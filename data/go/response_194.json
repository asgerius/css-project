[{"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1538005449, "last_edit_date": 1538005449, "creation_date": 1538000238, "answer_id": 52526750, "question_id": 52526413, "link": "https://stackoverflow.com/questions/52526413/how-do-i-keep-reading-the-remaining-bytes-after-reading-the-first-few-bytes-usin/52526750#52526750", "title": "How do I keep reading the remaining bytes after reading the first few bytes using conn.Read() in Go?", "body": "<p><a href=\"https://godoc.org/io#Reader.Read\" rel=\"nofollow noreferrer\">Read</a> returns when data is available, not when it fills the buffer.  Use <a href=\"https://godoc.org/io#ReadFull\" rel=\"nofollow noreferrer\">io.ReadFull()</a> to read until the buffer is full or there's an error reading from the connection.</p>\n\n<pre><code>_, err := io.ReadFull(conn, headerBuf)\n\n...\n\n_, err := io.ReadFull(conn, messageBuf)\n</code></pre>\n"}], "owner": {"reputation": 524, "user_id": 4695952, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ddbb13b83fa0193327392265d2b94963?s=128&d=identicon&r=PG&f=1", "display_name": "Dikshant Adhikari", "link": "https://stackoverflow.com/users/4695952/dikshant-adhikari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 52526750, "answer_count": 1, "score": 3, "last_activity_date": 1538005449, "creation_date": 1537998211, "question_id": 52526413, "link": "https://stackoverflow.com/questions/52526413/how-do-i-keep-reading-the-remaining-bytes-after-reading-the-first-few-bytes-usin", "title": "How do I keep reading the remaining bytes after reading the first few bytes using conn.Read() in Go?", "body": "<p>I am trying to read from a tcp connection in Go. I have a specific header format I am trying to parse first. So read the first 12 bytes which has the info associated with the header. And that tells me that the remaining message length is a certain amount of bytes. In this case 1607 bytes. I tried the following code where I read the header bytes, and then tried to read the remaining bytes.</p>\n\n<pre><code>import (\"net\"\n        log \"github.com/sirupsen/logrus\"\n       \"bytes\"\n       \"encoding/binary\"\n)\n\nfunc handleRequest(conn net.Conn) {\n\n    // Structs to make header parsing easiers\n    type encapSTHdrMsgType uint16\n    type encapSTHdrMsgEncap uint16\n    type encapSTHdr struct {\n        MsgType       encapSTHdrMsgType\n        MsgEncap      encapSTHdrMsgEncap\n        MsgHdrVersion uint16\n        Msgflag       uint16\n        Msglen        uint32\n    }\n\n    // Make a buffer to hold header data.\n    headerBuf := make([]byte, 12)\n\n    // Read the incoming header info into the buffer.\n    _, err := conn.Read(headerBuf)\n    if err != nil {\n        log.Debug(\"Error reading:\", err.Error())\n    }\n\n    // Header is in big endian\n    var header encapSTHdr\n    headerReader := bytes.NewReader(headerBuf)\n    err = binary.Read(headerReader, binary.BigEndian, &amp;header)\n    if err != nil {\n        log.Debugf(\"Could not read header bytes into the buffer: %v\", err)\n    }\n\n    messageBuf := make([]byte, header.Msglen)\n    messageBufLen, err := conn.Read(messageBuf)\n    if err != nil {\n        log.Debugf(\"Error reading messages: %s\", err.Error())\n    }\n    log.Debugf(\"The message buffer length is: %d\", messageBufLen)\n    log.Debugf(\"The header message length is: %d\", header.Msglen) \n}\n</code></pre>\n\n<p>When I try reading the remaining bytes by making a new buffer of the desired length of 1607, I get a new byte array with data but it is only of length 1228. Hence, I have two questions:</p>\n\n<p>1) Why does conn.Read()not read the remaining bytes?</p>\n\n<p>2) Now I am aware I can use a for loop until I have read the desired amount of bytes and break when done but I was wondering if there was a better way to do this?</p>\n"}, {"tags": ["go", "amp-html"], "comments": [{"owner": {"reputation": 3342, "user_id": 5635098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D4c6F.jpg?s=128&g=1", "display_name": "Bachcha Singh", "link": "https://stackoverflow.com/users/5635098/bachcha-singh"}, "edited": false, "score": 0, "creation_date": 1538024376, "post_id": 52526339, "comment_id": 91998605, "body": "<a href=\"https://stackoverflow.com/a/46480932/5635098\">stackoverflow.com/a/46480932/5635098</a> hope this help you?"}], "answers": [{"tags": [], "owner": {"reputation": 86, "user_id": 8474185, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b6rGZ.jpg?s=128&g=1", "display_name": "Epanemu", "link": "https://stackoverflow.com/users/8474185/epanemu"}, "is_accepted": true, "score": 0, "last_activity_date": 1537998708, "last_edit_date": 1537998708, "creation_date": 1537998190, "answer_id": 52526408, "question_id": 52526339, "link": "https://stackoverflow.com/questions/52526339/amp-form-always-showing-submit-error-even-on-response-code-200/52526408#52526408", "title": "AMP Form always showing submit-error, even on response code 200", "body": "<p>I feel embarrassed.\nAfter a couple of days wondering and getting back to this issue, when I finally decide to post a question, an idea struck me right after I do it...</p>\n\n<p>The problem is with header <code>Content-type</code>. It must be set to JSON:</p>\n\n<pre><code>Content-type: application/json\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1561, "user_id": 6512693, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tgtV5lsxjAk/AAAAAAAAAAI/AAAAAAAAACY/OLMWRPMKlFk/photo.jpg?sz=128", "display_name": "Varun Kumar", "link": "https://stackoverflow.com/users/6512693/varun-kumar"}, "is_accepted": false, "score": 0, "last_activity_date": 1559036562, "creation_date": 1559036562, "answer_id": 56339308, "question_id": 52526339, "link": "https://stackoverflow.com/questions/52526339/amp-form-always-showing-submit-error-even-on-response-code-200/56339308#56339308", "title": "AMP Form always showing submit-error, even on response code 200", "body": "<p>Make sure that you implement AMP CORS headers.</p>\n\n<p>Refer: <a href=\"https://amp.dev/documentation/guides-and-tutorials/learn/amp-caches-and-cors/amp-cors-requests?referrer=ampproject.org\" rel=\"nofollow noreferrer\">https://amp.dev/documentation/guides-and-tutorials/learn/amp-caches-and-cors/amp-cors-requests?referrer=ampproject.org</a></p>\n\n<p>If requests are for your own origin (your domain and not amp cached servers) then you can set following headers-</p>\n\n<pre><code>if (req.headers['amp-same-origin'] === 'true') {\n    origin = req.query.__amp_source_origin;\n    sourceOrigin = origin;\n}\n\nres.set({\n    'Access-Control-Allow-Origin': origin,\n    'AMP-Access-Control-Allow-Source-Origin': sourceOrigin,\n    'Access-Control-Allow-Source-Origin': 'AMP-Access-Control-Allow-Source-Origin',\n    'Access-Control-Expose-Headers': 'Access-Control-Allow-Origin' + ', AMP-Access-Control-Allow-Source-Origin' + ', Access-Control-Allow-Source-Origin'\n});\n</code></pre>\n"}], "owner": {"reputation": 86, "user_id": 8474185, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/b6rGZ.jpg?s=128&g=1", "display_name": "Epanemu", "link": "https://stackoverflow.com/users/8474185/epanemu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 702, "favorite_count": 0, "accepted_answer_id": 52526408, "answer_count": 2, "score": 1, "last_activity_date": 1559036562, "creation_date": 1537997810, "last_edit_date": 1538024799, "question_id": 52526339, "link": "https://stackoverflow.com/questions/52526339/amp-form-always-showing-submit-error-even-on-response-code-200", "title": "AMP Form always showing submit-error, even on response code 200", "body": "<p>I am using AMP form to send data to my Golang server. Even if I skip all handling of data sent and just write response with the code 200 as is said in AMP form reference, I still get shown the submit-error template.</p>\n\n<p>This is my form (I skipped the fields because it would be too long)</p>\n\n<pre><code>&lt;form action-xhr=\"/contactus\" method=\"POST\" class=\"contactForm\" target=\"_top\" custom-validation-reporting=\"show-all-on-submit\" id=\"contactForm\"&gt;\n    &lt;fieldset&gt;\n        &lt;!-- divs with input and submit button --&gt;\n    &lt;/fieldset&gt;\n    &lt;div submit-success&gt;\n        &lt;template type=\"amp-mustache\"&gt;\n            Success! \n        &lt;/template&gt;\n    &lt;/div&gt;\n    &lt;div submit-error&gt;\n        &lt;template type=\"amp-mustache\"&gt;\n            Error! \n        &lt;/template&gt;\n    &lt;/div&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>And this is an example of server response:</p>\n\n<pre><code>HTTP/1.1 200 OK\nContent-Encoding: gzip\nVary: Accept-Encoding\nDate: Sun, 23 Sep 2018 21:48:15 GMT\nContent-Length: 23\nContent-Type: application/x-gzip\n</code></pre>\n\n<p>Could the problem be on server side? \nI can't figure it out... Any idea is much appreciated</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda"], "comments": [{"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1537996185, "post_id": 52525862, "comment_id": 91991952, "body": "I haven&#39;t tried this myself, but, maybe take a look at <a href=\"https://godoc.org/github.com/aws/aws-lambda-go/lambdacontext#NewContext\" rel=\"nofollow noreferrer\"><code>lambdacontext.NewContext</code></a> from the SDK. This way, you should be able to add the data, lambda would add, yourself. You can construct the parent context with <a href=\"https://golang.org/pkg/context/#Background\" rel=\"nofollow noreferrer\"><code>context.Background()</code></a> and add a deadline/cancel it etc. using the other functions in the <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\"><code>context</code></a> package. I don&#39;t know, if AWS does any other magic with the context, thus this might not completely duplicate all functionally."}, {"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1538009082, "post_id": 52525862, "comment_id": 91995302, "body": "why is the <code>HandleRequest</code> having no <code>http.Request, http.ResponseWriter</code> pair? if it is a handler, how do you take care of that?"}], "answers": [{"tags": [], "owner": {"reputation": 1922, "user_id": 781978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16a69772a226fa055da82cce2c1241f1?s=128&d=identicon&r=PG", "display_name": "twsaef", "link": "https://stackoverflow.com/users/781978/twsaef"}, "is_accepted": false, "score": 1, "last_activity_date": 1538004927, "creation_date": 1538004927, "answer_id": 52527393, "question_id": 52525862, "link": "https://stackoverflow.com/questions/52525862/how-to-mock-aws-lambda-context-when-testing-lambda-handler-in-go/52527393#52527393", "title": "How to mock AWS Lambda context when testing lambda handler in Go?", "body": "<p>Will <code>context.TODO</code> satisfy your needs?</p>\n\n<p><a href=\"https://golang.org/pkg/context/#TODO\" rel=\"nofollow noreferrer\">https://golang.org/pkg/context/#TODO</a></p>\n"}, {"comments": [{"owner": {"reputation": 1556, "user_id": 691816, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/07a1c91639f297f3dbe8cb82f87ac961?s=128&d=identicon&r=PG", "display_name": "Edward J. Stembler", "link": "https://stackoverflow.com/users/691816/edward-j-stembler"}, "edited": false, "score": 0, "creation_date": 1538060486, "post_id": 52528389, "comment_id": 92019575, "body": "Yeah, I was beginning to come to the same conclusion that I shouldn&#39;t worry about mocking it.  Especially since I couldn&#39;t find any tests from Amazon which did.  Thanks!"}], "tags": [], "owner": {"reputation": 1306, "user_id": 5705686, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jYuOhkTQVgQ/AAAAAAAAAAI/AAAAAAAAA1A/v5x1CDU6W4s/photo.jpg?sz=128", "display_name": "dolan", "link": "https://stackoverflow.com/users/5705686/dolan"}, "is_accepted": true, "score": 2, "last_activity_date": 1538013896, "creation_date": 1538013896, "answer_id": 52528389, "question_id": 52525862, "link": "https://stackoverflow.com/questions/52525862/how-to-mock-aws-lambda-context-when-testing-lambda-handler-in-go/52528389#52528389", "title": "How to mock AWS Lambda context when testing lambda handler in Go?", "body": "<p>\u2018context.Context\u2019 is designed to be an immutable value (even though it is literally an interface). So I wouldn\u2019t be concerned with mocking it.</p>\n\n<p>There are two ways to create empty contexts (\u2018context.Background()\u2019 and \u2018context.TODO()\u2019). I would start with those. If you want to set something on the context, check out documentation on the context package.</p>\n"}], "owner": {"reputation": 1556, "user_id": 691816, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/07a1c91639f297f3dbe8cb82f87ac961?s=128&d=identicon&r=PG", "display_name": "Edward J. Stembler", "link": "https://stackoverflow.com/users/691816/edward-j-stembler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2705, "favorite_count": 1, "accepted_answer_id": 52528389, "answer_count": 2, "score": 4, "last_activity_date": 1538013896, "creation_date": 1537995077, "question_id": 52525862, "link": "https://stackoverflow.com/questions/52525862/how-to-mock-aws-lambda-context-when-testing-lambda-handler-in-go", "title": "How to mock AWS Lambda context when testing lambda handler in Go?", "body": "<p>I have an S3-triggered AWS Lambda written in Go.  I've been able to successfully test all of the ancillary code, however, I'm stuck trying to test the lambda handler.</p>\n\n<p>Here's the signature of my handler:</p>\n\n<pre><code>func HandleRequest(ctx context.Context, s3Event events.S3Event)\n</code></pre>\n\n<p>Here's the test code:</p>\n\n<pre><code>package main\n\nimport (\n  \"context\"\n  \"encoding/json\"\n  \"testing\"\n\n  \"github.com/aws/aws-lambda-go/events\"\n  \"github.com/stretchr/testify/assert\"\n)\n\nfunc TestHandleRequest(t *testing.T) {\n  // 1. read JSON from file\n  inputJSON, err := readJSONFromFile(\"./testdata/s3-event.json\")\n  if err != nil {\n    t.Errorf(\"could not open test file. details: %v\", err)\n  }\n\n  // 2. de-serialize into Go object\n  var inputEvent events.S3Event\n  if err := json.Unmarshal(inputJSON, &amp;inputEvent); err != nil {\n    t.Errorf(\"could not unmarshal event. details: %v\", err)\n  }\n\n  // 3. How can I mock the context.Context?\n\n  assert.NoError(t, HandleRequest(context.Context, inputEvent))\n}\n</code></pre>\n\n<p>I have no clue how I should mock the context.Context.  I couldn't find any examples online either.</p>\n\n<p>Anyone know?  Does my code look idiomatic for testing an S3-triggered, Go Lambda?</p>\n"}, {"tags": ["mongodb", "go", "revel", "medium.com"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1537989910, "post_id": 52524746, "comment_id": 91989238, "body": "Please show the code that actually produces this error, preferably a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Verifiable, Complete Example</a>. Without that, it&#39;s hard for anyone to help you."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 3494410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4e35384f6456b51ec9002a2d504775e?s=128&d=identicon&r=PG&f=1", "display_name": "user3494410", "link": "https://stackoverflow.com/users/3494410/user3494410"}, "is_accepted": true, "score": 0, "last_activity_date": 1537989879, "creation_date": 1537989879, "answer_id": 52524804, "question_id": 52524746, "link": "https://stackoverflow.com/questions/52524746/could-not-parse-line-126-mongo-database-mongo-db-test/52524804#52524804", "title": "could not parse line #126: mongo.database = mongo_db_test", "body": "<p>I solved just putting double quotes like this:</p>\n\n<pre><code> mongo.database = \"mongo_db_test\"\n mongo.path = \"127.0.0.1:27017\"\n mongo.maxPool = 20\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 3494410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4e35384f6456b51ec9002a2d504775e?s=128&d=identicon&r=PG&f=1", "display_name": "user3494410", "link": "https://stackoverflow.com/users/3494410/user3494410"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31, "favorite_count": 0, "accepted_answer_id": 52524804, "answer_count": 1, "score": -1, "last_activity_date": 1537989958, "creation_date": 1537989620, "last_edit_date": 1537989958, "question_id": 52524746, "link": "https://stackoverflow.com/questions/52524746/could-not-parse-line-126-mongo-database-mongo-db-test", "title": "could not parse line #126: mongo.database = mongo_db_test", "body": "<p>I'm following this tutorial <a href=\"https://medium.com/@kyawmyintthein/revel-mgo-restful-generator-for-revel-web-framework-mongodb-86209de3977e\" rel=\"nofollow noreferrer\">Golang + Revel web framework + Mongodb RESTFul generator for (revel_mgo)</a> step by step, but when I finally end it and try to run it, it throw this error </p>\n\n<p>CRIT  16:11:18 revel_container.go:139: Unable to load configuartion file        error=\"C:\\Users\\Userx\\go\\src\\RevelApp\\conf\\app.conf: could not parse line #126:  mongo.database = RevelApp\"</p>\n\n<p>The line #126 is like this:</p>\n\n<pre><code>[dev]\n\n126 - mongo.database = mongo_db_test\n127 - mongo.path = 127.0.0.1:27017\n128 - mongo.maxPool = 20\n</code></pre>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1537988254, "post_id": 52524265, "comment_id": 91988431, "body": "<a href=\"https://play.golang.org/p/bKfMLnthHnO\" rel=\"nofollow noreferrer\">play.golang.org/p/bKfMLnthHnO</a>"}, {"owner": {"reputation": 1152, "user_id": 747358, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/93e4090b9134e62d1b1cc5c26ff73c50?s=128&d=identicon&r=PG", "display_name": "MobileGuy", "link": "https://stackoverflow.com/users/747358/mobileguy"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1537988786, "post_id": 52524265, "comment_id": 91988684, "body": "Thank you! <code>start.Name.Local = &quot;param&quot;</code> was what I was missing"}], "owner": {"reputation": 1152, "user_id": 747358, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/93e4090b9134e62d1b1cc5c26ff73c50?s=128&d=identicon&r=PG", "display_name": "MobileGuy", "link": "https://stackoverflow.com/users/747358/mobileguy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1537988255, "creation_date": 1537987552, "last_edit_date": 1537988255, "question_id": 52524265, "link": "https://stackoverflow.com/questions/52524265/custom-marshal-array-of-xml-values", "title": "Custom Marshal Array of XML values", "body": "<p>I have the following set of <code>structs</code> that i need to write out in a certain way to XML:</p>\n\n<pre><code>type Parameter struct {                                                                                                                                                          \n    ParameterType             string        `xml:\"param_type\" json:\"parameterType\"`                                                                                              \n    ParameterValue            string        `xml:\"param_value,omitempty\" json:\"parameterValue,omitempty\"`                                                                        \n} \n\ntype Condition struct {                                                                                                                                                          \n    XMLName        xml.Name                                                                                                                         \n    LeftParameter  Parameter                                                                                                                            \n    Comparator     string      `xml:\"comparator\"`                                                                                           \n    RightParameter Parameter                                                                                                                             \n}\n\ntype Conditions struct {                                                                                                                                                        \n    ConditionList  []Condition  `xml:\"condition,omitempty\" json:\"condition,omitempty\"`                                                                                         \n}\n</code></pre>\n\n<p>I need to write both <code>LeftParameter</code> and <code>RightParameter</code> out as <code>&lt;param&gt;</code> in the XML.  It needs to look like this:</p>\n\n<pre><code>&lt;conditions&gt;                                                                                                                                                             \n  &lt;condition&gt;                                                                                                                                                            \n    &lt;param&gt;                                                                                                                                                              \n      &lt;param_type&gt;pop_ref&lt;/param_type&gt;                                                                                                                                   \n      &lt;param_value&gt;PtAge&lt;/param_value&gt;                                                                                                                                   \n    &lt;/param&gt;                                                                                                                                                             \n    &lt;comparator&gt;GE&lt;/comparator&gt;                                                                                                                                          \n    &lt;param&gt;                                                                                                                                                              \n      &lt;param_type&gt;value&lt;/param_type&gt;                                                                                                                                     \n      &lt;param_data_type&gt;number&lt;/param_data_type&gt;                                                                                                                          \n      &lt;param_value&gt;8&lt;/param_value&gt;                                                                                                                                       \n    &lt;/param&gt;                                                                                                                                                             \n  &lt;/condition&gt;  \n&lt;conditions&gt;                                                                                                                                                             \n</code></pre>\n\n<p>I assume that i should use the Marshaller interface for this, but i cannot figure out how to get it working.</p>\n"}, {"tags": ["go", "floating-point", "base", "base36"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1537985891, "post_id": 52523898, "comment_id": 91987290, "body": "Out of the box I do not think Go supports that format. However if you haven&#39;t come across this package check it out github.com/martinlindhe/base36."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10420388"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1537986129, "post_id": 52523898, "comment_id": 91987383, "body": "@reticenroot I&#39;ve already tried every base36 conversion package available, and unfortunately they don&#39;t output correctly."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1537986911, "post_id": 52523898, "comment_id": 91987793, "body": "Also that base36 package only accepts uint64 as parameter."}, {"owner": {"reputation": 1091, "user_id": 2160562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CcQEn.png?s=128&g=1", "display_name": "gammatester", "link": "https://stackoverflow.com/users/2160562/gammatester"}, "edited": false, "score": 0, "creation_date": 1537990043, "post_id": 52523898, "comment_id": 91989305, "body": "BTW: Your number is not exactly representable in base 36 and the JS result is incomplete, more digits are <code>0.d3lh1pogpwkf75gi0nweot08s8j4vucdfv5a335rdgxasxi02yvn0vp9d6&zwnj;&#8203;o...</code>"}], "answers": [{"tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 3, "last_activity_date": 1537988264, "last_edit_date": 1537988264, "creation_date": 1537987302, "answer_id": 52524228, "question_id": 52523898, "link": "https://stackoverflow.com/questions/52523898/how-do-i-convert-a-float64-to-base36-in-go/52524228#52524228", "title": "How do I convert a Float64 to Base36 in Go?", "body": "<p>Go base36 packages don't convert this properly because Javascript's <code>toString(36)</code> does not base36 encode the the float64, it represents it using a radix of 36. The documentation is lackluster as to the specifics of how this function works on <code>Number</code> objects (and only number objects), and the logic is really bizarre as well, but is located here: <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toString#Description\" rel=\"nofollow noreferrer\">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/toString#Description</a></p>\n\n<p>Basically, in the case of a non whole number, the value is converted to a number in baseN (where N is the radix passed in), by concatenating the conversion of the left side of the decimal with a dot, then with the conversion of the right side of the decimal. e.g.</p>\n\n<p><code>baseNLeft + \".\" + baseNRight</code></p>\n\n<p>There also other considerations explained in the documentation link above about negatives. Specifically that they preserve the negative and simply convert the digits then replace the negative sign instead of using the two's complement representation.</p>\n\n<p>In my opinion, this functionality is not suitable for any other language than Javascript itself, and I would advise caution in using it cross-language.</p>\n\n<p>As to the answering of the question itself as to how you would do this in Go. Follow the same goofy semantics and unit test it against hundreds of thousands of test cases to check that <code>f(x) = y</code> in both Javascript and your Go implementation. The actual specification of the logic is in the ECMA specification here: <a href=\"https://www.ecma-international.org/ecma-262/6.0/#sec-tostring-applied-to-the-number-type\" rel=\"nofollow noreferrer\">https://www.ecma-international.org/ecma-262/6.0/#sec-tostring-applied-to-the-number-type</a></p>\n\n<p><em>Note</em>: There is a Javascript engine implemented in Go called <code>otto</code> (github.com/robertkrimen/otto), but it <strong>does not</strong> properly perform the <code>Number.toString(radix)</code> functionality. Plus it is a heavy library to import if this would be it's only purpose anyway.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10420388"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 0, "accepted_answer_id": 52524228, "answer_count": 1, "score": -1, "last_activity_date": 1537988264, "creation_date": 1537985757, "question_id": 52523898, "link": "https://stackoverflow.com/questions/52523898/how-do-i-convert-a-float64-to-base36-in-go", "title": "How do I convert a Float64 to Base36 in Go?", "body": "<p>I have say the value <code>0.36388617850285954</code>, when I use the Javascript <code>.toString(36)</code> function I get the output <code>\"0.d3lh1pogpwk\".</code> I would like to replicate this in golang however I have no real starting point.</p>\n\n<p>How would I carry this out?</p>\n"}, {"tags": ["email", "go", "google-cloud-platform", "smtp", "google-workspace"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1537983784, "post_id": 52523375, "comment_id": 91986342, "body": "Passwords should never be in source files. They should be in environment variables, or stored in files that you&#39;ve told your repo to ignore."}, {"owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1537983874, "post_id": 52523375, "comment_id": 91986370, "body": "I was wondering if on Google Cloud, you could completely avoid specifying a password for sending an email"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1537983986, "post_id": 52523375, "comment_id": 91986412, "body": "Is this on App Engine? Standard, or Flex, or Compute Engine?"}, {"owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1537984243, "post_id": 52523375, "comment_id": 91986533, "body": "using Compute Engine"}], "answers": [{"comments": [{"owner": {"reputation": 925, "user_id": 597342, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/67cafe2c4f74121a4cd5575f3b5c068a?s=128&d=identicon&r=PG", "display_name": "fjlksahfob", "link": "https://stackoverflow.com/users/597342/fjlksahfob"}, "edited": false, "score": 0, "creation_date": 1590359549, "post_id": 52524759, "comment_id": 109644576, "body": "you could also store the password information in secrets manager and pull it from there within your cloud application"}], "tags": [], "owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "is_accepted": true, "score": 3, "last_activity_date": 1537992102, "last_edit_date": 1537992102, "creation_date": 1537989664, "answer_id": 52524759, "question_id": 52523375, "link": "https://stackoverflow.com/questions/52523375/how-to-send-emails-via-g-suite-from-google-cloud/52524759#52524759", "title": "How to send emails via G-suite from Google Cloud", "body": "<p><strong>I found the solution!</strong></p>\n\n<p>And it's very simple: instead of specifying the account password, you can restrict the connection to <strong>your server IP address</strong>.</p>\n\n<p>1) Sign in to your Google Admin console (<a href=\"https://admin.google.com\" rel=\"nofollow noreferrer\">https://admin.google.com</a>) using the G-suite administrator account</p>\n\n<p>2) Click on <strong>Apps</strong> -> <strong>G Suite</strong> -> <strong>Gmail</strong> -> <strong>Advanced settings</strong></p>\n\n<p>3) At the bottom of the page, mouse over on <strong>SMTP Relay Service</strong> and click on \"<em>ADD ANOTHER</em>\"</p>\n\n<p>4) As <strong>Allowed Sender</strong> select \"<em>Only addresses in my domain</em>\"</p>\n\n<p>5) Check <strong>Only accept mail from the specified IP addresses</strong> and type <em>your server IP address</em></p>\n\n<p>6) Confirm by clicking on \"<em>ADD SETTING</em>\" and then \"<em>SAVE</em>\"</p>\n\n<p><br><br>\nThis is the Go code required to send an email:</p>\n\n<pre><code>from := \"myuser@mydomain.com\"\nto := \"mail@recipient.com\"\n\nmsg := \"From: \" + from + \"\\n\" +\n    \"To: \" + to + \"\\n\" +\n    \"Subject: Hello there\\n\\n\" +\n    \"SOME TEXT\"\n\nerr := smtp.SendMail(\"smtp-relay.gmail.com:587\", nil,\n    from, []string{to}, []byte(msg))\n\nif err != nil {\n    log.Printf(\"smtp error: %s\", err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "is_accepted": false, "score": 1, "last_activity_date": 1612273914, "creation_date": 1612273914, "answer_id": 66011094, "question_id": 52523375, "link": "https://stackoverflow.com/questions/52523375/how-to-send-emails-via-g-suite-from-google-cloud/66011094#66011094", "title": "How to send emails via G-suite from Google Cloud", "body": "<p>An even better way is to create API/OAuth2 credentials directly in Google Cloud.\nIn this way you don't even have to specify the server IP addresses as a security measure:</p>\n<p><a href=\"https://medium.com/wesionary-team/sending-emails-with-go-golang-using-smtp-gmail-and-oauth2-185ee12ab306\" rel=\"nofollow noreferrer\">https://medium.com/wesionary-team/sending-emails-with-go-golang-using-smtp-gmail-and-oauth2-185ee12ab306</a></p>\n"}], "owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 929, "favorite_count": 1, "accepted_answer_id": 52524759, "answer_count": 2, "score": 1, "last_activity_date": 1612273914, "creation_date": 1537983632, "last_edit_date": 1537995906, "question_id": 52523375, "link": "https://stackoverflow.com/questions/52523375/how-to-send-emails-via-g-suite-from-google-cloud", "title": "How to send emails via G-suite from Google Cloud", "body": "<p>How can you send an email in Go from the Google Cloud owner G-suite email account?</p>\n\n<p>Is it possible to use the Google Cloud projectID existing authorizations, without specifying the Google account password inside the Go source files?</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1537983413, "post_id": 52523136, "comment_id": 91986182, "body": "@ThunderCat <code>executing &quot;index&quot; at &lt;$element&gt;: range can&#39;t iterate over true</code> although it displays all data from the map correctly. I don&#39;t understand this error."}, {"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1537983963, "post_id": 52523136, "comment_id": 91986403, "body": "@ThunderCat I see. Question edited."}, {"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1537984348, "post_id": 52523136, "comment_id": 91986578, "body": "@ThunderCat I discovered that and managed to fix the issue. Thanks for the help!"}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1537984810, "post_id": 52523555, "comment_id": 91986778, "body": "This is more efficient than me having to simply return just <code>result</code>. Cheers for that!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1555610480, "last_edit_date": 1555610480, "creation_date": 1537984388, "answer_id": 52523555, "question_id": 52523136, "link": "https://stackoverflow.com/questions/52523136/range-cant-iterate-over-true-when-it-displays-everything-correctly/52523555#52523555", "title": "Range can&#39;t iterate over true when it displays everything correctly?", "body": "<p>The outer range iterates over a map with the keys <code>result</code> and <code>success</code>. The inner range attempts to iterate over the values for these keys. The value for <code>success</code> is <code>true</code>.  It's not possible to range on a bool. </p>\n\n<p>Change the template range over <code>result</code> only:</p>\n\n<pre><code>{{define \"index\"}}\n        {{range .Items.result}}\n            {{.Title}}\n        {{end}}\n{{end}}\n</code></pre>\n\n<p>Also, modify the code to check and handle the error returned from <code>ExecuteTemplate</code>.</p>\n"}], "owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3567, "favorite_count": 0, "accepted_answer_id": 52523555, "answer_count": 1, "score": 1, "last_activity_date": 1555610480, "creation_date": 1537982572, "last_edit_date": 1537984323, "question_id": 52523136, "link": "https://stackoverflow.com/questions/52523136/range-cant-iterate-over-true-when-it-displays-everything-correctly", "title": "Range can&#39;t iterate over true when it displays everything correctly?", "body": "<p>I'm having a weird issue with Go templates. For some reason when I use double <code>range</code> it stops rendering everything below it in the code.</p>\n\n<pre><code>// Index.html\n{{define \"index\"}}\n    {{range $k, $element := .Items}}\n        {{range $element}}\n            {{.Title}}\n        {{end}}\n    {{end}}\n{{end}}\n</code></pre>\n\n<p>This is my Go code:</p>\n\n<pre><code>data := IndexData{\n    Items: items,\n}\n\nIndexTemplate := template.Must(template.New(\"skeleton.html\").Funcs(FuncTemplate).ParseFiles(\"skeleton.html\", \"index.html\"))\nIndexTemplate.ExecuteTemplate(w, \"skeleton\", data)\n</code></pre>\n\n<p>It does show the data correctly on my page and there are no errors. The only problem here is that it stops the rendering of the page after the last item is displayed.</p>\n\n<p>In my skeleton I display my templates like this, depending on what page they're visiting:</p>\n\n<pre><code>// Skeleton.html\n{{define \"skeleton\"}}\n    {{block \"index\".}}{{end}}\n    {{block \"account.register\".}}{{end}}\n    {{block \"account.login\".}}{{end}}\n    {{block \"account.profile\".}}{{end}}\n{{end}}\n</code></pre>\n\n<p>Why does it stop rendering after the last item is displayed from the range?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Only error displayed is <code>executing \"index\" at &lt;$element&gt;: range can't iterate over true</code></p>\n\n<p><strong>EDIT 2:</strong></p>\n\n<p><code>.Item</code> is a <code>map[string]interface{}</code> that contains the following:</p>\n\n<pre><code>map[result:[map[Title:Hello World2 Content:Lorem ipsum dolor sit amet2...] map[Title:Hello World Content:Lorem ipsum dolor sit amet...]] success:true]\n</code></pre>\n\n<p><strong>Solution</strong></p>\n\n<p>I managed to solve this by properly returning the data I need to use without the <code>success:true</code> part as well as using it as <code>interface{}</code> so I don't have to use 2 range loops.</p>\n"}, {"tags": ["rest", "unit-testing", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1537965631, "post_id": 52517842, "comment_id": 91975456, "body": "Can you show the code that is not working as you expect? the <code>TheFunc</code>?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1537965793, "post_id": 52517842, "comment_id": 91975565, "body": "... also don&#39;t ignore the error from <code>json.Unmarshal</code>, it just might point you to your bug."}, {"owner": {"reputation": 122, "user_id": 8184302, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fS0fA.png?s=128&g=1", "display_name": "Harshit Vadhera", "link": "https://stackoverflow.com/users/8184302/harshit-vadhera"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1537965820, "post_id": 52517842, "comment_id": 91975582, "body": "func TheFunc(c *gin.Context) { \tGetErrResponseList(c, config.FailureMsg, nil, nil) }                                                                                                                                it is just a simple function which will give 400 as the response code."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1537966136, "post_id": 52517842, "comment_id": 91975798, "body": "Actually your second test case makes little to no sense... assuming <code>TestGetProviders</code> is inteded to test <code>GetProviders</code> then there is no point for your second test case as it doesnt test that handler at all, it executes a different handler with a different endpoint, you gain no knowledge about GetProviders from that test case."}, {"owner": {"reputation": 122, "user_id": 8184302, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fS0fA.png?s=128&g=1", "display_name": "Harshit Vadhera", "link": "https://stackoverflow.com/users/8184302/harshit-vadhera"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1537966215, "post_id": 52517842, "comment_id": 91975860, "body": "but it should not be giving 500 as the error"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1537966241, "post_id": 52517842, "comment_id": 91975882, "body": "what is giving you 500, and what should that thing give you instead?"}, {"owner": {"reputation": 122, "user_id": 8184302, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fS0fA.png?s=128&g=1", "display_name": "Harshit Vadhera", "link": "https://stackoverflow.com/users/8184302/harshit-vadhera"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1537966370, "post_id": 52517842, "comment_id": 91975945, "body": "the second test case is giving 500 response code on get but it should be giving 400 as the response code as i have specified it in the function."}, {"owner": {"reputation": 122, "user_id": 8184302, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fS0fA.png?s=128&g=1", "display_name": "Harshit Vadhera", "link": "https://stackoverflow.com/users/8184302/harshit-vadhera"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1537966412, "post_id": 52517842, "comment_id": 91975974, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/180799/discussion-between-harshit-vadhera-and-mkopriva\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 122, "user_id": 8184302, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fS0fA.png?s=128&g=1", "display_name": "Harshit Vadhera", "link": "https://stackoverflow.com/users/8184302/harshit-vadhera"}, "is_accepted": true, "score": 1, "last_activity_date": 1537968339, "creation_date": 1537968339, "answer_id": 52518888, "question_id": 52517842, "link": "https://stackoverflow.com/questions/52517842/go-passing-the-test-case-while-giving-500-as-the-response/52518888#52518888", "title": "Go passing the test case while giving 500 as the response", "body": "<p>Finally After Some Discussion with </p>\n\n<blockquote>\n  <p>mkopriva</p>\n</blockquote>\n\n<p>I Was Able To Solve The Problem.</p>\n\n<p>I have been Using Defer c.Request.Body.Close() in GetErrResponseList inside the </p>\n\n<pre><code>func TheFunc(c *gin.Context) { \n\nGetErrResponseList(c, config.FailureMsg, nil, nil) \n\n}\n</code></pre>\n\n<p>like this </p>\n\n<pre><code>func GetErrResponseList(c *gin.Context, msg string, data, count interface{}) { \ndefer c.Request.Body.Close() \nresponse := ResponseControllerList{400, 0, msg, data, count} \nc.JSON(200, gin.H{ \nconfig.Response: response, \n}) \n}\n</code></pre>\n\n<p>Which Was Causing The Problem as a request body does not need to be closed in the handler. and so it was closing the body just before it could be used and hence removing it solved the problem.</p>\n"}], "owner": {"reputation": 122, "user_id": 8184302, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fS0fA.png?s=128&g=1", "display_name": "Harshit Vadhera", "link": "https://stackoverflow.com/users/8184302/harshit-vadhera"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 1, "accepted_answer_id": 52518888, "answer_count": 1, "score": -1, "last_activity_date": 1537968339, "creation_date": 1537965103, "last_edit_date": 1537966394, "question_id": 52517842, "link": "https://stackoverflow.com/questions/52517842/go-passing-the-test-case-while-giving-500-as-the-response", "title": "Go passing the test case while giving 500 as the response", "body": "<pre><code>request, err := http.NewRequest(\"GET\", path, nil)\nresponse := httptest.NewRecorder()\nr.ServeHTTP(response, request)\nvar raw map[string]map[string]string\n_ = json.Unmarshal(response.Body.Bytes(), &amp;raw)\ndetails := raw[\"response\"]\n</code></pre>\n\n<p>I have a TestFunction in which I am using this code. It is code\nto test the REST API for a GET request. </p>\n\n<p>In my first test case I hit a defined handler while in the second test case I am hitting some random handler so as to make that case fail.</p>\n\n<p>The code is getting passed but every time the second test case is giving 500 as the response.</p>\n\n<p>Below is the code of my test case.</p>\n\n<pre><code>func TestGetProviders(t *testing.T) {\ntype args struct {\n    path    string\n    handler gin.HandlerFunc\n}\ntests := []struct {\n    name string\n    args args\n    want bool\n}{\n    {\n        \"First\",\n        args{\n            \"/api/v1/providers\",\n            GetProviders,\n        },\n        true,\n    },\n    {\n        \"Second\",\n        args{\n            \"/demo\",\n            TheFunc,\n        },\n        false,\n    },\n}\nfor _, tt := range tests {\n    t.Run(tt.name, func(t *testing.T) {\n        value := copyCodeGet(tt.args.path, tt.args.handler)\n        if len(value[\"response\"]) &gt; 0 {\n            statusCode, _ := strconv.Atoi(value[\"response\"][\"code\"])\n            if val := statusCode == config.SuccessCode &amp;&amp; value[\"response\"][\"message\"] == config.SuccessMsg; val != tt.want {\n                t.Errorf(\"Error is:%v &amp;&amp; Status code should be %v, was %d.\", value, http.StatusOK, statusCode)\n            }\n        }\n    })\n}\n</code></pre>\n\n<p>} </p>\n"}, {"tags": ["go", "iis", "iis-express", "devops", "event-stream"], "answers": [{"tags": [], "owner": {"reputation": 129, "user_id": 2306278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a04c75c401f0157d02d33d84f6cf190f?s=128&d=identicon&r=PG", "display_name": "Mossila", "link": "https://stackoverflow.com/users/2306278/mossila"}, "is_accepted": true, "score": 0, "last_activity_date": 1538130648, "creation_date": 1538130648, "answer_id": 52553427, "question_id": 52517156, "link": "https://stackoverflow.com/questions/52517156/how-to-config-httpplatformhandler-of-iis-for-server-sent-event-sse-eventstream/52553427#52553427", "title": "How to config HTTPPlatformHandler of IIS for Server Sent Event (SSE, EventStream)", "body": "<p>Actually HttpPlatformHandler has <a href=\"https://github.com/aspnet/IISIntegration/issues/7\" rel=\"nofollow noreferrer\">8kb output buffer</a> , so my message is not sent out immediately. </p>\n\n<p>I have to change <a href=\"https://github.com/aspnet/IISIntegration/issues/105\" rel=\"nofollow noreferrer\">HttpPlatformHandler to ASP.NET Core Module</a>, \nso <code>web.config</code> must update to this.</p>\n\n<pre><code>    &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n    &lt;configuration&gt;\n      &lt;system.webServer&gt;\n        &lt;handlers&gt;\n          &lt;add name=\"aspNetCore\" path=\"*\" verb=\"*\" modules=\"AspNetCoreModule\" resourceType=\"Unspecified\" /&gt;\n        &lt;/handlers&gt;\n        &lt;aspNetCore processPath=\".\\sse_server.exe\"  /&gt;\n      &lt;/system.webServer&gt;\n    &lt;/configuration&gt;\n</code></pre>\n\n<p>And to start <code>go</code> 's application as <code>aspNetCore</code> on <code>iis</code>, the application need to get environment variable name <code>ASPNETCORE_PORT</code> then start http service on that port. </p>\n\n<pre><code>port := os.Getenv(\"ASPNETCORE_PORT\")\nhttp.ListenAndServe(\":\"+port, nil)\n</code></pre>\n\n<p>That's all!</p>\n"}], "owner": {"reputation": 129, "user_id": 2306278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a04c75c401f0157d02d33d84f6cf190f?s=128&d=identicon&r=PG", "display_name": "Mossila", "link": "https://stackoverflow.com/users/2306278/mossila"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 966, "favorite_count": 1, "accepted_answer_id": 52553427, "answer_count": 1, "score": 0, "last_activity_date": 1538130648, "creation_date": 1537962866, "last_edit_date": 1538015983, "question_id": 52517156, "link": "https://stackoverflow.com/questions/52517156/how-to-config-httpplatformhandler-of-iis-for-server-sent-event-sse-eventstream", "title": "How to config HTTPPlatformHandler of IIS for Server Sent Event (SSE, EventStream)", "body": "<p>Currently I have program that provide SSE as a service, and I have to deploy on IIS. But its does not work correctly, \nHere is the result when I run .exe without IIS. </p>\n\n<pre><code>data: Hello, world\n</code></pre>\n\n<p>But when its run behind IIS, Browser was stuck on loading.\nI have to flush event <code>Hello, world</code> thousand times to make IIS flush result to browser and it's flush instantly instead of incremental update like SSE use to be. </p>\n\n<p>Here is my <code>web.config</code> </p>\n\n<pre><code>    &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n    &lt;configuration&gt;\n      &lt;system.webServer&gt;\n        &lt;handlers&gt;\n          &lt;add name=\"httpplatformhandler\" path=\"*\" verb=\"*\" modules=\"httpPlatformHandler\" resourceType=\"Unspecified\" /&gt;\n        &lt;/handlers&gt;\n        &lt;httpPlatform processPath=\".\\sse_server.exe\" \n          arguments=\"-port=%HTTP_PLATFORM_PORT% -environment development\" \n          stdoutLogEnabled=\"false\" \n          requestTimeout=\"00:05:00\" \n          stdoutLogFile=\".\\sse_server_log\"&gt;\n        &lt;/httpPlatform&gt;\n        &lt;urlCompression doStaticCompression=\"true\" doDynamicCompression=\"false\" /&gt;\n        &lt;caching enabled=\"false\" enableKernelCache=\"false\" /&gt;\n      &lt;/system.webServer&gt;\n    &lt;/configuration&gt;\n</code></pre>\n\n<p>Here is my <code>go</code> code</p>\n\n<pre><code>func SSEHello(rw http.ResponseWriter, flusher http.Flusher) {\n    rw.Header().Set(\"Content-Type\", \"text/event-stream; charset=utf-8\")\n    rw.Header().Set(\"Cache-Control\", \"no-cache\")\n    rw.Header().Set(\"Connection\", \"keep-alive\")\n    rw.WriteHeader(http.StatusOK)\n    for i := 0; i &lt; 1000; i++ {\n        rw.Write([]byte(\"data:Hello, world\\n\\n\"))\n        flusher.Flush()\n        time.Sleep(time.Millisecond * 100)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "mime"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1537961413, "post_id": 52516634, "comment_id": 91972845, "body": "RFC 6266 is &quot;just&quot; a proposed standard."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1537963094, "creation_date": 1537963094, "answer_id": 52517228, "question_id": 52516634, "link": "https://stackoverflow.com/questions/52516634/get-utf-8-filename-from-content-disposition-header/52517228#52517228", "title": "Get UTF-8 Filename from Content-Disposition Header", "body": "<p>The quotes must surround the header value:</p>\n\n<pre><code>attachment; filename*=\"UTF-8''Geotag_Stamp%20(1)%20(1).jpg\"\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/aG9zp-9wVkG\" rel=\"nofollow noreferrer\">Run it on the playground</a></p>\n"}], "owner": {"reputation": 1322, "user_id": 7533177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YtNtF.jpg?s=128&g=1", "display_name": "Simon Frey", "link": "https://stackoverflow.com/users/7533177/simon-frey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1135, "favorite_count": 1, "accepted_answer_id": 52517228, "answer_count": 1, "score": 1, "last_activity_date": 1537963094, "creation_date": 1537961118, "last_edit_date": 1537961296, "question_id": 52516634, "link": "https://stackoverflow.com/questions/52516634/get-utf-8-filename-from-content-disposition-header", "title": "Get UTF-8 Filename from Content-Disposition Header", "body": "<p>When I try to get the filename from the Content-Disposition Header the go function <code>mime.ParseMediaType()</code> fails with the error <code>mime: invalid media parameter</code></p>\n\n<hr>\n\n<p>I already found out, that it works with the normal filename format:</p>\n\n<p><code>attachment; filename=\"Geotag_Stamp%20(1)%20(1).jpg\"</code> &lt;- works</p>\n\n<p>But with the UTF-8 filename (defined in <a href=\"https://tools.ietf.org/html/rfc6266#page-5\" rel=\"nofollow noreferrer\">rfc6266</a>) it failes with the error given in the first paragraph:</p>\n\n<p><code>attachment; filename*=UTF-8''\"Geotag_Stamp%20(1)%20(1).jpg\"</code> &lt;- Fails</p>\n\n<hr>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"mime\"\n)\n\nfunc main() {\n    d, params, err := mime.ParseMediaType(`attachment; filename=\"Geotag_Stamp%20(1)%20(1).jpg\"`)\n    if err != nil {\n        fmt.Println(\"**Normal Filename error:\", err)\n    }\n\n    fmt.Println(\"Normal:\", d, params)\n    d, params, err = mime.ParseMediaType(`attachment; filename*=UTF-8''\"Geotag_Stamp%20(1)%20(1).jpg\"`)\n    if err != nil {\n        fmt.Println(\"**UTF-8 Filename error:\", err)\n    }\n    fmt.Println(\"UTF-8\",d, params)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/iSXX8DG6g3n\" rel=\"nofollow noreferrer\">On the playground</a></p>\n\n<hr>\n\n<p>Is it possible that the stdlib does not support the UTF-8 version of Content-Disposition->Filename ?</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1537961219, "post_id": 52516612, "comment_id": 91972744, "body": "What good is a time without the timezone?  Without the timezone, the time you obtain is ambiguous."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1537961220, "post_id": 52516612, "comment_id": 91972746, "body": "Simply call <code>newTime.UTC()</code>. It returns the new time, you may want to store it, e.g. <code>newTime = newTime.UTC()</code>."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1537961254, "post_id": 52516612, "comment_id": 91972769, "body": "or you can format the time using time.Parse according to the format you want."}, {"owner": {"reputation": 103, "user_id": 10185451, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8035dd743c69e54ae059b900cd7b81c8?s=128&d=identicon&r=PG&f=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/10185451/martin"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1537961559, "post_id": 52516612, "comment_id": 91972918, "body": "@AndrewHenle my program is used only in one time zone, so i want only get time,without timezone."}, {"owner": {"reputation": 103, "user_id": 10185451, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8035dd743c69e54ae059b900cd7b81c8?s=128&d=identicon&r=PG&f=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/10185451/martin"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1537961605, "post_id": 52516612, "comment_id": 91972939, "body": "@icza converts time, after <code>.UTC()</code> i got my time minus 5 hours"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1537961666, "post_id": 52516612, "comment_id": 91972978, "body": "Then it looks you <b>do</b> want it in local timezone, you just don&#39;t want to print the zone info. Then use your intended format, and print it with <code>time.Format()</code>."}, {"owner": {"reputation": 103, "user_id": 10185451, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8035dd743c69e54ae059b900cd7b81c8?s=128&d=identicon&r=PG&f=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/10185451/martin"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1537961713, "post_id": 52516612, "comment_id": 91973006, "body": "@icza yes, thank you"}], "owner": {"reputation": 103, "user_id": 10185451, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8035dd743c69e54ae059b900cd7b81c8?s=128&d=identicon&r=PG&f=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/10185451/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "closed_date": 1537961210, "answer_count": 0, "score": 0, "last_activity_date": 1537961718, "creation_date": 1537961047, "last_edit_date": 1537961684, "question_id": 52516612, "link": "https://stackoverflow.com/questions/52516612/how-to-get-time-without-timezone", "closed_reason": "Duplicate", "title": "How to get time without timezone?", "body": "<p>I'm converting unix timestamp to time</p>\n\n<pre><code>newTime := time.Unix(int64(1537957097), 0)\n</code></pre>\n\n<p>and it retrns time with a timezone - 2017-10-12T19:10:56+05:00</p>\n\n<p>how can i remove time zone from it?</p>\n\n<p>format i want to get - 2017-10-12T19:10:56</p>\n"}, {"tags": ["java", "regex", "go"], "comments": [{"owner": {"reputation": 1633, "user_id": 7639034, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/x3qat.jpg?s=128&g=1", "display_name": "Code_Ninja", "link": "https://stackoverflow.com/users/7639034/code-ninja"}, "edited": false, "score": 0, "creation_date": 1537960906, "post_id": 52516475, "comment_id": 91972564, "body": "You can check whether the regex is correct or not and it flow of control in <a href=\"https://regexper.com\" rel=\"nofollow noreferrer\">this</a> link."}, {"owner": {"reputation": 27610, "user_id": 85421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kKvXH.gif?s=128&g=1", "display_name": "user85421", "link": "https://stackoverflow.com/users/85421/user85421"}, "edited": false, "score": 2, "creation_date": 1537961252, "post_id": 52516475, "comment_id": 91972765, "body": "according <a href=\"https://golang.org/s/re2syntax#user-content-ascii\" rel=\"nofollow noreferrer\">documentation</a> you can use <code>[[:xdigit:]]</code> (instead of <code>\\\\p{XDigit}</code>)"}, {"owner": {"reputation": 27610, "user_id": 85421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kKvXH.gif?s=128&g=1", "display_name": "user85421", "link": "https://stackoverflow.com/users/85421/user85421"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1537966633, "post_id": 52516475, "comment_id": 91976104, "body": "@WiktorStribi\u017cew it is just one (half) line, you can integrate it in yours"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 27610, "user_id": 85421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kKvXH.gif?s=128&g=1", "display_name": "user85421", "link": "https://stackoverflow.com/users/85421/user85421"}, "edited": false, "score": 0, "creation_date": 1537971795, "post_id": 52516475, "comment_id": 91979539, "body": "@CarlosHeuberger Ok, see, thanks."}], "answers": [{"comments": [{"owner": {"reputation": 1074, "user_id": 2185630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/798165e76261cc1d73e033d815effdf9?s=128&d=identicon&r=PG", "display_name": "dbl", "link": "https://stackoverflow.com/users/2185630/dbl"}, "edited": false, "score": 0, "creation_date": 1537961931, "post_id": 52516521, "comment_id": 91973134, "body": "Please consider taking into account @Carlos Heuberger comment."}, {"owner": {"reputation": 27610, "user_id": 85421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kKvXH.gif?s=128&g=1", "display_name": "user85421", "link": "https://stackoverflow.com/users/85421/user85421"}, "edited": false, "score": 1, "creation_date": 1537966784, "post_id": 52516521, "comment_id": 91976204, "body": "no need to post it myself.... not sure, but <code>[[:xdigit:]]</code> is just one <i>token</i>, <code>[a-fA-F0-9]</code> can be a bit more complicated (implementation-wise) and the later one is more <i>traditional</i>, should work no matter which regular expression"}], "tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": false, "score": 4, "last_activity_date": 1537972034, "last_edit_date": 1537972034, "creation_date": 1537960763, "answer_id": 52516521, "question_id": 52516475, "link": "https://stackoverflow.com/questions/52516475/converting-the-regular-expression-in-java-to-golang-correct-me/52516521#52516521", "title": "Converting the regular expression in java to golang. Correct me", "body": "<p>In <a href=\"https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html\" rel=\"nofollow noreferrer\">Java regex</a>, the <code>\\p{XDigit}</code> is just a shorthand for <code>[0-9a-fA-F]</code>:</p>\n\n<pre><b>POSIX character classes (US-ASCII only)</b>\n\\p{Lower}               A lower-case alphabetic character: [a-z]\n\\p{Upper}               An upper-case alphabetic character:[A-Z]\n\\p{ASCII}               All ASCII:[\\x00-\\x7F]\n\\p{Alpha}               An alphabetic character:[\\p{Lower}\\p{Upper}]\n\\p{Digit}               A decimal digit: [0-9]\n\\p{Alnum}               An alphanumeric character:[\\p{Alpha}\\p{Digit}]\n\\p{Punct}               Punctuation: One of !\"#$%&'()*+,-./:;?@[\\]^_`{|}~\n\\p{Graph}               A visible character: [\\p{Alnum}\\p{Punct}]\n\\p{Print}               A printable character: [\\p{Graph}\\x20]\n\\p{Blank}               A space or a tab: [ \\t]\n\\p{Cntrl}               A control character: [\\x00-\\x1F\\x7F]\n<b>\\p{XDigit}              A hexadecimal digit: [0-9a-fA-F]</b>\n\\p{Space}               A whitespace character: [ \\t\\n\\x0B\\f\\r]\n</pre>\n\n<p>The same <code>[0-9a-fA-F]</code> character class can be expressed with a <a href=\"https://github.com/google/re2/wiki/Syntax#user-content-ascii\" rel=\"nofollow noreferrer\"><code>[[:xdigit:]]</code> in Go regex</a>.</p>\n\n<p>You may write the Go pattern like</p>\n\n<pre><code>re:=regexp.MustCompile(\"([[:xdigit:]]{8})([[:xdigit:]]{4})([[:xdigit:]]{4})([[:xdigit:]]{4})([[:xdigit:]]+)\")\n</code></pre>\n\n<p>Or,</p>\n\n<pre><code>re:=regexp.MustCompile(\"([0-9a-fA-F]{8})([0-9a-fA-F]{4})([0-9a-fA-F]{4})([0-9a-fA-F]{4})([0-9a-fA-F]+)\")\n</code></pre>\n\n<p>You may see the <a href=\"https://regex101.com/r/hQ9K74/1\" rel=\"nofollow noreferrer\">online Go regex demo here</a> and here is <a href=\"https://play.golang.org/p/j_9QdLesSxK\" rel=\"nofollow noreferrer\">a Go demo</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nconst sample = `0a1f0a1f0a1f0a1f0a1f0a1f0a1f 0a1f0a1f0a1f0a1f0a1f0a1f0a1f`\n\nfunc main() {\n    re := regexp.MustCompile(`([[:xdigit:]]{8})([[:xdigit:]]{4})([[:xdigit:]]{4})([[:xdigit:]]{4})([[:xdigit:]]+)`)\n    repl := `$1-$2-$3-$4-$5`\n    fmt.Println(re.ReplaceAllString(sample, repl))\n}\n</code></pre>\n\n<p>Result: <code>0a1f0a1f-0a1f-0a1f-0a1f-0a1f0a1f 0a1f0a1f-0a1f-0a1f-0a1f-0a1f0a1f</code>.</p>\n\n<p>Note that if you need to replace <em>only the first occurrence</em> (as in Java, you are using <code>String#replaceFirst</code>), you will probably want to match the whole string with <code>.*?</code> before the pattern you need to replace, and then <code>.*</code> after it to match the rest of the string, capture them and adjust the replacement string to contain the placeholders for these two additional parts of the string:</p>\n\n<pre><code>re:=regexp.MustCompile(\"^(.*?)([[:xdigit:]]{8})([[:xdigit:]]{4})([[:xdigit:]]{4})([[:xdigit:]]{4})([[:xdigit:]]+)(.*)$\")\nrepStr := \"$1$2-$3-$4-$5-$6$7\"\n</code></pre>\n\n<p>See <a href=\"https://regex101.com/r/hQ9K74/2\" rel=\"nofollow noreferrer\">another regex demo</a>.</p>\n"}], "owner": {"reputation": 89, "user_id": 4299004, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DMd4nI7daVk/AAAAAAAAAAI/AAAAAAAAAKw/cXtZ_aHPqZk/photo.jpg?sz=128", "display_name": "Junaid s", "link": "https://stackoverflow.com/users/4299004/junaid-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 502, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1537972034, "creation_date": 1537960578, "last_edit_date": 1537961543, "question_id": 52516475, "link": "https://stackoverflow.com/questions/52516475/converting-the-regular-expression-in-java-to-golang-correct-me", "title": "Converting the regular expression in java to golang. Correct me", "body": "<p>Java Regular expression:</p>\n\n<pre><code>str.replaceFirst(\"(\\\\p{XDigit}{8})(\\\\p{XDigit}{4})(\\\\p{XDigit}{4})(\\\\p{XDigit}{4})(\\\\p{XDigit}+)\", \"$1-$2-$3-$4-$5\")\n</code></pre>\n\n<p>What I have tried in Go:</p>\n\n<pre><code>re:=regexp.MustCompile(\"(\\\\p{XDigit}{8})(\\\\p{XDigit}{4})(\\\\p{XDigit}{4})(\\\\p{XDigit}{4})(\\\\p{XDigit}+)\")\n\nrepStr := \"$1-$2-$3-$4-$5\"\n\nstr1:=re.ReplaceAllString(someString,repStr)\n</code></pre>\n\n<p>It says that the XDigit is an unknown character category </p>\n"}, {"tags": ["mysql", "json", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1537960196, "post_id": 52516333, "comment_id": 91972169, "body": "What is your question ?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1537960381, "post_id": 52516333, "comment_id": 91972269, "body": "the question is lacking the solution you have attempted and failed to produce."}, {"owner": {"reputation": 21, "user_id": 10418219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0815f234adbe10a924c2006953a740e?s=128&d=identicon&r=PG&f=1", "display_name": "sangamesh", "link": "https://stackoverflow.com/users/10418219/sangamesh"}, "edited": false, "score": 0, "creation_date": 1537960571, "post_id": 52516333, "comment_id": 91972374, "body": "My question is how can I get the required json ?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1537960931, "post_id": 52516333, "comment_id": 91972576, "body": "@sangamesh first print the data in each row for  rows.next along with that provide the struct that you are using."}, {"owner": {"reputation": 21, "user_id": 10418219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0815f234adbe10a924c2006953a740e?s=128&d=identicon&r=PG&f=1", "display_name": "sangamesh", "link": "https://stackoverflow.com/users/10418219/sangamesh"}, "edited": false, "score": 0, "creation_date": 1537962140, "post_id": 52516333, "comment_id": 91973280, "body": "My struct is type Screens struct { \tParentID   int \tScreenName string \tChildren []Screens }"}], "answers": [{"tags": [], "owner": {"reputation": 1011, "user_id": 722955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/20f47acfd4f247064e5ec44fc15dd9dc?s=128&d=identicon&r=PG", "display_name": "Devin", "link": "https://stackoverflow.com/users/722955/devin"}, "is_accepted": false, "score": -1, "last_activity_date": 1537984198, "last_edit_date": 1537984198, "creation_date": 1537983805, "answer_id": 52523417, "question_id": 52516333, "link": "https://stackoverflow.com/questions/52516333/create-parent-child-nested-json-in-go-with-mysql/52523417#52523417", "title": "Create parent child nested json in Go with Mysql", "body": "<p>Typically I assign flags to the struct and then you can easily use <code>json.Marshal</code> to convert the struct into json format.</p>\n\n<p>Update your struct to something like:</p>\n\n<pre><code>type Screens struct {\n    ParentID int      `json:\"ParentId\" db:\"ParentID\"`\n    ScreenID int      `json:\"ScreenId\" db:\"ScreenID\"`\n    Name     string   `json:\"Name\" db:\"ScreenName\"`\n    Children []Screens `json:\"Children,omitempty\"`\n}\n</code></pre>\n\n<p>Then scan data into struct: (not tested)</p>\n\n<pre><code>for rows.Next() {\n    if err := rows.Scan(&amp;screens); err != nil {\n        // break and handle err\n    }\n} \n</code></pre>\n\n<p>Then convert to JSON:</p>\n\n<pre><code>s, err := json.Marshal(screens)\nif err != nil {\n    // handle error\n}\nfmt.Println(string(s))\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>{\"ParentId\":0,\"ScreenId\":2,\"Name\":\"Home\",\"Children\":[{\"ParentId\":3,\"ScreenId\":4,\"Name\":\"NDR\"}]}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/KgpC7tFJ_hR\" rel=\"nofollow noreferrer\">Go Playground - https://play.golang.org/p/KgpC7tFJ_hR</a></p>\n"}], "owner": {"reputation": 21, "user_id": 10418219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0815f234adbe10a924c2006953a740e?s=128&d=identicon&r=PG&f=1", "display_name": "sangamesh", "link": "https://stackoverflow.com/users/10418219/sangamesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 548, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1537984198, "creation_date": 1537960110, "last_edit_date": 1537973642, "question_id": 52516333, "link": "https://stackoverflow.com/questions/52516333/create-parent-child-nested-json-in-go-with-mysql", "title": "Create parent child nested json in Go with Mysql", "body": "<p>I am using mysql database with golang (go). Below is my db structure for treeview</p>\n\n<pre><code>ScreenID        ParentID        ScreenName\n\n1                0               Home\n\n2                0               Run Records\n\n3                0               Requests\n\n4                3               NDR\n\n5                4               Add NDR Request\n</code></pre>\n\n<p>Struct I am using is:</p>\n\n<pre><code>type Screens struct {\n    ProductID int\n    ParentID   int\n    ScreenName string\n    Children []Screens\n}\n</code></pre>\n\n<p>Below is my golang code</p>\n\n<pre><code>db, err := sql.Open(\"mysql\", username + \":\" + password + \"@tcp(127.0.0.1:3306)/\" + dbName)\n\nrows, err := db.Query(\"call usp_select_screens(1)\")\n\nfor rows.Next() {\nerr := rows.Scan(&amp;screens.ProductID, &amp;screens.ParentID, &amp;screens.ScreenName)\n</code></pre>\n\n<p>I'm trying to store the query result as a json. I need guidance in taking the output and marshaling it into a json in the form of: </p>\n\n<pre><code>[  \n     {  \n        \"ParentId\":\"0\",\n        \"ScreenId\":\"1\",\n        \"Name\":\"Home\"\n    },\n    {  \n        \"ParentId\":\"0\",\n        \"ScreenId\":\"2\",\n        \"Name\":\"Run Records\"\n    },\n    {  \n        \"ParentId\":\"0\",\n        \"ScreenId\":\"3\",\n        \"Name\":\"Requests\",\n        \"Children\":[  \n            {  \n                \"Name\":\"NDR\",\n                \"ScreenId\":\"4\",\n                \"ParentId\":\"3\",\n                \"Children\":[  \n                    {  \n                        \"Name\":\"Add NDR Request\",\n                        \"ScreenId\":\"5\",\n                        \"ParentId\":\"4\"\n                    }\n                ]\n            }\n        ]\n    }\n]\n</code></pre>\n"}, {"tags": ["sorting", "dictionary", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 2, "creation_date": 1537955473, "post_id": 52514821, "comment_id": 91969348, "body": "Please post the golang code you have tried along with the dummy data you want to sort."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1537956973, "post_id": 52514821, "comment_id": 91970281, "body": "The actual problem is totally unrelated to a map. You have a stream of values (by iterating the map or whatever) and you have to find the largest n values. You should be able to come up with at least one solution. Remember: Nothing of map helps here."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1537958182, "post_id": 52514821, "comment_id": 91970988, "body": "You can test each methods you have found using the standard library <a href=\"https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go\" rel=\"nofollow noreferrer\">see this</a>. Post it here so we can validate, if you like. Under more general terms, if efficiency is a matter, you might want to search for alternative data structure other than maps."}, {"owner": {"reputation": 73, "user_id": 2501025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/595b96ef32a5cc40f11167b045aafd3c?s=128&d=identicon&r=PG", "display_name": "user2501025", "link": "https://stackoverflow.com/users/2501025/user2501025"}, "edited": false, "score": 0, "creation_date": 1537967367, "post_id": 52514821, "comment_id": 91976598, "body": "I updated my post to fit your comments."}, {"owner": {"reputation": 73, "user_id": 2501025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/595b96ef32a5cc40f11167b045aafd3c?s=128&d=identicon&r=PG", "display_name": "user2501025", "link": "https://stackoverflow.com/users/2501025/user2501025"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1538035995, "post_id": 52514821, "comment_id": 92004009, "body": "@Volker I updated my post, would you consider deleting the OnHold tag please?"}, {"owner": {"reputation": 73, "user_id": 2501025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/595b96ef32a5cc40f11167b045aafd3c?s=128&d=identicon&r=PG", "display_name": "user2501025", "link": "https://stackoverflow.com/users/2501025/user2501025"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1538036003, "post_id": 52514821, "comment_id": 92004013, "body": "@Himanshu I updated my post, would you consider deleting the OnHold tag please?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1538037158, "post_id": 52514821, "comment_id": 92004669, "body": "Okay. For x=3 and len(m)=11 there is no better solution. For larger values you should look for a data structure which a) keeps only the larges x values at all (your slice keeps all data) and b) can decide fast (O(1)) if a new element should be included and if so c) can include this element fast. Try a min-heap. Note that this is not a Go question but a general algorithm question."}, {"owner": {"reputation": 73, "user_id": 2501025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/595b96ef32a5cc40f11167b045aafd3c?s=128&d=identicon&r=PG", "display_name": "user2501025", "link": "https://stackoverflow.com/users/2501025/user2501025"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1538138706, "post_id": 52514821, "comment_id": 92049850, "body": "@Volker Very useful comment. Thank you. i am reconsidering my view on how I should do this."}], "answers": [{"comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1538158330, "post_id": 52558340, "comment_id": 92059926, "body": "For the avoidance of doubt, using a <i>greater than</i> comparison in <code>Less</code> causes the sort order to be reversed. This is generally what you want if you want the &quot;top x items&quot; in the set."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 8, "last_activity_date": 1538158737, "last_edit_date": 1538158737, "creation_date": 1538147920, "answer_id": 52558340, "question_id": 52514821, "link": "https://stackoverflow.com/questions/52514821/how-to-extract-x-top-int-values-from-a-map-in-golang/52558340#52558340", "title": "How to extract x top int values from a map in Golang?", "body": "<p>Creating a slice and sorting is a fine solution; however, you could also use a <a href=\"https://golang.org/pkg/container/heap/\" rel=\"noreferrer\">heap</a>. The Big O performance should be equal for both implementations (n log n) so this is a viable alternative with the advantage that if you want to add new entries you can still efficiently access the top N items without repeatedly sorting the entire set.</p>\n\n<p>To use a heap, you would implement the <a href=\"https://golang.org/pkg/container/heap/#Interface\" rel=\"noreferrer\"><code>heap.Interface</code></a> for the <code>kv</code> type with a <code>Less</code> function that compares Values as <em>greater than</em> (<code>h[i].Value &gt; h[j].Value</code>), add all of the entries from the map, and then pop the number of items you want to use.</p>\n\n<p>For example (<a href=\"https://play.golang.com/p/k0bJf40naie\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>func main() {\n  m := getMap()\n\n  // Create a heap from the map and print the top N values.\n  h := getHeap(m)\n  for i := 1; i &lt;= 3; i++ {\n    fmt.Printf(\"%d) %#v\\n\", i, heap.Pop(h))\n  }\n  // 1) main.kv{Key:\"k11\", Value:76}\n  // 2) main.kv{Key:\"k2\", Value:31}\n  // 3) main.kv{Key:\"k5\", Value:31}\n}\n\nfunc getHeap(m map[string]int) *KVHeap {\n  h := &amp;KVHeap{}\n  heap.Init(h)\n  for k, v := range m {\n    heap.Push(h, kv{k, v})\n  }\n  return h\n}\n\n// See https://golang.org/pkg/container/heap/\ntype KVHeap []kv\n\n// Note that \"Less\" is greater-than here so we can pop *larger* items.\nfunc (h KVHeap) Less(i, j int) bool { return h[i].Value &gt; h[j].Value }\nfunc (h KVHeap) Swap(i, j int)      { h[i], h[j] = h[j], h[i] }\nfunc (h KVHeap) Len() int           { return len(h) }\n\nfunc (h *KVHeap) Push(x interface{}) {\n  *h = append(*h, x.(kv))\n}\n\nfunc (h *KVHeap) Pop() interface{} {\n  old := *h\n  n := len(old)\n  x := old[n-1]\n  *h = old[0 : n-1]\n  return x\n}\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 2501025, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/595b96ef32a5cc40f11167b045aafd3c?s=128&d=identicon&r=PG", "display_name": "user2501025", "link": "https://stackoverflow.com/users/2501025/user2501025"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2647, "favorite_count": 1, "accepted_answer_id": 52558340, "answer_count": 1, "score": 6, "last_activity_date": 1538160883, "creation_date": 1537955405, "last_edit_date": 1538160883, "question_id": 52514821, "link": "https://stackoverflow.com/questions/52514821/how-to-extract-x-top-int-values-from-a-map-in-golang", "title": "How to extract x top int values from a map in Golang?", "body": "<p>I have a <code>map[string]int</code></p>\n\n<p>I want to get the x top values from it and store them in another data structure, another map or a slice. \nFrom <a href=\"https://blog.golang.org/go-maps-in-action#TOC_7.\" rel=\"noreferrer\">https://blog.golang.org/go-maps-in-action#TOC_7.</a> I understood that:</p>\n\n<blockquote>\n  <p>When iterating over a map with a range loop, the iteration order is\n  not specified and is not guaranteed to be the same from one iteration\n  to the next.</p>\n</blockquote>\n\n<p>so the result structure will be a slice then.</p>\n\n<p>I had a look at several related topics but none fits my problem:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/23330781/sort-go-map-values-by-keys\">related topic 1</a></p>\n\n<p><a href=\"https://codereview.stackexchange.com/questions/178424/get-maximum-int-key-from-a-map-of-ints\">related topic 2</a></p>\n\n<p><a href=\"https://stackoverflow.com/a/44380276/2501025\">related topic 3</a></p>\n\n<p>What would be the most efficient way to do this please?</p>\n\n<p>Thanks,</p>\n\n<p>Edit:\nMy solution would be to turn my map into a slice and sort it, then extract the first x values.<br>\nBut is there a better way ? </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\nfunc main() {\n\n    // I want the x top values\n    x := 3\n\n    // Here is the map\n    m := make(map[string]int)\n    m[\"k1\"] = 7\n    m[\"k2\"] = 31\n    m[\"k3\"] = 24\n    m[\"k4\"] = 13\n    m[\"k5\"] = 31\n    m[\"k6\"] = 12\n    m[\"k7\"] = 25\n    m[\"k8\"] = -8\n    m[\"k9\"] = -76\n    m[\"k10\"] = 22\n    m[\"k11\"] = 76\n\n    // Turning the map into this structure\n    type kv struct {\n        Key   string\n        Value int\n    }\n\n    var ss []kv\n    for k, v := range m {\n        ss = append(ss, kv{k, v})\n    }\n\n    // Then sorting the slice by value, higher first.\n    sort.Slice(ss, func(i, j int) bool {\n        return ss[i].Value &gt; ss[j].Value\n    })\n\n    // Print the x top values\n    for _, kv := range ss[:x] {\n        fmt.Printf(\"%s, %d\\n\", kv.Key, kv.Value)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/jmwbDC6mkWn\" rel=\"noreferrer\">Link to golang playground example</a></p>\n\n<p>If I want to have a map at the end with the x top values, then with my solution I would have to turn the slice into a map again. Would this still be the most efficient way to do it?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1537955578, "post_id": 52514636, "comment_id": 91969414, "body": "The code and description provided are too light to give an answer. I suggest you to show us more contextualized code example/description."}, {"owner": {"reputation": 158, "user_id": 3584906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f47b52341fabcfee97c2c3dbca41338?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh S", "link": "https://stackoverflow.com/users/3584906/mahesh-s"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1537956933, "post_id": 52514636, "comment_id": 91970269, "body": "Sorry for that. Updated the post to improve clarity."}, {"owner": {"reputation": 122, "user_id": 8184302, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fS0fA.png?s=128&g=1", "display_name": "Harshit Vadhera", "link": "https://stackoverflow.com/users/8184302/harshit-vadhera"}, "edited": false, "score": 0, "creation_date": 1538038865, "post_id": 52514636, "comment_id": 92005585, "body": "you can use session.copy with a defered close as it only builds a connection when neccessary and doesnt hold back for too long as in session.refresh"}, {"owner": {"reputation": 158, "user_id": 3584906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f47b52341fabcfee97c2c3dbca41338?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh S", "link": "https://stackoverflow.com/users/3584906/mahesh-s"}, "edited": false, "score": 0, "creation_date": 1538043249, "post_id": 52514636, "comment_id": 92008356, "body": "The query is about whether the collection (*mgo.Collection) has to be re-assigned after every session.Refresh() or it can be assigned only once outside the loop."}], "owner": {"reputation": 158, "user_id": 3584906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f47b52341fabcfee97c2c3dbca41338?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh S", "link": "https://stackoverflow.com/users/3584906/mahesh-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 567, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1538051465, "creation_date": 1537954832, "last_edit_date": 1538051465, "question_id": 52514636, "link": "https://stackoverflow.com/questions/52514636/how-to-handle-eof-error-from-mgo-in-golang", "title": "How to handle EOF error from mgo in Golang", "body": "<p>Rarely I see a EOF error from mgo in my logs. Searching about this issue I came across this <a href=\"https://groups.google.com/forum/#!topic/mgo-users/XM0rc6p-V-8\" rel=\"nofollow noreferrer\">discussion</a> where it is suggested that it would be safe to put a <code>session.Refresh()</code> at the start of the loop to handle this issue other issues like socket error, timeout etc.</p>\n\n<p>However I couldn't find if my loop should be like this where the collection (*mgo.Collection) is re-assigned after each Refresh():</p>\n\n<pre><code>session := // create mgo session\nvar collection *mgo.Collection\n\nfor{\n    session.Refresh()\n\n    collection := session.DB(\"dbname\").C(\"collectionName\")\n    ....\n}\n</code></pre>\n\n<p>OR like below where collection is assigned once outside the loop:</p>\n\n<pre><code>session := // create mgo session\ncollection := session.DB(\"dbname\").C(\"collectionName\")\nfor{\n    session.Refresh()\n\n    ....\n}\n</code></pre>\n\n<p>Posting this since I am not able to simulate this issue at will </p>\n"}, {"tags": ["go", "struct", "interface", "functional-programming"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1537954665, "post_id": 52514540, "comment_id": 91968735, "body": "There are no generics in Go, so a function may only have a specific return type (or types). If you want to return values of multiple types, you may use interfaces, optionally the empty interface type <code>interface{}</code> that may hold any value. But then callers will need to use type assertion to obtain a concrete type from it."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1537995168, "post_id": 52514540, "comment_id": 91991582, "body": "Pass in a second pointer argument and populate its value via reflection, like <code>json.Unmarshal</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "is_accepted": false, "score": 0, "last_activity_date": 1537956839, "creation_date": 1537956839, "answer_id": 52515313, "question_id": 52514540, "link": "https://stackoverflow.com/questions/52514540/dynamic-function-return-type/52515313#52515313", "title": "Dynamic function return type", "body": "<p>As noted in the comment - Go doesn't allow you to support generic return types. So you'd either want to return an interface type that you know your Entity types conform to or you'd return the empty interface type <code>interface{}</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "is_accepted": true, "score": 2, "last_activity_date": 1537993859, "last_edit_date": 1537993859, "creation_date": 1537980951, "answer_id": 52522726, "question_id": 52514540, "link": "https://stackoverflow.com/questions/52514540/dynamic-function-return-type/52522726#52522726", "title": "Dynamic function return type", "body": "<p><strong>Quick/Dirty solution:</strong> Return interface{}, but then you end up cheating the compiler, and the pain to do type checking is on you.</p>\n\n<p><strong>Better/Safer solution:</strong> Think of the common operations you need to do on the types that you return, define those common methods on each type, and keep those common methods in an interface. If you are trying to return multiple types from a function, most probably there must already be some common relationship among them, or can be found with little restructuring. Return that interface from the function. This way, the compiler will always be able to check that you aren't returning something unexpected(something that doesn't implement those methods).\nYou may want to look up how the <code>factory method</code> pattern is implemented in Golang. (Hint: It returns interfaces, and not a super class the way it's normally done in C++/Java)</p>\n"}], "owner": {"reputation": 113, "user_id": 5706879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5be805c76f9d2694a4314203b981b589?s=128&d=identicon&r=PG", "display_name": "Artem Y", "link": "https://stackoverflow.com/users/5706879/artem-y"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1366, "favorite_count": 0, "accepted_answer_id": 52522726, "answer_count": 2, "score": -1, "last_activity_date": 1570113613, "creation_date": 1537954545, "last_edit_date": 1570113613, "question_id": 52514540, "link": "https://stackoverflow.com/questions/52514540/dynamic-function-return-type", "title": "Dynamic function return type", "body": "<p>I have an app separated on modules. There are several Entities and CSV module. Csv module supports only struct(Entity), but i want to make CSV module works with any type of entity. Now it works like this:\nCsv module receives data from channel and strictly converts it to <code>EverySize</code> struct. How can I achieve dynamical return type, so it will works with any type of Entity, not only with <code>Everysize</code></p>\n\n<pre><code>    func prepareWrapData(data []feed.WrapExporterChannels) []everysize.EverySizeItem {\n        var result []everysize.EverySizeItem\n        for _, value := range data {\n            result = append(result, *value.EverySizeItem)\n        }\n    return result\n}\n</code></pre>\n"}, {"tags": ["c", "docker", "go", "dockerfile", "gmp"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1537958207, "post_id": 52513731, "comment_id": 91971003, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/52508498/add-c-library-to-docker\">Add C library to docker</a>"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1537958273, "post_id": 52513731, "comment_id": 91971040, "body": "This is exactly the same as the question you posted yesterday: the pbc library depends on the gmp library and you need to install that too.  (That&#39;s pretty common and you might be able to use a distribution package manager to add it and its development files.)"}, {"owner": {"reputation": 129, "user_id": 7694216, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XkyCe.jpg?s=128&g=1", "display_name": "inyutin", "link": "https://stackoverflow.com/users/7694216/inyutin"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1537958807, "post_id": 52513731, "comment_id": 91971343, "body": "You can see that I add gmp through apk. Howerver  I still get error while installing pbc"}, {"owner": {"reputation": 129, "user_id": 7694216, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XkyCe.jpg?s=128&g=1", "display_name": "inyutin", "link": "https://stackoverflow.com/users/7694216/inyutin"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1538070095, "post_id": 52513731, "comment_id": 111666047, "body": "Changing to Ubuntu env. solve this problem"}], "owner": {"reputation": 129, "user_id": 7694216, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XkyCe.jpg?s=128&g=1", "display_name": "inyutin", "link": "https://stackoverflow.com/users/7694216/inyutin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 753, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1596004943, "creation_date": 1537952097, "last_edit_date": 1537961797, "question_id": 52513731, "link": "https://stackoverflow.com/questions/52513731/gmp-library-not-found", "title": "gmp library not found", "body": "<p>I try to install pbc library which have gmp as dependence.\nDockerfile:</p>\n\n<pre><code>FROM golang:1.9.6-alpine3.7\n\nRUN mkdir -p /go/src/app\n\nWORKDIR /go/src/app\n\nCOPY . /go/src/app\n\nRUN apk add --update git gcc build-base flex bison gmp\n\nRUN wget https://crypto.stanford.edu/pbc/files/pbc-0.5.14.tar.gz &amp;&amp; \\\n    tar -xvf pbc-0.5.14.tar.gz &amp;&amp; \\\n    cd pbc-0.5.14 &amp;&amp; \\\n    ./configure --prefix=$HOME/.local &amp;&amp; \\\n    make &amp;&amp; make install\n\nRUN rm pbc-0.5.14.tar.gz &amp;&amp; rm -rf pbc-0.5.14 \n\nRUN go-wrapper download\n\nRUN go-wrapper install\n\nCMD [\"go-wrapper\", \"run\", \"-web\"]\n\nEXPOSE 8000\n</code></pre>\n\n<p>However when I run it I get such an error during pbc installation:</p>\n\n<pre><code>gmp library not found\nadd its path to LDFLAGS\nsee ./configure --help\n</code></pre>\n\n<p>Here I found that i should add export:\n<a href=\"https://stackoverflow.com/questions/6254245/how-to-add-a-path-to-ldflags/12718015\">How to add a path to LDFLAGS</a></p>\n\n<p>Note that I add gmp to dependencies, but pbg dont see it</p>\n\n<p>How should I do it throw docker?</p>\n"}, {"tags": ["dictionary", "go", "concurrency", "mutex"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537949865, "post_id": 52512915, "comment_id": 91965821, "body": "The right choice depends on a lot of factors and no choice is optimal in al circumstances. Go with a RWMutex."}, {"owner": {"reputation": 110, "user_id": 7831814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f29ae60e0c167ab64a53de14f67257?s=128&d=identicon&r=PG&f=1", "display_name": "\u767d\u680b\u5929", "link": "https://stackoverflow.com/users/7831814/%e7%99%bd%e6%a0%8b%e5%a4%a9"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537950580, "post_id": 52512915, "comment_id": 91966242, "body": "So in my circumstance (only one write/delete goroutine and thousands of read goroutines), the RWMutex is a good choice?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1537950902, "post_id": 52512915, "comment_id": 91966416, "body": "It does not matter how many read- or write-goroutines you have but how many actual reads/write. Thousands of read-goroutines doing one read per day and one write-goroutine writing once ever 300ns is probably not what you have but it illustrates the problem. You first must get your metrics straight."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1537950966, "post_id": 52512915, "comment_id": 91966447, "body": "A RWMutex is a good solution as it is simple. If you have 1e8 reads/sec and 1e4 writes/s then a simple RWMutex protecting a single map might be still optimal with respect to code simplicity but suboptimal in respect to throughput and lock contention. You first have to know what is important to you."}, {"owner": {"reputation": 110, "user_id": 7831814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f29ae60e0c167ab64a53de14f67257?s=128&d=identicon&r=PG&f=1", "display_name": "\u767d\u680b\u5929", "link": "https://stackoverflow.com/users/7831814/%e7%99%bd%e6%a0%8b%e5%a4%a9"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537951372, "post_id": 52512915, "comment_id": 91966688, "body": "Actually, the amount of read ops  is tens of thousands of times  the number of  write/delete  ops. The second one&#39;s value  per day is proportional to the number of users which may grows from hundreds to millions, and throughput is very improtant"}, {"owner": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "edited": false, "score": 0, "creation_date": 1537952414, "post_id": 52512915, "comment_id": 91967354, "body": "The best solution is probably using a <code>RWMutex</code>. Wrap it around a custom type if you want, so that you can have simple <code>Get(string)</code> and <code>Set(string, string)</code> (for example) methods which take care of the locking, which should make it less redundant. Then try it out on your application and see if the map actually <i>is</i> a bottleneck (pprof may come in handy). If so, try out other solutions (such as <code>sync.Map</code>)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537953009, "post_id": 52512915, "comment_id": 91967707, "body": "Then builtin map is not the right data structure if you need basically unlimited scalability. Such questions are hard (if the requirements are real and not just imagined) and cannot be answered on SO."}, {"owner": {"reputation": 110, "user_id": 7831814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f29ae60e0c167ab64a53de14f67257?s=128&d=identicon&r=PG&f=1", "display_name": "\u767d\u680b\u5929", "link": "https://stackoverflow.com/users/7831814/%e7%99%bd%e6%a0%8b%e5%a4%a9"}, "edited": false, "score": 0, "creation_date": 1537953647, "post_id": 52512915, "comment_id": 91968105, "body": "If the write/delete goroutine only update and do not delete key, is it a best choice that using builtin map with  StorePointer(sync.atomic)  when update is needed"}], "answers": [{"comments": [{"owner": {"reputation": 110, "user_id": 7831814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f29ae60e0c167ab64a53de14f67257?s=128&d=identicon&r=PG&f=1", "display_name": "\u767d\u680b\u5929", "link": "https://stackoverflow.com/users/7831814/%e7%99%bd%e6%a0%8b%e5%a4%a9"}, "edited": false, "score": 0, "creation_date": 1537953268, "post_id": 52513790, "comment_id": 91967868, "body": "As describe in comments above, now i have a write/delete goroutine may have hundreds or millions ops per day, and many read goroutines whose ops amount may be tens of thousands times of the  write/delete ops. Is the RWmutex is better than sync.map on throughput ?"}, {"owner": {"reputation": 117, "user_id": 2403194, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/drfdi.jpg?s=128&g=1", "display_name": "Peter Stirrup", "link": "https://stackoverflow.com/users/2403194/peter-stirrup"}, "reply_to_user": {"reputation": 110, "user_id": 7831814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f29ae60e0c167ab64a53de14f67257?s=128&d=identicon&r=PG&f=1", "display_name": "\u767d\u680b\u5929", "link": "https://stackoverflow.com/users/7831814/%e7%99%bd%e6%a0%8b%e5%a4%a9"}, "edited": false, "score": 0, "creation_date": 1537956062, "post_id": 52513790, "comment_id": 91969748, "body": "@\u767d\u680b\u5929 Try my above solution with a RWMutex and benchmark it for the number of operations you&#39;re expecting. There are mixed views on the performance of sync.Map, so it might be worth doing a bit of research first: <a href=\"https://medium.com/@deckarep/the-new-kid-in-town-gos-sync-map-de24a6bf7c2c\" rel=\"nofollow noreferrer\">medium.com/@deckarep/&hellip;</a>"}], "tags": [], "owner": {"reputation": 117, "user_id": 2403194, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/drfdi.jpg?s=128&g=1", "display_name": "Peter Stirrup", "link": "https://stackoverflow.com/users/2403194/peter-stirrup"}, "is_accepted": false, "score": 1, "last_activity_date": 1537952304, "creation_date": 1537952304, "answer_id": 52513790, "question_id": 52512915, "link": "https://stackoverflow.com/questions/52512915/how-to-solve-concurrency-access-of-golang-map/52513790#52513790", "title": "How to solve concurrency access of Golang map?", "body": "<p>Your question is a little vague - so I'll break it down.</p>\n\n<blockquote>\n  <p>What form of concurrent access should I use for a map?</p>\n</blockquote>\n\n<p>The choice depends on the performance you require from the map. I would opt for a simple mutex (or a RWMutex) based approach.</p>\n\n<p>Granted, you can get better performance from a <a href=\"https://github.com/orcaman/concurrent-map\" rel=\"nofollow noreferrer\">concurrent map</a>. <code>sync.Mutex</code> locks <strong>all</strong> of a maps buckets, whereas in a concurrent map, each bucket has it's own <code>sync.Mutex</code>.</p>\n\n<p>Again - it all depends on the scale of your program and the performance you require.</p>\n\n<blockquote>\n  <p>How would I use a mutex for concurrent access?</p>\n</blockquote>\n\n<p>To ensure the map is being used correctly, you can wrap this in a <code>struct</code>.</p>\n\n<pre><code>type Store struct {\n    Data              map[T]T\n}\n</code></pre>\n\n<p>This a more object-oriented solution, but it allows us to make sure any read/writes are performed concurrently. As well as this, we can easily store other information that may be useful for debugging or security, such as author.</p>\n\n<p>Now, we would implement this with a set of methods like so:</p>\n\n<pre><code>mux sync.Mutex\n\n// New initialises a Store type with an empty map\nfunc New(t, h uint) *Store {\n    return &amp;Store{\n        Data:     map[T]T{},\n    }\n}\n\n// Insert adds a new key i to the store and places the value of x at this location\n// If there is an error, this is returned - if not, this is nil\nfunc (s *Store) Insert(i, x T) error {\n    mux.Lock()\n    defer mux.Unlock()\n    _, ok := s.Data[i]\n    if ok {\n        return fmt.Errorf(\"index %s already exists; use update\", i)\n    }\n    s.Data[i] = x\n    return nil\n}\n\n// Update changes the value found at key i to x\n// If there is an error, this is returned - if not, this is nil\nfunc (s *Store) Update(i, x T) error {\n    mux.Lock()\n    defer mux.Unlock()\n    _, ok := s.Data[i]\n    if !ok {\n        return fmt.Errorf(\"value at index %s does not exist; use insert\", i)\n    }\n    s.Data[i] = x\n    return nil\n}\n\n// Fetch returns the value found at index i in the store\n// If there is an error, this is returned - if not, this is nil\nfunc (s *Store) Fetch(i T) (T, error) {\n    mux.Lock()\n    defer mux.Unlock()\n    v, ok := s.Data[i]\n    if !ok {\n        return \"\", fmt.Errorf(\"no value for key %s exists\", i)\n    }\n    return v, nil\n}\n\n// Delete removes the index i from store\n// If there is an error, this is returned - if not, this is nil\nfunc (s *Store) Delete(i T) (T, error) {\n    mux.Lock()\n    defer mux.Unlock()\n    v, ok := s.Data[i]\n    if !ok {\n        return \"\", fmt.Errorf(\"index %s already empty\", i)\n    }\n    delete(s.Data, i)\n    return v, nil\n}\n</code></pre>\n\n<p>In my solution, I've used a simple <code>sync.Mutex</code> - but you can simply change this code to accommodate RWMutex.</p>\n\n<p>I recommend you take a look at <a href=\"https://stackoverflow.com/questions/19148809/how-to-use-rwmutex-in-golang\">How to use RWMutex in Golang?</a>.</p>\n"}], "owner": {"reputation": 110, "user_id": 7831814, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f29ae60e0c167ab64a53de14f67257?s=128&d=identicon&r=PG&f=1", "display_name": "\u767d\u680b\u5929", "link": "https://stackoverflow.com/users/7831814/%e7%99%bd%e6%a0%8b%e5%a4%a9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3412, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1537952304, "creation_date": 1537949261, "last_edit_date": 1537949810, "question_id": 52512915, "link": "https://stackoverflow.com/questions/52512915/how-to-solve-concurrency-access-of-golang-map", "title": "How to solve concurrency access of Golang map?", "body": "<p>Now i have a map with only one write/delete goroutine and many read goroutines, there are some solutions upon <a href=\"https://stackoverflow.com/questions/11063473/map-with-concurrent-access\">Map with concurrent access</a>, such as RWMutex, sync.map, <a href=\"https://github.com/orcaman/concurrent-map\" rel=\"nofollow noreferrer\" title=\"concurrent-map\">concurrent-map</a>, sync.atomic, sync.Value, what's the best choice for me? </p>\n\n<p>RWMutex's read lock is a little redundant</p>\n\n<p>sync.map and concurrent-map focus on many write goroutines</p>\n"}, {"tags": ["go", "workspace", "geth"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537949135, "post_id": 52512735, "comment_id": 91965387, "body": "&quot;should not metter, right?&quot; Wrong."}, {"owner": {"reputation": 31053, "user_id": 566608, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/bf8ff77ca000b80a2b19d07dbb257645?s=128&d=identicon&r=PG", "display_name": "Felice Pollano", "link": "https://stackoverflow.com/users/566608/felice-pollano"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537949619, "post_id": 52512735, "comment_id": 91965690, "body": "funny -2 votes for a legitimate question"}], "answers": [{"comments": [{"owner": {"reputation": 31053, "user_id": 566608, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/bf8ff77ca000b80a2b19d07dbb257645?s=128&d=identicon&r=PG", "display_name": "Felice Pollano", "link": "https://stackoverflow.com/users/566608/felice-pollano"}, "edited": false, "score": 0, "creation_date": 1537949725, "post_id": 52512882, "comment_id": 91965738, "body": "thank you, suspected but did not find where the doc talk about it."}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 2, "last_activity_date": 1537949159, "creation_date": 1537949159, "answer_id": 52512882, "question_id": 52512735, "link": "https://stackoverflow.com/questions/52512735/confused-on-how-to-build-a-go-project-from-source/52512882#52512882", "title": "Confused on how to build a go project from source", "body": "<p>You must clone the <code>geth</code> source in the exact folder in your <code>GOPATH</code>, actual path should be <code>GOPATH/src/github.com/ethereum/go-ethereum</code>.</p>\n"}], "owner": {"reputation": 31053, "user_id": 566608, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/bf8ff77ca000b80a2b19d07dbb257645?s=128&d=identicon&r=PG", "display_name": "Felice Pollano", "link": "https://stackoverflow.com/users/566608/felice-pollano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 52512882, "answer_count": 1, "score": -2, "last_activity_date": 1537949159, "creation_date": 1537948617, "question_id": 52512735, "link": "https://stackoverflow.com/questions/52512735/confused-on-how-to-build-a-go-project-from-source", "title": "Confused on how to build a go project from source", "body": "<p>I'm trying to build the Ethereum node Geth: <a href=\"https://github.com/ethereum/go-ethereum\" rel=\"nofollow noreferrer\">https://github.com/ethereum/go-ethereum</a>\nI cloned the project in my src folder ( in a folder called geth, should not metter, right? ) and when I try to run/compile does not find:</p>\n\n<pre><code>\"github.com/ethereum/go-ethereum/accounts\"\n\"github.com/ethereum/go-ethereum/accounts/keystore\"\n\"github.com/ethereum/go-ethereum/cmd/utils\"\n</code></pre>\n\n<p>and currently these file exists, as part of the project I'm trying to compile, so I don't actually understand why is referring the repository on line, and, in any case, why it does not work</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1537946090, "post_id": 52511877, "comment_id": 91963698, "body": "What have you tried? What problems did you encounter?"}], "answers": [{"comments": [{"owner": {"reputation": 4103, "user_id": 162358, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/I2kN6.jpg?s=128&g=1", "display_name": "Keith John Hutchison", "link": "https://stackoverflow.com/users/162358/keith-john-hutchison"}, "edited": false, "score": 0, "creation_date": 1537949168, "post_id": 52512531, "comment_id": 91965403, "body": "I prefer null as well. We&#39;re making a cache for a FileMaker database.  The FileMaker Data API uses &quot;&quot; for null."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1537954111, "last_edit_date": 1537954111, "creation_date": 1537947930, "answer_id": 52512531, "question_id": 52511877, "link": "https://stackoverflow.com/questions/52511877/how-do-you-json-marshall-a-pq-nulltime-in-utc-rather-than-the-local-timezone/52512531#52512531", "title": "How do you JSON Marshall a pq.NullTime in UTC rather than the local timezone?", "body": "<p>Libraries usually construct <code>time.Time</code> values using the local timezone, but the time instant is still the same, so you shouldn't worry about that.</p>\n\n<p>If you want to display / output the time in UTC zone specifically, then \"switch\" your time to UTC timezone. For this, you may use the <a href=\"https://golang.org/pkg/time/#Time.UTC\" rel=\"nofollow noreferrer\"><code>Time.UTC()</code></a> method:</p>\n\n<pre><code>val := fmt.Sprintf(\"\\\"%s\\\"\", nt.Time.UTC().Format(\"01/02/2006 15:04:05\"))\n</code></pre>\n\n<p>That's all.</p>\n\n<p>Also note that if your <code>NullTime</code> is not valid, I would rather output JSON <code>null</code> instead of an empty string.</p>\n"}], "owner": {"reputation": 4103, "user_id": 162358, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/I2kN6.jpg?s=128&g=1", "display_name": "Keith John Hutchison", "link": "https://stackoverflow.com/users/162358/keith-john-hutchison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 52512531, "answer_count": 1, "score": 1, "last_activity_date": 1537954111, "creation_date": 1537945620, "question_id": 52511877, "link": "https://stackoverflow.com/questions/52511877/how-do-you-json-marshall-a-pq-nulltime-in-utc-rather-than-the-local-timezone", "title": "How do you JSON Marshall a pq.NullTime in UTC rather than the local timezone?", "body": "<p>I have dates in postgres table. The dates are stored with a UTC timezone.</p>\n\n<p>Example from python.</p>\n\n<pre><code>roster = Roster.objects.get(id=266438)\nroster.start_timestamp\nOut[11]: datetime.datetime(2018, 9, 7, 15, 0, tzinfo=&lt;UTC&gt;)\n</code></pre>\n\n<p>When I marshall these dates from within go lib/pq my local time zone is somehow being applied. </p>\n\n<pre><code>func (nt *pq.NullTime) MarshalJSON() ([]byte, error) {\n    if !nt.Valid {\n        return []byte(\"\\\"\\\"\"), nil\n    }\n    val := fmt.Sprintf(\"\\\"%s\\\"\", nt.Time.Format(\"01/02/2006 15:04:05\"))\n    fmt.Println(\"Marshalling FMPDateTime\", nt, val)\n    return []byte(val), nil\n}\n</code></pre>\n\n<p>Example log:</p>\n\n<pre><code>Marshalling DateTime &amp;{2018-09-08 00:30:00 +0930 ACST true} \"09/08/2018 00:30:00\"\n</code></pre>\n\n<p>2018-09-08 00:30:00 +0930 ACST <em>is</em> 2018-09-07 15:00:00 UTC.</p>\n\n<p>How do you JSON Marshall a pq.NullTime in UTC rather than the local timezone?  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 1, "creation_date": 1537916605, "post_id": 52507676, "comment_id": 91955851, "body": "key skill of any good productive software developer is to master the art of google fu ... do a search on :   golang current function name"}], "answers": [{"comments": [{"owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "edited": false, "score": 0, "creation_date": 1537916922, "post_id": 52507718, "comment_id": 91955918, "body": "This is perfect. Thank you!"}, {"owner": {"reputation": 711, "user_id": 5250939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gy7YP.png?s=128&g=1", "display_name": "Bo Sunesen", "link": "https://stackoverflow.com/users/5250939/bo-sunesen"}, "edited": false, "score": 0, "creation_date": 1546856198, "post_id": 52507718, "comment_id": 94977524, "body": "Rather than use the result of runtime.Callers, runtime.CallersFrames should be used as shown here: <a href=\"https://stackoverflow.com/a/46289376/5250939\">stackoverflow.com/a/46289376/5250939</a> and described in the doc: <a href=\"https://godoc.org/runtime#Callers\" rel=\"nofollow noreferrer\">godoc.org/runtime#Callers</a>"}, {"owner": {"reputation": 187, "user_id": 8913779, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6wMKr.png?s=128&g=1", "display_name": "systrigger", "link": "https://stackoverflow.com/users/8913779/systrigger"}, "edited": false, "score": 0, "creation_date": 1572222184, "post_id": 52507718, "comment_id": 103483153, "body": "Why are we subtracting 1 from the PC here? I tested with(/out) the -1 but the result is weirdly the same: <code>caller := runtime.FuncForPC(fpcs[0] - 1) </code>"}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 5, "last_activity_date": 1537916583, "creation_date": 1537916583, "answer_id": 52507718, "question_id": 52507676, "link": "https://stackoverflow.com/questions/52507676/name-of-current-function/52507718#52507718", "title": "Name of current function", "body": "<p>You can do this using <code>runtime.Callers</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n)\n\nfunc printFuncName() {\n    fpcs := make([]uintptr, 1)\n\n    // Skip 2 levels to get the caller\n    n := runtime.Callers(2, fpcs)\n    if n == 0 {\n        fmt.Println(\"MSG: NO CALLER\")\n    }\n\n    caller := runtime.FuncForPC(fpcs[0] - 1)\n    if caller == nil {\n        fmt.Println(\"MSG CALLER WAS NIL\")\n    }\n\n    // Print the name of the function\n    fmt.Println(caller.Name())\n}\n\nfunc foo() {\n    printFuncName()\n}\n\nfunc main() {\n    foo()\n}\n</code></pre>\n\n<p>Outputs (package.function)</p>\n\n<p><code>main.foo</code></p>\n"}], "owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2501, "favorite_count": 0, "closed_date": 1537935661, "accepted_answer_id": 52507718, "answer_count": 1, "score": 1, "last_activity_date": 1537916583, "creation_date": 1537916263, "question_id": 52507676, "link": "https://stackoverflow.com/questions/52507676/name-of-current-function", "closed_reason": "Duplicate", "title": "Name of current function", "body": "<p>Is there a way to include the name of the current function I am in? I'd like to include it in my debug logs rather than hard coding the func name which is a pain after a while.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["unix", "go", "logging", "time", "epoch"], "answers": [{"comments": [{"owner": {"reputation": 1383, "user_id": 3226932, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e05eac9c05a7aefcaa1ca3a27191fbb6?s=128&d=identicon&r=PG&f=1", "display_name": "user3226932", "link": "https://stackoverflow.com/users/3226932/user3226932"}, "edited": false, "score": 0, "creation_date": 1537914812, "post_id": 52507461, "comment_id": 91955417, "body": "time.Format returns a string, I want to use the actual Time type, not a string"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1383, "user_id": 3226932, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e05eac9c05a7aefcaa1ca3a27191fbb6?s=128&d=identicon&r=PG&f=1", "display_name": "user3226932", "link": "https://stackoverflow.com/users/3226932/user3226932"}, "edited": false, "score": 2, "creation_date": 1537915168, "post_id": 52507461, "comment_id": 91955514, "body": "If you use it as a <code>time.Time</code>, unless you modified it, it should still have the same precision. I guess that the difference you observe is in the way you print it. Calling <code>.String()</code> on your <code>time.Time</code> formats it in a way that displays the ms, while the other method you tried doesn&#39;t, because it uses a different format layout."}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1383, "user_id": 3226932, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e05eac9c05a7aefcaa1ca3a27191fbb6?s=128&d=identicon&r=PG&f=1", "display_name": "user3226932", "link": "https://stackoverflow.com/users/3226932/user3226932"}, "edited": false, "score": 2, "creation_date": 1537915227, "post_id": 52507461, "comment_id": 91955522, "body": "So again, if you wish to display a milisecond precision, you have to either pass a string instead of a time, formatted in the way you want, or to pass a <code>time.Time</code> and control the function that prints it by enforcing a format that is precise enough."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1383, "user_id": 3226932, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e05eac9c05a7aefcaa1ca3a27191fbb6?s=128&d=identicon&r=PG&f=1", "display_name": "user3226932", "link": "https://stackoverflow.com/users/3226932/user3226932"}, "edited": false, "score": 1, "creation_date": 1537939698, "post_id": 52507461, "comment_id": 91960965, "body": "This is the correct answer. @user3226932 You do <i>not</i> want an actual Time type--that&#39;s what you have and you&#39;re complaining about it."}, {"owner": {"reputation": 1383, "user_id": 3226932, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e05eac9c05a7aefcaa1ca3a27191fbb6?s=128&d=identicon&r=PG&f=1", "display_name": "user3226932", "link": "https://stackoverflow.com/users/3226932/user3226932"}, "edited": false, "score": 0, "creation_date": 1538005441, "post_id": 52507461, "comment_id": 91994484, "body": "so to solve this we can only change the time format constant in the logging library, golang context&#39;s Time only accepts a Time type, not a string"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1383, "user_id": 3226932, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e05eac9c05a7aefcaa1ca3a27191fbb6?s=128&d=identicon&r=PG&f=1", "display_name": "user3226932", "link": "https://stackoverflow.com/users/3226932/user3226932"}, "edited": false, "score": 0, "creation_date": 1538026320, "post_id": 52507461, "comment_id": 91999231, "body": "@user3226932 What do you mean &quot;golang context&#39;s Time only accepts a Time type&quot;? Go&#39;s context package, which is usually meant by a phrase like &quot;golang&#39;s context&quot;, has no concept of Time at all."}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 3, "last_activity_date": 1538030420, "last_edit_date": 1538030420, "creation_date": 1537914492, "answer_id": 52507461, "question_id": 52507400, "link": "https://stackoverflow.com/questions/52507400/log15-library-rounds-up-epoch-time-from-nanoseconds-to-seconds-for-logging/52507461#52507461", "title": "log15 library rounds up epoch time from nanoseconds to seconds for logging", "body": "<p>You need to use <a href=\"https://golang.org/pkg/time/#Time.Format\" rel=\"nofollow noreferrer\">time.Format</a> to display your <code>time.Time</code>'s value with the precision you want. It doesn't loose its precision unless you modify its value, the reason why you see a difference is only due to the <code>layout</code> used by the call for <code>time.Format</code> of whatever is printing your time.</p>\n\n<p>When you use <code>mytime.String()</code>, the layout used is different that the one used by whatever prints your time otherwise.</p>\n\n<p>That's why you need to either use the <code>time.Time</code> value but manipulate the way it is printed, or store it as a formatted string instead.</p>\n\n<p>See <a href=\"https://gobyexample.com/time-formatting-parsing\" rel=\"nofollow noreferrer\">Go by example</a></p>\n\n<pre><code>// Go supports time formatting and parsing via\n// pattern-based layouts.\n\npackage main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc main() {\n    p := fmt.Println\n\n    // Here's a basic example of formatting a time\n    // according to RFC3339, using the corresponding layout\n    // constant.\n    t := time.Now()\n    p(t.Format(time.RFC3339))\n\n    // Time parsing uses the same layout values as `Format`.\n    t1, e := time.Parse(\n        time.RFC3339,\n        \"2012-11-01T22:08:41+00:00\")\n    p(t1)\n\n    // `Format` and `Parse` use example-based layouts. Usually\n    // you'll use a constant from `time` for these layouts, but\n    // you can also supply custom layouts. Layouts must use the\n    // reference time `Mon Jan 2 15:04:05 MST 2006` to show the\n    // pattern with which to format/parse a given time/string.\n    // The example time must be exactly as shown: the year 2006,\n    // 15 for the hour, Monday for the day of the week, etc.\n    p(t.Format(\"3:04PM\"))\n    p(t.Format(\"Mon Jan _2 15:04:05 2006\"))\n    p(t.Format(\"2006-01-02T15:04:05.999999-07:00\"))\n    form := \"3 04 PM\"\n    t2, e := time.Parse(form, \"8 41 PM\")\n    p(t2)\n\n    // For purely numeric representations you can also\n    // use standard string formatting with the extracted\n    // components of the time value.\n    fmt.Printf(\"%d-%02d-%02dT%02d:%02d:%02d-00:00\\n\",\n        t.Year(), t.Month(), t.Day(),\n        t.Hour(), t.Minute(), t.Second())\n\n    // `Parse` will return an error on malformed input\n    // explaining the parsing problem.\n    ansic := \"Mon Jan _2 15:04:05 2006\"\n    _, e = time.Parse(ansic, \"8:41PM\")\n    p(e)\n}\n</code></pre>\n\n<p>Outputs</p>\n\n<pre><code>2009-11-10T23:00:00Z\n2012-11-01 22:08:41 +0000 UTC\n11:00PM\nTue Nov 10 23:00:00 2009\n2009-11-10T23:00:00+00:00\n0000-01-01 20:41:00 +0000 UTC\n2009-11-10T23:00:00-00:00\nparsing time \"8:41PM\" as \"Mon Jan _2 15:04:05 2006\": cannot parse \"8:41PM\" as \"Mon\"\n</code></pre>\n\n<p>Try it out yourself <a href=\"https://play.golang.org/p/BFw556nWcM\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 1383, "user_id": 3226932, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e05eac9c05a7aefcaa1ca3a27191fbb6?s=128&d=identicon&r=PG&f=1", "display_name": "user3226932", "link": "https://stackoverflow.com/users/3226932/user3226932"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 52507461, "answer_count": 1, "score": -1, "last_activity_date": 1538030420, "creation_date": 1537914099, "last_edit_date": 1537939629, "question_id": 52507400, "link": "https://stackoverflow.com/questions/52507400/log15-library-rounds-up-epoch-time-from-nanoseconds-to-seconds-for-logging", "title": "log15 library rounds up epoch time from nanoseconds to seconds for logging", "body": "<p>I'd like to have millisecond precision for my logging in my golang project, currently using log15 library</p>\n\n<p>Problem is when I append it to Context, it rounds back up to seconds</p>\n\n<pre><code>newTimeWithMilliseconds := time.Unix(0, time.Now().UnixNano())\n\nreturn log.FuncHandler(func(r *log.Record) {\n     r.Ctx = append(r.Ctx, \"time\", newTimeWithMilliseconds)\n     nextHandler.Log(r)\n})\n</code></pre>\n\n<p>When I convert it to string <code>newTimeWithMilliseconds.String()</code> it works and I get <code>\"2018-09-25 15:07:45.25801232 -0500 PDT\"</code>, but when I don't, the decimals go away and I get <code>2018-09-25 15:07:45 -0700 PDT</code>. </p>\n\n<p>I want to keep in Time format though and not use string, anybody have any ideas on why this is happening and how to solve this?</p>\n"}, {"tags": ["go", "kubernetes", "google-cloud-platform", "containers", "google-kubernetes-engine"], "comments": [{"owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 0, "creation_date": 1537914119, "post_id": 52507126, "comment_id": 91955236, "body": "How do you create your container image? Do you use a Docker image which is empty (e.g. <code>scratch</code> or similar) and so won&#39;t have a root certificates bundle present?"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 0, "creation_date": 1537914936, "post_id": 52507126, "comment_id": 91955458, "body": "FROM alpine COPY backend /backend CMD [&quot;/backend&quot;] RUN chmod 755 /backend"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 0, "creation_date": 1537915003, "post_id": 52507126, "comment_id": 91955479, "body": "command CMD [&quot;/backend&quot;] RUN chmod 755 /backend  is because I had another problem <a href=\"https://stackoverflow.com/questions/52488927/permission-denied-when-deploying-docker-image-to-kubernetes-engine\" title=\"permission denied when deploying docker image to kubernetes engine\">stackoverflow.com/questions/52488927/&hellip;</a>"}, {"owner": {"reputation": 48205, "user_id": 2989261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b03110b84c83464a58832d4d55ff4542?s=128&d=identicon&r=PG", "display_name": "Rico", "link": "https://stackoverflow.com/users/2989261/rico"}, "edited": false, "score": 0, "creation_date": 1537916693, "post_id": 52507126, "comment_id": 91955871, "body": "did you build backend Windows again?  what&#39;s the command you are using to build the binary?"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1537917114, "post_id": 52507126, "comment_id": 91955961, "body": "yes, I would want to avoid do it in linux, now I just have one computer and in order to make the linux binary I&#39;ll need to install in my pc and I&#39;m scared to erase all data in my computer, command to deploy: gcloud builds submit --config cloudbuild.yaml ."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1537917244, "post_id": 52507126, "comment_id": 91955993, "body": "commands to build the binary:  1) set GOSS=linux 2)set GOARCH=amd64 3)go build"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1537917360, "post_id": 52507126, "comment_id": 91956023, "body": "also I tried to build the binary with cloud build but I couldn&#39;t, I tried many combinations and any worked <a href=\"https://stackoverflow.com/questions/52410487/how-to-build-a-docker-image-using-cloud-build-with-sdk-in-local-machine-without\" title=\"how to build a docker image using cloud build with sdk in local machine without\">stackoverflow.com/questions/52410487/&hellip;</a>"}, {"owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 0, "creation_date": 1537918131, "post_id": 52507126, "comment_id": 91956178, "body": "You need <code>set GOOS</code> \u2013 this won&#39;t fix your problem, and I assume it&#39;s a typo in your comment."}, {"owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 0, "creation_date": 1537918357, "post_id": 52507126, "comment_id": 91956226, "body": "Make sure you&#39;re installing the <code>ca-certificates</code> bundle in your alpine-sourced container. Add <code>RUN apk update &amp;&amp; apk add ca-certificates &amp;&amp; rm -rf &#47;var&#47;cache&#47;apk&#47;*</code> to your <code>Dockerfile</code>, after the <code>RUN chmod</code> command (although order is mostly irrelevant)."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 1, "creation_date": 1537918884, "post_id": 52507126, "comment_id": 91956333, "body": "@CosmicOssifrage my bad, actually I indeed did: &quot;set GOOS=linux&quot; I just typed wrong here, I&#39;ll try that solution"}], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1537920187, "post_id": 52507971, "comment_id": 91956601, "body": "thank you that completely solved it, thank you a lot :D"}], "tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": true, "score": 5, "last_activity_date": 1537918751, "creation_date": 1537918751, "answer_id": 52507971, "question_id": 52507126, "link": "https://stackoverflow.com/questions/52507126/certificate-signed-by-unknown-authority-kubernetes-engine/52507971#52507971", "title": "certificate signed by unknown authority Kubernetes Engine", "body": "<p>From the comments in your question, I expect you are running up against the common problem of Alpine base images not being populated with the <code>ca-certificates</code> package, which contains a number of root CA certificates to anchor your root of trust.</p>\n\n<p>Add the following command to your <code>Dockerfile</code> to ensure these are installed in the produced image:</p>\n\n<pre><code>RUN apk update &amp;&amp; apk add ca-certificates &amp;&amp; rm -rf /var/cache/apk/*\n</code></pre>\n\n<p>(we run multiple operations in a single <code>RUN</code> step to <a href=\"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#run\" rel=\"noreferrer\">avoid introducing unnecessary bloat</a> in the layers of your final image).</p>\n\n<p>Base images which include the CA certificates package are also available in the container registry (although with this statement I make no claims as to their suitability or provenance).</p>\n"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1264, "favorite_count": 0, "accepted_answer_id": 52507971, "answer_count": 1, "score": 2, "last_activity_date": 1537918751, "creation_date": 1537912119, "question_id": 52507126, "link": "https://stackoverflow.com/questions/52507126/certificate-signed-by-unknown-authority-kubernetes-engine", "title": "certificate signed by unknown authority Kubernetes Engine", "body": "<p>When I deploy a docker image to <a href=\"https://cloud.google.com/kubernetes-engine/\" rel=\"nofollow noreferrer\">Kubernetes Engine</a>,</p>\n\n<p><a href=\"https://i.stack.imgur.com/LtwaW.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/LtwaW.png\" alt=\"enter image description here\"></a>\n the pods can't be initialize, pods are just making a simple get request to <a href=\"https://jsonplaceholder.typicode.com/\" rel=\"nofollow noreferrer\">https://jsonplaceholder.typicode.com/</a> \n<a href=\"https://i.stack.imgur.com/qtxIt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/qtxIt.png\" alt=\"code\"></a></p>\n\n<p>I get an error message <code>certificate signed by unknown authority</code></p>\n\n<p><a href=\"https://i.stack.imgur.com/jeX7D.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jeX7D.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["mysql", "ubuntu", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1537912199, "post_id": 52506911, "comment_id": 91954737, "body": "A firewall rule (or lack thereof) comes to mind. <code>mysql -h 127.0.0.1</code> on the shell works (not <code>localhost</code>, that&#39;s different because it uses a unix socket)?"}, {"owner": {"reputation": 111, "user_id": 9278374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9a4980b308a75e207765cd6c2b94345?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Anonymous", "link": "https://stackoverflow.com/users/9278374/michael-anonymous"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1537912360, "post_id": 52506911, "comment_id": 91954791, "body": "@Peter. You are on to something I think. mysql -h localhost works, mysql -h 127.0.0.1 does not."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1537915054, "post_id": 52506911, "comment_id": 91955488, "body": "Double check firewall and AppArmor rules. I&#39;m not familiar with Ubuntu, so I can&#39;t offer any concrete trouble shooting steps."}, {"owner": {"reputation": 111, "user_id": 9278374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9a4980b308a75e207765cd6c2b94345?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Anonymous", "link": "https://stackoverflow.com/users/9278374/michael-anonymous"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1537915769, "post_id": 52506911, "comment_id": 91955642, "body": "That was my problem. If you make it an answer I&#39;ll accept."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1537944812, "post_id": 52506911, "comment_id": 91963073, "body": "It could be that now MySQL is bound only to IPv6, which localhost maps to, but 127.0.0.1 does not."}], "answers": [{"tags": [], "owner": {"reputation": 775, "user_id": 1139600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f37b3de5f7859e51b1c2c44ad8423df9?s=128&d=identicon&r=PG", "display_name": "Manuel", "link": "https://stackoverflow.com/users/1139600/manuel"}, "is_accepted": false, "score": 0, "last_activity_date": 1537916460, "creation_date": 1537916460, "answer_id": 52507703, "question_id": 52506911, "link": "https://stackoverflow.com/questions/52506911/golang-mysql-connection-timeout-after-ubuntu-upgrade/52507703#52507703", "title": "Golang MySQL connection timeout after Ubuntu upgrade", "body": "<p>I can think about 2 possibility:</p>\n\n<ul>\n<li>MySQL server lacks user \"Test@127.0.0.1\" but has user \"Test@localhost\"</li>\n<li>server firewall is blocking access to port 3306 on 127.0.0.1</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 111, "user_id": 9278374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9a4980b308a75e207765cd6c2b94345?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Anonymous", "link": "https://stackoverflow.com/users/9278374/michael-anonymous"}, "is_accepted": true, "score": 0, "last_activity_date": 1539189039, "creation_date": 1539189039, "answer_id": 52744896, "question_id": 52506911, "link": "https://stackoverflow.com/questions/52506911/golang-mysql-connection-timeout-after-ubuntu-upgrade/52744896#52744896", "title": "Golang MySQL connection timeout after Ubuntu upgrade", "body": "<p>Answering my question just to close it off but thank you Peter for your comments that led to my solution.   </p>\n\n<p>The problem was specifically my firewall rules. I have some strict rules around country of origin but inadvertently blocked traffic from 127.0.0.1. Once I made an exception for this, everything works fine.</p>\n"}], "owner": {"reputation": 111, "user_id": 9278374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9a4980b308a75e207765cd6c2b94345?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Anonymous", "link": "https://stackoverflow.com/users/9278374/michael-anonymous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 52744896, "answer_count": 2, "score": 0, "last_activity_date": 1539189039, "creation_date": 1537910759, "question_id": 52506911, "link": "https://stackoverflow.com/questions/52506911/golang-mysql-connection-timeout-after-ubuntu-upgrade", "title": "Golang MySQL connection timeout after Ubuntu upgrade", "body": "<p>I am having a problem with a golang project fetching data from MySQL database. This project has been working without issue until I upgraded from Ubuntu 16.04 to Ubuntu 18.04.01. The application now times out when connecting to the database. </p>\n\n<p>My first thought was that something broke in the 16.04 to 18.04 upgrade. To prove this I spun up a new VM running 16.04, performed a \"do-release-upgrade\" and brought it up to 18.04. However on this VM, my application works just fine without problems. </p>\n\n<p>I'm at a loss where to go from here to troubleshoot what is happening. Here is a summary of the two configurations. Both the VM (working) and the server (not working) are the following;</p>\n\n<p>Ubuntu 18.04.01 LTS x86_64<br>\nKernal 4.15.0-34-generic<br>\nGo 1.11<br>\nMySQL 5.7.23-0ubuntu  </p>\n\n<p>Here is my test program:<br>\npackage main</p>\n\n<pre><code>import (\n        \"fmt\"\n        \"database/sql\"\n        _\"github.com/go-sql-driver/mysql\"\n)\n\nfunc main() {\n        fmt.Printf(\"Connecting to db\\n\")\n        db,err := sql.Open(\"mysql\",\"Test:@/Test\")\n        if err != nil {\n                panic(err)\n        }\n        fmt.Printf(\"Trying query Row\\n\")\n        var Data int \n        err = db.QueryRow(\"SELECT Data FROM Test WHERE ID=2\").Scan(&amp;Data)\n        fmt.Printf(\"After Query\\n\")\n        if err != nil {\n                panic(err)\n        }\n        fmt.Printf(\"Got Data=%d\\n\",Data)\n        db.Close()\n}\n</code></pre>\n\n<p>On the VM the program executes without problem and returns some valid data. The server hangs on the QueryRow line. After 2 minutes I get this return</p>\n\n<pre><code>$ time ./test\nConnecting to db\nTrying query Row\nAfter Query\npanic: dial tcp 127.0.0.1:3306: connect: connection timed out\n\ngoroutine 1 [running]:\nmain.main()\n    /home/daedalus/test/sqltest.go:20 +0x263\n\nreal    2m10.874s\nuser    0m0.001s\nsys 0m0.009s\n</code></pre>\n\n<p>I realize the problem is the program cannot connect to the database, or that the database does not respond, but I cannot see why. There is nothing being logged either in syslog, mysql's log files. There is nothing wrong with MySQL that I can see. I can connect and run queries as the Test user just fine. </p>\n\n<p>I'm not sure how to proceed with tracking down why the server is failing but the VM is working when both configurations are the same. </p>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["c", "go", "glib", "pango"], "answers": [{"comments": [{"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1537936680, "post_id": 52508550, "comment_id": 91960033, "body": "doubly registering the type? what is that mean here? Go registers two types? How?"}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1537936854, "post_id": 52508550, "comment_id": 91960088, "body": "&quot;being opaque to what each other are doing&quot; The code snipped provided in description explains how each other are doing. &quot;Try to use the go bindings for the gtk stack&quot; this make things hard because the library remains huge and mystery, it is impossible to directly use gtk binding at the moment, any other suggestions?"}], "tags": [], "owner": {"reputation": 260, "user_id": 8322623, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XtjmiGIeM-U/AAAAAAAAAAI/AAAAAAAAABw/RVDz5MYOGsk/photo.jpg?sz=128", "display_name": "Paul Childs", "link": "https://stackoverflow.com/users/8322623/paul-childs"}, "is_accepted": false, "score": 0, "last_activity_date": 1537923918, "creation_date": 1537923918, "answer_id": 52508550, "question_id": 52505186, "link": "https://stackoverflow.com/questions/52505186/what-can-be-a-cause-of-glib-gobject-critical-when-call-pango-cairo-font-map-ge/52508550#52508550", "title": "What can be a cause of &quot;GLib-GObject-CRITICAL&quot; when call pango_cairo_font_map_get_default() in libpango?", "body": "<p>The problem is likely due to a conflict between what you are doing in Go and c, due to doubly registering the type and being opaque to what each other are doing.\nTry to use the go bindings for the gtk stack rather than making your own wrapper.</p>\n"}], "owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 539, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1537923918, "creation_date": 1537902346, "question_id": 52505186, "link": "https://stackoverflow.com/questions/52505186/what-can-be-a-cause-of-glib-gobject-critical-when-call-pango-cairo-font-map-ge", "title": "What can be a cause of &quot;GLib-GObject-CRITICAL&quot; when call pango_cairo_font_map_get_default() in libpango?", "body": "<p>This is a concept question regarding <code>gtk/glib/libpango/libcairo</code>. Let's straight to the problem.</p>\n\n<p>I am wrapping an old C library in Go written by a former colleague, somewhere in the C code calls <a href=\"https://developer.gnome.org/pango/stable/pango-Cairo-Rendering.html\" rel=\"nofollow noreferrer\"><code>pango_cairo_font_map_get_default()</code></a> to get a default <code>font_map</code> maintained by <code>libpango</code>.</p>\n\n<p>The wrapping is basically from Go domain entering the C domain (foreign function interface) and C side using <code>pthread</code> creates a thread eventually calls <code>pango_cairo_font_map_get_default</code>.</p>\n\n<p>Originally, everything works fine on the pure C side. After the wrapping, the C code stuck on the calling of <code>pango_cairo_font_map_get_default()</code></p>\n\n<pre><code>printf(\"before call\");\nfont_map = pango_cairo_font_map_get_default();\nprintf(\"after call\");\n</code></pre>\n\n<p>The expected outputs are:</p>\n\n<pre><code>before call\nafter call\n</code></pre>\n\n<p>The actual outputs are:</p>\n\n<pre><code>before call\n(process:1): GLib-GObject-WARNING **: cannot register existing type 'PangoFontMap'\n\n(process:1): GLib-CRITICAL **: g_once_init_leave: assertion 'result != 0' failed\n\n(process:1): GLib-GObject-CRITICAL **: g_type_register_static: assertion 'parent_type &gt; 0' failed\n\n(process:1): GLib-CRITICAL **: g_once_init_leave: assertion 'result != 0' failed\n\n(process:1): GLib-GObject-CRITICAL **: g_type_register_static: assertion 'parent_type &gt; 0' failed\n\n(process:1): GLib-GObject-WARNING **: cannot register existing type 'PangoCairoFontMap'\n</code></pre>\n\n<p>My own simulation (The C side basically explains how my former colleague was doing with <code>libpango</code>) demo works fine, no warning and no critical outputs:</p>\n\n<pre><code>package main\n\n/*\n#cgo CFLAGS: -I/usr/local/include/pango-1.0\n#cgo CFLAGS: -I/usr/local/include/glib-2.0\n#cgo CFLAGS: -I/usr/local/include/cairo\n#cgo LDFLAGS: -L/usr/local/lib -lpangocairo-1.0 -lpango-1.0 -lcairo -lgobject-2.0 -lglib-2.0\n#include &lt;pango/pangocairo.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;pthread.h&gt;\nvoid hello() {\n    printf(\"threa id: %li\\n\", (unsigned long int)pthread_self());\n    PangoFontMap* font_map = pango_cairo_font_map_get_default();\n    PangoFontDescription* font_desc = pango_font_description_new();\n    pango_font_description_set_family(font_desc, \"monospace\");\n    pango_font_description_set_weight(font_desc, PANGO_WEIGHT_NORMAL);\n    pango_font_description_set_size(font_desc, 20 * PANGO_SCALE * 700 / 96);\n    PangoContext* context = pango_font_map_create_context(font_map);\n    PangoFont* font = pango_font_map_load_font(font_map, context, font_desc);\n    PangoFontMetrics* metrics = pango_font_get_metrics(font, NULL);\n    int width = pango_font_metrics_get_approximate_digit_width(metrics) / PANGO_SCALE;\n    int height = (pango_font_metrics_get_descent(metrics)\n                    + pango_font_metrics_get_ascent(metrics)) / PANGO_SCALE;\n    printf(\"%d, %d\\n\", width, height);\n    cairo_surface_t* surface = cairo_image_surface_create(CAIRO_FORMAT_RGB24, width, height);\n    cairo_t* cairo = cairo_create(surface);\n    cairo_set_source_rgb(cairo, 155 / 255.0, 155 / 255.0, 155 / 255.0);\n    cairo_rectangle(cairo, 0, 0, width, height);\n    PangoLayout* layout = pango_cairo_create_layout(cairo);\n    pango_layout_set_font_description(layout, font_desc);\n    g_object_unref(layout);\n    cairo_destroy(cairo);\n    cairo_surface_destroy(surface);\n}\nvoid* font() {\n    hello();\n    hello();\n    return NULL;\n}\nvoid two_threads() {\n    pthread_t thread1;\n    pthread_create(&amp;thread1, NULL, font, NULL);\n    pthread_join(thread1, NULL);\n    pthread_t thread2;\n    pthread_create(&amp;thread2, NULL, font, NULL);\n    pthread_join(thread2, NULL);\n}\n*/\nimport \"C\"\nimport \"sync\"\n\nfunc main() {\n    wg := sync.WaitGroup{}\n    for i := 0; i &lt; 1; i++ {\n        wg.Add(1)\n        go func() {\n            C.two_threads()\n            wg.Done()\n        }()\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<p>TL;DR: my understanding of <code>pango_cairo_font_map_get_default()</code> will always succeed (thread safe, because it is using 1.40.4 1.el7), and no matter how many times (static internal variable inside pango) the code tries to call.</p>\n\n<p>Thus, my questions are:</p>\n\n<ol>\n<li>what can be a cause of <code>cannot register existing type</code>/<code>g_once_init_leave: assertion failed</code>?</li>\n<li>why such an error blocks the code?</li>\n</ol>\n"}, {"tags": ["mysql", "database", "docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 63555, "user_id": 1094597, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/d42a80b4c1210d697031449b8f86df38?s=128&d=identicon&r=PG", "display_name": "kosa", "link": "https://stackoverflow.com/users/1094597/kosa"}, "edited": false, "score": 0, "creation_date": 1537898988, "post_id": 52504318, "comment_id": 91949158, "body": "<a href=\"https://stackoverflow.com/questions/19712307/mysql-localhost-127-0-0-1\" title=\"mysql localhost 127 0 0 1\">stackoverflow.com/questions/19712307/mysql-localhost-127-0-0&zwnj;&#8203;-1</a>"}, {"owner": {"reputation": 349, "user_id": 2766510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dmg9r.jpg?s=128&g=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/2766510/jacob"}, "edited": false, "score": 0, "creation_date": 1537899494, "post_id": 52504318, "comment_id": 91949402, "body": "This has been asked and answered before. Check <a href=\"https://stackoverflow.com/questions/24319662/from-inside-of-a-docker-container-how-do-i-connect-to-the-localhost-of-the-mach?answertab=active#tab-top\">connecting from docker VM to host.</a>"}], "answers": [{"comments": [{"owner": {"reputation": 638, "user_id": 2011368, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9ZRvA.png?s=128&g=1", "display_name": "william205", "link": "https://stackoverflow.com/users/2011368/william205"}, "edited": false, "score": 0, "creation_date": 1537899452, "post_id": 52504428, "comment_id": 91949378, "body": "This works, thank you :) And thank you for the explanation. I am guessing because this is a workaround that I shouldn&#39;t be doing it this way, what is the proper way to develop with MySQL using docker-compose? (I am very new to docker)"}, {"owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "reply_to_user": {"reputation": 638, "user_id": 2011368, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9ZRvA.png?s=128&g=1", "display_name": "william205", "link": "https://stackoverflow.com/users/2011368/william205"}, "edited": false, "score": 2, "creation_date": 1537900066, "post_id": 52504428, "comment_id": 91949701, "body": "There&#39;s nothing inherently wrong with this approach. It has the benefit that your database data persists \u2013 i.e. the data won&#39;t go away if you destroy a MySQL container accidentally, nor do you have to worry about mapping a host volume into such a container, which is more complex. The alternative would be to host a MySQL instance in Docker and set this up using Docker Compose in the same way. You gain Docker&#39;s internal container-to-container networking capabilities at this point. The main benefit of <code>docker.for.mac.localhost</code> is the Docker daemon will map that name to the host IP automatically."}, {"owner": {"reputation": 638, "user_id": 2011368, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9ZRvA.png?s=128&g=1", "display_name": "william205", "link": "https://stackoverflow.com/users/2011368/william205"}, "edited": false, "score": 0, "creation_date": 1537906448, "post_id": 52504428, "comment_id": 91952515, "body": "Thank you for this, I really appreciate it :)"}], "tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": true, "score": 9, "last_activity_date": 1537899192, "creation_date": 1537899192, "answer_id": 52504428, "question_id": 52504318, "link": "https://stackoverflow.com/questions/52504318/unable-to-connect-to-mysql-server-with-go-and-docker-dial-tcp-127-0-0-13306/52504428#52504428", "title": "Unable to connect to mysql server with go and docker - dial tcp 127.0.0.1:3306: connect: connection refused", "body": "<p>You can't connect to <code>localhost</code> from Docker (especially on a Mac, where Docker runs in a Linux VM under the surface) and expect to access the services provided by the host machine.</p>\n\n<p>However, there is functionality to access the host machine by IP address using the special hostname <code>docker.for.mac.localhost</code>. Absent any other Docker networking issues, amending your connection string to use <code>docker.for.mac.localhost:3306</code> should resolve this issue and permit access to services on the host machine.</p>\n\n<p>(More details about this workaround available in the <a href=\"https://docs.docker.com/v17.09/docker-for-mac/networking/#per-container-ip-addressing-is-not-possible\" rel=\"noreferrer\">Docker docs</a>.)</p>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 9864729, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ydtab.jpg?s=128&g=1", "display_name": "Vitah", "link": "https://stackoverflow.com/users/9864729/vitah"}, "is_accepted": false, "score": 6, "last_activity_date": 1541061202, "creation_date": 1541061202, "answer_id": 53097623, "question_id": 52504318, "link": "https://stackoverflow.com/questions/52504318/unable-to-connect-to-mysql-server-with-go-and-docker-dial-tcp-127-0-0-13306/53097623#53097623", "title": "Unable to connect to mysql server with go and docker - dial tcp 127.0.0.1:3306: connect: connection refused", "body": "<p>You should open like this:</p>\n\n<pre><code>db, err := sql.Open(\"mysql\", \"root:root@tcp(mysql:3306)/GoLife\")\n</code></pre>\n\n<p><code>mysql</code> is docker-compose service name.</p>\n"}, {"tags": [], "owner": {"reputation": 3000, "user_id": 5175802, "user_type": "registered", "accept_rate": 88, "profile_image": "https://graph.facebook.com/10204557372486692/picture?type=large", "display_name": "Jake Boomgaarden", "link": "https://stackoverflow.com/users/5175802/jake-boomgaarden"}, "is_accepted": false, "score": 1, "last_activity_date": 1608715230, "creation_date": 1608715230, "answer_id": 65421829, "question_id": 52504318, "link": "https://stackoverflow.com/questions/52504318/unable-to-connect-to-mysql-server-with-go-and-docker-dial-tcp-127-0-0-13306/65421829#65421829", "title": "Unable to connect to mysql server with go and docker - dial tcp 127.0.0.1:3306: connect: connection refused", "body": "<p>My solution ended up being a combination of the answers on this page. I was receiving the error:</p>\n<pre><code>dial tcp 127.0.0.1:3306: connect: connection refused\n</code></pre>\n<p>And my connection was constructed like so:</p>\n<pre><code>db, err := sql.Open(&quot;mysql&quot;,  &quot;root:password@/mydbname?parseTime=true&quot;)\n</code></pre>\n<p>I read what @Cosmic Ossifrage had wasn't sure how to implement it so i applied the answer given by Vitah. this did not work because mysql:3306 was not a location that docker understood so connection failed. I then applied @Cosmic Ossifrage's solution with Vitah's to get a working setup.</p>\n<pre><code>db, err:= sql.Open(&quot;mysql&quot;, &quot;root:password@tcp(docker.for.mac.localhost:3306)/mydbname?parseTime=true&quot;)\n</code></pre>\n<p>Hope this helps anyone searching for the answer! Thank you to the other contributors for helping me piece it together</p>\n"}], "owner": {"reputation": 638, "user_id": 2011368, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/9ZRvA.png?s=128&g=1", "display_name": "william205", "link": "https://stackoverflow.com/users/2011368/william205"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11527, "favorite_count": 3, "accepted_answer_id": 52504428, "answer_count": 3, "score": 5, "last_activity_date": 1608715230, "creation_date": 1537898782, "question_id": 52504318, "link": "https://stackoverflow.com/questions/52504318/unable-to-connect-to-mysql-server-with-go-and-docker-dial-tcp-127-0-0-13306", "title": "Unable to connect to mysql server with go and docker - dial tcp 127.0.0.1:3306: connect: connection refused", "body": "<p>I have Mysql Community Server installed on my mac, it is set up and is working, I can connect to it on localhost:3306 using Navicat for MySQL. However, whenever I try and connect to the database from my go app which is running using docker-compose, I get the following error:</p>\n\n<pre><code>dial tcp 127.0.0.1:3306: connect: connection refused\n</code></pre>\n\n<p>This is my go code:</p>\n\n<pre><code>// dbUser, dbPassword, &amp; dbName are all variables that definitely contain the correct values\ndb, err = sql.Open(\"mysql\", dbUser+\":\"+dbPassword+\"@tcp(localhost:3306)/\"+dbName)\n\nif err != nil {\n    panic(err.Error())\n}\n\ndefer db.Close()\n\nquery, err := db.Query(\"INSERT INTO test_table(test_field) VALUES(This is a test)\")\n\nif err != nil {\n    panic(err.Error())\n}\n\ndefer query.Close()\n</code></pre>\n\n<p>and I am importing:</p>\n\n<pre><code>\"database/sql\"\n_ \"github.com/go-sql-driver/mysql\"\n</code></pre>\n\n<p>Any help would be really appreciated, thank you.</p>\n"}, {"tags": ["go", "scope", "variable-declaration", "type-declaration"], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1537896109, "post_id": 52503596, "comment_id": 91947843, "body": "As for the usage of locally scoped types, sometimes it is useful to declare a throwaway type in a lesser scope so you don&#39;t have to worry about muddying the namespace."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1537896175, "post_id": 52503596, "comment_id": 91947875, "body": "Or for use in a locally-declared function. But generally, locally-declared types are a fairly rare occurrence."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1537896534, "post_id": 52503596, "comment_id": 91948036, "body": "I use them quite a bit in my API when calling some 3rd party API. I declare the response type locally in the function because the response is Unmarshalled, dismantled, and its values are used only inside that function (See <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/json-to-go</a>). Just my two cents for an example. I should benchmark to see if a local declared type is more/less overhead... probably no difference, but could be an interesting experiment."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1537896611, "post_id": 52503596, "comment_id": 91948082, "body": "I feel like anonymous types are a more common solution for that use case, but I may well be wrong about that."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1537896733, "post_id": 52503596, "comment_id": 91948143, "body": "Er sorry, that&#39;s what I meant. It&#39;s anonymous."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 5, "last_activity_date": 1537895866, "creation_date": 1537895866, "answer_id": 52503596, "question_id": 52503560, "link": "https://stackoverflow.com/questions/52503560/understanding-variable-scope-in-go/52503596#52503596", "title": "Understanding variable scope in Go", "body": "<p>They're making the same point, with the same rules, about two different things: the first is about variables and constants, the second is about type identifiers. So, if you declare a type inside a block, the same scoping rules apply as would apply to a variable declared at the same spot.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1537941176, "last_edit_date": 1537941176, "creation_date": 1537906745, "answer_id": 52506086, "question_id": 52503560, "link": "https://stackoverflow.com/questions/52503560/understanding-variable-scope-in-go/52506086#52506086", "title": "Understanding variable scope in Go", "body": "<p>Besides applying to different things (rule #5 is for <a href=\"https://golang.org/ref/spec#Constant_declarations\" rel=\"nofollow noreferrer\">constant-</a> and <a href=\"https://golang.org/ref/spec#Variable_declarations\" rel=\"nofollow noreferrer\">variable declarations</a>, rule #6 is for <a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"nofollow noreferrer\">type declarations</a>), there is also an important difference in wording:</p>\n\n<blockquote>\n  <ol start=\"5\">\n  <li>The scope of a constant or variable identifier declared inside a\n  function <strong>begins at the end</strong> of the ConstSpec or VarSpec (ShortVarDecl\n  for short variable declarations) and ends at the end of the\n  innermost containing block.</li>\n  <li>The scope of a type identifier declared inside a function <strong>begins at\n  the identifier in the TypeSpec</strong> and ends at the end of the innermost\n  containing block.</li>\n  </ol>\n</blockquote>\n\n<p>This is the reason why there are 2 rules and not one.</p>\n\n<p>What does this mean? What does the difference imply?</p>\n\n<h3># 5 Variable and Constant declarations (inside a function)</h3>\n\n<p>The scope of the declared variables or constants begins at the end of the declaration. This means if you're creating a function variable, initializing it with an anonymous function, it can't refer to itself.</p>\n\n<p>This is invalid:</p>\n\n<pre><code>f := func() {\n    f()\n}\n</code></pre>\n\n<p>Attempting to compile: </p>\n\n<pre><code>prog.go:5:3: undefined: f\n</code></pre>\n\n<p>This is because the declaration ends after the closing bracket of the anonymous function, so inside of it you can't call <code>f()</code>. A workaround would be:</p>\n\n<pre><code>var f func()\nf = func() {\n    f()\n}\n</code></pre>\n\n<p>Now here the declaration of <code>f</code> ends at the closing parenthesis (of its type <code>func()</code>), so in the next line when we assign an anonymous function to it, it is valid to refer to <code>f</code> (to call the function value stored in the <code>f</code> variable) because it is now in scope. See related question: <a href=\"https://stackoverflow.com/questions/28099441/define-a-recursive-function-within-a-function-in-go/28099510#28099510\">Define a recursive function within a function in Go</a></p>\n\n<p>Similarly, when initializing a variable e.g. with a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a>, you can't refer to the variable inside of it:</p>\n\n<pre><code>var m = map[int]string{\n    1:  \"one\",\n    21: \"twenty-\" + m[1],\n}\n</code></pre>\n\n<p>This gives a compile-time error (\"undefined: m\"), because <code>m</code> is not in scope yet inside the composite literal.</p>\n\n<p>And obviously this workaround works:</p>\n\n<pre><code>var m = map[int]string{\n    1: \"one\",\n}\nm[21] = \"twenty-\" + m[1]\n</code></pre>\n\n<h3># 6 Type declarations (inside a function)</h3>\n\n<p>The scope of the declared type begins at the identifier in the declaration. So in contrast to rule #5, it is valid to refer to the type itself inside its declaration.</p>\n\n<p>Does it have any advantage / significance?</p>\n\n<p>Yes, you can declare recursive types, such as this:</p>\n\n<pre><code>type Node struct {\n    Left, Right *Node\n}\n</code></pre>\n\n<p>The type identifier <code>Node</code> is in scope right after it appears in the type declaration, which ends with the closing bracket, but before that we could refer to it, meaningfully. </p>\n\n<p>Another example would be a slice type whose element type is itself:</p>\n\n<pre><code>type Foo []Foo\n</code></pre>\n\n<p>You can read more about it here: <a href=\"https://stackoverflow.com/questions/36077566/how-can-a-slice-contain-itself\">How can a slice contain itself?</a></p>\n\n<p>Yet another valid example:</p>\n\n<pre><code>type M map[int]M\n</code></pre>\n"}], "owner": {"reputation": 1061, "user_id": 10260399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c87b06d5c16f130459ff4e480135ecce?s=128&d=identicon&r=PG&f=1", "display_name": "MBB", "link": "https://stackoverflow.com/users/10260399/mbb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6497, "favorite_count": 1, "accepted_answer_id": 52503596, "answer_count": 2, "score": 7, "last_activity_date": 1590843437, "creation_date": 1537895731, "last_edit_date": 1590843437, "question_id": 52503560, "link": "https://stackoverflow.com/questions/52503560/understanding-variable-scope-in-go", "title": "Understanding variable scope in Go", "body": "<p>I am going through the <code>Go specification</code> to learn the language, and these points are taken from the spec under <a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\"><code>Declarations and scope</code></a>.</p>\n\n<p>Though I am able to understand points 1-4, I am confused on points <code>5</code> and <code>6</code>:</p>\n\n<blockquote>\n  <ol start=\"5\">\n  <li>The scope of a constant or variable identifier declared inside a\n  function begins at the end of the ConstSpec or VarSpec (ShortVarDecl\n  for short variable declarations) and ends at the end of the\n  innermost containing block.</li>\n  <li>The scope of a type identifier declared inside a function begins at\n  the identifier in the TypeSpec and ends at the end of the innermost\n  containing block.</li>\n  </ol>\n</blockquote>\n\n<p>This is the code which I used to understand scope in Go:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    x := 42\n    fmt.Println(x)\n    {\n        fmt.Println(x)\n        y := \"The test message\"\n        fmt.Println(y)\n    }\n    // fmt.Println(y) // outside scope of y\n}\n</code></pre>\n\n<p>From this what I understand is <code>scope of x</code> is within the <code>main</code> function, and the <code>scope of y</code> is inside the opening and closing brackets after <code>fmt.Println(x)</code>, and I cannot use <code>y</code> outside of the closing brackets.</p>\n\n<p>If I understand it correctly, both points <code>4 and 5</code> are saying the same thing. So my questions are:</p>\n\n<ol>\n<li><p>If they are saying the same thing, what is the <code>importance</code> of both the\npoints?</p></li>\n<li><p>If they are different, can you please let me know the <code>difference</code>?</p></li>\n</ol>\n"}, {"tags": ["go", "cryptography", "ecdsa"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1537892231, "post_id": 52502511, "comment_id": 91945844, "body": "Did you see the documentation? <code>type PublicKey interface{}</code> It can be anything, and is probably not directly convertible to a byte slice. For instance an RSA PublicKey is a struct that contains a modulus and exponent. Converting this to a <code>[]byte</code> is meaningless and impossible anyway. This question is an <a href=\"https://meta.stackexchange.com/q/66377/189912\">XY problem</a>. You should instead describe what you are really trying to accomplish by doing this. Then we can find a solution for the true underlying problem."}, {"owner": {"reputation": 65, "user_id": 6424134, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df6721b4ee96dc81bd3cf571f9f3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Folleah", "link": "https://stackoverflow.com/users/6424134/folleah"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1537893145, "post_id": 52502511, "comment_id": 91946335, "body": "@MichaelHampton, I use another package in which I need to pass an array of bytes to the method. However, since I only have an interface, it&#39;s impossible to do it"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1537894581, "post_id": 52502511, "comment_id": 91947093, "body": "What other package? What method?"}, {"owner": {"reputation": 65, "user_id": 6424134, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df6721b4ee96dc81bd3cf571f9f3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Folleah", "link": "https://stackoverflow.com/users/6424134/folleah"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1537901486, "post_id": 52502511, "comment_id": 91950365, "body": "@MichaelHampton i use <a href=\"https://github.com/btcsuite/btcd/issues/974#issuecomment-320462200\" rel=\"nofollow noreferrer\">this</a> way, i need to get public key in byte[] format for use <code>btcutil.NewAddressPubKey(wif.SerializePubKey(), \t\t&amp;chaincfg.MainNetParams)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1537893968, "post_id": 52502639, "comment_id": 91946761, "body": "@Folleah, While it&#39;s tangential, it might worth mentioning that at least 3 &quot;wire formats&quot; were created to store/transmit cryptographic material\u2014pkcs#7, PFX and pkcs#12 (see <a href=\"https://en.wikipedia.org/wiki/PKCS\" rel=\"nofollow noreferrer\">this</a>). The latter is arguably the most common these days, and <a href=\"https://github.com/SSLMate/go-pkcs12\" rel=\"nofollow noreferrer\"><code>github.com&#47;SSLMate&#47;go-pkcs12</code></a> allows to create PKCS#12-formatted containers. <a href=\"https://godoc.org/?q=pkcs\" rel=\"nofollow noreferrer\">See also</a>."}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 1, "creation_date": 1537894541, "post_id": 52502639, "comment_id": 91947070, "body": "Instead of inventing your own encoding it would be wise to use the <a href=\"https://golang.org/pkg/crypto/elliptic/#Marshal\" rel=\"nofollow noreferrer\">Marshal</a> function to get a standardized uncompressed point to represent the public key. Using a container format such as suggested by the comment above is of course also a good option, but it is not similar to storing D."}, {"owner": {"reputation": 65, "user_id": 6424134, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df6721b4ee96dc81bd3cf571f9f3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Folleah", "link": "https://stackoverflow.com/users/6424134/folleah"}, "edited": false, "score": 0, "creation_date": 1537901574, "post_id": 52502639, "comment_id": 91950400, "body": "Thank you, i will explore these ways."}, {"owner": {"reputation": 3795, "user_id": 4926817, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/0lH0y.png?s=128&g=1", "display_name": "Noam Hacker", "link": "https://stackoverflow.com/users/4926817/noam-hacker"}, "edited": false, "score": 0, "creation_date": 1538756733, "post_id": 52502639, "comment_id": 92269419, "body": "note for if you are using rsa: <code>privkey.PublicKey.N.Bytes()</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1537894805, "last_edit_date": 1592644375, "creation_date": 1537892335, "answer_id": 52502639, "question_id": 52502511, "link": "https://stackoverflow.com/questions/52502511/how-to-generate-bytes-array-from-publickey/52502639#52502639", "title": "How to generate bytes array from PublicKey", "body": "<p><a href=\"https://golang.org/pkg/crypto/ecdsa/#PrivateKey\" rel=\"nofollow noreferrer\"><code>ecdsa.PrivateKey</code></a> is a struct:</p>\n<pre><code>type PrivateKey struct {\n        PublicKey\n        D *big.Int\n}\n</code></pre>\n<p>So <code>privkey.D.Bytes()</code> returns you the bytes of the <code>D</code> big integer.</p>\n<p>Similarly, <a href=\"https://golang.org/pkg/crypto/ecdsa/#PublicKey\" rel=\"nofollow noreferrer\"><code>ecdsa.PublicKey</code></a>:</p>\n<pre><code>type PublicKey struct {\n        elliptic.Curve\n        X, Y *big.Int\n}\n</code></pre>\n<p>You may do the same with <code>pubkey.X</code> and <code>pubkey.Y</code> fields. These will give you 2 separate byte slices. If you need to merge them into one, you need to come up with some kind of &quot;format&quot;, e.g. encoding the length of the first slice (the result of <code>pubkey.X.Bytes()</code>) using 4 bytes, then the first slice, then the length (4 bytes again) of the 2nd slice, and the second slice itself.</p>\n<p>Best would be to use the <a href=\"https://golang.org/pkg/crypto/elliptic/#Marshal\" rel=\"nofollow noreferrer\"><code>elliptic.Marshal()</code></a> function for this:</p>\n<blockquote>\n<pre><code>func Marshal(curve Curve, x, y *big.Int) []byte\n</code></pre>\n<p>Marshal converts a point into the uncompressed form specified in section 4.3.6 of ANSI X9.62.</p>\n</blockquote>\n<p>Example using it:</p>\n<pre><code>var pubkey *ecdsa.PublicKey = // ...\n\ndata := elliptic.Marshal(pubkey, pubkey.X, pubkey.Y)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1045, "user_id": 1623885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OFggV.jpg?s=128&g=1", "display_name": "George Aristy", "link": "https://stackoverflow.com/users/1623885/george-aristy"}, "edited": false, "score": 0, "creation_date": 1604440423, "post_id": 62640606, "comment_id": 114348012, "body": "I don&#39;t think this is entirely correct - the format of ed25519 private keys seems to be that of the seed concatenated with the public key. See <a href=\"https://stackoverflow.com/a/44874097/1623885\">stackoverflow.com/a/44874097/1623885</a>"}], "tags": [], "owner": {"reputation": 78, "user_id": 1374825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5beb6259ecf0b1ed986130e0aa80c8d3?s=128&d=identicon&r=PG", "display_name": "George Spasov", "link": "https://stackoverflow.com/users/1374825/george-spasov"}, "is_accepted": false, "score": 0, "last_activity_date": 1593441791, "creation_date": 1593441791, "answer_id": 62640606, "question_id": 52502511, "link": "https://stackoverflow.com/questions/52502511/how-to-generate-bytes-array-from-publickey/62640606#62640606", "title": "How to generate bytes array from PublicKey", "body": "<p>For the lovely folks looking for a solution when it comes to <code>ed25519/crypto</code>. I banged my head for nearly 3 hours until I figured it out:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func getPrivateKey() ed25519.PrivateKey {\n    // TODO You fill in this one\n}\n\nfunc main() {\n    prvKey := getPrivateKey() // Get the private key\n\n    pubKey := prvKey.Public().(ed25519.PublicKey)\n    if !ok {\n        log.Errorf(&quot;Could not assert the public key to ed25519 public key&quot;)\n    }\n    pubKeyBytes := []byte(pubKey)\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 6424134, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df6721b4ee96dc81bd3cf571f9f3c61?s=128&d=identicon&r=PG&f=1", "display_name": "Folleah", "link": "https://stackoverflow.com/users/6424134/folleah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2464, "favorite_count": 2, "accepted_answer_id": 52502639, "answer_count": 2, "score": 3, "last_activity_date": 1593441791, "creation_date": 1537891790, "question_id": 52502511, "link": "https://stackoverflow.com/questions/52502511/how-to-generate-bytes-array-from-publickey", "title": "How to generate bytes array from PublicKey", "body": "<p>I'm use <a href=\"https://golang.org/src/crypto/\" rel=\"nofollow noreferrer\">crypto lib</a>, ran into a problem: I need to convert the <code>PublicKey</code> type into <code>byte[]</code>, as it can be done with a private key:</p>\n\n<pre><code>privkey.D.Bytes()\n</code></pre>\n\n<p>How can I solve this problem?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1537885710, "post_id": 52500451, "comment_id": 91941712, "body": "Read the documentation of ParseFiles. The name of the template is <i>not</i> the filepath. So fix <code>&quot;templates&#47;&quot;+tmpl+&quot;.html&quot;</code>"}, {"owner": {"reputation": 1209, "user_id": 770120, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bde4c63167ba18607df504d7feefe16a?s=128&d=identicon&r=PG", "display_name": "Cl&#225;udio Ribeiro", "link": "https://stackoverflow.com/users/770120/cl%c3%a1udio-ribeiro"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537886172, "post_id": 52500451, "comment_id": 91942041, "body": "I&#39;ve read the documentation, but I don&#39;t understand how it can reach the template inside the folder without indicating it. I&#39;m a little bit lost."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1537886346, "post_id": 52500451, "comment_id": 91942162, "body": "As @Volker wrote, the template name is just <code>&quot;view.html&quot;</code>, and not <code>&quot;templates&#47;view.html&quot;</code>. Please see related / possible duplicate: <a href=\"https://stackoverflow.com/questions/41176355/go-template-name/41187671#41187671\">Go template name</a>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1537886352, "post_id": 52500451, "comment_id": 91942167, "body": "Did you try a simple &quot;edit.html&quot;?"}, {"owner": {"reputation": 1209, "user_id": 770120, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bde4c63167ba18607df504d7feefe16a?s=128&d=identicon&r=PG", "display_name": "Cl&#225;udio Ribeiro", "link": "https://stackoverflow.com/users/770120/cl%c3%a1udio-ribeiro"}, "edited": false, "score": 0, "creation_date": 1537886613, "post_id": 52500451, "comment_id": 91942378, "body": "I just tried a simple edit.html and I still get the same error which is strange because I don&#39;t have &#39;/templates&#39; on any part of the code but it still references it."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1537886942, "post_id": 52500451, "comment_id": 91942633, "body": "make sure you save the code, run <code>go clean</code>, re-build the code and run it."}, {"owner": {"reputation": 1209, "user_id": 770120, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bde4c63167ba18607df504d7feefe16a?s=128&d=identicon&r=PG", "display_name": "Cl&#225;udio Ribeiro", "link": "https://stackoverflow.com/users/770120/cl%c3%a1udio-ribeiro"}, "edited": false, "score": 0, "creation_date": 1537887017, "post_id": 52500451, "comment_id": 91942679, "body": "It&#39;s working now, thanks for the tips!"}], "owner": {"reputation": 1209, "user_id": 770120, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bde4c63167ba18607df504d7feefe16a?s=128&d=identicon&r=PG", "display_name": "Cl&#225;udio Ribeiro", "link": "https://stackoverflow.com/users/770120/cl%c3%a1udio-ribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1325, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1537885202, "creation_date": 1537885202, "question_id": 52500451, "link": "https://stackoverflow.com/questions/52500451/golang-template-is-undefined", "title": "Golang, template is undefined", "body": "<p>I'm currently trying to create a small web application using golang and I'm following the tutorial on their webpage (<a href=\"https://golang.org/doc/articles/wiki/final.go\" rel=\"nofollow noreferrer\">https://golang.org/doc/articles/wiki/final.go</a>). Instead of having the templates on the same folder as the rest of the code I'm trying to move them into <code>templates/template_name.html</code>.</p>\n\n<p>For template rendering I'm using the following code:</p>\n\n<pre><code>var templates = template.Must(template.ParseFiles(\"templates/edit.html\", \"templates/view.html\"))\n\nfunc renderTemplate(w http.ResponseWriter, tmpl string, p *Page) {\n    err := templates.ExecuteTemplate(w, \"templates/\"+tmpl+\".html\", p)\n    if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n    }\n}\n</code></pre>\n\n<p>And for example my View handler is the following:</p>\n\n<pre><code>func viewHandler(w http.ResponseWriter, r *http.Request, title string) {                                                                                                                                    \n    p, err := loadPage(title)                                                                                                                                                                           \n    if err != nil {                                                                                                                                                                                     \n            http.Redirect(w, r, \"/edit/\"+title, http.StatusFound)                                                                                                                                       \n            return                                                                                                                                                                                      \n    }                                                                                                                                                                                                   \n    renderTemplate(w, \"view\", p)                                                                                                                                                                        \n\n}\n</code></pre>\n\n<p>I have the <code>templates/</code> folder with the <code>edit.html</code> and <code>view.html</code> file inside. I run the full code with: <code>go run wiki.go</code> but when I try to access the webpage I get the following error:</p>\n\n<pre><code>html/template: \"templates/view.html\" is undefined\n</code></pre>\n\n<p>Any idea of what might be happening?</p>\n"}, {"tags": ["go", "bitwise-operators", "bitwise-and"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1537885504, "post_id": 52500422, "comment_id": 91941566, "body": "Because you can specify more than just one flag to be set. op is a bitpattern with lets say bit 4 signifying &quot;rename&quot; and bit 2 signifiying &quot;write&quot; if someone passes 0001010 this is not equal to Rename which is 0001000 and not equal to Write which is 00000010. To test if the Rename bit is set you have to AND it with Rename and test if the result is nonzero. Comparing to Rename, Write, etc is not important here and could be replaced by != 0."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1537885516, "post_id": 52500422, "comment_id": 91941573, "body": "Do you understand how <code>iota</code> works? Do you know what the values of <code>Create</code>, <code>Write</code>, <code>Remote</code>, etc. are? Why you want to use <code>&amp;</code> rather than checking for equality might become clearer once you understand that..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1537886190, "post_id": 52500422, "comment_id": 91942047, "body": "This might be of some help to you: <a href=\"https://stackoverflow.com/questions/28432398/difference-between-some-operators-golang/28433370#28433370\">Difference between some operators \u201c|\u201d, \u201c^\u201d, \u201c&amp;\u201d, \u201c&amp;^\u201d. Golang</a>."}, {"owner": {"reputation": 2033, "user_id": 940299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a20dd0502a8b0688a1f099e5b48ac41?s=128&d=identicon&r=PG", "display_name": "trikelef", "link": "https://stackoverflow.com/users/940299/trikelef"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537947313, "post_id": 52500422, "comment_id": 91964370, "body": "Thanks @Volker! Comparing <code>op&amp;operation</code> with <i>not</i> zero is more straightforward. I though this piece of code <code>op&amp;operation==operation</code> was some kind of idiomatism."}], "answers": [{"tags": [], "owner": {"reputation": 141, "user_id": 8127284, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P4qAf.jpg?s=128&g=1", "display_name": "Shane Tyler Malachow", "link": "https://stackoverflow.com/users/8127284/shane-tyler-malachow"}, "is_accepted": false, "score": 4, "last_activity_date": 1537889821, "creation_date": 1537889821, "answer_id": 52501955, "question_id": 52500422, "link": "https://stackoverflow.com/questions/52500422/why-compare-using-bitwise-and-in-golang/52501955#52501955", "title": "Why compare using bitwise AND in golang?", "body": "<p>This is an example of <a href=\"https://en.wikipedia.org/wiki/Mask_(computing)\" rel=\"nofollow noreferrer\">bit masking</a>. What they're doing is defining a series of masks (Create, Remove, Write) that are integers 1,2,4,8,16,32,etc. You pass in a single op value, which can have multiple operations, and it figures out which operation to perform based on which bit is flipped. This makes more sense if you think about these numbers in a bitwise pattern. 4 == 00000100, the value for Remove. If you pass in an op code of say, 6, when you compare 00000110 &amp;&amp; 00000100 == 00000100 you get true, because the bit that is specific to Remove, the third least significant bit, is 1.</p>\n\n<p>In a less jargony and specific way, this is basically a way to pass in multiple opcodes with one byte. The reason they're doing a bitwise AND and then comparing is because it allows them to check if that specific bit is flipped, while ignoring the rest of the bits.</p>\n"}], "owner": {"reputation": 2033, "user_id": 940299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a20dd0502a8b0688a1f099e5b48ac41?s=128&d=identicon&r=PG", "display_name": "trikelef", "link": "https://stackoverflow.com/users/940299/trikelef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 415, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1537889821, "creation_date": 1537885110, "question_id": 52500422, "link": "https://stackoverflow.com/questions/52500422/why-compare-using-bitwise-and-in-golang", "title": "Why compare using bitwise AND in golang?", "body": "<p>I am reading a piece of code like this (taken from <a href=\"https://github.com/fsnotify/fsnotify/blob/master/fsnotify.go\" rel=\"nofollow noreferrer\">fsnotify</a>):</p>\n\n<pre><code>    type Op uint32\n\n    const (\n        Create Op = 1 &lt;&lt; iota\n        Write\n        Remove\n        Rename\n        Chmod\n    )\n\n    ...\n\n    func (op Op) String() string {\n\n    var buffer bytes.Buffer\n\n    if op&amp;Create == Create {\n        buffer.WriteString(\"|CREATE\")\n    }\n    if op&amp;Remove == Remove {\n        buffer.WriteString(\"|REMOVE\")\n    }\n    if op&amp;Write == Write {\n        buffer.WriteString(\"|WRITE\")\n    }\n    if op&amp;Rename == Rename {\n        buffer.WriteString(\"|RENAME\")\n    }\n    if op&amp;Chmod == Chmod {\n        buffer.WriteString(\"|CHMOD\")\n    }\n    if buffer.Len() == 0 {\n        return \"\"\n    }\n    return buffer.String()[1:] \n}\n</code></pre>\n\n<p>My <em>newbie</em> question is why someone would use a bitwise AND operation like <code>op&amp;Remove == Remove</code> to actually make a comparison.\nWhy not just compare the op and (Create|Remove|...) values?</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 6249, "user_id": 4577854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QaZMq.jpg?s=128&g=1", "display_name": "xiaomi", "link": "https://stackoverflow.com/users/4577854/xiaomi"}, "edited": false, "score": 0, "creation_date": 1537883567, "post_id": 52499509, "comment_id": 91940288, "body": "Your statement has a condition on <code>block_id</code> while the query you did is on <code>id</code>, does it matter in your situation ?"}, {"owner": {"reputation": 5015, "user_id": 983925, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d824ee5b7e18058b97236525d9afdd5?s=128&d=identicon&r=PG&f=1", "display_name": "fantasitcalbeastly", "link": "https://stackoverflow.com/users/983925/fantasitcalbeastly"}, "reply_to_user": {"reputation": 6249, "user_id": 4577854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QaZMq.jpg?s=128&g=1", "display_name": "xiaomi", "link": "https://stackoverflow.com/users/4577854/xiaomi"}, "edited": false, "score": 0, "creation_date": 1537883885, "post_id": 52499509, "comment_id": 91940488, "body": "@xiaomi - that&#39;s just laziness on my part. In this instance id == block_id."}, {"owner": {"reputation": 6249, "user_id": 4577854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QaZMq.jpg?s=128&g=1", "display_name": "xiaomi", "link": "https://stackoverflow.com/users/4577854/xiaomi"}, "edited": false, "score": 1, "creation_date": 1537884720, "post_id": 52499509, "comment_id": 91941020, "body": "Could you check the err from <code>err := rows.Scan(...)</code> ? This error occurs if the value cannot be stored without loss of information."}, {"owner": {"reputation": 5015, "user_id": 983925, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d824ee5b7e18058b97236525d9afdd5?s=128&d=identicon&r=PG&f=1", "display_name": "fantasitcalbeastly", "link": "https://stackoverflow.com/users/983925/fantasitcalbeastly"}, "reply_to_user": {"reputation": 6249, "user_id": 4577854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QaZMq.jpg?s=128&g=1", "display_name": "xiaomi", "link": "https://stackoverflow.com/users/4577854/xiaomi"}, "edited": false, "score": 1, "creation_date": 1537885223, "post_id": 52499509, "comment_id": 91941350, "body": "I panic() on err, directly underneath the call to Scan() and there currently isn&#39;t an error"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 1, "creation_date": 1537890582, "post_id": 52499509, "comment_id": 91944893, "body": "@LokiSinclair You panic on err from <code>rows.Err()</code>, but you are failing to check the error from <code>rows.Scan(...)</code>."}, {"owner": {"reputation": 5015, "user_id": 983925, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d824ee5b7e18058b97236525d9afdd5?s=128&d=identicon&r=PG&f=1", "display_name": "fantasitcalbeastly", "link": "https://stackoverflow.com/users/983925/fantasitcalbeastly"}, "edited": false, "score": 0, "creation_date": 1537890708, "post_id": 52499509, "comment_id": 91944957, "body": "I&#39;d assumed that would have been caught in: if err = rows.Err(); err != nil - is that not the case?"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 1, "creation_date": 1537891738, "post_id": 52499509, "comment_id": 91945577, "body": "@LokiSinclair That is not the case. <code>err</code> is assigned the value from <code>rows.Scan(...)</code>, but then you immediately re-assign the value from <code>rows.Err()</code> to it, which overwrites the error from Scan."}], "answers": [{"comments": [{"owner": {"reputation": 5015, "user_id": 983925, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d824ee5b7e18058b97236525d9afdd5?s=128&d=identicon&r=PG&f=1", "display_name": "fantasitcalbeastly", "link": "https://stackoverflow.com/users/983925/fantasitcalbeastly"}, "edited": false, "score": 1, "creation_date": 1537906670, "post_id": 52502362, "comment_id": 91952592, "body": "Thank you, I&#39;ll give it a go tomorrow. I&#39;m not worried about nulls as I&#39;ve read all the horror stories and have configured db to always have defaults. Cheers."}, {"owner": {"reputation": 6249, "user_id": 4577854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QaZMq.jpg?s=128&g=1", "display_name": "xiaomi", "link": "https://stackoverflow.com/users/4577854/xiaomi"}, "reply_to_user": {"reputation": 5015, "user_id": 983925, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d824ee5b7e18058b97236525d9afdd5?s=128&d=identicon&r=PG&f=1", "display_name": "fantasitcalbeastly", "link": "https://stackoverflow.com/users/983925/fantasitcalbeastly"}, "edited": false, "score": 0, "creation_date": 1537938868, "post_id": 52502362, "comment_id": 91960691, "body": "@LokiSinclair if you deal with default such as zero value instead of null, you can keep <code>time.Time</code>"}, {"owner": {"reputation": 5015, "user_id": 983925, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d824ee5b7e18058b97236525d9afdd5?s=128&d=identicon&r=PG&f=1", "display_name": "fantasitcalbeastly", "link": "https://stackoverflow.com/users/983925/fantasitcalbeastly"}, "edited": false, "score": 0, "creation_date": 1537942720, "post_id": 52502362, "comment_id": 91962118, "body": "You were correct, I was overwriting the consumed error. Once I&#39;d separated them, I saw that, even though deleted_at was zero time, it still wouldn&#39;t parse without the field being a pointer. Perfect, thank you!"}], "tags": [], "owner": {"reputation": 6249, "user_id": 4577854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QaZMq.jpg?s=128&g=1", "display_name": "xiaomi", "link": "https://stackoverflow.com/users/4577854/xiaomi"}, "is_accepted": true, "score": 6, "last_activity_date": 1537892813, "last_edit_date": 1537892813, "creation_date": 1537891233, "answer_id": 52502362, "question_id": 52499509, "link": "https://stackoverflow.com/questions/52499509/golang-mysql-scan-returns-zeros-when-data-is-there/52502362#52502362", "title": "Golang Mysql scan returns zeros, when data is there?", "body": "<p>First of all, check the error which come from <a href=\"https://golang.org/pkg/database/sql/#Rows.Scan\" rel=\"noreferrer\">rows.Scan()</a>. You only check the error from <a href=\"https://golang.org/pkg/database/sql/#Rows.Err\" rel=\"noreferrer\">rows.Err()</a> which is a different kind of error, and not related to the scan.</p>\n\n<pre><code>err := rows.Scan(&amp;r.ID, &amp;r.Name, &amp;r.RoomType, &amp;r.CreatedAt, &amp;r.UpdatedAt, &amp;r.DeletedAt,\n    &amp;r.GroupId, &amp;r.BlockId, &amp;r.ProjectId, &amp;r.RoomLength, &amp;r.RoomWidth, &amp;r.CeilingHeight,\n    &amp;r.CeilingColorHex, &amp;r.WallColorHex, &amp;r.FloorColorHex, &amp;r.CeilingColorRgb, &amp;r.WallColorRgb,\n    &amp;r.FloorColorRgb)\nif err != nil {\n    panic(err) // Error related to the scan\n}\nif err = rows.Err(); err != nil {\n    panic(err) // Error related to the iteration of rows\n}\n</code></pre>\n\n<p>When the value from <code>deleted_at</code> is return as <code>NULL</code>, Scan will return an error such as <code>unsupported Scan, storing driver.Value type &lt;nil&gt; into type *time.Time</code> and the rest of your struct will get <em>zero values</em>.</p>\n\n<p>It means that your room struct has to change to use a pointer to time.</p>\n\n<pre><code>CreatedAt       *time.Time\nUpdatedAt       *time.Time\nDeletedAt       *time.Time\n</code></pre>\n\n<p>However, you may need to add into you sql.Open() the <a href=\"https://github.com/go-sql-driver/mysql#parsetime\" rel=\"noreferrer\">parameter parseTime</a> <code>sql.Open(\"mysql\", \"user:password@/dbname?parseTime=true)</code> to parse the time correctly for mysql.</p>\n\n<p>You should then received a valid *time.Time when it is set, or nil when it is NULL.</p>\n"}], "owner": {"reputation": 5015, "user_id": 983925, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d824ee5b7e18058b97236525d9afdd5?s=128&d=identicon&r=PG&f=1", "display_name": "fantasitcalbeastly", "link": "https://stackoverflow.com/users/983925/fantasitcalbeastly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 930, "favorite_count": 0, "accepted_answer_id": 52502362, "answer_count": 1, "score": 1, "last_activity_date": 1537892813, "creation_date": 1537882362, "last_edit_date": 1537882465, "question_id": 52499509, "link": "https://stackoverflow.com/questions/52499509/golang-mysql-scan-returns-zeros-when-data-is-there", "title": "Golang Mysql scan returns zeros, when data is there?", "body": "<p>Having a bit of a head scratcher moment. I've got the following struct:</p>\n\n<pre><code>type Room struct {\n    ID              int\n    Name            string\n    RoomType        int\n    CreatedAt       time.Time\n    UpdatedAt       time.Time\n    DeletedAt       time.Time\n    GroupId         int\n    BlockId         int\n    ProjectId       int\n    RoomLength      float64\n    RoomWidth       float64\n    CeilingHeight   float64\n    CeilingColorHex string\n    WallColorHex    string\n    FloorColorHex   string\n    CeilingColorRgb string\n    WallColorRgb    string\n    FloorColorRgb   string\n}\n</code></pre>\n\n<p>Reading it out in rest api with:</p>\n\n<pre><code>database := db.New()\nstmt, err := database.Prepare(\"SELECT * FROM room WHERE block_id = ?\")\nif err != nil {\n    panic(err)\n}\ndefer stmt.Close()\n\nrows, err := stmt.Query(c.Param(\"id\"))\nif err != nil {\n    panic(err)\n}\ndefer rows.Close()\n\nvar rooms []common.Room\nfor rows.Next() {\n    var r common.Room\n    err := rows.Scan(&amp;r.ID, &amp;r.Name, &amp;r.RoomType, &amp;r.CreatedAt, &amp;r.UpdatedAt, &amp;r.DeletedAt,\n        &amp;r.GroupId, &amp;r.BlockId, &amp;r.ProjectId, &amp;r.RoomLength, &amp;r.RoomWidth, &amp;r.CeilingHeight,\n        &amp;r.CeilingColorHex, &amp;r.WallColorHex, &amp;r.FloorColorHex, &amp;r.CeilingColorRgb, &amp;r.WallColorRgb,\n        &amp;r.FloorColorRgb)\n    if err = rows.Err(); err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"Found: %v\", r)\n    rooms = append(rooms, r)\n}\n</code></pre>\n\n<p>Yet, the resulting payload is:</p>\n\n<pre><code>{3 Loki #1 3 2018-09-25 08:42:38 +0000 UTC 2018-09-25 14:52:39 +0000 UTC 0001-01-01 00:00:00 +0000 UTC 0 0 0 0 0 0      }\n</code></pre>\n\n<p>I'm specifically after the length/width, which (above) are 0. Yet in the db:</p>\n\n<pre><code>mysql&gt; select * from room where id = 3 \\G\n*************************** 1. row ***************************\n               id: 3\n             name: Loki #1\n        room_type: 3\n       created_at: 2018-09-25 08:42:38\n       updated_at: 2018-09-25 14:52:39\n       deleted_at: NULL\n         group_id: 0\n         block_id: 1\n       project_id: 0\n      room_length: 10\n       room_width: 7\n   ceiling_height: 4\nceiling_color_hex: #c0c0c0\n   wall_color_hex: #a9a9a9\n  floor_color_hex: #708090\nceiling_color_rgb: 192,192,192\n   wall_color_rgb: 169,169,169\n  floor_color_rgb: 112,128,144\n1 row in set (0.00 sec)\n</code></pre>\n\n<p>I thought it may have something to do with differing types, but after changing them in the db, and then in code, no change. Can anyone explain why <code>.Scan</code> isn't picking up certain values?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["firefox", "go", "attachment", "go-gin"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 3, "creation_date": 1537885522, "post_id": 52499224, "comment_id": 91941582, "body": "The RFC suggest a quoted string in http headers should be quoted with a double-quote mark (<code>&quot;</code>). I think that&#39;s where the problem is."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1537885998, "post_id": 52499224, "comment_id": 91941926, "body": "And the double quotes are not required at all, unless you have spaces in your filename."}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 2, "last_activity_date": 1537893959, "last_edit_date": 1537893959, "creation_date": 1537893516, "answer_id": 52503002, "question_id": 52499224, "link": "https://stackoverflow.com/questions/52499224/file-download-works-with-chrome-but-not-in-firefox-when-downloading-golang-gener/52503002#52503002", "title": "File Download works with Chrome but not in Firefox when downloading golang generated file", "body": "<p>You might need to use double-quotes (<code>\"</code>) for the <a href=\"https://www.w3.org/Protocols/rfc2616/rfc2616-sec19.html#sec19.5.1\" rel=\"nofollow noreferrer\">Content Disposition filename</a> instead of single quotes (<code>'</code>):</p>\n\n<pre><code>extraHeaders := map[string]string{\n  \"Content-Disposition\": `attachment; filename=\"BillingReport.xlsx\"`,\n  // Note the double quotes -------------------^------------------^\n</code></pre>\n\n<p>See <a href=\"https://tools.ietf.org/html/rfc2616#section-19.5.1\" rel=\"nofollow noreferrer\">RFC 2616 Section 19.5.1 \"Content-Disposition\"</a>:</p>\n\n<blockquote>\n  <p>The Content-Disposition response-header field has been proposed as a means for the origin server to suggest a default filename if the user requests that the content is saved to a file...</p>\n\n<pre><code>    content-disposition = \"Content-Disposition\" \":\"\n                          disposition-type *( \";\" disposition-parm )\n    ...\n    filename-parm = \"filename\" \"=\" quoted-string\n</code></pre>\n</blockquote>\n\n<p>And <a href=\"https://tools.ietf.org/html/rfc2616#section-2.2\" rel=\"nofollow noreferrer\">Section 2.2 \"Basic Rules\"</a>:</p>\n\n<blockquote>\n  <p>A string of text is parsed as a single word if it is quoted using double-quote marks.</p>\n\n<pre><code>  quoted-string  = ( &lt;\"&gt; *(qdtext | quoted-pair ) &lt;\"&gt; )\n</code></pre>\n</blockquote>\n\n<p><a href=\"https://tools.ietf.org/html/rfc6266\" rel=\"nofollow noreferrer\">RFC 6266</a> defines additional rules but the simple quoting above is easiest.</p>\n"}, {"tags": [], "owner": {"reputation": 3870, "user_id": 1156199, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1756e52fd4b42a4c5a7973633546fa9b?s=128&d=identicon&r=PG", "display_name": "Vadimo", "link": "https://stackoverflow.com/users/1156199/vadimo"}, "is_accepted": true, "score": 0, "last_activity_date": 1538141549, "creation_date": 1538141549, "answer_id": 52556549, "question_id": 52499224, "link": "https://stackoverflow.com/questions/52499224/file-download-works-with-chrome-but-not-in-firefox-when-downloading-golang-gener/52556549#52556549", "title": "File Download works with Chrome but not in Firefox when downloading golang generated file", "body": "<p>I tried to fix the issue for a couple of days. However I found the culprit where I didn't expect it. It finally was the behavior of the frontend application as I had the impression it was just a link that gets called and I was wrong.</p>\n\n<p>However I wanted to point out that I could successfully verify that the browser doesn't care if the <code>Content-Disposition</code> has a <code>'</code>, <code>\"</code> or no quoting at all.</p>\n\n<p>Also the gin/golang above is working as it should.</p>\n\n<p>thx everyone for helping me out.</p>\n"}], "owner": {"reputation": 3870, "user_id": 1156199, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1756e52fd4b42a4c5a7973633546fa9b?s=128&d=identicon&r=PG", "display_name": "Vadimo", "link": "https://stackoverflow.com/users/1156199/vadimo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 770, "favorite_count": 0, "accepted_answer_id": 52556549, "answer_count": 2, "score": 2, "last_activity_date": 1538141549, "creation_date": 1537881574, "last_edit_date": 1537882600, "question_id": 52499224, "link": "https://stackoverflow.com/questions/52499224/file-download-works-with-chrome-but-not-in-firefox-when-downloading-golang-gener", "title": "File Download works with Chrome but not in Firefox when downloading golang generated file", "body": "<p>I have simple golang/gin-gonic REST Service that serves an excel report upon request to <code>/api/billing</code>. When the requester sets the accept header to <code>application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</code> then an Excel file is served otherwise json. This code works fine in Chrome and IE but not with Firefox and I have no idea why.</p>\n\n<p>In the FF debugger I see that the actual content is transmitted to the browser but FF does not offer the user the download dialog. So for the user it looks like as nothing is happening if he clicks on the link. </p>\n\n<p>I checked already that the popups aren't blocked by FF also I disabled the other security features <a href=\"https://support.mozilla.org/1/firefox/62.0.2/Darwin/de/phishing-malware\" rel=\"nofollow noreferrer\">https://support.mozilla.org/1/firefox/62.0.2/Darwin/de/phishing-malware</a> just in case. I also reinstalled plain FF without any extensions and any changes. The same happens on FF on windows.</p>\n\n<pre><code>r.GET(\"/api/billing\", func(c *gin.Context) {\n        if c.GetHeader(\"Accept\") == \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\" {\n            b := api.GetBillingReportExcel()\n            extraHeaders := map[string]string{\n                \"Content-Disposition\": \"attachment;filename='BillingReport.xlsx'\",\n                \"Content-Transfer-Encoding\": \"binary\",\n                \"Content-Description\": \"Excel Billing Report\",\n            }\n            c.DataFromReader(200, int64(b.Len()),\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",&amp;b,extraHeaders)\n        }else {\n            billingTenants, _ := cache.Get(c.Request.RequestURI)\n            c.JSON(200, GetBillingData())\n        }\n})\n</code></pre>\n\n<p>Here are the request headers they are the same for FF &amp; Chrome</p>\n\n<p><strong>HTTP Request:</strong></p>\n\n<pre><code>    Host: localhost:8081\n    User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:61.0) Gecko/20100101 Firefox/61.0\n    Accept: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\n    Accept-Language: de,en-US;q=0.7,en;q=0.3\n    Accept-Encoding: gzip, deflate\n    Referer: http://localhost:8081/\n    Connection: keep-alive\n</code></pre>\n\n<p><strong>Response</strong></p>\n\n<pre><code>    HTTP/1.1 200 OK\n    X-Powered-By: Express\n    content-description: Excel Billing Report\n    content-disposition: attachment; filename='BillingReport.xlsx'\n    content-length: 11397\n    content-transfer-encoding: binary\n    content-type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\n    date: Tue, 25 Sep 2018 12:17:41 GMT\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "edited": false, "score": 1, "creation_date": 1537880412, "post_id": 52498762, "comment_id": 91938103, "body": "What do you mean, &quot;an object&quot;? Do you mean JSON?"}, {"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "reply_to_user": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "edited": false, "score": 0, "creation_date": 1537880880, "post_id": 52498762, "comment_id": 91938421, "body": "Yes, I mean a JSON object."}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1537880932, "post_id": 52498880, "comment_id": 91938456, "body": "There are no errors returned by those functions. What I meant is that the API response returns error responses such as &quot;field X is required&quot;. Changing the content-type to json also have no effect, both of them works normally (through e.g. Postman)"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1537881237, "post_id": 52498880, "comment_id": 91938691, "body": "@JeffreyAnderson but chaneg the content type since you are sending the json object in bytes. Also you are skipping the errors try to print them like I did and then run the code again see what it prints and psot in your question. It will be of help"}, {"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1537881359, "post_id": 52498880, "comment_id": 91938776, "body": "I did run the error checks and I did change the content type. As I said, no errors are printed."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1537881433, "post_id": 52498880, "comment_id": 91938828, "body": "@JeffreyAnderson also if they are saying that <code>field x is required</code> then you need to be specific that which field has validation since you are sending the request to the server. It is for sure that there are validations on the server."}, {"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1537881715, "post_id": 52498880, "comment_id": 91939031, "body": "It is saying that <code>field x is required</code> because when I debug the given parameters to the server, neither of the fields are present. The interface should hold e.g. <code>&amp;v%!(EXTRA *mystruct.Mystruct=&amp;{0 hello world })</code> but instead, as I&#39;m sending bytes, it holds <code>&amp;v%!(EXTRA *mystruct.Mystruct=&amp;{0      })</code>, for clarification, the API checks for <code>req.FormValue()</code> to get values."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1537881940, "post_id": 52498880, "comment_id": 91939198, "body": "@JeffreyAnderson why you are using <code>bytes.NewBuffer</code> since the parsseData returned from the marshal is itself in bytes so you can send them directly check my updated code also print the data as <code>fmt.Println(string(parseData))</code> to see if it contains the data."}, {"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1537882025, "post_id": 52498880, "comment_id": 91939273, "body": "It contains the data. I cannot pass <code>parsedData</code> to the request: <code>cannot use parsedData (variable of type []byte) as io.Reader value in argument to http.NewRequest: missing method Read </code>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1537882445, "post_id": 52498880, "comment_id": 91939567, "body": "@JeffreyAnderson yes I get it you need to implement io.reader for which you have used <code>bytes.NewBuffer</code>. Try to check the status of the response along with that the body of the response. Also since you have said that due to sending bytes your data is changed that is not possible. Since you are just converting your struct to json. So you should check you data before sending."}, {"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1537882586, "post_id": 52498880, "comment_id": 91939643, "body": "The body is empty (unless I decode it like so <code>json.NewDecoder(response.Body).Decode(&amp;j)</code>, then it returns the error messages about field X being empty etc) and the status is 400 (as expected, that is what the API returns when a field is missing)"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1537882884, "post_id": 52498880, "comment_id": 91939863, "body": "@JeffreyAnderson you are going right now all you have to do is check for which field is empty and why it is going empty. So try to check you data before sending and if you have problem regarding creating the buffer then flush the buffer before sending to check if it contains the data."}, {"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1537883015, "post_id": 52498880, "comment_id": 91939951, "body": "No field in the data that being sent is empty. I&#39;m sending bytes when it expects an object, content-type does not change that. I printed the entire request that the API receieves, and nothing there is present because bytes."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 3, "last_activity_date": 1537953697, "last_edit_date": 1537953697, "creation_date": 1537880549, "answer_id": 52498880, "question_id": 52498762, "link": "https://stackoverflow.com/questions/52498762/how-to-send-new-request-with-object-instead-of-bytes/52498880#52498880", "title": "How to send new request with object instead of bytes?", "body": "<p>You are setting the content type to <code>application/x-www-form-urlencoded</code> while you are sending the data in json format, so change your content-type when setting the request headers, along with that do not skip the error to check what is the error returned:</p>\n\n<pre><code>parsedData, err := json.Marshal(data)\nif err != nil{\n    fmt.Println(err)\n}\nreq, err := http.NewRequest(method, url, parsedData) // send the parseData which are bytes returned from the marshal.\nif err != nil{\n    fmt.Println(err)\n}\nreq.Header.Set(\"Content-Type\", \"application/json\") // set the content type to json\n\ngo func() { // Must be a goroutine\n    response, err := client.Do(req)\n    if err != nil{\n        fmt.Println(err)\n    }\n    defer response.Body.Close()\n}()\n\n// you should check for response status to verify the details as\nfmt.Println(\"response Status:\", response.Status)\nfmt.Println(\"response Headers:\", response.Header)\nbody, _ := ioutil.ReadAll(response.Body)\nfmt.Println(\"response Body:\", string(body))\n</code></pre>\n\n<p>One thing that should be taken into consideration is that you have not exported your struct fields. That can be the reason your json string becomes empty. Make your struct fields exportable by making their first letter of each field in caps.</p>\n"}, {"tags": [], "owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "is_accepted": false, "score": 0, "last_activity_date": 1537883687, "creation_date": 1537883687, "answer_id": 52499949, "question_id": 52498762, "link": "https://stackoverflow.com/questions/52498762/how-to-send-new-request-with-object-instead-of-bytes/52499949#52499949", "title": "How to send new request with object instead of bytes?", "body": "<p>I solved this using the <code>\"net/url\"</code> package.</p>\n\n<pre><code>data := url.Values{}\n\nfor value := range inputs {\n    // Append all values from the inputs to a new array, with the key named by the input name attribute\n    if inputs[value] != nil &amp;&amp; inputs[value].(*dom.HTMLInputElement).Value != \"\" {\n        data.Add(inputs[value].(*dom.HTMLInputElement).Name, inputs[value].(*dom.HTMLInputElement).Value)\n    }\n}\n\nreq, _ := http.NewRequest(method, actionUrl, strings.NewReader(data.Encode()))\nreq.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1537953697, "creation_date": 1537880178, "question_id": 52498762, "link": "https://stackoverflow.com/questions/52498762/how-to-send-new-request-with-object-instead-of-bytes", "title": "How to send new request with object instead of bytes?", "body": "<p>I need to send an object of data e.g. <code>{hello: \"world\", goodbye: \"world\"}</code> to an API. I'm doing it like this right now:</p>\n\n<pre><code>inputs := form.GetElementsByTagName(\"input\")\n\nvar data = make(map[string]interface{}) // after adding values this looks like this: {hello: \"world\", goodbye: \"world\"}\n\nfor value := range inputs {\n    // Append all values from the inputs to a new array, with the key named by the input name attribute\n    if inputs[value] != nil &amp;&amp; inputs[value].(*dom.HTMLInputElement).Value != \"\" {\n        data[inputs[value].(*dom.HTMLInputElement).Name] = inputs[value].(*dom.HTMLInputElement).Value\n    }\n}\n\nparsedData, _ := json.Marshal(data)\nreq, _ := http.NewRequest(method, url, bytes.NewBuffer(parsedData))\n\nreq.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n\nclient := &amp;http.Client{}\ngo func() { // Must be a goroutine\n    response, _ := client.Do(req)\n    defer response.Body.Close()\n}()\n</code></pre>\n\n<p>The problem I'm having is since we're sending it as a byte, the server always returns error responses as it's expecting to deal with an object.</p>\n\n<p>How can I make sure it's sending an object instead of bytes?</p>\n"}, {"tags": ["elasticsearch", "go"], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": true, "score": 2, "last_activity_date": 1537883138, "creation_date": 1537883138, "answer_id": 52499747, "question_id": 52498734, "link": "https://stackoverflow.com/questions/52498734/go-elastic-client-have-to-wait-some-time-before-run-query/52499747#52499747", "title": "Go elastic client: have to wait some time before run query", "body": "<p>You probably want to use the Refresh API see <a href=\"https://github.com/olivere/elastic/blob/release-branch.v6/indices_refresh.go\" rel=\"nofollow noreferrer\">https://github.com/olivere/elastic/blob/release-branch.v6/indices_refresh.go</a></p>\n\n<p>The insertion is real time but the indexes that the get uses are not</p>\n"}, {"tags": [], "owner": {"reputation": 25901, "user_id": 493928, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ce109c88210d5c36c957082ddfe92d16?s=128&d=identicon&r=PG", "display_name": "khachik", "link": "https://stackoverflow.com/users/493928/khachik"}, "is_accepted": false, "score": 1, "last_activity_date": 1537883808, "creation_date": 1537883808, "answer_id": 52499995, "question_id": 52498734, "link": "https://stackoverflow.com/questions/52498734/go-elastic-client-have-to-wait-some-time-before-run-query/52499995#52499995", "title": "Go elastic client: have to wait some time before run query", "body": "<p>You can:</p>\n\n<ul>\n<li>request immediate refresh</li>\n<li>wait until it is refreshed (scheduled refresh or another on-demand refresh)</li>\n</ul>\n\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-refresh.html\" rel=\"nofollow noreferrer\">https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-refresh.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 17097, "user_id": 672689, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IPnRU.png?s=128&g=1", "display_name": "Roee Gavirel", "link": "https://stackoverflow.com/users/672689/roee-gavirel"}, "is_accepted": false, "score": 1, "last_activity_date": 1537883908, "creation_date": 1537883908, "answer_id": 52500017, "question_id": 52498734, "link": "https://stackoverflow.com/questions/52498734/go-elastic-client-have-to-wait-some-time-before-run-query/52500017#52500017", "title": "Go elastic client: have to wait some time before run query", "body": "<p>This is related to the ES behaviour and has nothing to do with the GO client.</p>\n\n<p>The ES doesn't index document immediately as they are added to the index (the default is every 1 second if I remember correctly). You can increase the index rate in the ES, and that would be good for development but in production and with high load on the ES that may result in degradation of the performance.</p>\n\n<p>It is called the refresh_interval and you can read more about it in <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-update-settings.html\" rel=\"nofollow noreferrer\">the documentation</a></p>\n"}], "owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 52499747, "answer_count": 3, "score": 3, "last_activity_date": 1537883908, "creation_date": 1537880098, "question_id": 52498734, "link": "https://stackoverflow.com/questions/52498734/go-elastic-client-have-to-wait-some-time-before-run-query", "title": "Go elastic client: have to wait some time before run query", "body": "<p>I use <a href=\"http://github.com/olivere/elastic\" rel=\"nofollow noreferrer\">olivere elastic library</a> to connect to elastic.\nSo I have one client, connect with it, add a few documents.\nThen I have another client that make search. But I have to wait about seconds cause immediate response is empty</p>\n\n<pre><code>_, err := client.Index().\n    Index(elasticTemplateName).\n    Type(elasticType).\n    Id(myID).\n    BodyJson(myJson).\n    Do(ctx)\nrequire.NoError(t, err)\n\n// wait cause of async elastic client\ntime.Sleep(1000 * time.Millisecond)\n\nresult, err := anotherClient.Search().Index(IndexName).SearchSource(searchSource).Do(ctx)\n</code></pre>\n\n<p>another client:</p>\n\n<pre><code>client, err := elastic.NewClient(\n    elastic.SetURL(\n        conf.Hosts...\n    ),\n    elastic.SetSniff(false),\n)\n</code></pre>\n"}, {"tags": ["go", "concurrency"], "answers": [{"comments": [{"owner": {"reputation": 1561, "user_id": 1340439, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4b9aa7c3409a4c7187b514eb101d8f32?s=128&d=identicon&r=PG", "display_name": "Karesh A", "link": "https://stackoverflow.com/users/1340439/karesh-a"}, "edited": false, "score": 0, "creation_date": 1537885003, "post_id": 52499206, "comment_id": 91941230, "body": "Thanks. Is there any way we can try using channels without waitgroup ?"}, {"owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "reply_to_user": {"reputation": 1561, "user_id": 1340439, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4b9aa7c3409a4c7187b514eb101d8f32?s=128&d=identicon&r=PG", "display_name": "Karesh A", "link": "https://stackoverflow.com/users/1340439/karesh-a"}, "edited": false, "score": 0, "creation_date": 1537891162, "post_id": 52499206, "comment_id": 91945224, "body": "Sure, you can implement your own waiting logic but why bother reinventing the wheel? Why do you <i>need</i> to use channels here? There is no need for the asynchronicity they provide. In the example you provided, they just complicate the code and create a maintenance overhead with no benefit."}], "tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": false, "score": 5, "last_activity_date": 1537882229, "last_edit_date": 1537882229, "creation_date": 1537881522, "answer_id": 52499206, "question_id": 52498618, "link": "https://stackoverflow.com/questions/52498618/golang-making-concurrent-request-and-combine-respone/52499206#52499206", "title": "golang making concurrent request and combine respone", "body": "<p>There's a <a href=\"https://en.wikipedia.org/wiki/Race_condition\" rel=\"nofollow noreferrer\">race condition</a> in your code.</p>\n\n<p>There is no barrier to ensure the goroutines in the <code>profile</code> method which read from <code>uChan</code> and <code>rChan</code> have populated the variables <code>meResp</code> and <code>ratingResp</code> <em>before</em> you return from <code>profile</code>.</p>\n\n<p>You can simplify your code immensely by dropping the use of channels and the inline declared goroutines in <code>profile</code>. Instead, simply populate the response values directly. There is no benefit provided by using channels or goroutines to read from them in this circumstance as you only intend to send one value and you have a requirement that the values produced by both HTTP calls are present before returning.</p>\n\n<p>You might do this by modifying the signature of <code>me</code> and <code>rate</code> to receive a pointer to the location to write their output, or by wrapping their calls with a small function which receives their output value and populates the value in <code>profile</code>. Importantly, the <code>WaitGroup</code> should only be signalled <em>after</em> the value has been populated:</p>\n\n<pre><code>wgcall := &amp;sync.WaitGroup{}\n\nvar meResp UserMe\nvar ratingResp RatingMe\n\nwgcall.Add(2)\n// The \"me\" and \"rate\" functions should be refactored to\n// drop the wait group and channel arguments.\ngo func() {\n    meResp = me(req)\n    wgcall.Done()\n}()\ngo func() {\n    ratingResp = rate(req)\n    wgcall.Done()\n}()\nwgcall.Wait()\n\n// You are guaranteed that if \"me\" and \"rate\" returned valid values,\n// they are populated in \"meResp\" and \"ratingResp\" at this point.\n\n// Do whatever you need here, such as logging or returning.\n</code></pre>\n"}], "owner": {"reputation": 1561, "user_id": 1340439, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4b9aa7c3409a4c7187b514eb101d8f32?s=128&d=identicon&r=PG", "display_name": "Karesh A", "link": "https://stackoverflow.com/users/1340439/karesh-a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1039, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1537882229, "creation_date": 1537879704, "question_id": 52498618, "link": "https://stackoverflow.com/questions/52498618/golang-making-concurrent-request-and-combine-respone", "title": "golang making concurrent request and combine respone", "body": "<p>I have written go code to call multiple http request independently and combine the results.</p>\n\n<p>Sometime values are missing on combined method. </p>\n\n<pre><code>func profile(req *http.Request)  (UserMe, error, UserRating, error) {\n\n    wgcall := &amp;sync.WaitGroup{}\n\n    uChan := make(chan ResUser)\n    rChan := make(chan ResRating)\n\n        // variable inits\n    var meResp UserMe\n    var ratingResp UserRating\n\n    go func() {\n        res := &lt;-uChan\n                meResp = res.Value\n    }()\n\n    go func() {\n        res := &lt;-rChan\n                ratingResp = res.Value\n    }()\n\n    wgcall.Add(2)\n    go me(req, wgcall, uChan)\n    go rate(req, wgcall, rChan)\n\n    wgcall.Wait()\n\n    logrus.Info(meResp)  // sometimes missing\n    logrus.Info(ratingResp) // sometimes missing\n\n    return meResp, meErr, ratingResp, ratingErr\n}\n</code></pre>\n\n<p>But the me and rating calls returns the values from api requests as expected.</p>\n\n<pre><code>func me(req *http.Request, wg *sync.WaitGroup, ch chan ResUser) {\n    defer wg.Done()\n\n    // http call return value correclty\n    me := ...\n    ch &lt;- ResUser{\n        Value := // value from rest\n    }\n    logrus.Info(fmt.Sprintf(\"User calls  %v\" , me))  // always return the values\n    close(ch)\n}\n\nfunc rate(req *http.Request, wg *sync.WaitGroup, ch chan ResRating) {\n    defer wg.Done()\n\n        // make http call\n    rating := ...\n    ch &lt;- ResRating{\n        Value := // value from rest\n    }\n    logrus.Info(fmt.Sprintf(\"Ratings calls %v\" , rating)) // always return the values\n\n    close(ch)\n}\n</code></pre>\n\n<p>Issue is: meResp and ratingResp on profile function not getting the values always. sometime only meResp or ratingResp, sometimes both as expected.</p>\n\n<p>But me and rate function calls getting values always.</p>\n\n<p>Can help me fix this plz ?</p>\n"}, {"tags": ["go", "webserver"], "comments": [{"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 1, "creation_date": 1537879773, "post_id": 52498519, "comment_id": 91937703, "body": "would a heaertbeat script not be good here? a simple script that checks if your important go code is still running."}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1537881175, "post_id": 52498519, "comment_id": 91938625, "body": "i do not know any integrated toold for this, the last time i need to check if i process was a live i wrote a go script to look at all process id&#39;s and the names associated with it. if the code that needed to run was not active it would start it using the command line"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1537881797, "post_id": 52498519, "comment_id": 91939101, "body": "Recommending third-party tools is off-topic for StackOverflow."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1537881925, "post_id": 52498519, "comment_id": 91939188, "body": "Most OS offer some way to ensure a service is running. On Windows, this would be a Windows Service. On Linux, process managers like systemd et al can ensure a process is restarted if it crashes. A simple shell script could do the same on any OS. If your question is more than just how to keep a service running, please edit your question to clarify your intentions."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1537882266, "post_id": 52498519, "comment_id": 91939431, "body": "Sorry, I&#39;m not saying it&#39;s off-topic as it relates to your situation, I&#39;m saying it&#39;s not permitted on this site: <i>Questions asking us to recommend or find a book, tool, software library, tutorial or other off-site resource are off-topic for Stack Overflow as they tend to attract opinionated answers and spam.</i> See <a href=\"https://stackoverflow.com/help/on-topic\">What topics can I ask about here?</a>"}, {"owner": {"reputation": 228, "user_id": 8567993, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VMUkS.jpg?s=128&g=1", "display_name": "Mehdi", "link": "https://stackoverflow.com/users/8567993/mehdi"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1537882428, "post_id": 52498519, "comment_id": 91939558, "body": "@Adrian when a service crashes and is reloaded by OS we lose time and uptime will be less than 100%"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1537882550, "post_id": 52498519, "comment_id": 91939623, "body": "On that instance, yes. And no matter what you do, any requests in-flight will fail when it crashes. You want to avoid crashes first and foremost, and generally you increase uptime by increasing the number of machines hosting a service, behind a load balancer, not by trying to run &quot;spare&quot; processes of the service on the same machine, which is unlikely to prove successful."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1537885549, "post_id": 52498519, "comment_id": 91941607, "body": "Python does that precisely because the language does not have anything like goroutines. You don&#39;t need to do anything special in Go to get this behavior; it&#39;s built in to net/http."}], "answers": [{"tags": [], "owner": {"reputation": 141, "user_id": 8127284, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P4qAf.jpg?s=128&g=1", "display_name": "Shane Tyler Malachow", "link": "https://stackoverflow.com/users/8127284/shane-tyler-malachow"}, "is_accepted": true, "score": 1, "last_activity_date": 1537893408, "creation_date": 1537893408, "answer_id": 52502975, "question_id": 52498519, "link": "https://stackoverflow.com/questions/52498519/how-to-run-multiple-instances-of-one-go-application/52502975#52502975", "title": "How to run multiple instances of one GO application?", "body": "<p>As people have stated prior, you'll want to have various instances running to help decrease downtime. Theoretically multiple instances on the same server will prevent most of the software crashing downtime. If you're worried about hardware failure, you'll want multiple servers running with some loadbalancer/proxy handling the request. Things like nginx or haproxy will provide that.</p>\n\n<p>You may also want to consider containerization for this. Containerization allows you to easily run multiple software instances of your application, and it'll be easy to ensure you have the number you want. Kubernetes and related apps will improve this reliability even further, and give you clustering. </p>\n"}], "owner": {"reputation": 228, "user_id": 8567993, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VMUkS.jpg?s=128&g=1", "display_name": "Mehdi", "link": "https://stackoverflow.com/users/8567993/mehdi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 919, "favorite_count": 0, "accepted_answer_id": 52502975, "answer_count": 1, "score": 1, "last_activity_date": 1537893408, "creation_date": 1537879351, "question_id": 52498519, "link": "https://stackoverflow.com/questions/52498519/how-to-run-multiple-instances-of-one-go-application", "title": "How to run multiple instances of one GO application?", "body": "<p>In python, you may have uwsgi application server run multiple instances of your application at the same time.</p>\n\n<p>The problem is not about load-balancing incoming requests in which goroutines do best. You can have many goroutines run concurrently but until the main app is alive. If the app crashes no goroutines are there to process any task.</p>\n\n<p><strong>My question is</strong>: how we can run multiple instances of one go app at the same time?. If the problem is solved in another way by Go, what is that?</p>\n"}, {"tags": ["go", "platform"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1537888161, "last_edit_date": 1537888161, "creation_date": 1537879127, "answer_id": 52498436, "question_id": 52498435, "link": "https://stackoverflow.com/questions/52498435/how-to-access-platform-specific-package-documentation/52498436#52498436", "title": "How to access platform specific package documentation?", "body": "<h2>1. Online</h2>\n\n<p>Online, platform specific documentation can be accessed on the official Go home page, by appending the <code>GOOS</code> and <code>GOARCH</code> query parameters, similar to the environment variables.</p>\n\n<p>For example, to access the <code>syscall</code> package documentation for Windows 64-bit platform, visit:</p>\n\n<p><a href=\"https://golang.org/pkg/syscall/?GOOS=windows&amp;GOACH=amd64\" rel=\"nofollow noreferrer\">https://golang.org/pkg/syscall/?GOOS=windows&amp;GOACH=amd64</a></p>\n\n<p>To quickly verify that it works, search for the <code>type DLL</code> phrase (or simply <code>DLL</code>), as those don't appear on linux's syscall package.</p>\n\n<h2>2. Offline</h2>\n\n<p>The go tool has default target platform and architecture which can be overridden with the <code>GOOS</code> and <code>GOARCH</code> environment variables. So by default <code>go doc syscall</code> will show package documentation for the default platform and architecture.</p>\n\n<p>To get doc for other platforms and / or architectures, all we need to do is change those environment variables.</p>\n\n<p>On unix systems (e.g. linux, OS-X), we can simply prepend the <code>go doc</code> command with the new platform / architecture we're interested in, e.g. package doc of <code>syscall</code> for Windows (executed on Linux):</p>\n\n<pre><code>GOOS=windows go doc syscall\n</code></pre>\n\n<p>And that's all it takes. To quickly check if it works, print the <code>DLL</code> type and its methods:</p>\n\n<pre><code>GOOS=windows go doc syscall DLL\n</code></pre>\n\n<p>Example output:</p>\n\n<pre><code>type DLL struct {\n    Name   string\n    Handle Handle\n}\n    A DLL implements access to a single DLL.\n\n\nfunc MustLoadDLL(name string) *DLL\nfunc (d *DLL) FindProc(name string) (proc *Proc, err error)\nfunc (d *DLL) MustFindProc(name string) *Proc\nfunc (d *DLL) Release() (err error)\n</code></pre>\n\n<p>This is documented in the <code>syscall</code> package:</p>\n\n<blockquote>\n  <p>The details vary depending on the underlying system, and by default, godoc will display the syscall documentation for the current system. If you want godoc to display syscall documentation for another system, set $GOOS and $GOARCH to the desired system. For example, if you want to view documentation for freebsd/arm on linux/amd64, set $GOOS to freebsd and $GOARCH to arm.</p>\n</blockquote>\n"}], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 2, "accepted_answer_id": 52498436, "answer_count": 1, "score": 4, "last_activity_date": 1537888161, "creation_date": 1537879127, "last_edit_date": 1537879539, "question_id": 52498435, "link": "https://stackoverflow.com/questions/52498435/how-to-access-platform-specific-package-documentation", "title": "How to access platform specific package documentation?", "body": "<p>We can access Go's package documentation online on the official website:</p>\n\n<p><a href=\"https://golang.org/pkg/\" rel=\"noreferrer\">https://golang.org/pkg/</a></p>\n\n<p>This only contains the package documentation available on the <code>linux</code> platform (<code>GOOS</code>), <code>amd64</code> archicture (<code>GOARCH</code>).</p>\n\n<p>Or offline via the <code>go doc</code> command, e.g package doc of the <a href=\"https://golang.org/pkg/syscall/\" rel=\"noreferrer\"><code>syscall</code></a> package.</p>\n\n<pre><code>go doc syscall\n</code></pre>\n\n<p>This shows documentation for the platform of the Go SDK.</p>\n\n<p>Some packages have different API based on the platform we target, most famous is the <code>syscall</code> package.</p>\n\n<p>How can we access platform specific package documentation online and offline?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 322, "user_id": 8399906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4b20fa1357bb11e0ba2eab0d5b358ed?s=128&d=identicon&r=PG", "display_name": "CJW", "link": "https://stackoverflow.com/users/8399906/cjw"}, "edited": false, "score": 0, "creation_date": 1537875665, "post_id": 52496944, "comment_id": 91934937, "body": "Thanks for the answer! When trying to implement the bytes.Buffer I get the following error:  <code>cannot use &amp;out (type **bytes.Buffer) as type io.Writer in assignment: **bytes.Buffer does not implement io.Writer (missing Write method)</code> Any idea what is causing this?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 322, "user_id": 8399906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4b20fa1357bb11e0ba2eab0d5b358ed?s=128&d=identicon&r=PG", "display_name": "CJW", "link": "https://stackoverflow.com/users/8399906/cjw"}, "edited": false, "score": 0, "creation_date": 1537877240, "post_id": 52496944, "comment_id": 91935973, "body": "@CJW I typoed. There was an <code>&amp;</code> before the <code>out</code>, which should not be there."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 4, "last_activity_date": 1537877183, "last_edit_date": 1537877183, "creation_date": 1537874351, "answer_id": 52496944, "question_id": 52496395, "link": "https://stackoverflow.com/questions/52496395/save-stdout-to-variable-when-using-stdoutpipe/52496944#52496944", "title": "Save Stdout to variable when using StdoutPipe", "body": "<p>You can assign any <code>io.Writer</code> to a <code>Stdout</code>. So if you want to get the output stored into a variable, the easiest way might be:</p>\n\n<pre><code>out := &amp;bytes.Buffer{}\nc4.Stdout = out\n</code></pre>\n\n<p>Then the output is stored in out, which can be get by calling <code>out.Bytes()</code> or <code>out.String()</code> depending on you want a <code>[]byte</code> or a <code>string</code>.</p>\n\n<p>To also have the output streamed to the screen, <code>io.MultiWriter</code> can help. It writes to all given writer when a write is called. So you can do this:</p>\n\n<pre><code>out := &amp;bytes.Buffer{}\nc4.Stdout = io.MultiWriter(out, os.Stdout)\n</code></pre>\n"}], "owner": {"reputation": 322, "user_id": 8399906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4b20fa1357bb11e0ba2eab0d5b358ed?s=128&d=identicon&r=PG", "display_name": "CJW", "link": "https://stackoverflow.com/users/8399906/cjw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1537878501, "creation_date": 1537872630, "last_edit_date": 1537878501, "question_id": 52496395, "link": "https://stackoverflow.com/questions/52496395/save-stdout-to-variable-when-using-stdoutpipe", "title": "Save Stdout to variable when using StdoutPipe", "body": "<p>I am trying to use Go to run commands that contain a pipe, and then save the output of the command to a variable to be used later. The code below will retrieve the file name of the latest file to be uploaded to Amazon S3 and output it to the terminal. The point of this is so that the file name can be used later to generate the item.Key: </p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    c1 := exec.Command(\"aws\", \"s3\", \"ls\", \"bucket\", \"--recursive\")\n    c2 := exec.Command(\"sort\")\n    c3 := exec.Command(\"tail\", \"-n\", \"1\")\n    c4 := exec.Command(\"awk\", \"{print $4}\")\n    c2.Stdin, _ = c1.StdoutPipe()\n    c3.Stdin, _ = c2.StdoutPipe()\n    c4.Stdin, _ = c3.StdoutPipe()\n    c4.Stdout = os.Stdout\n    _ = c4.Start()\n    _ = c3.Start()\n    _ = c2.Start()\n    _ = c1.Run()\n    _ = c2.Wait()\n    _ = c3.Wait()\n    _ = c4.Wait()\n}\n</code></pre>\n\n<p>Instead of/as well as outputting the file name to the terminal I would like to save the output to a variable.</p>\n\n<p>Would anyone know where to start with this?</p>\n"}, {"tags": ["debugging", "go"], "answers": [{"tags": [], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "is_accepted": false, "score": 1, "last_activity_date": 1574612794, "creation_date": 1574612794, "answer_id": 59019836, "question_id": 52496204, "link": "https://stackoverflow.com/questions/52496204/making-sense-of-time-time-values-when-debugging-in-delve/59019836#59019836", "title": "Making sense of `time.Time` values when debugging in Delve", "body": "<p>It looks like <a href=\"https://github.com/go-delve/delve/issues/999\" rel=\"nofollow noreferrer\">the issue</a> adding the functionality you're wanting has been closed.</p>\n\n<blockquote>\n  <p>Closing, you can instead call methods on the time value to format via\n  the call t.Format(...) or call t.String().</p>\n</blockquote>\n"}], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 691, "favorite_count": 1, "answer_count": 1, "score": 12, "last_activity_date": 1574612794, "creation_date": 1537871981, "last_edit_date": 1537874328, "question_id": 52496204, "link": "https://stackoverflow.com/questions/52496204/making-sense-of-time-time-values-when-debugging-in-delve", "title": "Making sense of `time.Time` values when debugging in Delve", "body": "<p>When debugging a program that processes <code>time.Time</code> values, I need to be able to print the values and make sense of them.  In Delve, if I print a variable of type <code>time.Time</code> it prints the internal structure of the object, and does not allow me to run <code>time.Time</code> methods on the object.  </p>\n\n<p>How do I makes sense of this structure and translate it to my normal understanding of what would be printed by the <code>Unix()</code>, <code>UnixNano()</code>, or <code>String()</code> functions.</p>\n\n<p>For example:</p>\n\n<pre><code>$ dlv test\n(dlv) b calendar.go:200\n(dlv) p appt\ntime.Time {\nwall: 0,\next: 63673770600,\nloc: *time.Location {\n    name: \"Local\",\n    zone: []time.zone len: 4, cap: 4, [\n        (*time.zone)(0xc0000a8100),\n    ],\n    tx: []time.zoneTrans len: 235, cap: 235, [\n        (*time.zoneTrans)(0xc0000bb000),\n        ...+171 more\n    ],\n    cacheStart: 1520751600,\n    cacheEnd: 1541311200,\n    cacheZone: *(*time.zone)(0xc0000a8100),},}\n</code></pre>\n\n<p>Or in the case of a list of values:</p>\n\n<pre><code>(dlv) p dates\n[]time.Time len: 2, cap: 2, [\n{\n    wall: 0,\n    ext: 63673689600,\n    loc: *(*time.Location)(0xc00008e9c0),},\n{\n    wall: 0,\n    ext: 63673776000,\n    loc: *(*time.Location)(0xc00008ea80),},\n]\n</code></pre>\n\n<p>I found <a href=\"https://github.com/derekparker/delve/issues/999\" rel=\"noreferrer\">a github ticket to add pretty-printing of <code>time.Time</code> values</a> to Delve.  Until that is approved and released, what can I do to make sense of these values and translate them to a more readable form?</p>\n\n<p>As a workaround, I considered adding new variables of string type that I would update (as needed) with the output of <code>.String()</code> or <code>.Format(...)</code>.  Is there a better alternative?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1537869207, "post_id": 52495295, "comment_id": 91931065, "body": "Have you looked at <a href=\"https://godoc.org/github.com/lib/pq#Int64Array\" rel=\"nofollow noreferrer\">godoc.org/github.com/lib/pq#Int64Array</a>?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1537869384, "post_id": 52495295, "comment_id": 91931177, "body": "... my bad, the array types won&#39;t work with <code>IN</code> but you could use them with <code>ANY</code>, like so <code>WHERE parent_id = ANY ($1)</code>. (<a href=\"https://github.com/lib/pq/blob/90697d60dd844d5ef6ff15135d0203f65d2f53b8/array.go#L22\" rel=\"nofollow noreferrer\">github.com/lib/pq/blob/90697d60dd844d5ef6ff15135d0203f65d2f&zwnj;&#8203;53b8/&hellip;</a>)"}], "owner": {"reputation": 4103, "user_id": 162358, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/I2kN6.jpg?s=128&g=1", "display_name": "Keith John Hutchison", "link": "https://stackoverflow.com/users/162358/keith-john-hutchison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "closed_date": 1537869960, "answer_count": 0, "score": 0, "last_activity_date": 1537869097, "creation_date": 1537869097, "question_id": 52495295, "link": "https://stackoverflow.com/questions/52495295/im-looking-for-a-way-to-pass-in-either-a-slice-of-int-or-a-comma-delimited-stri", "closed_reason": "Duplicate", "title": "I&#39;m looking for a way to pass in either a slice of int or a comma delimited string into a database/sql &#39;in&#39; query", "body": "<p>I'm aiming to get a list of related child records to returned for a set of parent records.</p>\n\n<p>Using SQL the following works</p>\n\n<pre><code>SELECT id FROM children WHERE parent_id IN ( \n    19036,19037\n)\n</code></pre>\n\n<p>Using golang I'm getting the following errors.</p>\n\n<p>When using a comma separated string</p>\n\n<pre><code>import (\n    \"database/sql\"\n    \"github.com/lib/pq\"\n)\n// db is a valid XODB struct generated from https://github.com/xo/xo\n\nvar ids []string{\"19036\",\"19037\"}\n\nconst sqlstr = `SELECT ` +\n    `id ` +  \n    `FROM children ` +\n    `WHERE parent_id in ($1) `\n\nq, err := db.Query(sqlstr, strings.Join(ids, \",\"))\nif err != nil {\n    return nil, err\n}\n</code></pre>\n\n<p>results in pq: invalid input syntax for integer: \"19036,19037\"</p>\n\n<p>When using a slice of ints</p>\n\n<pre><code>var ids []int{19036,19037}\n\nconst sqlstr = `SELECT ` +\n    `id ` +  \n    `FROM children ` +\n    `WHERE parent_id in ($1) `\n\nq, err := db.Query(sqlstr, ids)\nif err != nil {\n    return nil, err\n}\n</code></pre>\n\n<p>results in sql: converting argument $1 type: unsupported type []int, a slice of int.</p>\n\n<p>Creating a sql string using fmt.Sprintf works</p>\n\n<pre><code>var ids []string{\"19036\",\"19037\"}\n\nvar sqlstr = `SELECT ` +\n    `id ` +  \n    `FROM children ` +\n    `WHERE parent_id in ($1) `\n\nsqlstr = fmt.Sprintf(sqlstr, strings.Join(ids, \",\"))\nq, err := db.Query(sqlstr)\nif err != nil {\n    return nil, err\n}\n</code></pre>\n\n<p>but I'm looking for a way to pass in either a slice of int or a comma delimited string into a database/sql 'in' query. How would you do that?</p>\n"}, {"tags": ["c", "windows", "go", "dll", "g++"], "comments": [{"owner": {"reputation": 6899, "user_id": 1212012, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gmBY7.png?s=128&g=1", "display_name": "Mathieu", "link": "https://stackoverflow.com/users/1212012/mathieu"}, "edited": false, "score": 0, "creation_date": 1537867167, "post_id": 52494518, "comment_id": 91929771, "body": "The problem may comes from the dll compiled for 32 bits system, while the go program is for 64 bits? Try adding <code>-m64</code> in <code>g++</code> invocation"}, {"owner": {"reputation": 6899, "user_id": 1212012, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gmBY7.png?s=128&g=1", "display_name": "Mathieu", "link": "https://stackoverflow.com/users/1212012/mathieu"}, "edited": false, "score": 0, "creation_date": 1537867228, "post_id": 52494518, "comment_id": 91929812, "body": "Please do not post image that contains text, instead, quote it in your question."}, {"owner": {"reputation": 27, "user_id": 8736013, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-QGLc3mCD17A/AAAAAAAAAAI/AAAAAAAABvI/l4xCcp1Lxto/photo.jpg?sz=128", "display_name": "Mohit", "link": "https://stackoverflow.com/users/8736013/mohit"}, "reply_to_user": {"reputation": 6899, "user_id": 1212012, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gmBY7.png?s=128&g=1", "display_name": "Mathieu", "link": "https://stackoverflow.com/users/1212012/mathieu"}, "edited": false, "score": 0, "creation_date": 1537867751, "post_id": 52494518, "comment_id": 91930149, "body": "@purplepsycho. Thank you for your reply , i compiled using &quot; g++ -m64 -shared -o helloWorld.dll helloWorld.o -Wl,--out-implib,libhelloWorld.a&quot; , it still gave me same error ."}, {"owner": {"reputation": 27, "user_id": 8736013, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-QGLc3mCD17A/AAAAAAAAAAI/AAAAAAAABvI/l4xCcp1Lxto/photo.jpg?sz=128", "display_name": "Mohit", "link": "https://stackoverflow.com/users/8736013/mohit"}, "reply_to_user": {"reputation": 6899, "user_id": 1212012, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gmBY7.png?s=128&g=1", "display_name": "Mathieu", "link": "https://stackoverflow.com/users/1212012/mathieu"}, "edited": false, "score": 0, "creation_date": 1537868092, "post_id": 52494518, "comment_id": 91930360, "body": "@Afshin , example.c was able to consume helloWorld.dll , but still , i tried compiling helloWorld.c with gcc after reading your comment. Thank you so much . it worked."}], "owner": {"reputation": 27, "user_id": 8736013, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-QGLc3mCD17A/AAAAAAAAAAI/AAAAAAAABvI/l4xCcp1Lxto/photo.jpg?sz=128", "display_name": "Mohit", "link": "https://stackoverflow.com/users/8736013/mohit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 883, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1537867471, "creation_date": 1537866730, "last_edit_date": 1537867471, "question_id": 52494518, "link": "https://stackoverflow.com/questions/52494518/creating-c-dll-and-using-it-in-golang", "title": "Creating C DLL and using it in Golang?", "body": "<p>I want to create DLL in C and use it in Golang. </p>\n\n<p>I used <a href=\"http://www.mingw.org/wiki/sampledll\" rel=\"nofollow noreferrer\">this tutorial</a> to generate dll :\nhelloWorld.h</p>\n\n<pre><code>#include&lt;stdio.h&gt;\nvoid __stdcall __declspec(dllexport) hello();\n</code></pre>\n\n<p>helloWorld.c</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include \"helloWorld.h\"\n__stdcall void hello()\n{\n    printf(\"Hello World !!\");\n}\n</code></pre>\n\n<p>I used this in command Prompt to compile it </p>\n\n<pre><code>g++ -c helloWorld.c\ng++ -shared -o helloWorld.dll helloWorld.o -Wl,--out-implib,libhelloWorld.a\n</code></pre>\n\n<p>I was able to use the generated dll in this C code , named as example.c :</p>\n\n<pre><code>#include&lt;stdio.h&gt;\n#include \"helloWorld.h\"\nint main()\n{\n    hello();\n}\n</code></pre>\n\n<p>and compile it using </p>\n\n<pre><code>g++ -c example.c\ng++ -o example.exe example.o -L. -lhelloWorld\n</code></pre>\n\n<p>But while using the DLL in Golang , i am getting error , please help me </p>\n\n<p>test.go</p>\n\n<pre><code>package main \n\n/*\n#cgo LDFLAGS: -L. -lhelloWorld\n#include \"helloWorld.h\"\n*/\nimport \"C\"\n\nfunc main(){\n\n    C.hello()\n}\n</code></pre>\n\n<p>Error :</p>\n\n<pre><code># command-line-arguments\nC:\\Users\\kumarmoh\\AppData\\Local\\Temp\\go-build544493490\\b001\\_x002.o: In function `_cgo_525f579e070a_Cfunc_hello':\n/tmp/go-build/cgo-gcc-prolog:40: undefined reference to `hello'\ncollect2.exe: error: ld returned 1 exit status \n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/z04QC.png\" rel=\"nofollow noreferrer\">error image</a></p>\n\n<p>Other info : </p>\n\n<ol>\n<li><p>go version go1.11 windows/amd64</p></li>\n<li><p>64-bit OS , x64-based processor , Windows 10</p></li>\n<li><p>I tried creating dll in Visual studios and it gave me error as <a href=\"https://stackoverflow.com/questions/30886645/mingw-w64-linker-skipping-incompatible-files-when-searching-for-third-party-stat\">explained here</a> .</p></li>\n</ol>\n"}, {"tags": ["go", "struct", "mutex"], "answers": [{"comments": [{"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1537869973, "post_id": 52495303, "comment_id": 91931551, "body": "I have a vague memory of there being an <code>Unlocker</code> interface as well. If so, maybe they merged the two, and added the extra function to <code>Locker</code>?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1537870274, "post_id": 52495303, "comment_id": 91931729, "body": "@FilipHaglund I doubt they removed <code>Unlocker</code>: it&#39;s not currently in the standard lib, and removing it would cause backward incompatibility (and hence breaking Go 1&#39;s compatibility promise). I added some links regarding <code>go vet</code> and <code>nocopy</code>."}, {"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1537875182, "post_id": 52495303, "comment_id": 91934660, "body": "Maybe the interface wasn&#39;t public before? Idk. Nice digging anyways, thanks for the answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1537872851, "last_edit_date": 1537872851, "creation_date": 1537869123, "answer_id": 52495303, "question_id": 52494458, "link": "https://stackoverflow.com/questions/52494458/nocopy-minimal-example/52495303#52495303", "title": "Nocopy minimal example?", "body": "<p>First, copying locks is properly detected by <code>go vet</code>. Example:</p>\n\n<pre><code>type My struct {\n    l sync.Mutex\n}\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>func main() {\n    m := My{}\n    m2 := m\n    fmt.Println(m2)\n}\n</code></pre>\n\n<p>Running <code>go vet</code>, the output is:</p>\n\n<pre><code>./play.go:25: assignment copies lock value to m2: main.My contains sync.Mutex\n./play.go:26: call of fmt.Println copies lock value: main.My contains sync.Mutex\n</code></pre>\n\n<p>So both cases (assigning and passing to <code>fmt.Println()</code>) were detected.</p>\n\n<p>This also means that the easiest way to make your struct a target of vet when copied, simply add a field of type <code>sync.Mutex</code>. This is a ready solution, although it consumes memory (<code>sync.Mutex</code> is not a zero-size struct). It doesn't matter whether you use this mutex or not (we didn't use it in the example above).</p>\n\n<p>In the discussion you referenced Rob Pike suggests to create a type:</p>\n\n<pre><code>type noCopy struct{}\nfunc (*noCopy) Lock() {}\n</code></pre>\n\n<p>And use a field of this type (either regular or embedded) to mark a struct non-copiable (and so make <code>go vet</code> scream if that happens).</p>\n\n<p>I don't know if this has ever worked, but currently it doesn't, because <code>go vet</code> checks for the <a href=\"https://golang.org/pkg/sync/#Locker\" rel=\"nofollow noreferrer\"><code>sync.Locker</code></a> interface, which also has an <code>Unlock()</code> method:</p>\n\n<pre><code>type Locker interface {\n        Lock()\n        Unlock()\n}\n</code></pre>\n\n<p>So if we create a <code>noCopy</code> type that implements <code>sync.Locker</code> (more precisely its pointer type), that will work:</p>\n\n<pre><code>type noCopy struct{}\n\nfunc (*noCopy) Lock()   {}\nfunc (*noCopy) Unlock() {}\n\ntype By struct {\n    noCopy noCopy\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>func main() {\n    b := By{}\n    b2 := b\n    fmt.Println(b2)\n}\n</code></pre>\n\n<p>Running <code>go vet</code>:</p>\n\n<pre><code>./play.go:29: assignment copies lock value to b2: main.By contains main.noCopy\n./play.go:30: call of fmt.Println copies lock value: main.By contains main.noCopy\n</code></pre>\n\n<p>Here are some changes related to <code>go vet</code> and <code>noCopy</code>:</p>\n\n<p><a href=\"https://golang.org/doc/go1.7#cmd_vet\" rel=\"nofollow noreferrer\">Go 1.7</a></p>\n\n<p><a href=\"https://golang.org/doc/go1.8#tool_vet\" rel=\"nofollow noreferrer\">Go 1.8</a></p>\n"}], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1180, "favorite_count": 1, "accepted_answer_id": 52495303, "answer_count": 1, "score": 3, "last_activity_date": 1537872970, "creation_date": 1537866509, "last_edit_date": 1537872970, "question_id": 52494458, "link": "https://stackoverflow.com/questions/52494458/nocopy-minimal-example", "title": "Nocopy minimal example?", "body": "<p>I've been trying to get a <code>noCopy</code> directive to work for one of my own structs, but I cannot get <code>go vet</code> to detect it. </p>\n\n<p>I can get it to detect copying of <code>sync.WaitGroup</code>, and <code>sync.Mutex</code>, but not my own struct. <a href=\"https://golang.org/src/cmd/vet/testdata/copylock.go\" rel=\"nofollow noreferrer\">This test file</a> in the vet source doesn't even trigger with my <code>go vet</code>. </p>\n\n<p>Or well, it finds some of the errors:</p>\n\n<pre><code># command-line-arguments\n./govet.go:56:6: no new variables on left side of :=\n./govet.go:110:17: unsafe.Sizeof(mu) evaluated but not used\n./govet.go:111:18: unsafe.Sizeof(mu) evaluated but not used\n./govet.go:112:10: unsafe.Sizeof(mu) evaluated but not used\n</code></pre>\n\n<p>but the copylock detection doesn't find anything.</p>\n\n<p>Did something change in <code>go vet</code> since <a href=\"https://github.com/golang/go/issues/8005#issuecomment-190753527\" rel=\"nofollow noreferrer\">this discussion</a> at 1.4? I'm running <code>go version go1.11 darwin/amd64</code>.</p>\n"}, {"tags": ["xml", "go", "struct", "xml-parsing"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1537861097, "post_id": 52492893, "comment_id": 91926454, "body": "The struct representing your config does not match the structure of the XML tree."}], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 7072729, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/9be68688b8d69616340b5958278fd359?s=128&d=identicon&r=PG&f=1", "display_name": "Vivek", "link": "https://stackoverflow.com/users/7072729/vivek"}, "edited": false, "score": 0, "creation_date": 1537866494, "post_id": 52493230, "comment_id": 91929355, "body": "Thanks, It helped."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1537862028, "creation_date": 1537862028, "answer_id": 52493230, "question_id": 52492893, "link": "https://stackoverflow.com/questions/52492893/xml-parsing-in-go-for-same-tags-under-different-parent-tag/52493230#52493230", "title": "XML parsing in Go for same tags under different parent tag", "body": "<p>You can use the <code>,any</code> tag option.</p>\n\n<pre><code>type root struct {\n    XMLName xml.Name     `xml:\"root\"`\n    Files   []ConfigFile `xml:\",any\"`\n}\n\ntype ConfigFile struct {\n    Configs []Config `xml:\"config\"`\n}\n\ntype Config struct {\n    Name        string `xml:\"name\"`\n    Value       string `xml:\"value\"`\n    Description string `xml:\"description\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/osaA5t5BnHi\" rel=\"nofollow noreferrer\">https://play.golang.org/p/osaA5t5BnHi</a></p>\n"}], "owner": {"reputation": 157, "user_id": 7072729, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/9be68688b8d69616340b5958278fd359?s=128&d=identicon&r=PG&f=1", "display_name": "Vivek", "link": "https://stackoverflow.com/users/7072729/vivek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 52493230, "answer_count": 1, "score": 1, "last_activity_date": 1537866326, "creation_date": 1537860833, "last_edit_date": 1537866326, "question_id": 52492893, "link": "https://stackoverflow.com/questions/52492893/xml-parsing-in-go-for-same-tags-under-different-parent-tag", "title": "XML parsing in Go for same tags under different parent tag", "body": "<p>I am new to Go, and I am trying to parse an XML file.  My goal is to get the values of all the config tags by making only one structure for them. Not a separate structure for each parent tag. Below is the XML file and what I have done.</p>\n\n<p>My XML file:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;root&gt;\n    &lt;TestFramework&gt;\n        &lt;config&gt;\n            &lt;name&gt;TEST_COMPONENT&lt;/name&gt;\n            &lt;value&gt;FILMS&lt;/value&gt;\n            &lt;description&gt;\n           Name of the test Films.\n            &lt;/description&gt;\n        &lt;/config&gt;\n        &lt;config&gt;\n            &lt;name&gt;TESTER_NAME&lt;/name&gt;\n            &lt;value&gt;abc@xyz.com&lt;/value&gt;\n            &lt;description&gt;\n            Name or email of the tester.\n            &lt;/description&gt;\n        &lt;/config&gt;\n    &lt;/TestFramework&gt;\n    &lt;Product&gt;\n        &lt;config&gt;\n            &lt;name&gt;PRODUCT_RELEASE&lt;/name&gt;\n            &lt;value&gt;2.1&lt;/value&gt;\n            &lt;description&gt;\n            Name or email of the tester.\n            &lt;/description&gt;\n        &lt;/config&gt;\n        &lt;config&gt;\n            &lt;name&gt;PRODUCT_BUILD&lt;/name&gt;\n            &lt;value&gt;7.1.3182018&lt;/value&gt;\n            &lt;description&gt;\n            Name or email of the tester.\n            &lt;/description&gt;\n        &lt;/config&gt;\n    &lt;/Product&gt;\n&lt;/root&gt;\n</code></pre>\n\n<p>My Go program:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n)\n\ntype ConfigFile struct {\n    Configs []Config `xml:\"config\"`\n}\n\ntype Config struct {\n    Name  string `xml:\"name\"`\n    Value string `xml:\"value\"`\n}\n\nfunc main() {\n    xmlFile, err := os.Open(\"octa_config.xml\")\n    m := make(map[string]string)\n    if err != nil {\n        fmt.Println(err)\n    }else {\n        fmt.Println(\"Successfully Opened octa_config.xml\")\n    }\n    defer xmlFile.Close()\n    byteValue, _ := ioutil.ReadAll(xmlFile)\n    var c ConfigFile\n    xml.Unmarshal(byteValue,&amp;c)\n    for i := 0; i &lt; len(c.Configs); i++ {\n        m[c.Configs[i].Name]=c.Configs[i].Value\n    }\n    for k,v :=range m{\n        fmt.Println( k,v)\n    }\n}\n</code></pre>\n\n<p>I know I can make a struct like this:</p>\n\n<pre><code>type TestFramework struct {\n    Configs []Config `xml:\"TestFramework&gt;config\"`\n}\n</code></pre>\n\n<p>But I don't want to use this:</p>\n\n<pre><code>`xml:\"TestFramework&gt;config\"`\n</code></pre>\n\n<p>I am getting output like this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>D:\\Go&gt;go run config_nim.go\nSuccessfully Opened octa_config.xml\n\nD:\\Go&gt;\n</code></pre>\n"}, {"tags": ["http", "go", "http-redirect"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 1, "creation_date": 1537860433, "post_id": 52492739, "comment_id": 91926105, "body": "You can&#39;t do it without involving a piece of javascript code on the client side."}, {"owner": {"reputation": 123, "user_id": 10403753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac3c22f960852374748c6e31028585c8?s=128&d=identicon&r=PG&f=1", "display_name": "Sam.L", "link": "https://stackoverflow.com/users/10403753/sam-l"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1537860626, "post_id": 52492739, "comment_id": 91926214, "body": "@\u0417\u0435\u043b\u0451\u043d\u044b\u0439 how It should look, like about what I need to search?"}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 10403753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac3c22f960852374748c6e31028585c8?s=128&d=identicon&r=PG&f=1", "display_name": "Sam.L", "link": "https://stackoverflow.com/users/10403753/sam-l"}, "edited": false, "score": 0, "creation_date": 1537863649, "post_id": 52492951, "comment_id": 91927779, "body": "Thanks for so detailed answer"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1537862347, "last_edit_date": 1537862347, "creation_date": 1537861035, "answer_id": 52492951, "question_id": 52492739, "link": "https://stackoverflow.com/questions/52492739/send-few-response-through-one-http-responsewriter/52492951#52492951", "title": "Send few response through one http.ResponseWriter", "body": "<p>You can't send data back with a redirect request, so here are 2 proposed alternatives.</p>\n\n<h2>Client side navigation</h2>\n\n<p>One option would be to send back a normal response with the message you want to show to the user, optionally with the URL to move to. After this, the client may do the navigation.</p>\n\n<p>This may be an AJAX request, and client side JavaScript can process the result, and act upon it: display the message, and navigate. Here are some ways for client side JavaScript navigation:</p>\n\n<pre><code>window.location = \"http://new-website.com\";\nwindow.location.href = \"http://new-website.com\";\nwindow.location.assign(\"http://new-website.com\");\nwindow.location.replace(\"http://new-website.com\");\n</code></pre>\n\n<h2>Encode message in URL as parameter</h2>\n\n<p>Another common way is to send a redirect, and encode the message in the new URL as a query parameter, such as:</p>\n\n<pre><code>newPath := \"/?msg=Hello\"\n</code></pre>\n\n<p>This is a simple example, but if the message is more complex, you have to escape it to get a valid path. For that, you may use <a href=\"https://golang.org/pkg/net/url/#QueryEscape\" rel=\"nofollow noreferrer\"><code>url.QueryEscape()</code></a> like this:</p>\n\n<pre><code>msg := \"Email didn't send\"\npath := \"/?msg=\" + url.QueryEscape(msg)\n</code></pre>\n\n<p>This would result in a path <code>/?msg=Email+didn%27t+send</code> (try it on the <a href=\"https://play.golang.org/p/Qu0CV3LA3E1\" rel=\"nofollow noreferrer\">Go Playground</a>). Another option would be to use <a href=\"https://golang.org/pkg/net/url/#URL\" rel=\"nofollow noreferrer\"><code>url.URL</code></a> and <a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"nofollow noreferrer\"><code>url.Values</code></a> to assemble the URL, for example:</p>\n\n<pre><code>values := url.Values{}\nvalues.Add(\"msg\", \"Email didn't send\")\n\nurl := &amp;url.URL{\n    Path:     \"/\",\n    RawQuery: values.Encode(),\n}\n\nfmt.Println(url)\n</code></pre>\n\n<p>The above prints (try it on the <a href=\"https://play.golang.org/p/gc0eIwYMD6L\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>/?msg=Email+didn%27t+send\n</code></pre>\n\n<p>Of course, the new page must handle that query parameter, e.g. use JavaScript to detect if in this case the <code>msg</code> query param exists, and if so, display it somehow to the user.</p>\n\n<p>Also note that you shouldn't use the <code>StatusMovedPermanently</code> code for this redirect, as that may be cached by browsers and proxies. Instead use <code>StatusFound</code>. This status code indicates to clients that the redirection is temporary and may change in the future, so if the client needs the original URL again, it will query the original again (and not the new one automatically).</p>\n"}], "owner": {"reputation": 123, "user_id": 10403753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac3c22f960852374748c6e31028585c8?s=128&d=identicon&r=PG&f=1", "display_name": "Sam.L", "link": "https://stackoverflow.com/users/10403753/sam-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 52492951, "answer_count": 1, "score": 0, "last_activity_date": 1537862347, "creation_date": 1537860241, "last_edit_date": 1537861669, "question_id": 52492739, "link": "https://stackoverflow.com/questions/52492739/send-few-response-through-one-http-responsewriter", "title": "Send few response through one http.ResponseWriter", "body": "<p>after I click on post button on frontend I receive data to my handler, create email and send it, but I want to inform user about status of email(sended or not) and redirect it back to main page. Problem is that I dont know how to pass <code>alert</code> and <code>redirecting to main page</code> at once.</p>\n\n<p>Here is a handler code:</p>\n\n<pre><code>func contactHandler(w http.ResponseWriter, r *http.Request) {\n    if r.Method == http.MethodPost {\n        r.ParseForm()\n        /* creating email */\n        err := smtp.SendMail(\"smtp.gmail.com:587\", smtp.PlainAuth(\"\", *emailFromLogin, *emailFromPassword, \"smtp.gmail.com\"), *emailFrom, []string{*emailTo}, []byte(msg))\n        http.Redirect(w, r, \"/\", http.StatusMovedPermanently)\n    }\n}\n</code></pre>\n\n<p>That what I want send to user before redirecting.</p>\n\n<pre><code>if err != nil {\n    fmt.Fprint(w, \"&lt;script&gt;Email didn't send&lt;script&gt;\")\n} else {\n    fmt.Fprint(w, \"&lt;script&gt;Email sent successfully&lt;script&gt;\")\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1555, "user_id": 1759834, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b1875929629d1cedce0405e41e2fa4d1?s=128&d=identicon&r=PG&f=1", "display_name": "Michael D.", "link": "https://stackoverflow.com/users/1759834/michael-d"}, "edited": false, "score": 0, "creation_date": 1537860954, "post_id": 52492362, "comment_id": 91926388, "body": "try <code>go get -u github.com&#47;golang&#47;example&#47;hello</code>. If this fails. Delete <code>example</code> directory in `d:\\gocode\\github.com\\golang`"}, {"owner": {"reputation": 4209, "user_id": 3165255, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qd87N.jpg?s=128&g=1", "display_name": "IronGeek", "link": "https://stackoverflow.com/users/3165255/irongeek"}, "edited": false, "score": 0, "creation_date": 1537861045, "post_id": 52492362, "comment_id": 91926432, "body": "Did you made some changes in the local downloaded package (<code>D:\\gocode\\src\\github.com\\golang\\example</code>)?"}, {"owner": {"reputation": 11, "user_id": 5946659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3fdc0bb38cf6b0869d9be88b4eba950?s=128&d=identicon&r=PG&f=1", "display_name": "parpande", "link": "https://stackoverflow.com/users/5946659/parpande"}, "edited": false, "score": 0, "creation_date": 1537942942, "post_id": 52492362, "comment_id": 91962222, "body": "Michael D  it did not work either :  &gt;go get -u github.com/golang/example/hello # cd .; git clone <a href=\"https://github.com/golang/example\" rel=\"nofollow noreferrer\">github.com/golang/example</a> D:\\gocode\\src\\github.com\\golang\\example Cloning into &#39;D:\\gocode\\src\\github.com\\golang\\example&#39;... fatal: unable to access &#39;<a href=\"https://github.com/golang/example/\" rel=\"nofollow noreferrer\">github.com/golang/example</a>&#39;: Failed to connect to github.com port 443: Timed out package github.com/golang/example/hello: exit status 128"}], "owner": {"reputation": 11, "user_id": 5946659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3fdc0bb38cf6b0869d9be88b4eba950?s=128&d=identicon&r=PG&f=1", "display_name": "parpande", "link": "https://stackoverflow.com/users/5946659/parpande"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1537859263, "creation_date": 1537858852, "last_edit_date": 1537859263, "question_id": 52492362, "link": "https://stackoverflow.com/questions/52492362/getting-the-error-i-used-git-config-global-unset-https-proxy-to-get-rid-of", "title": "Getting the error I used \u2018git config\u200a\u2014\u200aglobal\u200a\u2014\u200aunset https.proxy\u2019 to get rid of the error but it doesn&#39;t work", "body": "<p>I have installed go1.11/ windows amd64. I am testing the installation of GO</p>\n\n<p>I installed golang with recommended path for all env variables but getting the errors while issuing 'go get github.com/golang/example/hello' on the command prompt </p>\n\n<pre><code>&gt; `go get github.com/golang/example/hello\n&gt; # cd D:\\gocode\\src\\github.com\\golang\\example; git pull --ff-only There is no tracking information for the current branch. Please specify\n&gt; which branch you want to merge with. See git-pull(1) for details.\n&gt; \n&gt;     git pull &lt;remote&gt; &lt;branch&gt;\n&gt; \n&gt; If you wish to set tracking information for this branch you can do so\n&gt; with:\n&gt; \n&gt;     git branch --set-upstream-to=&lt;remote&gt;/&lt;branch&gt; master\n&gt; \n&gt; package github.com/golang/example/hello: exit status 1`\n</code></pre>\n\n<p>Below is my output of 'go env':</p>\n\n<blockquote>\n  <blockquote>\n    <p>go env set GOARCH=amd64 set GOBIN= set GOCACHE=C:\\Users\\parapand\\AppData\\Local\\go-build set GOEXE=.exe set\n    GOFLAGS= set GOHOSTARCH=amd64 set GOHOSTOS=windows set GOOS=windows\n    set GOPATH=D:\\gocode set GOPROXY= set GORACE= set GOROOT=C:\\Go set\n    GOTMPDIR= set GOTOOLDIR=C:\\Go\\pkg\\tool\\windows_amd64 set GCCGO=gccgo\n    set CC=gcc set CXX=g++ set CGO_ENABLED=1 set GOMOD= set CGO_CFLAGS=-g\n    -O2 set CGO_CPPFLAGS= set CGO_CXXFLAGS=-g -O2 set CGO_FFLAGS=-g -O2 set CGO_LDFLAGS=-g -O2 set PKG_CONFIG=pkg-config set GOGCCFLAGS=-m64\n    -mthreads -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=C:\\Users\\parapand\\AppData\\Local\\Temp\\go-build101474458=/tmp/go-build\n    -gno-record-gcc-switches</p>\n  </blockquote>\n  \n  <p><code>&gt;go build \n  can't load package: package .: no Go files in C:\\Users\\parapand</code></p>\n</blockquote>\n"}, {"tags": ["go", "rabbitmq", "amqp"], "comments": [{"owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "edited": false, "score": 1, "creation_date": 1537881931, "post_id": 52491904, "comment_id": 91939192, "body": "&quot;broken pipe&quot; implies an underlying network problem causing the TCP connection to the RabbitMQ broker to be closed. There is insufficient information here to troubleshoot why that might occur; if the broker remains up at the far end after the error, this might imply an intermediate load balancer or stateful firewall device is terminating the connection, perhaps due to observing low traffic. AMQP &amp; TCP have heartbeat mechanisms to help mitigate this, which you may wish to ensure are enabled. Not posted as an answer as there are numerous other circumstances which may contribute to this error."}, {"owner": {"reputation": 6400, "user_id": 1466825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b420d86764ffe237a2fdc52e28b73f4?s=128&d=identicon&r=PG", "display_name": "Luke Bakken", "link": "https://stackoverflow.com/users/1466825/luke-bakken"}, "edited": false, "score": 0, "creation_date": 1538013306, "post_id": 52491904, "comment_id": 91996154, "body": "If you can reproduce this, get a TCP traffic capture and post that to the <a href=\"https://groups.google.com/forum/#!forum/rabbitmq-users\" rel=\"nofollow noreferrer\">the <code>rabbitmq-users</code> mailing list</a>."}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 4746790, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NPP8O.jpg?s=128&g=1", "display_name": "Benjamin Mullard", "link": "https://stackoverflow.com/users/4746790/benjamin-mullard"}, "is_accepted": false, "score": 0, "last_activity_date": 1537885965, "creation_date": 1537885965, "answer_id": 52500712, "question_id": 52491904, "link": "https://stackoverflow.com/questions/52491904/why-rabbitmq-wont-the-connection-stay-open-when-not-in-use/52500712#52500712", "title": "Why RabbitMQ won&#39;t the connection stay open when not in use?", "body": "<p>As Cosmic Ossifrage says, the error is saying your RabbitMQ client has disconnected.</p>\n\n<p>There are so many things that could sit between your client and server that can/will drop dormant connections that it's not worth focusing on how long your connection can be dormant for.  You want to set the requested heartbeat interval in your connection manager.</p>\n\n<p><a href=\"https://www.rabbitmq.com/heartbeats.html\" rel=\"nofollow noreferrer\">https://www.rabbitmq.com/heartbeats.html</a></p>\n\n<p>I'm not familiar with the framework you're using but I see it has a <code>defaultHeartbeat</code> field in <em>connection.go</em>.  You might need to experiment with the value to find the best balance is to stop the connection being killed but not hit the server too often with keep-alive traffic.</p>\n"}], "owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 824, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1537885965, "creation_date": 1537856970, "last_edit_date": 1537860085, "question_id": 52491904, "link": "https://stackoverflow.com/questions/52491904/why-rabbitmq-wont-the-connection-stay-open-when-not-in-use", "title": "Why RabbitMQ won&#39;t the connection stay open when not in use?", "body": "<p>I have used <a href=\"http://github.com/streadway/amqp\" rel=\"nofollow noreferrer\">http://github.com/streadway/amqp</a> package in my application in order to handle connections to a remote RabbitMQ server.  Everything is ok and works fine but when a connection is idle for a long period of time f.g 6 hours it gets closed. I check NotifyClose(make(chan *amqp.Error)) all time in my go routine and it returns :</p>\n\n<blockquote>\n  <p>Exception (501) Reason: \"write tcp\n  192.168.133.53:55424->192.168.134.34:5672: write: broken pipe\"</p>\n</blockquote>\n\n<ol>\n<li><p>Why this error happens? (is there any problem in my code?)</p></li>\n<li><p>How long a connection can be idle?</p></li>\n<li><p>How to prevent this problem?</p></li>\n</ol>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "edited": false, "score": 0, "creation_date": 1537857784, "post_id": 52492030, "comment_id": 91924672, "body": "Thanks for your response. I think for now, I&#39;ll stick to the first, more simpler option. Could you elaborate on &quot;and post-process the slice: remove elements according to your requirements.&quot; - perhaps add a small sample? I think I did some of this in the <code>UnmarshalJSON</code> function, but of course it should be a separate one."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "edited": false, "score": 1, "creation_date": 1537858145, "post_id": 52492030, "comment_id": 91924862, "body": "@cbll Added a working example (linked to Go Playground)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1537858132, "last_edit_date": 1537858132, "creation_date": 1537857576, "answer_id": 52492030, "question_id": 52491791, "link": "https://stackoverflow.com/questions/52491791/what-is-the-most-efficient-way-of-filtering-out-json-objects-from-a-key-value/52492030#52492030", "title": "What is the most efficient way of &quot;filtering&quot; out JSON objects from a key-value pair?", "body": "<p>When <code>languageStruct.UnmarshalJSON()</code> is called, there is already a <code>languageStruct</code> prepared that will be appended to the slice, no matter if you fill its content (fields) or not.</p>\n\n<p>The easiest and my suggested solution is to just unmarshal normally, and post-process the slice: remove elements according to your requirements. This results in clean code, which you can easily adjust / alter in the future. Although it could be implemented as custom marshaling logic on a custom slice type <code>[]languageStruct</code>, I would still not create custom marshaling logic for this but implement it as a separate filtering logic.</p>\n\n<p>Here's a simple code unmarshaling, filtering and marshaling it again (note: no custom marshaling is defined / used for this):</p>\n\n<pre><code>var x []*languageStruct\n\nerr := json.Unmarshal(file, &amp;x)\nif err != nil {\n    panic(err)\n}\n\nvar x2 []*languageStruct\nfor _, v := range x {\n    if v.Location == \"England\" {\n        x2 = append(x2, v)\n    }\n}\n\ndata, err := json.MarshalIndent(x2, \"\", \" \")\nfmt.Println(string(data), err)\n</code></pre>\n\n<p>This will result in your desired output. Try it on the <a href=\"https://play.golang.org/p/fP3Qzdkve5b\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>The fastest and most complex solution would be to use <em>event-driven</em> parsing and building a state machine, but the complexity would increase by large. The idea would be to process the JSON by tokens, track where you're at currently in the object tree, and when an object is detected that must be excluded, don't process / add it to your slice. For details and ideas how this can be written, check out this anwser: <a href=\"https://stackoverflow.com/questions/44307219/go-decode-json-as-it-is-still-streaming-in-via-net-http/44308109#44308109\">Go - Decode JSON as it is still streaming in via net/http</a></p>\n"}], "owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1075, "favorite_count": 0, "accepted_answer_id": 52492030, "answer_count": 1, "score": 2, "last_activity_date": 1537858132, "creation_date": 1537856520, "last_edit_date": 1537856946, "question_id": 52491791, "link": "https://stackoverflow.com/questions/52491791/what-is-the-most-efficient-way-of-filtering-out-json-objects-from-a-key-value", "title": "What is the most efficient way of &quot;filtering&quot; out JSON objects from a key-value pair?", "body": "<p>I am reading in a <code>.json</code> file. It's an array of objects in valid JSON format, example:</p>\n\n<pre><code>    [\n        {\n                \"Id\": 13,\n                \"Location\": \"Australia\",\n                \"Content\": \"Another string\"\n        },\n        {\n                \"Id\": 145,\n                \"Location\": \"England\",\n                \"Content\": \"SomeString\"\n        },\n        {\n                \"Id\": 12,\n                \"Location\": \"England\",\n                \"Content\": \"SomeString\"\n        },\n        {\n                \"Id\": 12331,\n                \"Location\": \"Sweden\",\n                \"Content\": \"SomeString\"\n        },\n        {\n                \"Id\": 213123,\n                \"Location\": \"England\",\n                \"Content\": \"SomeString\"\n        }\n     ]\n</code></pre>\n\n<p>I want to filter these objects out - say, removing anything where <code>\"Location\"</code>doesn't equal <code>\"England\"</code>.</p>\n\n<p>What I've tried so far is creating a custom <code>UnmarshalJSON</code> function. It does unmarshal it, but the objects it produces are empty - and as many as the input.</p>\n\n<p>Sample code:</p>\n\n<pre><code>type languageStruct struct {\n    ID                  int     `json:\"Id\"`\n    Location            string  `json:\"Location\"` \n    Content             string  `json:\"Content\"`\n}\n\nfunc filterJSON(file []byte) ([]byte, error) {\n    var x []*languageStruct\n\n    err := json.Unmarshal(file, &amp;x)\n    check(err)\n\n    return json.MarshalIndent(x, \"\", \" \")\n}\n\n\nfunc (s *languageStruct) UnmarshalJSON(p []byte) error {\n\n    var result struct {\n        ID              int     `json:\"Id\"`\n        Location        string  `json:\"Location\"` \n        Content         string  `json:\"Content\"`\n    }\n\n    err := json.Unmarshal(p, &amp;result)\n    check(err)\n\n    // slice of locations we'd like to filter the objects on\n    locations := []string{\"England\"} // Can be more \n\n    if sliceContains(s.Location, locations) {\n        s.ID = result.ID\n        s.Location= result.Location\n        s.Content = result.Content\n    }\n\n    return nil\n}\n\n// helper func to check if a given string, f.e. a value of a key-value pair in a json object, is in a provided list\nfunc sliceContains(a string, list []string) bool {\n    for _, b := range list {\n        if b == a {\n            fmt.Println(\"it's a match!\")\n            return true\n        }\n    }\n    return false\n}\n</code></pre>\n\n<p>While this runs - the output is wrong. It creates as many objects as comes in - however, the new ones are empty, f.e.:</p>\n\n<pre><code>// ...\n [\n {\n  \"Id\": 0,\n  \"Location\": \"\",\n  \"Content\": \"\"\n },\n {\n  \"Id\": 0,\n  \"Location\": \"\",\n  \"Content\": \"\"\n }\n ]\n//...\n</code></pre>\n\n<p>Whereas my desired output, from the first given input, would be:</p>\n\n<pre><code>[\n    {\n            \"Id\": 145,\n            \"Location\": \"England\",\n            \"Content\": \"SomeString\"\n    },\n    {\n            \"Id\": 12,\n            \"Location\": \"England\",\n            \"Content\": \"SomeString\"\n    },\n    {\n            \"Id\": 213123,\n            \"Location\": \"England\",\n            \"Content\": \"SomeString\"\n    }\n ]\n</code></pre>\n"}, {"tags": ["go", "memory-management", "operating-system", "heap-memory", "exploit"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 3, "creation_date": 1537850762, "post_id": 52489786, "comment_id": 91922153, "body": "Nothing in the C standard <a href=\"http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf\" rel=\"nofollow noreferrer\">n1570</a> suggests that its heap is not executable. It is a quality of implementation issue (and the C heap could be executable on some systems). BTW, on my system, <code>malloc</code> may -and often does, for big memory zones- use <code>mmap</code> (not only <code>sbrk</code>)"}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 10411234, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/1441dc9291d31a89e0ae4e51f672b46f?s=128&d=identicon&r=PG", "display_name": "Foo Bar", "link": "https://stackoverflow.com/users/10411234/foo-bar"}, "is_accepted": false, "score": 5, "last_activity_date": 1537850298, "creation_date": 1537850298, "answer_id": 52490663, "question_id": 52489786, "link": "https://stackoverflow.com/questions/52489786/why-is-the-heap-in-go-executable/52490663#52490663", "title": "Why is the heap in Go executable?", "body": "<blockquote>\n  <p>Why is the heap in Go executable? </p>\n</blockquote>\n\n<p>Go heap is not executable since 2013.</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 9, "last_activity_date": 1537851173, "last_edit_date": 1537851173, "creation_date": 1537850310, "answer_id": 52490665, "question_id": 52489786, "link": "https://stackoverflow.com/questions/52489786/why-is-the-heap-in-go-executable/52490665#52490665", "title": "Why is the heap in Go executable?", "body": "<p>The <a href=\"https://github.com/golang/go/commit/5a8b7dc6d009bd95f5904b4250107ef57c163c22\" rel=\"noreferrer\">heap is no longer executable</a>.</p>\n\n<p>Code was generated at runtime for function literals prior to Go 1.1, thus requiring an executable heap. Function calls were <a href=\"https://docs.google.com/document/d/1bMwCey-gmqZVTpRax-ESeVuZGmjwbocYs1iHplK-cjo/pub\" rel=\"noreferrer\">revamped in Go 1.1</a> to eliminate the need for an executable heap and to provide other benefits.</p>\n"}], "owner": {"reputation": 199, "user_id": 9608876, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Carson Harmon", "link": "https://stackoverflow.com/users/9608876/carson-harmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 2, "accepted_answer_id": 52490665, "answer_count": 2, "score": 5, "last_activity_date": 1537851173, "creation_date": 1537842806, "question_id": 52489786, "link": "https://stackoverflow.com/questions/52489786/why-is-the-heap-in-go-executable", "title": "Why is the heap in Go executable?", "body": "<p>I recently read this article <a href=\"http://codearcana.com/posts/2012/05/06/securing-and-exploiting-go-binaries.html\" rel=\"noreferrer\">http://codearcana.com/posts/2012/05/06/securing-and-exploiting-go-binaries.html</a>\nwhich claims in Go that the heap is executable. This raises a few different questions for me about the interaction between the runtime and the operating system.</p>\n\n<p>In C, when a program needs space on the heap, it makes a call to malloc, which in turn calls sbrk which gives it memory. As far as I know in C the heap is read-write only. </p>\n\n<p>Why is the heap in Go executable? What is different about the application - OS interaction in Go then in C? </p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "runtime"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537851650, "post_id": 52489464, "comment_id": 91922383, "body": "&quot;This is my first week using Go&quot;. So why are you even using runtime.Caller? To answer the questions: Do whatever fits your purpose. You did not tell us why you are interested in the call stack. I&#39;d bet you are trying to do something fishy. Normally runtime.Caller might be used to gather debug information e.g. for logging/monitoring. If you cannot gather that information you have to decide what to do next: Log &quot;???&quot;, do nothing, whatever. The question as stated cannot be answered."}, {"owner": {"reputation": 81, "user_id": 10393632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/170c88a4250c1d5dce8eb6c6c213564c?s=128&d=identicon&r=PG&f=1", "display_name": "superhup", "link": "https://stackoverflow.com/users/10393632/superhup"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537925644, "post_id": 52489464, "comment_id": 91957678, "body": "I want to get the current file, isn&#39;t obvious by looking at the code? It should be, since I&#39;m only getting file and ok."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537935406, "post_id": 52489464, "comment_id": 91959739, "body": "Then what is the question? If ok is false you do not have the filename. Live with that."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1537935847, "creation_date": 1537935847, "answer_id": 52509923, "question_id": 52489464, "link": "https://stackoverflow.com/questions/52489464/how-to-properly-deal-with-error-on-runtime-caller0/52509923#52509923", "title": "How to properly deal with error on runtime.Caller(0)", "body": "<blockquote>\n  <p>Why this function in specific doesn't provide an error?</p>\n</blockquote>\n\n<p>That is opinion based.</p>\n\n<blockquote>\n  <p>What should I do if it fails? (Panic, fatal error?)</p>\n</blockquote>\n\n<p>Whatever fits your needs.</p>\n\n<blockquote>\n  <p>What could be wrong to fail?</p>\n</blockquote>\n\n<p>Everything. E.g. a binary stripped of debug information.</p>\n\n<blockquote>\n  <p>Should I validate at all?</p>\n</blockquote>\n\n<p>Yes of course.</p>\n"}], "owner": {"reputation": 81, "user_id": 10393632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/170c88a4250c1d5dce8eb6c6c213564c?s=128&d=identicon&r=PG&f=1", "display_name": "superhup", "link": "https://stackoverflow.com/users/10393632/superhup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1537935847, "creation_date": 1537839832, "question_id": 52489464, "link": "https://stackoverflow.com/questions/52489464/how-to-properly-deal-with-error-on-runtime-caller0", "title": "How to properly deal with error on runtime.Caller(0)", "body": "<p>I'm using <code>runtime.Caller(0)</code> to return the file name:</p>\n\n<pre><code>_, file, _, ok := runtime.Caller(0)\nif !ok {\n    // What should I do here?\n}\n</code></pre>\n\n<p>I would like to know:</p>\n\n<ul>\n<li>Why this function in specific doesn't provide an error?</li>\n<li>What should I do if it fails? (Panic, fatal error?)</li>\n<li>What could be wrong to fail? Should I validate at all?</li>\n</ul>\n\n<p>This is my first week using Go, so I might seem like stupid questions if you are already advanced, and I'm sorry for that.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go", "kubernetes", "containers", "google-kubernetes-engine"], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1537839595, "post_id": 52489411, "comment_id": 91919938, "body": "Yes I&#39;m using windows, but I did that when building the binary, the os in the node is <a href=\"https://cloud.google.com/container-optimized-os/docs/\" rel=\"nofollow noreferrer\">cloud.google.com/container-optimized-os/docs</a>"}, {"owner": {"reputation": 48205, "user_id": 2989261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b03110b84c83464a58832d4d55ff4542?s=128&d=identicon&r=PG", "display_name": "Rico", "link": "https://stackoverflow.com/users/2989261/rico"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 1, "creation_date": 1537842437, "post_id": 52489411, "comment_id": 91920410, "body": "It is an error from golang but my guess is that you probably compiled as a non-static binary which probably is picking up stuff from the local env."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1537843356, "post_id": 52489411, "comment_id": 91920581, "body": "time.LoadLocation needs zoneinfo.zip to load time zones; is related to this <a href=\"https://github.com/golang/go/issues/20969\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/20969</a> thank you :D"}], "tags": [], "owner": {"reputation": 48205, "user_id": 2989261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b03110b84c83464a58832d4d55ff4542?s=128&d=identicon&r=PG", "display_name": "Rico", "link": "https://stackoverflow.com/users/2989261/rico"}, "is_accepted": false, "score": 1, "last_activity_date": 1537839268, "creation_date": 1537839268, "answer_id": 52489411, "question_id": 52489347, "link": "https://stackoverflow.com/questions/52489347/how-to-create-a-binary-that-contains-zoneinfo-zip/52489411#52489411", "title": "How to create a binary that contains zoneinfo.zip", "body": "<p>Looks like you are trying to build your Golang exec on a Windows environment container? You can try to build with the right <code>GOOS=linux</code> (Goose) and <code>GOARCH=amd64</code> (Gorch).  If that doesn't work I recommend you build it natively on a Linux container.</p>\n"}, {"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1537939268, "post_id": 52509992, "comment_id": 91960823, "body": "yes, I actually did that, luckly for me, I only need one time zone, that is my time zone(at least for now), hope this get fixed soon, 357B is the size of zoneinfo.zip,it won&#39;t hurt anybody just to add it to the binary"}], "tags": [], "owner": {"reputation": 700, "user_id": 6940117, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/us57e.png?s=128&g=1", "display_name": "Slotheroo", "link": "https://stackoverflow.com/users/6940117/slotheroo"}, "is_accepted": true, "score": 2, "last_activity_date": 1537936417, "creation_date": 1537936417, "answer_id": 52509992, "question_id": 52489347, "link": "https://stackoverflow.com/questions/52489347/how-to-create-a-binary-that-contains-zoneinfo-zip/52509992#52509992", "title": "How to create a binary that contains zoneinfo.zip", "body": "<p>When using Go's time package, specifically the LoadLocation method, it looks for <a href=\"https://www.iana.org/time-zones\" rel=\"nofollow noreferrer\">time zone database</a> information in various locations. This is explained in the comments for LoadLocation in the source code at <a href=\"https://golang.org/src/time/zoneinfo.go\" rel=\"nofollow noreferrer\">https://golang.org/src/time/zoneinfo.go</a>. Specifically it looks in these places:</p>\n\n<ol>\n<li>A location specified by a ZONEINFO environment variable</li>\n<li>Known locations where time zone database files are kept on Unix operating systems</li>\n<li>The zoneinfo.zip file in your $GOROOT</li>\n</ol>\n\n<p>When you're programming on a Windows machine, Go is most likely defaulting to the 3rd option. However, there is no $GOROOT when you're working with a binary, so that won't work in your container. On most versions of Linux the 2nd option would work fine as they would have the necessary time zone database files. However, I have a strong suspicion that the optimized container you reference does not. This leaves you with option 1, which essentially consists of putting your own time zone database files on the container and then referencing their location with the ZONEINFO environment variable. This is both kind of a pain in the ass and I've also found that it fails silently when you request a time zone file that doesn't exist. </p>\n\n<p>In my own addressing of this problem I ended up creating a package that utilizes the LoadLocationFromTZData method and tries to simplify the process of providing and working with your own copy of the time zone database. You can see my own stack overflow question here: <a href=\"https://stackoverflow.com/questions/51053321/detect-if-zoneinfo-fails-in-go\">Detect if ZONEINFO fails in Go</a>. And you can see the repository for my time zone package here: <a href=\"https://github.com/slotheroo/knozone\" rel=\"nofollow noreferrer\">https://github.com/slotheroo/knozone</a></p>\n"}, {"tags": [], "owner": {"reputation": 605, "user_id": 917268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/187887731a1307f80996ca2eec88bd51?s=128&d=identicon&r=PG", "display_name": "coffekid", "link": "https://stackoverflow.com/users/917268/coffekid"}, "is_accepted": false, "score": 1, "last_activity_date": 1564361227, "creation_date": 1564361227, "answer_id": 57246043, "question_id": 52489347, "link": "https://stackoverflow.com/questions/52489347/how-to-create-a-binary-that-contains-zoneinfo-zip/57246043#57246043", "title": "How to create a binary that contains zoneinfo.zip", "body": "<p>I faced that same problem a week ago and ended up resolving like this on the Dockerfile.</p>\n\n<p>First, you need to locate the <code>zoneinfo.zip</code> file. For instance on a MacOS having Go installed via brew can get tricky.</p>\n\n<pre><code>tztest$ go env GOROOT\n/usr/local/Cellar/go/1.12.7/libexec\ntztest$ ls -l /usr/local/Cellar/go/1.12.7/libexec/lib/time/zoneinfo.zip\n-rwxr-xr-x  1 mau  staff  365447 Jul  8 16:29 /usr/local/Cellar/go/1.12.7/libexec/lib/time/zoneinfo.zip\n</code></pre>\n\n<p>So the workaround is copying <code>zoneinfo.zip</code> and include in the same directory of the Dockerfile. From there, is just a matter of ADD the file to the docker build process and override the environment variable</p>\n\n<pre><code>ADD zoneinfo.zip /zoneinfo.zip\nENV ZONEINFO /zoneinfo.zip\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 4, "last_activity_date": 1597216346, "creation_date": 1597216346, "answer_id": 63371576, "question_id": 52489347, "link": "https://stackoverflow.com/questions/52489347/how-to-create-a-binary-that-contains-zoneinfo-zip/63371576#63371576", "title": "How to create a binary that contains zoneinfo.zip", "body": "<p>You might consider building your Go application <a href=\"https://golang.org/doc/go1.15#time/tzdata\" rel=\"nofollow noreferrer\">with Go 1.15</a> (August 2020, two years later)</p>\n<blockquote>\n<h2>New embedded tzdata package</h2>\n</blockquote>\n<blockquote>\n<p>Go 1.15 includes a new package, <a href=\"https://golang.org/pkg/time/tzdata/\" rel=\"nofollow noreferrer\"><code>time/tzdata</code></a>, that permits embedding the timezone database into a program.</p>\n<ul>\n<li>Importing this package (as <code>import _ &quot;time/tzdata&quot;</code>) permits the program to find timezone information even if the timezone database is not available on the local system.</li>\n<li>You can also embed the timezone database by building with <code>-tags timetzdata</code>.</li>\n</ul>\n<p>Either approach increases the size of the program by about 800 KB.</p>\n</blockquote>\n<p>That way, once deployed to a Kubernetes engine as a Docker image, it won't have to try and load any timezone information, since said information is embedded in its program.</p>\n"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2585, "favorite_count": 3, "accepted_answer_id": 52509992, "answer_count": 4, "score": 3, "last_activity_date": 1597216346, "creation_date": 1537838646, "question_id": 52489347, "link": "https://stackoverflow.com/questions/52489347/how-to-create-a-binary-that-contains-zoneinfo-zip", "title": "How to create a binary that contains zoneinfo.zip", "body": "<p>I'm using Docker to create a container application and then deploy it to <a href=\"https://cloud.google.com/kubernetes-engine/\" rel=\"nofollow noreferrer\">kubernetes engine</a> but when the application is been initialized I get this error: </p>\n\n<pre><code>err: open C:\\Go/lib/time/zoneinfo.zip: no such file or directory\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/UAjLT.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UAjLT.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/OCnpZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/OCnpZ.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["docker", "go", "amazon-ec2", "ansible"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1537869304, "post_id": 52488723, "comment_id": 91931135, "body": "You quoted <code>ports:</code> block references port 8000, but your question and Dockerfile say 8080.  Is that a typo in the question or your setup?  Are AWS security groups or the host iptables blocking the connection?"}, {"owner": {"reputation": 1635, "user_id": 5012849, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y0srn.jpg?s=128&g=1", "display_name": "stringVector", "link": "https://stackoverflow.com/users/5012849/stringvector"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1537871495, "post_id": 52488723, "comment_id": 91932481, "body": "That is a typo, fixed. I will research a security groups and host iptables possibility."}], "answers": [{"comments": [{"owner": {"reputation": 1635, "user_id": 5012849, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y0srn.jpg?s=128&g=1", "display_name": "stringVector", "link": "https://stackoverflow.com/users/5012849/stringvector"}, "edited": false, "score": 1, "creation_date": 1537844339, "post_id": 52489290, "comment_id": 91920721, "body": "I have tried adding ports argument to docker compose in the edits shown above with no success."}], "tags": [], "owner": {"reputation": 71, "user_id": 6082918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7PCp1.jpg?s=128&g=1", "display_name": "Daniel Montoya", "link": "https://stackoverflow.com/users/6082918/daniel-montoya"}, "is_accepted": false, "score": 1, "last_activity_date": 1537838215, "creation_date": 1537838215, "answer_id": 52489290, "question_id": 52488723, "link": "https://stackoverflow.com/questions/52488723/docker-deployed-image-not-accessible-from-outside-host/52489290#52489290", "title": "Docker deployed image not accessible from outside host", "body": "<p>Make sure the container binds the port to the host port. In the <a href=\"https://docs.docker.com/config/containers/container-networking/\" rel=\"nofollow noreferrer\">container networking</a> documentation you can read the following:</p>\n\n<blockquote>\n  <p>By default, when you create a container, it does not publish any of\n  its ports to the outside world. To make a port available to services\n  outside of Docker, or to Docker containers which are not connected to\n  the container\u2019s network, use the --publish or -p flag. This creates a\n  firewall rule which maps a container port to a port on the Docker\n  host. Here are some examples.</p>\n</blockquote>\n\n<p>You can try running your container with the <code>-p</code> flag explained above:</p>\n\n<pre><code>docker run -p 0.0.0.0:8080:80 your-container-image\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1635, "user_id": 5012849, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y0srn.jpg?s=128&g=1", "display_name": "stringVector", "link": "https://stackoverflow.com/users/5012849/stringvector"}, "is_accepted": false, "score": 0, "last_activity_date": 1537897698, "creation_date": 1537897698, "answer_id": 52504059, "question_id": 52488723, "link": "https://stackoverflow.com/questions/52488723/docker-deployed-image-not-accessible-from-outside-host/52504059#52504059", "title": "Docker deployed image not accessible from outside host", "body": "<p>We have discovered the answer. This problem happened after adding the following go code:</p>\n\n<pre><code>serv := &amp;http.Server{\n    Addr:         \"localhost\" + port,\n    ReadTimeout:  60 * time.Second,\n    WriteTimeout: 60 * time.Second,\n    Handler:      router,\n}\n</code></pre>\n\n<p>This sets timeouts for responses. We found that the word \"localhost\" was not mapping to the ip address of the host. Changing it to the following fixed the issue:</p>\n\n<pre><code>    serv := &amp;http.Server{\n        Addr:         \"0.0.0.0\" + port,\n        ReadTimeout:  60 * time.Second,\n        WriteTimeout: 60 * time.Second,\n        Handler:      router,\n    }\n</code></pre>\n\n<p>I can now access the server from outside the host.</p>\n"}], "owner": {"reputation": 1635, "user_id": 5012849, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y0srn.jpg?s=128&g=1", "display_name": "stringVector", "link": "https://stackoverflow.com/users/5012849/stringvector"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1460, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1537897698, "creation_date": 1537832670, "last_edit_date": 1537871369, "question_id": 52488723, "link": "https://stackoverflow.com/questions/52488723/docker-deployed-image-not-accessible-from-outside-host", "title": "Docker deployed image not accessible from outside host", "body": "<p>So I have a Go application that I am deploying to a EC2 instance with Ansible and Jenkins pipeline as a Docker image. I have an image that I can access from outside the host using the IP address and the port number, 8080, using Postman. When I deploy a new image I cannot get a response using the ip address and port number. When I ssh into the server I can reach the endpoint using <strong>localhost</strong> and the port number. If I stop that image and start the first I can then reach it again. </p>\n\n<p>What are the possible differences between these images that makes it so the endpoint can no longer be accessed via the ip address?</p>\n\n<p>My Docker Compose File:</p>\n\n<pre><code>version: '2'\nservices:\n  project-1:\n    image: ...\n    volumes:\n      - /var/log:/var/log\n    network_mode: host\n    environment:\n      - ...\n    cpu_shares: 1236\n    mem_limit: 2619m\n</code></pre>\n\n<p>My DockerFile:</p>\n\n<pre><code>FROM golang:1.10\n\nWORKDIR /go/src/...\nCOPY . .\n\nRUN go get -d -v ./...\nRUN go install -v ./...\n\nEXPOSE 8080-8080\nCMD ./run.sh\n</code></pre>\n\n<p>I have also attempted removing network_mode from Docker Compose file and replacing it with ports as shown below with no success:</p>\n\n<pre><code>ports:\n      - \"0.0.0.0:8080:8080\"\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 2, "creation_date": 1537832438, "post_id": 52488573, "comment_id": 91918578, "body": "This is an example of variadic arguments. You can read more about them in the <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"nofollow noreferrer\">spec</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1537860489, "post_id": 52488573, "comment_id": 91926141, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/23669720/meaning-of-interface-dot-dot-dot-interface\">Meaning of ...interface{} (dot dot dot interface)</a>"}], "answers": [{"tags": [], "owner": {"reputation": 121, "user_id": 1443684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37888e0b7eefba8175fe00c52db35d2f?s=128&d=identicon&r=PG", "display_name": "thanhpham", "link": "https://stackoverflow.com/users/1443684/thanhpham"}, "is_accepted": true, "score": 1, "last_activity_date": 1537831454, "creation_date": 1537831454, "answer_id": 52488598, "question_id": 52488573, "link": "https://stackoverflow.com/questions/52488573/golang-string-type-arg-function/52488598#52488598", "title": "Golang ...string type arg function", "body": "<p>You can use: <code>ex...</code> in the statement <code>exec.Command(c,ex...)</code> instead of just <code>ex</code></p>\n\n<p>Below as an example:</p>\n\n<pre><code>func ex(c string,ex ...string) { exec.Command(c,ex...) }\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10409601, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ceUDoAYU5pA/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DX0_R4NuXGBwJNQ6vSTDb0zNyvWFw/mo/photo.jpg?sz=128", "display_name": "itshaman", "link": "https://stackoverflow.com/users/10409601/itshaman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 52488598, "answer_count": 1, "score": -3, "last_activity_date": 1537831454, "creation_date": 1537831219, "question_id": 52488573, "link": "https://stackoverflow.com/questions/52488573/golang-string-type-arg-function", "title": "Golang ...string type arg function", "body": "<p>Why i cant put args in function </p>\n\n<pre><code>func ex(c string,ex ...string) { exec.Command(c,ex) }\n</code></pre>\n\n<p>get error <code>cannot use args (type []string) as type string</code>. Why?</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 6305, "user_id": 72987, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9d1484425e9a125402f85497c7f86a00?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/72987/mike"}, "edited": false, "score": 0, "creation_date": 1537847826, "post_id": 52489902, "comment_id": 91921412, "body": "looks like it was my copy/paste stupidity from another code block in my app.. I had inited profile like <code>var profile []db.Profile</code> which was causing the issue it seems.. your example somehow caused me to think again.. thanks!"}, {"owner": {"reputation": 410, "user_id": 4793100, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/df152828f32e71f57e4ca98ca0e67bc0?s=128&d=identicon&r=PG", "display_name": "Jordy Baylac", "link": "https://stackoverflow.com/users/4793100/jordy-baylac"}, "edited": false, "score": 0, "creation_date": 1600656720, "post_id": 52489902, "comment_id": 113146012, "body": "this always create a new record in DB for me, and update the existing record as well. I am looking to update if exist, in other case, insert"}], "tags": [], "owner": {"reputation": 121, "user_id": 1443684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37888e0b7eefba8175fe00c52db35d2f?s=128&d=identicon&r=PG", "display_name": "thanhpham", "link": "https://stackoverflow.com/users/1443684/thanhpham"}, "is_accepted": true, "score": 3, "last_activity_date": 1537845413, "last_edit_date": 1537845413, "creation_date": 1537843781, "answer_id": 52489902, "question_id": 52486334, "link": "https://stackoverflow.com/questions/52486334/how-to-use-firstorcreate-properly/52489902#52489902", "title": "How to use FirstOrCreate properly", "body": "<p>I think you forget to create the table <code>db.CreateTable(&amp;Profile{})</code></p>\n\n<p>Here is a working example:</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n)\n\ntype Profile struct {\n    gorm.Model\n\n    Email     string    `json:\"email\" sql:\"not null;unique\"`\n    LastLogin time.Time `json:\"lastlogin\"`\n}\n\nfunc main() {\n    db, err := gorm.Open(\"sqlite3\", \"test.db\")\n    if err != nil {\n        panic(\"failed to connect database\")\n    }\n    defer db.Close()\n    // Create the table...\n    // Read the doc at: http://doc.gorm.io/database.html#migration -&gt; sec: Create Table\n    db.CreateTable(&amp;Profile{})\n\n    var profile Profile\n    db.Debug().Where(Profile{Email: \"user@domain.com\"}).Assign(Profile{LastLogin: time.Now()}).FirstOrCreate(&amp;profile)\n}\n</code></pre>\n\n<p>Out put:</p>\n\n<pre><code>[2018-09-25 09:47:35]  [0.18ms]  INSERT INTO \"profiles\" (\"created_at\",\"updated_at\",\"deleted_at\",\"email\",\"last_login\") VALUES ('2018-09-25 09:47:35','2018-09-25 09:47:35',NULL,'user@domain.com','2018-09-25 09:47:35')\n[1 rows affected or returned ]\n</code></pre>\n\n<p>Hope this help :)</p>\n"}], "owner": {"reputation": 6305, "user_id": 72987, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9d1484425e9a125402f85497c7f86a00?s=128&d=identicon&r=PG", "display_name": "Mike", "link": "https://stackoverflow.com/users/72987/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2388, "favorite_count": 0, "accepted_answer_id": 52489902, "answer_count": 1, "score": 3, "last_activity_date": 1537860395, "creation_date": 1537818303, "last_edit_date": 1537860395, "question_id": 52486334, "link": "https://stackoverflow.com/questions/52486334/how-to-use-firstorcreate-properly", "title": "How to use FirstOrCreate properly", "body": "<p>I have the following simple struct</p>\n\n<pre><code>type Profile struct {\n    gorm.Model\n\n    Email     string    `json:\"email\" sql:\"not null;unique\"`\n    LastLogin time.Time `json:\"lastlogin\"`\n}\n</code></pre>\n\n<p>I'm trying to make a insert if it doesn't exist via</p>\n\n<pre><code>  db.Con.Debug().Where(db.Profile{Email: \"user@domain.com\"}).Assign(db.Profile{LastLogin: time.Now()}).FirstOrCreate(&amp;profile)\n</code></pre>\n\n<p>I get the following in my logs</p>\n\n<pre><code>(/Users/mzupan/go/src/gitlab.com/org/app/pkg/auth/login.go:182)\n[2018-09-24 13:35:58]  [4.56ms]  SELECT * FROM \"profiles\"  WHERE \"profiles\".\"deleted_at\" IS NULL AND ((\"profiles\".\"email\" = 'user@domain.com')) ORDER BY \"profiles\".\"id\" ASC LIMIT 1\n[0 rows affected or returned ]\n\n(/Users/mzupan/go/src/gitlab.com/org/app/pkg/auth/login.go:182)\n[2018-09-24 13:35:58]  [1.77ms]  UPDATE \"profiles\" SET \"last_login\" = '2018-09-24 13:35:58', \"updated_at\" = '2018-09-24 13:35:58'  WHERE \"profiles\".\"deleted_at\" IS NULL AND ((\"profiles\".\"email\" = 'user@domain.com'))\n[0 rows affected or returned ]\n</code></pre>\n\n<p>So it's trying to do the select/update even though 0 rows are found in the select. Seems to me I'm doing the right thing. </p>\n"}, {"tags": ["go", "apache-kafka", "kafka-consumer-api", "kafka-producer-api", "confluent-platform"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1537815242, "post_id": 52485463, "comment_id": 91912726, "body": "What did you try so far?"}, {"owner": {"reputation": 117, "user_id": 923499, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bb4643be38295907ae67db477b879429?s=128&d=identicon&r=PG", "display_name": "user923499", "link": "https://stackoverflow.com/users/923499/user923499"}, "reply_to_user": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 0, "creation_date": 1537850773, "post_id": 52485463, "comment_id": 91922159, "body": "@Ullaakut I am checking if any consumer factory would be available to create N number of consumers for same topic (with different partitions) in confluent kafka? Updated my question."}, {"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1540346396, "post_id": 52485463, "comment_id": 92827194, "body": "Again, what have you tried, though? For example, try to create a list of consumer objects and assign them all a given partition? Generally, one application only runs one consumer, though. Then you scale your application independently"}, {"owner": {"reputation": 117, "user_id": 923499, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bb4643be38295907ae67db477b879429?s=128&d=identicon&r=PG", "display_name": "user923499", "link": "https://stackoverflow.com/users/923499/user923499"}, "reply_to_user": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1540442787, "post_id": 52485463, "comment_id": 92869115, "body": "@cricket_007, any reason why one application should run one consumer. I see having partitions can improve the data processing time. I was able to get the partition count in topic, create multiple consumers and read the data from different partitions and it worked with small data. Just need to tweak code in this example, <a href=\"https://github.com/confluentinc/confluent-kafka-go/blob/master/examples/consumer_example/consumer_example.go\" rel=\"nofollow noreferrer\">github.com/confluentinc/confluent-kafka-go/blob/master/examp&zwnj;&#8203;les/&hellip;</a>"}, {"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1540478276, "post_id": 52485463, "comment_id": 92889121, "body": "For simplicity? Scalable microservices? Rather than having one machine become a bottleneck, you distribute it over many. Otherwise, one application is already assigned all the partitions for a given topic. If you actually need two distinct topics, I&#39;ve only seen that being done in Kafka Streams were you would first join the topics on some field"}], "answers": [{"comments": [{"owner": {"reputation": 117, "user_id": 923499, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bb4643be38295907ae67db477b879429?s=128&d=identicon&r=PG", "display_name": "user923499", "link": "https://stackoverflow.com/users/923499/user923499"}, "edited": false, "score": 0, "creation_date": 1537850579, "post_id": 52486491, "comment_id": 91922105, "body": "I am checking if any consumer factory would be available to create N number of consumers for same topic (with different partitions) ?"}], "tags": [], "owner": {"reputation": 17939, "user_id": 870483, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/4c0cf09ba2aac169509746cf29a251a2?s=128&d=identicon&r=PG", "display_name": "Nishu Tayal", "link": "https://stackoverflow.com/users/870483/nishu-tayal"}, "is_accepted": false, "score": 0, "last_activity_date": 1540346294, "last_edit_date": 1540346294, "creation_date": 1537819020, "answer_id": 52486491, "question_id": 52485463, "link": "https://stackoverflow.com/questions/52485463/create-multiple-consumers-for-same-topic-in-kafka/52486491#52486491", "title": "Create multiple consumers for same topic in kafka", "body": "<p>There is an example in the Confluent github repo :</p>\n\n<p><a href=\"https://github.com/confluentinc/confluent-kafka-go/blob/master/examples/consumer_example/consumer_example.go\" rel=\"nofollow noreferrer\">https://github.com/confluentinc/confluent-kafka-go/blob/master/examples/consumer_example/consumer_example.go</a></p>\n\n<p>If you want to create multiple consumers for the same topic, there are two scenarios : </p>\n\n<p>1.Create each consumer with different group id. </p>\n\n<pre><code>c1, err := kafka.NewConsumer(&amp;kafka.ConfigMap{\n        \"bootstrap.servers\":    broker,\n        \"group.id\":             group1,\n        \"session.timeout.ms\":   6000,\n        \"default.topic.config\": kafka.ConfigMap{\"auto.offset.reset\": \"earliest\"}})\n\nc2, err := kafka.NewConsumer(&amp;kafka.ConfigMap{\n        \"bootstrap.servers\":    broker,\n        \"group.id\":             group2,\n        \"session.timeout.ms\":   6000,\n        \"default.topic.config\": kafka.ConfigMap{\"auto.offset.reset\": \"earliest\"}})\n</code></pre>\n\n<ol start=\"2\">\n<li>If you want multiple consumers for the same topic but with the same group id, it will start consuming from single partition. i.e. A topic contains 3 partitions and you create 3 consumers with same group id, each consumer will consume from one partition</li>\n</ol>\n"}], "owner": {"reputation": 117, "user_id": 923499, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bb4643be38295907ae67db477b879429?s=128&d=identicon&r=PG", "display_name": "user923499", "link": "https://stackoverflow.com/users/923499/user923499"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3960, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1540346294, "creation_date": 1537814477, "last_edit_date": 1537850689, "question_id": 52485463, "link": "https://stackoverflow.com/questions/52485463/create-multiple-consumers-for-same-topic-in-kafka", "title": "Create multiple consumers for same topic in kafka", "body": "<p>I am newbie and can see one example with one consumer in below github repository, but any ideas how to create multiple consumers for same topic in go lang?</p>\n\n<p><a href=\"https://github.com/confluentinc/confluent-kafka-go/tree/master/examples\" rel=\"nofollow noreferrer\">https://github.com/confluentinc/confluent-kafka-go/tree/master/examples</a></p>\n\n<p>Any consumer factory (to generate N consumers) available in confluent-kafka to read same topic (with partitions)?</p>\n"}, {"tags": ["go", "twitter"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1537814679, "post_id": 52485245, "comment_id": 91912480, "body": "Please next time make sure you have created an <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>: all the code in your example except for the first two non-commented lines of the <code>FeedHandler</code> function serve no purpose in demonstrating the problem."}], "answers": [{"tags": [], "owner": {"reputation": 2183, "user_id": 10029810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ee9acb32ea179266c431ba3232807f?s=128&d=identicon&r=PG&f=1", "display_name": "nodediggity", "link": "https://stackoverflow.com/users/10029810/nodediggity"}, "is_accepted": true, "score": 4, "last_activity_date": 1537813952, "creation_date": 1537813952, "answer_id": 52485349, "question_id": 52485245, "link": "https://stackoverflow.com/questions/52485245/how-do-i-use-twitter-api-with-github-com-chimeracoder-anaconda/52485349#52485349", "title": "How do I use Twitter API with github.com/ChimeraCoder/anaconda?", "body": "<p>You need to pass in the user's screen name as a property on <code>url.Values{}</code></p>\n\n<pre><code>func FeedHandler(w http.ResponseWriter, r *http.Request) {\n    api := anaconda.NewTwitterApi(\"\", \"\")\n\n    v := url.Values{}\n    v.Set(\"screen_name\", \"some_user_name\")\n\n    searchResult, _ := api.GetUserTimeline(v)\n\n    json.NewEncoder(w).Encode(searchResult)\n}\n</code></pre>\n"}], "owner": {"reputation": 3038, "user_id": 7579156, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9e859f30bb49fd88ad3017b07d0ffb5d?s=128&d=identicon&r=PG&f=1", "display_name": "Harry Blue", "link": "https://stackoverflow.com/users/7579156/harry-blue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 52485349, "answer_count": 1, "score": 1, "last_activity_date": 1537814502, "creation_date": 1537813450, "last_edit_date": 1537814502, "question_id": 52485245, "link": "https://stackoverflow.com/questions/52485245/how-do-i-use-twitter-api-with-github-com-chimeracoder-anaconda", "title": "How do I use Twitter API with github.com/ChimeraCoder/anaconda?", "body": "<p>I have a web API written Go, I would like to use it to consume the Twitter API and return some properties from a user's timeline.</p>\n\n<p>I have added <a href=\"https://github.com/ChimeraCoder/anaconda\" rel=\"nofollow noreferrer\">https://github.com/ChimeraCoder/anaconda</a> to my web API, however I cannot understand from the docs just how to get a timeline for a user.</p>\n\n<p>This is my application currently.</p>\n\n<p>I am trying to use the <code>FeedHandler</code> method. I can trigger a search, but when it comes to actually returning a user's timeline, I am stuck.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n\n    \"github.com/ChimeraCoder/anaconda\"\n    \"github.com/gorilla/mux\"\n)\n\ntype Meta struct {\n    Description string     `json:\"description\"`\n    Version     string     `json:\"version\"`\n    Bugs        GitHubLink `json:\"bugs\"`\n}\n\ntype GitHubLink struct {\n    Url string `json:\"url\"`\n}\n\ntype ErrorMessage struct {\n    Status  int    `json:\"status\"`\n    Message string `json:\"message\"`\n}\n\nvar (\n    consumerKey    = getenv(\"TWITTER_CONSUMER_KEY\")\n    consumerSecret = getenv(\"TWITTER_CONSUMER_SECRET\")\n)\n\nfunc getenv(name string) string {\n    v := os.Getenv(name)\n    if v == \"\" {\n        panic(\"required environment variable \" + name + \"is missing\")\n    }\n    return v\n}\n\nfunc main() {\n\n    anaconda.SetConsumerKey(consumerKey)\n    anaconda.SetConsumerSecret(consumerSecret)\n\n    r := mux.NewRouter()\n\n    r.HandleFunc(\"/\", HomeHandler)\n    r.HandleFunc(\"/feed/{screenName}\", FeedHandler)\n    r.HandleFunc(\"/healthz\", HealthzHandler)\n\n    r.NotFoundHandler = http.HandlerFunc(NotFoundHandler)\n\n    log.Fatal(http.ListenAndServe(\":8000\", r))\n\n}\n\nfunc HomeHandler(w http.ResponseWriter, r *http.Request) {\n\n    meta := Meta{\n        Description: \"API returning twitter.com posted images\",\n        Version:     \"0.0.0\",\n        Bugs:        GitHubLink{Url: \"https://foo.bar\"}}\n\n    json.NewEncoder(w).Encode(meta)\n}\n\nfunc FeedHandler(w http.ResponseWriter, r *http.Request) {\n    api := anaconda.NewTwitterApi(\"\", \"\")\n\n    // vars := mux.Vars(r)\n\n    tweets := api.GetUserTimeline('&lt;users_screen_name&gt;')\n\n    // searchResult, _ := api.\n    // for _, tweet := range searchResult.Statuses {\n    //  fmt.Println(tweet.Text)\n    // }\n\n    fmt.Fprintf(w, \"Not Implemented Yet\")\n}\n\nfunc HealthzHandler(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Cache-Control\", \"no-cache, no-store, max-age=0\")\n\n}\n\nfunc NotFoundHandler(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(http.StatusNotFound)\n    errorMessage := ErrorMessage{Status: 404, Message: \"Request resource does not exist\"}\n\n    json.NewEncoder(w).Encode(errorMessage)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 6, "creation_date": 1537805399, "post_id": 52483310, "comment_id": 91908092, "body": "I believe you&#39;re looking for <code>fmt.Sprintf</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "is_accepted": true, "score": 4, "last_activity_date": 1537808286, "creation_date": 1537808286, "answer_id": 52484091, "question_id": 52483310, "link": "https://stackoverflow.com/questions/52483310/golang-store-print-as-variable/52484091#52484091", "title": "Golang store print as variable", "body": "<p>To store the result of the concatenation, you can use <a href=\"https://golang.org/src/fmt/print.go?s=5498:5550#L191\" rel=\"nofollow noreferrer\">fmt.Sprintf</a></p>\n\n<pre><code>variable := fmt.Sprintf(\"https://s3.%s.amazonaws.com/%s/%s\", region, bucket, *item.Key)\n</code></pre>\n"}], "owner": {"reputation": 322, "user_id": 8399906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4b20fa1357bb11e0ba2eab0d5b358ed?s=128&d=identicon&r=PG", "display_name": "CJW", "link": "https://stackoverflow.com/users/8399906/cjw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1407, "favorite_count": 0, "closed_date": 1537811492, "accepted_answer_id": 52484091, "answer_count": 1, "score": -1, "last_activity_date": 1537808286, "creation_date": 1537805279, "question_id": 52483310, "link": "https://stackoverflow.com/questions/52483310/golang-store-print-as-variable", "closed_reason": "Duplicate", "title": "Golang store print as variable", "body": "<p>I am fairly new to GO and I was hoping someone would be able to point me in the right direction.\nI am trying to store a Print to a variable. To give some context, currently, I am retrieving the URL of a file that is in Amazon S3 and I would like to store the URL as a variable so I can send it out as say, an email or push notification.</p>\n\n<p>Here is what I have at the moment:</p>\n\n<pre><code>func main() {\n    bucket := \"bucket\"\n    region := \"eu-west-2\"\n\n    // Initialize a session in us-west-2 that the SDK will use to load\n    // credentials from the shared credentials file ~/.aws/credentials.\n    sess, err := session.NewSession(&amp;aws.Config{\n        Region: aws.String(\"eu-west-2\")},\n    )\n\n    // Create S3 service client\n    svc := s3.New(sess)\n\n\n    // Get the list of item\n    resp, err := svc.ListObjects(&amp;s3.ListObjectsInput{Bucket: aws.String(bucket)})\n    if err != nil {\n        exitErrorf(\"Unable to list items in bucket %q, %v\", bucket, err)\n    }\n\n    for _, item := range resp.Contents {\n        fmt.Printf(\"https://s3.%s.amazonaws.com/%s/%s\", region, bucket, *item.Key)\n        fmt.Println(\"\")\n        var url string = \"https://s3.%s.amazonaws.com/%s/%s\", region, bucket, *item.Key\n}\n}\n\nfunc exitErrorf(msg string, args ...interface{}) {\n    fmt.Fprintf(os.Stderr, msg+\"\\n\", args...)\n    os.Exit(1)\n}\n</code></pre>\n\n<p>This results in <code>extra expression in var declaration</code> when attempting to compile (TBF I did not expect it to work). Would anyone know an alternative way of doing this?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "types", "interface", "casting"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1537805284, "post_id": 52483250, "comment_id": 91908029, "body": "It seems like you&#39;re trying to use this as a form of polymorphism, which it is not. What are you actually trying to accomplish? There is likely a better/more idiomatic way to accomplish it in Go."}], "answers": [{"comments": [{"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 0, "creation_date": 1537805676, "post_id": 52483346, "comment_id": 91908241, "body": "yes!!! that&#39;s it, I had tried <code>BaseType(e)</code> but that is a mismatch between a pointer and a struct, but didn&#39;t know how to achieve it for a pointer :) Thanks!"}, {"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 0, "creation_date": 1537806057, "post_id": 52483346, "comment_id": 91908442, "body": "I have edited the question title so that it is a bit clearer what I was actually requesting :)"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1537805418, "creation_date": 1537805418, "answer_id": 52483346, "question_id": 52483250, "link": "https://stackoverflow.com/questions/52483250/assign-a-variable-to-label-type-or-how-to-type-cast-between-pointers/52483346#52483346", "title": "Assign a variable to &quot;label&quot; type, or how to type cast between pointers", "body": "<p>Use the <code>(*BaseType)()</code> <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">type conversion</a> to convert a <code>*LabeledType1</code> and <code>*LabeledType2</code> to a <code>*BaseType</code>:</p>\n\n<pre><code>func handle(evt interface{}) error {\n    switch e := evt.(type) {\n    case *LabeledType1:\n        return handleBaseEvent((*BaseType)(e))\n    }\n    ...\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/lhvW2Y2Hk_X\" rel=\"noreferrer\">Run it on the playground</a>.</p>\n"}], "owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 52483346, "answer_count": 1, "score": 1, "last_activity_date": 1537860366, "creation_date": 1537805024, "last_edit_date": 1537860366, "question_id": 52483250, "link": "https://stackoverflow.com/questions/52483250/assign-a-variable-to-label-type-or-how-to-type-cast-between-pointers", "title": "Assign a variable to &quot;label&quot; type, or how to type cast between pointers", "body": "<p>I have two identical structures, which for disambiguation purposes have different types:</p>\n\n<pre><code>type BaseType struct {\n   id  uint64\n   name string\n}\n\ntype LabeledType1 BaseType\ntype LabeledType2 BaseType\n</code></pre>\n\n<p>There is one function in the whole chain which actually doesn't care about the <code>LabeledType</code>, it just works with the <code>BaseType</code> (because it does the exact same thing with both). The sender of the event has to send the labeled type, not the base type, because the actual type defines some post-behavior.</p>\n\n<pre><code>func handle(evt interface{}) error {\n  switch e := evt.(type) {\n  case *LabeledType1: \n    return handleBaseEvent(e)\n  case *LabeledType2:\n    return handleBaseEvent(e)\n  //there are other types\n  case *OtherType:\n      return handleOtherType(e)\n  } \n}\n\nfunc handleBaseEvent(evt *BaseType) {\n   //do stuff\n}\n</code></pre>\n\n<p>Now of course this doesn't compile:</p>\n\n<pre><code>cannot convert e (type *LabeledType1) to type BaseType\n</code></pre>\n\n<p>But I wonder, both types are <strong>assignable</strong> as far as I understand that concept, so there should be some easy conversion? I've tried type casting: </p>\n\n<p><code>evt.(BaseType)</code>) </p>\n\n<p>and also </p>\n\n<p><code>BaseType(e)</code></p>\n\n<p>I can't use a <code>bool</code> inside <code>BaseType</code>.</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1537803358, "post_id": 52482777, "comment_id": 91906920, "body": "You can only reflect on exported members."}, {"owner": {"reputation": 81, "user_id": 10393632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/170c88a4250c1d5dce8eb6c6c213564c?s=128&d=identicon&r=PG&f=1", "display_name": "superhup", "link": "https://stackoverflow.com/users/10393632/superhup"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1537804311, "post_id": 52482777, "comment_id": 91907495, "body": "@Adrian if I change to <code>Fake</code>, still doesn&#39;t work."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1537804899, "post_id": 52482777, "comment_id": 91907809, "body": "<code>t</code> is already a pointer, <code>&amp;t</code> is <code>**t</code> (<a href=\"https://play.golang.org/p/TIylbXFRiNb\" rel=\"nofollow noreferrer\">play.golang.org/p/TIylbXFRiNb</a>)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537804905, "post_id": 52482777, "comment_id": 91907817, "body": "T has no method Fake (or fake) or any method at all."}], "answers": [{"tags": [], "owner": {"reputation": 121, "user_id": 1443684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37888e0b7eefba8175fe00c52db35d2f?s=128&d=identicon&r=PG", "display_name": "thanhpham", "link": "https://stackoverflow.com/users/1443684/thanhpham"}, "is_accepted": false, "score": 1, "last_activity_date": 1537804887, "creation_date": 1537804887, "answer_id": 52483209, "question_id": 52482777, "link": "https://stackoverflow.com/questions/52482777/using-reflect-to-call-method-of-struct-inside-struct-method/52483209#52483209", "title": "Using reflect to call method of struct inside struct method", "body": "<p>You need to export the method and call it:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"reflect\"\n\ntype T struct{}\n\nfunc (t *T) New() {\n    value := getDynamicValue()\n    method := reflect.ValueOf(t).MethodByName(value)\n    fmt.Println(method.Call(nil))\n}\n\nfunc (t *T) Fake() {\n    fmt.Println(\"Fake!\")\n}\n\nfunc main() {\n    var t T\n    t.New()\n}\n\nfunc getDynamicValue() string {\n    return \"Fake\"\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 4, "last_activity_date": 1537805048, "creation_date": 1537805048, "answer_id": 52483257, "question_id": 52482777, "link": "https://stackoverflow.com/questions/52482777/using-reflect-to-call-method-of-struct-inside-struct-method/52483257#52483257", "title": "Using reflect to call method of struct inside struct method", "body": "<p>The problems are that:</p>\n\n<ul>\n<li><code>&amp;t</code> is passed to <code>ValueOf</code> instead of <code>t</code></li>\n<li>the <code>fake</code> method is not exported</li>\n</ul>\n\n<p>Here is a working example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"reflect\"\n\ntype T struct{}\n\nfunc (t *T) New() {\n    value := getDynamicValue()\n    method := reflect.ValueOf(t).MethodByName(value)\n    fmt.Println(method)\n}\n\nfunc (t *T) Method() {\n    fmt.Println(\"Hello world!\")\n}\n\nfunc main() {\n    var t T\n    t.New()\n}\n\nfunc getDynamicValue() string {\n    return \"Method\"\n}\n</code></pre>\n\n<p>Outputs</p>\n\n<p><code>0xec820</code></p>\n\n<p><a href=\"https://play.golang.org/p/r41oPdF7tR7\" rel=\"nofollow noreferrer\">Try it yourself</a></p>\n"}], "owner": {"reputation": 81, "user_id": 10393632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/170c88a4250c1d5dce8eb6c6c213564c?s=128&d=identicon&r=PG&f=1", "display_name": "superhup", "link": "https://stackoverflow.com/users/10393632/superhup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "closed_date": 1537861984, "accepted_answer_id": 52483257, "answer_count": 2, "score": -1, "last_activity_date": 1537805048, "creation_date": 1537803287, "question_id": 52482777, "link": "https://stackoverflow.com/questions/52482777/using-reflect-to-call-method-of-struct-inside-struct-method", "closed_reason": "Not suitable for this site", "title": "Using reflect to call method of struct inside struct method", "body": "<p>How can I use reflect to call method of struct, inside a struct method? e.g:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"reflect\"\n\ntype T struct{}\n\nfunc (t *T) New() {\n    value := getDynamicValue()\n    method := reflect.ValueOf(&amp;t).MethodByName(value)\n    fmt.Println(method)\n}\n\nfunc (t *T) fake() {\n    fmt.Println(\"Fake!\")\n}\n\nfunc main() {\n    var t T\n    t.New()\n}\n\nfunc getDynamicValue() string {\n    return \"fake\"\n}\n</code></pre>\n\n<p>The following code will print <code>&lt;invalid reflect.Value&gt;</code> even though <code>fake</code> exists.</p>\n\n<p>Thanks in advance! :)</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1537803623, "post_id": 52482442, "comment_id": 91907105, "body": "Because that library was explicitly written that way. This is not a quality of Go, but a design decision made in that particular third-party library. You would have to ask the author of the library why they chose to do it this way."}, {"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1537803997, "post_id": 52482442, "comment_id": 91907325, "body": "Understood. (I should try to get some more coffee, and then come back to this...)"}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1537802821, "creation_date": 1537802128, "last_edit_date": 1537802821, "question_id": 52482442, "link": "https://stackoverflow.com/questions/52482442/panic-because-parameters-must-be-struct-and-not-interface-in-web-router", "title": "Panic because parameters must be struct and not interface, in web.Router?", "body": "<p>In testing the following code:</p>\n\n<pre><code>package logHandler\n\nimport (\n    \"ezsoft/apiserver_sdk/context\"\n\n    \"github.com/hsoshiant/web\"\n)\n\n// Build simply builds a log handler router\n//\n// Parameters:\n//\n// - `mainRouter` : the main Router\n//\n// Returns:\n//\n// - a sub Router made specifically for logging\nfunc Build(mainRouter *web.Router) *web.Router {\n    return mainRouter.Subrouter(context.Context{}, \"/log\").\n        Post(\"/\", doLog)\n\n}\n</code></pre>\n\n<p>I hit a panic. <code>context.Context</code> is defined thus:</p>\n\n<pre><code>//BaseContext contains all the base context to be helpful when using the utilities\ntype BaseContext struct {\n    Session        session.Store\n    ResponseWriter *web.ResponseWriter\n    RequestReader  *web.Request\n}\n\n//Context contains all values needed when using the utilities\ntype Context struct {\n    BaseContext\n    JSONBody      map[string]interface{}\n    tokenHandler  *apiToken.APITokenHandlerSt\n    OAuthInstance *oAuth2.OAuth2St\n}\n</code></pre>\n\n<p>and with testability/flexibility in mind, the developers wrote the middleware functions to take <code>context.ContextIntf</code>, which <code>context.Context</code> implements, which is defined as follows: </p>\n\n<pre><code>//ContextIntf is the interface to use when using the context interface functions.\ntype ContextIntf interface {\n    SetUniversalHeaders(header map[string]string) map[string]string\n    GetInfo() *Context\n    GetOAuth() *oAuth2.OAuth2St\n}\n</code></pre>\n\n<p>Here's one such middleware func: </p>\n\n<pre><code>//AuthenticationMiddleware Middleware which handles all of the authentication.\nfunc AuthenticationMiddleware(mw AuthenticationMiddlewareIntf, context context.ContextIntf, w web.ResponseWriter, r *web.Request, next web.NextMiddlewareFunc) {\n    //Check if the url should be public.\n    for _, url := range mw.GetInfo().nonAuthURLs {\n        if url.Method == r.Method &amp;&amp; strings.Contains(r.URL.Path, url.DomainName) {\n            key := utilities.GetRemoteAdd(r) + \";\" + r.URL.Path\n            if timeSince, ok := NonAuthSecurityMap[key]; ok {\n                var (\n                    timeSinceTime, _  = time.Parse(time.UnixDate, timeSince)\n                    timeSinceDuration = time.Since(timeSinceTime)\n                )\n                if timeSinceDuration &lt; nonAuthTimeReset {\n                    // will sleep for `nonAuthTimeReset` - `timeSinceDuration` &gt; 0\n                    time.Sleep(-(timeSinceDuration - nonAuthTimeReset))\n                }\n            }\n            NonAuthSecurityMap[key] = time.Now().Format(time.UnixDate)\n            next(w, r)\n            return\n        }\n    }\n\n    if errSt := CheckForAuthorization(mw, context, r, w); errSt != nil {\n        responses.Write(w, responses.Unauthorized(*errSt))\n        return\n    }\n    defer context.GetInfo().Session.SessionRelease(w)\n    next(w, r)\n}\n</code></pre>\n\n<p>I am unsure which middleware business functions that <a href=\"https://github.com/HSoshiant/web\" rel=\"nofollow noreferrer\"><code>package web</code></a> is checking, let alone what business packages they reside in, and the call stack trace returns no such clues. </p>\n\n<p>The error I get is thus: </p>\n\n<hr>\n\n<pre><code>                            * You are adding a handler to a router with context type 'Context'\n                            *\n                            *\n                            * Your handler function can have one of these signatures:\n                            *\n                            * // If you don't need context:\n                            * func YourFunctionName(rw web.ResponseWriter, req *web.Request)\n                            *\n                            * // If you want your handler to accept a context:\n                            * func (c *Context) YourFunctionName(rw web.ResponseWriter, req *web.Request)  // or,\n                            * func YourFunctionName(c *Context, rw web.ResponseWriter, req *web.Request)\n                            *\n                            * Unfortunately, your function has this signature: func(context.ContextIntf, web.ResponseWriter, *web.Request)\n                            *\n                            ************************************************************************************************************************\n</code></pre>\n\n<p><strong>Why is this requesting a <code>Context</code> struct, instead of the <code>ContextIntf</code> that it implements?!</strong></p>\n\n<p><strong>The stack trace</strong></p>\n\n<p>Looks like this:</p>\n\n<pre><code>goroutine 20 [running]:\ntesting.tRunner.func1(0xc04213e1e0)\n    C:/Go/src/testing/testing.go:742 +0x2a4\npanic(0x7633c0, 0xc0421320a0)\n    C:/Go/src/runtime/panic.go:502 +0x237\ngithub.com/hsoshiant/web.validateHandler(0x778420, 0x80d8f0, 0x13, 0x8405c0, 0x7b7960)\n    D:/dev2017/GO/src/github.com/hsoshiant/web/router_setup.go:286 +0x242\ngithub.com/hsoshiant/web.(*Router).addRoute(0xc042106680, 0x7eeb93, 0x4, 0x7ee4bd, 0x1, 0x778420, 0x80d8f0, 0xc042051f80)\n    D:/dev2017/GO/src/github.com/hsoshiant/web/router_setup.go:223 +0x94\ngithub.com/hsoshiant/web.(*Router).Post(0xc042106680, 0x7ee4bd, 0x1, 0x778420, 0x80d8f0, 0xc042106680)\n    D:/dev2017/GO/src/github.com/hsoshiant/web/router_setup.go:193 +0x6f\nezsoft/apiserver_sdk/logger/logHandler.Build(0xc0421064e0, 0xc042051f40)\n    D:/dev2017/GO/src/ezsoft/apiserver_sdk/logger/logHandler/handler.go:20 +0xcf\nezsoft/apiserver_sdk/logger/logHandler.TestBuild.func1(0xc04213e1e0)\n    D:/dev2017/GO/src/ezsoft/apiserver_sdk/logger/logHandler/handler_test.go:16 +0x91\ntesting.tRunner(0xc04213e1e0, 0x80d8e0)\n    C:/Go/src/testing/testing.go:777 +0xd7\ncreated by testing.(*T).Run\n    C:/Go/src/testing/testing.go:824 +0x2e7\n</code></pre>\n\n<p><strong>UPDATE</strong> : It's hitting the private method <code>doLog</code>, which is defined thus: </p>\n\n<pre><code>func doLog(contextIntf context.ContextIntf, rw web.ResponseWriter, req *web.Request) {\n    var (\n        logType int    = 0\n        code    string = \"\"\n        message string = \"\"\n        context        = contextIntf.GetInfo()\n    )\n    if val, OK := context.JSONBody[\"type\"]; OK {\n        if val1, noErr := val.(float64); noErr {\n            logType = int(val1)\n        }\n    }\n    if logType == 0 {\n        responses.Write(rw, responses.FreeUnprocessableEntity(\"Type\"))\n        return\n    }\n\n    if val, OK := context.JSONBody[\"code\"]; OK {\n        if val1, noErr := val.(string); noErr {\n            code = val1\n        } else {\n            responses.Write(rw, responses.FreeUnprocessableEntity(\"Code\"))\n            return\n        }\n    }\n\n    if val, OK := context.JSONBody[\"message\"]; OK {\n        if val1, noErr := val.(string); noErr {\n            message = val1\n        }\n    }\n    if message == \"\" {\n        responses.Write(rw, responses.FreeUnprocessableEntity(\"message\"))\n        return\n    }\n    if code &gt; \"\" {\n        code = \" (\" + code + \") \"\n    }\n    switch logType {\n    case 1:\n        logger.Instance.LogError(code + message)\n    case 2:\n        logger.Instance.LogWarning(code + message)\n    case 3:\n        logger.Instance.LogInfo(code + message)\n    default:\n        logger.Instance.LogWarning(code + message)\n    }\n\n    responses.Write(rw, responses.OK(0))\n}\n</code></pre>\n\n<p>I still don't get why that argument needs to be a <code>context.Context</code>, or what I, the unit-tester, can do about it.</p>\n"}, {"tags": ["go", "unsafe"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1537809344, "post_id": 52481330, "comment_id": 91910111, "body": "Tip: if you want the size of some value, you may use <code>reflect</code> to avoid having to import and use <code>unsafe</code>, e.g. <code>reflect.TypeOf(Foo{}).Size()</code>."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1537841349, "post_id": 52481330, "comment_id": 91920228, "body": "There is indeed an issue by Rob Pike himself suggesting moving <code>Sizeof</code> out of <code>unsafe</code>. <a href=\"https://github.com/golang/go/issues/5602\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/5602</a>"}], "answers": [{"tags": [], "owner": {"reputation": 533, "user_id": 771564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bd4c92dcc00d019e3f6a2a858b803f?s=128&d=identicon&r=PG", "display_name": "Peter Mellett", "link": "https://stackoverflow.com/users/771564/peter-mellett"}, "is_accepted": false, "score": 2, "last_activity_date": 1537798747, "creation_date": 1537798747, "answer_id": 52481386, "question_id": 52481330, "link": "https://stackoverflow.com/questions/52481330/why-is-unsafe-sizeof-considered-unsafe/52481386#52481386", "title": "Why is unsafe.Sizeof considered unsafe?", "body": "<p>From the looks of the unsafe package the methods don't use go's type safety for their operations.</p>\n\n<p><a href=\"https://godoc.org/unsafe\" rel=\"nofollow noreferrer\">https://godoc.org/unsafe</a></p>\n\n<blockquote>\n  <p>Package unsafe contains operations that step around the type safety of\n  Go programs.</p>\n  \n  <p>Packages that import unsafe may be non-portable and are not protected\n  by the Go 1 compatibility guidelines.</p>\n</blockquote>\n\n<p>So from the sounds of it the unsafe-ness is in the kind of code being provided, not necessarily from calling it in particular</p>\n"}, {"tags": [], "owner": {"reputation": 2208, "user_id": 5328069, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21DZ0.jpg?s=128&g=1", "display_name": "morganbaz", "link": "https://stackoverflow.com/users/5328069/morganbaz"}, "is_accepted": true, "score": 7, "last_activity_date": 1537799954, "creation_date": 1537799954, "answer_id": 52481767, "question_id": 52481330, "link": "https://stackoverflow.com/questions/52481330/why-is-unsafe-sizeof-considered-unsafe/52481767#52481767", "title": "Why is unsafe.Sizeof considered unsafe?", "body": "<p>Because in Go if you need to call sizeof, it generally means you're manipulating memory directly, and you should never need to do that.</p>\n\n<p>If you come from the C world, you'll probably most often have used <code>sizeof</code> together with <code>malloc</code> to create a variable-length array - but this should not be needed in Go, where you can simply <code>make([]Foo, 10)</code>. In Go, the amount of memory to be allocated is taken care of by the runtime.</p>\n\n<p>You should not be afraid of calling <code>unsafe.Sizeof</code> where it really makes sense - but you should ask yourself whether you actually need it.</p>\n\n<p>Even if you're using it for, say, writing a binary format, it's generally a good idea to calculate by yourself the number of bytes you need, or if anything generate it dynamically using <code>reflect</code>:</p>\n\n<ul>\n<li>calling <code>unsafe.Sizeof</code> on a struct will also include the number of bytes added in for <a href=\"https://dave.cheney.net/2015/10/09/padding-is-hard\" rel=\"noreferrer\">padding</a>.</li>\n<li>calling it on dynamically-sized structures (ie. slices, strings) will yield the length of their headers - you should call <code>len()</code> instead.</li>\n</ul>\n\n<p>Using <code>unsafe</code> on a <code>uintptr</code>, <code>int</code> or <code>uint</code> to determine whether you're running on 32-bit or 64-bit? You can generally avoid that by specifying <code>int64</code> where you actually need to support numbers bigger than 2^31. Or, if you really need to detect that, you have many other options, such as build tags or something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nconst is32bit = ^uint(0) == (1 &lt;&lt; 32) - 1\n\nfunc main() {\n    fmt.Println(is32bit)\n}\n</code></pre>\n"}], "owner": {"reputation": 116, "user_id": 2739210, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jsexn.jpg?s=128&g=1", "display_name": "Josh", "link": "https://stackoverflow.com/users/2739210/josh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 965, "favorite_count": 0, "accepted_answer_id": 52481767, "answer_count": 2, "score": 6, "last_activity_date": 1537816088, "creation_date": 1537798540, "last_edit_date": 1537799177, "question_id": 52481330, "link": "https://stackoverflow.com/questions/52481330/why-is-unsafe-sizeof-considered-unsafe", "title": "Why is unsafe.Sizeof considered unsafe?", "body": "<p>Consider the following:</p>\n\n<pre><code>import (\n    \"log\"\n    \"unsafe\"\n)\n\ntype Foo struct {\n    Bar int32\n}\n\nfunc main() {\n    log.Println(int(unsafe.Sizeof(Foo{})))\n}\n</code></pre>\n\n<p>Why is determining the size of a variable considered unsafe, and a part of the unsafe package? I don't understand why obtaining the size of any type is an unsafe operation, or what mechanism go uses to determine its size that necessitates this. </p>\n\n<p>I would also love to know if there are any alternatives to the unsafe package for determining size of a known struct.</p>\n"}, {"tags": ["go", "threadpool"], "comments": [{"owner": {"reputation": 533, "user_id": 771564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bd4c92dcc00d019e3f6a2a858b803f?s=128&d=identicon&r=PG", "display_name": "Peter Mellett", "link": "https://stackoverflow.com/users/771564/peter-mellett"}, "edited": false, "score": 2, "creation_date": 1537798185, "post_id": 52481054, "comment_id": 91903825, "body": "When I run your code I get all the output. You&#39;re reading as far as the newline character- are you hitting enter after the 6?"}, {"owner": {"reputation": 41, "user_id": 2737382, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001283381579/picture?type=large", "display_name": "Joe Williams", "link": "https://stackoverflow.com/users/2737382/joe-williams"}, "reply_to_user": {"reputation": 533, "user_id": 771564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bd4c92dcc00d019e3f6a2a858b803f?s=128&d=identicon&r=PG", "display_name": "Peter Mellett", "link": "https://stackoverflow.com/users/771564/peter-mellett"}, "edited": false, "score": 0, "creation_date": 1537798815, "post_id": 52481054, "comment_id": 91904228, "body": "Yes, it prints out 1-5, but not 6. and it also sometimes skips inputs."}, {"owner": {"reputation": 533, "user_id": 771564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bd4c92dcc00d019e3f6a2a858b803f?s=128&d=identicon&r=PG", "display_name": "Peter Mellett", "link": "https://stackoverflow.com/users/771564/peter-mellett"}, "edited": false, "score": 0, "creation_date": 1537799064, "post_id": 52481054, "comment_id": 91904379, "body": "Are you sure missed inputs aren&#39;t just empty strings? If you just hit enter you get <code>Worker 1 said:</code> or equivalent"}, {"owner": {"reputation": 533, "user_id": 771564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bd4c92dcc00d019e3f6a2a858b803f?s=128&d=identicon&r=PG", "display_name": "Peter Mellett", "link": "https://stackoverflow.com/users/771564/peter-mellett"}, "edited": false, "score": 0, "creation_date": 1537799716, "post_id": 52481054, "comment_id": 91904764, "body": "I know it&#39;s not much help, but I recorded my terminal output here so you can see how it behaves for me: <a href=\"https://asciinema.org/a/XjMKZ9uZF2eApcLl3PkVjEg4M\" rel=\"nofollow noreferrer\">asciinema.org/a/XjMKZ9uZF2eApcLl3PkVjEg4M</a> I&#39;ve got <code>go version go1.10 linux&#47;amd64</code> on ubuntu 17.10"}, {"owner": {"reputation": 41, "user_id": 2737382, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001283381579/picture?type=large", "display_name": "Joe Williams", "link": "https://stackoverflow.com/users/2737382/joe-williams"}, "reply_to_user": {"reputation": 533, "user_id": 771564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bd4c92dcc00d019e3f6a2a858b803f?s=128&d=identicon&r=PG", "display_name": "Peter Mellett", "link": "https://stackoverflow.com/users/771564/peter-mellett"}, "edited": false, "score": 0, "creation_date": 1537990352, "post_id": 52481054, "comment_id": 91989454, "body": "Try it like 5 times faster."}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 2, "last_activity_date": 1537816308, "creation_date": 1537816308, "answer_id": 52485847, "question_id": 52481054, "link": "https://stackoverflow.com/questions/52481054/why-does-my-golang-workerpool-ignore-jobs/52485847#52485847", "title": "Why does my Golang Workerpool ignore jobs?", "body": "<p>Move <code>reader := bufio.NewReader(os.Stdin)</code> to just before the for loop</p>\n\n<p>I would guess if this is run repeatedly the waiting data in stdin is lost</p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 2737382, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001283381579/picture?type=large", "display_name": "Joe Williams", "link": "https://stackoverflow.com/users/2737382/joe-williams"}, "is_accepted": true, "score": 1, "last_activity_date": 1537990312, "creation_date": 1537990312, "answer_id": 52524879, "question_id": 52481054, "link": "https://stackoverflow.com/questions/52481054/why-does-my-golang-workerpool-ignore-jobs/52524879#52524879", "title": "Why does my Golang Workerpool ignore jobs?", "body": "<p>Apparently making the channel a buffered channel helped.</p>\n\n<pre><code>jobs := make(chan string, 3)\n</code></pre>\n\n<p>Thanks guys</p>\n"}], "owner": {"reputation": 41, "user_id": 2737382, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001283381579/picture?type=large", "display_name": "Joe Williams", "link": "https://stackoverflow.com/users/2737382/joe-williams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 52524879, "answer_count": 2, "score": 2, "last_activity_date": 1537990312, "creation_date": 1537797527, "last_edit_date": 1537862706, "question_id": 52481054, "link": "https://stackoverflow.com/questions/52481054/why-does-my-golang-workerpool-ignore-jobs", "title": "Why does my Golang Workerpool ignore jobs?", "body": "<p>I am trying to create a threadpool of workers that do jobs. </p>\n\n<p>This seems to  working fine, but it if I, for instance, input 1-6. It won't print out six. </p>\n\n<p>Can someone explain why and hopefully provide a fix for me?</p>\n\n<pre><code>// Golang Workerpool\n\nfunc worker(id int, jobs &lt;-chan string) {\n    fmt.Println(\"Worker\", id, \"initilized!\")\n        for {\n            s := &lt;- jobs\n            time.Sleep(2 * time.Second)\n            fmt.Println(\"Worker\", id, \"said:\", s);\n    }\n}\n\nfunc main() {\n    // In order to use our pool of workers we need to send\n    // them work and collect their results. We make 2\n    // channels for this.\n    jobs := make(chan string)\n\n    // This starts up 3 workers, initially blocked\n    // because there are no jobs yet.\n    for w := 1; w &lt;= 3; w++ {\n        go worker(w, jobs)\n    }\n\n    for {\n        reader := bufio.NewReader(os.Stdin)\n        text, _ := reader.ReadString('\\n')\n        jobs &lt;- text\n    }\n}\n</code></pre>\n"}, {"tags": ["linux", "go"], "comments": [{"owner": {"reputation": 31408, "user_id": 243245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aed5c13647d581ae231f019a886e05a8?s=128&d=identicon&r=PG", "display_name": "Rup", "link": "https://stackoverflow.com/users/243245/rup"}, "edited": false, "score": 1, "creation_date": 1537796846, "post_id": 52480795, "comment_id": 91902980, "body": "I don&#39;t know go, but if that really is file permissions then you should check the ownership and permissions of ~/.cache and its subfolders and files, specifically the one named."}, {"owner": {"reputation": 371, "user_id": 8693784, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QJm9v.png?s=128&g=1", "display_name": "EMKAY", "link": "https://stackoverflow.com/users/8693784/emkay"}, "reply_to_user": {"reputation": 31408, "user_id": 243245, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/aed5c13647d581ae231f019a886e05a8?s=128&d=identicon&r=PG", "display_name": "Rup", "link": "https://stackoverflow.com/users/243245/rup"}, "edited": false, "score": 0, "creation_date": 1537796949, "post_id": 52480795, "comment_id": 91903040, "body": "@Rup No i  have not entered into my root"}, {"owner": {"reputation": 533, "user_id": 771564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bd4c92dcc00d019e3f6a2a858b803f?s=128&d=identicon&r=PG", "display_name": "Peter Mellett", "link": "https://stackoverflow.com/users/771564/peter-mellett"}, "edited": false, "score": 0, "creation_date": 1537798487, "post_id": 52480795, "comment_id": 91904004, "body": "the <code>$HOME&#47;.cache</code> dir should be writeable by your user, so if it were me I&#39;d just <code>chown</code> the directory to my user and group and call it a day. I presume at some point go was run with <code>sudo</code> or something similar? - Can you provide examples of the commands you&#39;re running in your terminal?"}, {"owner": {"reputation": 3063, "user_id": 5075720, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kNyMGvaELDs/AAAAAAAAAAI/AAAAAAAAVnw/P1Rt8TFE2gc/photo.jpg?sz=128", "display_name": "PaSTE", "link": "https://stackoverflow.com/users/5075720/paste"}, "edited": false, "score": 0, "creation_date": 1537798501, "post_id": 52480795, "comment_id": 91904012, "body": "Can you check the output of <code>ls -ld &#47;home&#47;myname&#47;.cache&#47;go-build</code> and see what it reports?"}, {"owner": {"reputation": 371, "user_id": 8693784, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QJm9v.png?s=128&g=1", "display_name": "EMKAY", "link": "https://stackoverflow.com/users/8693784/emkay"}, "reply_to_user": {"reputation": 533, "user_id": 771564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bd4c92dcc00d019e3f6a2a858b803f?s=128&d=identicon&r=PG", "display_name": "Peter Mellett", "link": "https://stackoverflow.com/users/771564/peter-mellett"}, "edited": false, "score": 1, "creation_date": 1537800025, "post_id": 52480795, "comment_id": 91904966, "body": "@Peter Mellett Thank You. It worked after changing the permission"}, {"owner": {"reputation": 533, "user_id": 771564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bd4c92dcc00d019e3f6a2a858b803f?s=128&d=identicon&r=PG", "display_name": "Peter Mellett", "link": "https://stackoverflow.com/users/771564/peter-mellett"}, "edited": false, "score": 0, "creation_date": 1537864271, "post_id": 52480795, "comment_id": 91928096, "body": "@EMKAY I&#39;m glad you&#39;re up and running! I would recommend accepting Yaseen&#39;s answer as correct :-)"}, {"owner": {"reputation": 1081, "user_id": 1727470, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/lYHhp.png?s=128&g=1", "display_name": "Samy Bencherif", "link": "https://stackoverflow.com/users/1727470/samy-bencherif"}, "edited": false, "score": 0, "creation_date": 1567195417, "post_id": 52480795, "comment_id": 101905255, "body": "This question has been wrongfully downvoted. This cache error comes up when you run a program, by default, even if you don&#39;t care about caches. The program works, but stderr is polluted with some nonsense. This either a bug (happened on macOS for me btw) or just annoying. The question should be how to prevent the message, not how to elicit a machine specific fix. Some simple program that uses console I/O is very disturbed by a warning that has nothing to do with the program&#39;s operation."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 10390538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/upI1c.jpg?s=128&g=1", "display_name": "Yaseen", "link": "https://stackoverflow.com/users/10390538/yaseen"}, "is_accepted": false, "score": 2, "last_activity_date": 1537804683, "last_edit_date": 1537804683, "creation_date": 1537804352, "answer_id": 52483060, "question_id": 52480795, "link": "https://stackoverflow.com/questions/52480795/permission-denied-error-during-initialization/52483060#52483060", "title": "&quot;Permission denied&quot; error during initialization", "body": "<p>The error you are facing is that you don't have enough privileges to create/delete/modify inside the directory you are trying to work in.</p>\n\n<p><strong>How to solve it?</strong></p>\n\n<ul>\n<li><p>The easy way: You can solve this problem by changing the permissions of the directory you are working on by using the <code>chmod</code> command, for example: <code>sudo chmod -R 777 /testDir</code>. Using this you are allowing the owner - group - others to create, delete, and modify the directory + the sub directories (when <code>-R</code> is used). So i suggest you do <code>sudo chmod -R 754 /testDir</code> for now.</p></li>\n<li><p>The less easy way: You can use <code>chown</code> which means changing the ownership for the directory for both the owner and the group, for example <code>sudo chown -R newOwner:newGroup /testDir</code> and by that you have the ultimate ownership for the directory + the sub directories.</p></li>\n<li><p>The most easy yet a dangerous way: You can work in the directories as a <em>root</em> and do what ever you like, when you open up the terminal use the command <code>sudo -s</code> and enter your password to be a root user. Not Recommended because it can destroy system files if you used it wrong! see the risks here <a href=\"https://askubuntu.com/questions/16178/why-is-it-bad-to-log-in-as-root\">Why is it bad to log in as root?</a></p></li>\n</ul>\n"}], "owner": {"reputation": 371, "user_id": 8693784, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QJm9v.png?s=128&g=1", "display_name": "EMKAY", "link": "https://stackoverflow.com/users/8693784/emkay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3484, "favorite_count": 0, "closed_date": 1537860645, "answer_count": 1, "score": -1, "last_activity_date": 1537804683, "creation_date": 1537796724, "last_edit_date": 1537796796, "question_id": 52480795, "link": "https://stackoverflow.com/questions/52480795/permission-denied-error-during-initialization", "closed_reason": "Not suitable for this site", "title": "&quot;Permission denied&quot; error during initialization", "body": "<p>As I am new to Go, I am trying to execute my first Go code with terminal, as the code compiles and gives an output, But I am getting an error of initialization failure</p>\n\n<pre><code>go: disabling cache (/home/myname/.cache/go-build) due to initialization \nfailure: open /home/myname/.cache/go-build/log.txt: permission denied\n</code></pre>\n\n<p>How can I solve this?</p>\n"}, {"tags": ["go", "stdin"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 6, "creation_date": 1537796282, "post_id": 52480640, "comment_id": 91902580, "body": "You can pass a file path in as an argument, but there&#39;s no way to have both interactive and piped stdin. Either stdin is attached to the terminal, or it&#39;s coming from a file."}, {"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1537990598, "post_id": 52480640, "comment_id": 91989551, "body": "But wait, if data gets processed by the password prompt, why don&#39;t you save it as password variable, ask user the password then process it. Just change the location of your code blocks"}], "answers": [{"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 0, "last_activity_date": 1537816863, "creation_date": 1537816863, "answer_id": 52485993, "question_id": 52480640, "link": "https://stackoverflow.com/questions/52480640/how-to-postpone-reading-from-stdin/52485993#52485993", "title": "How to \u201cpostpone\u201d reading from STDIN", "body": "<p>You wont be able because the shell will close the stdin file descriptor once it has finished to write the content.</p>\n\n<p>Once stdin is closed you cant re open it, this is controlled by the shell.</p>\n\n<p>Check this program, to test this behavior</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\nfunc main() {\n    io.Copy(os.Stdout, os.Stdin)\n    fmt.Println(\"done\")\n    some := make([]byte, 100)\n    _, err := os.Stdin.Read(some)\n    fmt.Println(err)\n    fmt.Println(string(some))\n}\n</code></pre>\n\n<p>The output will be </p>\n\n<pre><code>$ echo \"some\" | go run main.go \nsome\ndone\nEOF\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 328, "user_id": 1176300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5382d5f3db26dfdd3d2a82db6dc99fc2?s=128&d=identicon&r=PG", "display_name": "Kokos", "link": "https://stackoverflow.com/users/1176300/kokos"}, "is_accepted": false, "score": 1, "last_activity_date": 1537990343, "last_edit_date": 1537990343, "creation_date": 1537989918, "answer_id": 52524818, "question_id": 52480640, "link": "https://stackoverflow.com/questions/52480640/how-to-postpone-reading-from-stdin/52524818#52524818", "title": "How to \u201cpostpone\u201d reading from STDIN", "body": "<p>Without any changes to your program, you can include password in stdin before json, eg (bash): <code>{echo pass; cat data.json; } | goprog</code>, or <code>cat pass.txt data.json | goprog</code></p>\n\n<p>For better method for password passing (eg environment or file descriptor) look at <code>sshpass</code>: <a href=\"https://linux.die.net/man/1/sshpass\" rel=\"nofollow noreferrer\">https://linux.die.net/man/1/sshpass</a></p>\n\n<hr>\n\n<p>You can also buffer all stdin, and reuse its content later (via io.Reader)</p>\n\n<hr>\n\n<p>Redesign your application logic to function which accept <code>io.Reader</code> as source of data to unmarshall.</p>\n\n<p>In <code>main()</code> pass <code>os.Stdin</code> to mentioned function if there is no file argument on command line, otherwise (try to) open file and pass it to unmarshalling function.</p>\n\n<hr>\n\n<p>Note: for deciding whether to print prompt or not you may use <code>isatty</code> like function, which tells if stdin is interactive: <a href=\"https://github.com/mattn/go-isatty\" rel=\"nofollow noreferrer\">https://github.com/mattn/go-isatty</a></p>\n"}], "owner": {"reputation": 1266, "user_id": 3656424, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3c56441e0f23ba66563c2dfd0e361b28?s=128&d=identicon&r=PG", "display_name": "Petr Shevtsov", "link": "https://stackoverflow.com/users/3656424/petr-shevtsov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1537990343, "creation_date": 1537796166, "question_id": 52480640, "link": "https://stackoverflow.com/questions/52480640/how-to-postpone-reading-from-stdin", "title": "How to \u201cpostpone\u201d reading from STDIN", "body": "<p>In this minimal working example I'm trying to do the following:</p>\n\n<ol>\n<li>Prompt user for password</li>\n<li>Unmarshal JSON either from files specified as arguments or from STDIN</li>\n</ol>\n\n<p>Here's the source code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"syscall\"\n\n    \"golang.org/x/crypto/ssh/terminal\"\n)\n\nconst correctPassword = \"secret\"\n\nfunc main() {\n    args := os.Args[1:]\n\n    var passwd string\n\n    for {\n        passwd = promptPassword()\n        if passwd == correctPassword {\n            log.Println(\"Correct password! Begin processing...\")\n            break\n        }\n        log.Println(\"Incorrect password!\")\n    }\n\n    if len(args) == 0 { // Read from stdin\n        log.Println(\"Reading from stdin\")\n        dec := json.NewDecoder(os.Stdin)\n        for {\n            var v interface{}\n            if err := dec.Decode(&amp;v); err == io.EOF {\n                break\n            } else if err != nil {\n                log.Fatal(err)\n            }\n            log.Printf(\"%#v\", v)\n        }\n    }\n\n    for _, fileName := range args {\n        log.Println(\"Reading from\", fileName)\n        f, err := os.Open(fileName)\n        if err != nil {\n            log.Println(err)\n            continue\n        }\n        defer f.Close()\n        dec := json.NewDecoder(f)\n        for {\n            var v interface{}\n            if err := dec.Decode(&amp;v); err == io.EOF {\n                break\n            } else if err != nil {\n                log.Fatal(err)\n            }\n            log.Printf(\"%#v\", v)\n        }\n    }\n}\n\nfunc promptPassword() (passwd string) {\n    for {\n        fmt.Fprintln(os.Stderr, \"Enter password:\")\n        b, _ := terminal.ReadPassword(int(syscall.Stdin))\n        passwd = string(b)\n        if passwd != \"\" {\n            break\n        }\n    }\n    return passwd\n}\n</code></pre>\n\n<p>Everything works all right except when already prepared data is piped or redirected (e.g. <code>go run main.go &lt; mydata.json</code>, or <code>echo 42 | go run main.go</code>, etc).</p>\n\n<p>When I pipe or redirect some data to the program, the data gets processed by the password prompt, not the JSON decoder part. Is there any way to at first prompt for the password, and only after process the incoming data?</p>\n\n<p>I was trying to <a href=\"https://stackoverflow.com/a/26567513/3656424\">detect if there's any data in STDIN</a> to read it and store in some temporary bytes slice, but I can't find how to close/truncate the STDIN, so it won't read data twice.</p>\n"}, {"tags": ["arrays", "loops", "dictionary", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1537793612, "post_id": 52479891, "comment_id": 91900759, "body": "Type assert <code>[]map[string]string</code> from that element, which you can loop over."}], "answers": [{"tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": true, "score": 6, "last_activity_date": 1537807145, "last_edit_date": 1537807145, "creation_date": 1537793709, "answer_id": 52479965, "question_id": 52479891, "link": "https://stackoverflow.com/questions/52479891/how-to-iterate-an-array-in-an-interface/52479965#52479965", "title": "How to iterate an array in an interface{}?", "body": "<p>You can't iterate over a value of type <code>interface{}</code>, which is the type you'll get returned from a lookup on any key in your map (since it has type <code>map[string]interface{}</code>).</p>\n\n<p>You should use a <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">type assertion</a> to obtain a value of that type, over which you can then range.</p>\n\n<pre><code>myElt := myMap[\"element\"]\nv, ok := myElt.([]map[string]string)\nif !ok {\n    // TODO: Handle the error\n}\n\nfor i, item := range v {\n    // TODO: do something with each map[string]string item in the slice\n}\n</code></pre>\n\n<p>Here's a <a href=\"https://play.golang.org/p/-EgpirlTq1k\" rel=\"nofollow noreferrer\">working playground example</a> using a contrived setup for those map types.</p>\n\n<hr>\n\n<p>If you know the value is of the specified slice type, you can omit the <code>ok</code> check in the type assertion. This might be the case if you are using someone else's generic map implementation (which has keys of type <code>interface{}</code>) and know you only ever populate it with values of type <code>[]map[string]string</code>. However, exercise caution: if you obtain a value <em>not</em> of this type from the map, and you omit the check, your program will panic.</p>\n"}], "owner": {"reputation": 103, "user_id": 10185451, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8035dd743c69e54ae059b900cd7b81c8?s=128&d=identicon&r=PG&f=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/10185451/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 0, "accepted_answer_id": 52479965, "answer_count": 1, "score": 0, "last_activity_date": 1537807145, "creation_date": 1537793524, "question_id": 52479891, "link": "https://stackoverflow.com/questions/52479891/how-to-iterate-an-array-in-an-interface", "title": "How to iterate an array in an interface{}?", "body": "<p>i have a map</p>\n\n<pre><code>myMap := make(map[string]interface{})\n</code></pre>\n\n<p>one of this map elements is array of []map[string]string</p>\n\n<pre><code>myMap[\"element\"] = []map[string]string\n</code></pre>\n\n<p>how can i iterate this array?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1537793515, "post_id": 52479739, "comment_id": 91900688, "body": "If the value stored in it is of type <code>[]map[string]int</code>, type assert <code>[]map[string]int</code> from it, not <code>[]interface{}</code>. If the value may be other slice types too, use a type switch."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1537793517, "post_id": 52479739, "comment_id": 91900691, "body": "The compiler tells you: You cannot. You have a  []map[string]int and this is totally different from a []interface{}."}, {"owner": {"reputation": 1153, "user_id": 7330731, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ag7zK.jpg?s=128&g=1", "display_name": "Boris K", "link": "https://stackoverflow.com/users/7330731/boris-k"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1537798062, "post_id": 52479739, "comment_id": 91903748, "body": "@icza It can be an array of anything"}], "answers": [{"comments": [{"owner": {"reputation": 1153, "user_id": 7330731, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ag7zK.jpg?s=128&g=1", "display_name": "Boris K", "link": "https://stackoverflow.com/users/7330731/boris-k"}, "edited": false, "score": 0, "creation_date": 1537797984, "post_id": 52480069, "comment_id": 91903702, "body": "I don&#39;t know the exact type of testStruct, only that it is an array of something, which I why I need a <code>[]interface{}</code>"}, {"owner": {"reputation": 3312, "user_id": 4175960, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QbvYc.png?s=128&g=1", "display_name": "Eddy Hernandez", "link": "https://stackoverflow.com/users/4175960/eddy-hernandez"}, "reply_to_user": {"reputation": 1153, "user_id": 7330731, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ag7zK.jpg?s=128&g=1", "display_name": "Boris K", "link": "https://stackoverflow.com/users/7330731/boris-k"}, "edited": false, "score": 0, "creation_date": 1537799739, "post_id": 52480069, "comment_id": 91904774, "body": "@BorisK You need to know what kind of types you can receive, for example: <a href=\"https://tour.golang.org/methods/16\" rel=\"nofollow noreferrer\">tour.golang.org/methods/16</a> let me if this helps you, and then I can change my response"}], "tags": [], "owner": {"reputation": 3312, "user_id": 4175960, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QbvYc.png?s=128&g=1", "display_name": "Eddy Hernandez", "link": "https://stackoverflow.com/users/4175960/eddy-hernandez"}, "is_accepted": false, "score": -1, "last_activity_date": 1537794379, "last_edit_date": 1537794379, "creation_date": 1537793997, "answer_id": 52480069, "question_id": 52479739, "link": "https://stackoverflow.com/questions/52479739/how-to-convert-interface-to-interfaces-slice/52480069#52480069", "title": "How to convert interface to interfaces slice?", "body": "<p>I think what you are looking is type assertion</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    parentStruct := map[string]interface{}{\n         \"test\": []map[string]int{\n          {\"a\": 1, \"b\": 2},\n          {\"c\": 3},\n        },\n   }\n\n   testStruct := parentStruct[\"test\"].([]map[string]int)\n\n   fmt.Println(testStruct)\n}\n</code></pre>\n\n<p>read this link: <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Type_assertions</a></p>\n\n<p><a href=\"https://play.golang.org/p/81uL2hgrN3l\" rel=\"nofollow noreferrer\">https://play.golang.org/p/81uL2hgrN3l</a></p>\n"}, {"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1537818137, "creation_date": 1537818137, "answer_id": 52486290, "question_id": 52479739, "link": "https://stackoverflow.com/questions/52479739/how-to-convert-interface-to-interfaces-slice/52486290#52486290", "title": "How to convert interface to interfaces slice?", "body": "<p>The point of the interface is to define the behaviour you want to use, if you use an empty interface, you know nothing about the types in that slice.  </p>\n\n<p>If you want to print it, you can use println or printf with no conversion.</p>\n\n<p>If you want to access it, and must allow any type, you can use reflect (slow and complex to use).</p>\n\n<p>If you want to acess it, and use common behaviour/ data that you can define functions for, define an interface, e.g. :</p>\n\n<pre><code>type Doer interface {\n Do() error\n}\nparentStruct := []Doer{...}\ntestStruct.Do()\n</code></pre>\n\n<p>If none of that works, wait for Go 2 and generics. </p>\n"}], "owner": {"reputation": 1153, "user_id": 7330731, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ag7zK.jpg?s=128&g=1", "display_name": "Boris K", "link": "https://stackoverflow.com/users/7330731/boris-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1840, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1537818137, "creation_date": 1537793073, "question_id": 52479739, "link": "https://stackoverflow.com/questions/52479739/how-to-convert-interface-to-interfaces-slice", "title": "How to convert interface to interfaces slice?", "body": "<p>My input is an <code>interface{}</code>, and I know it can be an array of any type.</p>\n\n<p>I'd like to read one of the elements of my input, so I try to convert my <code>interface{}</code> into an <code>[]interface{}</code>, but go will give me the following error:</p>\n\n<blockquote>\n  <p>panic: interface conversion: interface {} is []map[string]int, not []interface {}</p>\n</blockquote>\n\n<p>How can I do that conversion? (without reflect if possible).</p>\n\n<p><a href=\"https://play.golang.org/p/FWt5h2hoONs\" rel=\"nofollow noreferrer\">Playground test</a></p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "reflection", "go-reflect", "gofmt"], "answers": [{"comments": [{"owner": {"reputation": 5962, "user_id": 3873510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/YpJMi.jpg?s=128&g=1", "display_name": "Paul Razvan Berg", "link": "https://stackoverflow.com/users/3873510/paul-razvan-berg"}, "edited": false, "score": 0, "creation_date": 1537785894, "post_id": 52477530, "comment_id": 91896288, "body": "Oh yeah haha I skipped this part from the doc: <code>We call the String method explicitly because by default the fmt package digs into a reflect.Value to show the concrete value inside. The String method does not.</code>"}], "tags": [], "owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "is_accepted": true, "score": 1, "last_activity_date": 1537785602, "creation_date": 1537785602, "answer_id": 52477530, "question_id": 52477377, "link": "https://stackoverflow.com/questions/52477377/in-go-why-are-both-the-reflected-value-and-its-interface-the-same-when-printed/52477530#52477530", "title": "In go, why are both the reflected value and its interface the same when printed?", "body": "<p>This is a special case, which is documented on the <a href=\"https://golang.org/pkg/reflect/#Value.String\" rel=\"nofollow noreferrer\"><code>String()</code></a> method of <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a>. It states</p>\n\n<blockquote>\n  <p>The fmt package treats Values specially. It does not call their String method implicitly but instead prints the concrete values they hold.</p>\n</blockquote>\n"}], "owner": {"reputation": 5962, "user_id": 3873510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/YpJMi.jpg?s=128&g=1", "display_name": "Paul Razvan Berg", "link": "https://stackoverflow.com/users/3873510/paul-razvan-berg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 52477530, "answer_count": 1, "score": 0, "last_activity_date": 1537785602, "creation_date": 1537785031, "question_id": 52477377, "link": "https://stackoverflow.com/questions/52477377/in-go-why-are-both-the-reflected-value-and-its-interface-the-same-when-printed", "title": "In go, why are both the reflected value and its interface the same when printed?", "body": "<p>Excerpt from the <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\">Laws of Reflection</a>:</p>\n\n<blockquote>\n  <p>(Why not fmt.Println(v)? Because v is a reflect.Value; we want the\n  concrete value it holds.)</p>\n</blockquote>\n\n<p>This confuses me because the following code:</p>\n\n<pre><code>var x float64 = 3.4\nvar v = reflect.ValueOf(x)\n\nfmt.Println(\"value of x is:\", v)\ny := v.Interface().(float64) // y will have type float64.\nfmt.Println(\"interface of value of x is:\", y)\n</code></pre>\n\n<p>Prints the same output:</p>\n\n<blockquote>\n  <p>value of x is: 3.4</p>\n  \n  <p>interface of value of x is: 3.4</p>\n</blockquote>\n\n<p>Is it because <code>fmt</code> internally finds the concrete value for the reflected <code>v</code>?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1537784926, "post_id": 52476752, "comment_id": 91895782, "body": "Using a map makes the type a set, e.g. all values are unique. A slice wouldn&#39;t guarantee that."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1537794620, "post_id": 52476752, "comment_id": 91901454, "body": "@Peter, they&#39;re unmarshalled into a slice, then put into the map, at which point they&#39;re guaranteed unique, just as when they were marshalled. What&#39;s your concern?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1537794828, "post_id": 52476752, "comment_id": 91901608, "body": "@Adrian, I was commenting the last paragraph. Recommending to use a slice (outside the marshal/unmarshal methods) when set semantics are desired isn&#39;t appropriate."}], "tags": [], "owner": {"reputation": 1137, "user_id": 2660766, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/qiIdj.png?s=128&g=1", "display_name": "maksadbek", "link": "https://stackoverflow.com/users/2660766/maksadbek"}, "is_accepted": true, "score": 3, "last_activity_date": 1537782916, "creation_date": 1537782916, "answer_id": 52476752, "question_id": 52476454, "link": "https://stackoverflow.com/questions/52476454/unmarshal-mapped-structure/52476752#52476752", "title": "Unmarshal mapped structure", "body": "<p>You can decode json with the same way as you encoded(by taking only keys):</p>\n\n<pre><code>func (ts *times) UnmarshalJSON(b []byte) error {\n    var t []time.Time\n\n    err := json.Unmarshal(b, &amp;t)\n    if err != nil {\n        return err\n    }\n\n    for _, v := range t {\n        (*ts)[v] = struct{}{}\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>See: <a href=\"https://play.golang.org/p/0ViEBX_5iLw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0ViEBX_5iLw</a></p>\n\n<p>But, I highly recommend to use a slice type, not a map.\nThe decoded output is an array, so the type should also be an array too. </p>\n"}], "owner": {"reputation": 1103, "user_id": 8548036, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p7UDF.jpg?s=128&g=1", "display_name": "ncopiy", "link": "https://stackoverflow.com/users/8548036/ncopiy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 52476752, "answer_count": 1, "score": -1, "last_activity_date": 1537782916, "creation_date": 1537781857, "question_id": 52476454, "link": "https://stackoverflow.com/questions/52476454/unmarshal-mapped-structure", "title": "Unmarshal mapped structure", "body": "<p>First of all I have one structure:  </p>\n\n<pre><code>type times map[time.Time]struct{}\n</code></pre>\n\n<p>I need to write for it <code>Marshal</code>/<code>Unmarshal</code> methods for json converting. I've wrote <code>MarshalJSON</code> method, but do not understand how to write <code>UnmarshalJSON</code> method.  </p>\n\n<pre><code>func (ts times) keys() []time.Time {\n    res := make([]time.Time, 0, len(ts))\n    for key := range ts {\n        res = append(res, key)\n    }\n    return res\n}\n\nfunc (ts times) MarshalJSON() ([]byte, error) {\n    return json.Marshal(ts.keys())\n}\n\nfunc (ts *times) UnmarshalJSON(b []byte) (error) {\n    // ????\n}  \n</code></pre>\n\n<p>Any idea? </p>\n"}, {"tags": ["go", "ethereum"], "answers": [{"tags": [], "owner": {"reputation": 121, "user_id": 1443684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37888e0b7eefba8175fe00c52db35d2f?s=128&d=identicon&r=PG", "display_name": "thanhpham", "link": "https://stackoverflow.com/users/1443684/thanhpham"}, "is_accepted": false, "score": 0, "last_activity_date": 1537831748, "last_edit_date": 1537831748, "creation_date": 1537807898, "answer_id": 52484004, "question_id": 52475977, "link": "https://stackoverflow.com/questions/52475977/how-to-understand-rlphash-method-in-core-types-block-go/52484004#52484004", "title": "How to understand &#39;rlpHash&#39; method in core/types/block.go", "body": "<p>Some thoughts...hope it help:</p>\n\n<p>h[:0] -> create an empty slice from <code>h</code>...but it still refer to the same underlying array.</p>\n\n<p>The slice then is being passed to the method <code>hw.Sum(h[:0])</code>\nNote that when you passed a slice to a method, the target method can change value of the slice (because slice is a reference type, search relect.SliceHeader to see why)</p>\n\n<p>If you look at the method Sum. It's actually change the value of the slice <code>h</code> by below line of code:</p>\n\n<pre><code>return append(in, hash...)\n</code></pre>\n\n<p>So, the return statement do 2 jobs:</p>\n\n<ol>\n<li>Change the content of the slice <code>in</code> (<code>h</code> in our case) </li>\n<li>Return the slice <code>h</code></li>\n</ol>\n\n<p>They are using named return <code>h</code>, hence for me it's make the code a little bit difficult to read.</p>\n\n<p>By the way, the below code make it clear how the slice work (sorry if  not):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc Sum(in []byte) []byte {\n    return append(in, []byte{'a','b'}...)\n}\n\nfunc main() {\n    h := [4]byte{}\n    Sum(h[:0])\n    fmt.Printf(\"%s\\n\", h) //should print 'ab'\n}\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 10400327, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XWMVA4aPRBI/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DWmY2TnyjgROaytElXt28xWkF-VOQ/mo/photo.jpg?sz=128", "display_name": "henry", "link": "https://stackoverflow.com/users/10400327/henry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1537831748, "creation_date": 1537780261, "last_edit_date": 1537799744, "question_id": 52475977, "link": "https://stackoverflow.com/questions/52475977/how-to-understand-rlphash-method-in-core-types-block-go", "title": "How to understand &#39;rlpHash&#39; method in core/types/block.go", "body": "<p>the code:    </p>\n\n<pre><code>func rlpHash(x interface{}) (h common.Hash) {\n    hw := sha3.NewKeccak256()\n    rlp.Encode(hw, x)\n    hw.Sum(h[:0])\n    return h\n}\n</code></pre>\n\n<p>If useful:</p>\n\n<pre><code>func (d *state) Sum(in []byte) []byte {\n    dup := d.clone()\n    hash := make([]byte, dup.outputLen)\n    dup.Read(hash)\n    return append(in, hash...)\n}\n</code></pre>\n\n<p>Full code context see <a href=\"https://github.com/ethereum/go-ethereum/blob/master/core/types/block.go\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>How to understand 'h' here?</p>\n\n<p>Shouldn't assign a value to h first?</p>\n\n<p>'h[:0]' means a zero-value byte?</p>\n\n<p>What a 'h' returned exactly?</p>\n\n<p>'hw.Sum(h[:0])' has a return value ,just ignored?</p>\n\n<p>Confused...</p>\n"}, {"tags": ["docker", "go"], "answers": [{"tags": [], "owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "is_accepted": true, "score": 0, "last_activity_date": 1537782651, "creation_date": 1537782651, "answer_id": 52476672, "question_id": 52474543, "link": "https://stackoverflow.com/questions/52474543/golang-dep-doesnt-download-all-library-files/52476672#52476672", "title": "Golang dep doesn&#39;t download all library files", "body": "<p>You have version 1.13.1 as your constraint in the <code>Gopkg.toml</code> file, but <code>NewClientWithOpts()</code> was introduced after that version. You could either try setting the constraint as <code>branch = \"master\"</code> or <code>revision = \"&lt;latest_commit_sha&gt;\"</code>, or use the v1.13.1 release and look at docs for that specific version.</p>\n\n<p><code>dep</code> doesn't necessarily include all the files from a package - it only keeps sub-packages that are actually being used. That's not a problem in this case though.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 10089239, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WVx_axEF0bY/AAAAAAAAAAI/AAAAAAAAAAo/_0iQC3VYUIQ/photo.jpg?sz=128", "display_name": "Linus", "link": "https://stackoverflow.com/users/10089239/linus"}, "is_accepted": false, "score": 0, "last_activity_date": 1571143909, "creation_date": 1571143909, "answer_id": 58395176, "question_id": 52474543, "link": "https://stackoverflow.com/questions/52474543/golang-dep-doesnt-download-all-library-files/58395176#58395176", "title": "Golang dep doesn&#39;t download all library files", "body": "<p>If you set the <code>GO111MODULE=on</code>, the latest docker version is move to <code>v0.0.0</code>.</p>\n\n<p>The date of the suffix followed by <code>v0.0.0</code> is the relevant docker version number, such as <code>20190515185722</code> is the corresponding docker version <code>19.05</code>.</p>\n\n<p>So, you can run the command such as:  </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go get -v github.com/docker/docker@v0.0.0-0.20190515185722-34b56728ed71\n</code></pre>\n\n<p>You can get the version list by: <a href=\"https://goproxy.io/github.com/docker/docker/@v/\" rel=\"nofollow noreferrer\">https://goproxy.io/github.com/docker/docker/@v/</a></p>\n"}], "owner": {"reputation": 2246, "user_id": 7529562, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LvzXUtUqo1I/AAAAAAAAAAI/AAAAAAAAAAo/5pNfpegHXAE/photo.jpg?sz=128", "display_name": "nuclear", "link": "https://stackoverflow.com/users/7529562/nuclear"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 366, "favorite_count": 0, "accepted_answer_id": 52476672, "answer_count": 2, "score": 0, "last_activity_date": 1571144137, "creation_date": 1537774211, "last_edit_date": 1571144137, "question_id": 52474543, "link": "https://stackoverflow.com/questions/52474543/golang-dep-doesnt-download-all-library-files", "title": "Golang dep doesn&#39;t download all library files", "body": "<p>I use docker library in my <code>$GOPATH/src/github.com/docker</code>\nNow I'm trying to use <code>dep</code>. In my <code>gopkg.toml</code>, it has the following description:</p>\n\n<pre><code>[[constraint]]\n  name = \"github.com/docker/docker\"\n  version = \"1.13.1\"\n</code></pre>\n\n<p>But after <code>dep init</code> completed, all my codes tell me:</p>\n\n<pre><code>Unresolved reference 'NewClientWithOpts'\n</code></pre>\n\n<p>It used to work before I used the <code>dep</code>.</p>\n\n<pre><code>client.NewClientWithOpts(client.WithVersion(\"1.38\"))\n</code></pre>\n\n<hr>\n\n<p>When I look up my library from vendor, there are 105 files. But from my <code>src/github.com/docker/client</code>, It has 212 items!!</p>\n\n<hr>\n\n<p>My questions are:</p>\n\n<ul>\n<li>Why <code>dep</code> did not download all library files?</li>\n<li>How I solve this problem?</li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1537794673, "post_id": 52473818, "comment_id": 91901494, "body": "What command are you using that results in this error?"}, {"owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1537810399, "post_id": 52473818, "comment_id": 91910602, "body": "This is encountered with <code>go build</code>, <code>go run</code>, and <code>go test</code>. I&#39;ve added more description above."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1537895419, "post_id": 52473818, "comment_id": 91947516, "body": "I wonder if this this is a problem compiling the .qtpl.go file, and that it&#39;s only reporting the line number in the .qtpl file because of the directives like <code>&#47;&#47;line timeseries_page.qtpl:41</code> in <code>timeseries_page.qtpl.go</code>. That isn&#39;t a complete answer of course but might help you find the problem."}], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 148, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1537895013, "creation_date": 1537770935, "last_edit_date": 1537895013, "question_id": 52473818, "link": "https://stackoverflow.com/questions/52473818/how-to-stop-go-1-11-from-building-quicktemplate-qtpl-files", "title": "How to stop Go 1.11 from building quicktemplate .qtpl files?", "body": "<p>I have some Go packages that use <a href=\"https://github.com/valyala/quicktemplate\" rel=\"nofollow noreferrer\">quicktemplate</a>. Quicktemplate compiles template files with the <code>.qtpl</code> extension to Go files with the <code>.qtpl.go</code> extension using the <code>qtc</code> CLI app. In Go versions prior to 1.11, having <code>.qtpl</code> files in a Go package wasn't a problem as the <code>.qtpl</code> files would be ignored by the compiler. However, Go 1.11 appears to process <code>.qtpl</code> files, causing compilation failures.</p>\n\n<p>An example that works with Go 1.3-1.10 but not 1.11 is available here and described below.</p>\n\n<ul>\n<li>Source: <a href=\"https://github.com/grokify/gocharts/tree/master/charts/c3\" rel=\"nofollow noreferrer\">https://github.com/grokify/gocharts/tree/master/charts/c3</a></li>\n<li>Build Logs: <a href=\"https://travis-ci.org/grokify/gocharts/builds/431794367\" rel=\"nofollow noreferrer\">https://travis-ci.org/grokify/gocharts/builds/431794367</a> (Go 1.0-1.11)</li>\n</ul>\n\n<p>The package directory contains:</p>\n\n<ul>\n<li><code>timeseries_page.qtpl</code> template file</li>\n<li><code>timeseries_page.qtpl.go</code> template file compiled to Go using <code>qtc</code></li>\n</ul>\n\n<p>Previously, only the file ending in <code>.go</code> would be compiled and everything builds fine. With 1.11, there is an error thrown while parsing the <code>.qtpl</code> file which isn't intended to be built by the Go compiler.</p>\n\n<p>Here is a minimal Go program using that package will fail to build in Go 1.11, but work with 1.10.</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/grokify/gocharts/charts/c3\"\n)\n\nfunc main() {\n    _ = c3.C3Chart{}\n}\n</code></pre>\n\n<p>Here's the error showing the <code>timeseries_page.qtpl</code> file:</p>\n\n<pre><code>$ go build main.go\n# github.com/grokify/gocharts/charts/c3\ntimeseries_page.qtpl:42: undefined: TimeseriesHTML\ntimeseries_page.qtpl:48: undefined: TimeseriesHTML\n</code></pre>\n\n<p><code>TimeseriesHTML</code> is a function that is called in that template file and built by another quicktemplate file in the <a href=\"https://github.com/grokify/gocharts/blob/master/charts/c3/timeseries_js.qtpl.go#L120-L132\" rel=\"nofollow noreferrer\"><code>timeseries_js.qtpl.go</code> file</a>.</p>\n\n<p>The same result and output is encountered with the following:</p>\n\n<pre><code>$ go run main.go\n$ go test main.go\n</code></pre>\n\n<p>Is there a way to get back the prior Go behavior, or ignore <code>.qtpl</code> files during builds?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1537777892, "post_id": 52473017, "comment_id": 91892150, "body": "Calling <a href=\"https://golang.org/pkg/net/http/#Transport.CloseIdleConnections\" rel=\"nofollow noreferrer\">CloseIdleConnections</a> will give you a best-effort implementation, but no guarantees; if unlucky, a particular connection may always be in use at the time of calling CloseIdleConnections and it may close connections that are younger than 60 seconds. If that&#39;s not acceptable you can replace the client regularly with a new one, which creates a new, empty connection pool."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1537794942, "post_id": 52473017, "comment_id": 91901689, "body": "Creating a new Client <i>and passing in a new Transport</i> will create a new, empty connection pool. Just creating a new Client will, by default, use DefaultTransport, and its connection pool."}, {"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1548254611, "post_id": 52473017, "comment_id": 95477438, "body": "@Elliot I am also facing the similar problem. Did you solve the problem"}], "owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 231, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1537766155, "creation_date": 1537766155, "question_id": 52473017, "link": "https://stackoverflow.com/questions/52473017/how-to-limit-the-keep-alive-ttl-in-go-transport", "title": "How to limit the keep-alive TTL in Go Transport?", "body": "<p>We have a proxy service built in Go. It needs to communicate with another service however the connection is busy enough ~20 req/sec that Go never terminates the keep-alive connection.</p>\n\n<p>We don't want to completely disable the keep-alive, but rather have the connection gracefully closed after 60 seconds so it forces a reconnect.</p>\n\n<p>Is this possible with the Transport directly or how would it be done with a ticker?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "edited": false, "score": 0, "creation_date": 1537765474, "post_id": 52472170, "comment_id": 91887590, "body": "If you only interested in check if the file exists, you can use <a href=\"https://golang.org/pkg/os/#IsNotExist\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#IsNotExist</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "edited": false, "score": 1, "creation_date": 1537795109, "post_id": 52472170, "comment_id": 91901792, "body": "@Motakjuq not on that error, no."}], "answers": [{"tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": false, "score": 2, "last_activity_date": 1537775581, "creation_date": 1537775581, "answer_id": 52474835, "question_id": 52472170, "link": "https://stackoverflow.com/questions/52472170/how-to-properly-check-type-of-error-returned-by-plugin-open/52474835#52474835", "title": "How to properly check type of error returned by plugin.Open", "body": "\n\n<p>Inspection of <a href=\"https://github.com/golang/go/blob/ce536837d8e53f1bf0c7ef450d4580d19f7d6f52/src/plugin/plugin_dlopen.go#L46-L50\" rel=\"nofollow noreferrer\">the code</a> for <code>plugin.Open()</code> reveals the package calls out to some C code to determine whether the path exists. If it doesn't, it returns a plain error value. In particular, the package does not define any sentinel errors which you can compare against, nor does it return its own concrete implementer of the <code>error</code> interface which carries custom metadata. This is the code which produces that error:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>return nil, errors.New(`plugin.Open(\"` + name + `\"): realpath failed`)\n</code></pre>\n\n<p><code>errors.New</code> is a basic implementation of the <code>error</code> interface which doesn't allow any additional information to be passed. Unlike other locations in the standard library which return errors (such as path non-existent errors from the <code>os</code> package), you can't get such metadata in this instance.</p>\n\n<hr>\n\n<h1>Check whether the module file exists first</h1>\n\n<p>My preference would be to verify whether the module exists <em>before</em> attempting to load it, using the native capabilities provided by the <code>os</code> package:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>modulePath := \"./module.so\"\nif _, err := os.Stat(modulePath); os.IsNotExist(err) {\n    // Do whatever is required on module not existing\n}\n\n// Continue to load the module \u2013 can be another branch of the if block\n// above if necessary, depending on your desired control flow.\n</code></pre>\n\n<h1>Compare a subset of the error values</h1>\n\n<p>You could also use <code>strings.Contains</code> to search for the value <code>realpath failed</code> in the returned error value. <em>This is not a good idea</em> in the event that string changes in future, so if you adopt this pattern, at the very least you should ensure you have <em>rigorous tests around it</em> (and even then it's still not great).</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>_, err := plugin.Open(\"./module.so\")\nif err != nil {\n    if strings.Contains(err.Error(), \"realpath failed\") {\n        // Do your fallback behavior for module not existing\n        log.Fatalf(\"module doesn't exist\")\n    } else {\n        // Some other type of error\n        log.Fatalf(\"%+v\", err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 10393632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/170c88a4250c1d5dce8eb6c6c213564c?s=128&d=identicon&r=PG&f=1", "display_name": "superhup", "link": "https://stackoverflow.com/users/10393632/superhup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 390, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1537775581, "creation_date": 1537758130, "question_id": 52472170, "link": "https://stackoverflow.com/questions/52472170/how-to-properly-check-type-of-error-returned-by-plugin-open", "title": "How to properly check type of error returned by plugin.Open", "body": "<p>I would like to know how can I check the type of error returned by plugin.Open, e.g:</p>\n\n<pre><code>package main\n\nimport \"plugin\"\n\nfunc main() {\n  _, err := plugin.Open(\"./module.so\")\n  // here\n}\n</code></pre>\n\n<p>I would like to do something different if the error is:</p>\n\n<pre><code>plugin.Open(\"./module.so\"): realpath failed\n</code></pre>\n\n<p>Which basically means that the file doesn't exist.</p>\n\n<p>Example of desired result:</p>\n\n<pre><code>package main\n\nimport \"plugin\"\n\nfunc main() {\n  _, err := plugin.Open(\"./module.so\")\n  if err.Error() == \"plugin.Open(\\\"./module.so\\\"): realpath failed\" {\n    // do something different here\n  } else {\n    log.Fatal(err)\n  }\n}\n</code></pre>\n\n<p>The string that I pass to <code>plugin.Open</code> can have other values, so it needs to be something more smart than that.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1537756500, "post_id": 52471996, "comment_id": 91886005, "body": "Since you apparently know the types of your mappedPick entries why are you using interface{} and type-casting everywhere?"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1537756541, "post_id": 52471996, "comment_id": 91886013, "body": "Also you seem to know how a map works since mappedPick is a map. Why try to use append on a map when you already have code using maps correctly?"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1537756631, "post_id": 52471996, "comment_id": 91886027, "body": "Look at the Go tag info: <a href=\"https://stackoverflow.com/tags/go/info\">stackoverflow.com/tags/go/info</a> especially the language reference bit: <a href=\"https://golang.org/ref/spec#Map_types\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Map_types</a>"}, {"owner": {"reputation": 4209, "user_id": 3165255, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qd87N.jpg?s=128&g=1", "display_name": "IronGeek", "link": "https://stackoverflow.com/users/3165255/irongeek"}, "edited": false, "score": 0, "creation_date": 1537757026, "post_id": 52471996, "comment_id": 91886098, "body": "You probably wanted a <code>Slices</code> (<code>[]Outcome</code>) for the <code>outcomes</code> instead of <code>map[string]interface{}</code>"}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1537760991, "creation_date": 1537760991, "answer_id": 52472453, "question_id": 52471996, "link": "https://stackoverflow.com/questions/52471996/how-do-we-create-an-empty-map-and-append-new-data-in-golang/52472453#52472453", "title": "How do we create an empty map and append new data in golang?", "body": "<p>As the error clearly says:</p>\n\n<blockquote>\n  <p>first argument to append must be slice; have map[string]interface{}</p>\n</blockquote>\n\n<p>which means you need to create a slice before appending the data to outcomes which is actually slice of outcomes, like you have mentioned in the output you want. </p>\n\n<blockquote>\n  <p>The append function appends the elements x to the end of the slice s,\n  and grows the slice if a greater capacity is needed.</p>\n</blockquote>\n\n<p>Create a slice of <code>outcomes</code> and then append the data from <code>entryPicks</code> to that slice:</p>\n\n<pre><code>outcomes := make([]map[string]interface{})\nfor idx, pick := range entryPicks {\n    mappedPick := pick.(map[string]interface{})\n    outcomes = append(outcomes, Outcome{\n        QuestionIndex: idx,\n        ChoiceIndex:   mappedPick[\"index\"].(int64),\n        Correct:       mappedPick[\"correct\"].(bool),\n    })\n}\n</code></pre>\n\n<p>which will let you provide the outcome you want.</p>\n"}, {"tags": [], "owner": {"reputation": 140, "user_id": 5115007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3667e565469ab7020a2a4b6c0aeb4392?s=128&d=identicon&r=PG&f=1", "display_name": "Prabesh P", "link": "https://stackoverflow.com/users/5115007/prabesh-p"}, "is_accepted": false, "score": 1, "last_activity_date": 1537768743, "creation_date": 1537768743, "answer_id": 52473422, "question_id": 52471996, "link": "https://stackoverflow.com/questions/52471996/how-do-we-create-an-empty-map-and-append-new-data-in-golang/52473422#52473422", "title": "How do we create an empty map and append new data in golang?", "body": "<pre><code>type Outcome struct {\nQuestionIndex string\nChoiceIndex   int64\nCorrect       bool\n}\n\nfunc createEntryOutcome(e *entry.Entry) map[string]interface{} {\nentryPicks := e.Live.Picks\nvar outcomes []Outcome\nfor idx, pick := range entryPicks {\n    mappedPick := pick.(map[string]interface{})\n    outcomes = append(outcomes, Outcome{\n        QuestionIndex: idx,\n        ChoiceIndex:   mappedPick[\"index\"].(int64),\n        Correct:       mappedPick[\"correct\"].(bool),\n    })\n}\nreturn outcomes\n}\n</code></pre>\n\n<p>change <em><strong>outcomes := make(map[string]interface{})</strong></em> to <em><strong>var outcomes []Outcome</strong></em></p>\n"}], "owner": {"reputation": 47, "user_id": 5686580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69a857332b84c18499a2777a6010d37d?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/5686580/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1697, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1537768743, "creation_date": 1537755906, "question_id": 52471996, "link": "https://stackoverflow.com/questions/52471996/how-do-we-create-an-empty-map-and-append-new-data-in-golang", "title": "How do we create an empty map and append new data in golang?", "body": "<p>I'm having a problem with creating an empty map and append new data to it while looping on another map.</p>\n\n<p>this is the error i'm getting on my IDE.</p>\n\n<p><a href=\"https://i.stack.imgur.com/FJ33w.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/FJ33w.png\" alt=\"enter image description here\"></a> </p>\n\n<p>here's my data struct to be added to the map.</p>\n\n<pre><code>type Outcome struct {\nQuestionIndex string\nChoiceIndex   int64\nCorrect       bool\n}\n\nfunc createEntryOutcome(e *entry.Entry) map[string]interface{} {\nentryPicks := e.Live.Picks\noutcomes := make(map[string]interface{})\nfor idx, pick := range entryPicks {\n    mappedPick := pick.(map[string]interface{})\n    outcomes = append(outcomes, Outcome{\n        QuestionIndex: idx,\n        ChoiceIndex:   mappedPick[\"index\"].(int64),\n        Correct:       mappedPick[\"correct\"].(bool),\n    })\n}\nreturn outcomes\n}\n</code></pre>\n\n<p>i basically want something like below to be saved in the database.</p>\n\n<pre><code>[\n  {\n    qIndex: \"1\",\n    cIndex: 1,\n    correct: false,\n  },\n  {\n    qIndex: \"1\",\n    cIndex: 1,\n    correct: false,\n  },\n]\n</code></pre>\n\n<p>im new to golang and any help is appreciated. thanks</p>\n"}, {"tags": ["amazon-web-services", "go"], "comments": [{"owner": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "edited": false, "score": 0, "creation_date": 1537766049, "post_id": 52470994, "comment_id": 91887751, "body": "You are using <code>r</code> as a map, but it is a pointer to a struct. You can get the struct definition in <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/route53/#ListHostedZonesOutput\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/route53/#&zwnj;&#8203;ListHostedZonesOutpu&zwnj;&#8203;t</a>"}], "answers": [{"tags": [], "owner": {"reputation": 169, "user_id": 5225507, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c2b36e20306d068e0900f7f5d13b03a5?s=128&d=identicon&r=PG&f=1", "display_name": "SO03112", "link": "https://stackoverflow.com/users/5225507/so03112"}, "is_accepted": false, "score": 0, "last_activity_date": 1537744922, "creation_date": 1537744922, "answer_id": 52471094, "question_id": 52470994, "link": "https://stackoverflow.com/questions/52470994/route53-list-hosted-zones-output-throws-does-not-support-indexing-error/52471094#52471094", "title": "route53 list hosted zones output throws &quot;does not support indexing&quot; error", "body": "<p>This is an example of how to get the Id:  </p>\n\n<pre><code>fmt.Println(*r.HostedZones[0].Id)\n</code></pre>\n\n<p>Name:</p>\n\n<pre><code>fmt.Println(*r.HostedZones[0].Name)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": false, "score": 0, "last_activity_date": 1537754991, "creation_date": 1537754991, "answer_id": 52471922, "question_id": 52470994, "link": "https://stackoverflow.com/questions/52470994/route53-list-hosted-zones-output-throws-does-not-support-indexing-error/52471922#52471922", "title": "route53 list hosted zones output throws &quot;does not support indexing&quot; error", "body": "<p>you are probably trying to index with the pointer to your <code>struct</code>, your <code>r</code> is a pointer, you can get the deferenced value by doing <code>(*r)[\"yourkeyhere\"][\"index\"]</code>.</p>\n"}], "owner": {"reputation": 169, "user_id": 5225507, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c2b36e20306d068e0900f7f5d13b03a5?s=128&d=identicon&r=PG&f=1", "display_name": "SO03112", "link": "https://stackoverflow.com/users/5225507/so03112"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1537754991, "creation_date": 1537743632, "question_id": 52470994, "link": "https://stackoverflow.com/questions/52470994/route53-list-hosted-zones-output-throws-does-not-support-indexing-error", "title": "route53 list hosted zones output throws &quot;does not support indexing&quot; error", "body": "<p>I can't parse the output of the response below. </p>\n\n<p>When I include the line: </p>\n\n<pre><code>\"fmt.Println(*r[\"HostedZones\"][0])\"\n</code></pre>\n\n<p>it throws:</p>\n\n<pre><code>\"type *route53.ListHostedZonesOutput does not support indexing\". \n</code></pre>\n\n<p>I'd like to retrieve the \"Id\" and \"Name\" of each zone in the output. If the type doesn't support indexing, how can I retrieve the parts of the output I need?</p>\n\n<p>Thank you.</p>\n\n<pre><code>package main\n\nimport (\n        \"log\"\n        \"fmt\"\n        \"reflect\"\n        \"github.com/aws/aws-sdk-go/aws/session\"\n        \"github.com/aws/aws-sdk-go/service/route53\"\n)\n\nfunc main() {\n        r53 := route53.New(session.New())\n        r, err := r53.ListHostedZones(&amp;route53.ListHostedZonesInput{})\n        if err != nil {\n                log.Fatal(err)\n        }\n        log.Println(r)\n        fmt.Println(reflect.TypeOf(r))\n        fmt.Println(*r[\"HostedZones\"][0])\n}\n</code></pre>\n\n<p>sample output:</p>\n\n<pre><code>{\n  HostedZones: [{\n      CallerReference: \"5E95CADD-59E-A6\",\n      Config: {\n        PrivateZone: false\n      },\n      Id: \"/hostedzone/Z1Q1TZTO\",\n      Name: \"testzone.local.\",\n      ResourceRecordSetCount: 4\n    },{\n      CallerReference: \"39895A3C-9B8B-95C2A3\",\n      Config: {\n        PrivateZone: false\n      },\n      Id: \"/hostedzone/Z2MXJQ7\",\n      Name: \"2.168.192.in-addr.arpa.\",\n      ResourceRecordSetCount: 3\n    }],\n  IsTruncated: false,\n  MaxItems: \"100\"\n}\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "scheduler"], "answers": [{"tags": [], "owner": {"reputation": 48205, "user_id": 2989261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b03110b84c83464a58832d4d55ff4542?s=128&d=identicon&r=PG", "display_name": "Rico", "link": "https://stackoverflow.com/users/2989261/rico"}, "is_accepted": false, "score": 1, "last_activity_date": 1537752920, "creation_date": 1537752920, "answer_id": 52471734, "question_id": 52470789, "link": "https://stackoverflow.com/questions/52470789/deploy-a-custom-kubernetes-scheduler-as-a-pod/52471734#52471734", "title": "Deploy a custom kubernetes scheduler as a pod", "body": "<p>I believe this is well documented <a href=\"https://kubernetes.io/docs/tasks/administer-cluster/configure-multiple-schedulers/\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>Something like this for <code>my-scheduler.yaml</code>: </p>\n\n<pre><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: my-scheduler\n  namespace: kube-system\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: my-scheduler-as-kube-scheduler\nsubjects:\n- kind: ServiceAccount\n  name: my-scheduler\n  namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: kube-scheduler\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    component: scheduler\n    tier: control-plane\n  name: my-scheduler\n  namespace: kube-system\nspec:\n  selector:\n    matchLabels:\n      component: scheduler\n      tier: control-plane\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        component: scheduler\n        tier: control-plane\n        version: second\n    spec:\n      serviceAccountName: my-scheduler\n      containers:\n      - command:\n        - /usr/local/bin/kube-scheduler\n        - --address=0.0.0.0\n        - --leader-elect=false\n        - --scheduler-name=my-scheduler\n        image: gcr.io/my-gcp-project/my-kube-scheduler:1.0\n        livenessProbe:\n          httpGet:\n            path: /healthz\n            port: 10251\n          initialDelaySeconds: 15\n        name: kube-second-scheduler\n        readinessProbe:\n          httpGet:\n            path: /healthz\n            port: 10251\n        resources:\n          requests:\n            cpu: '0.1'\n        securityContext:\n          privileged: false\n        volumeMounts: []\n      hostNetwork: false\n      hostPID: false\n      volumes: []\n</code></pre>\n"}], "owner": {"reputation": 311, "user_id": 4721350, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-awJg3CY2LgQ/AAAAAAAAAAI/AAAAAAAAAGE/ZAtt5DIhiaI/photo.jpg?sz=128", "display_name": "Gofrane Haj Ahmed", "link": "https://stackoverflow.com/users/4721350/gofrane-haj-ahmed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1609696865, "creation_date": 1537741623, "last_edit_date": 1609696865, "question_id": 52470789, "link": "https://stackoverflow.com/questions/52470789/deploy-a-custom-kubernetes-scheduler-as-a-pod", "title": "Deploy a custom kubernetes scheduler as a pod", "body": "<p>How can I deploy a <strong>custom kubernetes scheduler</strong> as a <strong>pod</strong> where it is written with <strong>golang</strong> language ?</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1537742287, "post_id": 52470489, "comment_id": 91883682, "body": "<code>go vet</code> doesn&#39;t stop at 10 messages, it finds and prints all. How are you runnig it?"}, {"owner": {"reputation": 33459, "user_id": 928098, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/2761f0967c4a4b1839c1feee764c6dd7?s=128&d=identicon&r=PG", "display_name": "Kristian Glass", "link": "https://stackoverflow.com/users/928098/kristian-glass"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1537775351, "post_id": 52470489, "comment_id": 91891005, "body": "@icza I mean, it really does for me- running it with <code>go vet $packagename</code>, as stated"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1537776113, "post_id": 52470489, "comment_id": 91891372, "body": "Can you create a single file, put an <code>f()</code> function in it, and put 20 <code>return</code> statements in its body. Then run <code>go vet</code> on this package. This should give 19 messages (&quot;unreachable code&quot;). Do you get 19 messages?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1537776319, "post_id": 52470489, "comment_id": 91891459, "body": "Also, can you pass <code>-v</code> to vet, so it may display errors why it stops? <code>go vet -v</code>"}, {"owner": {"reputation": 33459, "user_id": 928098, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/2761f0967c4a4b1839c1feee764c6dd7?s=128&d=identicon&r=PG", "display_name": "Kristian Glass", "link": "https://stackoverflow.com/users/928098/kristian-glass"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1537778869, "post_id": 52470489, "comment_id": 91892626, "body": "Right, I suspect this is cgo related, thanks - I indeed got 19 messages out of the single pure Go file; <code>go vet -v</code> gives me no extra useful info"}], "owner": {"reputation": 33459, "user_id": 928098, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/2761f0967c4a4b1839c1feee764c6dd7?s=128&d=identicon&r=PG", "display_name": "Kristian Glass", "link": "https://stackoverflow.com/users/928098/kristian-glass"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 606, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1537778927, "creation_date": 1537738720, "last_edit_date": 1537778927, "question_id": 52470489, "link": "https://stackoverflow.com/questions/52470489/getting-all-errors-from-go-vet-with-cgo", "title": "Getting all errors from go vet with cgo", "body": "<p><code>go vet</code> and <code>go build</code> normally stop after finding 10 errors and abort with \"<code>too many errors</code>\" when run on a cgo codebase:</p>\n\n<pre><code>$ go version\ngo version go1.10 linux/amd64\n\n$ go vet loremipsum\nsrc/loremipsum/foo.go:103: invalid operation: _Ctype__Bool(IS_OK(c)) &amp;&amp; IS_EVIL(c) (mismatched types _Ctype__Bool and bool)\n# 9 other vet issues\nsrc/loremipsum/foo.go:203: too many errors\n</code></pre>\n\n<p>The project is large enough that each of these commands takes ~minutes to run, so I'd prefer to get a complete list of issues all at once.</p>\n\n<p>I can achieve this with <code>go build</code> by passing <code>-gcflags \"-e\"</code> (<a href=\"https://menno.io/posts/showing-all-go-compiler-errors/\" rel=\"nofollow noreferrer\">https://menno.io/posts/showing-all-go-compiler-errors/</a>)</p>\n\n<p>How can I do the same for <code>go vet</code> (which doesn't take a <code>-gcflags</code> parameter!)</p>\n"}, {"tags": ["authentication", "go", "cors", "mux", "negroni"], "comments": [{"owner": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 0, "creation_date": 1537739503, "post_id": 52470302, "comment_id": 91883196, "body": "Whatever web app is sending the requests, inspect it with browser devtools and look in the devtools console to see what error the browser is reporting about the preflight failing. Because if your middleware is only receiving the CORS preflight OPTIONS request, that would seem to indicate that the response the browser is receiving is not what the browser needs in order to decide the preflight has been successful. So the browser stops after the preflight fails, and never moves on to trying the POST."}, {"owner": {"reputation": 11, "user_id": 5815532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4adc13a58676550ac4f9f2820f7a0482?s=128&d=identicon&r=PG&f=1", "display_name": "lightningbolt6", "link": "https://stackoverflow.com/users/5815532/lightningbolt6"}, "reply_to_user": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 0, "creation_date": 1537822919, "post_id": 52470302, "comment_id": 91915872, "body": "So it appears like the browser actually is making the POST request, however the middleware is not being triggered and the request is making it as far as the handleLogin method as I can see the output of this in the server logs (it appears the auth request is succeeding and we are getting a 200 OK response). The CORS middleware is not running so we are still getting the &quot;No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource&quot; error in the devtools console (which seems very weird to me)."}, {"owner": {"reputation": 11, "user_id": 5815532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4adc13a58676550ac4f9f2820f7a0482?s=128&d=identicon&r=PG&f=1", "display_name": "lightningbolt6", "link": "https://stackoverflow.com/users/5815532/lightningbolt6"}, "reply_to_user": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 0, "creation_date": 1537822996, "post_id": 52470302, "comment_id": 91915901, "body": "Just to add, the middleware does appear to be adding all of the correct things to the OPTIONS request."}, {"owner": {"reputation": 11, "user_id": 5815532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4adc13a58676550ac4f9f2820f7a0482?s=128&d=identicon&r=PG&f=1", "display_name": "lightningbolt6", "link": "https://stackoverflow.com/users/5815532/lightningbolt6"}, "reply_to_user": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 0, "creation_date": 1537911639, "post_id": 52470302, "comment_id": 91954557, "body": "I have managed to get this working - rewrote my own middleware library without using Negroni - I can see and have full control over what&#39;s going on and can make sure everything is being called at the right times."}, {"owner": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "edited": false, "score": 0, "creation_date": 1537914877, "post_id": 52470302, "comment_id": 91955440, "body": "Cool \u2014 very glad to hear you got it working. And yeah sometimes rolling your own is the better way to go. As you describe, it has the advantage that you clearly know what it\u2019s doing (and can troubleshoot it, etc., more easily)."}], "owner": {"reputation": 11, "user_id": 5815532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4adc13a58676550ac4f9f2820f7a0482?s=128&d=identicon&r=PG&f=1", "display_name": "lightningbolt6", "link": "https://stackoverflow.com/users/5815532/lightningbolt6"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 659, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1537737224, "creation_date": 1537737224, "question_id": 52470302, "link": "https://stackoverflow.com/questions/52470302/negroni-cors-middleware-only-being-called-for-options-request", "title": "Negroni CORS Middleware only being called for OPTIONS request", "body": "<p>I am building a web app in Golang, using mux as a router and Negroni for managing middleware for the API.</p>\n\n<p>I have the following middleware:</p>\n\n<ul>\n<li>Authentication middleware which checks that the client has a valid session and returns 401 if not</li>\n<li>Middleware to allow CORS requests which is based on an edited version of <a href=\"https://github.com/rs/cors/\" rel=\"nofollow noreferrer\">https://github.com/rs/cors/</a></li>\n</ul>\n\n<p>I want to apply the middleware to specific routes as appropriate, i.e using the CORS middleware on all requests and checking auth only on the protected routes.</p>\n\n<p>What is actually happens for me when I try to make API requests using the frontend is that the CORS middleware seems only to get called for an initial OPTIONS request for each API route and is not subsequently used.</p>\n\n<p>For example:</p>\n\n<ul>\n<li>UI does a POST to /api/login with a JSON object containing the credentials</li>\n<li>In the browser console we see the initial preflight OPTIONS request getting a 200 OK with all the headers we set using handlePreflight in the corsMiddleware, so far so good.</li>\n<li>Then none of the subsequent POST requests hit the corsMiddleware. We know the middleware is never called as we never see it being called in the server log. We get the error \"No 'Access-Control-Allow-Origin' header is present on the requested resource\" in Chrome.</li>\n<li>The weird thing is that the function handleLogin <strong>is</strong> actually called, we can see the correct credentials and it appears that the server is correctly storing a session for them.</li>\n</ul>\n\n<p>We also see strange things on some of the other routes - i.e when making Postman GET requests to /api/entities we are able to get the list of entities (which should be protected) when not logged in. It is as if the authentication middleware is not being called or is not behaving as expected.</p>\n\n<p>I am fairly new to some of these concepts so perhaps I have misunderstood something. Any help would be appreciated.</p>\n\n<p>My code is as follows (main.go):</p>\n\n<pre><code>router := mux.NewRouter()\nrouter.HandleFunc(\"/\", ServeUI).Methods(\"GET\")\n\napiRouter := router.PathPrefix(\"/api\").Subrouter()\n\nauthRouter := apiRouter.PathPrefix(\"/auth\").Subrouter()\nauthRouter.HandleFunc(\"/login\", HandleLogin).Methods(\"POST\")\nauthRouter.HandleFunc(\"/logout\", HandleLogout).Methods(\"POST\")\n\nentitiesRouter := apiRouter.PathPrefix(\"/entities\").Subrouter()\nentitiesRouter.HandleFunc(\"/\", GetEntities).Methods(\"GET\")\n\ncommonAPIMiddleware := negroni.New(corsMiddleware.NewCorsMiddleware())\n\nrouter.PathPrefix(\"/api/auth\").Handler(commonAPIMiddleware.With(\n    negroni.Wrap(authRouter),\n))\n\nrouter.PathPrefix(\"/api/entities\").Handler(commonAPIMiddleware.With(\n    auth.NewAPIAuthMiddleware(),\n    negroni.Wrap(entitiesRouter),\n))\n\nn := negroni.New(negronilogrus.NewMiddleware())\nn.UseHandler(router)\nn.Run(\":8009\")\n</code></pre>\n\n<p>The code for corsMiddleware is as follows:</p>\n\n<pre><code>// CorsMiddleware allows CORS request for api routes\ntype CorsMiddleware struct {\n}\n\n// Negroni compatible interface\nfunc (m *CorsMiddleware) ServeHTTP(w http.ResponseWriter, r *http.Request, next http.HandlerFunc) {\n    log.Info(\"CORS MIDDLEWARE CALLED\")\n    if r.Method == http.MethodOptions &amp;&amp; r.Header.Get(\"Access-Control-Request-Method\") != \"\" {\n        log.Info(\"ServeHTTP: Preflight request\")\n        handlePreflight(w, r)\n        // Preflight requests are standalone and should stop the chain as some other\n        // middleware may not handle OPTIONS requests correctly. One typical example\n        // is authentication middleware ; OPTIONS requests won't carry authentication\n        // headers (see #1)\n\n        w.WriteHeader(http.StatusOK)\n    } else {\n        log.Info(\"ServeHTTP: Actual request\")\n        handleActualRequest(w, r)\n        next(w, r)\n    }\n}\n\n// handlePreflight handles pre-flight CORS requests\nfunc handlePreflight(w http.ResponseWriter, r *http.Request) {\n    headers := w.Header()\n    origin := r.Header.Get(\"Origin\")\n\n    if r.Method != http.MethodOptions {\n        log.Info(\"  Preflight aborted: %s!=OPTIONS\", r.Method)\n        return\n    }\n    // Always set Vary headers\n    // see https://github.com/rs/cors/issues/10,\n    //     https://github.com/rs/cors/commit/dbdca4d95feaa7511a46e6f1efb3b3aa505bc43f#commitcomment-12352001\n    headers.Add(\"Vary\", \"Origin\")\n    headers.Add(\"Vary\", \"Access-Control-Request-Method\")\n    headers.Add(\"Vary\", \"Access-Control-Request-Headers\")\n\n    if origin == \"\" {\n        log.Info(\"  Preflight aborted: empty origin\")\n        return\n    }\n    headers.Set(\"Access-Control-Allow-Origin\", origin)\n\n    // Spec says: Since the list of methods can be unbounded, simply returning the method indicated\n    // by Access-Control-Request-Method (if supported) can be enough\n    w.Header().Set(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, PUT, DELETE\")\n    headers.Set(\"Access-Control-Allow-Headers\", \"Content-Type, Content-Length, X-Requested-With\")\n    headers.Set(\"Access-Control-Allow-Credentials\", \"true\")\n    headers.Set(\"Access-Control-Max-Age\", strconv.Itoa(1000))\n    log.Info(\"  Preflight response headers: %v\", headers)\n}\n\n// handleActualRequest handles simple cross-origin requests, actual request or redirects\nfunc handleActualRequest(w http.ResponseWriter, r *http.Request) {\n    log.Info(\"CORS HANDLING ACTUAL REQUEST\")\n    headers := w.Header()\n    origin := r.Header.Get(\"Origin\")\n\n    if r.Method == http.MethodOptions {\n        log.Info(\"  Actual request no headers added: method == %s\", r.Method)\n        return\n    }\n    // Always set Vary, see https://github.com/rs/cors/issues/10\n    headers.Add(\"Vary\", \"Origin\")\n    if origin == \"\" {\n        log.Info(\"  Actual request no headers added: missing origin\")\n        return\n    }\n\n    headers.Set(\"Access-Control-Allow-Headers\", \"Content-Type, Content-Length, X-Requested-With\")\n    headers.Set(\"Access-Control-Allow-Credentials\", \"true\")\n\n    headers.Set(\"Access-Control-Allow-Origin\", origin)\n\n    if true {\n        headers.Set(\"Access-Control-Allow-Credentials\", \"true\")\n    }\n} \n</code></pre>\n"}, {"tags": ["go", "marshalling"], "answers": [{"comments": [{"owner": {"reputation": 2372, "user_id": 468778, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/XgvcC.jpg?s=128&g=1", "display_name": "Roger Hill", "link": "https://stackoverflow.com/users/468778/roger-hill"}, "edited": false, "score": 0, "creation_date": 1537745983, "post_id": 52470903, "comment_id": 91884298, "body": "That did the trick, thanks for the insight. By just passing back the interface itself, the marshaller is able to correctly determine the underlying type."}], "tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": false, "score": 2, "last_activity_date": 1537742774, "creation_date": 1537742774, "answer_id": 52470903, "question_id": 52470276, "link": "https://stackoverflow.com/questions/52470276/how-do-i-serialize-a-map-of-type-stringreflect-value/52470903#52470903", "title": "How do I serialize a map of type [string]reflect.Value?", "body": "\n\n<p>You're almost there: <code>reflect.Value</code> doesn't itself have a <code>Value</code> receiver method, nor does it need one. Changing your <code>MarshalJSON</code> implementation to the following works:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (p Prop) MarshalJSON() ([]byte, error) {\n    return json.Marshal(p.val.Interface())\n}\n</code></pre>\n\n<p>(i.e. dropping <code>.Value()</code> from the chain of function calls).</p>\n\n<p><a href=\"https://play.golang.org/p/HLdkgriNSf4\" rel=\"nofollow noreferrer\">Playground link</a></p>\n\n<p>(I don't like the use of <code>reflect</code> here \u2013 solutions relying on reflection are rarely clear and understandable, but it seems you can't change the upstream data structure, besides choosing not to use it.)</p>\n"}], "owner": {"reputation": 2372, "user_id": 468778, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/XgvcC.jpg?s=128&g=1", "display_name": "Roger Hill", "link": "https://stackoverflow.com/users/468778/roger-hill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1537742920, "creation_date": 1537736992, "question_id": 52470276, "link": "https://stackoverflow.com/questions/52470276/how-do-i-serialize-a-map-of-type-stringreflect-value", "title": "How do I serialize a map of type [string]reflect.Value?", "body": "<p>I have been trying to work out how to get this to work, and I am stuck.</p>\n\n<p>I have an object that looks like this:</p>\n\n<pre><code>type PropSet map[string]*Prop\n\ntype Prop struct {\n    val reflect.Value\n}\n</code></pre>\n\n<p>and I need to generate a JSON representation of all the key value pairs that it holds. I have been reading posts on SO talking about how to marshal more mundane types, but I have not been able to figure out how to deal with the reflect.Value type. I think I should be able to do something simple like this:</p>\n\n<pre><code>func (p Prop) MarshalJSON() ([]byte, error) {\n    return json.Marshal(p.val.Value().Interface())\n}\n</code></pre>\n\n<p>... but it just isn't working. Any suggestions?</p>\n\n<p>Additional note: I didn't write the data structure, but the reason that I think it is using the reflect.Value for the map value is that the values that we are expecting can be ints, floats, strings etc. So this is essentially needs to do some sort of type inference with base interface to figure out the return result.</p>\n"}, {"tags": ["sorting", "dictionary", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 8, "creation_date": 1537732803, "post_id": 52469714, "comment_id": 91881477, "body": "Maps are not ordered, so your initial map is just a set of key-value pairs. The <code>json</code> package orders entries by key to provide a consistent output. If it wouldn&#39;t, entries in the output would appear in random order, and only occasionally in the same order as your input. So if order matters, you have to have some data structure describing your order already, please post that. To keep that order in the output, you have to write a custom marshaler. If you don&#39;t have anything designating the order, then those 2 maps are considered identical."}, {"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 3, "creation_date": 1537736348, "post_id": 52469714, "comment_id": 91882406, "body": "You shouldn&#39;t be relying on the order of keys in a JSON object..."}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": -1, "last_activity_date": 1537794124, "last_edit_date": 1537794124, "creation_date": 1537736144, "answer_id": 52470170, "question_id": 52469714, "link": "https://stackoverflow.com/questions/52469714/how-to-prevent-a-map-from-sorting/52470170#52470170", "title": "how to prevent a map from sorting?", "body": "<p>To answer the original question use an ordered map</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"github.com/iancoleman/orderedmap\"\n)\n\nfunc main() {\n\n    o := orderedmap.New()\n\n    // use Set instead of o[\"a\"] = 1\n\n    o.Set(\"m_key\", \"123\") // go json.Marshall doesn't like integers\n    o.Set(\"z_key\", \"123\")\n    o.Set(\"a_key\", \"123\")\n    o.Set(\"f_key\", \"123\")\n\n    // serialize to a json string using encoding/json\n    prettyBytes, _ := json.Marshal(o)\n    fmt.Printf(\"%s\", prettyBytes)\n}\n</code></pre>\n\n<p>But according the spec <a href=\"https://json-schema.org/latest/json-schema-core.html#rfc.section.4.2\" rel=\"nofollow noreferrer\">https://json-schema.org/latest/json-schema-core.html#rfc.section.4.2</a>\nthere is no guarantee that the ordering of maps is honoured, so it's probably better to use an array instead for json output</p>\n\n<pre><code>   // convert to array\n    fmt.Printf(\"\\n\\n\\n\")\n    arr := make([]string, 8)\n    c := 0\n    for _, k := range o.Keys() {\n            arr[c] = k\n            c++\n            v, _ := o.Get(k)\n            arr[c], _ = v.(string)\n            c++\n    }\n\n    morePretty, _ := json.Marshal(arr)\n    fmt.Printf(\"%s\", morePretty)\n</code></pre>\n\n<p>When the array is reloaded it will be in the correct order</p>\n"}], "owner": {"reputation": 103, "user_id": 10185451, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8035dd743c69e54ae059b900cd7b81c8?s=128&d=identicon&r=PG&f=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/10185451/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 238, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1537794124, "creation_date": 1537732340, "question_id": 52469714, "link": "https://stackoverflow.com/questions/52469714/how-to-prevent-a-map-from-sorting", "title": "how to prevent a map from sorting?", "body": "<p>I have a map</p>\n\n<pre><code>{\n\"m_key\": 123,\n\"z_key\": 123,\n\"a_key\": 123,\n\"f_key\": 123\n}\n</code></pre>\n\n<p>When i'm trying to make a json from it and print it my json becomes sorted by key and i get json:</p>\n\n<pre><code>{\n\"a_key\": 123,\n\"f_key\": 123,\n\"m_key\": 123,\n\"z_key\": 123\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": true, "score": 2, "last_activity_date": 1537831575, "last_edit_date": 1537831575, "creation_date": 1537731813, "answer_id": 52469663, "question_id": 52469378, "link": "https://stackoverflow.com/questions/52469378/go-skip-function/52469663#52469663", "title": "Go skip function", "body": "<p>The login function is not being skipped, though it will never print anything out.  The line:</p>\n\n<pre><code>nameCorrect = name\n</code></pre>\n\n<p>sets the nameCorrect to be the same as name followed by:</p>\n\n<pre><code>for !(nameCorrect == name) {\n</code></pre>\n\n<p>which will only execute if name and nameCorrect are different.  You can see this by adding the line:</p>\n\n<pre><code>fmt.Printf(\"Name: '%s', nameCorrect: '%s', !(nameCorrect == name): %t\\n\", name, nameCorrect, !(nameCorrect == name))\n</code></pre>\n\n<p>which will print:</p>\n\n<pre><code>Name: '', nameCorrect: '', !(nameCorrect == name): false\n</code></pre>\n\n<p>I think you do not want to have the <code>nameCorrect = name</code> line.</p>\n"}], "owner": {"reputation": 62, "user_id": 10404936, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vULjox2JXcQ/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DXwC4NLadwCw2RZOCe14SgZUqF8kQ/mo/photo.jpg?sz=128", "display_name": "Lucas Oliveira Ferreira", "link": "https://stackoverflow.com/users/10404936/lucas-oliveira-ferreira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 52469663, "answer_count": 1, "score": -1, "last_activity_date": 1537831575, "creation_date": 1537729719, "last_edit_date": 1537730392, "question_id": 52469378, "link": "https://stackoverflow.com/questions/52469378/go-skip-function", "title": "Go skip function", "body": "<p>I am trying to make this code run, but he skips function login</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nvar name string\nvar password string\n\nfunc getName() {\n    fmt.Print(\"What's your name : \\n\")\n    fmt.Scanf(\"%s\", &amp;name)\n}\n\nfunc showName() {\n    fmt.Print(\"Your name is \" + name + \"\\n\")\n}\n\nfunc getPassword() {\n    fmt.Print(\"What's your password : \\n\")\n    fmt.Scanf(\"%s \\n\", &amp;password)\n}\n\nfunc singOrLog() {\n    var input string\n    input = \"\"\n    var loop bool\n    loop = false\n\n    for loop == false {\n        fmt.Print(\"Do you want to make an account or login (0 for register and 1 login) : \")\n        fmt.Scanf(\"%s \\n\", &amp;input)\n\n        if input == \"0\" {\n            register()\n            loop = true\n        } else if input == \"1\" {\n            login()\n            loop = true\n        }\n    }\n}\n\nfunc login() {\n    var nameCorrect string\n    nameCorrect = name\n    for !(nameCorrect == name) {\n        fmt.Print(\"What's your name :\\n\")\n        fmt.Scanf(\"%s\", &amp;nameCorrect)\n    }\n}\n\nfunc register() {\n    getName()\n    showName()\n    getPassword()\n    login()\n}\n\nfunc main() {\n    singOrLog()\n}\n</code></pre>\n"}, {"tags": ["google-maps", "go", "geo", "polyline"], "comments": [{"owner": {"reputation": 27113, "user_id": 5140781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GkAfu.jpg?s=128&g=1", "display_name": "xomena", "link": "https://stackoverflow.com/users/5140781/xomena"}, "edited": false, "score": 0, "creation_date": 1537731109, "post_id": 52468462, "comment_id": 91881015, "body": "Have a look at implementation of the <code>isLocationOnEdge</code> for Android SDK written in Java and try to port it to Go: <a href=\"https://github.com/googlemaps/android-maps-utils/blob/master/library/src/com/google/maps/android/PolyUtil.java\" rel=\"nofollow noreferrer\">github.com/googlemaps/android-maps-utils/blob/master/library&zwnj;&#8203;/&hellip;</a>"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1537732901, "post_id": 52468462, "comment_id": 91881502, "body": "find the equation of the line between any two points in the polyline and then see of the point in question is solved by that equation"}], "owner": {"reputation": 53, "user_id": 3292885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fcded50f9ffa4068eba3ca8195a3f1e?s=128&d=identicon&r=PG&f=1", "display_name": "user3292885", "link": "https://stackoverflow.com/users/3292885/user3292885"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 261, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1537814989, "creation_date": 1537722755, "last_edit_date": 1537814989, "question_id": 52468462, "link": "https://stackoverflow.com/questions/52468462/how-do-i-implement-islocationonedge-of-google-maps-api-in-go", "title": "How do I implement isLocationOnEdge of Google Maps API in Go?", "body": "<p>I am using google maps API through <a href=\"https://godoc.org/googlemaps.github.io/maps\" rel=\"nofollow noreferrer\">this library</a>. I have a route that I got using the direction API. Now I need to know whether given point is on the polyline. Google JS geometry library has function <a href=\"https://developers.google.com/maps/documentation/javascript/geometry#isLocationOnEdge\" rel=\"nofollow noreferrer\">isLocationOnEdge</a>. But I can't find something similar in Golang.</p>\n"}, {"tags": ["go", "integration-testing"], "answers": [{"tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": false, "score": 3, "last_activity_date": 1537718922, "creation_date": 1537718922, "answer_id": 52467922, "question_id": 52467809, "link": "https://stackoverflow.com/questions/52467809/mock-up-go-echo-context/52467922#52467922", "title": "Mock up Go Echo context", "body": "<p>The problem is probably that you are passing json-encoded data without specifying the <code>Content-Type</code> header.</p>\n\n<p>Add <code>req.Header.Set(echo.HeaderContentType, echo.MIMEApplicationJSON)</code> to your code, and it should work:</p>\n\n<pre><code>req := httptest.NewRequest(echo.GET, \"http://localhost:1323/admin/user_points/settings/get\", nil)\nreq.Header.Set(echo.HeaderContentType, echo.MIMEApplicationJSON)\n\nrec := httptest.NewRecorder()\n\nc := e.NewContext(req, rec)\ng := p.GetRates(c)\n\nassert.Equal(s.T(), \"success\", g)\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 2546756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6de84bb45df9d332c63b44078d16c686?s=128&d=identicon&r=PG", "display_name": "smiletrl", "link": "https://stackoverflow.com/users/2546756/smiletrl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 696, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1537718922, "creation_date": 1537718116, "question_id": 52467809, "link": "https://stackoverflow.com/questions/52467809/mock-up-go-echo-context", "title": "Mock up Go Echo context", "body": "<p>I'm trying to test a route handler of Go echo.</p>\n\n<p>Code looks like following:</p>\n\n<pre><code>p := NewPoint(s.db)\n\n// Update the deduction and exchange rate.\ne := echo.New()\n\nmapD := map[string]string{\"exchange_cash\": \"5\", \"exchange_point\": \"7\"}\nmapB, _ := json.Marshal(mapD)\nreq := httptest.NewRequest(echo.POST, \"http://localhost:1323/settings/update/exchange\", bytes.NewReader(mapB))\n//req := httptest.NewRequest(echo.POST, \"/settings/update/exchange\", bytes.NewReader(mapB))\nrec := httptest.NewRecorder()\nc := e.NewContext(req, rec)\n\nu := p.UpdateDeductionRate(c)\nassert.Equal(s.T(), \"success\", u)\n</code></pre>\n\n<p>Yet this keeps give error like \"Unsupported Media Type\"</p>\n\n<p>For Get test, code is like</p>\n\n<pre><code>req := httptest.NewRequest(echo.GET, \"http://localhost:1323/admin/user_points/settings/get\", nil)\n//req := httptest.NewRequest(echo.GET, \"/admin/user_points/settings/get\", nil)\nrec := httptest.NewRecorder()\nc := e.NewContext(req, rec)\ng := p.GetRates(c)\nassert.Equal(s.T(), \"success\", g)\n</code></pre>\n\n<p>g is nil. It looks like the hander p.UpdateDeductionRate(c echo.Context),  p.GetRates(c echo.Context) is not called at all.</p>\n\n<p>I feel like the echo.Context is not constructed correctly. Anyone has idea? Thanks!</p>\n"}, {"tags": ["go", "abstract-syntax-tree"], "answers": [{"comments": [{"owner": {"reputation": 14735, "user_id": 167814, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/53ee4a3bcfdb4e8f4c37991900ab48ef?s=128&d=identicon&r=PG", "display_name": "Abhijeet Rastogi", "link": "https://stackoverflow.com/users/167814/abhijeet-rastogi"}, "edited": false, "score": 0, "creation_date": 1537721124, "post_id": 52467649, "comment_id": 91878188, "body": "Oops, <code>type visitor</code> is an interface, all it really wants is &quot;something&quot;  that has the method <code>Visit</code>. Hence, a pointer can be passed too. Thank you @ThunderCat."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1537717007, "creation_date": 1537717007, "answer_id": 52467649, "question_id": 52467542, "link": "https://stackoverflow.com/questions/52467542/keep-track-of-ast-walk-parsing-errors-in-go/52467649#52467649", "title": "Keep track of ast.Walk() parsing errors in Go", "body": "<p>Collecting the errors in a struct is a good approach, but you need to use a pointer receiver to make it work.  </p>\n\n<pre><code>func (v *visitor) Visit(n ast.Node) ast.Visitor {  // change to pointer receiver\n     ...\n}\n\n...\n\nvar v visitor\nast.Walk(&amp;v, astTree) // pass pointer to visitor\n</code></pre>\n"}], "owner": {"reputation": 14735, "user_id": 167814, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/53ee4a3bcfdb4e8f4c37991900ab48ef?s=128&d=identicon&r=PG", "display_name": "Abhijeet Rastogi", "link": "https://stackoverflow.com/users/167814/abhijeet-rastogi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 52467649, "answer_count": 1, "score": 0, "last_activity_date": 1537717007, "creation_date": 1537716215, "question_id": 52467542, "link": "https://stackoverflow.com/questions/52467542/keep-track-of-ast-walk-parsing-errors-in-go", "title": "Keep track of ast.Walk() parsing errors in Go", "body": "<p>I'm writing a custom parser and would like to keep track of errors I come across. How do I keep track of errors during parsing without using a global variable when doing a <code>ast.Walk</code>? </p>\n\n<pre><code>type visitor struct {\n    err error\n}\n\nfunc (v visitor) Visit(n ast.Node) ast.Visitor {\n    switch d := n.(type) {\n    case *ast.BinaryExpr:\n        if d.Op != token.LAND {\n            v.err = fmt.Errorf(\"Illegal operator :%s\", d.Op) // NOT WORKING\n                return v\n        }\n    }\n    return v\n}\n</code></pre>\n\n<p>I use the above code as:-</p>\n\n<pre><code>var v visitor\nast.Walk(v, astTree)\n</code></pre>\n\n<p>This probably doesn't work as, in <code>func (v visitor)</code>, v is not a pointer to struct. What's the recommended way of keeping track of this?</p>\n"}, {"tags": ["go", "redis"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 7039175, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mGaLdPdfTpY/AAAAAAAAAAI/AAAAAAAAABE/3gGVvjjdhzs/photo.jpg?sz=128", "display_name": "Arief Kahfi", "link": "https://stackoverflow.com/users/7039175/arief-kahfi"}, "edited": false, "score": 0, "creation_date": 1537717051, "post_id": 52467498, "comment_id": 91877062, "body": "ok, that solve a problem :), inside <code>writeToServer()</code> routine, i add <code>time.Sleep()</code> after writing to server, so the output comes out three times, but if i dont <code>sleep</code> after write to server, the code fallthrough. does <code>time.Sleep()</code> let <code>readFromServer()</code> routine to work for printing to os.Stdout ?"}, {"owner": {"reputation": 23, "user_id": 7039175, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mGaLdPdfTpY/AAAAAAAAAAI/AAAAAAAAABE/3gGVvjjdhzs/photo.jpg?sz=128", "display_name": "Arief Kahfi", "link": "https://stackoverflow.com/users/7039175/arief-kahfi"}, "edited": false, "score": 0, "creation_date": 1537724964, "post_id": 52467498, "comment_id": 91879326, "body": "yep, that&#39;s right. i just refactored the code, you can check it <a href=\"https://play.golang.org/p/SoE6ir_33dl\" rel=\"nofollow noreferrer\">here</a>, i&#39;ve just added <code>isRead</code> channel to program, to make sure program read all responses written before it exits. is that correct ?"}, {"owner": {"reputation": 23, "user_id": 7039175, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mGaLdPdfTpY/AAAAAAAAAAI/AAAAAAAAABE/3gGVvjjdhzs/photo.jpg?sz=128", "display_name": "Arief Kahfi", "link": "https://stackoverflow.com/users/7039175/arief-kahfi"}, "edited": false, "score": 0, "creation_date": 1537730793, "post_id": 52467498, "comment_id": 91880932, "body": "how about <a href=\"https://play.golang.org/p/QGTEijBJVS4\" rel=\"nofollow noreferrer\">this</a> ?, if it&#39;s not solved, can you provide with your code snippet ?"}, {"owner": {"reputation": 23, "user_id": 7039175, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mGaLdPdfTpY/AAAAAAAAAAI/AAAAAAAAABE/3gGVvjjdhzs/photo.jpg?sz=128", "display_name": "Arief Kahfi", "link": "https://stackoverflow.com/users/7039175/arief-kahfi"}, "edited": false, "score": 0, "creation_date": 1537747739, "post_id": 52467498, "comment_id": 91884578, "body": "but , does my code <a href=\"https://play.golang.org/p/QGTEijBJVS4\" rel=\"nofollow noreferrer\">before</a>, guarantee waiting read and write finished ?, i need an answer, because i am new to concurrent programming :)"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1537716597, "last_edit_date": 1537716597, "creation_date": 1537715900, "answer_id": 52467498, "question_id": 52467359, "link": "https://stackoverflow.com/questions/52467359/tcp-to-redis-server-with-channel-stuck/52467498#52467498", "title": "TCP to Redis server with channel stuck", "body": "<p>The readFromServer function receives one value from the isWrite channel and then blocks in the call to io.Copy. The io.Copy function does not return until EOF or some error reading or writing data.  All of the program output is from the single call to io.Copy.</p>\n\n<p>The second send to isWrite in sendToServer blocks.\nThe isWrite channel is an unbuffered channel. A send on an unbuffered channel does not proceed until there's a receiver. There is no receiver on the channel because readFromServer is blocked in the call to io.Copy.</p>\n\n<p>Possible fixes are:</p>\n\n<ul>\n<li><p>The fix is to modify readFromServer to parse the RESP protocol and read exactly one message per iteration in the loop. </p></li>\n<li><p>Replace for loop in readFromServer with a single call to io.Copy.</p></li>\n</ul>\n\n<p>The isWrite channel is not needed. </p>\n\n<p>The program does not ensure that readFromServer reads all of the responses from writeToServer before the program exits. </p>\n"}], "owner": {"reputation": 23, "user_id": 7039175, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mGaLdPdfTpY/AAAAAAAAAAI/AAAAAAAAABE/3gGVvjjdhzs/photo.jpg?sz=128", "display_name": "Arief Kahfi", "link": "https://stackoverflow.com/users/7039175/arief-kahfi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 52467498, "answer_count": 1, "score": 0, "last_activity_date": 1537717432, "creation_date": 1537714868, "last_edit_date": 1537717432, "question_id": 52467359, "link": "https://stackoverflow.com/questions/52467359/tcp-to-redis-server-with-channel-stuck", "title": "TCP to Redis server with channel stuck", "body": "<p>I need to send <code>echo aaa</code> three times to redis server,\nbut its get stuck in the middle of process, I also check\nif <code>read</code> and <code>write</code> operation get error message, but it doesn't.\nso, why it get stuck in the middle of process?</p>\n\n<pre><code>package main\n\n\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"io\"\n    \"net\"\n    \"sync\"\n)\n\nvar (\n    wg = new(sync.WaitGroup)\n)\n\nfunc readFromServer(isWrite chan bool, r io.Reader) {\n    for {\n        select {\n        case &lt;-isWrite:\n            _ , err := io.Copy(os.Stdout, r)\n            if err != nil {\n                panic(err)\n            }\n        }\n    }\n}\n\nfunc writeToServer(conn net.Conn , isWrite chan bool ){\n    defer wg.Done()\n    for i :=0; i&lt;3; i++{\n        _ , err := conn.Write([]byte(\"*2\\r\\n$4\\r\\necho\\r\\n$3\\r\\naaa\\r\\n\"))\n        if err != nil {\n            panic(err)\n        }\n        isWrite&lt;- true\n    }\n}\n\nfunc main(){\n    wg.Add(1)\n\n    conn ,err := net.Dial(\"tcp\",\"127.0.0.1:6379\")\n    isWrite := make(chan bool)\n\n    if err != nil {\n        panic(err)\n    }\n\n    go readFromServer(isWrite, conn)\n    go writeToServer(conn , isWrite)\n\n\n\n    wg.Wait()\n    fmt.Println(\"finished...\")\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$3\naaa\n$3\naaa\nStuck here...\n</code></pre>\n"}, {"tags": ["json", "loops", "go", "interface"], "comments": [{"owner": {"reputation": 611, "user_id": 4281077, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3oOg40JdTy4/AAAAAAAAAAI/AAAAAAAAHNQ/jB3IczOZSFE/photo.jpg?sz=128", "display_name": "Karthik Nayak", "link": "https://stackoverflow.com/users/4281077/karthik-nayak"}, "edited": false, "score": 1, "creation_date": 1537708998, "post_id": 52466447, "comment_id": 91874616, "body": "It&#39;s always helpful to post about what you tried."}, {"owner": {"reputation": 480, "user_id": 9551463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a12d16f997ae9e9660098cd90d7e77c?s=128&d=identicon&r=PG&f=1", "display_name": "General Omosco", "link": "https://stackoverflow.com/users/9551463/general-omosco"}, "reply_to_user": {"reputation": 611, "user_id": 4281077, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3oOg40JdTy4/AAAAAAAAAAI/AAAAAAAAHNQ/jB3IczOZSFE/photo.jpg?sz=128", "display_name": "Karthik Nayak", "link": "https://stackoverflow.com/users/4281077/karthik-nayak"}, "edited": false, "score": 0, "creation_date": 1537709237, "post_id": 52466447, "comment_id": 91874694, "body": "Yes, But that is what i&#39;m trying since without success"}], "answers": [{"tags": [], "owner": {"reputation": 480, "user_id": 9551463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a12d16f997ae9e9660098cd90d7e77c?s=128&d=identicon&r=PG&f=1", "display_name": "General Omosco", "link": "https://stackoverflow.com/users/9551463/general-omosco"}, "is_accepted": false, "score": 1, "last_activity_date": 1537736860, "creation_date": 1537736860, "answer_id": 52470252, "question_id": 52466447, "link": "https://stackoverflow.com/questions/52466447/loop-through-json-keys-and-values-and-same-time-replacing-specify-matched-value/52470252#52470252", "title": "Loop through JSON keys and values and same time replacing specify matched value in golang", "body": "<p>I finally succeeded in getting keys/values and can same time replace any values or keys now, but the last step i'm battling now is how can i get the <code>aMap[key]</code> and <code>anArray[i]</code> paths respectively of all values. E.g   <code>\"test2\": \"TEST EACH REPLACE \"</code> has a path of <code>outterJSON.innerJSON1.nnerInnerArray.1.test2</code> but can be in any format.</p>\n\n<p><a href=\"https://play.golang.org/p/TNkonE8AkoJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/TNkonE8AkoJ</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"   \n)\n var co=\"\"\nfunc main() {\n    //Creating the maps for JSON\n    m := map[string]interface{}{}\n\n    //Parsing/Unmarshalling JSON encoding/json\n    err := json.Unmarshal([]byte(input), &amp;m)\n\n    if err != nil {\n        panic(err)\n    }\n    parseMap(m)\n\n    fmt.Println(co)\n\n    data, _ := json.MarshalIndent(m,\"\", \"  \")\n    fmt.Println(string(data))\n}\n\nfunc parseMap(aMap map[string]interface{}) {\n    for key, val := range aMap {\n        switch concreteVal := val.(type) {\n        case map[string]interface{}:\n\n        co += key+\".\"\n            fmt.Println(key+\"NwHN\")\n            parseMap(val.(map[string]interface{}))\n\n        case []interface{}:\n        co += key+\".\"\n            fmt.Println(key+\"NHN\")\n            parseArray(val.([]interface{}))\n\n        default:\n\n        fmt.Println(\"OOOOO\")\n        aMap[key]=\"TEST EACH REPLACE \"\n            fmt.Println(key, \"v:\", concreteVal)\n\n        }\n    }\n}\n\nfunc parseArray(anArray []interface{}) {\n    for i, val := range anArray {\n        switch concreteVal := val.(type) {\n        case map[string]interface{}:\n\n            fmt.Println(\"Indexr:\", i)\n            parseMap(val.(map[string]interface{}))\n\n        case []interface{}:\n\n            fmt.Println(\"Indexb:\", i)\n            parseArray(val.([]interface{}))\n\n\n        default:\n        anArray[i]= \"TEST EACH REPLACE ARR\"\n            fmt.Println(\"Index\", i, \":\", concreteVal)\n\n        }\n    }\n}\n\nconst input = `\n{\n\"ouj\":\"ou\",\n    \"outterJSON\":{\n        \"innerJSON1\":{\n            \"value1\":10,\n            \"value2\":22\n            ,\n            \"InnerInnerArray\": [ \"test1\" , {\"test2\":\"valtest2\"}],\n            \"InnerInnerJSONArray\": [ {\"fld1\" : \"val1\"} , {\"fld2\" : \"val2\"} ]\n            },\n            \"InnerJSON2\":\"NoneValue\"\n        }\n    }\n    `\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 480, "user_id": 9551463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a12d16f997ae9e9660098cd90d7e77c?s=128&d=identicon&r=PG&f=1", "display_name": "General Omosco", "link": "https://stackoverflow.com/users/9551463/general-omosco"}, "is_accepted": true, "score": 1, "last_activity_date": 1550092249, "last_edit_date": 1550092249, "creation_date": 1538000334, "answer_id": 52526767, "question_id": 52466447, "link": "https://stackoverflow.com/questions/52466447/loop-through-json-keys-and-values-and-same-time-replacing-specify-matched-value/52526767#52526767", "title": "Loop through JSON keys and values and same time replacing specify matched value in golang", "body": "<p>Finally! I completed the full specification of what i were looking for!!</p>\n\n<p><a href=\"https://play.golang.org/p/eN4-FjaQS97\" rel=\"nofollow noreferrer\">https://play.golang.org/p/eN4-FjaQS97</a></p>\n\n<pre><code>   package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    b := []byte(`\n        {\n        \"iw\":{\"Ie\":{\"Itye\":{\"e\":\"eIe\"}}},\n\"InnerJSON2\":\"NoneValue\",\n    \"outterJSON\":{\n        \"innerJSON1\":{\n            \"value1\":10,\n            \"value2\":22\n            ,\n            \"InnerInnerArray\": [ \"test1\" , \"test2\"],\n            \"InnerInnerJSONArray\": [ {\"fld1\" : \"val1\"} , {\"fld2\" : \"val2\"} ]\n            },\n            \"InnerJSON2\":\"NoneValue\"\n        }\n    }\n    `)\n\n    f := map[string]interface{}{}\n    if err := json.Unmarshal(b, &amp;f); err != nil {\n        panic(err)\n    }\n\n    verifyJSON(f)\n    data, _ := json.MarshalIndent(f, \"\", \"  \")\n    fmt.Println(string(data))\n}\n\nfunc verifyJSON(bv interface{}) {\n\n    var dumpJSON func(v interface{}, kn string)\n\n    dumpJSON = func(v interface{}, kn string) {\n        iterMap := func(x map[string]interface{}, root string) {\n\n            var knf string\n            if root == \"root\" {\n                knf = \"%v/%v\"\n            } else {\n                knf = \"%v/%v\"\n            }\n            for k, v := range x {\n\n                switch vv := v.(type) {\n\n                case map[string]interface{}:\n\n                    fmt.Printf(\"%s =&gt; (map[string]interface{}) ...\\n\", fmt.Sprintf(knf, root, k))\n\n                case []interface{}:\n                    fmt.Printf(\"%s =&gt; ([]interface{}) ...\\n\", fmt.Sprintf(knf, root, k))\n                default:\n                    fmt.Printf(\"%s =&gt; %v\\n\", fmt.Sprintf(knf, root, k), vv)\n                    x[k] = \"rgk\"\n                }\n                dumpJSON(v, fmt.Sprintf(knf, root, k))\n            }\n        }\n\n        iterSlice := func(x []interface{}, root string) {\n            var knf string\n            if root == \"root\" {\n                knf = \"%v/%v\"\n\n            } else {\n                knf = \"%v/%v\"\n            }\n            for k, v := range x {\n\n                switch vv := v.(type) {\n\n                case map[string]interface{}:\n\n                    fmt.Printf(\"%s =&gt; (map[string]interface{}) ...\\n\", fmt.Sprintf(knf, root, k))\n\n                case []interface{}:\n                    fmt.Printf(\"%s =&gt; ([]interface{}) ...\\n\", fmt.Sprintf(knf, root, k))\n                default:\n\n                    fmt.Printf(\"%s =&gt; %v\\n\", fmt.Sprintf(knf, root, k), vv)\n\n                    x[k] = \"rg\"\n                }\n\n                dumpJSON(v, fmt.Sprintf(knf, root, k))\n            }\n        }\n\n        switch vv := v.(type) {\n        case map[string]interface{}:\n            iterMap(vv, kn)\n        case []interface{}:\n            iterSlice(vv, kn)\n        default:\n\n        }\n    }\n    dumpJSON(bv, \"root\")\n}\n</code></pre>\n"}], "owner": {"reputation": 480, "user_id": 9551463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a12d16f997ae9e9660098cd90d7e77c?s=128&d=identicon&r=PG&f=1", "display_name": "General Omosco", "link": "https://stackoverflow.com/users/9551463/general-omosco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1173, "favorite_count": 1, "accepted_answer_id": 52526767, "answer_count": 2, "score": 1, "last_activity_date": 1550092249, "creation_date": 1537708586, "last_edit_date": 1537709006, "question_id": 52466447, "link": "https://stackoverflow.com/questions/52466447/loop-through-json-keys-and-values-and-same-time-replacing-specify-matched-value", "title": "Loop through JSON keys and values and same time replacing specify matched value in golang", "body": "<p>Is there any way to loop all over keys and values of json and thereby confirming and replacing a specific value by matched path or matched compared key or value and simultaneously creating a new interface of out of the json after being confirmed with the key new value in Golang.</p>\n\n<p>This an example i saw that loops through all values <a href=\"https://play.golang.org/p/xtiT2iGocBg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/xtiT2iGocBg</a> but i have no idea of replacing values by matched path or value</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 5945, "user_id": 2664985, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/b481e39808c4dd2db7a66c1931a9bb08?s=128&d=identicon&r=PG", "display_name": "Jack Wilsdon", "link": "https://stackoverflow.com/users/2664985/jack-wilsdon"}, "edited": false, "score": 1, "creation_date": 1537724890, "post_id": 52465888, "comment_id": 91879306, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28881072/how-to-add-c-files-in-a-subdirectory-as-part-of-go-build-by-using-pseudo-cgo-dir\">How to add C files in a subdirectory as part of go build by using pseudo CGO directives?</a>"}, {"owner": {"reputation": 1031, "user_id": 1107514, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/36ef13d2c481eec643c6298213d70f21?s=128&d=identicon&r=PG", "display_name": "Leonid Shagabutdinov", "link": "https://stackoverflow.com/users/1107514/leonid-shagabutdinov"}, "reply_to_user": {"reputation": 5945, "user_id": 2664985, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/b481e39808c4dd2db7a66c1931a9bb08?s=128&d=identicon&r=PG", "display_name": "Jack Wilsdon", "link": "https://stackoverflow.com/users/2664985/jack-wilsdon"}, "edited": false, "score": 0, "creation_date": 1537787196, "post_id": 52465888, "comment_id": 91896953, "body": "Correct, thank you! It is the reply to my question."}], "owner": {"reputation": 1031, "user_id": 1107514, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/36ef13d2c481eec643c6298213d70f21?s=128&d=identicon&r=PG", "display_name": "Leonid Shagabutdinov", "link": "https://stackoverflow.com/users/1107514/leonid-shagabutdinov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1537704025, "creation_date": 1537704025, "question_id": 52465888, "link": "https://stackoverflow.com/questions/52465888/building-git-submodule-with-cgo", "title": "Building git submodule with CGO", "body": "<p>I need to include a C++ code from git submodule to my GO program and have following code: </p>\n\n<pre><code>$ tree\n\u251c\u2500\u2500 git-imaginary-submodule\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 test.cc\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 test.h\n\u2514\u2500\u2500 main.go\n\n1 directory, 3 files\n\n$ cat main.go\npackage main\n\n//#cgo CPPFLAGS: -g -I${SRCDIR}/git-imaginary-submodule\n//#cgo CFLAGS: -g -I${SRCDIR}/git-imaginary-submodule\n//#include \"test.h\"\nimport \"C\"\n\nimport (\n    \"log\"\n)\n\nfunc main() {\n    log.Println(C.test())\n}\n</code></pre>\n\n<p>When I run <code>go build</code> I have following:</p>\n\n<pre><code>$ go build\n# github.com/shagabutdinov/stackoverflow-go-include-question/nope\n/usr/bin/ld: $WORK/b001/_x002.o: in function `_cgo_bc718ee76ee7_Cfunc_test':\n/tmp/go-build/cgo-gcc-prolog:43: undefined reference to `test'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>But when the C++ code is locally located build is fine:</p>\n\n<pre><code>$ tree\n.\n\u251c\u2500\u2500 main.go\n\u251c\u2500\u2500 test.cc\n\u2514\u2500\u2500 test.h\n\n0 directories, 3 files\n$ go build .\n# ok\n\n$ cat main.go \npackage main\n\n//#include \"test.h\"\nimport \"C\"\n\nimport (\n  \"log\"\n)\n\nfunc main() {\n  log.Println(C.test())\n}\n</code></pre>\n\n<p>Here are source code for <code>test.h</code> and <code>test.cc</code>:</p>\n\n<pre><code>$ cat test.h \n#ifdef __cplusplus\nextern \"C\" {\n#endif\n  int test();\n#ifdef __cplusplus\n}\n#endif\n\n$ cat test.cc\n#include &lt;vector&gt;\n#include \"test.h\"\n\nint test() {\n  std::vector&lt;int&gt; vector = {1, 2};\n  return vector[0] + vector[1];\n}\n</code></pre>\n\n<p>How can I use C++ code located in another directory?</p>\n"}, {"tags": ["javascript", "go", "google-cloud-platform", "google-cloud-storage"], "comments": [{"owner": {"reputation": 611, "user_id": 4281077, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3oOg40JdTy4/AAAAAAAAAAI/AAAAAAAAHNQ/jB3IczOZSFE/photo.jpg?sz=128", "display_name": "Karthik Nayak", "link": "https://stackoverflow.com/users/4281077/karthik-nayak"}, "edited": false, "score": 0, "creation_date": 1537695489, "post_id": 52464209, "comment_id": 91871523, "body": "The documentation talks about using the <i>multiple chunks</i> upload mechanism if you want to show progress."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 611, "user_id": 4281077, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3oOg40JdTy4/AAAAAAAAAAI/AAAAAAAAHNQ/jB3IczOZSFE/photo.jpg?sz=128", "display_name": "Karthik Nayak", "link": "https://stackoverflow.com/users/4281077/karthik-nayak"}, "edited": false, "score": 1, "creation_date": 1537708677, "post_id": 52464209, "comment_id": 91874528, "body": "Yes you are right, I didn&#39;t notice that part, thanks :D, if you could make it as an anwser I would accept it"}], "answers": [{"tags": [], "owner": {"reputation": 611, "user_id": 4281077, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3oOg40JdTy4/AAAAAAAAAAI/AAAAAAAAHNQ/jB3IczOZSFE/photo.jpg?sz=128", "display_name": "Karthik Nayak", "link": "https://stackoverflow.com/users/4281077/karthik-nayak"}, "is_accepted": true, "score": 1, "last_activity_date": 1537708955, "creation_date": 1537708955, "answer_id": 52466500, "question_id": 52464209, "link": "https://stackoverflow.com/questions/52464209/how-to-get-upload-progress-informations-for-a-resumable-upload-with-google-cloud/52466500#52466500", "title": "How to get upload progress informations for a resumable-upload with Google Cloud Storage JSON API?", "body": "<p>The documentation talks about using the <strong>multiple chunks</strong> upload mechanism if you want to show progress. That's what you need. </p>\n"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 411, "favorite_count": 0, "accepted_answer_id": 52466500, "answer_count": 1, "score": 1, "last_activity_date": 1537711196, "creation_date": 1537690119, "last_edit_date": 1537711196, "question_id": 52464209, "link": "https://stackoverflow.com/questions/52464209/how-to-get-upload-progress-informations-for-a-resumable-upload-with-google-cloud", "title": "How to get upload progress informations for a resumable-upload with Google Cloud Storage JSON API?", "body": "<p>I'm using <a href=\"https://cloud.google.com/storage/docs/json_api/v1/how-tos/resumable-upload\" rel=\"nofollow noreferrer\">JSON resumable upload</a> in order to upload a file to a cloud storage. But there is no information about \"how to retrieve the upload progress state\", in the <a href=\"https://cloud.google.com/storage/docs/json_api/v1/how-tos/upload\" rel=\"nofollow noreferrer\">documentation</a>. </p>\n\n<p>In the browser it just says \"pending\" until the file is uploaded.\nAny idea how to get progress informations from the client or server?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1537689058, "post_id": 52464058, "comment_id": 91870100, "body": "Please provide the code for json where you are unmarshalling the data into timestamp."}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1537689300, "post_id": 52464058, "comment_id": 91870149, "body": "The error says error on &quot;Unmarshal&quot; not on marshal , you need to implement Unmarshaller for unmarshal to work"}, {"owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "reply_to_user": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1537689558, "post_id": 52464058, "comment_id": 91870205, "body": "I&#39;m using echo&#39;s context.JSON for that here is the code: <a href=\"https://github.com/labstack/echo/blob/master/context.go#L406\" rel=\"nofollow noreferrer\">github.com/labstack/echo/blob/master/context.go#L406</a>  As for @SarathSadasivanPillai true I didn&#39;t notice that. I will try that"}, {"owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "reply_to_user": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1537690262, "post_id": 52464058, "comment_id": 91870369, "body": "@SarathSadasivanPillai I&#39;ve added the UnmarshalJSON method but sadly the error stays"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1537690351, "post_id": 52464058, "comment_id": 91870378, "body": "You defined custom marshaling / unmarshaling for the <code>timestamp</code> type, but you don&#39;t use that in <code>log</code>. So either use <code>timestamp</code> in <code>log</code>, or define custom marshaling / unmarshaling on the <code>log</code> type."}, {"owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1537690842, "post_id": 52464058, "comment_id": 91870473, "body": "@icza sorry that was just a bad copy paste on my part, I do actually use the timestamp type in log"}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1537691051, "post_id": 52464058, "comment_id": 91870528, "body": "Is it because you have a pointer receiver for the <code>UnmarshalJSON</code> method but use values everywhere else?"}, {"owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "reply_to_user": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1537691479, "post_id": 52464058, "comment_id": 91870628, "body": "@IainDuncan no that&#39;s not it. I wrote that like the official implementation of time.Time.UnmarshalJSON looks like <a href=\"https://golang.org/src/time/time.go?s=37288:37335#L1240\" rel=\"nofollow noreferrer\">golang.org/src/time/time.go?s=37288:37335#L1240</a>  It needs to be a pointer otherwise how am i going to modify the value."}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1537694165, "post_id": 52464058, "comment_id": 91871218, "body": "I can&#39;t get this to fail!  However, I did notice that you set the pointer t to a new pointer which will be lost when you leave the method.  You actually need to dereference t and set the value in the location t points to.  Once done it seems to work for me, can you create an executable example where this fails?: <a href=\"https://play.golang.org/p/ht5PDO6PwD4\" rel=\"nofollow noreferrer\">play.golang.org/p/ht5PDO6PwD4</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1537694202, "post_id": 52464661, "comment_id": 91871228, "body": "This wouldn&#39;t cause the error that the original post referred to though"}, {"owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "edited": false, "score": 0, "creation_date": 1537694482, "post_id": 52464661, "comment_id": 91871292, "body": "Alright I can see that I did that wrong, even in the original Go implementation it is like you wrote. I fixed that. But it&#39;s not causing the error I&#39;m having. The error still persists."}, {"owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "edited": false, "score": 0, "creation_date": 1537697272, "post_id": 52464661, "comment_id": 91871852, "body": "@SarathSadasivanPillai I&#39;ve edited the original question. Sorry that I left out that part before."}], "tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": false, "score": 1, "last_activity_date": 1537714113, "last_edit_date": 1537714113, "creation_date": 1537693791, "answer_id": 52464661, "question_id": 52464058, "link": "https://stackoverflow.com/questions/52464058/marshalling-time-time-to-unix-timestamp/52464661#52464661", "title": "Marshalling time.Time to unix timestamp", "body": "<p>here when assigning <code>&amp;timestamp{..}</code> to t it is changing the pointer instead the value it is pointed to has to be chaged as follows</p>\n\n<pre><code>func (t *timestamp) UnmarshalJSON(data []byte) error {\n    i, err := strconv.ParseInt(string(data[:]), 10, 64)\n    if err != nil {\n        return err\n    }\n    *t = timestamp{\n        time.Unix(i, 0),\n    }\n    return nil\n}\n</code></pre>\n\n<p>Please find code  <a href=\"https://play.golang.com/p/1lmEkUYCdOS\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p><strong>Edit</strong></p>\n\n<p>Since you are failing to unmarshall when reading from Database it is not because of <code>json.unmarshalling</code> you have to implement <strong><code>sql.Scanner</code></strong>\nif you are using sql </p>\n\n<p>Please find the details here => <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"nofollow noreferrer\">sql.Scanner</a></p>\n"}, {"comments": [{"owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "edited": false, "score": 0, "creation_date": 1537694648, "post_id": 52464751, "comment_id": 91871339, "body": "Hmm yes, I have a similar working version on the playground now aswell. Okay so I know that code is good, but I&#39;m still having issues in my program. I don&#39;t marshall it myself, I&#39;m not even sure why the unmarshal error is thrown, the actual point where it is marshalled is here: <a href=\"https://github.com/labstack/echo/blob/master/context.go#L406\" rel=\"nofollow noreferrer\">github.com/labstack/echo/blob/master/context.go#L406</a> My code is just <code>return c.JSON(http.StatusOK, userlogResult)</code>"}], "tags": [], "owner": {"reputation": 86, "user_id": 10005533, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fa7c0a25af1534a41ff68bdb3d6bdb1?s=128&d=identicon&r=PG", "display_name": "Oliver Jackman", "link": "https://stackoverflow.com/users/10005533/oliver-jackman"}, "is_accepted": false, "score": 1, "last_activity_date": 1537694478, "creation_date": 1537694478, "answer_id": 52464751, "question_id": 52464058, "link": "https://stackoverflow.com/questions/52464058/marshalling-time-time-to-unix-timestamp/52464751#52464751", "title": "Marshalling time.Time to unix timestamp", "body": "<p>I think your code is ok - apart from the code in your unmarshal. You don't show the code where you are Marshalling/Unmarshalling which is where the actual error is.</p>\n\n<p>I have it working on the playground. <a href=\"https://play.golang.org/p/No0QIivkXxM\" rel=\"nofollow noreferrer\" title=\"Golang Playground\">Golang Playground</a></p>\n\n<p>Instead of this (which changes the pointer)</p>\n\n<pre><code>t = &amp;timestamp{\n  time.Unix(i, 0),\n}\n</code></pre>\n\n<p>Change the value</p>\n\n<pre><code>t.Time = time.Unix(i,0)\n</code></pre>\n\n<p>Main function to use your structs</p>\n\n<pre><code>fmt.Println(\"First Log...\")\nl := log{Timestamp: timestamp{time.Now()}}\nfmt.Println(l)\n\nbuf, err := json.Marshal(l)\nif err != nil {\n    panic(err)\n}\nfmt.Println(\"Marshalled to JSON...\")\nfmt.Printf(\"%s\\n\", buf)\n\nvar logCopy log\nif err := json.Unmarshal(buf, &amp;logCopy); err != nil {\n    panic(err)\n}\nfmt.Println(\"UnMarshalled from JSON...\")\nfmt.Println(logCopy)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "is_accepted": false, "score": 0, "last_activity_date": 1537697861, "creation_date": 1537697861, "answer_id": 52465125, "question_id": 52464058, "link": "https://stackoverflow.com/questions/52464058/marshalling-time-time-to-unix-timestamp/52465125#52465125", "title": "Marshalling time.Time to unix timestamp", "body": "<p>Alright after confusing a lot of people here (sorry) and myself I've found a solution.</p>\n\n<p>The marshalling to json works now only need to fix the gocql compatiblity like this:</p>\n\n<pre><code>var ts time.Time\nfor iter.Scan(&amp;message.Text, &amp;ts) {\n    message.Timestamp = timestamp{ts}\n\n    userlogResult.Messages = append(userlogResult.Messages, message)\n}\n</code></pre>\n"}], "owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 686, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1537714113, "creation_date": 1537688413, "last_edit_date": 1537697957, "question_id": 52464058, "link": "https://stackoverflow.com/questions/52464058/marshalling-time-time-to-unix-timestamp", "title": "Marshalling time.Time to unix timestamp", "body": "<p>I have a struct like so </p>\n\n<pre><code>type log struct {\n    [...]\n    Timestamp timestamp `json:\"timestamp\"`\n}\n</code></pre>\n\n<p>and I want to have the Timestamp as unix timestamp instead of whatever go does by default (<code>2018-09-21T19:31:03.291Z</code>) </p>\n\n<p>I've tried creating a custom type for that like this:</p>\n\n<pre><code>type timestamp struct {\n    time.Time\n}\n\nfunc (t timestamp) MarshalJSON() ([]byte, error) {\n    return []byte(strconv.FormatInt(time.Time(t.Time).Unix(), 10)), nil\n}\n\nfunc (t *timestamp) UnmarshalJSON(data []byte) error {\n    i, err := strconv.ParseInt(string(data[:]), 10, 64)\n    if err != nil {\n        return err\n    }\n    t = &amp;timestamp{\n        time.Unix(i, 0),\n    }\n    return nil\n}\n</code></pre>\n\n<p>but I'm always getting the error <code>can not unmarshal timestamp into *main.timestamp</code> when trying to read from the database. </p>\n\n<pre><code>for iter.Scan(&amp;message.Text, &amp;message.Timestamp) {\n\n    userlogResult.Messages = append(userlogResult.Messages, message)\n}\nif err := iter.Close(); err != nil {\n    log.Error(err)\n}\n</code></pre>\n\n<p>It can't unmarshall the Timestamp here. <a href=\"https://github.com/gocql/gocql/blob/799fb0373110eaa4e2e71dd32a9b5903f80dca8f/helpers.go#L30\" rel=\"nofollow noreferrer\">https://github.com/gocql/gocql/blob/799fb0373110eaa4e2e71dd32a9b5903f80dca8f/helpers.go#L30</a> the issue is that it doesn't use the Unmarshall functions.</p>\n\n<p>Edit: I've answered my own question.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1537686666, "post_id": 52463814, "comment_id": 91869575, "body": "Create a package for fzr inside model in which there can be two files one contains the list of structs and other one contains the unmarshal functions. Or you can create a package named store to unmarshal yaml and store the data inside db."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1537686916, "post_id": 52463814, "comment_id": 91869631, "body": "@Himanshu - but the root is called <code>fzr</code> :) how do you called to package inside <code>fzr</code> with all access functions ?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1537687071, "post_id": 52463814, "comment_id": 91869673, "body": "there is one more option then you can add all the files structs in a single file called global.go and then unmarshal inside fzr.go"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1537687204, "post_id": 52463814, "comment_id": 91869703, "body": "@Himanshu - im a bit confused, can you provide a answer that descirbe it ? for example assume that I&#39;ve only <code>fzr</code> package and inside it having <code>modles</code> package , where do you put the <code>yaml.Unmarshal</code> and the <code>accessFunctions</code> ?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1537687245, "post_id": 52463814, "comment_id": 91869715, "body": "it will be great if you can provide example in my context"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1537687885, "post_id": 52463814, "comment_id": 91869842, "body": "you said you do want a flat structure because in your case you can add a file in models containing the structs and fzr.go will contains all functions unmarshaling the yaml."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1537689273, "post_id": 52463814, "comment_id": 91870143, "body": "@Himanshu - I dont want flat structure, assume that I&#39;ve only fzr package and inside it having modles package , where do you put the yaml.Unmarshal and the accessFunctions ?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1537689312, "post_id": 52463814, "comment_id": 91870151, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/180609/discussion-between-himanshu-and-shopia-t\">continue this discussion in chat</a>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537723883, "post_id": 52463814, "comment_id": 91879007, "body": "@shopiaT There are no &quot;inside&quot; packages and no &quot;subpackages&quot; in Go. All packages are equal and it does not matter the tiniest bit where you place them on the FS. Take a look at how other OS programs are structured on disk."}], "owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 296, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1537690908, "creation_date": 1537686228, "last_edit_date": 1537690908, "question_id": 52463814, "link": "https://stackoverflow.com/questions/52463814/golang-project-structure-domain-model-package", "title": "Golang project structure domain model package", "body": "<p>I have a question about the Golang project structure. \nAssume that this is my project structure in high level:</p>\n\n<p><a href=\"https://i.stack.imgur.com/vnWQE.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vnWQE.png\" alt=\"enter image description here\"></a></p>\n\n<p>The project <code>fzr</code> defines yaml structure, which I need to parse and provide functions, to get data on top of this yaml file content.</p>\n\n<ul>\n<li>the <code>model</code> contains all the structs </li>\n<li>the <code>provider</code> contains the <code>yaml.Unmarshal</code> to parse the structs and provide objects which contain all the yaml file data </li>\n</ul>\n\n<p>Assume that I need to provide <strong>functions on top of the structs data</strong>, such as:</p>\n\n<ul>\n<li><code>getUserApps</code> </li>\n<li><code>getServices</code>  </li>\n<li><code>getUserServices</code></li>\n<li><code>getApps</code></li>\n<li><code>getUserByIde</code> </li>\n<li>etc..</li>\n</ul>\n\n<p>Where should these functions be placed? Maybe in a new created package under <code>fzr</code>? I don't want to use the flat option.</p>\n\n<p>Of course, I can place some files under the provider package, which contains all the function there, but not sure if this would be clean? Go package structure is quite confusing me.</p>\n"}, {"tags": ["go", "geolocation", "geo"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537688263, "post_id": 52463565, "comment_id": 91869918, "body": "Looking for libraries is offtopic on SO. For the optimisation: Precompute and save the nearest neighbour/distance"}], "answers": [{"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1538215899, "post_id": 52464239, "comment_id": 92071761, "body": "Yes, I am interested in the code or even better.. some existing library function"}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 2, "last_activity_date": 1537690402, "creation_date": 1537690402, "answer_id": 52464239, "question_id": 52463565, "link": "https://stackoverflow.com/questions/52463565/calculating-closest-point-in-golang/52464239#52464239", "title": "Calculating closest point in Golang", "body": "<p>You can split the whole plane into grids that can be decided by an O(1) operation of the points' latitude and longitude, like <code>(int(lat) / 10, int(lng) /10)</code>. Precalculate for each of the 5000 points and each grids of what the max and min distance is between the grid and the point. Maintain for each grid a set of points that can possibly produce the minimum distance. With a good dividing algorithms (usually just divide latitude and longitude with a certain number is good enough), the set should be very small, like no more than 10 points.</p>\n\n<p>So when you get a query, you can get the grid the point is in immediately and has a small list of points that can be the closet. Simply loop over it and find the one.</p>\n\n<p>Calculating the min and max distance is trivial, just be careful with some special cases. Maintaining the set can be done by keeping a current (min,max): when a new pair of (minI,maxI) is calculated, compare it to current ones. If maxI &lt; min, discard everything we had and use the new pair.\nIf minI > max, nothing happens. Else, just add the new pair and update min/max accordingly.</p>\n\n<p>I am currently on mobile so I can't provide code. If you need code to see how it is done, I would add it later.</p>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 667, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1537690402, "creation_date": 1537683859, "question_id": 52463565, "link": "https://stackoverflow.com/questions/52463565/calculating-closest-point-in-golang", "title": "Calculating closest point in Golang", "body": "<p>I am <a href=\"https://github.com/kaihendry/geoclose\" rel=\"nofollow noreferrer\">writing a lambda function</a> that needs to return the closest point to another. I'm thinking that there must be a better way than calculating the distance to <a href=\"https://github.com/kaihendry/geoclose/blob/master/all.json\" rel=\"nofollow noreferrer\">all 5000 points</a> that I have every time.</p>\n\n<pre><code>func (places Places) closest(w place) (c place) {\n    c = places[0]\n    closestSoFar := w.Point.GreatCircleDistance(c.Point)\n    for _, p := range places[1:] {\n        distance := w.Point.GreatCircleDistance(p.Point)\n        if distance &lt; closestSoFar {\n            // Set the return\n            c = p\n            // Record closest distance\n            closestSoFar = distance\n        }\n    }\n    return\n}\n</code></pre>\n\n<p>If you could review the code and point to libraries I should be using, I would be most grateful. Also I'd like to benchmark different approaches so I am wondering how to define that. I think currently my approach takes ~0.025s on my i7 system. Perhaps what I am doing here is premature optimization? Since my bus stop data probably won't exceed 10k points.</p>\n"}, {"tags": ["css", "templates", "go", "truetype"], "comments": [{"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 1, "creation_date": 1537678918, "post_id": 52462645, "comment_id": 91868306, "body": "Have you tried to follow the example provided by Google? That includes a specific reference to <code>https:&#47;&#47;fonts.googleapis.com&#47;css?family=[family-name]</code> that you&#39;re missing and a more straightforward <code>font-family=[family-name]</code> reference. [Link: <a href=\"https://developers.google.com/fonts/docs/getting_started]\" rel=\"nofollow noreferrer\">developers.google.com/fonts/docs/getting_started]</a>"}], "answers": [{"comments": [{"owner": {"reputation": 291, "user_id": 3141154, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/D0xIs.jpg?s=128&g=1", "display_name": "T1960CT", "link": "https://stackoverflow.com/users/3141154/t1960ct"}, "edited": false, "score": 0, "creation_date": 1537704833, "post_id": 52465160, "comment_id": 91873612, "body": "Was not aware of the fact that I have to create a fileserver for static content! Thank you!"}], "tags": [], "owner": {"reputation": 916, "user_id": 8047506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KS6Eg.jpg?s=128&g=1", "display_name": "Evgeny A. Mamonov", "link": "https://stackoverflow.com/users/8047506/evgeny-a-mamonov"}, "is_accepted": true, "score": 1, "last_activity_date": 1537701966, "last_edit_date": 1537701966, "creation_date": 1537698137, "answer_id": 52465160, "question_id": 52462645, "link": "https://stackoverflow.com/questions/52462645/golang-ttf-font-in-template/52465160#52465160", "title": "Golang ttf font in template", "body": "<p>You need process static files, add this to main func and set url to <code>/static/Comfortaa-Regular.ttf</code> in your template</p>\n\n<pre><code>//Create MUX Routing for static\nfs := http.FileServer(http.Dir(\"./static\"))\nhttp.Handle(\"/static/\", http.StripPrefix(\"/static/\", fs))\n</code></pre>\n\n<p>Here is complete working code</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"text/template\"\n)\n\ntype Portal struct{\n    Title string\n}\n\nfunc main(){\n    //Create MUX Routing handlers\n    http.HandleFunc(\"/\", portal)\n\n    //Create MUX Routing for static\n    fs := http.FileServer(http.Dir(\"./static\"))\n    http.Handle(\"/static/\", http.StripPrefix(\"/static/\", fs))\n\n    //Start WebServer\n    if err := http.ListenAndServe(\":1234\", nil); err != nil{ panic(err) }\n}\n\nfunc portal(w http.ResponseWriter, r *http.Request){\n    //Create template\n    tmpl, _ := template.ParseFiles(\"./html_templates/portal.html\")\n\n    //Populate struct\n    portal := Portal{\n        Title: \"title\",\n    }\n\n    //Execute template with struct data\n    tmpl.Execute(w, portal)\n}\n</code></pre>\n\n<p>And template</p>\n\n<pre><code>&lt;head&gt;\n    &lt;title&gt;{{ .Title }}&lt;/title&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n\n    &lt;style&gt;\n        @font-face {\n            font-family: 'comfortaaRegular';\n            src: url('/static/Comfortaa-Regular.ttf');\n            src: local('comfortaaRegular'),\n                 local('Comfortaa-Regular.ttf'),\n                 url('/static/Comfortaa-Regular.ttf') format('truetype'),\n        }\n        body{ font-family: 'comfortaaRegular' }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;p&gt;test&lt;/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"}], "owner": {"reputation": 291, "user_id": 3141154, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/D0xIs.jpg?s=128&g=1", "display_name": "T1960CT", "link": "https://stackoverflow.com/users/3141154/t1960ct"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 910, "favorite_count": 0, "accepted_answer_id": 52465160, "answer_count": 1, "score": 0, "last_activity_date": 1537701966, "creation_date": 1537672418, "question_id": 52462645, "link": "https://stackoverflow.com/questions/52462645/golang-ttf-font-in-template", "title": "Golang ttf font in template", "body": "<p>I'm trying to get a TTF font to work in a golang template, but it wont render the font. It shows up as regular Times New Roman. I can change fonts using the standard font-family fonts (ex verdana or 'helvetica'), but I cant import a TTF. </p>\n\n<p>All I can seem to find about TTF fonts is libraries to add text to images, but I want to change web fonts. How can I achieve this?</p>\n\n<p>Structure of project is </p>\n\n<ul>\n<li>/html_templates/portal.html</li>\n<li>/html_teplates/Comfortaa-Regular.ttf</li>\n<li>main.go</li>\n</ul>\n\n<p>Here is the relevant golang code:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"net/http\"\n    \"text/template\"\n)\ntype Portal struct{\n    Title string\n}\nfunc main(){\n    //Create MUX Routing handlers\n    http.HandleFunc(\"/\", portal)\n\n    //Start WebServer\n    if err := http.ListenAndServe(\":1234\", nil); err != nil{ panic(err) }\n}\nfunc portal(w http.ResponseWriter, r *http.Request){\n    //Create template\n    tmpl, _ := template.ParseFiles(\"./html_templates/portal.html\")\n\n    //Populate struct\n    portal := Portal{\n        Title: \"title\",\n    }\n\n    //Execute template with struct data\n    tmpl.Execute(w, portal)\n}\n</code></pre>\n\n<p>And the relevant HTML:</p>\n\n<pre><code>&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;{{ .Title }}&lt;/title&gt;\n    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n\n    &lt;style&gt;\n        @font-face {\n            font-family: 'comfortaaRegular';\n            src: url('Comfortaa-Regular.ttf');\n            src: local('comfortaaRegular'), \n                 local('Comfortaa-Regular.ttf'), \n                 url('Comfortaa-Regular.ttf') format('truetype'),\n        }\n        body{ font-family: 'comfortaaRegular' }\n    &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;p&gt;test/p&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"}, {"tags": ["go", "error-handling"], "answers": [{"comments": [{"owner": {"reputation": 46, "user_id": 2801352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cc0aa9a384321091d9503d7fd3ce566?s=128&d=identicon&r=PG&f=1", "display_name": "user2801352", "link": "https://stackoverflow.com/users/2801352/user2801352"}, "edited": false, "score": 0, "creation_date": 1537679745, "post_id": 52463060, "comment_id": 91868432, "body": "Thank you, that&#39;s excellent advice. Perhaps I can have 2 separate if cases so err.Error() does not fail. Or just nest another if err != nil. I&#39;ll think about it, thank you!"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1537690201, "post_id": 52463060, "comment_id": 91870350, "body": "Wait, how is it possible for <code>err.Error()</code> to fail? An <code>error</code> is an interface which guarantees that <code>func Error() string</code> exists."}, {"owner": {"reputation": 409, "user_id": 4476357, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lkPLG1GYS_Q/AAAAAAAAAAI/AAAAAAAAABg/gCmW6uoXgTk/photo.jpg?sz=128", "display_name": "cperez08", "link": "https://stackoverflow.com/users/4476357/cperez08"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1537728809, "post_id": 52463060, "comment_id": 91880436, "body": "@RayfenWindspear in the example if <code>models.FindDog(id) return err = nil</code> the code would says <code>panic: runtime error: invalid memory address or nil pointer dereference</code> since the err is nil"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1537729382, "post_id": 52463060, "comment_id": 91880573, "body": "Oh I see, because you are using <code>||</code> (or) in that check."}], "tags": [], "owner": {"reputation": 409, "user_id": 4476357, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lkPLG1GYS_Q/AAAAAAAAAAI/AAAAAAAAABg/gCmW6uoXgTk/photo.jpg?sz=128", "display_name": "cperez08", "link": "https://stackoverflow.com/users/4476357/cperez08"}, "is_accepted": true, "score": 1, "last_activity_date": 1537677900, "creation_date": 1537677900, "answer_id": 52463060, "question_id": 52462569, "link": "https://stackoverflow.com/questions/52462569/what-is-the-idiomatic-way-to-handle-nil-and-error-in-golang/52463060#52463060", "title": "What is the idiomatic way to handle nil and error in Golang?", "body": "<p>In my personal opinion you are handling it very well, Just a recommendation as I don't know what <code>models.FindDog(id)</code> does I would double check <code>found</code> and if this is <code>nil</code> return error, summarizing <code>if err != nil  || found == nil {</code> </p>\n\n<p><em>Note: doing this <code>return err.Error()</code> could fail</em></p>\n"}, {"comments": [{"owner": {"reputation": 46, "user_id": 2801352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cc0aa9a384321091d9503d7fd3ce566?s=128&d=identicon&r=PG&f=1", "display_name": "user2801352", "link": "https://stackoverflow.com/users/2801352/user2801352"}, "edited": false, "score": 0, "creation_date": 1537679534, "post_id": 52463062, "comment_id": 91868400, "body": "Yes thank you. The &quot;Indent error blocks, not code&quot; idea is why I have the comment that reads &quot;Or does the if check above need to return? (even if I would like the function to be longer)&quot;. I mangled that question, but thank you - I will change my code accordingly. A quick follow up: does this imply the need for shorter functions? Since having a long function with an error/return at the top of it seems dangerous. Or is it not dangerous at all? I suppose having long functions in itself is considered bad form anyways."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 46, "user_id": 2801352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cc0aa9a384321091d9503d7fd3ce566?s=128&d=identicon&r=PG&f=1", "display_name": "user2801352", "link": "https://stackoverflow.com/users/2801352/user2801352"}, "edited": false, "score": 0, "creation_date": 1537679767, "post_id": 52463062, "comment_id": 91868435, "body": "@user2801352 Long functions aren&#39;t necessarily bad form, but smaller ones are easier to test. I have a production function that follows the idiom I mentioned the whole way through. Over 100 lines all left flush except for <code>return nil, err</code> blocks. Admittedly it needs to be refactored and shrunk to be unit tested."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 46, "user_id": 2801352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cc0aa9a384321091d9503d7fd3ce566?s=128&d=identicon&r=PG&f=1", "display_name": "user2801352", "link": "https://stackoverflow.com/users/2801352/user2801352"}, "edited": false, "score": 0, "creation_date": 1537680013, "post_id": 52463062, "comment_id": 91868457, "body": "It also depends on the code though. Often on an error, you simply want to pass it back up to the caller. In cases where you actually handle the error, you&#39;ll possibly have if/else blocks and whatever is necessary. A lot of the time that sort of handling is done at the very top level functions, so usually the error is just passed back up the stack by returning"}, {"owner": {"reputation": 46, "user_id": 2801352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cc0aa9a384321091d9503d7fd3ce566?s=128&d=identicon&r=PG&f=1", "display_name": "user2801352", "link": "https://stackoverflow.com/users/2801352/user2801352"}, "edited": false, "score": 0, "creation_date": 1537680411, "post_id": 52463062, "comment_id": 91868536, "body": "Although SO discourages these types of comments, I just wanted to say thank you again. I&#39;ll be applying your advice in my current project."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 2, "last_activity_date": 1537690786, "last_edit_date": 1537690786, "creation_date": 1537677930, "answer_id": 52463062, "question_id": 52462569, "link": "https://stackoverflow.com/questions/52462569/what-is-the-idiomatic-way-to-handle-nil-and-error-in-golang/52463062#52463062", "title": "What is the idiomatic way to handle nil and error in Golang?", "body": "<p>Yes, this is idiomatic Go. Because errors are handled up front, an error means something failed and the result is either <code>nil</code>, or e.g. perhaps a partially written buffer that isn't of any use.</p>\n\n<p>P.S. I also have a suggestion that would make things more idiomatic. The idiom goes something like \"Indent error blocks, not code\". You specifically have an if/else in your <code>sampleFunction</code>, yet in most error checking circumstances (not all) you handle it and return, then skip the else and the flow simply continues. Why indent when you don't have to? This has the effect of making even long functions easy to read because the intended flow of the function can be read top-to-bottom and without having to bounce back and forth between if/else blocks. At least in many occasions.</p>\n\n<p>I had a pull request into someone's repository amended because I had an if/else where the if with return was sufficient.</p>\n\n<p><strong>EDIT</strong>\nSo my answer was bothering me a little bit, and now I remember why. It's normally idiomatic for a non <code>nil</code> <code>error</code> return to indicate that the other return value(s) are useless, but there are indeed exceptions. <strong>Be sure to check individual documentation.</strong></p>\n\n<p>As a concrete example, see <a href=\"https://godoc.org/bytes#Buffer.ReadBytes\" rel=\"nofollow noreferrer\"><code>bytes.Buffer.ReadBytes</code></a></p>\n\n<blockquote>\n  <p>If ReadBytes encounters an error before finding a delimiter, it returns the data read before the error and the error itself (often io.EOF).</p>\n</blockquote>\n"}], "owner": {"reputation": 46, "user_id": 2801352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cc0aa9a384321091d9503d7fd3ce566?s=128&d=identicon&r=PG&f=1", "display_name": "user2801352", "link": "https://stackoverflow.com/users/2801352/user2801352"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1379, "favorite_count": 1, "accepted_answer_id": 52463060, "answer_count": 2, "score": 2, "last_activity_date": 1537690786, "creation_date": 1537671484, "question_id": 52462569, "link": "https://stackoverflow.com/questions/52462569/what-is-the-idiomatic-way-to-handle-nil-and-error-in-golang", "title": "What is the idiomatic way to handle nil and error in Golang?", "body": "<p>I have 2 go functions:</p>\n\n<pre><code>func sampleFunction () {\n    u, err := findDog(1)\n    if err != nil {\n        // We couldn't find the dog, print a message.\n        fmt.Println(err)\n        // Custom error types.\n        if _, ok := err.(*dneError); ok {\n            fmt.Println(\"Custom dog dne error for the end-user here.\")\n        }\n    } else {\n        // Do something with u.\n        u.doSomething() // Is this idiomatic in Go?\n                        // Should we explicility check for u != nil?\n                        // Or does the if check above need to return?\n                        // (even if I would like the function to be longer)\n\n    }\n}\n\n// findDog returns a dog with a given ID. If not found, returns an error.\nfunc findDog(id int) (*models.Dog, error) {\n    found, err := models.FindDog(id)\n    // Is this return scheme/flow too brittle?\n    if err != nil {\n        return nil, &amp;dneError{fmt.Sprintf(\"Dog %d does not exist in the\" +\n            \"database: %s\", id, err.Error())}\n    }\n    return found, nil\n}\n</code></pre>\n\n<p>I just want to make sure I'm handling errors and nils correctly, so my 2 main questions are:</p>\n\n<ol>\n<li><p>In findDog, am I returning nil appropriately in both cases?</p></li>\n<li><p>In sampleFunction, is it idiomatic to not explicitly check u != nil, or am I just doing this completely incorrectly?</p></li>\n</ol>\n\n<p>My goal is to properly show errors/problems to the programmers when they need it, and show errors/problems to the users when they need it, while also adhering to idiomatic standards. Thank you for your time.</p>\n"}, {"tags": ["go", "struct", "reflection", "casting"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1537684819, "post_id": 52462441, "comment_id": 91869234, "body": "There is no way you can use one type in another type. But Please post the code where you re using one type and then wrapping the interface around the struct to achieve something."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1537688523, "post_id": 52462441, "comment_id": 91869972, "body": "This is all totally wrong. B is <b>not</b> an alias for A. Aliases are something completely different. B is a new named type whose underlying type is A. Type assertions are a third thing which turn interface types into what the interface wrapps. Redesign as nothing here seems to be sensible. One more: There are <i>not</i> type casts in Go."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9784507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e848bdb04bbf4d49e550a961e8e3842d?s=128&d=identicon&r=PG&f=1", "display_name": "David Bryant", "link": "https://stackoverflow.com/users/9784507/david-bryant"}, "edited": false, "score": 0, "creation_date": 1537672926, "post_id": 52462496, "comment_id": 91867545, "body": "Thanks, but unfortunately this solution doesn&#39;t work for my use-case, because type B would become just another way to write type A, so I&#39;d lose all the custom methods I have defined on type B."}], "tags": [], "owner": {"reputation": 1306, "user_id": 5705686, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jYuOhkTQVgQ/AAAAAAAAAAI/AAAAAAAAA1A/v5x1CDU6W4s/photo.jpg?sz=128", "display_name": "dolan", "link": "https://stackoverflow.com/users/5705686/dolan"}, "is_accepted": false, "score": 0, "last_activity_date": 1537670344, "creation_date": 1537670344, "answer_id": 52462496, "question_id": 52462441, "link": "https://stackoverflow.com/questions/52462441/how-to-cast-a-struct-to-a-basic-type-rather-than-the-immediate-type-in-go/52462496#52462496", "title": "How to cast a struct to a basic type, rather than the immediate type in Go?", "body": "<p>You can solve this with <code>type aliasing</code> (released in Go1.9).</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype A struct {\n    foo string\n}\n\ntype B = A\n\nfunc main() {\n    bS := B{foo: \"foo\"}\n    bI := reflect.ValueOf(bS).Interface()\n    fmt.Println(bI)\n\n    aS := bI.(A)\n    fmt.Println(aS)\n}\n</code></pre>\n\n<p>N.B. <code>type B = A</code> makes is so that cast will work.</p>\n"}, {"tags": [], "owner": {"reputation": 409, "user_id": 4476357, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lkPLG1GYS_Q/AAAAAAAAAAI/AAAAAAAAABg/gCmW6uoXgTk/photo.jpg?sz=128", "display_name": "cperez08", "link": "https://stackoverflow.com/users/4476357/cperez08"}, "is_accepted": false, "score": 0, "last_activity_date": 1537680318, "creation_date": 1537680318, "answer_id": 52463258, "question_id": 52462441, "link": "https://stackoverflow.com/questions/52462441/how-to-cast-a-struct-to-a-basic-type-rather-than-the-immediate-type-in-go/52463258#52463258", "title": "How to cast a struct to a basic type, rather than the immediate type in Go?", "body": "<p>the only way I know to go to the first struct is <code>aS := A(bI.(B))</code> is reversing the process. Hope it helps</p>\n"}], "owner": {"reputation": 11, "user_id": 9784507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e848bdb04bbf4d49e550a961e8e3842d?s=128&d=identicon&r=PG&f=1", "display_name": "David Bryant", "link": "https://stackoverflow.com/users/9784507/david-bryant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1537680318, "creation_date": 1537669342, "last_edit_date": 1537672870, "question_id": 52462441, "link": "https://stackoverflow.com/questions/52462441/how-to-cast-a-struct-to-a-basic-type-rather-than-the-immediate-type-in-go", "title": "How to cast a struct to a basic type, rather than the immediate type in Go?", "body": "<p>I need to cast an interface of an unknown immediate type to a known basic type.</p>\n\n<p>Example</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype A struct {\n    foo string\n}\n\ntype B A\n\nfunc main() {\n    bS := B{foo: \"foo\"}\n    bI := reflect.ValueOf(bS).Interface()\n    fmt.Println(bI)\n\n    aS := bI.(A)\n    fmt.Println(aS)\n}\n</code></pre>\n\n<p>When this code is run, it, understandably, panics with the following message</p>\n\n<pre><code>panic: interface conversion: interface {} is main.B, not main.A\n</code></pre>\n\n<p>In this example:</p>\n\n<ul>\n<li>type B is unknown to the code receiving the interface bI</li>\n<li>type B is\nguaranteed to be an alias to type A, which is known.</li>\n</ul>\n\n<p><strong>Edit</strong>: I can't use type aliasing here, because this means that type B would become just another way to write type A, so I'd lose all the custom methods I have defined on type B.</p>\n"}, {"tags": ["function", "go", "scope"], "answers": [{"comments": [{"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 1, "creation_date": 1537666630, "post_id": 52462245, "comment_id": 91866744, "body": "Note that <a href=\"https://golang.org/pkg/os/#Setenv\" rel=\"nofollow noreferrer\"><code>os.Setenv</code></a> will only set the environment variable for the Go process and any of its children. Probably not what is intended."}, {"owner": {"reputation": 1306, "user_id": 5705686, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jYuOhkTQVgQ/AAAAAAAAAAI/AAAAAAAAA1A/v5x1CDU6W4s/photo.jpg?sz=128", "display_name": "dolan", "link": "https://stackoverflow.com/users/5705686/dolan"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1537666782, "post_id": 52462245, "comment_id": 91866767, "body": "It can be helpful when using Go as a bash alternative and using the <code>exec</code> package to run processes."}], "tags": [], "owner": {"reputation": 1306, "user_id": 5705686, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jYuOhkTQVgQ/AAAAAAAAAAI/AAAAAAAAA1A/v5x1CDU6W4s/photo.jpg?sz=128", "display_name": "dolan", "link": "https://stackoverflow.com/users/5705686/dolan"}, "is_accepted": false, "score": -1, "last_activity_date": 1537666542, "creation_date": 1537666542, "answer_id": 52462245, "question_id": 52462032, "link": "https://stackoverflow.com/questions/52462032/scope-of-variable-in-golang/52462245#52462245", "title": "Scope of variable in golang", "body": "<p>Go doesn't support the <code>export</code> keyword.</p>\n\n<p>Are you trying to create a variable with global scope?</p>\n\n<pre><code>var foo string\n\nfunc SetFoo(to string) {\n    foo = to\n}\n</code></pre>\n\n<p>Or are you trying to set an environment variable? In which case, use <code>os.Setenv(key, value)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": 1, "last_activity_date": 1537667001, "last_edit_date": 1537667001, "creation_date": 1537666549, "answer_id": 52462246, "question_id": 52462032, "link": "https://stackoverflow.com/questions/52462032/scope-of-variable-in-golang/52462246#52462246", "title": "Scope of variable in golang", "body": "<p><code>set</code> and <code>export</code> are not <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">Go keywords</a>. Maybe you're thinking of shell? It looks like you're trying to set and export environment variables.</p>\n\n<p>You cannot export environment variables from one process to another. You can only change your own process's environment. Child processes will inherit the parent's environment, but you can't go the other way. You can only do it in a shell program because that \"program\" is really a set of commands to the shell itself, and only then when using <a href=\"https://superuser.com/questions/46139/what-does-source-do\"><code>source something.sh</code></a>. <code>sh something.sh</code>, in contrast, is run in a new shell process.</p>\n\n<p>If you want to \"export\" data from a non-shell program, you'll have to print out the data in some format, <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">JSON</a> is a good choice, and have that be read by the other process.</p>\n"}], "owner": {"reputation": 157, "user_id": 7072729, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/9be68688b8d69616340b5958278fd359?s=128&d=identicon&r=PG&f=1", "display_name": "Vivek", "link": "https://stackoverflow.com/users/7072729/vivek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1537667001, "creation_date": 1537663460, "question_id": 52462032, "link": "https://stackoverflow.com/questions/52462032/scope-of-variable-in-golang", "title": "Scope of variable in golang", "body": "<p>I am trying to run one function in golang but I am getting some errors. Can anyone please help.</p>\n\n<pre><code>func exportVal(name string, value string){\n    var ops = isWindows()\n    if ops == true{\n        set name=value\n        fmt.Printf(\"name=\")\n\n    }else{\n        export name=value\n        fmt.Printf(\"name=\")\n   }\n}\n</code></pre>\n\n<p>But I am getting below error.</p>\n\n<pre><code>D:\\Go&gt;go run octa.go\n# command-line-arguments\n.\\octa.go:42:10: syntax error: unexpected name at end of statement\n.\\octa.go:46:13: syntax error: unexpected name at end of statement\n</code></pre>\n"}, {"tags": ["c++", "go", "reflection"], "answers": [{"tags": [], "owner": {"reputation": 9434, "user_id": 528720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZpqMk.png?s=128&g=1", "display_name": "&#214;&#246; Tiib", "link": "https://stackoverflow.com/users/528720/%c3%96%c3%b6-tiib"}, "is_accepted": true, "score": 3, "last_activity_date": 1537657886, "creation_date": 1537657886, "answer_id": 52461640, "question_id": 52461510, "link": "https://stackoverflow.com/questions/52461510/providing-code-hints-tags-in-c-structs-like-in-golang/52461640#52461640", "title": "Providing code hints/tags in C++ structs like in Golang", "body": "<p>No. C++ does not have any serialization support in the language. You have to write it with code or you can use third party tools and libraries like Cereal, Boost.Serialization, FlatBuffers, ThorSerializer, Cap'n Proto and so on for it.</p>\n"}], "owner": {"reputation": 1521, "user_id": 1013731, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/41427402ce0ec49a8e6ebcb0e7008dfe?s=128&d=identicon&r=PG", "display_name": "Michael Sazonov", "link": "https://stackoverflow.com/users/1013731/michael-sazonov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 52461640, "answer_count": 1, "score": 1, "last_activity_date": 1537657886, "creation_date": 1537656440, "last_edit_date": 1537656647, "question_id": 52461510, "link": "https://stackoverflow.com/questions/52461510/providing-code-hints-tags-in-c-structs-like-in-golang", "title": "Providing code hints/tags in C++ structs like in Golang", "body": "<p>In Golang I can write:</p>\n\n<pre><code>type Person struct {\n    Id int `json:\"id\"`\n}\n</code></pre>\n\n<p>Then on <code>JSON.Marshal(Person{})</code>, I get <code>{\"id\": 0}</code>. That is possible due to the <code>json</code> tag related to the <code>Id</code> field. Furthermore, I can provide any custom information in the tag section and treat it later using reflect on the struct.</p>\n\n<p>Is there some analogy in C++, where I can provide additional info for a field?</p>\n"}, {"tags": ["ssl", "go", "heroku", "lets-encrypt"], "answers": [{"comments": [{"owner": {"reputation": 777, "user_id": 778553, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6de52147a789cb9dd28a0f9773d8f40c?s=128&d=identicon&r=PG", "display_name": "Till", "link": "https://stackoverflow.com/users/778553/till"}, "edited": false, "score": 0, "creation_date": 1537660874, "post_id": 52461646, "comment_id": 91865830, "body": "I get the same errors when I listen to TLS-only. Also, the HTTP listener is in a goroutine, that should solve it, no?"}], "tags": [], "owner": {"reputation": 649, "user_id": 554480, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/m1Kjt.png?s=128&g=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/554480/mikhail"}, "is_accepted": false, "score": 0, "last_activity_date": 1537658022, "creation_date": 1537658022, "answer_id": 52461646, "question_id": 52461409, "link": "https://stackoverflow.com/questions/52461409/how-can-i-fix-a-tls-handshake-error-using-go-on-heroku/52461646#52461646", "title": "How can I fix a TLS handshake error using Go on Heroku?", "body": "<p>You can't listen to both http and https on the same port, and those log-errors are cases when you have http clients try to connect to the app.</p>\n"}, {"tags": [], "owner": {"reputation": 1306, "user_id": 5705686, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jYuOhkTQVgQ/AAAAAAAAAAI/AAAAAAAAA1A/v5x1CDU6W4s/photo.jpg?sz=128", "display_name": "dolan", "link": "https://stackoverflow.com/users/5705686/dolan"}, "is_accepted": false, "score": 0, "last_activity_date": 1537667072, "creation_date": 1537667072, "answer_id": 52462281, "question_id": 52461409, "link": "https://stackoverflow.com/questions/52461409/how-can-i-fix-a-tls-handshake-error-using-go-on-heroku/52462281#52462281", "title": "How can I fix a TLS handshake error using Go on Heroku?", "body": "<p>By default, the golang http server only supports listening to http or https traffic on a given port (not both). To listen to https traffic, you need to use <code>http.ListenAndServeTLS</code>.</p>\n\n<p>If you are directing both http and https traffic at at point configured for only one, you will end up seeing errors.</p>\n\n<p>There are third-party solution (like <a href=\"https://github.com/soheilhy/cmux\" rel=\"nofollow noreferrer\">cmux</a>) that support hosting both secure and insecure traffic on the same port. Not as easy as separating the ports, but if it's something you want to do, they have an example configuration in the README.</p>\n"}, {"tags": [], "owner": {"reputation": 777, "user_id": 778553, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6de52147a789cb9dd28a0f9773d8f40c?s=128&d=identicon&r=PG", "display_name": "Till", "link": "https://stackoverflow.com/users/778553/till"}, "is_accepted": false, "score": 1, "last_activity_date": 1537730487, "creation_date": 1537730487, "answer_id": 52469481, "question_id": 52461409, "link": "https://stackoverflow.com/questions/52461409/how-can-i-fix-a-tls-handshake-error-using-go-on-heroku/52469481#52469481", "title": "How can I fix a TLS handshake error using Go on Heroku?", "body": "<p>TLS termination is handled by the Heroku router and can't be done at the app level \u00af_(\u30c4)_/\u00af</p>\n"}], "owner": {"reputation": 777, "user_id": 778553, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6de52147a789cb9dd28a0f9773d8f40c?s=128&d=identicon&r=PG", "display_name": "Till", "link": "https://stackoverflow.com/users/778553/till"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1162, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1537730487, "creation_date": 1537655271, "question_id": 52461409, "link": "https://stackoverflow.com/questions/52461409/how-can-i-fix-a-tls-handshake-error-using-go-on-heroku", "title": "How can I fix a TLS handshake error using Go on Heroku?", "body": "<p>I have a simple proxy that listens to HTTP and HTTPS connections on the same port.</p>\n\n<p>However I'm seeing weird TLS handshake errors that seem to be caused by the Heroku router:</p>\n\n<pre><code>heroku[router]: sock=backend at=error code=H18 desc=\"Server Request Interrupted\" method=GET path=\"/favicon.ico\" host=banana.camp request_id=f56144c8-e480-476a-90b8-429b490f1ff5 fwd=\"24.67.185.77\" dyno=web.1 connect=0ms service=1ms status=503 bytes=7 protocol=https\nhttp: TLS handshake error from 10.81.159.108:19578: tls: first record does not look like a TLS handshake\nhttp: TLS handshake error from 172.17.117.25:36924: EOF\n</code></pre>\n\n<p>Is there any way to fix or ignore them? Any clues are greatly appreciated.</p>\n\n<p>Thanks!</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func InitServer() error {\n    m := autocert.Manager{\n        Cache:  autocert.DirCache(*StorageDir),\n        Prompt: autocert.AcceptTOS,\n        HostPolicy: func(ctx context.Context, host string) error {\n            return nil\n        },\n    }\n\n    errchan := make(chan error)\n\n    s := &amp;http.Server{\n        Addr:      \":\" + os.Getenv(\"PORT\"),\n        TLSConfig: &amp;tls.Config{GetCertificate: m.GetCertificate},\n        Handler:   ServeHTTP(),\n    }\n\n    go (func() {\n        errchan &lt;- http.ListenAndServe(\":\"+os.Getenv(\"PORT\"), m.HTTPHandler(nil))\n    })()\n\n    errchan &lt;- s.ListenAndServeTLS(\"\", \"\")\n\n    return &lt;-errchan\n}\n\nfunc ServeHTTP() http.Handler {\n    return http.HandlerFunc(func(res http.ResponseWriter, req *http.Request) {\n        if upstreams, ok := Hosts[req.Host]; ok {\n            forwarder, _ := forward.New(forward.PassHostHeader(true))\n            loadbalancer, _ := roundrobin.New(forwarder)\n\n            for _, upstream := range upstreams {\n                if url, err := url.Parse(upstream); err == nil {\n                    loadbalancer.UpsertServer(url)\n                } else {\n                    log.Fatal(\"InitHostsList: \", err)\n                }\n            }\n\n            loadbalancer.ServeHTTP(res, req)\n\n            return\n        }\n\n        http.Error(res, \"The request service couldn't be found here\", http.StatusNotImplemented)\n    })\n}\n</code></pre>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 2122, "user_id": 4183352, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4Kfzk.png?s=128&g=1", "display_name": "cymruu", "link": "https://stackoverflow.com/users/4183352/cymruu"}, "edited": false, "score": 0, "creation_date": 1537651392, "post_id": 52460925, "comment_id": 91863988, "body": "Why wouldn&#39;t you define interfaces for all possible structures the response can have and add pointers to those in your master interface?"}, {"owner": {"reputation": 43, "user_id": 3504767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a411f32fe096ac485cf0fdfbfa8fddb?s=128&d=identicon&r=PG&f=1", "display_name": "Hennessy", "link": "https://stackoverflow.com/users/3504767/hennessy"}, "reply_to_user": {"reputation": 2122, "user_id": 4183352, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4Kfzk.png?s=128&g=1", "display_name": "cymruu", "link": "https://stackoverflow.com/users/4183352/cymruu"}, "edited": false, "score": 0, "creation_date": 1537652942, "post_id": 52460925, "comment_id": 91864363, "body": "Didn&#39;t understand your idea, can your explain it with a code sketch?"}, {"owner": {"reputation": 2122, "user_id": 4183352, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4Kfzk.png?s=128&g=1", "display_name": "cymruu", "link": "https://stackoverflow.com/users/4183352/cymruu"}, "edited": false, "score": 0, "creation_date": 1537653190, "post_id": 52460925, "comment_id": 91864421, "body": "Closely {... *MessageIntreface *ChatInterface } then you can write custom Unmarshallers for those types just by defining UnmarshalJSON method"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1537656624, "post_id": 52460925, "comment_id": 91865136, "body": "Most probably you should not do any of that, the idea of your types (Update, Message, etc.) having a reference to a copy of the API type seems like an awful design decision. But if you decide to go ahead with the idea then options 1. 2. and 3. are, in my opinion, all wrong with number 1 being the worst offender. The least awkward approach I can think of is to write a function that uses the reflect package to set every field of type API, and you would call this function after you&#39;ve obtained your result and not during unmarshaling. e.g. <code>res := unmarshal(data); populate(res, api)</code>."}], "owner": {"reputation": 43, "user_id": 3504767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a411f32fe096ac485cf0fdfbfa8fddb?s=128&d=identicon&r=PG&f=1", "display_name": "Hennessy", "link": "https://stackoverflow.com/users/3504767/hennessy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 436, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1573575563, "creation_date": 1537650835, "last_edit_date": 1573575563, "question_id": 52460925, "link": "https://stackoverflow.com/questions/52460925/assign-additional-field-when-unmarshalling-json-object-to-struct", "title": "Assign additional field when unmarshalling JSON object to struct", "body": "<p>What is the best way to assign additional field to struct and all it references sub-structure when encoding it from []byte and this field is not a part of unmarshalling []byte?</p>\n\n<p>Let me clarify by example...</p>\n\n<ol>\n<li>We have a few struct:</li>\n</ol>\n\n<pre>\n\n    type Update struct {\n        UpdateID int32 `json:\"update_id\"`\n        Message *Message `json:\"message,omitempty\"`\n        ...\n    }\n\n    type Message struct {\n        MessageID int32 `json:\"message_id\"`\n        From *User `json:\"from,omitempty\"`\n        Date int32 `json:\"date\"`\n        Chat Chat `json:\"chat\"`\n        ...\n    }\n\n</pre>\n\n<ol start=\"2\">\n<li>Our core struct is APIClient and it has many methods for send something or get something (API wrapper)</li>\n</ol>\n\n<pre>\n\n    type API struct {\n        Token string\n        PollInt int32\n        URL string\n\n        client *http.Client\n    }\n\n    func(a *API) ... () {\n\n    }\n\n    func(a *API) ... () {\n\n    }\n\n    ...\n\n</pre>\n\n<ol start=\"3\">\n<li>Main loop poller make http request and return json response as \"res\" \u2013 []byte, so we can use json.Unmarshal to map it to special Update struct</li>\n</ol>\n\n<pre>\n\n    func (a *API) GetUpdates(ctx context.Context, gu *GetUpdates) ([]Update, error) {\n        buf := bytes.Buffer{}\n        err := json.NewEncoder(&buf).Encode(gu)\n        if err != nil {\n            return nil, fmt.Errorf(\"getupdates: %s\", err)\n        }\n\n        res, err := a.DoRequest(&ctx, \"getUpdates\", &buf)\n        if err != nil {\n            return nil, fmt.Errorf(\"getupdates: %s\", err)\n        }\n\n        var result []Update\n        err = json.Unmarshal(res.Result, &result)\n        if err != nil {\n            return nil, fmt.Errorf(\"getupdates: %s\", err)\n        }\n\n        return result, nil\n    }\n\n</pre>\n\n<ol start=\"4\">\n<li>Is it any way to extend ALL structs in unmarhsaling chain for a additional field when use json.Unmarshal</li>\n</ol>\n\n<pre>\n\n    type Update struct {\n        UpdateID int32 `json:\"update_id\"`\n        Message *Message `json:\"message,omitempty\"`\n        ...\n\n        API `json:\"-\"`\n    }\n\n    type Message struct {\n        MessageID int32 `json:\"message_id\"`\n        From *User `json:\"from,omitempty\"`\n        Date int32 `json:\"date\"`\n        Chat Chat `json:\"chat\"`\n        ...\n\n        API `json:\"-\"`\n    }\n\n</pre>\n\n<p>So we can do something like:</p>\n\n<pre>\n\n    var result []Update\n    err = json.Unmarshal(res.Result, &result, api)\n    if err != nil {\n        return nil, fmt.Errorf(\"getupdates: %s\", err)\n    }\n\n</pre>\n\n<p>And then use it:</p>\n\n<pre>\n\n    result[0].RejectUpdate()\n    result[0].Message.SendReply()\n    ...\n    func (u *Update) RejectUpdate(cause string) {\n      m.API.SendMessage(u.Chat.ID, text)\n      m.API.Reject(u.ID, cause)\n    }\n    func (m *Message) SendReply(text string) {\n      m.API.SendMessage(m.Chat.ID, text)\n    }\n\n</pre>\n\n<p>All struct will be extended by api (embedded struct) on unmarshaling...</p>\n\n<p>My thoughts about solution:</p>\n\n<ol>\n<li>Patch standard encoding/json library \u2013 not a good choice</li>\n<li>Get custom encoding library and rewrite a little bit \u2013 questionable choice</li>\n<li>Manually unmarshal all object \u2013 awful code</li>\n</ol>\n\n<pre>\n\n   type Bot struct {\n        superCLient string\n    }\n\n    type Image struct {\n        Name string\n        Path string\n\n        *Bot `json:\"-\"`\n    }\n\n    type FormFile struct {\n        Img  *Image\n        Name string\n\n        *Bot `json:\"-\"`\n    }\n\n    func main() {\n        data := []byte(`{\"Img\": {\"Name\": \"Vi\", \"Path\": \"/etc/log\"}, \"Name\": \"Josh\"}`)\n        bot := &Bot{\n            superCLient: \"ClientExample\",\n        }\n        var omg FormFile\n        omg.CustomUnmarshal(data, bot)\n        fmt.Println(omg)\n    }\n\n    func (ff *FormFile) CustomUnmarshal(data []byte, bot *Bot) error {\n        var f map[string]*json.RawMessage\n        json.Unmarshal(data, &f)\n\n        var i Image\n        i.CustomUnmarshal(*f[\"Img\"], bot)\n        ff.Img = &i\n\n        json.Unmarshal(*f[\"Name\"], ff.Name)\n\n        ff.Bot = bot\n\n        return nil\n    }\n\n    func (img *Image) CustomUnmarshal(data []byte, bot *Bot) error {\n        err := json.Unmarshal(data, img)\n        img.Bot = bot\n        return err\n    }\n\n</pre>\n"}, {"tags": ["go", "glide-golang"], "answers": [{"tags": [], "owner": {"reputation": 1306, "user_id": 5705686, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jYuOhkTQVgQ/AAAAAAAAAAI/AAAAAAAAA1A/v5x1CDU6W4s/photo.jpg?sz=128", "display_name": "dolan", "link": "https://stackoverflow.com/users/5705686/dolan"}, "is_accepted": false, "score": 1, "last_activity_date": 1553437063, "last_edit_date": 1553437063, "creation_date": 1537670638, "answer_id": 52462508, "question_id": 52460700, "link": "https://stackoverflow.com/questions/52460700/how-to-force-dependencies-to-be-installed-from-local-directory/52462508#52462508", "title": "How to force dependencies to be installed from local directory", "body": "<p>If you are vendoring your dependencies before deploying to heroku, you should be able to place the pre-downloaded version of the dependency directly in the vendor folder instead.</p>\n\n<p>Glide also support <code>repo</code> (see the <a href=\"https://glide.readthedocs.io/en/latest/glide.yaml/\" rel=\"nofollow noreferrer\">documentation</a>) which allows you to tell glide which repo to find the code in. You could push the code to a private (or public) github repo and configure your <code>glide.yaml</code> file to point at that repo.</p>\n"}], "owner": {"reputation": 175, "user_id": 2082616, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/fe807193b7c240eb8be61632d5ff9b98?s=128&d=identicon&r=PG", "display_name": "user2082616", "link": "https://stackoverflow.com/users/2082616/user2082616"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553437063, "creation_date": 1537648897, "last_edit_date": 1553437055, "question_id": 52460700, "link": "https://stackoverflow.com/questions/52460700/how-to-force-dependencies-to-be-installed-from-local-directory", "title": "How to force dependencies to be installed from local directory", "body": "<p>I have an app hosted in Heroku, and I use glide to collect dependencies when deploying the app. The problem is that I have one library, namely, <code>gonum.org/v1/gonum</code>, that cannot be downloaded the standard way. Is it possible to somehow force glide to use pre-downloaded version of package instead?</p>\n"}, {"tags": ["go", "serial-port"], "comments": [{"owner": {"reputation": 13673, "user_id": 1599004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df9d2a02744f666e97375e05fdc54255?s=128&d=identicon&r=PG", "display_name": "sawdust", "link": "https://stackoverflow.com/users/1599004/sawdust"}, "edited": false, "score": 0, "creation_date": 1537654718, "post_id": 52460419, "comment_id": 91864776, "body": "<i>&quot;I am not able to open the serial port ... How could I narrow this down? &quot;</i> -- The straightforward debug step is to check if the device the program is trying to open, i.e. &quot;/dev/cu.usbmodem641&quot;, actually exists in the device directory.  FWIW a FTDI adapter would typically show up as a <b>/dev/ttyUSB</b>n device node."}, {"owner": {"reputation": 6026, "user_id": 3991125, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/wbRqp.png?s=128&g=1", "display_name": "albert", "link": "https://stackoverflow.com/users/3991125/albert"}, "reply_to_user": {"reputation": 13673, "user_id": 1599004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df9d2a02744f666e97375e05fdc54255?s=128&d=identicon&r=PG", "display_name": "sawdust", "link": "https://stackoverflow.com/users/1599004/sawdust"}, "edited": false, "score": 0, "creation_date": 1537703010, "post_id": 52460419, "comment_id": 91873182, "body": "@sawdust: Please see my update"}], "owner": {"reputation": 6026, "user_id": 3991125, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/wbRqp.png?s=128&g=1", "display_name": "albert", "link": "https://stackoverflow.com/users/3991125/albert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 334, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1537702991, "creation_date": 1537646534, "last_edit_date": 1537702991, "question_id": 52460419, "link": "https://stackoverflow.com/questions/52460419/unable-to-open-serial-port-with-mikepbs-go-serial", "title": "Unable to open serial port with mikepb&#39;s go-serial", "body": "<p>I try to communicate with a serial device using <a href=\"https://github.com/mikepb/go-serial\" rel=\"nofollow noreferrer\">this package</a>. I adopted the provided sample code to my needs as follows:</p>\n\n<pre><code>package main\n\nimport (\n  \"github.com/mikepb/go-serial\"\n  \"log\"\n)\n\nfunc main() {\n  options := serial.RawOptions\n  options.BitRate = 9600\n  p, err := options.Open(\"/dev/cu.usbmodem641\")\n  if err != nil {\n    log.Panic(err)\n  }\n\n  defer p.Close()\n\n  buf := make([]byte, 1)\n  if _, err := p.Read(buf); err != nil {\n    log.Panic(err)\n  } else {\n    log.Println(buf)\n  }\n}\n</code></pre>\n\n<p>However, I am not able to open the serial port. An error is raised:</p>\n\n<pre><code>2018/09/22 21:50:24 The requested operation is not supported by this system or device\npanic: The requested operation is not supported by this system or device\n\ngoroutine 1 [running]:\nlog.Panic(0xc000049f50, 0x1, 0x1)\n  /usr/local/Cellar/go/1.11/libexec/src/log/log.go:326 +0xc0\nmain.main()\n  /Users/Albert/go/src/serial-test/test.go:14 +0xda\nexit status 2\n</code></pre>\n\n<p>How could I narrow this down? I am working on MacOS 10.10.5 with golang 1.11 from Homebrew. The serial device is an FTDI FT232 or an Atmega 16U2 on-board an Arduino (working with Arduino IDE).</p>\n\n<hr>\n\n<p><em>Update due to comments:</em></p>\n\n<p>I had a typo in my code. <code>/dev/cu.usbmodem641</code> is actually <code>/dev/cu.usbmodem411</code> which is available in device directory as <code>ll /dev/cu.*</code> shows:</p>\n\n<pre><code>crw-rw-rw-  1 root  wheel   17,   1 16 Sep 20:46 /dev/cu.Bluetooth-Incoming-Port\ncrw-rw-rw-  1 root  wheel   17,   3 16 Sep 20:46 /dev/cu.Bluetooth-Modem\ncrw-rw-rw-  1 root  wheel   17, 151 23 Sep 13:21 /dev/cu.usbmodem411\n</code></pre>\n\n<p>Go with go-serial package itself lists the device as well by using:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"log\"\n  \"github.com/mikepb/go-serial\"\n)\n\nfunc main() {\n  portInfo, err := serial.ListPorts()\n  if err != nil {\n    log.Panic(err)\n  }\n  for _, info := range portInfo {\n    fmt.Println(info.Name())\n  }\n}\n</code></pre>\n\n<p>Giving the following output:</p>\n\n<pre><code>$ go run list_serial.go \n/dev/cu.Bluetooth-Incoming-Port\n/dev/cu.Bluetooth-Modem\n/dev/cu.usbmodem411\n</code></pre>\n\n<p>I fixed the typo in the snipped I provided in my question above and tried again which leads to an invalid arguments error:</p>\n\n<pre><code>$ go run test.go \n2018/09/23 13:33:32 Invalid arguments were passed to the function\npanic: Invalid arguments were passed to the function\n\ngoroutine 1 [running]:\nlog.Panic(0xc000049f50, 0x1, 0x1)\n    /usr/local/Cellar/go/1.11/libexec/src/log/log.go:326 +0xc0\nmain.main()\n    /Users/Albert/go/src/go-echo-vue/test.go:13 +0xda\nexit status 2\n</code></pre>\n\n<p>I double-checked everything, found no additional error in my code and ran again. This time getting another error:</p>\n\n<pre><code>$ go run test.go \n2018/09/23 13:37:26 The requested operation is not supported by this system or device\npanic: The requested operation is not supported by this system or device\n\ngoroutine 1 [running]:\nlog.Panic(0xc000044f50, 0x1, 0x1)\n    /usr/local/Cellar/go/1.11/libexec/src/log/log.go:326 +0xc0\nmain.main()\n    /Users/Albert/go/src/go-echo-vue/test.go:13 +0xda\nexit status 2    \n</code></pre>\n\n<p><em>Remark: Serial ports on macOS have two interfaces to the device itself. One is the <code>tty.*</code>, the other is <code>cu.*</code>. For a short explanation see <a href=\"https://stackoverflow.com/a/8632603/3991125\">this SO answer</a>. I was not able to get the Go code running with either of those interfaces raising same errors as stated before.</em></p>\n"}]