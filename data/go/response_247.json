[{"tags": ["sql", "database", "go"], "comments": [{"owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 2, "creation_date": 1570052858, "post_id": 58209730, "comment_id": 102797178, "body": "Not knowing your sql statement before running it sounds like a security nightmare. Other than that, if you really, REALLY trust the sql, you can probably just run everything with Query and accept that sometimes the query won&#39;t return a result set. It&#39;s not perfect (e.g. you won&#39;t know how many records were modified by UPDATE queries) but the only other safe solution I can think of would be to rearchitect something upstream."}, {"owner": {"reputation": 11, "user_id": 10934779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b21f6833318622afddfd4502b8d6abfa?s=128&d=identicon&r=PG&f=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/10934779/jack"}, "reply_to_user": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 0, "creation_date": 1570060354, "post_id": 58209730, "comment_id": 102798728, "body": "security is not an issue, assume that you are writing a wrapper function, unfortunately, using Query() for all query strings will not work for many C_UD operations."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1570063229, "post_id": 58209730, "comment_id": 102799266, "body": "I&#39;d throw in that the incident which is inevitably going to happen does not necessarily have to come from malicious intent. However, as far as I get the sql package, it is merely a question wether something is returned or not. So basically, you can use query all the time, it might just happen that <code>*Rows</code> is nil or empty. A simple guard should do the trick."}, {"owner": {"reputation": 11, "user_id": 10934779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b21f6833318622afddfd4502b8d6abfa?s=128&d=identicon&r=PG&f=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/10934779/jack"}, "edited": false, "score": 0, "creation_date": 1570112849, "post_id": 58209730, "comment_id": 102818250, "body": "create, update, delete or insert operations using Query() will not return an error and Rows will not be nil but the query will not succeed.  GORM (the db orm) for example has two functions Exec and Row which in the background are used for sql.DB.Exec() and sql.DB.Query() respectively"}], "answers": [{"comments": [{"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 0, "creation_date": 1570365968, "post_id": 58255254, "comment_id": 102883539, "body": "I&#39;m  100% agree with advice &quot;don&#39;t try to parse SQL&quot;  but I would use stronger words than just &quot;hacky&quot;.  More proper: &quot;impossible in general case to predict by parsing <code>query string</code> parameter existence/non-existence of output&quot;."}], "tags": [], "owner": {"reputation": 234, "user_id": 6628349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e88d4443473648a6a488a8c91d494af?s=128&d=identicon&r=PG&f=1", "display_name": "vincent163", "link": "https://stackoverflow.com/users/6628349/vincent163"}, "is_accepted": false, "score": 2, "last_activity_date": 1570348233, "creation_date": 1570348233, "answer_id": 58255254, "question_id": 58209730, "link": "https://stackoverflow.com/questions/58209730/determine-whether-to-use-db-exec-or-db-query-from-unknown-query-string/58255254#58255254", "title": "Determine whether to use DB.Exec or DB.Query from unknown query string", "body": "<p>In any cases, don't try to parse SQL since it's hacky. Just use <code>Query</code> if you are not sure, <code>Query</code> should be able to handle C_UD well and return an empty result set in that case. Both <code>Query</code> and <code>Exec</code> should have exactly the same effect, and they only differ in their response. Only use <code>Exec</code> if the user of your API explicitly does not need the results.</p>\n"}, {"tags": [], "owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "is_accepted": false, "score": 0, "last_activity_date": 1615663824, "last_edit_date": 1615663824, "creation_date": 1570365533, "answer_id": 58257302, "question_id": 58209730, "link": "https://stackoverflow.com/questions/58209730/determine-whether-to-use-db-exec-or-db-query-from-unknown-query-string/58257302#58257302", "title": "Determine whether to use DB.Exec or DB.Query from unknown query string", "body": "<p>Your question is not that simple as it may seem from the first sight.</p>\n<p>Let's clarify the problem:</p>\n<p>Question is not about particular database as pgsql/mysql/sqlite/other but for any generic database drive.</p>\n<p>So the answer must be in  <code>database/sql/driver</code>.</p>\n<p>Let's go further:</p>\n<p><code>sql/driver</code>. Interfaces: <code>Queryer</code>/<code>QueryerContext</code> &amp; <code>Execer</code>/<code>ExecerContext</code></p>\n<p>Module <code>sql/driver</code> defines interfaces:</p>\n<ul>\n<li><code>Queryer</code>/<code>QueryerContext</code> - for ability to <code>(*DB).Query</code></li>\n<li><code>Execer</code>/<code>ExecerContext</code> - for <code>(*DB).Exec</code></li>\n<li>others such as <code>Pinger</code></li>\n</ul>\n<p>Note that <strong>every interface</strong> described in documentation as <em>&quot; an optional interface that may be implemented by a Conn&quot;</em></p>\n<p>Which means that it's possible to implement sql driver without <code>Query</code> and/or <code>Exec</code>.</p>\n<p><strong>Experimental verification</strong></p>\n<p>Let's try to implement <strong>correct</strong> database driver that cannot <code>Query</code> and <code>Exec</code>: <a href=\"https://play.golang.org/p/sZiigEghphE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/sZiigEghphE</a></p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;database/sql&quot;\n    &quot;database/sql/driver&quot;\n    &quot;log&quot;\n)\n\ntype expdrv struct{}\ntype expconn struct{}\n\n// sql.Driver implementation\nfunc (*expdrv) Open(name string) (driver.Conn, error) {\n    return &amp;expconn{}, nil\n}\n\n// driver.Conn implementation\nfunc (c *expconn) Prepare(query string) (driver.Stmt, error) {\n    return nil, nil\n}\n\nfunc (c *expconn) Close() error {\n    return nil\n}\n\nfunc (c *expconn) Begin() (driver.Tx, error) {\n    return nil, nil\n}\n\nfunc main() {\n    sql.Register(&quot;drvexp&quot;, &amp;expdrv{})\n    log.Printf(&quot;Registred drivers: %v\\n&quot;, sql.Drivers())\n\n    db, err := sql.Open(&quot;drvexp&quot;, &quot;&quot;)\n    log.Printf(&quot;sql.Open() success: %v, error: %v&quot;, db != nil, err)\n\n    log.Println(&quot;db.Close() error:&quot;, db.Close())\n}\n</code></pre>\n<pre>\n2009/11/10 23:00:00 Registred drivers: [drvexp]\n2009/11/10 23:00:00 sql.Open() success: true, error: \n2009/11/10 23:00:00 db.Ping()  success: true\n2009/11/10 23:00:00 db.Close() success: true\n2009/11/10 23:00:00 db.Ping()  result:  sql: database is closed\n</pre>\n<p>It works!</p>\n<p>This <code>Driver</code> implementation is:</p>\n<ul>\n<li>correct from <code>database/sql</code> standpoint</li>\n<li>has no working methods <code>Query</code> and <code>Exec</code> (attempt will throw panic)</li>\n<li>surprisingly working <code>Ping()</code></li>\n</ul>\n<p><strong>Possibility to implement <code>Exec</code> or <code>Query</code> independently of each other</strong></p>\n<p>Let's add <code>Exec</code>:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>// driver.Result &amp; driver.Execer\ntype expresult struct{}\n\nfunc (*expconn) Exec(query string, args []driver.Value) (driver.Result, error) {\n    return &amp;expresult{}, nil\n}\n\nfunc (*expresult) LastInsertId() (int64, error) {\n    return 0, nil\n}\n\nfunc (*expresult) RowsAffected() (int64, error) {\n    return 0, nil\n}\n</code></pre>\n<p>will allow:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>_, err = db.Exec(&quot;BYE&quot;)\nfmt.Println(&quot;db.Exec() success:&quot;, err == nil) // Outputs: true\n</code></pre>\n<p><strong>Conclusion</strong></p>\n<ul>\n<li><p>Ability to call <code>Query/QueryContext</code> and/or <code>Exec/ExecContext</code> are optional</p>\n</li>\n<li><p>Behaviour of those methods can vary at great length between drivers</p>\n</li>\n<li><p>In general case there is no correct answer exists</p>\n</li>\n<li><p>For particular cases (with specific driver):</p>\n<ul>\n<li>it's possible to suppose that <code>db.Query</code> would work for most cases</li>\n<li>but it's impossible to guarantee that <code>Query</code> will really work without experimental verification</li>\n</ul>\n</li>\n</ul>\n<p>Thank you for your attention!</p>\n<p>I suppose that's the final answer.</p>\n"}], "owner": {"reputation": 11, "user_id": 10934779, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b21f6833318622afddfd4502b8d6abfa?s=128&d=identicon&r=PG&f=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/10934779/jack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 426, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1615663824, "creation_date": 1570052490, "last_edit_date": 1570068112, "question_id": 58209730, "link": "https://stackoverflow.com/questions/58209730/determine-whether-to-use-db-exec-or-db-query-from-unknown-query-string", "title": "Determine whether to use DB.Exec or DB.Query from unknown query string", "body": "<p>Using \"<code>database/sql</code>\", <code>sql.DB.Exec()</code> is used for queries that do not return rows (<code>insert, delete, update</code>) and <code>sql.DB.Query(</code>) for queries that return rows (<code>selects</code>).\nAssume you have an incoming query string which you wish to execute, however you do not know whether the query intends to return rows.\nCan you think of a way to find out whether to use Exec or Query?</p>\n"}, {"tags": ["go", "struct", "slice"], "comments": [{"owner": {"reputation": 163, "user_id": 11869461, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tNYETRt85Vc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reswQ_iiZbSbtY0EpXqOvZxksDFVQ/photo.jpg?sz=128", "display_name": "ialam", "link": "https://stackoverflow.com/users/11869461/ialam"}, "edited": false, "score": 1, "creation_date": 1570047417, "post_id": 58208538, "comment_id": 102795448, "body": "Please see the solution in =&gt; <a href=\"https://play.golang.org/p/ZYdkczjlC-R\" rel=\"nofollow noreferrer\">play.golang.org/p/ZYdkczjlC-R</a>"}, {"owner": {"reputation": 456, "user_id": 472427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/2bb9596cdff38909b67f70aecf36c557?s=128&d=identicon&r=PG", "display_name": "AndyM", "link": "https://stackoverflow.com/users/472427/andym"}, "edited": false, "score": 1, "creation_date": 1570047449, "post_id": 58208538, "comment_id": 102795455, "body": "Yes not a duplicate := wasn&#39;t the main issue."}], "answers": [{"comments": [{"owner": {"reputation": 456, "user_id": 472427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/2bb9596cdff38909b67f70aecf36c557?s=128&d=identicon&r=PG", "display_name": "AndyM", "link": "https://stackoverflow.com/users/472427/andym"}, "edited": false, "score": 0, "creation_date": 1570047377, "post_id": 58208639, "comment_id": 102795434, "body": "OK many thanks, the initialize explains it !  The number of swells will always be arbitrary"}], "tags": [], "owner": {"reputation": 39296, "user_id": 560299, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c38fe465734e8428048585e0acf6174f?s=128&d=identicon&r=PG", "display_name": "Ibu", "link": "https://stackoverflow.com/users/560299/ibu"}, "is_accepted": false, "score": 2, "last_activity_date": 1570047039, "last_edit_date": 1570047039, "creation_date": 1570046666, "answer_id": 58208639, "question_id": 58208538, "link": "https://stackoverflow.com/questions/58208538/how-to-populate-a-struct-that-contains-slice-of-structs-with-unknown-size/58208639#58208639", "title": "How to populate a struct that contains slice of structs with unknown size", "body": "<p>First, note that you can't assign a value to a struct property with <code>:=</code>. And to fix your main issue you just have to initialize <code>p.Swells</code></p>\n\n<pre><code>func NewForecastHour() *ForecastHour {\n       p := ForecastHour{}\n       p.Year  = 2019\n       p.Month = 10\n       p.Day = 3\n       p.Hour = 13\n       p.Swells = make([]Swell, 3) // initialize with size 3\n\n       p.Swells[0] = Swell{ Slot: 0, Height: 2.20, Period: 15.5,Dir: 300 }\n       p.Swells[1] = Swell{ Slot: 1, Height: 1.20, Period: 5.5,Dir: 90 }\n       p.Swells[2] = Swell{ Slot: 5, Height: 0.98, Period: 7.5,Dir: 180 }\n\n       return &amp;p\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/OpHkDUAqxYW\" rel=\"nofollow noreferrer\">Demo</a></p>\n\n<p>If you have an arbitrary number of Swells to add, you can use the less efficient append method:</p>\n\n<pre><code>p.Swells = []Swell{}\np.Swells = append(p.Swells, Swell{ Slot: 0, Height: 2.20, Period: 15.5,Dir: 300 })\np.Swells = append(p.Swells, Swell{ Slot: 1, Height: 1.20, Period: 5.5,Dir: 90 })\np.Swells = append(p.Swells, Swell{ Slot: 5, Height: 0.98, Period: 7.5,Dir: 180 })\n</code></pre>\n\n<p>This works in a for loop.</p>\n"}], "owner": {"reputation": 456, "user_id": 472427, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/2bb9596cdff38909b67f70aecf36c557?s=128&d=identicon&r=PG", "display_name": "AndyM", "link": "https://stackoverflow.com/users/472427/andym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1570087150, "creation_date": 1570046208, "last_edit_date": 1570046454, "question_id": 58208538, "link": "https://stackoverflow.com/questions/58208538/how-to-populate-a-struct-that-contains-slice-of-structs-with-unknown-size", "title": "How to populate a struct that contains slice of structs with unknown size", "body": "<p>I'm trying to get my head around the following simplified version of my problem. </p>\n\n<p>I'd like to initialise a struct that has a slice of another type of struct within it.</p>\n\n<p>I've looked at the various examples they seem to be for simpler versions where the struct just contains a slice of []int etc. </p>\n\n<p>I can't seem to figure out what I whats needed to initialise my struct/slices.  </p>\n\n<p>The <code>Swells</code> slice can be an arbitrary length including empty.</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n)\n\ntype Swell struct {\n        Slot      uint\n        Height    float32\n        Period    float32\n        Dir       uint\n}\n\ntype ForecastHour struct {\n        Year      uint\n        Month     uint\n        Day       uint\n        Hour      uint\n        Swells    []Swell\n}\n\nfunc NewForecastHour() *ForecastHour {\n       p := ForecastHour{}\n       p.Year  = 2019\n       p.Month = 10\n       p.Day = 3\n       p.Hour = 13\n\n\n       p.Swells[0] := { Slot: 0, Height: 2.20, Period: 15.5,Dir: 300 }\n       p.Swells[1] := { Slot: 1, Height: 1.20, Period: 5.5,Dir: 90 }\n       p.Swells[2] := { Slot: 5, Height: 0.98, Period: 7.5,Dir: 180 }\n\n       return &amp;p\n}\n\nfunc main() {\n        ThisHour := NewForecastHour()\n        fmt.Println(ThisHour)\n}\n</code></pre>\n\n<p>When I run the above I get:</p>\n\n<pre><code>./test.go:30:16: non-name p.Swells[0] on left side of :=\n./test.go:30:23: syntax error: unexpected {, expecting expression\n./test.go:31:8: syntax error: non-declaration statement outside function body\n</code></pre>\n"}, {"tags": ["javascript", "html", "go"], "answers": [{"comments": [{"owner": {"reputation": 739, "user_id": 5801621, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/eca1a0e83999e7a4a00f7774b15f1ca2?s=128&d=identicon&r=PG&f=1", "display_name": "O. San", "link": "https://stackoverflow.com/users/5801621/o-san"}, "edited": false, "score": 0, "creation_date": 1570047888, "post_id": 58208560, "comment_id": 102795625, "body": "Thank you! and one more small Q, when I &quot;View Page Source&quot;, I basicly see the raw HTML? It would be identical to the HTTP requests&#39; response?"}, {"owner": {"reputation": 2643, "user_id": 1377323, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/963103a32936718819cd95ed38fb43fb?s=128&d=identicon&r=PG", "display_name": "herrbischoff", "link": "https://stackoverflow.com/users/1377323/herrbischoff"}, "reply_to_user": {"reputation": 739, "user_id": 5801621, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/eca1a0e83999e7a4a00f7774b15f1ca2?s=128&d=identicon&r=PG&f=1", "display_name": "O. San", "link": "https://stackoverflow.com/users/5801621/o-san"}, "edited": false, "score": 0, "creation_date": 1570048107, "post_id": 58208560, "comment_id": 102795697, "body": "If the server does not change the output for different user agents, then yes, it should be identical. Also, if you feel that my answer helped you, you could <a href=\"http://meta.stackexchange.com/a/5235\">accept it</a>."}, {"owner": {"reputation": 14671, "user_id": 2317490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypoen.png?s=128&g=1", "display_name": "dandavis", "link": "https://stackoverflow.com/users/2317490/dandavis"}, "edited": false, "score": 0, "creation_date": 1570048141, "post_id": 58208560, "comment_id": 102795708, "body": "isn&#39;t there a html parser for go yet?"}, {"owner": {"reputation": 2643, "user_id": 1377323, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/963103a32936718819cd95ed38fb43fb?s=128&d=identicon&r=PG", "display_name": "herrbischoff", "link": "https://stackoverflow.com/users/1377323/herrbischoff"}, "edited": false, "score": 3, "creation_date": 1570048261, "post_id": 58208560, "comment_id": 102795752, "body": "There certainly is (Example: <a href=\"https://github.com/PuerkitoBio/goquery\" rel=\"nofollow noreferrer\">github.com/PuerkitoBio/goquery</a>). However, like I mentioned, an HTML parser will <b>not</b> apply DOM manipulations made by JavaScript, which is what OP is apparently asking for."}], "tags": [], "owner": {"reputation": 2643, "user_id": 1377323, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/963103a32936718819cd95ed38fb43fb?s=128&d=identicon&r=PG", "display_name": "herrbischoff", "link": "https://stackoverflow.com/users/1377323/herrbischoff"}, "is_accepted": true, "score": 2, "last_activity_date": 1570047962, "last_edit_date": 1570047962, "creation_date": 1570046341, "answer_id": 58208560, "question_id": 58208468, "link": "https://stackoverflow.com/questions/58208468/retrieve-website-dom-via-http-request-in-go/58208560#58208560", "title": "Retrieve website DOM via http request in GO", "body": "<p>A simple HTTP request (via Go or anything else) will only ever get the raw HTML. The DOM is a browser-generated interpretation of the raw HTML. Yes, there is even something like the <a href=\"https://glazkov.com/2011/01/14/what-the-heck-is-shadow-dom/\" rel=\"nofollow noreferrer\">Shadow DOM</a>.</p>\n\n<p>JavaScript is interpreted by the browsers' JavaScript engine which applies changes to the DOM, adds event listeners and dynamically manipulates said DOM.</p>\n\n<p>This is why you cannot get the DOM state you see in a browser through a HTTP request. The request does not contain all the client-side DOM manipulations done through a browsers' JavaScript engine. A request library is not a browser.</p>\n\n<p>To get access to the full rendered DOM you're accustomed to see in the Developer Tools, you're going to need a more involved web scraping setup, usually involving a headless browser, like <a href=\"https://github.com/GoogleChrome/puppeteer\" rel=\"nofollow noreferrer\">Puppeteer</a>. However, this is written in Node.js. Given Go, you may have better luck with <a href=\"https://github.com/chromedp/chromedp\" rel=\"nofollow noreferrer\">chromedp</a> or <a href=\"https://github.com/mafredri/cdp\" rel=\"nofollow noreferrer\">cdp</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1570046524, "creation_date": 1570046524, "answer_id": 58208600, "question_id": 58208468, "link": "https://stackoverflow.com/questions/58208468/retrieve-website-dom-via-http-request-in-go/58208600#58208600", "title": "Retrieve website DOM via http request in GO", "body": "<p>DOM stands for \"Document Object Model\", which is a tree of nodes where each node represents an element of the underlying document. Nodes may correspond to elements, text, comments, etc. There are many go-based DOM packages around. One you should look at is: </p>\n\n<p><a href=\"https://godoc.org/golang.org/x/net/html\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/net/html</a></p>\n\n<p>It lets you parse HTML, and traverse elements of the document programatically. </p>\n"}], "owner": {"reputation": 739, "user_id": 5801621, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/eca1a0e83999e7a4a00f7774b15f1ca2?s=128&d=identicon&r=PG&f=1", "display_name": "O. San", "link": "https://stackoverflow.com/users/5801621/o-san"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 58208560, "answer_count": 2, "score": 0, "last_activity_date": 1570047962, "creation_date": 1570045835, "question_id": 58208468, "link": "https://stackoverflow.com/questions/58208468/retrieve-website-dom-via-http-request-in-go", "title": "Retrieve website DOM via http request in GO", "body": "<p>in GO I use HTTP request to get a site html and I see in some elements difference than when using Inspect in Chrome. A search in google and some reading led me to understand that what I see in Inspect is a stage called DOM which takes the raw html and runs some java scripts that add info and alter elements (go easy on me, I'm new at this ^_^).\nIs there a why I can receive in GO the DOM instead of the raw html? I know I can use Chromedp, but I'm hoping for something more like some sort of an HTTP package because Chromedp a bit heavy on performance.\nI would really appreciate any suggestions, thank you.   </p>\n"}, {"tags": ["go", "ginkgo", "gomega"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1570039650, "post_id": 58206898, "comment_id": 102792033, "body": "No need to write tests for that, just use the compiler: <code>var _ Common = (*Stuff)(nil)</code>. You&#39;ll find this pattern in the standard library as well."}, {"owner": {"reputation": 2846, "user_id": 1318830, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/NKMrG.jpg?s=128&g=1", "display_name": "mkungla", "link": "https://stackoverflow.com/users/1318830/mkungla"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570040113, "post_id": 58206898, "comment_id": 102792235, "body": "@mkopriva so just to expect compiler to fail e.g.  <code>var _ Common = (*Stuff)(nil)</code>, <code>var _ Common2 = (*Stuff)(nil)</code> ... ???"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1570040254, "post_id": 58206898, "comment_id": 102792298, "body": "yup, with that your program will <i>not</i> compile if <code>*Stuff</code> does not implement <code>Common</code>, and if your program compiles it means <code>*Stuff</code> <i>does</i> implement <code>Common</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570040461, "post_id": 58206898, "comment_id": 102792389, "body": "<a href=\"https://play.golang.com/p/G3YNlQ2MeAQ\" rel=\"nofollow noreferrer\">play.golang.com/p/G3YNlQ2MeAQ</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570041263, "post_id": 58206898, "comment_id": 102792772, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/q/30367803/13860\">stackoverflow.com/q/30367803/13860</a>"}, {"owner": {"reputation": 2846, "user_id": 1318830, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/NKMrG.jpg?s=128&g=1", "display_name": "mkungla", "link": "https://stackoverflow.com/users/1318830/mkungla"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570042133, "post_id": 58206898, "comment_id": 102793153, "body": "@mkopriva updated the question! What I mean is that <code>lib</code> package builds without knowing that stuff should implement <code>String2</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1570043635, "post_id": 58206898, "comment_id": 102793834, "body": "@mkungla write the check where you need <code>*Stuff</code> to implement <code>Common</code>. However keep in mind that this is less useful outside of the declaring package. Why? Because most likely you are importing <code>stuff</code> so that you can use it and if you&#39;re using <code>*Stuff</code> where <code>Common</code> is expected, imported or not, the compiler will complain if the interface is not implemented, and keep quiet if it is. <a href=\"https://play.golang.com/p/FipYcC3evRT\" rel=\"nofollow noreferrer\">example1</a>, <a href=\"https://play.golang.com/p/zduCZu2MJTc\" rel=\"nofollow noreferrer\">example2</a>, <a href=\"https://play.golang.com/p/hbszAqouVmz\" rel=\"nofollow noreferrer\">example3</a>"}], "owner": {"reputation": 2846, "user_id": 1318830, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/NKMrG.jpg?s=128&g=1", "display_name": "mkungla", "link": "https://stackoverflow.com/users/1318830/mkungla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 375, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1570043328, "creation_date": 1570039185, "last_edit_date": 1570042412, "question_id": 58206898, "link": "https://stackoverflow.com/questions/58206898/how-to-test-that-a-struct-implements-a-specific-interface", "title": "How to test that a struct implements a specific interface", "body": "<p><strong>What is the right way to write following test?</strong></p>\n\n<p>To avoid writing inside the package itself </p>\n\n<pre><code>var _ Common = (*Stuff)(nil), \nvar _ Common2 = (*Stuff)(nil)\nvar _ Common3 = (*Stuff)(nil)\n...\n</code></pre>\n\n<p>``</p>\n\n<h1>package stuff</h1>\n\n<blockquote>\n  <p>stuff/common.go</p>\n</blockquote>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package stuff\n\ntype Common interface {\n  String() string\n}\n</code></pre>\n\n<blockquote>\n  <p>stuff/common2.go</p>\n</blockquote>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package stuff\n\ntype Common2 interface {\n  String2() string\n}\n</code></pre>\n\n<blockquote>\n  <p>stuff/stuff_suite_test.go</p>\n</blockquote>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package stuff\n\nimport (\n  \"testing\"\n  . \"github.com/onsi/ginkgo\"\n  . \"github.com/onsi/gomega\"\n)\n\nfunc Test(t *testing.T) {\n  RegisterFailHandler(Fail)\n  RunSpecs(t, \"Stuff\")\n}\n</code></pre>\n\n<blockquote>\n  <p>stuff/stuff_test.go</p>\n</blockquote>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package stuff\n\nimport (\n  \"testing\"\n  . \"github.com/onsi/ginkgo\"\n  . \"github.com/onsi/gomega\"\n}\n\nvar _ = Describe(\"Stuff\", func() {\n  It(\"implements Common\", func() {\n    var s interface{} = &amp;Stuff{}\n    _, ok := s.(Common)\n    Expect(ok).To(Equal(true))\n  })\n})\n\nIt(\"implements Common 2\", func() {\n  var _ Common2 = (*Stuff)(nil) // ok\n})\n</code></pre>\n\n<blockquote>\n  <p>stuff/stuff.go</p>\n</blockquote>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package stuff\n\ntype Stuff struct {}\n\nfunc (s *Stuff) String() string {\n  return \"\"\n}\n</code></pre>\n\n<h1>package lib</h1>\n\n<blockquote>\n  <p>/lib/lib.go</p>\n</blockquote>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import \"stuff\"\n\nfunc GetCommon() *stuff.Stuff {\n  return &amp;stuff.Stuff{}\n}\n</code></pre>\n\n<blockquote>\n  <p>/lib/lib_suite_test.go</p>\n</blockquote>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package lib\n\nimport (\n  \"testing\"\n  . \"github.com/onsi/ginkgo\"\n  . \"github.com/onsi/gomega\"\n)\n\nfunc Test(t *testing.T) {\n  RegisterFailHandler(Fail)\n  RunSpecs(t, \"Lib\")\n}\n</code></pre>\n\n<blockquote>\n  <p>/lib/lib_test.go</p>\n</blockquote>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package lib\n\nimport (\n    . \"github.com/onsi/ginkgo\"\n    . \"github.com/onsi/gomega\"\n)\n\nvar _ = Describe(\"Lib\", func() {\n  It(\"can be created\", func() {\n    l := GetCommon()\n    Expect(l).NotTo(BeNil())\n  })\n}\n</code></pre>\n"}, {"tags": ["go", "aws-lambda", "amazon-iam", "serverless-framework", "aws-sdk-go"], "answers": [{"comments": [{"owner": {"reputation": 1263, "user_id": 448967, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/79b84e97fab1f1e001a0f9e22a1ae326?s=128&d=identicon&r=PG", "display_name": "Adgezaza", "link": "https://stackoverflow.com/users/448967/adgezaza"}, "edited": false, "score": 0, "creation_date": 1570150546, "post_id": 58208270, "comment_id": 102831958, "body": "I ended up using * for now."}], "tags": [], "owner": {"reputation": 1003, "user_id": 2389292, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/L1X7h.jpg?s=128&g=1", "display_name": "Gareth McCumskey", "link": "https://stackoverflow.com/users/2389292/gareth-mccumskey"}, "is_accepted": false, "score": 1, "last_activity_date": 1570044954, "creation_date": 1570044954, "answer_id": 58208270, "question_id": 58206844, "link": "https://stackoverflow.com/questions/58206844/dynamo-updateitem-accessdeniedexception-with-default-lambdarole/58208270#58208270", "title": "Dynamo UpdateItem AccessDeniedException with default LambdaRole", "body": "<p>DynamoDB has sub resources that often need access. To ensure that you are also addressing those sub items I would recommend adding a wildcard <code>*</code> onto the end of the resource. To do this I prefer to use the <code>serverless-pseudo-parameters</code> plugin (you can install it quickly with <code>serverless plugin install --name serverless-pseudo-parameters</code>) and then use it to more cleanly describe the resource like:</p>\n\n<pre><code>      Resource:\n        - arn:aws:dynamodb:#{AWS::Region}:#{AWS::AccountId}:table/myTable-${opt:stage, 'dev'}*\n</code></pre>\n"}], "owner": {"reputation": 1263, "user_id": 448967, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/79b84e97fab1f1e001a0f9e22a1ae326?s=128&d=identicon&r=PG", "display_name": "Adgezaza", "link": "https://stackoverflow.com/users/448967/adgezaza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1570044954, "creation_date": 1570038968, "question_id": 58206844, "link": "https://stackoverflow.com/questions/58206844/dynamo-updateitem-accessdeniedexception-with-default-lambdarole", "title": "Dynamo UpdateItem AccessDeniedException with default LambdaRole", "body": "<p>I'm having difficulties getting the right role to execute a Dynamo UpdateItem in my golang lambda handler.</p>\n\n<p>I've deployed the function using the serverless framework with the following config:</p>\n\n<pre><code>provider:\n  name: aws\n  runtime: go1.x\n  stage: ${opt:stage, 'dev'}\n  environment: ${file(./env/config.${self:provider.stage}.yml)}\n  iamRoleStatements: # TODO: create special roles and restrict access per lambda\n    - Effect: Allow\n      Action:\n        - dynamodb:DescribeTable\n        - dynamodb:Query\n        - dynamodb:Scan\n        - dynamodb:GetItem\n        - dynamodb:PutItem\n        - dynamodb:UpdateItem\n        - dynamodb:DeleteItem\n      Resource:\n        - \"Fn::GetAtt\": [ myTable, Arn ]\n\nresources:\n  Resources:\n    myTable:\n      Type: 'AWS::DynamoDB::Table'\n      Properties:\n        TableName: myTable-${opt:stage, 'dev'}\n        AttributeDefinitions:\n          - AttributeName: UserID\n            AttributeType: S\n        KeySchema:\n          - AttributeName: UserID\n            KeyType: HASH\n        ProvisionedThroughput:\n          ReadCapacityUnits: 1\n          WriteCapacityUnits: 1\n\nfunctions:\n  myFunc:\n    handler: bin/myFunc\n    events:\n      - http:\n          path: myFunc\n          method: post\n          authorizer: app-auth\n          cors: true\n</code></pre>\n\n<p>The handler uses the golang aws-sdk to create a session and call UpdateItem on the table:</p>\n\n<pre><code>    sess, err := session.NewSession()\n    svc := dynamodb.New(sess)\n    input := &amp;dynamodb.UpdateItemInput{\n        ...\n    }\n    _, err = svc.UpdateItem(input)\n</code></pre>\n\n<p>This throws the exception:</p>\n\n<p><code>AccessDeniedException: User: arn:aws:sts::{acct}:assumed-role/myservice-stage-us-east-1-lambdaRole/myservice-stage-myfunc</code></p>\n\n<p>The <code>User: arn:aws:sts::{acct}:assumed-role/myservice-stage-us-east-1-lambdaRole</code> is a role that has the correct permissions:</p>\n\n<p><a href=\"https://i.stack.imgur.com/wNfoO.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wNfoO.png\" alt=\"enter image description here\"></a></p>\n\n<p>I'm not sure what the <code>/myservice-stage-myfunc</code> part of the User is in the exception as nothing of the sort exists in the IAM console.</p>\n\n<p>Is there some kind of config step I'm missing. To my knowledge, the IAM permissions setup in the serverless.yaml should apply to all functions. However, the assumed role for when working with the go-aws-sdk seems wrong.</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1570030892, "post_id": 58204618, "comment_id": 102787949, "body": "See <a href=\"https://golang.org/doc/go1.12#modules\" rel=\"nofollow noreferrer\">golang.org/doc/go1.12#modules</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1570031119, "post_id": 58204618, "comment_id": 102788059, "body": "Also: <a href=\"https://golang.org/cmd/go/#hdr-The_go_mod_file\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-The_go_mod_file</a>: The expected language version, set by the go directive, determines which language features are available when compiling the module. Language features available in that version will be available for use. Language features removed in earlier versions, or added in later versions, will not be available. Note that the language version does not affect build tags, which are determined by the Go release being used."}], "answers": [{"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 7, "last_activity_date": 1570033473, "creation_date": 1570033473, "answer_id": 58205552, "question_id": 58204618, "link": "https://stackoverflow.com/questions/58204618/what-are-the-implications-of-using-the-go-version-directive-within-a-go-module/58205552#58205552", "title": "What are the implications of using the &quot;go&quot; version directive within a go module file (go.mod)", "body": "<p>It should be considered along the lines of a minimum required Go Version. If you build with the same or a higher version of Go, all should be fine as promised by the <a href=\"https://golang.org/doc/go1compat\" rel=\"noreferrer\">Go 1 compatibility promise</a>. If you build with a lower version there will be an error message if the build fails:</p>\n\n<blockquote>\n  <p>The go directive in a go.mod file now indicates the version of the language used by the files within that module. It will be set to the current release (go 1.12) if no existing version is present. If the go directive for a module specifies a version newer than the toolchain in use, the go command will attempt to build the packages regardless, and will note the mismatch only if that build fails. <a href=\"https://golang.org/doc/go1.12#modules\" rel=\"noreferrer\">Go 1.12 Release Notes</a></p>\n</blockquote>\n"}], "owner": {"reputation": 4513, "user_id": 605022, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/CRrSr.jpg?s=128&g=1", "display_name": "mdwhatcott", "link": "https://stackoverflow.com/users/605022/mdwhatcott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 58205552, "answer_count": 1, "score": 9, "last_activity_date": 1570033473, "creation_date": 1570029955, "question_id": 58204618, "link": "https://stackoverflow.com/questions/58204618/what-are-the-implications-of-using-the-go-version-directive-within-a-go-module", "title": "What are the implications of using the &quot;go&quot; version directive within a go module file (go.mod)", "body": "<p>Given the following go.mod file:</p>\n\n<pre><code>module foo\n\ngo 1.12\n\nrequire (\n    github.com/bar/baz v1.0.0\n    github.com/rat/cat v1.0.0\n)\n</code></pre>\n\n<p>What does the <code>go 1.12</code> indicate? Does it prevent compiling the <code>foo</code> module against any other version of Go? Or is it simply an indicator of the <code>foo</code>'s recommended/required Go version? Is this a directive that we should update whenever a new version of go is released (every 6 months)?</p>\n"}, {"tags": ["go", "networking", "tcp"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1570029915, "post_id": 58204571, "comment_id": 102787384, "body": "Use <a href=\"https://en.wikipedia.org/wiki/Multicast_DNS\" rel=\"nofollow noreferrer\">mDNS</a> and DNS service discovery."}, {"owner": {"reputation": 4989, "user_id": 3745413, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jQsNL.png?s=128&g=1", "display_name": "Ron Maupin", "link": "https://stackoverflow.com/users/3745413/ron-maupin"}, "edited": false, "score": 0, "creation_date": 1570033620, "post_id": 58204571, "comment_id": 102789292, "body": "You can use multicast for this type of thing."}, {"owner": {"reputation": 1, "user_id": 12154583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84d58819b74c3baf7e90b8a34bb6e694?s=128&d=identicon&r=PG&f=1", "display_name": "kylepritchard", "link": "https://stackoverflow.com/users/12154583/kylepritchard"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1570037249, "post_id": 58204571, "comment_id": 102790967, "body": "@CeriseLim&#243;n Thank you so much! That was exactly what I was after and wouldn&#39;t have found the answer without your feedback. Quick googling and found <a href=\"https://sosedoff.com/2017/09/07/zeroconf.html\" rel=\"nofollow noreferrer\">this</a> which gave me exactly what I was after :)"}], "owner": {"reputation": 1, "user_id": 12154583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84d58819b74c3baf7e90b8a34bb6e694?s=128&d=identicon&r=PG&f=1", "display_name": "kylepritchard", "link": "https://stackoverflow.com/users/12154583/kylepritchard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1570029782, "creation_date": 1570029782, "question_id": 58204571, "link": "https://stackoverflow.com/questions/58204571/need-help-to-search-a-network", "title": "Need help to search a network", "body": "<p>I have a program which I use at work for organising jobs and planning future work. Kind of like a todo list on steroids. At present it runs via a central golang server and users connect through local network to the server to retrieve data. The server gets the IP address of the host machine and saves it to a file on a shared drive and the clients read this file so they know where to connect. I would like to have this done differently so that the clients (also golang servers) each perform a search of the local network upon startup until they find the server and then store its IP address. I am wondering if there is a way to scan a network and ping each IP address until it gets a response from the server machine?</p>\n\n<p>I can get the client machines to perform a 'ping' to a set address and I can expand upon this with a for loop to generate a list of IP address's to 'ping'. It just doesn't seem elegant enough to me and I am wondering if there is a smart way of carrying out a search on the network pinging all machines on a set port until a response is received? </p>\n"}, {"tags": ["git", "go", "gitlab"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570025800, "post_id": 58203258, "comment_id": 102784845, "body": "Did you add the ssh key for that user to your gitlab account? I am using private repos without any problems with that key set."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570025832, "post_id": 58203258, "comment_id": 102784873, "body": "@bserdar: Post says he did..."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1570025947, "post_id": 58203258, "comment_id": 102784947, "body": "@Flimzy Post says he generated a key. Is that the ssh key?"}, {"owner": {"reputation": 153, "user_id": 540370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0RDe.jpg?s=128&g=1", "display_name": "gianpaolo", "link": "https://stackoverflow.com/users/540370/gianpaolo"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1570026072, "post_id": 58203258, "comment_id": 102785022, "body": "@bserdar yes, I added the ssh pub key. If I use &quot;git clone&quot; it prompts me for the username and so I can pass username and password of the gitlab user."}], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 540370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0RDe.jpg?s=128&g=1", "display_name": "gianpaolo", "link": "https://stackoverflow.com/users/540370/gianpaolo"}, "edited": false, "score": 0, "creation_date": 1570026594, "post_id": 58203507, "comment_id": 102785364, "body": "it says this: # cd .; git ls-remote https://&lt;machine&gt;/&lt;path&gt; ssh: Could not resolve hostname http: Temporary failure in name resolution fatal: Could not read from remote repository."}, {"owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "reply_to_user": {"reputation": 153, "user_id": 540370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0RDe.jpg?s=128&g=1", "display_name": "gianpaolo", "link": "https://stackoverflow.com/users/540370/gianpaolo"}, "edited": false, "score": 0, "creation_date": 1570027036, "post_id": 58203507, "comment_id": 102785650, "body": "@gianpaolo usually it says if you&#39;re add wrong ssh-key <a href=\"https://github.com/jakubroztocil/cloudtunes/issues/23\" rel=\"nofollow noreferrer\">github.com/jakubroztocil/cloudtunes/issues/23</a>"}, {"owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "reply_to_user": {"reputation": 153, "user_id": 540370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0RDe.jpg?s=128&g=1", "display_name": "gianpaolo", "link": "https://stackoverflow.com/users/540370/gianpaolo"}, "edited": false, "score": 0, "creation_date": 1570027368, "post_id": 58203507, "comment_id": 102785850, "body": "@gianpaolo I updated the answer  12mins ago. Maybe you&#39;re trying not a final version of answer"}, {"owner": {"reputation": 153, "user_id": 540370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0RDe.jpg?s=128&g=1", "display_name": "gianpaolo", "link": "https://stackoverflow.com/users/540370/gianpaolo"}, "edited": false, "score": 0, "creation_date": 1570027783, "post_id": 58203507, "comment_id": 102786079, "body": "I added a new ssh-key, nothing changed :("}, {"owner": {"reputation": 153, "user_id": 540370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0RDe.jpg?s=128&g=1", "display_name": "gianpaolo", "link": "https://stackoverflow.com/users/540370/gianpaolo"}, "edited": false, "score": 0, "creation_date": 1570027884, "post_id": 58203507, "comment_id": 102786131, "body": "yes, I used yr edited method. same errors and prompts to enter the password of the user of the local machine (the one where I run the command)"}, {"owner": {"reputation": 153, "user_id": 540370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0RDe.jpg?s=128&g=1", "display_name": "gianpaolo", "link": "https://stackoverflow.com/users/540370/gianpaolo"}, "edited": false, "score": 0, "creation_date": 1570032599, "post_id": 58203507, "comment_id": 102788789, "body": "Thank you.  I also had to switch to a virtual machine in the same subnet, but yor config was necessary too. :-)"}], "tags": [], "owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "is_accepted": true, "score": 1, "last_activity_date": 1570027433, "last_edit_date": 1570027433, "creation_date": 1570026203, "answer_id": 58203507, "question_id": 58203258, "link": "https://stackoverflow.com/questions/58203258/go-get-with-private-gitlab-repo/58203507#58203507", "title": "go get with private gitlab repo", "body": "<p>I guess it should helps you. You miss the <code>ssh://</code></p>\n\n<p>Post for example how it works: <a href=\"https://www.scivision.dev/git-pull-https-push-ssh/\" rel=\"nofollow noreferrer\">https://www.scivision.dev/git-pull-https-push-ssh/</a></p>\n\n<pre><code>git config --global url.\"ssh://git@mymachine.prv/\".insteadOf \"https://mymachine.prv/\"\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 540370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0RDe.jpg?s=128&g=1", "display_name": "gianpaolo", "link": "https://stackoverflow.com/users/540370/gianpaolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1237, "favorite_count": 1, "accepted_answer_id": 58203507, "answer_count": 1, "score": 3, "last_activity_date": 1570027433, "creation_date": 1570025363, "last_edit_date": 1570026215, "question_id": 58203258, "link": "https://stackoverflow.com/questions/58203258/go-get-with-private-gitlab-repo", "title": "go get with private gitlab repo", "body": "<p>Despite all the attempts I can't succeed in using \"go get\" to get a private repo from gitlab\nI've tried with .netrc, gitconfig but it doesnt work.\nI have a private machine with git on it, suppose it is mymachine.prv</p>\n\n<pre><code>git config --global url.\"git@mymachine.prv:\".insteadOf \"https://mymachine.prv/\"\n</code></pre>\n\n<p>I run this command from a virtual machine with user \"gp\"\nand it keeps asking me the password for gp@mymachine.prv</p>\n\n<p>So I have generated the public key with ssh-keygen and added to gitlab account, but no luck.</p>\n\n<p>Any help please?</p>\n\n<p>Gianpaolo</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1570017585, "post_id": 58200259, "comment_id": 102779977, "body": "<code>go get github.com&#47;golang&#47;protobuf&#47;proto</code> works just fine. Please show the code you want to run. Also what version of Go are you using?"}, {"owner": {"reputation": 1163, "user_id": 5481865, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/36eb3783cb07bbdff9581179614bcf5e?s=128&d=identicon&r=PG&f=1", "display_name": "FailedUnitTest", "link": "https://stackoverflow.com/users/5481865/failedunittest"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1570017674, "post_id": 58200259, "comment_id": 102780030, "body": "go version go1.13.1 darwin/amd64"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1570018083, "post_id": 58200259, "comment_id": 102780256, "body": "It works for me. It might be a Go module config error for you. Try running <code>go mod tidy</code>, then <code>go build</code>."}, {"owner": {"reputation": 1163, "user_id": 5481865, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/36eb3783cb07bbdff9581179614bcf5e?s=128&d=identicon&r=PG&f=1", "display_name": "FailedUnitTest", "link": "https://stackoverflow.com/users/5481865/failedunittest"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1570018206, "post_id": 58200259, "comment_id": 102780326, "body": "strange, I get this for tidy:go: failed to lock file at /Users/CoolUser/go/pkg/mod/cache/lock"}, {"owner": {"reputation": 1163, "user_id": 5481865, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/36eb3783cb07bbdff9581179614bcf5e?s=128&d=identicon&r=PG&f=1", "display_name": "FailedUnitTest", "link": "https://stackoverflow.com/users/5481865/failedunittest"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1570018433, "post_id": 58200259, "comment_id": 102780448, "body": "I cannot seem to import my local packages as well, maybe the problems are related"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1570018565, "post_id": 58200259, "comment_id": 102780514, "body": "Please post a complete, minimal go file. Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 1163, "user_id": 5481865, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/36eb3783cb07bbdff9581179614bcf5e?s=128&d=identicon&r=PG&f=1", "display_name": "FailedUnitTest", "link": "https://stackoverflow.com/users/5481865/failedunittest"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1570018778, "post_id": 58200259, "comment_id": 102780654, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/200295/discussion-between-failedunittest-and-icza\">continue this discussion in chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1570071239, "post_id": 58202138, "comment_id": 102800613, "body": "Any idea how the cache got into a bad state? Is there a test to verify the current integrity of the cache without clearing it?"}, {"owner": {"reputation": 1163, "user_id": 5481865, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/36eb3783cb07bbdff9581179614bcf5e?s=128&d=identicon&r=PG&f=1", "display_name": "FailedUnitTest", "link": "https://stackoverflow.com/users/5481865/failedunittest"}, "edited": false, "score": 0, "creation_date": 1570071488, "post_id": 58202138, "comment_id": 102800659, "body": "Not sure, maybe it has something to do with me rearranging the directories of my packages a bit."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1570021510, "creation_date": 1570021510, "answer_id": 58202138, "question_id": 58200259, "link": "https://stackoverflow.com/questions/58200259/unable-to-use-the-protobuf-package/58202138#58202138", "title": "Unable to use the protobuf package", "body": "<p>It turns out there was something wrong with the module cache, that's why the <code>go</code> tool was not able to fetch / update dependencies.</p>\n\n<p>In such cases, clearing the module cache (might) help:</p>\n\n<pre><code>go clean -modcache\n</code></pre>\n"}], "owner": {"reputation": 1163, "user_id": 5481865, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/36eb3783cb07bbdff9581179614bcf5e?s=128&d=identicon&r=PG&f=1", "display_name": "FailedUnitTest", "link": "https://stackoverflow.com/users/5481865/failedunittest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1521, "favorite_count": 0, "accepted_answer_id": 58202138, "answer_count": 1, "score": 2, "last_activity_date": 1570021510, "creation_date": 1570014470, "last_edit_date": 1570019542, "question_id": 58200259, "link": "https://stackoverflow.com/questions/58200259/unable-to-use-the-protobuf-package", "title": "Unable to use the protobuf package", "body": "<p>It appears that I cannot import this package: github.com/golang/protobuf/proto</p>\n\n<p>When I try to <strong>build</strong> or use <strong>go get</strong> I get:cannot load github.com/golang/protobuf/proto: module github.com/golang/protobuf@latest (v1.3.2) found, but does not contain package github.com/golang/protobuf/proto</p>\n\n<p>It is a popular package, I am surprised it does not seem to be working.\n<a href=\"https://godoc.org/github.com/golang/protobuf/proto#Marshal\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/golang/protobuf/proto#Marshal</a></p>\n\n<p>Has anybody encountered this?</p>\n\n<p><strong>Update</strong>: </p>\n\n<p>I am simply trying to import this: \nimport (\n    \"bytes\"\n    \"context\"\n    \"encoding/json\"\n    \"errors\"\n    \"fmt\"\n    \"github.com/golang/protobuf/proto\"\n)</p>\n\n<p>GoLang does not resolve proto in the above path...</p>\n\n<p>I try to install like this: \n$ go get github.com/golang/protobuf/proto\ngo: finding github.com/golang/protobuf/proto latest\ngo get github.com/golang/protobuf/proto: module github.com/golang/protobuf@upgrade (v1.3.2) found, but does not contain package github.com/golang/protobuf/proto</p>\n\n<p><strong>Update2</strong>, not sure how the file helps but here it is: </p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"context\"\n    \"encoding/json\"\n    \"errors\"\n    \"fmt\"\n    \"github.com/golang/protobuf/proto\"\n    \"go_poc/plugins/com_styx_proto\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc init() {\n    fmt.Println(\"styxBotDetect plugin is loaded!\")\n}\n\nfunc (r registrable) RegisterHandlers(f func(\n    name string,\n    handler func(\n        context.Context,\n        map[string]interface{},\n        http.Handler) (http.Handler, error),\n)) {\n    f(pluginName, r.registerHandlers)\n}\n\nfunc (r registrable) registerHandlers(ctx context.Context, extra map[string]interface{}, handler http.Handler) (http.Handler, error) {\n// skipping some lines here\n\nstyxRqBytes, err := proto.Marshal(styxRq)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusNotAcceptable)\n            return\n        }\n\n// more code\n</code></pre>\n"}, {"tags": ["go", "tcp", "protocol-buffers"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 2, "creation_date": 1570025145, "post_id": 58199986, "comment_id": 102784480, "body": "Are you trying to emulate grpc? This can be done easily with a grpc service. That said, scanner reads line-delimited input. Protobuf is a binary protocol, it is not line-delimited."}], "owner": {"reputation": 21, "user_id": 2667836, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f678dd0130646a0b0c09091af034a81?s=128&d=identicon&r=PG", "display_name": "Oyth David", "link": "https://stackoverflow.com/users/2667836/oyth-david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 130, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1570015586, "creation_date": 1570013388, "last_edit_date": 1570015586, "question_id": 58199986, "link": "https://stackoverflow.com/questions/58199986/how-to-unmarshal-proto-with-scanner-using-net-conn", "title": "How to unmarshal proto with scanner using net.Conn?", "body": "<p>I have setup a go server to receive data from a client. Have faced the issue attempting to unmarshal the object. Am I doing this the wrong way? It was working well with text.  </p>\n\n<p>This is my code currently:</p>\n\n<pre><code>func handleConnection(conn net.Conn) {\nscanner := bufio.NewScanner(conn)\n\nfor {\n    ok := scanner.Scan()\n\n    if !ok {\n        break\n    }\n    request := &amp;protoBuf.Request{}\n    err := proto.Unmarshal(scanner.Bytes(), request)\n    if err != nil {\n        log.Fatal(\"unmarshaling error: \", err)\n    }\n}\n}\n</code></pre>\n\n<p>Error message:</p>\n\n<pre><code>2019/10/02 19:24:29 unmarshaling error: proto: protoBuf.Request: \nillegal tag 0 (wire type 2)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1570019125, "post_id": 58199688, "comment_id": 102780842, "body": "I just had a case where the link was broken in several placrs but, because I had the article title, I could find it elsewhere."}], "tags": [], "owner": {"reputation": 5945, "user_id": 2664985, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/b481e39808c4dd2db7a66c1931a9bb08?s=128&d=identicon&r=PG", "display_name": "Jack Wilsdon", "link": "https://stackoverflow.com/users/2664985/jack-wilsdon"}, "is_accepted": true, "score": 2, "last_activity_date": 1570092387, "last_edit_date": 1570092387, "creation_date": 1570011937, "answer_id": 58199688, "question_id": 58199636, "link": "https://stackoverflow.com/questions/58199636/override-global-variable/58199688#58199688", "title": "Override Global Variable", "body": "<p>Variables are allowed to shadow other variables in parent scopes. In your example, the scope hierarchy looks like this:</p>\n\n<pre><code>global (scope)\n\u251c\u2500\u2500 theStruct (variable)\n\u2514\u2500\u2500 main (scope)\n    \u2514\u2500\u2500 theStruct (variable)\n</code></pre>\n\n<p>Shadowing like this is often done with <code>err</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n)\n\nfunc main() {\n    f, err := ioutil.TempFile(\"\", \"\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer f.Close()\n\n    // This err shadows the one above, it is technically in its\n    // own scope within the \"if\".\n    if _, err := f.Write([]byte(\"hello world\\n\")); err != nil {\n        log.Fatal(err)\n    }\n\n    if true {\n        // We can even shadow with different types!\n        err := 3\n\n        log.Println(err)\n    }\n}\n\n</code></pre>\n\n<p>This example is in part from \"<a href=\"https://blog.charmes.net/post/scope-shadowing-go/\" rel=\"nofollow noreferrer\">Scope and Shadowing in Go</a>\".</p>\n"}], "owner": {"reputation": 8321, "user_id": 1213006, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/utGQE.jpg?s=128&g=1", "display_name": "rhughes", "link": "https://stackoverflow.com/users/1213006/rhughes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 403, "favorite_count": 0, "closed_date": 1570024128, "accepted_answer_id": 58199688, "answer_count": 1, "score": 0, "last_activity_date": 1570092387, "creation_date": 1570011694, "last_edit_date": 1570024103, "question_id": 58199636, "link": "https://stackoverflow.com/questions/58199636/override-global-variable", "closed_reason": "Duplicate", "title": "Override Global Variable", "body": "<p>I would like to know why there is no warning or error in the following code which allows me to override a global variable.</p>\n\n<pre><code>// You can edit this code!\n// Click here and start typing.\npackage main\n\nimport \"fmt\"\n\ntype MyStruct struct {\n    MyInt uint32\n}\n\nfunc (s *MyStruct) MyMethod() {\n    fmt.Println(s.MyInt)\n}\n\nvar theStruct MyStruct\n\nfunc main() {\n\n    // Override the above global variable\n    // I would expect some kind of warning or error here?\n    theStruct := MyStruct {\n        MyInt: 42,\n    }\n\n    // Outputs 42\n    theStruct.MyMethod()\n\n    // Outputs 0\n    UseMyStruct()\n}\n\nfunc UseMyStruct() {\n    theStruct.MyMethod()\n}\n</code></pre>\n"}, {"tags": ["go", "conventions"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1570014397, "post_id": 58199564, "comment_id": 102778391, "body": "The simple rule is: write understandable code. Putting most of the code into cleverly nested defers is not understandable."}, {"owner": {"reputation": 2750, "user_id": 661598, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BVAlk.png?s=128&g=1", "display_name": "wst", "link": "https://stackoverflow.com/users/661598/wst"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1570033986, "post_id": 58199564, "comment_id": 102789472, "body": "This is my thought exactly. Instead of putting logic in function in defer, I&#39;d rather put defer logic into other function and then call both, one after another. Much more easy to read the code. It&#39;s just my opinion, tho, and I&#39;ve been curious is there any practice in place."}], "answers": [{"comments": [{"owner": {"reputation": 2750, "user_id": 661598, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BVAlk.png?s=128&g=1", "display_name": "wst", "link": "https://stackoverflow.com/users/661598/wst"}, "edited": false, "score": 0, "creation_date": 1570105917, "post_id": 58199621, "comment_id": 102814184, "body": "I\u2019d strongly emphasize \u201cif it makes your code safer or easier to read\u201d. Especially easier to read. If something is hard to read it fails to be safe anyway."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1570090200, "last_edit_date": 1570090200, "creation_date": 1570011612, "answer_id": 58199621, "question_id": 58199564, "link": "https://stackoverflow.com/questions/58199564/defer-used-not-only-for-cleanup-good-or-bad-practice/58199621#58199621", "title": "Defer used not only for cleanup - good or bad practice?", "body": "<p>The Go compiler doesn't know what code is clean-up code. So if it works to defer clean-up code, it will obviously work to defer any non-clean-up code too.</p>\n\n<p>There is some overhead for deferred functions, obviously the call stack has to be managed, but if it makes your code safer and / or easier to read, go for it. It's perfectly fine to use it to do any action before a return, even to modify the values being returned, and even in case of panicing. See <a href=\"https://stackoverflow.com/questions/33167282/how-to-return-a-value-in-a-go-function-that-panics/33167433?r=SearchResults#33167433\">How to return a value in a Go function that panics?</a></p>\n\n<p>One thing you should keep in mind: deferred functions are run even if the code panics (which is desirable for clean-up code), which otherwise would not be a normal flow of execution. So this will be a difference when using defer compared to not using it. See related: <a href=\"https://stackoverflow.com/questions/45617758/defer-in-the-loop-what-will-be-better/45620423#45620423\">`defer` in the loop - what will be better?</a></p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1570457688, "creation_date": 1570457688, "answer_id": 58271397, "question_id": 58199564, "link": "https://stackoverflow.com/questions/58199564/defer-used-not-only-for-cleanup-good-or-bad-practice/58271397#58271397", "title": "Defer used not only for cleanup - good or bad practice?", "body": "<p>Let's be very specific about the overhead that Go defer operations currently (pre Go 1.14) add.</p>\n\n<blockquote>\n  <p>As of Go 1.13, most defer operations take about 35ns (reduced from\n  about 50ns in Go 1.12). In contrast, a direct call takes about 6ns.\n  This gap incentivizes engineers to eliminate defer operations from hot\n  code paths, which takes away time from more productive tasks, leads to\n  less maintainable code (e.g., if a panic is later introduced, the\n  \"optimization\" is no longer correct), and discourages people from\n  using a language feature when it would otherwise be an appropriate\n  solution to a problem.</p>\n  \n  <p><a href=\"https://github.com/golang/proposal/blob/master/design/34481-opencoded-defers.md\" rel=\"nofollow noreferrer\">Proposal: Low-cost defers through inline code, and extra funcdata to\n  manage the panic case</a></p>\n</blockquote>\n"}], "owner": {"reputation": 2750, "user_id": 661598, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BVAlk.png?s=128&g=1", "display_name": "wst", "link": "https://stackoverflow.com/users/661598/wst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 1, "accepted_answer_id": 58199621, "answer_count": 2, "score": -1, "last_activity_date": 1570457688, "creation_date": 1570011366, "question_id": 58199564, "link": "https://stackoverflow.com/questions/58199564/defer-used-not-only-for-cleanup-good-or-bad-practice", "title": "Defer used not only for cleanup - good or bad practice?", "body": "<p>Defering execution of code is commonly used in Go to clean up resources. It's not so often seen but happens that <code>defer</code> is used to execute regular business logic, too. Just as a last step of execution, no matter at which point function hits <code>return</code> keyword.</p>\n\n<p>On <a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow noreferrer\">Go Blog</a> page, we can find that \"<em>defer statement pushes a function call onto a list. The list of saved calls is executed after the surrounding function returns. Defer is commonly used to simplify functions that perform various clean-up actions.</em>\"</p>\n\n<p>They do mention about cleaning up but nothing about regular code execution. Obviously, it may execute an arbitrary code, doesn't have to be cleaning up. Is this the best practice, though? Has community any agreement on convention or best practice in this regard?</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1570011133, "post_id": 58198896, "comment_id": 102776959, "body": "Are you looking for SetReportCaller?"}, {"owner": {"reputation": 7044, "user_id": 7670262, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3zdDY.jpg?s=128&g=1", "display_name": "Azeem", "link": "https://stackoverflow.com/users/7670262/azeem"}, "edited": false, "score": 0, "creation_date": 1570172872, "post_id": 58198896, "comment_id": 102836919, "body": "In your desired output, you&#39;ve written <code>log-ut-usage&#47;main.go:21</code>. <code>main.go</code> is the filename but above this code you&#39;ve mentioned that file is <code>log-ut-usage</code>. Can you please confirm what is what?"}], "answers": [{"tags": [], "owner": {"reputation": 493, "user_id": 8364553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d203cf51ae3926dca4c2c3afcf24948?s=128&d=identicon&r=PG&f=1", "display_name": "p1gd0g", "link": "https://stackoverflow.com/users/8364553/p1gd0g"}, "is_accepted": false, "score": 0, "last_activity_date": 1570030813, "creation_date": 1570030813, "answer_id": 58204883, "question_id": 58198896, "link": "https://stackoverflow.com/questions/58198896/how-to-get-file-and-function-name-for-loggers/58204883#58204883", "title": "How to get file and function name for loggers", "body": "<p>Have you tried to use debug.Stack() to fetch the file name which calls InitLog?</p>\n\n<p><a href=\"https://play.golang.org/p/g6yLGsiuEEn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/g6yLGsiuEEn</a></p>\n\n<pre><code>goroutine 1 [running]:\nruntime/debug.Stack(0x15d6b0, 0x3, 0x68360, 0x1580)\n    /usr/local/go/src/runtime/debug/stack.go:24 +0xc0\nmain.fun2()\n    /tmp/sandbox834348417/prog.go:20 +0x20\nmain.fun1(...)\n    /tmp/sandbox834348417/prog.go:15\nmain.main()\n    /tmp/sandbox834348417/prog.go:10 +0x20\n</code></pre>\n\n<p>Hope it works.</p>\n"}, {"tags": [], "owner": {"reputation": 7044, "user_id": 7670262, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3zdDY.jpg?s=128&g=1", "display_name": "Azeem", "link": "https://stackoverflow.com/users/7670262/azeem"}, "is_accepted": true, "score": 4, "last_activity_date": 1570175563, "creation_date": 1570175563, "answer_id": 58232098, "question_id": 58198896, "link": "https://stackoverflow.com/questions/58198896/how-to-get-file-and-function-name-for-loggers/58232098#58232098", "title": "How to get file and function name for loggers", "body": "<p>You can wrap your logger with file, function and line information and then use that.</p>\n\n<p>Here's an example (<a href=\"https://play.golang.org/p/q0kyZvvbT0C\" rel=\"nofollow noreferrer\">live</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"runtime\"\n    \"strconv\"\n    \"strings\"\n\n    log \"github.com/sirupsen/logrus\"\n)\n\nfunc init() {\n    log.SetFormatter(&amp;log.JSONFormatter{})\n    log.SetOutput(os.Stdout)\n}\n\nfunc logger() *log.Entry {\n    pc, file, line, ok := runtime.Caller(1)\n    if !ok {\n        panic(\"Could not get context info for logger!\")\n    }\n\n    filename := file[strings.LastIndex(file, \"/\")+1:] + \":\" + strconv.Itoa(line)\n    funcname := runtime.FuncForPC(pc).Name()\n    fn := funcname[strings.LastIndex(funcname, \".\")+1:]\n    return log.WithField(\"file\", filename).WithField(\"function\", fn)\n}\n\nfunc test() {\n    logger().Info(\"Testing...\")\n}\n\nfunc main() {\n    logger().Info(\"Testing...\")\n    test()\n}\n</code></pre>\n\n<p><strong>Output</strong>:</p>\n\n<pre><code>{\"file\":\"prog.go:34\",\"function\":\"main\",\"level\":\"info\",\"msg\":\"Testing...\",\"time\":\"2009-11-10T23:00:00Z\"}\n{\"file\":\"prog.go:30\",\"function\":\"test\",\"level\":\"info\",\"msg\":\"Testing...\",\"time\":\"2009-11-10T23:00:00Z\"}\n</code></pre>\n"}], "owner": {"reputation": 645, "user_id": 6192772, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74209ab5f4b99c81cf444d87f85fcc36?s=128&d=identicon&r=PG&f=1", "display_name": "NSS", "link": "https://stackoverflow.com/users/6192772/nss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2220, "favorite_count": 2, "accepted_answer_id": 58232098, "answer_count": 2, "score": 2, "last_activity_date": 1587706535, "creation_date": 1570008849, "last_edit_date": 1570024829, "question_id": 58198896, "link": "https://stackoverflow.com/questions/58198896/how-to-get-file-and-function-name-for-loggers", "title": "How to get file and function name for loggers", "body": "<p>I'm using  <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">logrus</a> OS which works as expected, now we have a requirement to add to the logger output the file and the function which from where you put the logger call,</p>\n\n<p>we need it to be something like</p>\n\n<p>File <code>log-ut-usage</code> </p>\n\n<pre><code>func main(){\n\n\n  logs := lts.InitLogger(\"test\",\"1\",\"debug\")\n\n  logs.Debugf(\"test 123\")\n....\n\n}\n</code></pre>\n\n<p><strong>This is the required output</strong> </p>\n\n<pre><code>\n{\"file\":\"log-ut-usage/main.go:21\",\"function\":\"main\",\"level\":\"warn\",\"test 123\":\"ddd\",\"timestamp\":\"2019-10-02T09:21:39.309559Z\"}\n</code></pre>\n\n<p>currently we got the file and function of the </p>\n\n<p>file <code>logger.go</code></p>\n\n<pre><code>func InitLog(label string) LoggerI {\n\nloggerImpl = &amp;logrus.Logger{\n        Out:          os.Stdout,\n        Level:        level,\n        ReportCaller: true,\n        Formatter: &amp;logrus.JSONFormatter{\n            TimestampFormat: timestampFormat,\n            CallerPrettyfier: func(f *runtime.Frame) (string, string) {\n                s := strings.Split(f.Function, \".\")\n                funcname := s[len(s)-1]\n                _, filename := path.Split(f.File)\n                return funcname, filename\n            },\n        },\n    }\n</code></pre>\n\n<p>This is the <strong>(unwanted)</strong> output</p>\n\n<pre><code>{\"file\":\"logger.go\",\"func\":\"InitLog\",\"level\":\"debug\",\"msg\":\"test 123\",\"time\":\"2019-10-02 12:21:39\"}\n</code></pre>\n\n<p>I dont want to get the file <code>logger.go</code> where we coded the json formater, I want to get the file that with the usage of the logger .</p>\n"}, {"tags": ["docker", "go", "google-cloud-platform"], "answers": [{"tags": [], "owner": {"reputation": 3016, "user_id": 476917, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/09e7f8896d4a5104c2058128a03a30b0?s=128&d=identicon&r=PG", "display_name": "Agung Pratama", "link": "https://stackoverflow.com/users/476917/agung-pratama"}, "is_accepted": true, "score": 3, "last_activity_date": 1570014890, "last_edit_date": 1570014890, "creation_date": 1570010302, "answer_id": 58199285, "question_id": 58198511, "link": "https://stackoverflow.com/questions/58198511/how-to-properly-authenticate-docker-client-golang-library-to-gcr-io-registry/58199285#58199285", "title": "How to properly authenticate docker client golang library to gcr.io registry?", "body": "<p>Okay I just found out what the mistake is on my code above. I realized this after looking at example code on <strong>pulling</strong> image from private registry here: <a href=\"https://docs.docker.com/develop/sdk/examples/#pull-an-image-with-authentication\" rel=\"nofollow noreferrer\">https://docs.docker.com/develop/sdk/examples/#pull-an-image-with-authentication</a> </p>\n\n<p>As it turns out, the <code>RegistryAuth</code> arg in types.ImagePush options expect a base64 encoding string.</p>\n\n<p>So with this code, I can successfully push local image to my private registry.</p>\n\n<pre><code>    authConfig := types.AuthConfig{\n        Username: \"oauth2accesstoken\",\n        Password: option.DestRegistryAuth,\n    }\n    encodedJSON, err := json.Marshal(authConfig)\n    if err != nil {\n        return fmt.Errorf(\"error when encoding authConfig. err: %v\", err)\n    }\n\n    authStr := base64.URLEncoding.EncodeToString(encodedJSON)\n\n    rc, err = destClient.DockerClient.ImagePush(ctx, dest, types.ImagePushOptions{\n        RegistryAuth: authStr,\n    })\n</code></pre>\n"}], "owner": {"reputation": 3016, "user_id": 476917, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/09e7f8896d4a5104c2058128a03a30b0?s=128&d=identicon&r=PG", "display_name": "Agung Pratama", "link": "https://stackoverflow.com/users/476917/agung-pratama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1688, "favorite_count": 1, "accepted_answer_id": 58199285, "answer_count": 1, "score": 3, "last_activity_date": 1570014890, "creation_date": 1570007386, "last_edit_date": 1570009383, "question_id": 58198511, "link": "https://stackoverflow.com/questions/58198511/how-to-properly-authenticate-docker-client-golang-library-to-gcr-io-registry", "title": "How to properly authenticate docker client golang library to gcr.io registry?", "body": "<p>I have a need to programmatically (using golang) login to gcr.io docker registry using this package library <a href=\"https://godoc.org/github.com/docker/docker/client\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/docker/docker/client</a></p>\n\n<p>I have tried using it, i can successfully login but upon pushing an image to my gcr.io project registry, it said </p>\n\n<pre><code>{\"errorDetail\":{\"message\":\"unauthorized: You don't have the needed permissions to perform this operation, and you may have invalid credentials. To authenticate your request, follow the steps in: https://cloud.google.com/container-registry/docs/advanced-authentication\"},\"error\":\"unauthorized: You don't have the needed permissions to perform this operation, and you may have invalid credentials. To authenticate your request, follow the steps in: https://cloud.google.com/container-registry/docs/advanced-authentication\"}\n\n</code></pre>\n\n<p>My code looks like this</p>\n\n<pre><code>package client\nimport (\n    \"context\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n\n    \"github.com/docker/docker/api/types\"\n    dockerClient \"github.com/docker/docker/client\"\n)\n\ntype Service struct{\n    DockerClient *dockerClient.Client\n}\n\ntype CopyImageOptions struct {\n    DestRegistryAuth    string\n}\ntype DockerImageService interface {\n    CopyImage(ctx context.Context, source, dest string, option CopyImageOptions)\n}\n\n// NewDockerClient returns a client\nfunc NewDockerClient() *Service {\n    cli, err := dockerClient.NewEnvClient()\n    if err != nil {\n        panic(err)\n    }\n    return &amp;Service{DockerClient: cli}\n}\n\nfunc (s *Service) CopyImage(ctx context.Context, source, dest string, option CopyImageOptions) error {\n\n    rc, err := s.DockerClient.ImagePull(ctx, source, types.ImagePullOptions{})\n\n    if err != nil{\n        return fmt.Errorf(\"error when pulling source image. err: %v\", err)\n    }\n    defer rc.Close()\n\n    io.Copy(os.Stdout, rc)\n\n\n    destClient := NewDockerClient()\n\n    if option.DestRegistryAuth != \"\"  {\n        //current use case we can assume that the dest is on asia.gcr.io\n        status, err := destClient.DockerClient.RegistryLogin(ctx, types.AuthConfig{\n            Username:      \"oauth2accesstoken\",\n            Password:      option.DestRegistryAuth,\n            ServerAddress: \"asia.gcr.io\",\n        })\n        if err != nil{\n            return fmt.Errorf(\"error when login to destination image registry. err: %v\", err)\n        }\n\n        fmt.Println(status)\n    }\n    err = destClient.DockerClient.ImageTag(ctx, source, dest)\n    if err != nil {\n        return fmt.Errorf(\"error when tagging image. err: %v\", err)\n    }\n    rc, err = destClient.DockerClient.ImagePush(ctx, dest, types.ImagePushOptions{\n        RegistryAuth: option.DestRegistryAuth,\n    })\n\n    if err != nil{\n        return fmt.Errorf(\"error when pushing image to destionation. err: %v\", err)\n    }\n    defer rc.Close()\n\n    io.Copy(os.Stdout, rc)\n    return nil\n}\n\n</code></pre>\n\n<p>You may take a look at the <code>CopyImage</code> method, where the <code>option.DestRegistryAuth</code> is assigned with the output <code>gcloud auth print-access-token</code>. The username is set to \"oauth2accesstoken\" because I followed this instruction:  <a href=\"https://cloud.google.com/container-registry/docs/advanced-authentication\" rel=\"nofollow noreferrer\">https://cloud.google.com/container-registry/docs/advanced-authentication</a></p>\n\n<p>As for the <code>source</code> parameter, it is assumed it's from public registry like docker.io/library/alpine:3.10, so we can pull it without having configuring any auth token. However for the <code>dest</code> parameter, currently it is an image in my private registry such as: <code>asia.gcr.io/&lt;gcp-project-id&gt;/alpine:3.10</code></p>\n\n<p>Also, the <code>gcloud auth print-access-token</code> is called after I did <code>gcloud auth login</code>and I already had full permission to access my private asia.gcr.io registry (assigned on bucket level).</p>\n\n<p>Now the weird thing is I can successfully push it using <code>docker push</code> command, right after do <code>docker login</code> described in here <a href=\"https://cloud.google.com/container-registry/docs/advanced-authentication\" rel=\"nofollow noreferrer\">https://cloud.google.com/container-registry/docs/advanced-authentication</a> .</p>\n\n<p>Any advice?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 35869, "user_id": 7512, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d064a7aca29011d3246302b27c41f4d9?s=128&d=identicon&r=PG", "display_name": "slim", "link": "https://stackoverflow.com/users/7512/slim"}, "edited": false, "score": 0, "creation_date": 1570003761, "post_id": 58197442, "comment_id": 102773335, "body": "Define &quot;secure&quot;. Your code is not vulnerable to SQL injection, but is that what you&#39;re asking about?"}, {"owner": {"reputation": 2277, "user_id": 1318313, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/854c52560c0c04e45102fb3b4b375ec0?s=128&d=identicon&r=PG", "display_name": "devnull", "link": "https://stackoverflow.com/users/1318313/devnull"}, "reply_to_user": {"reputation": 35869, "user_id": 7512, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d064a7aca29011d3246302b27c41f4d9?s=128&d=identicon&r=PG", "display_name": "slim", "link": "https://stackoverflow.com/users/7512/slim"}, "edited": false, "score": 0, "creation_date": 1570005713, "post_id": 58197442, "comment_id": 102774279, "body": "yes I meant secure from SQL injection. I also want to understand if it is (which I think so) why all examples I could find on go-sql-driver  have db.Prepare and not db-Query"}], "answers": [{"comments": [{"owner": {"reputation": 2277, "user_id": 1318313, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/854c52560c0c04e45102fb3b4b375ec0?s=128&d=identicon&r=PG", "display_name": "devnull", "link": "https://stackoverflow.com/users/1318313/devnull"}, "edited": false, "score": 0, "creation_date": 1570007367, "post_id": 58198440, "comment_id": 102775099, "body": "thank you for your answer. Could you please add an example on how it would be done as a prepared statement and perhaps how to check if the query was successful e.g. by printing &quot;record added&quot; ? sorry if this sounds trivial but I think it will benefit other readers too."}, {"owner": {"reputation": 35869, "user_id": 7512, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d064a7aca29011d3246302b27c41f4d9?s=128&d=identicon&r=PG", "display_name": "slim", "link": "https://stackoverflow.com/users/7512/slim"}, "reply_to_user": {"reputation": 2277, "user_id": 1318313, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/854c52560c0c04e45102fb3b4b375ec0?s=128&d=identicon&r=PG", "display_name": "devnull", "link": "https://stackoverflow.com/users/1318313/devnull"}, "edited": false, "score": 0, "creation_date": 1570007939, "post_id": 58198440, "comment_id": 102775373, "body": "If you want an example of <code>Prepare</code> in use, then you should have asked that question. But there are plenty of examples elsewhere, so it&#39;s not clear why it belongs in SO. <a href=\"http://go-database-sql.org/prepared.html\" rel=\"nofollow noreferrer\">go-database-sql.org/prepared.html</a>"}, {"owner": {"reputation": 2277, "user_id": 1318313, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/854c52560c0c04e45102fb3b4b375ec0?s=128&d=identicon&r=PG", "display_name": "devnull", "link": "https://stackoverflow.com/users/1318313/devnull"}, "edited": false, "score": 0, "creation_date": 1570010500, "post_id": 58198440, "comment_id": 102776660, "body": "fair enough but my question states Also, what is the best way to detect if the row has been inserted?"}], "tags": [], "owner": {"reputation": 35869, "user_id": 7512, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d064a7aca29011d3246302b27c41f4d9?s=128&d=identicon&r=PG", "display_name": "slim", "link": "https://stackoverflow.com/users/7512/slim"}, "is_accepted": false, "score": 1, "last_activity_date": 1570007989, "last_edit_date": 1570007989, "creation_date": 1570007111, "answer_id": 58198440, "question_id": 58197442, "link": "https://stackoverflow.com/questions/58197442/secure-insert-queries-with-go-sql-driver-and-mysql/58198440#58198440", "title": "Secure insert queries with go-sql-driver and mysql", "body": "<p>Yes, this safe from SQL injection attacks.</p>\n\n<p>Note that the client code does <em>not</em> \"escape\" parameters in a query of this kind. It does something much simpler and more secure:</p>\n\n<p>The client does not combine <code>INSERT INTO users (name) VALUES(?)</code> and the parameter <code>;DROP TABLE USERS;</code> into <code>INSERT INTO users (name) VALUES(;DROP TABLE USERS;</code>.</p>\n\n<p>Nor does the client do the above with escape characters to make it \"safe\". The client does <em>not</em> construct something like <code>INSERT INTO users (name) VALUES(\"\\;DROP TABLE USERS\\;\")</code></p>\n\n<p>What it does is send a query to MySQL that contains, separately:</p>\n\n<ul>\n<li>the query string <code>INSERT INTO users (name) VALUES(?)</code> -- MySQL knows this is a query string and knows that the <code>?</code> is where parameters are plugged in.</li>\n<li>the parameter <code>;DROP TABLE USERS;</code> -- MySQL knows this is a parameter to the query</li>\n</ul>\n\n<p>Hence the <em>server</em> knows that the parameter is not SQL code, and that neatly avoids the whole nasty problem of escaping characters.</p>\n\n<p>By choosing not to use <code>Prepare</code> you are skipping some potential for optimisation in the server. The server compiles each statement into an internal representation, and this takes time. By making this explicit and re-using the prepared statement, you explicitly save repeating that compilation step.</p>\n\n<p>However, MySQL does cache compiled statements, to avoid repeatedly compiling exactly the same string -- so you probably won't see big performance issues.</p>\n"}], "owner": {"reputation": 2277, "user_id": 1318313, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/854c52560c0c04e45102fb3b4b375ec0?s=128&d=identicon&r=PG", "display_name": "devnull", "link": "https://stackoverflow.com/users/1318313/devnull"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1570007989, "creation_date": 1570003253, "last_edit_date": 1570006211, "question_id": 58197442, "link": "https://stackoverflow.com/questions/58197442/secure-insert-queries-with-go-sql-driver-and-mysql", "title": "Secure insert queries with go-sql-driver and mysql", "body": "<p>I have reviewed the go-sql-driver examples with db.Prepare but I couldn't get it to work properly so I modified it to work directly with db.Query. My understanding is that by using ?? the value is escaped anyway so I was wondering if the following is correct and secure against SQL injection (note that I am using MySQL)</p>\n\n<pre><code>stmtIns, err := db.Query(\"INSERT INTO users (name, address) VALUES(?,?)\", name, address) // ? = placeholder\n        if err != nil {\n            panic(err.Error()) // proper error handling instead of panic in your app\n        }\n        defer stmtIns.Close() // Close the statement when we leave main() / the program terminates\n</code></pre>\n\n<p>Also, what is the best way to detect if the row has been inserted? </p>\n\n<p>clarification: for secure I meant from SQL Injection. I think it is but then I wonder why all example I could find use db.Prepare and not db.Query as I do. </p>\n"}, {"tags": ["go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1570002097, "creation_date": 1570002097, "answer_id": 58197157, "question_id": 58197122, "link": "https://stackoverflow.com/questions/58197122/why-binary-read-doesnt-work-for-struct/58197157#58197157", "title": "Why binary.Read() doesn&#39;t work for struct?", "body": "<p>The error says it all: you can't use unexported fields. Change the fields of <code>Coordinate</code> to be exported:</p>\n\n<pre><code>type Coordinate struct {\n    X float64\n    Y float64\n    Z float64\n}\n</code></pre>\n\n<p>Then it'll work, and outputs (try it on the <a href=\"https://play.golang.org/p/cELBd55Rqw_w\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>(1.000000,2.000000,3.000000)\n{[0 0 0 0 0 0 240 63 0 0 0 0 0 0 0 64 0 0 0 0 0 0 8 64] 0 0}\n(1.000000,2.000000,3.000000)\nover\n</code></pre>\n\n<p>Also never omit errors in Go. <a href=\"https://golang.org/pkg/encoding/binary/#Read\" rel=\"nofollow noreferrer\"><code>binary.Read()</code></a> and <a href=\"https://golang.org/pkg/encoding/binary/#Write\" rel=\"nofollow noreferrer\"><code>binary.Write()</code></a> return errors, always check them, for example:</p>\n\n<pre><code>if err := binary.Write(&amp;buf, binary.LittleEndian, &amp;point); err != nil {\n    // Handle error, for brevity we just panic here:\n    panic(err)\n}\n\nif err := binary.Read(&amp;buf, binary.LittleEndian, p); err != nil {\n    // Handle error, for brevity we just panic here:\n    panic(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 11955681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f56fa0913ca9fcec6662f7abc088916e?s=128&d=identicon&r=PG&f=1", "display_name": "Green", "link": "https://stackoverflow.com/users/11955681/green"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "accepted_answer_id": 58197157, "answer_count": 1, "score": 0, "last_activity_date": 1570002397, "creation_date": 1570001953, "last_edit_date": 1570002397, "question_id": 58197122, "link": "https://stackoverflow.com/questions/58197122/why-binary-read-doesnt-work-for-struct", "title": "Why binary.Read() doesn&#39;t work for struct?", "body": "<p>I'm a beginner of golang</p>\n\n<p>and my golang version is 1.13</p>\n\n<p>I try to use <code>binary</code> package as follow</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/binary\"\n    \"fmt\"\n)\n\ntype Coordinate struct {\n    x float64\n    y float64\n    z float64\n}\n\nfunc (self Coordinate) String() string {\n    return fmt.Sprintf(\"(%f,%f,%f)\", self.x, self.y, self.z)\n}\n\n//not work\nfunc test() {\n    var point Coordinate = Coordinate{1, 2, 3}\n    buf := bytes.Buffer{}\n    binary.Write(&amp;buf, binary.LittleEndian, &amp;point)\n    fmt.Println(point)\n    fmt.Println(buf)\n\n    p := new(Coordinate)\n    //panic: reflect: reflect.flag.mustBeAssignable using value obtained using unexported field\n    binary.Read(&amp;buf, binary.LittleEndian, p)\n    fmt.Println(p)\n}\n\nfunc main() {\n    test()\n    println(\"over\")\n}\n</code></pre>\n\n<p>and I got error message like this:</p>\n\n<pre><code>panic: reflect: reflect.flag.mustBeAssignable using value obtained using unexported field\n</code></pre>\n\n<p>It's there anything wrong with my code?</p>\n"}, {"tags": ["go", "slack-api"], "comments": [{"owner": {"reputation": 3480, "user_id": 164137, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/95614a2721a6f2bec5eeabc0de04fa4f?s=128&d=identicon&r=PG", "display_name": "Amos Shapira", "link": "https://stackoverflow.com/users/164137/amos-shapira"}, "edited": false, "score": 0, "creation_date": 1570001275, "post_id": 58196822, "comment_id": 102772244, "body": "Why the downvote?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1570001540, "post_id": 58196822, "comment_id": 102772366, "body": "You might want to read <a href=\"http://stackoverflow.com/help/how-to-ask\">How do I ask a good question</a>, which enhances the probability for getting a useful answer <i>drastically</i>. You might find <a href=\"https://en.m.wikipedia.org/wiki/Eric_S._Raymond\" rel=\"nofollow noreferrer\">ESR</a>\u2018s excellent essay <a href=\"http://catb.org/~esr/faqs/smart-questions.html\" rel=\"nofollow noreferrer\">How To Ask Questions The Smart Way</a> helpful, too - despite it\u2018s \u201eharsh\u201c title."}, {"owner": {"reputation": 3480, "user_id": 164137, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/95614a2721a6f2bec5eeabc0de04fa4f?s=128&d=identicon&r=PG", "display_name": "Amos Shapira", "link": "https://stackoverflow.com/users/164137/amos-shapira"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570001795, "post_id": 58196822, "comment_id": 102772489, "body": "It&#39;s far from being the first question I asked on StackOverflow. I describe what I&#39;m trying to achieve, how I tried, the results I got and the technologies I use. What other information is missing?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570002429, "post_id": 58196822, "comment_id": 102772789, "body": "You have not shown what you have tried so far (aka \u201eda codez\u201c ;) ). It is pretty hard to find out why a link is sent instead of the content without seeing the code, isn\u2018t it?"}, {"owner": {"reputation": 3480, "user_id": 164137, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/95614a2721a6f2bec5eeabc0de04fa4f?s=128&d=identicon&r=PG", "display_name": "Amos Shapira", "link": "https://stackoverflow.com/users/164137/amos-shapira"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1570002553, "post_id": 58196822, "comment_id": 102772839, "body": "Ok I&#39;ll add this when I get to a desk"}], "answers": [{"tags": [], "owner": {"reputation": 3480, "user_id": 164137, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/95614a2721a6f2bec5eeabc0de04fa4f?s=128&d=identicon&r=PG", "display_name": "Amos Shapira", "link": "https://stackoverflow.com/users/164137/amos-shapira"}, "is_accepted": false, "score": 0, "last_activity_date": 1570068655, "creation_date": 1570068655, "answer_id": 58211456, "question_id": 58196822, "link": "https://stackoverflow.com/questions/58196822/how-to-share-a-message-from-one-channel-to-another/58211456#58211456", "title": "How to share a message from one channel to another?", "body": "<p>I got the answer from a tip by Slack support - passing <code>slack.MsgOptionEnableLinkUnfurl()</code> to <code>PostMessage()</code> caused the message to be shared as I wanted.</p>\n"}], "owner": {"reputation": 3480, "user_id": 164137, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/95614a2721a6f2bec5eeabc0de04fa4f?s=128&d=identicon&r=PG", "display_name": "Amos Shapira", "link": "https://stackoverflow.com/users/164137/amos-shapira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1570068655, "creation_date": 1570000563, "last_edit_date": 1570008721, "question_id": 58196822, "link": "https://stackoverflow.com/questions/58196822/how-to-share-a-message-from-one-channel-to-another", "title": "How to share a message from one channel to another?", "body": "<p>I'm looking for a way to let my Slack bot mimic what happens when I hit the right-arrow button on a channel message, like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/6j6Ib.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/6j6Ib.png\" alt=\"screenshot of &quot;Share this message&quot; pop-up\"></a></p>\n\n<p>If I hit \"Share\" on that window the original message will appear in the destination channel with the same message URL as the original (which is what I need).</p>\n\n<p>I tried just posting the message URL by the bot but the URL appeared as a simple link, it didn't actually look like a copy of the original message.</p>\n\n<p>How can I achieve this with a bot?</p>\n\n<p>In case this matters, the bot is written in Go using <a href=\"https://github.com/nlopes/slack\" rel=\"nofollow noreferrer\">https://github.com/nlopes/slack</a></p>\n\n<p>EDIT: Here is a rough minimal code of what I tried (also tried surrounding the URL with <code>&lt;&gt;</code>, but got the same results):</p>\n\n<pre><code>s := slack.New(accessToken,\u00a0slack.OptionDebug(true))\ns.PostMessage(\n\u00a0\u00a0\u00a0\u00a0\u201c#target-channel\u201c,\n\u00a0\u00a0\u00a0\u00a0\u00a0slack.MsgOptionText(\"https://organization.slack.com/archives/original-channel-id/original-msg-id\u201d,\u00a0false),\n\u00a0\u00a0\u00a0\u00a0\u00a0slack.MsgOptionAsUser(false),\n\u00a0)\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 1417, "user_id": 109472, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/be1397db4ebc83d4cef5e47551614e56?s=128&d=identicon&r=PG", "display_name": "Nixarn", "link": "https://stackoverflow.com/users/109472/nixarn"}, "edited": false, "score": 0, "creation_date": 1570002089, "post_id": 58196895, "comment_id": 102772636, "body": "There we go, thanks, I totally missed that! The go 1.9 to 1.11 didn&#39;t mention it (clearly atleast)"}], "tags": [], "owner": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "is_accepted": true, "score": 2, "last_activity_date": 1570000973, "creation_date": 1570000973, "answer_id": 58196895, "question_id": 58196783, "link": "https://stackoverflow.com/questions/58196783/google-cloud-datatore-go-client-doesnt-close-the-connection-by-default/58196895#58196895", "title": "Google Cloud Datatore Go Client doesn&#39;t close the connection by default?", "body": "<p>I almost did the same but the godoc says to create a single client and reuse it for all datastore operations. There is no need to close the connection. </p>\n\n<pre><code>    // Create a datastore client. In a typical application, you would create\n    // a single client which is reused for every datastore operation.\n    dsClient, err := datastore.NewClient(ctx, \"my-project\")\n    if err != nil {\n        // Handle error.\n    }\n</code></pre>\n\n<p><a href=\"https://godoc.org/cloud.google.com/go/datastore\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go/datastore</a></p>\n"}], "owner": {"reputation": 1417, "user_id": 109472, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/be1397db4ebc83d4cef5e47551614e56?s=128&d=identicon&r=PG", "display_name": "Nixarn", "link": "https://stackoverflow.com/users/109472/nixarn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 58196895, "answer_count": 1, "score": 1, "last_activity_date": 1570004276, "creation_date": 1570000410, "last_edit_date": 1570004276, "question_id": 58196783, "link": "https://stackoverflow.com/questions/58196783/google-cloud-datatore-go-client-doesnt-close-the-connection-by-default", "title": "Google Cloud Datatore Go Client doesn&#39;t close the connection by default?", "body": "<p>I've had a bunch of issues <strong>migrating</strong> from App Engine on <strong>Go 1.9</strong> to <strong>1.11</strong>. </p>\n\n<p>I noticed the <strong>memory usage grew</strong> insanely when I followed the guide how to migrate. Before it was at a constant ~<strong>50-60 MB</strong>, but now it grew to <strong>1.5 GB</strong> quickly and instances started failing. </p>\n\n<p>But then I noticed that all examples showing how to use the GCP Datastore just replaced the previous </p>\n\n<p><code>datastore.Get()</code> </p>\n\n<p>with </p>\n\n<p><code>dsClient := datastore.NewClient(...) dsClient.get()</code> </p>\n\n<p>Then, when I looked closer at this client, it created a connection but never seem to close it, so when I added a <code>defer dsClient.Close()</code> after I created a new client <em>(basically in every call handler)</em>, the memory started going up from around ~<strong>60-80 MB</strong> to ~<strong>500 MB</strong> and then dropped; it kept going like this, but it was stable so I figured it did a GC every now and then. However, after a couple days it failed again and requests took forever and new instances were created until the cap was reached <em>(previously it failed quicker)</em>.</p>\n\n<p>So I wonder if I should just create one Datastore Client in main instead? Is it a good practice? And, if so, why do all examples show it being created in the call handle, and why is there never call to close the connection?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "soap", "header"], "comments": [{"owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 1, "creation_date": 1569996082, "post_id": 58195833, "comment_id": 102770293, "body": "hello, welcome to stackoverflow! What have you tried? Please have a look at <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">stackoverflow.com/help/minimal-reproducible-example</a>, this will make it easier for people to help you."}, {"owner": {"reputation": 58, "user_id": 592446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c21f423535c8ab496c8ea3239cc6378b?s=128&d=identicon&r=PG", "display_name": "giubueno", "link": "https://stackoverflow.com/users/592446/giubueno"}, "edited": false, "score": 0, "creation_date": 1570001525, "post_id": 58195833, "comment_id": 102772360, "body": "Could you share how you are calling this service, please?"}, {"owner": {"reputation": 436, "user_id": 1638158, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/NlmL8.jpg?s=128&g=1", "display_name": "John Dowling", "link": "https://stackoverflow.com/users/1638158/john-dowling"}, "edited": false, "score": 1, "creation_date": 1570002332, "post_id": 58195833, "comment_id": 102772745, "body": "Could you clarify what you mean by handle the header, what would you like to do with it ?"}, {"owner": {"reputation": 1, "user_id": 11364083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf945b5abe5ef3da1e55f793090cba7c?s=128&d=identicon&r=PG&f=1", "display_name": "Yash", "link": "https://stackoverflow.com/users/11364083/yash"}, "edited": false, "score": 0, "creation_date": 1570029317, "post_id": 58195833, "comment_id": 102787034, "body": "I would like to read soap response header in golang.. how do I parse soap in Go for the above soap response."}], "owner": {"reputation": 1, "user_id": 11364083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf945b5abe5ef3da1e55f793090cba7c?s=128&d=identicon&r=PG&f=1", "display_name": "Yash", "link": "https://stackoverflow.com/users/11364083/yash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 117, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1570029893, "creation_date": 1569995092, "last_edit_date": 1570029893, "question_id": 58195833, "link": "https://stackoverflow.com/questions/58195833/how-to-handle-soap-response-headers-in-golang", "title": "How to handle soap response headers in golang", "body": "<p>Im calling a soap api from golang, the response on the soap api has header section and body.. how to handle header response in golang</p>\n\n<p>this is soap api response</p>\n\n<pre><code>&lt;?xml version='1.0' encoding='UTF-8'?&gt;\n&lt;S:Envelope xmlns:S=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;\n    &lt;S:Header&gt;\n        &lt;SessionId xmlns=\"http://schemas.com/2/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:nil=\"true\"/&gt;\n        &lt;TransactionId xmlns=\"http://schemas.com/2/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:nil=\"true\"/&gt;\n    &lt;/S:Header&gt;\n    &lt;S:Body&gt;\n        &lt;GetResponse xmlns=\"http://schemas.ericsson.com/cai3g1.2/\"&gt;\n            &lt;MOAttributes&gt;\n                &lt;ilf:getResponseSubscription xmlns:ilf=\"http://schemas.com/ema/ILF/\" publicIdentity=\"tel:+1234567890\"&gt;\n                    &lt;ilf:publicIdEntry publicIdentity=\"tel:+1234567890\"&gt;\n                    &lt;/ilf:publicIdEntry&gt;\n                &lt;/ilf:getResponseSubscription&gt;\n            &lt;/MOAttributes&gt;\n        &lt;/GetResponse&gt;\n    &lt;/S:Body&gt;\n&lt;/S:Envelope&gt;\n</code></pre>\n\n<p>this is my soap client struct</p>\n\n<pre><code>type SOAPEnvelopeOutput struct {\n    XMLName xml.Name `xml:\"http://schemas.xmlsoap.org/soap/envelope/ Envelope\"`\n    Header  SoapHeaderOutput\n    Body    SOAPBodyOutput }\n\ntype SOAPBodyOutput struct {\n    XMLName xml.Name `xml:\"http://schemas.xmlsoap.org/soap/envelope/ Body\"`\n    Content []byte `xml:\",innerxml\"` }\n\ntype SoapHeaderOutput struct {\n    XMLName xml.Name `xml:\"http://schemas.xmlsoap.org/soap/envelope/ Header\"`\n    Items []byte `xml:\",innerxml\"` }\n</code></pre>\n\n<p>Here's the code I wrote parse:</p>\n\n<pre><code>type GetResponse struct {\n    XMLName               xml.Name `xml:\"http://schemas.ericsson.com/cai3g1.2/ GetResponse\"`\n    GetMOAttributes       MOAttributes `xml:\"MOAttributes\"`\n}\n\ntype MOAttributes struct {\n    XMLName                   xml.Name                `xml:\"http://schemas.ericsson.com/cai3g1.2/ MOAttributes\"`\n    GetResponseSubscription   getResponseSubscription `xml:\"ilf:getResponseSubscription\"`\n}\n\ntype getResponseSubscription struct {\n    XMLName            xml.Name `xml:\"http://schemas.ericsson.com/cai3g1.2/ ilf:getResponseSubscription\"`\n    GetPublicIdEntry   getPublicIdEntry  `xml:\"ilf:publicIdEntry\"`\n}\n\ntype getPublicIdEntry struct {\n    XMLName            xml.Name `xml:\"http://schemas.ericsson.com/cai3g1.2/ ilf:publicIdEntry\"`\n    }\n</code></pre>\n"}, {"tags": ["go", "sqlx"], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 11183608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bbcc5e9b025458b0a7ab0ea4a7c2aa9?s=128&d=identicon&r=PG&f=1", "display_name": "kurapika", "link": "https://stackoverflow.com/users/11183608/kurapika"}, "edited": false, "score": 0, "creation_date": 1569998022, "post_id": 58195302, "comment_id": 102770891, "body": "if i am using <code>db, err := sqlx.Connect(&quot;mysql&quot;,connection)</code> then there&#39;s no need for me to declare it at the anymore. Thank you for the explanation. Could you also point out any other syntax error here? I&#39;m still in learning progress"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 137, "user_id": 11183608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bbcc5e9b025458b0a7ab0ea4a7c2aa9?s=128&d=identicon&r=PG&f=1", "display_name": "kurapika", "link": "https://stackoverflow.com/users/11183608/kurapika"}, "edited": false, "score": 1, "creation_date": 1569998514, "post_id": 58195302, "comment_id": 102771072, "body": "@kurapika you need to <code>Close</code> the <code>db</code>, or else your app will run out of available connections very quickly. This is documented in <a href=\"https://golang.org/pkg/database/sql/\" rel=\"nofollow noreferrer\"><code>database&#47;sql</code></a> which <a href=\"https://godoc.org/github.com/jmoiron/sqlx#DB\" rel=\"nofollow noreferrer\"><code>sqlx</code></a> relies upon."}], "tags": [], "owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "is_accepted": true, "score": 2, "last_activity_date": 1569991529, "last_edit_date": 1569991529, "creation_date": 1569991220, "answer_id": 58195302, "question_id": 58195027, "link": "https://stackoverflow.com/questions/58195027/undefined-err-in-sqlx-when-initializing-connecting-to-a-database/58195302#58195302", "title": "Undefined &#39;err&#39; in SQLX when initializing connecting to a database", "body": "<p>This is very basic Go. You should do the tour. In particular have a look at <a href=\"https://tour.golang.org/basics/10\" rel=\"nofollow noreferrer\">https://tour.golang.org/basics/10</a>.  Not that in Go you have to watch for the subtle difference between <code>=</code> and <code>:=</code>.</p>\n\n<p>But in brief you are using <code>err</code> before it is declared.  You can either declare it first:</p>\n\n<pre><code>  var err error\n</code></pre>\n\n<p>or use a short declaration</p>\n\n<pre><code>  db, err := sqlx.Connect(\"mysql\", connection)\n</code></pre>\n\n<p>Maybe easiest is to move the following line (which does do short declaration) before it otherwise you will get another error when it's declared twice.  And you probably should also check the error.</p>\n\n<pre><code>  userJson, err := json.Marshal(response)\n  if err != nil {\n    panic(err)\n  }\n  db, err = sqlx.Connect(\"mysql\", connection)\n  if err != nil {\n    panic(err)\n  }\n</code></pre>\n\n<p>However, I can see further problems beside this syntax error.</p>\n"}], "owner": {"reputation": 137, "user_id": 11183608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bbcc5e9b025458b0a7ab0ea4a7c2aa9?s=128&d=identicon&r=PG&f=1", "display_name": "kurapika", "link": "https://stackoverflow.com/users/11183608/kurapika"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 58195302, "answer_count": 1, "score": 1, "last_activity_date": 1569991529, "creation_date": 1569988751, "question_id": 58195027, "link": "https://stackoverflow.com/questions/58195027/undefined-err-in-sqlx-when-initializing-connecting-to-a-database", "title": "Undefined &#39;err&#39; in SQLX when initializing connecting to a database", "body": "<p>I am new to Go lang and trying to connect to the server and create a database upon an API call. </p>\n\n<p>But I am getting an \"undefined:err\" at <code>sqlx.Connect</code>. Initially I thought it was because of me not defining the <code>db *sqlx.DB</code>. But it still gets error at <code>db, err = sqlx.Connect(\"mysql\", connection)</code>.</p>\n\n<p>Is it necessary to define a <code>var err</code> ?</p>\n\n<pre><code>func (setupController *SetupController) Setup(w http.ResponseWriter, r *http.Request) {\n    var db *sqlx.DB\n    var connection string\n\n    response := new(Response)\n    response.Host = r.FormValue(\"host\")\n    response.Port = r.FormValue(\"port\")\n    response.Dbuser = r.FormValue(\"dbuser\")\n    response.Dbpassword = r.FormValue(\"dbpassword\")\n    response.Dbname = r.FormValue(\"dbname\")\n    response.Username = r.FormValue(\"username\")\n    response.Password = r.FormValue(\"password\")\n\n    connection = response.Dbuser + \":\" + response.Dbpassword + \"@tcp(\" + response.Host + \":\" + response.Port + \")/\" + response.Dbname\n    db, err = sqlx.Connect(\"mysql\", connection)\n    userJson, err := json.Marshal(response)\n    if err != nil {\n        panic(err)\n    }\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.WriteHeader(http.StatusOK)\n    w.Write(userJson)\n}\n</code></pre>\n\n<p>Thank you! </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1569986412, "creation_date": 1569986412, "answer_id": 58194800, "question_id": 58193688, "link": "https://stackoverflow.com/questions/58193688/web-application-in-golang-for-offline-browser-use/58194800#58194800", "title": "Web application in Golang for offline/browser use", "body": "<p>If you want to use Docker for this, you have to create a platform-specific docker image containing the platform-specific binary in it. Once you have these images, you can use docker-compose to run your app with an instance of postgres running in its own container.</p>\n"}, {"comments": [{"owner": {"reputation": 1568, "user_id": 4239355, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/1062734612/picture?type=large", "display_name": "Zoltan King", "link": "https://stackoverflow.com/users/4239355/zoltan-king"}, "edited": false, "score": 0, "creation_date": 1570183850, "post_id": 58213608, "comment_id": 102841842, "body": "Thank you mozey. That&#39;s very true and I perfectly agree with you. One thing that bothers me is the database. PostgreSQL has it own running process/server and can&#39;t be bundled into a GO binary. So, I think SQLITE or something similar that is file based would be a better choice in my case."}, {"owner": {"reputation": 1885, "user_id": 639133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4781a491e1923d56755de71fbec9d5d4?s=128&d=identicon&r=PG", "display_name": "mozey", "link": "https://stackoverflow.com/users/639133/mozey"}, "reply_to_user": {"reputation": 1568, "user_id": 4239355, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/1062734612/picture?type=large", "display_name": "Zoltan King", "link": "https://stackoverflow.com/users/4239355/zoltan-king"}, "edited": false, "score": 0, "creation_date": 1570269822, "post_id": 58213608, "comment_id": 102865549, "body": "It sounded like the client will already have Postgres as a &quot;separate server locally&quot;. SQLite is a great option if you need to bundle a single user relational db, and it&#39;s well supported in golang"}], "tags": [], "owner": {"reputation": 1885, "user_id": 639133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4781a491e1923d56755de71fbec9d5d4?s=128&d=identicon&r=PG", "display_name": "mozey", "link": "https://stackoverflow.com/users/639133/mozey"}, "is_accepted": true, "score": 1, "last_activity_date": 1572942082, "last_edit_date": 1572942082, "creation_date": 1570084992, "answer_id": 58213608, "question_id": 58193688, "link": "https://stackoverflow.com/questions/58193688/web-application-in-golang-for-offline-browser-use/58213608#58213608", "title": "Web application in Golang for offline/browser use", "body": "<p>You don't need Docker to do this. </p>\n\n<p>It complicates things since your users will have to install the Docker engine first. Go is perfectly capable for cross platform applications, batteries included.</p>\n\n<p>Decide if you want your app to run in a browser tab or should it have it's own window?</p>\n\n<p>For a <strong>browser tab</strong> compile your app for the target architecture and think about a URL scheme that will make sense to your users, for example</p>\n\n<ul>\n<li><code>localhost:8080/app</code> => the user interface. This route is the web app, it serves HTML, JS and CSS. Tell your users to run the executable (or install it as a service, see <a href=\"https://github.com/kardianos/service\" rel=\"nofollow noreferrer\">this</a> or use a platform specific tool like <a href=\"https://nssm.cc\" rel=\"nofollow noreferrer\">this one</a>). Then open the link in a browser</li>\n<li><code>localhost:8080/api</code> => backend routes. Serves data to requests made by the user interface. For talking to the Postgres server running locally</li>\n</ul>\n\n<p>If you want your app to run in it's <strong>own window</strong> have a look at <a href=\"https://electronjs.org\" rel=\"nofollow noreferrer\">Electron</a>. See <a href=\"https://github.com/Equanox/gotron\" rel=\"nofollow noreferrer\">gotron</a>: <em>Go Api for Electron</em></p>\n"}], "owner": {"reputation": 1568, "user_id": 4239355, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/1062734612/picture?type=large", "display_name": "Zoltan King", "link": "https://stackoverflow.com/users/4239355/zoltan-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "accepted_answer_id": 58213608, "answer_count": 2, "score": 0, "last_activity_date": 1572942082, "creation_date": 1569974412, "last_edit_date": 1569974767, "question_id": 58193688, "link": "https://stackoverflow.com/questions/58193688/web-application-in-golang-for-offline-browser-use", "title": "Web application in Golang for offline/browser use", "body": "<p>I'd like to create a simple web application to manage some data. The application will use PostgreSQL but I have no idea how to package everything in order to make it run on windows, linux, and mac. I can cross-compile a go binary which will include everything (web server, etc..) but the postgresql database will be left out because that's running as a separate server locally. I heard about docker but I don't know if that's the right solution. </p>\n\n<p>Should I create a docker container and include PostgreSQL in it so I can start that web app on any platform?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-dynamodb", "aws-sdk", "aws-fargate"], "answers": [{"comments": [{"owner": {"reputation": 1739, "user_id": 42040, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4325b045cc09237efcd8d4f485d19453?s=128&d=identicon&r=PG", "display_name": "Marcelo MD", "link": "https://stackoverflow.com/users/42040/marcelo-md"}, "edited": false, "score": 0, "creation_date": 1569974388, "post_id": 58193416, "comment_id": 102766386, "body": "Looks like networking indeed. Except the python task runs ok in the same setup. I just changed the task image. Before setting the task role I got an invalid credentials error, so I assumed the network was ok. I&#39;m trying the simplest setup that will work. Hence the use of the templates from AWS. Thanks  The VPC endpoint was an experiment and made no difference."}, {"owner": {"reputation": 1984, "user_id": 481816, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0d64813aef50eccbe84a3278b2270d51?s=128&d=identicon&r=PG", "display_name": "Dude0001", "link": "https://stackoverflow.com/users/481816/dude0001"}, "reply_to_user": {"reputation": 1739, "user_id": 42040, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4325b045cc09237efcd8d4f485d19453?s=128&d=identicon&r=PG", "display_name": "Marcelo MD", "link": "https://stackoverflow.com/users/42040/marcelo-md"}, "edited": false, "score": 0, "creation_date": 1569974628, "post_id": 58193416, "comment_id": 102766421, "body": "What server address are you using to connect to DynamoDB?"}, {"owner": {"reputation": 1739, "user_id": 42040, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4325b045cc09237efcd8d4f485d19453?s=128&d=identicon&r=PG", "display_name": "Marcelo MD", "link": "https://stackoverflow.com/users/42040/marcelo-md"}, "edited": false, "score": 0, "creation_date": 1569975115, "post_id": 58193416, "comment_id": 102766492, "body": "I&#39;m not using any explicit address. Just setting the region on the client. See <code>init()</code> function."}, {"owner": {"reputation": 1984, "user_id": 481816, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0d64813aef50eccbe84a3278b2270d51?s=128&d=identicon&r=PG", "display_name": "Dude0001", "link": "https://stackoverflow.com/users/481816/dude0001"}, "reply_to_user": {"reputation": 1739, "user_id": 42040, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4325b045cc09237efcd8d4f485d19453?s=128&d=identicon&r=PG", "display_name": "Marcelo MD", "link": "https://stackoverflow.com/users/42040/marcelo-md"}, "edited": false, "score": 0, "creation_date": 1569975587, "post_id": 58193416, "comment_id": 102766594, "body": "Are you trying to access a local DynamoDB or the AW DynamoDB service? Either way you need to tell your client what to connect to.  <a href=\"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GettingStarted.NET.01.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/amazondynamodb/latest/developerguide/&hellip;</a>"}, {"owner": {"reputation": 1739, "user_id": 42040, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4325b045cc09237efcd8d4f485d19453?s=128&d=identicon&r=PG", "display_name": "Marcelo MD", "link": "https://stackoverflow.com/users/42040/marcelo-md"}, "edited": false, "score": 0, "creation_date": 1569976624, "post_id": 58193416, "comment_id": 102766746, "body": "I&#39;m trying to access the AWS service."}, {"owner": {"reputation": 1984, "user_id": 481816, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0d64813aef50eccbe84a3278b2270d51?s=128&d=identicon&r=PG", "display_name": "Dude0001", "link": "https://stackoverflow.com/users/481816/dude0001"}, "reply_to_user": {"reputation": 1739, "user_id": 42040, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4325b045cc09237efcd8d4f485d19453?s=128&d=identicon&r=PG", "display_name": "Marcelo MD", "link": "https://stackoverflow.com/users/42040/marcelo-md"}, "edited": false, "score": 0, "creation_date": 1569976997, "post_id": 58193416, "comment_id": 102766798, "body": "Then you need to give the client the http address to your DynamoDB as in the link I shared"}, {"owner": {"reputation": 1739, "user_id": 42040, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4325b045cc09237efcd8d4f485d19453?s=128&d=identicon&r=PG", "display_name": "Marcelo MD", "link": "https://stackoverflow.com/users/42040/marcelo-md"}, "edited": false, "score": 0, "creation_date": 1570014574, "post_id": 58193416, "comment_id": 102778471, "body": "Hah. Problem was with the base image. The DynamoDB Go package doesn&#39;t need an address. There isn&#39;t an option to pass and it never shows in the docs or tutorials. The client must work with something from the host to resolve the service address and that part was missing from the bare bones image I was using. Thanks!"}, {"owner": {"reputation": 1984, "user_id": 481816, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0d64813aef50eccbe84a3278b2270d51?s=128&d=identicon&r=PG", "display_name": "Dude0001", "link": "https://stackoverflow.com/users/481816/dude0001"}, "reply_to_user": {"reputation": 1739, "user_id": 42040, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4325b045cc09237efcd8d4f485d19453?s=128&d=identicon&r=PG", "display_name": "Marcelo MD", "link": "https://stackoverflow.com/users/42040/marcelo-md"}, "edited": false, "score": 0, "creation_date": 1570015603, "post_id": 58193416, "comment_id": 102778949, "body": "Okay not familiar with Dynamo Go and missed that part. You said you were trying to access the AWS Service and that through me off. Glad you figured it out."}], "tags": [], "owner": {"reputation": 1984, "user_id": 481816, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0d64813aef50eccbe84a3278b2270d51?s=128&d=identicon&r=PG", "display_name": "Dude0001", "link": "https://stackoverflow.com/users/481816/dude0001"}, "is_accepted": false, "score": 0, "last_activity_date": 1569971708, "creation_date": 1569971708, "answer_id": 58193416, "question_id": 58193300, "link": "https://stackoverflow.com/questions/58193300/access-dynamodb-in-golang-fargate-task/58193416#58193416", "title": "Access DynamoDB in Golang Fargate Task", "body": "<p>Timeout is often a network Issue. Have you checked security groups used by both the ECS task and Dynamo DB. Need to make sure you have rules setup to egress out of ECS and ingress into DynamoDB on the correct ports.</p>\n\n<p>You said you setup an endpoint for Dynamo in the VPC. Not clear from your OP if you are trying to connect to private endpoint in a private VPC or if you are trying to go through the public internet. If you are trying to go through public internet you need to also check that your ECS task is in a VPC that has a NAT gateway out to the public internet. It looks like you are trying to connect through 127.0.0.1 or an ELB DNS to connect to the DynamoDB service which doesn't make sense to me.</p>\n"}, {"comments": [{"owner": {"reputation": 2333, "user_id": 505726, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f93ee4ff9e016460a56f66a6084751d4?s=128&d=identicon&r=PG", "display_name": "Napas", "link": "https://stackoverflow.com/users/505726/napas"}, "edited": false, "score": 0, "creation_date": 1570478786, "post_id": 58200208, "comment_id": 102919406, "body": "Solved the issue I had, which to way too much to resolve :|"}], "tags": [], "owner": {"reputation": 1739, "user_id": 42040, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4325b045cc09237efcd8d4f485d19453?s=128&d=identicon&r=PG", "display_name": "Marcelo MD", "link": "https://stackoverflow.com/users/42040/marcelo-md"}, "is_accepted": true, "score": 1, "last_activity_date": 1570014316, "creation_date": 1570014316, "answer_id": 58200208, "question_id": 58193300, "link": "https://stackoverflow.com/questions/58193300/access-dynamodb-in-golang-fargate-task/58200208#58200208", "title": "Access DynamoDB in Golang Fargate Task", "body": "<p>Answering my own question.</p>\n\n<p>Problem was with the Docker base image I was using. My Dockerfile was:</p>\n\n<pre><code>FROM scratch\nADD ./build/api/api /\nEXPOSE 8080\nENTRYPOINT [\"/api\"]\n</code></pre>\n\n<p>With a statically linked executable.</p>\n\n<p>Changing <code>FROM scratch</code> to <code>FROM gcr.io/distroless/base</code> made it work.</p>\n\n<p>My guess is that the application/dynamodb client wasn't able to resolve the service address without the missing parts from the base image.</p>\n\n<p>Thanks @Dude0001.</p>\n"}], "owner": {"reputation": 1739, "user_id": 42040, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4325b045cc09237efcd8d4f485d19453?s=128&d=identicon&r=PG", "display_name": "Marcelo MD", "link": "https://stackoverflow.com/users/42040/marcelo-md"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 674, "favorite_count": 0, "accepted_answer_id": 58200208, "answer_count": 2, "score": 1, "last_activity_date": 1570014316, "creation_date": 1569970620, "last_edit_date": 1569975024, "question_id": 58193300, "link": "https://stackoverflow.com/questions/58193300/access-dynamodb-in-golang-fargate-task", "title": "Access DynamoDB in Golang Fargate Task", "body": "<p>I'm trying to access DynamoDB from my Fargate task, which is written in golang. And all I get is a timeout. What I am missing?</p>\n\n<p>I'm using the Cloudformation templates from AWS Labs <a href=\"https://github.com/awslabs/aws-cloudformation-templates/tree/master/aws/services/ECS\" rel=\"nofollow noreferrer\">(here)</a> plus a task role that allows full DynamoDB access. It's the simplest public subnet template plus the Fargate one.</p>\n\n<p>I tried adding a VPC endpoint, but it made no difference.</p>\n\n<p>Running the task on my machine works.\nRunning a Python (Flask) task that does (more or less) the same works both locally and on AWS. It's the same setup, I just changed the task image.</p>\n\n<p>This is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"github.com/aws/aws-sdk-go-v2/aws/endpoints\"\n    \"github.com/aws/aws-sdk-go-v2/aws/external\"\n    \"github.com/aws/aws-sdk-go-v2/service/dynamodb\"\n    \"github.com/gin-gonic/gin\"\n    \"time\"\n)\n\nvar db *dynamodb.Client\n\nfunc init() {\n    cfg, err := external.LoadDefaultAWSConfig()\n    if err != nil {\n        panic(\"unable to load SDK config, \" + err.Error())\n    }\n    cfg.Region = endpoints.UsEast2RegionID\n    db = dynamodb.New(cfg)\n}\n\nfunc main() {\n    fmt.Println(\"go!\")\n    router := gin.New()\n    router.Use(gin.Recovery())\n    router.GET(\"/ping\", func(c *gin.Context) { c.JSON(200, gin.H{\"msg\": \"pong\"}) })\n    router.GET(\"/pong\", func(c *gin.Context) {\n        req := db.ListTablesRequest(&amp;dynamodb.ListTablesInput{})\n        ctx := context.Background()\n        ctx, cancelFn := context.WithTimeout(ctx, time.Second*5)\n        defer cancelFn()\n        res, err := req.Send(ctx)\n        if err != nil {\n            c.JSON(400, gin.H{\"msg\": \"Fail\", \"error\": err.Error()})\n            return\n        }\n        c.JSON(200, gin.H{\"msg\": fmt.Sprint(res)})\n        return\n    })\n    router.Run()\n}\n\n</code></pre>\n\n<p>Timeout:</p>\n\n<pre><code>helles:v2&gt; curl  xyz.us-east-2.elb.amazonaws.com/pong\n{\"error\":\"RequestCanceled: request context canceled\\ncaused by: context deadline exceeded\",\"msg\":\"Fail\"}\n</code></pre>\n\n<p>Expected:</p>\n\n<pre><code>helles:v2&gt; curl 127.0.0.1:8080/pong\n{\"msg\":\"{\\n  TableNames: [\\\"OneTable\\\",\\\"OtherTable\\\"]\\n}\"}\n</code></pre>\n\n<p>Python for comparison:</p>\n\n<pre><code>#!/usr/bin/env python3\nfrom flask import Flask\nimport boto3\n\ndynamodb = boto3.client(\"dynamodb\")\napp = Flask(__name__)\n\n@app.route(\"/ping\")\ndef index():\n    return \"pong\"\n\n@app.route(\"/pong\")\ndef pong():\n    return dynamodb.list_tables()\n\nif __name__ == \"__main__\":\n    app.run(debug=True, host=\"0.0.0.0\", port=8080)\n</code></pre>\n\n<p>The result is a bit different, with metadata added, but the table names are there.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "openssl", "curve-25519"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1569961894, "post_id": 58191402, "comment_id": 102763092, "body": "FYI... your generate key output has <code>PRIVATE KEY</code> yet your code snippet uses <code>PUBLIC KEY</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "edited": false, "score": 0, "creation_date": 1569963276, "post_id": 58191800, "comment_id": 102763564, "body": "My apologies, StackOverFlow&#39;s editor failed to format my tabs correctly. I&#39;ve fixed the question. The question still remains. There&#39;s no parsing function that recognizes curve25519."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "edited": false, "score": 1, "creation_date": 1569967017, "post_id": 58191800, "comment_id": 102764756, "body": "I think you need to clarify <code>Public</code> vs <code>Private</code> - the function in question is meant for a Public key - and your question has a private key definition."}, {"owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "edited": false, "score": 0, "creation_date": 1569968324, "post_id": 58191800, "comment_id": 102765114, "body": "The key in my example is a public key and the function I used to parse it is for public keys. The question is irrespective of whether if it&#39;s a public or private key. There&#39;s no function to parse either."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "edited": false, "score": 0, "creation_date": 1569968495, "post_id": 58191800, "comment_id": 102765166, "body": "It is relevant. A private key contains both the private and public part. A public key just the public part. OpenSSL has this distinction and so too does the <code>x509</code> package."}, {"owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "edited": false, "score": 0, "creation_date": 1569969266, "post_id": 58191800, "comment_id": 102765372, "body": "I understand that. But there&#39;s no function under the <code>x509</code> package that will parse the private or the public key file. <code>ParsePKIXPublicKey</code> is not the correct function."}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 0, "last_activity_date": 1569962044, "last_edit_date": 1569962044, "creation_date": 1569961522, "answer_id": 58191800, "question_id": 58191402, "link": "https://stackoverflow.com/questions/58191402/parse-curve25519-keys-generated-using-openssl-in-go/58191800#58191800", "title": "Parse curve25519 keys generated using openssl in Go", "body": "<p>Your inline key value is malform due to the tab/spaces before <code>-----END PUBLIC KEY-----</code></p>\n\n<p>As a result <code>block</code> is <code>nil</code> and cause the follow-up function to segfault.</p>\n\n<p>Here's a quick fix for the decoding piece:</p>\n\n<pre><code>pKey := `-----BEGIN PRIVATE KEY-----\nMCowBQYDK2VuAyEAfLLsWKkI/7EmTOkSf4fyHuRHDnKk6qNncWDzV8jlIUU=\n-----END PRIVATE KEY-----`\n\nblock, _ := pem.Decode([]byte(pKey))\n\nif block == nil || block.Type != \"PRIVATE KEY\" {\n    log.Fatal(\"failed to decode PEM block containing private key\")\n\n}\n\nkey, err := x509.ParsePKIXPublicKey(block.Bytes)\nif err != nil {\n    log.Println(\"Parse PKI Error:\", err)\n    return\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/O2wk8rmKGWH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/O2wk8rmKGWH</a></p>\n\n<p>Note: <code>ParsePKIXPublicKey</code> function does not recognize this key algorithm.</p>\n\n<blockquote>\n  <p>2009/11/10 23:00:00 Parse PKI Error: x509: unknown public key\n  algorithm</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 74087, "user_id": 214790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f878c8230342730990acd21f889301d4?s=128&d=identicon&r=PG", "display_name": "matt", "link": "https://stackoverflow.com/users/214790/matt"}, "is_accepted": true, "score": 1, "last_activity_date": 1570052772, "creation_date": 1570052772, "answer_id": 58209771, "question_id": 58191402, "link": "https://stackoverflow.com/questions/58191402/parse-curve25519-keys-generated-using-openssl-in-go/58209771#58209771", "title": "Parse curve25519 keys generated using openssl in Go", "body": "<p>Since there is currently no way to parse X25519 keys in the standard library, you may have to do this \u201cby hand\u201d.</p>\n\n<p>You could do it \u201cproperly\u201d by <a href=\"https://play.golang.org/p/AOLSdcL4SBK\" rel=\"nofollow noreferrer\">using the <code>encoding/asn1</code> library to decode the keys</a>, but in this case there is a simpler way.</p>\n\n<p>It turns out that for both the private and public keys the actual key is just the last 32 bytes of the base64 decoded block of the key.</p>\n\n<p>So you can just do:</p>\n\n<pre><code>block, _ := pem.Decode([]byte(pemString))\nkey := block.Bytes[len(block.Bytes)-32:]\n</code></pre>\n\n<p>This will work for both public and private keys, and will give you a 32 byte <code>[]byte</code> containing the appropriate key.</p>\n"}], "owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 639, "favorite_count": 1, "accepted_answer_id": 58209771, "answer_count": 2, "score": 0, "last_activity_date": 1570052772, "creation_date": 1569959441, "last_edit_date": 1569963211, "question_id": 58191402, "link": "https://stackoverflow.com/questions/58191402/parse-curve25519-keys-generated-using-openssl-in-go", "title": "Parse curve25519 keys generated using openssl in Go", "body": "<p>Using <code>OpenSSL</code> version 1.1 and or later, I'm able to generate a curve25519 key:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>openssl genpkey -algorithm x25519\n</code></pre>\n\n<p>This produces a private key of the form:</p>\n\n<pre><code>-----BEGIN PRIVATE KEY-----\nMC4CAQAwBQYDK2VuBCIEIDgk3GuFMIaUJd3m95jn/Z8oU+cK9FzPoidIDn/bqRlk\n-----END PRIVATE KEY-----\n</code></pre>\n\n<p>I want to parse this key file in Go and potentially use it using <a href=\"https://godoc.org/golang.org/x/crypto/nacl/box\" rel=\"nofollow noreferrer\">golang.org/x/crypto/nacl/box</a>. Looking at <a href=\"https://golang.org/pkg/crypto/x509/\" rel=\"nofollow noreferrer\">crypto/x509</a> documentation, I can't find a parsing function that parses curve25519. Anyone have an idea?</p>\n\n<p>I tried:</p>\n\n<pre><code>pKey := `-----BEGIN PUBLIC KEY-----\nMCowBQYDK2VuAyEAfLLsWKkI/7EmTOkSf4fyHuRHDnKk6qNncWDzV8jlIUU=\n-----END PUBLIC KEY-----`\n\nblock, _ := pem.Decode([]byte(pKey))\nkey, err := x509.ParsePKIXPublicKey(block.Bytes)\nif err != nil {\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>I get the error <code>unknown public key algorithm</code>.</p>\n"}, {"tags": ["html", "go", "post", "browser"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1569949942, "post_id": 58189164, "comment_id": 102758565, "body": "&quot;How do i tell the browser to keep or rerender the original page?&quot; You cannot. Dead simple. You must respond with whatever you would like to be displayed."}, {"owner": {"reputation": 2776, "user_id": 1987437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/508e14a7e9414311eff04b2fd8d20ed6?s=128&d=identicon&r=PG", "display_name": "Liam Kelly", "link": "https://stackoverflow.com/users/1987437/liam-kelly"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1569950012, "post_id": 58189164, "comment_id": 102758591, "body": "@Volker So after the POST, just send the HTML I want displayed?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1569953683, "post_id": 58189164, "comment_id": 102759971, "body": "&quot;How do I tell the browser to keep or rerender the original page?&quot; -- You don&#39;t. This is the reason SPAs are popular."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1569958183, "post_id": 58189164, "comment_id": 102761666, "body": "&quot;How do I tell the browser to keep or rerender the original page?&quot;  Redirect to the page from the POST handler.  For example: <code>http.Redirect(w, r, &quot;&#47;&quot;, http.StatusSeeOther)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1569950284, "creation_date": 1569950284, "answer_id": 58189558, "question_id": 58189164, "link": "https://stackoverflow.com/questions/58189164/what-is-the-default-browser-form-behavior-for-post-method/58189558#58189558", "title": "What is the default browser form behavior for POST method?", "body": "<p>What you are asking is the basic operation of HTTP. The client sends a request, and the server responds to the request. If the client is a browser, the browser displays the response.</p>\n\n<p>For GET request, browser sends the GET request to the server, the server responds with an HTML page, and browser displays it.</p>\n\n<p>For POST request, browser sends the POST request along with the values submitted in the form, and the server should respond with an HTML page, so the browser can dispay it. The response displayed will be a POST response, so if you reload that page, it will try to resubmit the form. </p>\n"}, {"tags": [], "owner": {"reputation": 2776, "user_id": 1987437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/508e14a7e9414311eff04b2fd8d20ed6?s=128&d=identicon&r=PG", "display_name": "Liam Kelly", "link": "https://stackoverflow.com/users/1987437/liam-kelly"}, "is_accepted": true, "score": 0, "last_activity_date": 1569950339, "creation_date": 1569950339, "answer_id": 58189568, "question_id": 58189164, "link": "https://stackoverflow.com/questions/58189164/what-is-the-default-browser-form-behavior-for-post-method/58189568#58189568", "title": "What is the default browser form behavior for POST method?", "body": "<p>@Volker pointed out what needed to change. The POST needed to be answered by the HTML I wanted displayed, so the real simple way to fix this is:</p>\n\n<pre><code>func MainPage(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"method:\", r.Method) //get request method\n\n    if r.Method == http.MethodPost {\n        r.ParseForm()\n        ...\n    }\n\n  if r.Method == \"GET\" || r.Method == \"POST\" {\n        t, err := template.New(\"RTL Page\").Parse(page)\n        if err != nil {\n            log.Fatal(err)\n        }\n        err = t.Execute(w, State)\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 2776, "user_id": 1987437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/508e14a7e9414311eff04b2fd8d20ed6?s=128&d=identicon&r=PG", "display_name": "Liam Kelly", "link": "https://stackoverflow.com/users/1987437/liam-kelly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 58189568, "answer_count": 2, "score": -5, "last_activity_date": 1569953653, "creation_date": 1569948377, "last_edit_date": 1569953653, "question_id": 58189164, "link": "https://stackoverflow.com/questions/58189164/what-is-the-default-browser-form-behavior-for-post-method", "title": "What is the default browser form behavior for POST method?", "body": "<p>Normally I use JSON API and SPA for when I make web apps, but I am trying to learn how to use the more simple method server-side templating and default form behavior with Go. </p>\n\n<p>I am doing something very similar to what is seen <a href=\"https://astaxie.gitbooks.io/build-web-application-with-golang/en/04.1.html\" rel=\"nofollow noreferrer\">here</a>. The only difference is that I changed the <code>action</code> to <code>\"/\"</code> in the form for simplicity and handle the GET and POST from the same Handler (filtering by method type).</p>\n\n<p>Server-Side Template </p>\n\n<pre><code>&lt;form action=\"/\" method=\"post\"   &gt;\n\n         ...\n\n        &lt;div class=\"form-group\"&gt;\n            &lt;label for=\"myname\"&gt;Dev Name&lt;/label&gt;\n            &lt;input type=\"text\" class=\"form-control\" id=\"myname\" name=\"myname\" value=\"{{.MyDname}}\"&gt;\n        &lt;/div&gt;\n\n        &lt;button type=\"submit\" class=\"btn btn-primary\"&gt;Update&lt;/button&gt;\n        &lt;/form&gt;\n</code></pre>\n\n<p>Server side </p>\n\n<pre><code>func MainPage(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"method:\", r.Method) //get request method\n    if r.Method == \"GET\" {\n        t, err := template.New(\"RTL Page\").Parse(page)\n        if err != nil {\n            log.Fatal(err)\n        }\n        err = t.Execute(w, State)\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n\n    if r.Method == http.MethodPost {\n        r.ParseForm()\n        ...\n    }\n}\n</code></pre>\n\n<p>The initial web page renders fine, the data gets sent correctly in a POST, I answer the POST with a just a 200 but then my webpage goes blank.</p>\n\n<p>How do I tell the browser to keep or rerender the original page? Do I need to send an HTML response to the POST? Something other than a 200?</p>\n"}, {"tags": ["mongodb", "go", "mongodb-replica-set"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1569994106, "post_id": 58188673, "comment_id": 102769768, "body": "Show us da codez! ;) Of special importance would be our code to initialize the replset."}], "owner": {"reputation": 3031, "user_id": 576488, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6394f70dd009d4d16bb2c969c82c2ff1?s=128&d=identicon&r=PG", "display_name": "SBSTP", "link": "https://stackoverflow.com/users/576488/sbstp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1569953800, "creation_date": 1569946004, "last_edit_date": 1569953800, "question_id": 58188673, "link": "https://stackoverflow.com/questions/58188673/cannot-connect-to-uninitialized-replica-set-with-the-go-driver", "title": "Cannot connect to uninitialized Replica Set with the Go driver", "body": "<p>I'm trying to connect to a member of a future replica set in order to initiate the replica set with <code>replSetInitiate</code> using the official Go mongodb driver (not mgo).</p>\n\n<p>I can connect fine to my instance using the mongodb shell but the same connection string does not work with the go driver. The go driver returns a server selection timeout.</p>\n\n<p>I tried setting the <code>Direct</code> parameter to true on the client options object but that gives me an unauthenticated error on the first command I try to run. Again, I have no issues with authentication in the mongodb shell, the authentication works properly.</p>\n\n<p>The connection string looks like <code>mongodb://admin:password@host</code>.</p>\n\n<p>It seems to me like the problem is that the go driver tries to connect to what should be a working replica set, but it hasn't been initialized yet. Is there a way of preventing this behavior of the Go mongodb driver?</p>\n"}, {"tags": ["go", "google-cloud-firestore"], "comments": [{"owner": {"reputation": 47877, "user_id": 414062, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/xc7mu.jpg?s=128&g=1", "display_name": "Dominic", "link": "https://stackoverflow.com/users/414062/dominic"}, "edited": false, "score": 0, "creation_date": 1569945510, "post_id": 58188438, "comment_id": 102756762, "body": "I don&#39;t think you can check length, you might have to store the length as a separate field"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1569947414, "post_id": 58188438, "comment_id": 102757623, "body": "If customer_id is stored as an integer, then use an integer value in the condition: <code>Where(&quot;customer_id&quot;, &quot;&lt;&quot;, 10000)</code>"}, {"owner": {"reputation": 89473, "user_id": 5246885, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/Bxclj.jpg?s=128&g=1", "display_name": "Alex Mamo", "link": "https://stackoverflow.com/users/5246885/alex-mamo"}, "edited": false, "score": 0, "creation_date": 1570003246, "post_id": 58188438, "comment_id": 102773125, "body": "Please add your database structure as a screenshot."}], "answers": [{"comments": [{"owner": {"reputation": 7437, "user_id": 375721, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/nosh5.png?s=128&g=1", "display_name": "martins", "link": "https://stackoverflow.com/users/375721/martins"}, "edited": false, "score": 0, "creation_date": 1570000304, "post_id": 58189014, "comment_id": 102771816, "body": "Thanks for the suggestion. I actually found that doc myself and tried what you suggested. It doesn&#39;t return anything. I think it&#39;s because customer_id is a string in Firestore. If I could cast it to an int it might work, but I haven&#39;t found out how to do that yet."}], "tags": [], "owner": {"reputation": 493, "user_id": 8364553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d203cf51ae3926dca4c2c3afcf24948?s=128&d=identicon&r=PG&f=1", "display_name": "p1gd0g", "link": "https://stackoverflow.com/users/8364553/p1gd0g"}, "is_accepted": false, "score": 1, "last_activity_date": 1569947676, "creation_date": 1569947676, "answer_id": 58189014, "question_id": 58188438, "link": "https://stackoverflow.com/questions/58188438/make-firestore-only-return-users-with-customer-id-that-is-less-than-1000/58189014#58189014", "title": "Make Firestore only return users with customer_id that is less than 1000", "body": "<p>Not a firestore user, but I found some info from <a href=\"https://cloud.google.com/firestore/docs/query-data/queries\" rel=\"nofollow noreferrer\">https://cloud.google.com/firestore/docs/query-data/queries</a>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>countryQuery := cities.Where(\"state\", \"==\", \"CA\")\npopQuery := cities.Where(\"population\", \"&lt;\", 1000000)\ncityQuery := cities.Where(\"name\", \"&gt;=\", \"San Francisco\")\n</code></pre>\n\n<p>So I think you should just try:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>iter := client.Collection(\"users\").Where(\"customer_id\", \"&lt;\", 10000).Documents(ctx)\n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2417, "user_id": 4037220, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JYTuqJ0lf0w/AAAAAAAAAAI/AAAAAAAAAEw/irO6eSzV15Q/photo.jpg?sz=128", "display_name": "Andrei Cusnir", "link": "https://stackoverflow.com/users/4037220/andrei-cusnir"}, "is_accepted": false, "score": 0, "last_activity_date": 1570608780, "creation_date": 1570608780, "answer_id": 58299750, "question_id": 58188438, "link": "https://stackoverflow.com/questions/58188438/make-firestore-only-return-users-with-customer-id-that-is-less-than-1000/58299750#58299750", "title": "Make Firestore only return users with customer_id that is less than 1000", "body": "<p>The reason for this to happen is because you are having the filed set as \"string\" instead of \"number\". I had replicated the use case scenario and those are my findings:</p>\n\n<p>My Firestore database:</p>\n\n<pre><code>collection: users\n&gt;&gt; document: \"auto_id\"\n   --customer_id: 111\n&gt;&gt; document: \"auto_id\"\n   --customer_id: 123\n&gt;&gt; document: \"auto_id\"\n   --customer_id: 4500\n&gt;&gt; document: \"auto_id\"\n   --customer_id: 3500\n</code></pre>\n\n<p>I have setup in Firestore each <code>customer_id</code> as string. Then when using method <code>Where(\"customer_id\", \"==\", \"111\")</code> will give me <code>map[customer_id:111]</code> but when using <code>Where(\"customer_id\", \"&lt;\", \"1000\")</code> or <code>Where(\"customer_id\", \"&lt;\", 1000)</code> will give me nothing as you described.</p>\n\n<p>Then I went to Firestore and changed the type of each filed from <code>string</code> to <code>number</code> and executed the code again, so I got:</p>\n\n<pre><code> map[customer_id:111]\n map[customer_id:123]\n</code></pre>\n\n<p>My <a href=\"https://github.com/andrikosrikos/Google-Cloud-Support/blob/master/Firestore/GO/load_users_with_id_less_than_1000.go\" rel=\"nofollow noreferrer\">full code example in GitHub</a> that worked for me.</p>\n"}], "owner": {"reputation": 7437, "user_id": 375721, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/nosh5.png?s=128&g=1", "display_name": "martins", "link": "https://stackoverflow.com/users/375721/martins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1570608780, "creation_date": 1569945187, "last_edit_date": 1569998598, "question_id": 58188438, "link": "https://stackoverflow.com/questions/58188438/make-firestore-only-return-users-with-customer-id-that-is-less-than-1000", "title": "Make Firestore only return users with customer_id that is less than 1000", "body": "<p>How do I extract the users in my db that has a customer_id with less than 8 digits?</p>\n\n<p>I tried to do this:</p>\n\n<p><code>iter := client.Collection(\"users\").Where(\"customer_id\", \"&lt;\", \"10000\").Documents(ctx)</code></p>\n\n<p>But that doesn't return anything, even though I know I have users that looks like this:</p>\n\n<pre><code> map[customer_id:111]\n map[customer_id:123]\n</code></pre>\n\n<p>If I however do</p>\n\n<pre><code>iter := client.Collection(\"users\").Where(\"customer_id\", \"==\", \"111\").Documents(ctx)\n</code></pre>\n\n<p>.. it will find that document,</p>\n\n<p>EDIT: I just noticed that customer_id is stored as a string. </p>\n"}, {"tags": ["go", "proxysql"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 9889043, "user_type": "registered", "profile_image": "https://graph.facebook.com/830458453822182/picture?type=large", "display_name": "Bob Kreitz", "link": "https://stackoverflow.com/users/9889043/bob-kreitz"}, "edited": false, "score": 0, "creation_date": 1569952613, "post_id": 58189291, "comment_id": 102759593, "body": "We are trying the Tx.Exec as stated above. It works for queries but does not allow the use of the USE db; statement  We also tried &quot;select id from database1.user_id&quot; which works on the connection to ProxySQL from a linux mysql prompt, but doesnt work in GO Drivers"}, {"owner": {"reputation": 493, "user_id": 8364553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d203cf51ae3926dca4c2c3afcf24948?s=128&d=identicon&r=PG&f=1", "display_name": "p1gd0g", "link": "https://stackoverflow.com/users/8364553/p1gd0g"}, "reply_to_user": {"reputation": 41, "user_id": 9889043, "user_type": "registered", "profile_image": "https://graph.facebook.com/830458453822182/picture?type=large", "display_name": "Bob Kreitz", "link": "https://stackoverflow.com/users/9889043/bob-kreitz"}, "edited": false, "score": 0, "creation_date": 1570026584, "post_id": 58189291, "comment_id": 102785353, "body": "@BobKreitz How about creating two sql handlers in go? Sorry I am not totally clear about what you want."}], "tags": [], "owner": {"reputation": 493, "user_id": 8364553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d203cf51ae3926dca4c2c3afcf24948?s=128&d=identicon&r=PG&f=1", "display_name": "p1gd0g", "link": "https://stackoverflow.com/users/8364553/p1gd0g"}, "is_accepted": false, "score": 0, "last_activity_date": 1569949057, "creation_date": 1569949057, "answer_id": 58189291, "question_id": 58188344, "link": "https://stackoverflow.com/questions/58188344/golang-mysql-driver-does-not-allow-database-changes-with-proxysql/58189291#58189291", "title": "Golang MySQL Driver does not allow database changes with ProxySQL", "body": "<p>I found some infos from golang official documents <a href=\"https://golang.google.cn/pkg/database/sql/#Tx.Exec\" rel=\"nofollow noreferrer\">https://golang.google.cn/pkg/database/sql/#Tx.Exec</a>:</p>\n\n<pre><code>func (*Tx) Exec\nfunc (tx *Tx) Exec(query string, args ...interface{}) (Result, error)\nExec executes a query that doesn't return rows. For example: an INSERT and UPDATE.\n</code></pre>\n\n<p>Maybe you should use another method <code>func (db *DB) Prepare(query string) (*Stmt, error)</code>, good luck.</p>\n"}, {"tags": [], "owner": {"reputation": 477, "user_id": 4307308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2e92a176f0167f47c4a53962ee2b1ae?s=128&d=identicon&r=PG", "display_name": "common-nighthawk", "link": "https://stackoverflow.com/users/4307308/common-nighthawk"}, "is_accepted": false, "score": 0, "last_activity_date": 1603475785, "creation_date": 1603475785, "answer_id": 64505098, "question_id": 58188344, "link": "https://stackoverflow.com/questions/58188344/golang-mysql-driver-does-not-allow-database-changes-with-proxysql/64505098#64505098", "title": "Golang MySQL Driver does not allow database changes with ProxySQL", "body": "<p>For reasons I don't completely understand around how ProxySQL disables multiplexing and the interplay with USE statements, transactions don't seem to work nicely here.</p>\n<p>I had success using Connections to ensure statements are executed on the correct database.</p>\n<pre><code>conn, err := db.Conn(ctx)\nconn.Exec(&quot;use database1&quot;)\nconn.Exec(&quot;select id from users where user_id=1;&quot;)\nconn.Exec(&quot;use database2&quot;)\nconn.Exec(&quot;select id from posts where user_id=1;&quot;)\nconn.Close()\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 9889043, "user_type": "registered", "profile_image": "https://graph.facebook.com/830458453822182/picture?type=large", "display_name": "Bob Kreitz", "link": "https://stackoverflow.com/users/9889043/bob-kreitz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 216, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1603475785, "creation_date": 1569944863, "question_id": 58188344, "link": "https://stackoverflow.com/questions/58188344/golang-mysql-driver-does-not-allow-database-changes-with-proxysql", "title": "Golang MySQL Driver does not allow database changes with ProxySQL", "body": "<p>We are trying to use GO to create a web app that connects to ProxySQL, which will in turn connect to the various MySQL database servers based on MySQL query rules that are set in ProxySQL.</p>\n\n<p>We can connect to ProxySQL via command line in linux and everything works as expected:</p>\n\n<pre><code>    use database1;\n    select id from users where user_id=1;\n    use database2;\n    select id from posts where user_id=1;\n</code></pre>\n\n<p>The above databases are located on physically different servers. Rules in ProxySQL know how to route them.</p>\n\n<p>While connected to ProxySQL, the rules work fine and we are connected to the correct database servers and the requests are processed as expected.</p>\n\n<p>When we try the same thing with GO and transactions, we cannot switch the databases as the it returns that the database does not exist.</p>\n\n<p>The database exists on the back end servers, which ProxySQL will direct traffic to.</p>\n\n<p>For whatever reason, it works on a command line, but not in GO</p>\n\n<p>We can make it work if we connect with GO and specify the database on the connection, then disconnect and reconnect with a new database connection.</p>\n\n<p>We are trying to use connection pool so we don't waste the time in opening and closing the connections.</p>\n\n<pre><code>    //open the connection to ProxySQL\n\n    db, err = sql.Open(\"mysql\", \"user:password@tcp(x.x.x.x:6033)/\")\n\n    //The above only allows us to stay on the default database for the user\n\n    //in order to access each of the databases we would need to open a\n    //connection to database1 then open another connection to database2\n    //which defeats the whole purpose of connection pooling.\n\n    db, err = sql.Open(\"mysql\", \"user:password@tcp(x.x.x.x:6033)/database1\")\n    ... do something...\n\n    db, err = sql.Open(\"mysql\", \"user:password@tcp(x.x.x.x:6033)/database2\")\n    ... do something ...\n\n\n\n    //code below is an example of what is not working but works from\n    //command line in linux. Results are not processed below because we\n    //cannot get past the first error of no database\n    tx, err := db.Begin()\n    res, err := tx.Exec(\"use database1\")\n    res, err = tx.Exec(\"select id from users where user_id=1;\")\n    res, err = tx.Exec(\"use database2\")\n    res, err = tx.Exec(\"select id from posts where user_id=1;\")\n    tx.Commit()\n</code></pre>\n\n<p>ProxySQL knows how to route properly, but we cannot seem to get the functions working correctly in GOLANG</p>\n"}, {"tags": ["go", "google-cloud-firestore"], "comments": [{"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1569942628, "post_id": 58187520, "comment_id": 102755241, "body": "What is client? Which library are you using to access it? You cannot access <code>documentID</code> because it is not an exported member (starts with lowercase letter); can you try using <code>doc.DocumentID</code>?"}, {"owner": {"reputation": 7437, "user_id": 375721, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/nosh5.png?s=128&g=1", "display_name": "martins", "link": "https://stackoverflow.com/users/375721/martins"}, "reply_to_user": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1569943720, "post_id": 58187520, "comment_id": 102755832, "body": "<code>client</code> added to the original post. According to this doc, documentID is with a small &#39;d&#39;. <a href=\"https://pub.dev/documentation/cloud_firestore/latest/cloud_firestore/DocumentSnapshot-class.html\" rel=\"nofollow noreferrer\">pub.dev/documentation/cloud_firestore/latest/cloud_firestore&zwnj;&#8203;/&hellip;</a>"}, {"owner": {"reputation": 7437, "user_id": 375721, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/nosh5.png?s=128&g=1", "display_name": "martins", "link": "https://stackoverflow.com/users/375721/martins"}, "reply_to_user": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1569944110, "post_id": 58187520, "comment_id": 102756056, "body": "I&#39;ve also tried with <code>doc.DocumentID</code> ,  <code>doc.DocumentId</code> and different casing."}], "answers": [{"comments": [{"owner": {"reputation": 509, "user_id": 11073131, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NvFpu4uUg6A/AAAAAAAAAAI/AAAAAAAAAOw/MYnlw0Rtjqk/photo.jpg?sz=128", "display_name": "Ueda Takeyuki", "link": "https://stackoverflow.com/users/11073131/ueda-takeyuki"}, "edited": false, "score": 0, "creation_date": 1612834937, "post_id": 58188325, "comment_id": 116885192, "body": "Where can I refer <code>DocumentSnapshot</code> on godoc?"}], "tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": true, "score": 2, "last_activity_date": 1569945156, "last_edit_date": 1569945156, "creation_date": 1569944772, "answer_id": 58188325, "question_id": 58187520, "link": "https://stackoverflow.com/questions/58187520/how-do-i-get-the-id-of-a-firestore-document/58188325#58188325", "title": "How do I get the ID of a Firestore document?", "body": "<p>The Go documentation is on <a href=\"https://godoc.org/cloud.google.com/go/firestore\" rel=\"nofollow noreferrer\">godoc.org</a>.</p>\n\n<p>In your line <code>doc, err := iter.Next()</code> you get a <a href=\"https://godoc.org/cloud.google.com/go/firestore#DocumentSnapshot\" rel=\"nofollow noreferrer\"><code>*DocumentSnapshot</code></a>. It has a field called <code>Ref</code> which is a <a href=\"https://godoc.org/cloud.google.com/go/firestore#DocumentRef\" rel=\"nofollow noreferrer\"><code>*DocumentRef</code></a>. Its field <code>ID</code> is, according to the documentation: </p>\n\n<pre><code>// The ID of the document: the last component of the resource path.\nID  string\n</code></pre>\n\n<p>So to access the ID in your code, you probably need to use </p>\n\n<pre><code>doc.Ref.ID\n</code></pre>\n"}], "owner": {"reputation": 7437, "user_id": 375721, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/nosh5.png?s=128&g=1", "display_name": "martins", "link": "https://stackoverflow.com/users/375721/martins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1047, "favorite_count": 0, "accepted_answer_id": 58188325, "answer_count": 1, "score": 0, "last_activity_date": 1569945156, "creation_date": 1569941825, "last_edit_date": 1569944045, "question_id": 58187520, "link": "https://stackoverflow.com/questions/58187520/how-do-i-get-the-id-of-a-firestore-document", "title": "How do I get the ID of a Firestore document?", "body": "<p>I'm iterating over my user documents in Firestore, but I'm not able to see the ID of the document I'm currently reading.</p>\n\n<pre><code>  package main\n\n  import (\n    \"context\"\n    firebase \"firebase.google.com/go\"\n    \"fmt\"\n    \"google.golang.org/api/iterator\"\n    \"google.golang.org/api/option\"\n    \"log\"\n  )\n\n   ctx := context.Background()\n   sa := option.WithCredentialsFile(\"cert.json\")\n   app, err := firebase.NewApp(ctx, nil, sa)\n   client, err := app.Firestore(ctx)\n\n   iter := client.Collection(\"users\").Documents(ctx)\n   for {\n     doc, err := iter.Next()\n     if err == iterator.Done {\n       break\n     }\n     if err != nil {\n       fmt.Println(\"Error:\", err)\n     }\n\n    userDoc := doc.Data()\n    var customer_id string\n    fmt.Println(\"user object ID: \", userDoc[\"mobile_number\"])\n    // ^ Works\n\n    fmt.Println(\"user object ID: \", doc.documentID)\n    // ^ This gives me this error \"\u276f doc.documentID undefined \n    // (type *\"cloud.google.com/go/firestore\".DocumentSnapshot\n    // has no field or method documentID)\"\n</code></pre>\n\n<p>As far as I can <a href=\"https://pub.dev/documentation/cloud_firestore/latest/cloud_firestore/DocumentSnapshot-class.html\" rel=\"nofollow noreferrer\">read from the docs</a> a DocumentSnapshot should have a <code>documentID</code> property that\nreturns the ID of the snapshot's document.</p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["c", "go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1569981387, "last_edit_date": 1569981387, "creation_date": 1569942017, "answer_id": 58187584, "question_id": 58187124, "link": "https://stackoverflow.com/questions/58187124/cgo-segfault-when-returning-c-cstring/58187584#58187584", "title": "CGo segfault when returning C.CString", "body": "<blockquote>\n  <p>I am trying to call a Go function from C code.</p>\n</blockquote>\n\n<p>What exactly is your issue?</p>\n\n<hr>\n\n<p>For example, this works,</p>\n\n<p>Output:</p>\n\n<pre><code>$ go version\ngo version devel +5e514b76e2 Tue Oct 1 00:02:11 2019 +0000 linux/amd64\n$ gcc --version\ngcc (Ubuntu 7.4.0-1ubuntu1~18.04.1) 7.4.0\n$ go build -buildmode=c-archive -o cstr.a cstr.go\n$ gcc -pthread -o cstr cstr.c cstr.a\n$ ./cstr\nret = 0x5600ca344390\nwhatever\n$ echo $?\n0\n$ \n</code></pre>\n\n<p><code>cstr.go</code>:</p>\n\n<pre><code>package main\n\n/*\n */\nimport \"C\"\n\n//export CheckDpkgInfo\nfunc CheckDpkgInfo() *C.char {\n    return C.CString(\"whatever\")\n}\n\nfunc main() {}\n</code></pre>\n\n<p><code>cstr.c</code>:</p>\n\n<pre><code>#include \"cstr.h\"\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\nint main() {\n    char * ret = CheckDpkgInfo();\n    printf(\"ret = %p\\n\", ret);\n    if (!ret) {\n        return 1;\n    }\n    printf(\"%s\\n\", ret);\n    free(ret);\n    return 0;\n}\n</code></pre>\n\n<hr>\n\n<p>Reference: <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">Command cgo</a></p>\n\n<hr>\n\n<p><strong>Solution:</strong></p>\n\n<p>Comment: Even the minimal example caused a segfault, but it was due to the fact that I build the application in a Docker container, while preparing the c-archive outside. So it came down to a compatibility issue. \u2013 <a href=\"https://stackoverflow.com/users/8139532/gbatt\">gbatt</a></p>\n"}], "owner": {"reputation": 53, "user_id": 8139532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/187d3b35488579d0afdca17a53da009f?s=128&d=identicon&r=PG&f=1", "display_name": "gbatt", "link": "https://stackoverflow.com/users/8139532/gbatt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1569981435, "creation_date": 1569940485, "last_edit_date": 1569981435, "question_id": 58187124, "link": "https://stackoverflow.com/questions/58187124/cgo-segfault-when-returning-c-cstring", "title": "CGo segfault when returning C.CString", "body": "<p>I am trying to call a Go function from C code, but I encountered a issue which I can't really explain:</p>\n\n<p>C:</p>\n\n<pre><code>char * ret; \nCheckDpkgInfo(&amp;ret);\nprintf(\"%s\", ret);\n</code></pre>\n\n<p>Go:</p>\n\n<pre><code>func CheckDpkgInfo(dpkg_c **C.char) { \n*dpkg_c = C.CString(\"whatever\")\n}\n</code></pre>\n\n<p>This works, but not when I simply return a c string from Go (segfault):</p>\n\n<p>C:</p>\n\n<pre><code>char * ret = CheckDpkgInfo();\nprintf(\"%s\", ret);\n</code></pre>\n\n<p>Go:</p>\n\n<pre><code>func CheckDpkgInfo() *C.char { \nreturn C.CString(\"whatever\") \n}\n</code></pre>\n\n<p>If I understood the documentation correctly CString should call malloc, therefore I really don't get why the printf segfaults. Thanks!</p>\n"}, {"tags": ["pointers", "go", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1569940531, "post_id": 58186719, "comment_id": 102753934, "body": "Why don&#39;t use use plain fields instead of pointer fields? Is that a requirement? If there&#39;s one thing unconventional here then that would be it."}, {"owner": {"reputation": 492, "user_id": 8035443, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rOKW6.jpg?s=128&g=1", "display_name": "Jerlam", "link": "https://stackoverflow.com/users/8035443/jerlam"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1569940842, "post_id": 58186719, "comment_id": 102754138, "body": "@mkopriva, you mean <code>Name string</code> instead of <code>Name *string</code> in my Gorm User struct? I thought that using pointers there is actually conventional, because it avoids confusion when a field is empty and that it returns a value anyway"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1569941163, "post_id": 58186719, "comment_id": 102754353, "body": "Yes that is what I mean. Well you would have to clarify what the actual confusion is in that <i>specific case</i>, i.e. a user with name <code>&quot;&quot;</code> and a user with name <code>nil</code>, both indicate a user with <i>no name</i>, there is no confusion, it&#39;s just that one is more difficult to use then the other, right? There are legitimate cases where <code>&quot;&quot;</code> is semantically not the same as <code>nil</code>, however there is less of those cases then cases where those two can be considered the same, in my opinion."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1569941324, "post_id": 58186719, "comment_id": 102754456, "body": "You say &quot;but it is very annoying if I want to read this [pointer] data&quot;. Why? Reading the value from a *string is dead simple like <code>*Nickname</code>. What is annyoing here?"}, {"owner": {"reputation": 492, "user_id": 8035443, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rOKW6.jpg?s=128&g=1", "display_name": "Jerlam", "link": "https://stackoverflow.com/users/8035443/jerlam"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1569941746, "post_id": 58186719, "comment_id": 102754718, "body": "@Volker, by &quot;this data&quot; I meant &quot;this struct&quot;, I agree that reading one piece of data is simple"}], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 8605429, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e0efdbe758e69dc351b92d1c255a853?s=128&d=identicon&r=PG", "display_name": "Matjam", "link": "https://stackoverflow.com/users/8605429/matjam"}, "is_accepted": false, "score": 0, "last_activity_date": 1570562569, "creation_date": 1570562569, "answer_id": 58292808, "question_id": 58186719, "link": "https://stackoverflow.com/questions/58186719/manipulate-struct-with-pointers-queried-from-gorm-in-go/58292808#58292808", "title": "Manipulate struct with pointers queried from Gorm in Go?", "body": "<p>You need to use sql.NullString for string pointer types.</p>\n\n<p>Please see <a href=\"https://golang.org/pkg/database/sql/#NullString\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/#NullString</a></p>\n\n<p>Specifically one uses sql null types where it makes sense for there to be a concept of \"no valid value for this field\".</p>\n"}], "owner": {"reputation": 492, "user_id": 8035443, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rOKW6.jpg?s=128&g=1", "display_name": "Jerlam", "link": "https://stackoverflow.com/users/8035443/jerlam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 603, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1570562569, "creation_date": 1569939283, "last_edit_date": 1569942086, "question_id": 58186719, "link": "https://stackoverflow.com/questions/58186719/manipulate-struct-with-pointers-queried-from-gorm-in-go", "title": "Manipulate struct with pointers queried from Gorm in Go?", "body": "<p>I am practicing by developing a web server written in Go, using Gqlgen and Gorm (postgres dialect). </p>\n\n<p>I started by describing the model of my User:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code># dbm.User{}\n\ntype User struct {\n    BaseModel      \n    Email       string  `gorm:\"not null;unique_index:idx_email\"`\n    UserID      *string // External user ID\n    Name        *string\n    NickName    *string\n    FirstName   *string\n    LastName    *string\n    Location    *string `gorm:\"size:1048\"`\n    Description *string `gorm:\"size:1048\"`\n}\n</code></pre>\n\n<p>In this case, from what I understand, it is nice to use pointers for certain values in my struct because they can evaluate to <code>&lt;nil&gt;</code> when there is no value attached to it. Whereas if I use no pointers, an int will be 0 if no value is attached to it. Alright, this makes sense...if I am not wrong...</p>\n\n<p>However, the difficulty that I face now, is when getting this value out of a Gorm operation on the DB:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>dbRecord := &amp;dbm.User{}\n\ndb = db.Where(whereEmail, email).Find(&amp;dbRecord)\nfmt.Println(\"dbRecord:\", dbRecord)\n// Prints:\n// dbRecord: &amp;{{def90b3c-93ff-40f0-8d33-6320dddbe3f2 2019-10-01 14:16:34.365395 +0200 CEST 2019-10-01 14:16:34.365395 +0200 CEST} test@test.com &lt;nil&gt; 0xc0000a1cb0 0xc0000a1cd0 0xc0000a1cc0 &lt;nil&gt; 0xc0000a1cf0 0xc0000a1ce0}\n</code></pre>\n\n<p>This code queries a User where email is \"email@email.com\", and obviously some fields in the struct point to the actual address of the value. This makes sense, but it is very annoying if I want to read this data. Is there a conventional way of reading this data?</p>\n\n<p>What I tried is to is to convert this struct into a GQL struct (which was autogenerated by GQLgen):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code># gqlm.User{}\n\ntype User struct {\n    ID          string     `json:\"id\"`\n    Email       string     `json:\"email\"`\n    UserID      *string    `json:\"userId\"`\n    Name        *string    `json:\"name\"`\n    FirstName   *string    `json:\"firstName\"`\n    LastName    *string    `json:\"lastName\"`\n    NickName    *string    `json:\"nickName\"`\n    Description *string    `json:\"description\"`\n    Location    *string    `json:\"location\"`\n    CreatedAt   time.Time  `json:\"createdAt\"`\n    UpdatedAt   *time.Time `json:\"updatedAt\"`\n}\n</code></pre>\n\n<p>But again, I get the addresses when I want the values, which makes sense.</p>\n\n<p>So the only way I found is to create a new custom struct customUser, Marshal the data from Gorm, then Unmarshal it into my customUser struct:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type customUser struct {\n    ID          string    `json:\"id\"`\n    Email       string    `json:\"email\"`\n    UserID      string    `json:\"userId\"`\n    Name        string    `json:\"name\"`\n    FirstName   string    `json:\"firstName\"`\n    LastName    string    `json:\"lastName\"`\n    NickName    string    `json:\"nickName\"`\n    Description string    `json:\"description\"`\n    Location    string    `json:\"location\"`\n    CreatedAt   time.Time `json:\"createdAt\"`\n    UpdatedAt   time.Time `json:\"updatedAt\"`\n}\n\nbs, _ := json.Marshal(record)\nvar s = string(bs)\n\nnewRecord := &amp;customUser{}\nbs = []byte(s) // This is maybe not necessary\n\nerr = json.Unmarshal(bs, newRecord)\nif err != nil {\n   fmt.Println(err)\n}\n\nfmt.Printf(\"record: %+v\\n\", newRecord)\n// I now get the right format: record: &amp;{ID:def90b3c-93ff-40f0-8d33-6320dddbe3f2 Email:test@test.com UserID: Name:frer FirstName:fwef LastName: NickName:trgt Description:werfergh rthrt hr Location:wfwf CreatedAt:2019-10-01 14:16:34.365395 +0200 CEST UpdatedAt:2019-10-01 14:16:34.365395 +0200 CEST}\n</code></pre>\n\n<p>But this seems so overkilled, and lots of effort if I need to create such struct everytime I need to read data from the DB. Is this the way to go? Or do you know a more convenient way?</p>\n"}, {"tags": ["rest", "go", "routes", "middleware", "go-echo"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1569937820, "post_id": 58186129, "comment_id": 102752168, "body": "Files are not importable, in Go you can only import packages. And also do not use relative imports. I would suggest you follow the recommendations from here: <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a>"}, {"owner": {"reputation": 688, "user_id": 6514473, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a62f2ab2989cbdd4826313c3cb8e3334?s=128&d=identicon&r=PG", "display_name": "Valorad", "link": "https://stackoverflow.com/users/6514473/valorad"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1569938142, "post_id": 58186129, "comment_id": 102752362, "body": "@mkopriva Here <code>api.go</code> is included in the package: <code>package API</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1569938321, "post_id": 58186129, "comment_id": 102752472, "body": "I would also suggest you consider renaming your package (<a href=\"https://golang.org/doc/effective_go.html#package-names\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#package-names</a>). That said, you can declare a function in your <code>API</code> package that takes <code>*echo.Echo</code> as its argument and does all the route-to-handler registering."}, {"owner": {"reputation": 688, "user_id": 6514473, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a62f2ab2989cbdd4826313c3cb8e3334?s=128&d=identicon&r=PG", "display_name": "Valorad", "link": "https://stackoverflow.com/users/6514473/valorad"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570073548, "post_id": 58186129, "comment_id": 102800946, "body": "About package, I moved the source code to <code>src&#47;</code>, ran <code>go mod init</code>, upload to Github, then I could use a canonical name starting with <code>github.com&#47;username&#47;myapp&#47;API</code>. This feels terrible and very unnatural IMO, but this is Go, isn&#39;t it lol."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1570083027, "post_id": 58186129, "comment_id": 102803058, "body": "with <code>go mod</code> <i>it is not</i> necessary to have your package in <code>src&#47;</code>, without <code>go mod</code> <i>it is</i> necessary that your package is located in <code>$GOPATH&#47;src</code>, however <i>it is not</i> necessary to upload your package to github. And also, although it is a convention when using GOPATH, <i>it is not</i> necessary that your package is located in <code>$GOPATH&#47;src&#47;github.com&#47;user&#47;repo</code>, something like <code>$GOPATH&#47;src&#47;api</code> and then <code>import &quot;api&quot;</code> will work as well."}], "answers": [{"comments": [{"owner": {"reputation": 688, "user_id": 6514473, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a62f2ab2989cbdd4826313c3cb8e3334?s=128&d=identicon&r=PG", "display_name": "Valorad", "link": "https://stackoverflow.com/users/6514473/valorad"}, "edited": false, "score": 0, "creation_date": 1570073149, "post_id": 58186683, "comment_id": 102800887, "body": "Thanks. This works for now. There is still a problem though when trying to achieve the same to <code>&#47;api&#47;user&#47;xxx</code>. After all, it would be ugly to write <code>func UseSubroute()</code> in every sub-route file."}], "tags": [], "owner": {"reputation": 56, "user_id": 7983620, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CFMJrLMQr4k/AAAAAAAAAAI/AAAAAAAAABU/qO88AmVDH_w/photo.jpg?sz=128", "display_name": "Artikell", "link": "https://stackoverflow.com/users/7983620/artikell"}, "is_accepted": true, "score": 1, "last_activity_date": 1570621053, "last_edit_date": 1570621053, "creation_date": 1569939178, "answer_id": 58186683, "question_id": 58186129, "link": "https://stackoverflow.com/questions/58186129/how-to-import-sub-routes-from-other-packages/58186683#58186683", "title": "How to import sub-routes from other packages", "body": "<p>The Echo object does not have this method. I think you need the code?</p>\n\n<p>API.go:</p>\n\n<pre><code>package main\n\nimport \"github.com/labstack/echo\"\n\nfunc UseSubroute(echo *echo.Echo)  {\n    echo.GET(\"/api\", sayHello)\n    echo.GET(\"/api/music\", getMusic)\n    echo.GET(\"/api/user/:id\", getDetail)\n    echo.POST(\"/api/user\", addUser)\n}\n</code></pre>\n\n<p>main.go:</p>\n\n<pre><code>package main\n\nimport \"github.com/labstack/echo\"\n\nfunc main() {\n    e := echo.New()\n    UseSubroute(e)\n}\n</code></pre>\n\n<p>These two files need to be placed in the same directory.</p>\n\n<p>Do you need it?</p>\n"}, {"tags": [], "owner": {"reputation": 319, "user_id": 7616247, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-31aFbdT1DIk/AAAAAAAAAAI/AAAAAAAAABQ/uL2uRsjTbKg/photo.jpg?sz=128", "display_name": "Andy", "link": "https://stackoverflow.com/users/7616247/andy"}, "is_accepted": false, "score": 3, "last_activity_date": 1572474418, "creation_date": 1572474418, "answer_id": 58634457, "question_id": 58186129, "link": "https://stackoverflow.com/questions/58186129/how-to-import-sub-routes-from-other-packages/58634457#58634457", "title": "How to import sub-routes from other packages", "body": "<p>What you can do is use the <code>echo.Group</code> and pass it to the <code>api</code> package, and initialize the routes handler there.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package api\n\nimport (\n    \"github.com/labstack/echo\"\n)\n\nfunc UseSubroute(group *echo.Group)  {\n    group.GET(\"/\", sayHello)\n    group.GET(\"/music\", getMusic)\n    group.GET(\"/user/:id\", getDetail)\n    group.POST(\"/user\", addUser)\n}\n</code></pre>\n\n<p>and in the main you can just import your <code>api</code> package.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"github.com/labstack/echo\"\n    \"your-repo/path-to/api\" // your api package\n)\n\nfunc main() {\n    e := echo.New()\n    apiGroup := e.Group(\"/api\")\n    api.UseSubroute(apiGroup)\n    // ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 688, "user_id": 6514473, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a62f2ab2989cbdd4826313c3cb8e3334?s=128&d=identicon&r=PG", "display_name": "Valorad", "link": "https://stackoverflow.com/users/6514473/valorad"}, "is_accepted": false, "score": 1, "last_activity_date": 1582417452, "last_edit_date": 1582417452, "creation_date": 1582394039, "answer_id": 60355080, "question_id": 58186129, "link": "https://stackoverflow.com/questions/58186129/how-to-import-sub-routes-from-other-packages/60355080#60355080", "title": "How to import sub-routes from other packages", "body": "<p>Based on @Andy 's idea, I come up with a solution, that supports detachable nested routes.</p>\n\n<p>The current folder structure is as follows:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 routes\n\u2502   \u251c\u2500\u2500 index.go\n\u2502   \u2514\u2500\u2500 music.go\n\u2514\u2500\u2500 server.go\n</code></pre>\n\n<p>...where <code>server.go</code> is the project main entry, belongs to the <code>main</code> package, while <code>index.go</code> and <code>music.go</code> belong to <code>routes</code> package.</p>\n\n<p>The endpoints are</p>\n\n<pre><code>\"/api\"       -&gt; index.go\n\"/api/music\" -&gt; music.go\n</code></pre>\n\n<p>First in <code>index.go</code> we define a function for using routes at this level.</p>\n\n<pre><code>func UseRoute(group *echo.Group, routes func(group *echo.Group)) {\n    routes(group)\n}\n</code></pre>\n\n<p>Then,</p>\n\n<p>in <code>server.go</code></p>\n\n<pre><code>func main() {\n    e := echo.New()\n    apiGroup := e.Group(\"/api\")\n    routes.ActivateIndex(mainGroup)\n}\n</code></pre>\n\n<p>in <code>index.go</code></p>\n\n<pre><code>var mainGroup *echo.Group\nfunc ActivateIndex(g *echo.Group) {\n    mainGroup = g\n    UseRoute(mainGroup, IndexRoutes)\n\n    // sub routes\n    musicGroup := mainGroup.Group(\"/music\")\n    ActivateMusic(musicGroup)\n}\n</code></pre>\n\n<p>and in <code>music.go</code></p>\n\n<pre><code>var musicGroup *echo.Group\nfunc ActivateMusic(g *echo.Group) {\n    musicGroup = g\n    UseRoute(musicGroup, MusicRoutes)\n}\n</code></pre>\n\n<p>Note: <code>IndexRoutes</code>, <code>MusicRoutes</code> etc. are functions that specify endpoints at this level.</p>\n\n<p>e.g.</p>\n\n<pre><code>func IndexRoutes(group *echo.Group) {\n    group.GET(\"/\", sayHello)\n    group.GET(\"/user/:id\", getDetail)\n    group.POST(\"/user\", addUser)\n}\n</code></pre>\n\n<p>In this way, the routes can be defined in different <code>.go</code> files, making the business logic clearer.</p>\n\n<p>For example, to extend the nested level, we can create another <code>ActivateHiphop</code> function in <code>hiphop.go</code>, also import the new sub-routes at <code>ActivateMusic</code> function from <code>music.go</code>, so that <code>\"/api/music/hiphop\"</code> can be pointed to <code>hiphop.go</code>.</p>\n\n<p>p.s. To add more routes in <code>/api</code> level, just create more endpoints in <code>IndexRoutes</code> function.</p>\n"}], "owner": {"reputation": 688, "user_id": 6514473, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a62f2ab2989cbdd4826313c3cb8e3334?s=128&d=identicon&r=PG", "display_name": "Valorad", "link": "https://stackoverflow.com/users/6514473/valorad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 684, "favorite_count": 0, "accepted_answer_id": 58186683, "answer_count": 3, "score": 1, "last_activity_date": 1582417452, "creation_date": 1569937396, "last_edit_date": 1569942165, "question_id": 58186129, "link": "https://stackoverflow.com/questions/58186129/how-to-import-sub-routes-from-other-packages", "title": "How to import sub-routes from other packages", "body": "<p>Instead of writing every route under main(), like</p>\n\n<pre><code>func main() {\n    e := echo.New()\n    e.GET(\"/api\", sayHello)\n    e.GET(\"/api/music\", getMusic)\n    e.GET(\"/api/user/:id\", getDetail)\n    e.POST(\"/api/user\", addUser)\n    // ...\n}\n</code></pre>\n\n<p>How can I import these all sub-routes from a file called <code>api.go</code>, and use those in the main function? Similar to</p>\n\n<pre><code>import \"./API\"\nfunc main() {\n    e := echo.New()\n    e.UseSubroute(API.Routes) // &lt;-- similar to this\n    // ...\n}\n</code></pre>\n"}, {"tags": ["pointers", "go", "struct", "slice"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1569937687, "creation_date": 1569937687, "answer_id": 58186222, "question_id": 58186111, "link": "https://stackoverflow.com/questions/58186111/initializing-slice-of-type-struct-in-golang/58186222#58186222", "title": "Initializing Slice of type Struct in Golang", "body": "<p>Use a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a> and take its address in the loop:</p>\n\n<pre><code>for i := range obj {\n    obj[i] = &amp;mystruct{Power: i}\n}\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/u-aGMA7TmUl\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 1776, "user_id": 4128489, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23520a568dcb0de9063d9c6f506efcc9?s=128&d=identicon&r=PG&f=1", "display_name": "Elie Asmar", "link": "https://stackoverflow.com/users/4128489/elie-asmar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1569937757, "creation_date": 1569937344, "last_edit_date": 1569937757, "question_id": 58186111, "link": "https://stackoverflow.com/questions/58186111/initializing-slice-of-type-struct-in-golang", "title": "Initializing Slice of type Struct in Golang", "body": "<p>I have the following structure in Golang    </p>\n\n<pre><code>type mystruct struct {\n        Name  string\n        Power int\n    }\n</code></pre>\n\n<p>My purpose is to write a function that takes as input a slice of type *mystuct and returns a slice of type int containing the \"Power\" property taken from the input slice.</p>\n\n<p>my code is presented below:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n)\nfunc main() {\n    obj := make([]*mystruct, 15)\n    for i, s := range obj {\n        s.Power = i\n    }\n    fmt.Println(extractpowers(obj))\n}\nfunc extractpowers(obj []*mystruct) []int {\n    powers := make([]int, len(obj))\n    for i, s := range obj {\n        powers[i] = s.Power\n    }\n    return powers\n\n} \n</code></pre>\n\n<p>My issue is that the <code>obj := make([]*mystruct, 15)</code> creates a slices of 15 *mystruc pointers initialized to nil; which causes the code within the for loop to raise a panic of type \"invalid memory or nil pointer dereference\".</p>\n\n<p>My question is what is the proper and fastest way to initialize the slice; (the equivalent of var lst = new List(Of mystruct) in .net)</p>\n\n<p>Regards.</p>\n"}, {"tags": ["xml", "go", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 1501, "user_id": 6414477, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6a2c251e715864f098ebf4b4057848b1?s=128&d=identicon&r=PG&f=1", "display_name": "rhillhouse", "link": "https://stackoverflow.com/users/6414477/rhillhouse"}, "edited": false, "score": 0, "creation_date": 1569926496, "post_id": 58182933, "comment_id": 102745925, "body": "Thanks! This is exactly what I was looking for. Just so that I&#39;m sure I understand: any XML field not explicitly defined in the struct, will be unmarshaled to <code>Entries</code> slice due to the <code>any</code> tag option?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1501, "user_id": 6414477, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6a2c251e715864f098ebf4b4057848b1?s=128&d=identicon&r=PG&f=1", "display_name": "rhillhouse", "link": "https://stackoverflow.com/users/6414477/rhillhouse"}, "edited": false, "score": 0, "creation_date": 1569926539, "post_id": 58182933, "comment_id": 102745947, "body": "@rhillhouse Yes, but as my last example shows, the tag name is available and you can simply filter out those you don&#39;t need."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1569927595, "last_edit_date": 1569927595, "creation_date": 1569925869, "answer_id": 58182933, "question_id": 58182643, "link": "https://stackoverflow.com/questions/58182643/xml-unmarshal-dynamic-response-with-indices-in-field-names/58182933#58182933", "title": "XML unmarshal dynamic response with indices in field names", "body": "<p>You may use a slice with the <code>,any</code> XML tag option to tell the <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow noreferrer\"><code>encoding/xml</code></a> package to put any XML tag into it. This is documented at <a href=\"https://golang.org/pkg/encoding/xml/#Unmarshal\" rel=\"nofollow noreferrer\"><code>xml.Unmarshal()</code></a>:</p>\n\n<blockquote>\n<pre><code>If the XML element contains a sub-element that hasn't matched any\n   of the above rules and the struct has a field with tag \",any\",\n   unmarshal maps the sub-element to that struct field.\n</code></pre>\n</blockquote>\n\n<p>For the <code>&lt;ifindexXX&gt;</code> tags use another struct which contains an <code>XMLName</code> field of type <a href=\"https://golang.org/pkg/encoding/xml/#Name\" rel=\"nofollow noreferrer\"><code>xml.Name</code></a> so the actual field name will be available if you need to filter only fields that start with <code>ifindex</code>.</p>\n\n<p>Let's parse the following XML:</p>\n\n<pre><code>&lt;root&gt;\n    &lt;nic_cnt&gt;2&lt;/nic_cnt&gt;\n    &lt;ifindex1&gt;eno1&lt;/ifindex1&gt;\n    &lt;ifindex2&gt;eno2&lt;/ifindex2&gt;\n&lt;/root&gt;\n</code></pre>\n\n<p>We can model it with:</p>\n\n<pre><code>type Root struct {\n    NicCnt  int     `xml:\"nic_cnt\"`\n    Entries []Entry `xml:\",any\"`\n}\n\ntype Entry struct {\n    XMLName xml.Name\n    Value   string `xml:\",innerxml\"`\n}\n</code></pre>\n\n<p>Example code parsing it:</p>\n\n<pre><code>var root Root\nif err := xml.Unmarshal([]byte(src), &amp;root); err != nil {\n    panic(err)\n}\nfmt.Printf(\"%+v\", root)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/noS5n6PgSig\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{NicCnt:2 Entries:[\n    {XMLName:{Space: Local:ifindex1} Value:eno1}\n    {XMLName:{Space: Local:ifindex2} Value:eno2}]}\n</code></pre>\n\n<p>Note that <code>Root.Entries</code> will also contain other unmapped XML tags. If you only care about tags that start with <code>ifindex</code>, this is how you can \"filter\" them:</p>\n\n<pre><code>for _, e := range root.Entries {\n    if strings.HasPrefix(e.XMLName.Local, \"ifindex\") {\n        fmt.Println(e.XMLName.Local, \":\", e.Value)\n    }\n}\n</code></pre>\n\n<p>If the XML also contains an additional tag:</p>\n\n<pre><code>&lt;other&gt;something else&lt;/other&gt;\n</code></pre>\n\n<p>Output will be (try this one on the <a href=\"https://play.golang.org/p/BNrIiiXl8_R\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{NicCnt:2 Entries:[\n    {XMLName:{Space: Local:ifindex1} Value:eno1}\n    {XMLName:{Space: Local:ifindex2} Value:eno2}\n    {XMLName:{Space: Local:other} Value:something else}]}\nifindex1 : eno1\nifindex2 : eno2\n</code></pre>\n"}], "owner": {"reputation": 1501, "user_id": 6414477, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6a2c251e715864f098ebf4b4057848b1?s=128&d=identicon&r=PG&f=1", "display_name": "rhillhouse", "link": "https://stackoverflow.com/users/6414477/rhillhouse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 58182933, "answer_count": 1, "score": 1, "last_activity_date": 1569932992, "creation_date": 1569924806, "last_edit_date": 1569932992, "question_id": 58182643, "link": "https://stackoverflow.com/questions/58182643/xml-unmarshal-dynamic-response-with-indices-in-field-names", "title": "XML unmarshal dynamic response with indices in field names", "body": "<p>I am attempting to unmarshal a \"dynamic\" XML response, but I am not sure how to approach it. A server responds with a pretty large response, so I would prefer not parsing the response twice. The XML looks like this:</p>\n\n<pre><code>...\n&lt;nic_cnt&gt;2&lt;/nic_cnt&gt;\n&lt;ifindex1&gt;eno1&lt;/ifindex1&gt;\n&lt;ifindex2&gt;eno2&lt;/ifindex2&gt;\n...\n</code></pre>\n\n<p>So the <code>nic_cnt</code> field defines how may times <code>ifindex</code> will occur. Since I do not know how many times <code>ifindex</code> will occur, I cannot statically define the struct fields needed to unmarshal the response.</p>\n"}, {"tags": ["c++", "go", "swig"], "owner": {"reputation": 199, "user_id": 2194088, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5d353c7669daa26c77cd680ed69576ea?s=128&d=identicon&r=PG", "display_name": "Kimi Wu", "link": "https://stackoverflow.com/users/2194088/kimi-wu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1570005564, "creation_date": 1569920899, "last_edit_date": 1570005564, "question_id": 58181518, "link": "https://stackoverflow.com/questions/58181518/nothing-known-about-base-class-if-custom-template-class-used", "title": "Nothing known about base class if custom template class used", "body": "<p>I'm trying to wrap libsnark, a c++ project, to golang.\nI got the following warnings, </p>\n\n<pre><code>SWIG:1: Warning 125: Use of the include path to find the input file is deprecated and will not work with ccache. Please include the path when specifying the input file.\n./go_wrapper/swig/../../libsnark/libsnark/gadgetlib2/variable.hpp:320: Warning 401: Nothing known about base class 'VariableArrayContents'. Ignored.\n./go_wrapper/swig/../../libsnark/libsnark/gadgetlib2/variable.hpp:332: Warning 315: Nothing known about 'VariableArrayContents::operator []'.\n./go_wrapper/swig/../../libsnark/libsnark/gadgetlib2/variable.hpp:333: Warning 315: Nothing known about 'VariableArrayContents::at'.\n</code></pre>\n\n<p>here is the c++ snippet</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>class Variable {\n   /**\n    * @brief allocates the variable\n    */\npublic:\n    explicit Variable(const ::std::string&amp; name = \"\");\n    virtual ~Variable();\n    ...\n}; // class Variable\n\ntypedef ::std::vector&lt;Variable&gt; VariableArrayContents;\n\nclass VariableArray : public VariableArrayContents {\n   public:\n    using VariableArrayContents::operator[];\n    using VariableArrayContents::at;\n    using VariableArrayContents::push_back;\n    using VariableArrayContents::size;\n\n   ... \n}\n</code></pre>\n\n<p>and this is my swig file</p>\n\n<pre><code>%module gadgetlib2\n\n%include &lt;typemaps.i&gt;\n%include \"std_vector.i\"\n%include \"std_string.i\"\n\n\n%ignore VariableArrayContents;\ntypedef std::vector&lt;Variable&gt; VariableArrayContents;\n%{\ntypedef std::vector&lt;Variable&gt; VariableArrayContents;\n%}\nnamespace std {\n   %template(StringVector) vector&lt;string&gt;;\n   %template(VariableArrayContentsVector) vector&lt;Variable&gt;;\n   // Use this, got the same result \n   // %template(VariableArrayContentsVector) vector&lt;Variable&gt;;\n}\n\n\n%include \"../../libsnark/libsnark/gadgetlib2/variable.hpp\"\n%include \"../../libsnark/libsnark/gadgetlib2/variable_operators.hpp\"\n%include \"../../libsnark/libsnark/gadgetlib2/protoboard.hpp\"\n%include \"../../libsnark/libsnark/gadgetlib2/pp.hpp\"\n...\n</code></pre>\n\n<p>I'm new to SWIG, not very know how to write such complex script. The c++ project is a 3rd party project, we don't plan to touch it. </p>\n"}, {"tags": ["linux", "go", "stat"], "comments": [{"owner": {"reputation": 27648, "user_id": 9952196, "user_type": "registered", "profile_image": "https://graph.facebook.com/10216835866235879/picture?type=large", "display_name": "Shawn", "link": "https://stackoverflow.com/users/9952196/shawn"}, "edited": false, "score": 1, "creation_date": 1569914071, "post_id": 58179647, "comment_id": 102739608, "body": "Looks like go&#39;s <code>os</code> package has a <code>Stat</code> function that doesn&#39;t include that information, and yet it has a <code>Chown</code> function that takes uid and gid...  strange decisions there."}], "answers": [{"comments": [{"owner": {"reputation": 5024, "user_id": 1419891, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bb825cd3f1905f42c16408393480a65b?s=128&d=identicon&r=PG", "display_name": "425nesp", "link": "https://stackoverflow.com/users/1419891/425nesp"}, "edited": false, "score": 1, "creation_date": 1569914631, "post_id": 58179864, "comment_id": 102739907, "body": "Yeah, I think it&#39;s not just &quot;a reasonable way to do it&quot;. It&#39;s <i>the</i> way to do it. <a href=\"https://github.com/golang/go/issues/14753\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/14753</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1569914983, "post_id": 58179864, "comment_id": 102740058, "body": "Or alternatively you may directly call <a href=\"https://golang.org/pkg/syscall/#Stat\" rel=\"nofollow noreferrer\"><code>syscall.Stat()</code></a> which returns <a href=\"https://golang.org/pkg/syscall/#Stat_t\" rel=\"nofollow noreferrer\"><code>*syscall.Stat_t</code></a> but that is not available on all target OSes (e.g. on Window)."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1569916116, "post_id": 58179864, "comment_id": 102740588, "body": "I&#39;d not create &quot;fake&quot; UID and GID for non-Unix-y platforms. A struct such as <code>type fileOwner struct { UID, GID int; Valid bool }</code> would be better: it would only have <code>Valid == true</code> on systems where the rest of the fields makes sense."}, {"owner": {"reputation": 1165, "user_id": 869271, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ae486e9ebb18f0cd4dd3f512abc3a3e1?s=128&d=identicon&r=PG", "display_name": "Siscia", "link": "https://stackoverflow.com/users/869271/siscia"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1569920005, "post_id": 58179864, "comment_id": 102742490, "body": "@kostix os.Getuid() should return -1 on Windows. The <code>Valid == true</code> check is equal to UID &gt;= 0, making the Valid field redudant."}], "tags": [], "owner": {"reputation": 1165, "user_id": 869271, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ae486e9ebb18f0cd4dd3f512abc3a3e1?s=128&d=identicon&r=PG", "display_name": "Siscia", "link": "https://stackoverflow.com/users/869271/siscia"}, "is_accepted": false, "score": 6, "last_activity_date": 1569914517, "creation_date": 1569914517, "answer_id": 58179864, "question_id": 58179647, "link": "https://stackoverflow.com/questions/58179647/getting-uid-and-gid-of-a-file/58179864#58179864", "title": "Getting uid and gid of a file", "body": "<p>I figured out a reasonable way to do it.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"syscall\"\n    \"os\"\n)\n\ninfo, _ := os.Stat(\"/path/to/the/file\")\n\nvar UID int\nvar GID int\nif stat, ok := info.Sys().(*syscall.Stat_t); ok {\n    UID = int(stat.Uid)\n    GID = int(stat.Gid)\n} else {\n    // we are not in linux, this won't work anyway in windows, \n    // but maybe you want to log warnings\n    UID = os.Getuid()\n    GID = os.Getgid()\n}\n</code></pre>\n"}], "owner": {"reputation": 1165, "user_id": 869271, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ae486e9ebb18f0cd4dd3f512abc3a3e1?s=128&d=identicon&r=PG", "display_name": "Siscia", "link": "https://stackoverflow.com/users/869271/siscia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3094, "favorite_count": 0, "closed_date": 1569914769, "answer_count": 1, "score": 3, "last_activity_date": 1569915942, "creation_date": 1569913600, "last_edit_date": 1569915942, "question_id": 58179647, "link": "https://stackoverflow.com/questions/58179647/getting-uid-and-gid-of-a-file", "closed_reason": "Duplicate", "title": "Getting uid and gid of a file", "body": "<p>In linux the <code>stat</code> struct contains the UID and GID of a file.</p>\n\n<p>Is there a way to obtain the same information (UID and GID) of a file using Go(lang)?</p>\n"}, {"tags": ["function", "go", "methods"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1569910877, "post_id": 58179020, "comment_id": 102738287, "body": "There aint no such thing as methods in Go. There are only functions. I guess this answers the question."}, {"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "edited": false, "score": 4, "creation_date": 1569911549, "post_id": 58179020, "comment_id": 102738526, "body": "From <a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">here</a>: &quot;A method is a function with a special receiver argument.&quot;"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1569912611, "post_id": 58179020, "comment_id": 102738950, "body": "from the spec <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Method_sets</a>"}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1569913353, "post_id": 58179020, "comment_id": 102739294, "body": "@MarkusWMahlberg funny how the Go Language Specification has sections about Method Declarations, Method Expressions, Method Values, and Method Sets then."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1569915127, "post_id": 58179020, "comment_id": 102740124, "body": "@hobbs See above. &quot;A method is a function with a special argument&quot;. A function, at the end of the day. or, from the specs, exploring method sets a bit deeper: &quot;A method is a function with a receiver&quot;. Still a function."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1569915313, "post_id": 58179020, "comment_id": 102740211, "body": "@MarkusWMahlberg We&#39;re not saying a method is not a function, even your quote says method is a thing, so it&#39;s harsh to say they don&#39;t exist."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1569915410, "post_id": 58179020, "comment_id": 102740248, "body": "@icza In the context of the question? ;)"}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1569925108, "post_id": 58179235, "comment_id": 102745141, "body": "Also, the namespace for methods is the type they are defined on, not the package namespace. So it&#39;s possible to define two distinct methods named Foo in a package, but not two functions named Foo."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1569925187, "post_id": 58179235, "comment_id": 102745179, "body": "@Peter True, but just as easily we could name 2 different <code>Foo</code> functions <code>Type1Foo</code> and <code>Type2Foo</code> if needed."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1570000131, "last_edit_date": 1570000131, "creation_date": 1569911723, "answer_id": 58179235, "question_id": 58179020, "link": "https://stackoverflow.com/questions/58179020/is-there-any-profits-of-using-methods-rather-than-functions/58179235#58179235", "title": "Is there any profits of using Methods rather than Functions?", "body": "<p>If you just want to call the function or method, it doesn't matter, you may create a function with a signature where the receiver is a normal, regular parameter. There won't be any performance penalty (there could be if methods could be <a href=\"https://en.wikipedia.org/wiki/Virtual_function\" rel=\"nofollow noreferrer\"><em>virtual</em></a>, but in Go there are no virtual methods).</p>\n\n<p>One advantage might be the \"visual appeal\". Calling a method makes it obvious it belongs to the receiver. I also find chained code easier to understand if methods are used.</p>\n\n<p>Compare this solution without methods:</p>\n\n<pre><code>type Circle struct{}\ntype Point struct{}\n\nfunc Center(Circle) Point { return Point{} }\nfunc Abs(Point) float64   { return 0 }\n\nfunc main() {\n    var c Circle\n    fmt.Println(Abs(Center(c)))\n}\n</code></pre>\n\n<p><code>Abs(Center(c))</code> isn't that intuitive. But if you add methods instead of using functions:</p>\n\n<pre><code>func (Circle) Center() Point { return Point{} }\nfunc (Point) Abs() float64 { return 0 }\n\nfunc main() {\n    var c Circle\n    fmt.Println(c.Center().Abs())\n}\n</code></pre>\n\n<p><code>c.Center().Abs()</code> is easier to understand.</p>\n\n<p><strong>Methods are a must if you want to implement interfaces.</strong> If an interface contains some methods, only types that have those methods can implement it. See related: <a href=\"https://stackoverflow.com/questions/39092925/why-are-interfaces-needed-in-golang/39100038#39100038\">Why are interfaces needed in Golang?</a> It should also be noted that you may only create methods defined in the same package, so if you want to \"arm\" a type from a different package, you can't \"use\" methods.</p>\n\n<p>One thing that I would call \"profit\" for using methods: you can't call functions by name, but you can access and call methods by name. For details, see <a href=\"https://stackoverflow.com/questions/37384473/call-functions-with-special-prefix-suffix/37384665#37384665\">Call functions with special prefix/suffix</a>.</p>\n"}], "owner": {"reputation": 19, "user_id": 12146593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-B2MfXvq2mUw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfW5eHgUrE7kWm0X-Ce4mo8C-yYTg/photo.jpg?sz=128", "display_name": "Dong-Arc Park", "link": "https://stackoverflow.com/users/12146593/dong-arc-park"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1570000131, "creation_date": 1569910620, "last_edit_date": 1569937295, "question_id": 58179020, "link": "https://stackoverflow.com/questions/58179020/is-there-any-profits-of-using-methods-rather-than-functions", "title": "Is there any profits of using Methods rather than Functions?", "body": "<p>I'm developing \"Matrix\" struct and related methods for the purpose of practicing Go.\nI made a lot of methods but I realized that all these methods can be changed into functions\nI'm used to C++ and in C++, if I make a function whose parameter is a type of class, the function cannot use the class' private variable(information hiding)\nHowever, when I built a similar code using \"Go\", a function can access a struct's variable.\nSo I don't get what is different between methods and functions in Go.\nAre there any profits using methods rather than functions or vice versa?</p>\n\n<p>First one is my original \"Matrix\" code(not all of it)\nIt used a method \"Tr\".\nIt doesn't have problems.</p>\n\n<pre><code>package main\nimport \"fmt\"\n\n//definition of \"Array\"\ntype Array struct{\n    component [][]float32\n    row int\n    col int\n}\n//constructor of Array, \"Ones\"; making an array setting all component as one\nfunc Ones(m int, n int) Array{\n    var a Array\n    a.component = make([][]float32, m)\n    a.row=m\n    a.col=n\n    for i:=0; i&lt;m; i++{\n        a.component[i] = make([]float32, n)\n        for j:=0; j&lt;n; j++{\n            a.component[i][j]=1\n        }\n    }\n    return a\n}\n//Tr function; find trace of an Array\nfunc (a Array) Tr() float32{\n    var sum float32 = 0\n    for i:=0; i&lt;a.row; i++{\n        sum += a.component[i][i]\n    }\n    return sum\n}\n\nfunc main(){\n    a := Ones(3,3)\n    fmt.Println(a.Tr())\n}\n</code></pre>\n\n<p>The second one is another similar code. (Everything is same but \"Tr\" part)\nIt used only functions.\nIt also doesn't have problems.</p>\n\n<pre><code>package main\nimport \"fmt\"\n\n//definition of \"Array\"\ntype Array struct{\n    component [][]float32\n    row int\n    col int\n}\n//constructor of Array, \"Ones\"; making an array setting all component as one\nfunc Ones(m int, n int) Array{\n    var a Array\n    a.component = make([][]float32, m)\n    a.row=m\n    a.col=n\n    for i:=0; i&lt;m; i++{\n        a.component[i] = make([]float32, n)\n        for j:=0; j&lt;n; j++{\n            a.component[i][j]=1\n        }\n    }\n    return a\n}\n//Tr function; find trace of an Array\nfunc Tr(a Array) float32{\n    var sum float32 = 0\n    for i:=0; i&lt;a.row; i++{\n        sum += a.component[i][i]\n    }\n    return sum\n}\n\nfunc main(){\n    a := Ones(3,3)\n    fmt.Println(Tr(a))\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1569904518, "post_id": 58178075, "comment_id": 102736526, "body": "Your bubble sort does not modify <code>a</code>_itself_ . All it does is order its elements."}, {"owner": {"reputation": 1079, "user_id": 8606992, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rNyz3YV6Mlc/AAAAAAAAAAI/AAAAAAAAABw/-znmvkqZgOU/photo.jpg?sz=128", "display_name": "Toxnyc", "link": "https://stackoverflow.com/users/8606992/toxnyc"}, "edited": false, "score": 0, "creation_date": 1569904684, "post_id": 58178075, "comment_id": 102736556, "body": "slice is <code>pass by reference</code>, it will modify the original input"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1079, "user_id": 8606992, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rNyz3YV6Mlc/AAAAAAAAAAI/AAAAAAAAABw/-znmvkqZgOU/photo.jpg?sz=128", "display_name": "Toxnyc", "link": "https://stackoverflow.com/users/8606992/toxnyc"}, "edited": false, "score": 3, "creation_date": 1569904932, "post_id": 58178075, "comment_id": 102736603, "body": "@Toxnyc: In Go all arguments are passed by value. The slice descriptor, a struct, is passed by value as if by assignment. The slice desriptor contains a pointer to its underlying array."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1569934157, "last_edit_date": 1569934157, "creation_date": 1569904562, "answer_id": 58178103, "question_id": 58178075, "link": "https://stackoverflow.com/questions/58178075/how-does-a-go-function-without-return-values-modify-data/58178103#58178103", "title": "How does a Go function without return values modify data?", "body": "<blockquote>\n  <p><code>src/runtime/slice.go</code></p>\n\n<pre><code>type slice struct {\n  array unsafe.Pointer\n  len   int\n  cap   int\n}\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>In Go all arguments are passed by value. The slice descriptor, a struct, is passed by value as if by assignment. The slice descriptor contains a pointer to its underlying array.</p>\n\n<p><code>func bubbleSort(a []int)</code> receives the <code>a</code> argument by value but uses the pointer <code>a.array</code> to modify the underlying array elements.</p>\n\n<hr>\n\n<p>References:</p>\n\n<p><a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">The Go Blog: Go Slices: usage and internals</a></p>\n\n<p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a> </p>\n"}], "owner": {"reputation": 39, "user_id": 11981439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25f6feee3d4017b242b02c7f5f9e280a?s=128&d=identicon&r=PG&f=1", "display_name": "MiryangJung", "link": "https://stackoverflow.com/users/11981439/miryangjung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 1, "accepted_answer_id": 58178103, "answer_count": 1, "score": 0, "last_activity_date": 1569934157, "creation_date": 1569904319, "last_edit_date": 1569906508, "question_id": 58178075, "link": "https://stackoverflow.com/questions/58178075/how-does-a-go-function-without-return-values-modify-data", "title": "How does a Go function without return values modify data?", "body": "<p>I don't understand how the bubbleSort() slice <code>a</code> be applied at the main().</p>\n\n<p>I don't give a <code>return a</code> and don't write a global variable.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc bubbleSort(a []int) {\n    var temp int\n    for j := 0; j &lt; len(a); j++ {\n        for i := 0; i &lt; (len(a) - 1); i++ {\n            if a[i] &gt; a[i+1] {\n                temp = a[i]\n                a[i] = a[i+1]\n                a[i+1] = temp\n            }\n        }\n    }\n}\n\nfunc inputNums() []int {\n    var input int\n    var number int\n\n    fmt.Scan(&amp;input)\n    s := make([]int, input)\n\n    for i := 0; i &lt; input; i++ {\n        fmt.Scan(&amp;number)\n        s[i] = number\n    }\n    return s\n}\n\nfunc outputNums(b []int) {\n    for i := 0; i &lt; len(b); i++ {\n        fmt.Print(b[i])\n        fmt.Print(\" \")\n    }\n}\n\nfunc main() {\n    nums := inputNums()\n    bubbleSort(nums)\n    outputNums(nums)\n}\n</code></pre>\n"}, {"tags": ["go", "package", "webserver"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 5, "creation_date": 1569883954, "post_id": 58176159, "comment_id": 102732964, "body": "<a href=\"https://tour.golang.org/basics/3\" rel=\"nofollow noreferrer\">tour.golang.org/basics/3</a>"}], "answers": [{"tags": [], "owner": {"reputation": 480, "user_id": 667055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5c1ab48637b4d5e78e4a2c3547dafaf?s=128&d=identicon&r=PG", "display_name": "DeeZone", "link": "https://stackoverflow.com/users/667055/deezone"}, "is_accepted": false, "score": 0, "last_activity_date": 1569945781, "last_edit_date": 1569945781, "creation_date": 1569892774, "answer_id": 58177000, "question_id": 58176159, "link": "https://stackoverflow.com/questions/58176159/how-do-i-export-a-variable-property-in-go-lang/58177000#58177000", "title": "How do i export a variable/property in go lang", "body": "<p>When you ask \"how do I make property sm exportable\" I assume you mean in the node sense? If so, the concept you're looking for is \"packages\".</p>\n\n<p><a href=\"https://www.golang-book.com/books/intro/11\" rel=\"nofollow noreferrer\">https://www.golang-book.com/books/intro/11</a></p>\n\n<p>This allows making reference to functionality in one package in other packages using \"import\". Note that the name of the function you want to access must start with a capital letter vs lowercase which can only be referenced with the package.</p>\n\n<p>Typically the web server is created in the \"main\" function / package with controllers attached to the routes you define.</p>\n\n<p>This is a good basic example: <a href=\"https://astaxie.gitbooks.io/build-web-application-with-golang/en/03.2.html\" rel=\"nofollow noreferrer\">https://astaxie.gitbooks.io/build-web-application-with-golang/en/03.2.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "is_accepted": false, "score": 0, "last_activity_date": 1569910645, "last_edit_date": 1569910645, "creation_date": 1569902364, "answer_id": 58177858, "question_id": 58176159, "link": "https://stackoverflow.com/questions/58176159/how-do-i-export-a-variable-property-in-go-lang/58177858#58177858", "title": "How do i export a variable/property in go lang", "body": "<p>You could define your web app in a <code>mywebapp</code> package like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package mywebapp\n\nimport \"net/http\"\n\nvar SM *http.ServeMux\n\nfunc init() {\n    SM = http.NewServeMux()\n    SM.Handle(\"/route1\", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        http.ServeFile(w, r, \"static/front-office/index.html\")\n    }))\n    SM.Handle(\"/route2\", handleSomething())\n    SM.Handle(\"/route3\", handleSomething())\n    SM.Handle(\"/static/\", http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"static\"))))\n\n    frontEndUIServer := http.Server{\n        Addr:    \":9000\",\n        Handler: SM,\n    }\n    go frontEndUIServer.ListenAndServe()\n}\n</code></pre>\n\n<p>The <code>ServeMux</code> used by the server is exported so other packages can add handlers. The server starts as soon as the package is imported.</p>\n"}], "owner": {"reputation": 1075, "user_id": 10358967, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4V7Q6XvDivU/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaOvV19bWhnj7CaSL2naSzQty7e0sg/mo/photo.jpg?sz=128", "display_name": "Oto-obong Eshiett", "link": "https://stackoverflow.com/users/10358967/oto-obong-eshiett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1940, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1569945781, "creation_date": 1569883795, "last_edit_date": 1569906738, "question_id": 58176159, "link": "https://stackoverflow.com/questions/58176159/how-do-i-export-a-variable-property-in-go-lang", "title": "How do i export a variable/property in go lang", "body": "<p>I am trying to create an MVC web app in golang without using any framework. How I plan to achieve it is to create an instance of a http.Server {} with a http.NewServeMux() as it's handler as coded below:</p>\n\n<pre><code> sm := http.NewServeMux()\n    sm.Handle(\"/route1\", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        http.ServeFile(w, r, \"static/front-office/index.html\")\n    }))\n    sm.Handle(\"/route2\", handleSomething())\n    sm.Handle(\"/route3\", handleSomething())\n    sm.Handle(\"/static/\", http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"static\"))))\n\n\n    frontEndUIServer := http.Server{\n        Addr:    \":9000\",\n        Handler:  sm,\n    }\n    go frontEndUIServer.ListenAndServe()\n</code></pre>\n\n<p>then make property <code>sm</code> exportable so that any other go files can import it and create handlers on it, thereby implementing my controller. Since I am new to goLang, my question now is how do I make property <code>sm</code> exportable?</p>\n"}, {"tags": ["git", "go", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1569896195, "creation_date": 1569896195, "answer_id": 58177295, "question_id": 58175969, "link": "https://stackoverflow.com/questions/58175969/where-pseudo-version-with-non-existent-tag/58177295#58177295", "title": "Where pseudo version with non-existent tag", "body": "<p>It is a 'pseudo-version', explained here:</p>\n\n<p><a href=\"https://tip.golang.org/cmd/go/#hdr-Pseudo_versions\" rel=\"nofollow noreferrer\">https://tip.golang.org/cmd/go/#hdr-Pseudo_versions</a></p>\n\n<p>In short, since you picked @master, it creates this version with the timestamp and hash of the latest commit on the master branch. The version number is generated from the latest tag +1 revision.</p>\n"}, {"tags": [], "owner": {"reputation": 166, "user_id": 11904651, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WUMVN-fvfNk/AAAAAAAAAAI/AAAAAAAAAOY/j_7iNZcBCGU/photo.jpg?sz=128", "display_name": "Ankush Chadha", "link": "https://stackoverflow.com/users/11904651/ankush-chadha"}, "is_accepted": false, "score": 1, "last_activity_date": 1570669346, "creation_date": 1570669346, "answer_id": 58314060, "question_id": 58175969, "link": "https://stackoverflow.com/questions/58175969/where-pseudo-version-with-non-existent-tag/58314060#58314060", "title": "Where pseudo version with non-existent tag", "body": "<p>This is the expected behavior. Here's the info from the link mentioned above -</p>\n\n<blockquote>\n  <p>vX.Y.(Z+1)-0.yyyymmddhhmmss-abcdefabcdef is used when the most recent\n  versioned commit before the target commit is vX.Y.Z.</p>\n</blockquote>\n"}], "owner": {"reputation": 198, "user_id": 2321402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74e530211e5048f0d6276964de30f75d?s=128&d=identicon&r=PG", "display_name": "luiss", "link": "https://stackoverflow.com/users/2321402/luiss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 748, "favorite_count": 0, "accepted_answer_id": 58177295, "answer_count": 2, "score": 1, "last_activity_date": 1570669346, "creation_date": 1569882080, "last_edit_date": 1569882236, "question_id": 58175969, "link": "https://stackoverflow.com/questions/58175969/where-pseudo-version-with-non-existent-tag", "title": "Where pseudo version with non-existent tag", "body": "<p>When importing a <code>GOPATH</code> style dependency from in a go.mod enabled module, I get a mysterious pseudo-version.</p>\n\n<pre><code>$ cd $(mktemp -d)\n$ go mod init github.com/foo/test\ngo: creating new go.mod: module github.com/foo/test\n$ go get github.com/bar/api@master\n$ cat go.mod \nmodule github.com/foo/test\n\ngo 1.12\n\nrequire (\n    github.com/bar/api v3.9.1-0.20190923092516-169848dd8137+incompatible // indirect\n)\n$ \n</code></pre>\n\n<p>The <code>github.com/bar/api</code> repo has only a <code>v3.9.0</code> tag defined. The <code>master</code> branch is a few commits ahead of that.</p>\n\n<p>Does anyone know where the <code>v3.9.1</code> tag is being picked up from? That tag does not exist. The commit id, <code>169848dd8137</code>, does point to the <code>HEAD</code> of <code>master</code>, but it is not tagged. Is it just <code>go mod</code> just being clever and saying hey, commits after the <code>v3.9.0</code> tag imply some version of <code>v3.9.1</code>?</p>\n"}, {"tags": ["string", "go", "floating-point", "binary", "uint16"], "answers": [{"comments": [{"owner": {"reputation": 732, "user_id": 4999812, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/8bd09518ec24320e674e5feb9cf69a63?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Dube", "link": "https://stackoverflow.com/users/4999812/brandon-dube"}, "edited": false, "score": 0, "creation_date": 1569883448, "post_id": 58176033, "comment_id": 102732862, "body": "Is there a similarly quick way to go the opposite direction?  I need to write to these as well, albeit at a far slower rate.  Algorithmic symmetry would be ideal."}, {"owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "reply_to_user": {"reputation": 732, "user_id": 4999812, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/8bd09518ec24320e674e5feb9cf69a63?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Dube", "link": "https://stackoverflow.com/users/4999812/brandon-dube"}, "edited": false, "score": 0, "creation_date": 1569888904, "post_id": 58176033, "comment_id": 102733842, "body": "@Brandon said: <code>this is much faster...</code> I just ran a test and Uint16() is inlined as I suspected. <code>.\\main.go:13:34: inlining call to binary.bigEndian.Uint16</code>  Personally I would use the std library function, as it as just as fast, self-documenting, and avoids possible mistakes using bit manipulation (shifts, OR, etc)."}, {"owner": {"reputation": 732, "user_id": 4999812, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/8bd09518ec24320e674e5feb9cf69a63?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Dube", "link": "https://stackoverflow.com/users/4999812/brandon-dube"}, "edited": false, "score": 0, "creation_date": 1569904356, "post_id": 58176033, "comment_id": 102736491, "body": "I agree using the binary pkg to do the manipulation is better \u2014 it\u2019s the lack of round tripping through text that make Cerise\u2019 answer much faster than what I came up with."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1569938054, "last_edit_date": 1569938054, "creation_date": 1569882637, "answer_id": 58176033, "question_id": 58175951, "link": "https://stackoverflow.com/questions/58175951/uint16-to-xx-x-float-fastest-algorithm/58176033#58176033", "title": "uint16 to xx.x float -- fastest algorithm?", "body": "<p>Convert the bytes to a number and divide by 10:</p>\n\n<pre><code>b := []byte{0x02, 0xBC}\nf := float64(binary.BigEndian.Uint16(b)) / 10.0\n</code></pre>\n\n<p>The reverse conversion is:</p>\n\n<pre><code>p := make([]byte, 2)\nbinary.BigEndian.PutUint16(p, uint16(math.Round(f*10.0)))\n</code></pre>\n\n<p>To handle negative numbers, covert the uint16 to an int16 before the conversion to float:</p>\n\n<pre><code>f := float64(int16(binary.BigEndian.Uint16(p))) / 10.0\n</code></pre>\n"}], "owner": {"reputation": 732, "user_id": 4999812, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/8bd09518ec24320e674e5feb9cf69a63?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Dube", "link": "https://stackoverflow.com/users/4999812/brandon-dube"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 58176033, "answer_count": 1, "score": 0, "last_activity_date": 1569938054, "creation_date": 1569881980, "last_edit_date": 1569935701, "question_id": 58175951, "link": "https://stackoverflow.com/questions/58175951/uint16-to-xx-x-float-fastest-algorithm", "title": "uint16 to xx.x float -- fastest algorithm?", "body": "<p>I receive data from a temperature sensor that is formatted as two bytes which are a binary encoding of the fixed-width, floating point data.  The encoding scheme can be demonstrated in the following table:</p>\n\n<pre><code>| temperature | hexadecimal | int16 |\n| 0.1 *F      | 0x00 0x01   | 01    |\n| 10.0 *F     | 0x00 0x64   | 100   |\n</code></pre>\n\n<p>To reconstruct the floating point value, I have written the following short program:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/binary\"\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    b1 := byte(0x02)\n    b2 := byte(0xBC)\n    b := []byte{b1, b2}\n    intgr := binary.BigEndian.Uint16(b)\n    str := fmt.Sprint(intgr)\n    l := len(str)\n    front := str[:l-1]\n    decimal := str[l-1:]\n    str = fmt.Sprintf(\"%v.%v\", front, decimal)\n    float, _ := strconv.ParseFloat(str, 64)\n    fmt.Println(float)\n}\n</code></pre>\n\n<p>However it is a bit too slow for my needs, which I think is because I have used Sprint/Sprintf.  Is there a faster (and perhaps cleaner) algorithm for doing this?</p>\n"}, {"tags": ["go", "go-cobra", "viper-go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1569882279, "post_id": 58175903, "comment_id": 102732613, "body": "Declare package-level variables for <code>projectBase</code> and the others.  Follow the example of <code>cfgFile</code>.  Consider filing an issue about the incomplete example code."}, {"owner": {"reputation": 145, "user_id": 11838238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5403287547b8ee6e30d3664243a79269?s=128&d=identicon&r=PG&f=1", "display_name": "ruck64", "link": "https://stackoverflow.com/users/11838238/ruck64"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1569884235, "post_id": 58175903, "comment_id": 102733014, "body": "Thank you I appreciate it. And ill consider it. I just feel since im really fresh theres lot of things that are picked up earlier and Im not privy to all them at this point.  But Ill look into what you stated"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1569894477, "post_id": 58175903, "comment_id": 102734767, "body": "Seriously, everyone started once upon a time. We all wrote bad code when we learn programming languages. Keeping that bad code secret harms you in two ways: <i>We</i> can not help you and <i>you</i> might miss an opportunity to learn."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1569894688, "post_id": 58175903, "comment_id": 102734803, "body": "As for the author, a constant flag seems odd to me. <a href=\"https://godoc.org/github.com/spf13/cobra#Command.SetVersionTemplate\" rel=\"nofollow noreferrer\"><code>func(*Command)SetVersionTemplate(string s)</code></a> and its relatives seem to be more suitable."}], "owner": {"reputation": 145, "user_id": 11838238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5403287547b8ee6e30d3664243a79269?s=128&d=identicon&r=PG&f=1", "display_name": "ruck64", "link": "https://stackoverflow.com/users/11838238/ruck64"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 651, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1569881600, "creation_date": 1569881600, "question_id": 58175903, "link": "https://stackoverflow.com/questions/58175903/config-files-and-golang-or-just-beginner-mistake", "title": "Config files and Golang or just beginner mistake", "body": "<p>I have done a few tutorials in Go and wanted to try something much more relevant that is going to needed from me relatively soon. Im starting by looking at viper and cobra. I understand the config file is actually for viper to use and cobra is just handling things with it. However, Im stuck on even getting past that point. Ill likely run into a few more errors but I am stuck on this one and any help I find doesnt really make any sense to aid my issue. So I have a decent background in C/C++. And from the reading ampersands and asteriks are used in a similar fashion. Thats why Im having trouble with this. </p>\n\n<pre><code>func init() {\n     cobra.OnInitialize(initConfig)\n     rootCmd.PersistentFlags().StringVar(&amp;cfgFile, \"config\", \"\", \"config file (default is $Home/.cobra.yaml)\")\n     rootCmd.PersistentFlags().StringVarP(&amp;projectBase,\"projectbase\", \"b\", \"\", \"base project direcoty eg. github.com\")\n     rootCmd.PersistentFlags().StringP(\"author\", \"a\", \"Rutger\", \"Written by rutger\")\n     rootCmd.PersistentFlags().StringVarP(&amp;userLicense, \"license\", \"l\", \"\", \"My license homie\")\n     viper.BindPFlag(\"author\", rootCmd. PersistentFlags().Lookup(\"author\"))\n     viper.BindPFlag(\"projectbase\", rootCmd.PersistentFlags().Lookup(\"projectbase\"))\n     viper.BindPFlag(\"useViper\", rootCmd.PersistentFlags().Lookup(\"viper\"))\n     viper.SetDefault(\"author\", \"Rutger Luther &lt;rutger.luther@printtrackerpro.com\")\n     viper.SetDefault(\"license\", \"nachos\")\n}\n</code></pre>\n\n<p>This is basically the example used for viper and cobra from here.  <a href=\"https://github.com/spf13/cobra\" rel=\"nofollow noreferrer\">Go Cobra</a></p>\n\n<p>The issue is im getting these errors.  </p>\n\n<pre><code>cmd\\root.go:25:40: undefined: projectBase\ncmd\\root.go:27:40: undefined: userLicense\ncmd\\root.go:39:15: undefined: homedir\n</code></pre>\n\n<p>Im making the calls to these for the first time so Im not sure how they would have any values. I apologize if this is a really simply question. But some of these Go pages are a bit more difficult to understand.</p>\n"}, {"tags": ["go", "mqtt", "paho"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 12145439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af57d6ccdb32914522bab65ae2b2e012?s=128&d=identicon&r=PG&f=1", "display_name": "Paho Man", "link": "https://stackoverflow.com/users/12145439/paho-man"}, "edited": false, "score": 0, "creation_date": 1570127147, "post_id": 58218327, "comment_id": 102824899, "body": "Published messages must be ordered, using worker will send them randomly, and the goal here is to use Paho lib using goroutine to pass message to it via channels. Thank you"}, {"owner": {"reputation": 148, "user_id": 3541986, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4XmsN.png?s=128&g=1", "display_name": "Ilya Kaznacheev", "link": "https://stackoverflow.com/users/3541986/ilya-kaznacheev"}, "reply_to_user": {"reputation": 3, "user_id": 12145439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af57d6ccdb32914522bab65ae2b2e012?s=128&d=identicon&r=PG&f=1", "display_name": "Paho Man", "link": "https://stackoverflow.com/users/12145439/paho-man"}, "edited": false, "score": 0, "creation_date": 1570214231, "post_id": 58218327, "comment_id": 102855535, "body": "You will achieve the same if you will set the worker pool size to one."}, {"owner": {"reputation": 148, "user_id": 3541986, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4XmsN.png?s=128&g=1", "display_name": "Ilya Kaznacheev", "link": "https://stackoverflow.com/users/3541986/ilya-kaznacheev"}, "reply_to_user": {"reputation": 3, "user_id": 12145439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af57d6ccdb32914522bab65ae2b2e012?s=128&d=identicon&r=PG&f=1", "display_name": "Paho Man", "link": "https://stackoverflow.com/users/12145439/paho-man"}, "edited": false, "score": 0, "creation_date": 1570214403, "post_id": 58218327, "comment_id": 102855593, "body": "In other words you can start only one goroutine, but if you want to send messages on sync mode, you will not achieve any performance improvement"}, {"owner": {"reputation": 3, "user_id": 12145439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af57d6ccdb32914522bab65ae2b2e012?s=128&d=identicon&r=PG&f=1", "display_name": "Paho Man", "link": "https://stackoverflow.com/users/12145439/paho-man"}, "edited": false, "score": 0, "creation_date": 1570223363, "post_id": 58218327, "comment_id": 102858584, "body": "We are not talking about same thing, it&#39;s not a matter for number of workers or not. You can read again my message please, thank you for your efforts."}], "tags": [], "owner": {"reputation": 148, "user_id": 3541986, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4XmsN.png?s=128&g=1", "display_name": "Ilya Kaznacheev", "link": "https://stackoverflow.com/users/3541986/ilya-kaznacheev"}, "is_accepted": false, "score": 0, "last_activity_date": 1570214087, "last_edit_date": 1570214087, "creation_date": 1570102543, "answer_id": 58218327, "question_id": 58175550, "link": "https://stackoverflow.com/questions/58175550/what-is-the-right-way-to-use-this-code-paho-mqtt-as-goroutine-and-pass-message/58218327#58218327", "title": "What is the right way to use this code (Paho MQTT) as GoRoutine and pass messages via channel to publish via websockets", "body": "<p>Why don't you just split message sending into a bunch of workers?</p>\n\n<p>Something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>...\n    const workerPoolSize = 10 // the number of workers you want to have\n    wg := &amp;sync.WaitGroup{}\n    wCh := make(chan string)\n    wg.Add(workerPoolSize) // you want to wait for 10 workers to finish the job\n\n    // run workers in goroutines\n    for i := 0; i &lt; workerPoolSize; i++ {\n        go func(wch &lt;-chan string) {\n            // get the data from the channel\n            for text := range wch {\n                c.Publish(\"logs\", 0, false, text)\n                token.Wait()\n            }\n            wg.Done() // worker says that he finishes the job\n        }(wCh)\n    }\n\n    for i := 0; i &lt; 5; i++ {\n        // put the data to the channel\n        wCh &lt;- fmt.Sprintf(\"this is msg #%d!\", i)\n    }\n\n        close(wCh)\n    wg.Wait() // wait for all workers to finish\n...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 12145439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af57d6ccdb32914522bab65ae2b2e012?s=128&d=identicon&r=PG&f=1", "display_name": "Paho Man", "link": "https://stackoverflow.com/users/12145439/paho-man"}, "edited": false, "score": 0, "creation_date": 1570364288, "post_id": 58255750, "comment_id": 102883196, "body": "Thank you sir ! some questions please: do wg.Wait() must be called after channel is closed ? In my case, I will not close channel since the program work in loop  (he listen for new datas coming from web browser and then send them via MQTT), and can I call it even if the channel is not closed ? Can I use wg sync.WaitGroup for multiple different goroutines or use it for a specific one ? Thanks again !"}, {"owner": {"reputation": 3, "user_id": 12145439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af57d6ccdb32914522bab65ae2b2e012?s=128&d=identicon&r=PG&f=1", "display_name": "Paho Man", "link": "https://stackoverflow.com/users/12145439/paho-man"}, "edited": false, "score": 0, "creation_date": 1570364876, "post_id": 58255750, "comment_id": 102883310, "body": "Another thing, logically wg.Done() will be inside the for ... range ? SInce I want use one goroutine to process all this message and will not be closed until the entire program shutdown."}, {"owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "reply_to_user": {"reputation": 3, "user_id": 12145439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af57d6ccdb32914522bab65ae2b2e012?s=128&d=identicon&r=PG&f=1", "display_name": "Paho Man", "link": "https://stackoverflow.com/users/12145439/paho-man"}, "edited": false, "score": 0, "creation_date": 1570434031, "post_id": 58255750, "comment_id": 102898216, "body": "I think you have misunderstod the purpose of the wg.Wait(). If you remove that line then the program will exit immediatly after the for <code>i := 0; i &lt; 5; i++loop</code> has completed (probably without anything actually being sent). This is because the code actually sending the messages is in a go routine and these are all automatically stopped when the program exits.   The <code>close(msgChan)</code> and <code>wg.Wait</code> should only be called when your program is ready to exit (having these delays the exit until the queued messages have beeen sent)."}, {"owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "reply_to_user": {"reputation": 3, "user_id": 12145439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af57d6ccdb32914522bab65ae2b2e012?s=128&d=identicon&r=PG&f=1", "display_name": "Paho Man", "link": "https://stackoverflow.com/users/12145439/paho-man"}, "edited": false, "score": 0, "creation_date": 1570434746, "post_id": 58255750, "comment_id": 102898506, "body": "<i>wg.Done() will be inside the for ... range</i> : the wg.Done() is a way of informing the main go routine that the go routine publishing the messages has finnished sending everything (so you only want to call this once; it is the <code>token.Wait()</code> that waits for a message to be sent). The <code>for msg := range msgChan</code> will only exit after <code>close(msgChan)</code> has been called and any messages added to the channel prior to calling close have been read."}], "tags": [], "owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "is_accepted": true, "score": 5, "last_activity_date": 1570435449, "last_edit_date": 1570435449, "creation_date": 1570352470, "answer_id": 58255750, "question_id": 58175550, "link": "https://stackoverflow.com/questions/58175550/what-is-the-right-way-to-use-this-code-paho-mqtt-as-goroutine-and-pass-message/58255750#58255750", "title": "What is the right way to use this code (Paho MQTT) as GoRoutine and pass messages via channel to publish via websockets", "body": "<p><em>I posted the answer below on the <a href=\"https://github.com/eclipse/paho.mqtt.golang/issues/357\" rel=\"nofollow noreferrer\">github repo</a> but as you have asked the same question here thought it was worth cross posting (with a bit more info).</em></p>\n\n<p>When you say \"passing messages in mass while doing high latency tasks\" I assume that you mean that you want to send the messages asynchronously (so the message is handled by a different go-routine than your main code is running on).</p>\n\n<p>If that is the case then a very simple change to your initial example will give you that:</p>\n\n<pre><code>for i := 0; i &lt; 5; i++ {\n        text := fmt.Sprintf(\"this is msg #%d!\", i)\n        token := c.Publish(\"logs\", 0, false, text)\n        // comment out... token.Wait()\n    }\n</code></pre>\n\n<p><em>Note: Your example code may exit before the messages are actually sent; adding time.Sleep(10 &ast; time.Second) would give it time for these to go out; see the code below for another way of handling this</em> </p>\n\n<p>The only reason that your initial code stopped until the message was sent was that you called token.Wait(). If you don't care about errors (and you are not checking for them so I assume you dont care) then there is little point in calling token.Wait() (it just waits until the message is sent; the message will go out whether you call token.Wait() or not).</p>\n\n<p>If you want to log any errors you could use something like:</p>\n\n<pre><code>for i := 0; i &lt; 5; i++ {\n        text := fmt.Sprintf(\"this is msg #%d!\", i)\n        token := c.Publish(\"logs\", 0, false, text)\n        go func(){\n            token.Wait()\n            err := token.Error()\n            if err != nil {\n                fmt.Printf(\"Error: %s\\n\", err.Error()) // or whatever you want to do with your error\n            }\n        }()\n    }\n</code></pre>\n\n<p>Note that there are a few more things that you need to do if message delivery is critical (but as you are not checking for errors I'm assuming its not).</p>\n\n<p>In terms of the code you found; I suspect that this would add complexity you dont need (and more info would be required to work this out; for example the MqttProtocol struct is not defined within the bit you pasted).</p>\n\n<p>Extra bit... In your comments you mentioned \"Published messages must be ordered\". If that is essential (so you want to wait until each message has been delivered before sending another) then you need something like:</p>\n\n<pre><code>msgChan := make(chan string, 200) // Allow a queue of up to 200 messages\nvar wg sync.WaitGroup\nwg.Add(1)\ngo func(){ // go routine to send messages from channel\n    for msg := range msgChan {\n        token := c.Publish(\"logs\", 2, false, msg) // Use QOS2 is order is vital\n        token.Wait()\n        // should check for errors here\n    }\n    wg.Done()\n}()\n\nfor i := 0; i &lt; 5; i++ {\n        text := fmt.Sprintf(\"this is msg #%d!\", i)\n        msgChan &lt;- text\n    }\nclose(msgChan) // this will stop the goroutine (when all messages processed)\nwg.Wait() // Wait for all messages to be sent before exiting (may wait for ever is mqtt broker down!)\n</code></pre>\n\n<p><em>Note: This is similar to the solution from Ilya Kaznacheev (if you set workerPoolSize to 1 and make the channel buffered)</em></p>\n\n<p>As your comments indicate that the wait group makes this difficult to understand here is another way of waiting that might be clearer (waitgroups are generally used when you are waiting for multiple things to finnish; in this example we are only waiting for one thing so a simpler approach can be used)</p>\n\n<pre><code>msgChan := make(chan string, 200) // Allow a queue of up to 200 messages\ndone := make(chan struct{}) // channel used to indicate when go routine has finnished\n\ngo func(){ // go routine to send messages from channel\n    for msg := range msgChan {\n        token := c.Publish(\"logs\", 2, false, msg) // Use QOS2 is order is vital\n        token.Wait()\n        // should check for errors here\n    }\n    close(done) // let main routine know we have finnished\n}()\n\nfor i := 0; i &lt; 5; i++ {\n        text := fmt.Sprintf(\"this is msg #%d!\", i)\n        msgChan &lt;- text\n    }\nclose(msgChan) // this will stop the goroutine (when all messages processed)\n&lt;-done // wait for publish go routine to complete\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 12145439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af57d6ccdb32914522bab65ae2b2e012?s=128&d=identicon&r=PG&f=1", "display_name": "Paho Man", "link": "https://stackoverflow.com/users/12145439/paho-man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1444, "favorite_count": 0, "accepted_answer_id": 58255750, "answer_count": 2, "score": 0, "last_activity_date": 1570435449, "creation_date": 1569879239, "question_id": 58175550, "link": "https://stackoverflow.com/questions/58175550/what-is-the-right-way-to-use-this-code-paho-mqtt-as-goroutine-and-pass-message", "title": "What is the right way to use this code (Paho MQTT) as GoRoutine and pass messages via channel to publish via websockets", "body": "<p>As standard code I am using to publish message for testing purpose:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n\n    opts := MQTT.NewClientOptions().AddBroker(\"tcp://127.0.0.1:1883\")\n    opts.SetClientID(\"myclientid_\")\n    opts.SetDefaultPublishHandler(f)\n    opts.SetConnectionLostHandler(connLostHandler)\n\n    opts.OnConnect = func(c MQTT.Client) {\n        fmt.Printf(\"Client connected, subscribing to: test/topic\\n\")\n\n        if token := c.Subscribe(\"logs\", 0, nil); token.Wait() &amp;&amp; token.Error() != nil {\n            fmt.Println(token.Error())\n            os.Exit(1)\n        }\n    }\n\n    c := MQTT.NewClient(opts)\n    if token := c.Connect(); token.Wait() &amp;&amp; token.Error() != nil {\n        panic(token.Error())\n    }\n\n\n    for i := 0; i &lt; 5; i++ {\n        text := fmt.Sprintf(\"this is msg #%d!\", i)\n        token := c.Publish(\"logs\", 0, false, text)\n        token.Wait()\n    }\n\n    time.Sleep(3 * time.Second)\n\n    if token := c.Unsubscribe(\"logs\"); token.Wait() &amp;&amp; token.Error() != nil {\n        fmt.Println(token.Error())\n        os.Exit(1)\n    }\n\n    c.Disconnect(250)\n}\n</code></pre>\n\n<p>This works well ! but passing messages in mass while doing high latency tasks, performance of my program will be low, so I have to use goroutine and channel. </p>\n\n<p>So, I was looking for a way to make a Worker inside goroutine for PUBLISHING messages to the browser using Paho MQTT library for GOlang, I had a hard time to find a better solution that feet my need, but after some searches, I found this code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"strings\"\n    \"time\"\n\n    MQTT \"git.eclipse.org/gitroot/paho/org.eclipse.paho.mqtt.golang.git\"\n    \"linksmart.eu/lc/core/catalog\"\n    \"linksmart.eu/lc/core/catalog/service\"\n)\n\n// MQTTConnector provides MQTT protocol connectivity\ntype MQTTConnector struct {\n    config        *MqttProtocol\n    clientID      string\n    client        *MQTT.Client\n    pubCh         chan AgentResponse\n    subCh         chan&lt;- DataRequest\n    pubTopics     map[string]string\n    subTopicsRvsd map[string]string // store SUB topics \"reversed\" to optimize lookup in messageHandler\n}\n\nconst defaultQoS = 1\n\nfunc (c *MQTTConnector) start() {\n    logger.Println(\"MQTTConnector.start()\")\n\n    if c.config.Discover &amp;&amp; c.config.URL == \"\" {\n        err := c.discoverBrokerEndpoint()\n        if err != nil {\n            logger.Println(\"MQTTConnector.start() failed to start publisher:\", err.Error())\n            return\n        }\n    }\n\n    // configure the mqtt client\n    c.configureMqttConnection()\n\n    // start the connection routine\n    logger.Printf(\"MQTTConnector.start() Will connect to the broker %v\\n\", c.config.URL)\n    go c.connect(0)\n\n    // start the publisher routine\n    go c.publisher()\n}\n\n// reads outgoing messages from the pubCh und publishes them to the broker\nfunc (c *MQTTConnector) publisher() {\n    for resp := range c.pubCh {\n        if !c.client.IsConnected() {\n            logger.Println(\"MQTTConnector.publisher() got data while not connected to the broker. **discarded**\")\n            continue\n        }\n        if resp.IsError {\n            logger.Println(\"MQTTConnector.publisher() data ERROR from agent manager:\", string(resp.Payload))\n            continue\n        }\n        topic := c.pubTopics[resp.ResourceId]\n        c.client.Publish(topic, byte(defaultQoS), false, resp.Payload)\n        // We dont' wait for confirmation from broker (avoid blocking here!)\n        //&lt;-r\n        logger.Println(\"MQTTConnector.publisher() published to\", topic)\n    }\n}\n\n\nfunc (c *MQTTConnector) stop() {\n    logger.Println(\"MQTTConnector.stop()\")\n    if c.client != nil &amp;&amp; c.client.IsConnected() {\n        c.client.Disconnect(500)\n    }\n}\n\nfunc (c *MQTTConnector) connect(backOff int) {\n    if c.client == nil {\n        logger.Printf(\"MQTTConnector.connect() client is not configured\")\n        return\n    }\n    for {\n        logger.Printf(\"MQTTConnector.connect() connecting to the broker %v, backOff: %v sec\\n\", c.config.URL, backOff)\n        time.Sleep(time.Duration(backOff) * time.Second)\n        if c.client.IsConnected() {\n            break\n        }\n        token := c.client.Connect()\n        token.Wait()\n        if token.Error() == nil {\n            break\n        }\n        logger.Printf(\"MQTTConnector.connect() failed to connect: %v\\n\", token.Error().Error())\n        if backOff == 0 {\n            backOff = 10\n        } else if backOff &lt;= 600 {\n            backOff *= 2\n        }\n    }\n\n    logger.Printf(\"MQTTConnector.connect() connected to the broker %v\", c.config.URL)\n    return\n}\n\nfunc (c *MQTTConnector) onConnected(client *MQTT.Client) {\n    // subscribe if there is at least one resource with SUB in MQTT protocol is configured\n    if len(c.subTopicsRvsd) &gt; 0 {\n        logger.Println(\"MQTTPulbisher.onConnected() will (re-)subscribe to all configured SUB topics\")\n\n        topicFilters := make(map[string]byte)\n        for topic, _ := range c.subTopicsRvsd {\n            logger.Printf(\"MQTTPulbisher.onConnected() will subscribe to topic %s\", topic)\n            topicFilters[topic] = defaultQoS\n        }\n        client.SubscribeMultiple(topicFilters, c.messageHandler)\n    } else {\n        logger.Println(\"MQTTPulbisher.onConnected() no resources with SUB configured\")\n    }\n}\n\nfunc (c *MQTTConnector) onConnectionLost(client *MQTT.Client, reason error) {\n    logger.Println(\"MQTTPulbisher.onConnectionLost() lost connection to the broker: \", reason.Error())\n\n    // Initialize a new client and reconnect\n    c.configureMqttConnection()\n    go c.connect(0)\n}\n\nfunc (c *MQTTConnector) configureMqttConnection() {\n    connOpts := MQTT.NewClientOptions().\n        AddBroker(c.config.URL).\n        SetClientID(c.clientID).\n        SetCleanSession(true).\n        SetConnectionLostHandler(c.onConnectionLost).\n        SetOnConnectHandler(c.onConnected).\n        SetAutoReconnect(false) // we take care of re-connect ourselves\n\n    // Username/password authentication\n    if c.config.Username != \"\" &amp;&amp; c.config.Password != \"\" {\n        connOpts.SetUsername(c.config.Username)\n        connOpts.SetPassword(c.config.Password)\n    }\n\n    // SSL/TLS\n    if strings.HasPrefix(c.config.URL, \"ssl\") {\n        tlsConfig := &amp;tls.Config{}\n        // Custom CA to auth broker with a self-signed certificate\n        if c.config.CaFile != \"\" {\n            caFile, err := ioutil.ReadFile(c.config.CaFile)\n            if err != nil {\n                logger.Printf(\"MQTTConnector.configureMqttConnection() ERROR: failed to read CA file %s:%s\\n\", c.config.CaFile, err.Error())\n            } else {\n                tlsConfig.RootCAs = x509.NewCertPool()\n                ok := tlsConfig.RootCAs.AppendCertsFromPEM(caFile)\n                if !ok {\n                    logger.Printf(\"MQTTConnector.configureMqttConnection() ERROR: failed to parse CA certificate %s\\n\", c.config.CaFile)\n                }\n            }\n        }\n        // Certificate-based client authentication\n        if c.config.CertFile != \"\" &amp;&amp; c.config.KeyFile != \"\" {\n            cert, err := tls.LoadX509KeyPair(c.config.CertFile, c.config.KeyFile)\n            if err != nil {\n                logger.Printf(\"MQTTConnector.configureMqttConnection() ERROR: failed to load client TLS credentials: %s\\n\",\n                    err.Error())\n            } else {\n                tlsConfig.Certificates = []tls.Certificate{cert}\n            }\n        }\n\n        connOpts.SetTLSConfig(tlsConfig)\n    }\n\n    c.client = MQTT.NewClient(connOpts)\n}\n</code></pre>\n\n<p>This code do exactly what I am looking for !</p>\n\n<p>But as noob in Golang, I can't figure out how to run <code>START()</code> function inside my main function and what argument to pass ! </p>\n\n<p>And espacially, how I will process to pass messages to the worker (Publisher) using channel ?!</p>\n\n<p>Your help will be appreciated !</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1569880443, "post_id": 58175413, "comment_id": 102732158, "body": "unless you need something you can&#39;t achieve with bash, prefer bash to an home made go implementation. You will get better performance, less bugs."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1569997169, "post_id": 58175413, "comment_id": 102770642, "body": "@mh-cbon: The question is about and tagged as &quot;a Go program.&quot; Your suggestion is not an answer; it&#39;s <a href=\"http://widgetsandshit.com/teddziuba/2010/10/taco-bell-programming.html\" rel=\"nofollow noreferrer\">Taco Bell Programming</a>."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 12145453, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/a99f9227f918363f0bf31c4c593506a5?s=128&d=identicon&r=PG", "display_name": "nhoorical", "link": "https://stackoverflow.com/users/12145453/nhoorical"}, "is_accepted": false, "score": 2, "last_activity_date": 1569880993, "last_edit_date": 1569880993, "creation_date": 1569878889, "answer_id": 58175504, "question_id": 58175413, "link": "https://stackoverflow.com/questions/58175413/text-parsing-of-log-file-in-go/58175504#58175504", "title": "Text parsing of log file in GO", "body": "<p>Use the following code to print the time field for log entries with the value field \"REQUEST-A\".</p>\n\n<pre><code>for scanner.Scan() {\n    line := scanner.Text()\n    if len(line) &lt; 19 {\n        continue\n    }\n    if line[19:] == \" - REQUEST-A\" {\n        fmt.Println(line[:19])\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/48ZPIcooqul\" rel=\"nofollow noreferrer\">Run it on the Go play ground!</a></p>\n\n<p>To write to a file, redirect stdout to a file.</p>\n\n<p>The code above assumes that everything after the timestamp is \"- REQUEST-A\".  Use the following if \"- REQUEST-A\" is a prefix to other data:</p>\n\n<pre><code>const lenTimestamp = 19\nfor scanner.Scan() {\n    line := scanner.Text()\n    if len(line) &lt; lenTimestamp {\n        continue\n    }\n    if strings.HasPrefix(line[lenTimestamp:], \" - REQUEST-A\") {\n        fmt.Println(line[:lenTimestamp])\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/WhjfbKfESiX\" rel=\"nofollow noreferrer\">Run this version on the playground</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1569912125, "post_id": 58175567, "comment_id": 102738738, "body": "Why no regex? Expensive once, enough performance later, much less code."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1569912276, "post_id": 58175567, "comment_id": 102738813, "body": "regexp is slow in comparison to byte comparison and positions manipulation"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1569914944, "post_id": 58175567, "comment_id": 102740042, "body": "@mh-cbon Well, I benchmarked both approaches (can push the code, if you want), and either way we are talking of a one digit &#181;s/op. Not sure wether this is worth it. In a text parsing library? May be. In a Go implementation of an awk script? May be not."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1569916561, "post_id": 58175567, "comment_id": 102740809, "body": "it depends your level of requirement, your input, the time you are ok to compute this. But still i see a 5 times difference between the two approaches. It can make a difference. (<code>BenchmarkRe-4     \t  100000\t     12350 ns&#47;op\t    4496 B&#47;op\t      13 allocs&#47;op</code> / <code>BenchmarkByte-4   \t 1000000\t      2142 ns&#47;op\t    4304 B&#47;op\t       7 allocs&#47;op</code>)"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1569997279, "post_id": 58175567, "comment_id": 102770669, "body": "@MarkusWMahlberg: Your <a href=\"https://play.golang.org/p/R2D_BeiJvx9\" rel=\"nofollow noreferrer\">Go solution</a>  is inefficient. I&#39;ve added a benchmark."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1569999348, "post_id": 58175567, "comment_id": 102771398, "body": "Interestingly, I get rather different values in my benchmarks. See <a href=\"https://github.com/mwmahlberg/textparsebench\" rel=\"nofollow noreferrer\">github.com/mwmahlberg/textparsebench</a>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1569996749, "last_edit_date": 1569996749, "creation_date": 1569879326, "answer_id": 58175567, "question_id": 58175413, "link": "https://stackoverflow.com/questions/58175413/text-parsing-of-log-file-in-go/58175567#58175567", "title": "Text parsing of log file in GO", "body": "<p>In Go, we try to be efficient. Don't do things unneccessarily.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    lines, requestA := 0, 0\n    f, err := os.Open(\"request.log\")\n    if err != nil {\n        fmt.Print(\"There has been an error!: \", err)\n    }\n    defer f.Close()\n\n    scanner := bufio.NewScanner(f)\n    for scanner.Scan() {\n        lines++\n        // filter request a\n        line := scanner.Bytes()\n        if len(line) &lt;= 30 || line[30] != 'A' {\n            continue\n        }\n        if !bytes.Equal(line[22:], []byte(\"REQUEST-A\")) {\n            continue\n        }\n        requestA++\n        request := string(line)\n\n        // handle request a\n        fmt.Println(request)\n    }\n    if err := scanner.Err(); err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(lines, requestA)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run request.go\n\n2019-09-30T04:17:02 - REQUEST-A\n2019-09-30T04:20:02 - REQUEST-A\n2019-09-30T04:21:02 - REQUEST-A\n6 3\n\n$ cat request.log\n2019-09-30T04:17:02 - REQUEST-A\n2019-09-30T04:18:02 - REQUEST-C\n2019-09-30T04:19:02 - REQUEST-B\n2019-09-30T04:20:02 - REQUEST-A\n2019-09-30T04:21:02 - REQUEST-A\n2019-09-30T04:22:02 - REQUEST-B\n</code></pre>\n\n<hr>\n\n<p>To emphasize the importance of efficiency (logs can be very large), let's run a benchmark against <a href=\"https://stackoverflow.com/users/1296707/markus-w-mahlberg\">Markus W Mahlberg</a>'s solution: <a href=\"https://play.golang.org/p/R2D_BeiJvx9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/R2D_BeiJvx9</a>.</p>\n\n<pre><code>$ go test log_test.go -bench=. -benchmem\nBenchmarkPeterSO-4   21285     56953 ns/op    4128 B/op      2 allocs/op\nBenchmarkMarkusM-4     649   1817868 ns/op   84747 B/op   2390 allocs/op\n</code></pre>\n\n<p><code>log_test.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"regexp\"\n    \"strings\"\n    \"testing\"\n)\n\nvar requestLog = `\n2019-09-30T04:17:02 - REQUEST-A\n2019-09-30T04:18:02 - REQUEST-C\n2019-09-30T04:19:02 - REQUEST-B\n2019-09-30T04:20:02 - REQUEST-A\n2019-09-30T04:21:02 - REQUEST-A\n2019-09-30T04:22:02 - REQUEST-B\n`\n\nvar benchLog = strings.Repeat(requestLog[1:], 256)\n\nfunc BenchmarkPeterSO(b *testing.B) {\n    for N := 0; N &lt; b.N; N++ {\n        scanner := bufio.NewScanner(strings.NewReader(benchLog))\n        for scanner.Scan() {\n            // filter request a\n            line := scanner.Bytes()\n            if len(line) &lt;= 30 || line[30] != 'A' {\n                continue\n            }\n            if !bytes.Equal(line[22:], []byte(\"REQUEST-A\")) {\n                continue\n            }\n            request := string(line)\n            // handle request a\n            _ = request\n        }\n        if err := scanner.Err(); err != nil {\n            b.Fatal(err)\n        }\n    }\n}\n\nfunc BenchmarkMarkusM(b *testing.B) {\n    for N := 0; N &lt; b.N; N++ {\n        var re *regexp.Regexp = regexp.MustCompile(`^(\\S*) - REQUEST-A$`)\n        scanner := bufio.NewScanner(strings.NewReader(benchLog))\n        var res []string\n        for scanner.Scan() {\n            if res = re.FindStringSubmatch(scanner.Text()); len(res) &gt; 0 {\n                _ = res[1]\n            }\n        }\n        if err := scanner.Err(); err != nil {\n            b.Fatal(err)\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1569997108, "post_id": 58179432, "comment_id": 102770614, "body": "The question is about and tagged as &quot;a Go program.&quot; Your first solution is not an answer; it&#39;s <a href=\"http://widgetsandshit.com/teddziuba/2010/10/taco-bell-programming.html\" rel=\"nofollow noreferrer\">Taco Bell Programming</a>. Your second solution in Go appears to be inefficient; see my answer."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1569997452, "post_id": 58179432, "comment_id": 102770721, "body": "@peterSO LoC-wise... As said, I benchmarked both solutions, and we are not talking orders of magnitude, though significant. Your solution is a bit more than 4 times faster: 1.4&#181;s vs 5.8&#181;s per op on average. It is safe to assume that I/O operations will more likely be the bottleneck, so I went for less LoC as being efficient. And I find it important to think outside the box, according to the saying \u201eIf all you have is a hammer, everything starts to look like a nail.\u201c: The first solution provides the requested result with zero implementation effort."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1569997943, "post_id": 58179432, "comment_id": 102770863, "body": "I would be interested to see your benchmark code. Add it to your answer."}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1569912653, "creation_date": 1569912653, "answer_id": 58179432, "question_id": 58175413, "link": "https://stackoverflow.com/questions/58175413/text-parsing-of-log-file-in-go/58179432#58179432", "title": "Text parsing of log file in GO", "body": "<p>No need for a Go program if you are on a Linux or Mac:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ echo \"2019-09-30T04:17:02 - REQUEST-A\n2019-09-30T04:18:02 - REQUEST-C\n2019-09-30T04:19:02 - REQUEST-B\n2019-09-30T04:20:02 - REQUEST-A\n2019-09-30T04:21:02 - REQUEST-A\n2019-09-30T04:22:02 - REQUEST-B\" | awk '/REQUEST-A/{print $1}' | tee request.log\n2019-09-30T04:17:02\n2019-09-30T04:20:02\n2019-09-30T04:21:02\n</code></pre>\n\n<p>However, if you really want to implement this in Go:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"regexp\"\n    \"strings\"\n)\n\nconst input = `\n2019-09-30T04:17:02 - REQUEST-A\n2019-09-30T04:18:02 - REQUEST-C\n2019-09-30T04:19:02 - REQUEST-B\n2019-09-30T04:20:02 - REQUEST-A\n2019-09-30T04:21:02 - REQUEST-A\n2019-09-30T04:22:02 - REQUEST-B\n`\n\nvar scanner = bufio.NewScanner(strings.NewReader(input))\n\n// Here comes the magic: We create an anonymous group containing all\n// non-whitespace characters up to the first blank. Since it is\n// a group, we can easily extract it later down the road.\nvar re *regexp.Regexp = regexp.MustCompile(`^(\\S*) - REQUEST-A$`)\n\nfunc main() {\n    var res []string\n    for scanner.Scan() {\n        // We use re.FindStringSubmatch here, as it actually kills two\n        // birds with one stone: We check wether it is REQUEST-A\n        // and the anonymous group of the regexp contains what we are looking for.\n        if res = re.FindStringSubmatch(scanner.Text()); len(res) &gt; 0 {\n            fmt.Println(res[1])\n        }\n    }\n}\n</code></pre>\n\n<p><kbd><strong><a href=\"https://play.golang.org/p/R2D_BeiJvx9\" rel=\"nofollow noreferrer\">Run on playground</a></strong></kbd></p>\n"}], "owner": {"reputation": 322, "user_id": 8399906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4b20fa1357bb11e0ba2eab0d5b358ed?s=128&d=identicon&r=PG", "display_name": "CJW", "link": "https://stackoverflow.com/users/8399906/cjw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1903, "favorite_count": 2, "accepted_answer_id": 58175567, "answer_count": 3, "score": 3, "last_activity_date": 1569996749, "creation_date": 1569878232, "question_id": 58175413, "link": "https://stackoverflow.com/questions/58175413/text-parsing-of-log-file-in-go", "title": "Text parsing of log file in GO", "body": "<p>Go newbie here!</p>\n\n<p>I am trying to put together a Go program that will parse a log file and return specific information on lines matched.</p>\n\n<p>To give an example of what I am trying to achieve I would start with a log file that looks like this:</p>\n\n<pre><code>2019-09-30T04:17:02 - REQUEST-A\n2019-09-30T04:18:02 - REQUEST-C\n2019-09-30T04:19:02 - REQUEST-B\n2019-09-30T04:20:02 - REQUEST-A\n2019-09-30T04:21:02 - REQUEST-A\n2019-09-30T04:22:02 - REQUEST-B\n</code></pre>\n\n<p>From here I would want to extract all \"REQUEST-A\" and either print the time the request occurred to the terminal or to a file.</p>\n\n<p>I have tried using os.Open and scanner and I can use scanner.Text to log that it has found occurrence of my string, like so:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"strings\"\n)\n\nfunc main() {\n    request := 0\n    f, err := os.Open(\"request.log\")\n    if err != nil {\n        fmt.Print(\"There has been an error!: \", err)\n    }\n    defer f.Close()\n    scanner := bufio.NewScanner(f)\n\n    for scanner.Scan() {\n        if strings.Contains(scanner.Text(), \"REQUEST-A\") {\n            request = request + 1\n        }\n\n        if err := scanner.Err(); err != nil {\n        }\n        fmt.Println(request)\n    }\n}\n</code></pre>\n\n<p>But I am unsure of how to take this to use it to retrieve the information I am after.\nNormally I would use Bash for this but I thought I would branch out and see if I could use Go.\nAny advise would be appreciated.</p>\n"}, {"tags": ["go", "memory-management", "return", "heap-memory", "rvo"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1569873883, "post_id": 58174563, "comment_id": 102729939, "body": "This is unspecified and may vary from compiler to compiler. Note that your assumptions about being heap-/stack-allocated are unfounded too. Not to speak of inlining calls to NewFoo."}, {"owner": {"reputation": 2854, "user_id": 6923555, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-N8FUb3l8l44/AAAAAAAAAAI/AAAAAAAAAio/1HlhcKxsTPo/photo.jpg?sz=128", "display_name": "rodrigocfd", "link": "https://stackoverflow.com/users/6923555/rodrigocfd"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1569873964, "post_id": 58174563, "comment_id": 102729975, "body": "@Volker So Go may deliberately alloc a struct in the heap?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 3, "creation_date": 1569874022, "post_id": 58174563, "comment_id": 102730002, "body": "In general, the semantics will be equivalent of copying the struct, but whether or not copying really takes place depends on the implementation. If the function is inlined, there would be no need for copying."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 3, "creation_date": 1569874089, "post_id": 58174563, "comment_id": 102730028, "body": "Yes it can decide. It uses escape analysis <a href=\"https://golang.org/doc/faq#stack_or_heap\" rel=\"nofollow noreferrer\">golang.org/doc/faq#stack_or_heap</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1720, "user_id": 6205738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a08adf9353636c19dc5a4e45df11d8e?s=128&d=identicon&r=PG&f=1", "display_name": "Saty", "link": "https://stackoverflow.com/users/6205738/saty"}, "is_accepted": true, "score": 1, "last_activity_date": 1570111316, "last_edit_date": 1570111316, "creation_date": 1569927410, "answer_id": 58183378, "question_id": 58174563, "link": "https://stackoverflow.com/questions/58174563/will-go-make-a-copy-of-my-struct-if-i-return-by-value-instead-of-a-pointer/58183378#58183378", "title": "Will Go make a copy of my struct if I return by value, instead of a pointer?", "body": "<p>You can check it by following these steps: </p>\n\n<ol>\n<li><p>Write your program in a file say <code>main.go</code> like this: <a href=\"https://play.golang.org/p/iwxai0EHa40\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iwxai0EHa40</a></p></li>\n<li><p>Execute the command <code>go build -gcflags=-m main.go</code></p></li>\n<li><p>See the output to really know if it is being copied/inlined. In my case the output I get is: </p></li>\n</ol>\n\n<pre><code># command-line-arguments\n./main.go:13:6: can inline NewFoo\n./main.go:17:6: can inline main\n./main.go:18:15: inlining call to NewFoo\n./main.go:19:12: inlining call to fmt.Printf\n./main.go:19:24: fff.num escapes to heap\n./main.go:19:12: io.Writer(os.Stdout) escapes to heap\n./main.go:19:12: main []interface {} literal does not escape\n&lt;autogenerated&gt;:1: os.(*File).close .this does not escape\n</code></pre>\n\n<p>This procedure you can follow in any Go program to check if there is any unnecessary heap allocation occurring in your program which you can avoid. </p>\n\n<p><a href=\"https://tennexas.com/how-to-check-improve-performance-in-go/\" rel=\"nofollow noreferrer\">Here is a short article</a> which goes through various ways you can make your program more efficient.</p>\n"}], "owner": {"reputation": 2854, "user_id": 6923555, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-N8FUb3l8l44/AAAAAAAAAAI/AAAAAAAAAio/1HlhcKxsTPo/photo.jpg?sz=128", "display_name": "rodrigocfd", "link": "https://stackoverflow.com/users/6923555/rodrigocfd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 348, "favorite_count": 0, "accepted_answer_id": 58183378, "answer_count": 1, "score": 0, "last_activity_date": 1570111316, "creation_date": 1569873664, "question_id": 58174563, "link": "https://stackoverflow.com/questions/58174563/will-go-make-a-copy-of-my-struct-if-i-return-by-value-instead-of-a-pointer", "title": "Will Go make a copy of my struct if I return by value, instead of a pointer?", "body": "<p>Take this example:</p>\n\n<pre><code>type Foo struct {\n    num int\n}\n\n// func NewFoo() *Foo { // returning a pointer\n//     return &amp;Foo{33}\n// }\n\nfunc NewFoo() Foo { // NOT returning a pointer\n    return Foo{33}\n}\n\nfunc main() {\n    fff := NewFoo()\n    fmt.Printf(\"%d\\n\", fff.num)\n}\n</code></pre>\n\n<p>If <code>NewFoo</code> returns a pointer, I understand the object is kept in the heap, and <code>fff</code> receives the pointer to the very same heap-allocated object.</p>\n\n<p>Now, with the second implementation of <code>NewFoo</code>, which won't return a pointer, will Go return a <strong>copy</strong> of the stack-allocated struct, or is there something like <a href=\"https://en.wikipedia.org/wiki/Copy_elision\" rel=\"nofollow noreferrer\">C++'s RVO</a> taking place?</p>\n"}, {"tags": ["go", "struct", "reflection", "interface", "embedding"], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 2629302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/564f75900af86635a22348bef63ad11b?s=128&d=identicon&r=PG", "display_name": "Arka Roy", "link": "https://stackoverflow.com/users/2629302/arka-roy"}, "edited": false, "score": 0, "creation_date": 1569871458, "post_id": 58173808, "comment_id": 102728901, "body": "Thanks for your suggestion. It seems to fulfil my requirement. I will give it a try asap. I wonder if there is any way to pass the whole struct (or pointer of the struct) instead of passing only the <code>Model</code> (if I embed another struct and wish to update a field of that in the same function). Can you give any example on how to do it if I want to use reflection on the embedding struct (Fruit or Animal)? Thanks a lot."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 141, "user_id": 2629302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/564f75900af86635a22348bef63ad11b?s=128&d=identicon&r=PG", "display_name": "Arka Roy", "link": "https://stackoverflow.com/users/2629302/arka-roy"}, "edited": false, "score": 0, "creation_date": 1569871613, "post_id": 58173808, "comment_id": 102728962, "body": "You can&#39;t pass a struct to a function and expect the function to find an embedded struct in it. So, you can&#39;t do it without reflection. That said, it is usually not necessary. If you ever need to do this, you probably are trying to emulate something you did in another language."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 4, "last_activity_date": 1569870371, "last_edit_date": 1569870371, "creation_date": 1569870072, "answer_id": 58173808, "question_id": 58173685, "link": "https://stackoverflow.com/questions/58173685/golang-update-struct-field-inside-function-passed-as-interface/58173808#58173808", "title": "Golang update struct field inside function passed as interface", "body": "<p>Assuming you want to achieve this via reflection: first of all, you have to pass a pointer to the struct. You're now passing a copy of the struct, so any modifications done in <code>update</code> will be done on the copy, not on the instance you passed in. Then, you can lookup the field <code>UpdatedAt</code> in the interface passed in, and set it.</p>\n\n<p>That said, that's probably not the best way to do this. Another way of doing this without reflection is:</p>\n\n<pre><code>func update(in *Model) {\n   in.UpdatedAt = time.Now()\n}\n\nfunc main() {\n   apple := &amp;Fruit{}\n   update(&amp;apple.Model)\n}\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>func (in *Model) update() {\n   in.UpdatedAt = time.Now()\n}\n\nfunc main() {\n   apple := &amp;Fruit{}\n   apple.update()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 5, "last_activity_date": 1569870346, "creation_date": 1569870346, "answer_id": 58173868, "question_id": 58173685, "link": "https://stackoverflow.com/questions/58173685/golang-update-struct-field-inside-function-passed-as-interface/58173868#58173868", "title": "Golang update struct field inside function passed as interface", "body": "<p>I'd avoid <code>reflect</code> or <code>interface{}</code> if you're starting to learn go. Beginners usually fall back on them like a <code>void *</code> crutch. Try to use concrete types or well defined interfaces.</p>\n\n<p>This should get you going:</p>\n\n<pre><code>type Timestamper interface {\n    Update()\n    UpdatedTime() time.Time\n}\n\ntype Model struct {\n    updated time.Time\n}\n\nfunc (m *Model) Update()                { m.updated = time.Now() }\nfunc (m *Model) UpdatedTime() time.Time { return m.updated }\n\ntype Fruit struct {\n    Model\n    label string\n}\n\ntype Animal struct {\n    Model\n    label string\n}\n\n// update will work with a `Model` `Animal` or `Fruit`\n// as they all implement the `Timestamper` interface`\nfunc update(v Timestamper) {\n    v.Update()\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/27yDVLr-zqd\" rel=\"noreferrer\">https://play.golang.org/p/27yDVLr-zqd</a></p>\n"}], "owner": {"reputation": 141, "user_id": 2629302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/564f75900af86635a22348bef63ad11b?s=128&d=identicon&r=PG", "display_name": "Arka Roy", "link": "https://stackoverflow.com/users/2629302/arka-roy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1482, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1569870371, "creation_date": 1569869585, "question_id": 58173685, "link": "https://stackoverflow.com/questions/58173685/golang-update-struct-field-inside-function-passed-as-interface", "title": "Golang update struct field inside function passed as interface", "body": "<p>I am new to go (golang). That is why my question may be irrelevant (or impossible to answer).</p>\n\n<p>I have created two structs. Both of these embed another struct. Now I want to update a field of the embedded struct inside a function.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"time\"\n)\n\ntype Model struct {\n    UpdatedAt time.Time\n}\n\ntype Fruit struct {\n    Model\n    label string\n}\n\ntype Animal struct {\n    Model\n    label string\n}\n\nfunc update(v interface{}) {\n    reflectType := reflect.TypeOf(v)\n    reflectKind := reflectType.Kind()\n    if reflectKind == reflect.Ptr {\n        reflectType = reflectType.Elem()\n    }\n    m := reflect.Zero(reflectType)\n    fmt.Println(m)\n}\n\nfunc main() {\n    apple := &amp;Fruit{\n        label: \"Apple\",\n    }\n    tiger := &amp;Animal{\n        label: \"Tiger\",\n    }\n    update(apple)\n    update(tiger)\n    fmt.Println(apple)\n    fmt.Println(tiger)\n}\n\n</code></pre>\n\n<p>I wish to implement the <code>update</code> function so that it will put the current time in <code>UpdatedAt</code> of the passed struct. But I am not able to do this.</p>\n\n<p>In this case, the field of <code>Fruit</code> and <code>Animal</code> is same: <code>label</code>. But it will not always be. Please keep that in mind when providing your suggestions.</p>\n\n<p>Any guidance would be much appreciated.</p>\n"}, {"tags": ["multithreading", "go", "memory-model"], "answers": [{"comments": [{"owner": {"reputation": 4969, "user_id": 151741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a0415ca8483fa8eefed7778824b3d68?s=128&d=identicon&r=PG", "display_name": "Jonathan Oliver", "link": "https://stackoverflow.com/users/151741/jonathan-oliver"}, "edited": false, "score": 0, "creation_date": 1569883894, "post_id": 58173664, "comment_id": 102732952, "body": "I found the section in the memory model &quot;Channel communication&quot; which confirms your answer: <a href=\"https://golang.org/ref/mem#tmp_7\" rel=\"nofollow noreferrer\">golang.org/ref/mem#tmp_7</a>. It also has a small code snippet which demonstrates the fences/barriers on channel operations."}, {"owner": {"reputation": 113, "user_id": 6899569, "user_type": "registered", "profile_image": "https://graph.facebook.com/954323951340089/picture?type=large", "display_name": "shota silagadze", "link": "https://stackoverflow.com/users/6899569/shota-silagadze"}, "edited": false, "score": 0, "creation_date": 1580114051, "post_id": 58173664, "comment_id": 105977124, "body": "I was searching the same. In documentation they don&#39;t mention OTHER operations that happen before write is visible in another thread after read they just talk about channel operations specifically. Could you point to where this is mentioned."}, {"owner": {"reputation": 113, "user_id": 6899569, "user_type": "registered", "profile_image": "https://graph.facebook.com/954323951340089/picture?type=large", "display_name": "shota silagadze", "link": "https://stackoverflow.com/users/6899569/shota-silagadze"}, "edited": false, "score": 0, "creation_date": 1580114078, "post_id": 58173664, "comment_id": 105977137, "body": "and is that guarantee the same for mutexes?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 113, "user_id": 6899569, "user_type": "registered", "profile_image": "https://graph.facebook.com/954323951340089/picture?type=large", "display_name": "shota silagadze", "link": "https://stackoverflow.com/users/6899569/shota-silagadze"}, "edited": false, "score": 0, "creation_date": 1580135672, "post_id": 58173664, "comment_id": 105988342, "body": "@shotasilagadze <a href=\"https://golang.org/ref/mem#tmp_8\" rel=\"nofollow noreferrer\">golang.org/ref/mem#tmp_8</a> talks about mutexes. The next section talks about <code>sync.Once</code>. The <code>sync&#47;atomic</code> package functions also offer some guarantees, and there were some discussions about adding those to the memory model. There is a github issue discussing this, I don&#39;t have the link atm."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 4, "last_activity_date": 1569869529, "creation_date": 1569869529, "answer_id": 58173664, "question_id": 58173528, "link": "https://stackoverflow.com/questions/58173528/go-memory-model-happens-before-channels-with-shared-state/58173664#58173664", "title": "Go Memory Model Happens Before (Channels with Shared State)", "body": "<p>The memory model guarantees that when the channel write operation executes, all operations in that goroutine that comes before the channel operation are visible. So in your example, the \"unintended race condition\" cannot happen, because when the channel is read, the assignment happened in the goroutine is visible. This, of course, assumes that there isn't another goroutine that's writing to that same variable. If there was another goroutine writing to that same variable, then you would need to synchronize that goroutine as well to avoid the race.</p>\n"}], "owner": {"reputation": 4969, "user_id": 151741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a0415ca8483fa8eefed7778824b3d68?s=128&d=identicon&r=PG", "display_name": "Jonathan Oliver", "link": "https://stackoverflow.com/users/151741/jonathan-oliver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 58173664, "answer_count": 1, "score": 1, "last_activity_date": 1569869529, "creation_date": 1569868930, "question_id": 58173528, "link": "https://stackoverflow.com/questions/58173528/go-memory-model-happens-before-channels-with-shared-state", "title": "Go Memory Model Happens Before (Channels with Shared State)", "body": "<p>I'm trying to more fully understand the nature of the Happens-Before relationship between channels and other shared state. Specifically, I want to see if some kind of memory fence is created on a channel send and receive operation.</p>\n\n<p>For example, if I send a message on a channel, do all other operations surrounding modification of shared state \"happen before\" the send/receive operation. In my particular example, I'm only ever writing from a single go routine and then reading from a single go routine.</p>\n\n<p>(Aside: the obvious answer in the example below is to put an instance of the <code>Person</code> struct on the channel directly, but that's not what I'm asking.)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nfunc main() {\n    channel := make(chan int, 128)\n\n    go func() {\n        person := &amp;sharedState[0]\n        person.Name = \"Hello, World!\"\n        channel &lt;- 0\n    }()\n\n    index := &lt;-channel\n    person := sharedState[index]\n    if person.Name != \"Hello, World!\" {\n        // unintended race condition\n    }\n}\n\ntype Person struct{ Name string }\n\nvar sharedState = make([]Person, 1024)\n</code></pre>\n"}, {"tags": ["firebase", "go", "error-code"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1569859024, "post_id": 58171187, "comment_id": 102723893, "body": "The messaging package provides the IsXXX functions to check for specific errors (<a href=\"https://godoc.org/firebase.google.com/go/messaging#IsMismatchedCredential\" rel=\"nofollow noreferrer\">example</a>).  If those don&#39;t give you want you need, then use the reflect package to get the <a href=\"https://godoc.org/firebase.google.com/go/internal#FirebaseError.Code\" rel=\"nofollow noreferrer\">error code</a>."}, {"owner": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "edited": false, "score": 0, "creation_date": 1569866718, "post_id": 58171187, "comment_id": 102726913, "body": "<code>err.Error()</code> will give you the error as a string, based on <a href=\"https://github.com/firebase/firebase-admin-go/blob/master/messaging/messaging.go#L855-L881\" rel=\"nofollow noreferrer\">this function</a> in that lib it looks like the error code should be present in the literal error text so you could probably just get away with parsing the result of <code>err.Error()</code>"}], "owner": {"reputation": 193, "user_id": 1006296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71f6af059900efa52884d8af797f3ec9?s=128&d=identicon&r=PG", "display_name": "Gayatri", "link": "https://stackoverflow.com/users/1006296/gayatri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 225, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1569865635, "creation_date": 1569858161, "last_edit_date": 1569865635, "question_id": 58171187, "link": "https://stackoverflow.com/questions/58171187/handling-error-codes-for-with-firebase-sdk", "title": "Handling error codes for with Firebase SDK", "body": "<p>I am using <code>\"firebase.google.com/go/messaging\"</code> to send android notifications. I want to read out the error code of the response returned. It seems like the Go libs don't expose it. Is there a way I can achieve this?</p>\n\n<pre><code>res, err := f.client.Send(ctx, m.Message)\n</code></pre>\n\n<p>This is the function I am calling : <a href=\"https://github.com/firebase/firebase-admin-go/blob/master/messaging/messaging.go#L699-L704\" rel=\"nofollow noreferrer\">https://github.com/firebase/firebase-admin-go/blob/master/messaging/messaging.go#L699-L704</a></p>\n"}, {"tags": ["sql-server", "go", "go-gorm"], "comments": [{"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1569858289, "post_id": 58171098, "comment_id": 102723544, "body": "That&#39;s not a valid SQL Server Express string. SQL Server Express installs only named instances. Use <code>localhost\\\\SQLEXPRESS</code> instead of <code>localhost</code>"}, {"owner": {"reputation": 816, "user_id": 2359010, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/612536ffc2d4cb3a96b794da6113b8e9?s=128&d=identicon&r=PG", "display_name": "Arlo Guthrie", "link": "https://stackoverflow.com/users/2359010/arlo-guthrie"}, "reply_to_user": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1569858471, "post_id": 58171098, "comment_id": 102723636, "body": "I have tried various permutations of that, but gorm does not like when you insert &quot;\\\\&quot; into the connection string.  The result is:  invalid character &quot;\\\\&quot; in host name."}, {"owner": {"reputation": 816, "user_id": 2359010, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/612536ffc2d4cb3a96b794da6113b8e9?s=128&d=identicon&r=PG", "display_name": "Arlo Guthrie", "link": "https://stackoverflow.com/users/2359010/arlo-guthrie"}, "reply_to_user": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1569859968, "post_id": 58171098, "comment_id": 102724278, "body": "I realize that doesn&#39;t look like a SQL Server connect string, this is GORM&#39;s interpretation of a SQL Server connect string.  :D"}], "answers": [{"comments": [{"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 1, "creation_date": 1569858736, "post_id": 58171288, "comment_id": 102723763, "body": "This would apply only if the connection string pointed to the correct named database. It doesn&#39;t"}, {"owner": {"reputation": 1201, "user_id": 4290740, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5a7e3744eb77857d283039b3c1d07c77?s=128&d=identicon&r=PG&f=1", "display_name": "cdrrr", "link": "https://stackoverflow.com/users/4290740/cdrrr"}, "reply_to_user": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1569858875, "post_id": 58171288, "comment_id": 102723828, "body": "@PanagiotisKanavos - totally agree and thanks for mentioning. Just wanted to expose how to configure and open the port in case of a pointed connection string."}, {"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 1, "creation_date": 1569858915, "post_id": 58171288, "comment_id": 102723843, "body": "There&#39;s a highly upvoted question that shows how to troubleshoot networking issues. If that were the case here the question would be closed as a duplicate already"}, {"owner": {"reputation": 1201, "user_id": 4290740, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5a7e3744eb77857d283039b3c1d07c77?s=128&d=identicon&r=PG&f=1", "display_name": "cdrrr", "link": "https://stackoverflow.com/users/4290740/cdrrr"}, "reply_to_user": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1569858973, "post_id": 58171288, "comment_id": 102723872, "body": "@PanagiotisKanavos - there is. A solution I&#39;ve posted the link to."}, {"owner": {"reputation": 816, "user_id": 2359010, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/612536ffc2d4cb3a96b794da6113b8e9?s=128&d=identicon&r=PG", "display_name": "Arlo Guthrie", "link": "https://stackoverflow.com/users/2359010/arlo-guthrie"}, "edited": false, "score": 0, "creation_date": 1569859718, "post_id": 58171288, "comment_id": 102724174, "body": "This is a partial answer.  The final thing I did to make it work correctly was to go to SQL Server Configuration Manager -- &gt; SQL Server Network Configuration -- &gt; TCP/IP (double click) -- &gt; IP Addresses -- &gt; Scroll all the way down to IPALL -- &gt; Set port to 1433"}, {"owner": {"reputation": 1201, "user_id": 4290740, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5a7e3744eb77857d283039b3c1d07c77?s=128&d=identicon&r=PG&f=1", "display_name": "cdrrr", "link": "https://stackoverflow.com/users/4290740/cdrrr"}, "reply_to_user": {"reputation": 816, "user_id": 2359010, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/612536ffc2d4cb3a96b794da6113b8e9?s=128&d=identicon&r=PG", "display_name": "Arlo Guthrie", "link": "https://stackoverflow.com/users/2359010/arlo-guthrie"}, "edited": false, "score": 0, "creation_date": 1569859817, "post_id": 58171288, "comment_id": 102724210, "body": "@ArloGuthrie Partial or not, it helped you to get to the result. If you consider, accept my answer. Thanks!"}], "tags": [], "owner": {"reputation": 1201, "user_id": 4290740, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5a7e3744eb77857d283039b3c1d07c77?s=128&d=identicon&r=PG&f=1", "display_name": "cdrrr", "link": "https://stackoverflow.com/users/4290740/cdrrr"}, "is_accepted": true, "score": 6, "last_activity_date": 1569858579, "creation_date": 1569858579, "answer_id": 58171288, "question_id": 58171098, "link": "https://stackoverflow.com/questions/58171098/connecting-to-sqlserver-with-gorm/58171288#58171288", "title": "Connecting to SQLServer with GORM", "body": "<p>TCP port 1433 is the default port for <code>SQL Server</code>. This port is also the official Internet Assigned Number Authority (IANA) socket number for SQL Server. Client systems use TCP 1433 to connect to the database engine; SQL Server Management Studio (SSMS) uses the port to manage SQL Server instances across the network. You can reconfigure <code>SQL Server</code> to listen on a different port, but 1433 is by far the most common implementation.</p>\n\n<p>However, if you still want to open it, follow the below steps:</p>\n\n<p><strong>Step 1</strong> </p>\n\n<p>Probably TCP/IP channel is disabled under <code>SQL Server Configuration Manager</code>. SO go there and enable all TCP/IP options.</p>\n\n<p><a href=\"https://i.stack.imgur.com/r5cgx.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/r5cgx.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>Step 2</strong></p>\n\n<p>Just in case at the same place <code>SQL Server Configuration Manager</code> make sure you have 1433 port.</p>\n\n<p><a href=\"https://i.stack.imgur.com/ZXwxJ.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/ZXwxJ.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>Step 3</strong></p>\n\n<p>Make sure that SQL server is configured to allow remote connections. Use MS SQL Management Studio and right click on the top node which server itself.</p>\n\n<p><a href=\"https://i.stack.imgur.com/4shXe.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/4shXe.png\" alt=\"enter image description here\"></a></p>\n\n<p>Credit from the solution found <a href=\"https://stackoverflow.com/questions/13304249/firewall-port-1433-not-opening/13306515\">here</a>.</p>\n"}], "owner": {"reputation": 816, "user_id": 2359010, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/612536ffc2d4cb3a96b794da6113b8e9?s=128&d=identicon&r=PG", "display_name": "Arlo Guthrie", "link": "https://stackoverflow.com/users/2359010/arlo-guthrie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1226, "favorite_count": 0, "accepted_answer_id": 58171288, "answer_count": 1, "score": 0, "last_activity_date": 1576695103, "creation_date": 1569857727, "last_edit_date": 1576695103, "question_id": 58171098, "link": "https://stackoverflow.com/questions/58171098/connecting-to-sqlserver-with-gorm", "title": "Connecting to SQLServer with GORM", "body": "<p>I am using the statement below to try and open a connection to the latest download of SQLServer Express.</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/mssql\"\n    \"log\"\n)\n\n        db, err := gorm.Open(\"mssql\", \"sqlserver://tony:Password6!@localhost:1433?database=go_user\")\n</code></pre>\n\n<p>The statement results in an error:</p>\n\n<blockquote>\n  <p>2019/09/30 10:29:16 Unable to open tcp connection with host\n  'localhost:1433': dial tcp [::1]:1433: connectex: No connection could\n  be made because the target machine actively refused it. panic: Unable\n  to open tcp connection with host 'localhost:1433': dial tcp\n  [::1]:1433: connectex: No connection could be made because the target\n  machine actively refused it.</p>\n</blockquote>\n\n<p>Is anyone successfully connecting to SQLServer Express with GORM on Golang?</p>\n"}, {"tags": ["image", "http", "go", "get"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1569851299, "post_id": 58169201, "comment_id": 102719813, "body": "I don&#39;t see any error output here. What exactly is the problem?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1569851563, "post_id": 58169201, "comment_id": 102719966, "body": "&quot;my client can&#39;t decode correctly the image sent&quot; meaning what? Decode it into what? What are you trying to do with it?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5169981"}, "edited": false, "score": 0, "creation_date": 1569851792, "post_id": 58169201, "comment_id": 102720116, "body": "I don&#39;t understand why the output printed is different in the client and in the server. Or perhaps it&#39;s just a different format, but I was expecting the client to write: &quot;Pixels: &amp;{[164 16] 2 (0,0)-(1,1)}&quot; as well"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1569852064, "post_id": 58169201, "comment_id": 102720293, "body": "The encoded image is a image.Gray16. The decoded  image is a image.YCbCr. These images types have different representations and therefore print differently.  Decode from JPEG will always return a image.YCbCr."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1569852140, "post_id": 58169201, "comment_id": 102720332, "body": "In server.go <code>img</code> is of type <code>image.Gray16</code> and in client.go <code>m</code> is of type <code>image.Image</code>. Different things will be printed differently. If new to Go: Take the Tour of Go and focus on the interface types."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1569852224, "post_id": 58169201, "comment_id": 102720371, "body": "Note that this is totally <b>unrelated</b> to HTTP and all that complication."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1569855098, "post_id": 58169201, "comment_id": 102721924, "body": "&quot;I am trying to send an image between a Client and a Server via an HTTP GET request&quot; -- this is not possible. To send an image from client to server you must use POST or PUT, because a GET request has no body."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1569857572, "post_id": 58169201, "comment_id": 102723182, "body": "@Flimzy  The prose in the question can be more clear about the direction of the request, but the code clearly shows that the client is getting the image from the server."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user5169981"}, "is_accepted": false, "score": 0, "last_activity_date": 1570030767, "last_edit_date": 1570030767, "creation_date": 1569943466, "answer_id": 58187990, "question_id": 58169201, "link": "https://stackoverflow.com/questions/58169201/retrieve-image-from-http-response-body/58187990#58187990", "title": "Retrieve image from HTTP response body", "body": "<p>Thank you Cerise Limon, I didn't know that decoded image was a YCbCr.\nIf I try to convert to a Gray16 image, it gives me the expected output format.\nMuch clearer now!</p>\n\n<p>Indeed this was not related to HTTP.. I wrote a simpler piece of code:</p>\n\n<pre><code>\n    // Create a 2x1 Gray16 image\n    img := image.NewGray16(image.Rect(0, 0, 2, 1))\n    // Set 1st pixel to 42\n    img.SetGray16(0, 0, color.Gray16{Y: 42})\n\n    log.Print(\"Pixels: \", img)\n\n    // Encode the image\n    buffer := new(bytes.Buffer)\n    jpeg.Encode(buffer, img, &amp;jpeg.Options{Quality: 100})\n\n    // Decode the encoded buffer\n    m, _ := jpeg.Decode(buffer)\n\n    // Create a Gray16 image and fill it with decoded image\n    newImage := image.NewGray16(image.Rect(0, 0, m.Bounds().Dx(), m.Bounds().Dy()))\n    draw.Draw(newImage, newImage.Bounds(), m, m.Bounds().Min, draw.Src)\n\n    log.Print(\"Pixels: \", newImage)\n</code></pre>\n\n<p>This gives me the following output:</p>\n\n<pre><code>INFO[0000] Pixels: &amp;{[0 42 0 0] 4 (0,0)-(2,1)}          \nINFO[0000] Pixels: &amp;{[0 0 0 0] 4 (0,0)-(2,1)}\n</code></pre>\n\n<p>Note that if I replace Gray16 by Gray, the encoding/decoding seems to work correctly: i get the same image in output than the input one.</p>\n\n<p>Am I missing something here? \nThanks!</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5169981"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 984, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1570030767, "creation_date": 1569851077, "last_edit_date": 1569943551, "question_id": 58169201, "link": "https://stackoverflow.com/questions/58169201/retrieve-image-from-http-response-body", "title": "Retrieve image from HTTP response body", "body": "<p>I am trying to retrieve an image from a Server via an HTTP GET request in my Client service.\nI reproduced my use case in the following code:</p>\n\n<p>main.go: </p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"os\"\n\n    \"github.com/gorilla/mux\"\n    log \"github.com/sirupsen/logrus\"\n)\n\nfunc main() {\n    log.SetFormatter(&amp;log.TextFormatter{})\n\n    // Initialize router\n    router := mux.NewRouter()\n\n    args := os.Args\n\n    if args[1] == \"client\" {\n        log.Print(\"Run Client, listening on port 8080\")\n        router.Methods(\"GET\").Path(\"/image\").HandlerFunc(ClientGetImage)\n        log.Fatal(http.ListenAndServe(\":8080\", router))\n    } else if args[1] == \"server\" {\n        log.Print(\"Run Server, listening on port 4242\")\n        router.Methods(\"GET\").Path(\"/image\").HandlerFunc(ServerGetImage)\n        log.Fatal(http.ListenAndServe(\":4242\", router))\n    } else {\n        log.Fatal(\"Wrong command. Choose [client] or [server] option\")\n    }\n}\n</code></pre>\n\n<p>client.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"image\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc ClientGetImage(w http.ResponseWriter, r *http.Request) {\n    // Make HTTP Get request to retrieve the image from the server\n    log.Print(\"Requesting image to server\")\n    resp, err := http.Get(\"http://localhost:4242/image\")\n\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer resp.Body.Close()\n\n    m, _, err := image.Decode(resp.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    log.Print(\"Pixels: \", m)\n}\n</code></pre>\n\n<p>server.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"image\"\n    \"image/color\"\n    \"image/jpeg\"\n    \"log\"\n    \"net/http\"\n    \"strconv\"\n)\n\nfunc ServerGetImage(w http.ResponseWriter, r *http.Request) {\n    img := image.NewGray16(image.Rect(0, 0, 1, 1))\n    img.SetGray16(0, 0, color.Gray16{Y: 42000})\n\n    // Print created\n    log.Print(\"Pixels: \", img)\n\n    buffer := new(bytes.Buffer)\n    if err := jpeg.Encode(buffer, img, nil); err != nil {\n        log.Println(\"unable to encode image.\")\n    }\n\n    w.Header().Set(\"Content-Type\", \"image/jpeg\")\n    w.Header().Set(\"Content-Length\", strconv.Itoa(len(buffer.Bytes())))\n    if _, err := w.Write(buffer.Bytes()); err != nil {\n        log.Println(\"unable to write image.\")\n    }\n}\n</code></pre>\n\n<p>The purpose is pretty simple: upon reception of a GET request, the client sends a GET request to the server to retrieve an image.\nUpon reception of the Client's GET request, the server creates a 1x1 image, encoded in 16bits.</p>\n\n<p>After running my client and server, when I send a my GET request to the client, I get the following logs:</p>\n\n<p>Server logs:</p>\n\n<pre><code>INFO[0000] Run Server, listening on port 4242           \n2019/09/30 15:32:05 Pixels: &amp;{[164 16] 2 (0,0)-(1,1)}\n</code></pre>\n\n<p>Client logs:</p>\n\n<pre><code>INFO[0000] Run Client, listening on port 8080           \n2019/09/30 15:41:52 Requesting image to server\n2019/09/30 15:41:52 Pixels: &amp;{[164 164 164 164 164 164 164 164 164 164 164 164 164 164 164\n 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 1\n64 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164\n 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 1\n64 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164\n 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 1\n64 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164\n 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 1\n64 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164\n 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 1\n64 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164\n 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164 164] [128 128 128 128 128 128\n 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 1\n28 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128\n 128 128 128 128 128 128 128 128 128 128 128 128 128] [128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128 128] 16 8 YCbCrSubsampleRatio420 (0,0)-(1,1)}\n</code></pre>\n\n<p>I was expecting that the client would print:\nPixels: &amp;{[164 16] 2 (0,0)-(1,1)} \nas well. \nIs it just a difference in the printing format, or is the image not-correctly decoded?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1569850774, "post_id": 58168994, "comment_id": 102719489, "body": "There is nothing wrong with running http.ListenAndServe concurrently to something else. You can do both things: put ListenAndServe on its own goroutine or the Kafka consumer. It does not matter. But don&#39;t do it like you did as this swallows any error returned from ListenAndServe."}, {"owner": {"reputation": 6405, "user_id": 959936, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e97b823512add9d58a2f679407b2e666?s=128&d=identicon&r=PG", "display_name": "Jurudocs", "link": "https://stackoverflow.com/users/959936/jurudocs"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1569852268, "post_id": 58168994, "comment_id": 102720391, "body": "could you downvote guys explain why this question is so bad for you?"}], "answers": [{"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1569942057, "post_id": 58169131, "comment_id": 102754905, "body": "Not all errors are fatal - <code>http.ErrServerClosed</code>.  See example code <a href=\"https://golang.org/pkg/net/http/#example_Server_Shutdown\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1569945567, "post_id": 58169131, "comment_id": 102756800, "body": "@colminator  Any return from http.ListenAndServe is fatal to the OP&#39;s application."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1569945752, "post_id": 58169131, "comment_id": 102756868, "body": "Yes. My comment merely shows that a http server can be spun and shutdown in a controlled fashion."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1569945403, "last_edit_date": 1569945403, "creation_date": 1569850793, "answer_id": 58169131, "question_id": 58168994, "link": "https://stackoverflow.com/questions/58168994/putting-listenandserve-into-goroutine/58169131#58169131", "title": "Putting ListenAndServe into goroutine", "body": "<p>Best practice is to check for and handle errors. The error from http.ListenAndServe is ignored. </p>\n\n<p>If return from http.ListenAndServe is fatal to the application, then use the following code or some variation on it to handle the error.</p>\n\n<pre><code>go func() { \n     log.Fatal(http.ListenAndServe(*addr, nil)) \n}()\n</code></pre>\n\n<p>The call to log.Fatal logs the error and exits the application.</p>\n"}], "owner": {"reputation": 6405, "user_id": 959936, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e97b823512add9d58a2f679407b2e666?s=128&d=identicon&r=PG", "display_name": "Jurudocs", "link": "https://stackoverflow.com/users/959936/jurudocs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 58169131, "answer_count": 1, "score": -2, "last_activity_date": 1569945403, "creation_date": 1569850332, "question_id": 58168994, "link": "https://stackoverflow.com/questions/58168994/putting-listenandserve-into-goroutine", "title": "Putting ListenAndServe into goroutine", "body": "<p>I'm having trouble to estimate if there will be side effects of running http.ListenAndServe in goroutine.</p>\n\n<p>To make it possible for prometheus to collect stats data from a /metrics endpoint of a service running a kafkaclient(running a kafka consumer in an infinite for-loop)</p>\n\n<pre><code>var addr = flag.String(\"listen-address\", \":8070\", \"The address to listen on for HTTP requests.\")\n\nfunc main() {\n\n   flag.Parse()\n   http.Handle(\"/metrics\", promhttp.Handler())\n   go http.ListenAndServe(*addr, nil)\n\n   for {....}\n</code></pre>\n\n<p>What would be the best practices to start the monitoring endpoint and run the infinite loop?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1569841610, "post_id": 58166490, "comment_id": 102714820, "body": "Why are you calling <code>fmt.Println</code> in a goroutine? All that will accomplish is unordering your output, and slowing things down."}, {"owner": {"reputation": 8438, "user_id": 3176550, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/m6HBi.jpg?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/3176550/jonathan"}, "edited": false, "score": 0, "creation_date": 1569845929, "post_id": 58166490, "comment_id": 102716780, "body": "<code>fmt.Println</code> is a stand-in for the actual function I will call when processing the data"}, {"owner": {"reputation": 8438, "user_id": 3176550, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/m6HBi.jpg?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/3176550/jonathan"}, "edited": false, "score": 1, "creation_date": 1569846160, "post_id": 58166490, "comment_id": 102716902, "body": "I don&#39;t understand the votes to close. Why should I close this?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1569846776, "post_id": 58166490, "comment_id": 102717213, "body": "to do what you are asking, 1/ your processing must not rely on ordered reads 2/ it is slightly more complex because in order to outweigh the cost of parallel processing you must buffer your lines and spread them among Y workers. They call to close because your question is incorrect and requires rephrasing to state your actual problem, not that non sense error. Or if you really want an answer to that error, then, your code is completely miss-designed. please rephrase your post to something like <code>how to implement parallel processing of a line based file content</code>."}, {"owner": {"reputation": 8438, "user_id": 3176550, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/m6HBi.jpg?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/3176550/jonathan"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1569848485, "post_id": 58166490, "comment_id": 102718182, "body": "@mh-cbon I don&#39;t understand what I&#39;m doing, what&#39;s the correct way to do this?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1569848627, "post_id": 58166490, "comment_id": 102718257, "body": "as i said, rephrase."}, {"owner": {"reputation": 8438, "user_id": 3176550, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/m6HBi.jpg?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/3176550/jonathan"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1569848938, "post_id": 58166490, "comment_id": 102718430, "body": "@Flimzy it&#39;s a proof of concept I haven&#39;t written the processing code yet, fmt.Println will be something else that processes the line and writes the output to a database"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1569848940, "post_id": 58166490, "comment_id": 102718432, "body": "The correct way of doing this is almost certainly <i>not</i> in parallel."}, {"owner": {"reputation": 8438, "user_id": 3176550, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/m6HBi.jpg?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/3176550/jonathan"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1569849338, "post_id": 58166490, "comment_id": 102718668, "body": "@Flimzy the data is unordered, and the order of output isn&#39;t important, isn&#39;t there a better way to process this file than reading it synchronously line by line?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1569850401, "post_id": 58166490, "comment_id": 102719283, "body": "There&#39;s no such thing as an &quot;unordered file&quot;. By definition a file is an ordered series of bytes, and since you&#39;re scanning lines, you have to read it as a single stream. You can&#39;t ignore the basic data structures you&#39;re interacting with."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1569855016, "post_id": 58166490, "comment_id": 102721887, "body": "&quot;isn&#39;t there a better way to process this file than reading it synchronously line by line?&quot; -- probably not. Files are, by very nature, sequential."}], "answers": [{"comments": [{"owner": {"reputation": 8438, "user_id": 3176550, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/m6HBi.jpg?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/3176550/jonathan"}, "edited": false, "score": 0, "creation_date": 1569848116, "post_id": 58167622, "comment_id": 102717952, "body": "Thanks, the data in the file is unordered."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1569851737, "post_id": 58167622, "comment_id": 102720080, "body": "this wont fix the limit overrun, at all."}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 1, "last_activity_date": 1569850148, "last_edit_date": 1569850148, "creation_date": 1569845274, "answer_id": 58167622, "question_id": 58166490, "link": "https://stackoverflow.com/questions/58166490/how-to-implement-parallel-processing-of-line-based-file-content/58167622#58167622", "title": "How to implement parallel processing of line-based file content", "body": "<p>All your example does currently is asynchronously printing the values -- and not even that as the print function has to synchronise printing to the output.</p>\n\n<p>At the same time you are not printing all your lines in the file. The main routine starts a lot of goroutines, but it doesn't wait for them to finish. Some will run, and some will not. To wait for the routines to finish, use a <code>sync.WaitGroup</code>.</p>\n\n<p>Here is an example. It might also fix your file descriptor problem.</p>\n\n<pre><code>    wg := &amp;sync.WaitGroup{}\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() {\n            text := scanner.Text()\n            wg.Add(1)\n            go func(t string) {\n                    fmt.Println(t)\n                    wg.Done()\n            }(text)\n    }\n\n    wg.Wait()\n</code></pre>\n\n<p>Note that the lines will not be processed in order! If you need to process them in order, but do not want to process them in the goroutine reading, you need a channel and a single goroutine processing them.</p>\n"}, {"comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1570016819, "post_id": 58169853, "comment_id": 102779592, "body": "As stated in my answer: there are no concurrent reads here. You have one single routine reading. If the code above helped, then it seems you were running into a limit when writing concurrently to stdout."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1570016963, "post_id": 58169853, "comment_id": 102779661, "body": "Note that you are only timing pure reading here. Whatever you do in your goroutines will not finish. In this particular case not the entire file will be printed to stdout."}], "tags": [], "owner": {"reputation": 8438, "user_id": 3176550, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/m6HBi.jpg?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/3176550/jonathan"}, "is_accepted": false, "score": 0, "last_activity_date": 1569853252, "creation_date": 1569853252, "answer_id": 58169853, "question_id": 58166490, "link": "https://stackoverflow.com/questions/58166490/how-to-implement-parallel-processing-of-line-based-file-content/58169853#58169853", "title": "How to implement parallel processing of line-based file content", "body": "<p>This helped with the too many concurrent operations error. I use a channel to limit the number of concurrent reads to 100,000.</p>\n\n<pre><code>package main\n\nimport (\n        \"bufio\"\n        \"fmt\"\n        \"log\"\n        \"os\"\n        \"time\"\n)\n\nvar tokens = make(chan struct{}, 100000)\n\nfunc main() {\n        start := time.Now()\n        file, err := os.Open(\"dump10.txt\")\n        if err != nil {\n                log.Fatal(err)\n        }\n        defer file.Close()\n\n        scanner := bufio.NewScanner(file)\n        for scanner.Scan() {\n                tokens &lt;- struct{}{} // acquire a token\n                text := scanner.Text()\n                go func () {\n                    fmt.Printf(\"%s\\n\",text)\n                    &lt;-tokens\n                }()\n        }\n\n        if err := scanner.Err(); err != nil {\n                log.Fatal(err)\n        }\n        secs := time.Since(start).Seconds()\n        fmt.Printf(\"Took %.2fs\", secs)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 4, "last_activity_date": 1576431611, "last_edit_date": 1576431611, "creation_date": 1569865705, "answer_id": 58172839, "question_id": 58166490, "link": "https://stackoverflow.com/questions/58166490/how-to-implement-parallel-processing-of-line-based-file-content/58172839#58172839", "title": "How to implement parallel processing of line-based file content", "body": "<p>Before considering to parallelize a process, you should study your input and computations to make sure that it makes sense.</p>\n\n<p>An input that requires to be processed in order is not a good match because parallel processing would require additional complex instructions to keep things in order, it is difficult to evaluate upfront if this strategy will be a win.</p>\n\n<p>Also in order to take advantage of parallelization, the computations to run must take longer than the time required to synchronize the parallel tasks. It is possible to outweigh this cost by bulking the data, but the resulting algorithm will be more complex and creates additional undesired side effects (like allocations). </p>\n\n<p>Otherwise, don't parallelize.</p>\n\n<p>See below example of various implementations with long/short computations times and their resulting benchmark.</p>\n\n<p>The conclusion is that unless you compute a long running asynchronous task that will clearly outweigh the synchronization costs, sequential processing is faster.</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"runtime\"\n    \"strings\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    data := strings.Repeat(strings.Repeat(\"a\", 1000)+\"\\n\", 1000)\n    run_line_short(data, true)\n    run_line_long(data, true)\n    run_line_short_workers(data, true)\n    run_line_long_workers(data, true)\n    run_bulk_short(data, true)\n    run_bulk_long(data, true)\n    run_seq_short(data, true)\n    run_seq_long(data, true)\n}\n\nfunc run_line_short(data string, stat bool) {\n    if stat {\n        s := stats(\"run_line_short\")\n        defer s()\n    }\n    r := strings.NewReader(data)\n    err := process(r, line_handler_short)\n    if err != nil {\n        panic(err)\n    }\n}\nfunc run_line_long(data string, stat bool) {\n    if stat {\n        s := stats(\"run_line_long\")\n        defer s()\n    }\n    r := strings.NewReader(data)\n    err := process(r, line_handler_long)\n    if err != nil {\n        panic(err)\n    }\n}\nfunc run_line_short_workers(data string, stat bool) {\n    if stat {\n        s := stats(\"run_line_short_workers\")\n        defer s()\n    }\n    r := strings.NewReader(data)\n    err := processWorkers(r, line_handler_short)\n    if err != nil {\n        panic(err)\n    }\n}\nfunc run_line_long_workers(data string, stat bool) {\n    if stat {\n        s := stats(\"run_line_long_workers\")\n        defer s()\n    }\n    r := strings.NewReader(data)\n    err := processWorkers(r, line_handler_long)\n    if err != nil {\n        panic(err)\n    }\n}\nfunc run_bulk_short(data string, stat bool) {\n    if stat {\n        s := stats(\"run_bulk_short\")\n        defer s()\n    }\n    r := strings.NewReader(data)\n    err := processBulk(r, bulk_handler_short)\n    if err != nil {\n        panic(err)\n    }\n}\nfunc run_bulk_long(data string, stat bool) {\n    if stat {\n        s := stats(\"run_bulk_long\")\n        defer s()\n    }\n    r := strings.NewReader(data)\n    err := processBulk(r, bulk_handler_long)\n    if err != nil {\n        panic(err)\n    }\n}\nfunc run_seq_short(data string, stat bool) {\n    if stat {\n        s := stats(\"run_seq_short\")\n        defer s()\n    }\n    r := strings.NewReader(data)\n    err := processSeq(r, line_handler_short)\n    if err != nil {\n        panic(err)\n    }\n}\nfunc run_seq_long(data string, stat bool) {\n    if stat {\n        s := stats(\"run_seq_long\")\n        defer s()\n    }\n    r := strings.NewReader(data)\n    err := processSeq(r, line_handler_long)\n    if err != nil {\n        panic(err)\n    }\n}\n\nfunc line_handler_short(k string) error {\n    _ = len(k)\n    return nil\n}\n\nfunc line_handler_long(k string) error {\n    &lt;-time.After(time.Millisecond * 5)\n    _ = len(k)\n    return nil\n}\n\nfunc bulk_handler_short(b []string) error {\n    for _, k := range b {\n        _ = len(k)\n    }\n    return nil\n}\n\nfunc bulk_handler_long(b []string) error {\n    &lt;-time.After(time.Millisecond * 5)\n    for _, k := range b {\n        _ = len(k)\n    }\n    return nil\n}\n\nfunc stats(name string) func() {\n    fmt.Printf(\"======================\\n\")\n    fmt.Printf(\"%v\\n\", name)\n    start := time.Now()\n    return func() {\n        fmt.Printf(\"time to run %v\\n\", time.Since(start))\n        var ms runtime.MemStats\n        runtime.ReadMemStats(&amp;ms)\n        fmt.Printf(\"Alloc: %d MB, TotalAlloc: %d MB, Sys: %d MB\\n\",\n            ms.Alloc/1024/1024, ms.TotalAlloc/1024/1024, ms.Sys/1024/1024)\n        fmt.Printf(\"Mallocs: %d, Frees: %d\\n\",\n            ms.Mallocs, ms.Frees)\n        fmt.Printf(\"HeapAlloc: %d MB, HeapSys: %d MB, HeapIdle: %d MB\\n\",\n            ms.HeapAlloc/1024/1024, ms.HeapSys/1024/1024, ms.HeapIdle/1024/1024)\n        fmt.Printf(\"HeapObjects: %d\\n\", ms.HeapObjects)\n        fmt.Printf(\"\\n\")\n    }\n}\n\nfunc process(r io.Reader, h func(string) error) error {\n    errs := make(chan error)\n    workers := make(chan struct{}, 4)\n    var wg sync.WaitGroup\n    go func() {\n        scanner := bufio.NewScanner(r)\n        for scanner.Scan() {\n            workers &lt;- struct{}{} // acquire a token\n            wg.Add(1)\n            go func(line string) {\n                defer wg.Done()\n                if err := h(line); err != nil {\n                    errs &lt;- err\n                }\n                &lt;-workers\n            }(scanner.Text())\n        }\n        wg.Wait()\n        if err := scanner.Err(); err != nil {\n            errs &lt;- err\n        }\n        close(errs)\n    }()\n    var err error\n    for e := range errs {\n        if e != nil &amp;&amp; err == nil {\n            err = e\n        }\n    }\n    return err\n}\n\nfunc processWorkers(r io.Reader, h func(string) error) error {\n    errs := make(chan error)\n    input := make(chan string)\n    y := 4\n    var wg sync.WaitGroup\n    for i := 0; i &lt; y; i++ {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            for line := range input {\n                if err := h(line); err != nil {\n                    errs &lt;- err\n                }\n            }\n        }()\n    }\n    go func() {\n        scanner := bufio.NewScanner(r)\n        for scanner.Scan() {\n            input &lt;- scanner.Text()\n        }\n        close(input)\n        wg.Wait()\n        if err := scanner.Err(); err != nil {\n            errs &lt;- err\n        }\n        close(errs)\n    }()\n    var err error\n    for e := range errs {\n        if err == nil &amp;&amp; e != nil {\n            err = e\n        }\n    }\n    return err\n}\n\nfunc processBulk(r io.Reader, h func([]string) error) error {\n    errs := make(chan error)\n    input := make(chan []string)\n    y := 4\n    var wg sync.WaitGroup\n    for i := 0; i &lt; y; i++ {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            for bulk := range input {\n                if err := h(bulk); err != nil {\n                    errs &lt;- err\n                }\n            }\n        }()\n    }\n    go func() {\n        scanner := bufio.NewScanner(r)\n        l := 50\n        bulk := make([]string, l)\n        i := 0\n        for scanner.Scan() {\n            text := scanner.Text()\n            bulk[i] = text\n            i++\n            if i == l {\n                copied := make([]string, l, l)\n                copy(copied, bulk)\n                i = 0\n                input &lt;- copied\n            }\n        }\n        if i &gt; 0 {\n            input &lt;- bulk[:i]\n        }\n        close(input)\n        if err := scanner.Err(); err != nil {\n            errs &lt;- err\n        }\n    }()\n    go func() {\n        wg.Wait()\n        close(errs)\n    }()\n    var err error\n    for e := range errs {\n        if err == nil &amp;&amp; e != nil {\n            err = e\n        }\n    }\n    return err\n}\n\nfunc processSeq(r io.Reader, h func(string) error) error {\n    scanner := bufio.NewScanner(r)\n    for scanner.Scan() {\n        text := scanner.Text()\n        if err := h(text); err != nil {\n            return err\n        }\n    }\n    return scanner.Err()\n}\n</code></pre>\n\n<p><strong>main_test.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"strings\"\n    \"testing\"\n)\n\nfunc Benchmark_run_line_short(b *testing.B) {\n    data := strings.Repeat(strings.Repeat(\"a\", 1000)+\"\\n\", 1000)\n    for i := 0; i &lt; b.N; i++ {\n        run_line_short(data, false)\n    }\n}\n\nfunc Benchmark_run_line_long(b *testing.B) {\n    data := strings.Repeat(strings.Repeat(\"a\", 1000)+\"\\n\", 1000)\n    for i := 0; i &lt; b.N; i++ {\n        run_line_long(data, false)\n    }\n}\nfunc Benchmark_run_line_short_workers(b *testing.B) {\n    data := strings.Repeat(strings.Repeat(\"a\", 1000)+\"\\n\", 1000)\n    for i := 0; i &lt; b.N; i++ {\n        run_line_short_workers(data, false)\n    }\n}\nfunc Benchmark_run_line_long_workers(b *testing.B) {\n    data := strings.Repeat(strings.Repeat(\"a\", 1000)+\"\\n\", 1000)\n    for i := 0; i &lt; b.N; i++ {\n        run_line_long_workers(data, false)\n    }\n}\nfunc Benchmark_run_bulk_short(b *testing.B) {\n    data := strings.Repeat(strings.Repeat(\"a\", 1000)+\"\\n\", 1000)\n    for i := 0; i &lt; b.N; i++ {\n        run_bulk_short(data, false)\n    }\n}\nfunc Benchmark_run_bulk_long(b *testing.B) {\n    data := strings.Repeat(strings.Repeat(\"a\", 1000)+\"\\n\", 1000)\n    for i := 0; i &lt; b.N; i++ {\n        run_bulk_long(data, false)\n    }\n}\nfunc Benchmark_run_seq_short(b *testing.B) {\n    data := strings.Repeat(strings.Repeat(\"a\", 1000)+\"\\n\", 1000)\n    for i := 0; i &lt; b.N; i++ {\n        run_seq_short(data, false)\n    }\n}\nfunc Benchmark_run_seq_long(b *testing.B) {\n    data := strings.Repeat(strings.Repeat(\"a\", 1000)+\"\\n\", 1000)\n    for i := 0; i &lt; b.N; i++ {\n        run_seq_long(data, false)\n    }\n}\n</code></pre>\n\n<p><strong>results</strong></p>\n\n<pre><code>$ go run main.go \n======================\nrun_line_short\ntime to run 2.747827ms\nAlloc: 2 MB, TotalAlloc: 2 MB, Sys: 68 MB\nMallocs: 1378, Frees: 1\nHeapAlloc: 2 MB, HeapSys: 63 MB, HeapIdle: 61 MB\nHeapObjects: 1377\n\n======================\nrun_line_long\ntime to run 1.30987804s\nAlloc: 3 MB, TotalAlloc: 3 MB, Sys: 68 MB\nMallocs: 5619, Frees: 5\nHeapAlloc: 3 MB, HeapSys: 63 MB, HeapIdle: 59 MB\nHeapObjects: 5614\n\n======================\nrun_line_short_workers\ntime to run 4.54926ms\nAlloc: 1 MB, TotalAlloc: 4 MB, Sys: 68 MB\nMallocs: 6648, Frees: 5743\nHeapAlloc: 1 MB, HeapSys: 63 MB, HeapIdle: 61 MB\nHeapObjects: 905\n\n======================\nrun_line_long_workers\ntime to run 1.29874118s\nAlloc: 2 MB, TotalAlloc: 5 MB, Sys: 68 MB\nMallocs: 10670, Frees: 5747\nHeapAlloc: 2 MB, HeapSys: 63 MB, HeapIdle: 60 MB\nHeapObjects: 4923\n\n======================\nrun_bulk_short\ntime to run 1.279059ms\nAlloc: 3 MB, TotalAlloc: 6 MB, Sys: 68 MB\nMallocs: 11695, Frees: 5751\nHeapAlloc: 3 MB, HeapSys: 63 MB, HeapIdle: 59 MB\nHeapObjects: 5944\n\n======================\nrun_bulk_long\ntime to run 31.328652ms\nAlloc: 1 MB, TotalAlloc: 7 MB, Sys: 68 MB\nMallocs: 12728, Frees: 11361\nHeapAlloc: 1 MB, HeapSys: 63 MB, HeapIdle: 61 MB\nHeapObjects: 1367\n\n======================\nrun_seq_short\ntime to run 956.991\u00b5s\nAlloc: 3 MB, TotalAlloc: 8 MB, Sys: 68 MB\nMallocs: 13746, Frees: 11160\nHeapAlloc: 3 MB, HeapSys: 63 MB, HeapIdle: 59 MB\nHeapObjects: 2586\n\n======================\nrun_seq_long\ntime to run 5.195705859s\nAlloc: 1 MB, TotalAlloc: 9 MB, Sys: 68 MB\nMallocs: 17766, Frees: 15973\nHeapAlloc: 1 MB, HeapSys: 63 MB, HeapIdle: 61 MB\nHeapObjects: 1793\n\n[mh-cbon@Host-001 bulk] $ go test -bench=. -benchmem -count=4\ngoos: linux\ngoarch: amd64\npkg: test/bulk\nBenchmark_run_line_short-4                  1000       1750824 ns/op     1029354 B/op       1005 allocs/op\nBenchmark_run_line_short-4                  1000       1747408 ns/op     1029348 B/op       1005 allocs/op\nBenchmark_run_line_short-4                  1000       1757826 ns/op     1029352 B/op       1005 allocs/op\nBenchmark_run_line_short-4                  1000       1758427 ns/op     1029352 B/op       1005 allocs/op\nBenchmark_run_line_long-4                      1    1303037704 ns/op     2253776 B/op       4075 allocs/op\nBenchmark_run_line_long-4                      1    1305074974 ns/op     2247792 B/op       4032 allocs/op\nBenchmark_run_line_long-4                      1    1305353658 ns/op     2246320 B/op       4013 allocs/op\nBenchmark_run_line_long-4                      1    1305725817 ns/op     2247792 B/op       4031 allocs/op\nBenchmark_run_line_short_workers-4          1000       2148354 ns/op     1029366 B/op       1005 allocs/op\nBenchmark_run_line_short_workers-4          1000       2139629 ns/op     1029370 B/op       1005 allocs/op\nBenchmark_run_line_short_workers-4          1000       1983352 ns/op     1029359 B/op       1005 allocs/op\nBenchmark_run_line_short_workers-4          1000       1909968 ns/op     1029363 B/op       1005 allocs/op\nBenchmark_run_line_long_workers-4              1    1298321093 ns/op     2247856 B/op       4013 allocs/op\nBenchmark_run_line_long_workers-4              1    1299846127 ns/op     2246384 B/op       4012 allocs/op\nBenchmark_run_line_long_workers-4              1    1300003625 ns/op     2246288 B/op       4011 allocs/op\nBenchmark_run_line_long_workers-4              1    1302779911 ns/op     2246256 B/op       4011 allocs/op\nBenchmark_run_bulk_short-4                  2000        704358 ns/op     1082154 B/op       1011 allocs/op\nBenchmark_run_bulk_short-4                  2000        708563 ns/op     1082147 B/op       1011 allocs/op\nBenchmark_run_bulk_short-4                  2000        714687 ns/op     1082148 B/op       1011 allocs/op\nBenchmark_run_bulk_short-4                  2000        705546 ns/op     1082156 B/op       1011 allocs/op\nBenchmark_run_bulk_long-4                     50      31411412 ns/op     1051497 B/op       1088 allocs/op\nBenchmark_run_bulk_long-4                     50      31513018 ns/op     1051544 B/op       1088 allocs/op\nBenchmark_run_bulk_long-4                     50      31539311 ns/op     1051502 B/op       1088 allocs/op\nBenchmark_run_bulk_long-4                     50      31564940 ns/op     1051505 B/op       1088 allocs/op\nBenchmark_run_seq_short-4                   2000        574346 ns/op     1028632 B/op       1002 allocs/op\nBenchmark_run_seq_short-4                   3000        572857 ns/op     1028464 B/op       1002 allocs/op\nBenchmark_run_seq_short-4                   2000        580493 ns/op     1028632 B/op       1002 allocs/op\nBenchmark_run_seq_short-4                   3000        572240 ns/op     1028464 B/op       1002 allocs/op\nBenchmark_run_seq_long-4                       1    5196313302 ns/op     2245792 B/op       4005 allocs/op\nBenchmark_run_seq_long-4                       1    5199995649 ns/op     2245792 B/op       4005 allocs/op\nBenchmark_run_seq_long-4                       1    5200460425 ns/op     2245792 B/op       4005 allocs/op\nBenchmark_run_seq_long-4                       1    5201080570 ns/op     2245792 B/op       4005 allocs/op\nPASS\nok      test/bulk   68.944s\n</code></pre>\n\n<p>notes: to my surprise, <code>run_line_short_workers</code> is slightly slower than <code>run_line_short</code>, i don't explain that result, however a deeper analysis using pprof should provide the answer.</p>\n"}], "owner": {"reputation": 8438, "user_id": 3176550, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/m6HBi.jpg?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/3176550/jonathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 1, "accepted_answer_id": 58172839, "answer_count": 3, "score": -1, "last_activity_date": 1576431611, "creation_date": 1569841035, "last_edit_date": 1569850061, "question_id": 58166490, "link": "https://stackoverflow.com/questions/58166490/how-to-implement-parallel-processing-of-line-based-file-content", "title": "How to implement parallel processing of line-based file content", "body": "<p>I'm writing a POC to process a very large text file ~1 billion+ lines and am experimenting with Go for this;</p>\n\n<pre><code>package main\n\nimport (\n        \"bufio\"\n        \"fmt\"\n        \"log\"\n        \"os\"\n        \"time\"\n)\n\nfunc main() {\n        start := time.Now()\n        file, err := os.Open(\"dump10.txt\")\n        if err != nil {\n                log.Fatal(err)\n        }\n        defer file.Close()\n\n        scanner := bufio.NewScanner(file)\n        for scanner.Scan() {\n                go fmt.Println(scanner.Text())\n        }\n\n        if err := scanner.Err(); err != nil {\n                log.Fatal(err)\n        }\n        secs := time.Since(start).Seconds()\n        fmt.Printf(\"Took %.2fs\", secs)\n}\n</code></pre>\n\n<p>However when running this I get this error;</p>\n\n<blockquote>\n  <p>panic: too many concurrent operations on a single file or socket (max 1048575)</p>\n</blockquote>\n\n<p>I haven't found anything online that deals with this specific error. I'm not sure if it's a file descriptors issue, the maximum listed in the error is much higher than my <code>ulimit -n</code> limit of 500,000.</p>\n\n<p>What is the best way to do this?</p>\n\n<p>As it's not obvious, <code>fmt.Println</code> is a stand-in for the actual function I will call when processing the data.</p>\n"}, {"tags": ["go", "go-github"], "answers": [{"tags": [], "owner": {"reputation": 1219, "user_id": 783726, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0d68f895b1ae840dd1e3df3bba1a5bcb?s=128&d=identicon&r=PG", "display_name": "Russell Seymour", "link": "https://stackoverflow.com/users/783726/russell-seymour"}, "is_accepted": true, "score": 1, "last_activity_date": 1569845059, "creation_date": 1569845059, "answer_id": 58167575, "question_id": 58166420, "link": "https://stackoverflow.com/questions/58166420/how-can-i-set-http-request-headers-when-using-go-github-and-an-http-transport/58167575#58167575", "title": "How can I set HTTP request headers when using Go-Github and an http.Transport?", "body": "<p>As tends to be the case with these things, shortly after posting my question I found the answer.</p>\n\n<p>The trick is to set the headers using the <code>Base</code> in the Oauth2 transport thus:</p>\n\n<pre><code>transport = &amp;oauth2.Transport{\n    Source: oauth2.StaticTokenSource(\n        &amp;oauth2.Token{\n            AccessToken: gh.tokens.GitHub.Token,\n        },\n    ),\n    Base: &amp;transportHeaders{\n        modifiedSince: modifiedSince,\n    },\n}\n</code></pre>\n\n<p>The struct and method look like:</p>\n\n<pre><code>type transportHeaders struct {\n    modifiedSince string\n}\n\nfunc (t *transportHeaders) RoundTrip(req *http.Request) (*http.Response, error) {\n\n    // Determine the last modified date based on the transportHeader options\n    // Do not add any headers if blank or zero\n    if t.modifiedSince != \"\" {\n        req.Header.Set(\"If-Modified-Since\", t.modifiedSince)\n    }\n\n    return http.DefaultTransport.RoundTrip(req)\n}\n</code></pre>\n\n<p>So by doing this I can intercept the call to RoundTrip and add my own header. This now means I can check the resources and see if they return a 304 HTTP status code. For example:</p>\n\n<pre><code>ERRO[0001] Error retrieving repository                   error=\"GET https://api.github.com/repos/chef-partners/camsa-setup: 304  []\" name=camsa-setup vcs=github\n</code></pre>\n\n<p>I worked out how to do this after coming across this page - <a href=\"https://github.com/rmichela/go-reddit/blob/bd882abbb7496c54dbde66d92c35ad95d4db1211/authenticator.go#L117\" rel=\"nofollow noreferrer\">https://github.com/rmichela/go-reddit/blob/bd882abbb7496c54dbde66d92c35ad95d4db1211/authenticator.go#L117</a></p>\n"}], "owner": {"reputation": 1219, "user_id": 783726, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0d68f895b1ae840dd1e3df3bba1a5bcb?s=128&d=identicon&r=PG", "display_name": "Russell Seymour", "link": "https://stackoverflow.com/users/783726/russell-seymour"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 58167575, "answer_count": 1, "score": 0, "last_activity_date": 1569845059, "creation_date": 1569840793, "last_edit_date": 1592644375, "question_id": 58166420, "link": "https://stackoverflow.com/questions/58166420/how-can-i-set-http-request-headers-when-using-go-github-and-an-http-transport", "title": "How can I set HTTP request headers when using Go-Github and an http.Transport?", "body": "<p>I am writing an app that uses the GitHub API to look at repositories in my GitHub orgs. I am using the <code>github.com/google/go-github</code> library.</p>\n<p>I am also using the <code>github.com/gregjones/httpcache</code> so that I can do token based authentication as well as set the conditional headers for the API calls. I have got authentication working thus:</p>\n<pre><code>ctx := context.Background()\n\n// GitHUb API authentication\ntransport = &amp;oauth2.Transport{\n    Source: oauth2.StaticTokenSource(\n        &amp;oauth2.Token{\n            AccessToken: gh.tokens.GitHub.Token,\n        },\n    ),\n}\n\n// Configure HTTP memory caching\ntransport = &amp;httpcache.Transport{\n    Transport:           transport,\n    Cache:               httpcache.NewMemoryCache(),\n    MarkCachedResponses: true,\n}\n\n// Create the http client that GutHUb will use\nhttpClient := &amp;http.Client{\n    Transport: transport,\n}\n\n// Attempt to login to GitHub\nclient := github.NewClient(httpClient)\n</code></pre>\n<p>However I am unable to work out how to add the necessary <code>If-Match</code> header when I use <code>client.Repositories.Get</code> for example. This is so I can work out if the repo has changed in the last 24 hours for exampple.</p>\n<p>I have searched how to do this, but the examples I come across show how to create an HTTP client and then create a request (so the headers can be added) and then do a <code>Do</code> action on it. However As I am using the client directly I do not have that option.</p>\n<p>The documentation for <code>go-github</code> states that for conditional requests:</p>\n<blockquote>\n<p>The GitHub API has good support for conditional requests which will help prevent you from burning through your rate limit, as well as help speed up your application. go-github does not handle conditional requests directly, but is instead designed to work with a caching http.Transport. We recommend using <a href=\"https://github.com/gregjones/httpcache\" rel=\"nofollow noreferrer\">https://github.com/gregjones/httpcache</a> for that.</p>\n<p>Learn more about GitHub conditional requests at <a href=\"https://developer.github.com/v3/#conditional-requests\" rel=\"nofollow noreferrer\">https://developer.github.com/v3/#conditional-requests</a>.</p>\n</blockquote>\n<p>I do not know how to add it in my code, any help is greatly appreciated.</p>\n"}, {"tags": ["go", "multipart", "content-disposition"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1569838305, "post_id": 58165606, "comment_id": 102713133, "body": "The file is not part of this HTTP Header."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1569838811, "post_id": 58165606, "comment_id": 102713386, "body": "he does not have a clue what he is doing. Unless it can be marked as duplicate, please help to improve the question / response instead of throwing close votes."}], "answers": [{"comments": [{"owner": {"reputation": 536, "user_id": 9111141, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HD4A1.jpg?s=128&g=1", "display_name": "pshx", "link": "https://stackoverflow.com/users/9111141/pshx"}, "edited": false, "score": 0, "creation_date": 1569839756, "post_id": 58165723, "comment_id": 102713870, "body": "i see now after printing resp that there is a csv text but type is http.Response  i have to deal with <a href=\"https://golang.org/pkg/encoding/csv/#Reader\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/csv/#Reader</a>   how to turn resp to string in order to be able reader to read it, or i miss something else ?"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1569839816, "post_id": 58165723, "comment_id": 102713894, "body": "see my answer for that"}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 2, "last_activity_date": 1569841654, "last_edit_date": 1569841654, "creation_date": 1569838286, "answer_id": 58165723, "question_id": 58165606, "link": "https://stackoverflow.com/questions/58165606/how-to-read-file-content-from-an-http-requests-response/58165723#58165723", "title": "How to read file content from an http.Request&#39;s response", "body": "<p>you have to consume the body of the request.</p>\n\n<pre><code>baseUrl := \"Some url that i call to fetch csv file\"\n\nclient := http.Client{}\n\nresp, _ := client.Get(baseUrl)\ndefer resp.Body.Close()\nio.Copy(os.Stdout, resp.Body) // this line.\n\nfmt.Println(resp)\n</code></pre>\n\n<p>if you have to deal with a multipart form data <a href=\"https://golang.org/pkg/net/http/#Request.FormFile\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Request.FormFile</a></p>\n\n<p>Given following comment,</p>\n\n<blockquote>\n  <p>i see now after printing resp that there is a csv text but type is\n  http.Response i have to deal with golang.org/pkg/encoding/csv/#Reader\n  how to turn resp to string in order to be able reader to read it, or i\n  miss something else ?</p>\n</blockquote>\n\n<p>OP has to understand that an http response Body implements the <code>io.Reader</code> interface.\nWhen the http response come back from the server, the body is not read directly into memory as slice of bytes <code>[]byte</code>.</p>\n\n<p>OP should note also that a <code>csv.Reader</code> is an implementation to decode a CSV encoded content that consumes an <code>io.Reader</code>. Under the hood it does not hold the entire content of the file in memory, it reads whats needed to decode one line and proceed further.</p>\n\n<p>As a consequence to those two important properties of golang implementation, is that it is easy and natural to connect the response body reader to the csv reader.</p>\n\n<p>To the question, what is an <code>io.Reader</code>, OP has to figure out it is anything capable of reading a byte stream by chunks of max len p. This is illustrated by the signature of the unique method of this interface <code>Read([]byte) (int, error)</code></p>\n\n<p>This interface is designed in such way that it minimizes consumed memory and allocations.</p>\n\n<p>ref links</p>\n\n<ul>\n<li><a href=\"https://golang.org/pkg/encoding/csv/#Reader\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/csv/#Reader</a></li>\n<li><a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\">https://golang.org/pkg/io/#Reader</a></li>\n<li><a href=\"https://golang.org/pkg/net/http/#Response\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Response</a></li>\n</ul>\n\n<p>All that being said, the final code is trivially written,</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    baseUrl := \"https://geolite.maxmind.com/download/geoip/misc/region_codes.csv\"\n\n    client := http.Client{}\n\n    resp, err := client.Get(baseUrl)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer resp.Body.Close()\n    fmt.Println(resp)\n\n    r := csv.NewReader(resp.Body)\n\n    for {\n        record, err := r.Read()\n        if err == io.EOF {\n            break\n        }\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        fmt.Println(record)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1569841725, "post_id": 58166131, "comment_id": 102714888, "body": "i was unhappy you proposed a string conversion so i updated my answer."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1569842648, "post_id": 58166131, "comment_id": 102715321, "body": "Yes, very nice! I tried to give the simplest answer but also point out that the body is a <code>io.Reader</code>. Reading the body at once is a bad idea with large files and streaming it is way superior... but a lot more complex -- especially for beginners."}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 1, "last_activity_date": 1569839766, "creation_date": 1569839766, "answer_id": 58166131, "question_id": 58165606, "link": "https://stackoverflow.com/questions/58165606/how-to-read-file-content-from-an-http-requests-response/58166131#58166131", "title": "How to read file content from an http.Request&#39;s response", "body": "<p>The easiest way is to use <code>ioutil.ReadAll</code> method to read the entire body. The body implements the <code>io.Reader</code> interface, so everything you can do with a reader can be done with the body. That includes piping it to stdout as mh-cbon has shown in his answer.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>baseUrl := \"Some url that i call to fetch csv file\"\n\nresp, err := http.Get(baseUrl)\nif err != nil {\n    // do something with the error\n}\ndefer resp.Body.Close()\n\ncontent, err := ioutil.ReadAll(resp.Body)\nif err != nil {\n    // do something with the error\n}\n\nfmt.Println(string(content))\n</code></pre>\n\n<p>Note that I removed the <code>client</code>. It is not needed for simple <code>GET</code> calls. If you need more configuration use the <code>http.Client</code> as you did in your example.</p>\n\n<p>Also note that <code>content</code> is of type <code>[]byte</code> but it can easily be converted to string as done above in the print statement.</p>\n"}], "owner": {"reputation": 536, "user_id": 9111141, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HD4A1.jpg?s=128&g=1", "display_name": "pshx", "link": "https://stackoverflow.com/users/9111141/pshx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4117, "favorite_count": 0, "accepted_answer_id": 58165723, "answer_count": 2, "score": -1, "last_activity_date": 1569841654, "creation_date": 1569837813, "last_edit_date": 1569838625, "question_id": 58165606, "link": "https://stackoverflow.com/questions/58165606/how-to-read-file-content-from-an-http-requests-response", "title": "How to read file content from an http.Request&#39;s response", "body": "<p>I use below code to send a request to an http server.</p>\n\n<p>The server sends a response that contains those http headers </p>\n\n<pre><code>Content-Disposition:[attachment;filename=somefilename.csv] \nContent-Type:[text/csv; charset=UTF-8]\n</code></pre>\n\n<p>How do i proceed to retrieve the content of the file attached with the response ?</p>\n\n<pre><code>baseUrl := \"Some url that i call to fetch csv file\"\n\nclient := http.Client{}\n\nresp, _ := client.Get(baseUrl)\ndefer resp.Body.Close()\n\nfmt.Println(resp)\n\n// &amp;{200 OK 200 HTTP/2.0 2 0 map[Content-Disposition:[attachment;filename=somefilename.csv] Content-Type:[text/csv; charset=UTF-8] Date:[Mon, 30 Sep 2019 09:54:08 GMT] Server:[Jetty(9.2.z-SNAPSHOT)] Vary:[Accept]] {0xc000530280} -1 [] false false map[] 0xc000156200 0xc0000c26e0}\n</code></pre>\n"}, {"tags": ["python", "string", "python-2.7", "go"], "owner": {"reputation": 47, "user_id": 10081420, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a154b00c839d8cf2e51e9d412c8dd15?s=128&d=identicon&r=PG&f=1", "display_name": "HuDahai", "link": "https://stackoverflow.com/users/10081420/hudahai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 1, "closed_date": 1569837139, "answer_count": 0, "score": 2, "last_activity_date": 1569837163, "creation_date": 1569836809, "last_edit_date": 1569836975, "question_id": 58165354, "link": "https://stackoverflow.com/questions/58165354/how-to-change-xe4-xbd-xa0-to-chinese-in-goland", "closed_reason": "Duplicate", "title": "how to change &quot;\\\\xe4\\\\xbd\\\\xa0&quot; to Chinese in goland", "body": "<p>I get a string like this</p>\n\n<pre><code>\"\\\\xe4\\\\xbd\\\\xa0\" \n</code></pre>\n\n<p>now I want to print this string to chinese in go. like this</p>\n\n<pre><code>\u4f60\n</code></pre>\n\n<p>In python2.7\uff0cI can do this</p>\n\n<pre><code>print \"\\\\xe4\\\\xbd\\\\xa0\".decode(\"string-escape\")\n# \u4f60\n</code></pre>\n\n<p>But I don't know how to do it.</p>\n\n<p>How do I do it in go?</p>\n"}, {"tags": ["arrays", "mongodb", "go", "slice", "mongo-go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1569833260, "post_id": 58164337, "comment_id": 102710423, "body": "<code>hitches</code> in your database is an array of arrays, so you may decode that into a value of type <code>[][]primitive.ObjectID</code>."}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 3, "creation_date": 1569833522, "post_id": 58164337, "comment_id": 102710565, "body": "Probably worth noting that since each &quot;array of arrays&quot; only has one member, this was probably an error on insertion of the data. You should probably consider correcting that instead of &quot;coding around it&quot;."}, {"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1569833589, "post_id": 58164337, "comment_id": 102710605, "body": "@NeilLunn Yeah I got it what you are saying."}], "answers": [{"comments": [{"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569833717, "post_id": 58164444, "comment_id": 102710664, "body": "Yeah! I got what are you saying! Thanks! I changed my data structure! :D"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1569841478, "last_edit_date": 1569841478, "creation_date": 1569833465, "answer_id": 58164444, "question_id": 58164337, "link": "https://stackoverflow.com/questions/58164337/cannot-decode-array-into-an-objectid/58164444#58164444", "title": "cannot decode array into an ObjectID", "body": "<p><code>hitches</code> in your database isn't a \"simple\" array, it's an array of arrays, so you may decode that into a value of type <code>[][]primitive.ObjectID</code>:</p>\n\n<pre><code>type Student struct {\n    ID      primitive.ObjectID     `bson:\"_id,omitempty\"`\n    ...\n    Hitches [][]primitive.ObjectID `bson:\"hitches\"`\n    ...\n}\n</code></pre>\n\n<p>Although each element in <code>hitches</code> contains a single element, so this \"2D\" array structure doesn't really make sense, it may be an error on the part where you create these documents. If you change (correct) that to create a \"1-dimensional\" array in MongoDB, then you may decode that into a value of type <code>[]primitive.ObjectID</code>.</p>\n"}], "owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 767, "favorite_count": 0, "accepted_answer_id": 58164444, "answer_count": 1, "score": 3, "last_activity_date": 1569841478, "creation_date": 1569833020, "last_edit_date": 1592644375, "question_id": 58164337, "link": "https://stackoverflow.com/questions/58164337/cannot-decode-array-into-an-objectid", "title": "cannot decode array into an ObjectID", "body": "<p>I have this struct and when I decode it from the database to struct I'm getting this error <code>cannot decode array into an ObjectID</code></p>\n<pre><code>type Student struct {\n    ID           primitive.ObjectID   `bson:&quot;_id,omitempty&quot;`\n    ...\n    Hitches      []primitive.ObjectID `bson:&quot;hitches&quot;`\n    ...\n}\n</code></pre>\n<p>I'm using this function to decode</p>\n<pre><code>func GetStudentByID(ID primitive.ObjectID) model.Student {\n\n    // Filter\n    filter := bson.M{&quot;_id&quot;: ID}\n\n    // Get the collection\n    studentCollection := GetStudentCollection()\n\n    // The object that it will return\n    student := model.Student{}\n\n    // Search the database\n    err := studentCollection.FindOne(context.TODO(), filter).Decode(&amp;student)\n\n    if err != nil {\n        fmt.Println(&quot;Student DAO &quot;, err)  &lt;----------- Error is output here\n        return model.Student{}\n    }\n\n    return student\n}\n</code></pre>\n<p>Here is a screenshot from the MongoDB</p>\n<p><a href=\"https://i.stack.imgur.com/quQKj.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/quQKj.png\" alt=\"\" /></a></p>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "edited": false, "score": 0, "creation_date": 1569867055, "post_id": 58163750, "comment_id": 102727056, "body": "try <code>0.0.0.0:50051</code>, that will listen on all interfaces at port 50051 which is generally what you want"}, {"owner": {"reputation": 3, "user_id": 12141553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/236988604002eefe8a75ee840e6e29e0?s=128&d=identicon&r=PG&f=1", "display_name": "mars", "link": "https://stackoverflow.com/users/12141553/mars"}, "reply_to_user": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "edited": false, "score": 0, "creation_date": 1569983303, "post_id": 58163750, "comment_id": 102767805, "body": "@RobbieMilejczak ths, i try <code>0.0.0.0:50051</code> in server, but it is not ok. i use <code>myInetIp:50051</code> in client, also get the same error like above."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 12141553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/236988604002eefe8a75ee840e6e29e0?s=128&d=identicon&r=PG&f=1", "display_name": "mars", "link": "https://stackoverflow.com/users/12141553/mars"}, "edited": false, "score": 0, "creation_date": 1570120420, "post_id": 58206793, "comment_id": 102822122, "body": "thank you for your suggestion, i change the network, and solved the problem."}], "tags": [], "owner": {"reputation": 576, "user_id": 7371810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c53dfe10f0150e2213e244ef1b93ccde?s=128&d=identicon&r=PG&f=1", "display_name": "menghanl", "link": "https://stackoverflow.com/users/7371810/menghanl"}, "is_accepted": true, "score": 1, "last_activity_date": 1570038764, "creation_date": 1570038764, "answer_id": 58206793, "question_id": 58163750, "link": "https://stackoverflow.com/questions/58163750/504-gateway-time-out-on-grpc/58206793#58206793", "title": "504 Gateway Time-out on GRPC", "body": "<p>It seems the client failed to on proxy (failed to do a <a href=\"https://en.wikipedia.org/wiki/HTTP_tunnel#HTTP_CONNECT_method\" rel=\"nofollow noreferrer\">HTTP Connect</a> handshake).</p>\n\n<p>If you have proxy enabled in your system (the proxy environment variable, <code>HTTP_PROXY</code> or <code>HTTPS_PROXY</code>, is set), make sure the proxy works.</p>\n\n<p>If you don't need proxy, clear the env variables and try again.</p>\n"}], "owner": {"reputation": 3, "user_id": 12141553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/236988604002eefe8a75ee840e6e29e0?s=128&d=identicon&r=PG&f=1", "display_name": "mars", "link": "https://stackoverflow.com/users/12141553/mars"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 728, "favorite_count": 0, "accepted_answer_id": 58206793, "answer_count": 1, "score": 0, "last_activity_date": 1570038764, "creation_date": 1569830505, "question_id": 58163750, "link": "https://stackoverflow.com/questions/58163750/504-gateway-time-out-on-grpc", "title": "504 Gateway Time-out on GRPC", "body": "<p>I am learning rpc&amp;grpc and go now, i was confused by the grpc.</p>\n\n<p>When I was learning the examples on GitHub\uff08<a href=\"https://github.com/grpc/grpc-go/tree/master/examples\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc-go/tree/master/examples</a>\uff09, I encountered some problems. In server, i use <code>address = \"ip:50051\"</code>  instead of <code>address = \":50051\"</code>(ip is my intranet ip), and in client i use  <code>address = \"ip:50051\"</code>  instead of <code>address= \"localhost:50051\"</code>, then run the server and the client, in client i get the error:</p>\n\n<p><code>rpc error: code = Unavailable desc = all SubConns are in TransientFailure, latest connection error: connection error: desc = \"transport: Error while dialing failed to do connect handshake, response: \\\"HTTP/1.0 504 Gateway Time-out\\\\r\\\\nConnection: close</code></p>\n\n<p>But when i learn rpc in golang, use my intranet ip in the server and client, it is ok.</p>\n\n<p>So i want to know why it is wrong in the grpc?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1569828030, "post_id": 58163095, "comment_id": 102707996, "body": "There is no inheritance and virtual methods in Go. <code>Mappable.ToMap()</code> always receives a value of <code>*Mappable</code> regardless of where it&#39;s embedded. &quot;Childs&quot; don&#39;t automatically know about their &quot;parents&quot;, you have to take care of that manually. In your case it&#39;s easier to just create a utility <i>function</i> instead of a <i>method</i>, which may take an <code>interface{}</code> value and do what your <code>Mappable.ToMap()</code> does."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 1, "creation_date": 1569840873, "post_id": 58163095, "comment_id": 102714426, "body": "Just in case it is not clear what icza means by <code>utility function</code>: A function with the signature <code>func ToMap(s interface{}) (reqInterface map[string]interface{})</code>. But I&#39;d strongly suggest to first embrace go&#39;s intentional lack of inheritance (and this far also of generics) and learn how to write idiomatic Go code. Actually I doubt there is a good reason for a <code>ToMap</code> function at all. You are throwing away Go&#39;s type system instead of using it."}], "owner": {"reputation": 1053, "user_id": 227705, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/b78415ec052d8811a4f31c4746cbde9f?s=128&d=identicon&r=PG", "display_name": "siliconsenthil", "link": "https://stackoverflow.com/users/227705/siliconsenthil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "closed_date": 1569827937, "answer_count": 0, "score": 0, "last_activity_date": 1569827994, "creation_date": 1569827541, "question_id": 58163095, "link": "https://stackoverflow.com/questions/58163095/common-tomap-method-across-structs", "closed_reason": "Duplicate", "title": "Common `ToMap` method across structs", "body": "<p>We have a few structs and we wanted to have a common <code>ToMap</code> method that converts the struct to Map. It does by marshaling and unmarshalling to json. But it does not seem to work.</p>\n\n<p>Is it because the <code>Mappable</code> struct receives <code>ToMap()</code> and it does not have any member attributes? \nIf so, is there any way to make <code>ToMap()</code> to be received on <code>Params</code> struct instead of <code>Mappable</code> struct.</p>\n\n<p>I've kept the code below but feel free to edit at <a href=\"https://play.golang.org/p/aDsYxddImxb\" rel=\"nofollow noreferrer\">https://play.golang.org/p/aDsYxddImxb</a> too</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype Mappable struct {}\n\nfunc (m *Mappable) ToMap() (reqInterface map[string]interface{}) {\n    resJson, err := json.Marshal(m)\n    fmt.Println(\"**** err ****\", err)\n    json.Unmarshal(resJson, &amp;reqInterface)\n    return\n}\n\ntype Params struct {\n    Mappable\n    A   string `json:\"a\"`\n    B   string `json:\"b\"`\n    C   string `json:\"c\"`\n    D   string `json:\"d\"`\n}\n\nfunc main() {\n    params := Params{\n        A: \"dummy\",\n        B: \"dummy\",\n        C: \"dummy\",\n        D: \"dummy\",\n    }\n    fmt.Printf(\"struct to convert: %#v \\n\", params)\n    fmt.Println(\"Converted with common ToMap method: \", params.ToMap())\n}\n\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1569839665, "post_id": 58161631, "comment_id": 102713816, "body": "Why are you using a pointer?"}], "answers": [{"tags": [], "owner": {"reputation": 839, "user_id": 4665710, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2B5b.jpg?s=128&g=1", "display_name": "Bharath Kumar", "link": "https://stackoverflow.com/users/4665710/bharath-kumar"}, "is_accepted": false, "score": 0, "last_activity_date": 1569819928, "creation_date": 1569819928, "answer_id": 58161743, "question_id": 58161631, "link": "https://stackoverflow.com/questions/58161631/initializing-error-variable-as-error-pointer/58161743#58161743", "title": "Initializing error variable as error pointer", "body": "<p>you need to assign the memory to the err where you are just defining now. </p>\n\n<p>Replace <strong><code>var err *error</code></strong> with <strong><code>var err = new(error)</code></strong> or <strong><code>err := new(error)</code></strong> to instantiate and make this code work.</p>\n"}, {"tags": [], "owner": {"reputation": 923, "user_id": 4735706, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/550c63615be76b768e5b8b271f2657e0?s=128&d=identicon&r=PG&f=1", "display_name": "Jibin Mathews", "link": "https://stackoverflow.com/users/4735706/jibin-mathews"}, "is_accepted": false, "score": 0, "last_activity_date": 1569847544, "creation_date": 1569847544, "answer_id": 58168222, "question_id": 58161631, "link": "https://stackoverflow.com/questions/58161631/initializing-error-variable-as-error-pointer/58168222#58168222", "title": "Initializing error variable as error pointer", "body": "<p>I never needed to pass pointer</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"errors\"\n)\n\nfunc main() {\n    var err error\n\n    defer func() {\n        if err != nil {\n            fmt.Println(\"hi\")\n        } else {\n            fmt.Println(\"oh\")\n        }\n    }()\n    err = errors.New(\"EMPTY_BODY\")\n}\n</code></pre>\n\n<p>I thought i needed as defer was taking the value of err at that point not at the end of function.</p>\n"}], "owner": {"reputation": 923, "user_id": 4735706, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/550c63615be76b768e5b8b271f2657e0?s=128&d=identicon&r=PG&f=1", "display_name": "Jibin Mathews", "link": "https://stackoverflow.com/users/4735706/jibin-mathews"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 121, "favorite_count": 0, "answer_count": 2, "score": -5, "last_activity_date": 1569847544, "creation_date": 1569818989, "last_edit_date": 1569839623, "question_id": 58161631, "link": "https://stackoverflow.com/questions/58161631/initializing-error-variable-as-error-pointer", "title": "Initializing error variable as error pointer", "body": "<p>Trying to handle all error in a single defer function.\nBut err can't be assigned as a pointer to error? As it gives me Invalid memory address error</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"errors\"\n)\n\nfunc main() {\n    var err *error\n\n    defer func(err *error) {\n        if *err != nil {\n            fmt.Println(\"hi\")\n        } else {\n            fmt.Println(\"oh\")\n        }\n    }(err)\n    *err = errors.New(\"EMPTY_BODY\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/DxkGobgVWnM\" rel=\"nofollow noreferrer\">playground</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5056, "user_id": 4276090, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/r87tb.jpg?s=128&g=1", "display_name": "Skam", "link": "https://stackoverflow.com/users/4276090/skam"}, "edited": false, "score": 0, "creation_date": 1569809241, "post_id": 58160666, "comment_id": 102703586, "body": "<a href=\"https://gist.github.com/denji/12b3a568f092ab951456\" rel=\"nofollow noreferrer\">this gist</a> looks promising"}], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 1, "last_activity_date": 1569809914, "last_edit_date": 1569809914, "creation_date": 1569809443, "answer_id": 58160725, "question_id": 58160666, "link": "https://stackoverflow.com/questions/58160666/how-http-request-in-gloang-attaches-cert-pem-and-key-pem/58160725#58160725", "title": "How http request in gloang attaches cert.pem and key.pem?", "body": "<p>Load the certificate files using <a href=\"https://golang.org/pkg/crypto/tls/#LoadX509KeyPair\" rel=\"nofollow noreferrer\">tls.LoadX509KeyPair</a>, and create a <a href=\"https://golang.org/pkg/crypto/tls/#Config\" rel=\"nofollow noreferrer\">tls.Config</a> which has the loaded certificate in its <code>Certificates</code> slice. Make an <a href=\"https://golang.org/pkg/net/http/#Transport\" rel=\"nofollow noreferrer\">http.Transport</a> which has that config as its <code>TLSClientConfig</code>, and make an <a href=\"https://golang.org/pkg/net/http/#Client\" rel=\"nofollow noreferrer\">http.Client</a> which has that transport as its <code>Transport</code>. Finally, make requests using that client!</p>\n"}], "owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 58160725, "answer_count": 1, "score": 0, "last_activity_date": 1569809914, "creation_date": 1569808703, "question_id": 58160666, "link": "https://stackoverflow.com/questions/58160666/how-http-request-in-gloang-attaches-cert-pem-and-key-pem", "title": "How http request in gloang attaches cert.pem and key.pem?", "body": "<p>I'm using golang and want my request to attach <code>apiclient_cert.p12</code>. </p>\n\n<p>After searching from internet, I find golang doesn't support decoding <code>file.p12</code>.So I transfer <code>apiclient.p12</code> into <code>cert.pem</code> and <code>key.pem</code>.</p>\n\n<p>Now I've know <code>cert.pem</code> and <code>key.pem</code> path. How to use it in golang http request.</p>\n"}, {"tags": ["parsing", "go"], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 10647583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad9763120996efab32e1de3f36006228?s=128&d=identicon&r=PG&f=1", "display_name": "Francis", "link": "https://stackoverflow.com/users/10647583/francis"}, "edited": false, "score": 0, "creation_date": 1570034636, "post_id": 58160384, "comment_id": 102789765, "body": "Thanks for your advice about breaking the code into smaller functions!"}], "tags": [], "owner": {"reputation": 49, "user_id": 7190425, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9DOWH.jpg?s=128&g=1", "display_name": "Aaron Raff", "link": "https://stackoverflow.com/users/7190425/aaron-raff"}, "is_accepted": false, "score": 0, "last_activity_date": 1569805380, "creation_date": 1569805380, "answer_id": 58160384, "question_id": 58159554, "link": "https://stackoverflow.com/questions/58159554/how-to-make-my-go-parser-code-more-readable/58160384#58160384", "title": "How to make my go parser code more readable", "body": "<p>As far as how to make your code more readable, there is not always a cut and dry answer. I personally find that code is more readable when you can use function names in place of comments in the code. A lot of people like to recommend the book \"Clean Code\" by Robert C. Martin. He pushes this throughout the book, small functions that have one purpose and are self documenting (via the function name).</p>\n\n<p>Of course, as I said before this is a subjective topic. I took a crack at it, and came up with the code below, which I personally feel is more readable. It also uses the function names to document what is going on. That way the reader doesn't necessarily need to dig into every single statement in the code, but rather just the high level function names if they don't need all of the details.</p>\n\n<pre><code>// assignment                 : variable_list '=' expr_list\n//                            | variable_list type\n//                            | variable_list type '=' expr_list\nfunc (p *Parser) assignment() ast.Noder {\n    assignment := &amp;ast.AssignmentNode{}\n    assignment.Left = p.variable_list()\n\n    // This if-statement deals with rule 2 or 3\n    if p.currentToken.Type != token.ASSIGN {\n        // Static variable declaration\n        // Could be a declaration or an assignment\n        // Only static variables can be declared without providing a value\n        p.parseStaticStatement(assignment)\n    } else {\n        p.parseVariableAssignment(assignment)\n    }\n\n    if assignment.Right == nil {\n        assignment.appendDefaultValues()\n    }\n\n    p.checkForUnbalancedAssignment(assignment)\n\n    return assignment\n}\n\nfunc (p *Parser) parseStaticStatement(assignment *ast.AssingmentNode) {\n    assignment.IsStatic = true\n    assignment.Type = p.var_type().Value\n    assignment.Right = nil\n\n    p.nextToken()\n\n    // Rule 2 is finished at this point in the code\n    // This if-statement is for rule 3\n    if p.currentToken.Type == token.ASSIGN {\n        a.parseStaticAssignment()\n    } \n}\n\nfunc (p *Parser) parseStaticAssignment(assignment *ast.AssignmentNode) {\n    assignment.Operator = p.currentToken\n    p.nextToken()\n    assignment.Right = p.expr_list() \n}\n\nfunc (p *Parser) parseVariableAssignment(assignment *ast.AssignmentNode) {\n    // This deals with rule 1\n    assignment.Operator = p.currentToken\n    p.nextToken()\n    assignment.Right = p.expr_list()\n}\n\nfunc (a *ast.AssignmentNode) appendDefaultValues() {\n    for i := 0; i &lt; len(assignment.Left); i++ {\n        assignment.Right = append(assignment.Right, nil)\n    }\n}\n\nfunc (p *Parser) checkForUnbalancedAssignment(assignment *ast.AssignmentNode) {\n    if len(assignment.Left) != len(assignment.Right) {\n        p.FoundError(p.syntaxError(\"variable mismatch, \" + strconv.Itoa(len(assignment.Left)) + \" on left but \" + strconv.Itoa(len(assignment.Right)) + \" on right,\"))\n    }\n}\n</code></pre>\n\n<p>I hope that you find this helpful. I am more than willing to answer any further questions that you may have if you leave a comment on my response.</p>\n"}, {"comments": [{"owner": {"reputation": 53, "user_id": 10647583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad9763120996efab32e1de3f36006228?s=128&d=identicon&r=PG&f=1", "display_name": "Francis", "link": "https://stackoverflow.com/users/10647583/francis"}, "edited": false, "score": 0, "creation_date": 1570034542, "post_id": 58163577, "comment_id": 102789731, "body": "Thanks for your help! assignment.Right is a slice containing the nodes for each of the variables on the rhs of the assignment. For the code: <code>a,b,c = 10,20,30</code>, assignment.Left = [a,b,c] and assignment.Right = [10,20,30] and I check the length of the slices are the same to pick up errors like this: <code>a,b,c = 10,20</code> ie. 3 variables on the lhs and only 2 on the rhs. Thanks for your help!"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1569867702, "last_edit_date": 1569867702, "creation_date": 1569829727, "answer_id": 58163577, "question_id": 58159554, "link": "https://stackoverflow.com/questions/58159554/how-to-make-my-go-parser-code-more-readable/58163577#58163577", "title": "How to make my go parser code more readable", "body": "<blockquote>\n  <p>how I can make my code more readable?</p>\n</blockquote>\n\n<hr>\n\n<p>For readability, a prerequisite for correct, maintainable code,</p>\n\n<pre><code>// assignment                 : variable_list '=' expr_list\n//                            | variable_list type\n//                            | variable_list type '=' expr_list\nfunc (p *Parser) assignment() ast.Noder {\n    assignment := &amp;ast.AssignmentNode{}\n\n    // variable_list\n    assignment.Left = p.variable_list()\n\n    // type\n    if p.currentToken.Type != token.ASSIGN {\n        // Static variable declaration\n        // Could be a declaration or an assignment\n        // Only static variables can be declared without providing a value\n        assignment.IsStatic = true\n\n        assignment.Type = p.var_type().Value\n        p.nextToken()\n    }\n\n    // '=' expr_list\n    if p.currentToken.Type == token.ASSIGN {\n        assignment.Operator = p.currentToken\n        p.nextToken()\n        assignment.Right = p.expr_list()\n    }\n\n    // variable_list [expr_list]\n    if assignment.Right == nil {\n        for i := 0; i &lt; len(assignment.Left); i++ {\n            assignment.Right = append(assignment.Right, nil)\n        }\n    }\n    if len(assignment.Left) != len(assignment.Right) {\n        p.FoundError(p.syntaxError(fmt.Sprintf(\n            \"variable mismatch, %d on left but %d on right,\",\n            len(assignment.Left), len(assignment.Right),\n        )))\n    }\n\n    return assignment\n}\n</code></pre>\n\n<hr>\n\n<p>Note: This likely inefficient and overly complicated:</p>\n\n<pre><code>for i := 0; i &lt; len(assignment.Left); i++ {\n    assignment.Right = append(assignment.Right, nil)\n}\n</code></pre>\n\n<p>What is the type of <code>assignment.Right</code>?</p>\n"}], "owner": {"reputation": 53, "user_id": 10647583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad9763120996efab32e1de3f36006228?s=128&d=identicon&r=PG&f=1", "display_name": "Francis", "link": "https://stackoverflow.com/users/10647583/francis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 1, "accepted_answer_id": 58163577, "answer_count": 2, "score": 1, "last_activity_date": 1569867702, "creation_date": 1569794667, "question_id": 58159554, "link": "https://stackoverflow.com/questions/58159554/how-to-make-my-go-parser-code-more-readable", "title": "How to make my go parser code more readable", "body": "<p>I'm writing a recursive descent parser in Go for a simple made-up language, so I'm designing the grammar as I go. My parser works but I wanted to ask if there are any best practices for how I should lay out my code or when I should put code in its own function etc ... to make it more readable.</p>\n\n<p>I've been building the parser by following the simple rules I've learned so far ie. each non-terminal is it's own function, even though my code works I think looks really messy and unreadable.</p>\n\n<p>I've included the code for the assignment non-terminal and the grammar above the function.</p>\n\n<p>I've taken out most of the error handling to keep the function smaller.</p>\n\n<p>Here's some examples of what that code can parse:</p>\n\n<pre><code>a = 10\na,b,c = 1,2,3\na int = 100\na,b string = \"hello\", \"world\"\n</code></pre>\n\n<p>Can anyone give me some advice as to how I can make my code more readable please?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// assignment                 : variable_list '=' expr_list\n//                            | variable_list type\n//                            | variable_list type '=' expr_list\nfunc (p *Parser) assignment() ast.Noder {\n\n    assignment := &amp;ast.AssignmentNode{}\n\n    assignment.Left = p.variable_list()\n\n    // This if-statement deals with rule 2 or 3\n    if p.currentToken.Type != token.ASSIGN {\n        // Static variable declaration\n        // Could be a declaration or an assignment\n        // Only static variables can be declared without providing a value\n        assignment.IsStatic = true\n\n        assignment.Type = p.var_type().Value\n\n        assignment.Right = nil\n\n        p.nextToken()\n        // Rule 2 is finished at this point in the code\n        // This if-statement is for rule 3\n        if p.currentToken.Type == token.ASSIGN {\n            assignment.Operator = p.currentToken\n\n            p.nextToken()\n\n            assignment.Right = p.expr_list()\n        }\n\n    } else {\n        // This deals with rule 1\n        assignment.Operator = p.currentToken\n\n        p.nextToken()\n\n        assignment.Right = p.expr_list()\n\n    }\n\n    if assignment.Right == nil {\n        for i := 0; i &lt; len(assignment.Left); i++ {\n            assignment.Right = append(assignment.Right, nil)\n        }\n    }\n\n    if len(assignment.Left) != len(assignment.Right) {\n        p.FoundError(p.syntaxError(\"variable mismatch, \" + strconv.Itoa(len(assignment.Left)) + \" on left but \" + strconv.Itoa(len(assignment.Right)) + \" on right,\"))\n    }\n\n    return assignment\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1569790364, "post_id": 58158802, "comment_id": 102700545, "body": "See <a href=\"https://cloud.google.com/appengine/docs/standard/go112/specifying-dependencies\" rel=\"nofollow noreferrer\">here</a> for changes with Go Modules. You&#39;ll need to either (continue to) use <code>GOPATH</code> or (recommended) consider migrating to Go Modules and using <code>go.mod</code>. The documentation explains how to reference dependencies correctly using both approaches."}, {"owner": {"reputation": 145, "user_id": 788720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypwje.png?s=128&g=1", "display_name": "Soesah", "link": "https://stackoverflow.com/users/788720/soesah"}, "reply_to_user": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1569790863, "post_id": 58158802, "comment_id": 102700656, "body": "My app is both in my <code>GOPATH</code>, and I&#39;ve also created a <code>go.mod</code> file. The file not being find is not technically a dependency, it&#39;s just a part of my app."}, {"owner": {"reputation": 145, "user_id": 788720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypwje.png?s=128&g=1", "display_name": "Soesah", "link": "https://stackoverflow.com/users/788720/soesah"}, "reply_to_user": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1569793059, "post_id": 58158802, "comment_id": 102701081, "body": "I&#39;ve removed <code>go.mod</code> but this causes every other dependency not to be found. Checkout <code>go env GOPATH</code> gives me the correct path where everything lives..."}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1569793639, "post_id": 58158802, "comment_id": 102701191, "body": "I suggest using a <code>go.mod</code> file and moving your code to outside of your <code>GOPATH</code>. If you are trying to use a <code>go.mod</code> from within <code>GOPATH</code>, make sure you set <code>GO111MODULE=on</code>. You can create it with <code>go mod init github.com&#47;a</code>."}, {"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1569794775, "post_id": 58158802, "comment_id": 102701400, "body": "Apologies I missed your comment that you&#39;re using <code>go.mod</code>. Will try to repro. Ensure you&#39;re using absolute references in your imports; the prefix should match your <code>go.mod</code> modules path."}, {"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1569802470, "post_id": 58158802, "comment_id": 102702546, "body": "Hmmm..... ;-) I&#39;m able to repro. It appears (!) that your project must be in <code>GOPATH</code> even if you&#39;re using modules. I mimicked your project structure outside of <code>GOPATH</code> and observed the error but, after moving my project into <code>GOPATH</code>, deployment proceeds."}, {"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1569805165, "post_id": 58158802, "comment_id": 102702912, "body": "The issue appears specific to Flex. For Standard, I was able to deploy outside of <code>GOPATH</code> without issue. Switching to Flex, generates the error."}, {"owner": {"reputation": 145, "user_id": 788720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypwje.png?s=128&g=1", "display_name": "Soesah", "link": "https://stackoverflow.com/users/788720/soesah"}, "edited": false, "score": 0, "creation_date": 1569819077, "post_id": 58158802, "comment_id": 102705214, "body": "So I should switch to standard? I have it set to <code>F1</code> now. I was wondering if it could be related to my code being in a private repro."}, {"owner": {"reputation": 145, "user_id": 788720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypwje.png?s=128&g=1", "display_name": "Soesah", "link": "https://stackoverflow.com/users/788720/soesah"}, "edited": false, "score": 0, "creation_date": 1569820045, "post_id": 58158802, "comment_id": 102705414, "body": "I&#39;ve removed <code>instance_class</code> from <code>app.yaml</code> (to force default) but this did not work."}, {"owner": {"reputation": 145, "user_id": 788720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypwje.png?s=128&g=1", "display_name": "Soesah", "link": "https://stackoverflow.com/users/788720/soesah"}, "edited": false, "score": 0, "creation_date": 1569879287, "post_id": 58158802, "comment_id": 102731831, "body": "Whether I move the repo to outside <code>GOPATH</code>, and with or without Flex, I still get the same error. I&#39;ll try reproducing with a smaller app, to see if I can pinpoint the issue further, but it make no sense to me whatsoever."}, {"owner": {"reputation": 733, "user_id": 11193025, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-zVJHj5gZLow/AAAAAAAAAAI/AAAAAAAAAOs/9wgAFNIrCUs/photo.jpg?sz=128", "display_name": "Andie Vanille", "link": "https://stackoverflow.com/users/11193025/andie-vanille"}, "edited": false, "score": 0, "creation_date": 1569963631, "post_id": 58158802, "comment_id": 102763698, "body": "Maybe the issue is the GOPATH and GOROOT configuration. I had a simillar issue and this <a href=\"https://stackoverflow.com/questions/7970390/what-should-be-the-values-of-gopath-and-goroot\">answer</a> and this <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">tutorial</a> helped me to understand how these variables need to be configured."}], "owner": {"reputation": 145, "user_id": 788720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypwje.png?s=128&g=1", "display_name": "Soesah", "link": "https://stackoverflow.com/users/788720/soesah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 324, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1569787778, "creation_date": 1569787778, "question_id": 58158802, "link": "https://stackoverflow.com/questions/58158802/package-from-local-module-not-being-found-cannot-find-module-providing-package", "title": "Package from local module not being found &quot;cannot find module providing package&quot;", "body": "<p>I've been upgrading my app engine site to <strong>go112</strong>. The go app (with package <code>github.com/a/main.go</code>) is using a number of sub packages in a folder called <code>api</code> (<code>github.com/a/api/</code>) and another called <code>server</code>. These sub packages use other dependencies. </p>\n\n<p>When I run <code>go vet</code>, <code>go build</code> everything seems to be just fine.</p>\n\n<p>When I deploy the app to app engine the build process fails (using Cloud Build). The output shows that a package from the <code>api</code> folder cannot be found. When remove the references to that package, the build fails on another package from the <code>server</code> folder.</p>\n\n<p>The curious thing is that it my own code that cannot be found by the compilation on app engine</p>\n\n<p>It is as if all of the sub packages are not being 'uploaded', but I cannot understand why.</p>\n\n<p>I've run <code>go mod init</code> and <code>go build ./...</code> without any issues.</p>\n"}, {"tags": ["templates", "go", "go-templates"], "comments": [{"owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 0, "creation_date": 1569787600, "post_id": 58158658, "comment_id": 102699934, "body": "Seems very similar to <a href=\"https://stackoverflow.com/questions/43263280/go-template-cant-evaluate-field-x-in-type-y-x-not-part-of-y-but-stuck-in-a\" title=\"go template cant evaluate field x in type y x not part of y but stuck in a\">stackoverflow.com/questions/43263280/&hellip;</a> and <a href=\"https://stackoverflow.com/questions/37124256/go-cant-evaluate-field-when-using-range-to-build-from-template\" title=\"go cant evaluate field when using range to build from template\">stackoverflow.com/questions/37124256/&hellip;</a>"}, {"owner": {"reputation": 1087, "user_id": 5205011, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/968219f104811ae38a507aae54cef85b?s=128&d=identicon&r=PG&f=1", "display_name": "davidb", "link": "https://stackoverflow.com/users/5205011/davidb"}, "reply_to_user": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 0, "creation_date": 1569790515, "post_id": 58158658, "comment_id": 102700570, "body": "I checked both those threads before and I still don&#39;t understand how to apply that to my code. I was following some online tutorial and all is nice and fancy save the template. Any idea what should I do in my code above?"}], "answers": [{"comments": [{"owner": {"reputation": 1087, "user_id": 5205011, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/968219f104811ae38a507aae54cef85b?s=128&d=identicon&r=PG&f=1", "display_name": "davidb", "link": "https://stackoverflow.com/users/5205011/davidb"}, "edited": false, "score": 0, "creation_date": 1569791471, "post_id": 58159127, "comment_id": 102700786, "body": "I still don&#39;t get it. Let&#39;s say we forget about .Customer and I want to loop over orders inside ps only. How do I do that?"}, {"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "reply_to_user": {"reputation": 1087, "user_id": 5205011, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/968219f104811ae38a507aae54cef85b?s=128&d=identicon&r=PG&f=1", "display_name": "davidb", "link": "https://stackoverflow.com/users/5205011/davidb"}, "edited": false, "score": 1, "creation_date": 1569792240, "post_id": 58159127, "comment_id": 102700932, "body": "@davidb your template should work when you remove the <code>{ .Customer }</code> - the single dot references your slice. The range loop looks good, it should work as is"}, {"owner": {"reputation": 1087, "user_id": 5205011, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/968219f104811ae38a507aae54cef85b?s=128&d=identicon&r=PG&f=1", "display_name": "davidb", "link": "https://stackoverflow.com/users/5205011/davidb"}, "edited": false, "score": 0, "creation_date": 1569792512, "post_id": 58159127, "comment_id": 102700980, "body": "I get it now! I was planning on getting customer from somewhere else anyway so as long as this works I&#39;m good to go. Thank you!"}], "tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": true, "score": 2, "last_activity_date": 1569790567, "creation_date": 1569790567, "answer_id": 58159127, "question_id": 58158658, "link": "https://stackoverflow.com/questions/58158658/template-cant-evaluate-field-x-in-type-y/58159127#58159127", "title": "Template can&#39;t evaluate field X in type Y", "body": "<p>You're passing <code>ps</code>, a slice of <code>main.Order</code> to your template. In your template, <code>.</code> still is the slice.</p>\n\n<p>Your line <code>&lt;h3&gt;Your username is {{ .Customer }}&lt;/h3&gt;</code> tries to access the member <code>Customer</code> of this <code>[]main.Order</code> - which it doesn't have.</p>\n\n<p>You probably want to get the customer name from the first element of the slice or pass a struct to your template that has this field, e.g. like this:</p>\n\n<pre><code>type Customer struct {\n    Orders []Order\n    Username string\n}\n</code></pre>\n\n<p>Then you would need to change your template like this:</p>\n\n<pre><code>&lt;h1&gt;Hello&lt;/h1&gt;\n&lt;h3&gt;Your username is {{ .Username }}&lt;/h3&gt;\n{{ range .Orders }}\n&lt;h2&gt; {{ .Order_id }}&lt;/h2&gt;\n{{ end }}\n</code></pre>\n"}], "owner": {"reputation": 1087, "user_id": 5205011, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/968219f104811ae38a507aae54cef85b?s=128&d=identicon&r=PG&f=1", "display_name": "davidb", "link": "https://stackoverflow.com/users/5205011/davidb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1041, "favorite_count": 0, "accepted_answer_id": 58159127, "answer_count": 1, "score": 2, "last_activity_date": 1569839696, "creation_date": 1569786610, "last_edit_date": 1569839696, "question_id": 58158658, "link": "https://stackoverflow.com/questions/58158658/template-cant-evaluate-field-x-in-type-y", "title": "Template can&#39;t evaluate field X in type Y", "body": "<p>In Go I loop through a query result and append the results to a slice. I then try to display the data in html template, however I keep getting this error: <code>executing \"orders.html\" at &lt;.Customer&gt;: can't evaluate field Customer in type []main.Order</code>\nHere's my code:</p>\n\n<pre><code>type Order struct {\n    Order_id int\n    Customer string\n    Date_of_purchase string\n}\n\nfunc OrderPage(w http.ResponseWriter, r *http.Request) {\ndb := dbConnection()\nvar (\n    order_id int\n    customer string\n    date_of_p string\n    ps []Order\n)\nrows, err := db.Query(\"SELECT * FROM orders WHERE customer = 'David'\")\nif err != nil {\n    panic(err.Error())\n}\nfor rows.Next() {\n    err = rows.Scan(&amp;order_id, &amp;customer, &amp;date_of_p)\n    if err != nil {\n        log.Println(err)\n        http.Error(w, \"there was an error\", http.StatusInternalServerError)\n        return\n    }\n    ps = append(ps, Order{Order_id: order_id, Customer: customer, Date_of_purchase: date_of_p})\n}\ntemp, err := template.ParseFiles(\"templates/orders.html\")\nif err != nil { \n  log.Print(\"template parsing error: \", err)\n}\nerr = temp.Execute(w, ps)\nif err != nil {\n    fmt.Println(err)\n}\n}\n</code></pre>\n\n<p>My html template looks like this:</p>\n\n<pre><code>&lt;h1&gt;Hello&lt;/h1&gt;\n&lt;h3&gt;Your username is {{ .Customer }}&lt;/h3&gt;\n{{ range . }}\n&lt;h2&gt; {{ .Order_id }}&lt;/h2&gt;\n{{ end }}\n</code></pre>\n\n<p>I fetch the data from DB, just can't display it on html page.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 342, "user_id": 6207792, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mclTiFiiZ3c/AAAAAAAAAAI/AAAAAAAAALo/VlrIwDjjrf8/photo.jpg?sz=128", "display_name": "dj1986", "link": "https://stackoverflow.com/users/6207792/dj1986"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1569782228, "post_id": 58158087, "comment_id": 102698695, "body": "@hobbs thanks for the info. Can you please explain how?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1569851279, "post_id": 58158087, "comment_id": 102719800, "body": "Please take the <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">Tour of Go</a> which covers all the language basics, including why this code deadlocks."}], "answers": [{"tags": [], "owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "is_accepted": false, "score": 2, "last_activity_date": 1569783451, "last_edit_date": 1569783451, "creation_date": 1569782395, "answer_id": 58158155, "question_id": 58158087, "link": "https://stackoverflow.com/questions/58158087/dont-have-any-go-routine-but-still-getting-all-goroutines-are-asleep-deadlock/58158155#58158155", "title": "Don&#39;t have any go routine but still getting &quot;all goroutines are asleep -deadlock&quot;", "body": "<p>you are writing/sending data to the channel but you are not reading/receiving data from the same channel. A writing/reading to a channel blocks unless you read/write the data from it.</p>\n\n<p>write a for loop that reads data from the channel a or use buffered channel</p>\n\n<p>Adding some logs reveals the second case.</p>\n\n<p>In the second case you have spawned 10 seperate go routines but all of them are blocked because the data is never read from the channel a, and after 10 iterations the for loop exits followed by the main function.</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"time\"\n)\n\nfunc main(){\n\n  var a chan int\n  a = make(chan int)\n  for j:=0;j&lt;10;j++{\n    go firstRoutine(a, j)\n    fmt.Println(\"sleeping\")\n    time.Sleep(3 * time.Millisecond)\n    fmt.Println(\"awake\")\n  }\n}\n\nfunc firstRoutine(chennel chan int, j int){\n  i:=0\n  fmt.Println(\"j = \", j, \"chennel = \", chennel)\n  chennel &lt;- i\n  fmt.Println(\"pushed to channel\"); // never gets printed\n}\n</code></pre>\n\n<p>Upon using buffered channle:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"time\"\n)\n\nfunc main(){\n\n  var a chan int\n  a = make(chan int, 11) // making a buffered channel of 11 elements\n  for j:=0;j&lt;10;j++{\n    go firstRoutine(a, j)\n    fmt.Println(\"sleeping\")\n    time.Sleep(3 * time.Millisecond)\n    fmt.Println(\"awake\")\n  }\n}\n\nfunc firstRoutine(chennel chan int, j int){\n  i:=0\n  fmt.Println(\"j = \", j, \"chennel = \", chennel)\n  chennel &lt;- i\n  fmt.Println(\"pushed to channel\"); // gets printed as buffer is bigger than the iterations, so no blocking\n}\n</code></pre>\n"}], "owner": {"reputation": 342, "user_id": 6207792, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mclTiFiiZ3c/AAAAAAAAAAI/AAAAAAAAALo/VlrIwDjjrf8/photo.jpg?sz=128", "display_name": "dj1986", "link": "https://stackoverflow.com/users/6207792/dj1986"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1569839723, "creation_date": 1569781916, "last_edit_date": 1569839723, "question_id": 58158087, "link": "https://stackoverflow.com/questions/58158087/dont-have-any-go-routine-but-still-getting-all-goroutines-are-asleep-deadlock", "title": "Don&#39;t have any go routine but still getting &quot;all goroutines are asleep -deadlock&quot;", "body": "<p>I was doing some experiments. Below is my code.</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"time\"\n)\n\nfunc main(){\n  var a chan int\n  a = make(chan int)\n  for j:=0;j&lt;10;j++{\n    firstRoutine(a, j)\n    time.Sleep(3 * time.Millisecond)\n  }\n}\n\nfunc firstRoutine(chennel chan int, j int){\n  i:=0\n  fmt.Println(\"j = \", j, \"chennel = \", chennel)\n  chennel &lt;- i\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>F:\\Git\\GitHub\\GO\\Prog\\Concorrency&gt;go run Channels.go\nj =  0 chennel =  &lt;nil&gt;\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan send (nil chan)]:\nmain.firstRoutine(0x0, 0x0)\n        F:/Git/GitHub/GO/Prog/Concorrency/Channels.go:24 +0x11f\nmain.main()\n        F:/Git/GitHub/GO/Prog/Concorrency/Channels.go:14 +0x3f\nexit status 2\n</code></pre>\n\n<p>I don't have any <code>gorutines</code> in my program but still getting this error.</p>\n\n<p>Below program works, at least no goroutine error. only change is <code>go firstRoutine(a, j)</code></p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"time\"\n)\n\nfunc main(){\n\n  var a chan int\n  a = make(chan int)\n  for j:=0;j&lt;10;j++{\n    go firstRoutine(a, j)\n    time.Sleep(3 * time.Millisecond)\n  }\n}\n\nfunc firstRoutine(chennel chan int, j int){\n  i:=0\n  fmt.Println(\"j = \", j, \"chennel = \", chennel)\n  chennel &lt;- i\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>F:\\Git\\GitHub\\GO\\Prog\\Concorrency&gt;go run Channels.go\nj =  0 chennel =  0xc000048060\nj =  1 chennel =  0xc000048060\nj =  2 chennel =  0xc000048060\nj =  3 chennel =  0xc000048060\nj =  4 chennel =  0xc000048060\nj =  5 chennel =  0xc000048060\nj =  6 chennel =  0xc000048060\nj =  7 chennel =  0xc000048060\nj =  8 chennel =  0xc000048060\nj =  9 chennel =  0xc000048060\n</code></pre>\n"}, {"tags": ["go", "https", "server", "fileserver"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1569781231, "post_id": 58157860, "comment_id": 102698447, "body": "You&#39;re always serving <code>&#47;</code> (third argument to ServeFile), independent of the request path. Have you considered <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\">http.FileServer</a>?"}, {"owner": {"reputation": 11, "user_id": 12139186, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uyBcz.jpg?s=128&g=1", "display_name": "John", "link": "https://stackoverflow.com/users/12139186/john"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1569810212, "post_id": 58157860, "comment_id": 102703743, "body": "Hi @peter , I&#39;ve added <b>http.FileServer(http.Dir(&quot;/&quot;))</b> instead of <b>http.ServeFile(w, req, &quot;/&quot;)</b> and now i get blank page as a response. Not grasping how http works yet or I&#39;m missing something."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1569851815, "post_id": 58157860, "comment_id": 102720129, "body": "The documentation is clear and thorough, and includes multiple examples, I&#39;d highly recommend taking a look at the docs for the libraries you&#39;re using. For example, here&#39;s <code>http.FileServer</code> and its three examples: <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#FileServer</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 12139186, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uyBcz.jpg?s=128&g=1", "display_name": "John", "link": "https://stackoverflow.com/users/12139186/john"}, "edited": false, "score": 0, "creation_date": 1570364696, "post_id": 58171814, "comment_id": 102883271, "body": "Thank you for actually giving an answer Rick-777. Sometimes just a few words are not enough for a beginner in a new language. Working code or more practical answers are needed. This approach you showed here is helping me understand more about the handlers and I didn&#39;t find it initially.   For the rest, please be more open to others when asking for help, we know the documentation is there, but its one thing to read it and another to make it work when you need custom code and you are not an experience programmer."}], "tags": [], "owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "is_accepted": false, "score": 1, "last_activity_date": 1569860870, "creation_date": 1569860870, "answer_id": 58171814, "question_id": 58157860, "link": "https://stackoverflow.com/questions/58157860/issues-creating-an-https-server-to-serve-binaries-and-other-files/58171814#58171814", "title": "Issues creating an HTTPS server to serve binaries and other files", "body": "<p>There are several examples elsewhere on how to do this (as has been commented).</p>\n\n<p>Here's a worked example in which the fileserver handler is an enhanced version of that in the standard library that supports more cache headers and locally-compressed files. The standard fileserver handler can be dropped in here instead if that's what you need.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n\n    \"github.com/rickb777/servefiles/v3\"\n)\n\nvar path = flag.String(\"path\", \"..\", \"directory for the files tp be served\")\nvar cert = flag.String(\"cert\", \"\", \"file containing the certificate (optional)\")\nvar key = flag.String(\"key\", \"\", \"file containing the private key (optional)\")\nvar port = flag.Int(\"port\", 8080, \"TCP port to listen on\")\nvar maxAge = flag.String(\"maxage\", \"\", \"Maximum age of assets sent in response headers - causes client caching\")\nvar verbose = flag.Bool(\"v\", false, \"Enable verbose messages\")\n\nfunc main() {\n    flag.Parse()\n\n    if *verbose {\n        servefiles.Debugf = log.Printf\n    }\n\n    if (*cert != \"\" &amp;&amp; *key == \"\") ||\n        (*cert == \"\" &amp;&amp; *key != \"\") {\n        log.Fatal(\"Both certificate file (-cert) and private key file (-key) are required.\")\n    }\n\n    h := servefiles.NewAssetHandler(*path)\n\n    if *maxAge != \"\" {\n        d, err := time.ParseDuration(*maxAge)\n        log.Printf(\"MaxAge: %s %v\\n\", d, err)\n        h = h.WithMaxAge(d)\n    }\n\n    srv := &amp;http.Server{\n        Addr:    fmt.Sprintf(\":%d\", *port),\n        Handler: h,\n    }\n\n    if *cert != \"\" {\n        srv.TLSConfig = &amp;tls.Config{\n            MinVersion:               tls.VersionTLS12,\n            CurvePreferences:         []tls.CurveID{tls.CurveP521, tls.CurveP384, tls.CurveP256},\n            PreferServerCipherSuites: true,\n            CipherSuites: []uint16{\n                tls.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,\n                tls.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,\n                tls.TLS_RSA_WITH_AES_256_GCM_SHA384,\n                tls.TLS_RSA_WITH_AES_256_CBC_SHA,\n                tls.TLS_AES_256_GCM_SHA384,\n            },\n        }\n        log.Printf(\"Access the server via: https://localhost:%d/\", *port)\n        log.Fatal(srv.ListenAndServeTLS(*cert, *key))\n\n    } else {\n        log.Printf(\"Access the server via: http://localhost:%d/\", *port)\n        log.Fatal(srv.ListenAndServe())\n    }\n}\n</code></pre>\n\n<p>Source code <a href=\"https://github.com/rickb777/servefiles/blob/master/v3/webserver/example.go\" rel=\"nofollow noreferrer\">https://github.com/rickb777/servefiles/blob/master/v3/webserver/example.go</a></p>\n"}], "owner": {"reputation": 11, "user_id": 12139186, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uyBcz.jpg?s=128&g=1", "display_name": "John", "link": "https://stackoverflow.com/users/12139186/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569860870, "creation_date": 1569780215, "last_edit_date": 1569839776, "question_id": 58157860, "link": "https://stackoverflow.com/questions/58157860/issues-creating-an-https-server-to-serve-binaries-and-other-files", "title": "Issues creating an HTTPS server to serve binaries and other files", "body": "<p><strong>What I want to achieve:</strong>\nAn HTTPS server designed specifically to serve binaries to around 1000 devices, sometimes in the same time (clients will fetch the binaries via wget, curl, browser download, etc).</p>\n\n<p><strong>Key functionality features:</strong></p>\n\n<ul>\n<li>client won't be able to download the binary without a certificate</li>\n<li>server will allow the client directory browsing/download via browser(if client has certificate)</li>\n<li>server is optimized for stability and security, then for speed</li>\n<li>server must use high security ciphers and TLS1.2</li>\n</ul>\n\n<p><strong>What I managed to achieve</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, req *http.Request) {\n        w.Header().Set(\"Content-Type\", \"text/plain; charset=utf-8\")\n        http.ServeFile(w, req, \"/\")\n    })\n\n    log.Printf(\"Server running\\nAccess the server via: https://localhost:9900/\")\n    log.Fatal(http.ListenAndServeTLS(\":9900\", \"cert.crt\", \"priv.key\", http.FileServer(http.Dir(\"/\"))))\n}\n</code></pre>\n\n<p>Now, this works fine although it doesn't check all the features and its not very flexible and somehow I wanted to make it more future proof, as I wish to both learn by creating this project and also expand on it in the future as I'm interested in learning more about servers. </p>\n\n<p>After a bit of research I found several code pieces on GitHub and in tutorials, which led me to put together the following piece of code: </p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/\", func(w http.ResponseWriter, req *http.Request) {\n        w.Header().Add(\"Strict-Transport-Security\", \"max-age=63072000; includeSubDomains\")\n        http.ServeFile(w, req, \"/\")\n\n    })\n    cfg := &amp;tls.Config{\n        MinVersion:               tls.VersionTLS12,\n        CurvePreferences:         []tls.CurveID{tls.CurveP521, tls.CurveP384, tls.CurveP256},\n        PreferServerCipherSuites: true,\n        CipherSuites: []uint16{\n            tls.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,\n            tls.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,\n            tls.TLS_RSA_WITH_AES_256_GCM_SHA384,\n            tls.TLS_RSA_WITH_AES_256_CBC_SHA,\n            tls.TLS_AES_256_GCM_SHA384,\n        },\n    }\n\n    srv := &amp;http.Server{\n        Addr:         \":9900\",\n        Handler:      mux,\n        TLSConfig:    cfg,\n        TLSNextProto: make(map[string]func(*http.Server, *tls.Conn, http.Handler), 0),\n    }\n    log.Printf(\"Server running\\nAccess the server via: https://localhost:9900/\")\n    log.Fatal(srv.ListenAndServeTLS(\"cert.crt\", \"priv.key\"), http.FileServer(http.Dir(\"/\")))\n\n}\n</code></pre>\n\n<p>Problem is that when the server starts and I connect to it via browser, I'm presented with the root directory but every time I click on a folder the URL increments the address but the page just refreshes in the \"/\" directory. </p>\n\n<p><strong>To be exact:</strong></p>\n\n<ul>\n<li>I connect initially to the server and I'm presented the root directory , I'm shown Dir1, Dir2, Dir3</li>\n<li>I click Dir1</li>\n<li>The URL modifies from <a href=\"https://localhost:9900\" rel=\"nofollow noreferrer\">https://localhost:9900</a> to <a href=\"https://localhost:9900/Dir1\" rel=\"nofollow noreferrer\">https://localhost:9900/Dir1</a></li>\n<li>But I'm still in the root directory</li>\n</ul>\n\n<p>From what I'm able to see...I think I'm creating a loop somewhere.\nIf anyone knows what I need to do to make this functional, help would be much appreciated. </p>\n\n<p><strong>NOTE</strong>\nThe above behavior is on Firefox, on Chrome I get one of the 2 errors in the server error log, depending on changes that I make: </p>\n\n<ul>\n<li>2019/09/29 19:59:37 http: TLS handshake error from [::1]:53287: EOF</li>\n<li>2019/09/29 19:15:59 http: TLS handshake error from [::1]:50457: tls: client doesn't support selected certificate</li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1569780604, "post_id": 58157708, "comment_id": 102698290, "body": "You need to make the interface fields <code>I</code> and <code>F</code> store a pointer (maybe not <code>F</code> since you&#39;re not decoding anything into that), and then pass them directly to <code>Decode</code>, without anymore <code>&amp;</code>. That is <code>m:= mymodel{I: &amp;item, F: &amp;filter}</code>, and then <code>.Decode(m.I)</code>."}, {"owner": {"reputation": 245, "user_id": 7360695, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5ba260c91ea10f26485623058a28e4fc?s=128&d=identicon&r=PG&f=1", "display_name": "Battalgazi", "link": "https://stackoverflow.com/users/7360695/battalgazi"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1569781126, "post_id": 58157708, "comment_id": 102698423, "body": "that worked perfectly! many thanks. If you post it as an answer ill mark it as accepted."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1569781388, "creation_date": 1569781388, "answer_id": 58157993, "question_id": 58157708, "link": "https://stackoverflow.com/questions/58157708/decode-into-struct-when-passed-as-interface-returns-map/58157993#58157993", "title": "Decode into struct when passed as interface{} returns map", "body": "<p>You need to make the interface fields <code>I</code> and <code>F</code> store a pointer to the instance into which you want to decode the data (maybe not <code>F</code> since you're not decoding anything into that), and then pass them directly to <code>Decode</code>, without any more address operations (<code>&amp;x</code>).</p>\n\n<p>For example:</p>\n\n<pre><code>func Do(){\n    var item Item\n    var filter Item\n\n    m:= mymodel{I: &amp;item, F: filter}\n    res,_ := get(m)\n}\n\nfunc get(m mymodel) (*interface{}, error) {\n    c := database.DBCon.Database(\"whatever\").Collection(\"whatever\")\n\n    ctx, _ := context.WithTimeout(context.Background(), 5*time.Second)\n    err := c.FindOne(ctx, m.F).Decode(m.I)\n    if err != nil {\n        log.Log.Info(err)\n        return nil, err\n    }\n\n    return &amp;m.I, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 245, "user_id": 7360695, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5ba260c91ea10f26485623058a28e4fc?s=128&d=identicon&r=PG&f=1", "display_name": "Battalgazi", "link": "https://stackoverflow.com/users/7360695/battalgazi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 58157993, "answer_count": 1, "score": 0, "last_activity_date": 1569781388, "creation_date": 1569779080, "question_id": 58157708, "link": "https://stackoverflow.com/questions/58157708/decode-into-struct-when-passed-as-interface-returns-map", "title": "Decode into struct when passed as interface{} returns map", "body": "<p>When using mongo-driver, I have this struct which I pass to the get function as interface{}. The problem is when I use the Decode method, it returns a map while I was expecting a struct of the proper type. I found a similar question\n<a href=\"https://stackoverflow.com/questions/39058902/json-decode-into-struct-as-interface-yields-mapstringinterface-not-struct\">here</a> but the solution didnt work for me, the program crashes.</p>\n\n<pre><code>type Item struct {\n //whatever\n}\n\ntype mymodel struct {\n    I            interface{} \n    F            interface{}\n    DatabaseName string\n    Collection   string\n}\n\nfunc Do(){\n    var item Item\n    var filter Item\n\n    m:= mymodel{I: item, F: filter}\n    res,_ := get(m)\n}\n\nfunc get(m mymodel) (*interface{}, error) {\n\n    c := database.DBCon.Database(\"whatever\").Collection(\"whatever\")\n\n    ctx, _ := context.WithTimeout(context.Background(), 5*time.Second)\n    err := c.FindOne(ctx, m.F).Decode(&amp;m.I)\n    if err != nil {\n        log.Log.Info(err)\n        return nil, err\n    }\n\n\n    return &amp;m.I, nil\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 320, "user_id": 3347630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41b967d05a393a5b9568532d18c658e6?s=128&d=identicon&r=PG", "display_name": "Sdyess", "link": "https://stackoverflow.com/users/3347630/sdyess"}, "edited": false, "score": 1, "creation_date": 1569777166, "post_id": 58157429, "comment_id": 102697521, "body": "What is class Animal like? You&#39;re also missing commas after each kvp in the map."}, {"owner": {"reputation": 5026, "user_id": 993592, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/cmoKM.jpg?s=128&g=1", "display_name": "ardochhigh", "link": "https://stackoverflow.com/users/993592/ardochhigh"}, "reply_to_user": {"reputation": 320, "user_id": 3347630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41b967d05a393a5b9568532d18c658e6?s=128&d=identicon&r=PG", "display_name": "Sdyess", "link": "https://stackoverflow.com/users/3347630/sdyess"}, "edited": false, "score": 0, "creation_date": 1569777384, "post_id": 58157429, "comment_id": 102697564, "body": "Thanks @Sdyess I added the class definition. I tried adding commas but no luck."}], "answers": [{"comments": [{"owner": {"reputation": 5026, "user_id": 993592, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/cmoKM.jpg?s=128&g=1", "display_name": "ardochhigh", "link": "https://stackoverflow.com/users/993592/ardochhigh"}, "edited": false, "score": 0, "creation_date": 1569777554, "post_id": 58157496, "comment_id": 102697614, "body": "So when defaulting a map we need a comma after every value, even the last! Thanks!"}], "tags": [], "owner": {"reputation": 23612, "user_id": 147407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/65f858d8a973f4ee8d97517a21a17e7d?s=128&d=identicon&r=PG", "display_name": "Andrejs Cainikovs", "link": "https://stackoverflow.com/users/147407/andrejs-cainikovs"}, "is_accepted": true, "score": 2, "last_activity_date": 1569777558, "last_edit_date": 1569777558, "creation_date": 1569777460, "answer_id": 58157496, "question_id": 58157429, "link": "https://stackoverflow.com/questions/58157429/how-to-init-map-with-values/58157496#58157496", "title": "How to init map with values", "body": "<p>Typo. You missed commas after map elements.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Animal struct {\n    food, locomotion, sound string\n}\n\ntype AnimalInterface interface {\n    Eat()\n    Move()\n    Speak()\n}\n\nfunc main() {\n    animals := map[string]Animal{\n        \"cow\": Animal{\"grass\", \"walk\", \"moo\"},\n        \"bird\": Animal{\"worms\", \"fly\", \"peep\"},\n        \"snake\": Animal{\"mice\", \"slither\", \"hsss\"},\n    }\n\n    fmt.Println(animals)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/hTy8kYkAo08\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 5026, "user_id": 993592, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/cmoKM.jpg?s=128&g=1", "display_name": "ardochhigh", "link": "https://stackoverflow.com/users/993592/ardochhigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 58157496, "answer_count": 1, "score": 0, "last_activity_date": 1569839810, "creation_date": 1569776957, "last_edit_date": 1569839810, "question_id": 58157429, "link": "https://stackoverflow.com/questions/58157429/how-to-init-map-with-values", "title": "How to init map with values", "body": "<p>I have a multi-line map creation and setting of values in Go.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Animal struct {\n  food, locomotion, sound string\n}\n\ntype AnimalInterface interface {\n  Eat()\n  Move()\n  Speak()\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>animals := make(map[string]Animal)\nanimals[\"cow\"] = Animal{\"grass\", \"walk\", \"moo\"}\nanimals[\"bird\"] = Animal{\"worms\", \"fly\", \"peep\"}\nanimals[\"snake\"] = Animal{\"mice\", \"slither\", \"hsss\"}\n</code></pre>\n\n<p>I'd prefer to do the create and init in a single step. This doesn't work ... how should I fix it?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>animals := map[string]Animal{\n  \"cow\": Animal{\"grass\", \"walk\", \"moo\"}\n  \"bird\": Animal{\"worms\", \"fly\", \"peep\"}\n  \"snake\": Animal{\"mice\", \"slither\", \"hsss\"}\n}\n</code></pre>\n\n<p><em>EDIT</em> \nAdded commas </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>  animals := map[string]Animal{\n    \"cow\": Animal{\"grass\", \"walk\", \"moo\"},\n    \"bird\": Animal{\"worms\", \"fly\", \"peep\"},\n    \"snake\": Animal{\"mice\", \"slither\", \"hsss\"}\n  }\n</code></pre>\n\n<pre><code>\u276f go run animals.go\n# command-line-arguments\n./animals.go:109:47: syntax error: unexpected newline, expecting comma or }\n</code></pre>\n"}, {"tags": ["go", "mongo-go"], "comments": [{"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "edited": false, "score": 1, "creation_date": 1569760451, "post_id": 58155223, "comment_id": 102693320, "body": "I found this function signature in their source code <code>&#47;&#47; CountDocuments gets the number of documents matching the filter. &#47;&#47; For a fast count of the total documents in a collection see EstimatedDocumentCount.  func (coll *Collection) CountDocuments(ctx context.Context, filter interface{}, \topts ...*options.CountOptions) (int64, error) { ...</code> Maybe there is not Count menthod but an CountDocuments"}], "answers": [{"tags": [], "owner": {"reputation": 1052, "user_id": 7768287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ySIAC.png?s=128&g=1", "display_name": "Tiya Jose", "link": "https://stackoverflow.com/users/7768287/tiya-jose"}, "is_accepted": false, "score": 1, "last_activity_date": 1569819860, "creation_date": 1569819860, "answer_id": 58161730, "question_id": 58155223, "link": "https://stackoverflow.com/questions/58155223/cannot-print-find-the-number-of-records-mongo-db-with-go/58161730#58161730", "title": "Cannot print/find the number of records mongo_db with go", "body": "<p>EstimatedDocumentCount and CountDocuments are the methods used to get the number of documents in the collection.</p>\n\n<p>Refer General documentation for the MongoDB Go Driver to find out the available functions:</p>\n\n<p><a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo\" rel=\"nofollow noreferrer\">https://godoc.org/go.mongodb.org/mongo-driver/mongo</a></p>\n"}], "owner": {"reputation": 190, "user_id": 3993770, "user_type": "registered", "profile_image": "https://graph.facebook.com/1752506490/picture?type=large", "display_name": "Aayush", "link": "https://stackoverflow.com/users/3993770/aayush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1569819860, "creation_date": 1569760180, "question_id": 58155223, "link": "https://stackoverflow.com/questions/58155223/cannot-print-find-the-number-of-records-mongo-db-with-go", "title": "Cannot print/find the number of records mongo_db with go", "body": "<pre><code>import \"go.mongodb.org/mongo-driver/bson\"\nimport \"go.mongodb.org/mongo-driver/bson/primitive\"\nimport \"go.mongodb.org/mongo-driver/mongo\"\nimport \"go.mongodb.org/mongo-driver/mongo/options\"\n\nfunc count() int{\n     collection := client.Database(\"thepolyglotdeveloper\").Collection(\"people\")\n    filter := bson.M{\"sig\": bson.M{ \"$eq\": \"sdfsdf\" }}//iv.Sig\n    cur,_ := collection.Find(context.TODO(), filter)\n    count,_ := collection.Count(context.TODO(), filter)\n    return count\n}\n\nfunc main(){\n    ctx, _ := context.WithTimeout(context.Background(), 10*time.Second)\n    clientOptions := options.Client().ApplyURI(\"mongodb://localhost:27017\")\n    client, _ = mongo.Connect(ctx, clientOptions)\n    .....\n}\n</code></pre>\n\n<p>The error received:-</p>\n\n<pre><code># command-line-arguments\n./example.go:131:23: collection.Count undefined (type *mongo.Collection has no field or method Count)\n</code></pre>\n\n<p>I believe that I am not using the correct method for the count. I am using it to find out is there any record the preexists with the filter in the database. Please suggest.</p>\n\n<pre><code>count,_ := collection.Count(context.TODO(), filter)\n</code></pre>\n\n<p>Is it the correct usage.</p>\n"}, {"tags": ["sqlite", "go", "packr"], "comments": [{"owner": {"reputation": 3355, "user_id": 1143639, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ad387b358af367c236a391275c11af3?s=128&d=identicon&r=PG&f=1", "display_name": "KDEx", "link": "https://stackoverflow.com/users/1143639/kdex"}, "edited": false, "score": 2, "creation_date": 1569760874, "post_id": 58154936, "comment_id": 102693396, "body": "Try the special file name ? <a href=\"https://www.sqlite.org/inmemorydb.html\" rel=\"nofollow noreferrer\">sqlite.org/inmemorydb.html</a>"}, {"owner": {"reputation": 1062, "user_id": 1517624, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e6d7f2d2a5443be1694ee70b13720fb5?s=128&d=identicon&r=PG", "display_name": "ashishmohite", "link": "https://stackoverflow.com/users/1517624/ashishmohite"}, "reply_to_user": {"reputation": 3355, "user_id": 1143639, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ad387b358af367c236a391275c11af3?s=128&d=identicon&r=PG&f=1", "display_name": "KDEx", "link": "https://stackoverflow.com/users/1143639/kdex"}, "edited": false, "score": 0, "creation_date": 1569766726, "post_id": 58154936, "comment_id": 102694834, "body": "Already tried - doesn&#39;t go well with concurrent access from go routines"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1569766905, "post_id": 58154936, "comment_id": 102694880, "body": "If that &quot;not going well with multiple go routines&quot; would be a general issue, hardly anyone would use it, would they. Presumably, it does not do well with <i>your</i> code - hence you might want to show us what you did so far."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1569767217, "post_id": 58154936, "comment_id": 102694960, "body": "In general: If you hand out the binary, <a href=\"https://rednaga.io/2016/09/21/reversing_go_binaries_like_a_pro/\" rel=\"nofollow noreferrer\">it is rather easy to extract payload</a>. If the data can not be leaked: connect to a cloud instance (preferably via a REST API)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1569840015, "post_id": 58154936, "comment_id": 102713991, "body": "I&#39;m fairly confident that the sqlite API allows reading from memory. That just apparently isn&#39;t exposed in the Go driver layer. It may be possible to add that feature to the Go package."}], "owner": {"reputation": 1062, "user_id": 1517624, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e6d7f2d2a5443be1694ee70b13720fb5?s=128&d=identicon&r=PG", "display_name": "ashishmohite", "link": "https://stackoverflow.com/users/1517624/ashishmohite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "closed_date": 1569839900, "answer_count": 0, "score": 2, "last_activity_date": 1569839832, "creation_date": 1569757984, "last_edit_date": 1569839832, "question_id": 58154936, "link": "https://stackoverflow.com/questions/58154936/how-to-store-sqlite3-db-file-inside-binary", "closed_reason": "Duplicate", "title": "How to store sqlite3 db file inside binary", "body": "<p><strong>What I want to do</strong>:</p>\n\n<p>I am developing a CLI app which has a read-only database (sqlite using <code>mattn/sqlite3</code>) which should not be exposed and the binary is just an API over the read-only database.</p>\n\n<p>I tried tools like <code>packr</code> but it gives <code>File</code>, <code>string</code> or <code>[]byte{}</code> and the <code>sqlx.Connect</code> requires file path only</p>\n\n<p>This <a href=\"https://stackoverflow.com/questions/57326215/how-to-bundle-an-sqlite-database-in-a-go-binary\">statckoverflow question</a> talks about using <code>tempfile</code> but that too stays on FS.\nI can't keep the DB file on FS as it can be accessed by anyone with access to the system.</p>\n\n<p><strong>What I have already tried</strong></p>\n\n<p>Keeping an encrypted file in storage and then decrypting it runtime and then storing it in sqlite <code>in-memory db</code> but when using multiple go-routines I'm facing a lot of issues like <code>table not found</code> which are already there on <a href=\"https://github.com/mattn/go-sqlite3/issues/204\" rel=\"nofollow noreferrer\">GH issues</a> for <code>mattn/sqlite3</code> repo and are unsolved. So, I can't work with in-memory database.</p>\n"}, {"tags": ["docker", "go", "redis", "redigo"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1569764272, "post_id": 58154576, "comment_id": 102694199, "body": "Redigo does not do any caching."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1569793089, "post_id": 58154576, "comment_id": 102701089, "body": "Furthermore, the config of the pool is rather uninteresting. What would be more interesting is the actual code using it."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1569805204, "post_id": 58154576, "comment_id": 102702917, "body": "Use <a href=\"https://godoc.org/github.com/gomodule/redigo/redis#DialPassword\" rel=\"nofollow noreferrer\">redis.DialPassword</a> to simplify the pool dial function.  That said, this has nothing to do with the issue."}, {"owner": {"reputation": 1262, "user_id": 5035525, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh5.googleusercontent.com/-9-3pCbljKGY/AAAAAAAAAAI/AAAAAAAAAEE/3dJvT0fbUnQ/photo.jpg?sz=128", "display_name": "Ramanujan R", "link": "https://stackoverflow.com/users/5035525/ramanujan-r"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1569835483, "post_id": 58154576, "comment_id": 102711628, "body": "Thanks @CeriseLim&#243;n for your valuable input"}, {"owner": {"reputation": 1262, "user_id": 5035525, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh5.googleusercontent.com/-9-3pCbljKGY/AAAAAAAAAAI/AAAAAAAAAEE/3dJvT0fbUnQ/photo.jpg?sz=128", "display_name": "Ramanujan R", "link": "https://stackoverflow.com/users/5035525/ramanujan-r"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1569835898, "post_id": 58154576, "comment_id": 102711875, "body": "@MarkusWMahlberg We tried it again after changing <code>MaxIdle: 10</code>. <b>It worked!</b> But I can&#39;t see any reason for that. Someone please shed some light on this behavior."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1569850024, "post_id": 58154576, "comment_id": 102719052, "body": "The pool configuration is not the problem.  Something else changed when max idle was changed from 5 to 10 or the change covered up some other bug.  Is it possible that the application and redis-cli connected to different servers?  Does the application handle the error returned from <code>redis.Bool(conn.Do(&quot;GET&quot;, &quot;MyFlag&quot;))</code> ? Perhaps <code>flag</code> is false because the command failed or the returned value is not in a format expected by <code>redis.Bool</code>."}], "owner": {"reputation": 1262, "user_id": 5035525, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh5.googleusercontent.com/-9-3pCbljKGY/AAAAAAAAAAI/AAAAAAAAAEE/3dJvT0fbUnQ/photo.jpg?sz=128", "display_name": "Ramanujan R", "link": "https://stackoverflow.com/users/5035525/ramanujan-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1569755034, "creation_date": 1569755034, "question_id": 58154576, "link": "https://stackoverflow.com/questions/58154576/redigo-fetches-old-value-from-redis-docker-container", "title": "Redigo fetches old value from Redis Docker container", "body": "<p>I'm developing a golang web project with <strong>Redigo</strong> to connect to a redis <strong>docker</strong> container.</p>\n\n<p>While the golang web application is in running state, I've changed the value of a redis key using <code>SET MyFlag true</code> in <strong>redis-cli</strong>. But this is not reflecting in my webapp. When <code>MyFlag</code> is fetched using <code>flag, err := redis.Bool(conn.Do(\"GET\", \"MyFlag\"))</code>, it gives the old value.</p>\n\n<p>But, after the webapp is <strong>restarted</strong>, the same command fetches the new value.</p>\n\n<p><code>conn</code> is retrieved from a redis connection pool. This is the configuration for <strong>redis pool</strong></p>\n\n<pre><code>redisPool = &amp;redis.Pool{\n        MaxIdle:     5,\n        IdleTimeout: 240 * time.Second,\n        MaxActive:   10,\n        Wait:        true,\n        Dial: func() (redis.Conn, error) {\n            c, err := redis.Dial(\"tcp\", db.GetUrl())\n            if err != nil {\n                return nil, err\n            }\n            password := db.GetPassword()\n            if password != \"\" {\n                if _, err := c.Do(\"AUTH\", password); err != nil {\n                    _ = c.Close()\n                    return nil, err\n                }\n            }\n            return c, nil\n        },\n    }\n</code></pre>\n\n<p>Is this the issue of caching in Redis/Redigo/Docker ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1569750308, "post_id": 58154051, "comment_id": 102691134, "body": "What does not work? Your function doesn&#39;t do anything, except print some output to stdout."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1569750402, "post_id": 58154051, "comment_id": 102691153, "body": "In any case, you should probably use the <a href=\"https://golang.org/pkg/net/#IPNet.Contains\" rel=\"nofollow noreferrer\">IPNet.Contains</a> method."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1569753582, "post_id": 58154051, "comment_id": 102691840, "body": "<a href=\"https://play.golang.org/p/KP9mI4xRLZg\" rel=\"nofollow noreferrer\">play.golang.org/p/KP9mI4xRLZg</a> IPv6 left as an exercise."}, {"owner": {"reputation": 11, "user_id": 12137914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4290b4fa97a034214ca25c26769ee314?s=128&d=identicon&r=PG&f=1", "display_name": "Hoch", "link": "https://stackoverflow.com/users/12137914/hoch"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1569778078, "post_id": 58154051, "comment_id": 102697742, "body": "@Peter. Thank you so much--that works but I will need too spend some time picking it apart figure out how it works.  I am new to Go, and I was hoping to be pointed in the right direction and you wrote it out--thanks!.  Once I go through it I will mark your comment as the answer--in the next day."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1569780844, "post_id": 58154051, "comment_id": 102698355, "body": "Think about the definition of a subnet: The set of addresses with a particular common prefix. So to figure out if A contains B you have to check if A is a prefix of B."}, {"owner": {"reputation": 11, "user_id": 12137914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4290b4fa97a034214ca25c26769ee314?s=128&d=identicon&r=PG&f=1", "display_name": "Hoch", "link": "https://stackoverflow.com/users/12137914/hoch"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1569803489, "post_id": 58154051, "comment_id": 102702689, "body": "@Peter I have worked through it and it is an interesting approach and what I was hoping for.  Only, I have found some situations where it does not work as I hoped.  It seem to provide consistent positive matches but can provide false matches.  I took your code and broke it out with print statements here:  [ <a href=\"https://play.golang.org/p/WqPdErR12UO\" rel=\"nofollow noreferrer\">play.golang.org/p/WqPdErR12UO</a> ]. Note that I compare here two small /29 networks that are close though completely separate, but the code still returns true.  This has given me a lot to think about and I will try to figure some way to tweak this to get the needed result.  Thanks,"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 12137914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4290b4fa97a034214ca25c26769ee314?s=128&d=identicon&r=PG&f=1", "display_name": "Hoch", "link": "https://stackoverflow.com/users/12137914/hoch"}, "edited": false, "score": 0, "creation_date": 1570548524, "post_id": 58161558, "comment_id": 102943562, "body": "I have not forgotten your answer just been busy.  I will go through it carefully soon."}], "tags": [], "owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "is_accepted": false, "score": 1, "last_activity_date": 1569818222, "creation_date": 1569818222, "answer_id": 58161558, "question_id": 58154051, "link": "https://stackoverflow.com/questions/58154051/function-to-search-if-one-network-is-contained-in-another-network/58161558#58161558", "title": "Function to search if one network is contained in another network", "body": "<p>For any <code>x</code> and <code>y</code> IPv4s, and any integers <code>m</code> and <code>n</code> from 0-32, the network <code>x/m</code> is contained in <code>y/n</code> if and only if <code>m &gt;= n</code> and <code>x</code> is in <code>y/n</code> (you can work out the proof for this yourself).  Therefore, the following will work:</p>\n\n<pre><code>func contains(subnet, route string) (bool, error) {\n    sIP, sNW, err := net.ParseCIDR(subnet)\n    if err != nil {\n        return false, err\n    }\n\n    _, rNW, err := net.ParseCIDR(route)\n    if err != nil {\n        return false, err\n    }\n\n    sNWMaskSize, _ := sNW.Mask.Size()\n    rNWMaskSize, _ := rNW.Mask.Size()\n\n    return rNW.Contains(sIP) &amp;&amp; sNWMaskSize &gt;= rNWMaskSize, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 12137914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4290b4fa97a034214ca25c26769ee314?s=128&d=identicon&r=PG&f=1", "display_name": "Hoch", "link": "https://stackoverflow.com/users/12137914/hoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569818222, "creation_date": 1569750164, "last_edit_date": 1569810917, "question_id": 58154051, "link": "https://stackoverflow.com/questions/58154051/function-to-search-if-one-network-is-contained-in-another-network", "title": "Function to search if one network is contained in another network", "body": "<p>I need an efficient way in Go to take one CIDR network and test if it is wholly contained in other networks. </p>\n\n<p>Example:</p>\n\n<pre><code>var (\n    subnet string = \"10.10.10.8/29\"\n    route string = \"10.10.10.0/24\"\n)\n</code></pre>\n\n<p>I want to test if 'subnet' is in 'route' and return true because it is.  Return false for values that are not within 'route' or partially outside it. </p>\n\n<p>I have a solution for testing if a single host is in a network using IP/CIDR parsing and 'x.Contains()' in package net.  I have tried adapting this for networks and it failed.</p>\n\n<p><strong>This does not work:</strong>.  </p>\n\n<pre><code>if route.Contains(subnet) {\n    fmt.Println(\"%s subnet is contained subnet %s\",net, route)\n}\n</code></pre>\n\n<p><em>Edit:  There is apparently some confusion over this. The snipet of code just above this paragraph here that does not work for me to test if one network is inside another. The SO overflow guidelines asked me to be specific about what I have tried so that is why I put this in here. This is my first SO post.</em> </p>\n\n<p>I have some ideas that are bulkier than I would like to do this with this one in the lead:</p>\n\n<p>Calculate the first IP (network IP) and last ip (broadcast IP) of 'subnet', using 'net.ParseCIDR()' and known subnet sizes as constants, and then test if both the network and broadcast IP of 'subnet' are in 'route' with 'x.Contains()'.</p>\n\n<p>Edit:  I did not see this thread in my initial searches but came across it now.  It is similar so I am linking here for completeness.  [ <a href=\"https://stackoverflow.com/questions/34729158/how-to-detect-if-two-golang-net-ipnet-objects-intersect\">How to detect if two Golang net.IPNet objects intersect?</a> ]</p>\n"}, {"tags": ["go", "floating-point", "precision"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1569744735, "post_id": 58152168, "comment_id": 102690028, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/q/21895756/13860\">stackoverflow.com/q/21895756/13860</a>"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1569747315, "post_id": 58152168, "comment_id": 102690505, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/21895756/why-are-floating-point-numbers-inaccurate\">Why are floating point numbers inaccurate?</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1569767034, "post_id": 58152168, "comment_id": 102694913, "body": "The &quot;duplicate&quot; links in the comments provide no information on how to get a precise floating-point value value in Go, since <code>strconv.ParseFloat(v, 64)</code> is not adequate. The links merely explain floating-point mathematics."}, {"owner": {"reputation": 3716, "user_id": 438570, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zJhUv.jpg?s=128&g=1", "display_name": "Medeni Baykal", "link": "https://stackoverflow.com/users/438570/medeni-baykal"}, "edited": false, "score": 0, "creation_date": 1570623979, "post_id": 58152168, "comment_id": 102970401, "body": "You need more precision, please check <a href=\"https://stackoverflow.com/questions/46374304/dealing-with-floating-point-number-precision-in-go-arithmetic\" title=\"dealing with floating point number precision in go arithmetic\">stackoverflow.com/questions/46374304/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1569735271, "last_edit_date": 1569735271, "creation_date": 1569734104, "answer_id": 58152438, "question_id": 58152168, "link": "https://stackoverflow.com/questions/58152168/how-to-get-precise-float64-value-in-go/58152438#58152438", "title": "How to get precise float64 value in Go?", "body": "<p>The limitations of <code>float64</code>, 53-bit precision <a href=\"https://en.wikipedia.org/wiki/Double-precision_floating-point_format\" rel=\"nofollow noreferrer\">64-bit IEEE 754 binary floating-point</a>. For a more precise representation, use <code>math/big</code> type <code>Float</code> with more precision.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n    \"strconv\"\n)\n\nfunc main() {\n    v := \"43701.330694444441\"\n    f1, err := strconv.ParseFloat(v, 64) // 53-bit precision\n    fmt.Println(f1, err)\n    f2, ok := big.NewFloat(0).SetPrec(53).SetString(v)\n    fmt.Println(f2, ok)\n    f3, ok := big.NewFloat(0).SetPrec(55).SetString(v)\n    fmt.Println(f3, ok)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/8aVj-y83Mdp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/8aVj-y83Mdp</a></p>\n\n<p>Output:</p>\n\n<pre><code>43701.33069444444 &lt;nil&gt;\n43701.33069444444 true\n43701.330694444441 true\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 4732178, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M2P54.jpg?s=128&g=1", "display_name": "true2009fans", "link": "https://stackoverflow.com/users/4732178/true2009fans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "closed_date": 1569783332, "answer_count": 1, "score": -2, "last_activity_date": 1569735522, "creation_date": 1569730161, "last_edit_date": 1569735522, "question_id": 58152168, "link": "https://stackoverflow.com/questions/58152168/how-to-get-precise-float64-value-in-go", "closed_reason": "Needs details or clarity", "title": "How to get precise float64 value in Go?", "body": "<p>I got a float64 value 43701.330694444441, after i call strconv.ParseFloat(v, 64) function, the result turn out to be 43701.33069444444. Anyone can solve this?</p>\n\n<pre><code>v := \"43701.330694444441\"\n\nf, err := strconv.ParseFloat(v, 64)\nif err != nil {\n    return\n}\nfmt.Println(f) // it output 43701.33069444444, the tail '1' is missing.\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1569711056, "post_id": 58150358, "comment_id": 102685555, "body": "Why do you want to compare against the hex encoding? Compare the bytes."}], "answers": [{"comments": [{"owner": {"reputation": 271, "user_id": 961346, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8dad37829ad6cca463619ace4d3bf871?s=128&d=identicon&r=PG", "display_name": "user961346", "link": "https://stackoverflow.com/users/961346/user961346"}, "edited": false, "score": 0, "creation_date": 1569708075, "post_id": 58150475, "comment_id": 102685077, "body": "that  results in the following error:     invalid operation: data == magic_number (mismatched types []byte and [32]byte)"}, {"owner": {"reputation": 271, "user_id": 961346, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8dad37829ad6cca463619ace4d3bf871?s=128&d=identicon&r=PG", "display_name": "user961346", "link": "https://stackoverflow.com/users/961346/user961346"}, "edited": false, "score": 0, "creation_date": 1569708742, "post_id": 58150475, "comment_id": 102685192, "body": "i dont understand"}, {"owner": {"reputation": 271, "user_id": 961346, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8dad37829ad6cca463619ace4d3bf871?s=128&d=identicon&r=PG", "display_name": "user961346", "link": "https://stackoverflow.com/users/961346/user961346"}, "edited": false, "score": 0, "creation_date": 1569710699, "post_id": 58150475, "comment_id": 102685505, "body": "still doesn&#39;t work. I added a print statement for header and magic_number to the output , this is the result with your changes (no match)  value: 64ffffffffffbfc0 read 8 bytes  header -&gt; 64ffffffffffbfc00000000000000000 magic_number -&gt; 36346666666666666666666662666330 value: 3b10004001000000 read 8 bytes  header -&gt; 3b100040010000000000000000000000 magic_number -&gt; 36346666666666666666666662666330 value: 7c10004001000000 read 8 bytes  header -&gt; 7c100040010000000000000000000000 magic_number -&gt; 36346666666666666666666662666330"}], "tags": [], "owner": {"reputation": 314, "user_id": 2836309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af3bda205e8d1259983422eb48a7eca6?s=128&d=identicon&r=PG&f=1", "display_name": "scopolamin", "link": "https://stackoverflow.com/users/2836309/scopolamin"}, "is_accepted": false, "score": 0, "last_activity_date": 1569762927, "last_edit_date": 1569762927, "creation_date": 1569706378, "answer_id": 58150475, "question_id": 58150358, "link": "https://stackoverflow.com/questions/58150358/matching-binary-data-against-hex-value-in-go/58150475#58150475", "title": "matching binary data against hex value in go", "body": "<p>You could compare the arrays:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"bytes\"\n)\n\nvar magicNumber = []byte{0x64, 0xff, 0xff, 0xff, 0xff, 0xff, 0xbf, 0xc0}\n\nfunc main() {\n    path := \"test.exe.16900.sancov\"\n\n    f, err := os.Open(path)\n    if err != nil {\n        log.Fatal(\"Error while opening file\", err)\n    }\n\n    data := make([]byte, len(magicNumber))\n    if _, err := io.ReadFull(f, data); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"%s\\n\", data)\n\n    if bytes.Equal(data, magicNumber) {\n        fmt.Println(\"header found\")\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1569711937, "last_edit_date": 1569711937, "creation_date": 1569711623, "answer_id": 58150911, "question_id": 58150358, "link": "https://stackoverflow.com/questions/58150358/matching-binary-data-against-hex-value-in-go/58150911#58150911", "title": "matching binary data against hex value in go", "body": "<p>Compare the data read from the file to a <code>[]byte</code> containing the magic value.</p>\n\n<p>Declare a package-level variable with the magic value:</p>\n\n<pre><code> var magicValue = []byte{0x64,0xff, 0xff, 0xff, 0xff, 0xff, 0xbf, 0xc0}\n</code></pre>\n\n<p>Compare with <a href=\"https://godoc.org/bytes#Equal\" rel=\"nofollow noreferrer\">bytes.Equal</a>:</p>\n\n<pre><code> data := make([]byte, len(magicValue))\n _, err := io.ReadFull(f, data)\n if err != nil {\n     // handle error\n }\n if bytes.Equal(data, magicValue) { \n      fmt.Println(\"64 bit header found\")\n}\n</code></pre>\n\n<p>Use <a href=\"https://godoc.org/io#ReadFull\" rel=\"nofollow noreferrer\">io.ReadFull</a> to ensure that 8 bytes of data is read.</p>\n"}], "owner": {"reputation": 271, "user_id": 961346, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8dad37829ad6cca463619ace4d3bf871?s=128&d=identicon&r=PG", "display_name": "user961346", "link": "https://stackoverflow.com/users/961346/user961346"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 58150911, "answer_count": 2, "score": -1, "last_activity_date": 1569762927, "creation_date": 1569705369, "last_edit_date": 1569709493, "question_id": 58150358, "link": "https://stackoverflow.com/questions/58150358/matching-binary-data-against-hex-value-in-go", "title": "matching binary data against hex value in go", "body": "<p>I am trying to implement a simple parser in Go for the sancov file format <a href=\"https://clang.llvm.org/docs/SanitizerCoverage.html#sancov-data-format\" rel=\"nofollow noreferrer\">https://clang.llvm.org/docs/SanitizerCoverage.html#sancov-data-format</a> </p>\n\n<p>the format is basically first 8 bytes is a magic value either 0xC0BFFFFFFFFFFF64 or 0xC0BFFFFFFFFFFF32 with the last byte of the magic value determining the size of the remaining offsets. </p>\n\n<p>however i don't know how to compare a hex value to the byte value in Go for example</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    path := \"test.exe.16900.sancov\"\n\n    f, err := os.Open(path)\n    if err != nil {\n        log.Fatal(\"Error while opening file\", err)\n    }\n\n    for {\n        data := make([]byte, 8)\n        // ignoring errors for now\n        bytesread, _ := f.Read(data)\n        if bytesread == 0 {\n            break\n        }\n        fmt.Printf(\"value: %x read %d bytes\\n\", data, bytesread)\n\n        //\"64ffffffffffbfc0\"\n        if data == 0xC0BFFFFFFFFFFF64 { // this is not valid \n            fmt.Println(\"64 bit header found\")\n        }\n\n    }\n}\n</code></pre>\n\n<p>what am i missing here? </p>\n\n<p>the output (when removing the last if statement) is as follows</p>\n\n<pre><code>PS C:\\Users\\user\\src\\test&gt; go run main.go\nvalue: 64ffffffffffbfc0 read 8 bytes\nvalue: 3b10004001000000 read 8 bytes\nvalue: 7c10004001000000 read 8 bytes\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1569705237, "post_id": 58150271, "comment_id": 102684624, "body": "<code>:=</code> <i>re</i>-declares the identifiers on the left hand side in its containing scope. Therefore, in the outer scope, <code>db</code> is left <code>nil</code>. You can predeclare <code>err</code> in <code>main</code> and then use <code>=</code> instead. For example: <code>var err error</code> and then <code>db, err = gorm.Open(...</code>. Now the package level <code>db</code> will not be <code>nil</code> when referenced in <code>getEffects</code>."}], "answers": [{"comments": [{"owner": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 0, "creation_date": 1569714372, "post_id": 58151056, "comment_id": 102685969, "body": "How does one warn about shadowing with the command-line <code>go</code> application?"}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "reply_to_user": {"reputation": 13760, "user_id": 10795151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eazk7.png?s=128&g=1", "display_name": "S.S. Anne", "link": "https://stackoverflow.com/users/10795151/s-s-anne"}, "edited": false, "score": 1, "creation_date": 1569788781, "post_id": 58151056, "comment_id": 102700211, "body": "Well, go compiler doesn&#39;t really have any concept of warnings.  Anything <code>go run</code> or <code>go build</code> finds disturbing will always be an error. There are other tools like <code>go fmt</code> &amp; <code>goimports</code> that warn about bad coding practices. Most IDEs(Visual Code, Intellij), integrate with them to show warnings. For command-line options, you will need to check the documentations of these 2 commands."}], "tags": [], "owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "is_accepted": true, "score": 1, "last_activity_date": 1569788607, "last_edit_date": 1569788607, "creation_date": 1569713490, "answer_id": 58151056, "question_id": 58150271, "link": "https://stackoverflow.com/questions/58150271/how-to-solve-runtime-error-invalid-memory-address-or-nil-pointer-dereference/58151056#58151056", "title": "How to solve &quot;runtime error: invalid memory address or nil pointer dereference&quot; with gorm", "body": "<p>When you write <code>db, err := gorm.Open(\"sqlite3\", \"gorm.db\")</code>, you are essentially declaring a \"new\" local variable, which shadows the global \"db\". </p>\n\n<p>Hence the \"db\" variable being used in <code>db.Find(&amp;effects)</code> was never actually initialized.</p>\n\n<p>To give you some more context, in case you are starting with Go. This runtime error is logically similar to C's segmentation fault, or Java's null pointer exception. If you are using an IDE, make sure to configure it in a way, that it shows such declarations as warnings(or even error). Re-declaring a variable with same name is almost never a good idea.</p>\n"}], "owner": {"reputation": 3, "user_id": 12136384, "user_type": "registered", "profile_image": "https://graph.facebook.com/10218124786567975/picture?type=large", "display_name": "Guillaume Fortin", "link": "https://stackoverflow.com/users/12136384/guillaume-fortin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 647, "favorite_count": 0, "closed_date": 1575484153, "accepted_answer_id": 58151056, "answer_count": 1, "score": -1, "last_activity_date": 1569788607, "creation_date": 1569704453, "question_id": 58150271, "link": "https://stackoverflow.com/questions/58150271/how-to-solve-runtime-error-invalid-memory-address-or-nil-pointer-dereference", "closed_reason": "Duplicate", "title": "How to solve &quot;runtime error: invalid memory address or nil pointer dereference&quot; with gorm", "body": "<p>I'm new in golang i want to use it to make a rest API.\nI'm blocking on this problem.\nI don't understand it because the function CreateEffect runs good.</p>\n\n<p>My problem is in the function \"getEffects\" at line: \"db.Find(&amp;effects)\"</p>\n\n<p>This is my code:</p>\n\n<pre><code>var db *gorm.DB\nvar err error\n\nfunc getEffects (w http.ResponseWriter, r *http.Request) {\n    var effects []Effects\n    db.Find(&amp;effects)\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    json.NewEncoder(w).Encode(&amp;effects)\n}\n\nfunc main () {\n    db, err := gorm.Open(\"sqlite3\", \"gorm.db\")\n    defer db.Close()\n\n    //Initialisation des routes\n    r:= mux.NewRouter()\n    r.HandleFunc(\"/effects\", getEffects).Methods(\"GET\")\n\n    //Start serveur port 5080\n    log.Fatal(http.ListenAndServe(\":5080\",r))\n}\n</code></pre>\n\n<p>This is the runtime error:</p>\n\n<pre><code>2019/09/28 22:46:54 http: panic serving 127.0.0.1:36488: runtime error: invalid memory address or nil pointer dereference\ngoroutine 27 [running]:\n</code></pre>\n\n<p>The full code is here: <a href=\"https://pastebin.com/sbzhK8YV\" rel=\"nofollow noreferrer\">https://pastebin.com/sbzhK8YV</a></p>\n\n<p>Thanks for help</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569709418, "post_id": 58150504, "comment_id": 102685294, "body": "It&#39;s not working. I did this <code>var values = []primitive.ObjectID{ID}</code>"}, {"owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "reply_to_user": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569709743, "post_id": 58150504, "comment_id": 102685348, "body": "@VarunRaj have you tried using single  value like your example? that also failed?"}], "tags": [], "owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "is_accepted": true, "score": 1, "last_activity_date": 1569709638, "last_edit_date": 1569709638, "creation_date": 1569706708, "answer_id": 58150504, "question_id": 58149305, "link": "https://stackoverflow.com/questions/58149305/how-to-add-object-to-the-array-in-mongodb/58150504#58150504", "title": "How to add object to the array in mongodb", "body": "<p>Change suggestions:</p>\n\n<ol>\n<li>Change structure metadata tag <code>json</code> to <code>bson</code></li>\n</ol>\n\n<pre><code>type Student struct {\n    ID           primitive.ObjectID   `bson:\"_id,omitempty\"`\n    ...\n    Users      []primitive.ObjectID   `bson:\"users\"`\n    ...\n}\n</code></pre>\n"}], "owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 58150504, "answer_count": 1, "score": 0, "last_activity_date": 1569744837, "creation_date": 1569696389, "last_edit_date": 1569744837, "question_id": 58149305, "link": "https://stackoverflow.com/questions/58149305/how-to-add-object-to-the-array-in-mongodb", "title": "How to add object to the array in mongodb", "body": "<pre><code>type Student struct {\n    ID           primitive.ObjectID   `bson:\"_id,omitempty\"`\n    ...\n    Users      []primitive.ObjectID `json:\"users\"`\n    ...\n}\n</code></pre>\n\n<p>I have this struct and I want to add to <code>Users array</code>. I'm doing this and I'm using <code>Mongo-go-driver</code></p>\n\n<pre><code>// Filter for search\nfilter := bson.M{\"_id\": userID}\n\n// Fields to update\nupdate := bson.M{\"$addToSet\": bson.M{\"users\": ID}}\n\n// Update the document\nUsersCollection := GetUsersCollection()\nUsersCollection.FindOneAndUpdate(context.Background(), filter, update, nil)\n</code></pre>\n\n<p>Can somebody tell me what I'm doing wrong? It's not adding to the database it's staying null.</p>\n"}, {"tags": ["go", "recursion"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1569682765, "post_id": 58147509, "comment_id": 102679379, "body": "Why do you think you&#39;ll change the value of <code>c</code>? Nothing in your code changes that value."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1569682836, "post_id": 58147509, "comment_id": 102679393, "body": "Also your call within <code>a</code> to <code>a</code> is completely ignored."}, {"owner": {"reputation": 455, "user_id": 3738751, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IWssd.png?s=128&g=1", "display_name": "Pankaj Singh", "link": "https://stackoverflow.com/users/3738751/pankaj-singh"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1569682907, "post_id": 58147509, "comment_id": 102679413, "body": "@Flimzy function <code>a</code> should return true, true but it is returning false, false. that all  want to understand"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1569682953, "post_id": 58147509, "comment_id": 102679426, "body": "Why do you think it should return true? It will only return true if <code>c</code> is true. If <code>c</code> is false, then it calls <code>a</code> again, ignoring the result, then returns false."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1569683115, "creation_date": 1569683115, "answer_id": 58147575, "question_id": 58147509, "link": "https://stackoverflow.com/questions/58147509/what-is-the-correct-way-to-return-from-function/58147575#58147575", "title": "What is the correct way to return from function?", "body": "<p>It's unclear what you think your code should do, but here's what it's actually doing:</p>\n\n<ol>\n<li><p>You call <code>a</code> with the value <code>false</code>:</p>\n\n<p>It checks if <code>c</code> is true:</p>\n\n<pre><code>if c {\n</code></pre>\n\n<p>but it's not, so it contiues</p></li>\n<li><p>It calls <code>a</code> again, this time with the value <code>true</code>, but completely ignoring the result:</p>\n\n<pre><code>a(true)\n</code></pre></li>\n<li><p>Then it returns false:</p>\n\n<pre><code>return \"false\", false\n</code></pre></li>\n</ol>\n\n<p>This means that step #2 is a complete no-op (and is probably removed entirely by the compiler).</p>\n\n<p>Maybe you want to do something with the returned value of <code>a(true)</code>?</p>\n"}, {"tags": [], "owner": {"reputation": 59, "user_id": 7343529, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6827a430028953f68b24f28805e682f0?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Mohib Khan", "link": "https://stackoverflow.com/users/7343529/muhammad-mohib-khan"}, "is_accepted": false, "score": 0, "last_activity_date": 1569683210, "creation_date": 1569683210, "answer_id": 58147587, "question_id": 58147509, "link": "https://stackoverflow.com/questions/58147509/what-is-the-correct-way-to-return-from-function/58147587#58147587", "title": "What is the correct way to return from function?", "body": "<p>This will result in a 2 level recursion. In first level you have c as false. Then you call a(true) and you are in second level which returns true. Now you are back in level 1 at line a(true) and the next line is to return false as string and bool. Hence you get false as final output.</p>\n\n<p>I think you are trying to use the return value which is not the case right now.</p>\n"}, {"tags": [], "owner": {"reputation": 163, "user_id": 11869461, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tNYETRt85Vc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reswQ_iiZbSbtY0EpXqOvZxksDFVQ/photo.jpg?sz=128", "display_name": "ialam", "link": "https://stackoverflow.com/users/11869461/ialam"}, "is_accepted": true, "score": 3, "last_activity_date": 1569684933, "last_edit_date": 1569684933, "creation_date": 1569683374, "answer_id": 58147610, "question_id": 58147509, "link": "https://stackoverflow.com/questions/58147509/what-is-the-correct-way-to-return-from-function/58147610#58147610", "title": "What is the correct way to return from function?", "body": "<p>Your recursive code will always return \"false\" false when <code>c</code> is false. Please see the correct code below.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc a(c bool) (string, bool) {\n    if c {\n        return \"true\", true\n    }\n    return a(true)\n}\n\nfunc main() {\n    s, ok := a(false)\n   fmt.Println(s, ok)\n}\n</code></pre>\n"}], "owner": {"reputation": 455, "user_id": 3738751, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IWssd.png?s=128&g=1", "display_name": "Pankaj Singh", "link": "https://stackoverflow.com/users/3738751/pankaj-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 58147610, "answer_count": 3, "score": -4, "last_activity_date": 1569684933, "creation_date": 1569682635, "last_edit_date": 1569683387, "question_id": 58147509, "link": "https://stackoverflow.com/questions/58147509/what-is-the-correct-way-to-return-from-function", "title": "What is the correct way to return from function?", "body": "<p>I am confused how should I return a value from a function. I was trying the below example:</p>\n\n<ul>\n<li>Passing false to function a</li>\n<li>Value of c will be false in function a</li>\n<li>It will make a recursive call and this will change the value of c from false to true</li>\n<li><p>So function should return a string \"true\" and bool true but it is returning  a string \"false\" and bool false</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc a(c bool) (string, bool) {\n    if c {\n        return \"true\", true\n    }\n    a(true)\n    return \"false\", false\n}\n\nfunc main() {\n    s, ok := a(false)\n   fmt.Println(s, ok)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/uSIN2k0G3QW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uSIN2k0G3QW</a></p></li>\n</ul>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1569758285, "last_edit_date": 1569758285, "creation_date": 1569676224, "answer_id": 58146628, "question_id": 58146202, "link": "https://stackoverflow.com/questions/58146202/why-does-append-overwrite-subelements/58146628#58146628", "title": "Why does append overwrite subelements?", "body": "<p>In each iteration over the cursor you're reusing the same block of memory with <code>&amp;</code> on the pre-declared <code>elem</code>, essentially overwriting the data decoded in the previous iteration. Instead, inside the loop, allocate a new elem for each record in the db.</p>\n\n<p>For example:</p>\n\n<pre><code>var elements []models.Country\n\n// Get the next result from the cursor\nfor cur.Next(context.Background()) {\n    var elem models.Country\n    if err := cur.Decode(&amp;elem); err != nil {\n        log.Fatal(err)\n    }\n\n    elements = append(elements, elem)\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 12134791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22b21249b9244c28d4ff933cfe00c80e?s=128&d=identicon&r=PG&f=1", "display_name": "tutahunia", "link": "https://stackoverflow.com/users/12134791/tutahunia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 58146628, "answer_count": 1, "score": -1, "last_activity_date": 1569758285, "creation_date": 1569672858, "last_edit_date": 1569674051, "question_id": 58146202, "link": "https://stackoverflow.com/questions/58146202/why-does-append-overwrite-subelements", "title": "Why does append overwrite subelements?", "body": "<p>I create this struct:</p>\n\n<pre><code>type Country struct {\nId              interface{} `bson:\"_id,omitempty\"`\nLanguages       []string    `json:\"languages\"`\nCountry         string      `json:\"country\"`\nCountry_id      int         `json:\"country_id\"`\nCapital         string      `json:\"capital\"`\nCurrency_name   string      `json:\"currency_name\"`\nCurrency_symbol string      `json:\"currency_symbol\"`\nCurrency_code   string      `json:\"currency_code\"`\nIso             string      `json:\"iso\"`\n</code></pre>\n\n<p>}</p>\n\n<p>Then from Mongo I get all the data that i need.The problem is when i try to append each element, the langueges are overwritting.</p>\n\n<p>Here is the append:</p>\n\n<pre><code>func GetAllCountries() []models.Country { \noptions := options.Find() options.SetLimit(4)\n\ncur, err := db.Collection(COLLCOUNTRIES).Find(context.Background(), bson.D{}, options)\n\nif err != nil {\n    log.Fatal(err)\n}\nvar elements []models.Country\nvar elem models.Country\n// Get the next result from the cursor\nfor cur.Next(context.Background()) {    \n    err := cur.Decode(&amp;elem)\n            if err != nil {\n        log.Fatal(err)\n    }\n\n    elements = append(elements, elem)\n}\nif err := cur.Err(); err != nil {\n    log.Fatal(err)\n}\ncur.Close(context.Background())\n\nreturn elements\n</code></pre>\n\n<p>}</p>\n\n<p>The result is like this:</p>\n\n<p>-- element before append -- </p>\n\n<pre><code> {ObjectID(\"5d7f6b2b57d5104f58e53d2b\") [ar-AE fa en hi ur] United Arab Emirates 290557 Abu Dhabi Dirham \u062f.\u0625 AED AE}\n</code></pre>\n\n<p>-- element before append -- </p>\n\n<pre><code>{ObjectID(\"5d7f6b2b57d5104f58e53d2c\") [fa-AF ps uz-AF tk] Afghanistan 1149361 Kabul Afghani \u060b AFN AF}\n</code></pre>\n\n<p>-- all the results --</p>\n\n<pre><code>[{ObjectID(\"5d7f6b2b57d5104f58e53d2b\") [fa-AF ps uz-AF tk ur] United Arab Emirates 290557 Abu Dhabi Dirham \u062f.\u0625 AED AE} {ObjectID(\"5d7f6b2b57d5104f58e53d2c\") [fa-AF ps uz-AF tk] Afghanistan 1149361 Kabul Afghani \u060b AFN AF}]\n</code></pre>\n"}, {"tags": ["http", "go"], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 7190425, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9DOWH.jpg?s=128&g=1", "display_name": "Aaron Raff", "link": "https://stackoverflow.com/users/7190425/aaron-raff"}, "is_accepted": true, "score": 0, "last_activity_date": 1569716674, "creation_date": 1569716674, "answer_id": 58151248, "question_id": 58145120, "link": "https://stackoverflow.com/questions/58145120/how-to-formulate-requests-for-these-endpoints/58151248#58151248", "title": "How to formulate requests for these endpoints", "body": "<p>There are a few ways to go about this. You can either use a tool like Postman, or simply just use <code>curl</code> from the command line to send a post request to your endpoint. Here is the curl command that I used to hit the endpoint (I am using port 8080 for my testing), the bit after the <code>-d</code> flag is the request body:</p>\n\n<p><code>curl -X POST http://localhost:8080/903/access -d '{\"Act\": \"act\", \"Nonce\": \"nonce\", \"Signature\": \"signature\", \"TimeOut\": 64, \"Offset\": 0}'</code></p>\n\n<p>I did modify the code to cut out most of the logic. This request just shows an example of how the current code can parse the request body. If you are interested more in how some of the other logic works in the handler functions, let me know and I can edit my response. Here is the code that I used for my testing:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n)\n\n// Required parameters for the request\ntype params struct {\n    Act       string\n    Nonce     string\n    Signature string\n    Timeout   int64\n    Offset    int\n}\n\nfunc main() {\n    // Endpoints available\n    http.HandleFunc(\"/903/access\", handleAccess)\n\n    err := http.ListenAndServe(os.Args[1], nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc parse(w http.ResponseWriter, r *http.Request) (params params, ok bool) {\n    w.Header().Set(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\")\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    w.Header().Set(\"Access-Control-Max-Age\", \"3600\")\n\n    if r.Method != \"POST\" {\n        w.Header().Set(\"Allow\", \"POST, OPTIONS\")\n        if r.Method == \"OPTIONS\" {\n            w.WriteHeader(http.StatusOK)\n        } else {\n            w.WriteHeader(http.StatusMethodNotAllowed)\n        }\n        return\n    }\n\n    err := json.NewDecoder(r.Body).Decode(&amp;params)\n    if err != nil {\n        w.WriteHeader(http.StatusBadRequest)\n        log.Printf(\"%s: %v\", r.URL.Path, err)\n        return\n    }\n\n    return\n}\n\nfunc handleAccess(w http.ResponseWriter, r *http.Request) {\n    params, _ := parse(w, r)\n\n    fmt.Printf(\"%+v\\n\", params)\n}\n</code></pre>\n\n<p>Here is the output that I received when all is said and done:</p>\n\n<p><code>{Act:act Nonce:nonce Signature:signature Timeout:64 Offset:0}</code></p>\n"}], "owner": {"reputation": 1400, "user_id": 4816590, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8fa5a126eba3fbde91a8ae572f25c961?s=128&d=identicon&r=PG", "display_name": "Ramon Vasconcelos", "link": "https://stackoverflow.com/users/4816590/ramon-vasconcelos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 58151248, "answer_count": 1, "score": 0, "last_activity_date": 1569716674, "creation_date": 1569663956, "last_edit_date": 1569670149, "question_id": 58145120, "link": "https://stackoverflow.com/questions/58145120/how-to-formulate-requests-for-these-endpoints", "title": "How to formulate requests for these endpoints", "body": "<p>I cannot figure out how to make the requests for \"access\", \"clock\" and \"audit\" with the required parameters. Could you give me some guidance on how to make these requests?</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/sha256\"\n    \"crypto/subtle\"\n    \"encoding/base64\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"sync\"\n    \"time\"\n)\n\nconst secret = \"galumphing\"\n\n// Required parameters for the request\ntype params struct {\n    Act       string\n    Nonce     string\n    Signature string\n    Timeout   int64\n    Offset    int\n}\n\nvar (\n    auditLock sync.Mutex\n    auditBase int\n    auditLog  []string\n)\n\nvar (\n    seenLock sync.Mutex\n    seenMap  = map[string]bool{}\n)\n\nvar (\n    clockAsk  = make(chan bool)\n    clockTime = make(chan int64, 1)\n)\n\nfunc main() {\n    // Endpoints available\n    http.HandleFunc(\"/903/access\", handleAccess)\n    http.HandleFunc(\"/903/clock\", handleClock)\n    http.HandleFunc(\"/903/audit\", handleAudit)\n\n    err := http.ListenAndServe(os.Args[1], nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc checkCapacity(w http.ResponseWriter) (ok bool) {\n    auditLock.Lock()\n    defer auditLock.Unlock()\n\n    if len(auditLog) &gt; 10 {\n        w.WriteHeader(http.StatusServiceUnavailable)\n        return\n    }\n\n    ok = true\n    return\n}\n\nfunc audit(r *http.Request, params params, ok bool) {\n    auditLock.Lock()\n    defer auditLock.Unlock()\n\n    auditLog = append(auditLog, fmt.Sprintf(\"%v %q %q\", ok, r.URL.Path, params.Act))\n}\n\nfunc parse(w http.ResponseWriter, r *http.Request) (params params, ok bool) {\n    defer func() {\n        if !ok {\n            audit(r, params, false)\n        }\n    }()\n\n    w.Header().Set(\"Access-Control-Allow-Methods\", \"POST, OPTIONS\")\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    w.Header().Set(\"Access-Control-Max-Age\", \"3600\")\n\n    if r.Method != \"POST\" {\n        w.Header().Set(\"Allow\", \"POST, OPTIONS\")\n        if r.Method == \"OPTIONS\" {\n            w.WriteHeader(http.StatusOK)\n        } else {\n            w.WriteHeader(http.StatusMethodNotAllowed)\n        }\n        return\n    }\n\n    err := json.NewDecoder(r.Body).Decode(&amp;params)\n    if err != nil {\n        w.WriteHeader(http.StatusBadRequest)\n        log.Printf(\"%s: %v\", r.URL.Path, err)\n        return\n    }\n\n    h := sha256.New()\n    fmt.Fprintf(h, \"%s\\r\\n%s\\r\\n%s\\r\\n%s\", r.URL.Path, params.Act, params.Nonce, secret)\n    sig := base64.StdEncoding.EncodeToString(h.Sum(nil))\n    if subtle.ConstantTimeCompare([]byte(sig), []byte(params.Signature)) != 1 {\n        w.WriteHeader(http.StatusForbidden)\n        return\n    }\n\n    seenLock.Lock()\n    seen := seenMap[params.Signature]\n    if !seen {\n        seenMap[params.Signature] = true\n    }\n    seenLock.Unlock()\n    if seen {\n        w.WriteHeader(http.StatusForbidden)\n        return\n    }\n\n    ok = true\n    return\n}\n\nfunc handleAccess(w http.ResponseWriter, r *http.Request) {\n    if !checkCapacity(w) {\n        return\n    }\n\n    params, ok := parse(w, r)\n    if !ok {\n        return\n    }\n\n    switch params.Act {\n    case \"begin\":\n        if params.Timeout &lt; 0 || params.Timeout &gt; 250000 {\n            w.WriteHeader(http.StatusBadRequest)\n            audit(r, params, false)\n            return\n        }\n\n        timer := time.NewTimer(time.Duration(params.Timeout) * time.Microsecond)\n\n        select {\n        case clockAsk &lt;- true: // https://golang.org/ref/spec#Send_statements\n            w.WriteHeader(http.StatusNoContent)\n            audit(r, params, true)\n\n        case &lt;-timer.C:\n            w.WriteHeader(http.StatusConflict)\n            audit(r, params, false)\n            return\n        }\n\n        go func() {\n            &lt;-timer.C\n\n            select {\n            case &lt;-clockTime:\n            default:\n            }\n        }()\n\n    case \"end\":\n        if params.Timeout &lt; 0 {\n            w.WriteHeader(http.StatusBadRequest)\n            audit(r, params, false)\n            return\n        }\n\n        timer := time.NewTimer(time.Duration(params.Timeout) * time.Microsecond)\n\n        select {\n        case value := &lt;-clockTime: // https://golang.org/ref/spec#Receive_operator\n            w.Header().Set(\"Content-Type\", \"text/plain\")\n            w.WriteHeader(http.StatusOK)\n            fmt.Fprintln(w, value)\n            audit(r, params, true)\n\n        case &lt;-timer.C:\n            w.WriteHeader(http.StatusConflict)\n            audit(r, params, false)\n        }\n\n    default:\n        w.WriteHeader(http.StatusBadRequest)\n        audit(r, params, false)\n    }\n}\n\nfunc handleClock(w http.ResponseWriter, r *http.Request) {\n    if !checkCapacity(w) {\n        return\n    }\n\n    params, ok := parse(w, r)\n    if !ok {\n        return\n    }\n\n    switch params.Act {\n    case \"observe\":\n        if params.Timeout != 0 {\n            w.WriteHeader(http.StatusBadRequest)\n            audit(r, params, false)\n            return\n        }\n\n        select {\n        case &lt;-clockAsk: // https://golang.org/ref/spec#Receive_operator\n            select {\n            case clockTime &lt;- time.Now().Unix(): // https://golang.org/ref/spec#Send_statements\n            default:\n            }\n\n        default:\n        }\n\n        w.WriteHeader(http.StatusNoContent)\n        audit(r, params, true)\n\n    default:\n        w.WriteHeader(http.StatusBadRequest)\n        audit(r, params, false)\n    }\n}\n\nfunc handleAudit(w http.ResponseWriter, r *http.Request) {\n    params, ok := parse(w, r)\n    if !ok {\n        return\n    }\n\n    ok = false\n\n    func() {\n        auditLock.Lock()\n        defer auditLock.Unlock()\n\n        switch params.Act {\n        case \"\":\n            if params.Offset != 0 {\n                w.WriteHeader(http.StatusBadRequest)\n                return\n            }\n\n            w.Header().Set(\"Content-Type\", \"text/plain\")\n            w.WriteHeader(http.StatusOK)\n            fmt.Fprintln(w, auditBase)\n\n        case \"burble\":\n            if params.Offset &lt; auditBase || params.Offset &gt; auditBase+len(auditLog) {\n                w.WriteHeader(http.StatusBadRequest)\n                return\n            }\n\n            w.Header().Set(\"Content-Type\", \"text/plain\")\n            w.WriteHeader(http.StatusOK)\n\n            for i := params.Offset - auditBase; i &lt; len(auditLog); i++ {\n                fmt.Fprintf(w, \"%d %s\\n\", auditBase+i, auditLog[i])\n            }\n\n        case \"chortle\":\n            if params.Offset &gt; auditBase+len(auditLog) {\n                w.WriteHeader(http.StatusBadRequest)\n                return\n            }\n\n            if params.Offset &gt; auditBase {\n                auditLog = auditLog[params.Offset-auditBase:] // https://golang.org/ref/spec#Slice_expressions\n                auditBase = params.Offset\n            }\n\n            w.WriteHeader(http.StatusNoContent)\n\n        default:\n            w.WriteHeader(http.StatusBadRequest)\n            return\n        }\n\n        ok = true\n    }()\n\n    audit(r, params, ok)\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 1417, "user_id": 109472, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/be1397db4ebc83d4cef5e47551614e56?s=128&d=identicon&r=PG", "display_name": "Nixarn", "link": "https://stackoverflow.com/users/109472/nixarn"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1569652340, "post_id": 58143760, "comment_id": 102673427, "body": "No this happened yesterday (Sept 27) and today again. As you can see in the log there"}, {"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1569700905, "post_id": 58143760, "comment_id": 102683764, "body": "An error is being reported. The last log line shows a <code>500</code> on the 10th (!) <code>POST</code> to <code>&#47;clan&#47;poll&#47;quests</code>. The App Engine default timeout is 60 seconds after which time, the service will terminate the request. 10 attempts on this request comes out to ~600 seconds (602.1 seconds is shown). So, if you&#39;re not already, you should determine whether it&#39;s always this endpoint that&#39;s failing and then dig into <code>&#47;clan&#47;poll&#47;guests</code>."}, {"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1569701207, "post_id": 58143760, "comment_id": 102683836, "body": "You may also wish to consider: Stackdriver Error Reporting (<a href=\"https://cloud.google.com/error-reporting/docs/setup/go\" rel=\"nofollow noreferrer\">cloud.google.com/error-reporting/docs/setup/go</a>) to dig into any errors from your code and Stackdriver Profiler (<a href=\"https://cloud.google.com/profiler/docs/profiling-go\" rel=\"nofollow noreferrer\">cloud.google.com/profiler/docs/profiling-go</a>)"}, {"owner": {"reputation": 1417, "user_id": 109472, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/be1397db4ebc83d4cef5e47551614e56?s=128&d=identicon&r=PG", "display_name": "Nixarn", "link": "https://stackoverflow.com/users/109472/nixarn"}, "reply_to_user": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1569743581, "post_id": 58143760, "comment_id": 102689843, "body": "Thanks @DazWilkin I&#39;ll try the stack driver error reporting tool. Also, once one request fails all other fail as well, and critical errors were reported on the AppEngine dashboard(I guess those would be panic() errors?). I got GoLand now instead of just a syntax hightlight editor and it did find some warnings, so next step will be to go through the warnings and fix those and add the improved error reporting."}, {"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1569785134, "post_id": 58143760, "comment_id": 102699418, "body": "Error Reporting will enable to capture errors from the running service. The endpoint looks to be panicking. Error Reporting should help you identify the underlying problem."}, {"owner": {"reputation": 1417, "user_id": 109472, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/be1397db4ebc83d4cef5e47551614e56?s=128&d=identicon&r=PG", "display_name": "Nixarn", "link": "https://stackoverflow.com/users/109472/nixarn"}, "reply_to_user": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1570081623, "post_id": 58143760, "comment_id": 102802637, "body": "I found the issue. The problem was I replaced every datastore.Put() with a dsClient = datastore.NewClient(...) dsClient.put(), and that created a ton of open connections, when I added a defer close it worked, but still consumed a ton of memory, but switching it to one shared datastore client fixed all issues."}], "owner": {"reputation": 1417, "user_id": 109472, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/be1397db4ebc83d4cef5e47551614e56?s=128&d=identicon&r=PG", "display_name": "Nixarn", "link": "https://stackoverflow.com/users/109472/nixarn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1569670176, "creation_date": 1569649904, "last_edit_date": 1569670176, "question_id": 58143760, "link": "https://stackoverflow.com/questions/58143760/app-engine-going-crazy-after-some-hours-of-a-new-deployment", "title": "App Engine going crazy after some hours of a new deployment", "body": "<p>I was a bit unsure how to title this question, as I'm quite unsure where the problems is. Recently we upgraded to Go 1.11 as 1.9 is deprecated as of oct 1, unfortunately it wasn't a smooth transition.</p>\n\n<p>I did all changes needed, got it running just fine and it worked well for around 10 hours. Then all the suddenly requests start taking 10 minutes (but they shouldn't take more than 1min ever?) and this causes new instances to be created but no requests go through successfully. (As a side-note, I didn't have a max instances value set so at one point 500 were created. Now it's capped)</p>\n\n<p>Yesterday I fixed a couple null pointer errors that got reported (5 reports in total), re deployed and again, same thing. Here's the log from when it happened:</p>\n\n<p><a href=\"https://i.stack.imgur.com/tOHGP.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/tOHGP.png\" alt=\"enter image description here\"></a></p>\n\n<p>Everything was working fine, until it wasn't. And zero errors have been reported.</p>\n\n<p>The function called is pretty simple, a couple datastore reads and and every now and then a write. No for loops that could turn into infinite for loops and so forth.</p>\n\n<p>I'm a bit lost where to go next, I migrated traffic back to the 1.9 version for now.</p>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 657, "user_id": 16015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/687fc707b9a25551fa470b92d62c9218?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/16015/chris"}, "edited": false, "score": 0, "creation_date": 1605887812, "post_id": 58144420, "comment_id": 114798922, "body": "What about extracting the value?"}], "tags": [], "owner": {"reputation": 1022, "user_id": 4648184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/530bad0fba2d3c48393c99f66e04b7dd?s=128&d=identicon&r=PG&f=1", "display_name": "Pablo Flores", "link": "https://stackoverflow.com/users/4648184/pablo-flores"}, "is_accepted": true, "score": 0, "last_activity_date": 1569657253, "creation_date": 1569657253, "answer_id": 58144420, "question_id": 58143555, "link": "https://stackoverflow.com/questions/58143555/how-to-mock-cursor-with-mongo-go-driver/58144420#58144420", "title": "How to mock cursor with mongo-go-driver", "body": "<p>In my opinion, the best approach to mocking this kind of objects is by defining an interface, as in go interfaces are implemented implicitly your code probably wouldn't need that much changes. Once you have an interface you can use some third party library to autogenerate mocks, like <a href=\"https://github.com/vektra/mockery\" rel=\"nofollow noreferrer\">mockery</a>  </p>\n\n<p>An example on how to create the interface</p>\n\n<pre><code>type Cursor interface{\n  Next(ctx Context)\n  Close(ctx Context)  \n}\n</code></pre>\n\n<p>Just change any function that receives a mongodb cursor to use the custom interface</p>\n"}, {"tags": [], "owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "is_accepted": false, "score": 0, "last_activity_date": 1599986565, "creation_date": 1599986565, "answer_id": 63868798, "question_id": 58143555, "link": "https://stackoverflow.com/questions/58143555/how-to-mock-cursor-with-mongo-go-driver/63868798#63868798", "title": "How to mock cursor with mongo-go-driver", "body": "<p>I just ran into this problem. Because <code>mongo.Cursor</code> has an internal field that holds the <code>[]byte</code> -- <code>Current</code>, in order to fully mock you'll need to wrap the <code>mongo.Cursor</code>. Here are the types I made to do this:</p>\n<pre><code>type MongoCollection interface {\n    Find(ctx context.Context, filter interface{}, opts ...*options.FindOptions) (MongoCursor, error)\n    FindOne(ctx context.Context, filter interface{}, opts ...*options.FindOneOptions) MongoDecoder\n    Aggregate(ctx context.Context, pipeline interface{}, opts ...*options.AggregateOptions) (MongoCursor, error)\n}\n\ntype MongoDecoder interface {\n    DecodeBytes() (bson.Raw, error)\n    Decode(val interface{}) error\n    Err() error\n}\n\ntype MongoCursor interface {\n    Decode(val interface{}) error\n    Err() error\n    Next(ctx context.Context) bool\n    Close(ctx context.Context) error\n    ID() int64\n    Current() bson.Raw\n}\n\ntype mongoCursor struct {\n    mongo.Cursor\n}\n\nfunc (m *mongoCursor) Current() bson.Raw {\n    return m.Cursor.Current\n}\n</code></pre>\n<p>Unfortunately this will be a bit of a moving target. I'll have to add new functions to the <code>MongoCollection</code> interface as time goes on.</p>\n"}], "owner": {"reputation": 13, "user_id": 12133677, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-YhGzhqSvyG4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reu0ehEIDcZ3tSiaS-d6uTDu_n1DQ/photo.jpg?sz=128", "display_name": "surya rawr", "link": "https://stackoverflow.com/users/12133677/surya-rawr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 659, "favorite_count": 0, "accepted_answer_id": 58144420, "answer_count": 2, "score": 1, "last_activity_date": 1599986565, "creation_date": 1569647677, "last_edit_date": 1569670190, "question_id": 58143555, "link": "https://stackoverflow.com/questions/58143555/how-to-mock-cursor-with-mongo-go-driver", "title": "How to mock cursor with mongo-go-driver", "body": "<p>I just learned go language, and then used <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">https://github.com/mongodb/mongo-go-driver</a> for make rest API with MongoDB and Golang and then I'm doing a unit test, but I'm stuck when mocking Cursor MongoDB, because Cursor is a struct, an idea for that or someone made it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1569766693, "post_id": 58143271, "comment_id": 102694823, "body": "I am a bit... puzzled. That is not exactly a map/reduce, is it?"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1569953680, "post_id": 58143271, "comment_id": 102759969, "body": "@MarkusWMahlberg, why not? I am perform some operation for each playlist (Map-step) and calculete aggregate over all playlists (Reduce-step).  For me, it is looks like as a classic MapReduce (<a href=\"https://en.wikipedia.org/wiki/MapReduce\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/MapReduce</a>)"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1569870413, "last_edit_date": 1569870413, "creation_date": 1569649190, "answer_id": 58143692, "question_id": 58143271, "link": "https://stackoverflow.com/questions/58143271/mapreduce-task-using-channels/58143692#58143692", "title": "MapReduce task using channels", "body": "<p>There are multiple solutions using channels. One might look like this:</p>\n\n<pre><code>ch := make(chan *engine2.DownloadResult)\nwg := sync.WaitGroup()\ngo func() {\n   for result := range ch {\n      increment_without_lock(result)\n   }\n}()\nfor _, playlist := range repository.PlaylistRepository.Fetch() {\n    id := playlist.Id\n    wg.Add(1)\n    go func() {\n       defer wg.Done()\n       ch &lt;- engine.DownloadPlaylist(id)\n    }()\n}\nwg.Wait()\nclose(ch)\n</code></pre>\n"}], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 58143692, "answer_count": 1, "score": 1, "last_activity_date": 1569870413, "creation_date": 1569643657, "question_id": 58143271, "link": "https://stackoverflow.com/questions/58143271/mapreduce-task-using-channels", "title": "MapReduce task using channels", "body": "<p>My function downloads data, parses it and returns some result. I would like to start many instances of the function concurrently and sum up the results of them. Here is my solution using <code>Mutex</code>:</p>\n\n<pre><code>var lock sync.Mutex\nincrement := func(data engine2.DownloadResult) {\n    lock.Lock()\n    defer lock.Unlock()\n    albums += data.Album\n    singles += data.Single\n}\n\nvar wg sync.WaitGroup\nfoo := func(id uint) {\n    defer wg.Done()\n    result := engine.DownloadPlaylist(id)\n    increment(*result)\n}\n\nfor _, playlist := range repository.PlaylistRepository.Fetch() {\n    wg.Add(1)\n    go foo(playlist.Id)\n}\n\nwg.Wait()\n</code></pre>\n\n<p>As I know <code>channels</code> are recommended synchronization mechanism in Go. Can you please show me how can I rewrite this task using channels?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1569648617, "post_id": 58143139, "comment_id": 102672910, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/21481288/variable-not-declared-inside-a-if-else-statement\">Variable not declared, inside a if..else statement</a>, <a href=\"https://stackoverflow.com/questions/42074611/if-else-condition-defines-variable-undefined-dat-variable\">if/else condition defines variable. undefined: dat (variable)</a>"}, {"owner": {"reputation": 1762, "user_id": 3044959, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/TDfIN.jpg?s=128&g=1", "display_name": "nodeffect", "link": "https://stackoverflow.com/users/3044959/nodeffect"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1569667413, "post_id": 58143139, "comment_id": 102675956, "body": "i;ve search from others but couldn&#39;t solve the rows problem, I couldn&#39;t declare rows until someone show me the solution"}], "answers": [{"tags": [], "owner": {"reputation": 131, "user_id": 9353289, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-7zRvzDBVsKY/AAAAAAAAAAI/AAAAAAAALJU/mLo07MckG9M/photo.jpg?sz=128", "display_name": "Sufiyan Parkar", "link": "https://stackoverflow.com/users/9353289/sufiyan-parkar"}, "is_accepted": true, "score": 1, "last_activity_date": 1569681578, "last_edit_date": 1569681578, "creation_date": 1569643918, "answer_id": 58143293, "question_id": 58143139, "link": "https://stackoverflow.com/questions/58143139/how-to-declare-a-sql-row-if-else-statement-not-declared-problem/58143293#58143293", "title": "How to declare a SQL row, if else statement not declared problem", "body": "<p>You are facing issues because of the scope of the variable.\nIn Golang, <code>:=</code> creates a new variable inside a scope.</p>\n\n<p><code>rows, err := pnt.ReadConn(\"testdb\").Query(sql, start, end, start, end)</code></p>\n\n<p>Creates a new <code>rows</code> and <code>err</code> variables in the <code>if</code> block which won't be accessible outside the if block.</p>\n\n<p><a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">Shorthand declarations in Go</a></p>\n\n<p>The fix,</p>\n\n<pre><code>var sql string\nvar err error\nvar rows *sql.Rows\n\nif pnt.Type == \"newType\" {\n    sql = `select code, count(*) count from ( \n                select code \n                    from code_table \n                    where start &gt;= ? and end &lt;= ? \n                union \n                select code \n                    from code_table \n                    where start &gt;= ? and end &lt;= ? \n                ) a group by code`\n    rows, err = pnt.ReadConn(\"testdb\").Query(sql, start, end, start, end)\n} else {\n    sql = `select code, count(*) count from code_table where start &gt;= ? and end &lt;= ?` group by code\n    rows, err = pnt.ReadConn(\"testdb\").Query(sql, start, end)\n}\n\nif err == nil {\n    defer rows.Close()\n    for rows.Next() {\n        var code, count int\n        rows.Scan(&amp;code, &amp;count)\n    }\n} else {\n    log.Println(err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 148, "user_id": 9569060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e19ad970d755bb34cb928192efffa782?s=128&d=identicon&r=PG&f=1", "display_name": "B.Ghost", "link": "https://stackoverflow.com/users/9569060/b-ghost"}, "is_accepted": false, "score": 0, "last_activity_date": 1569644070, "creation_date": 1569644070, "answer_id": 58143306, "question_id": 58143139, "link": "https://stackoverflow.com/questions/58143139/how-to-declare-a-sql-row-if-else-statement-not-declared-problem/58143306#58143306", "title": "How to declare a SQL row, if else statement not declared problem", "body": "<p>In golang \":=\" mean you declare a variable and assign them a this value GO will automatically detect his type so : \nExemples \n<code>variable := 15</code> \nIt\u2019s the same \n<code>var variable int = 15</code> </p>\n\n<p>So when you do this <code>rows, err := pnt.switchConn(\"base\", \"read\").Query(sql, start, end, start, end)\n} else {\n    sql =</code>select code, count(*) count from code_table where start >= ? and end &lt;= ?<code>group by code\n    rows, err := pnt.switchConn(\"base\", \"read\").Query(sql, start, end)\n}\n</code>\nYou declare the same variable rows and err twice </p>\n"}], "owner": {"reputation": 1762, "user_id": 3044959, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/TDfIN.jpg?s=128&g=1", "display_name": "nodeffect", "link": "https://stackoverflow.com/users/3044959/nodeffect"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 58143293, "answer_count": 2, "score": 0, "last_activity_date": 1569681578, "creation_date": 1569641706, "last_edit_date": 1569670211, "question_id": 58143139, "link": "https://stackoverflow.com/questions/58143139/how-to-declare-a-sql-row-if-else-statement-not-declared-problem", "title": "How to declare a SQL row, if else statement not declared problem", "body": "<p>I have a code like this below.</p>\n\n<pre><code>var sql string\n\nif pnt.Type == \"newType\" {\n    sql = `select code, count(*) count from ( \n                select code \n                    from code_table \n                    where start &gt;= ? and end &lt;= ? \n                union \n                select code \n                    from code_table \n                    where start &gt;= ? and end &lt;= ? \n                ) a group by code`\n    rows, err := pnt.readConn(\"testdb\").Query(sql, start, end, start, end)\n} else {\n    sql = `select code, count(*) count from code_table where start &gt;= ? and end &lt;= ?` group by code\n    rows, err := pnt.readConn(\"testdb\").Query(sql, start, end)\n}\n\nif err == nil {\n    defer rows.Close()\n    for rows.Next() {\n        var code, count int\n        rows.Scan(&amp;code, &amp;count)\n    }\n} else {\n    log.Println(err)\n}\n</code></pre>\n\n<p>This will give me an error something like this \"Variable not declared for rows, err\"... </p>\n\n<p>I've tried declaring \"var err error\" and within the if else statement, I use = instead of :=\nsomething like this</p>\n\n<pre><code>var err error\nrows, err = pnt.switchConn(\"base\", \"read\").Query(sql, start, end)\n</code></pre>\n\n<p>However, I still can't declare the rows cuz I will have different kind of errors for that. I tried declaring it as string but no luck.</p>\n\n<p>This is my first time using golang and the if else thing is giving me a hard time, why can't I just use := inside if else statement. As you can see, I can't use rows, err := outside the if else statement, cuz both have different numbers of parameters. </p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1569628281, "post_id": 58142263, "comment_id": 102670678, "body": "Note: The second solution doesn&#39;t work for nested json objects and the first doesn&#39;t guarantee syntactically correct JSON"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1569628483, "post_id": 58142263, "comment_id": 102670707, "body": "If the body is always JSON, then use the second approach to avoid encoding errors.  Use <code>bytes.NewReader</code> instead of <code>bytes.NewBuffer</code>.  What problem are you having with the <code>constuctBody</code> function?  Give some examples of the values you want to pass to <code>constructBody</code>. The second approach will work with nested objects if you use map[string]interface{}."}], "answers": [{"tags": [], "owner": {"reputation": 3547, "user_id": 546750, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/5e663c9fc0ebe46af81b8a49d5e2aa91?s=128&d=identicon&r=PG", "display_name": "ahmy", "link": "https://stackoverflow.com/users/546750/ahmy"}, "is_accepted": false, "score": 0, "last_activity_date": 1569670383, "creation_date": 1569670383, "answer_id": 58145884, "question_id": 58142263, "link": "https://stackoverflow.com/questions/58142263/http-post-request-with-body-go/58145884#58145884", "title": "Http POST request with body Go", "body": "<p>If the body is already string, options #1 is more compelling to me.</p>\n\n<p>If you are only working with a key -> value with only string, option #2 is better.\nBut this will become cumbersome when you have nested struct</p>\n\n<p>But most of the time in my experience we are dealing with struct. I like to make the struct closer to where the http call happened. </p>\n\n<pre><code>func main() {\n    ctx := context.Background()\n\n    body := struct {\n        Key string `json:\"key\"`\n    }{\n        Key: \"value\",\n    }\n\n    out, err := json.Marshal(body)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n\n    req, err := http.NewRequest(\"POST\", \"http://example.com\", bytes.NewBuffer(out))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    req = req.WithContext(ctx)\n\n    http.DefaultClient.Do(req)\n}\n</code></pre>\n\n<p>And if the struct is used in multiple places, you can make a package level struct.</p>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1569768423, "creation_date": 1569768423, "answer_id": 58156295, "question_id": 58142263, "link": "https://stackoverflow.com/questions/58142263/http-post-request-with-body-go/58156295#58156295", "title": "Http POST request with body Go", "body": "<p>To have it more reusable, you could create a jsonReaderFactory, which just takes a few lines of code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func jsonReaderFactory(in interface{}) (io.Reader, error) {\n    buf := bytes.NewBuffer(nil)\n    enc := json.NewEncoder(buf)\n    err := enc.Encode(in)\n    if err != nil {\n        return nil, fmt.Errorf(\"creating reader: error encoding data: %s\", err)\n    }\n    return buf, nil\n}\n</code></pre>\n\n<p><strong><kbd><a href=\"https://play.golang.org/p/UzONP6sauEH\" rel=\"nofollow noreferrer\">Example on playground</a></kbd></strong></p>\n"}], "owner": {"reputation": 688, "user_id": 9335323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afa5fa14921e13722e4e1c69222fa227?s=128&d=identicon&r=PG&f=1", "display_name": "Adolfo", "link": "https://stackoverflow.com/users/9335323/adolfo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 190, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1569768423, "creation_date": 1569627525, "question_id": 58142263, "link": "https://stackoverflow.com/questions/58142263/http-post-request-with-body-go", "title": "Http POST request with body Go", "body": "<p>I want to construct a HTTP POST request with a body using Go <code>net/http</code> library.</p>\n\n<p>The function I am using to construct the http request is the following: <a href=\"https://golang.org/pkg/net/http/#NewRequest\" rel=\"nofollow noreferrer\">docs</a></p>\n\n<pre><code>http.NewRequest(method string, url string, body io.Reader)\n</code></pre>\n\n<p>I came up with 2 solutions, but I am trying to see which one is more idiomatic and extensible to support different body configurations. </p>\n\n<pre><code>Solution #1\n\nbytesObj := []byte(`{\"key\":\"value\"}`)\nbody := bytes.NewBuffer(bytesObj)\n\n</code></pre>\n\n<pre><code>Solution #2\n\nbodyMap := map[string]string{\"key\":\"value\"}\nbodyBytes, _ := json.Marshal(bodyMap)\nbody := bytes.NewBuffer(bodyBytes)\n\n</code></pre>\n\n<p>Ideally, I will move the code to a helper function that way I can customize the construction of the body. The helper function will be something like</p>\n\n<pre><code>func constructBody(someArgument) io.Reader {\n  return bodyHere\n}\n</code></pre>\n"}, {"tags": ["json", "rest", "go", "swagger", "go-swagger"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1569649820, "post_id": 58142240, "comment_id": 102673087, "body": "I have the exact same situation producing the desired result, with the difference that the json tag for the body is <code>json:&quot;body&quot;</code>"}], "owner": {"reputation": 1507, "user_id": 807327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b8b96c91c66df91a27ca98b3ddf7ec4?s=128&d=identicon&r=PG", "display_name": "dbh", "link": "https://stackoverflow.com/users/807327/dbh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 145, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1569691754, "creation_date": 1569627215, "last_edit_date": 1569670285, "question_id": 58142240, "link": "https://stackoverflow.com/questions/58142240/problem-generating-spec-for-json-response-type-of-array-of-users", "title": "Problem generating Spec for JSON Response type of Array of Users", "body": "<p>I've got a  Go project, exposing REST CRUD APIs, for a Mongo collection. I'm using go-swagger to generate the swagger spec. However, I'm having trouble getting the JSON response to look like I want without breaking the go-swagger spec generator.</p>\n\n<p>I'm trying to use go-swagger to generate a swagger-spec from annotations on go code. I'd like to see if I can make the response just be a JSON Array of Users, like below. </p>\n\n<p>Is there a way to adjust the json annotation on the User struct to produce the desired result?</p>\n\n<pre><code>[\n    {\"id\": \"5d8e9aaca00ef6123c989f69\", \"user_name\": \"zbeeblebrox\"}, \n    {\"id\": \"5d8e9ab1a00ef6123c989f6a\", \"user_name\": \"another_user\"}\n]\n</code></pre>\n\n<p>Below is what I'm getting, understandably, a JSON object, containing key \"data\", with a value of an Array of User objects. </p>\n\n<p>I've tried redefining the swagger response struct to be an alias of type []*User, which creates the right response body, but it breaks the go swagger generator.  </p>\n\n<pre><code>{\n  \"data\": [\n    {\"id\": \"5d8e9aaca00ef6123c989f69\", \"user_name\": \"zbeeblebrox\"}, \n    {\"id\": \"5d8e9ab1a00ef6123c989f6a\", \"user_name\": \"another_user\"}\n  ]\n}\n</code></pre>\n\n<p>Here's some code.</p>\n\n<pre><code>// swagger:model\ntype User struct {\n    Id             *primitive.ObjectID      `json:\"id,omitempty\" bson:\"_id,omitempty\"`\n    UserName       string                   `json:\"user_name\" bson:\"user_name\"`\n}\n\n// HTTP status code 200 and an array of repository models in data\n//swagger:response usersResp\ntype swaggUsersResp struct {\n    // in:body\n    Data []*User `json:\"data\"`\n}\n</code></pre>\n\n<p>I also tried doing it as an alias, which provides the desired JSON response, but breaks Go-Swagger code generation. I suspect this is because the swagger:response annotation is expected to be on a struct, not an alias.</p>\n\n<pre><code>// swagger:response usersResp\ntype swaggUsersResp = []*User\n</code></pre>\n"}, {"tags": ["postgresql", "go", "testing", "go-sqlmock"], "comments": [{"owner": {"reputation": 155, "user_id": 6759337, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xmkBv.png?s=128&g=1", "display_name": "PeggyScott", "link": "https://stackoverflow.com/users/6759337/peggyscott"}, "edited": false, "score": 0, "creation_date": 1569813728, "post_id": 58142191, "comment_id": 102704354, "body": "I made some progress,      <code>crawlerMock.ExpectQuery(&quot;SELECT EXISTS \\\\( SELECT 1 (.*) &#39;myTable3&#39; \\\\);&quot;).         WillReturnRows(existsRows)</code>  gives me &#39;arguments do not match: expected 1, but got 0 arguments&#39;. Please let me know how to proceed. I am not providing any arguments in my actual code. And it works. More examples here: <a href=\"https://chromium.googlesource.com/external/github.com/DATA-DOG/go-sqlmock/+/e36ad8d068217ee8e4df50408476b153e115e3e6/README.md\" rel=\"nofollow noreferrer\">chromium.googlesource.com/external/github.com/DATA-DOG/&hellip;</a>"}, {"owner": {"reputation": 155, "user_id": 6759337, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xmkBv.png?s=128&g=1", "display_name": "PeggyScott", "link": "https://stackoverflow.com/users/6759337/peggyscott"}, "edited": false, "score": 0, "creation_date": 1569868297, "post_id": 58142191, "comment_id": 102727636, "body": "I tried one more thing: <code>crawlerMock.ExpectQuery(&quot;SELECT EXISTS ( SELECT 1 FROM information_schema.tables WHERE table_schema = &#39;public&#39; AND table_name = &#39;myTable3&#39; );&quot;). \t\tWillReturnRows(existsRows)</code> gives the error <code>could not match actual sql:  \\&quot;SELECT EXISTS ( SELECT 1 FROM information_schema.tables WHERE table_schema = &#39;public&#39; AND table_name = &#39;myTable3&#39; );\\&quot;  with expected regexp  \\&quot;SELECT EXISTS ( SELECT 1 FROM information_schema.tables WHERE table_schema = &#39;public&#39; AND table_name = &#39;myTable3&#39; );\\&quot;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 148, "user_id": 9569060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e19ad970d755bb34cb928192efffa782?s=128&d=identicon&r=PG&f=1", "display_name": "B.Ghost", "link": "https://stackoverflow.com/users/9569060/b-ghost"}, "is_accepted": false, "score": 0, "last_activity_date": 1569644825, "creation_date": 1569644825, "answer_id": 58143356, "question_id": 58142191, "link": "https://stackoverflow.com/questions/58142191/call-to-query-with-args-was-not-expected-in-go-sqlmock-for-compound-sql-quer/58143356#58143356", "title": "Call to Query with args [], was not expected in go-sqlmock for compound SQL queries", "body": "<p>I am not sure but think the problem is in your indentation of ur query try to remove the line break or your tabulation in your query <code>SELECT EXISTS\n        ( SELECT 1\n        FROM information_schema.tables\n        WHERE table_schema = 'public'\n           AND table_name = 'myTable3' );</code></p>\n\n<p>Like this  <code>SELECT EXISTS( SELECT 1 FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'myTable3' );</code></p>\n"}, {"tags": [], "owner": {"reputation": 155, "user_id": 6759337, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xmkBv.png?s=128&g=1", "display_name": "PeggyScott", "link": "https://stackoverflow.com/users/6759337/peggyscott"}, "is_accepted": true, "score": 0, "last_activity_date": 1569874995, "last_edit_date": 1569874995, "creation_date": 1569811030, "answer_id": 58160875, "question_id": 58142191, "link": "https://stackoverflow.com/questions/58142191/call-to-query-with-args-was-not-expected-in-go-sqlmock-for-compound-sql-quer/58160875#58160875", "title": "Call to Query with args [], was not expected in go-sqlmock for compound SQL queries", "body": "<p>Actually,</p>\n\n<pre><code>\n    sqlMock.ExpectQuery(\"SELECT EXISTS \\\\( SELECT 1 FROM information_schema\\\\.tables WHERE table_schema = 'public' AND table_name = 'myTable3' \\\\);\").\n        WillReturnRows(existsRows)\n</code></pre>\n\n<p>did the trick.</p>\n\n<p>More examples here:\n<a href=\"https://chromium.googlesource.com/external/github.com/DATA-DOG/go-sqlmock/+/e36ad8d068217ee8e4df50408476b153e115e3e6/README.md\" rel=\"nofollow noreferrer\">https://chromium.googlesource.com/external/github.com/DATA-DOG/go-sqlmock/+/e36ad8d068217ee8e4df50408476b153e115e3e6/README.md</a></p>\n\n<p>I also used regex101.com</p>\n\n<p>The clue was it was expecting the next query straightaway. So we knew it didn't read this one at all. My co worker pointed it out :)</p>\n"}], "owner": {"reputation": 155, "user_id": 6759337, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xmkBv.png?s=128&g=1", "display_name": "PeggyScott", "link": "https://stackoverflow.com/users/6759337/peggyscott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2139, "favorite_count": 0, "accepted_answer_id": 58160875, "answer_count": 2, "score": 0, "last_activity_date": 1569874995, "creation_date": 1569626533, "question_id": 58142191, "link": "https://stackoverflow.com/questions/58142191/call-to-query-with-args-was-not-expected-in-go-sqlmock-for-compound-sql-quer", "title": "Call to Query with args [], was not expected in go-sqlmock for compound SQL queries", "body": "<p>I was able to successfully mock the query to select from one table like so: </p>\n\n<pre><code>sqlMock.ExpectQuery(\"^SELECT DISTINCT (.+) FROM myTable1, myTable2\").\n        WillReturnRows(myResultRows)\n</code></pre>\n\n<p>But I was not able to mock the following query that checks for the existence of the table in my postgres  db:</p>\n\n<pre><code>SELECT EXISTS\n        ( SELECT 1\n        FROM information_schema.tables\n        WHERE table_schema = 'public'\n           AND table_name = 'myTable3' );\n</code></pre>\n\n<p>The combination of:</p>\n\n<pre><code>    existsRows := sqlmock.NewRows([]string{\"exists\"}).\n        AddRow(true)\n</code></pre>\n\n<p>AND</p>\n\n<pre><code>    slMock.ExpectQuery(\"^SELECT EXISTS\").\n        WillReturnRows(existsRows)\n</code></pre>\n\n<p>I tried mocking <code>SELECT 1</code> as well but I get the exact same error:</p>\n\n<pre><code>time=\"2019-09-27T15:49:41-07:00\" level=panic msg=\"db query\" error=\"call to Query 'SELECT EXISTS\\n\\t\\t( SELECT 1\\n\\t\\tFROM information_schema.tables\\n\\t\\tWHERE table_schema = 'public'\\n\\t\\t   AND table_name = 'myTable3' );' with args [], was not expected, next expectation is: ExpectedExec =&gt; expecting Exec or ExecContext which......\n</code></pre>\n\n<p>Packages I am using:</p>\n\n<pre><code>import (\n    \"database/sql\"\n    \"db\"\n    \"os\"\n    \"testing\"\n\n    // not explicitly called\n    _ \"github.com/denisenkom/go-mssqldb\"\n    _ \"github.com/lib/pq\"\n\n    \"github.com/DATA-DOG/go-sqlmock\"\n    \"github.com/sirupsen/logrus\"\n)\n</code></pre>\n\n<p>Any ideas or pointers are appreciated. I couldn't find relevant examples on the internet</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1986, "user_id": 4180276, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f34129a97d735e6e19247c911626cb9a?s=128&d=identicon&r=PG&f=1", "display_name": "nadermx", "link": "https://stackoverflow.com/users/4180276/nadermx"}, "edited": false, "score": 0, "creation_date": 1569629590, "post_id": 58142389, "comment_id": 102670820, "body": "It gives me <code>cannot use req.Request.Form (type url.Values) as type []ArrayText in assignment</code>, so perhaps I might have to do <code>c.Captions = req.Request.Form[&quot;captions&quot;]</code>?"}, {"owner": {"reputation": 55, "user_id": 11898878, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KKfAm-JPmj4/AAAAAAAAAAI/AAAAAAAAAAk/F99sJ0yJSpI/photo.jpg?sz=128", "display_name": "Taylor Belland", "link": "https://stackoverflow.com/users/11898878/taylor-belland"}, "reply_to_user": {"reputation": 1986, "user_id": 4180276, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f34129a97d735e6e19247c911626cb9a?s=128&d=identicon&r=PG&f=1", "display_name": "nadermx", "link": "https://stackoverflow.com/users/4180276/nadermx"}, "edited": false, "score": 0, "creation_date": 1569630229, "post_id": 58142389, "comment_id": 102670927, "body": "You&#39;re on the right track. You probably want to marshall the data into your structures using the encoding/json built in library. The godoc for json is pretty confusing, but this page has a decent explanation. <a href=\"https://www.dotnetperls.com/json-go\" rel=\"nofollow noreferrer\">dotnetperls.com/json-go</a>"}, {"owner": {"reputation": 55, "user_id": 11898878, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KKfAm-JPmj4/AAAAAAAAAAI/AAAAAAAAAAk/F99sJ0yJSpI/photo.jpg?sz=128", "display_name": "Taylor Belland", "link": "https://stackoverflow.com/users/11898878/taylor-belland"}, "reply_to_user": {"reputation": 1986, "user_id": 4180276, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f34129a97d735e6e19247c911626cb9a?s=128&d=identicon&r=PG&f=1", "display_name": "nadermx", "link": "https://stackoverflow.com/users/4180276/nadermx"}, "edited": false, "score": 0, "creation_date": 1569633234, "post_id": 58142389, "comment_id": 102671287, "body": "So for a marshaller you have a few options, read the data in to an unmarshaller if you have the raw json data, or you can parse the url.Values, which should become a simple string once you call .Encode() on the url.Values. Sorry for the multiple posts, new here."}], "tags": [], "owner": {"reputation": 55, "user_id": 11898878, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KKfAm-JPmj4/AAAAAAAAAAI/AAAAAAAAAAk/F99sJ0yJSpI/photo.jpg?sz=128", "display_name": "Taylor Belland", "link": "https://stackoverflow.com/users/11898878/taylor-belland"}, "is_accepted": false, "score": 0, "last_activity_date": 1569629190, "creation_date": 1569629190, "answer_id": 58142389, "question_id": 58142151, "link": "https://stackoverflow.com/questions/58142151/how-to-parse-array-inside-form-post/58142389#58142389", "title": "How to parse array inside form post", "body": "<p>You're doing it right, except for the assignment. When you run req.Request.ParseForm(), rather than returning a value, or passing in a reference to a buffer, it populates the req.Request.Form and req.Request.PostForm structures.</p>\n\n<p><a href=\"https://godoc.org/net/http#Request.ParseForm\" rel=\"nofollow noreferrer\">The related GoDoc explaining said function</a></p>\n\n<p>So rather than </p>\n\n<pre><code>c.Captions = req.Request.ParseForm()\n</code></pre>\n\n<p>It would look more like</p>\n\n<pre><code>err := req.Request.ParseForm()\n//check for errors as usual here\nc.Captions = req.Request.Form\n//or\nc.Captions = req.Request.PostForm\n</code></pre>\n\n<p>Approaching it from this direction should put you on the right track.</p>\n\n<p>Cheers!\nTaylor</p>\n"}], "owner": {"reputation": 1986, "user_id": 4180276, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f34129a97d735e6e19247c911626cb9a?s=128&d=identicon&r=PG&f=1", "display_name": "nadermx", "link": "https://stackoverflow.com/users/4180276/nadermx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1569670307, "creation_date": 1569626048, "last_edit_date": 1569670307, "question_id": 58142151, "link": "https://stackoverflow.com/questions/58142151/how-to-parse-array-inside-form-post", "title": "How to parse array inside form post", "body": "<p>I currently have a form post that is coming in like</p>\n\n<pre><code>{\n \"stuff\":\"cool text\",\n \"otherthing\":\"neat thing\",\n \"captions\":[\n     {\"first\":\"the list\",\n     \"second\":\"how are you\"},\n     {\"first\":\"wow\",\n     etc....\n  ]\n}\n</code></pre>\n\n<p>Now I don't know how many captions there will be.  It might be one in the array, it might be twenty.</p>\n\n<p>I have set up two structures as well</p>\n\n<pre><code>type ThingContext struct {\n    Stuff       string  `json:\"stuff\"`\n    OtherThing  string  `json:\"otherthing\"`\n    Captions    []ArrayText `json:\"captions\"`\n}\n\ntype ArrayText struct {\n    First    string  `json:\"first\"`\n    Second   string  `json:\"second\"`\n}\n</code></pre>\n\n<p>And in my golang function I have something like this</p>\n\n<pre><code>func (c *ThingContext) SetThingContext(rw web.ResponseWriter, req *web.Request, next web.NextMiddlewareFunc) {\n    if err := req.ParseForm(); err != nil {\n    }\n    c.Stuff = req.FormValue(\"stuff\")\n    c.OtherThing = req.FormValue(\"otherthing\")\n}\n</code></pre>\n\n<p>This works fine till I try and parse the array.\nWhen I do something along the lines of <code>c.Captions = req.ParseForm(\"captions\")</code>\nI get the error </p>\n\n<pre><code>.cannot use req.Request.ParseForm(\"captions\") (type error) as type []ArrayText in assignment\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-app-engine-go"], "comments": [{"owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "edited": false, "score": 0, "creation_date": 1569624485, "post_id": 58140642, "comment_id": 102670136, "body": "if you&#39;re using go modules, you don&#39;t need to put your code inside $GOPATH (especially with same path as $GOROOT). Just make a <code>work&#47;</code> directory somewhere. Or name it <code>projects&#47;</code> ."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1569633330, "post_id": 58140642, "comment_id": 102671296, "body": "Does the application build locally?  What&#39;s the output of <code>go env</code>?"}, {"owner": {"reputation": 3645, "user_id": 1730966, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4dff6dbd5d9ec926ffb5266be887526f?s=128&d=identicon&r=PG", "display_name": "nibarius", "link": "https://stackoverflow.com/users/1730966/nibarius"}, "reply_to_user": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "edited": false, "score": 0, "creation_date": 1569653179, "post_id": 58140642, "comment_id": 102673563, "body": "@LaevusDexter, I&#39;m not familiar with go modules so I&#39;ll have to read up on that and try that approach if I can&#39;t get this to work."}, {"owner": {"reputation": 3645, "user_id": 1730966, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4dff6dbd5d9ec926ffb5266be887526f?s=128&d=identicon&r=PG", "display_name": "nibarius", "link": "https://stackoverflow.com/users/1730966/nibarius"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1569653214, "post_id": 58140642, "comment_id": 102673569, "body": "@CeriseLim&#243;n, the application builds and runs locally, I&#39;ve updated the question with the full <code>go env</code> output."}], "answers": [{"tags": [], "owner": {"reputation": 3645, "user_id": 1730966, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4dff6dbd5d9ec926ffb5266be887526f?s=128&d=identicon&r=PG", "display_name": "nibarius", "link": "https://stackoverflow.com/users/1730966/nibarius"}, "is_accepted": true, "score": 2, "last_activity_date": 1569704076, "creation_date": 1569704076, "answer_id": 58150232, "question_id": 58140642, "link": "https://stackoverflow.com/questions/58140642/unable-to-deploy-appengine-go-app-with-runtime-1-12-that-uses-external-libraries/58150232#58150232", "title": "Unable to deploy AppEngine Go app with runtime 1.12 that uses external libraries", "body": "<p>I managed to solve this problem in two different ways.</p>\n\n<p>The first was to copy my project outside of my $GOPATH and enable go modules like explained in <a href=\"https://www.kablamo.com.au/blog/2018/12/10/just-tell-me-how-to-use-go-modules\" rel=\"nofollow noreferrer\">this simple guide</a>. When I did this I was able to successfully deploy my application including all it's dependencies.</p>\n\n<p>I also manged to solve the problem without go modules. It turned out that it was not only my project that hadn't been touched in a very long time. My Google Cloud SDK was also severely outdated. After I updated it with <code>gcloud components update</code> I was able to deploy my application normally without any problems.</p>\n"}], "owner": {"reputation": 3645, "user_id": 1730966, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4dff6dbd5d9ec926ffb5266be887526f?s=128&d=identicon&r=PG", "display_name": "nibarius", "link": "https://stackoverflow.com/users/1730966/nibarius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 275, "favorite_count": 0, "accepted_answer_id": 58150232, "answer_count": 1, "score": 2, "last_activity_date": 1569704076, "creation_date": 1569613987, "last_edit_date": 1569653104, "question_id": 58140642, "link": "https://stackoverflow.com/questions/58140642/unable-to-deploy-appengine-go-app-with-runtime-1-12-that-uses-external-libraries", "title": "Unable to deploy AppEngine Go app with runtime 1.12 that uses external libraries", "body": "<p>I'm trying to migrate an old Google App Engine (standard environment) project written in Go to runtime 1.12. I haven't touched it since late 2017 and a lot seems to have changed since then. I've been able to sort some things out, but I fail to deploy the code since I have some external dependencies.</p>\n\n<p>Relevant parts of the console output when trying to deploy</p>\n\n<pre><code>d:\\src\\go\\src\\data-axe&gt;go env GOPATH\nd:\\src\\go\n\nd:\\src\\go\\src\\data-axe&gt;gcloud app deploy --no-promote\n...\nError type: BuildError.\nError message: 2019/09/27 19:10:09 Your app is not on your GOPATH, this build may fail.\n2019/09/27 19:10:10 Building from Go source in /tmp/staging/srv, with main package at ./...\n2019/09/27 19:10:10 Building /tmp/staging/srv, saving to /tmp/staging/usr/local/bin/start\n2019/09/27 19:10:11 Wrote build output to /builder/outputs/output\n2019/09/27 19:10:11 Failed to build app: Your app is not on your GOPATH, please move it there and try again.\n...\n err=exit status 1, out=srv/main.go:6:2: cannot find package \"github.com/microcosm-cc/bluemonday\" in any of:\n...\n</code></pre>\n\n<p>As seen in the snippet above my GOPATH is set to <code>d:\\src\\go</code>, my app is in <code>d:\\src\\go\\src\\data-axe</code> and and Bluemonday that I'm using is in <code>d:\\src\\go\\src\\github.com\\microcosm-cc\\bluemonday</code> so to my best knowledge all of this is in my GOPATH.</p>\n\n<p>The App Engine documentation for <a href=\"https://cloud.google.com/appengine/docs/standard/go112/specifying-dependencies\" rel=\"nofollow noreferrer\">specifying dependencies</a> say</p>\n\n<blockquote>\n  <p>If your application is in a directory on your GOPATH, App Engine analyzes, copies, and uploads your imports from GOPATH. This approach supports vendor directories.</p>\n</blockquote>\n\n<p>There must be something I don't understand here. I have both my code and the library I use in my GOPATH but the App Engine doesn't seem to pick up and upload my import when I try to deploy.</p>\n\n<p>The import in my main.go is using an absolute path as the documentation say it should:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"github.com/microcosm-cc/bluemonday\"\n    \"strings\"\n    \"log\"\n    \"os\"\n)\n</code></pre>\n\n<p>What am I doing wrong?</p>\n\n<hr>\n\n<p><strong>Edit</strong></p>\n\n<p>Full output of <code>go env</code>:</p>\n\n<pre><code>d:\\src\\go\\src\\data-axe&gt;go env\nset GOARCH=amd64\nset GOBIN=\nset GOCACHE=C:\\Users\\niklas\\AppData\\Local\\go-build\nset GOEXE=.exe\nset GOFLAGS=\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOOS=windows\nset GOPATH=d:\\src\\go\nset GOPROXY=\nset GORACE=\nset GOROOT=c:\\go\nset GOTMPDIR=\nset GOTOOLDIR=c:\\go\\pkg\\tool\\windows_amd64\nset GCCGO=gccgo\nset CC=gcc\nset CXX=g++\nset CGO_ENABLED=1\nset GOMOD=\nset CGO_CFLAGS=-g -O2\nset CGO_CPPFLAGS=\nset CGO_CXXFLAGS=-g -O2\nset CGO_FFLAGS=-g -O2\nset CGO_LDFLAGS=-g -O2\nset PKG_CONFIG=pkg-config\nset GOGCCFLAGS=-m64 -mthreads -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=C:\\Users\\niklas\\AppData\\Local\\Temp\\go-build168636674=/tmp/go-build -gno-record-gcc-switches\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1569612565, "creation_date": 1569612565, "answer_id": 58140461, "question_id": 58140410, "link": "https://stackoverflow.com/questions/58140410/go-time-parse-format-02-01-2006-is-valid-but-02-01-2003-not/58140461#58140461", "title": "go time.Parse, format &quot;02/01/2006&quot; is valid but &quot;02/01/2003&quot; not", "body": "<p>This is a common confusion. The date format is not an example date. Each date element is denoted by a specific number in the format. 2006 denotes the year, 02 is the day, 01 is the month. So 2003 is not part of a valid format.</p>\n"}, {"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 2, "last_activity_date": 1569612579, "creation_date": 1569612579, "answer_id": 58140465, "question_id": 58140410, "link": "https://stackoverflow.com/questions/58140410/go-time-parse-format-02-01-2006-is-valid-but-02-01-2003-not/58140465#58140465", "title": "go time.Parse, format &quot;02/01/2006&quot; is valid but &quot;02/01/2003&quot; not", "body": "<p>You have to use year 2006 in the format string.</p>\n"}, {"comments": [{"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 1, "creation_date": 1569613004, "post_id": 58140487, "comment_id": 102667381, "body": "That&#39;s not how date formatting works in go. It does not try to &quot;guess&quot; what the numbers mean, as that is very error-prone. There is <a href=\"https://godoc.org/time#pkg-constants\" rel=\"nofollow noreferrer\">a single reference date</a>, and to correctly get a date format you need to write that date in the format you want."}], "tags": [], "owner": {"reputation": 101, "user_id": 7308469, "user_type": "registered", "profile_image": "https://graph.facebook.com/1821824674697336/picture?type=large", "display_name": "Westley Bennett", "link": "https://stackoverflow.com/users/7308469/westley-bennett"}, "is_accepted": false, "score": 0, "last_activity_date": 1569612741, "creation_date": 1569612741, "answer_id": 58140487, "question_id": 58140410, "link": "https://stackoverflow.com/questions/58140410/go-time-parse-format-02-01-2006-is-valid-but-02-01-2003-not/58140487#58140487", "title": "go time.Parse, format &quot;02/01/2006&quot; is valid but &quot;02/01/2003&quot; not", "body": "<p>I think this is fairly simple, because the number 21 cannot be a month. Since it cannot be a month, the parser can deduce that it's a day. However, in your second example, \"02\" could be a month OR a day. You'll have to massage your data into a format that makes it more clear which is the day, and which is the month.</p>\n"}], "owner": {"reputation": 21022, "user_id": 348081, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fc6e3adc850c07248a46aaadc05fa59b?s=128&d=identicon&r=PG", "display_name": "JuanPablo", "link": "https://stackoverflow.com/users/348081/juanpablo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "closed_date": 1569664104, "accepted_answer_id": 58140461, "answer_count": 3, "score": -3, "last_activity_date": 1569612741, "creation_date": 1569612261, "question_id": 58140410, "link": "https://stackoverflow.com/questions/58140410/go-time-parse-format-02-01-2006-is-valid-but-02-01-2003-not", "closed_reason": "Not suitable for this site", "title": "go time.Parse, format &quot;02/01/2006&quot; is valid but &quot;02/01/2003&quot; not", "body": "<p>Why the first format is valid but the second not</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n\n    date := \"21/07/1993\"\n    in := \"02/01/2006\"\n    out := \"02-01-2006\"\n    dt, err := time.Parse(in, date)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(dt.Format(out))\n\n    date = \"21/07/1993\"\n    in = \"02/01/2003\"\n    out = \"02-01-2003\"\n    dt, err = time.Parse(in, date)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(dt.Format(out))\n}\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>21-07-1993\nparsing time \"21/07/1993\" as \"02/01/2003\": cannot parse \"93\" as \"0\"\n01-01-1012\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Ht0XZVs54ta\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Ht0XZVs54ta</a></p>\n"}, {"tags": ["mysql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 4760503, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gvi9EYKX8AE/AAAAAAAAAAI/AAAAAAAAE8Q/0t_s3ZfdlrI/photo.jpg?sz=128", "display_name": "podoglyph", "link": "https://stackoverflow.com/users/4760503/podoglyph"}, "is_accepted": false, "score": 0, "last_activity_date": 1569616860, "creation_date": 1569616860, "answer_id": 58141112, "question_id": 58140277, "link": "https://stackoverflow.com/questions/58140277/how-to-query-association-after-successful-db-save/58141112#58141112", "title": "How to query association after successful db.Save()", "body": "<p>Ok, so as it turns out I just needed to ask and then I'd figure it out on my own a few minutes later.</p>\n\n<p>I'd read about <code>Preload()</code> in the Gorm docs, but didn't know where to implement it. I first tried when the DB fired up thinking it would load the associations. But I really needed to use <code>Preload()</code> as I run the query.</p>\n\n<pre><code>result := &amp;Report{}\nif err = s.db.Preload(\"Patient\").Where(&amp;query).First(&amp;result).Error; err != nil {\n  log.WithField(\"id\", id).WithError(err).\n    Error(\"could not find report\")\n    return nil, err\n}\n</code></pre>\n\n<p>Now, the graphql query:</p>\n\n<pre><code>query {\n  report(id: \"some_id\") {\n    id\n    patient {\n      id // now it returns the id\n      birthyear // now it returns other fields, too\n      ...\n    }\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 4760503, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gvi9EYKX8AE/AAAAAAAAAAI/AAAAAAAAE8Q/0t_s3ZfdlrI/photo.jpg?sz=128", "display_name": "podoglyph", "link": "https://stackoverflow.com/users/4760503/podoglyph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 29, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569670362, "creation_date": 1569611593, "last_edit_date": 1569670362, "question_id": 58140277, "link": "https://stackoverflow.com/questions/58140277/how-to-query-association-after-successful-db-save", "title": "How to query association after successful db.Save()", "body": "<p>I am working with Gorm and Graphql. I hadn't run into problems querying data until I tried to connect two existing items using their <code>foreignkey</code> relationships. Here are my two models:</p>\n\n<pre><code>type Report struct {\n    db.Base\n    OwnerID         string\n    Patient         patients.Patient `gorm:\"association_name:Patient;\"`\n    PatientID       string\n}\ntype Patient struct {\n    db.Base\n    ReportID   string\n}\n</code></pre>\n\n<p>I have a function to save the relationship to the database:</p>\n\n<pre><code>func (s *Store) AddPatientToReport(ctx context.Context, id string, patient *patients.Patient) (*Report, error) {\n\n    // check against user using context\n\n    report, err := s.Report(ctx, id)\n    if err != nil {\n        log.Error(\"Could not find report.\")\n        return nil, err\n    }\n\n    report.PatientID = patient.ID\n\n    if err := s.db.Save(&amp;report).Association(\"Patient\").Append(patient).Error; err != nil {\n        log.WithError(err).Error(\"add patient failed\")\n        return nil, err\n    }\n\n    return report, nil\n}\n</code></pre>\n\n<p>After the above function I can query the <code>Report</code> and see the <code>patient_id</code>. I can also query the <code>Patient</code> and see the <code>report_id</code>. But the following query to get the whole <code>Patient</code> from the <code>Report</code> just returns empty.</p>\n\n<pre><code>query {\n  report(id: \"report_id\") {\n   id\n   patientID // this will return the correct patient_id\n   patient {\n     id // this field always comes back as an empty string\n   }\n  }\n}\n</code></pre>\n\n<p>Here is how the DB is setup:</p>\n\n<pre><code>// NewConn creates a new database connection\nfunc NewConn(cc ConnConf) (*Conn, error) {\n    db, err := gorm.Open(\"mysql\", cc.getCtxStr())\n    if err != nil {\n        return nil, err\n    }\n\n    // Models are loaded from each package. Patients is created before Reports.\n    if err := db.AutoMigrate(Models...).Error; err != nil {\n        log.Fatal(err)\n    }\n\n\n    db.LogMode(cc.Logger)\n\n    return &amp;Conn{db}, err\n}\n</code></pre>\n\n<p>I can't figure out how to get the whole <code>patient</code> back. Any suggestions?</p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569792691, "post_id": 58140563, "comment_id": 102701004, "body": "How can I do this <code>prefix</code> thing?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 1, "creation_date": 1569814700, "post_id": 58140563, "comment_id": 102704500, "body": "You can do: <code>if strings.HasPrefix(requestPath,value)</code> to check if <code>requestPath</code> has a prefix <code>value</code>. Make sure the <code>notAuth</code> paths end with /, otherwise any matching prefix will work. Also, <code>&#47;</code> cannot be in <code>notAuth</code> as it will let everything pass."}, {"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569835304, "post_id": 58140563, "comment_id": 102711512, "body": "It&#39;s working! But image is not opening it&#39;s downloading."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569857101, "post_id": 58140563, "comment_id": 102722940, "body": "You need to set the correct Content-Type in the response. If you set the content type to the correct image mime type, it should display the image."}, {"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569860667, "post_id": 58140563, "comment_id": 102724551, "body": "Yeah but it&#39;s already <code>w.Header().Add(&quot;Content-Type&quot;, &quot;image&#47;jpeg&quot;)</code>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569860973, "post_id": 58140563, "comment_id": 102724689, "body": "It also matters when you set that header. It should be set before sending anything to the client."}, {"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569861882, "post_id": 58140563, "comment_id": 102725075, "body": "Yeah! Postman is showing those headers. But still having this issue"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 1, "creation_date": 1569862764, "post_id": 58140563, "comment_id": 102725397, "body": "If the response has Content-Type: image/jpeg, then the client should be able to display the image. I&#39;d check if there something amiss on the client side."}, {"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569863505, "post_id": 58140563, "comment_id": 102725712, "body": "Please check! Thanks!"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569863879, "post_id": 58140563, "comment_id": 102725871, "body": "Maybe you misunderstood? I meant &quot;you should check on the client side&quot;."}, {"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569867854, "post_id": 58140563, "comment_id": 102727416, "body": "I&#39;m using postman! What should I check? I tried chrome and it&#39;s showing me the download prompt."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569868280, "post_id": 58140563, "comment_id": 102727629, "body": "This is difficult to do without the knowledge of the setting, however, you can check if there is a Content-Disposition header, that affects download behavior; you can check other headers. You can try different browsers and/or plugins and try to understand why it is downloading the image instead of displaying it."}, {"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569871014, "post_id": 58140563, "comment_id": 102728721, "body": "Okay, I&#39;ll post here! If I get something!"}, {"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1569880725, "post_id": 58140563, "comment_id": 102732236, "body": "Interesting! Mozilla is letting me show the image but chrome is not."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 0, "last_activity_date": 1569613512, "creation_date": 1569613512, "answer_id": 58140563, "question_id": 58140144, "link": "https://stackoverflow.com/questions/58140144/how-to-send-back-an-image-in-go-from-the-public-folder/58140563#58140563", "title": "How to send back an image in Go from the public folder?", "body": "<p>For #1: clearly the request path is not one of those in <code>notAuth</code>. Maybe you need to check if the path has a prefix that is included in <code>notAuth</code>? If that is so, you need to be careful about <code>/</code>, as it will pass all paths. If not, log the request path and see what the problem is.</p>\n\n<p>For #2: you should be able to do:</p>\n\n<pre><code>http.ServeFile(w,request,filepath.Join(baseDir,mux.Vars(request)[\"imageName\"])\n</code></pre>\n"}], "owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 58140563, "answer_count": 1, "score": 0, "last_activity_date": 1569613512, "creation_date": 1569610858, "question_id": 58140144, "link": "https://stackoverflow.com/questions/58140144/how-to-send-back-an-image-in-go-from-the-public-folder", "title": "How to send back an image in Go from the public folder?", "body": "<p>I'm new to go if it's an obvious question then sorry but I didn't find anything so I'm posting here.</p>\n\n<p>This is a two-part question actually.</p>\n\n<p>1) So I have this web folder in my project dir. And it is public and I have a middleware function which is checking for the JWT.</p>\n\n<p>I'm using this logic to avoid JWT auth but it's now working. I'm getting <code>unauthorized</code>.</p>\n\n<pre><code>// List of endpoints that don't require auth by an access token\n        notAuth := []string{\"/\", \"/refreshtokens\", \"/students/signup\", \"/students/signin\", \"/students/forgotpassword\",\n            \"/images\"}\n\n        // Current request path\n        requestPath := r.URL.Path\n\n        // Check if the request does not need authentication, serve the request if it doesn't need it\n        for _, value := range notAuth {\n\n            if value == requestPath {\n                next.ServeHTTP(w, r)\n                return\n            }\n        }\n</code></pre>\n\n<p>So how can I put this URL inside the array so it can escape the JWT authorization?</p>\n\n<p>2) This is how I'm making the folder public but I don't want this.</p>\n\n<pre><code>router.PathPrefix(\"/images\").Handler(http.StripPrefix(\"/images\", http.FileServer(http.Dir(\"./web/\"))))\n</code></pre>\n\n<p>What I want is something like</p>\n\n<pre><code>router.Handle(\"/image/{imageName}\",func(w http.ResponseWriter, request *http.Request){\nhttp.ServeFile(this image name file)\n})\n</code></pre>\n\n<p>So I can send back the file which is requested.</p>\n\n<p>Any help will be appreciated.</p>\n"}, {"tags": ["linux", "docker", "go", "sandbox", "linux-namespaces"], "comments": [{"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 1, "creation_date": 1569600383, "post_id": 58137996, "comment_id": 102662558, "body": "Does <code>&#47;Main</code> exist? Can you run it from a non-Go program (say, from your shell)?"}, {"owner": {"reputation": 55, "user_id": 9533194, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Hsk5ovcDlLg/AAAAAAAAAAI/AAAAAAAAACA/hVTztwF-vYg/photo.jpg?sz=128", "display_name": "Zihe Liu", "link": "https://stackoverflow.com/users/9533194/zihe-liu"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 1, "creation_date": 1569600551, "post_id": 58137996, "comment_id": 102662626, "body": "Yes, <code>&#47;Main</code> exists, which is generated from <code>main.cpp</code>. And if I remove <code>Credential: &amp;syscall.Credential{Uid: uint32(1), Gid: uint32(1)}</code>, it  works well."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1569600595, "post_id": 58137996, "comment_id": 102662651, "body": "Ahh. So, what are the permissions on the file? If it&#39;s readable only by root, then there&#39;s your answer."}, {"owner": {"reputation": 55, "user_id": 9533194, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Hsk5ovcDlLg/AAAAAAAAAAI/AAAAAAAAACA/hVTztwF-vYg/photo.jpg?sz=128", "display_name": "Zihe Liu", "link": "https://stackoverflow.com/users/9533194/zihe-liu"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1569600834, "post_id": 58137996, "comment_id": 102662746, "body": "The permissions of <code>&#47;Main</code> are <code>-rwxr-xr-x</code>, the user <code>nobody</code> should have permission to read and execute it. Even if I use <code>Credential: &amp;syscall.Credential{Uid: uint32(0), Gid: uint32(0)}</code>, the same error occurs. Maybe it has no permission to change uid, but I can not figure out the reason."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1569601046, "post_id": 58137996, "comment_id": 102662845, "body": "Smells plausible. Which syscall does <code>strace</code> or <a href=\"https://sysdig.com\" rel=\"nofollow noreferrer\">sysdig</a> say is failing?"}, {"owner": {"reputation": 55, "user_id": 9533194, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Hsk5ovcDlLg/AAAAAAAAAAI/AAAAAAAAACA/hVTztwF-vYg/photo.jpg?sz=128", "display_name": "Zihe Liu", "link": "https://stackoverflow.com/users/9533194/zihe-liu"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 1, "creation_date": 1569604576, "post_id": 58137996, "comment_id": 102664292, "body": "According to the recommendations, I traced the source code of cmd.Run() and  found that <code>cmd.SysProcAttr.GidMappingsEnableSetgroups</code>: <code>GidMappingsEnableSetgroups enabling setgroups syscall. If false, then setgroups syscall will be disabled for the child process.</code>. As a result, after I set cmd.SysProcAttr.GidMappingsEnableSetgroups as true, it works! Thanks very much!"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 1, "creation_date": 1569612097, "post_id": 58137996, "comment_id": 102667141, "body": "Glad to hear you have a solution! Since you did all the work to verify that, go ahead and add your own answer to that effect; you&#39;ll be able to accept it in a few days (there&#39;s a delay on accepting self-answers); that way, the question will show up as solved, and you&#39;ll get reputation points from any folks who indicate that the answer was helpful to them."}], "answers": [{"tags": [], "owner": {"reputation": 55, "user_id": 9533194, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Hsk5ovcDlLg/AAAAAAAAAAI/AAAAAAAAACA/hVTztwF-vYg/photo.jpg?sz=128", "display_name": "Zihe Liu", "link": "https://stackoverflow.com/users/9533194/zihe-liu"}, "is_accepted": true, "score": 0, "last_activity_date": 1569748453, "creation_date": 1569748453, "answer_id": 58153865, "question_id": 58137996, "link": "https://stackoverflow.com/questions/58137996/exec-command-with-credential-in-a-new-user-namespace-gets-error-operation-not/58153865#58153865", "title": "exec.Command with Credential in a new user namespace gets error: &quot;operation not permitted&quot;", "body": "<p>According to recommendations from @Charles Duffy, I traced the source code of <code>cmd.Run()</code> and found that:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\ntype SysProcAttr struct {\n    UidMappings  []SysProcIDMap // User ID mappings for user namespaces.\n    GidMappings  []SysProcIDMap // Group ID mappings for user namespaces.\n    // GidMappingsEnableSetgroups enabling setgroups syscall.\n    // If false, then setgroups syscall will be disabled for the child process.\n    // This parameter is no-op if GidMappings == nil. Otherwise for unprivileged\n    // users this should be set to false for mappings work.\n    GidMappingsEnableSetgroups bool\n}\n</code></pre>\n\n<p>Thus, if the value of <code>GidMappingsEnableSetgroups</code> is <code>false</code> as default, the child process <code>justiceInit</code> will have no permission to use <code>setgroups</code> syscall regardless of whether it has root privileges. </p>\n\n<p>As a result, when I set <code>cmd.SysProcAttr.GidMappingsEnableSetgroups</code> as <code>true</code> in the function <code>main</code> as follows, it works!</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>cmd.Stdin = os.Stdin\ncmd.Stdout = os.Stdout\ncmd.Stderr = os.Stderr\ncmd.SysProcAttr = &amp;syscall.SysProcAttr{\n    // ...\n    GidMappingsEnableSetgroups: true,\n}\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 9533194, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Hsk5ovcDlLg/AAAAAAAAAAI/AAAAAAAAACA/hVTztwF-vYg/photo.jpg?sz=128", "display_name": "Zihe Liu", "link": "https://stackoverflow.com/users/9533194/zihe-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 732, "favorite_count": 0, "accepted_answer_id": 58153865, "answer_count": 1, "score": 0, "last_activity_date": 1569748453, "creation_date": 1569600146, "last_edit_date": 1569600712, "question_id": 58137996, "link": "https://stackoverflow.com/questions/58137996/exec-command-with-credential-in-a-new-user-namespace-gets-error-operation-not", "title": "exec.Command with Credential in a new user namespace gets error: &quot;operation not permitted&quot;", "body": "<p>I'd like to implement a simple sandbox using Linux namespace and Go to execute command. \nIn order to prevent the command from writing to disk, the command is executed as another user using <code>Credential: &amp;syscall.Credential{Uid: uint32(1), Gid: uint32(1)}</code>. </p>\n\n<p>However, I got this error: \"fork/exec /Main: operation not permitted\".</p>\n\n<p>Even if I change code to <code>Credential: &amp;syscall.Credential{Uid: uint32(0), Gid: uint32(0)}</code>, the same error occurred.</p>\n\n<p>The container.go is as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// +build linux\n// +build go1.12\n\npackage main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    uuid \"github.com/satori/go.uuid\"\n    \"io/ioutil\"\n    \"os\"\n    \"os/exec\"\n    \"os/user\"\n    \"path/filepath\"\n    \"strconv\"\n    \"strings\"\n    \"syscall\"\n    \"time\"\n\n    \"github.com/ZiheLiu/sandbox/sandbox\"\n    \"github.com/docker/docker/pkg/reexec\"\n)\n\nfunc init() {\n    // register \"justiceInit\" =&gt; justiceInit() every time\n    reexec.Register(\"justiceInit\", justiceInit)\n\n    /**\n    * 0. `init()` adds key \"justiceInit\" in `map`;\n    * 1. reexec.Init() seeks if key `os.Args[0]` exists in `registeredInitializers`;\n    * 2. for the first time this binary is invoked, the key is os.Args[0], AKA \"/path/to/clike_container\",\n         which `registeredInitializers` will return `false`;\n    * 3. `main()` calls binary itself by reexec.Command(\"justiceInit\", args...);\n    * 4. for the second time this binary is invoked, the key is os.Args[0], AKA \"justiceInit\",\n    *    which exists in `registeredInitializers`;\n    * 5. the value `justiceInit()` is invoked, any hooks(like set hostname) before fork() can be placed here.\n    */\n    if reexec.Init() {\n        os.Exit(0)\n    }\n}\n\nfunc justiceInit() {\n    command := os.Args[1]\n    timeout, _ := strconv.ParseInt(os.Args[2], 10, 32)\n\n    cmd := exec.Command(command)\n    cmd.Stdin = os.Stdin\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    // set uid and gid as another user\n    cmd.SysProcAttr = &amp;syscall.SysProcAttr{\n        Setpgid: true,\n        Credential: &amp;syscall.Credential{Uid: uint32(1), Gid: uint32(1)},\n    }\n    cmd.Env = []string{\"PS1=[justice] # \"}\n\n    // got the error \"fork/exec /Main: operation not permitted\" here\n    if err := cmd.Run(); err != nil {\n        _, _ = os.Stderr.WriteString(fmt.Sprintf(\"%s\\n\", err.Error()))\n    }\n}\n\n// logs will be printed to os.Stderr\nfunc main() {\n    command := flag.String(\"command\", \"./Main\", \"the command needed to be execute in sandbox\")\n    username := flag.String(\"username\", \"root\", \"the user to execute command\")\n    flag.Parse()\n\n    u, err := user.Lookup(*username)\n    if err != nil {\n        _, _ = os.Stderr.WriteString(fmt.Sprintf(\"%s\\n\", err.Error()))\n        os.Exit(0)\n    }\n    uid, _ := strconv.Atoi(u.Uid)\n    gid, _ := strconv.Atoi(u.Gid)\n\n    cmd := reexec.Command(\"justiceInit\", *basedir, *command, *timeout)\n    cmd.Stdin = os.Stdin\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    cmd.SysProcAttr = &amp;syscall.SysProcAttr{\n        Cloneflags: syscall.CLONE_NEWNS |\n            syscall.CLONE_NEWUTS |\n            syscall.CLONE_NEWIPC |\n            syscall.CLONE_NEWPID |\n            syscall.CLONE_NEWNET |\n            syscall.CLONE_NEWUSER,\n        UidMappings: []syscall.SysProcIDMap{\n            {\n                ContainerID: 0,\n                HostID:      os.Getuid(),\n                Size:        1,\n            },\n            {\n                ContainerID: 1,\n                HostID:      uid,\n                Size:        1,\n            },\n        },\n        GidMappings: []syscall.SysProcIDMap{\n            {\n                ContainerID: 0,\n                HostID:      os.Getgid(),\n                Size:        1,\n            },\n            {\n                ContainerID: 1,\n                HostID:      gid,\n                Size:        1,\n            },\n        },\n    }\n\n    if err := cmd.Run(); err != nil {\n        _, _ = os.Stderr.WriteString(fmt.Sprintf(\"%s\\n\", err.Error()))\n    }\n\n    os.Exit(0)\n}\n\n</code></pre>\n\n<p>When I run <code>sudo ./container -command='/Main' -username='nobody'</code>, the error \"fork/exec /Main: operation not permitted\" occurred.</p>\n\n<p>The user in the user namespace of <code>justiceInit</code> should be the root, but it can not set uid and gid using <code>Credential</code>.</p>\n\n<p>I'm a new hand of linux and namespace. Maybe I misunderstand something. How should I fix this error? Thanks very much!</p>\n"}, {"tags": ["string", "templates", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1569598265, "post_id": 58137433, "comment_id": 102661554, "body": "No. Backtick literals have no escaping support whatsoever. Interrupting the literal like you&#39;ve done in your question is one way to do it, and fmt.Sprintf is another option."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1569598516, "post_id": 58137433, "comment_id": 102661672, "body": "Split string on lines, escape each line with <a href=\"https://godoc.org/strconv#Quote\" rel=\"nofollow noreferrer\">godoc.org/strconv#Quote</a> and join with <code>+</code>."}], "owner": {"reputation": 13358, "user_id": 3878940, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/v1J2L.jpg?s=128&g=1", "display_name": "Aditya Singh", "link": "https://stackoverflow.com/users/3878940/aditya-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "closed_date": 1569599385, "answer_count": 0, "score": 0, "last_activity_date": 1569599341, "creation_date": 1569597950, "last_edit_date": 1569599341, "question_id": 58137433, "link": "https://stackoverflow.com/questions/58137433/how-to-add-backtick-in-a-multiline-string-in-go", "closed_reason": "Duplicate", "title": "How to add backtick in a multiline string in Go?", "body": "<p>I have a go application reading content from a Markdown file and adding it to a go template file.</p>\n\n<pre><code>var tmpl = template.Must(template.New(\"\").Parse(`//Code generated by go generate\n//Please don't change\n\npackage cmd\n\nvar fooTemplate = ` + \"`\" + `{{ .FileName }}` + \"`\"))\n</code></pre>\n\n<p>and the markdown file has content</p>\n\n<pre><code>## Title\nFoo bar\n\n## Description\nThis is a dummy description using `go` language\n</code></pre>\n\n<p>The problem is that the markdown syntax has backticks and so the generated go file is broken in syntax. This syntax works here in SO because of the use of triple backticks(```) but doesn't while generating the go file. </p>\n\n<p>Is it possible to create a go file with backticks inside the multiline string by escaping them?</p>\n"}, {"tags": ["go", "go-modules", "gopath"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1569596725, "post_id": 58137092, "comment_id": 102660837, "body": "You could run <code>go get</code> from a different directory, but know that go will re-download it if you want to use it in your go modules project (since dependencies are stored at a different path)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1569599850, "post_id": 58137092, "comment_id": 102662302, "body": "Why do you want to install it in GOPATH if you&#39;re using modules? If it&#39;s for local development, just clone the repo (which can be done into the old GOPATH of course)"}, {"owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "edited": false, "score": 0, "creation_date": 1569605175, "post_id": 58137092, "comment_id": 102664511, "body": "I don&#39;t think it&#39;s unrealistic use-case. I&#39;ve faced it a couple of times already: I am working on something and at the same time I want to install go program that would be accessible as a command-line tool."}, {"owner": {"reputation": 163, "user_id": 11869461, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tNYETRt85Vc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reswQ_iiZbSbtY0EpXqOvZxksDFVQ/photo.jpg?sz=128", "display_name": "ialam", "link": "https://stackoverflow.com/users/11869461/ialam"}, "edited": false, "score": 0, "creation_date": 1569699811, "post_id": 58137092, "comment_id": 102683438, "body": "Please share the output after running <b>go env</b> command from the directory where go.mod file is there."}, {"owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "edited": false, "score": 0, "creation_date": 1569777336, "post_id": 58137092, "comment_id": 102697554, "body": "I&#39;ve added <code>go env</code> output."}], "answers": [{"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": false, "score": 0, "last_activity_date": 1584041922, "creation_date": 1584041922, "answer_id": 60660872, "question_id": 58137092, "link": "https://stackoverflow.com/questions/58137092/installing-a-package-to-gopath-in-directory-with-go-mod/60660872#60660872", "title": "Installing a package to GOPATH in directory with go.mod", "body": "<p>The variable is named <code>GO111MODULE</code> (with a letter <code>O</code>), not <code>G0111MODULE</code> (with a number <code>0</code>).</p>\n"}], "owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1142, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1584041922, "creation_date": 1569596631, "last_edit_date": 1569777318, "question_id": 58137092, "link": "https://stackoverflow.com/questions/58137092/installing-a-package-to-gopath-in-directory-with-go-mod", "title": "Installing a package to GOPATH in directory with go.mod", "body": "<p>I would like to install a package to <code>GOPATH</code> using <code>go get</code>. This became tricky with go tooling migrated to go mod support.</p>\n\n<p>There is no problem outside of the project directory (=directory with go.mod file). In the project directory, I would expect setting <code>G0111MODULE</code> variable should do the job but it doesn't.</p>\n\n<pre><code>G0111MODULE=off go get &lt;package name&gt;\n</code></pre>\n\n<p>How I can install a package to <code>GOPATH</code> within a directory containing <code>go.mod</code> file? \nThank you.</p>\n\n<p><code>go env</code> output:</p>\n\n<pre><code>GO111MODULE=\"on\"\nGOARCH=\"amd64\"\nGOBIN=\"\"\nGOCACHE=\"/Users/zb/Library/Caches/go-build\"\nGOENV=\"/Users/zb/Library/Application Support/go/env\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGONOPROXY=\"\"\nGONOSUMDB=\"\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/zb/dev/go\"\nGOPRIVATE=\"\"\nGOPROXY=\"https://proxy.golang.org,direct\"\nGOROOT=\"/usr/local/Cellar/go/1.13/libexec\"\nGOSUMDB=\"sum.golang.org\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/Cellar/go/1.13/libexec/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nAR=\"ar\"\nCC=\"clang\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"/Users/zb/dev/mycopmany/links/go.mod\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/gf/8xg53y0j2h9d3k5g3_vvvw9m0000gn/T/go-build248955952=/tmp/go-build -gno-record-gcc-switches -fno-common\"\n</code></pre>\n"}, {"tags": ["go", "ffmpeg"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1569596323, "post_id": 58136758, "comment_id": 102660628, "body": "have you tried to close stdin after fill ? Otherwise it closes after Wait(), so if ffmpeg waits for its stdin to close before proceeding further, you will be blocked while reading its stdout."}, {"owner": {"reputation": 1, "user_id": 12131264, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAz3IEh_ASyMfaclAn8fJqphlfBUGZK1lW2GmgW5Q=k-s128", "display_name": "haxmat", "link": "https://stackoverflow.com/users/12131264/haxmat"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1569596707, "post_id": 58136758, "comment_id": 102660828, "body": "@mh-cbon I have tried that (still stalls), thankfully now ffmpeg is saying it can&#39;t output to pipe:1 so the problem has to be something to do with stdout"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1569611308, "post_id": 58136758, "comment_id": 102666893, "body": "try creating output.mpg before cmd.Start, and run <code>io.Copy(fo,stdout)</code> in a goroutine."}, {"owner": {"reputation": 1, "user_id": 12131264, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAz3IEh_ASyMfaclAn8fJqphlfBUGZK1lW2GmgW5Q=k-s128", "display_name": "haxmat", "link": "https://stackoverflow.com/users/12131264/haxmat"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1569616292, "post_id": 58136758, "comment_id": 102668213, "body": "@bserdar changing when creating the file means the file actually gets created (yippee) and running io.copy whether in a goroutine or not still leads to a stall. When i exit out of ffmpeg i get <code>av_interleaved_write_frame(): Invalid argument Error writing trailer of pipe:1: Invalid argument</code> so i&#39;m inclined to believe it&#39;s something to do with ffmpeg"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1569633367, "post_id": 58136758, "comment_id": 102671297, "body": "Did you start the reader goroutine before wrting the input to the pipe?"}, {"owner": {"reputation": 1, "user_id": 12131264, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAz3IEh_ASyMfaclAn8fJqphlfBUGZK1lW2GmgW5Q=k-s128", "display_name": "haxmat", "link": "https://stackoverflow.com/users/12131264/haxmat"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1569659691, "post_id": 58136758, "comment_id": 102674611, "body": "@bserdar found the fix. i had to run the stdinfill in a goroutine."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12131264, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAz3IEh_ASyMfaclAn8fJqphlfBUGZK1lW2GmgW5Q=k-s128", "display_name": "haxmat", "link": "https://stackoverflow.com/users/12131264/haxmat"}, "is_accepted": false, "score": 0, "last_activity_date": 1569659729, "creation_date": 1569659729, "answer_id": 58144674, "question_id": 58136758, "link": "https://stackoverflow.com/questions/58136758/exec-ffmpeg-stdout-pipe-stalling/58144674#58144674", "title": "exec ffmpeg stdout pipe stalling", "body": "<p>Running stdinfill in a goroutine fixed the issue.</p>\n"}], "owner": {"reputation": 1, "user_id": 12131264, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAz3IEh_ASyMfaclAn8fJqphlfBUGZK1lW2GmgW5Q=k-s128", "display_name": "haxmat", "link": "https://stackoverflow.com/users/12131264/haxmat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 521, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569659729, "creation_date": 1569595333, "last_edit_date": 1569599432, "question_id": 58136758, "link": "https://stackoverflow.com/questions/58136758/exec-ffmpeg-stdout-pipe-stalling", "title": "exec ffmpeg stdout pipe stalling", "body": "<p>I've been trying to get the exec stdoutpipe from ffmpeg and write it into a different file. However, it stalls and doesn't finish executing the command. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc stdinfill(stdin io.WriteCloser) {\n    fi, err := ioutil.ReadFile(\"music.ogg\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    io.Copy(stdin, bytes.NewReader(fi))\n}\n\nfunc main() {\n    runcommand()\n}\n\nfunc runcommand() {\n\n    cmd := exec.Command(\"ffmpeg\", \"-i\", \"pipe:0\", \"-f\", \"mp3\", \"pipe:1\")\n    stdin, err := cmd.StdinPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    cmd.Stderr = os.Stderr\n\n    err = cmd.Start()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    stdinfill(stdin)\n\n    fo, err := os.Create(\"output.mp3\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    io.Copy(fo, stdout)\n\n    defer fo.Close()\n\n    err = cmd.Wait()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n}\n</code></pre>\n\n<p>does anyone have any ideas? It starts running ffmpeg but just stalls.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 292363, "user_id": 37213, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/eeec80237213c91e5bab56b77ac5b8ca?s=128&d=identicon&r=PG", "display_name": "duffymo", "link": "https://stackoverflow.com/users/37213/duffymo"}, "edited": false, "score": 4, "creation_date": 1569593641, "post_id": 58136215, "comment_id": 102659163, "body": "GoF design patterns are common solutions to problems in object-oriented programming.  Some people, like functional programmers, would say that these are band aids on flaws in the OOP idiom.  Do you need them in Go?  <a href=\"https://flaviocopes.com/golang-is-go-object-oriented/\" rel=\"nofollow noreferrer\">flaviocopes.com/golang-is-go-object-oriented</a>"}, {"owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 1, "creation_date": 1569596912, "post_id": 58136215, "comment_id": 102660927, "body": "I understand from where you come from, I think each of us went through the GoF indoctrination. Then a revival of Functional Programming showed that patterns (and OO) are highly overrated. And as other answers mention, Go is not a language adapted to classic OO. The best I can suggest is to go through documentation such as A tour of Go, Effective Go, Go by Example and walk enough in Go shoes to become disintoxicated :-) It takes time, it is worth it. Embrace Go, do not try to bend Go to what Go is not."}, {"owner": {"reputation": 1925, "user_id": 433717, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dab73f2c115bc0dc8f0d39e271eec30?s=128&d=identicon&r=PG&f=1", "display_name": "belteshazzar", "link": "https://stackoverflow.com/users/433717/belteshazzar"}, "reply_to_user": {"reputation": 292363, "user_id": 37213, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/eeec80237213c91e5bab56b77ac5b8ca?s=128&d=identicon&r=PG", "display_name": "duffymo", "link": "https://stackoverflow.com/users/37213/duffymo"}, "edited": false, "score": 0, "creation_date": 1569655484, "post_id": 58136215, "comment_id": 102673935, "body": "@duffymo marco-m: Alright. Thanks."}, {"owner": {"reputation": 1925, "user_id": 433717, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dab73f2c115bc0dc8f0d39e271eec30?s=128&d=identicon&r=PG&f=1", "display_name": "belteshazzar", "link": "https://stackoverflow.com/users/433717/belteshazzar"}, "edited": false, "score": 0, "creation_date": 1572103127, "post_id": 58136215, "comment_id": 103460761, "body": "By the way, design patterns are not programming paradigm specific. MVC, Observer and Strategy can be implemented in any programming paradigm. OOP was itself a &quot;design pattern&quot; and was implemented in C and others waay before C++ and Java came along."}, {"owner": {"reputation": 933, "user_id": 2536112, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/zIv5h.jpg?s=128&g=1", "display_name": "Ashwin Shirva", "link": "https://stackoverflow.com/users/2536112/ashwin-shirva"}, "edited": false, "score": 0, "creation_date": 1591627543, "post_id": 58136215, "comment_id": 110120295, "body": "As suggested by other, design patterns are not an absolute necessity in go, and cant be exactly emulated as it is not purely an OOP language. But if you are still looking for references, this one might help: <a href=\"https://github.com/ashwinshirva/api/tree/master/dp\" rel=\"nofollow noreferrer\">github.com/ashwinshirva/api/tree/master/dp</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1925, "user_id": 433717, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dab73f2c115bc0dc8f0d39e271eec30?s=128&d=identicon&r=PG&f=1", "display_name": "belteshazzar", "link": "https://stackoverflow.com/users/433717/belteshazzar"}, "edited": false, "score": 0, "creation_date": 1569655505, "post_id": 58136604, "comment_id": 102673937, "body": "I&#39;ll have a look. Thank you."}], "tags": [], "owner": {"reputation": 179, "user_id": 4718921, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58c07e4f74942d3e358b307d23a057e3?s=128&d=identicon&r=PG&f=1", "display_name": "Muhamed Keta", "link": "https://stackoverflow.com/users/4718921/muhamed-keta"}, "is_accepted": true, "score": 2, "last_activity_date": 1569594734, "creation_date": 1569594734, "answer_id": 58136604, "question_id": 58136215, "link": "https://stackoverflow.com/questions/58136215/design-patterns-in-go/58136604#58136604", "title": "Design Patterns in Go", "body": "<p>Go doesn't do OOP, so technically GoF design patterns look weird. </p>\n\n<p>I have seen some repos that try to emulate those in a way (a quick search got me <a href=\"https://github.com/bvwells/go-patterns\" rel=\"nofollow noreferrer\">https://github.com/bvwells/go-patterns</a> and <a href=\"https://github.com/tmrts/go-patterns\" rel=\"nofollow noreferrer\">https://github.com/tmrts/go-patterns</a>). I have tried before using factory pattern on some db code and now I am doing something that is MVC-like, but it doesn't feel totally idiomatic.</p>\n\n<p>You can try doing these for fun or just to learn, however don't start with the file structure and stuff when you code.</p>\n"}], "owner": {"reputation": 1925, "user_id": 433717, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dab73f2c115bc0dc8f0d39e271eec30?s=128&d=identicon&r=PG&f=1", "display_name": "belteshazzar", "link": "https://stackoverflow.com/users/433717/belteshazzar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 427, "favorite_count": 0, "closed_date": 1569595258, "accepted_answer_id": 58136604, "answer_count": 1, "score": -3, "last_activity_date": 1569594734, "creation_date": 1569593326, "question_id": 58136215, "link": "https://stackoverflow.com/questions/58136215/design-patterns-in-go", "closed_reason": "Not suitable for this site", "title": "Design Patterns in Go", "body": "<p>How would one go about implementing Observer, Strategy and an MVC file structure in Go?</p>\n\n<p>Is there a book or website that teaches how to implement these three and hopefully most of the \"gang-of-four\" design patterns?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1569588532, "post_id": 58134609, "comment_id": 102656513, "body": "Defining structs for the messages (or groups of similar messages) is the way to do it in Go. If those format strings are fixed (and not, say, computed at runtime), consider generating the Go types and parse functions (or at least the bulk of it)."}, {"owner": {"reputation": 31, "user_id": 2158583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ef2cf656932630b5acc44f83cf0732?s=128&d=identicon&r=PG", "display_name": "user2158583", "link": "https://stackoverflow.com/users/2158583/user2158583"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1569607301, "post_id": 58134609, "comment_id": 102665379, "body": "Thank you ... the formats are fixed, so there should be no problem creating at least the basis of the structure code programatically.. It just feels un-elegant ..."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1569767460, "post_id": 58134609, "comment_id": 102695018, "body": "Well, create a library. like <code>php-pack-go</code>. ;)"}], "owner": {"reputation": 31, "user_id": 2158583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ef2cf656932630b5acc44f83cf0732?s=128&d=identicon&r=PG", "display_name": "user2158583", "link": "https://stackoverflow.com/users/2158583/user2158583"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1569599466, "creation_date": 1569587459, "last_edit_date": 1569599466, "question_id": 58134609, "link": "https://stackoverflow.com/questions/58134609/phps-pack-unpack-in-go", "title": "PHP&#39;s pack/unpack in Go", "body": "<p>I'm intending to rewrite a game server I already have working in PHP-cli.</p>\n\n<p>As I cannot touch the client, I have to use the on-wire protocol as-is.  This is a pure binary format, with multiple fields per packet.  I use a modified version of PHP's pack/unpack commands to convert to and from this.  A packet is generally in the form:</p>\n\n<h3>header:</h3>\n\n<pre><code>unpack('nitem/ncmdNum/NdataLen', $buf);\n</code></pre>\n\n<h3>data:</h3>\n\n<p>any of several dozen subsequent unpack strings, as identified by cmdNum. e.g.:</p>\n\n<ul>\n<li><p><code>a32first_name/a32second_name/a32third_name/nfirst_itemid/nfirst_flags/nfirst_level/nunused/Nfirst_perm_flags/Ncvsize/a{$cvsize}contentsVector</code></p></li>\n<li><p><code>nsuccess/ndummyfielda/a*xerror_msg/a*xtext/NcurrentVersion/NtimeLimit/a*xlimitValue/a*xlimit</code></p></li>\n</ul>\n\n<p>[Where <code>a{$cvsize}</code> means a fixed length string determined by the named (usually immediately previous) value, and a* means a zero-terminated variable-length string.. ]</p>\n\n<p>The current PHP implementation unpacks this and calls the a function that deals with command 'cmdNum' passing an associative array containing the unpacked data. This in turn calls the sending code with a similar array for the return values.</p>\n\n<p>Whilst I'm sure I could map these to structures, reading from the input (and writing to it) wouldn't simply be a matter of dropping the buffer over the struct.  Plus, most packet types are only used once, in a function dedicated to dealing with that message, so coding up several dozen structures, and the code to deal with loading each field individually, seems like a lot of work.</p>\n\n<p>Is there any method or package that I can use as the basis for dealing with this sort of thing?  My searching for \"php unpack in go\" only seems to return results based on people unpacking a single numerical value, which is obviously easy enough to replace with encoding/binary!</p>\n\n<p>The unpack/pack strings are auto-generated by some other PHP based on a specification grabbed from the client, so I could change that to create a different format fairly easily, if there is something I can use.  I'd normally have no issues with writing my own functions to do this sort of thing, but being totally new to Go, this might be too much off-the-bat.</p>\n"}, {"tags": ["go", "amazon-s3", "aws-lambda", "handler"], "answers": [{"comments": [{"owner": {"reputation": 493, "user_id": 1125133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/208e578f641b294689b75887704bc790?s=128&d=identicon&r=PG", "display_name": "David Fulton", "link": "https://stackoverflow.com/users/1125133/david-fulton"}, "edited": false, "score": 4, "creation_date": 1572626724, "post_id": 58135074, "comment_id": 103628904, "body": "While it wasn&#39;t a problem in this example, I think it might be worth pointing out that the executable has to be called &quot;main&quot;, not just the function in the code.  I found this out the hard way when following the instructions above."}, {"owner": {"reputation": 439, "user_id": 6473645, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tutc5.png?s=128&g=1", "display_name": "Pooja K Bhatt", "link": "https://stackoverflow.com/users/6473645/pooja-k-bhatt"}, "reply_to_user": {"reputation": 493, "user_id": 1125133, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/208e578f641b294689b75887704bc790?s=128&d=identicon&r=PG", "display_name": "David Fulton", "link": "https://stackoverflow.com/users/1125133/david-fulton"}, "edited": false, "score": 0, "creation_date": 1572949071, "post_id": 58135074, "comment_id": 103712340, "body": "Yes you are right, that the executable has to be called &quot;main&quot;, not just the function in the code."}], "tags": [], "owner": {"reputation": 439, "user_id": 6473645, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tutc5.png?s=128&g=1", "display_name": "Pooja K Bhatt", "link": "https://stackoverflow.com/users/6473645/pooja-k-bhatt"}, "is_accepted": false, "score": 12, "last_activity_date": 1605507000, "last_edit_date": 1605507000, "creation_date": 1569589109, "answer_id": 58135074, "question_id": 58133166, "link": "https://stackoverflow.com/questions/58133166/getting-error-fork-exec-var-task-main-no-such-file-or-directory-while-execut/58135074#58135074", "title": "Getting error &quot;fork/exec /var/task/main: no such file or directory&quot; while executing aws-lambda function", "body": "<p>Run following commands in command prompt</p>\n<pre><code>set GOOS=linux\nset GOARCH=amd64\nset CGO_ENABLED=0\n</code></pre>\n<p>After this , build your project and upload zip file to aws console lambda</p>\n<p>like this</p>\n<p><code>GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -o main main.go</code></p>\n<p>Reference Link : <a href=\"https://github.com/aws/aws-lambda-go\" rel=\"noreferrer\">https://github.com/aws/aws-lambda-go</a></p>\n"}, {"comments": [{"owner": {"reputation": 315, "user_id": 6635453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f8d2a834296986b4c7fbfade987231d?s=128&d=identicon&r=PG&f=1", "display_name": "Conor", "link": "https://stackoverflow.com/users/6635453/conor"}, "edited": false, "score": 1, "creation_date": 1607816018, "post_id": 59671420, "comment_id": 115392766, "body": "using the standard serverless framework boiler code, this solves the error"}], "tags": [], "owner": {"reputation": 905, "user_id": 3002244, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003895341884/picture?type=large", "display_name": "Wishmaster", "link": "https://stackoverflow.com/users/3002244/wishmaster"}, "is_accepted": false, "score": 8, "last_activity_date": 1578600650, "creation_date": 1578600650, "answer_id": 59671420, "question_id": 58133166, "link": "https://stackoverflow.com/questions/58133166/getting-error-fork-exec-var-task-main-no-such-file-or-directory-while-execut/59671420#59671420", "title": "Getting error &quot;fork/exec /var/task/main: no such file or directory&quot; while executing aws-lambda function", "body": "<p>There are two reasons can happen:</p>\n\n<ol>\n<li><p>You did't use <strong>GOOS=linux GOARCH=amd64</strong> with go build, so try:</p>\n\n<p>GOOS=linux GOARCH=amd64 go build -o main main.go</p></li>\n<li><p>You used to build this programm some CI function with golang-alpine base image, so try to use full golang image instead.</p></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 1041, "user_id": 6150999, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/dKcy6.png?s=128&g=1", "display_name": "Poh Zi How", "link": "https://stackoverflow.com/users/6150999/poh-zi-how"}, "edited": false, "score": 1, "creation_date": 1606121877, "post_id": 62800898, "comment_id": 114854205, "body": "this can now be found under &quot;Runtime Settings&quot;"}], "tags": [], "owner": {"reputation": 161, "user_id": 5628106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/288be6f829d30f3727da4a6405646073?s=128&d=identicon&r=PG&f=1", "display_name": "mch.zawalski", "link": "https://stackoverflow.com/users/5628106/mch-zawalski"}, "is_accepted": false, "score": 15, "last_activity_date": 1594231215, "creation_date": 1594231215, "answer_id": 62800898, "question_id": 58133166, "link": "https://stackoverflow.com/questions/58133166/getting-error-fork-exec-var-task-main-no-such-file-or-directory-while-execut/62800898#62800898", "title": "Getting error &quot;fork/exec /var/task/main: no such file or directory&quot; while executing aws-lambda function", "body": "<p>In my case the problem was default setted handler to '<strong>hello</strong>' function.</p>\n<p>Needed to change it to '<strong>main</strong>' via AWS Lambda view panel -&gt; Basic Settings -&gt; Edit.</p>\n<p><a href=\"https://i.stack.imgur.com/0yTU4.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/0yTU4.png\" alt=\"AWS Lambda function\" /></a></p>\n"}, {"comments": [{"owner": {"reputation": 135, "user_id": 6939269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6yiAE.jpg?s=128&g=1", "display_name": "coder kemp", "link": "https://stackoverflow.com/users/6939269/coder-kemp"}, "edited": false, "score": 0, "creation_date": 1611145503, "post_id": 63950649, "comment_id": 116355205, "body": "Naming the Handler in AWS lambda function &#39;Handler&#39; is a important step, once the steps mentioned above have been followed."}], "tags": [], "owner": {"reputation": 83, "user_id": 5502503, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Carxf.jpg?s=128&g=1", "display_name": "Psp360", "link": "https://stackoverflow.com/users/5502503/psp360"}, "is_accepted": false, "score": 6, "last_activity_date": 1600411852, "creation_date": 1600411852, "answer_id": 63950649, "question_id": 58133166, "link": "https://stackoverflow.com/questions/58133166/getting-error-fork-exec-var-task-main-no-such-file-or-directory-while-execut/63950649#63950649", "title": "Getting error &quot;fork/exec /var/task/main: no such file or directory&quot; while executing aws-lambda function", "body": "<p>Recently I was facing similar issue, and I solved it. As the error says it s finding executable with handle name, so you should name your executable same as handler.</p>\n<p>Follow these steps and your will not get this error, I am using PowerShell</p>\n<pre><code>&gt; go.exe get -u github.com/aws/aws-lambda-go/cmd/build-lambda-zip # If you do not this have utility earlier\n&gt; $env:GOOS = &quot;linux&quot;\n&gt; $env:GOARCH = &quot;amd64&quot;\n&gt; $env:CGO_ENABLED = &quot;0&quot;\n&gt; go build -o .\\Handler .\\main.go # considering your are in the same directory where your main.go or handler code is present\n&gt; ~\\Go\\Bin\\build-lambda-zip.exe -o .\\Handler.zip .\\Handler\n</code></pre>\n<p>Upload this code, and change handler name to Handler(name of the executable that you created above)\n<a href=\"https://i.stack.imgur.com/MfgzW.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/MfgzW.png\" alt=\"enter image description here\" /></a></p>\n<p>Let me know if this helps.</p>\n"}, {"tags": [], "owner": {"reputation": 689, "user_id": 5501996, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh6.googleusercontent.com/-Iillv5DgY_Q/AAAAAAAAAAI/AAAAAAAADIo/A342SSD0Cy8/photo.jpg?sz=128", "display_name": "yoges nsamy", "link": "https://stackoverflow.com/users/5501996/yoges-nsamy"}, "is_accepted": false, "score": 0, "last_activity_date": 1601614785, "creation_date": 1601614785, "answer_id": 64166371, "question_id": 58133166, "link": "https://stackoverflow.com/questions/58133166/getting-error-fork-exec-var-task-main-no-such-file-or-directory-while-execut/64166371#64166371", "title": "Getting error &quot;fork/exec /var/task/main: no such file or directory&quot; while executing aws-lambda function", "body": "<p>In my case it was related to my Go setting.</p>\n<p>As I use Go Version Manager, I had to run the following to specify the right Go path before compiling my project.</p>\n<pre><code>gvm use go1.x.x\n</code></pre>\n<p>Proceed to compile then deploy.</p>\n"}, {"tags": [], "owner": {"reputation": 535, "user_id": 12370337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eab593365a62cd02a8e034a4a93d1515?s=128&d=identicon&r=PG", "display_name": "Luke-zhang-04", "link": "https://stackoverflow.com/users/12370337/luke-zhang-04"}, "is_accepted": false, "score": 0, "last_activity_date": 1602463795, "creation_date": 1602463795, "answer_id": 64310387, "question_id": 58133166, "link": "https://stackoverflow.com/questions/58133166/getting-error-fork-exec-var-task-main-no-such-file-or-directory-while-execut/64310387#64310387", "title": "Getting error &quot;fork/exec /var/task/main: no such file or directory&quot; while executing aws-lambda function", "body": "<p>My case was a strange one, but I'll leave it here in case someone needs it.</p>\n<p>I built my executable in a Docker container and then used <code>Docker cp</code> to put the file in a local directory. Then I zipped the executable and deployed it.</p>\n<p>Apparently, <code>Docker cp</code> creates a symlink-like file rather than an actual file, so it just wouldn't work.</p>\n<p>My solution was just to use <code>sudo cp</code> and copy the executable as another file, which created a physical file, and deployed that instead.</p>\n"}, {"tags": [], "owner": {"reputation": 2714, "user_id": 1482990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ed4e6d440b9c55fc6fcad74fefe5ce9?s=128&d=identicon&r=PG", "display_name": "drodsou", "link": "https://stackoverflow.com/users/1482990/drodsou"}, "is_accepted": false, "score": 0, "last_activity_date": 1616864492, "creation_date": 1616864492, "answer_id": 66833954, "question_id": 58133166, "link": "https://stackoverflow.com/questions/58133166/getting-error-fork-exec-var-task-main-no-such-file-or-directory-while-execut/66833954#66833954", "title": "Getting error &quot;fork/exec /var/task/main: no such file or directory&quot; while executing aws-lambda function", "body": "<p>In my embarrasing case I was zipping the folder from outside so the path in the zip I was uploading was 'folder/main'</p>\n"}], "owner": {"reputation": 439, "user_id": 6473645, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tutc5.png?s=128&g=1", "display_name": "Pooja K Bhatt", "link": "https://stackoverflow.com/users/6473645/pooja-k-bhatt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11244, "favorite_count": 4, "answer_count": 7, "score": 19, "last_activity_date": 1616864492, "creation_date": 1569581878, "last_edit_date": 1569584646, "question_id": 58133166, "link": "https://stackoverflow.com/questions/58133166/getting-error-fork-exec-var-task-main-no-such-file-or-directory-while-execut", "title": "Getting error &quot;fork/exec /var/task/main: no such file or directory&quot; while executing aws-lambda function", "body": "<p>Getting error fork/exec /var/task/main: no such file or directory while executing lambda function.</p>\n\n<p>I am using windows platform to run and build code in Go.</p>\n\n<p>I have done following steps to deploy go aws-lambda handler:</p>\n\n<ol>\n<li>Written code in go language with VSCode in windows platform</li>\n<li>Build project with : go build main.go</li>\n<li>Convert main.exe to main.zip</li>\n<li>Uploaded main.zip with handler name main aws-lambda fuction using aws console account </li>\n<li>Created test event to test lambda function</li>\n<li>Got error \"fork/exec /var/task/main: no such file or directory while executing lambda function\"</li>\n</ol>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/aws/aws-lambda-go/lambda\"\n)\n\n// Request represents the requested object\ntype Request struct {\n    ID    int    `json:\"ID\"`\n    Value string `json:\"Value\"`\n}\n\n// Response represents the Response object\ntype Response struct {\n    Message string `json:\"Message\"`\n    Ok      bool   `json:\"Ok\"`\n}\n\n// Handler represents the Handler of lambda\nfunc Handler(request Request) (Response, error) {\n    return Response{\n        Message: fmt.Sprint(\"Process Request Id %f\", request.ID),\n        Ok:      true,\n    }, nil\n}\n\nfunc main() {\n    lambda.Start(Handler)\n}\n</code></pre>\n\n<p>build command </p>\n\n<pre><code>go build main.go\n</code></pre>\n\n<p>Detail Error in AWS console</p>\n\n<pre><code>{\n  \"errorMessage\": \"fork/exec /var/task/main: no such file or directory\",\n  \"errorType\": \"PathError\"\n}\n</code></pre>\n\n<p>Log Output in AWS console</p>\n\n<pre><code>START RequestId: 9ef206ed-5538-407a-acf0-06673bacf2d7 Version: $LATEST\nfork/exec /var/task/main: no such file or directory: PathError\nnull\nEND RequestId: 9ef206ed-5538-407a-acf0-06673bacf2d7\nREPORT RequestId: 9ef206ed-5538-407a-acf0-06673bacf2d7  Duration: 0.64 ms   Billed Duration: 100 ms Memory Size: 512 MB Max Memory Used: 31 MB  Init Duration: 1.49 ms\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "kubernetes-operator"], "comments": [{"owner": {"reputation": 307, "user_id": 1460675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee5171d3e7aeda3d5921af89d94c6a15?s=128&d=identicon&r=PG", "display_name": "user1460675", "link": "https://stackoverflow.com/users/1460675/user1460675"}, "edited": false, "score": 0, "creation_date": 1574840620, "post_id": 58130729, "comment_id": 104369038, "body": "Question: Are these two clusters on GKE or are they managed on other environments by you manually?"}], "answers": [{"comments": [{"owner": {"reputation": 4571, "user_id": 186429, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/861636564e64678e849fe27ffbd2a61f?s=128&d=identicon&r=PG", "display_name": "Galder Zamarre&#241;o", "link": "https://stackoverflow.com/users/186429/galder-zamarre%c3%b1o"}, "edited": false, "score": 0, "creation_date": 1569585762, "post_id": 58131363, "comment_id": 102655075, "body": "Hmmm, not sure this works either. I can&#39;t see how you can take rest.Client and get a kubeconfig file out of it, or create a <code>k8s.io&#47;client-go&#47;tools&#47;clientcmd&#47;api.Config</code> instance to be able to use the <code>clientcmd</code> package to talk to a remote Kubernetes."}, {"owner": {"reputation": 958, "user_id": 1544021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47ea4ebd29b27e3dc2ee0ebbacec1033?s=128&d=identicon&r=PG", "display_name": "Paulo Schreiner", "link": "https://stackoverflow.com/users/1544021/paulo-schreiner"}, "edited": false, "score": 0, "creation_date": 1574863313, "post_id": 58131363, "comment_id": 104381634, "body": "Although correct, this is not the answer to the question posed. The question is about accessing the API of a <i>different</i> k8s cluster."}], "tags": [], "owner": {"reputation": 7068, "user_id": 2718151, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7fbf5d5ebe5c06ec8f0db845d356b157?s=128&d=identicon&r=PG", "display_name": "Nicola Ben", "link": "https://stackoverflow.com/users/2718151/nicola-ben"}, "is_accepted": false, "score": 1, "last_activity_date": 1569575352, "creation_date": 1569575352, "answer_id": 58131363, "question_id": 58130729, "link": "https://stackoverflow.com/questions/58130729/connect-with-go-code-from-kubernetes-to-external-kubernetes-cluster/58131363#58131363", "title": "Connect with go code from Kubernetes to external Kubernetes cluster", "body": "<p>From \"Programming Kubernetes\", ed. Oreilly (which I suggest as reading):</p>\n\n<p>\"When running a binary inside of a pod in a cluster, the kubelet will automatically mount a service account into the container at /var/run/secrets/kubernetes.io/serviceaccount. It replaces the kubeconfig file just mentioned and can easily be turned into a rest.Config via the rest.InClusterConfig() method.\"</p>\n\n<p>Required config is taken with this line:</p>\n\n<pre><code>cfg, err := rest.InClusterConfig()\n</code></pre>\n\n<p>Take a look at the code here:</p>\n\n<p><a href=\"https://github.com/programming-kubernetes/cnat/blob/master/cnat-client-go/main.go\" rel=\"nofollow noreferrer\">https://github.com/programming-kubernetes/cnat/blob/master/cnat-client-go/main.go</a></p>\n"}, {"comments": [{"owner": {"reputation": 4571, "user_id": 186429, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/861636564e64678e849fe27ffbd2a61f?s=128&d=identicon&r=PG", "display_name": "Galder Zamarre&#241;o", "link": "https://stackoverflow.com/users/186429/galder-zamarre%c3%b1o"}, "edited": false, "score": 0, "creation_date": 1569585397, "post_id": 58131784, "comment_id": 102654878, "body": "Yeah, I&#39;m running inside a Kubernetes pod and need to talk to a different Kubernetes cluster. Not sure your solution works because an operator does not have access in advance to the kubeconfig file."}, {"owner": {"reputation": 958, "user_id": 1544021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47ea4ebd29b27e3dc2ee0ebbacec1033?s=128&d=identicon&r=PG", "display_name": "Paulo Schreiner", "link": "https://stackoverflow.com/users/1544021/paulo-schreiner"}, "reply_to_user": {"reputation": 4571, "user_id": 186429, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/861636564e64678e849fe27ffbd2a61f?s=128&d=identicon&r=PG", "display_name": "Galder Zamarre&#241;o", "link": "https://stackoverflow.com/users/186429/galder-zamarre%c3%b1o"}, "edited": false, "score": 0, "creation_date": 1569672537, "post_id": 58131784, "comment_id": 102677015, "body": "An operator is nothing special, its a just a pod (Deployment) that accesses the k8s api. Of course it is your responsibility to mount a Kubeconfig file with the correct configuration that the Pod (&quot;operator&quot;) can then open and use."}, {"owner": {"reputation": 5452, "user_id": 3714940, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bwcdU.jpg?s=128&g=1", "display_name": "SiHa", "link": "https://stackoverflow.com/users/3714940/siha"}, "edited": false, "score": 2, "creation_date": 1574841122, "post_id": 58131784, "comment_id": 104369307, "body": "This. It&#39;s exactly how we do it here, we have multiple Kubernetes clusters, and one of them runs a nightly backup job for some services on the other clusters. kubeconfig in a configmap, plus some bash running kubectl commands."}], "tags": [], "owner": {"reputation": 958, "user_id": 1544021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47ea4ebd29b27e3dc2ee0ebbacec1033?s=128&d=identicon&r=PG", "display_name": "Paulo Schreiner", "link": "https://stackoverflow.com/users/1544021/paulo-schreiner"}, "is_accepted": false, "score": 2, "last_activity_date": 1569576864, "creation_date": 1569576864, "answer_id": 58131784, "question_id": 58130729, "link": "https://stackoverflow.com/questions/58130729/connect-with-go-code-from-kubernetes-to-external-kubernetes-cluster/58131784#58131784", "title": "Connect with go code from Kubernetes to external Kubernetes cluster", "body": "<p>A kubernetes operator is, in the end, a pod running inside of Kubernetes. Nicola Ben`s answer is the way to go if you want to access the current K8S cluster's API.</p>\n\n<p>However, you're saying your operator \"needs to talk to <strong>other</strong> Kubernetes clusters\" (my emphasis), and that it works locally.</p>\n\n<p>Then, one simple approach is to create a <code>ConfigMap</code> containing the <code>kubeconfig</code> file, and mount that to a known location in the operator pod. Then you can simply use that the same way you do it locally.</p>\n"}, {"tags": [], "owner": {"reputation": 307, "user_id": 1460675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee5171d3e7aeda3d5921af89d94c6a15?s=128&d=identicon&r=PG", "display_name": "user1460675", "link": "https://stackoverflow.com/users/1460675/user1460675"}, "is_accepted": false, "score": 0, "last_activity_date": 1574840837, "creation_date": 1574840837, "answer_id": 59065398, "question_id": 58130729, "link": "https://stackoverflow.com/questions/58130729/connect-with-go-code-from-kubernetes-to-external-kubernetes-cluster/59065398#59065398", "title": "Connect with go code from Kubernetes to external Kubernetes cluster", "body": "<p>Question: Are these two clusters on GKE or are they managed on other environments by you manually?</p>\n\n<p>A Kubernetes service is basically a collection of pods which can be your controller. </p>\n\n<p>One way to accomplish this is by exposing your service to outside the cluster. On GKE you can do this by using an ILB, ILB will help you expose the service to other k8s clusters you might want to connect to in the same VPC.\nBut if the other services you need to connect to are in some other VPC you should either:</p>\n\n<ol>\n<li>Connect via public internet with an intermediate load balancer in\nthe middle. Not recommended for sensitive traffic. ~or~</li>\n<li>Peer the two VPCs and again use some sort of load balancer that can connect the two k8s clusters. (NGINX might work here but depends on what you're doing)</li>\n</ol>\n\n<p>Does this help?</p>\n"}, {"tags": [], "owner": {"reputation": 4571, "user_id": 186429, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/861636564e64678e849fe27ffbd2a61f?s=128&d=identicon&r=PG", "display_name": "Galder Zamarre&#241;o", "link": "https://stackoverflow.com/users/186429/galder-zamarre%c3%b1o"}, "is_accepted": true, "score": 1, "last_activity_date": 1578554910, "creation_date": 1578554910, "answer_id": 59659101, "question_id": 58130729, "link": "https://stackoverflow.com/questions/58130729/connect-with-go-code-from-kubernetes-to-external-kubernetes-cluster/59659101#59659101", "title": "Connect with go code from Kubernetes to external Kubernetes cluster", "body": "<p>Turns out it's quite easy to do, just call the following with the master URL and the token to access it:</p>\n\n<pre><code>cfg, err := clientcmd.BuildConfigFromFlags(os.Getenv(\"MASTERURL\"), os.Getenv(\"KUBECONFIG\"))\ncfg.BearerToken = os.Getenv(\"BEARERTOKEN\")\n</code></pre>\n\n<p>It might also require:</p>\n\n<pre><code>cfg.Insecure = true\n</code></pre>\n"}], "owner": {"reputation": 4571, "user_id": 186429, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/861636564e64678e849fe27ffbd2a61f?s=128&d=identicon&r=PG", "display_name": "Galder Zamarre&#241;o", "link": "https://stackoverflow.com/users/186429/galder-zamarre%c3%b1o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1134, "favorite_count": 0, "accepted_answer_id": 59659101, "answer_count": 4, "score": 1, "last_activity_date": 1578554910, "creation_date": 1569573093, "question_id": 58130729, "link": "https://stackoverflow.com/questions/58130729/connect-with-go-code-from-kubernetes-to-external-kubernetes-cluster", "title": "Connect with go code from Kubernetes to external Kubernetes cluster", "body": "<p>An operator I'm building needs to talk to other Kubernetes clusters, are there any best practices on how to do that from within the operator that runs on Kubernetes?</p>\n\n<p>Using <code>k8s.io/client-go/tools/clientcmd</code> package I can call <code>BuildConfigFromFlags</code> method passing <code>masterURL</code> and kubeconfig location. This works fine from outside Kubernetes, but within Kubernetes, can any assumptions be made about kubeconfig location? Or should some other API be used?</p>\n\n<p>As a side note: I'm using <code>controller-runtime</code>'s <code>Client</code> API for talking to Kubernetes.</p>\n"}, {"tags": ["json", "go", "methods", "time", "struct"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1569571974, "creation_date": 1569571974, "answer_id": 58130462, "question_id": 58130096, "link": "https://stackoverflow.com/questions/58130096/how-to-format-nulltime-into-human-readable-format-like-hhmmss/58130462#58130462", "title": "How to format NullTime into human readable format like HH:MM:SS", "body": "<p><a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>json.Marshal()</code></a> expects a single value, and <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\"><code>time.Parse()</code></a> returns 2 values: the parsed time and an error. You have to handle that yourself and not pass it to <code>json.Marshal()</code>, for example:</p>\n\n<pre><code>func (ns *NullString) MarshalJSON() ([]byte, error) {\n    if !ns.Valid {\n        return []byte(\"null\"), nil\n    }\n    t, err := time.Parse(time.RFC3339, ns.String)\n    if err != nil {\n        return nil, err\n    }\n    return json.Marshal(t.Format(\"15:04:05\"))\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>ns := &amp;NullString{}\ndata, err := json.Marshal(ns)\nfmt.Println(string(data), err)\n\nns = &amp;NullString{\n    NullString: sql.NullString{\n        String: time.Time{}.Add(time.Minute * 1029).Format(time.RFC3339),\n        Valid:  true,\n    },\n}\ndata, err = json.Marshal(ns)\nfmt.Println(string(data), err)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/-3nBSCgfWBG\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>null &lt;nil&gt;\n\"17:09:00\" &lt;nil&gt;\n</code></pre>\n\n<p>Also be careful with the receiver type. You used pointer receivers (<code>ns *NullString</code>), yet you use your <code>NullString</code> as non-pointers in the <code>LogItem</code> struct. Which means when marshaling values of your <code>LogItem</code>, this <code>NullString.MarshalJSON()</code> will not be called. So instead use non-pointer receiver.</p>\n\n<pre><code>func (ns NullString) MarshalJSON() ([]byte, error) {\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 6009, "user_id": 132127, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/TnwQX.jpg?s=128&g=1", "display_name": "anta40", "link": "https://stackoverflow.com/users/132127/anta40"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1569572238, "creation_date": 1569570467, "last_edit_date": 1569572238, "question_id": 58130096, "link": "https://stackoverflow.com/questions/58130096/how-to-format-nulltime-into-human-readable-format-like-hhmmss", "title": "How to format NullTime into human readable format like HH:MM:SS", "body": "<p>I've managed to modify my code so it displays all table rows correctly, even if there are null values</p>\n\n<pre><code>type NullString struct {\n    sql.NullString\n}\n\nfunc (ns *NullString) MarshalJSON() ([]byte, error) {\n    if !ns.Valid {\n        return []byte(\"null\"), nil\n    }\n    return json.Marshal(ns.String)\n}\n\ntype LogItem struct {\n    UserId           string     `form:\"userid\" json:\"userid\"`\n    UserDate         string     `form:\"date\" json:\"date\"`\n    CheckinTime      NullString `form:\"checkintime\" json:\"checkintime\"`\n    CheckinLocation  NullString `form:\"checkinlocation\" json:\"checkinlocation\"`\n    CheckoutTime     NullString `form:\"checkouttime\" json:\"checkouttime\"`\n    CheckoutLocation NullString `form:\"checkoutlocation\" json:\"checkoutlocation\"`\n}\n\ndb := DBconnect()\ndefer db.Close()\n\nrows, err := db.Query(\"SELECT * FROM oc_log\")\nif err != nil {\n    log.Print(err)\n}\n\nfor rows.Next() {\n    if err := rows.Scan(&amp;logItem.UserId, &amp;logItem.UserDate, &amp;logItem.CheckinTime, &amp;logItem.CheckinLocation, &amp;logItem.CheckoutTime, &amp;logItem.CheckoutLocation); err != nil {\n        log.Fatal(err.Error())\n    } else {\n        arrLogItem = append(arrLogItem, logItem)\n    }\n}\n</code></pre>\n\n<blockquote>\n  <p>{\n      \"status\": 200,\n      \"message\": \"Success\",\n      \"Data\": [\n          {\n              \"userid\": \"9\",\n              \"date\": \"2019-09-25T00:00:00Z\",\n              \"checkintime\": \"0000-01-01T14:56:39+07:00\",\n              \"checkinlocation\": \"(100, 100)\",\n              \"checkouttime\": \"0000-01-01T15:52:22+07:00\",\n              \"checkoutlocation\": \"(100, 100)\"\n          },\n          {\n              \"userid\": \"10\",\n              \"date\": \"2019-09-27T00:00:00Z\",\n              \"checkintime\": \"0000-01-01T14:04:44+07:00\",\n              \"checkinlocation\": \"(123, 321)\",\n              \"checkouttime\": null,\n              \"checkoutlocation\": null\n          }\n      ] }</p>\n</blockquote>\n\n<p>Now the problem is how to format <strong>0000-01-01T14:04:44+07:00</strong> into human-friendlier output like <strong>17:09:02</strong>, for example?</p>\n\n<p>This code doesn't compile:</p>\n\n<pre><code>func (ns *NullString) MarshalJSON() ([]byte, error) {\n    if !ns.Valid {\n        return []byte(\"null\"), nil\n    }\n    return json.Marshal(time.Parse(time.RFC3339, ns.String))\n}\n</code></pre>\n\n<blockquote>\n  <p>too many arguments in call to json.Marshal\n          have (time.Time, error)\n          want (interface {})</p>\n</blockquote>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1569570006, "post_id": 58129958, "comment_id": 102647041, "body": "<code>MyGarage.AllCars()</code> must return <code>[]Car</code>, <code>[]MyCar</code> is not the same."}, {"owner": {"reputation": 23850, "user_id": 196679, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/fXUzE.jpg?s=128&g=1", "display_name": "Bazzz", "link": "https://stackoverflow.com/users/196679/bazzz"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1569570095, "post_id": 58129958, "comment_id": 102647082, "body": "Yup, but that would create a dependency that I am trying to avoid if possible. Since <code>MyGarage</code> can implement <code>Garage</code> without a dependency, why can <code>MyCar</code> not do the same for <code>Car</code>?"}, {"owner": {"reputation": 436, "user_id": 1638158, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/NlmL8.jpg?s=128&g=1", "display_name": "John Dowling", "link": "https://stackoverflow.com/users/1638158/john-dowling"}, "edited": false, "score": 1, "creation_date": 1569570150, "post_id": 58129958, "comment_id": 102647110, "body": "This is because a slice of interface is not an interface see the following <a href=\"https://github.com/golang/go/wiki/InterfaceSlice\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/InterfaceSlice</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1569571540, "post_id": 58129958, "comment_id": 102647751, "body": "Note that the signature of a function/method is its type. For type <code>T</code> to implement interface <code>I</code>, type <code>T</code> must implement the methods of <code>I</code>, and the methods&#39; types/signatures must match <i>verbatim</i>."}], "answers": [{"comments": [{"owner": {"reputation": 23850, "user_id": 196679, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/fXUzE.jpg?s=128&g=1", "display_name": "Bazzz", "link": "https://stackoverflow.com/users/196679/bazzz"}, "edited": false, "score": 0, "creation_date": 1569571691, "post_id": 58130298, "comment_id": 102647815, "body": "Yes that is a similar suggestion as icza gave in the comments, but considering that Garage and MyGarage are in different packages this would create a dependency from package[MyGarage] to package[Garage] (to have access to the interface Car) Since this dependency is not needed for MyGarage to implement Garage, I was hoping to avoid it."}, {"owner": {"reputation": 436, "user_id": 1638158, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/NlmL8.jpg?s=128&g=1", "display_name": "John Dowling", "link": "https://stackoverflow.com/users/1638158/john-dowling"}, "reply_to_user": {"reputation": 23850, "user_id": 196679, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/fXUzE.jpg?s=128&g=1", "display_name": "Bazzz", "link": "https://stackoverflow.com/users/196679/bazzz"}, "edited": false, "score": 0, "creation_date": 1569571919, "post_id": 58130298, "comment_id": 102647910, "body": "I guess you are correct but surely the upper level code should have the interfaces within and your packages should implement that interface, this is because the code that will orchestrate this needs to know more then the lower implementations, with that said this then becomes more of a question of if your package interface design and layout is correct"}, {"owner": {"reputation": 436, "user_id": 1638158, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/NlmL8.jpg?s=128&g=1", "display_name": "John Dowling", "link": "https://stackoverflow.com/users/1638158/john-dowling"}, "reply_to_user": {"reputation": 23850, "user_id": 196679, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/fXUzE.jpg?s=128&g=1", "display_name": "Bazzz", "link": "https://stackoverflow.com/users/196679/bazzz"}, "edited": false, "score": 0, "creation_date": 1569572983, "post_id": 58130298, "comment_id": 102648408, "body": "Also, I will go back to my comment about slices of interfaces are not interfaces, with the above code we are still not talking in pure interfaces exactly we are actually talking about slices, in the methods you are returning slices that contain interfaces as elements as the document I linked helps with, so when you are saying that it is not accepting the abstraction that is actually not what is going on, it is not accepting the static type of slice that contains interface elements, please read the doc above it explains what I mean better then I can give in a comment."}], "tags": [], "owner": {"reputation": 436, "user_id": 1638158, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/NlmL8.jpg?s=128&g=1", "display_name": "John Dowling", "link": "https://stackoverflow.com/users/1638158/john-dowling"}, "is_accepted": true, "score": 0, "last_activity_date": 1569571318, "creation_date": 1569571318, "answer_id": 58130298, "question_id": 58129958, "link": "https://stackoverflow.com/questions/58129958/how-to-make-an-interface-method-return-another-interface/58130298#58130298", "title": "How to make an interface method return another interface?", "body": "<p>This is to do with slices of interface not being interfaces, that being said I think that the below gives you what you want.</p>\n\n<p><a href=\"https://play.golang.org/p/qg0NQNCIjx7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qg0NQNCIjx7</a></p>\n\n<pre><code>type Garage interface {\n    AllCars() []Car\n}\n\ntype Car interface {\n    Name() string\n}\n\ntype MyGarage struct{\n\n}\n\nfunc (g MyGarage) AllCars() []Car {\n    x := []Car{MyCar{}}\n    return x\n}\n\ntype MyCar struct {\n    name string\n}\n\nfunc (c MyCar) Name() string {\n    return c.name\n}\n\nfunc main() {\n    var garage Garage\n    garage = MyGarage{}\n    cars := garage.AllCars()\n    fmt.Println(cars)\n}\n</code></pre>\n"}], "owner": {"reputation": 23850, "user_id": 196679, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/fXUzE.jpg?s=128&g=1", "display_name": "Bazzz", "link": "https://stackoverflow.com/users/196679/bazzz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 58130298, "answer_count": 1, "score": -2, "last_activity_date": 1569571318, "creation_date": 1569569918, "last_edit_date": 1569571211, "question_id": 58129958, "link": "https://stackoverflow.com/questions/58129958/how-to-make-an-interface-method-return-another-interface", "title": "How to make an interface method return another interface?", "body": "<p>I have an interface with one method that returns a slice of another interface. Here is a simple representation:</p>\n\n<pre><code>type Garage interface {\n    AllCars() []Car\n}\n\ntype Car interface {\n    Name() string\n}\n</code></pre>\n\n<p>I have also made an implementation for this:</p>\n\n<pre><code>type MyGarage struct{}\n\nfunc (g MyGarage) AllCars() []MyCar {\n    return make([]MyCar, 0)\n}\n\ntype MyCar struct {\n    name string\n}\n\nfunc (c MyCar) Name() string {\n    return c.name\n}\n</code></pre>\n\n<p>Now in my test I have made a function:</p>\n\n<pre><code>func TestAllCars(t *testing.T) {\n    var garage Garage\n    garage = new(mygarage.MyGarage)\n    cars := garage.AllCars()\n    fmt.Println(cars)\n}\n</code></pre>\n\n<p>And Go complains that MyGarage does not implement the Garage interface, which I understand, but did not expect, because MyCar does implement Car, so it should not have been an issue to me.</p>\n\n<pre><code>cannot use new(mygarage.MyGarage) (type *mygarage.MyGarage) as type Garage in assignment:\n    *mygarage.MyGarage does not implement Garage (wrong type for AllCars method)\n        have AllCars() []mygarage.MyCar\n        want AllCars() []Car\n</code></pre>\n\n<p>What am I doing wrong here?</p>\n\n<h2>Edit after comments</h2>\n\n<p>I tried changing the method to returning just a single car as to avoid the issues around slices of interfaces, yet it still complains. Just for the sake of me wanting to understand what is going on. Since <code>MyCar</code> implements <code>Car</code> I did not expect the following error:</p>\n\n<pre><code>*mygarage.MyGarage does not implement Garage (wrong type for GetCar method)\n    have GetCar() mygarage.MyCar\n    want GetCar() Car\n</code></pre>\n\n<p>I believe the issue is being a strongly typed return type, MyCar is not a Car, but it should be possible to cast it to one, yet Go does not accept that as a valid implementation for the interface Garage?</p>\n"}, {"tags": ["c", "go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1569721441, "last_edit_date": 1569721441, "creation_date": 1569591855, "answer_id": 58135816, "question_id": 58129146, "link": "https://stackoverflow.com/questions/58129146/c-call-go-exported-function/58135816#58135816", "title": "C call Go exported function", "body": "<blockquote>\n  <p><a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">Command cgo</a></p>\n  \n  <p><a href=\"https://golang.org/cmd/cgo/#hdr-Passing_pointers\" rel=\"nofollow noreferrer\">Passing pointers</a></p>\n  \n  <p>A Go function called by C code may not return a Go pointer (which\n  implies that it may not return a string, slice, channel, and so\n  forth). A Go function called by C code may take C pointers as\n  arguments, and it may store non-pointer or C pointer data through\n  those pointers, but it may not store a Go pointer in memory pointed to\n  by a C pointer. A Go function called by C code may take a Go pointer\n  as an argument, but it must preserve the property that the Go memory\n  to which it points does not contain any Go pointers.</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p>I want to return an array to C caller.</p>\n\n<pre><code>//export EtcdGetAllNodes\nfunc EtcdGetAllNodes() []uint32 {\n  a := []uint32{1, 2, 3}\n  return a\n}\n</code></pre>\n</blockquote>\n\n<p>A Go function called by C code may not return a Go pointer (which implies that it may not return a slice).</p>\n\n<hr>\n\n<p>There are many possible solutions: <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">Command cgo</a>.</p>\n\n<p>For example, here is one simple solution:</p>\n\n<p>Output:</p>\n\n<pre><code>$ go build -buildmode=c-archive -o cmem.a cmem.go\n$ gcc -pthread -o cmem cmem.c cmem.a\n$ ./cmem\n-- EtcdGetAllNodes --\nnodes: 3\nnode 0: 1\nnode 1: 2\nnode 2: 3\n$ echo $?\n0\n$ \n</code></pre>\n\n<p><code>cmem.go</code>:</p>\n\n<pre><code>package main\n\n/*\n#include &lt;stdint.h&gt;\n#include &lt;stdlib.h&gt;\n*/\nimport \"C\"\n\nimport \"unsafe\"\n\n// toC: Go slice to C array\n// c[0] is the number of elements,\n// c[1] through c[c[0]] are the elements.\n// When no longer in use, free the C array.\nfunc toC(a []uint32) *C.uint32_t {\n    // C array\n    ca := (*C.uint32_t)(C.calloc(C.size_t(1+len(a)), C.sizeof_uint32_t))\n    // Go slice of C array\n    ga := (*[1 &lt;&lt; 30]uint32)(unsafe.Pointer(ca))[: 1+len(a) : 1+len(a)]\n    // number of elements\n    ga[0] = uint32(len(a))\n    // elements\n    for i, e := range a {\n        ga[1+i] = e\n    }\n    return ca\n}\n\n//export EtcdGetAllNodes\n// EtcdGetAllNodes: return all nodes as a C array.\n// nodes[0] is the number of node elements.\n// nodes[1] through nodes[nodes[0]] are the node elements.\n// When no longer in use, free the nodes array.\nfunc EtcdGetAllNodes() *C.uint32_t {\n    // TODO: code to get all etcd nodes\n    a := []uint32{1, 2, 3}\n    // nodes as a C array\n    return toC(a)\n}\n\nfunc main() {}\n</code></pre>\n\n<p><code>cmem.c</code>:</p>\n\n<pre><code>#include \"cmem.h\"\n#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n\nint main() {\n    printf(\"-- EtcdGetAllNodes --\\n\");\n    // nodes[0] is the number of node elements.\n    // nodes[1] through nodes[nodes[0]] are the node elements.\n    // When no longer in use, free the nodes array.\n    uint32_t *nodes = EtcdGetAllNodes();\n    if (!nodes) {\n        return 1;\n    }\n    printf(\"nodes: %d\\n\", *nodes);\n    for (uint32_t i = 1; i &lt;= *nodes; i++) {\n        printf(\"node %d: %d\\n\", i-1,*(nodes+i));\n    }\n    free(nodes);\n    return 0;\n}\n</code></pre>\n"}], "owner": {"reputation": 197, "user_id": 3313450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef32fa1e6ba717f97b8abacd0b755037?s=128&d=identicon&r=PG&f=1", "display_name": "dingrui", "link": "https://stackoverflow.com/users/3313450/dingrui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1569721441, "creation_date": 1569566552, "last_edit_date": 1569582046, "question_id": 58129146, "link": "https://stackoverflow.com/questions/58129146/c-call-go-exported-function", "title": "C call Go exported function", "body": "<p>I want to return an array to C caller, just like below, how to do it?</p>\n\n<pre><code>//export EtcdGetAllNodes\nfunc EtcdGetAllNodes()[]uint32 {\n    a := []uint32{1,2,3}\n    return a\n}\n</code></pre>\n\n<p>This function <code>EtcdGetAllNodes</code> will try to get value with a prefix for the specific key from etcd, it will return multiple values. How to return these values to C caller?</p>\n"}]