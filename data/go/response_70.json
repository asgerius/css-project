[{"tags": ["go", "swagger"], "comments": [{"owner": {"reputation": 4007, "user_id": 616398, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/83e5ba145326da0edcc404bfff584df5?s=128&d=identicon&r=PG", "display_name": "Gerben Jacobs", "link": "https://stackoverflow.com/users/616398/gerben-jacobs"}, "edited": false, "score": 0, "creation_date": 1463067776, "post_id": 37172956, "comment_id": 61915823, "body": "One of the packages in go-swagger vendor directory is go-openapi and they have an Unmarshal method for Swagger; <a href=\"https://godoc.org/github.com/go-openapi/spec#Swagger.UnmarshalJSON\" rel=\"nofollow noreferrer\">godoc.org/github.com/go-openapi/spec#Swagger.UnmarshalJSON</a>"}], "owner": {"reputation": 74, "user_id": 1971025, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/345d6895f0e5f06a9fbbc01bea5660a2?s=128&d=identicon&r=PG", "display_name": "s.t.nguyen", "link": "https://stackoverflow.com/users/1971025/s-t-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1462999518, "creation_date": 1462999518, "question_id": 37172956, "link": "https://stackoverflow.com/questions/37172956/retrieve-go-swagger-annotation-from-swagger-json", "title": "Retrieve go-swagger annotation from swagger.json", "body": "<p>I am learning to generate swagger.json from go-swagger generator, but I have not found any complete example (with meta, and all methods).</p>\n\n<p>Is there any way to retrieve the go-swagger annotation back from the generated JSON?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 742, "user_id": 717318, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/13e99fc7225ca378040ef36ef1a3049e?s=128&d=identicon&r=PG", "display_name": "Kevin Deenanauth", "link": "https://stackoverflow.com/users/717318/kevin-deenanauth"}, "edited": false, "score": 0, "creation_date": 1462997960, "post_id": 37172468, "comment_id": 61879674, "body": "Thanks! I see from goji.io: <code>&lt;meta name=&quot;go-import&quot; content=&quot;goji.io git https:&#47;&#47;github.com&#47;goji&#47;goji&quot;&gt;     &lt;meta name=&quot;go-source&quot; content=&quot;goji.io https:&#47;&#47;github.com&#47;goji&#47;goji&#47; https:&#47;&#47;github.com&#47;goji&#47;goji&#47;tree&#47;master{&#47;dir} https:&#47;&#47;github.com&#47;goji&#47;goji&#47;blob&#47;master{&#47;dir}&#47;{file}#L{line&zwnj;&#8203;}&quot;&gt;</code>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1462997723, "creation_date": 1462997723, "answer_id": 37172468, "question_id": 37172147, "link": "https://stackoverflow.com/questions/37172147/import-package-directly-from-domain-e-g-goji/37172468#37172468", "title": "Import package directly from domain (e.g. goji)", "body": "<p>It's documented in the <code>go</code> command, under <a href=\"https://golang.org/cmd/go/#hdr-Remote_import_paths\">Remote Import Paths</a>.</p>\n\n<blockquote>\n  <p>If the import path is not a known code hosting site and also lacks a\n  version control qualifier, the go tool attempts to fetch the import\n  over https/http and looks for a  tag in the document's HTML\n  .</p>\n  \n  <p>The meta tag has the form:</p>\n\n<pre><code>&lt;meta name=\"go-import\" content=\"import-prefix vcs repo-root\"&gt; \n</code></pre>\n  \n  <p>The import-prefix is the import path corresponding to the repository root.\n  It must be a prefix or an exact match of the package being fetched\n  with \"go get\". If it's not an exact match, another http request is\n  made at the prefix to verify the  tags match.</p>\n</blockquote>\n"}], "owner": {"reputation": 742, "user_id": 717318, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/13e99fc7225ca378040ef36ef1a3049e?s=128&d=identicon&r=PG", "display_name": "Kevin Deenanauth", "link": "https://stackoverflow.com/users/717318/kevin-deenanauth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 37172468, "answer_count": 1, "score": 2, "last_activity_date": 1462997723, "creation_date": 1462996612, "last_edit_date": 1462997472, "question_id": 37172147, "link": "https://stackoverflow.com/questions/37172147/import-package-directly-from-domain-e-g-goji", "title": "Import package directly from domain (e.g. goji)", "body": "<p>I noticed while importing packages from goji - it is hosted directly off their domain e.g:</p>\n\n<pre><code>package web\n\nimport (\n    \"goji.io\"\n)\n\nfunc Start() {\n    mux := goji.NewMux()\n}\n</code></pre>\n\n<p>How are the packages being requested by go and how is it hosted in this way? I can't find any documentation, so I'm thinking it might be a neat trick.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "edited": false, "score": 0, "creation_date": 1463015682, "post_id": 37170759, "comment_id": 61885898, "body": "wrote a quick playground using a Person interface <a href=\"https://play.golang.org/p/_JfXyyflP8\" rel=\"nofollow noreferrer\">play.golang.org/p/_JfXyyflP8</a> ... Here is another helpful blog post <a href=\"https://medium.com/@gianbiondi/interfaces-in-go-59c3dc9c2d98#.7l72q6qwg\" rel=\"nofollow noreferrer\">medium.com/@gianbiondi/interfaces-in-go-59c3dc9c2d98#.7l72q6&zwnj;&#8203;qwg</a>"}, {"owner": {"reputation": 21, "user_id": 6321931, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xK9YgBAmW3U/AAAAAAAAAAI/AAAAAAAATFE/vqNBOy28llU/photo.jpg?sz=128", "display_name": "Toby", "link": "https://stackoverflow.com/users/6321931/toby"}, "edited": false, "score": 0, "creation_date": 1463021274, "post_id": 37170759, "comment_id": 61887326, "body": "Thank you!  Ended up using an interface which allows me to access the member of the &quot;parent&quot; struct.  You are right in that the problem is i&#39;m trying to do things the way i&#39;m used to doing them in OO and struggling to figure out the way to accomplish them in Go while staying DRY.    Feel like i&#39;m not doing something correctly because i&#39;m copying code."}], "tags": [], "owner": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "is_accepted": true, "score": 4, "last_activity_date": 1572605706, "last_edit_date": 1572605706, "creation_date": 1462991648, "answer_id": 37170759, "question_id": 37170513, "link": "https://stackoverflow.com/questions/37170513/calling-function-that-takes-parent-with-struct-embedding-parent-doesnt-work/37170759#37170759", "title": "Calling function that takes parent with struct embedding parent doesn&#39;t work", "body": "<p>Go does not support inheritance, so the concept of parents and children do not exist. This makes the names confusing in the text below. It also indicates that you need to make the mental leap between reimplementing inheritance, to designing data structures in a go-like manner. This very issue took me some time to get my head around, and the answer was <em>'don't start with an inheritance hierarchy and wonder how to do it in go, start with go and design what you want to do with the tools available'</em>.</p>\n\n<p><code>SomeFunction</code> is defined to take a <code>Parent</code> as a parameter, so you must pass it a parent. If you want to pass it a child, you need to do <a href=\"https://play.golang.org/p/3sw7kX093L\" rel=\"nofollow noreferrer\">this</a>, i.e. use:</p>\n\n<pre><code>SomeFunction(child.Parent)\n</code></pre>\n\n<p>That's what you do to pass an embedded struct.</p>\n\n<p>However, what I suspect you really want to do is declare an interface called <code>Parent</code>, have <code>Child</code> implement it, and have <code>SomeFunction</code> take a <code>Parent</code> interface. Your confusion is then going to be that currently <code>Parent</code> has a data member, and interfaces have only functions. The neatest way to fix that depends on what you are trying to do, but one route would be to provide another function to return the data member. All the 'child' classes could then embed this data member and a the function could return it (or a pointer to it). However, without a clearer idea of what you are trying to do, this is only speculation.</p>\n"}], "owner": {"reputation": 21, "user_id": 6321931, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xK9YgBAmW3U/AAAAAAAAAAI/AAAAAAAATFE/vqNBOy28llU/photo.jpg?sz=128", "display_name": "Toby", "link": "https://stackoverflow.com/users/6321931/toby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1201, "favorite_count": 0, "accepted_answer_id": 37170759, "answer_count": 1, "score": 1, "last_activity_date": 1572605706, "creation_date": 1462990842, "question_id": 37170513, "link": "https://stackoverflow.com/questions/37170513/calling-function-that-takes-parent-with-struct-embedding-parent-doesnt-work", "title": "Calling function that takes parent with struct embedding parent doesn&#39;t work", "body": "<p>A bit confused on this one.  Please see <a href=\"https://play.golang.org/p/6QeJzxAnjP\" rel=\"nofollow\">playground</a>.</p>\n\n<p>I would expect go to allow you to call a method that takes a parent with a child that embeds that parent.</p>\n\n<pre><code> package main\n\nimport (\n    \"fmt\"\n)\n\ntype Parent struct {\n    A string\n}\n\ntype Child struct {\n    Parent \n}\n\nfunc SomeFunction(parent Parent) {\n    fmt.Println(\"%v\", parent.A)\n}\n\nfunc main() {\n    child := Child{Parent{A:\"test\"}}\n    SomeFunction(child)  //prog.go:21: cannot use child (type Child) as type Parent in argument to SomeFunction\n}\n</code></pre>\n\n<p>If I call this with \"child.Parent\" it works but in that case I can't use any code within the function that utilizes the value as an empty interface.    Googled the heck out of this and found one very interesting and helpful page.  <a href=\"https://github.com/luciotato/golang-notes/blob/master/OOP.md\" rel=\"nofollow\">Golang concepts from an OOP point of view</a>.  Any guidance on what i'm missing here is welcome.  Perhaps this is just me not fully \"getting\" Golang here.  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 742, "user_id": 717318, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/13e99fc7225ca378040ef36ef1a3049e?s=128&d=identicon&r=PG", "display_name": "Kevin Deenanauth", "link": "https://stackoverflow.com/users/717318/kevin-deenanauth"}, "edited": false, "score": 2, "creation_date": 1462991072, "post_id": 37169147, "comment_id": 61875925, "body": "Without looking too closely at the code, 100 simultaneous requests (truly simultaneous, not sequential) is enough to warrant spiking 100% for a moment especially for something CPU bound."}, {"owner": {"reputation": 5268, "user_id": 302164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XucHp.png?s=128&g=1", "display_name": "miltonb", "link": "https://stackoverflow.com/users/302164/miltonb"}, "edited": false, "score": 0, "creation_date": 1462998920, "post_id": 37169147, "comment_id": 61880209, "body": "Processing takes processing, but if you suspect there is an improvement then profile your code. There is a detailed blog <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">Profiling Go Programs</a>, however there are cruder ways to get a timing (i.e stopwatch)."}, {"owner": {"reputation": 233, "user_id": 978119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/63065694841cb294dda437d16669d36e?s=128&d=identicon&r=PG", "display_name": "aloneibreak", "link": "https://stackoverflow.com/users/978119/aloneibreak"}, "edited": false, "score": 0, "creation_date": 1463032768, "post_id": 37169147, "comment_id": 61890779, "body": "thanks for advices guys"}], "owner": {"reputation": 233, "user_id": 978119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/63065694841cb294dda437d16669d36e?s=128&d=identicon&r=PG", "display_name": "aloneibreak", "link": "https://stackoverflow.com/users/978119/aloneibreak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1462986509, "creation_date": 1462986509, "question_id": 37169147, "link": "https://stackoverflow.com/questions/37169147/file-reading-and-encoding-performance", "title": "File reading and encoding performance", "body": "<p>I'm writing some web service which supposed to receive an xml file from user, read it and save data to database</p>\n\n<p>This file is gzipped and encoded in UTF-16. So i have to ungzip it, save xml to a file (for future purposes). Next i have to read file into a string, decode it to UTF-8 and kind of <code>xml.Unmarshal([]byte(xmlString), &amp;report)</code></p>\n\n<p>Currently without saving it into a database</p>\n\n<p>On my local machine i've realized that processing of one request takes about 30% of my CPU and about 300ms of time. For one request looks like okay. But i made script which simultaneously fires 100 requests (via curl ) and i saw that CPU usage is up to 100% and time for one request increased to 2sec</p>\n\n<p>What i wanted to ask is: should i worry about it or maybe on a real web server things are going to be ok? Or maybe i'm doing smth wrong\nHere is the code:</p>\n\n<pre><code>func Parse(filename string) Report {\n    xmlString := getXml(filename)\n    report := Report{}\n\n    xml.Unmarshal([]byte(xmlString), &amp;report)\n\n    return report\n}\n\n\n\nfunc getXml(filename string) string {\n    b, err := ioutil.ReadFile(filename)\n    if err != nil {\n        fmt.Println(\"Error opening file:\", err)\n    }\n\n    s, err := decodeUTF16(b)\n    if err != nil {\n        panic(err)\n    }\n\n    pattern := `&lt;?xml version=\"1.0\" encoding=\"UTF-16\"?&gt;`\n    res := strings.Replace(s, pattern, \"\", 1)\n\n    return res\n}\n\n\nfunc decodeUTF16(b []byte) (string, error) {\n    if len(b)%2 != 0 {\n        return \"\", fmt.Errorf(\"Must have even length byte slice\")\n    }\n\n    u16s := make([]uint16, 1)\n\n    ret := &amp;bytes.Buffer{}\n\n    b8buf := make([]byte, 4)\n\n    lb := len(b)\n    for i := 0; i &lt; lb; i += 2 {\n        u16s[0] = uint16(b[i]) + (uint16(b[i+1]) &lt;&lt; 8)\n        r := utf16.Decode(u16s)\n        n := utf8.EncodeRune(b8buf, r[0])\n        ret.Write(b8buf[:n])\n    }\n\n    return ret.String(), nil\n}\n</code></pre>\n\n<p>Please ask if i forgot something important</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "is_accepted": false, "score": 7, "last_activity_date": 1462971790, "creation_date": 1462971790, "answer_id": 37163554, "question_id": 37163048, "link": "https://stackoverflow.com/questions/37163048/how-to-install-github-repository-in-a-specific-gopath/37163554#37163554", "title": "How to install github repository in a specific GOPATH?", "body": "<p>Well I can't see an option to do this in <code>go get --help</code>.</p>\n\n<p>But you could use this *nix way to achieve it:</p>\n\n<pre><code>$ GOPATH=$HOME/HomeWork go get github.com/gin-gonic/gin\n</code></pre>\n\n<p>And your original <code>GOPATH</code> won't be changed by above command.</p>\n"}, {"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 7, "last_activity_date": 1462972640, "creation_date": 1462972640, "answer_id": 37163867, "question_id": 37163048, "link": "https://stackoverflow.com/questions/37163048/how-to-install-github-repository-in-a-specific-gopath/37163867#37163867", "title": "How to install github repository in a specific GOPATH?", "body": "<p>According to Go Wiki:</p>\n\n<p><a href=\"https://github.com/golang/go/wiki/GOPATH\" rel=\"noreferrer\">https://github.com/golang/go/wiki/GOPATH</a></p>\n\n<p><strong>Use a single GOPATH</strong></p>\n\n<blockquote>\n  <p>Even though the GOPATH may be a list of directories, it is generally\n  correct and sufficient to use a single GOPATH for all Go code on your\n  machine. Since all packages retrieved with \"go get\" have a unique URL\n  (and thus a unique path on disk), having more than one GOPATH is\n  almost never necessary when building with the Go tool.</p>\n</blockquote>\n"}], "owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 680, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1462972640, "creation_date": 1462970513, "question_id": 37163048, "link": "https://stackoverflow.com/questions/37163048/how-to-install-github-repository-in-a-specific-gopath", "title": "How to install github repository in a specific GOPATH?", "body": "<p>I have two folders for GOPATH:</p>\n\n<pre><code>export GOPATH=$HOME/Work:$HOME/HomeWork\n</code></pre>\n\n<p>Here is their structure organization:  </p>\n\n<pre><code>Work\n    /pkg\n    /src\n        /github.com\n\nHomeWork\n    /pkg\n    /src\n        /github.com\n</code></pre>\n\n<p>By default</p>\n\n<pre><code>$ go get github.com/gin-gonic/gin\n</code></pre>\n\n<p>will put the repository in the first GOPATH.</p>\n\n<p>Now I want to install a github repository to a specific GOPATH, for example in:</p>\n\n<pre><code>HomeWork\n    /pkg\n    /src\n        /github.com\n            /gin-gonic\n</code></pre>\n\n<p>How can I achieve that?</p>\n"}, {"tags": ["mysql", "go"], "answers": [{"comments": [{"owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "edited": false, "score": 0, "creation_date": 1462968743, "post_id": 37160793, "comment_id": 61859906, "body": "It works, but 4.10 would display as 4.1 and 4.00 would display as 4 which is not what I want."}, {"owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "edited": false, "score": 0, "creation_date": 1462968866, "post_id": 37160793, "comment_id": 61860011, "body": "c.JSON(httpcode, gin.H{&quot;meta&quot;: s, &quot;data&quot;: response.AcceptedTerms})"}, {"owner": {"reputation": 963, "user_id": 385280, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/82d083ee140420fe7acde11d5109a311?s=128&d=identicon&r=PG", "display_name": "Venkat", "link": "https://stackoverflow.com/users/385280/venkat"}, "reply_to_user": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "edited": false, "score": 2, "creation_date": 1462970428, "post_id": 37160793, "comment_id": 61861212, "body": "That is the default behavior of <code>encoding&#47;json</code> package. It represents numbers like 4.00 as 4 and 4.10 as 4.1 in the marshalled output."}, {"owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "edited": false, "score": 0, "creation_date": 1462970544, "post_id": 37160793, "comment_id": 61861307, "body": "Is there anyway to stop this as this is a fee so currency, therefore it should display as 4.00 and 4.10?"}, {"owner": {"reputation": 963, "user_id": 385280, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/82d083ee140420fe7acde11d5109a311?s=128&d=identicon&r=PG", "display_name": "Venkat", "link": "https://stackoverflow.com/users/385280/venkat"}, "reply_to_user": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "edited": false, "score": 3, "creation_date": 1462971523, "post_id": 37160793, "comment_id": 61862212, "body": "While displaying, the client can format the value correctly."}], "tags": [], "owner": {"reputation": 963, "user_id": 385280, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/82d083ee140420fe7acde11d5109a311?s=128&d=identicon&r=PG", "display_name": "Venkat", "link": "https://stackoverflow.com/users/385280/venkat"}, "is_accepted": false, "score": 1, "last_activity_date": 1462964865, "creation_date": 1462964865, "answer_id": 37160793, "question_id": 37160126, "link": "https://stackoverflow.com/questions/37160126/golang-store-retrieve-decimal-from-mysql/37160793#37160793", "title": "Golang - Store / Retrieve decimal from MySQL", "body": "<p>Does <code>float32</code> pose any problems? Since MySQL uses 32 bits to store <code>DECIMAL</code>, <code>float32</code> should be good enough.</p>\n"}, {"tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": false, "score": 1, "last_activity_date": 1463026222, "creation_date": 1463026222, "answer_id": 37177092, "question_id": 37160126, "link": "https://stackoverflow.com/questions/37160126/golang-store-retrieve-decimal-from-mysql/37177092#37177092", "title": "Golang - Store / Retrieve decimal from MySQL", "body": "<p>For scanning MySQL values to Go vars the good practice is to use sql.Null... types. Especially when column is nullable.</p>\n\n<p>For decimals it can be sql.NullFloat64:</p>\n\n<pre><code>// ...\nvar dec sql.NullFloat64\nrow.Scan(&amp;dec)\n// dec.Valid - bool\n// dec.Float64 - float64\n</code></pre>\n"}], "owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5288, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1463026222, "creation_date": 1462963034, "last_edit_date": 1462971981, "question_id": 37160126, "link": "https://stackoverflow.com/questions/37160126/golang-store-retrieve-decimal-from-mysql", "title": "Golang - Store / Retrieve decimal from MySQL", "body": "<p>I am using the gin gonic framework and have built a JSON API.</p>\n\n<p>I have a new end point I want to make but one of the values is a decimal. I created the following struct:</p>\n\n<pre><code>type AcceptedTerms struct {\n    Id          int64           \n    FirstName   string          \n    LastName    string                    \n    Fee         ***DECIMAL***\n    Date        *time.Time\n}\n</code></pre>\n\n<p>My controller snippets of code:</p>\n\n<pre><code>    query = \"SELECT \" +\n            \"AcceptedTerms.* \" +\n            \"FROM AcceptedTerms \" +\n            \"ORDER BY \" + sort_by + \" \" + order_by +\n            \" LIMIT \" + limit2 +\n            \" OFFSET \" + offset2`\n</code></pre>\n\n<p><code>_, err := dbmap.Select(&amp;response.AcceptedTerms, query)</code></p>\n\n<p>What should I set the type to be for decimal? I want the user to be able to post decimals e.g. 10.44 or 12.00 etc rather than \"10.44\" or \"12.00\". I also want the value to be returned as above rather than as a string.</p>\n\n<p><strong>Update</strong></p>\n\n<p>I tried to do this to my Struct but it's still not displaying as 2 decimal places</p>\n\n<pre><code>type AcceptedTerms struct {\n    Id          int64\n    FirstName   string\n    LastName    string\n    Fee         Number\n    Date        *time.Time\n}\n\ntype Number float64\n\nfunc (n Number) MarshalJSON() ([]byte, error) {\n    return []byte(fmt.Sprintf(\"%.2f\", n)), nil\n}\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "ssh"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1462963865, "post_id": 37160099, "comment_id": 61856333, "body": "Send both commands to execute in series. The same way you would non-interactively with ssh from the command line."}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1462981587, "post_id": 37160099, "comment_id": 61870122, "body": "<code>cmd := &quot;show clock &amp;&amp; echo &#39;Hello World&#39; &amp;&amp; echo &#47;home&#47;root&#47;.ssh&#47;rsa&quot;</code> :)"}, {"owner": {"reputation": 103, "user_id": 4526405, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a3c5334eb1fe30f08ca0e5a8af2e0c0?s=128&d=identicon&r=PG&f=1", "display_name": "NoName2", "link": "https://stackoverflow.com/users/4526405/noname2"}, "edited": false, "score": 0, "creation_date": 1463043577, "post_id": 37160099, "comment_id": 61897336, "body": "The problem I am having, is cmd := &quot;cmd := enable&quot; but then I need to pass the password after I type enable your are asked for a password:"}], "owner": {"reputation": 103, "user_id": 4526405, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a3c5334eb1fe30f08ca0e5a8af2e0c0?s=128&d=identicon&r=PG&f=1", "display_name": "NoName2", "link": "https://stackoverflow.com/users/4526405/noname2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1462962951, "creation_date": 1462962951, "question_id": 37160099, "link": "https://stackoverflow.com/questions/37160099/passing-a-password-multiple-commands", "title": "Passing a password multiple commands", "body": "<p>I am having trouble doing multiple commands.</p>\n\n<p>For example in the below scenario, I can login into the router and execute the command.</p>\n\n<p>But how do I it for multiple commands.</p>\n\n<p>In my case, I need to do command \"enable\" first, pass the password and then run command \"show clock\"</p>\n\n<p>Any examples of this ?</p>\n\n<pre><code>package main\n\nimport (\n    \"byt\n\nes\"\n       \"golang.org/x/crypto/ssh\"\n        \"fmt\"\n        \"os\"\n        \"time\"\n    )\n\n    func executeCmd(cmd, hostname string, config *ssh.ClientConfig) string {\n        conn, _ := ssh.Dial(\"tcp\", hostname+\":22\", config)\n        session, _ := conn.NewSession()\n        defer session.Close()\n\n        var stdoutBuf bytes.Buffer\n        session.Stdout = &amp;stdoutBuf\n        session.Run(cmd)\n        return hostname + \": \" + stdoutBuf.String()\n    }\n\n        func main() {\n            cmd := \"show clock\"\n            hosts := os.Args[1:]\n            results := make(chan string, 90)\n            timeout := time.After(5 * time.Second)\n           config := &amp;ssh.ClientConfig{\n                User: \"test\",\n                Auth: []ssh.AuthMethod{\n                    ssh.Password(\"test\"),\n                },\n            }\n\n            for _, hostname := range hosts {\n                go func(hostname string) {\n                    results &lt;- executeCmd(cmd, hostname, config)\n                }(hostname)\n            }\n\n            for i := 0; i &lt; len(hosts); i++ {\n                select {\n                case res := &lt;-results:\n                    fmt.Print(res)\n                case &lt;-timeout:\n                    fmt.Println(\"Timed out!\")\n                    return\n                }\n            }\n        }\n</code></pre>\n"}, {"tags": ["go", "godeps"], "answers": [{"tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": true, "score": 2, "last_activity_date": 1462981428, "last_edit_date": 1462981428, "creation_date": 1462980617, "answer_id": 37167162, "question_id": 37158170, "link": "https://stackoverflow.com/questions/37158170/how-to-add-a-package-to-godeps/37167162#37167162", "title": "How to add a package to godeps", "body": "<p>Don't fight the tooling.  Let <code>godep</code> update your json file and vendor folder, no matter how much it disturbs your pristine <code>Godeps/godeps.json</code> file.</p>\n\n<pre><code>godep restore     // put everything in a known state\ngo get -u foo/bar // get new package\ngo test ./...     // make sure everything is up to snuff\ngo run main.go    // run your code\ngodep save ./...  // update `godeps.json` to current state of packages\n</code></pre>\n\n<p>If you use <code>go get -u foo/bar</code> for your new package, this only affects your new package of <code>foo/bar</code> - it does not update your existing packages. </p>\n\n<blockquote>\n  <p>The -u flag instructs get to use the network to update the named packages and their dependencies. By default, get uses the network to check out missing packages but does not use it to look for updates to existing packages.\n  <a href=\"https://golang.org/cmd/go/\" rel=\"nofollow\">https://golang.org/cmd/go/</a> </p>\n</blockquote>\n\n<p>As a side note, I recommend getting in the habit of using <code>godep</code> prefixes so not to disburb your <code>$GOPATH</code>:</p>\n\n<pre><code>go get -u foo/bar     // get new package\ngodep go test ./...   // test your package, using your /vendor deps\ngodep go run main.go  // run your code, using your /vendor deps\ngodep save ./...      // update godeps if everything checks out\n</code></pre>\n\n<p>It makes switching multiple repos much easier.</p>\n\n<p>Tip: make your configuration defaults sensible for your \"local development environment\" for your team.  E.g. DB username/password like \"dev/dev\" and so on.  That way, you don't have to pass parameters with <code>godep go run main.go</code>.  Nice and simple.</p>\n"}], "owner": {"reputation": 281, "user_id": 5075092, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh3.googleusercontent.com/-4KZSb7556Tw/AAAAAAAAAAI/AAAAAAAACbY/nNiDqiiiNE4/photo.jpg?sz=128", "display_name": "Manjunath Kumatagi", "link": "https://stackoverflow.com/users/5075092/manjunath-kumatagi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1802, "favorite_count": 0, "accepted_answer_id": 37167162, "answer_count": 1, "score": 2, "last_activity_date": 1462981428, "creation_date": 1462958318, "question_id": 37158170, "link": "https://stackoverflow.com/questions/37158170/how-to-add-a-package-to-godeps", "title": "How to add a package to godeps", "body": "<p>I Already have a existing project in github and have deps json file stored in Godeps folder and dependency packages in vendor folder.</p>\n\n<p>Now I need a way to add a new package to the list without effecting anything to the existing json file and vendor package folder</p>\n"}, {"tags": ["xcode", "go", "touch", "gomobile"], "answers": [{"tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": false, "score": 0, "last_activity_date": 1470948861, "creation_date": 1470948861, "answer_id": 38905971, "question_id": 37157959, "link": "https://stackoverflow.com/questions/37157959/gomobile-event-touch-packages/38905971#38905971", "title": "GOMobile &quot;event/touch&quot; Packages", "body": "<p>The examples in the gomobile repo cover this now. Specially this one: <code>golang.org/x/mobile/example/basic</code></p>\n"}], "owner": {"reputation": 1, "user_id": 3004478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2FJrJ.jpg?s=128&g=1", "display_name": "Nishant Kumbhare", "link": "https://stackoverflow.com/users/3004478/nishant-kumbhare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1470948861, "creation_date": 1462957829, "last_edit_date": 1463212939, "question_id": 37157959, "link": "https://stackoverflow.com/questions/37157959/gomobile-event-touch-packages", "title": "GOMobile &quot;event/touch&quot; Packages", "body": "<p>How can I use gomobile \"event/touch\" packages? I want to get respective touch co-ordinate, and this return touch co-ordinate will used in ios/android. </p>\n\n<p>Please suggest how to do this. If any sample application in available please suggest. </p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 728, "user_id": 1292467, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/5oSiH.png?s=128&g=1", "display_name": "Iakov Davydov", "link": "https://stackoverflow.com/users/1292467/iakov-davydov"}, "edited": false, "score": 0, "creation_date": 1465127011, "post_id": 37378589, "comment_id": 62762801, "body": "As far as I understand what you&#39;re suggesting (not pass the Go function, but a pointer to a struct with the function on it that you want) won&#39;t work, since the new cgo rules state:  <i>Go code may pass a Go pointer to C provided that the Go memory to which it points does not contain any Go pointers</i>.  On top of that a runtime checks are used to enforce the rule."}, {"owner": {"reputation": 1079, "user_id": 10696946, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--WSJZmA-_fk/AAAAAAAAAAI/AAAAAAAAAHg/0JsVC8j_zXk/photo.jpg?sz=128", "display_name": "Ank i zle", "link": "https://stackoverflow.com/users/10696946/ank-i-zle"}, "reply_to_user": {"reputation": 728, "user_id": 1292467, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/5oSiH.png?s=128&g=1", "display_name": "Iakov Davydov", "link": "https://stackoverflow.com/users/1292467/iakov-davydov"}, "edited": false, "score": 0, "creation_date": 1590216359, "post_id": 37378589, "comment_id": 109601650, "body": "@IakovDavydov I tried the first example, and it worked for me, maybe go allowed this now?"}], "tags": [], "owner": {"reputation": 3305, "user_id": 439189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a37ac47f749d07e74b36ecb1866a8265?s=128&d=identicon&r=PG", "display_name": "Ash Berlin-Taylor", "link": "https://stackoverflow.com/users/439189/ash-berlin-taylor"}, "is_accepted": false, "score": 1, "last_activity_date": 1463944702, "creation_date": 1463944702, "answer_id": 37378589, "question_id": 37157379, "link": "https://stackoverflow.com/questions/37157379/passing-function-pointer-to-the-c-code-using-cgo/37378589#37378589", "title": "passing function pointer to the C code using cgo", "body": "<p>It depends exactly what you need to do with the callback function - but a trick that might work is to not pass the Go function, but a pointer to a struct with the function on it that you want.</p>\n\n<p>For example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\n/*\nextern void go_callback_int(void*, int);\nstatic inline void CallMyFunction(void* pfoo) {\n    go_callback_int(pfoo, 5);\n}\n*/\nimport \"C\"\n\n//export go_callback_int\nfunc go_callback_int(pfoo unsafe.Pointer, p1 C.int) {\n    foo := (*Test)(pfoo)\n    foo.cb(p1)\n}\n\ntype Test struct {\n}\n\nfunc (s *Test) cb(x C.int) {\n    fmt.Println(\"callback with\", x)\n}\n\nfunc main() {\n    data := &amp;Test{}\n    C.CallMyFunction(unsafe.Pointer(&amp;data))\n}\n</code></pre>\n\n<p>Another option might be to use a global variable as you had in your example, and then forgo passing anything useful in the pointer to C.</p>\n\n<p>Like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\n/*\nextern void go_callback_int(void*, int);\nstatic inline void CallMyFunction(void* pfoo) {\n    go_callback_int(pfoo, 5);\n}\n*/\nimport \"C\"\n\n//export go_callback_int\nfunc go_callback_int(_ unsafe.Pointer, p1 C.int) {\n    MyCallbackFunc(p1)\n}\n\nfunc MyCallback(x C.int) {\n    fmt.Println(\"callback with\", x)\n}\n\n// we store it in a global variable so that the garbage collector\n// doesn't clean up the memory for any temporary variables created.\nvar MyCallbackFunc = MyCallback\n\nfunc main() {\n    C.CallMyFunction(nil)\n}\n</code></pre>\n\n<p>It possibly depends on what your C callback needs to do.</p>\n\n<p>If neither of these work it might be possible to do some tricks with channels to send the value you need (and keep it in scope).</p>\n"}, {"tags": [], "owner": {"reputation": 728, "user_id": 1292467, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/5oSiH.png?s=128&g=1", "display_name": "Iakov Davydov", "link": "https://stackoverflow.com/users/1292467/iakov-davydov"}, "is_accepted": true, "score": 11, "last_activity_date": 1558713552, "last_edit_date": 1558713552, "creation_date": 1465126895, "answer_id": 37641451, "question_id": 37157379, "link": "https://stackoverflow.com/questions/37157379/passing-function-pointer-to-the-c-code-using-cgo/37641451#37641451", "title": "passing function pointer to the C code using cgo", "body": "<p>Starting from Go 1.6 cgo has new rules.</p>\n\n<blockquote>\n  <p>Go code may pass a Go pointer to C provided that the Go memory to which it points does not contain any Go pointers.</p>\n</blockquote>\n\n<p><a href=\"https://github.com/golang/go/issues/12416\" rel=\"nofollow noreferrer\">[source]</a></p>\n\n<p>These rules are checked during the runtime, and if violated program crashes. At the moment it is possible to disable checks using <code>GODEBUG=cgocheck=0</code> environment variable. But in the future, that might stop working.</p>\n\n<p>So it is not possible anymore to pass a pointer to C code, if the memory to which it is pointing stores a Go function/method pointer. There are several ways to overcome this limitations, but I guess in most of them you should store a synchronized data structure which represents the correspondence between a certain id and the actual pointer. This way you can pass an id to the C code, not a pointer.</p>\n\n<p>The code solving this problem might look like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package gocallback\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\n/*\nextern void go_callback_int(int foo, int p1);\n\n// normally you will have to define function or variables\n// in another separate C file to avoid the multiple definition\n// errors, however, using \"static inline\" is a nice workaround\n// for simple functions like this one.\nstatic inline void CallMyFunction(int foo) {\n    go_callback_int(foo, 5);\n}\n*/\nimport \"C\"\n\n//export go_callback_int\nfunc go_callback_int(foo C.int, p1 C.int) {\n    fn := lookup(int(foo))\n    fn(p1)\n}\n\nfunc MyCallback(x C.int) {\n    fmt.Println(\"callback with\", x)\n}\n\nfunc Example() {\n    i := register(MyCallback)\n    C.CallMyFunction(C.int(i))\n    unregister(i)\n}\n\nvar mu sync.Mutex\nvar index int\nvar fns = make(map[int]func(C.int))\n\nfunc register(fn func(C.int)) int {\n    mu.Lock()\n    defer mu.Unlock()\n    index++\n    for fns[index] != nil {\n        index++\n    }\n    fns[index] = fn\n    return index\n}\n\nfunc lookup(i int) func(C.int) {\n    mu.Lock()\n    defer mu.Unlock()\n    return fns[i]\n}\n\nfunc unregister(i int) {\n    mu.Lock()\n    defer mu.Unlock()\n    delete(fns, i)\n}\n</code></pre>\n\n<p>This code comes from the (updated) <a href=\"https://github.com/golang/go/wiki/cgo#function-variables\" rel=\"nofollow noreferrer\">wiki page</a>.</p>\n"}], "owner": {"reputation": 728, "user_id": 1292467, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/5oSiH.png?s=128&g=1", "display_name": "Iakov Davydov", "link": "https://stackoverflow.com/users/1292467/iakov-davydov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9149, "favorite_count": 5, "accepted_answer_id": 37641451, "answer_count": 2, "score": 9, "last_activity_date": 1558713552, "creation_date": 1462956322, "last_edit_date": 1465162336, "question_id": 37157379, "link": "https://stackoverflow.com/questions/37157379/passing-function-pointer-to-the-c-code-using-cgo", "title": "passing function pointer to the C code using cgo", "body": "<p>Starting from Go v1.6 cgo changed the rules of passing pointers to the C code <a href=\"https://github.com/golang/go/issues/12416\" rel=\"noreferrer\">golang/go#12416</a>.\nThe example of invoking a dynamic Go callback from C code from the wiki  doesn't work anymore.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\n/*\n   extern void go_callback_int(void* foo, int p1);\n\n   // normally you will have to define function or variables\n   // in another separate C file to avoid the multiple definition\n   // errors, however, using \"static inline\" is a nice workaround\n   // for simple functions like this one.\n   static inline void CallMyFunction(void* pfoo) {\n       go_callback_int(pfoo, 5);\n       }\n*/\nimport \"C\"\n\n//export go_callback_int\nfunc go_callback_int(pfoo unsafe.Pointer, p1 C.int) {\n    foo := *(*func(C.int))(pfoo)\n    foo(p1)\n}\n\nfunc MyCallback(x C.int) {\n    fmt.Println(\"callback with\", x)\n}\n\n// we store it in a global variable so that the garbage collector\n// doesn't clean up the memory for any temporary variables created.\nvar MyCallbackFunc = MyCallback\n\nfunc Example() {\n    C.CallMyFunction(unsafe.Pointer(&amp;MyCallbackFunc))\n}\n\nfunc main() {\n    Example()\n}\n</code></pre>\n\n<p>The output looks like this:</p>\n\n<pre><code>panic: runtime error: cgo argument has Go pointer to Go pointer\n</code></pre>\n\n<p>What is the proper way to do this today? Preferably without hacks like hiding pointer from the language by converting it into uintptr_t.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 17491, "user_id": 901827, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86a6acccf7e8dbe398ebda4f8524ed50?s=128&d=identicon&r=PG", "display_name": "LinearZoetrope", "link": "https://stackoverflow.com/users/901827/linearzoetrope"}, "edited": false, "score": 1, "creation_date": 1462955764, "post_id": 37157173, "comment_id": 61850733, "body": "Also a labelled break"}], "tags": [], "owner": {"reputation": 7543, "user_id": 1794051, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fc6d765eadabca02bdd7b44d6504720?s=128&d=identicon&r=PG", "display_name": "val", "link": "https://stackoverflow.com/users/1794051/val"}, "is_accepted": false, "score": 1, "last_activity_date": 1462955806, "last_edit_date": 1462955806, "creation_date": 1462955671, "answer_id": 37157173, "question_id": 37156960, "link": "https://stackoverflow.com/questions/37156960/why-do-i-get-deadlock-in-my-go-program/37157173#37157173", "title": "Why do I get deadlock in my go program?", "body": "<p>Your <code>break</code> at the end of your program only breaks out of the <code>select</code> (and enters the loop again, hence the deadlock): replacing it with a <code>return</code> works fine: <a href=\"https://play.golang.org/p/j5bDaj3z7y\" rel=\"nofollow\">https://play.golang.org/p/j5bDaj3z7y</a></p>\n\n<p>Indeed, from the <a href=\"https://golang.org/ref/spec#Break_statements\" rel=\"nofollow\">specifications</a>:</p>\n\n<blockquote>\n  <p>A \"break\" statement terminates execution of the innermost \"for\", \"switch\", or \"select\" statement within the same function.</p>\n</blockquote>\n\n<p>You can get around that with a <code>return</code> (as I did), a goto, or some other architectural refactoring.</p>\n\n<p>As for the infinite loop, that's the same problem, instead that closed channel always return, so when <code>break</code>ing out of the <code>select</code>, you enter back the loop, and receive <code>nil</code>s from the closed channels forever</p>\n"}, {"tags": [], "owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "is_accepted": true, "score": 2, "last_activity_date": 1462955850, "creation_date": 1462955850, "answer_id": 37157233, "question_id": 37156960, "link": "https://stackoverflow.com/questions/37156960/why-do-i-get-deadlock-in-my-go-program/37157233#37157233", "title": "Why do I get deadlock in my go program?", "body": "<p>The reason you get a deadlock is that the <code>break</code> inside your <code>select</code> only breaks out of the <code>select</code>, leaving the <code>for</code> loop free to re-enter the select, where none of the channels are ready to read from.</p>\n\n<p>You could rescue this by doing something like:</p>\n\n<pre><code>done := false\n\nfor !done {\n        select {\n               ...\n        case &lt;-chClose:\n                done = true\n                fmt.Println(\"CLOSED\")\n        }\n}\n</code></pre>\n\n<p>This trivially allows the <code>for</code> loop to terminate.</p>\n\n<p>The other would be to use a label:</p>\n\n<pre><code>OuterLoop:\n        for {\n                select {\n                ...\n                case &lt;-chClose:\n                        fmt.Println(\"CLOSED\")\n                        break OuterLoop\n                }\n        }\n</code></pre>\n\n<p>I, personally, have a slight preference for the first version in this case, but that is merely a matter of taste.</p>\n"}], "owner": {"reputation": 14871, "user_id": 68287, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/4ceb58cf5b018085915f8f446b76665d?s=128&d=identicon&r=PG&f=1", "display_name": "Embedd_0913", "link": "https://stackoverflow.com/users/68287/embedd-0913"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 37157233, "answer_count": 2, "score": 0, "last_activity_date": 1462955850, "creation_date": 1462955123, "question_id": 37156960, "link": "https://stackoverflow.com/questions/37156960/why-do-i-get-deadlock-in-my-go-program", "title": "Why do I get deadlock in my go program?", "body": "<p>I am very new to golang programming and I have the following program which produces <code>deadlock</code>, I don't understand why ?</p>\n\n<p>Another thing is if I close the channel in <code>doAdd</code> method then I go into an infinite loop, that's also bit strange for me. </p>\n\n<p>Here is the program.</p>\n\n<pre><code>var wg sync.WaitGroup\n\nfunc main() {\n\n    ch1 := make(chan string)\n    ch2 := make(chan string)\n    ch3 := make(chan string)\n    chClose := make(chan bool)\n    wg.Add(3)\n    go doAdd(ch1, \"ch1\")\n    go doAdd(ch2, \"ch2\")\n    go doAdd(ch3, \"ch3\")\n\n    go waitForClose(chClose)\n\n    for {\n        select {\n        case x := &lt;-ch1:\n            fmt.Println(\"Got from ch1 \", x)\n        case y := &lt;-ch2:\n            fmt.Println(\"Got from ch2 \", y)\n        case z := &lt;-ch3:\n            fmt.Println(\"Got from ch3 \", z)\n        case &lt;-chClose:\n            fmt.Println(\"CLOSED\")\n            break\n        }\n    }\n}\n\nfunc waitForClose(chClose chan bool) {\n    wg.Wait()\n    chClose &lt;- true\n}\n\nfunc doAdd(ch chan string, name string) {\n    for i := 0; i &lt; 10; i++ {\n        ch &lt;- strconv.Itoa(i)\n    }\n    wg.Done()\n}\n</code></pre>\n\n<p>and the output is: </p>\n\n<pre><code>Got from ch1  0\nGot from ch1  1\nGot from ch1  2\nGot from ch1  3\nGot from ch1  4\nGot from ch1  5\nGot from ch1  6\nGot from ch1  7\nGot from ch1  8\nGot from ch1  9\nGot from ch2  0\nGot from ch2  1\nGot from ch2  2\nGot from ch2  3\nGot from ch2  4\nGot from ch2  5\nGot from ch2  6\nGot from ch2  7\nGot from ch2  8\nGot from ch2  9\nGot from ch3  0\nGot from ch3  1\nGot from ch3  2\nGot from ch3  3\nGot from ch3  4\nGot from ch3  5\nGot from ch3  6\nGot from ch3  7\nGot from ch3  8\nGot from ch3  9\nCLOSED\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [select]:\nmain.main()\n        c:/PraveenData/demo/go-work/main.go:29 +0x915\nexit status 2\n</code></pre>\n"}, {"tags": ["go", "syntax"], "comments": [{"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 1, "creation_date": 1462956887, "post_id": 37156922, "comment_id": 61851460, "body": "Do you mean like dumping a Struct and get all fields with name and also the type of field? It can be done using the reflection."}, {"owner": {"reputation": 2581, "user_id": 1682262, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0fe729661b718d6f6ba16ec8cf6b0e90?s=128&d=identicon&r=PG", "display_name": "Jason Xu", "link": "https://stackoverflow.com/users/1682262/jason-xu"}, "reply_to_user": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 0, "creation_date": 1462958842, "post_id": 37156922, "comment_id": 61852818, "body": "@Apin should be yes. forgot to mention, my scenarios is trying to code generate based on existing type, most of the time, struct. not sure if any handy way of doing this, I feel using reflect is possible but also significant detail to handle. So I&#39;m wondering if I missed any existing facility."}, {"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 0, "creation_date": 1463013246, "post_id": 37156922, "comment_id": 61885383, "body": "Better also to mention on your question, what kind input and also the output you want."}, {"owner": {"reputation": 2581, "user_id": 1682262, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0fe729661b718d6f6ba16ec8cf6b0e90?s=128&d=identicon&r=PG", "display_name": "Jason Xu", "link": "https://stackoverflow.com/users/1682262/jason-xu"}, "reply_to_user": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 0, "creation_date": 1463026039, "post_id": 37156922, "comment_id": 61888462, "body": "here&#39;s the example output. It&#39;s used to be part of a code generation tool. <a href=\"https://play.golang.org/p/LEJHEsmxQ3\" rel=\"nofollow noreferrer\">play.golang.org/p/LEJHEsmxQ3</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2581, "user_id": 1682262, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0fe729661b718d6f6ba16ec8cf6b0e90?s=128&d=identicon&r=PG", "display_name": "Jason Xu", "link": "https://stackoverflow.com/users/1682262/jason-xu"}, "edited": false, "score": 0, "creation_date": 1463110934, "post_id": 37199519, "comment_id": 61933795, "body": "Thanks for the example, I think I&#39;d go to roll own solution (based on ^) as can&#39;t found any existing lib doing this job in a more complete way."}], "tags": [], "owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "is_accepted": true, "score": 0, "last_activity_date": 1463100078, "last_edit_date": 1463100078, "creation_date": 1463099705, "answer_id": 37199519, "question_id": 37156922, "link": "https://stackoverflow.com/questions/37156922/code-generation-syntax-representation-of-go-type/37199519#37199519", "title": "code generation / syntax representation of Go type", "body": "<p>I write little reflection function that maybe it help you. Please check :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype S struct {\n    A string\n    B int\n    c bool\n    d float64\n    e struct {\n          f int\n      }\n}\n\nfunc main() {\n    var s S\n    MagicPrint(&amp;s)\n}\n\nfunc MagicPrint(t interface{}) {\n    typeOfT := reflect.TypeOf(t).Elem()\n    fmt.Println(\"type\", typeOfT.Name(), \" struct {\")\n\n    for i := 0; i &lt; typeOfT.NumField(); i++ {\n        f := typeOfT.Field(i)\n        fmt.Printf(\"%s %s\\n\", f.Name, f.Type)\n    }\n    fmt.Println(\"}\")\n}\n</code></pre>\n\n<p>Check in <a href=\"https://play.golang.org/p/bSnpJvMDux\" rel=\"nofollow\">Go Playground</a></p>\n"}], "owner": {"reputation": 2581, "user_id": 1682262, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0fe729661b718d6f6ba16ec8cf6b0e90?s=128&d=identicon&r=PG", "display_name": "Jason Xu", "link": "https://stackoverflow.com/users/1682262/jason-xu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 37199519, "answer_count": 1, "score": 0, "last_activity_date": 1463100078, "creation_date": 1462954981, "question_id": 37156922, "link": "https://stackoverflow.com/questions/37156922/code-generation-syntax-representation-of-go-type", "title": "code generation / syntax representation of Go type", "body": "<p>In Go std lib there're some way to pretty printing object into a Go-Syntax representation, for example,here'd how to pretty print a value,</p>\n\n<p><a href=\"https://play.golang.org/p/hztlPEf1If\" rel=\"nofollow\">https://play.golang.org/p/hztlPEf1If</a></p>\n\n<p>so is there any way to dump definition of a <em>type</em>? If no, what's the challenges behind to stop having this feature.</p>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1462954451, "post_id": 37156606, "comment_id": 61849902, "body": "duplicate with <a href=\"http://stackoverflow.com/questions/34079466/golang-embedded-struct\" title=\"golang embedded struct\">stackoverflow.com/questions/34079466/golang-embedded-struct</a>"}], "answers": [{"comments": [{"owner": {"reputation": 244, "user_id": 2909262, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/01810f33c8dd067f257fe3b66e04121f?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/2909262/nick"}, "edited": false, "score": 2, "creation_date": 1462954613, "post_id": 37156705, "comment_id": 61850018, "body": "Not to be rude, but you didn&#39;t read the question. I already tried exporting it, and the same exact error occurs. They are in the same package."}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 1, "last_activity_date": 1462954358, "creation_date": 1462954358, "answer_id": 37156705, "question_id": 37156606, "link": "https://stackoverflow.com/questions/37156606/calling-methods-from-derived-type-in-go/37156705#37156705", "title": "Calling methods from derived type in Go", "body": "<p>Please be aware that in Go in order to access a method from another package you need to export it, meaning that you have to capitalize the first letter of the method.</p>\n\n<pre><code>type Handler struct{\n    fields map[string]interface{}\n}\n\nfunc (handler *Handler) AddField(key string, value interface{}){ some code }\n</code></pre>\n\n<p>Then if your package is named as <code>stathandler</code> you can access the <code>AddField</code> method as:</p>\n\n<pre><code>stathandler.AddField(\"some field\", \"some value\")\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 244, "user_id": 2909262, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/01810f33c8dd067f257fe3b66e04121f?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/2909262/nick"}, "edited": false, "score": 0, "creation_date": 1462954685, "post_id": 37156742, "comment_id": 61850070, "body": "Ahh! I knew it was something obvious... I remember reading about this in the Go documentation but I must&#39;ve not understood it completely. Thanks for the help."}], "tags": [], "owner": {"reputation": 51929, "user_id": 1524450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSzDV.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1524450/michael"}, "is_accepted": true, "score": 4, "last_activity_date": 1462954447, "creation_date": 1462954447, "answer_id": 37156742, "question_id": 37156606, "link": "https://stackoverflow.com/questions/37156606/calling-methods-from-derived-type-in-go/37156742#37156742", "title": "Calling methods from derived type in Go", "body": "<p>In Go you'd typically do this through composition:</p>\n\n<pre><code>type StatHandler struct {\n    Handler  // Anonymous member of type Handler\n}\n\n// ...Later on\nvar stathandler StatHandler\nstathandler.addField(\"some field\", \"some value\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1480074272, "last_edit_date": 1480074272, "creation_date": 1462954688, "answer_id": 37156827, "question_id": 37156606, "link": "https://stackoverflow.com/questions/37156606/calling-methods-from-derived-type-in-go/37156827#37156827", "title": "Calling methods from derived type in Go", "body": "<p>A declared method belongs to a specific type. The <a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"nofollow noreferrer\"><code>type</code></a> keyword creates a <em>new</em> type which does not \"inherit\" methods of the type you used in the type specification.</p>\n\n<p>The method <code>addField()</code> you declared belongs to <code>Handler</code>, the type <code>StatHandler</code> does not have any methods because you haven't specified any methods with that as the receiver type.</p>\n\n<p>If you have a variable of type <code>StatHandler</code> and if you want to call the <code>addField()</code> method, you need to have a value of type <code>*Handler</code>. You may obtain such a value by using a <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">type conversion</a>, e.g.:</p>\n\n<pre><code>s := StatHandler{}\n(*Handler)(&amp;s).addField(\"somekey\", \"someval\")\n</code></pre>\n\n<p>Note that since <code>addField()</code> has pointer receiver, a pointer is required (hence the use of <code>&amp;</code> address operator), but then the <code>*StatHandler</code> can only be converted to <code>*Handler</code>.</p>\n\n<p>If you would have an <code>*StatHandler</code> pointer in the first place:</p>\n\n<pre><code>sp := &amp;StatHandler{}\n(*Handler)(sp).addField(\"somekey\", \"someval\")\n</code></pre>\n\n<p>Since new types do not \"inherit\" methods of the underlying type, you should consider <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\"><em>embedding</em></a> to achieve what you want, because methods and fields of an embedded type are <em>promoted</em> to the embedder type:</p>\n\n<pre><code>type StatHandler struct {\n    Handler // Embed Handler, so addField() method will be promoted\n}\n\ns2 := StatHandler2{}\ns2.addField(\"somekey\", \"someval\")\n</code></pre>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/uoov_FES1w\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>The exact definition of what methods a type has is covered in the spec: <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">Method sets</a>.</p>\n"}], "owner": {"reputation": 244, "user_id": 2909262, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/01810f33c8dd067f257fe3b66e04121f?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/2909262/nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 932, "favorite_count": 0, "accepted_answer_id": 37156742, "answer_count": 3, "score": 1, "last_activity_date": 1480074272, "creation_date": 1462954059, "question_id": 37156606, "link": "https://stackoverflow.com/questions/37156606/calling-methods-from-derived-type-in-go", "title": "Calling methods from derived type in Go", "body": "<p>I have two files, generic_handler.go, which essentially looks like this:</p>\n\n<pre><code>type Handler struct{\n    fields map[string]interface{}\n}\n\nfunc (handler *Handler) addField(key string, value interface{}){ some code }\n</code></pre>\n\n<p>And stat_handler.go:</p>\n\n<pre><code>type StatHandler Handler\n</code></pre>\n\n<p>When I try to call (from within the stat_handler.go file) the method like this, I get an error:</p>\n\n<pre><code>//inside some function\nstathandler.addField(\"some field\", \"some value\")\n</code></pre>\n\n<p>It errors out with <code>type StatHandler has no field or method addField</code>. This is the same even if I export <code>addField</code> by making it <code>AddField</code>. Both of these files reside in the same package.</p>\n\n<p>Is there something I am missing?</p>\n"}, {"tags": ["java", "sockets", "go", "server", "client"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1462954058, "post_id": 37156378, "comment_id": 61849640, "body": "Based on the attached image you are sending two separate strings and Go  you are receiving these strings as you expect (two separate strings)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1462954204, "post_id": 37156378, "comment_id": 61849755, "body": "<code>Conn.Read()</code> does not read until a newline is found, it may read any number of bytes between <code>0</code> and the length of the passed slice (see in <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a>). You may use <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"nofollow noreferrer\"><code>bufio.Scanner</code></a> to read whole lines."}, {"owner": {"reputation": 1, "user_id": 4185324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcffcac7e8b67e6970b483fd8b43631e?s=128&d=identicon&r=PG&f=1", "display_name": "Simon", "link": "https://stackoverflow.com/users/4185324/simon"}, "edited": false, "score": 0, "creation_date": 1462954339, "post_id": 37156378, "comment_id": 61849834, "body": "but im sending the message as one string. this is my code to call the sendDataToServer on Java side      System.out.println(&quot;Geben sie eine Nachricht ein:&quot;); \t\t\t\t\t\tString message = in.next(); \t\t\t\t\t\tdataController.sendDataToServer(socket, message); \t\t\t\t\t\tString received = dataController.recieveDataFromServer(socket); \t\t\t\t\t\tSystem.out.println(&quot;SERVER: &quot;+ received);                                                 i tried also with the bufio.Scanner but the solution i had didnt work. same problem."}], "answers": [{"tags": [], "owner": {"reputation": 303, "user_id": 6183754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52813b297245d1739ff722b9e5a51e82?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Guti&#233;rrez-Maturana S&#225;nc", "link": "https://stackoverflow.com/users/6183754/javier-guti%c3%a9rrez-maturana-s%c3%a1nc"}, "is_accepted": false, "score": 0, "last_activity_date": 1497362003, "last_edit_date": 1497362003, "creation_date": 1494110565, "answer_id": 43826043, "question_id": 37156378, "link": "https://stackoverflow.com/questions/37156378/golang-server-with-java-client/43826043#43826043", "title": "golang Server with Java Client", "body": "<p>You maybe need send first the number of bytes to read and later the bytes to read with io.ReadFull function... of this way you are sure that read all the string...</p>\n\n<p>ReadFull in go <a href=\"https://golang.org/pkg/io/https://golang.org/pkg/io/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/io/https://golang.org/pkg/io/</a></p>\n\n<p>ReadFully Java with DataInputStream : <a href=\"https://docs.oracle.com/javase/8/docs/api/\" rel=\"nofollow noreferrer\">https://docs.oracle.com/javase/8/docs/api/</a></p>\n\n<ul>\n<li><p>First read int with the number of bytes....</p></li>\n<li><p>Later read bytes with io.ReadFull method...</p></li>\n</ul>\n\n<p>NOTE : You need write the integers in bigendianess to java. </p>\n\n<pre><code>binary.Write(tx, binary.BigEndian, value)\n</code></pre>\n\n<p>My advice make the complex in go and read int and readFull bytes in java...</p>\n\n<p>NOTE : You can only simple write bytes in both directions if you need send images or some similar...</p>\n\n<p><a href=\"https://github.com/jgmatu/fichasAndroid/blob/master/server/protocol/messages.go\" rel=\"nofollow noreferrer\">Code to send and write bytes in Go</a></p>\n\n<p><a href=\"https://github.com/jgmatu/fichasAndroid/blob/master/Cards/app/src/main/java/es/urjc/mov/javsan/cards/protocol/Message.java\" rel=\"nofollow noreferrer\">Code to send and write bytes in Java</a></p>\n\n<p>I hope this help...</p>\n"}, {"tags": [], "owner": {"reputation": 171, "user_id": 6914680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbfe189eb8fbf0973db448cf097a7a88?s=128&d=identicon&r=PG&f=1", "display_name": "Parmatma", "link": "https://stackoverflow.com/users/6914680/parmatma"}, "is_accepted": false, "score": 0, "last_activity_date": 1497441819, "creation_date": 1497441819, "answer_id": 44544276, "question_id": 37156378, "link": "https://stackoverflow.com/questions/37156378/golang-server-with-java-client/44544276#44544276", "title": "golang Server with Java Client", "body": "<p>In this case i will suggest to use gRPC. here is the <a href=\"https://developers.google.com/protocol-buffers/docs/gotutorial\" rel=\"nofollow noreferrer\">documentation</a> </p>\n\n<p>and here is <a href=\"https://github.com/grpc/grpc-go\" rel=\"nofollow noreferrer\">gitrepo</a>. </p>\n\n<p>Use <a href=\"https://developers.google.com/protocol-buffers/docs/gotutorial\" rel=\"nofollow noreferrer\">protobuf</a> instead of JSON to define the contract of service.</p>\n\n<p>So you can use this service for other clients as well which may be in any language.</p>\n\n<p>and for implementing this you just need to extract your service  contract and generate your contract in client respective language.</p>\n\n<p>May be its little expensive in term of building but it will make your project reusable and definately you will learn something new. </p>\n"}], "owner": {"reputation": 1, "user_id": 4185324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcffcac7e8b67e6970b483fd8b43631e?s=128&d=identicon&r=PG&f=1", "display_name": "Simon", "link": "https://stackoverflow.com/users/4185324/simon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1245, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1497441819, "creation_date": 1462953361, "last_edit_date": 1463048492, "question_id": 37156378, "link": "https://stackoverflow.com/questions/37156378/golang-server-with-java-client", "title": "golang Server with Java Client", "body": "<p>I have a big problem....\nWe have a project on school and work as dou.\nI write the go server and my partner the java client.\nI have a problem that if he is sending something like: \"Hello World\" the golang server split this into \"Hello\" and \"World\"</p>\n\n<p><a href=\"http://i.stack.imgur.com/hJoUj.png\" rel=\"nofollow\">See Picture</a></p>\n\n<p>The Java Code:</p>\n\n<pre><code>public class DataController {\npublic String recieveDataFromServer(Socket socket) throws Exception {\n\n    BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(socket.getInputStream()));\n    while (!bufferedReader.ready()) { }\n    String data = bufferedReader.readLine();\n    return data;\n}\n\npublic void sendDataToServer(Socket socket, String data) throws Exception\n{\n    PrintWriter printWriter = new PrintWriter(socket.getOutputStream(), true);\n    printWriter.println(data);\n}\n}\n</code></pre>\n\n<p>The go Code:</p>\n\n<pre><code>func handleRequest(conn net.Conn) {\nrequest := make([]byte, 256)\n\nfor {\n    _, err := conn.Read(request)\n    if err != nil {\n        Error.Println(err.Error())\n        return\n    }               \n    Info.Println(\"Message Received: \" + string(request))\n    message := []byte(time.Now().String())\n    message = append(message, []byte(\": \")...)\n    message = append(message, request...)\n    broadcast(message)\n}\n}\n</code></pre>\n\n<p>The broadcast function just do a conn.Write(msg) for all the connections.</p>\n\n<p>Does anyone know that the problem is?</p>\n\n<p>Edit: I found the problem. Java add after each word a \\r\\n. Then the go server think the message ended. We switch now to c#. its easier and work correct while writing with a bufferedWriter to a socket.</p>\n"}, {"tags": ["curl", "go", "oauth", "authorization", "signature"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1462954925, "post_id": 37155381, "comment_id": 61850216, "body": "as you have a worked <code>curl</code>, why not to compose HTTP request rather than using libraries?"}], "answers": [{"tags": [], "owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "is_accepted": false, "score": 0, "last_activity_date": 1462965354, "creation_date": 1462965354, "answer_id": 37160987, "question_id": 37155381, "link": "https://stackoverflow.com/questions/37155381/golang-one-legged-two-legged-oauth-1-0a-authentication/37160987#37160987", "title": "Golang one-legged / two-legged oauth 1.0a authentication", "body": "<p>Golang has a different aproach for frameworks, for one reason, you do not need them. You can easyily set the header of the response with the standard http package. When you get the hang of it, you realize that you are dealing with first class objects, which is what those other language frameworks are trying to implement.</p>\n\n<p>Something like this function</p>\n\n<pre><code>  func saveHandler(w http.ResponseWriter, r *http.Request) {\n    // allow cross domain AJAX requests\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n}\n</code></pre>\n"}], "owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 976, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1462965354, "creation_date": 1462950302, "last_edit_date": 1462951518, "question_id": 37155381, "link": "https://stackoverflow.com/questions/37155381/golang-one-legged-two-legged-oauth-1-0a-authentication", "title": "Golang one-legged / two-legged oauth 1.0a authentication", "body": "<p>I am looking for a library to help me authenticate with a service via oauth 1.0a using one-legged authentication. I only have a <code>consumerKey</code>, <code>consumerSecret</code> and <code>resource url</code>.</p>\n\n<p>Examples are available in curl, PHP and Python. I am trying to authenticate with GoLang.</p>\n\n<pre><code>curl\n-X GET\n-H \"Content-Type: application/json\"\n-H 'Authorization: OAuth realm=\"https://example.com\",oauth_consumer_key=\"1234-5678-91011\",oauth_signature_method=\"HMAC-SHA1\",oauth_timestamp=\"1424789327\",oauth_nonce=\"abcde\",oauth_version=\"1.0\",oauth_signature=\"3iwWBq%2FHaBcDl9Q1o%2BjAc%2BKz8J%2FE%3D\"'\nhttps://example.com\n</code></pre>\n\n<p>php</p>\n\n<pre><code>require 'vendor/autoload.php';\n\nuse Guzzle\\Http\\Client;\nuse Guzzle\\Plugin\\Oauth\\OauthPlugin;\n\n$client = new Client('https://example.com');\n$oauth = new OauthPlugin(array(\n    'consumer_key'    =&gt; '1234-5648-9101',\n    'consumer_secret' =&gt; 'abcde',\n));\n$client-&gt;addSubscriber($oauth);\n\n$response = $client-&gt;get('/')-&gt;send();\necho $response-&gt;getBody();\n</code></pre>\n\n<p>Python</p>\n\n<pre><code>from requests_oauthlib import OAuth1Session\n\nkey = '1234-5648-9101'\nsecret = 'abcde'\nexample = OAuth1Session(key, client_secret=secret)\nurl = 'https://example.com'\nr = example.get(url)\nprint r._content\n</code></pre>\n\n<p>I have looked at many oauth libraries in Golang. </p>\n\n<p><a href=\"https://github.com/mrjones/oauth\" rel=\"nofollow\">https://github.com/mrjones/oauth</a>, requires: <code>RequestTokenUrl</code>, <code>AccessTokenUrl</code>, <code>AuthorizeTokenUrl</code> and <code>callback url</code>.</p>\n\n<p><a href=\"http://godoc.org/github.com/nhjk/oauth\" rel=\"nofollow\">http://godoc.org/github.com/nhjk/oauth</a>, requires: a <code>tokenKey</code> and <code>tokenSecret</code> as well as the <code>consumerKey</code> and <code>consumerSecret</code>.</p>\n\n<p>Is there a library I can use which will allow me to authenticate with the service just as easily as php and python examples above? If i can use one of libraries above, could somebody provide a code snippet example? Anything I try just returns unauthorized responses.</p>\n"}, {"tags": ["go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "edited": false, "score": 0, "creation_date": 1462946003, "post_id": 37153900, "comment_id": 61845097, "body": "I try this one o2: = bson.M { \t&quot;$project&quot;: bson.M { \t\t&quot;$answer&quot;: bson.M { \t\t\t&quot;_id&quot;: 1, \t\t\t&quot;title&quot;: 1, \t\t\t&quot;revision&quot;: 1, \t\t\t&quot;bgimageurl&quot;: 1, \t\t\t&quot;author&quot;: 1, \t\t\t&quot;postdatetime&quot;: 1, \t\t\t&quot;status&quot;: 1, \t\t\t&quot;qatags&quot;: 1, \t\t\t&quot;followers&quot;: 1, \t\t\t&quot;qaviews&quot;: 1, \t\t\t&quot;answer&quot;: bson.M { \t\t\t\t&quot;$filter&quot;: bson.M { \t\t\t\t\t&quot;input&quot;: &quot;$answer&quot;, \t\t\t\t\t&quot;as&quot;: &quot;ans&quot;, \t\t\t\t\t&quot;cond&quot;: bson.M { \t\t\t\t\t\t&quot;$eq&quot;: bson.M { \t\t\t\t\t\t\t&quot;$$ans.status&quot;, \t\t\t\t\t\t\t&quot;Active&quot;, \t\t\t\t\t\t}, \t\t\t\t\t}, \t\t\t\t}, \t\t\t},  \t\t}, \t}, }"}, {"owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "reply_to_user": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "edited": false, "score": 0, "creation_date": 1462946284, "post_id": 37153900, "comment_id": 61845234, "body": "Sorry about that, I have updated my answer some minutes ago"}, {"owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "edited": false, "score": 0, "creation_date": 1462948105, "post_id": 37153900, "comment_id": 61846052, "body": "I also try this one o2: = bson.M { \t&quot;$project&quot;: bson.M { \t\t&quot;$answer&quot;: bson.M { \t\t\t&quot;_id&quot;: 1, \t\t\t&quot;title&quot;: 1, \t\t\t&quot;revision&quot;: 1, \t\t\t&quot;bgimageurl&quot;: 1, \t\t\t&quot;author&quot;: 1, \t\t\t&quot;postdatetime&quot;: 1, \t\t\t&quot;status&quot;: 1, \t\t\t&quot;qatags&quot;: 1, \t\t\t&quot;followers&quot;: 1, \t\t\t&quot;qaviews&quot;: 1, \t\t\t&quot;answer&quot;: bson.M { \t\t\t\t&quot;$filter&quot;: bson.M { \t\t\t\t\t&quot;input&quot;: &quot;$answer&quot;, \t\t\t\t\t&quot;as&quot;: &quot;ans&quot;, \t\t\t\t\t&quot;cond&quot;: bson.M { \t\t\t\t\t\t&quot;$eq&quot;: bson.M[&quot;$$ans.status&quot;, &quot;Active&quot;, ], \t\t\t\t\t}, \t\t\t\t}, \t\t\t},  \t\t}, \t}, }"}, {"owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "edited": false, "score": 0, "creation_date": 1462948149, "post_id": 37153900, "comment_id": 61846070, "body": "it give me error syntax error: unexpected comma, expecting ]"}, {"owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "reply_to_user": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "edited": false, "score": 0, "creation_date": 1462948358, "post_id": 37153900, "comment_id": 61846199, "body": "Ops, I have updated my first answer but not the second, this code will back to the <code>Array</code> problem that I have mentioned, try to use <code>[]string{&quot;$$ans.status&quot;,&quot;Active&quot;,}</code> as I mentioned in first part. I will update the second part too."}, {"owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "reply_to_user": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "edited": false, "score": 0, "creation_date": 1462948704, "post_id": 37153900, "comment_id": 61846392, "body": "And after all, I would suggest you to start from simple query, eg, you should make sure your <code>$project</code> query is working before proceed to nested query, and also take note that <code>aggregation</code> need an <code>array</code>..."}, {"owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "edited": false, "score": 0, "creation_date": 1462948711, "post_id": 37153900, "comment_id": 61846394, "body": "after use this one o2 := bson.M{ \t\t&quot;$project&quot;:bson.M{ \t\t\t&quot;$answer&quot;:bson.M{ \t\t\t\t\t&quot;_id&quot;:1,&quot;title&quot;:1,&quot;revision&quot;:1,&quot;bgimageurl&quot;:1,&quot;author&quot;:&zwnj;&#8203;1,&quot;postdatetime&quot;:1,&quot;&zwnj;&#8203;status&quot;:1,&quot;qatags&quot;:1&zwnj;&#8203;,&quot;followers&quot;:1,&quot;qavi&zwnj;&#8203;ews&quot;:1,&quot;answer&quot;:bson&zwnj;&#8203;.M{ \t\t\t\t\t\t\t\t&quot;$filter&quot;:bson.M{&quot;input&quot;:&quot;$answer&quot;,&quot;as&quot;:&quot;ans&quot;,&quot;cond&quot;&zwnj;&#8203;:bson.M{&quot;$eq&quot;:[]stri&zwnj;&#8203;ng{&quot;$$ans.status&quot;,&quot;A&zwnj;&#8203;ctive&quot;,},},}, \t\t\t\t\t\t\t}, \t\t\t\t\t\t \t\t\t\t}, \t\t\t}, \t}"}, {"owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "edited": false, "score": 0, "creation_date": 1462948745, "post_id": 37153900, "comment_id": 61846419, "body": "error is $expressions are not allowed at the top-level of $project exit status 1"}, {"owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "reply_to_user": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "edited": false, "score": 0, "creation_date": 1462948989, "post_id": 37153900, "comment_id": 61846557, "body": "As mentioned in answer... <code>aggregation</code> need <code>array</code>, a simple way to do it is wrap your <code>o2</code> into an array: <code>someName := []bson.M{o2}</code>"}], "tags": [], "owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "is_accepted": true, "score": 3, "last_activity_date": 1462948415, "last_edit_date": 1462948415, "creation_date": 1462945175, "answer_id": 37153900, "question_id": 37153518, "link": "https://stackoverflow.com/questions/37153518/how-to-write-these-mongo-code-in-go/37153900#37153900", "title": "How to write these mongo code in go", "body": "<p>There are two errors in your code:</p>\n\n<h3>1. Array in bson.M</h3>\n\n<p><code>bson.M[\"$$ans.status\",\"Active\",]</code> will give you error like <code>Type bson.M is not an expression</code>, and since you are not required key-value pair in this case, an array of string would be a preferable case.</p>\n\n<p>Try:</p>\n\n<pre><code>[]string{\"$$ans.status\",\"Active\",}\n</code></pre>\n\n<h3>2. The comma</h3>\n\n<p>According to <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow\">https://golang.org/doc/effective_go.html</a>:</p>\n\n<blockquote>\n  <p>the lexer always inserts a semicolon after the token. This could be summarized as, \u201cif the newline comes after a token that could end a statement, insert a semicolon\u201d. </p>\n</blockquote>\n\n<p>If you are not appended a comma after <code>}</code>, lexer will insert a <code>;</code> for you, which will cause your current problem.</p>\n\n<pre><code>\"$filter\":bson.M{\"input\":\"$answer\",\"as\":\"ans\",\"cond\":bson.M{\"$eq\":bson.M{\"$$ans.status\",\"Active\",},},} // should add a comma at the end of the line\n</code></pre>\n\n<p>After modified:</p>\n\n<pre><code>\"$filter\":bson.M{\"input\":\"$answer\",\"as\":\"ans\",\"cond\":bson.M{\"$eq\":[]string{\"$$ans.status\",\"Active\",},},},\n</code></pre>\n\n<h3>Update</h3>\n\n<p>For your second question, <code>$expressions are not allowed at the top-level of $project</code>, please note that aggregation in <code>mongodb</code> only accept <code>array</code>, you can refer to this link <a href=\"https://docs.mongodb.com/v3.0/reference/operator/aggregation/\" rel=\"nofollow\">https://docs.mongodb.com/v3.0/reference/operator/aggregation/</a>:</p>\n\n<pre><code>db.collection.aggregate( [ { &lt;stage&gt; }, ... ] )\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "is_accepted": false, "score": 2, "last_activity_date": 1462951134, "creation_date": 1462951134, "answer_id": 37155664, "question_id": 37153518, "link": "https://stackoverflow.com/questions/37153518/how-to-write-these-mongo-code-in-go/37155664#37155664", "title": "How to write these mongo code in go", "body": "<blockquote>\n  <p>After doing all this one is working </p>\n</blockquote>\n\n<pre><code>o2 := bson.M{\n        \"$project\":bson.M{\"_id\":1,\"title\":1,\"postdatetime\":1,\"status\":1\"answer\":bson.M{\n                    \"$filter\":bson.M{\"input\":\"$answer\",\"as\":\"ans\",\"cond\":bson.M{\"$eq\":[]string{\"$$ans.status\",\"Active\",},},},},},}\n</code></pre>\n"}], "owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 886, "favorite_count": 2, "accepted_answer_id": 37153900, "answer_count": 2, "score": 1, "last_activity_date": 1462951134, "creation_date": 1462943319, "last_edit_date": 1462945507, "question_id": 37153518, "link": "https://stackoverflow.com/questions/37153518/how-to-write-these-mongo-code-in-go", "title": "How to write these mongo code in go", "body": "<blockquote>\n  <p><strong>My mongo File is here</strong></p>\n</blockquote>\n\n<pre><code> db.aaa.aggregate([{\n                $match : {\n                    status : \"Active\"\n                }\n            }, {\n                $project : {\n                    _id : 1,\n                    title : 1,\n                    postdatetime : 1,\n                    status : 1,\n                    answer : {\n                        $filter : {\n                            input : \"$answer\",\n                            as : \"answe\",\n                            cond : {\n                                $eq : [\"$$answe.status\", \"Active\"]\n                            }\n                        }\n                    }\n                }\n            }\n        ])\n</code></pre>\n\n<blockquote>\n  <p><strong>I try this one to write in go</strong></p>\n</blockquote>\n\n<pre><code>o2 := bson.M{\n    \"$project\":bson.M{\n        \"$answer\":bson.M{\n                \"_id\":1,\"title\":1,\"postdatetime\":1,\"status\":1,\"answer\":bson.M{\n                            \"$filter\":bson.M{\"input\":\"$answer\",\"as\":\"ans\",\"cond\":bson.M{\"$eq\":bson.M[\"$$ans.status\",\"Active\",],},}\n                        },\n\n            },\n        },\n}\n</code></pre>\n\n<blockquote>\n  <blockquote>\n    <p>But it show this on err\n     <strong>syntax error: unexpected comma, expecting ]</strong></p>\n  </blockquote>\n  \n  <p>Please Help me Out.</p>\n\n<pre><code>After the answer i try this one\n</code></pre>\n</blockquote>\n\n<pre><code>   o2: = bson.M {\n    \"$project\": bson.M {\n        \"$answer\": bson.M {\n            \"_id\": 1,\n            \"title\": 1,\n            \"revision\": 1,\n            \"bgimageurl\": 1,\n            \"author\": 1,\n            \"postdatetime\": 1,\n            \"status\": 1,\n            \"qatags\": 1,\n            \"followers\": 1,\n            \"qaviews\": 1,\n            \"answer\": bson.M {\n                \"$filter\": bson.M {\n                    \"input\": \"$answer\",\n                    \"as\": \"ans\",\n                    \"cond\": bson.M {\n                        \"$eq\": \"[$$ans.status][,Active]\",\n                    },\n                },\n            },\n\n        },\n    },\n}\n</code></pre>\n\n<blockquote>\n  <p>This time compile successfully but after running the go file send me this err msg  <strong>2016/05/11 11:04:17 $expressions are not allowed at the top-level of $project\n  exit status 1</strong></p>\n</blockquote>\n"}, {"tags": ["json", "go", "unmarshalling"], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": true, "score": -1, "last_activity_date": 1462935825, "creation_date": 1462935825, "answer_id": 37152400, "question_id": 37152092, "link": "https://stackoverflow.com/questions/37152092/what-is-a-good-way-to-handle-single-or-array-struct-in-golang-json-unmarshal/37152400#37152400", "title": "What is a good way to handle single or array struct in golang json.Unmarshal?", "body": "<p>control the unmarshal process with <code>UnmarshalJSON()</code> override.</p>\n\n<p><a href=\"https://play.golang.org/p/pCSgymQYC3\" rel=\"nofollow\">https://play.golang.org/p/pCSgymQYC3</a></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"encoding/json\"\n    \"bytes\"\n)\n\nconst(\n    s1=`{\"query\":{\"count\":1,\"created\":\"2016-05-11T02:12:33Z\",\"lang\":\"en-US\",\"results\":{\"quote\":{\"Change\":\"+0.21\",\"DaysLow\":\"9.32\",\"DaysHigh\":\"9.68\",\"Name\":\"Alcoa Inc. Common Stock\",\"Open\":\"9.56\",\"PreviousClose\":\"9.46\",\"Symbol\":\"aa\",\"Volume\":\"22266533\",\"PercentChange\":\"+2.22%\"}}}}`\n    s2=`{\"query\":{\"count\":2,\"created\":\"2016-05-11T02:17:48Z\",\"lang\":\"en-us\",\"results\":{\"quote\":[{\"Change\":\"+0.21\",\"DaysLow\":\"9.32\",\"DaysHigh\":\"9.68\",\"Name\":\"Alcoa Inc. Common Stock\",\"Open\":\"9.56\",\"PreviousClose\":\"9.46\",\"Symbol\":\"aa\",\"Volume\":\"22266533\",\"PercentChange\":\"+2.22%\"},{\"Change\":\"+0.63\",\"DaysLow\":\"92.11\",\"DaysHigh\":\"93.57\",\"Name\":\"Apple Inc.\",\"Open\":\"93.35\",\"PreviousClose\":\"92.79\",\"Symbol\":\"aapl\",\"Volume\":\"33686836\",\"PercentChange\":\"+0.68%\"}]}}}`\n)\ntype QueryResult struct {\n    //Id bson.ObjectId `bson:\"_id,omitempty\"`\n    Query Query `json:\"query\"`\n}\n\ntype Query struct {\n    Count int `json:\"count\"`\n    Created string `json:\"created\"`\n    Lang string `json:\"lang\"`\n    Results Quote `json:\"results\"`\n}\n\ntype structOrArray struct{\n    parent *Quote\n    s StockQuote\n    a []StockQuote\n}\n\nfunc (this *structOrArray)UnmarshalJSON(data []byte) error{\n    d := json.NewDecoder(bytes.NewBuffer(data))\n    t, err := d.Token();\n    if err != nil{\n        return err\n    }\n    if t==json.Delim('['){\n        if err := json.Unmarshal(data, &amp;this.a);err != nil {\n            return err\n        }\n        return nil\n    }\n    if err := json.Unmarshal(data, &amp;this.s);err != nil {\n        return err\n    }\n    return nil\n}\n\ntype fakeQuote struct{\n    Load structOrArray `json:\"quote\"` //Here is the difference. Do I need to re-write the whole struct in order to handle []\n}\ntype Quote struct {\n    Quote *StockQuote\n    Quotes []StockQuote\n}\nfunc (this *Quote)UnmarshalJSON(data []byte) error{\n    fq := fakeQuote{}\n    if err := json.Unmarshal(data, &amp;fq);err != nil{\n        return err\n    }\n    this.Quote = &amp;fq.Load.s\n    this.Quotes = fq.Load.a\n    return nil\n}\ntype StockQuote struct {\n    Change string `json:\"change\"`\n    PercentChange string `json:\"percentChange\"`\n    DaysLow string `json:\"daysLow\"`\n    DaysHigh string `json:\"daysHigh\"`\n    Open string `json:\"open\"`\n    PreviousClose string `json:\"previousClose\"`\n    Symbol string `json:\"symbol\"`\n    Name string `json:\"name\"`\n    Volume string `json:\"volume\"`\n}\nfunc main() {\n    r := QueryResult{}\n    err := json.Unmarshal([]byte(s1), &amp;r)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    log.Println(r.Query.Results.Quote)\n    log.Println(r.Query.Results.Quotes)\n\n    err = json.Unmarshal([]byte(s2), &amp;r)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    log.Println(r.Query.Results.Quote)\n    log.Println(r.Query.Results.Quotes)\n}\n</code></pre>\n"}], "owner": {"reputation": 84, "user_id": 2957225, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5f51e9f0a445c9fea1d9a947b4d43059?s=128&d=identicon&r=PG&f=1", "display_name": "Jay Chen", "link": "https://stackoverflow.com/users/2957225/jay-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 925, "favorite_count": 0, "accepted_answer_id": 37152400, "answer_count": 1, "score": 0, "last_activity_date": 1462952834, "creation_date": 1462933623, "last_edit_date": 1462952834, "question_id": 37152092, "link": "https://stackoverflow.com/questions/37152092/what-is-a-good-way-to-handle-single-or-array-struct-in-golang-json-unmarshal", "title": "What is a good way to handle single or array struct in golang json.Unmarshal?", "body": "<p>I am building a stock quote web app by using Go and Yahoo API.</p>\n\n<p>The question is how to switch between array and single struct without writing another struct. I am not sure how to explain it in words.\nHere is the example:</p>\n\n<p>Get one symbol quote from Yahoo API looks like this:</p>\n\n<pre><code>{\"query\":{\"count\":1,\"created\":\"2016-05-11T02:12:33Z\",\"lang\":\"en-US\",\"results\":{\"quote\":{\"Change\":\"+0.21\",\"DaysLow\":\"9.32\",\"DaysHigh\":\"9.68\",\"Name\":\"Alcoa Inc. Common Stock\",\"Open\":\"9.56\",\"PreviousClose\":\"9.46\",\"Symbol\":\"aa\",\"Volume\":\"22266533\",\"PercentChange\":\"+2.22%\"}}}}\n</code></pre>\n\n<p>Get multiple quotes from Yahoo API:</p>\n\n<pre><code>{\"query\":{\"count\":2,\"created\":\"2016-05-11T02:17:48Z\",\"lang\":\"en-us\",\"results\":{\"quote\":[{\"Change\":\"+0.21\",\"DaysLow\":\"9.32\",\"DaysHigh\":\"9.68\",\"Name\":\"Alcoa Inc. Common Stock\",\"Open\":\"9.56\",\"PreviousClose\":\"9.46\",\"Symbol\":\"aa\",\"Volume\":\"22266533\",\"PercentChange\":\"+2.22%\"},{\"Change\":\"+0.63\",\"DaysLow\":\"92.11\",\"DaysHigh\":\"93.57\",\"Name\":\"Apple Inc.\",\"Open\":\"93.35\",\"PreviousClose\":\"92.79\",\"Symbol\":\"aapl\",\"Volume\":\"33686836\",\"PercentChange\":\"+0.68%\"}]}}}\n</code></pre>\n\n<p>The difference is the quote becomes an array <code>[]</code>.</p>\n\n<p>How to handle it when using <code>json.Unmarshal(quoteResultRawJSON, &amp;queryResult)</code>?</p>\n\n<p>I have struct look like:</p>\n\n<pre><code>type QueryResult struct {\n  Id bson.ObjectId `bson:\"_id,omitempty\"`\n  Query Query `json:\"query\"`\n}\n\ntype Query struct {\n  Count int `json:\"count\"`\n  Created string `json:\"created\"`\n  Lang string `json:\"lang\"`\n  Results Quote `json:\"results\"`\n}\n\ntype Quote struct {\n  Quote StockQuote `json:\"quote\"` //Here is the difference. Do I need to re-write the whole struct in order to handle []\n}\n\ntype StockQuote struct {\n  Change string `json:\"change\"`\n  PercentChange string `json:\"percentChange\"`\n  DaysLow string `json:\"daysLow\"`\n  DaysHigh string `json:\"daysHigh\"`\n  Open string `json:\"open\"`\n  PreviousClose string `json:\"previousClose\"`\n  Symbol string `json:\"symbol\"`\n  Name string `json:\"name\"`\n  Volume string `json:\"volume\"`\n }\n</code></pre>\n\n<p>Do I have to write another struct to handle array?</p>\n"}, {"tags": ["go", "build", "compilation", "ignore"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 7, "creation_date": 1462909692, "post_id": 37147211, "comment_id": 61833291, "body": "If you want help update your question to post the minimum code to re-create the issue ... otherwise its hard to guess"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1462921580, "post_id": 37147211, "comment_id": 61838591, "body": "go build filename.go only builds that one file, and doesn&#39;t look at your other files.   Normally, you just want to do &quot;go install&quot; from the project dir and have it &quot;just work(tm)&quot; and install to $GOPATH/bin.  but if you really want to build a set of files, list all of them on the command line, like go build *.go  (but this is a bad habit to get in to)"}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1462976304, "post_id": 37147211, "comment_id": 61866242, "body": "I&#39;m not ok with you David, if I do &quot;go build main.go&quot; and in this file.go, I added an import such as algo, it will compiles both, I&#39;m doing that from the begining of my using of golang"}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1462989038, "post_id": 37147211, "comment_id": 61874756, "body": "@MaximeGuittet David is right in that go build main.go, only instructs the compiler to build one file. So it might be using the same binary of server.go each time that you build main. Because you are not telling it to do so."}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1462993885, "post_id": 37147211, "comment_id": 61877458, "body": "So you mean, if I understood, if I compile only one file which import another package, the package isn&#39;t compiled too? I mean I can&#39;t use a function in package algo from main by example?"}], "answers": [{"comments": [{"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1462976463, "post_id": 37149290, "comment_id": 61866355, "body": "Thank for you answer :) I didn&#39;t put code because it&#39;s not about the code, I think it&#39;s just about the file organization, because, I commented my code and it still compiles x) So It can&#39;t be about code, just maybe because some file aren&#39;t at the good place, like you explained, or because golang generated some temporary files :)"}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "reply_to_user": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 1, "creation_date": 1462990522, "post_id": 37149290, "comment_id": 61875642, "body": "@MaximeGuittet I think I solve your problem. I edited the post."}], "tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": true, "score": 4, "last_activity_date": 1499114760, "last_edit_date": 1499114760, "creation_date": 1462915775, "answer_id": 37149290, "question_id": 37147211, "link": "https://stackoverflow.com/questions/37147211/golang-doesnt-recompile-some-file/37149290#37149290", "title": "Golang doesn&#39;t recompile some file", "body": "<p>So I'm guessing that your dev tree looks something like this:</p>\n\n<pre><code>src\n\u251c\u2500\u2500\u2500algo\n\u251c\u2500\u2500\u2500database_sql\n\u251c\u2500\u2500\u2500github.com\n\u251c\u2500\u2500\u2500golang.org\n\u251c\u2500\u2500\u2500GoogleAPI\n\u251c\u2500\u2500\u2500googlemaps.github.io\n\u251c\u2500\u2500\u2500main\n\u251c\u2500\u2500\u2500main.go\n\u251c\u2500\u2500\u2500models\n\u251c\u2500\u2500\u2500myDebug\n\u251c\u2500\u2500\u2500router\n\u2514\u2500\u2500\u2500server\n    \u2514\u2500\u2500\u2500server.go\n</code></pre>\n\n<p>As you can see in <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>, you are supposed to have a folder for your project, so main.go should be <code>someproject/main.go</code> and you can then just use <code>go build</code> to build the entire project.</p>\n\n<p>Ideally you will want to have all your projects in a folder for their web address, like <code>github.com/yourname/projectname</code>. I recommend you follow this convention even if a specific project is not going to be publicly accessible. I keep all my projects (even the ones that are not in github) in my <code>github/my user</code> folder. This way it's easier to find and classify all you software.</p>\n\n<p>If you want to build a project and all of it's dependencies (in this case server/server.go) you can do <code>go build ./...</code></p>\n\n<p>You can also go into the server package and do  <code>go install</code> to install build and reinstall the package.</p>\n\n<p>So you should have something like this:</p>\n\n<pre><code>GOPATH\n\u251c\u2500\u2500\u2500bin\n|   \u2514\u2500\u2500\u2500main (this will have the name of the folder)\n\u251c\u2500\u2500\u2500pkg (this routes match the ones on src)\n|   \u2514\u2500\u2500\u2500linux_amd64\n|       \u2514\u2500\u2500\u2500server.a\n\u2514\u2500\u2500\u2500src\n    \u251c\u2500\u2500\u2500algo\n    \u251c\u2500\u2500\u2500database_sql\n    \u251c\u2500\u2500\u2500github.com\n    \u251c\u2500\u2500\u2500golang.org\n    \u251c\u2500\u2500\u2500GoogleAPI\n    \u251c\u2500\u2500\u2500googlemaps.github.io\n    \u251c\u2500\u2500\u2500main\n    |   \u2514\u2500\u2500\u2500main.go\n    \u251c\u2500\u2500\u2500models\n    \u251c\u2500\u2500\u2500myDebug\n    \u251c\u2500\u2500\u2500router\n    \u2514\u2500\u2500\u2500server\n        \u2514\u2500\u2500\u2500server.go\n</code></pre>\n\n<p>And then go to <code>src/main/</code> and do <code>go build ./...</code> to build all the dependencies. Ideally you will want to do <code>go install ./...</code> so that libraries are installed on the correct path, and your binaries also get created in the correct path and not in the <code>src</code> folder. If you do this, you will need to run the binary <code>bin/main</code>. I recommend that you add <code>GOPATH/bin</code> to your path so that you can install your software and just run it without going to the bin folder.</p>\n\n<p>Probably there is some error in the way you are importing or using the server package. This is the best I can do without you posting your code.</p>\n\n<p><strong>Edit:</strong> After further thinking about this, I believe I found the error. You were doing <code>go build</code> to build the whole project, and at some point you did <code>go install</code> on the server library. So now <code>go build</code> is using the already compiled version of the library in <code>pkg</code>, so if you want to fix the problem do <code>go install</code> on the server file or <code>go install ./...</code> on the main folder. </p>\n\n<p>This is not an error in Go, usually you don't want a change in a library to break your code, so you have to remember to install the new version of a library before trying your code.</p>\n"}], "owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6160, "favorite_count": 1, "accepted_answer_id": 37149290, "answer_count": 1, "score": 1, "last_activity_date": 1499114760, "creation_date": 1462908113, "last_edit_date": 1462909464, "question_id": 37147211, "link": "https://stackoverflow.com/questions/37147211/golang-doesnt-recompile-some-file", "title": "Golang doesn&#39;t recompile some file", "body": "<p>I just got an error:</p>\n\n<h1>server</h1>\n\n<p>server/server.go:73: undefined: foo.MyName</p>\n\n<p>I didn't understand at first and I tried to change the name of my function etc..\nSo I created a function called MyName() which return a string which is my name..</p>\n\n<p>But, the error just came up again.. After more than one hour, I just tried to comment all of my code in the package foo ! I wanted to say f**k that at this moment... #PS: I also comment the server.go:73 line.. and.. It compiles and totally works?!</p>\n\n<p>I commented my code, but it seems to be still here?! So now my question is:</p>\n\n<p>Does Golang have some problem to recompile some file?</p>\n\n<h1>-------------------------------------</h1>\n\n<p>Workspace</p>\n\n<pre><code>pkg\n\n    linux_amd64\n\nsrc\n\n   algo  database_sql  github.com  golang.org  GoogleAPI  googlemaps.github.io  main  main.go  models  myDebug  router  server\n</code></pre>\n\n<p>I'm making \"go build main.go\"</p>\n\n<p>I also read <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow\">How to Write Go Code</a> without find any solution...</p>\n\n<p>Some hints? Thank !</p>\n"}, {"tags": ["sql", "sqlite", "go"], "answers": [{"comments": [{"owner": {"reputation": 780, "user_id": 5261088, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8256e8a248d8bcde285d3b97f77e36b0?s=128&d=identicon&r=PG&f=1", "display_name": "MickeyThreeSheds", "link": "https://stackoverflow.com/users/5261088/mickeythreesheds"}, "edited": false, "score": 0, "creation_date": 1526848414, "post_id": 37146542, "comment_id": 87892306, "body": "Not sure why this is marked as the correct answer. This code does not work."}, {"owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "reply_to_user": {"reputation": 780, "user_id": 5261088, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8256e8a248d8bcde285d3b97f77e36b0?s=128&d=identicon&r=PG&f=1", "display_name": "MickeyThreeSheds", "link": "https://stackoverflow.com/users/5261088/mickeythreesheds"}, "edited": false, "score": 0, "creation_date": 1526904520, "post_id": 37146542, "comment_id": 87910365, "body": "Thanks for noticing it! Why did I post such code? :o"}], "tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": true, "score": 5, "last_activity_date": 1526904476, "last_edit_date": 1526904476, "creation_date": 1462905826, "answer_id": 37146542, "question_id": 37145935, "link": "https://stackoverflow.com/questions/37145935/checking-if-a-value-exists-in-sqlite-db-with-go/37146542#37146542", "title": "Checking if a value exists in sqlite db with Go", "body": "<p>Use <a href=\"https://golang.org/pkg/database/sql/#DB.QueryRow\" rel=\"nofollow noreferrer\"><code>QueryRow</code></a> to query at most one row. If the query doesn't return any row, it returns <code>sql.ErrNoRows</code>.</p>\n\n<pre><code>func UserExists(db * sql.DB, username string) bool {\n    sqlStmt := `SELECT username FROM userinfo WHERE username = ?`\n    err := db.QueryRow(sqlStmt, username).Scan(&amp;username)\n    if err != nil {\n        if err != sql.ErrNoRows {\n            // a real error happened! you should change your function return\n            // to \"(bool, error)\" and return \"false, err\" here\n            log.Print(err)\n        }\n\n        return false\n    }\n\n    return true\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 11919693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df89dfea56d1cf97326994d4ad162d85?s=128&d=identicon&r=PG&f=1", "display_name": "Robert Phillips", "link": "https://stackoverflow.com/users/11919693/robert-phillips"}, "is_accepted": false, "score": 1, "last_activity_date": 1586411889, "creation_date": 1586411889, "answer_id": 61114825, "question_id": 37145935, "link": "https://stackoverflow.com/questions/37145935/checking-if-a-value-exists-in-sqlite-db-with-go/61114825#61114825", "title": "Checking if a value exists in sqlite db with Go", "body": "<p>I know this is a bit old, but I don't see any clean answers here. Notice below the if rows.Next() statement which will return a boolean if there are any rows or not:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    _ \"github.com/mattn/go-sqlite3\"\n    \"log\"\n)\n\nfunc main() {\n    exists, _ := SelectDBRowExists(`SELECT * FROM GEO_VELOCITY_EVENTS WHERE USERNAME='bob'`)\n    log.Println(exists)\n}\n\nfunc SelectDBRowExists(query string) (bool, error) {\n\n    DbConn, err := sql.Open(\"sqlite3\", \"/path/to/your/sql.sqlite3\")\n    if err != nil {\n        return false, err\n    }\n    defer DbConn.Close()\n    err = DbConn.Ping()\n\n    if err != nil {\n        return false, err\n    }\n\n    rows, err := DbConn.Query(query)\n\n    if rows.Next() {\n        return true, nil\n    } else {\n        return false, nil\n    }\n\n    defer rows.Close()\n\n    return false, nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29, "user_id": 7853228, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Yk4zVMr8kxU/AAAAAAAAAAI/AAAAAAAAAEE/mVCZkdZoqso/photo.jpg?sz=128", "display_name": "Fath", "link": "https://stackoverflow.com/users/7853228/fath"}, "is_accepted": false, "score": 1, "last_activity_date": 1605083740, "creation_date": 1605083740, "answer_id": 64782999, "question_id": 37145935, "link": "https://stackoverflow.com/questions/37145935/checking-if-a-value-exists-in-sqlite-db-with-go/64782999#64782999", "title": "Checking if a value exists in sqlite db with Go", "body": "<p>as long as you are only concerned about the existence of one single information in the Database. I found that this method is quite simpler and efficient.</p>\n<pre><code>func emailExists(email string) bool {\n    row := db.QueryRow(&quot;select user_email from users where user_email= ?&quot;, email)\n    checkErr(err)\n    temp := &quot;&quot;\n    row.Scan(&amp;temp)\n    if temp != &quot;&quot; {\n        return true\n    }\n    return false\n}\n</code></pre>\n<p>if u noticed am only getting a single row.\nthe result of my Query gets scanned in a temp Variable.</p>\n<p>then I check whether the temp Variable is empty or not.</p>\n<p>if it is not empty, true is returned.</p>\n"}], "owner": {"reputation": 676, "user_id": 1609380, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/97760e811af951a6b383a18865affefa?s=128&d=identicon&r=PG", "display_name": "cowlicks", "link": "https://stackoverflow.com/users/1609380/cowlicks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6048, "favorite_count": 1, "accepted_answer_id": 37146542, "answer_count": 3, "score": 1, "last_activity_date": 1605083740, "creation_date": 1462903665, "question_id": 37145935, "link": "https://stackoverflow.com/questions/37145935/checking-if-a-value-exists-in-sqlite-db-with-go", "title": "Checking if a value exists in sqlite db with Go", "body": "<p>I'm writing code to manage users in a sqlite database with Go.</p>\n\n<p>I'm trying to check if a username is taken, but my code is ugly.</p>\n\n<p>My table looks like:</p>\n\n<pre><code>    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    username TEXT UNIQUE,\n    password TEXT\n</code></pre>\n\n<p>And I check if a username is taken with:</p>\n\n<pre><code>func UserExists(db * sql.DB, username string) bool {\n    sqlStmt := `SELECT username FROM userinfo WHERE username = ?`\n    count := 0\n    rows, err := db.Query(sqlStmt, username)\n    Check(err)\n    for rows.Next() {  // Can I just check if rows is non-zero somehow?\n        count++\n    }\n    return len(rows) != 0\n}\n</code></pre>\n\n<p>Is there a better query I could use that would tell me if the username value exists in the table in a more staight forward way? Or is there a nicer way to check if <code>rows</code> is non-zero?</p>\n"}, {"tags": ["go", "godeps"], "answers": [{"tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": true, "score": 0, "last_activity_date": 1462923875, "last_edit_date": 1462923875, "creation_date": 1462923423, "answer_id": 37150653, "question_id": 37145287, "link": "https://stackoverflow.com/questions/37145287/godeps-development-flow/37150653#37150653", "title": "Godeps development flow?", "body": "<p>One option:</p>\n\n<pre><code>git pull\ngodep restore\ngo get -u foo/bar // -u updates\ngo test ./...\ngo run main.go\ngodep save ./...\n</code></pre>\n\n<p>But, I don't like restoring to my GOPATH in disconnected HEAD states of git, since I contribute to several other repos (and have gotten errors in the past with this) directly within my GOPATH. </p>\n\n<p>So I usually do this:</p>\n\n<pre><code>git pull\ngo get -u foo/bar\ngodep update foo/bar\ngodep go test ./...\ngodep go run main.go\n</code></pre>\n\n<p>Using <code>godep</code> as a prefix changes the $GOPATH for go-related functions.  </p>\n\n<p>TIP: set all the <code>flags</code> of your main executable with sensible defaults, for all developers.  That way they don't need to pass custom parameters just for local development.</p>\n"}], "owner": {"reputation": 2903, "user_id": 1363968, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/aead7eb0767fb1643bb7701a5f1c3282?s=128&d=identicon&r=PG&f=1", "display_name": "r123454321", "link": "https://stackoverflow.com/users/1363968/r123454321"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 37150653, "answer_count": 1, "score": 3, "last_activity_date": 1462923875, "creation_date": 1462901544, "question_id": 37145287, "link": "https://stackoverflow.com/questions/37145287/godeps-development-flow", "title": "Godeps development flow?", "body": "<p>Bit confused with Godeps in general. Say I'm contributing Go code to a central repository, and now I need to pull the code and contribute my own code changes. What would be the correct <code>godep</code> flow?</p>\n\n<p>Would it be:</p>\n\n<pre><code>git pull  // pull latest master\ngodep restore // Install the package versions specified in Godeps/Godeps.json to $GOPATH\ngo get foo/bar  // Get package foo/bar and edit your code to import foo/bar\ngodep save ./...  // Saves dependencies\n// Then, check into source control\n</code></pre>\n"}, {"tags": ["testing", "go"], "answers": [{"tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": true, "score": 3, "last_activity_date": 1462983338, "last_edit_date": 1462983338, "creation_date": 1462924957, "answer_id": 37150893, "question_id": 37143935, "link": "https://stackoverflow.com/questions/37143935/how-should-i-unit-test-middleware-packages-with-gorilla-context/37150893#37150893", "title": "How should I unit test middleware packages with gorilla context", "body": "<p>I would not test anything involving Gorilla or any other 3rd party package.  If you want to test to make sure it works, i'd setup some external test runner or integration suite for the endpoints of a running version of your app (e.g. a C.I. server).</p>\n\n<p>Instead, test your Middleware and Handlers individually - as those you have control over.</p>\n\n<p>But, if you are set on testing the stack (mux -> handler -> handler -> handler -> MyHandler), this is where defining the middleware globally using <em>functions as vars</em> could help:</p>\n\n<pre><code>var addCors = func(h http.Handler) http.Handler {\n  ...\n}\n\nvar checkAPIKey = func(h http.Handler) http.Handler {\n  ...\n}\n</code></pre>\n\n<p>During normal use, their implementation remains the same with change.</p>\n\n<pre><code>r.Handle(\"/documents\", addCors(checkAPIKey(getDocuments(sendJSON)))).Methods(\"GET\")\n</code></pre>\n\n<p>But for unit testing, you can override them:</p>\n\n<pre><code>// important to keep the same package name for\n// your test file, so you can get to the private\n// vars.\npackage main\n\nimport (\n  \"testing\"\n)\n\nfunc TestXYZHandler(t *testing.T) {\n\n  // save the state, so you can restore at the end\n  addCorsBefore := addCors\n  checkAPIKeyBefore := checkAPIKey\n\n  // override with whatever customization you want\n  addCors = func(h http.Handler) http.Handler {\n    return h\n  }\n  checkAPIKey = func(h http.Handler) http.Handler {\n    return h\n  }\n\n  // arrange, test, assert, etc.\n  //\n\n  // when done, be a good dev and restore the global state\n  addCors = addCorsBefore\n  checkAPIKey = checkAPIKeyBefore\n}\n</code></pre>\n\n<p>If you find yourself copy-n-pasting this boiler plate code often, move it to a global pattern within your unit tests:</p>\n\n<pre><code>package main\n\nimport (\n  \"testing\"\n)\n\nvar (\n  addCorsBefore = addCors\n  checkAPIKeyBefore = checkAPIKey\n)\n\nfunc clearMiddleware() {\n  addCors = func(h http.Handler) http.Handler {\n    return h\n  }\n  checkAPIKey = func(h http.Handler) http.Handler {\n    return h\n  }\n}\n\nfunc restoreMiddleware() {\n  addCors = addCorsBefore\n  checkAPIKey = checkAPIKeyBefore\n}\n\nfunc TestXYZHandler(t *testing.T) {\n\n  clearMiddleware()\n\n  // arrange, test, assert, etc.\n  //\n\n  restoreMiddleware()\n}\n</code></pre>\n\n<p>A side note on unit testing end points...  </p>\n\n<p>Since middleware should operate with sensible defaults (expected to pass normally and not mutex state of the underlying stream of data you want to test in func), I advise to unit test the middleware outside of the context of your actual main Handler function.</p>\n\n<p>That way, you have one set of unit tests strictly for your middleware.  And another set of tests focusing purely on the primary Handler of the url you are calling.  It makes discovering the code much easier for newcomers.</p>\n"}], "owner": {"reputation": 1967, "user_id": 1629858, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f5d7530121bfe0f8999aa67401b87344?s=128&d=identicon&r=PG", "display_name": "Martijn van Maasakkers", "link": "https://stackoverflow.com/users/1629858/martijn-van-maasakkers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1066, "favorite_count": 0, "accepted_answer_id": 37150893, "answer_count": 1, "score": 2, "last_activity_date": 1462983338, "creation_date": 1462896953, "question_id": 37143935, "link": "https://stackoverflow.com/questions/37143935/how-should-i-unit-test-middleware-packages-with-gorilla-context", "title": "How should I unit test middleware packages with gorilla context", "body": "<p>I have this net/http server setup with several middleware in a chain and I can't find examples on how I should test these...</p>\n\n<p>I am using basic net/http with the gorilla/mux router and one Handle looks somewhat like this:</p>\n\n<pre><code>r.Handle(\"/documents\", addCors(checkAPIKey(getDocuments(sendJSON)))).Methods(\"GET\")\n</code></pre>\n\n<p>In these I aggregate some data and supply them via Gorilla Context context.Set methods.</p>\n\n<p>Usually I test my http functions with httptest, and I hope to do it with these as well but I can't figure out how and I am curious as to what is the best way. Should I test each middleware seperately? Should I prefill the appropriate context values then when they are needed? Can I test this entire chain at once so I can just check desired states on input?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 7543, "user_id": 1794051, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fc6d765eadabca02bdd7b44d6504720?s=128&d=identicon&r=PG", "display_name": "val", "link": "https://stackoverflow.com/users/1794051/val"}, "is_accepted": true, "score": 7, "last_activity_date": 1462893820, "creation_date": 1462893820, "answer_id": 37142781, "question_id": 37142506, "link": "https://stackoverflow.com/questions/37142506/cant-get-concurrency-to-work-as-i-expect-it/37142781#37142781", "title": "Can&#39;t get concurrency to work as I expect it", "body": "<p>Your <code>broadcast</code> channel is <em>unbuffered</em>. This means that:</p>\n\n<ol>\n<li>You send the message to the <code>handle</code> channel: main goroutine blocks until...</li>\n<li>In the goroutine, the <code>select</code> case gets the message...</li>\n<li>And calls (in the goroutine) <code>handler</code>, which sends the message to the <code>broadcast</code> channel, blocking until...</li>\n</ol>\n\n<p>And that's it: your child goroutine is blocking, waiting on itself to pick the message. Concurrently, your main goroutine sleeps, then reaches the end of <code>main</code>, exits and terminates the program.</p>\n\n<p>You can 'solve' it in several ways:</p>\n\n<ul>\n<li>Make your <code>broadcast</code> channel buffered: this way, goroutine sends the message, which succeeds immediately, and returns in the <code>for</code> loop, selecting it back and printing as intended</li>\n<li>Make your <code>send</code> a (new) goroutine, either in <code>handler</code>, or by calling <code>go handler(m)</code> in your loop</li>\n<li>Have two different goroutines listen to <code>handler</code> and <code>broadcast</code></li>\n</ul>\n\n<p>Which one you choose depends on the exact problem you try to solve: in this tiny example, it's hard to find a 'best' one.</p>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 1, "accepted_answer_id": 37142781, "answer_count": 1, "score": 0, "last_activity_date": 1462893820, "creation_date": 1462893159, "question_id": 37142506, "link": "https://stackoverflow.com/questions/37142506/cant-get-concurrency-to-work-as-i-expect-it", "title": "Can&#39;t get concurrency to work as I expect it", "body": "<p>I am trying to understand why my code does not work, so I managed to recreate the problem in a simpler example.</p>\n\n<p>I expected this code to output the string \"broadcasted\", but it does not output anything.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype hub struct {\n    handle    chan []byte\n    broadcast chan []byte\n}\n\nfunc (h *hub) init() {\n    for {\n        select {\n        case m := &lt;-h.handle:\n            handler(m)\n        case _ = &lt;-h.broadcast:\n            fmt.Println(\"broadcasted\")\n        }\n    }\n}\n\nvar socketHub = hub{\n    handle:    make(chan []byte),\n    broadcast: make(chan []byte),\n}\n\nfunc main() {\n\n    go socketHub.init()\n\n    m := []byte(\"this is the message\")\n    socketHub.handle &lt;- m\n\n    time.Sleep(time.Second * 2)\n}\n\nfunc handler(m []byte) {\n    // Do some stuff.\n    socketHub.broadcast &lt;- m\n}\n</code></pre>\n\n<p>Why does this not work?</p>\n"}, {"tags": ["multithreading", "asynchronous", "go"], "comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 1, "creation_date": 1462893856, "post_id": 37142494, "comment_id": 61823952, "body": "If it returned from the called function, what would the goroutine be running?"}, {"owner": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1462893900, "post_id": 37142494, "comment_id": 61823980, "body": "I want it to send a UDP broadcast message over the network for a predefined amount of time, while doing other things."}, {"owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "edited": false, "score": 1, "creation_date": 1462895096, "post_id": 37142494, "comment_id": 61824807, "body": "Goroutines do continue running after you return from the function that called the goroutine (see my answer). What makes you think they don&#39;t do this?"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1462929996, "post_id": 37142494, "comment_id": 61840819, "body": "Goroutines have a lifecycle like Java&#39;s Daemon threads.  They don&#39;t stop the app from exiting but they do run as long as the their initial function doesn&#39;t exit (Runnable.run in java&#39;s case, or whatever function you called with &quot;go&quot; in go&#39;s case)"}], "answers": [{"tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": false, "score": 0, "last_activity_date": 1462899710, "last_edit_date": 1462899710, "creation_date": 1462893343, "answer_id": 37142568, "question_id": 37142494, "link": "https://stackoverflow.com/questions/37142494/make-goroutines-stay-running-after-returning-from-function/37142568#37142568", "title": "Make goroutines stay running after returning from function", "body": "<p>You can.</p>\n\n<p>If you want to have a <code>go-routine</code> running in background forever, you need to have some kind of infinite loop, with some kind of graceful stopping mechanism in place, usually via channel. And invoke the <code>go-routine</code> via some other function, so even after this other function terminates, your <code>go-routine</code> will still be running.</p>\n\n<p>For example:</p>\n\n<pre><code>// Go routine which will run indefinitely.\n// Unless you send a signal on quit channel.\nfunc goroutine(quit chan bool) {\n   for {\n      select {\n         case &lt;-quit:\n           fmt.Println(\"quit\")\n           return\n         default:\n           fmt.Println(\"Do your thing\")\n      }\n   }\n}\n\n// Go routine will still be running, \n// after you return from this function.\nfunc invoker() {\n     q := make(chan bool)\n     go goroutine(q)\n}\n</code></pre>\n\n<p>Here, you can call <code>invoker</code>, when you want to start the <code>go-routine</code>. And even after <code>invoker</code> returns, your go-routine will still be running in background.</p>\n\n<p>Only exception to this is, when <code>main</code> function returns all <code>go-routines</code> in the application will be terminated.</p>\n"}, {"comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 3, "creation_date": 1462894766, "post_id": 37143130, "comment_id": 61824560, "body": "Just not after the main function. Exiting the main function quits all threads and goroutines."}], "tags": [], "owner": {"reputation": 6345, "user_id": 483347, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c2d980bc16657b17b4869229796fcd9d?s=128&d=identicon&r=PG", "display_name": "weberc2", "link": "https://stackoverflow.com/users/483347/weberc2"}, "is_accepted": false, "score": 19, "last_activity_date": 1462894792, "last_edit_date": 1462894792, "creation_date": 1462894650, "answer_id": 37143130, "question_id": 37142494, "link": "https://stackoverflow.com/questions/37142494/make-goroutines-stay-running-after-returning-from-function/37143130#37143130", "title": "Make goroutines stay running after returning from function", "body": "<p>Goroutines <em>do</em> continue running after the function that invokes them exits: <a href=\"https://play.golang.org/p/Xusa-cwcZJ\" rel=\"noreferrer\">Playground</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc countToTen() chan bool {\n    done := make(chan bool)\n    go func() {\n        for i := 0; i &lt; 10; i++ {\n            time.Sleep(1 * time.Second)\n            fmt.Println(i)\n        }\n        done &lt;- true\n    }()\n    return done\n}\n\nfunc main() {\n    done := countToTen()\n    fmt.Println(\"countToTen() exited\")\n\n    // reading from the 'done' channel will block the main thread\n    // until there is something to read, which won't happen until\n    // countToTen()'s goroutine is finished\n    &lt;-done\n}\n</code></pre>\n\n<p>Note that we need to block the main thread until <code>countToTen()</code>'s goroutine completes. If we don't do this, the main thread will exit and all other goroutines will be stopped even if they haven't completed their task yet.</p>\n"}], "owner": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7769, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1462899710, "creation_date": 1462893118, "question_id": 37142494, "link": "https://stackoverflow.com/questions/37142494/make-goroutines-stay-running-after-returning-from-function", "title": "Make goroutines stay running after returning from function", "body": "<p>in Java I can make threads run for long periods of time and I don't need to stay within the function that started the thread.</p>\n\n<p>Goroutines, Go's answer to Threads seem to stop running after I return from the function that started the routine.</p>\n\n<p>How can I make these routines stay running and return from the calling function?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 4114, "user_id": 1059915, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6c5bf533354c7cdcd85ad8cb090473b6?s=128&d=identicon&r=PG", "display_name": "alpert", "link": "https://stackoverflow.com/users/1059915/alpert"}, "edited": false, "score": 0, "creation_date": 1462893056, "post_id": 37141991, "comment_id": 61823361, "body": "Wont {{ if lt .FileSize .minsize }} work?"}, {"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "reply_to_user": {"reputation": 4114, "user_id": 1059915, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6c5bf533354c7cdcd85ad8cb090473b6?s=128&d=identicon&r=PG", "display_name": "alpert", "link": "https://stackoverflow.com/users/1059915/alpert"}, "edited": false, "score": 0, "creation_date": 1462893874, "post_id": 37141991, "comment_id": 61823964, "body": "no, only &#39;lt .FileSize 9000&#39; work where 9000 is what I have minsize set to."}, {"owner": {"reputation": 4114, "user_id": 1059915, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6c5bf533354c7cdcd85ad8cb090473b6?s=128&d=identicon&r=PG", "display_name": "alpert", "link": "https://stackoverflow.com/users/1059915/alpert"}, "edited": false, "score": 0, "creation_date": 1462893951, "post_id": 37141991, "comment_id": 61824018, "body": "Is minsize an int?"}, {"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "reply_to_user": {"reputation": 4114, "user_id": 1059915, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6c5bf533354c7cdcd85ad8cb090473b6?s=128&d=identicon&r=PG", "display_name": "alpert", "link": "https://stackoverflow.com/users/1059915/alpert"}, "edited": false, "score": 0, "creation_date": 1462894320, "post_id": 37141991, "comment_id": 61824243, "body": "Yes, minsize is int as well as FileSize. But minsize is not part of pipeline like FileSize is"}, {"owner": {"reputation": 4114, "user_id": 1059915, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6c5bf533354c7cdcd85ad8cb090473b6?s=128&d=identicon&r=PG", "display_name": "alpert", "link": "https://stackoverflow.com/users/1059915/alpert"}, "edited": false, "score": 0, "creation_date": 1462894516, "post_id": 37141991, "comment_id": 61824377, "body": "To be honest I am not a expericed go user. I checked here: <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\">golang.org/pkg/html/template</a>. In Example if I add a new int variable like Num and pass it inside data {{if lt 5  .Num}} is working fine. Sorry I missing something completely."}], "answers": [{"comments": [{"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 1, "creation_date": 1463014253, "post_id": 37157523, "comment_id": 61885598, "body": "This doesn&#39;t really answers the question and it&#39;s not &quot;better&quot; to use JS in that situation. That will depend entirely in what data he is using and the question doesn&#39;t specifies that."}, {"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 0, "creation_date": 1463054190, "post_id": 37157523, "comment_id": 61905005, "body": "Right, in fact I ended up with workaround using regular expression to replace string &quot;-MINSIZE-&quot; in the template  &#39;tmplhtml = re.ReplaceAllString()&#39;"}], "tags": [], "owner": {"reputation": 134, "user_id": 1334914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1g1u.jpg?s=128&g=1", "display_name": "Mikhail Andrianov", "link": "https://stackoverflow.com/users/1334914/mikhail-andrianov"}, "is_accepted": true, "score": 0, "last_activity_date": 1462960418, "last_edit_date": 1462960418, "creation_date": 1462956659, "answer_id": 37157523, "question_id": 37141991, "link": "https://stackoverflow.com/questions/37141991/how-to-use-arithmetic-operator-in-golang-html-template/37157523#37157523", "title": "How to use arithmetic operator in golang html template", "body": "<p>Akama Razor tells me, that you don't need to use GO code here. \nit's much better to use JS in such situation. </p>\n\n<p>Good luck! </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>s = document.getElementsByTagName('td');\r\n\r\nfor (i = 0; i &lt; s.length; i++) {\r\n  if (parseInt(s[i].innerText) &gt; 123) {\r\n    s[i].style = 'color:red';\r\n  }\r\n}</code></pre>\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;head lang=\"en\"&gt;\r\n  &lt;title&gt;123&lt;/title&gt;\r\n&lt;/head&gt;\r\n\r\n&lt;body&gt;\r\n  &lt;table&gt;\r\n    &lt;tbody&gt;\r\n      &lt;tr&gt;\r\n        &lt;td&gt;123&lt;/td&gt;\r\n        &lt;td&gt;1234&lt;/td&gt;\r\n      &lt;/tr&gt;\r\n    &lt;/tbody&gt;\r\n  &lt;/table&gt;\r\n  &lt;script&gt;\r\n    s = document.getElementsByTagName('td');\r\n    for (i = 0; i &lt; s.length; i++) {\r\n      if (parseInt(s[i].innerText) &gt; 123) {\r\n        s[i].color = '#fff';\r\n      }\r\n    }\r\n  &lt;/script&gt;\r\n&lt;/body&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": false, "score": 1, "last_activity_date": 1463014495, "creation_date": 1463014495, "answer_id": 37175564, "question_id": 37141991, "link": "https://stackoverflow.com/questions/37141991/how-to-use-arithmetic-operator-in-golang-html-template/37175564#37175564", "title": "How to use arithmetic operator in golang html template", "body": "<p>The issue is the <code>*</code> in your <code>minsize</code> variable. If you are trying to dereference a pointer you have to do that in the go code, not in the template. That's why <code>9000</code> worked and the <code>*minsize</code> didn't.</p>\n"}], "owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1265, "favorite_count": 0, "accepted_answer_id": 37157523, "answer_count": 2, "score": 0, "last_activity_date": 1463014495, "creation_date": 1462891788, "last_edit_date": 1462959012, "question_id": 37141991, "link": "https://stackoverflow.com/questions/37141991/how-to-use-arithmetic-operator-in-golang-html-template", "title": "How to use arithmetic operator in golang html template", "body": "<p>I want to compare field 'FileSize' in my html go temple with variable 'minsize' in my code (.FileSize &lt; *minsize). I have no idea how to do it. See below</p>\n\n<pre><code>{{ if lt .FileSize *minsize }}\n&lt;td style=\"color:red;\"&gt;{{.FileSize}}&lt;/td&gt;\n{{else}}\n&lt;td&gt;{{.FileSize}}&lt;/td&gt;\n{{end}}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1462888907, "post_id": 37140711, "comment_id": 61820211, "body": "The first example is missing an <code>if</code>. The second example won&#39;t have the exact same error, so make sure your code is saved, and show the error you&#39;re getting."}, {"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1462889030, "post_id": 37140711, "comment_id": 61820314, "body": "You are absolutely right. The second one gave &quot;.\\messageHandler.go:20: dt declared and not used&quot;"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1462889097, "post_id": 37140711, "comment_id": 61820350, "body": "Then you haven&#39;t used <code>dt</code>. show a complete example if you&#39;re not sure what that means."}, {"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1462890729, "post_id": 37140711, "comment_id": 61821553, "body": "I understand, thanks for the help!"}], "answers": [{"tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": true, "score": 0, "last_activity_date": 1463039479, "last_edit_date": 1463039479, "creation_date": 1463026734, "answer_id": 37177190, "question_id": 37140711, "link": "https://stackoverflow.com/questions/37140711/stuck-at-go-syntax-error-that-i-cant-see/37177190#37177190", "title": "Stuck at Go syntax error that I can&#39;t see", "body": "<p>This code doesn't throw any error:</p>\n\n<pre><code>if flt, ok := data[\"type\"].(float64); ok {\n    dt = int64(flt)\n}\n</code></pre>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "accepted_answer_id": 37177190, "answer_count": 1, "score": -2, "last_activity_date": 1463039479, "creation_date": 1462888676, "question_id": 37140711, "link": "https://stackoverflow.com/questions/37140711/stuck-at-go-syntax-error-that-i-cant-see", "title": "Stuck at Go syntax error that I can&#39;t see", "body": "<p>I am getting a syntax error and I can't figure out why. I have tried several variations but no success.</p>\n\n<pre><code>type dataType int64\n\nconst (\n    PM_SENT dataType = iota + 1\n    PM_VIEWED\n)\n\nfunc messageHandler(m []byte) error {\n    var data map[string]interface{}\n    if err := json.Unmarshal(m, &amp;data); err != nil {\n        return err\n    }\n\n    var dt dataType\n    flt, ok := data[\"type\"].(float64); ok {\n        dt = dataType(flt)\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>I am getting this error:</p>\n\n<pre><code>.\\messageHandler.go:23: syntax error: unexpected =, expecting comma or }\n</code></pre>\n\n<p>Even if I change to this I still get the same error:</p>\n\n<pre><code>var dt int64\nflt, ok := data[\"type\"].(float64)\nif ok {\n    dt = int64(flt)\n}\n</code></pre>\n"}, {"tags": ["c", "arrays", "go", "slice"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1462889796, "post_id": 37139950, "comment_id": 61820861, "body": "First, you should create the slice with <code>(*[1 &lt;&lt; 30]C.virNodeCPUStatsPtr)(unsafe.Pointer(params))[:4:4]</code>. The fault is at the address <code>0x6c656e72656b</code>, which is the value in the params pointer, so there&#39;s a problem with how you&#39;re calling <code>virNodeGetCPUStats</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1462930693, "post_id": 37139950, "comment_id": 61841004, "body": "You&#39;re casting a <code>**C.virNodeCPUStatsPtr</code> as a <code>*C.virNodeCPUStats</code>, that can&#39;t be correct. The type <code>virNodeCPUStatsPtr</code> doesn&#39;t exist in the C code, are you sure you don&#39;t just need to use <code>*C.virNodeCPUStats</code>?"}], "owner": {"reputation": 31, "user_id": 4884201, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uhG5M.jpg?s=128&g=1", "display_name": "tugba", "link": "https://stackoverflow.com/users/4884201/tugba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 343, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1462886742, "creation_date": 1462886742, "question_id": 37139950, "link": "https://stackoverflow.com/questions/37139950/iterating-over-c-array-in-go", "title": "Iterating over C array in Go", "body": "<p>I am trying to write bindings to a C library. The code is invoked as follows in C:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;libvirt/libvirt.h&gt;\n#include &lt;string.h&gt;\n\n\nint main(int argc, char *argv[])\n{\n    virConnectPtr conn;\n\n    conn = virConnectOpen(\"qemu:///system\");\n    if (conn == NULL) {\n        fprintf(stderr, \"Failed to open connection to qemu:///system\\n\");\n        return 1;\n    }\n\n\n    int nparams = 0;\n    virNodeCPUStats* params = malloc(sizeof(virNodeCPUStats) * nparams);\n    memset(params, 0, sizeof(virNodeCPUStats) * nparams);\n\n    int cpuNum = VIR_NODE_CPU_STATS_ALL_CPUS;\n\n    if (virNodeGetCPUStats(conn, cpuNum, NULL, &amp;nparams, 0) == 0 &amp;&amp;\n        nparams != 0) {\n        if ((params = malloc(sizeof(virNodeCPUStats) * nparams)) == NULL)\n            goto error;\n\n        memset(params, 0, sizeof(virNodeCPUStats) * nparams);\n        if (virNodeGetCPUStats(conn, cpuNum, params, &amp;nparams, 0))\n            goto error;\n    }\n\n\n    int err = virNodeGetCPUStats(conn, cpuNum, params, &amp;nparams, 0);\n    printf(\"ret code %d\\n\", err);\n    printf(\"%d nparams\\n\", nparams);\n\n    int i = 0;\n    for(i = 0; i &lt; nparams; i++){\n        printf(\"%s value\\n\", params[i].field);\n        printf(\"%llu value\\n\", params[i].value);        \n    }\n\n    fflush(stdout);\n\nerror:\n    virConnectClose(conn);\n    return 0;\n}\n</code></pre>\n\n<p>As you see, you first call virNodeGetCPUStats to get the nparams (it returns 4 on linux) then you call with it again with proper size virNodeCPUStats array, and it will fill the values and an output like the following is shown:</p>\n\n<pre><code>ret code 0\n4 nparams\nkernel value\n991550000000 value\nuser value\n4830840000000 value\nidle value\n199124620000000 value\niowait value\n695120000000 value\nPASS\n</code></pre>\n\n<p>Upon reading the code for libvirt-go and <a href=\"https://github.com/rgbkrk/libvirt-go/blob/master/libvirt.go#L783\" rel=\"nofollow\">ListAllStorageVolumes</a>, I tried the implement the following:</p>\n\n<pre><code>func (c *VirConnection) GetNodeCPUStats(flags C.uint) ([]VirNodeCPUStats, error) {\n    var nparams C.int\n    var params *C.virNodeCPUStatsPtr\n    var cpuNum C.int = -1 // change with cVIR_NODE_CPU_STATS_ALL_CPUS\n    var stats []VirNodeCPUStats\n\n    if C.virNodeGetCPUStats(c.ptr, cpuNum, nil, &amp;nparams, 0) == 0 {\n        retcode := C.virNodeGetCPUStats(c.ptr, cpuNum, (*C.virNodeCPUStats)(unsafe.Pointer(&amp;params)), &amp;nparams, C.uint(0))\n       fmt.Println(\"D&gt; Retcode: \", retcode) --&gt; outputs 0, okay\n\n    } \n\n    fmt.Println(\"D&gt; params: \", params)\n\n    header := reflect.SliceHeader{\n        Data: uintptr(unsafe.Pointer(params)),\n        Len:  4,\n        Cap:  4,\n    }\n\n    slice := *(*[]C.virNodeCPUStatsPtr)(unsafe.Pointer(&amp;header))\n    for _, ptr := range slice {\n        stats = append(stats, VirNodeCPUStats{ptr}) //add for first\n    }\n    C.free(unsafe.Pointer(params))\n    return stats, nil\n}\n</code></pre>\n\n<p>However, it gives the following error:</p>\n\n<pre><code>D&gt; params initial:  &lt;nil&gt;\nD&gt; Successful: virNodeGetCPUStats\nD&gt; nparams:  4\nD&gt; ret code:  0\nD&gt; params: (*libvirt._Ctype_virNodeCPUStatsPtr)(0x6c656e72656b)\nD&gt; Header Data:  119182900487531\nD&gt; before slice\nD&gt; before for\nunexpected fault address 0x6c656e72656b\nfatal error: fault\n[signal 0xb code=0x1 addr=0x6c656e72656b pc=0x4c0c04]\n\ngoroutine 87 [running]:\nruntime.throw(0x613078, 0x5)\n    /usr/local/go/src/runtime/panic.go:547 +0x90 fp=0xc820053c80 sp=0xc820053c68\nruntime.sigpanic()\n    /usr/local/go/src/runtime/sigpanic_unix.go:27 +0x2ab fp=0xc820053cd0 sp=0xc820053c80\ngithub.com/rgbkrk/libvirt-go.(*VirConnection).GetNodeCPUStats(0xc820053ef0, 0x0, 0x0, 0x0, 0x0)\n    /home/tugba/go/src/github.com/rgbkrk/libvirt-go/libvirt.go:879 +0xa84 fp=0xc820053ec0 sp=0xc820053cd0\ngithub.com/rgbkrk/libvirt-go.TestGetCPUStats(0xc8200beea0)\n    /home/tugba/go/src/github.com/rgbkrk/libvirt-go/libvirt_test.go:833 +0x66 fp=0xc820053f58 sp=0xc820053ec0\ntesting.tRunner(0xc8200beea0, 0x91acf8)\n    /usr/local/go/src/testing/testing.go:473 +0x98 fp=0xc820053f90 sp=0xc820053f58\nruntime.goexit()\n    /usr/local/go/src/runtime/asm_amd64.s:1998 +0x1 fp=0xc820053f98 sp=0xc820053f90\ncreated by testing.RunTests\n    /usr/local/go/src/testing/testing.go:582 +0x892\n</code></pre>\n\n<p>Am I not slicing the C array properly? What is going on? What is unexpected fault and how can it be at an address? Does that mean I am using a memory I shouldn't be?</p>\n"}, {"tags": ["go", "client", "kubernetes"], "answers": [{"comments": [{"owner": {"reputation": 1571, "user_id": 1587118, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/cBN8s.jpg?s=128&g=1", "display_name": "SRC", "link": "https://stackoverflow.com/users/1587118/src"}, "edited": false, "score": 0, "creation_date": 1478719844, "post_id": 37141582, "comment_id": 68270833, "body": "Sir, I have a question, I am trying to run the most simple program, the example one, and I have not changed a single line of code. I am doing <code>glide init</code> which asks me few questions and generates the glide.yml file.Then, at the time when I am trying to do <code>glide up</code> it can not get the packages. What it says is something like this - <code>Error scanning k8s.io&#47;client-go&#47;1.5&#47;kubernetes: open &#47;Users&#47;shubhadeeproychowdhury&#47;.glide&#47;cache&#47;src&#47;https-k8s.io-&zwnj;&#8203;client-go&#47;1.5&#47;kubern&zwnj;&#8203;etes: no such file or directory</code> This does not change if I am trying to do a glide get k8s.io/client-go/1.5/ also. I am getting mad"}], "tags": [], "owner": {"reputation": 7801, "user_id": 420061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/863c36ad26574df2c254dc2e46c8ff03?s=128&d=identicon&r=PG", "display_name": "Timo Reimann", "link": "https://stackoverflow.com/users/420061/timo-reimann"}, "is_accepted": true, "score": 8, "last_activity_date": 1462890855, "creation_date": 1462890855, "answer_id": 37141582, "question_id": 37135933, "link": "https://stackoverflow.com/questions/37135933/samples-on-kubernetes-golang-client/37141582#37141582", "title": "Samples on kubernetes golang client", "body": "<p>I put together a sample Kubernetes client in Go that allows to query the API version and make a sample NGINX deployment. Maybe it's helpful to you: <a href=\"https://github.com/timoreimann/kubernetes-goclient-example\" rel=\"noreferrer\">https://github.com/timoreimann/kubernetes-goclient-example</a></p>\n\n<p>Note that it doesn't use replication controllers (which, by the way, have been replaced by <a href=\"http://kubernetes.io/docs/user-guide/replicasets/\" rel=\"noreferrer\">replica sets</a> by now) but uses the newer <a href=\"http://kubernetes.io/docs/user-guide/deployments/\" rel=\"noreferrer\">Deployments API</a>. I also don't feed in YAML files; instead, I define everything programmatically. Reading YAML files and unmarshalling them into Kubernetes structs should be a fairly straight-forward thing to do though.</p>\n"}], "owner": {"reputation": 1151, "user_id": 924953, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa9d59f8fe520321d15d9783d1852407?s=128&d=identicon&r=PG", "display_name": "Roel Van Nyen", "link": "https://stackoverflow.com/users/924953/roel-van-nyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4653, "favorite_count": 0, "accepted_answer_id": 37141582, "answer_count": 1, "score": 0, "last_activity_date": 1462920056, "creation_date": 1462876314, "last_edit_date": 1462920056, "question_id": 37135933, "link": "https://stackoverflow.com/questions/37135933/samples-on-kubernetes-golang-client", "title": "Samples on kubernetes golang client", "body": "<p>I`m trying to create replication controllers, services etc from the golang client. (\"github.com/kubernetes/kubernetes/pkg/client/unversioned\") However I cannot find any documentation on how to do so.</p>\n\n<p>I found this: </p>\n\n<p>r, err := c.ReplicationControllers(api.NamespaceDefault).Create(rep)</p>\n\n<p>But I don`t know where to put the yml data etc. Anyone who found documentation or has some sample code that I could get started with ?</p>\n"}, {"tags": ["go", "deadlock", "channel", "goroutine"], "comments": [{"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 2, "creation_date": 1462887991, "post_id": 37135708, "comment_id": 61819539, "body": "don&#39;t pass copies of waitgroups around, pass the pointer.  in this case, you are passing a copy which means wg.Done is called on the copy and not what the main function is waiting on, thus, you deadlock"}, {"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1462951360, "post_id": 37135708, "comment_id": 61848067, "body": "Thank you, It is working now. If you could write it as an answer, I&#39;ll accept it."}], "owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1462884406, "creation_date": 1462875768, "last_edit_date": 1462878467, "question_id": 37135708, "link": "https://stackoverflow.com/questions/37135708/parallel-execution-of-a-function-with-goroutines-and-channels-and-deadlock-error", "title": "Parallel execution of a function with goroutines and channels and deadlock error", "body": "<p>Edit:: Full code <a href=\"https://play.golang.org/p/Gv60nzo3U3\" rel=\"nofollow\">here</a></p>\n\n<p>I have the following piece of code:</p>\n\n<pre><code>filelistchan := make(chan string)\nfor _, dir := range tld {\n    w.Add(1)\n    go GetFileList(dir, filelistchan, w)\n}\nfor ;; {\n    file, ok := &lt;- filelistchan\n    fmt.Println(ok)\n    switch ok {\n    case false:\n        break\n    default:\n        fmt.Println(file)\n    }\n}\nw.Wait()\n</code></pre>\n\n<p>and GetFileList function is</p>\n\n<pre><code>func GetFileList(dir string, filelistchan chan string, w sync.WaitGroup)  {\n    defer fmt.Println(\"finishing from\", dir)\n    defer w.Done()\n    fmt.Println(\"Searching in\", dir)\n    filelist := []string{}\n    filepath.Walk(dir, func(path string, f os.FileInfo, err error) error{\n    filelist = append(filelist, path)\n    return nil\n    })\n\n    for _, file := range filelist {\n        fmt.Println(file)\n        filelistchan &lt;- file\n    }\n}\n</code></pre>\n\n<p>I am calling <code>GetFileList</code> function parallely inside a forloop, to get the list of files inside them. It works fine till the last directory, however, once the last directory is completed, it gives an error </p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan receive]:\n</code></pre>\n\n<p>and when I am printing the ok, I could see that false is never getting printed from the goroutine once it is finishing the job. I am unable to figure out what I am doing wrong here. I tried <code>close(filelistchan)</code> inside the <code>GetFileList</code> function, but it gives another error after the first goroutine exits, saying <code>write on closed channel</code> and <code>attempting to close a closed channel</code>. Can someone please explain, what is the best idiomatic way to get this working?</p>\n"}, {"tags": ["go", "struct", "initialization", "default-value"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1462877473, "post_id": 37135193, "comment_id": 61811412, "body": "Related: <a href=\"http://stackoverflow.com/questions/36826232/how-to-make-sure-that-a-method-is-used-after-an-object-is-created-in-golang\">How to make sure that a method is used after an object is created in golang?</a>"}, {"owner": {"reputation": 4704, "user_id": 2077459, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c66fbcda79317065038bbe8f63a55267?s=128&d=identicon&r=PG", "display_name": "Prateek", "link": "https://stackoverflow.com/users/2077459/prateek"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1462947121, "post_id": 37135193, "comment_id": 61845587, "body": "@icza  You answer does give provide a way to do it but going by the Question Title, it is in no way similar or searchable since it is a very specific question. I will add the link in my answer though."}, {"owner": {"reputation": 58775, "user_id": 474189, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/jzXIJ.jpg?s=128&g=1", "display_name": "Duncan Jones", "link": "https://stackoverflow.com/users/474189/duncan-jones"}, "edited": false, "score": 0, "creation_date": 1505132659, "post_id": 37135193, "comment_id": 79272976, "body": "There are two questions here, pick one. Assuming you opt for the first question (as per question title), please be more specific about your prior research and where your other answers require more discusssion,."}], "answers": [{"comments": [{"owner": {"reputation": 4704, "user_id": 2077459, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c66fbcda79317065038bbe8f63a55267?s=128&d=identicon&r=PG", "display_name": "Prateek", "link": "https://stackoverflow.com/users/2077459/prateek"}, "edited": false, "score": 8, "creation_date": 1462875305, "post_id": 37135458, "comment_id": 61809940, "body": "Yes, this is one of the ways that I have also mentioned in my answer but there is no way we can force anyone to use this function only."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 4704, "user_id": 2077459, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c66fbcda79317065038bbe8f63a55267?s=128&d=identicon&r=PG", "display_name": "Prateek", "link": "https://stackoverflow.com/users/2077459/prateek"}, "edited": false, "score": 0, "creation_date": 1462920628, "post_id": 37135458, "comment_id": 61838309, "body": "@Prateek it&#39;s either this or use an interface, which would be ugly and overcomplicated."}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "reply_to_user": {"reputation": 4704, "user_id": 2077459, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c66fbcda79317065038bbe8f63a55267?s=128&d=identicon&r=PG", "display_name": "Prateek", "link": "https://stackoverflow.com/users/2077459/prateek"}, "edited": false, "score": 37, "creation_date": 1462946580, "post_id": 37135458, "comment_id": 61845345, "body": "@Prateek yes, you can force people to use this constructor if you simply make the type itself unexported.  You can export the function <code>NewSomething</code> and even the fields <code>Text</code> and <code>DefaultText</code>, but just don&#39;t export the struct type <code>something</code>."}, {"owner": {"reputation": 4704, "user_id": 2077459, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c66fbcda79317065038bbe8f63a55267?s=128&d=identicon&r=PG", "display_name": "Prateek", "link": "https://stackoverflow.com/users/2077459/prateek"}, "edited": false, "score": 0, "creation_date": 1462946758, "post_id": 37135458, "comment_id": 61845437, "body": "Worth Trying. Still wondering if the struct variable will be accessible directly. Will check it out. Thanks !!"}, {"owner": {"reputation": 4704, "user_id": 2077459, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c66fbcda79317065038bbe8f63a55267?s=128&d=identicon&r=PG", "display_name": "Prateek", "link": "https://stackoverflow.com/users/2077459/prateek"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1462965898, "post_id": 37135458, "comment_id": 61857699, "body": "@Amit, I have mention an extension to this in my answer - which recommends to make use of interface as a return value"}, {"owner": {"reputation": 708, "user_id": 424221, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1c0f0508cc89d4ea6938b257b797bae3?s=128&d=identicon&r=PG", "display_name": "edam", "link": "https://stackoverflow.com/users/424221/edam"}, "edited": false, "score": 1, "creation_date": 1522233070, "post_id": 37135458, "comment_id": 86070347, "body": "The problem is worse... if a third party (library, for example) is used to instantiate your struct (via <code>reflect.New()</code>, for example), it couldn&#39;t be expected to know about your specially-named factory function.  In that case, and short of the language itself being changed, <i>only</i> an interface (which the library could check for) would do, I think."}, {"owner": {"reputation": 754, "user_id": 5875023, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yuu7yj0AUW8/AAAAAAAAAAI/AAAAAAAAABI/bEOwyZSpqyU/photo.jpg?sz=128", "display_name": "Simon", "link": "https://stackoverflow.com/users/5875023/simon"}, "edited": false, "score": 0, "creation_date": 1524771295, "post_id": 37135458, "comment_id": 87117550, "body": "Shouldn&#39;t you return &amp;something with return type *Something as a good practice?"}, {"owner": {"reputation": 354, "user_id": 2169951, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fecf52737a2b6902cd7e8e9abb4f0d7d?s=128&d=identicon&r=PG", "display_name": "M. Gopal", "link": "https://stackoverflow.com/users/2169951/m-gopal"}, "edited": false, "score": 0, "creation_date": 1539264871, "post_id": 37135458, "comment_id": 92445729, "body": "To Value add Amit&#39;s one, It will be better to go with singleton instead of generating the struct every time"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 1, "creation_date": 1574340697, "post_id": 37135458, "comment_id": 104203924, "body": "It is good to set default, but sometimes, I might want to override default. In this case, I won&#39;t be able to initialize a struct with a value that is not the default. a little annoying for me"}], "tags": [], "owner": {"reputation": 5356, "user_id": 1885921, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/02ba513b62ef9f2f7798b9bac1ccf822?s=128&d=identicon&r=PG", "display_name": "vodolaz095", "link": "https://stackoverflow.com/users/1885921/vodolaz095"}, "is_accepted": false, "score": 114, "last_activity_date": 1536964473, "last_edit_date": 1536964473, "creation_date": 1462875114, "answer_id": 37135458, "question_id": 37135193, "link": "https://stackoverflow.com/questions/37135193/how-to-set-default-values-in-go-structs/37135458#37135458", "title": "How to set default values in Go structs", "body": "<p>One possible idea is to write separate constructor function</p>\n\n<pre><code>//Something is the structure we work with\ntype Something struct {\n     Text string \n     DefaultText string \n} \n// NewSomething create new instance of Something\nfunc NewSomething(text string) Something {\n   something := Something{}\n   something.Text = text\n   something.DefaultText = \"default text\"\n   return something\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2851, "user_id": 243089, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c504339686fb2092eba997ee8899131?s=128&d=identicon&r=PG", "display_name": "Victor Zamanian", "link": "https://stackoverflow.com/users/243089/victor-zamanian"}, "edited": false, "score": 7, "creation_date": 1488285464, "post_id": 37521991, "comment_id": 72155230, "body": "This is now a broken link (404): <a href=\"http://joneisen.tumblr.com/post/53695478114/golang-and-default-values\" rel=\"nofollow noreferrer\">joneisen.tumblr.com/post/53695478114/golang-and-default-valu&zwnj;&#8203;es</a>"}, {"owner": {"reputation": 2047, "user_id": 1588795, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a23e95080d456123bf42bf8cc0f13519?s=128&d=identicon&r=PG", "display_name": "n8henrie", "link": "https://stackoverflow.com/users/1588795/n8henrie"}, "edited": false, "score": 4, "creation_date": 1495828141, "post_id": 37521991, "comment_id": 75430818, "body": "It&#39;s available in the <a href=\"https://web.archive.org/web/20160818125551/https://joneisen.tumblr.com/post/53695478114/golang-and-default-values\" rel=\"nofollow noreferrer\">wayback machine</a>."}, {"owner": {"reputation": 1020, "user_id": 391113, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/b4e3e96ba1b76fad8c90beaad7fd281d?s=128&d=identicon&r=PG", "display_name": "decimus phostle", "link": "https://stackoverflow.com/users/391113/decimus-phostle"}, "edited": false, "score": 1, "creation_date": 1520449830, "post_id": 37521991, "comment_id": 85324228, "body": "FWIW, I think it is &#39;Option 3&#39; - at least in the wayback machine link. (There is no &#39;Option 5&#39;, there)."}], "tags": [], "owner": {"reputation": 4704, "user_id": 2077459, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c66fbcda79317065038bbe8f63a55267?s=128&d=identicon&r=PG", "display_name": "Prateek", "link": "https://stackoverflow.com/users/2077459/prateek"}, "is_accepted": true, "score": 77, "last_activity_date": 1598431921, "last_edit_date": 1598431921, "creation_date": 1464599995, "answer_id": 37521991, "question_id": 37135193, "link": "https://stackoverflow.com/questions/37135193/how-to-set-default-values-in-go-structs/37521991#37521991", "title": "How to set default values in Go structs", "body": "<ol>\n<li><p>Force a method to get the struct (the constructor way).</p>\n<p>From <a href=\"https://stackoverflow.com/a/36826362\">this post</a>:</p>\n<blockquote>\n<p>A good design is to make your type unexported, but provide an exported constructor function like <code>NewMyType()</code> in which you can properly initialize your struct / type. Also return an interface type and not a concrete type, and the interface should contain everything others want to do with your value. And your concrete type must implement that interface of course.</p>\n</blockquote>\n<p>This can be done by simply making the type itself unexported. You can export the function NewSomething and even the fields Text and DefaultText, but just don't export the struct type something.</p>\n</li>\n<li><p>Another way to customize it for you own module is by using a <a href=\"https://web.archive.org/web/20160818125551/https://joneisen.tumblr.com/post/53695478114/golang-and-default-values\" rel=\"noreferrer\">Config struct to set default values</a> (Option 5 in the link). Not a good way though.</p>\n</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 679, "user_id": 2787085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7734e5f1f0dafd22029584c3eab28c9d?s=128&d=identicon&r=PG&f=1", "display_name": "wolfson109", "link": "https://stackoverflow.com/users/2787085/wolfson109"}, "is_accepted": false, "score": 42, "last_activity_date": 1573127477, "last_edit_date": 1573127477, "creation_date": 1502356236, "answer_id": 45609266, "question_id": 37135193, "link": "https://stackoverflow.com/questions/37135193/how-to-set-default-values-in-go-structs/45609266#45609266", "title": "How to set default values in Go structs", "body": "<p>One problem with option 1 in answer from \nVictor Zamanian is that if the type isn't exported then users of your package can't declare it as the type for function parameters etc. One way around this would be to export an interface instead of the struct e.g.</p>\n\n<pre><code>package candidate\n// Exporting interface instead of struct\ntype Candidate interface {}\n// Struct is not exported\ntype candidate struct {\n    Name string\n    Votes uint32 // Defaults to 0\n}\n// We are forced to call the constructor to get an instance of candidate\nfunc New(name string) Candidate {\n    return candidate{name, 0}  // enforce the default value here\n}\n</code></pre>\n\n<p>Which lets us declare function parameter types using the exported Candidate interface.\nThe only disadvantage I can see from this solution is that all our methods need to be declared in the interface definition, but you could argue that that is good practice anyway.</p>\n"}, {"tags": [], "owner": {"reputation": 1188, "user_id": 1308927, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e6c692ca1e6b1ad945b14b3a2f7e0850?s=128&d=identicon&r=PG", "display_name": "RdB", "link": "https://stackoverflow.com/users/1308927/rdb"}, "is_accepted": false, "score": 3, "last_activity_date": 1527090398, "last_edit_date": 1527090398, "creation_date": 1512189532, "answer_id": 47604644, "question_id": 37135193, "link": "https://stackoverflow.com/questions/37135193/how-to-set-default-values-in-go-structs/47604644#47604644", "title": "How to set default values in Go structs", "body": "<p><em>From <a href=\"https://golang.org/doc/effective_go.html#composite_literals\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#composite_literals</a>:</em></p>\n\n<p>Sometimes the zero value isn't good enough and an initializing constructor is necessary, as in this example derived from package os. </p>\n\n<pre><code>    func NewFile(fd int, name string) *File {\n      if fd &lt; 0 {\n        return nil\n      }\n      f := new(File)\n      f.fd = fd\n      f.name = name\n      f.dirinfo = nil\n      f.nepipe = 0\n      return f\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 620, "user_id": 3321356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e14f9190df43f297d8f64ba3bf14913?s=128&d=identicon&r=PG", "display_name": "markeissler", "link": "https://stackoverflow.com/users/3321356/markeissler"}, "edited": false, "score": 2, "creation_date": 1533948938, "post_id": 51791989, "comment_id": 90548536, "body": "This is incorrect. At best, you could set a tag value on that field and then get to its value with reflection but even with this the syntax is incorrect (missing back ticks) and you&#39;d only be able to set a default value for a string type.  If you have some insight as to what this example is referring to specifically please add a link to refer to."}], "tags": [], "owner": {"reputation": 9, "user_id": 10209901, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22fb9da359987d0dc3bc5b1ae64c27b4?s=128&d=identicon&r=PG", "display_name": "user10209901", "link": "https://stackoverflow.com/users/10209901/user10209901"}, "is_accepted": false, "score": -4, "last_activity_date": 1533963027, "last_edit_date": 1533963027, "creation_date": 1533924812, "answer_id": 51791989, "question_id": 37135193, "link": "https://stackoverflow.com/questions/37135193/how-to-set-default-values-in-go-structs/51791989#51791989", "title": "How to set default values in Go structs", "body": "<pre><code>type Config struct {\n    AWSRegion                               string `default:\"us-west-2\"`\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2336, "user_id": 80527, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mGkoE.jpg?s=128&g=1", "display_name": "Nordes", "link": "https://stackoverflow.com/users/80527/nordes"}, "edited": false, "score": 0, "creation_date": 1580782862, "post_id": 56778921, "comment_id": 106202502, "body": "Thank&#39;s a lot! I started to write the same code as the library suggested and came across this post. It does exactly what you expect (<a href=\"https://github.com/creasty/defaults\" rel=\"nofollow noreferrer\">github.com/creasty/defaults</a>). If you have no value it sets the default, but if you assigned a value to your variable, then it&#39;s going to not assign the default. It works pretty well with the yaml.v2 library."}, {"owner": {"reputation": 2387, "user_id": 2397613, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/ukaSU.jpg?s=128&g=1", "display_name": "ton", "link": "https://stackoverflow.com/users/2397613/ton"}, "edited": false, "score": 0, "creation_date": 1619095506, "post_id": 56778921, "comment_id": 118804746, "body": "This is a nice alternative, but it&#39;s not from <code>golang</code>. You have a generic constructor that use reflections. A real default value would be set automatically on every new struct instance."}], "tags": [], "owner": {"reputation": 2733, "user_id": 904032, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/sjogH.jpg?s=128&g=1", "display_name": "Mike Chirico", "link": "https://stackoverflow.com/users/904032/mike-chirico"}, "is_accepted": false, "score": 24, "last_activity_date": 1561573279, "creation_date": 1561573279, "answer_id": 56778921, "question_id": 37135193, "link": "https://stackoverflow.com/questions/37135193/how-to-set-default-values-in-go-structs/56778921#56778921", "title": "How to set default values in Go structs", "body": "<p>There is a way of doing this with tags, which\nallows for multiple defaults.   </p>\n\n<p>Assume you have the following struct, with 2 default\ntags <em>default0</em> and <em>default1</em>.  </p>\n\n<pre><code>type A struct {\n   I int    `default0:\"3\" default1:\"42\"`\n   S string `default0:\"Some String...\" default1:\"Some Other String...\"`\n}\n</code></pre>\n\n<p>Now it's possible to Set the defaults. </p>\n\n<pre><code>func main() {\n\nptr := &amp;A{}\n\nSet(ptr, \"default0\")\nfmt.Printf(\"ptr.I=%d ptr.S=%s\\n\", ptr.I, ptr.S)\n// ptr.I=3 ptr.S=Some String...\n\nSet(ptr, \"default1\")\nfmt.Printf(\"ptr.I=%d ptr.S=%s\\n\", ptr.I, ptr.S)\n// ptr.I=42 ptr.S=Some Other String...\n}\n</code></pre>\n\n<p>Here's the <a href=\"https://play.golang.org/p/rFql2x0Klm4\" rel=\"noreferrer\">complete program in a playground</a>. </p>\n\n<p>If you're interested in a more complex example, say with\nslices and maps, then, take a look at <a href=\"https://github.com/creasty/defaults\" rel=\"noreferrer\">creasty/defaultse</a> </p>\n"}], "owner": {"reputation": 4704, "user_id": 2077459, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c66fbcda79317065038bbe8f63a55267?s=128&d=identicon&r=PG", "display_name": "Prateek", "link": "https://stackoverflow.com/users/2077459/prateek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198778, "favorite_count": 30, "accepted_answer_id": 37521991, "answer_count": 6, "score": 179, "last_activity_date": 1598431921, "creation_date": 1462874452, "last_edit_date": 1531518284, "question_id": 37135193, "link": "https://stackoverflow.com/questions/37135193/how-to-set-default-values-in-go-structs", "title": "How to set default values in Go structs", "body": "<p>There are multiple answers/techniques to the below question:</p>\n\n<ol>\n<li>How to set default values to golang structs?</li>\n<li>How to initialize structs in golang</li>\n</ol>\n\n<p>I have a couple of answers but further discussion is required.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "edited": false, "score": 0, "creation_date": 1462859198, "post_id": 37130021, "comment_id": 61800254, "body": "my json file is like that{ \t&quot;_id&quot; : ObjectId(&quot;57307906f051147d5317984e&quot;), \t&quot;user&quot; : [ \t\t{ \t\t\t&quot;firstName&quot; : &quot;chetan&quot;, \t\t\t&quot;lastName&quot; : &quot;kumar&quot;, \t\t\t&quot;age&quot; : 23 \t\t}, \t\t{ \t\t\t&quot;firstName&quot; : &quot;nepolean&quot;, \t\t\t&quot;lastName&quot; : &quot;dang&quot;, \t\t\t&quot;age&quot; : 26 \t\t} \t], \t&quot;sales&quot; : [ \t\t{ \t\t\t&quot;firstName&quot; : &quot;ashu&quot;, \t\t\t&quot;lastName&quot; : &quot;jha&quot;, \t\t\t&quot;age&quot; : 27 \t\t} \t] }"}, {"owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "reply_to_user": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "edited": false, "score": 0, "creation_date": 1462859594, "post_id": 37130021, "comment_id": 61800400, "body": "Yes you got a list of users, but the problem is <code>$unwind</code> will modify the behavior (from an <code>array</code> to a single <code>element</code>). Another suggestion is to create another <code>type</code> for <code>$unwind</code> version of response."}, {"owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "edited": false, "score": 0, "creation_date": 1462859624, "post_id": 37130021, "comment_id": 61800413, "body": "But if i want  to use in array then what to do?"}, {"owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "reply_to_user": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "edited": false, "score": 0, "creation_date": 1462859972, "post_id": 37130021, "comment_id": 61800545, "body": "You can create another type for <code>$unwind</code>, lemme update my answer."}], "tags": [], "owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "is_accepted": true, "score": 2, "last_activity_date": 1462860447, "last_edit_date": 1462860447, "creation_date": 1462858534, "answer_id": 37130021, "question_id": 37129854, "link": "https://stackoverflow.com/questions/37129854/how-to-use-unwind-in-golang/37130021#37130021", "title": "How to use $unwind in golang?", "body": "<p>Because the mapping is invalid, after <code>$unwind</code> on <code>$user</code>, you should expect every single result only contains a single user, therefore, <code>User</code> shouldn't be an <code>array</code>.</p>\n\n<pre><code>type Details struct{\n    ID  bson.ObjectId   `json:\"_id\" bson:\"_id\"`\n    USER    []User      `json:\"user\" bson:\"user\"`\n    SALES   []Sales     `json:\"sales\" bson:\"sales\"`\n}\n</code></pre>\n\n<p>Should be changed to:</p>\n\n<pre><code>type Details struct{\n    ID  bson.ObjectId   `json:\"_id\" bson:\"_id\"`\n    USER    User      `json:\"user\" bson:\"user\"`\n    SALES   []Sales     `json:\"sales\" bson:\"sales\"`\n}\n</code></pre>\n\n<p>Since you might need two types of responses, one is normal response, another one is <code>$unwind</code> response which is current one, you can create another type for it:</p>\n\n<pre><code>type UnwindDetails struct{\n    ID  bson.ObjectId   `json:\"_id\" bson:\"_id\"`\n    USER    User      `json:\"user\" bson:\"user\"`\n    SALES   []Sales     `json:\"sales\" bson:\"sales\"`\n}\n</code></pre>\n\n<p>and remain your original <code>type</code></p>\n\n<pre><code>type Details struct{\n    ID  bson.ObjectId   `json:\"_id\" bson:\"_id\"`\n    USER    []User      `json:\"user\" bson:\"user\"`\n    SALES   []Sales     `json:\"sales\" bson:\"sales\"`\n}\n</code></pre>\n\n<p>So you got to modify the type of <code>result</code> variable to:</p>\n\n<pre><code>var result []UnwindDetails\n</code></pre>\n"}], "owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 824, "favorite_count": 2, "accepted_answer_id": 37130021, "answer_count": 1, "score": 0, "last_activity_date": 1462860447, "creation_date": 1462857707, "last_edit_date": 1462860215, "question_id": 37129854, "link": "https://stackoverflow.com/questions/37129854/how-to-use-unwind-in-golang", "title": "How to use $unwind in golang?", "body": "<p>I want the result in go as the mongo shell provide me.</p>\n\n<p>In mongo shell the data is like this:</p>\n\n<pre><code>db.user.aggregate([{$unwind:\"$user\"}]).pretty()    \n{\n    \"_id\" : ObjectId(\"57307906f051147d5317984e\"),\n    \"user\" : {\n        \"firstName\" : \"chetan\",\n        \"lastName\" : \"kumar\",\n        \"age\" : 23\n    },\n    \"sales\" : [\n        {\n            \"firstName\" : \"ashu\",\n            \"lastName\" : \"jha\",\n            \"age\" : 27\n        }\n    ]\n}\n{\n    \"_id\" : ObjectId(\"57307906f051147d5317984e\"),\n    \"user\" : {\n        \"firstName\" : \"nepolean\",\n        \"lastName\" : \"dang\",\n        \"age\" : 26\n    },\n    \"sales\" : [\n        {\n            \"firstName\" : \"ashu\",\n            \"lastName\" : \"jha\",\n            \"age\" : 27\n        }\n    ]\n}\n</code></pre>\n\n<p>But in go</p>\n\n<pre><code>package main    \nimport(\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n        \"encoding/json\"\n    \"github.com/gorilla/mux\"\n        \"gopkg.in/mgo.v2\"\n        \"gopkg.in/mgo.v2/bson\"\n)\ntype User struct{\n    FIRSTNAME   string      `json:\"firstName\" bson:\"firstName\"`\n    LASTNAME    string      `json:\"lastName\" bson:\"lastName\"`\n    AGE     int     `json:\"age\" bson:\"age\"`\n}\ntype Sales struct{\n    FIRSTNAME   string      `json:\"firstName\" bson:\"firstName\"`\n    LASTNAME    string      `json:\"lastName\" bson:\"lastName\"`\n    AGE     int     `json:\"age\" bson:\"age\"`\n}\n\ntype Details struct{\n    ID  bson.ObjectId   `json:\"_id\" bson:\"_id\"`\n    USER    []User      `json:\"user\" bson:\"user\"`\n    SALES   []Sales     `json:\"sales\" bson:\"sales\"`\n}\n\nfunc detail(w http.ResponseWriter, r *http.Request){\n    session, err := mgo.Dial(\"127.0.0.1\")\n        if err != nil {\n                panic(err)\n        }else{\n                fmt.Println(\"dial\")\n        }\n        defer session.Close()\n\n\n        session.SetMode(mgo.Monotonic, true)\n\n        c := session.DB(\"userdb\").C(\"user\")\n\n\n       var result []Details\n\n\n    o1 := bson.M{\n        \"$unwind\":\"$user\",\n    }\n\n\n        operations := []bson.M{o1}\n    pipe := c.Pipe(operations)\n    err = pipe.All(&amp;result)\n        if err != nil {\n                log.Fatal(err)\n        }\n        res1B, _ := json.Marshal(result)\n        fmt.Fprintf(w,string(res1B))\n}\n\nfunc main(){\n    router := mux.NewRouter().StrictSlash(true)\n    router.HandleFunc(\"/detail\",detail)\n    log.Fatal(http.ListenAndServe(\":9080\", router))\n\n}\n</code></pre>\n\n<p>Result is like this:</p>\n\n<pre><code> [{\"_id\":\"57307906f051147d5317984e\",\n\"user\":null,\n\"sales\":[{\n\"firstName\":\"ashu\",\"lastName\":\"jha\",\"age\":27}]},{\"_id\":\"57307906f051147d5317984e\",\n\"user\":null,\n\"sales\":[{\n\"firstName\":\"ashu\",\"lastName\":\"jha\",\"age\":27}]}]        \n</code></pre>\n\n<p>But it shows <code>\"user\": null</code>, I want the reult as provide by mongo shell.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 0, "last_activity_date": 1470471984, "last_edit_date": 1495539952, "creation_date": 1462857681, "answer_id": 37129848, "question_id": 37129614, "link": "https://stackoverflow.com/questions/37129614/advantage-of-scoping-variables-within-an-if-block/37129848#37129848", "title": "Advantage of scoping variables within an if block", "body": "<p>Advantage of scoping variables:</p>\n\n<ul>\n<li>Since it cannot be accessed from other scope, Data Integrity is preserved.</li>\n<li>Only required data can be passed to function , thus protecting the remaining data</li>\n</ul>\n\n<p>see this:<br>\n<a href=\"https://stackoverflow.com/questions/36553134/where-can-we-use-variable-shadowing-and-why/36553135#36553135\">Where can we use Variable Scoping and Shadowing in Go?</a></p>\n"}, {"comments": [{"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1462882758, "post_id": 37138010, "comment_id": 61815376, "body": "Named return values are, just like labels, very useful when you need them, but you almost never do."}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "reply_to_user": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1462882796, "post_id": 37138010, "comment_id": 61815405, "body": "correct. but I see a lot of code in projects where people make it the standard.  and Go&#39;s blog recommends not using them except in exceptional cases that allow the code to be easier read (which often times means not)."}, {"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 1, "creation_date": 1462882940, "post_id": 37138010, "comment_id": 61815526, "body": "I pretty much only use named return values when I need to modify a return value in a defered function. &quot;Deferred functions may read and assign to the returning function&#39;s named return values.&quot; <a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow noreferrer\">blog.golang.org/defer-panic-and-recover</a>"}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "reply_to_user": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1462886546, "post_id": 37138010, "comment_id": 61818426, "body": "+1 good point, using <code>defer</code> to modify the named parameter.  i think there was a Go Tour for that very thing."}], "tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": true, "score": 2, "last_activity_date": 1462886962, "last_edit_date": 1462886962, "creation_date": 1462881819, "answer_id": 37138010, "question_id": 37129614, "link": "https://stackoverflow.com/questions/37129614/advantage-of-scoping-variables-within-an-if-block/37138010#37138010", "title": "Advantage of scoping variables within an if block", "body": "<p>Remember, <code>error</code> is an interface.  And nil interfaces are zero-length in bytes (and empty structs are zero-length too).</p>\n\n<p>This means there is no additional work for the GC to cleanup either way.</p>\n\n<p>It is a personal preference, and there's even a third way using named return values:</p>\n\n<pre><code>func foo() (err error) {\n    ...\n}\n</code></pre>\n\n<p>Though I highly recommend not using that pattern.</p>\n\n<p>Personally, I prefer the idiomatic nature of <code>inline</code> with the if when I can and really enjoy when the pattern allows me to use it.  But remember, the scoping of other variables are only available within the if:</p>\n\n<pre><code>if temp, err := other(); err != nil {\n    // can only use temp here\n    ...\n}\n</code></pre>\n\n<p>(unless you define the vars ahead of time, which defeats the purpose of inlining anyways)</p>\n\n<p>But most often, I need to keep <code>temp</code> around after the evaluation:</p>\n\n<pre><code>temp, err := something()\nif err != nil {\n    ...\n}\n// continue to use temp\n</code></pre>\n\n<p>Which means most of my code looks like the above.</p>\n\n<p>But when I run across a pattern that allows it, you bet I'll use it.  For example, bufio's <code>Writer.WriteByte</code>:</p>\n\n<pre><code>if err := writer.WriteByte(b); err != nil {\n    ...\n}\n</code></pre>\n\n<p>Where <code>writer</code> and <code>b</code> were defined in the outer scope, most likely with their own <code>err</code> checks.  There is zero point of defining <code>err</code> outside the scope of the evaluation. </p>\n\n<p>Limiting the scope of the <code>err</code> value just seems like the idiomatic way, when you can use it.</p>\n"}], "owner": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 37138010, "answer_count": 2, "score": 2, "last_activity_date": 1470471984, "creation_date": 1462856408, "last_edit_date": 1462882836, "question_id": 37129614, "link": "https://stackoverflow.com/questions/37129614/advantage-of-scoping-variables-within-an-if-block", "title": "Advantage of scoping variables within an if block", "body": "<p>Is there an advantage to scoping the <strong>second</strong> <code>err</code> in an <code>if</code> statement after an <code>err</code> has already been created in the scope of <code>foo()</code>? Especially in terms of memory management or being idiomatic.</p>\n\n<p>Version 1</p>\n\n<pre><code>func foo() {\n    temp, err := something()\n    if err != nil {\n        ...\n    }\n\n    if err := other(); err != nil {\n        ...\n    }\n}\n</code></pre>\n\n<p>Version 2</p>\n\n<pre><code>func foo() {\n    temp, err := something()\n    if err != nil {\n        ...\n    }\n\n    err = other()\n    if err != nil {\n        ...\n    }\n}\n</code></pre>\n\n<p><a href=\"https://golang.org/doc/effective_go.html#control-structures\" rel=\"nofollow\">https://golang.org/doc/effective_go.html#control-structures</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 5, "creation_date": 1462833888, "post_id": 37126582, "comment_id": 61793869, "body": "That is never going to work. I&#39;m not going to get too deep into it but the Go http client is not a browser. When the page loads in your browser, the browser parses scripts and executes them, that doesn&#39;t happen here. If you want to scrape a page you&#39;d be better off using something like Selinium which is made for web ui automation. Another option is a tool called phantomjs which is made for the same, but in this context, scripts will not execute, ever. On top of that, you need to use javascript. You need to hook into the page load and have a callbakc that runs after that completes."}, {"owner": {"reputation": 183757, "user_id": 20654, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/94066dfa49c2feb14706cb081848fda7?s=128&d=identicon&r=PG", "display_name": "OscarRyz", "link": "https://stackoverflow.com/users/20654/oscarryz"}, "edited": false, "score": 0, "creation_date": 1462983651, "post_id": 37126582, "comment_id": 61871514, "body": "Scrap the comment section, load the comments by invoking the ajax url directly and then you&#39;ll have the comments.   Do you have an website example to look at?"}], "answers": [{"tags": [], "owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "is_accepted": false, "score": 0, "last_activity_date": 1462834586, "creation_date": 1462834586, "answer_id": 37126711, "question_id": 37126582, "link": "https://stackoverflow.com/questions/37126582/get-html-from-dom-after-javascript-has-executed/37126711#37126711", "title": "get html from dom after javascript has executed", "body": "<p>If you own the site or can easily determine (or generate) the URI of the call that loads the comments, it's probably easier to make that same AJAX call yourself rather than bother with DOM parsing or arbitrary JS execution.</p>\n\n<p>At that point Go would actually be a good language to use, since its JSON and XML standard libraries are excellent for unmarshalling that kind of data.</p>\n"}, {"tags": [], "owner": {"reputation": 5356, "user_id": 1885921, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/02ba513b62ef9f2f7798b9bac1ccf822?s=128&d=identicon&r=PG", "display_name": "vodolaz095", "link": "https://stackoverflow.com/users/1885921/vodolaz095"}, "is_accepted": false, "score": 2, "last_activity_date": 1462875546, "creation_date": 1462875546, "answer_id": 37135617, "question_id": 37126582, "link": "https://stackoverflow.com/questions/37126582/get-html-from-dom-after-javascript-has-executed/37135617#37135617", "title": "get html from dom after javascript has executed", "body": "<p>you can use the headless browsers like <a href=\"http://phantomjs.org/\" rel=\"nofollow\">http://phantomjs.org/</a> to get page, execute all javascripts on it and scrape the comments. \nThis example can help : <a href=\"https://github.com/ariya/phantomjs/blob/master/examples/phantomwebintro.js\" rel=\"nofollow\">https://github.com/ariya/phantomjs/blob/master/examples/phantomwebintro.js</a></p>\n\n<p>But phantomjs is separate binary application, maybe installing it can be not so trivial.</p>\n\n<p>Also you you can research the page using Firebug, see the requests being send to fetch comments, and emulate this call in go.</p>\n\n<p>Maybe the page loads comments via javascript code like this</p>\n\n<pre><code>$.get( \"/ajax/comments\", function( data ) {\n  $( \".comments\" ).html( data );\n});\n</code></pre>\n\n<p>so you can fetch and parse the <code>/ajax/comments</code> page using go</p>\n"}, {"tags": [], "owner": {"reputation": 134, "user_id": 1334914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1g1u.jpg?s=128&g=1", "display_name": "Mikhail Andrianov", "link": "https://stackoverflow.com/users/1334914/mikhail-andrianov"}, "is_accepted": false, "score": 1, "last_activity_date": 1463083807, "creation_date": 1463083807, "answer_id": 37196521, "question_id": 37126582, "link": "https://stackoverflow.com/questions/37126582/get-html-from-dom-after-javascript-has-executed/37196521#37196521", "title": "get html from dom after javascript has executed", "body": "<p>Recently I had the same issue and <a href=\"https://github.com/PuerkitoBio/goquery\" rel=\"nofollow\">GoQuery</a> helped a lot\nI tried the first site came from the net, where comments are loaded by JS event and wrote you a small snippet. You may try and check it out.</p>\n\n<pre><code>doc,_ := goquery.NewDocument(\"http://www.ihg.com/holidayinn/hotels/us/en/san-francisco/sfocc/hoteldetail/hotel-reviews?scmisc=hotel_details_reviews_link_bottom\")\nhtml_contents,_ := doc.Html()\nfmt.Println(html_contents)\n</code></pre>\n\n<p>This will initially shows all the comments below main content of the page, which are loaded by JS event.</p>\n\n<p>Good Luck! </p>\n"}], "owner": {"reputation": 901, "user_id": 1390561, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/54a92ddcdeb300851985eab386609da7?s=128&d=identicon&r=PG", "display_name": "Jacob Kranz", "link": "https://stackoverflow.com/users/1390561/jacob-kranz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3015, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1463083807, "creation_date": 1462833715, "question_id": 37126582, "link": "https://stackoverflow.com/questions/37126582/get-html-from-dom-after-javascript-has-executed", "title": "get html from dom after javascript has executed", "body": "<p>I may be saying this with incorrect terminology so correct me if I'm wrong please.</p>\n\n<p>Here's what I want to do: I'm trying to scrape a website's comments section but the comments are loaded via an ajax call after the page has fully loaded.  When I try to scrape the HTML from the site via: </p>\n\n<pre><code>res, err:= http.Get(url)\nif err != nil {\n    // handle error\n}\ndefer res.Body.Close()\n</code></pre>\n\n<p>But it obviously gets the html before the ajax call.  How do I go about getting the html after the ajax call?</p>\n\n<p>This is completely off the top of my head, but would I need to basically create a js-renderer in code for this?  My guess is that the JS needs to execute somehow.  Any suggestions / libraries / examples on how to go about this?  I'd prefer this to be in go but it could be realistically in any language.</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 2, "creation_date": 1462833710, "post_id": 37126539, "comment_id": 61793822, "body": "Just because a program builds doesn&#39;t mean it works. Runtime errors are common place in real software applications and in your code you ignore every single error that is returned. Rather than doing <code>val, _ :=</code> everywhere, do <code>val, err :=</code> and then follow it with an <code>if err != nil</code> and print/log the errors. As it is, no one can offer you any further help because you have nothing to go off of."}, {"owner": {"reputation": 109, "user_id": 5188181, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-h4VShzd67XE/AAAAAAAAAAI/AAAAAAAAA7Q/1rLmQS3qnKU/photo.jpg?sz=128", "display_name": "Prithviraj Sukale", "link": "https://stackoverflow.com/users/5188181/prithviraj-sukale"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1462833752, "post_id": 37126539, "comment_id": 61793830, "body": "ok @evanmcdonnal thanx"}], "answers": [{"tags": [], "owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "is_accepted": true, "score": 3, "last_activity_date": 1462835129, "creation_date": 1462835129, "answer_id": 37126792, "question_id": 37126539, "link": "https://stackoverflow.com/questions/37126539/this-builds-well-why-doesnt-this-code-execute/37126792#37126792", "title": "This builds well.why doesn&#39;t this code execute?", "body": "<p>Maybe your error is come from this :</p>\n\n<pre><code>string(count)\n</code></pre>\n\n<p>It will compiled but the result is empty. If you want to convert int to string you will need strconv package.</p>\n\n<pre><code>strconv.Itoa(count)\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>strconv.FormatInt(int64(count), 10)\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 5188181, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-h4VShzd67XE/AAAAAAAAAAI/AAAAAAAAA7Q/1rLmQS3qnKU/photo.jpg?sz=128", "display_name": "Prithviraj Sukale", "link": "https://stackoverflow.com/users/5188181/prithviraj-sukale"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 37126792, "answer_count": 1, "score": -1, "last_activity_date": 1462838947, "creation_date": 1462833505, "last_edit_date": 1462838947, "question_id": 37126539, "link": "https://stackoverflow.com/questions/37126539/this-builds-well-why-doesnt-this-code-execute", "title": "This builds well.why doesn&#39;t this code execute?", "body": "<p>I am trying to make a web scraper using go. I built this code. It was built fine without any errors. But its binary won't execute. </p>\n\n<p>Is this the problem with a large number of routines or those variables in the execute function? </p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"net/http\"\n    //\"regexp\"\n)\n\nfunc excuter(count int) {\n\n    adrr := string(\"http://torhit.com/torbite/?page=\" + string(count))\n\n    resp, _ := http.Get(adrr)\n    bytes, _ := ioutil.ReadAll(resp.Body)\n\n    ioutil.WriteFile(\"scrap.txt\"+string(count), bytes, 0777)\n\n    resp.Body.Close()\n}\nfunc main() {\n    //re := regexp.MustCompile(\"\")\n    count := 1\n    maxcount := 200\n    for ; count &lt;= maxcount; count++ {\n        go excuter(count)\n\n    }\n}\n\n    package main\n\nimport (\n    \"io/ioutil\"\n    \"net/http\"\n    //\"regexp\"\n)\n\nfunc excuter(count int) {\n\n    adrr := string(\"http://torhit.com/torbite/?page=\" + string(count))\n\n    resp, _ := http.Get(adrr)\n    bytes, _ := ioutil.ReadAll(resp.Body)\n\n    ioutil.WriteFile(\"scrap.txt\"+string(count), bytes, 0777)\n\n    resp.Body.Close()\n}\nfunc main() {\n    //re := regexp.MustCompile(\"\")\n    count := 1\n    maxcount := 200\n    for ; count &lt;= maxcount; count++ {\n        go excuter(count)\n\n    }\n}\n</code></pre>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1462830296, "post_id": 37125537, "comment_id": 61792738, "body": "You should show more of your code. Most likely you never close your statements and/or rows."}, {"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 1, "creation_date": 1462836519, "post_id": 37125537, "comment_id": 61794577, "body": "Do you create new statement on each insert (calling db.Prepare)? Btw, you have another stackoverflow thread with the same question I think."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 1, "creation_date": 1462839649, "post_id": 37125537, "comment_id": 61795354, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/37123216/cannot-prepare-more-than-max-prepared-stmt-count-mysql-error\">Cannot prepare more than max_prepared_stmt_count Mysql error</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 1, "creation_date": 1462871566, "post_id": 37133267, "comment_id": 61807172, "body": "that why you need to attach more code here for better understand for others."}], "tags": [], "owner": {"reputation": 164, "user_id": 4838903, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-BZ6JQIjP2ps/AAAAAAAAAAI/AAAAAAAAABk/kJzyEKq59iM/photo.jpg?sz=128", "display_name": "Yakirbu", "link": "https://stackoverflow.com/users/4838903/yakirbu"}, "is_accepted": true, "score": 2, "last_activity_date": 1462869521, "creation_date": 1462869521, "answer_id": 37133267, "question_id": 37125537, "link": "https://stackoverflow.com/questions/37125537/go-language-insert-data-to-mysql-database-without-prepared-statements/37133267#37133267", "title": "Go Language - Insert data to Mysql database without prepared statements", "body": "<p>For those who encouter the same issue, make sure you call Prepare statement only once and leave it out of any of your loops. I just noticed that it was inside my 'for' loop and therefore it created a new prepare statment everytime.</p>\n\n<p>Also thanks to Apin who mentioned it earlier</p>\n"}], "owner": {"reputation": 164, "user_id": 4838903, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-BZ6JQIjP2ps/AAAAAAAAAAI/AAAAAAAAABk/kJzyEKq59iM/photo.jpg?sz=128", "display_name": "Yakirbu", "link": "https://stackoverflow.com/users/4838903/yakirbu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 724, "favorite_count": 0, "accepted_answer_id": 37133267, "answer_count": 1, "score": 0, "last_activity_date": 1462935754, "creation_date": 1462828257, "last_edit_date": 1462935754, "question_id": 37125537, "link": "https://stackoverflow.com/questions/37125537/go-language-insert-data-to-mysql-database-without-prepared-statements", "title": "Go Language - Insert data to Mysql database without prepared statements", "body": "<p>I have a script that needs to insert a huge amount of data to the database (270k rows) and I'm using prepared statements (with for loops). \nAnd when I execute   (<code>res, err := stmt.Exec</code>) I can retrieve the last ID that was inserted to the database (<code>id, err  = res.LastInsertId()</code>).\nBut since I'm making a-lot of requests to the database, after 16k rows I get <code>max_prepared_statements(16,382) error</code> (which I then tried to set the max value to 1 million instead of 16,382 but the problem still remains). </p>\n\n<p>My question is if there's another way to insert to DB and retrieve the last inserted ID without using prepared statements?</p>\n\n<p>my insert code as for now is:</p>\n\n<pre><code>stmt, err := db.Prepare(`INSERT info SET title=?,minimage=?,downloadfile=?,rating=?,peoplewatched=?,likes=?`)\ncheckErr(err)\nres, err := stmt.Exec(title,minimage,downloadfile,rating,peoplewatched,likes)\ncheckErr(err)\nid, err  = res.LastInsertId()\ncheckErr(err)\nfmt.Println(id)\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 0, "creation_date": 1462826399, "post_id": 37125004, "comment_id": 61790874, "body": "cannot use buf (type *bytes.Buffer) as type string in argument to m.SetBody"}, {"owner": {"reputation": 5268, "user_id": 302164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XucHp.png?s=128&g=1", "display_name": "miltonb", "link": "https://stackoverflow.com/users/302164/miltonb"}, "reply_to_user": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 5, "creation_date": 1462826498, "post_id": 37125004, "comment_id": 61790917, "body": "a buffer is easily converted to a string,  I think its just <code>buf.String()</code> the docs are <a href=\"https://golang.org/pkg/bytes/#Buffer.String\" rel=\"nofollow noreferrer\">golang.org/pkg/bytes/#Buffer.String</a>"}], "tags": [], "owner": {"reputation": 5268, "user_id": 302164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XucHp.png?s=128&g=1", "display_name": "miltonb", "link": "https://stackoverflow.com/users/302164/miltonb"}, "is_accepted": true, "score": 6, "last_activity_date": 1462826175, "creation_date": 1462826175, "answer_id": 37125004, "question_id": 37124936, "link": "https://stackoverflow.com/questions/37124936/go-cannot-use-output-type-string-as-type-io-writer-in-argument-to-template-exe/37125004#37125004", "title": "go cannot use output (type string) as type io.Writer in argument to template Execute", "body": "<p>You need to write to a buffer as follows as this implements the interface <code>io.Writer</code>.  Its basically missing a Write method, which you could build your own, but a buffer is more straight forward:</p>\n\n<pre><code>buf := new(bytes.Buffer)\nt := template.Must(template.New(\"html table\").Parse(tmplhtml))\nerr = t.Execute(buf, Files)\n</code></pre>\n"}], "owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3329, "favorite_count": 0, "accepted_answer_id": 37125004, "answer_count": 1, "score": 2, "last_activity_date": 1462826175, "creation_date": 1462825931, "question_id": 37124936, "link": "https://stackoverflow.com/questions/37124936/go-cannot-use-output-type-string-as-type-io-writer-in-argument-to-template-exe", "title": "go cannot use output (type string) as type io.Writer in argument to template Execute", "body": "<p>It's easy to execute template ('tmplhtml' in my case) in 'go' to <em>os.Stdout</em> but how to write it to a string 'output' so I can later i.e. send html in mail using <code>\"gopkg.in/gomail.v2\"</code> ?</p>\n\n<pre><code>var output string\n    t := template.Must(template.New(\"html table\").Parse(tmplhtml))\n    err = t.Execute(output, Files)\nm.SetBody(\"text/html\", output) //\"gopkg.in/gomail.v2\"\n</code></pre>\n\n<p>Build error reads <strong>'cannot use output (type string) as type io.Writer in argument to t.Execute: string does not implement io.Writer (missing Write method)'</strong> I can implement Writer method but it is supposed to return integer <strong>Write(p []byte) (n int, err error)</strong></p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1484322378, "last_edit_date": 1484322378, "creation_date": 1462823896, "answer_id": 37124411, "question_id": 37124256, "link": "https://stackoverflow.com/questions/37124256/go-cant-evaluate-field-when-using-range-to-build-from-template/37124411#37124411", "title": "Go can&#39;t evaluate field when using range to build from template", "body": "<p>The initial value of your pipeline (the <em>dot</em>) is the value you pass to <a href=\"https://golang.org/pkg/text/template/#Template.Execute\" rel=\"nofollow noreferrer\"><code>Template.Execute()</code></a> which in your case is <code>Files</code> which is of type <code>[]File</code>.</p>\n\n<p>So during your template execution the <em>dot</em> <code>.</code> is <code>[]File</code>. This slice has no field or method named <code>Files</code> which is what <code>.Files</code> would refer to in your template.</p>\n\n<p>What you should do is simply use <code>.</code> which refers to your slice:</p>\n\n<pre><code>const tmpl = `\n    {{range .}}\n    file {{.}}\n    {{end}}\n`\n</code></pre>\n\n<p>And that's all. Testing it:</p>\n\n<pre><code>var Files []File = []File{\n    File{\"data.txt\", 123},\n    File{\"prog.txt\", 5678},\n}\nt := template.Must(template.New(\"html\").Parse(tmpl))\nerr := t.Execute(os.Stdout, Files)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/JDorrjAMm7\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>file {data.txt 123}\n\nfile {prog.txt 5678}\n</code></pre>\n"}], "owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3537, "favorite_count": 0, "accepted_answer_id": 37124411, "answer_count": 1, "score": 1, "last_activity_date": 1484322378, "creation_date": 1462823317, "last_edit_date": 1462825284, "question_id": 37124256, "link": "https://stackoverflow.com/questions/37124256/go-cant-evaluate-field-when-using-range-to-build-from-template", "title": "Go can&#39;t evaluate field when using range to build from template", "body": "<p>I have <code>Files</code> slice of <code>File</code> structure in my Go program to keep name and size of files. I created template, see below:</p>\n\n<pre><code>type File struct {\n    FileName string\n    FileSize int64\n}\nvar Files []File\nconst tmpl = `\n    {{range .Files}}\n    file {{.}}\n    {{end}}\n    `\nt := template.Must(template.New(\"html\").Parse(tmplhtml))\n    err = t.Execute(os.Stdout, Files)\n    if err != nil { panic(err) }\n</code></pre>\n\n<p>Of course I got panic saying:</p>\n\n<blockquote>\n  <p>can't evaluate field Files in type []main.File</p>\n</blockquote>\n\n<p>Not sure how to correctly display file names and sizes using <code>range</code> in template.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2447, "user_id": 419074, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4eb9847296c397d04aa464eb17ca2c16?s=128&d=identicon&r=PG&f=1", "display_name": "0x0", "link": "https://stackoverflow.com/users/419074/0x0"}, "edited": false, "score": 0, "creation_date": 1462821683, "post_id": 37122401, "comment_id": 61788371, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/15049903/how-to-use-custom-packages-in-golang\">How to use custom packages in golang?</a>"}, {"owner": {"reputation": 129, "user_id": 6311705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16d118e3b68d08d54b961465f22b8e18?s=128&d=identicon&r=PG&f=1", "display_name": "Luca S.", "link": "https://stackoverflow.com/users/6311705/luca-s"}, "reply_to_user": {"reputation": 2447, "user_id": 419074, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4eb9847296c397d04aa464eb17ca2c16?s=128&d=identicon&r=PG&f=1", "display_name": "0x0", "link": "https://stackoverflow.com/users/419074/0x0"}, "edited": false, "score": 0, "creation_date": 1462821843, "post_id": 37122401, "comment_id": 61788463, "body": "It&#39;s not a duplicate, the question you mention wants to import a go source file, which is already known before the program is run, while I want to load a go source file/compiled file and only get the filename during runtime."}], "answers": [{"comments": [{"owner": {"reputation": 129, "user_id": 6311705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16d118e3b68d08d54b961465f22b8e18?s=128&d=identicon&r=PG&f=1", "display_name": "Luca S.", "link": "https://stackoverflow.com/users/6311705/luca-s"}, "edited": false, "score": 0, "creation_date": 1462819185, "post_id": 37123000, "comment_id": 61787011, "body": "Can exec.Command() really execute a program with arguments like an http.ResponseWriter? Also I only get the file name on runtime, which is why the first solution wouldn&#39;t work if I understood correctly what you mean."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 129, "user_id": 6311705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16d118e3b68d08d54b961465f22b8e18?s=128&d=identicon&r=PG&f=1", "display_name": "Luca S.", "link": "https://stackoverflow.com/users/6311705/luca-s"}, "edited": false, "score": 0, "creation_date": 1462819601, "post_id": 37123000, "comment_id": 61787224, "body": "It will be better if you provide some sample code for your http.ResponseWriter , I think the 3rd way is better suits for this, I will add sample ASAP"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 129, "user_id": 6311705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16d118e3b68d08d54b961465f22b8e18?s=128&d=identicon&r=PG&f=1", "display_name": "Luca S.", "link": "https://stackoverflow.com/users/6311705/luca-s"}, "edited": false, "score": 1, "creation_date": 1462819643, "post_id": 37123000, "comment_id": 61787253, "body": "@LucaS. You can&#39;t serialize an http.ResponseWriter, since it&#39;s an interface, the package implementation contains state, and it handles a network connection."}, {"owner": {"reputation": 129, "user_id": 6311705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16d118e3b68d08d54b961465f22b8e18?s=128&d=identicon&r=PG&f=1", "display_name": "Luca S.", "link": "https://stackoverflow.com/users/6311705/luca-s"}, "edited": false, "score": 0, "creation_date": 1462820344, "post_id": 37123000, "comment_id": 61787627, "body": "Edit: I&#39;m gonna publish the code I use, I made a little server and I want to use it to server dynamic content programmed in go"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1462821558, "post_id": 37123000, "comment_id": 61788305, "body": "do you have source of bothe sides?"}, {"owner": {"reputation": 129, "user_id": 6311705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16d118e3b68d08d54b961465f22b8e18?s=128&d=identicon&r=PG&f=1", "display_name": "Luca S.", "link": "https://stackoverflow.com/users/6311705/luca-s"}, "edited": false, "score": 0, "creation_date": 1462822200, "post_id": 37123000, "comment_id": 61788679, "body": "I haven&#39;t programmed the dynamic page yet, because I don&#39;t know how to get that ResponseWriter and Request to the page and without these the page would be worthless."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 1, "creation_date": 1462823306, "post_id": 37123000, "comment_id": 61789307, "body": "is there any reason you are using two separate programs"}, {"owner": {"reputation": 129, "user_id": 6311705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16d118e3b68d08d54b961465f22b8e18?s=128&d=identicon&r=PG&f=1", "display_name": "Luca S.", "link": "https://stackoverflow.com/users/6311705/luca-s"}, "edited": false, "score": 0, "creation_date": 1462823939, "post_id": 37123000, "comment_id": 61789679, "body": "For some pages that might work, but when I get many dynamic pages using separate programs will be clearer."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 1, "creation_date": 1462824263, "post_id": 37123000, "comment_id": 61789842, "body": "So you don\u2019t need to send http.ResponseWriter. The best way for communicating between two programs inside one computer is using pipes or even TCP it is very simple this way. But in case of calling another function from another program \u201cnet/rpc\u201d is the suitable way, I think."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 14, "last_activity_date": 1462838161, "last_edit_date": 1462838161, "creation_date": 1462818802, "answer_id": 37123000, "question_id": 37122401, "link": "https://stackoverflow.com/questions/37122401/execute-another-go-program-from-within-a-golang-program/37123000#37123000", "title": "Execute another go program from within a golang program", "body": "<p>There are many ways to do this <strong>Interoperability</strong> :<br>\n1- I recommend to use standard golang package (Lib) calling, instead of Interoperability, if you have source files of both sides. </p>\n\n<p>2- using \"os/exec\": if you don't have source, and you have only binary,\n or you may pass args through files or text args:</p>\n\n<p>you may pass args  like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n\n    fmt.Println(os.Args[0]) // fileNameAndPath\n}\n</code></pre>\n\n<p>or using \"flag\" std lib:</p>\n\n<pre><code>// flags.exe -h\npackage main\n\nimport (\n    \"flag\"\n    \"fmt\"\n)\n\nfunc main() {\n    namePtr := flag.String(\"name\", \"AR\", \"name\")\n    agePtr := flag.Int(\"age\", 3700, \"age\")\n    flag.Parse()\n    fmt.Println(*namePtr, *agePtr) //AR 3700\n}\n\n/*\nUsage of flags.exe:\n  -age int\n        age (default 3700)\n  -name string\n        name (default \"AR\")\n*/\n</code></pre>\n\n<p>which will provides -h for help.<br>\nand you can call another binary program or golang compiler itself like this:  </p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmnd := exec.Command(\"main.exe\", \"arg\")\n    //cmnd.Run() // and wait\n    cmnd.Start()\n    log.Println(\"log\")\n}\n</code></pre>\n\n<p>3- another way is calling an external program by using stdin /stdout.<br>\nin this way you can send binary data over stdin/out:<br>\nHere file \"a\" calls binary file \"b\" and sends and receives through stdin/stdout:<br>\nthis is my conversion from :<br>\n<a href=\"http://erlang.org/doc/tutorial/c_port.html\" rel=\"noreferrer\">http://erlang.org/doc/tutorial/c_port.html</a><br>\n(you may use os named pipe)<br>\nfile a:  </p>\n\n<pre><code>// a\npackage main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n    \"runtime\"\n    \"time\"\n)\n\nvar cout chan []byte = make(chan []byte)\nvar cin chan []byte = make(chan []byte)\nvar exit chan bool = make(chan bool)\n\nfunc Foo(x byte) byte { return call_port([]byte{1, x}) }\nfunc Bar(y byte) byte { return call_port([]byte{2, y}) }\nfunc Exit() byte      { return call_port([]byte{0, 0}) }\nfunc call_port(s []byte) byte {\n    cout &lt;- s\n    s = &lt;-cin\n    return s[1]\n}\n\nfunc start() {\n    fmt.Println(\"start\")\n    cmd := exec.Command(\"../b/b\")\n    stdin, err := cmd.StdinPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n    stdout, err2 := cmd.StdoutPipe()\n    if err2 != nil {\n        log.Fatal(err2)\n    }\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n    defer stdin.Close()\n    defer stdout.Close()\n    for {\n        select {\n        case s := &lt;-cout:\n            stdin.Write(s)\n            buf := make([]byte, 2)\n            runtime.Gosched()\n            time.Sleep(100 * time.Millisecond)\n            stdout.Read(buf)\n            cin &lt;- buf\n        case b := &lt;-exit:\n            if b {\n                fmt.Printf(\"Exit\")\n                return //os.Exit(0)\n            }\n        }\n    }\n}\nfunc main() {\n    go start()\n    runtime.Gosched()\n    fmt.Println(\"30+1=\", Foo(30)) //30+1= 31\n    fmt.Println(\"2*40=\", Bar(40)) //2*40= 80\n    Exit()\n    exit &lt;- true\n}\n</code></pre>\n\n<p>file b:  </p>\n\n<pre><code>// b\npackage main\n\nimport (\n    \"log\"\n    \"os\"\n)\n\nfunc foo(x byte) byte { return x + 1 }\nfunc bar(y byte) byte { return y * 2 }\n\nfunc ReadByte() byte {\n    b1 := make([]byte, 1)\n    for {\n        n, _ := os.Stdin.Read(b1)\n        if n == 1 {\n            return b1[0]\n        }\n    }\n}\nfunc WriteByte(b byte) {\n    b1 := []byte{b}\n    for {\n        n, _ := os.Stdout.Write(b1)\n        if n == 1 {\n            return\n        }\n    }\n}\nfunc main() {\n    var res byte\n    for {\n        fn := ReadByte()\n        log.Println(\"fn=\", fn)\n        arg := ReadByte()\n        log.Println(\"arg=\", arg)\n        if fn == 1 {\n            res = foo(arg)\n        } else if fn == 2 {\n            res = bar(arg)\n        } else if fn == 0 {\n            return //exit\n        } else {\n            res = fn //echo\n        }\n        WriteByte(1)\n        WriteByte(res)\n    }\n}\n</code></pre>\n\n<p>4 - another way is using \"net/rpc\", this is best way for calling another function from another program.<br>\nsample:</p>\n\n<pre><code>// rpc\npackage main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"net/rpc\"\n    \"runtime\"\n    \"sync\"\n)\n\nvar wg sync.WaitGroup\n\ntype Server struct{}\n\nfunc (this *Server) Add(u [2]int64, reply *int64) error {\n    *reply = u[0] + u[1]\n    return nil\n}\n\nfunc server() {\n    fmt.Println(\"server: Hi\")\n    rpc.Register(new(Server))\n    ln, err := net.Listen(\"tcp\", \"127.0.0.1:12345\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    for {\n        c, err := ln.Accept()\n        if err != nil {\n            continue\n        }\n        go rpc.ServeConn(c)\n    }\n}\n\nfunc client() {\n    wg.Add(1)\n    c, err := rpc.Dial(\"tcp\", \"127.0.0.1:12345\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(\"Connected...\")\n    var result int64\n    err = c.Call(\"Server.Add\", [2]int64{10, 20}, &amp;result)\n    if err != nil {\n        fmt.Println(err)\n    } else {\n        fmt.Println(\"Server.Add(10,20) =\", result)\n    }\n    wg.Done()\n}\n\nfunc main() {\n    go server()\n    runtime.Gosched()\n    go client()\n    runtime.Gosched()\n    wg.Wait()\n    fmt.Println(\"Bye\")\n}\n\n/*output:\nserver: Hi\nConnected...\nServer.Add(10,20) = 30\nBye\n*/\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 129, "user_id": 6311705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16d118e3b68d08d54b961465f22b8e18?s=128&d=identicon&r=PG&f=1", "display_name": "Luca S.", "link": "https://stackoverflow.com/users/6311705/luca-s"}, "edited": false, "score": 0, "creation_date": 1462822601, "post_id": 37123869, "comment_id": 61788901, "body": "Well yeah I kinda try to use PHP concepts in Go, but text/template doesn&#39;t fit my criteria, e.g. I need to redirect based on files and that stuff"}], "tags": [], "owner": {"reputation": 124, "user_id": 6220497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d219408d5528bce91419cd0b40cdb07?s=128&d=identicon&r=PG&f=1", "display_name": "Miles Smith", "link": "https://stackoverflow.com/users/6220497/miles-smith"}, "is_accepted": false, "score": 4, "last_activity_date": 1462823554, "last_edit_date": 1462823554, "creation_date": 1462821963, "answer_id": 37123869, "question_id": 37122401, "link": "https://stackoverflow.com/questions/37122401/execute-another-go-program-from-within-a-golang-program/37123869#37123869", "title": "Execute another go program from within a golang program", "body": "<p>Using <code>os/exec</code>, you can call the go compiler like so:</p>\n\n<pre><code>output, err := exec.Command(\"go\", \"run\", \"/file/path/to/open\").Output() \nif err == nil {\n    w.Write(output) // write the output with ResponseWriter\n}\n</code></pre>\n\n<p>Go doesn't pass parameters to programs through <code>main</code>, eg <code>func main(x int)</code>. The way to do it in Go is with <code>os.Args</code>.</p>\n\n<p>It seems to me that you're trying to use PHP concepts in Go, which will not end well. Instead you should be using templates and static files to achieve a dynamic website. Check out the package <code>text/template</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1539771680, "creation_date": 1539771680, "answer_id": 52852572, "question_id": 37122401, "link": "https://stackoverflow.com/questions/37122401/execute-another-go-program-from-within-a-golang-program/52852572#52852572", "title": "Execute another go program from within a golang program", "body": "<p>Create an executabl file for the package you want to run from another file. Provide relative path for the file you want to run inside <code>exec.Command</code>. For example:</p>\n\n<p><strong>File A</strong></p>\n\n<pre><code>package a\n\nimport \"fmt\"\n\nfunc main(){\n    for i:=0;i&lt;10;i++{\n         fmt.Println(fmt.Sprintf(\"Process: %d\", i))\n    }\n}\n</code></pre>\n\n<p>Create a binary/executable for above file. The file will be inside the package so walk to the package and run the executable file. </p>\n\n<pre><code>go build github.com/user/a/a.go // or whatever be your GOPATH for executables to create a binary file\n</code></pre>\n\n<p>Below is the case of binary file inside linux systems.</p>\n\n<p><strong>File B</strong></p>\n\n<pre><code>package b\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n)    \n\nfunc main(){\n    // come out of package b and then go inside package a to run the executable file as\n    cmd := exec.Command(\"../a/a.go\")\n    if err := cmd.Run(); err != nil{\n       fmt.Println(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 129, "user_id": 6311705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/16d118e3b68d08d54b961465f22b8e18?s=128&d=identicon&r=PG&f=1", "display_name": "Luca S.", "link": "https://stackoverflow.com/users/6311705/luca-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 23486, "favorite_count": 9, "answer_count": 3, "score": 8, "last_activity_date": 1539771680, "creation_date": 1462816732, "question_id": 37122401, "link": "https://stackoverflow.com/questions/37122401/execute-another-go-program-from-within-a-golang-program", "title": "Execute another go program from within a golang program", "body": "<p>I want to execute another go program from inside another go program and give it args, something like this:</p>\n\n<pre><code>package main\nfunc main() {\n  //here I want to call a specific go file, e.g. test.go with args\n}\n</code></pre>\n\n<p>test.go</p>\n\n<pre><code>package main\nfunc main(x int) {\n  //do stuff with x\n}\n</code></pre>\n\n<p>I don't want to sent an int as arg, but something like http.ResponseWriter</p>\n\n<p>A solution I thought off, but it wouldn't be really good:</p>\n\n<ol>\n<li>Use gob to convert the http.ResponseWriter into a string</li>\n<li>Read in a line from test.go</li>\n<li>Sent the string to test.go</li>\n</ol>\n\n<p>Thanks for any answers :D</p>\n"}, {"tags": ["javascript", "ajax", "templates", "go", "refresh"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 5, "last_activity_date": 1466270394, "last_edit_date": 1466270394, "creation_date": 1462805919, "answer_id": 37119014, "question_id": 37118281, "link": "https://stackoverflow.com/questions/37118281/dynamically-refresh-a-part-of-the-template-when-a-variable-is-updated-golang/37119014#37119014", "title": "Dynamically refresh a part of the template when a variable is updated golang", "body": "<p>The template engine does not support this out-of-the-box.</p>\n\n<p>So you have to implement it yourself. It's not that hard. Here are the steps you should follow to achieve it:</p>\n\n<h3>1. Refactor your templates</h3>\n\n<p>Separate the template that renders the Addresses to be on its own by using a <code>{{define \"name\"}}</code> action. You may put it in a different template file and include it in its current place by using <code>{{template \"name\"}}</code> action, or you may leave it in the original place and use the new <code>{{block \"name\" pipeline}} T1 {{end}}</code> action (introduced in Go 1.6) which defines the template and executes it at once.</p>\n\n<h3>2. Modify/create handlers</h3>\n\n<p>Make sure you have a handler which executes only this new template that renders the Addressees. The result of executing the Addressees template should be sent directly to the output (<code>w http.ResponseWriter</code>).</p>\n\n<p>Note that you may use 1 handler to execute both the \"full\" page template and only the Addressees template (e.g. deciding based on a URL parameter), or you may have 2 distinct handlers, it's really up to you.</p>\n\n<h3>3. Modify client side</h3>\n\n<p>Now at client side when you want to refresh / rerender the Addressees, make an AJAX call to the handler that only executes and renders the Addressees template.</p>\n\n<p>When this AJAX call completes, you may simply use the response text of the AJAX call to replace the HTML content of the wrapper tag of Addressees.</p>\n\n<p>It may look something like this:</p>\n\n<pre><code>var e = document.getElementById(\"addressees\");\nvar xhr = new XMLHttpRequest();\nxhr.onreadystatechange = function() {\n    if (xhr.readyState == 4 &amp;&amp; xhr.status == 200) {\n        e.outerHTML = xhr.responseText;\n    }\n}\nxhr.open(\"GET\", \"path-to-addresses-render\", true);\ntry {\n    xhr.send();\n} catch (err) {\n    // handle error\n}\n</code></pre>\n\n<p><a href=\"https://github.com/icza/gowut\" rel=\"noreferrer\"><strong>Gowut</strong></a> (which is a web framework for building single-page web applications using pure Go) does something similar to update only parts of the web page without full page reload (although it doesn't use templates at the back-end side). <em>(Disclosure: I'm the author of Gowut.)</em></p>\n\n<p>You may check out the exact Javascript code how Gowut does it in its <a href=\"https://github.com/icza/gowut/blob/master/gwu/js.go\" rel=\"noreferrer\"><code>js.go</code></a> file (look for the <code>rerenderComp()</code> Javascript function).</p>\n"}], "owner": {"reputation": 3515, "user_id": 3535789, "user_type": "registered", "accept_rate": 22, "profile_image": "https://lh5.googleusercontent.com/-MCMsLSzu5b8/AAAAAAAAAAI/AAAAAAAAC3U/j8-d6DkGEA0/photo.jpg?sz=128", "display_name": "GuillaumeAgis", "link": "https://stackoverflow.com/users/3535789/guillaumeagis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5047, "favorite_count": 3, "answer_count": 1, "score": 6, "last_activity_date": 1466270394, "creation_date": 1462803882, "question_id": 37118281, "link": "https://stackoverflow.com/questions/37118281/dynamically-refresh-a-part-of-the-template-when-a-variable-is-updated-golang", "title": "Dynamically refresh a part of the template when a variable is updated golang", "body": "<p>In Golang, it is possible to refresh a part of a template when a variable is updated ? \nThis is something that we can find in Angular.js for instance.</p>\n\n<p>Basically in my code, I lookup adresses by a postcode in ajax, which display my list of addr found for this postcode. </p>\n\n<p>Here is a sample of the template : \n<a href=\"https://i.stack.imgur.com/odM74.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/odM74.png\" alt=\"enter image description here\"></a></p>\n\n<p>At the moment, the ajax calls a GO routine. I don't want to get the result in the JS and build the html from the result of the ajax call.</p>\n\n<p>I would like, if possible, to update only the Addresses value (it's an array) as I already build the list of addr dynamically. </p>\n\n<p>Any clue ? </p>\n"}, {"tags": ["json", "go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1462804766, "creation_date": 1462804766, "answer_id": 37118633, "question_id": 37118263, "link": "https://stackoverflow.com/questions/37118263/is-it-possible-to-have-a-struct-with-multiple-json-tags/37118633#37118633", "title": "Is it possible to have a struct with multiple JSON tags?", "body": "<p>It's not possible. The <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow\"><code>encoding/json</code></a> package only handles the <code>json</code> key in struct tags. If the <code>json</code> key is listed multiple times (as in your example), the first occurrence will be used (this is implemented in <a href=\"https://golang.org/pkg/reflect/#StructTag.Get\" rel=\"nofollow\"><code>StructTag.Get()</code></a>).</p>\n\n<p>Note that this is an implementation restriction of the <code>encoding/json</code> package and not that of Go. One could easily create a similar JSON encoding package supporting either multiple tag keys (e.g. <code>json1</code>, <code>json2</code>) or multiple occurrences of the same key (as in your example).</p>\n"}, {"comments": [{"owner": {"reputation": 311, "user_id": 4957046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a6e531ff15d53c5177d2ca8d9206b99?s=128&d=identicon&r=PG", "display_name": "exyzzy", "link": "https://stackoverflow.com/users/4957046/exyzzy"}, "edited": false, "score": 0, "creation_date": 1588808797, "post_id": 52930903, "comment_id": 109046146, "body": "This was very helpful for me in working with nearly identical data from two different sources - thanks"}], "tags": [], "owner": {"reputation": 102112, "user_id": 1950, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/c6aff8891ef80596f70263baf7bcf47f?s=128&d=identicon&r=PG", "display_name": "Jon Erickson", "link": "https://stackoverflow.com/users/1950/jon-erickson"}, "is_accepted": false, "score": 1, "last_activity_date": 1540215798, "creation_date": 1540215798, "answer_id": 52930903, "question_id": 37118263, "link": "https://stackoverflow.com/questions/37118263/is-it-possible-to-have-a-struct-with-multiple-json-tags/52930903#52930903", "title": "Is it possible to have a struct with multiple JSON tags?", "body": "<p>What is possible though, with 2 identically laid out structs (namin, types and ordering of fields needs to match exactly) is to cast from one to the other. I would be very cautious of doing this though and make sure the 2nd type (bar in your example) is unexported to prevent from being used elsewhere.</p>\n\n<p><a href=\"https://play.golang.org/p/y8EH1U9_3jN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/y8EH1U9_3jN</a></p>\n"}], "owner": {"reputation": 133, "user_id": 2225393, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/99ecc0f27896b0cac269ffc3ef284605?s=128&d=identicon&r=PG", "display_name": "ray", "link": "https://stackoverflow.com/users/2225393/ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3722, "favorite_count": 0, "accepted_answer_id": 37118633, "answer_count": 2, "score": 4, "last_activity_date": 1540215798, "creation_date": 1462803838, "last_edit_date": 1540207366, "question_id": 37118263, "link": "https://stackoverflow.com/questions/37118263/is-it-possible-to-have-a-struct-with-multiple-json-tags", "title": "Is it possible to have a struct with multiple JSON tags?", "body": "<p>I post a request to a server and get a reply in JSON format. I'm able to unmarshal it to a struct. Then I need to create a new JSON file with the same data but different JSON tags. </p>\n\n<p><strong>Example:</strong></p>\n\n<p>In the following code, I get <code>{\"name\":\"Sam\",\"age\":20}</code> from a server and unmarshal it to the struct <code>Foo</code>:</p>\n\n<pre><code>type Foo struct {\n    Name string `json:\"name\"`\n    Age  int    `json:\"age\"`\n}\n</code></pre>\n\n<p>Then I need to change the tag <code>name</code> to <code>employee_name</code> and omit <code>age</code>:</p>\n\n<pre><code>type Bar struct {\n    Name string `json:\"employee_name\"`\n    Age  int    `json:\"-\"`\n}\n</code></pre>\n\n<p>After that I send this modified data to another server.</p>\n\n<p>I know I could just create a new <code>Bar</code> and copy all data into it, but there are a lot of fields. I was wondering if there is a way to attach multiple JSON tags like this:</p>\n\n<pre><code>type Foo struct {\n    Name string `json:\"name\" json:\"employee_name\"`\n    Age  int    `json:\"age\" json:\"-\"`\n}        \n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["file", "unicode", "go", "rename"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1462799028, "post_id": 37116357, "comment_id": 61774103, "body": "Please show us code sample how you tried to rename it. Refer to <a href=\"http://stackoverflow.com/help/mcve\">MCVE</a>."}, {"owner": {"reputation": 590, "user_id": 2128025, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/LXH24.jpg?s=128&g=1", "display_name": "Spouk", "link": "https://stackoverflow.com/users/2128025/spouk"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1462800164, "post_id": 37116357, "comment_id": 61774870, "body": "Adding code sample. Enjoy."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1462811020, "post_id": 37116357, "comment_id": 61782481, "body": "<code>&quot;\\\\u&quot; + strconv.FormatInt(int64(r), 16)</code> is not doing what you think."}], "owner": {"reputation": 590, "user_id": 2128025, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/LXH24.jpg?s=128&g=1", "display_name": "Spouk", "link": "https://stackoverflow.com/users/2128025/spouk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 270, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1462799998, "creation_date": 1462798410, "last_edit_date": 1462799998, "question_id": 37116357, "link": "https://stackoverflow.com/questions/37116357/golang-rename-unicode-file-name", "title": "Golang Rename unicode file name", "body": "<p>How to rename a file in unicode format, the gaps?\nWhen you try to rename the standard library function, the file is not located.</p>\n\n<pre><code>Old: /usr/home/spouk/go/src/simple/Agraba - I Know You Are Smiling Now (Original Mix).mp4 New: /usr/home/spouk/go/src/simple/Agraba_-_I_Know_You_Are_Smiling_Now__Original_Mix_.mp4 [RENAME] rename Agraba - I Know You Are Smiling Now (Original Mix).mp4 /usr/home/spouk/go/src/simple/Agraba_-_I_Know_You_Are_Smiling_Now__Original_Mix_.mp4: no such file or directory\n</code></pre>\n\n<p>Someone tell me what to use or where to get acquainted with the direction of solution to this problem. Tnx.</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    d \"github.com/fiam/gounidecode/unidecode\"\n    \"fmt\"\n    \"path/filepath\"\n    \"os\"\n    \"strings\"\n    \"strconv\"\n    \"os/exec\"\n)\n\ntype (\n    File struct {\n        OriginPath  string\n        ConvertPath string\n    }\n    FilesStack struct {\n        Files   []File\n        InPath  string\n        OutPath string\n    }\n)\n\nfunc NewFilesStack() *FilesStack {\n    n := new(FilesStack)\n    n.Files = []File{}\n    return n\n}\nfunc (f *FilesStack) RuneToAscii(r rune) string {\n    if r &lt; 128 {\n        return string(r)\n    } else {\n        return \"\\\\u\" + strconv.FormatInt(int64(r), 16)\n    }\n}\nfunc (f *FilesStack) TransliterCyr(str string) string {\n    var result []string\n    for _, sym := range d.Unidecode(str) {\n        if (f.RuneToAscii(sym) == \" \") || (f.RuneToAscii(sym) == \"'\") || (f.RuneToAscii(sym) == \"`\") || (f.RuneToAscii(sym) == \")\") || (f.RuneToAscii(sym) == \"(\") {\n            result = append(result, \"_\")\n        } else {\n            result = append(result, f.RuneToAscii(sym))\n        }\n    }\n    return strings.Join(result, \"\")\n}\nfunc (f *FilesStack) walkFunction(path string, info os.FileInfo, err error) error {\n\n    if !info.IsDir() {\n        res, err := filepath.Abs(filepath.Dir(info.Name()))\n        if err != nil {\n            fmt.Printf(err.Error())\n        }\n        ext := filepath.Ext(info.Name())\n        if ext == \".mp4\" {\n            file := new(File)\n            //make new file name\n            oldfile := filepath.Join(res, info.Name())\n            newname := filepath.Join(res, f.TransliterCyr(info.Name()))\n\n            file.OriginPath = filepath.Join(res, newname)\n            fmt.Printf(\"Old: %s\\nNew: %s\\n\", oldfile, newname)\n\n            //rename file\n            if err_rename := os.Rename(info.Name(), newname); err_rename != nil {\n                fmt.Printf(\"[RENAME] %s\\n\", err_rename.Error())\n            }\n\n            tmpname := []string{}\n            name := strings.TrimRight(info.Name(), filepath.Ext(info.Name()))\n            for _, sym := range name {\n                if f.RuneToAscii(sym) != \" \" {\n                    tmpname = append(tmpname, string(sym))\n                }\n            }\n            word := strings.Join(tmpname, \"\")\n            oo, _ := filepath.Abs(f.OutPath)\n            rr := strings.Join([]string{f.TransliterCyr(word), \".mp3\"}, \"\")\n            //fmt.Printf(\"Res: %v %v\\n\", rr, word)\n            file.ConvertPath = filepath.Join(oo, rr)\n            //fmt.Printf(\"Infile: %v\\n\", file.OriginPath)\n            //fmt.Printf(\"Outfile: %v\\n\", file.ConvertPath)\n            f.Files = append(f.Files, *file)\n        }\n    }\n    return nil\n}\nfunc (f *FilesStack) ParseFilesmp4() {\n    //\u043f\u0430\u0440\u0441\u0438\u043d\u0433 \u0444\u0430\u0439\u043b\u043e\u0432\n    if err := filepath.Walk(f.InPath, f.walkFunction); err != nil {\n        fmt.Printf(err.Error())\n    }\n    //\u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0430\u0446\u0438\u044f\n\n    for _, file := range f.Files {\n        fmt.Printf(\"Start convertation %s \\n\", file.OriginPath)\n        command := fmt.Sprintf(\"ffmpeg -i %s -f mp3 %s\", file.OriginPath, file.ConvertPath)\n        //fmt.Printf(\"Command %v\\n\", command)\n        cmd, err_convert := exec.Command(command).Output()\n        if err_convert != nil {\n            fmt.Printf(err_convert.Error())\n        }\n\n        fmt.Printf(\"Result convert: %v\\n\", cmd)\n    }\n}\n\n// note, that variables are pointers\nvar (\n    inpath = flag.String(\"inpath\", \".\", \"\u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044f \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430 \u0432\u0441\u0435\u0445 \u0444\u0430\u0439\u043b\u043e\u0432 \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043c .mp4\")\n    outpath = flag.String(\"outpath\", \".\", \"\u0434\u0438\u0440\u0435\u043a\u0442\u043e\u0440\u0438\u044f \u0434\u043b\u044f \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f .mp3\")\n)\n\nfunc main() {\n    //make files structy\n    f := NewFilesStack()\n    //parse arguments\n    flag.Parse()\n    fmt.Printf(\"inpath: %s\\noutpath: %s\\n\", *inpath, *outpath)\n    //set arguments\n    f.InPath = *inpath\n    f.OutPath = *outpath\n    f.ParseFilesmp4()\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2666, "user_id": 1421957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b8e742c4a05e312502c828847c455ad?s=128&d=identicon&r=PG", "display_name": "Tico", "link": "https://stackoverflow.com/users/1421957/tico"}, "edited": false, "score": 0, "creation_date": 1462792482, "post_id": 37114313, "comment_id": 61769852, "body": "Did you try <code>(items ...)</code>?"}, {"owner": {"reputation": 233, "user_id": 978119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/63065694841cb294dda437d16669d36e?s=128&d=identicon&r=PG", "display_name": "aloneibreak", "link": "https://stackoverflow.com/users/978119/aloneibreak"}, "reply_to_user": {"reputation": 2666, "user_id": 1421957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b8e742c4a05e312502c828847c455ad?s=128&d=identicon&r=PG", "display_name": "Tico", "link": "https://stackoverflow.com/users/1421957/tico"}, "edited": false, "score": 0, "creation_date": 1462792566, "post_id": 37114313, "comment_id": 61769905, "body": "compiler says <code>final argument in variadic function missing type</code>"}], "answers": [{"comments": [{"owner": {"reputation": 233, "user_id": 978119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/63065694841cb294dda437d16669d36e?s=128&d=identicon&r=PG", "display_name": "aloneibreak", "link": "https://stackoverflow.com/users/978119/aloneibreak"}, "edited": false, "score": 0, "creation_date": 1462793068, "post_id": 37114445, "comment_id": 61770207, "body": "sorry, my bad forgot important details why i can&#39;t use Items type in declaration added to question"}], "tags": [], "owner": {"reputation": 998, "user_id": 2325784, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f7bd93e3c87e1b2174ab0fecb5b28b?s=128&d=identicon&r=PG", "display_name": "JamesStewy", "link": "https://stackoverflow.com/users/2325784/jamesstewy"}, "is_accepted": true, "score": 0, "last_activity_date": 1462797143, "last_edit_date": 1495542232, "creation_date": 1462792743, "answer_id": 37114445, "question_id": 37114313, "link": "https://stackoverflow.com/questions/37114313/passing-array-of-structs-to-a-function-in-go/37114445#37114445", "title": "Passing array of structs to a function in Go", "body": "<p><strike>\nReplace <code>????</code> with <code>[]Item</code>: <a href=\"https://play.golang.org/p/c_d8HUNyCE\" rel=\"nofollow noreferrer\">Go Playground</a>. It is just the same as how that variable <code>report.Items</code> is defined in struct <code>Report</code>.\n</strike></p>\n\n<p>Ok, yes that does change the question. The thing I thought of immediately was that you just needed to create an interface such as <code>Itemer</code> and have <code>[]Itemer</code> in the function definition of <code>doSmth</code>:</p>\n\n<pre><code>type Itemer interface {\n    Foo() bool\n} \n\nfunc doSmth(items []Itemer) {\n    ...\n}\n</code></pre>\n\n<p>Unfortunately <a href=\"https://play.golang.org/p/ujqkleIYy7\" rel=\"nofollow noreferrer\">this does not seem to be possible</a>. I then tried some other permutations including using <code>interface{}</code>, <code>[]interface{}</code> as well as variadic functions and I couldn't get anything to work.</p>\n\n<p>After <a href=\"https://stackoverflow.com/a/7153343/2325784\">doing some research</a> it turns out that Go will not convert the type of slices. Even if each element of a slice is an instance of an interface such as <code>Itemer</code> or <code>interface{}</code> it still won't do it. <strike>I could not re-find the source but apparently</strike> This is due to the fact that a new slice would have to be created and each element would have to be type cast individually from the old slice to the new slice: <a href=\"https://stackoverflow.com/a/7975763/2325784\">https://stackoverflow.com/a/7975763/2325784</a>.</p>\n\n<p>To me this suggests that a function such as <code>doSmth</code> is not possible. </p>\n\n<p>The only thing I could suggest is to restructure the code. If you are willing to post more information about <code>Foo</code> and <code>doSmth</code> I can try to help with that.</p>\n"}, {"comments": [{"owner": {"reputation": 233, "user_id": 978119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/63065694841cb294dda437d16669d36e?s=128&d=identicon&r=PG", "display_name": "aloneibreak", "link": "https://stackoverflow.com/users/978119/aloneibreak"}, "edited": false, "score": 0, "creation_date": 1462793064, "post_id": 37114487, "comment_id": 61770204, "body": "sorry, my bad forgot important details why i can&#39;t use Items type in declaration added to question"}, {"owner": {"reputation": 998, "user_id": 2325784, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f7bd93e3c87e1b2174ab0fecb5b28b?s=128&d=identicon&r=PG", "display_name": "JamesStewy", "link": "https://stackoverflow.com/users/2325784/jamesstewy"}, "edited": false, "score": 0, "creation_date": 1462793163, "post_id": 37114487, "comment_id": 61770271, "body": "This is syntactically incorrect: <code>undefined: report in report.Items</code>. Also, if you wanted to use a variadic function you would need to call <code>doSmth</code> like <code>doSmth(report.Items...)</code>."}, {"owner": {"reputation": 233, "user_id": 978119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/63065694841cb294dda437d16669d36e?s=128&d=identicon&r=PG", "display_name": "aloneibreak", "link": "https://stackoverflow.com/users/978119/aloneibreak"}, "edited": false, "score": 0, "creation_date": 1462793350, "post_id": 37114487, "comment_id": 61770399, "body": "<code>report</code> variable created earlier kind of <code>report := getReport()</code>"}, {"owner": {"reputation": 998, "user_id": 2325784, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f7bd93e3c87e1b2174ab0fecb5b28b?s=128&d=identicon&r=PG", "display_name": "JamesStewy", "link": "https://stackoverflow.com/users/2325784/jamesstewy"}, "edited": false, "score": 0, "creation_date": 1462796769, "post_id": 37114487, "comment_id": 61772562, "body": "Actually this error comes from the function definition not where the function is called: <a href=\"https://play.golang.org/p/rELz-hXgGC\" rel=\"nofollow noreferrer\">play.golang.org/p/rELz-hXgGC</a>."}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 0, "last_activity_date": 1462793369, "last_edit_date": 1462793369, "creation_date": 1462792882, "answer_id": 37114487, "question_id": 37114313, "link": "https://stackoverflow.com/questions/37114313/passing-array-of-structs-to-a-function-in-go/37114487#37114487", "title": "Passing array of structs to a function in Go", "body": "<p>You need to use variadic function for this scope:</p>\n\n<pre><code>func main(){\n    //some funcs called to get the report object\n    doSmth(report.Items)\n}\nfunc doSmth(items ...report.Items){\n    for _, item := range items {\n        item.Foo()\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "is_accepted": false, "score": 0, "last_activity_date": 1462796401, "creation_date": 1462796401, "answer_id": 37115672, "question_id": 37114313, "link": "https://stackoverflow.com/questions/37114313/passing-array-of-structs-to-a-function-in-go/37115672#37115672", "title": "Passing array of structs to a function in Go", "body": "<p><em><strong>EDIT:</strong> Nvm, this wont work. Forgot about the fact that go doesn't have inheritance.</em></p>\n\n<p>You could convert the array into a slice, and make the function take a slice as a parameter instead. </p>\n\n<pre><code>names := []string{\"leto\", \"paul\", \"teg\"}\nprocess(names[:])\n\nfunc process(names []string) {\n  ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 77, "user_id": 11373635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ece282de80af0de21c62cd81752535b?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin007", "link": "https://stackoverflow.com/users/11373635/kevin007"}, "is_accepted": false, "score": 0, "last_activity_date": 1584336111, "last_edit_date": 1584336111, "creation_date": 1584335127, "answer_id": 60700580, "question_id": 37114313, "link": "https://stackoverflow.com/questions/37114313/passing-array-of-structs-to-a-function-in-go/60700580#60700580", "title": "Passing array of structs to a function in Go", "body": "<p>You can call like this type of array of struct values using basic array concepts :\nIn this example , []item should be called as item.Item[i].Unitprice </p>\n\n<p>I hope u would got some idea</p>\n\n<pre><code>\ntype UserItem struct {\n    UniqueID string `json:\"uniqueID\" bson:\"uniqueID,omitempty\"`\n    Item     []Item\n}\n\n//Item : \"\"\ntype Item struct {\n    ProductName   string  `json:\"productName\" bson:\"productName,omitempty\"`\n    UnitPrice     float64 `json:\"unitPrice\" bson:\"unitPrice,omitempty\"`\n    Quantity      float64 `json:\"quantity\" bson:\"quantity,omitempty\"`\n\n//main : \"\"\nfunc main(){\n    for i := 0; i &lt; len(item.Item); i++ {\n        SubTotal := item.Item[i].UnitPrice * item.Item[i].Quantity\n        TotalTax := (item.Item[i].TaxPercentage / 100)\n        TotalTax = SubTotal * TotalTax\n        Tax := SubTotal + TotalTax\n        fmt.Println(Tax)\n}\n</code></pre>\n"}], "owner": {"reputation": 233, "user_id": 978119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/63065694841cb294dda437d16669d36e?s=128&d=identicon&r=PG", "display_name": "aloneibreak", "link": "https://stackoverflow.com/users/978119/aloneibreak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2666, "favorite_count": 0, "accepted_answer_id": 37114445, "answer_count": 4, "score": 1, "last_activity_date": 1584336111, "creation_date": 1462792317, "last_edit_date": 1462793021, "question_id": 37114313, "link": "https://stackoverflow.com/questions/37114313/passing-array-of-structs-to-a-function-in-go", "title": "Passing array of structs to a function in Go", "body": "<p>I have an object parsed from some XML file. It has struct type like this</p>\n\n<pre><code>type Report struct {\n    Items []Item `xml:......`\n    AnotherItems []AnotherItem `xml:......`\n}\ntype Item struct {\n    Name string\n}\ntype AnotherItem struct {\n    Name string\n}\nfunc (Item *Item) Foo() bool {\n    //some code here\n}\nfunc (AnotherItem *AnotherItem) Foo() bool {\n    //another code here\n}\n</code></pre>\n\n<p>For each item i have to do smth like this:</p>\n\n<pre><code>func main(){\n    //some funcs called to get the report object\n    doSmth(report.Items)\n    doSmth(report.AnotherItems)\n}\nfunc doSmth(items ????){\n    for _, item : range items {\n        item.Foo()\n    }\n}\n</code></pre>\n\n<p>Since i have different items with same function i want to have only one <code>doSmth</code> so i can't do just <code>doSmth(items []Item)</code>\nAnd the question is - what should i write instead of \"????\" to get this working?\nThe only way i made it to pass report.Items into doSmth() was </p>\n\n<pre><code>func doSmth(items interface{})\n</code></pre>\n\n<p>But it throws me an error \"cannot range over items (type interface {})\"\nAnd if instead of iteration i just put smth like </p>\n\n<pre><code>func doSmth(items interface{}){\n    fmt.Println(items)\n}\n</code></pre>\n\n<p>program print the list of my items</p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1462793162, "post_id": 37114221, "comment_id": 61770269, "body": "Where does <code>Messages{}</code> getting outputted? I don&#39;t see it&#39;s implemented somewhere"}, {"owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "reply_to_user": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1462793323, "post_id": 37114221, "comment_id": 61770383, "body": "@SimoEndre how about now? I managed to paste the wrong code snippet."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1462826839, "post_id": 37114221, "comment_id": 61791108, "body": "look at the tack trace and see where each goroutine is blocked"}], "answers": [{"comments": [{"owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "edited": false, "score": 0, "creation_date": 1462792979, "post_id": 37114415, "comment_id": 61770156, "body": "Thanks for the response,  In order to clarify my question Ive changed the original post slightly."}, {"owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "edited": false, "score": 0, "creation_date": 1462801263, "post_id": 37114415, "comment_id": 61775675, "body": "I think you missunderstood the entire question, every part of the code works, except the one i mentioned. eg. both MessageHandler and Push works as intended. &amp; they are both using go routines (as i stated in the post). The thing is: the channel is NOT the problem here. Ive used it before in another part of the program, and it worked just fine.  Also: if you look at the code provided, the fmt.Println(...) at the end of Listen(...) does get called, BUT the fmt.Println(...) right after the function call to Listen(...) does not. (Ive marked them in the original post)"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "edited": false, "score": 2, "creation_date": 1462802910, "post_id": 37114415, "comment_id": 61776885, "body": "@Olian04 - the code doesn&#39;t get called after Listen <i>because Listen blocks</i>. You need to handle that blocking behavior as per this answer."}, {"owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1462803184, "post_id": 37114415, "comment_id": 61777114, "body": "@elithrar how does it get blocked? The second to last row (the fmt.Println(..)) gets called, and that is both outside of the for loop, and its the last call of the function. Whats blocking it?"}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 2, "last_activity_date": 1462799552, "last_edit_date": 1462799552, "creation_date": 1462792658, "answer_id": 37114415, "question_id": 37114221, "link": "https://stackoverflow.com/questions/37114221/go-code-stops-executing-after-function-return/37114415#37114415", "title": "GO - Code stops executing after function return", "body": "<p>Looking at the <code>Listen</code> function you will remark that it has a <code>Messages</code> channel which receive the the <code>Message{}</code> struct, but in the main goroutine it does not get outputted. Remember that goroutines are two way communication channels, which means that if a channel does receive an input value it must have an output value the channel to not block.</p>\n\n<p>So you need to create a channel with the same struct type as the <code>Message{}</code></p>\n\n<pre><code>message := make(chan Message{})\n</code></pre>\n\n<p>Then in the Join function you have to pop out the value pushed to channel:</p>\n\n<pre><code>func Join(ws *websocket.Conn) {\n    ...\n    &lt;-message\n}\n</code></pre>\n\n<p><strong>Update after new inputs</strong>:</p>\n\n<p>It's not enough to iterate over the values coming from a channel, you need to do this inside a <code>go func()</code>. </p>\n\n<p>Getting the values out of different concurrently executing goroutines can be accomplished with the <code>select</code> keyword, which closely resembles the switch control statement and is sometimes called the communications switch.</p>\n\n<pre><code>go func() {   \n    for msg := range Messages {\n        for _, disc := range LivingDiscussions {\n            if disc.DiscussionID.UDID == msg.UDID {\n                select {\n                case disc.Push &lt;- msg: // push the channel value to the stack\n\n                default :\n                // default action\n                }\n            }\n        }\n    }\n}()\n</code></pre>\n\n<p>I don't know how your <code>disc.Push</code> method is implemented, but if the idea is to push the received channel values to a stack you have to modify your code in a way to send back the channel value to the array. In the code snippet above i've just wanted to emphasize that it's important to get the values back pushed into the channel.</p>\n"}], "owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1462803267, "creation_date": 1462792015, "last_edit_date": 1462803267, "question_id": 37114221, "link": "https://stackoverflow.com/questions/37114221/go-code-stops-executing-after-function-return", "title": "GO - Code stops executing after function return", "body": "<p>So, I'm trying to construct a websocket server in go. And i ran into this interesting bug, which i cant for the life of me figure out why its happening.</p>\n\n<p><strong>NOTE:</strong> The <strong>comments</strong> in the <strong>code snippets</strong> are there only for this post. <strong>Read them</strong>. </p>\n\n<p>Ive got this function: </p>\n\n<pre><code>func Join(ws *websocket.Conn) {\n    Log.Connection(ws)\n\n    enc := json.NewEncoder(ws)\n    dec := json.NewDecoder(ws)\n\n    var dJ g.DiscussionJoin\n    var disc g.Discussion\n\n    Log.Err(dec.Decode(&amp;dJ), \"dec.Decode\")\n\n    ssD := g.FindDiscussionByID(dJ.DiscussionID)\n\n    ssDJ := dJ.Convert(ws)\n\n    g.DiscHandle &lt;- &amp;ssDJ\n\n    disc = ssD.Convert()\n\n    Log.Err(enc.Encode(disc), \"enc.Encode\")\n\n    Log.Activity(\"Discussion\", \"Joined\", disc.DiscussionID.Subject)\n\n    fmt.Println(\"Listening\") //This gets called\n    g.Listen(dec)\n    fmt.Println(\"Stoped Listening\") //This DOESN'T get called [IT SHOULD]\n\n    ssDJ.SSDiscussion.Leave(ssDJ.SSUserID)\n\n    Log.Disconnection(ws)\n}\n</code></pre>\n\n<p>The function thats causing this is (in my opinion) g.Listen(...):</p>\n\n<pre><code>func Listen(dec *json.Decoder) {\n    timeLastSent := time.Now().Second()\n    in := Message{}\n    for ((timeLastSent + ConnTimeout) % 60) != time.Now().Second() {\n        if err := dec.Decode(&amp;in); err != nil {\n            continue\n        } else if in == Ping {\n            timeLastSent = time.Now().Second()\n            continue\n        }\n        timeLastSent = time.Now().Second()\n        Messages &lt;- in\n        in = Message{}\n    }\n    fmt.Println(\"Client timed out!\") //This gets called\n    return\n}\n</code></pre>\n\n<p>Ive tried both with and without the <strong>return</strong> on the last row of <strong>Listen</strong></p>\n\n<p>As response to @SimoEndre, Ive left the main method out of the code example, but since you mentioned it, this is the function that takes g.Messege{} out of the Messeges channel.<br>\n<strong>NOTE:</strong> MessageHandler() runs on its own go routine.</p>\n\n<pre><code>func MessageHandler() {\n    for msg := range Messages {\n        for _, disc := range LivingDiscussions {\n            if disc.DiscussionID.UDID == msg.UDID {\n                go disc.Push(msg)\n                break\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 397892, "user_id": 95592, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/utY5u.jpg?s=128&g=1", "display_name": "Matthew Rankin", "link": "https://stackoverflow.com/users/95592/matthew-rankin"}, "edited": false, "score": 0, "creation_date": 1462791378, "post_id": 37113606, "comment_id": 61769179, "body": "Does <code>Bar</code> have to be a <code>uint32</code>? Is there a reason you couldn&#39;t make that an <code>int</code>?"}, {"owner": {"reputation": 998, "user_id": 2325784, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f7bd93e3c87e1b2174ab0fecb5b28b?s=128&d=identicon&r=PG", "display_name": "JamesStewy", "link": "https://stackoverflow.com/users/2325784/jamesstewy"}, "edited": false, "score": 0, "creation_date": 1462798004, "post_id": 37113606, "comment_id": 61773390, "body": "Have you tried <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Buffered\" rel=\"nofollow noreferrer\">json.Decoder.Buffered</a> or <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Token\" rel=\"nofollow noreferrer\">json.Decoder.Token</a>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1462798427, "post_id": 37113606, "comment_id": 61773667, "body": "This is another example of why you should not use unsigned values for anything that could possibly be negative, even when a negative value is incorrect. Use an int, int32, or int64 and validate the &quot;schema&quot; another way."}, {"owner": {"reputation": 3685, "user_id": 1847261, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/87730852cde40d956d3854bea0cd2d01?s=128&d=identicon&r=PG", "display_name": "Phil K", "link": "https://stackoverflow.com/users/1847261/phil-k"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1462801870, "post_id": 37113606, "comment_id": 61776113, "body": "@JimB It is <code>uint32</code> because negative values aren&#39;t valid inputs. I <i>want</i> the unmarshalling to error because it should; the data is not valid. I just want it to be specific about where it failed so I can log meaningful data for debugging. Your solution would indeed work in the example I gave; but what if the JSON property is a string/array/object instead of an int?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1462803505, "post_id": 37113606, "comment_id": 61777384, "body": "Negative values may not be valid for <i>your</i> schema, but they <i>are</i> valid json numbers. Unsigned values should be reserved for bitwise or modulo operations, otherwise used signed values."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1462892036, "last_edit_date": 1462892036, "creation_date": 1462804539, "answer_id": 37118532, "question_id": 37113606, "link": "https://stackoverflow.com/questions/37113606/how-to-get-json-when-decoder-fails-to-unmarshal/37118532#37118532", "title": "How to get JSON when decoder fails to unmarshal?", "body": "<p>Some information is in the error, which is of type <a href=\"https://golang.org/pkg/encoding/json/#UnmarshalTypeError\" rel=\"nofollow\"><code>*json.UnamrshalTypeError</code></a></p>\n\n<pre><code>type UnmarshalTypeError struct {\n        Value  string       // description of JSON value - \"bool\", \"array\", \"number -5\"\n        Type   reflect.Type // type of Go value it could not be assigned to\n        Offset int64        // error occurred after reading Offset bytes\n}\n</code></pre>\n\n<p>You can get the offset in the json string, the <code>reflect.Type</code> of the field being unmarshaled into, and the json description of the Value. This can still pose a problem for types that implement their own unmarshaling logic, which is referenced by <a href=\"https://github.com/golang/go/issues/11858\" rel=\"nofollow\">issue 11858</a></p>\n"}, {"tags": [], "owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "is_accepted": false, "score": 0, "last_activity_date": 1462804654, "creation_date": 1462804654, "answer_id": 37118588, "question_id": 37113606, "link": "https://stackoverflow.com/questions/37113606/how-to-get-json-when-decoder-fails-to-unmarshal/37118588#37118588", "title": "How to get JSON when decoder fails to unmarshal?", "body": "<p>You can get at each element, key, value, and even delimiters using <code>decode.Token()</code> such as this in <a href=\"https://play.golang.org/p/Xp-TWF-lJH\" rel=\"nofollow\">the playground</a>, and below (modified from your example):</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    buff := bytes.NewBufferString(`{\"foo\": 123, \"bar\": -123, \"baz\": \"123\"}`)\n    decoder := json.NewDecoder(buff)\n\n    for {\n        t, err := decoder.Token()\n        if _, ok := t.(json.Delim); ok {\n            continue\n        }\n        fmt.Printf(\"type:%11T | value:%5v //\", t, t)\n\n        switch t.(type) {\n        case uint32:\n            fmt.Println(\"you don't see any uints\")\n        case int:\n            fmt.Println(\"you don't see any ints\")\n        case string:\n            fmt.Println(\"handle strings as you will\")\n        case float64:\n            fmt.Println(\"handle numbers as you will\")\n        }\n\n        if !decoder.More() {\n            break\n        }\n        if err != nil {\n            fmt.Println(err)\n        }\n    }\n}\n</code></pre>\n\n<p>This will output </p>\n\n<pre><code>type:     string | value:  foo //handle strings as you will\ntype:    float64 | value:  123 //handle numbers as you will\ntype:     string | value:  bar //handle strings as you will\ntype:    float64 | value: -123 //handle numbers as you will\ntype:     string | value:  baz //handle strings as you will\ntype:     string | value:  123 //handle strings as you will\n</code></pre>\n\n<p>You can switch on the type and handle each one as you wish. I have shown a simple example of that as well, each of the \"//comments\" in the result are conditional based on the type.</p>\n\n<p>You'll also notice that each numbers' type is float64, although they would fit into an int, or even uint in the case of the \"foo\" value, and I check for those types in the switch but they never get used. You would have to provide your own logic in order to convert the float64 values to the types you wanted if they could be and handle types that wouldn't convert as special cases, or errors or whatever you wanted.</p>\n"}, {"tags": [], "owner": {"reputation": 3685, "user_id": 1847261, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/87730852cde40d956d3854bea0cd2d01?s=128&d=identicon&r=PG", "display_name": "Phil K", "link": "https://stackoverflow.com/users/1847261/phil-k"}, "is_accepted": true, "score": 0, "last_activity_date": 1488799772, "creation_date": 1488799772, "answer_id": 42624472, "question_id": 37113606, "link": "https://stackoverflow.com/questions/37113606/how-to-get-json-when-decoder-fails-to-unmarshal/42624472#42624472", "title": "How to get JSON when decoder fails to unmarshal?", "body": "<p>As of Go 1.8 this is now possible. The <code>UnmarshalTypeError</code> type now contains <code>Struct</code> and <code>Field</code> values which provide the name of the struct and field which caused a type mismatch.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    buff := bytes.NewBufferString(\"{\\\"bar\\\": -123}\")\n    decoder := json.NewDecoder(buff)\n\n    var foo struct{\n        Bar uint32\n    }\n    if err := decoder.Decode(&amp;foo); err != nil {\n        if terr, ok := err.(*json.UnmarshalTypeError); ok {\n                fmt.Printf(\"Failed to unmarshal field %s \\n\", terr.Field)\n        } else {\n            fmt.Println(err)\n        }\n    } else {\n        fmt.Println(foo.Bar)\n    }\n}\n</code></pre>\n\n<p>The error message string also was changed to contain this new information.</p>\n\n<p>Go 1.8:</p>\n\n<pre><code>json: cannot unmarshal number -123 into Go struct field .Bar of type uint32\n</code></pre>\n\n<p>Go 1.7 and earlier:</p>\n\n<pre><code>json: cannot unmarshal number -123 into Go value of type uint32\n</code></pre>\n"}], "owner": {"reputation": 3685, "user_id": 1847261, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/87730852cde40d956d3854bea0cd2d01?s=128&d=identicon&r=PG", "display_name": "Phil K", "link": "https://stackoverflow.com/users/1847261/phil-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4549, "favorite_count": 0, "accepted_answer_id": 42624472, "answer_count": 3, "score": 2, "last_activity_date": 1488799772, "creation_date": 1462790222, "question_id": 37113606, "link": "https://stackoverflow.com/questions/37113606/how-to-get-json-when-decoder-fails-to-unmarshal", "title": "How to get JSON when decoder fails to unmarshal?", "body": "<p>I am using a <code>json.Decoder</code> to decode JSON delivered over a network stream. It works fine, but whenever someone sends data that doesn't fit the schema (e.g. sending a negative integer when the struct's field type is unsigned) it returns an error with a vague message that doesn't pinpoint the offending property. This makes debugging more difficult.</p>\n\n<p>Is there any way to extract the JSON that the decoder was trying to unmarshal when it errored? Here's a small reproducable snippet:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    buff := bytes.NewBufferString(\"{\\\"bar\\\": -123}\")\n    decoder := json.NewDecoder(buff)\n\n    var foo struct{\n        Bar uint32\n    }\n    if err := decoder.Decode(&amp;foo); err != nil {\n        fmt.Println(err)\n        fmt.Println(\"TODO: how to get JSON that caused this error?\")\n    } else {\n        fmt.Println(foo.Bar)\n    }\n}\n</code></pre>\n\n<p>Or on playground: <a href=\"https://play.golang.org/p/-WdYBkYEzJ\" rel=\"nofollow\">https://play.golang.org/p/-WdYBkYEzJ</a></p>\n"}, {"tags": ["go", "buffer", "httprequest"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 2, "creation_date": 1462788307, "post_id": 37112915, "comment_id": 61767147, "body": "Please post your code."}, {"owner": {"reputation": 4704, "user_id": 2077459, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c66fbcda79317065038bbe8f63a55267?s=128&d=identicon&r=PG", "display_name": "Prateek", "link": "https://stackoverflow.com/users/2077459/prateek"}, "reply_to_user": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1462790829, "post_id": 37112915, "comment_id": 61768831, "body": "Already mentioned that the error was in http.NewRequest when giving the body as string."}, {"owner": {"reputation": 4704, "user_id": 2077459, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c66fbcda79317065038bbe8f63a55267?s=128&d=identicon&r=PG", "display_name": "Prateek", "link": "https://stackoverflow.com/users/2077459/prateek"}, "reply_to_user": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 2, "creation_date": 1462790890, "post_id": 37112915, "comment_id": 61768876, "body": "Can anyone tell, why the downvote to question? I did not find any references of such question on the forum."}, {"owner": {"reputation": 364, "user_id": 3207109, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2a39a999be9ac8e5461d2d17d9163b49?s=128&d=identicon&r=PG&f=1", "display_name": "Thales P", "link": "https://stackoverflow.com/users/3207109/thales-p"}, "edited": false, "score": 1, "creation_date": 1498060710, "post_id": 37112915, "comment_id": 76346285, "body": "@Prateek In the world of SO, juniors can not ask questions, only seniors with 10 years of experience and perfect questions."}], "answers": [{"tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": true, "score": 6, "last_activity_date": 1462788669, "creation_date": 1462788669, "answer_id": 37113081, "question_id": 37112915, "link": "https://stackoverflow.com/questions/37112915/buffer-issue-cannot-use-type-as-type-io-reader-in-argument-to-http-newrequest/37113081#37113081", "title": "Buffer issue cannot use &lt;type&gt; as type io.Reader in argument to http.NewRequest golang", "body": "<p>This error means that the <code>http.NewRequest</code> method take a <code>io.Reader</code> interface as its <code>body</code> argument:</p>\n\n<pre><code>func NewRequest(method, urlStr string, body io.Reader) (*Request, error)\n</code></pre>\n\n<p>It is done this way so you can pass a file, a connection to a server, the response from something else to the request easily.</p>\n\n<p>The \"problem\" is that a <code>string</code> doesn't implement the <code>io.Reader</code> interface, which is defined as follow:</p>\n\n<pre><code>type Reader interface {\n   Read(p []byte) (n int, err error)\n}\n</code></pre>\n\n<p>Its not a huge problem, you can use the <code>strings.Reader</code> type which is a wrapper around a <code>string</code> that implement the said interface.</p>\n\n<pre><code>func NewReader(s string) *Reader\n</code></pre>\n\n<p>Tip: There also is a <code>bytes.Reader</code> type for the times you have a <code>[]byte</code> to pass as parameter.</p>\n"}], "owner": {"reputation": 4704, "user_id": 2077459, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c66fbcda79317065038bbe8f63a55267?s=128&d=identicon&r=PG", "display_name": "Prateek", "link": "https://stackoverflow.com/users/2077459/prateek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6283, "favorite_count": 1, "accepted_answer_id": 37113081, "answer_count": 1, "score": 2, "last_activity_date": 1462790676, "creation_date": 1462788218, "last_edit_date": 1462790676, "question_id": 37112915, "link": "https://stackoverflow.com/questions/37112915/buffer-issue-cannot-use-type-as-type-io-reader-in-argument-to-http-newrequest", "title": "Buffer issue cannot use &lt;type&gt; as type io.Reader in argument to http.NewRequest golang", "body": "<p>I was having an issue when I was passing string in http.NewRequest in golang body param. </p>\n\n<p>The error I got was :</p>\n\n<blockquote>\n  <p>cannot use req.Body (type string) as type io.Reader in argument to\n  http.NewRequest:\n          string does not implement io.Reader (missing Read method)</p>\n</blockquote>\n\n<p>Similarly there are other use cases where the Buffer is required as an input instead of a particular type or an array of it. \neg, byte[] when input required is buffer. </p>\n\n<p>What did the error mean and what are ways of solving it and understanding what golang is trying to enforce.</p>\n\n<p>Edit: This was the line I was having an issue with and did not find any references. </p>\n\n<blockquote>\n  <p>http.NewRequest(req.Method, req.Url, req.Body)</p>\n</blockquote>\n\n<p>http.NewRequest(req.Method, req.Url, strings.NewReader(req.Body)) solves the issue.\nI was planning to add the answer as well (as an FYI type of question)</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 538898, "user_id": 104349, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0f4cefeedec5163556751d61625eedd0?s=128&d=identicon&r=PG", "display_name": "Daniel Roseman", "link": "https://stackoverflow.com/users/104349/daniel-roseman"}, "edited": false, "score": 0, "creation_date": 1462788804, "post_id": 37112700, "comment_id": 61767518, "body": "Keys and indexes are completely different things. (And, for that matter, so are strings and integers.)"}, {"owner": {"reputation": 3946, "user_id": 736070, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/2ffe94c53681b5b72e448cd8a575e687?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/736070/dan"}, "reply_to_user": {"reputation": 538898, "user_id": 104349, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0f4cefeedec5163556751d61625eedd0?s=128&d=identicon&r=PG", "display_name": "Daniel Roseman", "link": "https://stackoverflow.com/users/104349/daniel-roseman"}, "edited": false, "score": 0, "creation_date": 1462789375, "post_id": 37112700, "comment_id": 61767913, "body": "That is all true, but ultimately the strings and integers that make up the datastore keys are represented as sequences of bytes on an index in order for them to be retrieved efficiently."}], "answers": [{"comments": [{"owner": {"reputation": 38473, "user_id": 821657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/qDRGg.png?s=128&g=1", "display_name": "Andrei Volgin", "link": "https://stackoverflow.com/users/821657/andrei-volgin"}, "edited": false, "score": 0, "creation_date": 1462803370, "post_id": 37113435, "comment_id": 61777263, "body": "There will be no over-writes in the Datastore itself, but you have to take care when you pass such IDs to your client and back, assuming that you allow String names that consist of integers only."}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 1, "last_activity_date": 1462789701, "creation_date": 1462789701, "answer_id": 37113435, "question_id": 37112700, "link": "https://stackoverflow.com/questions/37112700/is-it-possible-for-google-app-engine-string-and-integer-datastore-keys-to-clash/37113435#37113435", "title": "Is it possible for Google App Engine string and integer datastore keys to clash?", "body": "<p>Yes, you can safely mix String &amp; Int IDs for the same kind - just the same key (<em>entity</em>) can not use both at the same time. There is no danger of overlapping. I guess under the hood they use something like <a href=\"https://developers.google.com/protocol-buffers/\" rel=\"nofollow\">protocol buffers</a> to serialize a key to <code>[]byte</code>.</p>\n\n<p>I used it like that in production without any issues.</p>\n\n<p>Though it maybe not the best design but it really depends on your case.</p>\n"}], "owner": {"reputation": 3946, "user_id": 736070, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/2ffe94c53681b5b72e448cd8a575e687?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/736070/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "closed_date": 1462795099, "answer_count": 1, "score": 0, "last_activity_date": 1463163860, "creation_date": 1462787666, "last_edit_date": 1463163860, "question_id": 37112700, "link": "https://stackoverflow.com/questions/37112700/is-it-possible-for-google-app-engine-string-and-integer-datastore-keys-to-clash", "closed_reason": "Duplicate", "title": "Is it possible for Google App Engine string and integer datastore keys to clash?", "body": "<p>I have a datastore entity of kind <code>MyEntity</code> and I want to sometimes use <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference#Key.StringID\" rel=\"nofollow\"><code>StringID</code></a> keys and other times use <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference#Key.IntID\" rel=\"nofollow\"><code>IntID</code></a> keys generated by <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference#AllocateIDs\" rel=\"nofollow\"><code>AllocateIDs</code></a>.</p>\n\n<p>Can I safely mix string and integer IDs without worrying that a string ID might surreptitiously overwrite an integer ID generated by <code>AllocateIDs</code> and vice versa?</p>\n\n<p>The reason I ask is because I assume string and integer IDs use the same index. Is it possible to accidentally have a sequence of bytes that represent a string ID be the same as a sequence of bytes that represent an integer ID on the same index? Or are string and integer IDs namespaced in some way to prevent collisions?</p>\n"}, {"tags": ["angularjs", "go"], "comments": [{"owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "edited": false, "score": 0, "creation_date": 1462781866, "post_id": 37110632, "comment_id": 61763305, "body": "You can consider to use http status codes (<a href=\"https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html\" rel=\"nofollow noreferrer\">w3.org/Protocols/rfc2616/rfc2616-sec10.html</a>), eg, <code>302</code> for redirection, <code>201</code> for created"}], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 6248934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fffce90d5e80ebd9f1b61deaf6bdb8c9?s=128&d=identicon&r=PG&f=1", "display_name": "Phi-Long Vu", "link": "https://stackoverflow.com/users/6248934/phi-long-vu"}, "edited": false, "score": 0, "creation_date": 1462783254, "post_id": 37110802, "comment_id": 61764005, "body": "Yea I use $resource.  I added on the server side http status code that ch33hau mentioned and handled it in the client by checking the status code."}], "tags": [], "owner": {"reputation": 779, "user_id": 2112388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc29826ccf22e30922806b2a655c84fa?s=128&d=identicon&r=PG", "display_name": "Christiaan", "link": "https://stackoverflow.com/users/2112388/christiaan"}, "is_accepted": true, "score": 0, "last_activity_date": 1462781907, "creation_date": 1462781907, "answer_id": 37110802, "question_id": 37110632, "link": "https://stackoverflow.com/questions/37110632/is-it-possible-to-issue-a-failure-to-an-angularjs-post-request-with-a-golang-se/37110802#37110802", "title": "Is it possible to issue a failure to an AngularJS post request, with a Golang server?", "body": "<p>Assuming that you are using $resource to create <code>Registration</code> you can do</p>\n\n<pre><code>Registration.save(postBody, function(data, responseHeaders){\n    //on success\n    console.log(data)\n    console.log(responseHeaders)\n    //$location.path('/bookingsystem')\n}, function(httpResponse){\n    // Handle the error\n    console.log(httpResponse)\n}); \n</code></pre>\n\n<p>See the <a href=\"https://docs.angularjs.org/api/ngResource/service/$resource\" rel=\"nofollow\">documentation</a> on $resource for more API documentation.</p>\n"}], "owner": {"reputation": 49, "user_id": 6248934, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fffce90d5e80ebd9f1b61deaf6bdb8c9?s=128&d=identicon&r=PG&f=1", "display_name": "Phi-Long Vu", "link": "https://stackoverflow.com/users/6248934/phi-long-vu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 37110802, "answer_count": 1, "score": 0, "last_activity_date": 1462781907, "creation_date": 1462781353, "question_id": 37110632, "link": "https://stackoverflow.com/questions/37110632/is-it-possible-to-issue-a-failure-to-an-angularjs-post-request-with-a-golang-se", "title": "Is it possible to issue a failure to an AngularJS post request, with a Golang server?", "body": "<p>I have a HTTP server written in golang and the client is written in AngularJs. The client will send a POST request to the server with username/password to attempt to register a new account. I want the client to do something depending on the answer of the server. If a user with the requested username already exists I want to stay at the registration site, else I want the client to change the view to something else.</p>\n\n<p>I have the follow code to POST to the server, but how do I tell the client that the request failed?</p>\n\n<pre><code>$scope.register = function(){\n    var postBody = JSON.stringify({username:$scope.vm.user.username, password:$scope.vm.user.password})\n\n    Registration.save(postBody, function(data){\n        //on success\n        console.log(data)\n        //$location.path('/bookingsystem')\n    });     \n};\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo", "database"], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "edited": false, "score": 0, "creation_date": 1462781721, "post_id": 37110638, "comment_id": 61763232, "body": "Thanks a lot. But still I am getting following error                                                   &quot;Can&#39;t canonicalize query: BadValue and needs an array&quot;"}, {"owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "reply_to_user": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "edited": false, "score": 0, "creation_date": 1462782879, "post_id": 37110638, "comment_id": 61763837, "body": "Sorry my bad, @SyedQasimRizvi I have updated my answer, <code>$and</code> should accept an array which you are right. The trick is that you can remove the index during initialization and that is."}, {"owner": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "edited": false, "score": 0, "creation_date": 1462783145, "post_id": 37110638, "comment_id": 61763959, "body": "Thanks a lot @ch33hau. Still I am getting &quot;not found&quot; error. However there are records in mongodb satisfying this condition."}, {"owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "reply_to_user": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "edited": false, "score": 0, "creation_date": 1462783699, "post_id": 37110638, "comment_id": 61764247, "body": "I would suggest you to remove the <code>user_history</code> and give a try on relatively simpler conditions first. Or maybe, try to hard-code some values before you fully confirmed the code is working."}, {"owner": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "edited": false, "score": 0, "creation_date": 1462783903, "post_id": 37110638, "comment_id": 61764367, "body": "Thanks a lot @ch33hau. Query is working fine if I removed &quot;user-history&quot; part. Moreover query is also working fine if I used only &quot;user-history&quot; part but it gives &quot;not found&quot; if I used all three conditions."}, {"owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "reply_to_user": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "edited": false, "score": 0, "creation_date": 1462784541, "post_id": 37110638, "comment_id": 61764724, "body": "This is the problem in how you form the <code>mongodb</code> query, but you can give a try to not using <code>$elemMatch</code>, simply use <code>bson.M{&quot;user_history.action&quot;, &quot;STOP&quot;}</code> and <code>bson.M{&quot;user_history.message_id&quot;, mid}</code>, I think this is what you are trying to achieve."}, {"owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "reply_to_user": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "edited": false, "score": 0, "creation_date": 1462785318, "post_id": 37110638, "comment_id": 61765241, "body": "One more thing @SyedQasimRizvi, Ultimately, when I was unfamiliar with <code>mongodb</code>, before creating any queries in <code>mgo</code> or other libraries, I will testing it on <code>mongodb cli</code> in order to reduce uncertainty."}, {"owner": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "edited": false, "score": 0, "creation_date": 1462792622, "post_id": 37110638, "comment_id": 61769924, "body": "Thanks a lot @ch33hau"}], "tags": [], "owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "is_accepted": true, "score": 10, "last_activity_date": 1462782791, "last_edit_date": 1462782791, "creation_date": 1462781372, "answer_id": 37110638, "question_id": 37110431, "link": "https://stackoverflow.com/questions/37110431/how-to-run-and-operator-in-mgo-query-in-golang/37110638#37110638", "title": "How to run $and operator in mgo query in Golang", "body": "<p>The error is from the way you initialize an <code>array</code> in <code>go</code>: </p>\n\n<pre><code>....\n\"$and\": []interface{}{\n    \"shr_key\": user_shr_key,\n....\n</code></pre>\n\n<p><code>go</code> array doesn't accept <code>string</code> as an index.</p>\n\n<p>Anyway, in order to solve your problem, remove index from array initialization and wrap the key-value pair in <code>bson.M</code> will do, eg:</p>\n\n<pre><code>bson.M{\n            \"$and\": []bson.M{ // you can try this in []interface\n                bson.M{\"shr_key\": user_shr_key},\n                bson.M{\"id\": uid},\n                bson.M{\"user_history\": bson.M{\"$elemMatch\": bson.M{\"action\": \"STOP\", \"message_id\": mid}}},\n            },\n        }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 77, "user_id": 11373635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ece282de80af0de21c62cd81752535b?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin007", "link": "https://stackoverflow.com/users/11373635/kevin007"}, "is_accepted": false, "score": 1, "last_activity_date": 1582718314, "creation_date": 1582718314, "answer_id": 60413439, "question_id": 37110431, "link": "https://stackoverflow.com/questions/37110431/how-to-run-and-operator-in-mgo-query-in-golang/60413439#60413439", "title": "How to run $and operator in mgo query in Golang", "body": "<p>Here You Can See , Get Values by $Match , $and Using Golang MongoDB</p>\n\n<pre><code>\npipeline := []bson.M{\nbson.M{\"$match\": bson.M{\"$and\": []bson.M{bson.M{\"storyID\": storyID}, \nbson.M{\"parentID\": parentID}}}}\n}\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4847, "favorite_count": 0, "accepted_answer_id": 37110638, "answer_count": 2, "score": 4, "last_activity_date": 1582718314, "creation_date": 1462780621, "last_edit_date": 1506103077, "question_id": 37110431, "link": "https://stackoverflow.com/questions/37110431/how-to-run-and-operator-in-mgo-query-in-golang", "title": "How to run $and operator in mgo query in Golang", "body": "<p>I want to execute following query in MongoDB in Golang</p>\n\n<pre><code>check_select = bson.M{\n            \"$and\": []interface{}{\n                \"shr_key\": user_shr_key,\n                \"id\": uid,\n                \"user_history\": bson.M{\"$elemMatch\": bson.M{\"action\": \"STOP\", \"message_id\": mid}},\n            },\n        }\n</code></pre>\n\n<p>Please help... I am getting following error <code>\"index must be non-negative integer constant\"</code>.</p>\n"}, {"tags": ["cordova", "go", "websocket", "phonegap-plugins", "phonegap-build"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1462777829, "post_id": 37109510, "comment_id": 61761175, "body": "can you have a http dump? especially compare to non-phonegap client"}, {"owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1462777975, "post_id": 37109510, "comment_id": 61761253, "body": "@JiangYD - how can I do that?"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1462778184, "post_id": 37109510, "comment_id": 61761361, "body": "tcpdump in your server, to capture the port your server listening"}, {"owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1462778757, "post_id": 37109510, "comment_id": 61761669, "body": "@JiangYD - I have made &quot;tcpdump port 8080&quot;, here is ss when phonegap tried to connect: <a href=\"https://www.dropbox.com/s/5tg7icq6gngd8dv/Screenshot%202016-05-09%2009.25.51.png?dl=0\" rel=\"nofollow noreferrer\">dropbox.com/s/5tg7icq6gngd8dv/&hellip;</a>"}, {"owner": {"reputation": 858, "user_id": 5771658, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5374bd996ebe26fc7f65ad7a313165de?s=128&d=identicon&r=PG&f=1", "display_name": "PSo", "link": "https://stackoverflow.com/users/5771658/pso"}, "edited": false, "score": 0, "creation_date": 1462778852, "post_id": 37109510, "comment_id": 61761732, "body": "according to <a href=\"https://en.wikipedia.org/wiki/Same-origin_policy\" rel=\"nofollow noreferrer\">link</a> cross origin policy, there is no way you can send JS request outside your own domain."}, {"owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "edited": false, "score": 0, "creation_date": 1462778930, "post_id": 37109510, "comment_id": 61761773, "body": "Is there any other phonegap or ionic script which can connect to remote go gorilla websocket server?"}], "answers": [{"comments": [{"owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "edited": false, "score": 0, "creation_date": 1462780800, "post_id": 37110453, "comment_id": 61762763, "body": "Is that ok if we look from security point? I am using on my server sequence and token authorization."}, {"owner": {"reputation": 1169, "user_id": 498109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100036fbeed75b1abf5bf0161d1fb560?s=128&d=identicon&r=PG", "display_name": "Vadyus", "link": "https://stackoverflow.com/users/498109/vadyus"}, "reply_to_user": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "edited": false, "score": 0, "creation_date": 1462780886, "post_id": 37110453, "comment_id": 61762813, "body": "Origin header that is checker can be set manually, so yes, i dont think it will have huge impact on security"}, {"owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "edited": false, "score": 0, "creation_date": 1462781379, "post_id": 37110453, "comment_id": 61763058, "body": "What is your advice, should I go with socket.io (which site is down in the moment:) ) or I can stay with web socket?"}, {"owner": {"reputation": 1169, "user_id": 498109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100036fbeed75b1abf5bf0161d1fb560?s=128&d=identicon&r=PG", "display_name": "Vadyus", "link": "https://stackoverflow.com/users/498109/vadyus"}, "reply_to_user": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "edited": false, "score": 0, "creation_date": 1462782960, "post_id": 37110453, "comment_id": 61763877, "body": "My advice is to correct server-side code to make things work"}, {"owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "edited": false, "score": 0, "creation_date": 1462785685, "post_id": 37110453, "comment_id": 61765466, "body": "Thank you. I have implemented my own CheckOrigin function and now everything it&#39;s working. Do you have any other advice to improve security on server side?"}], "tags": [], "owner": {"reputation": 1169, "user_id": 498109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/100036fbeed75b1abf5bf0161d1fb560?s=128&d=identicon&r=PG", "display_name": "Vadyus", "link": "https://stackoverflow.com/users/498109/vadyus"}, "is_accepted": true, "score": 2, "last_activity_date": 1462780694, "creation_date": 1462780694, "answer_id": 37110453, "question_id": 37109510, "link": "https://stackoverflow.com/questions/37109510/how-to-solve-or-bypass-error-websocket-origin-not-allowed/37110453#37110453", "title": "How to solve or bypass error websocket: origin not allowed", "body": "<p>The solution is - to implement your own CheckOrigin function in your websocket.Upgrader{} because default one checks server host and accept client connections only from same host</p>\n"}], "owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1932, "favorite_count": 0, "accepted_answer_id": 37110453, "answer_count": 1, "score": 1, "last_activity_date": 1462780694, "creation_date": 1462777096, "question_id": 37109510, "link": "https://stackoverflow.com/questions/37109510/how-to-solve-or-bypass-error-websocket-origin-not-allowed", "title": "How to solve or bypass error websocket: origin not allowed", "body": "<p>On my server I'm running gorilla web socket in go and I'm trying to connect from phonegap application with following javascript code:</p>\n\n<pre><code>var conn = new WebSocket(\"ws://IP:8080/ws\");\n</code></pre>\n\n<p>but I'm getting this error: <strong>websocket: origin not allowed</strong> on my server.</p>\n\n<p>Is there anything I can do to solve this?</p>\n\n<p>Maybe another phonegap library or fix/update for this kind of connection?</p>\n\n<p>I have tried many examples of phonegap script but non of them worked.</p>\n\n<p>I would like to use that gorilla websocket plugin on my server but as things stand now that is not possible.\nThank you</p>\n"}, {"tags": ["reflection", "go", "struct", "interface", "slice"], "comments": [{"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 0, "creation_date": 1462780057, "post_id": 37108922, "comment_id": 61762390, "body": "Yes it is possible. Just learn about reflection on Golang."}, {"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "reply_to_user": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 0, "creation_date": 1462785131, "post_id": 37108922, "comment_id": 61765116, "body": "I know how to get the name of the struct with reflection. And I know I can convert the interface with .(type) syntax. But I still do not how to rewrite the function above to make that happen."}], "answers": [{"comments": [{"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1462787145, "post_id": 37111904, "comment_id": 61766406, "body": "What if I do not know the length and capacity of the slice beforehand? I am used to just create slices and adding stuff into them dynamically without saying anything about length and capacity"}, {"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "reply_to_user": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1462793371, "post_id": 37111904, "comment_id": 61770414, "body": "no problem, you can put any number. It growth automatically."}], "tags": [], "owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "is_accepted": false, "score": 1, "last_activity_date": 1462785400, "creation_date": 1462785400, "answer_id": 37111904, "question_id": 37108922, "link": "https://stackoverflow.com/questions/37108922/how-can-i-use-interfaces-to-allow-for-more-than-1-struct-type-to-make-code-more/37111904#37111904", "title": "How can I use interfaces to allow for more than 1 struct type to make code more useable?", "body": "<p>I write a little example using json, instead of sql rows. You can try to develop from this code : </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"encoding/json\"\n)\n\ntype A struct {\n    AField int `json:\"a\"`\n}\n\ntype B struct {\n    BField string `json:\"b\"`\n}\n\nfunc build(str string, typ reflect.Type) interface{} {\n    results := reflect.MakeSlice(reflect.SliceOf(typ), 0, 10)\n    for i:=0; i &lt; 5; i++ {\n        res := reflect.New(typ)\n        json.Unmarshal([]byte(str), res.Interface())\n        results = reflect.Append(results, res.Elem())\n    }\n    return results.Interface();\n}\n\nfunc main() {\n    a := build(\"{ \\\"a\\\": 15 }\", reflect.TypeOf(&amp;A{}))\n    fmt.Printf(\"%T : %V\\n\", a, a)\n    b := build(\"{ \\\"b\\\": \\\"my string\\\" }\", reflect.TypeOf(&amp;B{}))\n    fmt.Printf(\"%T : %V\\n\", b, b)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/NTFPvK3VHe\" rel=\"nofollow\">Golang Playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1462787439, "post_id": 37112089, "comment_id": 61766608, "body": "Thank you good sir! I see you like StarCraft on your profile. You didn&#39;t by any chance play iccup? ^^"}, {"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1462789092, "post_id": 37112089, "comment_id": 61767705, "body": "If I wanted to json.Marshal the result, would I need to convert the interface{} type to BetaKey with .(type) syntax first? Or is it possible to json.Marshal the interface?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1462789107, "post_id": 37112089, "comment_id": 61767719, "body": "@Alex In Starcraft (Broodwar) I was a &quot;BGH guy&quot; (played Big Game Hunters), no iccup, but nowadays when I play, I only play StarCraft II of course."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 1, "creation_date": 1462789197, "post_id": 37112089, "comment_id": 61767783, "body": "@Alex No need any conersion or type assertion if you want to marshal the result, <code>json.Marshal()</code> takes an argument of type <code>interface{}</code> anyway, and that&#39;s what you have. If you try to pass a non-interface type to <code>Marshal()</code>, a wrapper <code>interface{}</code> value will be created automatically."}, {"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1462789293, "post_id": 37112089, "comment_id": 61767851, "body": "Cool thanks alot for the help! This was very helpful! I have not played starcraft for years. Oh the nostalgia brood war gives! Let me know if you want to play starcraft 2 some day!"}, {"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1462790099, "post_id": 37112089, "comment_id": 61768365, "body": "I get error: type []interface {} is not an expression, for the line with the expression &quot;results := []interface{}&quot;, both the compiler and GoSublime does not like it, I don&#39;t understand why."}, {"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1462790604, "post_id": 37112089, "comment_id": 61768680, "body": "It works with &quot;var results []interface{}&quot;, but not results := []interface{}"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1462790619, "post_id": 37112089, "comment_id": 61768694, "body": "@Alex Sorry, that was a typo from my part. The slice type is <code>[]interface{}</code>, so the literal to create a value of this must be <b><code>[]interface{}{}</code></b>. See edited answer."}, {"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1462791022, "post_id": 37112089, "comment_id": 61768956, "body": "That makes sense! It&#39;s like someMap := map[string]interface{}{} Thank you so much!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1499893262, "last_edit_date": 1499893262, "creation_date": 1462785943, "answer_id": 37112089, "question_id": 37108922, "link": "https://stackoverflow.com/questions/37108922/how-can-i-use-interfaces-to-allow-for-more-than-1-struct-type-to-make-code-more/37112089#37112089", "title": "How can I use interfaces to allow for more than 1 struct type to make code more useable?", "body": "<p>Generics could be used to implement such thing, but Go does not support generics. To do what you want in Go, you need to use reflection.</p>\n\n<p>You may change your function to take 1 additional parameter, a <a href=\"https://golang.org/pkg/reflect/#Type\" rel=\"nofollow noreferrer\"><code>reflect.Type</code></a> for example which designates type of values the individual rows should be loaded into.</p>\n\n<p>Then you can use <a href=\"https://golang.org/pkg/reflect/#New\" rel=\"nofollow noreferrer\"><code>reflect.New()</code></a> to create a new value of this type and acquire a pointer to it. You can use <a href=\"https://golang.org/pkg/reflect/#Value.Interface\" rel=\"nofollow noreferrer\"><code>Value.Interface()</code></a> to obtain the pointer value as a type of <code>interface{}</code> from the <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a> value. This <code>interface{}</code> wrapping the pointer can now be passed to <code>Rows.StructScan()</code>.</p>\n\n<p>And if you want the result slice to hold non-pointer values, you can use <a href=\"https://golang.org/pkg/reflect/#Indirect\" rel=\"nofollow noreferrer\"><code>reflect.Indirect()</code></a> to get the pointed value (and another <code>reflect.Interface()</code> to extract the struct value as an <code>interface{}</code>).</p>\n\n<p>Example code:</p>\n\n<pre><code>func buildResults(query string, t reflect.Type) ([]interface{}, error) {\n    results := []interface{}{}\n    rows, err := sql.DB.Queryx(query)\n    if err != nil {\n        return results, err\n    }\n    defer rows.Close()\n    for rows.Next() {\n        val := reflect.New(t)\n        err := rows.StructScan(val.Interface())\n        if err != nil {\n            return results, err\n        }\n        i_ := reflect.Indirect(val)\n        result = append(result, i_.Interface())\n    }\n    err = rows.Err()\n    if err != nil {\n        return results, err\n    }\n    return results, nil\n}\n</code></pre>\n\n<p>The heart of it is the <code>for</code> block:</p>\n\n<pre><code>val := reflect.New(t)                   // A pointer to a new value (of type t)\nerr := rows.StructScan(val.Interface()) // Pass the pointer to StructScan\nif err != nil {\n    return results, err\n}\ni_ := reflect.Indirect(val)             // Dereference the pointer\nresult = append(result, i_.Interface()) // And add the non-pointer to the result slice\n</code></pre>\n\n<p>Here's how you can test it:</p>\n\n<pre><code>type BetaKey struct {\n    Id   string\n    Name string\n}\n\ntype AlphaKey struct {\n    Id     string\n    Source string\n}\n\nr, err := buildResults(\"\", reflect.TypeOf(AlphaKey{}))\nfmt.Printf(\"%T %+v %v\\n\", r[0], r, err)\n\nr, err = buildResults(\"\", reflect.TypeOf(BetaKey{}))\nfmt.Printf(\"%T %+v %v\\n\", r[0], r, err)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>main.AlphaKey [{Id:aa Source:asource} {Id:aa Source:asource} {Id:aa Source:asource}] &lt;nil&gt;\nmain.BetaKey [{Id:aa Name:aname} {Id:aa Name:aname} {Id:aa Name:aname}] &lt;nil&gt;\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/4u0RrsUxMK\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p><strong>Notes:</strong></p>\n\n<p>The above solution will return a value of type of <code>[]interface{}</code> whose elements will be of <em>static</em> type <code>interface{}</code> and their dynamic type will be the one specified by the <code>reflect.Type</code> argument. So for example if you call it with type:</p>\n\n<pre><code>bt := reflect.TypeOf(BetaKey{})\n</code></pre>\n\n<p>The values in the result slice will have dynamic type <code>BetaKey</code> so you can safely <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assert</a> them like this:</p>\n\n<pre><code>results, err := buildResults(\"some query\", bt)\nif err == nil {\n    for _, v := range results {\n        key := v.(BetaKey)\n        // key is of type BetaKey, you may use it like so\n    }\n} else {\n    // handle error\n}\n</code></pre>\n\n<p>To learn more about reflection, read the blog post:</p>\n\n<p><a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\"><strong>The Go Blog: The Laws of Reflection</strong></a></p>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "accepted_answer_id": 37112089, "answer_count": 2, "score": 2, "last_activity_date": 1499893262, "creation_date": 1462774739, "last_edit_date": 1462788726, "question_id": 37108922, "link": "https://stackoverflow.com/questions/37108922/how-can-i-use-interfaces-to-allow-for-more-than-1-struct-type-to-make-code-more", "title": "How can I use interfaces to allow for more than 1 struct type to make code more useable?", "body": "<p>I have a struct that looks like this:</p>\n\n<pre><code>type BetaKey struct {\n    Id           int64  `json:\"-\"`\n    IssuerId     int64  `json:\"-\"          db:\"issuer_id\"`\n    SubjectEmail string `json:\"-\"          db:\"subject_email\"`\n    IssuedTime   int64  `json:\"-\"          db:\"issued_time\"`\n    ExpiryTime   int64  `json:\"expiryTime\" db:\"expiry_time\"`\n    Betakey      string `json:\"accessKey\"`\n    Description  string `json:\"description\"`\n}\n</code></pre>\n\n<p>And within the same package I have a function that returns a slice of <code>BetaKey</code>:</p>\n\n<pre><code>func buildResults(query string) ([]BetaKey, error) {\n    results := []BetaKey{}\n    rows, err := sql.DB.Queryx(query)\n    if err != nil {\n        return results, err\n    }\n    defer rows.Close()\n    for rows.Next() {\n        var bk BetaKey\n        err := rows.StructScan(&amp;bk)\n        if err != nil {\n            return results, err\n        }\n        results = append(results, bk)\n    }\n    err = rows.Err()\n    if err != nil {\n        return results, err\n    }\n    return results, nil\n}\n</code></pre>\n\n<p>Is it possible for me to rewrite this function so that it takes in a query string but also a type of <code>BetaKey</code> as <code>interface{}</code>, and returns a slice of <code>interface{}</code> so that I can reuse the code instead of copy pasting this into every package because it is literally the same but the only difference is the name of the struct that changes.</p>\n\n<p>Is this possible? And also is this advised? If not, then why?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "edited": false, "score": 0, "creation_date": 1462774101, "post_id": 37108663, "comment_id": 61759393, "body": "Thank you, I knew it was something simple!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1462773616, "creation_date": 1462773616, "answer_id": 37108663, "question_id": 37108480, "link": "https://stackoverflow.com/questions/37108480/returning-arbitrary-data-types-in-golang/37108663#37108663", "title": "Returning arbitrary data types in golang", "body": "<p><a href=\"https://golang.org/pkg/database/sql/#Open\" rel=\"nofollow\"><code>Open</code></a> returns a <code>*sql.DB</code>, a pointer to a sql.Db.  Change the function signature to also return a <code>*sql.DB</code>:</p>\n\n<pre><code>func establish_db_connection() *sql.DB {\n</code></pre>\n"}], "owner": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 37108663, "answer_count": 1, "score": 1, "last_activity_date": 1462773619, "creation_date": 1462772837, "question_id": 37108480, "link": "https://stackoverflow.com/questions/37108480/returning-arbitrary-data-types-in-golang", "title": "Returning arbitrary data types in golang", "body": "<p>I have a simple golang routine that uses <code>database/sql</code> to open a connection to my Postgres DB and does some stuff</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"database/sql\"\n  _ \"github.com/lib/pq\"\n  \"log\"\n)\n\nconst (\n    DB_USER = \"my_user\"\n    DB_NAME = \"my_postgres_db\"\n)\n\n// The return type here is wrong - what should it be?\nfunc establish_db_connection() sql.DB {\n  dbinfo := fmt.Sprintf(\n    \"user=%s password=%s dbname=%s sslmode=disable\", \n    DB_USER, nil, DB_NAME)\n\n  db, err := sql.Open(\"postgres\", dbinfo)\n  if err != nil { log.Fatal(err) }\n\n  return db\n}\n\nfunc main() {\n  // Get a connection to the DB\n  db := establish_db_connection()\n\n  // Do other stuff\n  // ...\n  // ...\n}\n</code></pre>\n\n<p>I'm having trouble writing the signature for the <code>establish_db_connection</code> function -</p>\n\n<pre><code>func establish_db_connection() sql.DB {\n</code></pre>\n\n<p>The <a href=\"https://golang.org/pkg/database/sql/#Open\" rel=\"nofollow\">documentation suggests</a> it returns a <code>sql.DB</code> instance. So should this not be the return type?</p>\n\n<p>I'm super new to golang, so just figuring most of this out for the first time.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 32215, "user_id": 3789550, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8mGqv.gif?s=128&g=1", "display_name": "heemayl", "link": "https://stackoverflow.com/users/3789550/heemayl"}, "edited": false, "score": 0, "creation_date": 1462764136, "post_id": 37106834, "comment_id": 61756724, "body": "Try <code>(?m)&lt;think&gt;([^&lt;]+)&lt;&#47;think&gt;</code> or if non-greediness is supported <code>(?m)&lt;think&gt;(.*?)&lt;&#47;think&gt;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "edited": false, "score": 0, "creation_date": 1462772630, "post_id": 37107334, "comment_id": 61758858, "body": "I thought the same thing about <code>.</code> but in golang <code>s</code> is set by default: <a href=\"https://github.com/google/re2/wiki/Syntax\" rel=\"nofollow noreferrer\">github.com/google/re2/wiki/Syntax</a> Although this does seem to fix it so I guess the docs are wrong..."}, {"owner": {"reputation": 674, "user_id": 466088, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c18893b7745f814404762364d9d7bb37?s=128&d=identicon&r=PG", "display_name": "Eduardo Pereira", "link": "https://stackoverflow.com/users/466088/eduardo-pereira"}, "edited": false, "score": 0, "creation_date": 1462787572, "post_id": 37107334, "comment_id": 61766695, "body": "If <code>s=true</code>, then the new line will match, the default is <code>false</code>. Thanks for the clarification."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 17, "last_activity_date": 1462764202, "creation_date": 1462764202, "answer_id": 37107334, "question_id": 37106834, "link": "https://stackoverflow.com/questions/37106834/golang-multiline-regex-not-working/37107334#37107334", "title": "Golang multiline regex not working", "body": "<p>By default, \".\" doesn't match newline. If you give the \"s\" flag, it does. I don't think you need \"m\".</p>\n\n<p>Note that if there are multiple <code>&lt;think&gt;...&lt;/think&gt;</code> in your string, the regexp will match everything between the first <code>&lt;think&gt;</code> and the last <code>&lt;/think&gt;</code>. Using <code>.*?</code> will cause it to only match the contents of the first one.</p>\n"}, {"tags": [], "owner": {"reputation": 3359, "user_id": 122727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5e946def051f311e802140ecb9fbf?s=128&d=identicon&r=PG", "display_name": "kubanczyk", "link": "https://stackoverflow.com/users/122727/kubanczyk"}, "is_accepted": false, "score": 4, "last_activity_date": 1570701514, "last_edit_date": 1570701514, "creation_date": 1570694213, "answer_id": 58318036, "question_id": 37106834, "link": "https://stackoverflow.com/questions/37106834/golang-multiline-regex-not-working/58318036#58318036", "title": "Golang multiline regex not working", "body": "<p>Complete example (includes both LF and CRLF line endings, just in case) with a <a href=\"https://play.golang.org/p/c0R86J5QQqP\" rel=\"nofollow noreferrer\">link to The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    r := regexp.MustCompile(`(?s)&lt;think&gt;(.*)&lt;/think&gt;`)\n    const s = \"That is \\n&lt;think&gt;\\nFOOBAR\\r\\n\\r\\n&lt;/think&gt;\\n\"\n    fmt.Printf(\"%#v\\n\", r.FindStringSubmatch(s))\n}\n</code></pre>\n\n<p>returns:</p>\n\n<pre><code>[]string{\"&lt;think&gt;\\nFOOBAR\\r\\n\\r\\n&lt;/think&gt;\", \"\\nFOOBAR\\r\\n\\r\\n\"}\n</code></pre>\n"}], "owner": {"reputation": 674, "user_id": 466088, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c18893b7745f814404762364d9d7bb37?s=128&d=identicon&r=PG", "display_name": "Eduardo Pereira", "link": "https://stackoverflow.com/users/466088/eduardo-pereira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15220, "favorite_count": 4, "accepted_answer_id": 37107334, "answer_count": 2, "score": 11, "last_activity_date": 1570701514, "creation_date": 1462759244, "last_edit_date": 1462764027, "question_id": 37106834, "link": "https://stackoverflow.com/questions/37106834/golang-multiline-regex-not-working", "title": "Golang multiline regex not working", "body": "<p>Why the the following multiline regex do not work, I expect to match the substring inside the  tags. Other simples multiline matches worked correctly.</p>\n\n<pre><code>func main() {\n    r := regexp.MustCompile(`(?m)&lt;think&gt;(.*)&lt;/think&gt;`)\n    const s = `That is \n    &lt;think&gt;\n    FOOBAR\n    &lt;/think&gt;`\n    fmt.Printf(\"%#v\\n\", r.FindStringSubmatch(s))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/8C6u_0ca8w\" rel=\"noreferrer\">https://play.golang.org/p/8C6u_0ca8w</a></p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 2, "creation_date": 1462756653, "post_id": 37106384, "comment_id": 61755306, "body": "In your example using pointer will be likely slower. The size of pointer is the same as size of Vertex, pointers makes GC work harder and some operations on pointers are slower because of write barriers required for GC."}, {"owner": {"reputation": 9424, "user_id": 1248913, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ced76ce8952257b480f8b1c96ab0a79?s=128&d=identicon&r=PG", "display_name": "Roy Lee", "link": "https://stackoverflow.com/users/1248913/roy-lee"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1462756791, "post_id": 37106384, "comment_id": 61755335, "body": "@kostya ah ha! thanks for the insights ;)"}, {"owner": {"reputation": 9424, "user_id": 1248913, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ced76ce8952257b480f8b1c96ab0a79?s=128&d=identicon&r=PG", "display_name": "Roy Lee", "link": "https://stackoverflow.com/users/1248913/roy-lee"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1462757575, "post_id": 37106384, "comment_id": 61755495, "body": "@kostya Say if I have a bunch of values underneath the struct, in that case I should I go for pointer ?"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1462758575, "post_id": 37106384, "comment_id": 61755649, "body": "@Roylee but how will you use a pointer as a key? will you keep a separate map to keep keys -&gt; pointers?"}, {"owner": {"reputation": 9424, "user_id": 1248913, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ced76ce8952257b480f8b1c96ab0a79?s=128&d=identicon&r=PG", "display_name": "Roy Lee", "link": "https://stackoverflow.com/users/1248913/roy-lee"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1462759454, "post_id": 37106384, "comment_id": 61755819, "body": "@OneOfOne Okay, I think I understand what you are try to imply now. Map uses value of its key for comparisons, if key is a struct type, its contents will be compared. Hence, unless the size of struct is large, then probably we should use pointer, and separate map to keep keys as you mentioned above. Else, we will always go for option 1. am i correct?"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 2, "creation_date": 1462760230, "post_id": 37106384, "comment_id": 61755985, "body": "@Roylee yeah, because you really can&#39;t use a pointer as a key like that unless you keep track of the pointers somehow (aka another map or a slice), which would really defeat the point."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 2, "creation_date": 1462764361, "post_id": 37106384, "comment_id": 61756770, "body": "The only use case for pointer map keys I can think of is when you can guarantee that equal objects always have the same address (and these objects are relatively large). This might turn out faster and use less memory if you de-duplicate all your objects once and later only reference them by pointer. Still it is hard to say without benchmarks."}], "answers": [{"comments": [{"owner": {"reputation": 9424, "user_id": 1248913, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ced76ce8952257b480f8b1c96ab0a79?s=128&d=identicon&r=PG", "display_name": "Roy Lee", "link": "https://stackoverflow.com/users/1248913/roy-lee"}, "edited": false, "score": 0, "creation_date": 1462756308, "post_id": 37106432, "comment_id": 61755232, "body": "I have rephrased my question, apologize that my question was a little vague initially."}, {"owner": {"reputation": 9424, "user_id": 1248913, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ced76ce8952257b480f8b1c96ab0a79?s=128&d=identicon&r=PG", "display_name": "Roy Lee", "link": "https://stackoverflow.com/users/1248913/roy-lee"}, "edited": false, "score": 0, "creation_date": 1462757053, "post_id": 37106432, "comment_id": 61755389, "body": "By the way, would you mind to elaborate why pointer is a better option if struct&#39;s contents aren&#39;t comparable?"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 9424, "user_id": 1248913, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ced76ce8952257b480f8b1c96ab0a79?s=128&d=identicon&r=PG", "display_name": "Roy Lee", "link": "https://stackoverflow.com/users/1248913/roy-lee"}, "edited": false, "score": 1, "creation_date": 1462757181, "post_id": 37106432, "comment_id": 61755419, "body": "@Roylee because they can&#39;t be used a key then, map keys must be comparable."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 1, "last_activity_date": 1462756548, "last_edit_date": 1462756548, "creation_date": 1462755160, "answer_id": 37106432, "question_id": 37106384, "link": "https://stackoverflow.com/questions/37106384/maps-key-as-pointer-to-struct-use-cases/37106432#37106432", "title": "Map&#39;s key as pointer to struct? (use-cases)", "body": "<p>For that specific case, a pointer wouldn't really work, because for example:</p>\n\n<pre><code>func main() {\n    m1, m2 := map[Vertex]int{}, map[*Vertex]int{}\n    a, b := Vertex{10}, Vertex{10}\n    m1[a], m2[&amp;a] = 10, 10\n\n    fmt.Println(m1[a], m1[b], m1[a] == m1[b])\n    fmt.Println(m2[&amp;a], m2[&amp;b], m2[&amp;a] == m2[&amp;b])\n    fmt.Printf(\"%p %p\", &amp;a, &amp;b)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/nPAjEz_3K1\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n\n<p>// edit after the question got edited</p>\n\n<p>Only reasons to use a pointer is if the struct's contents aren't comparable (aka has a slice or a map, etc) or if it's too large that using it by value is causing performance issues.</p>\n\n<p>IMHO, your current case should be using a value not a pointer.</p>\n"}], "owner": {"reputation": 9424, "user_id": 1248913, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ced76ce8952257b480f8b1c96ab0a79?s=128&d=identicon&r=PG", "display_name": "Roy Lee", "link": "https://stackoverflow.com/users/1248913/roy-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1230, "favorite_count": 0, "accepted_answer_id": 37106432, "answer_count": 1, "score": 1, "last_activity_date": 1463039028, "creation_date": 1462754726, "last_edit_date": 1463039028, "question_id": 37106384, "link": "https://stackoverflow.com/questions/37106384/maps-key-as-pointer-to-struct-use-cases", "title": "Map&#39;s key as pointer to struct? (use-cases)", "body": "<p>Given a struct:</p>\n\n<pre><code>type Foo struct {\n    Bar int\n}  \n</code></pre>\n\n<p><strong>option 1</strong>, Map's key: <code>struct value</code></p>\n\n<pre><code>map[Foo]bool \n</code></pre>\n\n<p><strong>option 2</strong>, Map's key: <code>pointer to struct</code></p>\n\n<pre><code>map[*Foo]bool\n</code></pre>\n\n<hr>\n\n<p>Would there be situations that I <em>must</em> pick <strong>option 2</strong>? I.e:</p>\n\n<ol>\n<li>memory efficiency?</li>\n<li>huge struct value?  </li>\n</ol>\n\n<p>In general, what are the use-cases where its plausible of having map's key as <code>pointer to struct</code>?  </p>\n"}, {"tags": ["git", "go", "git-submodules"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1462750628, "post_id": 37105678, "comment_id": 61753967, "body": "As per <a href=\"https://golang.org/doc/code.html#remote\" rel=\"nofollow noreferrer\">golang.org/doc/code.html#remote</a> - <code>go get &lt;package-path&gt;</code> saves packages to <code>$GOPATH&#47;src&#47;&lt;packagepath&gt;</code> - that is, a global GOPATH like a global PYTHONPATH. vendoring, of course, solves that issue, and explicitly bundles dependencies (and their versions) with the project."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1462751067, "post_id": 37105678, "comment_id": 61754058, "body": "You can use go vendoring with submodules. Golang team fixed that in 1.6. Here&#39;s their test case as a sample <a href=\"https://github.com/rsc/go-get-issue-12612\" rel=\"nofollow noreferrer\">github.com/rsc/go-get-issue-12612</a> <code>go get</code> will checkout the repo and all of it&#39;s submodules as vendored packages"}], "answers": [{"comments": [{"owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "edited": false, "score": 0, "creation_date": 1462751682, "post_id": 37106047, "comment_id": 61754201, "body": "Thanks. Perhaps my question was confusing overall; in any case, you answered half of it. The rest of the question would be how Git handles it when you commit such a repo into an umbrella repo, versus a submodule. Although now that I understand it&#39;s just a <code>clone</code>, I can probably find the answer written up somewhere."}, {"owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "edited": false, "score": 0, "creation_date": 1462752365, "post_id": 37106047, "comment_id": 61754349, "body": "The bonus question is basically &quot;why would a tool for fetching dependencies not commit (or allow you to commit) the dependency in a way that allowed for reproducible builds?&quot;"}, {"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "reply_to_user": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "edited": false, "score": 0, "creation_date": 1462752626, "post_id": 37106047, "comment_id": 61754391, "body": "As I said <code>godep</code> is the tool for dependencies, <code>go get</code> isn&#39;t. Also, I&#39;m not really sure at the moment one can just commit one repo into another... Each of them has a <code>.git</code> directory of its own..."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1462752707, "post_id": 37106047, "comment_id": 61754403, "body": "&quot;Basically go get does nothing more than cloning the repository of the project you want&quot; that&#39;s wrong. <code>go get</code> will clone the project and all of it&#39;s dependencies and install all of them. So the bonus question applies and there&#39;s no good answer to it - that&#39;s probably how Google manages their code base. Master is always good for checkout. Of course that doesn&#39;t work outside of Google so external tools for vendoring been created and in Go 1.6 vendoring become official feature. And it&#39;s compatible with git submodules"}, {"owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "edited": false, "score": 0, "creation_date": 1462753031, "post_id": 37106047, "comment_id": 61754481, "body": "@Havelock Any idea <i>what</i> the behavior is when you do that with Git?  My Google-foo is failing me...maybe it&#39;s so obviously a mistake that nobody would think you would ever even try that."}, {"owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "reply_to_user": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1462753461, "post_id": 37106047, "comment_id": 61754582, "body": "@creker Given what you listed as the behavior of <code>go get</code> I&#39;m beginning to see it makes more sense when viewed like <code>brew</code> or <code>yum</code> or something: it allows you to obtain a binary for your computer, given the URL of the source code. It just <i>seems</i> like it would be good to fetch dependencies from your own project because it puts things in <code>src</code> all nicely, but this is just for the sake of its own operation."}], "tags": [], "owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "is_accepted": true, "score": 5, "last_activity_date": 1513079444, "last_edit_date": 1513079444, "creation_date": 1462751328, "answer_id": 37106047, "question_id": 37105678, "link": "https://stackoverflow.com/questions/37105678/go-get-git-and-dependencies/37106047#37106047", "title": "Go Get, Git and Dependencies", "body": "<p>Basically <code>go get</code> downloads and installs a project. It starts by cloning the repository of the project you want into the GOPATH. So  </p>\n\n<pre><code>go get github.com/foo/bar\n</code></pre>\n\n<p>would be equal to </p>\n\n<pre><code>cd $GOPATH/src/github.com/foo\ngit clone git@github.com:foo/bar.git\n</code></pre>\n\n<p>which is a repository of its own. </p>\n\n<p>As of go 1.5 the \"vendoring problem\" has been solved in a very neat and elegant way and as of go 1.6 it's become the standard way (it was only an experinemt in 1.5). This way you only add the (sub) packages (sometimes single files) you really need, to the structure / repository of your project. There are a few tools out there that take care of vendoring, including <a href=\"https://github.com/tools/godep\" rel=\"nofollow noreferrer\"><code>godep</code></a>, from which we currently switched to <a href=\"https://github.com/kardianos/govendor\" rel=\"nofollow noreferrer\"><code>govendor</code></a>. It has pretty awesome features. One of which is to update the dependency in your project to a given state (commit, tag, etc) but you can still have the package for other projects, you're working on.<br>\nRegarding the bonus question... I'm affraid I'm a bit confused and affraid I don't understand the question in it completely, I'd love to answer it though.</p>\n"}], "owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3776, "favorite_count": 0, "accepted_answer_id": 37106047, "answer_count": 1, "score": 4, "last_activity_date": 1513079444, "creation_date": 1462748227, "question_id": 37105678, "link": "https://stackoverflow.com/questions/37105678/go-get-git-and-dependencies", "title": "Go Get, Git and Dependencies", "body": "<p>I'm a moderately experienced Go developer and Git user, but there's something that I can't seem to wrap my head around.</p>\n\n<p>Usually my team uses <code>.gitmodules</code> for package dependencies, and that has been a successful pattern because it points to an exact commit.  The entire \"vendoring problem\" has been solved for us in this way.</p>\n\n<p>However, I recently created a project and used <code>go get</code> to fetch various packages from GitHub instead of using <code>git submodule add</code>.  I finished the project, committed everything to my git repo, but when a teammate cloned out the repo, the source code for the dependencies was missing.</p>\n\n<p>Usually I would say \"oh, you forgot to run <code>git submodule update --init</code>\", but of course they're not submodules.  So...I could tell him to run <code>go get -u</code> or something (right?) but that means I'm at the mercy of the dependency's master branch--enter vendoring.</p>\n\n<p>My real question here is: what <em>actually</em> happens when I <code>go get</code> a package and then commit it to my repository?  It's not committed into my source tree, and it's not a submodule...I can't tell what the heck it is!  What is the precise way that <code>go get</code> and Git are behaving and interacting here?</p>\n\n<p>Bonus round: Why would you want this behavior?  Under what circumstances would you want to commit another project into your repo in a way that forces new checkouts to pull the latest version of the source every time?</p>\n"}, {"tags": ["go", "interface"], "answers": [{"comments": [{"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 0, "creation_date": 1462752540, "post_id": 37105396, "comment_id": 61754376, "body": "Can also be done by replace get(pack) to get(Packet(pack))"}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 1, "last_activity_date": 1462745740, "creation_date": 1462745740, "answer_id": 37105396, "question_id": 37105341, "link": "https://stackoverflow.com/questions/37105341/type-assertion-and-interfaces/37105396#37105396", "title": "Type assertion and interfaces", "body": "<p>The problem is you're not passing a <code>Packet</code>, you're passing a <code>map[string]interface{}</code>, which is a completely different type as far as Go is concerned.</p>\n\n<p>If you use <code>pack := make(Packet)</code> or <code>pack := Packet{}</code>, it will work as intended.</p>\n\n<p><a href=\"https://play.golang.org/p/oP3o3--6t2\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}, {"comments": [{"owner": {"reputation": 63, "user_id": 2124597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e2db8875e0b887c35984de3f28e172b?s=128&d=identicon&r=PG", "display_name": "Exel", "link": "https://stackoverflow.com/users/2124597/exel"}, "edited": false, "score": 0, "creation_date": 1462882508, "post_id": 37106773, "comment_id": 61815176, "body": "<b>1. AType is an interface and thing satisfies the interface.</b> : if i have <code>var p interface{} = int(123)</code> then i can write <code>p.(int)</code> so, the rule is <b>thing is an interface, holding type AType</b>, isn&#39;t it ?"}, {"owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "reply_to_user": {"reputation": 63, "user_id": 2124597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e2db8875e0b887c35984de3f28e172b?s=128&d=identicon&r=PG", "display_name": "Exel", "link": "https://stackoverflow.com/users/2124597/exel"}, "edited": false, "score": 0, "creation_date": 1464306520, "post_id": 37106773, "comment_id": 62444005, "body": "&quot;if i have var p interface{} = int(123) then i can write p.(int) so, the rule is thing is an interface, holding type AType&quot; is a specific case of my 1. In this example, while <code>p</code> has been declared as <code>interface{}</code>, the underlying data is literally of type <code>int</code>. However if you had defined <code>type Foo int</code>, you would find <code>p.(Foo)</code> fails because the underlying data of <code>p</code> is not of type <code>Foo</code>."}, {"owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "reply_to_user": {"reputation": 63, "user_id": 2124597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e2db8875e0b887c35984de3f28e172b?s=128&d=identicon&r=PG", "display_name": "Exel", "link": "https://stackoverflow.com/users/2124597/exel"}, "edited": false, "score": 0, "creation_date": 1464306594, "post_id": 37106773, "comment_id": 62444022, "body": "It may help to think of interface types as tuples, they reference 2 pieces of information: the type of the underlying struct, and the struct data itself."}], "tags": [], "owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "is_accepted": false, "score": 0, "last_activity_date": 1462758520, "creation_date": 1462758520, "answer_id": 37106773, "question_id": 37105341, "link": "https://stackoverflow.com/questions/37105341/type-assertion-and-interfaces/37106773#37106773", "title": "Type assertion and interfaces", "body": "<p>The answers and comments so far are misunderstanding, mixing up, or at least brushing over a lot of detail in the difference between a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">type assertion</a> and a <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow\">type conversion</a>.</p>\n\n<p>The syntax <code>thing.(AType)</code> is a type assertion. It will be <strong>evaluated at runtime</strong>. The criteria for when this will be successful (i.e. <code>ok == true</code>) can be boiled down to really 2 situations:</p>\n\n<ol>\n<li><code>thing</code> is literally of type <code>AType</code>. Not a redeclared type like your <code>Packet</code>.</li>\n<li><code>AType</code> is an interface and <code>thing</code> satisfies the interface.</li>\n</ol>\n\n<p>In all other cases, <code>ok</code> will be <code>false</code> (or if you use the single value version <code>foo := bar.(Baz)</code>, <code>foo</code> will be whatever the appropriate zero value is).</p>\n\n<p>The syntax <code>AType(thing)</code> is a type conversion. It will be <strong>evaluated at compile time</strong>. A type conversion requires the in memory structure of <code>AType</code> and whatever type <code>thing</code> is, to be identical.</p>\n\n<p>Therefore, in your example the type assertion, <code>packet, ok := pack.(Packet)</code> results in <code>ok == false</code> because <code>Packet</code> is a non-interface type, and <code>packet</code> is not literally of that type, it is of type <code>map[string]interface</code>.</p>\n\n<p>However, you can do the type conversion <code>Packet(pack)</code>, because the type <code>Packet</code> and the variable <code>pack</code> have the same underlying memory structure, <code>map[string]interface{}</code></p>\n"}], "owner": {"reputation": 63, "user_id": 2124597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e2db8875e0b887c35984de3f28e172b?s=128&d=identicon&r=PG", "display_name": "Exel", "link": "https://stackoverflow.com/users/2124597/exel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 716, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1462758520, "creation_date": 1462745224, "question_id": 37105341, "link": "https://stackoverflow.com/questions/37105341/type-assertion-and-interfaces", "title": "Type assertion and interfaces", "body": "<p>Why first example fails, but second goes well?</p>\n\n<p>What is correct way to do such assertion?</p>\n\n<p>example 1\n<a href=\"https://play.golang.org/p/4LRGQLdGPB\" rel=\"nofollow\">https://play.golang.org/p/4LRGQLdGPB</a></p>\n\n<pre><code>// example 1\ntype Packet map[string]interface{}\n\nfunc get(pack interface{}) {\n    if packet, ok := pack.(Packet); !ok {\n        fmt.Printf(\"error: %#v, %#v\\n\", pack, packet)\n    }\n}\n\nfunc main() {\n    pack := make(map[string]interface{})\n    pack[\"qwe\"] = 123\n    get(pack)\n}\n\n// error: map[string]interface {}{\"qwe\":123}, main.Packet(nil)\n</code></pre>\n\n<p>example 2\n<a href=\"https://play.golang.org/p/Pd9jvvNrq5\" rel=\"nofollow\">https://play.golang.org/p/Pd9jvvNrq5</a></p>\n\n<pre><code>// example 2\ntype Packet map[string]interface{}\n\nfunc get(pack interface{}) {\n    var p Packet\n    if packet, ok := pack.(map[string]interface{}); !ok {\n        fmt.Printf(\"%#v, %#v\\n\", pack, packet)\n    } else {\n        p = packet\n    }\n    fmt.Printf(\"%#v\\n\", p)\n}\n\nfunc main() {\n    pack := make(map[string]interface{})\n    pack[\"qwe\"] = 123\n    get(pack)\n}\n\n// main.Packet{\"qwe\":123}\n</code></pre>\n"}, {"tags": ["security", "go", "binary", "obfuscation"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1462722865, "post_id": 37101223, "comment_id": 61745668, "body": "Obfuscating the names isn&#39;t going to stop any reverse engineering, it will hardly slow down the process."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 1, "creation_date": 1462723794, "post_id": 37101223, "comment_id": 61745990, "body": "<a href=\"https://www.reddit.com/r/golang/comments/3pmkwi/i_started_obfuscating_some_code_for_fun_and_got/\" rel=\"nofollow noreferrer\">reddit.com/r/golang/comments/3pmkwi/&hellip;</a>? looks good  ;) <a href=\"https://play.golang.org/p/WW-1fgSZW_\" rel=\"nofollow noreferrer\">play.golang.org/p/WW-1fgSZW_</a>"}, {"owner": {"reputation": 867, "user_id": 764516, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/e9c6eb568d8f822119773908a236ebbc?s=128&d=identicon&r=PG", "display_name": "thinkhy", "link": "https://stackoverflow.com/users/764516/thinkhy"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1462809405, "post_id": 37101223, "comment_id": 61781477, "body": "@JimB Thanks for your quick reply. Obfuscating can&#39;t stop reverse engineering but in a way prevent info leakage."}], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 0, "last_activity_date": 1462723668, "last_edit_date": 1495535359, "creation_date": 1462723668, "answer_id": 37101924, "question_id": 37101223, "link": "https://stackoverflow.com/questions/37101223/how-to-obfuscate-string-of-variable-function-and-package-names-in-golang-binary/37101924#37101924", "title": "How to obfuscate string of variable, function and package names in Golang binary?", "body": "<p>I think the best answer to this question is here <a href=\"https://stackoverflow.com/questions/261638/how-do-i-protect-python-code\">How do I protect Python code?</a>, specifically this <a href=\"https://stackoverflow.com/a/261727/145587\">answer</a>.</p>\n\n<p>While that question is about Python, it applies to all code in general.</p>\n\n<p>I was gonna mark this question as a duplicate, but maybe someone will provide more insight into it.</p>\n"}], "owner": {"reputation": 867, "user_id": 764516, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/e9c6eb568d8f822119773908a236ebbc?s=128&d=identicon&r=PG", "display_name": "thinkhy", "link": "https://stackoverflow.com/users/764516/thinkhy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1859, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1462723668, "creation_date": 1462719655, "question_id": 37101223, "link": "https://stackoverflow.com/questions/37101223/how-to-obfuscate-string-of-variable-function-and-package-names-in-golang-binary", "title": "How to obfuscate string of variable, function and package names in Golang binary?", "body": "<p>When use command \"nm go_binary\", I find the names of variables, functions and packages and even the directory where my code is located are all displayed, is there any way to obfuscate the binary generated by the command \"go build\" and prevent go binary from being exploited by hackers?</p>\n"}, {"tags": ["html", "google-app-engine", "go", "polymer", "polymer-starter-kit"], "answers": [{"tags": [], "owner": {"reputation": 118, "user_id": 4687085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/921be5aa7ffcdfa1624b262932738b69?s=128&d=identicon&r=PG", "display_name": "ModernDeveloperLLC", "link": "https://stackoverflow.com/users/4687085/moderndeveloperllc"}, "is_accepted": false, "score": 1, "last_activity_date": 1462971735, "last_edit_date": 1462971735, "creation_date": 1462971385, "answer_id": 37163381, "question_id": 37101221, "link": "https://stackoverflow.com/questions/37101221/iron-ajax-in-tandem-with-polymer-starter-kit-misbehaves-or-something-it-sends-r/37163381#37163381", "title": "iron-ajax in tandem with polymer-starter-kit misbehaves or something. It sends requests to a different url than the one I am expecting", "body": "<p>A couple of things. You are missing the slashes in <code>http:localhost:8080/journal_tag</code> It should be <code>http://localhost:8080/journal_tag</code>. Also, you can use the Developer tools for the browser you are in to see all the XHR requests that you are sending. Check there to see what the request headers being sent are.</p>\n"}, {"tags": [], "owner": {"reputation": 107, "user_id": 714258, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/684d9992d72e5985bb177d5752ad80fc?s=128&d=identicon&r=PG", "display_name": "branco", "link": "https://stackoverflow.com/users/714258/branco"}, "is_accepted": true, "score": 0, "last_activity_date": 1462973293, "creation_date": 1462973293, "answer_id": 37164162, "question_id": 37101221, "link": "https://stackoverflow.com/questions/37101221/iron-ajax-in-tandem-with-polymer-starter-kit-misbehaves-or-something-it-sends-r/37164162#37164162", "title": "iron-ajax in tandem with polymer-starter-kit misbehaves or something. It sends requests to a different url than the one I am expecting", "body": "<p>Seems like doing </p>\n\n<pre><code>document.location.protocol+\n\"//\"+\ndocument.location.host+\n\"/journal_tag\"\n</code></pre>\n\n<p>fixes everything.</p>\n"}], "owner": {"reputation": 107, "user_id": 714258, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/684d9992d72e5985bb177d5752ad80fc?s=128&d=identicon&r=PG", "display_name": "branco", "link": "https://stackoverflow.com/users/714258/branco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 37164162, "answer_count": 2, "score": 0, "last_activity_date": 1462973293, "creation_date": 1462719651, "last_edit_date": 1462918684, "question_id": 37101221, "link": "https://stackoverflow.com/questions/37101221/iron-ajax-in-tandem-with-polymer-starter-kit-misbehaves-or-something-it-sends-r", "title": "iron-ajax in tandem with polymer-starter-kit misbehaves or something. It sends requests to a different url than the one I am expecting", "body": "<p>In the Firefox developer tools I get the following log output:</p>\n\n<pre><code> GET XHR http://localhost:8080/localhost:8080/journal_tag\n</code></pre>\n\n<p>even though I want to go to:</p>\n\n<pre><code>http://localhost:8080/journal_tag\n</code></pre>\n\n<p>I try to data bind the server location from which the xhr response should come to the variable 'this.the_server_url'. But I am stumped because when I do either of</p>\n\n<pre><code>console.log(document.location.protocol+document.location.host+\"/journal_tag\")\nconsole.log(this.the_server_url)\n</code></pre>\n\n<p>I get</p>\n\n<pre><code>\"http:localhost:8080/journal_tag\"\n</code></pre>\n\n<p>which is where server side go code should respond to the xhr request. So the Firefox developer tools log tells me that iron-ajax, or iron-ajax in conjunction with page.js from polymer-starter-kit is misbehaving even though it has the right xhr destination in the the_server_url variable. If anyone has any thoughts on this I would appreciate an answer.</p>\n\n<p>This is my js code:</p>\n\n<pre><code>&lt;dom-module id=\"journal-tag\"&gt;\n  &lt;template&gt;\n    &lt;paper-input value={{the_new_tag}}&gt;\n        Enter the new tag\n    &lt;/paper-input&gt;\n    &lt;paper-button raised on-tap=\"tap_new_tag\"&gt;\n        Submit tag\n    &lt;/paper-button&gt;\n    &lt;iron-ajax\n        auto\n        url={{the_server_url}}\n        params={{ajax_new_tag}}\n        handle-as=\"json\"\n        on-response=\"new_tag_response\"\n        last-response={{the_xhr_response}}\n        debounce-duration=\"300\"&gt;\n    &lt;/iron-ajax&gt;\n  &lt;/template&gt;\n  &lt;script&gt;\n  (function() {\n    'use strict';\n\n    Polymer({\n      is: 'journal-tag',\n        properties:{\n            the_new_tag:{\n                type:String,\n                notify:true\n            },\n            the_server_url:{\n                type:String,\n                notify:true\n            },\n            ajax_new_tag:{\n                type:String,\n                notify:true\n            },\n            the_xhr_response:{\n                type:String,\n                notify:true\n            }\n        },\n        ready : function(){\n            this.the_server_url=document.location.protocol+document.location.host+\"/journal_tag\";\n        },\n        tap_new_tag : function(){\n//parameter format for{{ajax_new_tag}}:\n//'{\"alt\":\"json\", \"q\":\"chrome\"}'\n//            this.the_new_tag=\"tadu\";\n            this.ajax_new_tag={\"tag\" : this.the_new_tag};\n        },\n        new_tag_response : function(){\n            console.log(\"tada\")\n            console.log(this.the_xhr_response)\n            alert(this.the_xhr_response)\n        }\n    });\n  })();\n  &lt;/script&gt;\n&lt;/dom-module&gt;\n</code></pre>\n\n<p>Here is my server side go code, but it seems it never gets called:</p>\n\n<pre><code>...\nhttp.HandleFunc(\"/journal_tag\",journal_tag)\n...\nfunc journal_tag(w http.ResponseWriter, r *http.Request){\n    c := appengine.NewContext(r)\n    u := user.Current(c)\n    if u == nil {\n        io.WriteString(w, \"strange_matter\")\n        return\n    }\n//    var tag=r.FormValue(\"tag\")\n//    io.WriteString(w, \"{\\\"tag\\\":\\\"\" + tag + \"\\\"}\")\n    io.WriteString(w, \"{\\\"tag\\\":\\\"tada\\\"}\")\n}  \n</code></pre>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 3099, "user_id": 1368868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/swZfC.jpg?s=128&g=1", "display_name": "otiai10", "link": "https://stackoverflow.com/users/1368868/otiai10"}, "edited": false, "score": 0, "creation_date": 1516954149, "post_id": 37101512, "comment_id": 83907952, "body": "Thanks! <a href=\"https://cloud.google.com/appengine/docs/standard/python/how-requests-are-handled\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/standard/python/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "is_accepted": true, "score": 2, "last_activity_date": 1462721200, "last_edit_date": 1495542701, "creation_date": 1462721200, "answer_id": 37101512, "question_id": 37100587, "link": "https://stackoverflow.com/questions/37100587/get-current-deployed-timestamp-in-appengine-go/37101512#37101512", "title": "Get current deployed timestamp in AppEngine/Go", "body": "<p>From this link <a href=\"https://stackoverflow.com/questions/3948861/appengine-get-current-serving-application-version\">AppEngine: Get current serving application version</a>, the suggested answer is written in <code>python</code></p>\n\n<pre><code>os.environ['CURRENT_VERSION_ID']\n</code></pre>\n\n<p>Above code is trying to retrieve the environment variable with name <code>CURRENT_VERSION_ID</code>, Equivalent code in <code>go</code> would be:</p>\n\n<pre><code>import (\n    ...\n    \"os\"\n)\n...\nversionText := os.Getenv(\"CURRENT_VERSION_ID\")\n</code></pre>\n\n<p>According to one of the comments, the result would be in this format <code>my-version.383096322806301043</code>, you should use <code>strings.Split</code> method to split it by <code>.</code>, eg:</p>\n\n<pre><code>import (\n    ...\n    \"strings\"\n)\n...\ntimestampString := strings.Split(versionText, \".\")[1]\n</code></pre>\n"}], "owner": {"reputation": 3099, "user_id": 1368868, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/swZfC.jpg?s=128&g=1", "display_name": "otiai10", "link": "https://stackoverflow.com/users/1368868/otiai10"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "accepted_answer_id": 37101512, "answer_count": 1, "score": 0, "last_activity_date": 1462721200, "creation_date": 1462715631, "last_edit_date": 1495541273, "question_id": 37100587, "link": "https://stackoverflow.com/questions/37100587/get-current-deployed-timestamp-in-appengine-go", "title": "Get current deployed timestamp in AppEngine/Go", "body": "<p>Can I get the deployed timestamp of current application version in AppEngine/Go?</p>\n\n<p>It seems helpful, but not sure how to implement in AppEngine/Go application code.</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/3948861/appengine-get-current-serving-application-version\">AppEngine: Get current serving application version</a></li>\n<li><a href=\"https://godoc.org/google.golang.org/appengine\" rel=\"nofollow noreferrer\">https://godoc.org/google.golang.org/appengine</a></li>\n<li><a href=\"https://cloud.google.com/appengine/docs/admin-api/v1beta2/reference/apps/modules/versions\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/admin-api/v1beta2/reference/apps/modules/versions</a></li>\n</ul>\n"}, {"tags": ["if-statement", "go"], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 6001177, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60611a760f0082adfdd9f152805119dc?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Christian Gr&#252;nhage", "link": "https://stackoverflow.com/users/6001177/jan-christian-gr%c3%bcnhage"}, "edited": false, "score": 0, "creation_date": 1462715206, "post_id": 37100230, "comment_id": 61743258, "body": "Thank you, did not think of that ^^"}], "tags": [], "owner": {"reputation": 21, "user_id": 2312927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/257e27a634c98d9fe9bbbe6cf871f674?s=128&d=identicon&r=PG", "display_name": "Chris Wood", "link": "https://stackoverflow.com/users/2312927/chris-wood"}, "is_accepted": false, "score": 0, "last_activity_date": 1462713148, "creation_date": 1462713148, "answer_id": 37100230, "question_id": 37100139, "link": "https://stackoverflow.com/questions/37100139/reader-readstring-does-not-strip-out-the-first-occurrence-of-delim/37100230#37100230", "title": "reader.ReadString does not strip out the first occurrence of delim", "body": "<p>I don't know anything about Go, but you might want to strip the string of leading or trailing spaces and other whitespace (tabs, newline, etc) characters.</p>\n"}, {"tags": [], "owner": {"reputation": 1898, "user_id": 1708165, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ec670e250a0b2662151648ea882d2ef?s=128&d=identicon&r=PG", "display_name": "ch33hau", "link": "https://stackoverflow.com/users/1708165/ch33hau"}, "is_accepted": true, "score": 3, "last_activity_date": 1462713593, "last_edit_date": 1462713593, "creation_date": 1462713170, "answer_id": 37100236, "question_id": 37100139, "link": "https://stackoverflow.com/questions/37100139/reader-readstring-does-not-strip-out-the-first-occurrence-of-delim/37100236#37100236", "title": "reader.ReadString does not strip out the first occurrence of delim", "body": "<p>This is because your the <code>text</code> is storing <code>Bob\\n</code></p>\n\n<p>One way to solve this is using <code>strings.TrimSpace</code> to trim the newline, eg:</p>\n\n<pre><code>import (\n    ....\n    \"strings\"\n    ....\n)\n\n...\nif aliceOrBob(strings.TrimSpace(text)) {\n...\n</code></pre>\n\n<p>Alternatively, you can also use <code>ReadLine</code> instead of <code>ReadString</code>, eg:</p>\n\n<pre><code>...\ntext, _, _ := reader.ReadLine()\nif aliceOrBob(string(text)) {\n...\n</code></pre>\n\n<p>The reason why the <code>string(text)</code> is needed is because ReadLine will return you <code>byte[]</code> instead of <code>string</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "is_accepted": false, "score": 2, "last_activity_date": 1462715247, "creation_date": 1462715247, "answer_id": 37100525, "question_id": 37100139, "link": "https://stackoverflow.com/questions/37100139/reader-readstring-does-not-strip-out-the-first-occurrence-of-delim/37100525#37100525", "title": "reader.ReadString does not strip out the first occurrence of delim", "body": "<p>I think the source of confusion here is that:</p>\n\n<pre><code>text, _ := reader.ReadString('\\n')\n</code></pre>\n\n<p>Does not strip out the <code>\\n</code>, but instead keeps it as last value, and ignores everything after it. </p>\n\n<blockquote>\n  <p>ReadString reads until the first occurrence of delim in the input,\n  returning a string containing the data up to and including the\n  delimiter.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/src/bufio/bufio.go?s=11657:11721#L435\" rel=\"nofollow\">https://golang.org/src/bufio/bufio.go?s=11657:11721#L435</a></p>\n\n<p>And then you end up comparing <code>Alice</code> and <code>Alice\\n</code>. So the solution is to either use <code>Alice\\n</code> in your <code>aliceOrBob</code> function, or read the input differently, as pointed out by @ch33hau.</p>\n"}, {"comments": [{"owner": {"reputation": 1669, "user_id": 12396017, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Nk8xz.png?s=128&g=1", "display_name": "Maxim Sagaydachny", "link": "https://stackoverflow.com/users/12396017/maxim-sagaydachny"}, "edited": false, "score": 0, "creation_date": 1578553820, "post_id": 59658562, "comment_id": 105477623, "body": "Your answer is confusing. Could you please reformat it and add extra explanation?"}], "tags": [], "owner": {"reputation": 15, "user_id": 9265274, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/166341bc2926a8096845cbf7b2799661?s=128&d=identicon&r=PG&f=1", "display_name": "kongshuo", "link": "https://stackoverflow.com/users/9265274/kongshuo"}, "is_accepted": false, "score": 0, "last_activity_date": 1578552557, "creation_date": 1578552557, "answer_id": 59658562, "question_id": 37100139, "link": "https://stackoverflow.com/questions/37100139/reader-readstring-does-not-strip-out-the-first-occurrence-of-delim/59658562#59658562", "title": "reader.ReadString does not strip out the first occurrence of delim", "body": "<pre><code>reader.ReadLine() \n</code></pre>\n\n<p>Can leave \u2018\\n\u2019 but reader.ReadString() can't</p>\n"}], "owner": {"reputation": 81, "user_id": 6001177, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60611a760f0082adfdd9f152805119dc?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Christian Gr&#252;nhage", "link": "https://stackoverflow.com/users/6001177/jan-christian-gr%c3%bcnhage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1111, "favorite_count": 0, "accepted_answer_id": 37100236, "answer_count": 4, "score": 2, "last_activity_date": 1578552557, "creation_date": 1462712569, "last_edit_date": 1462716238, "question_id": 37100139, "link": "https://stackoverflow.com/questions/37100139/reader-readstring-does-not-strip-out-the-first-occurrence-of-delim", "title": "reader.ReadString does not strip out the first occurrence of delim", "body": "<p>I wrote a simple go program and it isn't working as it should:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Who are you? \\n Enter your name: \")\n    text, _ := reader.ReadString('\\n')\n    if aliceOrBob(text) {\n        fmt.Printf(\"Hello, \", text)\n    } else {\n        fmt.Printf(\"You're not allowed in here! Get OUT!!\")\n    } \n}\n\nfunc aliceOrBob(text string) bool {\n    if text == \"Alice\" {\n        return true\n    } else if text == \"Bob\" {\n        return true\n    } else {\n        return false\n    }\n}\n</code></pre>\n\n<p>It should ask the user to tell it's name and, if he is either Alice or Bob, greet him and else tell him to get out. \n The problem is, that even when the entered name is Alice or Bob, it tells the User to get out.</p>\n\n<p>Alice:</p>\n\n<pre><code>/usr/lib/golang/bin/go run /home/jcgruenhage/go/workspace/src/github.com/jcgruenhage/helloworld/greet/greet.go\nWho are you? \nEnter your name: Alice\nYou're not allowed in here! Get OUT!!\nProcess finished with exit code 0\n</code></pre>\n\n<p>Bob:</p>\n\n<pre><code>/usr/lib/golang/bin/go run /home/jcgruenhage/go/workspace/src/github.com/jcgruenhage/helloworld/greet/greet.go\nWho are you? \nEnter your name: Bob\nYou're not allowed in here! Get OUT!!\nProcess finished with exit code 0\n</code></pre>\n"}, {"tags": ["go", "jira-rest-api"], "comments": [{"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1462703638, "post_id": 37097989, "comment_id": 61740309, "body": "There is no format specifier (e.g. <code>%d</code>) in the <code>fmt.Printf</code> statement."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 6246000, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-DPRL7hLiw6M/AAAAAAAAAAI/AAAAAAAACa0/qXGaGbBeCBc/photo.jpg?sz=128", "display_name": "Mert Demirok", "link": "https://stackoverflow.com/users/6246000/mert-demirok"}, "edited": false, "score": 0, "creation_date": 1462709966, "post_id": 37099521, "comment_id": 61741883, "body": "Thank you , I working on it . I&#39;ll get back to you on that subject"}, {"owner": {"reputation": 43, "user_id": 6246000, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-DPRL7hLiw6M/AAAAAAAAAAI/AAAAAAAACa0/qXGaGbBeCBc/photo.jpg?sz=128", "display_name": "Mert Demirok", "link": "https://stackoverflow.com/users/6246000/mert-demirok"}, "edited": false, "score": 0, "creation_date": 1462713005, "post_id": 37099521, "comment_id": 61742709, "body": "Hey ralph , thank you so much. I just forgot to add the Json model. :) Data has reached the db."}], "tags": [], "owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "is_accepted": true, "score": 0, "last_activity_date": 1462711628, "last_edit_date": 1462711628, "creation_date": 1462708425, "answer_id": 37099521, "question_id": 37097989, "link": "https://stackoverflow.com/questions/37097989/i-wrote-the-rest-api-but-body-is-return-nil-in-golang-why-returning-0-nil/37099521#37099521", "title": "I wrote the rest api but body is return nil in golang . Why returning &quot;0 {&lt;nil&gt; false [] &lt;nil&gt; false 0 &lt;nil&gt; 0}&quot;", "body": "<p>If you examine the source code for <code>json.Decoder</code>,</p>\n\n<pre><code>...\ntype Decoder struct {\n    r     io.Reader\n    buf   []byte\n    d     decodeState\n    scanp int // start of unread data in buf\n    scan  scanner\n    err   error\n\n    tokenState int\n    tokenStack []int\n}\n\nfunc NewDecoder(r io.Reader) *Decoder {\n    return &amp;Decoder{r: r}\n}\n...\n</code></pre>\n\n<p>you can see that <code>NewDecoder</code> only sets the <code>r</code> field, and that is what you are observing in the output of <code>fmt.Printf</code>.</p>\n\n<p>Until you execute <code>err := decoder.Decode(&amp;apdata)</code>, your structure will not be filled in. What you are seeing in the output is the content of the decoder, not the body or your structure.</p>\n\n<p>If you print your structure after running <code>err := decoder.Decode(&amp;apdata)</code>, it contains proper data:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n    \"strings\"\n)\n\nfunc main() {\n    input := `{\n        \"mac\":\"01:0a:95:9d:68:20\",\n        \"rssi_max\":-73.50,\n        \"rssi_min\":-50.02,\n        \"loc_def_id\":1\n    }`\n\n    decoder := json.NewDecoder(strings.NewReader(input))\n    var apdata struct {\n            ID       int    `db:\"id\"`\n            Mac      string `json:\"mac\" db:\"mac\"`\n            RssiMax  uint64 `json:\"rssi_max\" db:\"rssi_max\"`\n            RssiMin  uint16 `json:\"rssi_min\" db:\"rssi_min\"`\n            LocDefId uint64 `json:\"loc_def_id\" db:\"loc_def_id\"`\n    }\n    _ = decoder.Decode(&amp;apdata)\n    fmt.Printf(\"appdata : %+v\\n\", apdata)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>appdata : {ID:0 Mac:01:0a:95:9d:68:20 RssiMax:0 RssiMin:0 LocDefId:1}\n</code></pre>\n\n<p>The <code>RssiMax</code> and <code>RssiMin</code> are zero because they are unsigned ints receiving negative values.</p>\n"}], "owner": {"reputation": 43, "user_id": 6246000, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-DPRL7hLiw6M/AAAAAAAAAAI/AAAAAAAACa0/qXGaGbBeCBc/photo.jpg?sz=128", "display_name": "Mert Demirok", "link": "https://stackoverflow.com/users/6246000/mert-demirok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 1, "accepted_answer_id": 37099521, "answer_count": 1, "score": 2, "last_activity_date": 1462711628, "creation_date": 1462697474, "last_edit_date": 1462698823, "question_id": 37097989, "link": "https://stackoverflow.com/questions/37097989/i-wrote-the-rest-api-but-body-is-return-nil-in-golang-why-returning-0-nil", "title": "I wrote the rest api but body is return nil in golang . Why returning &quot;0 {&lt;nil&gt; false [] &lt;nil&gt; false 0 &lt;nil&gt; 0}&quot;", "body": "<pre><code>func InsertApData(w http.ResponseWriter, r *http.Request) {\n\n    decoder := json.NewDecoder(r.Body)\n    fmt.Printf(\"Request Body : \", decoder)\n    var apdata models.ApData\n    err := decoder.Decode(&amp;apdata)\n    check(b.E(err))\n    _, err2 := stmt.InsertApData.Exec(apdata.Mac, apdata.RssiMax, apdata.RssiMin, apdata.LocDefId)\n    check(b.E(err2))\n}\n</code></pre>\n\n<p>and data type for db</p>\n\n<pre><code>type ApData struct {\n    ID       int    `db:\"id\"`\n    Mac      string `db:\"mac\"`\n    RssiMax  uint64 `db:\"rssi_max\"`\n    RssiMin  uint16 `db:\"rssi_min\"`\n    LocDefId uint64 `db:\"loc_def_id\"`\n}\n</code></pre>\n\n<p>Why returning </p>\n\n<blockquote>\n  <p>Request Body : %!(EXTRA *json.Decoder=&amp;{0xc820012b00 [] {[] 0 {\n  false []  false 0  0} { false []  false 0  0}\n   false} 0 { false []  false 0  0}  0 []})</p>\n</blockquote>\n\n<p>also json :</p>\n\n<pre><code>{\n\"mac\":\"01:0a:95:9d:68:20\",\n\"rssi_max\":-73.50,\n\"rssi_min\":-50.02,\n\"loc_def_id\":1\n}\n</code></pre>\n"}, {"tags": ["git", "go"], "answers": [{"comments": [{"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1462711439, "post_id": 37098297, "comment_id": 61742283, "body": "Thanks. I didn&#39;t realize that I could just rename the directory to &#39;user1&#39; locally while remote repo url is different, for things to work correctly."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 3, "last_activity_date": 1462699774, "creation_date": 1462699774, "answer_id": 37098297, "question_id": 37097867, "link": "https://stackoverflow.com/questions/37097867/go-packaging-how-to-avoid-cannot-find-package-error-when-submitting-prs-from/37098297#37098297", "title": "Go packaging: How to avoid &#39;cannot find package&#39; error when submitting PRs from fork?", "body": "<p>You might have forked <code>github.com/user1/goproject</code> into <code>github.com/user2/goproject</code>, that does not mean you cannot clone it wherever you want in your <code>GOPATH</code>.</p>\n\n<p>In particular, you can clone it in:</p>\n\n<pre><code>$GOPATH\n  github.com\n    user1\n      goproject\n</code></pre>\n\n<p>You effectively are replacing the local clone of the original repo by the clone of your fork.</p>\n\n<p>That means locally, you don't change any package path, even though <code>git remote -v</code> tells you are are pushing back to your fork url <code>github.com/user2/goproject</code>.</p>\n"}], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 2, "accepted_answer_id": 37098297, "answer_count": 1, "score": 2, "last_activity_date": 1462699774, "creation_date": 1462696641, "question_id": 37097867, "link": "https://stackoverflow.com/questions/37097867/go-packaging-how-to-avoid-cannot-find-package-error-when-submitting-prs-from", "title": "Go packaging: How to avoid &#39;cannot find package&#39; error when submitting PRs from fork?", "body": "<p>I am running into what sounds like a limitation in an overall simple approach for integrating git with go install. </p>\n\n<ol>\n<li>I've forked a git repo on github</li>\n<li>I now have to deal with changing packages in the same repo to reference correctly my own fork. </li>\n<li>Then when I am ready to submit a PR, I need to revert the package imports while I won't be able to compile and install the changes.</li>\n<li>I could keep 2 repos and cherry pick the lines I need to change but that seems too complicated by 2016.</li>\n</ol>\n\n<p>How do I get around this problem?</p>\n"}, {"tags": ["http", "go", "httprequest", "virtualhost", "virtual-hosts"], "comments": [{"owner": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "edited": false, "score": 0, "creation_date": 1462682749, "post_id": 37096166, "comment_id": 61735920, "body": "Is this an HTTP/1.x or an HTTP/2 request?"}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "reply_to_user": {"reputation": 10980, "user_id": 200445, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/322dfbdffdbb24e5595f3585e1b5c140?s=128&d=identicon&r=PG", "display_name": "Vasiliy Faronov", "link": "https://stackoverflow.com/users/200445/vasiliy-faronov"}, "edited": false, "score": 0, "creation_date": 1462683152, "post_id": 37096166, "comment_id": 61735977, "body": "http/1.x not http2"}], "answers": [{"comments": [{"owner": {"reputation": 2282, "user_id": 1483903, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6c37dd8068c794e8268a332d944cd7e8?s=128&d=identicon&r=PG", "display_name": "thebiggestlebowski", "link": "https://stackoverflow.com/users/1483903/thebiggestlebowski"}, "edited": false, "score": 0, "creation_date": 1594765013, "post_id": 37096297, "comment_id": 111240186, "body": "Thanks for the help!  So annoying they don&#39;t treat this as a normal http header.  It&#39;s silent and difficult to figure out, until you find the right answer online."}], "tags": [], "owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "is_accepted": true, "score": 6, "last_activity_date": 1462682768, "creation_date": 1462682768, "answer_id": 37096297, "question_id": 37096166, "link": "https://stackoverflow.com/questions/37096166/why-is-host-missing-from-my-http-request-header-fields/37096297#37096297", "title": "why is host missing from my http request header fields?", "body": "<p>It stated on Golang http docs :</p>\n\n<blockquote>\n  <p>For incoming requests, the Host header is promoted to the Request.Host\n  field and removed from the Header map.</p>\n</blockquote>\n\n<p>So you can get the host by access </p>\n\n<blockquote>\n  <p>http.Request.Host</p>\n</blockquote>\n\n<p>Check here for details : <a href=\"https://golang.org/pkg/net/http/\" rel=\"noreferrer\">https://golang.org/pkg/net/http/</a></p>\n"}], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2159, "favorite_count": 0, "accepted_answer_id": 37096297, "answer_count": 1, "score": 4, "last_activity_date": 1462682768, "creation_date": 1462681124, "last_edit_date": 1462681522, "question_id": 37096166, "link": "https://stackoverflow.com/questions/37096166/why-is-host-missing-from-my-http-request-header-fields", "title": "why is host missing from my http request header fields?", "body": "<p>I'm printing out all the headers and I get:</p>\n\n<pre><code>map[Cookie:[_ga=GA1.2.843429125.1462575405] User-Agent:[Mozilla/5.0\n(Macintosh; Intel Mac OS X 10_11_3) AppleWebKit/601.4.4 (KHTML, like Gecko)\nVersion/9.0.3 Safari/601.4.4] Accept-Language:[en-us] \nAccept-Encoding:[gzip, deflate] Connection:[keep-alive] \nAccept:[text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8]]\n</code></pre>\n\n<p>which means my browser is sending \"Cookie\", \"User-Agent\", \"Accept-Language\", \"Accept-Encoding\", \"Connection\", and \"Accept\" but there is no \"Host\" value.</p>\n\n<p>How can I get my <a href=\"https://en.wikipedia.org/wiki/Virtual_hosting\" rel=\"nofollow\">https://en.wikipedia.org/wiki/Virtual_hosting</a> working without this value?</p>\n\n<p>I'm using <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow\">https://github.com/gin-gonic/gin</a></p>\n"}, {"tags": ["go", "supervisord"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1462683644, "post_id": 37095379, "comment_id": 61736047, "body": "Related: 1. <a href=\"http://stackoverflow.com/questions/31059023/how-to-reference-a-relative-file-from-code-and-tests\">how to reference a relative file from code and tests</a>; 2. <a href=\"http://stackoverflow.com/questions/28745161/with-golang-webserver-where-does-the-root-of-the-website-map-onto-the-filesystem\">With golang webserver where does the root of the website map onto the filesystem&gt;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1462673370, "post_id": 37095487, "comment_id": 61734561, "body": "Yes: don&#39;t use relative paths in your application! Pass a path to your static files as a configuration option (e.g. using <a href=\"https://github.com/kelseyhightower/envconfig\" rel=\"nofollow noreferrer\">envconfig</a>), and if that&#39;s not set, then fallback to the result <code>os.Getwd</code> (or just bail out). Be explicit, because as you&#39;re finding, relying on &#39;implicit&#39; behaviour breaks very quickly once you&#39;re on another machine."}, {"owner": {"reputation": 25797, "user_id": 316357, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/50e7e6ec58e101311283a40e60c33572?s=128&d=identicon&r=PG", "display_name": "Curious2learn", "link": "https://stackoverflow.com/users/316357/curious2learn"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1462726601, "post_id": 37095487, "comment_id": 61746978, "body": "@elithrar Can you please give an example? It is not clear what you are suggesting. I have a folder from which I serve static files directly using \t<code>fs := http.StripPrefix(&quot;&#47;static&#47;&quot;, http.FileServer(http.Dir(&quot;.&#47;static&quot;)))</code>. However, I am not sure how to use this to convert  <code>http.ServeFile(w, req, &quot;.&#47;pleaselogin.html&quot;)</code> to an absolute path. If you could give me an example, I would be happy to accept that as the answer."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1462730569, "post_id": 37095487, "comment_id": 61748156, "body": "<code>.&#47;static</code> is a relative path. Have your application take an argument/config file/environmental variable that passes the full path - e.g. <code>&#47;Users&#47;you&#47;Code&#47;static&#47;</code> so that the application can find the static directory no matter where it&#39;s run from. Supervisord allows you to set environmental variables as well."}, {"owner": {"reputation": 25797, "user_id": 316357, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/50e7e6ec58e101311283a40e60c33572?s=128&d=identicon&r=PG", "display_name": "Curious2learn", "link": "https://stackoverflow.com/users/316357/curious2learn"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1462804308, "post_id": 37095487, "comment_id": 61777940, "body": "@elithrar Thanks! Now I understand. I will have to maintain separate values for dev and prod environments in that case (since full path is different in each case). However, I can use the appropriate flags when I start the process to specify these paths and have the application use them."}], "tags": [], "owner": {"reputation": 25797, "user_id": 316357, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/50e7e6ec58e101311283a40e60c33572?s=128&d=identicon&r=PG", "display_name": "Curious2learn", "link": "https://stackoverflow.com/users/316357/curious2learn"}, "is_accepted": false, "score": 1, "last_activity_date": 1462673212, "creation_date": 1462673212, "answer_id": 37095487, "question_id": 37095379, "link": "https://stackoverflow.com/questions/37095379/http-servefile-returns-404-not-found-error-on-the-server-golang/37095487#37095487", "title": "http.ServeFile returns 404 not found error on the server golang", "body": "<p>Okay, just figured out that I can add the directory option in <code>supervisord</code> configuration. Adding, </p>\n\n<pre><code>directory=/home/username/go/src/appdirectory/\n</code></pre>\n\n<p>solves the problem. However, if there are other better solutions, I would love to see them.</p>\n"}], "owner": {"reputation": 25797, "user_id": 316357, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/50e7e6ec58e101311283a40e60c33572?s=128&d=identicon&r=PG", "display_name": "Curious2learn", "link": "https://stackoverflow.com/users/316357/curious2learn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2087, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1462673212, "creation_date": 1462671802, "question_id": 37095379, "link": "https://stackoverflow.com/questions/37095379/http-servefile-returns-404-not-found-error-on-the-server-golang", "title": "http.ServeFile returns 404 not found error on the server golang", "body": "<p>I have the following handler in my go web application:</p>\n\n<pre><code>func pleaseLoginHandler(w http.ResponseWriter, req *http.Request) {\n    http.ServeFile(w, req, \"./pleaselogin.html\")\n}\n</code></pre>\n\n<p>This handler is called for the route <code>http://a.b.org/pleaselogin</code> by using:</p>\n\n<pre><code>rtr.HandleFunc(\"/pleaselogin\", pleaseLoginHandler)\n</code></pre>\n\n<p>The application works without any problems locally. Also, it works on the remote server if I run the executable from the folder in which all the application files are present. That is, if the application is in the location <code>/home/username/go/src/appdirectory/appexecfile</code> and I start the application by going to this directory and starting it as <code>./appexecfile</code> then all routes works as expected.</p>\n\n<p>The problem occurs when I start the application using <code>supervisord</code>. In this case if I visit the route <code>http://a.b.org/pleaselogin</code> the server returns 404 not found error. My guess is that this is because the http.ServeFile is using a relative path and when the application is started with <code>supervisord</code> it does not know to look for the file in <code>/home/user/go/src/appdirectory</code>.</p>\n\n<p>Can someone please suggest a solution to this problem? Can I use another method for serving the file in the golang application that avoids this problem? Or, can I use a setting in <code>supervisord</code> that makes it look for any file relative to the executable of the application?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "websocket", "ionic-framework", "phonegap-plugins"], "comments": [{"owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "edited": false, "score": 0, "creation_date": 1462645218, "post_id": 37091501, "comment_id": 61727872, "body": "The gorilla Websocket library aims to implement the RFC6455 web socket standard. A quick search yields third party libraries for phone gap that add web socket support. <a href=\"https://github.com/mkuklis/phonegap-websocket\" rel=\"nofollow noreferrer\">github.com/mkuklis/phonegap-websocket</a>"}, {"owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "reply_to_user": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "edited": false, "score": 0, "creation_date": 1462649184, "post_id": 37091501, "comment_id": 61729219, "body": "@benjic - it says it is for android only"}], "owner": {"reputation": 6166, "user_id": 1370370, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fb671a9cb0df8a662328d87de693e0ae?s=128&d=identicon&r=PG", "display_name": "iWizard", "link": "https://stackoverflow.com/users/1370370/iwizard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 390, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1462641581, "creation_date": 1462641581, "question_id": 37091501, "link": "https://stackoverflow.com/questions/37091501/how-to-connect-over-tcp-from-ionic-phonegap-to-websocket-on-server", "title": "How to connect over TCP from ionic (phonegap) to websocket on server?", "body": "<p>I have installed and running this script on server: <a href=\"https://github.com/gorilla/websocket\" rel=\"nofollow\">https://github.com/gorilla/websocket</a>\nEverything was configured and running ok when I was using ios native application but now I have to switch to phonegap and I cannot find example which is working.\nI cannot move to another script on my server because it would be to much work.\nIs there any way that I can connect to my server from phonegap ionic?\nMy application is for ios and android, it's game which needs real time connection just like chat application.\nThank you</p>\n"}, {"tags": ["shell", "go"], "comments": [{"owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "edited": false, "score": 1, "creation_date": 1462642579, "post_id": 37091316, "comment_id": 61727010, "body": "The <code>fmt</code> library has set of scan functions that can parse a formatted string into values. You can use a Scanner on the stdout pipe for lines and scan each formatted line. You would need to figure out how to the ratio of complete versus total from the ffmpeg."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1462684481, "post_id": 37091316, "comment_id": 61736201, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/30725751/streaming-commands-output-progress\">Streaming commands output progress</a>"}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1462877947, "post_id": 37091316, "comment_id": 61811762, "body": "@icza, could you please have a look at my posted answer, why I get nothing printed on the screen?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1462881292, "post_id": 37091316, "comment_id": 61814279, "body": "@seaguest I added an answer here as well."}], "answers": [{"comments": [{"owner": {"reputation": 48302, "user_id": 388916, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f9d967832644f9faa431e4e50b69bb0?s=128&d=identicon&r=PG", "display_name": "Hubro", "link": "https://stackoverflow.com/users/388916/hubro"}, "edited": false, "score": 0, "creation_date": 1496211077, "post_id": 37107433, "comment_id": 75560995, "body": "You could run ffmpeg in a pseudo terminal, that would probably work (?)"}], "tags": [], "owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "is_accepted": false, "score": 3, "last_activity_date": 1462877960, "last_edit_date": 1462877960, "creation_date": 1462765368, "answer_id": 37107433, "question_id": 37091316, "link": "https://stackoverflow.com/questions/37091316/how-to-get-the-realtime-output-for-a-shell-command-in-golang/37107433#37107433", "title": "How to get the realtime output for a shell command in golang?", "body": "<p>I do find icza's solution that he mentioned in that post is quite useful, however it didn't't solve my problem.</p>\n\n<p>I did a little test as following:</p>\n\n<p>1, I write a script which print some info every second for ten times, here is the script.sh</p>\n\n<pre><code>#!/bin/bash\n\nfor i in {1..10}\ndo\n    echo \"step \" $i\n    sleep 1s\ndone\n</code></pre>\n\n<p>2, read the stdout and extract the needed information from stdout and do some process to get the expected format, here is the code:\npackage main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"os/exec\"\n    \"regexp\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc getRatio(text string) float32 {\n    re1, _ := regexp.Compile(`step[\\s]+(\\d+)`)\n    result := re1.FindStringSubmatch(text)\n    val, _ := strconv.Atoi(result[1])\n    return float32(val) / 10\n}\n\nfunc main() {\n    cmdName := \"ffmpeg -i t.webm  -acodec aac -vcodec libx264  cmd1.mp4\"\n    //cmdName := \"bash ./script.sh\"\n    cmdArgs := strings.Fields(cmdName)\n\n    cmd := exec.Command(cmdArgs[0], cmdArgs[1:len(cmdArgs)]...)\n    stdout, _ := cmd.StdoutPipe()\n    cmd.Start()\n\n    oneByte := make([]byte, 10)\n    for {\n        _, err := stdout.Read(oneByte)\n        if err != nil {\n            break\n        }\n        progressingRatio := getRatio(string(oneByte))\n        fmt.Printf(\"progressing  ratio %v \\n\", progressingRatio)\n    }\n}\n</code></pre>\n\n<p>This does work for my script.sh test, but for the ffmpeg command it doesn't work, in ffmpeg's case, nothing get printed and the process get finished (not stuck), I guess the way of writing data to stdout for ffmpeg is a little special (maybe no newline character at all, and I tried icza's solution, but it still doesn't work).</p>\n"}, {"comments": [{"owner": {"reputation": 58775, "user_id": 474189, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/jzXIJ.jpg?s=128&g=1", "display_name": "Duncan Jones", "link": "https://stackoverflow.com/users/474189/duncan-jones"}, "edited": false, "score": 0, "creation_date": 1565590022, "post_id": 37137583, "comment_id": 101386477, "body": "&quot;<i>you need a library that is capable of capturing the (textual) content of the terminal window</i>&quot; &gt; Do you have any suggestions for this? Is this heading in the direction of needing a PTY?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 58775, "user_id": 474189, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/jzXIJ.jpg?s=128&g=1", "display_name": "Duncan Jones", "link": "https://stackoverflow.com/users/474189/duncan-jones"}, "edited": false, "score": 0, "creation_date": 1565680204, "post_id": 37137583, "comment_id": 101417747, "body": "@DuncanJones No, I don&#39;t have anything in mind. I thought libs like <a href=\"https://github.com/nsf/termbox-go\" rel=\"nofollow noreferrer\">termbox-go</a> can do it, but it seems it can just return characters from its buffer."}, {"owner": {"reputation": 58775, "user_id": 474189, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/jzXIJ.jpg?s=128&g=1", "display_name": "Duncan Jones", "link": "https://stackoverflow.com/users/474189/duncan-jones"}, "edited": false, "score": 0, "creation_date": 1565684137, "post_id": 37137583, "comment_id": 101419511, "body": "Thanks. In the interim, I&#39;ve found <a href=\"https://github.com/creack/pty\" rel=\"nofollow noreferrer\">github.com/creack/pty</a>, which does an excellent job."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1482861304, "last_edit_date": 1482861304, "creation_date": 1462880722, "answer_id": 37137583, "question_id": 37091316, "link": "https://stackoverflow.com/questions/37091316/how-to-get-the-realtime-output-for-a-shell-command-in-golang/37137583#37137583", "title": "How to get the realtime output for a shell command in golang?", "body": "<p>When you have an <a href=\"https://golang.org/pkg/os/exec/#Cmd\" rel=\"nofollow noreferrer\"><code>exec.Cmd</code></a> value of an external command you started from Go, you may use its <code>Cmd.Stdin</code>, <code>Cmd.Stdout</code> and <code>Cmd.Stderr</code> fields to communicate with the process in <em>some</em> way.</p>\n\n<p><em>Some</em> way means you can send data to its <em>standard</em> input, and you can read its <em>standard</em> output and error streams.</p>\n\n<p>The stress is on <em>standard</em>. If the external process is sending data on a network connection, or is writing data to a file, you will not be able to intercept those data via the above mentioned 3 streams.</p>\n\n<p>Now on to <code>ffmpeg</code>. <code>ffmpeg</code> and many other console applications do not write data to standard output/error, but they use system calls or other libraries (that use system calls) to manipulate the terminal window. Of course an application may send <em>some</em> data to the standard output/error, and may display <em>other</em> data by manipulating the terminal window.</p>\n\n<p>So you don't see the output of <code>ffmpeg</code> because you try to read its standard output/error, but <code>ffmpeg</code> does not display its output by writing to those streams.</p>\n\n<p>In the general case if you want to capture the output of such applications, you need a library that is capable of capturing the (textual) content of the terminal window. In an easier situation the application supports dumping those output to files usually controlled by extra command line parameters, which then you can read/monitor from Go.</p>\n"}, {"tags": [], "owner": {"reputation": 15, "user_id": 3688382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c89eea6accae4ab213e5d8ef087ce09?s=128&d=identicon&r=PG&f=1", "display_name": "aissa", "link": "https://stackoverflow.com/users/3688382/aissa"}, "is_accepted": false, "score": 2, "last_activity_date": 1474361572, "last_edit_date": 1474361572, "creation_date": 1474360919, "answer_id": 39589431, "question_id": 37091316, "link": "https://stackoverflow.com/questions/37091316/how-to-get-the-realtime-output-for-a-shell-command-in-golang/39589431#39589431", "title": "How to get the realtime output for a shell command in golang?", "body": "<p>check the below, needs enhancements (not recommended to be used as it is) but working :)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n    \"strconv\"\n    \"strings\"\n)\n\nvar duration = 0\nvar allRes = \"\"\nvar lastPer = -1\n\nfunc durToSec(dur string) (sec int) {\n    durAry := strings.Split(dur, \":\")\n    if len(durAry) != 3 {\n        return\n    }\n    hr, _ := strconv.Atoi(durAry[0])\n    sec = hr * (60 * 60)\n    min, _ := strconv.Atoi(durAry[1])\n    sec += min * (60)\n    second, _ := strconv.Atoi(durAry[2])\n    sec += second\n    return\n}\nfunc getRatio(res string) {\n    i := strings.Index(res, \"Duration\")\n    if i &gt;= 0 {\n\n        dur := res[i+10:]\n        if len(dur) &gt; 8 {\n            dur = dur[0:8]\n\n            duration = durToSec(dur)\n            fmt.Println(\"duration:\", duration)\n            allRes = \"\"\n        }\n    }\n    if duration == 0 {\n        return\n    }\n    i = strings.Index(res, \"time=\")\n    if i &gt;= 0 {\n\n        time := res[i+5:]\n        if len(time) &gt; 8 {\n            time = time[0:8]\n            sec := durToSec(time)\n            per := (sec * 100) / duration\n            if lastPer != per {\n                lastPer = per\n                fmt.Println(\"Percentage:\", per)\n            }\n\n            allRes = \"\"\n        }\n    }\n}\n\nfunc main() {\n    os.Remove(\"cmd1.mp4\")\n    cmdName := \"ffmpeg -i 1.mp4  -acodec aac -vcodec libx264  cmd1.mp4 2&gt;&amp;1\"\n    cmd := exec.Command(\"sh\", \"-c\", cmdName)\n    stdout, _ := cmd.StdoutPipe()\n    cmd.Start()\n    oneByte := make([]byte, 8)\n    for {\n        _, err := stdout.Read(oneByte)\n        if err != nil {\n            fmt.Printf(err.Error())\n            break\n        }\n        allRes += string(oneByte)\n        getRatio(allRes)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2051, "user_id": 474002, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Oqy8c.jpg?s=128&g=1", "display_name": "Browny Lin", "link": "https://stackoverflow.com/users/474002/browny-lin"}, "is_accepted": false, "score": 28, "last_activity_date": 1504088478, "creation_date": 1504088478, "answer_id": 45957859, "question_id": 37091316, "link": "https://stackoverflow.com/questions/37091316/how-to-get-the-realtime-output-for-a-shell-command-in-golang/45957859#45957859", "title": "How to get the realtime output for a shell command in golang?", "body": "<p>Looks like ffmpeg sends all diagnostic messages (the \"console output\")\nto <strong>stderr</strong> instead of stdout. Below code works for me. </p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os/exec\"\n    \"strings\"\n)\n\nfunc main() {\n    args := \"-i test.mp4 -acodec copy -vcodec copy -f flv rtmp://aaa/bbb\"\n    cmd := exec.Command(\"ffmpeg\", strings.Split(args, \" \")...)\n\n    stderr, _ := cmd.StderrPipe()\n    cmd.Start()\n\n    scanner := bufio.NewScanner(stderr)\n    scanner.Split(bufio.ScanWords)\n    for scanner.Scan() {\n        m := scanner.Text()\n        fmt.Println(m)\n    }\n    cmd.Wait()\n}\n</code></pre>\n\n<p>The version of ffmpeg is detailed as below. </p>\n\n<pre><code>ffmpeg version 3.0.2 Copyright (c) 2000-2016 the FFmpeg developers\nbuilt with Apple LLVM version 7.3.0 (clang-703.0.29)\nconfiguration: --prefix=/usr/local/Cellar/ffmpeg/3.0.2 --enable-shared --enable-pthreads --enable-gpl --enable-version3 --enable-hardcoded-tables --enable-avresample --cc=clang --host-cflags= --host-ldflags= --enable-opencl --enable-libx264 --enable-libmp3lame --enable-libxvid --enable-vda\nlibavutil      55. 17.103 / 55. 17.103\nlibavcodec     57. 24.102 / 57. 24.102\nlibavformat    57. 25.100 / 57. 25.100\nlibavdevice    57.  0.101 / 57.  0.101\nlibavfilter     6. 31.100 /  6. 31.100\nlibavresample   3.  0.  0 /  3.  0.  0\nlibswscale      4.  0.100 /  4.  0.100\nlibswresample   2.  0.101 /  2.  0.101\nlibpostproc    54.  0.100 / 54.  0.100\n</code></pre>\n"}], "owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 19754, "favorite_count": 10, "answer_count": 4, "score": 22, "last_activity_date": 1504088478, "creation_date": 1462640497, "question_id": 37091316, "link": "https://stackoverflow.com/questions/37091316/how-to-get-the-realtime-output-for-a-shell-command-in-golang", "title": "How to get the realtime output for a shell command in golang?", "body": "<p>I am trying to call shell command with os/exec in golang, that command will take some time, so I would like to retrieve the reatime output and print the processed output (a progressing ratio number).</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"os/exec\"\n    \"strings\"\n)\n\nfunc main() {\n    cmdName := \"ffmpeg -i t.webm  -acodec aac -vcodec libx264  cmd1.mp4\"\n    cmdArgs := strings.Fields(cmdName)\n\n    cmd := exec.Command(cmdArgs[0], cmdArgs[1:len(cmdArgs)]...)\n    stdout, _ := cmd.StdoutPipe()\n    cmd.Start()\n    go print(stdout)\n    cmd.Wait()\n}\n\n// to print the processed information when stdout gets a new line\nfunc print(stdout io.ReadCloser) {\n    r := bufio.NewReader(stdout)\n    line, _, err := r.ReadLine()\n    fmt.Println(\"line: %s err %s\", line, err)\n}\n</code></pre>\n\n<p>I want to have a function where can update the screen when the command print something, </p>\n\n<p>The ffmpeg command output is as follows:</p>\n\n<pre><code>frame=  101 fps=0.0 q=28.0 size=      91kB time=00:00:04.13 bitrate= 181.2kbits/\nframe=  169 fps=168 q=28.0 size=     227kB time=00:00:06.82 bitrate= 272.6kbits/\nframe=  231 fps=153 q=28.0 size=     348kB time=00:00:09.31 bitrate= 306.3kbits/\nframe=  282 fps=140 q=28.0 size=     499kB time=00:00:11.33 bitrate= 360.8kbits/\n</code></pre>\n\n<p>in fact, the above 4 line is the last line of ffmpeg command output which keeps changing, I want to print that change out, like </p>\n\n<pre><code>18%\n44%\n69%\n100%\n</code></pre>\n\n<p>how could I achieve this?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 0, "last_activity_date": 1462790494, "creation_date": 1462790494, "answer_id": 37113704, "question_id": 37091004, "link": "https://stackoverflow.com/questions/37091004/is-there-a-way-to-interactively-create-a-new-datastore-entity-kind-for-go-gae-ap/37113704#37113704", "title": "Is there a way to interactively create a new Datastore entity kind for Go GAE apps?", "body": "<p>First of all your code is safe at AppEngine - nobody can download it. At least nobody outside of Google. You can deploy it to a dedicated version/module and restrict usage to yourself (check current user, ask pass-phrase, etc in your code).</p>\n\n<p>Second you can <strong>use <a href=\"https://cloud.google.com/appengine/docs/go/tools/remoteapi\" rel=\"nofollow\">Remote API</a></strong> - this way you do not upload any code to AppEngine. You can create entities remotely as you wish using secure HTTPS connection.</p>\n"}, {"tags": [], "owner": {"reputation": 37598, "user_id": 153407, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/zoFYE.png?s=128&g=1", "display_name": "Dan McGrath", "link": "https://stackoverflow.com/users/153407/dan-mcgrath"}, "is_accepted": true, "score": 1, "last_activity_date": 1463153744, "creation_date": 1463153744, "answer_id": 37214050, "question_id": 37091004, "link": "https://stackoverflow.com/questions/37091004/is-there-a-way-to-interactively-create-a-new-datastore-entity-kind-for-go-gae-ap/37214050#37214050", "title": "Is there a way to interactively create a new Datastore entity kind for Go GAE apps?", "body": "<p>You absolutely can add new Entity Kinds in the Console.</p>\n\n<p>In the Cloud Console, Click on the Datastore menu item, then 'Create an Entity'. <a href=\"https://console.cloud.google.com/datastore/entities/new?project=_\" rel=\"nofollow noreferrer\">Handy link, just select your project name</a></p>\n\n<p>Then in the Kind field, just type in your desired Kind name.</p>\n\n<p><a href=\"https://i.stack.imgur.com/Oh4PF.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Oh4PF.png\" alt=\"Create an entity page showing a new kind name\"></a></p>\n"}], "owner": {"reputation": 48, "user_id": 6242353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3839a426531864d4be8cfa6af69577a7?s=128&d=identicon&r=PG&f=1", "display_name": "Clyde McQueen", "link": "https://stackoverflow.com/users/6242353/clyde-mcqueen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 37214050, "answer_count": 2, "score": 0, "last_activity_date": 1463153744, "creation_date": 1462638730, "last_edit_date": 1463153428, "question_id": 37091004, "link": "https://stackoverflow.com/questions/37091004/is-there-a-way-to-interactively-create-a-new-datastore-entity-kind-for-go-gae-ap", "title": "Is there a way to interactively create a new Datastore entity kind for Go GAE apps?", "body": "<p>Is there a way to create a new Datastore entity kind via some interactive means for Go App Engine apps? The datastore viewer won't let me add new entity kinds, and the interactive console doesn't seem to support Go.</p>\n\n<p>I'm trying to upload some configuration data to datastore, including sensitive data that I don't want to appear in code. So far the best method I can come up with is to write some code to write an empty configuration entity, deploy, run, then use the datastore viewer to set the values.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 3, "creation_date": 1462637950, "post_id": 37090751, "comment_id": 61725357, "body": "Your question depends on specific Go version as compiler may behave differently. 1.6.2 does nothing special - <code>copy</code> will be compiled into regular memory copy call. It will be the same even if you change the second line to <code>sliceB :=  make([]byte, 120)</code>"}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1462638028, "creation_date": 1462637318, "last_edit_date": 1462638028, "question_id": 37090751, "link": "https://stackoverflow.com/questions/37090751/does-go-copy-handle-no-op-copies-performantly", "title": "Does Go copy() handle no-op copies performantly?", "body": "<p>Does the following code copy 30 bytes, returning in O(n) in the general case - or \"realize\" it doesn't have to, and return in constant time?</p>\n\n<pre><code>sliceA := make([]byte, 120)\nsliceB := sliceA[0:30]\ncopy(sliceA, sliceB)\n</code></pre>\n\n<p>I'm using Go 1.6.</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 11, "user_id": 5942588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e52681477fb2d11b04438d1826018585?s=128&d=identicon&r=PG&f=1", "display_name": "golangnoob", "link": "https://stackoverflow.com/users/5942588/golangnoob"}, "edited": false, "score": 0, "creation_date": 1462629427, "post_id": 37089103, "comment_id": 61722674, "body": "{{ range $v := .Variables }} {{ index **$**.Information $v }} {{ end }} is what I had to do with the original code"}], "answers": [{"tags": [], "owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "is_accepted": false, "score": 2, "last_activity_date": 1462629176, "last_edit_date": 1462629176, "creation_date": 1462628875, "answer_id": 37089357, "question_id": 37089103, "link": "https://stackoverflow.com/questions/37089103/golang-ordering-map-by-slice-in-go-templates/37089357#37089357", "title": "Golang: Ordering map by slice in Go templates", "body": "<p>The following should work. To access <code>.Information</code> inside <code>range</code>, you should use <code>$</code>, which is basically <code>d</code> in your Playground example.</p>\n\n<pre><code>{{ range .Variables }} {{ index $.Information . }} {{ end }}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 5942588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e52681477fb2d11b04438d1826018585?s=128&d=identicon&r=PG&f=1", "display_name": "golangnoob", "link": "https://stackoverflow.com/users/5942588/golangnoob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 727, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1462629176, "creation_date": 1462627407, "question_id": 37089103, "link": "https://stackoverflow.com/questions/37089103/golang-ordering-map-by-slice-in-go-templates", "title": "Golang: Ordering map by slice in Go templates", "body": "<p>I have a question about how to order a map by a slice in Go Templates and if it is possible.</p>\n\n<p>Problem: I have a slice of ordered variable names that I want to display on a website, accompanying them I have a map of metadata of variable information that I would like to display together with the variable.</p>\n\n<p>If I have the following struct that I pass in to the template:</p>\n\n<pre><code>type Data struct {\n       Variables    []string\n       Information  map[string]int\n}\n</code></pre>\n\n<p>I would iterate over the slice and pass the variable name in to the map</p>\n\n<pre><code>{{ range $v := .Variables }} {{ index .Information $v }} {{ end }} // Doesn't work.\n</code></pre>\n\n<p>Here's a Go Playground with the example.\n<a href=\"https://play.golang.org/p/AL2csnXdoU\" rel=\"nofollow\">https://play.golang.org/p/AL2csnXdoU</a></p>\n\n<p><strong>Question: How can I do this?</strong></p>\n\n<p>I am fairly new to Golang. Thankful for any input.</p>\n"}, {"tags": ["memory", "go", "garbage-collection"], "comments": [{"owner": {"reputation": 11281, "user_id": 260805, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/34e031251528689dd8f8039fef24a65f?s=128&d=identicon&r=PG", "display_name": "Ztyx", "link": "https://stackoverflow.com/users/260805/ztyx"}, "reply_to_user": {"reputation": 7787, "user_id": 1257035, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WHLC8.png?s=128&g=1", "display_name": "a3f", "link": "https://stackoverflow.com/users/1257035/a3f"}, "edited": false, "score": 0, "creation_date": 1462601146, "post_id": 37085092, "comment_id": 61714633, "body": "You are right. Closing this."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1462621463, "post_id": 37085092, "comment_id": 61720141, "body": "it&#39;s not the garbage collectors job to release memory to the system. There is a separate heap scavenger which notifies the OS when blocks of memory are no longer needed."}], "owner": {"reputation": 11281, "user_id": 260805, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/34e031251528689dd8f8039fef24a65f?s=128&d=identicon&r=PG", "display_name": "Ztyx", "link": "https://stackoverflow.com/users/260805/ztyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "closed_date": 1462621226, "answer_count": 0, "score": 2, "last_activity_date": 1462604104, "creation_date": 1462600845, "last_edit_date": 1462604104, "question_id": 37085092, "link": "https://stackoverflow.com/questions/37085092/does-go-gc-hand-back-memory-to-os", "closed_reason": "Duplicate", "title": "Does Go GC hand back memory to OS?", "body": "<p>In many Java garbage collectors, free unused memory is never handed back to the operating system for other processes to use. </p>\n\n<p>Does the Go language GC occasionally and release memory to the OS?</p>\n"}, {"tags": ["pointers", "go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1462590916, "creation_date": 1462590916, "answer_id": 37084118, "question_id": 37083991, "link": "https://stackoverflow.com/questions/37083991/changing-struct-value/37084118#37084118", "title": "Changing struct value", "body": "<p>The line </p>\n\n<pre><code>usr := ug.users[i]\n</code></pre>\n\n<p>creates a copy of the user in the map. This copy is modified.  There are two ways to fix this. The first is store a pointer to a user in the map:</p>\n\n<pre><code>type userGroup struct {\n    users map[int]*user\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/EnE0tjMFhG\">playground example</a></p>\n\n<p>The second is to store the value back the map after modification:</p>\n\n<pre><code>    usr := ug.users[i]\n    fn(&amp;usr)\n    ug.users[i] = usr\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/9r33NS9NPF\">playground example</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1343639"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 1, "accepted_answer_id": 37084118, "answer_count": 1, "score": 2, "last_activity_date": 1462590916, "creation_date": 1462589454, "question_id": 37083991, "link": "https://stackoverflow.com/questions/37083991/changing-struct-value", "title": "Changing struct value", "body": "<p>Playing with golang and don't understand why can't I change user's email inside userGroup struct.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype user struct {\n    name, email string\n}\n\nfunc (u *user) changeEmail(newEmail string) {\n    u.email = newEmail\n}\n\ntype userGroup struct {\n    users map[int]user\n}\n\nfunc (ug *userGroup) mapOverUsers(fn func(u *user)) {\n    usersLen := len(ug.users)\n    for i := 0; i &lt; usersLen; i++ {\n        usr := ug.users[i]\n        fn(&amp;usr)\n    }\n}\n\nfunc main() {\n    ug := userGroup{\n        map[int]user{0: {\"0\", \"ZZZ\"}, 1: {\"1\", \"ZZZ\"}, 2: {\"2\", \"ZZZ\"}}}\n\n    fmt.Println(ug)\n\n    // should be same as (&amp;ug).mapOverUsers\n    ug.mapOverUsers(func(u *user) {\n        u.changeEmail(\"XXX\")\n        fmt.Println(u)\n    })\n\n    fmt.Println(ug)\n}\n</code></pre>\n\n<p>I checked, and I believe I reference same addresses in memory for <code>ug</code> (userGroup) and <code>u</code> (user).  Maybe it's not right approach, just reading a book on go and trying simple thing as I go. Thank you.</p>\n"}, {"tags": ["sockets", "redirect", "go", "stdin", "named-pipes"], "comments": [{"owner": {"reputation": 2269, "user_id": 3016716, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wCaTR.jpg?s=128&g=1", "display_name": "shivams", "link": "https://stackoverflow.com/users/3016716/shivams"}, "edited": false, "score": 4, "creation_date": 1462607682, "post_id": 37083236, "comment_id": 61716284, "body": "Where is the code written by you? Have you tried anything yet."}, {"owner": {"reputation": 41, "user_id": 527576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b42fce16bcaffb5201753db4cf9b8ea?s=128&d=identicon&r=PG", "display_name": "Harish", "link": "https://stackoverflow.com/users/527576/harish"}, "reply_to_user": {"reputation": 2269, "user_id": 3016716, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/wCaTR.jpg?s=128&g=1", "display_name": "shivams", "link": "https://stackoverflow.com/users/3016716/shivams"}, "edited": false, "score": 0, "creation_date": 1463085267, "post_id": 37083236, "comment_id": 61926238, "body": "I have added something to open a pipe and set the fd of the pipe to terminal.MakeRaw() but looks like we cant do something like that with sockets."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 527576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b42fce16bcaffb5201753db4cf9b8ea?s=128&d=identicon&r=PG", "display_name": "Harish", "link": "https://stackoverflow.com/users/527576/harish"}, "edited": false, "score": 0, "creation_date": 1463435172, "post_id": 37106850, "comment_id": 62054269, "body": "By creating a socket do you mean net.Dial() ?   I need to attach the current terminal to the unix socket. - The other end of the socket is running agetty. Should I have to use the termios structure accomplish this?"}, {"owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "reply_to_user": {"reputation": 41, "user_id": 527576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b42fce16bcaffb5201753db4cf9b8ea?s=128&d=identicon&r=PG", "display_name": "Harish", "link": "https://stackoverflow.com/users/527576/harish"}, "edited": false, "score": 0, "creation_date": 1463810015, "post_id": 37106850, "comment_id": 62233193, "body": "@Harish <code>net.Dial</code> can open unix sockets: <code>net.Dial(&quot;unix&quot;, &quot;&#47;path&#47;to&#47;unix.sock&quot;)</code>"}], "tags": [], "owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "is_accepted": false, "score": 3, "last_activity_date": 1462863245, "last_edit_date": 1462863245, "creation_date": 1462759381, "answer_id": 37106850, "question_id": 37083236, "link": "https://stackoverflow.com/questions/37083236/golang-attach-a-socket-to-stdin-stdout/37106850#37106850", "title": "golang attach a socket to Stdin/Stdout", "body": "<p>Well the socket types in Go implement the <code>io.Writer</code> interface, and <code>os.Stdin</code> implements the <code>io.Reader</code>, so my first guess would be to try out <code>bufio.Writer</code>. It would probably look something like:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"os\"\n)\n\nfunc main() {\n    socket := getSocket() // left as an exercise for you to implement\n    writer := bufio.NewWriter(socket)\n    writer.ReadFrom(os.Stdin)\n    // do something to determine when to stop\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 527576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b42fce16bcaffb5201753db4cf9b8ea?s=128&d=identicon&r=PG", "display_name": "Harish", "link": "https://stackoverflow.com/users/527576/harish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1327, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1462863245, "creation_date": 1462580841, "question_id": 37083236, "link": "https://stackoverflow.com/questions/37083236/golang-attach-a-socket-to-stdin-stdout", "title": "golang attach a socket to Stdin/Stdout", "body": "<p>What is the best way to attach a socket to Stdin/Stdout. I know we can redirect the stdin/Stdout to any any file descriptor but how can we do the same with sockets. (like how socat works) ? </p>\n"}, {"tags": ["ubuntu", "go", "environment-variables"], "answers": [{"tags": [], "owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "is_accepted": true, "score": 2, "last_activity_date": 1462581231, "creation_date": 1462581231, "answer_id": 37083273, "question_id": 37083167, "link": "https://stackoverflow.com/questions/37083167/setting-gopath-on-ubuntu-still-getting-error/37083273#37083273", "title": "Setting GOPATH on Ubuntu - still getting error", "body": "<p>Okay guys, I figured out the problem. </p>\n\n<p><a href=\"https://github.com/joefitzgerald/go-plus/issues/386\" rel=\"nofollow\">https://github.com/joefitzgerald/go-plus/issues/386</a> </p>\n\n<p>here it has been discussed. I will just copy it from that </p>\n\n<p>Linux folks, particularly those running Ubuntu. I believe I have reproduced your issues and I think they have to do with where you are setting your <code>GOPATH</code> and <code>PATH</code>.</p>\n\n<ul>\n<li><p><code>~/.profile</code>: If you set them here, <code>$GOPATH</code> will be set in Atom when you launch Atom for the first time from the launcher in the toolbar</p></li>\n<li><p><code>~/.bashrc</code> If you set them here, <code>$GOPATH</code> will be set in Atom when you launch Atom for the first time from the terminal\nThus, to ensure <code>GOPATH</code> and <code>PATH</code> are set correctly regardless of how you launch Atom, you should put the following (or similar) in both <code>~/.profile</code> and <code>~/.bashrc</code>:</p></li>\n</ul>\n\n<blockquote>\n<pre><code>export GOPATH=$HOME/work\n\nexport PATH=$GOPATH/bin:/usr/local/go/bin:$PATH\n</code></pre>\n</blockquote>\n\n<p>Obviously the above doesn't apply exactly if bash isn't your default shell, but I trust that if you're a user of a different shell, you can grok what I am saying above and apply the same principles to your particular environment.</p>\n"}, {"tags": [], "owner": {"reputation": 795, "user_id": 3479043, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xGd30.png?s=128&g=1", "display_name": "xh3b4sd", "link": "https://stackoverflow.com/users/3479043/xh3b4sd"}, "is_accepted": false, "score": -1, "last_activity_date": 1476836761, "creation_date": 1476836761, "answer_id": 40120128, "question_id": 37083167, "link": "https://stackoverflow.com/questions/37083167/setting-gopath-on-ubuntu-still-getting-error/40120128#40120128", "title": "Setting GOPATH on Ubuntu - still getting error", "body": "<p>I had the same issue on OSX. Weird in my case was that <code>process.env</code> showed I am using normal bash. This was strange, because I am using zsh. The environment variables overall were wrong and did not match the environment in my terminal at all. </p>\n\n<p><a href=\"https://i.stack.imgur.com/2vvN4.png\" rel=\"nofollow\"><img src=\"https://i.stack.imgur.com/2vvN4.png\" alt=\"enter image description here\"></a></p>\n\n<p>Turned out I needed to set zsh as default shell. This added zsh to the list of known shells and made it the default for my user. Note that <code>xh3b4sd</code> is my username.</p>\n\n<pre><code>command -v zsh | sudo tee -a /etc/shells\nchsh -s $(which zsh) xh3b4sd\n</code></pre>\n\n<p>After restarting my mac the environment in the output of <code>process.env</code> was correct and <code>go-plus</code> worked as expected.</p>\n\n<p><a href=\"https://i.stack.imgur.com/7r1w9.png\" rel=\"nofollow\"><img src=\"https://i.stack.imgur.com/7r1w9.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3809, "favorite_count": 0, "accepted_answer_id": 37083273, "answer_count": 2, "score": 2, "last_activity_date": 1561473604, "creation_date": 1462580341, "question_id": 37083167, "link": "https://stackoverflow.com/questions/37083167/setting-gopath-on-ubuntu-still-getting-error", "title": "Setting GOPATH on Ubuntu - still getting error", "body": "<p>I have set following path on my <code>~/.bashrc</code> file</p>\n\n<pre><code>export GOPATH=/usr/lib/go\nexport PATH=$PATH:$GOROOT/bin:$GOPATH/bin\n</code></pre>\n\n<p>But when i installed ATOM IDE and i tried to install <code>go-plus</code> package, it tired to download something at the end and i got the error that </p>\n\n<pre><code>package github.com/nsf/gocode: cannot download, $GOPATH not set. For more details see: go help gopath\n</code></pre>\n\n<p>What I am doing wrong ? Here is my ubunt information as well. </p>\n\n<pre><code>Distributor ID: Ubuntu\nDescription:    Ubuntu 15.10\nRelease:    15.10\nCodename:   wily\n</code></pre>\n\n<p><strong>P.S</strong></p>\n\n<p>I have already tried setting my </p>\n\n<pre><code>export GOPATH=/home/&lt;username/go\nexport PATH=$PATH:$GOPATH/bin\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 10595, "user_id": 325320, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/23bc4a16f6a4bac91accd76c8078cd35?s=128&d=identicon&r=PG", "display_name": "Mr.Wang from Next Door", "link": "https://stackoverflow.com/users/325320/mr-wang-from-next-door"}, "is_accepted": true, "score": 1, "last_activity_date": 1462582123, "creation_date": 1462582123, "answer_id": 37083350, "question_id": 37083025, "link": "https://stackoverflow.com/questions/37083025/set-cookie-in-websocket-handshake/37083350#37083350", "title": "Set-Cookie in websocket handshake", "body": "<pre><code>cookie := http.Cookie{Name: \"_c_id_\", Value: \"abcd\", Path: \"/\", HttpOnly: true, Secure: false}\n\nserver := websocket.Server{Handler: websocket.Handler(EchoServer)}\nserver.Config.Header = make(map[string][]string)\nserver.Config.Header.Set(\"Set-Cookie\", cookie.String())\nserver.ServeHTTP(writer, req)\n</code></pre>\n"}], "owner": {"reputation": 10595, "user_id": 325320, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/23bc4a16f6a4bac91accd76c8078cd35?s=128&d=identicon&r=PG", "display_name": "Mr.Wang from Next Door", "link": "https://stackoverflow.com/users/325320/mr-wang-from-next-door"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2233, "favorite_count": 0, "accepted_answer_id": 37083350, "answer_count": 1, "score": 1, "last_activity_date": 1462582123, "creation_date": 1462579222, "question_id": 37083025, "link": "https://stackoverflow.com/questions/37083025/set-cookie-in-websocket-handshake", "title": "Set-Cookie in websocket handshake", "body": "<p>During websocket handshake, how can I add <code>Set-Cookie</code> in the <code>Upgrade</code> response?</p>\n\n<p>I tried the following code</p>\n\n<pre><code>import (\n    //\"encoding/json\"\n    \"golang.org/x/net/websocket\"\n    //\"io\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n\n    http.HandleFunc(\"/v2\", onV2Handshake)\n\n    //  Ports below 1024 can be opened only by root.\n    err := http.ListenAndServe(\":8080\", nil)\n    // err := http.ListenAndServeTLS(\":443\", \"cert.pem\", \"key.pem\", nil)\n    if err != nil {\n        log.Panicln(err)\n    }\n}\n\nfunc EchoServer(ws *websocket.Conn) {\n    //io.Copy(ws, ws)\n}\n\nfunc onV2Handshake(writer http.ResponseWriter, req *http.Request) {\n    cookie := http.Cookie{Name: \"_c_id_\", Value: \"abcd\", Path: \"/\", HttpOnly: true, Secure: false}\n    http.SetCookie(writer, &amp;cookie)\n\n    server := websocket.Server{Handler: websocket.Handler(EchoServer)}\n    server.ServeHTTP(writer, req)\n}\n</code></pre>\n\n<p><strong>The handshake is done successfully but there is no <code>Set-Cookie</code> HTTP header in response.</strong> </p>\n\n<pre><code>Connection:Upgrade\nSec-WebSocket-Accept:wWtU5pygFsiY0aTzMRzJEQcgnZc=\nSec-WebSocket-Protocol:wamp.2.json\nUpgrade:websocket\n</code></pre>\n\n<p>According to <a href=\"https://tools.ietf.org/html/rfc6455\" rel=\"nofollow\">RFC6455</a>, this should work</p>\n\n<blockquote>\n  <p>Additional header fields may also be present, such as cookies</p>\n</blockquote>\n\n<p>I don't have this problem in NodeJS. </p>\n"}, {"tags": ["linux", "go", "fork", "exec"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1462800866, "post_id": 37082388, "comment_id": 61775396, "body": "Why do you think <code>exec.Cmd</code> is too high level? You have access to SysProcAttr from there too. Also, what do you mean by your process still owns the child? Is it in the same process group? Does it not get reassigned to PID 1 if the parent exits?"}], "answers": [{"comments": [{"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 2, "creation_date": 1463505096, "post_id": 37082839, "comment_id": 62090102, "body": "Note that if the command uses the stdin/stdout from the parent, if the parent terminates, the process might become a zombie."}, {"owner": {"reputation": 366, "user_id": 8215209, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mUcp9x419TE/AAAAAAAAAAI/AAAAAAAAAAA/x_oltuemiFo/photo.jpg?sz=128", "display_name": "achilles", "link": "https://stackoverflow.com/users/8215209/achilles"}, "reply_to_user": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1542005301, "post_id": 37082839, "comment_id": 93398701, "body": "@Anfernee I am executing a bash script from a Go program which inturn kills the parent go process at one stage . I had provided &quot;stderr, _ := cmd.StderrPipe()&quot; before cmd.Start() and noticed that the child process running the script would also die after parent go process was killed . Once I removed the stderr line and executed the program , the child would continue its execution properly . Forgive me if I did not understand you but is this what you mentioned in the above comment . ?"}], "tags": [], "owner": {"reputation": 464, "user_id": 1645219, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gnqzr.png?s=128&g=1", "display_name": "Jony T", "link": "https://stackoverflow.com/users/1645219/jony-t"}, "is_accepted": false, "score": 2, "last_activity_date": 1462577678, "creation_date": 1462577678, "answer_id": 37082839, "question_id": 37082388, "link": "https://stackoverflow.com/questions/37082388/golang-exec-process-and-to-disown-it/37082839#37082839", "title": "Golang exec process and to disown it", "body": "<p>The <a href=\"https://golang.org/pkg/os/exec/#Cmd.Start\" rel=\"nofollow\">Start() method</a> should give you what you're looking for. My script to append a simple text file after my sample Go program terminated continued to run:</p>\n\n<pre><code>package main\n\nimport (\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"./appender.sh\")\n    cmd.Start()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1436, "user_id": 383214, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/306b63b79c78a1b67e1789790ad2db86?s=128&d=identicon&r=PG", "display_name": "sheerun", "link": "https://stackoverflow.com/users/383214/sheerun"}, "edited": false, "score": 0, "creation_date": 1508165490, "post_id": 46755495, "comment_id": 80491932, "body": "The goal is to make 71432 equal 1 in the example above (immediately)."}, {"owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "reply_to_user": {"reputation": 1436, "user_id": 383214, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/306b63b79c78a1b67e1789790ad2db86?s=128&d=identicon&r=PG", "display_name": "sheerun", "link": "https://stackoverflow.com/users/383214/sheerun"}, "edited": false, "score": 0, "creation_date": 1508165781, "post_id": 46755495, "comment_id": 80492145, "body": "The question is phrased: &quot;[...] in case of my daemon crashes [sic]&quot;. It&#39;s not necessary to forcily orphan the process immediately. With <code>Start()</code> it will be orphaned only when and if the parent dies."}], "tags": [], "owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "is_accepted": true, "score": 13, "last_activity_date": 1508073848, "creation_date": 1508073848, "answer_id": 46755495, "question_id": 37082388, "link": "https://stackoverflow.com/questions/37082388/golang-exec-process-and-to-disown-it/46755495#46755495", "title": "Golang exec process and to disown it", "body": "<p>A process forked with <code>Start()</code> will continue even after its parent dies.</p>\n\n<pre><code>func forker() {\n    cmd := exec.Command(\"sleep\", \"3\")\n    cmd.Start()\n    time.Sleep(2 * time.Second)\n    os.Exit(1)\n}\n</code></pre>\n\n<p>Here the <code>sleep</code> process will happily live on for 3 seconds even if the parent process only lives for 2 seconds:</p>\n\n<pre><code>  $ forker &amp;; while true; do ps -f; sleep 1; done\n\n  UID   PID  PPID   C STIME   TTY           TIME CMD\n  501 71423 69892   0  3:01PM ttys003    0:00.07 forker\n  501 71433 71432   0  3:01PM ttys003    0:00.00 sleep 3\n\n  UID   PID  PPID   C STIME   TTY           TIME CMD\n  501 71423 69892   0  3:01PM ttys003    0:00.07 forker\n  501 71433 71432   0  3:01PM ttys003    0:00.00 sleep 3\n\n  UID   PID  PPID   C STIME   TTY           TIME CMD\n  501 71433     1   0  3:01PM ttys003    0:00.00 sleep 3\n</code></pre>\n\n<p>Notice how the parent process ID (<code>PPID</code>) of the <code>sleep</code> process became <code>1</code> when the parent process <code>71432</code> exited. This means that the <code>sleep</code> process has been orphaned.</p>\n"}, {"tags": [], "owner": {"reputation": 1436, "user_id": 383214, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/306b63b79c78a1b67e1789790ad2db86?s=128&d=identicon&r=PG", "display_name": "sheerun", "link": "https://stackoverflow.com/users/383214/sheerun"}, "is_accepted": false, "score": 2, "last_activity_date": 1508273586, "creation_date": 1508273586, "answer_id": 46799048, "question_id": 37082388, "link": "https://stackoverflow.com/questions/37082388/golang-exec-process-and-to-disown-it/46799048#46799048", "title": "Golang exec process and to disown it", "body": "<p>It seems good strategy for immediately disowning is spawning <code>os.Argv[0]</code> process (self-spawn), then spawning target process (with Setsid: true), and then exiting first spawned process. This way gradchild process immediately gets ppid 1. Optionally first spawned process can communicate pid of granchild via stdout to parent before it exits.</p>\n"}, {"tags": [], "owner": {"reputation": 609, "user_id": 550866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba271a060d9d82ac8783cd9165f83d2a?s=128&d=identicon&r=PG", "display_name": "Henry Finucane", "link": "https://stackoverflow.com/users/550866/henry-finucane"}, "is_accepted": false, "score": 2, "last_activity_date": 1508613951, "creation_date": 1508613951, "answer_id": 46867169, "question_id": 37082388, "link": "https://stackoverflow.com/questions/37082388/golang-exec-process-and-to-disown-it/46867169#46867169", "title": "Golang exec process and to disown it", "body": "<p>Daemonization doesn't play well with go's goroutine scheduling, so the details get pretty gnarly. <a href=\"https://github.com/VividCortex/godaemon\" rel=\"nofollow noreferrer\">godaemon</a> has a small implementation with good discussion and links to more good discussion, and there's also the more popular and more traditionally implemented <a href=\"https://github.com/sevlyar/go-daemon\" rel=\"nofollow noreferrer\">go-daemon</a>.</p>\n\n<p>The <code>ioctl</code> errors you are getting almost certainly come from the use of <a href=\"https://github.com/golang/go/issues/2647\" rel=\"nofollow noreferrer\"><code>Setctty</code></a>.</p>\n\n<p><code>\n        Sys: &amp;syscall.SysProcAttr{\n            Foreground: false,\n            Setsid:     true,\n        },\n</code></p>\n\n<p>should get you semantics like <code>os/exec</code>'s <code>Start</code>, where the child process is not immediately reparented, but will safely be hoisted if/when the parent dies.</p>\n\n<p>The <code>operation not permitted</code> you're seeing is, I think, about the pipes in <code>/tmp/</code>, from running under strace:\n<code>\nopenat(AT_FDCWD, \"/tmp/stdin\", O_RDWR|O_CREAT|O_TRUNC|O_CLOEXEC, 0666) = 3\nepoll_create1(EPOLL_CLOEXEC)            = 4\nepoll_ctl(4, EPOLL_CTL_ADD, 3, {EPOLLIN|EPOLLOUT|EPOLLRDHUP|EPOLLET, {u32=471047936, u64=140179613654784}}) = -1 EPERM (Operation not permitted)\nepoll_ctl(4, EPOLL_CTL_DEL, 3, 0xc420039c24) = -1 EPERM (Operation not permitted)\nopenat(AT_FDCWD, \"/tmp/stdout\", O_RDWR|O_CREAT|O_TRUNC|O_CLOEXEC, 0666) = 5\nepoll_ctl(4, EPOLL_CTL_ADD, 5, {EPOLLIN|EPOLLOUT|EPOLLRDHUP|EPOLLET, {u32=471047936, u64=140179613654784}}) = -1 EPERM (Operation not permitted)\nepoll_ctl(4, EPOLL_CTL_DEL, 5, 0xc420039c24) = -1 EPERM (Operation not permitted)\nopenat(AT_FDCWD, \"/tmp/stderr\", O_RDWR|O_CREAT|O_TRUNC|O_CLOEXEC, 0666) = 6\nepoll_ctl(4, EPOLL_CTL_ADD, 6, {EPOLLIN|EPOLLOUT|EPOLLRDHUP|EPOLLET, {u32=471047936, u64=140179613654784}}) = -1 EPERM (Operation not permitted)\nepoll_ctl(4, EPOLL_CTL_DEL, 6, 0xc420039c24) = -1 EPERM (Operation not permitted)\n</code></p>\n"}], "owner": {"reputation": 9005, "user_id": 337504, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/f365e5b3587387ed67c9c747288874e2?s=128&d=identicon&r=PG", "display_name": "Mustafa", "link": "https://stackoverflow.com/users/337504/mustafa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9860, "favorite_count": 2, "accepted_answer_id": 46755495, "answer_count": 4, "score": 14, "last_activity_date": 1508613951, "creation_date": 1462574179, "last_edit_date": 1462574526, "question_id": 37082388, "link": "https://stackoverflow.com/questions/37082388/golang-exec-process-and-to-disown-it", "title": "Golang exec process and to disown it", "body": "<p>I am trying to fork processes with my daemon, and trying to disown them in case of my daemon crashes. Regular <code>os/exec</code> is high-level, therefore I went for <code>syscall.ForkExec</code> and produced the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n    \"syscall\"\n    \"time\"\n)\n\nfunc main() {\n\n    cmd := \"myproc\"\n    binary, lookErr := exec.LookPath(cmd)\n    if lookErr != nil {\n        panic(lookErr)\n    }\n    fmt.Println(binary)\n\n    os.Remove(\"/tmp/stdin\")\n    os.Remove(\"/tmp/stdout\")\n    os.Remove(\"/tmp/stderr\")\n\n    fstdin, err1 := os.Create(\"/tmp/stdin\")\n    fstdout, err2 := os.Create(\"/tmp/stdout\")\n    fstderr, err3 := os.Create(\"/tmp/stderr\")\n    if err1 != nil || err2 != nil || err3 != nil {\n        fmt.Println(err1, err2, err3)\n        panic(\"WOW\")\n    }\n\n    argv := []string{\"hi\"}\n    procAttr := syscall.ProcAttr{\n        Dir:   \"/tmp\",\n        Files: []uintptr{fstdin.Fd(), fstdout.Fd(), fstderr.Fd()},\n        Env:   []string{\"VAR1=ABC123\"},\n        Sys: &amp;syscall.SysProcAttr{\n            Foreground: false,\n        },\n    }\n\n    pid, err := syscall.ForkExec(binary, argv, &amp;procAttr)\n    fmt.Println(\"Spawned proc\", pid, err)\n\n    time.Sleep(time.Second * 100)\n}\n</code></pre>\n\n<p>I have also made a simple application that sleeps and prints hello world and put it to path.</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(){\n    while(1){\n        printf(\"hello world\");\n        fflush(stdout);\n        usleep(300000);\n        }\n}\n</code></pre>\n\n<p>It works, however, the process is not send to background as I expected, my go process still owns the child. The <code>SysProcAttr</code> has the following values in Linux:</p>\n\n<pre><code>type SysProcAttr struct {\n    Chroot      string         // Chroot.\n    Credential  *Credential    // Credential.\n    Ptrace      bool           // Enable tracing.\n    Setsid      bool           // Create session.\n    Setpgid     bool           // Set process group ID to Pgid, or, if Pgid == 0, to new pid.\n    Setctty     bool           // Set controlling terminal to fd Ctty (only meaningful if Setsid is set)\n    Noctty      bool           // Detach fd 0 from controlling terminal\n    Ctty        int            // Controlling TTY fd\n    Foreground  bool           // Place child's process group in foreground. (Implies Setpgid. Uses Ctty as fd of controlling TTY)\n    Pgid        int            // Child's process group ID if Setpgid.\n    Pdeathsig   Signal         // Signal that the process will get when its parent dies (Linux only)\n    Cloneflags  uintptr        // Flags for clone calls (Linux only)\n    UidMappings []SysProcIDMap // User ID mappings for user namespaces.\n    GidMappings []SysProcIDMap // Group ID mappings for user namespaces.\n    // GidMappingsEnableSetgroups enabling setgroups syscall.\n    // If false, then setgroups syscall will be disabled for the child process.\n    // This parameter is no-op if GidMappings == nil. Otherwise for unprivileged\n    // users this should be set to false for mappings work.\n    GidMappingsEnableSetgroups bool\n}\n</code></pre>\n\n<p>I also tried the following but It caused an error:</p>\n\n<pre><code>Sys: &amp;syscall.SysProcAttr{\n    Setsid:     true,\n    Setctty:    true,\n    Foreground: false,\n },\n\nSpawned proc 0 inappropriate ioctl for device\n</code></pre>\n\n<p>Also the following:</p>\n\n<pre><code>Sys: &amp;syscall.SysProcAttr{\n    Setsid:     true,\n    Setctty:    true,\n    Foreground: false,\n    Noctty:     true,\n    Setpgid:    true,\n},\n\nSpawned proc 0 operation not permitted (with root privilleges)\n</code></pre>\n\n<p>What am I doing/assuming wrong?\n<strong>Note:</strong> Despite saying os/exec is high-level, I also tried the following, but it produced same results.</p>\n\n<pre><code>cs := exec.Command(binary)\ncs.SysProcAttr = &amp;syscall.SysProcAttr{\n    Setctty: true,\n}\nerr := cs.Run()\nfmt.Println(err)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1462572214, "post_id": 37079820, "comment_id": 61708854, "body": "Related questions: 1. <a href=\"http://stackoverflow.com/questions/31377433/getting-method-parameter-names-in-golang\">Getting method parameter names in Golang</a>; 2. <a href=\"http://stackoverflow.com/questions/22549228/why-does-go-allow-compilation-of-unused-function-parameters\">Why does Go allow compilation of unused function parameters?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 6, "last_activity_date": 1462562793, "creation_date": 1462562793, "answer_id": 37080025, "question_id": 37079820, "link": "https://stackoverflow.com/questions/37079820/meaning-of-underscore-in-a-go-function-parameter/37080025#37080025", "title": "Meaning of underscore in a Go function parameter", "body": "<p>_ is the <a href=\"https://golang.org/ref/spec#Blank_identifier\">blank identifier</a>.  It's in the signature to show that the value doesn't get used, so the signature will still match the methods of the interface.</p>\n"}, {"tags": [], "owner": {"reputation": 473, "user_id": 5176181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250389f0eeacc9c97cd514c118c102d6?s=128&d=identicon&r=PG&f=1", "display_name": "Gary Sham", "link": "https://stackoverflow.com/users/5176181/gary-sham"}, "is_accepted": true, "score": 14, "last_activity_date": 1462563134, "creation_date": 1462563134, "answer_id": 37080109, "question_id": 37079820, "link": "https://stackoverflow.com/questions/37079820/meaning-of-underscore-in-a-go-function-parameter/37080109#37080109", "title": "Meaning of underscore in a Go function parameter", "body": "<p>It means \"ignore that parameter\", the reason that they still need the last parameter here is because they want to pass it as <code>type Handle</code> to the function <code>GET</code>, which has the signature:</p>\n\n<p><code>type Handle func(http.ResponseWriter, *http.Request, Params)</code></p>\n\n<p>If you simply pass something like <code>func Index(w http.ResponseWriter, r *http.Request)</code> it will not be treated as <code>type Handle</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 1, "creation_date": 1462566846, "post_id": 37080960, "comment_id": 61706687, "body": "The OP&#39;s question is about function parameter. I don&#39;t think you are answering the question."}], "tags": [], "owner": {"reputation": 2447, "user_id": 419074, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4eb9847296c397d04aa464eb17ca2c16?s=128&d=identicon&r=PG&f=1", "display_name": "0x0", "link": "https://stackoverflow.com/users/419074/0x0"}, "is_accepted": false, "score": 0, "last_activity_date": 1462566873, "last_edit_date": 1462566873, "creation_date": 1462566718, "answer_id": 37080960, "question_id": 37079820, "link": "https://stackoverflow.com/questions/37079820/meaning-of-underscore-in-a-go-function-parameter/37080960#37080960", "title": "Meaning of underscore in a Go function parameter", "body": "<p>As others pointed out, it is a <a href=\"https://golang.org/doc/effective_go.html#blank\" rel=\"nofollow\">blank identifier</a>. For instance, consider the following example:</p>\n\n<pre><code>func main() {\n     nums := []int{5, 3, 4}\n     max := nums[0]\n     for _, num := range nums {\n         if num &gt; max {\n            max = num\n        }\n    }\n    fmt.Println(\"max:\", max)\n}\n</code></pre>\n\n<p>If you aren't going to use an index value, you can just ignore storing it by using <code>_</code> instead of a variable name.=.</p>\n"}, {"tags": [], "owner": {"reputation": 81, "user_id": 3720066, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/100002655830068/picture?type=large", "display_name": "Ross Albertson", "link": "https://stackoverflow.com/users/3720066/ross-albertson"}, "is_accepted": false, "score": 1, "last_activity_date": 1508447640, "creation_date": 1508447640, "answer_id": 46838996, "question_id": 37079820, "link": "https://stackoverflow.com/questions/37079820/meaning-of-underscore-in-a-go-function-parameter/46838996#46838996", "title": "Meaning of underscore in a Go function parameter", "body": "<p>Using \"_\" in place of a parameter name fulfills the obligations of a higher-level \"function as a parameter\" without getting a warning about an unused parameter. In your case, I believe the compiler is told to ignore all incoming \"POST\" data, thus in effect reducing the request to the functionality of a \"GET\". </p>\n"}], "owner": {"reputation": 555, "user_id": 3557072, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/GwsnH.jpg?s=128&g=1", "display_name": "Camilo Crespo", "link": "https://stackoverflow.com/users/3557072/camilo-crespo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3522, "favorite_count": 2, "accepted_answer_id": 37080109, "answer_count": 4, "score": 11, "last_activity_date": 1508447640, "creation_date": 1462561926, "question_id": 37079820, "link": "https://stackoverflow.com/questions/37079820/meaning-of-underscore-in-a-go-function-parameter", "title": "Meaning of underscore in a Go function parameter", "body": "<p>Came accross the below function <a href=\"https://godoc.org/github.com/julienschmidt/httprouter\">here</a>. I noticed the last parameter is identified with <code>_</code>. What is the intent of this pattern?</p>\n\n<pre><code>func Index(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n    fmt.Fprint(w, \"Welcome!\\n\")\n}\n</code></pre>\n"}, {"tags": ["go", "buffer"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1462563015, "post_id": 37079639, "comment_id": 61704846, "body": "What do you mean by best?  It either scans until EOF or you break whenever you want."}], "answers": [{"comments": [{"owner": {"reputation": 183, "user_id": 1883374, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ZpKR.jpg?s=128&g=1", "display_name": "Mehrdad", "link": "https://stackoverflow.com/users/1883374/mehrdad"}, "edited": false, "score": 0, "creation_date": 1462573159, "post_id": 37080084, "comment_id": 61709145, "body": "It scans remote host stdout and once it exited the loop I&#39;m seeing the below at heap :  1: 4096 [4: 16384] @ 0x456015 0x59f097 0x565791 0x4735f1 #\t0x59f097\tbufio.(*Scanner).Scan+0x147\t/usr/local/go/src/buf&zwnj;&#8203;io/scan.go:197"}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 1, "last_activity_date": 1462563019, "creation_date": 1462563019, "answer_id": 37080084, "question_id": 37079639, "link": "https://stackoverflow.com/questions/37079639/how-we-can-stop-bufio-scanning-at-golang/37080084#37080084", "title": "How we can stop bufio scanning at golang?", "body": "<p><a href=\"https://golang.org/pkg/bufio/#Scanner.Scan\" rel=\"nofollow\">Scanner.Scan()</a> will returns a bool. You don't need to do anything else, since the for loop will exit when it evaluates to <code>false</code> at the end of what it is scanning.</p>\n"}, {"tags": [], "owner": {"reputation": 57, "user_id": 5830392, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001250637236/picture?type=large", "display_name": "Gandharva S Murthy", "link": "https://stackoverflow.com/users/5830392/gandharva-s-murthy"}, "is_accepted": false, "score": 1, "last_activity_date": 1610420187, "creation_date": 1610420187, "answer_id": 65677422, "question_id": 37079639, "link": "https://stackoverflow.com/questions/37079639/how-we-can-stop-bufio-scanning-at-golang/65677422#65677422", "title": "How we can stop bufio scanning at golang?", "body": "<p>If you are stuck in continuous loop and hitting <code>ENTER</code> wont help in exiting the loop of <code>scanner.Scan()</code>, then try <code>ctrl+Z</code> to exit loop.</p>\n<p>Below is an example code for taking input from console and printing the duplicate lines.</p>\n<pre><code>func main() {\n    counts := make(map[string]int)\n    scanner := bufio.NewScanner(os.Stdin)\n    fmt.Println(&quot;Accepting inputs&quot;)\n    for scanner.Scan() {\n        counts[input.Text()]++\n    }\n    // NOTE: ignoring potential errors from input.Err()\n    fmt.Println(&quot;Printing output&quot;)\n    for line, n := range counts {\n        if n &gt; 1 {\n            fmt.Printf(&quot;Count: %d\\t Line: %s\\n&quot;, n, line)\n        }\n    }\n}\n</code></pre>\n<p>Console Output:</p>\n<pre><code>Accepting inputs\nHi\nhello\nhi\nHi\n\n^Z\nPrinting output\nCount: 2         Line: Hi\n</code></pre>\n<p>We can see that just after pressing <code>ctrl+Z</code> the scanner.Scan() exited the loop.</p>\n"}, {"tags": [], "owner": {"reputation": 452, "user_id": 5141875, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xJ1vr6IsVfo/AAAAAAAAAAI/AAAAAAAAACM/3h4GSMEpdlc/photo.jpg?sz=128", "display_name": "Tyler Kropp", "link": "https://stackoverflow.com/users/5141875/tyler-kropp"}, "is_accepted": false, "score": 1, "last_activity_date": 1610423543, "creation_date": 1610423543, "answer_id": 65677803, "question_id": 37079639, "link": "https://stackoverflow.com/questions/37079639/how-we-can-stop-bufio-scanning-at-golang/65677803#65677803", "title": "How we can stop bufio scanning at golang?", "body": "<p>The documentation states:</p>\n<blockquote>\n<p>It returns false when the scan stops, either by reaching the end of the input or an error. After Scan returns false, the Err method will return any error that occurred during scanning, except that if it was io.EOF, Err will return nil.</p>\n</blockquote>\n<p>Therefore, to stop scanning, you can break out of the loop manually after reading a line of text or you can wait until <code>false</code> is returned. If you need different functionality, you may want to use the <code>io.Reader</code> directly. The documentation for <code>io.Reader</code> states:</p>\n<blockquote>\n<p>If some data is available but not len(p) bytes, Read conventionally returns what is available instead of waiting for more.</p>\n</blockquote>\n<p>Thus, the <code>Read</code> method will immediately return rather than blocking like <code>bufio.Scanner</code> would.</p>\n<p>If you <em>do</em> want to use <code>bufio.Scanner</code> and want to stop it from reading, you must send an EOF through the <code>io.Reader</code> that was passed in. An example of this is shown below:</p>\n<p><a href=\"https://play.golang.org/p/ZF8bHX25KFq\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ZF8bHX25KFq</a></p>\n<pre><code>package main\n\nimport (\n    &quot;bufio&quot;\n    &quot;fmt&quot;\n    &quot;os&quot;\n    &quot;time&quot;\n)\n\nfunc main() {\n    r, w, err := os.Pipe()\n    if err != nil {\n        panic(err)\n    }\n    scanner := bufio.NewScanner(r)\n    go func() {\n        w.WriteString(&quot;line of text\\n&quot;)\n        time.Sleep(time.Second)\n        w.Close()\n    }()\n    for scanner.Scan() {\n        fmt.Printf(&quot;scanned \\&quot;%v\\&quot;\\n&quot;, scanner.Text())\n    }\n    err = scanner.Err()\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(&quot;done scanning&quot;)\n}\n</code></pre>\n"}], "owner": {"reputation": 183, "user_id": 1883374, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ZpKR.jpg?s=128&g=1", "display_name": "Mehrdad", "link": "https://stackoverflow.com/users/1883374/mehrdad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1304, "favorite_count": 2, "answer_count": 3, "score": 0, "last_activity_date": 1610423543, "creation_date": 1462561275, "question_id": 37079639, "link": "https://stackoverflow.com/questions/37079639/how-we-can-stop-bufio-scanning-at-golang", "title": "How we can stop bufio scanning at golang?", "body": "<p>What's the best way to stop the below scanning?</p>\n\n<pre><code>     outputReader := io.MultiReader(outReader, errReader)\n     scanner := bufio.NewScanner(outputReader)\n     for scanner.Scan(){\n        scanner.Text():\n     }   \n</code></pre>\n"}, {"tags": ["pointers", "dictionary", "memory", "go", "space-complexity"], "answers": [{"comments": [{"owner": {"reputation": 6350, "user_id": 2399935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0dba94ea111afa694c3615b18bea3589?s=128&d=identicon&r=PG&f=1", "display_name": "Brian", "link": "https://stackoverflow.com/users/2399935/brian"}, "edited": false, "score": 0, "creation_date": 1462562560, "post_id": 37079680, "comment_id": 61704650, "body": "Thanks! I needed some clarification on this. Your argument about pointing to a value accessed from multiple locations makes good sense."}], "tags": [], "owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "is_accepted": true, "score": 2, "last_activity_date": 1462561449, "creation_date": 1462561449, "answer_id": 37079680, "question_id": 37079602, "link": "https://stackoverflow.com/questions/37079602/golang-space-efficiency-of-maps-with-pointers/37079680#37079680", "title": "Golang - Space efficiency of maps with pointers", "body": "<p>I cannot say if this is a common practice, but it is not cheating at all. \nConsider that structs are copied in go, therefore you may have a significant loss of space in copying the entire structure.</p>\n\n<p>Note, however, that slices are implicitly pointing to the underlying array. Therefore, if your structure has a slice type for <code>field3</code>, you would end up copying just a few values, and the actual saving would not be that much - in this case.</p>\n\n<p>Nevertheless, I prefer the solution with pointers. It's conceptually simpler to point to a value if its accessed by two different locations, and in the case you modify one field, you don't have to update the corresponding other as well. (EDIT sorry, I didn't read that you figured this out by yourself :))</p>\n"}], "owner": {"reputation": 6350, "user_id": 2399935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0dba94ea111afa694c3615b18bea3589?s=128&d=identicon&r=PG&f=1", "display_name": "Brian", "link": "https://stackoverflow.com/users/2399935/brian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 393, "favorite_count": 2, "accepted_answer_id": 37079680, "answer_count": 1, "score": 1, "last_activity_date": 1462561449, "creation_date": 1462561131, "question_id": 37079602, "link": "https://stackoverflow.com/questions/37079602/golang-space-efficiency-of-maps-with-pointers", "title": "Golang - Space efficiency of maps with pointers", "body": "<p>I'm only minimally familiar with pointers, but they seem to be a good way to reuse memory, and avoid making extra copies of objects.</p>\n\n<p>Suppose I have a <code>struct</code></p>\n\n<pre><code>type MyObject struct {\n  field1 int\n  field2 string\n  field3 []string // some long list of long strings\n}\n</code></pre>\n\n<p>I'd like to have two <code>maps</code> that allow efficient look-up of corresponding objects by their field values</p>\n\n<pre><code>myField1Map := make(map[int]*MyObject)\nmyField2Map := make(map[string]*MyObject)\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>myField1Map := make(map[int]MyObject)\nmyField2Map := make(map[string]MyObject)\n</code></pre>\n\n<p>Suppose I choose the former</p>\n\n<pre><code>myObj1 := new(MyObject)\nmyObj1.field1 = 1\nmyObj1.field2 = \"Mufasaaaaa\"\nmyObj1.field3 = []string{// lots and lots of long strings}\n\nmyField1Map[myObj1.field1] = myObj1\nmyField2Map[myObj1.field2] = myObj1\n</code></pre>\n\n<p>What are my tradeoffs in terms of space efficiency? It seems to me that I am saving space because both maps refer to the same object in memory.</p>\n\n<p>A cool thing was that, I set up a toy problem in <a href=\"https://play.golang.org/p/p4wWZGFwoU\" rel=\"nofollow\">Go Playground</a>. I can change a field of a value in one of my maps, and it will show up in the other. This seems like a nice bonus if, suppose, one of these maps was a primary key to this pointer value to the object.</p>\n\n<p>Can someone clarify whether this is the right way to think about pointers and space. Also, is this a common practice? Am I cheating at <code>Go</code>?  </p>\n"}, {"tags": ["go", "mocking", "monkeypatching"], "answers": [{"comments": [{"owner": {"reputation": 13614, "user_id": 2073001, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DbYlx.jpg?s=128&g=1", "display_name": "Steve P.", "link": "https://stackoverflow.com/users/2073001/steve-p"}, "edited": false, "score": 0, "creation_date": 1462563147, "post_id": 37079653, "comment_id": 61704895, "body": "I want to make sure that I&#39;m understanding this correctly. You&#39;re suggesting to define a struct wrapping whatever struct that I&#39;m dealing with.  Define methods on said newly introduced struct that call the methods of the wrapped struct.  Define an interface over the wrapper struct, then selectively mock out whatever subset of the underlying logic that needs to be mocked out?  If my interpretation is correct, this seems like I&#39;d just be rewriting all of the code given that it&#39;s so intertwined. Perhaps this is to be expected--guess there may not be an alternative."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 13614, "user_id": 2073001, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DbYlx.jpg?s=128&g=1", "display_name": "Steve P.", "link": "https://stackoverflow.com/users/2073001/steve-p"}, "edited": false, "score": 0, "creation_date": 1462563652, "post_id": 37079653, "comment_id": 61705156, "body": "That, unfortunate as it may be, is exactly what I am suggesting."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 4, "creation_date": 1462571475, "post_id": 37079653, "comment_id": 61708571, "body": "You don&#39;t need to call/mock the methods you don&#39;t need to override. You embed the original type inside your type, which promotes the methods, and then only override the methods you want to: <a href=\"https://play.golang.org/p/oHW1JX8iFb\" rel=\"nofollow noreferrer\">play.golang.org/p/oHW1JX8iFb</a>"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1462571736, "post_id": 37079653, "comment_id": 61708663, "body": "@elithrar Not a bad idea.  Typically I end up making my interface functions more complex than straight pass-thrus (as I did in this example) but you are right indeed about an embedded type."}, {"owner": {"reputation": 1122, "user_id": 4970650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/496526a825adf2e6587a19d3a6d391f7?s=128&d=identicon&r=PG", "display_name": "Cirelli94", "link": "https://stackoverflow.com/users/4970650/cirelli94"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1588586606, "post_id": 37079653, "comment_id": 108944973, "body": "the problem with @elithrar idea is that the overridden method, when used inside another method isn&#39;t called, but the original one is."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 11, "last_activity_date": 1462572225, "last_edit_date": 1495540922, "creation_date": 1462561361, "answer_id": 37079653, "question_id": 37079225, "link": "https://stackoverflow.com/questions/37079225/golang-monkey-patching/37079653#37079653", "title": "Golang monkey patching", "body": "<p>When I have run into this situation my approach is to use my own interface as a wrapper which allows mocking in tests.  For example.</p>\n\n<pre><code>type MyInterface interface {\n    DoSomething(i int) error\n    DoSomethingElse() ([]int, error)\n}\n\ntype Concrete struct {\n    client *somepackage.Client\n}\n\nfunc (c *Concrete) DoSomething(i int) error {\n    return c.client.DoSomething(i)\n}\n\nfunc (c *Concrete) DoSomethingElse() ([]int, error) {\n    return c.client.DoSomethingElse()\n}\n</code></pre>\n\n<p>Now you can mock the Concrete in the same way you would mock <code>somepackage.Client</code> if it too were an interface.</p>\n\n<p>As pointed out in the comments below by <a href=\"https://stackoverflow.com/users/556573/elithrar\">@elithrar</a>, you can embed the type you want to mock so you are only forced to add methods which need mocking.  For example:</p>\n\n<pre><code>type Concrete struct {\n    *somepackage.Client\n}\n</code></pre>\n\n<p>When done like that, additional methods like <code>DoSomethingNotNeedingMocking</code> could be called directly on <code>Concrete</code> without having to add it to the interface / mock it out.</p>\n"}, {"tags": [], "owner": {"reputation": 6354, "user_id": 4258430, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7a2d5075177b2ff473c38f6d8fb64894?s=128&d=identicon&r=PG", "display_name": "Allen Luce", "link": "https://stackoverflow.com/users/4258430/allen-luce"}, "is_accepted": false, "score": 2, "last_activity_date": 1470181075, "creation_date": 1470181075, "answer_id": 38732121, "question_id": 37079225, "link": "https://stackoverflow.com/questions/37079225/golang-monkey-patching/38732121#38732121", "title": "Golang monkey patching", "body": "<p>There is an <a href=\"https://github.com/bouk/monkey\" rel=\"nofollow\">available monkey patching library</a> for Go. It only works for Intel/AMD systems (targeting OSX and Ubuntu in particular).</p>\n"}, {"tags": [], "owner": {"reputation": 2410, "user_id": 1574637, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b30da618a502d63ba0ae4736799ad0ef?s=128&d=identicon&r=PG", "display_name": "Corey Scott", "link": "https://stackoverflow.com/users/1574637/corey-scott"}, "is_accepted": false, "score": 1, "last_activity_date": 1529354650, "creation_date": 1529354650, "answer_id": 50917194, "question_id": 37079225, "link": "https://stackoverflow.com/questions/37079225/golang-monkey-patching/50917194#50917194", "title": "Golang monkey patching", "body": "<p>Depending on the situation, you can apply the \"Dependency Inversion Principle\" and leverage Go's implicit interfaces.</p>\n\n<p>To do this, you define an interface of your requirements in the package with the usage (as opposed to defining what you provide in the package that implements it; like you might in Java).  </p>\n\n<p>Then you can test your code in isolation from the dependency.</p>\n\n<p>Typical object with a struct dependency:</p>\n\n<pre><code>// Object that relies on a struct\ntype ObjectUnderTestBefore struct {\n    db *sql.DB\n}\n\nfunc (o *ObjectUnderTestBefore) Delete() error {\n    o.db.Exec(\"DELETE FROM sometable\")\n}\n</code></pre>\n\n<p>Apply Dependency Inversion Principle (with implicit interface)</p>\n\n<pre><code>// subset of sql.DB which defines our \"requirements\"\ntype dbExec interface {\n    Exec(query string, args ...interface{}) (sql.Result, error)\n}\n\n// Same object with it's requirement defined as an local interface\ntype ObjectUnderTestWithDIP struct {\n    // *sql.DB will implicitly implement this interface\n    db dbExec\n}\n\nfunc (o *ObjectUnderTestWithDIP) Delete() error {\n    o.db.Exec(\"DELETE FROM sometable\")\n}\n</code></pre>\n"}], "owner": {"reputation": 13614, "user_id": 2073001, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/DbYlx.jpg?s=128&g=1", "display_name": "Steve P.", "link": "https://stackoverflow.com/users/2073001/steve-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7330, "favorite_count": 3, "accepted_answer_id": 37079653, "answer_count": 3, "score": 12, "last_activity_date": 1547800733, "creation_date": 1462559665, "last_edit_date": 1462560004, "question_id": 37079225, "link": "https://stackoverflow.com/questions/37079225/golang-monkey-patching", "title": "Golang monkey patching", "body": "<p>I understand that if go code is structured such that it's programmed to interfaces, it's trivial to mock; however, I'm working with a code base that I cannot change (that is not mine) and this is not the case.  </p>\n\n<p>This code base is heavily interconnected and nothing is programmed to an interface, only structs, so no dependency injection.  </p>\n\n<p>The structs, themselves, only contain other structs, so I can't mock out that way either. I don't believe that I can do anything about methods, and the few functions that exist are not variables, so there's no way that I know of to swap them out. Inheritance isn't a thing in golang, so that's a no go as well.</p>\n\n<p>In scripting languages like python, we can modify the objects at runtime, aka monkey patch.  Is there something comparable that I can do in golang?  Trying to figure out some way to test/benchmark without touching the underlying code.</p>\n"}, {"tags": ["go", "type-conversion"], "comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1462571256, "post_id": 37079018, "comment_id": 61708478, "body": "Just a general Go comment: If this is code trying to be &quot;generic&quot; just give up on generics in Go. Using the <code>interface{}</code> stuff is much worse than Java <code>Object</code>. It is slow, difficult to get right, leads to many bugs and code panics, etc. If you need a lot of similar code for different types write a code generator instead...my opinion."}], "answers": [{"tags": [], "owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "is_accepted": false, "score": 0, "last_activity_date": 1462559218, "creation_date": 1462559218, "answer_id": 37079105, "question_id": 37079018, "link": "https://stackoverflow.com/questions/37079018/how-convert-array-of-interface-to-float/37079105#37079105", "title": "How convert array of interface to float", "body": "<p>You will need to iterate over your slice and append each item to a new slice. In order to append it to your []float32, you will need to type assert:</p>\n\n<pre><code>bound := []interface{}{1.00, 1.00, 1.00, 1.00}\nnew_bound := make([]float32, 0, len(bound))\nfor _, v := range bound {\n    new_bound = append(new_bound, v.(float32))\n}\n</code></pre>\n\n<p>GoPlay here:\n<a href=\"https://play.golang.org/p/S8-4KJkqPq\" rel=\"nofollow\">https://play.golang.org/p/S8-4KJkqPq</a></p>\n"}, {"comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1462569554, "post_id": 37079112, "comment_id": 61707898, "body": "@OneOfOne good call. Hope you don&#39;t mind me including that in the answer here."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1462593887, "post_id": 37079112, "comment_id": 61713217, "body": "Not a problem at all."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 1, "last_activity_date": 1462569522, "last_edit_date": 1462569522, "creation_date": 1462559229, "answer_id": 37079112, "question_id": 37079018, "link": "https://stackoverflow.com/questions/37079018/how-convert-array-of-interface-to-float/37079112#37079112", "title": "How convert array of interface to float", "body": "<p>In your example you have a slice where each item it contains is an <code>interface{}</code> rather than say, a single <code>interface{}</code> representing a <code>[]float32</code>, for this reason you can't convert the whole collection so simply like that. Instead you have to iterate it and do a type assertion on each item in the collection. Here's an example; <a href=\"https://play.golang.org/p/dD4161xgaV\" rel=\"nofollow\">https://play.golang.org/p/dD4161xgaV</a></p>\n\n<pre><code>bound :=  []interface{}{1.00, 1.00, 1.00, 1.00}\nnew_bound := []float64{}\nfor _, v := range bound {\n     new_bound = append(new_bound, v.(float64))\n}\n</code></pre>\n\n<p>One other thing to note, those literals have their type implied and it's <code>float64</code> so you actually need that here.</p>\n\n<p>EDIT: Including this more optimized solution posted by OneOfOne;</p>\n\n<pre><code>func main() {\n    bound := []interface{}{1.00, 1.10, 1.11, 1.111}\n    new_bound := make([]float64, len(bound))\n    for i := range bound {\n        new_bound[i] = bound[i].(float64)\n    }\n    fmt.Println(new_bound)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 411, "user_id": 872346, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/54cc4f8fd0f98d9f645ac2dc68c1730e?s=128&d=identicon&r=PG", "display_name": "newpdv", "link": "https://stackoverflow.com/users/872346/newpdv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2062, "favorite_count": 0, "accepted_answer_id": 37079112, "answer_count": 2, "score": 0, "last_activity_date": 1462569522, "creation_date": 1462558905, "question_id": 37079018, "link": "https://stackoverflow.com/questions/37079018/how-convert-array-of-interface-to-float", "title": "How convert array of interface to float", "body": "<pre><code>bound :=  []interface{}{1.00, 1.00, 1.00, 1.00}\nnew_bound := bound.([]float32)\nlog.Println(new_bound)\n</code></pre>\n\n<p>How convert array of interface to array of float?</p>\n\n<blockquote>\n  <p>invalid type assertion: bound.([]float32) (non-interface type []interface {} on left)</p>\n</blockquote>\n\n<p>And in real project</p>\n\n<blockquote>\n  <p>panic: interface conversion: interface is []interface {}, not []float32</p>\n</blockquote>\n"}, {"tags": ["jquery", "json", "xml", "go", "extract"], "answers": [{"tags": [], "owner": {"reputation": 464, "user_id": 1645219, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gnqzr.png?s=128&g=1", "display_name": "Jony T", "link": "https://stackoverflow.com/users/1645219/jony-t"}, "is_accepted": false, "score": 0, "last_activity_date": 1462580058, "creation_date": 1462580058, "answer_id": 37083130, "question_id": 37077296, "link": "https://stackoverflow.com/questions/37077296/golang-extracting-xml-issue/37083130#37083130", "title": "GOLang: Extracting XML Issue", "body": "<p>Change your xml attributes on reportType to remove the root element: <code>xml:\"course&gt;crn\"</code> should be <code>xml:\"crn\"</code>. If you aren't required to use CharData, I would also simplify your data types to strings so you aren't converting them later on. See my example playground for a working example.</p>\n\n<p><a href=\"https://play.golang.org/p/xysSV-7oCA\" rel=\"nofollow\">https://play.golang.org/p/xysSV-7oCA</a></p>\n"}], "owner": {"reputation": 141, "user_id": 6100438, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/906a7ce7929a333335af52c0a5c2042d?s=128&d=identicon&r=PG&f=1", "display_name": "Becca Bohem", "link": "https://stackoverflow.com/users/6100438/becca-bohem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1462580058, "creation_date": 1462552246, "question_id": 37077296, "link": "https://stackoverflow.com/questions/37077296/golang-extracting-xml-issue", "title": "GOLang: Extracting XML Issue", "body": "<p>Hello StackOverFLowers!</p>\n\n<p>I'm trying to extract the xml from the following.....\n<a href=\"https://i.stack.imgur.com/T6a6Z.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/T6a6Z.png\" alt=\"enter image description here\"></a></p>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/xml\"\n    \"net/http\"\n    \"log\"\n    \"io/ioutil\"\n    \"encoding/json\"\n\n)\n\ntype reportType struct{\n    Course xml.CharData     `xml:\"course\"`\n    Crn xml.CharData `xml:\"crn\"`\n    Id xml.CharData `xml:\"course&gt;id\"`\n    Section xml.CharData `xml:\"course&gt;section`\n    Title xml.CharData `xml:\"course&gt;title`\n\n\n}\ntype myErrorType struct{\n    TypeOfError xml.CharData `xml:\"type\"`\n    Desciption xml.CharData `xml:\"description\"`\n}\ntype reportTypeJson struct{\n    Course string       `json:\"course\"`\n    Crn string `json:\"crn\"`\n    Id string   `json:\"id\"`\n    Section string `json:\"section`\n    Title string `json:\"title`\n    course   map[string]string `json:\"course\"`;\n}\nfunc main() {\n\n    baseURL := \"http://turing.cs.missouriwestern.edu/classes/csc346/final/?crn=13398\";\n\n\n    var query string\n\n    query = baseURL\n    fmt.Println(\"The escaped query: \"+query)\n\n    response, err := http.Get(query)\n    doErr(err, \"After the GET\")\n    var body []byte\n    body, err = ioutil.ReadAll(response.Body)\n    fmt.Println(body);\n    doErr(err, \"After Readall\")\n\n    stringOfBody := string(body[:500])\n    fmt.Printf(\"TASK 1: The body(as text): %s\\n\",stringOfBody)\n\n    //Unmarshalling\n    var report reportType\n    xml.Unmarshal(body, &amp;report)\n    fmt.Printf(\"The Report: %s\\n\", report)\n\n    //Now marshal the data out in JSON\n    var data []byte\n    var output reportTypeJson\n    output.Course=string(report.Course)\n    output.Crn=string(report.Crn)\n    output.Id=string(report.Id)\n    output.Section=string(report.Section)\n    output.Title=string(report.Title)\n\n    //var output reportType\n    //output.Version = string(report.Version);\n    //report.Version -&gt; output.Version\n    //output.TermsOfService = string(report.TermsOfService)\n    data,err = json.MarshalIndent(output,\"\",\"      \")\n    doErr(err, \"From marshalIndent\")\n    fmt.Printf(\"JSON output nicely formatted: \\n%s\\n\",data)\n\n    fmt.Println(\"CRN: %v\\n\",report.Crn)\n    fmt.Println(\"ID: %v\\n\",report.Id)\n    fmt.Println(\"Section: %v\\n\",report.Section)\n    fmt.Println(\"Title: %v\\n\",report.Title)\n    fmt.Println(\"Course: %v\\n\",report.Course)\n    fmt.Println(\"ID: %v\\n\",report.Id)\n\n\n}\nfunc doErr( err error, message string){\n    if err != nil{\n        log.Panicf(\"ERROR: %s %s \\n\", message, err.Error())\n    }\n\n\n}\n</code></pre>\n\n<p>For Some reason it's not extracting the data from the file giving me basically a blank report. I made a program like this literally two days ago and am following the same format, but I can't figure out where I'm going wrong.</p>\n\n<p>OUTPUT:</p>\n\n<pre><code>The Report: {    }\nJSON output nicely formatted: \n{\n      \"course\": \"\",\n      \"crn\": \"\",\n      \"id\": \"\",\n      \"Section\": \"\",\n      \"Title\": \"\"\n}\n</code></pre>\n\n<p>Any and all help is much appreciated, I have a test in a few hours and I'm hoping for some guidance by then!! Thanks!</p>\n"}, {"tags": ["for-loop", "dictionary", "go"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 1421142, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/btIKr.jpg?s=128&g=1", "display_name": "cloudaice", "link": "https://stackoverflow.com/users/1421142/cloudaice"}, "is_accepted": false, "score": 0, "last_activity_date": 1462551081, "creation_date": 1462551081, "answer_id": 37076975, "question_id": 37076773, "link": "https://stackoverflow.com/questions/37076773/adding-entries-to-a-map-in-a-loop/37076975#37076975", "title": "Adding entries to a map in a loop", "body": "<p>the type of  manyUsers is value not reference\uff0cso the follow code maybe ok </p>\n\n<pre><code>var manyUsers *zendesk.ManyUsers\nusers := make(map[string]*zendesk.ManyUsers)\n......\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1462553582, "creation_date": 1462553582, "answer_id": 37077667, "question_id": 37076773, "link": "https://stackoverflow.com/questions/37076773/adding-entries-to-a-map-in-a-loop/37077667#37077667", "title": "Adding entries to a map in a loop", "body": "<p>You essentially modifying <em>the same</em> variable <code>manyUsers</code> on each iteration of your <code>for</code> loop and use that single instance as the value each time you create the new map entry.</p>\n\n<p>You did not show us how your <code>zendesk.ManyUser</code> is defined but if it has reference semantics all your map entries will share the same data.</p>\n\n<p>My guess (given the incomplete problem statement) is that you need to create a new instance of <code>zendesk.ManyUser</code> on each iteraition of your loop:</p>\n\n<pre><code>users := make(map[string]zendesk.ManyUsers)\n\nfor {\n    ...\n    var manyUsers zendesk.ManyUsers\n    manyUsers.AppendUsers(mysqlRequest(country, id))\n    users[country] = manyUsers\n\n    fmt.Printf(\"[%s]: %#v\\n\\n\", country, users[country])\n}\n</code></pre>\n\n<p>A no-brainer demonstration of the effect <a href=\"https://play.golang.org/p/6m6lAK0EeI\" rel=\"nofollow\">is there</a> &mdash; observe that the iterations of the first loop modify the same variable while in the second loop each iteration first gets a fresh instance of a variable.</p>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1462564052, "post_id": 37077805, "comment_id": 61705392, "body": "Consider accepting your own answer then -- that&#39;s what SO rules suggest to do anyway."}], "tags": [], "owner": {"reputation": 188, "user_id": 4611395, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/THoCA.jpg?s=128&g=1", "display_name": "Felipe Umpierre", "link": "https://stackoverflow.com/users/4611395/felipe-umpierre"}, "is_accepted": true, "score": 0, "last_activity_date": 1462554080, "creation_date": 1462554080, "answer_id": 37077805, "question_id": 37076773, "link": "https://stackoverflow.com/questions/37076773/adding-entries-to-a-map-in-a-loop/37077805#37077805", "title": "Adding entries to a map in a loop", "body": "<p>I would like to thanks @kostix and @cloudaice for the answers.</p>\n\n<p>I figure out what I need to do, I used what @kostix suggested, so I create in each iteration in my <code>for</code> loop, the <code>var manyUsers zendesk.ManyUsers</code> but I also added the follow:</p>\n\n<pre><code>manyUsers = users[country]\nmanyUsers.AppendUsers(mysqlRequest(country, id))\nusers[country] = manyUsers\n</code></pre>\n\n<p>Passing the current value from each country to my <code>manyUsers</code> I am capable of add a new <code>User</code> element in the <code>ManyUsers</code> struct and return the appended value to the <code>users[country]</code>. So, I never aggregate data from iteration and each country gets the correct amount of users.</p>\n\n<p>Thank you.</p>\n"}], "owner": {"reputation": 188, "user_id": 4611395, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/THoCA.jpg?s=128&g=1", "display_name": "Felipe Umpierre", "link": "https://stackoverflow.com/users/4611395/felipe-umpierre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 37077805, "answer_count": 3, "score": 1, "last_activity_date": 1462554080, "creation_date": 1462550402, "last_edit_date": 1462553894, "question_id": 37076773, "link": "https://stackoverflow.com/questions/37076773/adding-entries-to-a-map-in-a-loop", "title": "Adding entries to a map in a loop", "body": "<p>I am trying to implement in my application a way to separate users per country and then, send them to different actions.</p>\n\n<p>This is what I have right now:</p>\n\n<pre><code>var manyUsers zendesk.ManyUsers\nusers := make(map[string]zendesk.ManyUsers)\n\nfor {\n    ...\n    manyUsers.AppendUsers(mysqlRequest(country, id))\n    users[country] = manyUsers\n\n    fmt.Printf(\"[%s]: %#v\\n\\n\", country, users[country])\n}\n</code></pre>\n\n<p>But I figure out that after when I add a 3 different countries, it will generate 3 diferent keys, but the last one will have the 3 users from the other countries.</p>\n\n<p>This is my AppendUsers function</p>\n\n<pre><code>func (users *ManyUsers) AppendUsers(user User) []User {\n    users.Users = append(users.Users, user)\n\n    return users.Users\n}\n</code></pre>\n"}, {"tags": ["web", "web-applications", "go", "beego"], "answers": [{"tags": [], "owner": {"reputation": 588, "user_id": 1039765, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1b26b10cbaeb0be72a8232a1056d19d?s=128&d=identicon&r=PG", "display_name": "Reekdeb Mal", "link": "https://stackoverflow.com/users/1039765/reekdeb-mal"}, "is_accepted": true, "score": 0, "last_activity_date": 1462849481, "creation_date": 1462849481, "answer_id": 37128580, "question_id": 37076304, "link": "https://stackoverflow.com/questions/37076304/how-to-get-values-from-beego-appconfig-and-render-it-in-html-template/37128580#37128580", "title": "How to get values from beego AppConfig and render it in HTML template?", "body": "<p>Finally I solved this myself. <code>config</code> template function accepts all parameters as string.</p>\n\n<p>Correct way to use <code>config</code> template function is:</p>\n\n<pre><code>&lt;div&gt;{{config \"String\" \"appname\" \"TestDefaultValue\"}}&lt;/div&gt;\n</code></pre>\n"}], "owner": {"reputation": 588, "user_id": 1039765, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1b26b10cbaeb0be72a8232a1056d19d?s=128&d=identicon&r=PG", "display_name": "Reekdeb Mal", "link": "https://stackoverflow.com/users/1039765/reekdeb-mal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "accepted_answer_id": 37128580, "answer_count": 1, "score": 0, "last_activity_date": 1462849481, "creation_date": 1462548957, "question_id": 37076304, "link": "https://stackoverflow.com/questions/37076304/how-to-get-values-from-beego-appconfig-and-render-it-in-html-template", "title": "How to get values from beego AppConfig and render it in HTML template?", "body": "<p>I want to get value of a key defined in beego's <strong>app.conf</strong> and render in html pages.\nAs per documentation on <a href=\"http://beego.me/docs/mvc/view/template.md\" rel=\"nofollow\">http://beego.me/docs/mvc/view/template.md</a> I can get value of AppConfig by using config function in templates. However there is no example in documentation.</p>\n\n<blockquote>\n  <p>Get the value of AppConfig. {{config configType configKey defaultValue}}. configType must be String, Bool, Int, Int64, Float, or DIY</p>\n</blockquote>\n\n<p>After trying many ways I came to this:</p>\n\n<pre><code>&lt;div&gt;{{config config.String config.appname \"TestDefaultValue\"}}&lt;/div&gt;\n</code></pre>\n\n<p>But I am always getting error:</p>\n\n<pre><code>&lt;config&gt;: wrong number of args for config: want 3 got 0\n</code></pre>\n\n<p>What is the correct way to use config template function?</p>\n"}, {"tags": ["json", "go", "websocket"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1462561088, "post_id": 37076223, "comment_id": 61703980, "body": "It appears that you are using the <a href=\"https://github.com/gorilla/websocket#gorilla-websocket-compared-with-other-packages\" rel=\"nofollow noreferrer\">buggy</a> x/net/websocket package.  Consider using <a href=\"https://godoc.org/github.com/gorilla/websocket\" rel=\"nofollow noreferrer\">Gorilla</a> and starting with Gorilla&#39;s  <a href=\"https://github.com/gorilla/websocket/tree/master/examples/chat\" rel=\"nofollow noreferrer\">chat example</a>."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1462567277, "creation_date": 1462567277, "answer_id": 37081073, "question_id": 37076223, "link": "https://stackoverflow.com/questions/37076223/read-write-multiple-times-over-the-same-websocket-in-go/37081073#37081073", "title": "Read &amp; Write multiple times over the same websocket in go", "body": "<p>The x/net/websocket package closes the connection on return from the handler. To fix this, do the work in the handler function instead of starting a goroutine:</p>\n\n<pre><code>g.LivingDiscussions[len(g.LivingDiscussions)-1].Participants[0].Listen()\n</code></pre>\n"}], "owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 37081073, "answer_count": 1, "score": 0, "last_activity_date": 1462567277, "creation_date": 1462548690, "question_id": 37076223, "link": "https://stackoverflow.com/questions/37076223/read-write-multiple-times-over-the-same-websocket-in-go", "title": "Read &amp; Write multiple times over the same websocket in go", "body": "<p><strong>First of all, context:</strong></p>\n\n<ul>\n<li>I'm fairly new to go, I've take one 5 weeks course, but thats about it.</li>\n<li>I'm all new to networking, and I've been playing around with websockets (in go) for a couple of days.</li>\n</ul>\n\n<p>I'm working in a small team and I've been tasked with developing an IRC-server (in go) using Websockets. In order for me to be able to make sure that the server works, I've written a small testing framework (also in go).   </p>\n\n<p><strong>Now to the problem at hand:</strong><br>\nThe problem is in this snippet of code.</p>\n\n<pre><code>enc := json.NewEncoder(ws)\ncreator := g.UserID{Name: _name, UUID: g.GenerateUID(_name + _subject)}\nac := g.DiscussionCreate{Subject: _subject, Creator: creator}\nerr = enc.Encode(ac) //This encoding IS read by the server.\nLog.Err(err, \"enc.Encode\")\n\ndec := json.NewDecoder(ws)\nvar disc, empty g.Discussion\nerr = dec.Decode(&amp;disc)\nLog.Err(err, \"dec.Decode\")\n\nsend := g.Message{\n    Msg:  \"Hello, World!\",\n    UDID: disc.DiscussionID.UDID,\n    UUID: creator.UUID}\nerr = enc.Encode(send) //This encoding ISN'T read by the server.\nLog.Err(err, \"enc.Encode\")\n</code></pre>\n\n<p>The server reads the first encoded message.<br>\nBut fails to read the second one.</p>\n\n<p>The first message is read in this function</p>\n\n<pre><code>func Create(ws *websocket.Conn) {\n    Log.Connection(ws)\n    var dc g.DiscussionCreate\n    var di g.Discussion\n\n    dec := json.NewDecoder(ws)\n    err := dec.Decode(&amp;dc) //Here &lt;-----\n    Log.Err(err, \"dec.Decode\")\n\n    discID := g.DiscussionID{\n        Subject: dc.Subject,\n        UDID:    g.GenerateUID(time.Now().String())}\n\n    ssUserID := g.SSUserID{\n        Name: dc.Creator.Name,\n        UUID: dc.Creator.UUID,\n        WS:   ws}\n\n    disc := g.SSDiscussion{\n        DiscussionID: discID,\n        Participants: []g.SSUserID{ssUserID}}\n\n    g.LivingDiscussions = append(g.LivingDiscussions, disc)\n    Log.Activity(\"Discussion\", \"Created\", disc.DiscussionID.Subject)\n\n    di = g.Discussion{\n        DiscussionID: discID,\n        Participants: []g.UserID{dc.Creator}}\n\n    enc := json.NewEncoder(ws)\n    err = enc.Encode(di)\n    Log.Err(err, \"enc.Encode\")\n\n    go g.LivingDiscussions[len(g.LivingDiscussions)-1].Participants[0].Listen()\n}\n</code></pre>\n\n<p>And the second message is read in the go routine started in the last line of the function above.</p>\n\n<pre><code>func (ssUserID *SSUserID) Listen() {\n    lastMessage := time.Now().Second()\n    dec := json.NewDecoder(ssUserID.WS)\n    empty := \"\"\n    var msg Message\n    for (lastMessage + ConnTimeout) &gt; time.Now().Second() {\n        if err := dec.Decode(&amp;msg); err == nil { //Here  &lt;-----\n            Messages &lt;- msg\n            lastMessage = time.Now().Second()\n        } else if err := dec.Decode(&amp;empty); err == nil {\n            lastMessage = time.Now().Second()\n        }\n    }\n}\n</code></pre>\n\n<p>Why wont the server read the second message?<br>\nAnd how do i solve this?<br>\nThanks!</p>\n"}, {"tags": ["rest", "go", "json-api"], "answers": [{"comments": [{"owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "edited": false, "score": 0, "creation_date": 1462704487, "post_id": 37091057, "comment_id": 61740519, "body": "i went with <code>json:omitempty</code> and set all non requested fields to their zero value using reflection, i don&#39;t understand what you mean by &quot;in case somefields are missing&quot;?"}, {"owner": {"reputation": 384, "user_id": 1835188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M582S.png?s=128&g=1", "display_name": "Lorenz Leutgeb", "link": "https://stackoverflow.com/users/1835188/lorenz-leutgeb"}, "reply_to_user": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "edited": false, "score": 0, "creation_date": 1462798390, "post_id": 37091057, "comment_id": 61773638, "body": "Without <code>json:&quot;omitempty&quot;</code> you&#39;d send <code>{ &quot;name&quot;: &quot;&quot;, ... }</code>, but with <code>json:&quot;omitempty&quot;</code> your answer would not contain a &quot;name&quot; attribute in case it&#39;s value is the empty string. Thus a client (quite likely a browser) that receives the JSON, will not see the empty string but <code>undefined</code> for the &quot;name&quot; property. This could cause unexpected behaviour.  Did my answer help? If so, please consider marking it as correct."}, {"owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "edited": false, "score": 0, "creation_date": 1462880362, "post_id": 37091057, "comment_id": 61813568, "body": "that is not a problem in this specific case because I have no nullable fields in my database."}, {"owner": {"reputation": 384, "user_id": 1835188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M582S.png?s=128&g=1", "display_name": "Lorenz Leutgeb", "link": "https://stackoverflow.com/users/1835188/lorenz-leutgeb"}, "reply_to_user": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "edited": false, "score": 0, "creation_date": 1462881738, "post_id": 37091057, "comment_id": 61814626, "body": "I didn&#39;t mean to offend and I did not assume your database is all <code>NOT NULL</code>, sorry. Just mind that <code>NULL</code> in a database, a <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a> in Go and <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">the empty values in<code>encoding&#47;json</code></a> (false, 0, any nil pointer or interface value, and any array, slice, map, or string of length zero) are not the same by definition. The number 0 is a valid value for a <code>NOT NULLABLE</code> column, but will be omitted in JSON output, for example."}, {"owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "edited": false, "score": 0, "creation_date": 1462895725, "post_id": 37091057, "comment_id": 61825255, "body": "no worries I wasn&#39;t offended, you are right and that is why I made those fields a pointer type."}], "tags": [], "owner": {"reputation": 384, "user_id": 1835188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M582S.png?s=128&g=1", "display_name": "Lorenz Leutgeb", "link": "https://stackoverflow.com/users/1835188/lorenz-leutgeb"}, "is_accepted": true, "score": 1, "last_activity_date": 1462639035, "creation_date": 1462639035, "answer_id": 37091057, "question_id": 37075779, "link": "https://stackoverflow.com/questions/37075779/how-to-filter-fields-from-the-database-in-json-response/37091057#37091057", "title": "How to filter fields from the database in JSON response?", "body": "<p>For your first proposal (querying only the requested fields) there are two  approaches (answering \"would this work?\" and \"how would I go about implementing the first method?\"):</p>\n\n<ol>\n<li>Dynmaically reate a (possibly anonymous) <code>struct</code> and generate JSON from there using <code>encoding/json</code>.</li>\n<li>Implement a wrapper that will translate the <code>*database/sql.Rows</code> you get back from the query into JSON.</li>\n</ol>\n\n<p>For approach (1.), you will somehow need to create <code>struct</code>s for any combination of attributes from your original <code>struct</code>. As <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/T4YkIBkaziE\" rel=\"nofollow\"><code>reflect</code> cannot create a new struct type at runtime</a>, your only chance would be to <a href=\"https://blog.golang.org/generate\" rel=\"nofollow\">generate them at compile time</a>. The combinatorial explosion will bloat your binary, so do not do that.</p>\n\n<p>Approach (2.) is to be handled with caution and can only be a last resort. Taking the list of requested fields and writing out JSON with the values you got from DB sounds straightforward and does not involve reflection. However your solution will be (very likely) much more unstable than <code>encoding/json</code>.</p>\n\n<p>When reading your question I too thought about using the <code>json:\"omitempty\"</code> struct tag. And I think that it is the preferable solution. It does neither involve metaprogramming nor writing your own JSON encoder, which is a good thing. Just be aware of the implications in case some fields are missing (client side maybe has to account for that). You could query for <em>all</em> attributes <em>always</em> and override the unwanted ones using reflection.</p>\n\n<p>In the end, all above solutions are suboptimal, and the best solution would be to not implement that feature at all. I hope you have a solid reason to make attributes variable, and I am happy to further clarify my answer based on your explaination. However, if one of the attributes of a resource is too large, it maybe should be a sub-resource.</p>\n"}], "owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1572, "favorite_count": 1, "accepted_answer_id": 37091057, "answer_count": 1, "score": 0, "last_activity_date": 1462639035, "creation_date": 1462547367, "last_edit_date": 1462589507, "question_id": 37075779, "link": "https://stackoverflow.com/questions/37075779/how-to-filter-fields-from-the-database-in-json-response", "title": "How to filter fields from the database in JSON response?", "body": "<p>i am making a REST API in golang and i want to add support for filtering fields but i don't know the best way to implement that, lets say i have this structure representing an <code>Album</code> model</p>\n\n<pre><code>type Album struct {\n  ID            uint64    `json:\"id\"`\n  User          uint64    `json:\"user\"`\n  Name          string    `json:\"name\"`\n  CreatedDate   time.Time `json:\"createdDate\"`\n  Privacy       string    `json:\"privacy\"`\n  Stars         int       `json:\"stars\"`\n  PicturesCount int       `json:\"picturesCount\"`\n}\n</code></pre>\n\n<p>and a function that returns an instance of an <code>Album</code></p>\n\n<pre><code>func GetOne(id uint64, user uint64) (Album, error) {\n\n  var album Album\n\n  sql := `SELECT * FROM \"album\" WHERE \"id\" = $1 AND \"user\" = $2;`\n\n  err := models.DB.QueryRow(sql, id, user).Scan(\n    &amp;album.ID,\n    &amp;album.User,\n    &amp;album.Name,\n    &amp;album.CreatedDate,\n    &amp;album.Privacy,\n    &amp;album.Stars,\n    &amp;album.PicturesCount,\n  )\n\n  return album, err\n\n}\n</code></pre>\n\n<p>and the client was to issue a request like this<br>\n<code>https://api.localhost.com/albums/1/?fields=id,name,privacy</code></p>\n\n<p>obvious security issues aside, my first thought was to filter the fields in the database using something like this</p>\n\n<pre><code>func GetOne(id uint64, user uint64, fields string) {\n\n  var album Album\n\n  sql := fmt.Sprintf(`SELECT %s FROM \"album\" WHERE \"id\" = $1 AND \"user\" = $2;`, fields)\n\n  // i don't know what to do after this\n\n}\n</code></pre>\n\n<p>and then i thought of adding <code>omitempty</code> tag to all the fields and setting the fields to their zero value before encoding it to JSON, </p>\n\n<ul>\n<li><strong>would this work?</strong></li>\n<li><strong>which one is the better way?</strong></li>\n<li><strong>is there a best way?</strong></li>\n<li><strong>how would i go about implementing the first method?</strong></li>\n</ul>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "pgp", "openpgp"], "comments": [{"owner": {"reputation": 33721, "user_id": 695343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/KX04R.jpg?s=128&g=1", "display_name": "Jens Erat", "link": "https://stackoverflow.com/users/695343/jens-erat"}, "edited": false, "score": 1, "creation_date": 1462550066, "post_id": 37075531, "comment_id": 61697938, "body": "If you encrypted for the right key, I don&#39;t think you did anything wrong. Looking at that key on the key servers, you encrypted to the newest (and only) encryption subkey. If the &quot;guy on the other end&quot;  gets an error message he does not hold the secret key, then either you use the wrong key for encryption, the other guy gave you the wrong key or the other guy messed up himself."}, {"owner": {"reputation": 689, "user_id": 2776727, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c38f6255df694b842b5f0b588946beee?s=128&d=identicon&r=PG", "display_name": "Andreas", "link": "https://stackoverflow.com/users/2776727/andreas"}, "reply_to_user": {"reputation": 33721, "user_id": 695343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/KX04R.jpg?s=128&g=1", "display_name": "Jens Erat", "link": "https://stackoverflow.com/users/695343/jens-erat"}, "edited": false, "score": 0, "creation_date": 1462630829, "post_id": 37075531, "comment_id": 61723163, "body": "I use an ASCII armored key they have posted on theire website. I think the key is correct. However, they try to decrypt with gpg on the command line, while we are using the script."}, {"owner": {"reputation": 33721, "user_id": 695343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/KX04R.jpg?s=128&g=1", "display_name": "Jens Erat", "link": "https://stackoverflow.com/users/695343/jens-erat"}, "edited": false, "score": 1, "creation_date": 1462631056, "post_id": 37075531, "comment_id": 61723232, "body": "That should not matter. The &quot;other guys&quot; implementation correctly realized you encrypted for (sub)key <code>5BE299DC</code>, but does not have this key. Only one of the reasons listed in my comment can result in this message."}, {"owner": {"reputation": 689, "user_id": 2776727, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c38f6255df694b842b5f0b588946beee?s=128&d=identicon&r=PG", "display_name": "Andreas", "link": "https://stackoverflow.com/users/2776727/andreas"}, "reply_to_user": {"reputation": 33721, "user_id": 695343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/KX04R.jpg?s=128&g=1", "display_name": "Jens Erat", "link": "https://stackoverflow.com/users/695343/jens-erat"}, "edited": false, "score": 0, "creation_date": 1462890012, "post_id": 37075531, "comment_id": 61821038, "body": "Hi Jens, we tried now with a personal key of my contact and it worked indeed like a charm. Looks like encryption is not only difficulty for web guys like myself ;) - if you add your comment as an answer, I&#39;m would be happy to mark it as the final one."}], "answers": [{"tags": [], "owner": {"reputation": 33721, "user_id": 695343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/KX04R.jpg?s=128&g=1", "display_name": "Jens Erat", "link": "https://stackoverflow.com/users/695343/jens-erat"}, "is_accepted": true, "score": 1, "last_activity_date": 1462913369, "last_edit_date": 1592644375, "creation_date": 1462913369, "answer_id": 37148706, "question_id": 37075531, "link": "https://stackoverflow.com/questions/37075531/how-to-encrypt-a-string-to-an-ascii-armored-file-in-go/37148706#37148706", "title": "How to Encrypt a String to an ASCII armored file in go", "body": "<blockquote>\n<p>However, the guys on the other end get this error message:</p>\n<pre><code>gpg: encrypted with RSA key, ID 5BE299DC\ngpg: decryption failed: No secret key\n</code></pre>\n</blockquote>\n<p>If you encrypted for the right key, I don't think you did anything wrong. Looking at that key on the key servers, you encrypted to the newest (and only) encryption subkey.</p>\n<p>If the &quot;guy on the other end&quot; gets an error message indicating that he would not hold the secret key, then either</p>\n<ul>\n<li>you use the wrong key for encryption,</li>\n<li>&quot;the other guy&quot; gave you the wrong key or</li>\n<li>&quot;the other guy&quot; messed up himself.</li>\n</ul>\n<p>You can verify what's going wrong by passing the encrypted contents to <code>gpg --list-packets</code> or <code>pgpdump</code>, which list the OpenPGP packets contained in the message and are very helpful at debugging OpenPGP issues.</p>\n"}], "owner": {"reputation": 689, "user_id": 2776727, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c38f6255df694b842b5f0b588946beee?s=128&d=identicon&r=PG", "display_name": "Andreas", "link": "https://stackoverflow.com/users/2776727/andreas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1440, "favorite_count": 0, "accepted_answer_id": 37148706, "answer_count": 1, "score": 0, "last_activity_date": 1462913369, "creation_date": 1462546575, "question_id": 37075531, "link": "https://stackoverflow.com/questions/37075531/how-to-encrypt-a-string-to-an-ascii-armored-file-in-go", "title": "How to Encrypt a String to an ASCII armored file in go", "body": "<p>I'm at the moment realy struggeling in finding the error in my code - the task is to encrypt a string into a pgp ASCII armored file - a simple thing one could think.</p>\n\n<p>I use the following function, inspired by this <a href=\"https://gist.github.com/jyap808/8250124\" rel=\"nofollow\">gist</a>:</p>\n\n<pre><code>// pgp encryption using the pgp RSA certificate\n// massive thx to https://gist.github.com/jyap808/8250124\nfunc encToFile(secretString string, filename string) (string, error) {\n  log.Println(\"Public Keyring: \", publicKeyring)\n\n  encryptionType := \"PGP MESSAGE\"\n\n  // Read in public key\n  keyringFileBuffer, _ := os.Open(publicKeyring)\n  defer keyringFileBuffer.Close() \n  entityList, err := openpgp.ReadArmoredKeyRing(keyringFileBuffer) \n  check(err)\n\n  encbuf := bytes.NewBuffer(nil)\n  w, err := armor.Encode(encbuf, encryptionType, nil) // the encoder somehow makes this into ASCII armor\n  check(err)\n\n  plaintext, err := openpgp.Encrypt(w, entityList, nil, nil, nil)\n  check(err)\n\n  message := []byte(secretString)\n  _, err = plaintext.Write(message)\n\n  plaintext.Close()\n  w.Close()\n\n  // Output encrypted/encoded string\n  log.Println(\"Writing Encrypted Secred to: \", filename)\n  // we write the file into a file\n\n  err = ioutil.WriteFile(filename, encbuf.Bytes(), 0644)\n  check(err)\n\n  log.Println(\"File:\\n\", encbuf.String())\n\n\n  return encbuf.String(), nil\n}\n</code></pre>\n\n<p>However, the guys on the other end get this error message:</p>\n\n<pre><code>gpg: encrypted with RSA key, ID 5BE299DC\ngpg: decryption failed: No secret key\n</code></pre>\n\n<p>Hints and suggestion would be very welcome!</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "edited": false, "score": 0, "creation_date": 1462544617, "post_id": 37074762, "comment_id": 61694235, "body": "You are trying to update the <code>_id</code> field with this statement <code>col.Update(obj1.Id, bson.M{&quot;$set&quot;: &amp;obj1})</code> which is not possible in MongoDB, hence the error. You need to create an object which does not have the <code>_id</code> field to use in your <code>$set</code> expression."}, {"owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "reply_to_user": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "edited": false, "score": 0, "creation_date": 1462567490, "post_id": 37074762, "comment_id": 61706976, "body": "I&#39;m not seeing how to do that with a struct. The closest I could come is marshaling it to BSON, then unmarshaling then to a map, then deleting the &quot;_id&quot; entry from the map. Is there a better way to do this?"}], "answers": [{"tags": [], "owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "is_accepted": false, "score": 0, "last_activity_date": 1462626819, "creation_date": 1462626819, "answer_id": 37089005, "question_id": 37074762, "link": "https://stackoverflow.com/questions/37074762/not-understanding-how-mongodb-update-works-in-go/37089005#37089005", "title": "Not understanding how mongoDB Update works in Go", "body": "<p>The problem was that I was using the wrong field as the key. I had mapped \"Id\" to \"_id\", but was then asking MongoDB to find a record using the Go attribute name rather than the name. This works correctly:</p>\n\n<pre><code>package testmgo\n\nimport (\n    mgo \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n    \"testing\"\n)\n\ntype MyStruct struct {\n    Id    bson.ObjectId `bson:\"_id\"`\n    Fruit string        `bson:\"fruit\"`\n}\n\nfunc TestUpdate(t *testing.T) {\n    obj1 := MyStruct{Id: bson.NewObjectId(), Fruit: \"apple\"}\n    var obj2 MyStruct\n\n    session, _ := mgo.Dial(\"localhost\")\n    col := session.DB(\"test\").C(\"collection\")\n    col.Insert(&amp;obj1)\n    obj1.Fruit = \"cherry\"\n\n    if err := col.UpdateId(obj1.Id, bson.M{\"$set\": &amp;obj1}); err != nil {\n        t.Errorf(err.Error())\n    }\n    if err := col.Find(bson.M{\"_id\": obj1.Id}).One(&amp;obj2); err != nil {\n        t.Errorf(err.Error())\n    }\n    if obj1.Fruit != obj2.Fruit {\n        t.Errorf(\"Expected %s, got %s\", obj1.Fruit, obj2.Fruit)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 409, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1462626819, "creation_date": 1462544296, "last_edit_date": 1462577106, "question_id": 37074762, "link": "https://stackoverflow.com/questions/37074762/not-understanding-how-mongodb-update-works-in-go", "title": "Not understanding how mongoDB Update works in Go", "body": "<p>I'm trying to implement a MongoDB update for a Go struct. Stripped down to essentials, it looks something like this:</p>\n\n<pre><code>type MyStruct struct {\n        Id     bson.ObjectId `bson:\"_id\"`\n        Fruit string         `bson:\"fruit\"`\n}\n\nfunc TestUpdate(t *testing.T) {\n        obj1 := MyStruct{Id: bson.NewObjectId(),Fruit: \"apple\"}\n        var obj2 MyStruct\n\n        session, _ := mgo.Dial(\"whatever\")\n        col := session.DB(\"test\").C(\"collection\")\n        col.Insert(&amp;obj1)\n        obj1.Fruit = \"cherry\"\n        if err := col.Update(obj1.Id, bson.M{\"$set\": &amp;obj1}); err != nil {\n                t.Errorf(err.Error())\n        }\n        if err := col.Find(bson.M{\"Id\": obj1.Id}).One(&amp;obj2); err != nil {\n                t.Errorf(err.Error())\n        }\n        if obj1.Fruit != obj2.Fruit {\n                t.Errorf(\"Expected %s, got %s\", obj1.Fruit, obj2.Fruit)\n        }\n}\n</code></pre>\n\n<p>This generates the error message, indicating that the value wasn't updated. What am I missing?</p>\n\n<p>I understand that just updating one field is possible, but given that this is in a data layer, above which the code doesn't have any knowledge of MongoDB, that would be challenging to implement in a general way. I.e. I really need to make any updates to the Go object, and then update the copy of the object in the backing store. I suppose that I could retrieve the object and do a \"diff\" manually, constructing a \"$set\" document, but that doesn't seem like adding a retrieval every time I do an update would be very efficient.</p>\n\n<p><strong>Edit:</strong> Trying a map with \"_id\" deleted</p>\n\n<p>I've tried amending the code to the following:</p>\n\n<pre><code>package testmgo\n\nimport (\n    mgo \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n    \"github.com/fatih/structs\"\n    \"testing\"\n)\n\ntype MyStruct struct {\n    Id     bson.ObjectId `bson:\"_id\"`\n    Fruit string         `bson:\"fruit\"`\n}\n\nfunc TestUpdate(t *testing.T) {\n    obj1 := MyStruct{Id: bson.NewObjectId(),Fruit: \"apple\"}\n    var obj2 MyStruct\n\n    session, _ := mgo.Dial(\"localhost\")\n    col := session.DB(\"test\").C(\"collection\")\n    col.Insert(&amp;obj1)\n    obj1.Fruit = \"cherry\"\n    omap := structs.Map(&amp;obj1)\n    delete(omap, \"_id\")\n\n    if err := col.UpdateId(obj1.Id, bson.M{\"$set\": bson.M(omap)}); err != nil {\n        t.Errorf(err.Error())\n    }\n    if err := col.Find(bson.M{\"Id\": obj1.Id}).One(&amp;obj2); err != nil {\n        t.Errorf(err.Error())\n    }\n    if obj1.Fruit != obj2.Fruit {\n        t.Errorf(\"Expected %s, got %s\", obj1.Fruit, obj2.Fruit)\n    }\n}\n</code></pre>\n\n<p>and am still receiving the same results (<code>Expected cherry, got apple</code>). Note that the call to UpdateId() is not returning an error.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1462541909, "post_id": 37073626, "comment_id": 61692286, "body": "Thanks, it totally make sense now. But using inside a loop for reverse is quite tricky and should be pretty ineffective memory-wise."}, {"owner": {"reputation": 2325, "user_id": 2272638, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4c4d7d86231ea02341f3a868d9d3f8c5?s=128&d=identicon&r=PG", "display_name": "dwanderson", "link": "https://stackoverflow.com/users/2272638/dwanderson"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 1, "creation_date": 1462542054, "post_id": 37073626, "comment_id": 61692389, "body": "Yeah, I remember not being thrilled with that play.golang example, because it&#39;s so contrived as to be confusing, and it didn&#39;t really get at why it ought to be reverse. Glad I could help!"}], "tags": [], "owner": {"reputation": 2325, "user_id": 2272638, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4c4d7d86231ea02341f3a868d9d3f8c5?s=128&d=identicon&r=PG", "display_name": "dwanderson", "link": "https://stackoverflow.com/users/2272638/dwanderson"}, "is_accepted": true, "score": 13, "last_activity_date": 1462541640, "last_edit_date": 1462541640, "creation_date": 1462541220, "answer_id": 37073626, "question_id": 37073538, "link": "https://stackoverflow.com/questions/37073538/why-defer-in-range-loop-is-called-in-a-reverse-order/37073626#37073626", "title": "Why defer in range loop is called in a reverse order?", "body": "<p><code>defer</code> is a <code>LIFO</code>, or a stack - it is guaranteed to executed in reverse order. It gets the first <code>defer</code> and puts it on some internal stack (probably, I don't know the gory details), and then puts the next <code>defer</code> on top of that one, and then when it hits the end of the function, it unwinds, starting at the top. It seems contrived in a <code>for</code>-loop (I know this is Go's example, not yours), but in other cases where one function depends upon the clean-up of some other function, it makes more sense why it SHOULD be, and hence IS, guaranteed to be reverse order of execution.</p>\n\n<p>Here's a different example, all pseudo-code, but hopefully the point is clear.</p>\n\n<pre><code>open stream1\ndefer close stream1\ndefer write stream1 \"stream2 better be closed, or we are in trouble...\"\nopen stream2\ndefer close stream2\ndefer stream2 \"this is the last you'll ever hear from stream2\"\n\nconnect stream2 to stream1\n\nwrite stream2 \"hey, we are in stream2, this feeds into stream1\"\n</code></pre>\n\n<p>Should print something like:</p>\n\n<pre><code>\"hey, we are in stream2, this feeds into stream1\"\n\"this is the last you'll ever hear from stream2\"\n\"stream2 better be closed, or we are in trouble...\"\n</code></pre>\n\n<p>If you didn't have guarantees about reverse ordering, you couldn't be sure <code>stream1</code> was still open during your <code>defer stream2 write</code>.</p>\n"}], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1217, "favorite_count": 1, "accepted_answer_id": 37073626, "answer_count": 1, "score": 10, "last_activity_date": 1532159746, "creation_date": 1462540948, "last_edit_date": 1532159746, "question_id": 37073538, "link": "https://stackoverflow.com/questions/37073538/why-defer-in-range-loop-is-called-in-a-reverse-order", "title": "Why defer in range loop is called in a reverse order?", "body": "<p>I've run across an <a href=\"https://stackoverflow.com/questions/13190836/is-there-a-way-to-iterate-over-a-slice-in-reverse-in-go/35471657#35471657\">answer</a> on a question about \"reverse range\" and I was going to down-vote it as it seemed ridiculously wrong but checked and it actually works(!):</p>\n\n<p><a href=\"https://play.golang.org/p/4K2fDlSoCm\" rel=\"noreferrer\">https://play.golang.org/p/4K2fDlSoCm</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    s := []int{1, 2, 3, 4, 5}\n    for i, _ := range s {\n        defer fmt.Println(s[i])\n    }\n}\n</code></pre>\n\n<p>And the output is:</p>\n\n<pre><code>5\n4\n3\n2\n1\nProgram exited.\n</code></pre>\n\n<p>Any ideas why it works this way? Am I right it's not guaranteed to be executed exactly in the reverse order? Also I don't think it's a good way to write programs but curious to find why are we getting this result.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1462539813, "post_id": 37072815, "comment_id": 61690862, "body": "Why not to check you suspicion by adding logging?"}], "answers": [{"comments": [{"owner": {"reputation": 289, "user_id": 4768715, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/55e2ba38b11b464ad4146a33abbb391d?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Reck", "link": "https://stackoverflow.com/users/4768715/patrick-reck"}, "edited": false, "score": 0, "creation_date": 1462541093, "post_id": 37073142, "comment_id": 61691698, "body": "The code I pasted is directly from the source code of Go (<a href=\"https://golang.org/src/io/ioutil/ioutil.go\" rel=\"nofollow noreferrer\">golang.org/src/io/ioutil/ioutil.go</a> line 76)"}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 289, "user_id": 4768715, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/55e2ba38b11b464ad4146a33abbb391d?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Reck", "link": "https://stackoverflow.com/users/4768715/patrick-reck"}, "edited": false, "score": 0, "creation_date": 1462541298, "post_id": 37073142, "comment_id": 61691840, "body": "Ops. I guess the problem should be in your code. Probably the WriteFile is never called? Add logs &amp; post you own code &amp; logs output."}, {"owner": {"reputation": 289, "user_id": 4768715, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/55e2ba38b11b464ad4146a33abbb391d?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Reck", "link": "https://stackoverflow.com/users/4768715/patrick-reck"}, "edited": false, "score": 0, "creation_date": 1462541411, "post_id": 37073142, "comment_id": 61691917, "body": "It is called, I can run it many times cancelling at a random time, and it&#39;ll randomly leave the file empty. It works fine 9 out of 10 times."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 289, "user_id": 4768715, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/55e2ba38b11b464ad4146a33abbb391d?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Reck", "link": "https://stackoverflow.com/users/4768715/patrick-reck"}, "edited": false, "score": 0, "creation_date": 1462541539, "post_id": 37073142, "comment_id": 61692010, "body": "So may be there is a flaw in the <code>ioutil.WriteFile</code> impementation?  Try to use proposed code and see if it fixes the issue? Let us know on result if you do that."}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 2, "last_activity_date": 1462539731, "creation_date": 1462539731, "answer_id": 37073142, "question_id": 37072815, "link": "https://stackoverflow.com/questions/37072815/writefile-cancelled-mid-way/37073142#37073142", "title": "WriteFile cancelled mid-way", "body": "<p>You should <code>Close()</code> the file using <code>defer</code>. This would flush buffer to file system.</p>\n\n<p>See <a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow\">https://blog.golang.org/defer-panic-and-recover</a></p>\n\n<pre><code>func WriteFile(filename string, data []byte, perm os.FileMode) error {\n    f, err := os.OpenFile(filename, os.O_WRONLY|os.O_CREATE|os.O_TRUNC, perm)\n    if err != nil {\n        return err\n    }\n\n    defer f.Close() // &lt;-- ADD THIS to close file *************************\n\n    n, err := f.Write(data)\n    if err == nil &amp;&amp; n &lt; len(data) {\n        err = io.ErrShortWrite\n    }\n    if err1 := f.Close(); err == nil {\n        err = err1\n    }\n    return err\n}\n</code></pre>\n"}], "owner": {"reputation": 289, "user_id": 4768715, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/55e2ba38b11b464ad4146a33abbb391d?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Reck", "link": "https://stackoverflow.com/users/4768715/patrick-reck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1462539731, "creation_date": 1462538778, "question_id": 37072815, "link": "https://stackoverflow.com/questions/37072815/writefile-cancelled-mid-way", "title": "WriteFile cancelled mid-way", "body": "<p>I am currently writing some identifiers to a file, <code>last_imported.txt</code>. Every time I have imported an identifier, I want the file to contain only that. </p>\n\n<p>It looks like <code>ioutil.WriteFile(\"last_import.txt\", []byte(id), 0644)</code> would do the job, however it randomly leaves the file empty without writing the new identifier when I cancel the job while running, simulating a sudden crash. </p>\n\n<p>I suspect that whenever it leaves it empty, it's because <code>f.write(data)</code> is never reached.</p>\n\n<pre><code>func WriteFile(filename string, data []byte, perm os.FileMode) error {\n    f, err := os.OpenFile(filename, os.O_WRONLY|os.O_CREATE|os.O_TRUNC, perm)\n    if err != nil {\n        return err\n    }\n    n, err := f.Write(data)\n    if err == nil &amp;&amp; n &lt; len(data) {\n        err = io.ErrShortWrite\n    }\n    if err1 := f.Close(); err == nil {\n        err = err1\n    }\n    return err\n}\n</code></pre>\n\n<p>How do I make sure that the file will not be left empty?</p>\n"}, {"tags": ["go", "reactjs", "mattermost"], "answers": [{"tags": [], "owner": {"reputation": 16, "user_id": 3802217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58e3d3f5b3a9540eeb8204a790850356?s=128&d=identicon&r=PG&f=1", "display_name": "enahum", "link": "https://stackoverflow.com/users/3802217/enahum"}, "is_accepted": true, "score": 0, "last_activity_date": 1462585370, "creation_date": 1462585370, "answer_id": 37083636, "question_id": 37072758, "link": "https://stackoverflow.com/questions/37072758/mattermost-test-cases/37083636#37083636", "title": "Mattermost Test cases", "body": "<p>for running mattermost test you should run <code>make test</code> cause there are a few thing that need to be run first. sadly you can't run separate tests files</p>\n"}, {"tags": [], "owner": {"reputation": 16, "user_id": 3802217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58e3d3f5b3a9540eeb8204a790850356?s=128&d=identicon&r=PG&f=1", "display_name": "enahum", "link": "https://stackoverflow.com/users/3802217/enahum"}, "is_accepted": false, "score": 0, "last_activity_date": 1486589774, "creation_date": 1486589774, "answer_id": 42124077, "question_id": 37072758, "link": "https://stackoverflow.com/questions/37072758/mattermost-test-cases/42124077#42124077", "title": "Mattermost Test cases", "body": "<p>You can change directory where the test file is located and then do something like:</p>\n\n<p><code>go test -test.run=\"^TestCreatePost$\"</code></p>\n"}], "owner": {"reputation": 105, "user_id": 5337216, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/b32a76df14c0fb9783eb360ab536c10d?s=128&d=identicon&r=PG&f=1", "display_name": "user5337216", "link": "https://stackoverflow.com/users/5337216/user5337216"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 37083636, "answer_count": 2, "score": 0, "last_activity_date": 1518067028, "creation_date": 1462538603, "question_id": 37072758, "link": "https://stackoverflow.com/questions/37072758/mattermost-test-cases", "title": "Mattermost Test cases", "body": "<p>I am a beginner for Mattermost.I have setup complete mattermost and it runs appropriately.Kindly let me know how can I run and test the test case files like 'post_test.go'.</p>\n"}, {"tags": ["git", "go", "commit", "conflict", "libgit2"], "comments": [{"owner": {"reputation": 5037, "user_id": 1370215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e1295851b018af03706f391b76931?s=128&d=identicon&r=PG", "display_name": "Carlos Mart&#237;n Nieto", "link": "https://stackoverflow.com/users/1370215/carlos-mart%c3%adn-nieto"}, "edited": false, "score": 0, "creation_date": 1462555625, "post_id": 37072576, "comment_id": 61701134, "body": "This code doesn&#39;t show what you do when a conflict happens, which seems to be what you&#39;re asking about. The analysis won&#39;t change just because you&#39;re in a merge, since HEAD and the remote branches won&#39;t have changed, but that doesn&#39;t tell you anything about the merge you&#39;re doing right now."}, {"owner": {"reputation": 5055, "user_id": 1903257, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/op6HW.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1903257/michael"}, "reply_to_user": {"reputation": 5037, "user_id": 1370215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e1295851b018af03706f391b76931?s=128&d=identicon&r=PG", "display_name": "Carlos Mart&#237;n Nieto", "link": "https://stackoverflow.com/users/1370215/carlos-mart%c3%adn-nieto"}, "edited": false, "score": 0, "creation_date": 1462559243, "post_id": 37072576, "comment_id": 61703021, "body": "Yes, it seems I do everything right in the first loop, until I detect the conflict and return to the editor, telling the user to make the changes and save the project again. Then when the user saves the project, I just call the same function and get the same result. I just don&#39;t know how to detect in this function, that the index is in a different state, that there are different paths that are not brought together. You have a hint, how I can find out about this?"}, {"owner": {"reputation": 5037, "user_id": 1370215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e1295851b018af03706f391b76931?s=128&d=identicon&r=PG", "display_name": "Carlos Mart&#237;n Nieto", "link": "https://stackoverflow.com/users/1370215/carlos-mart%c3%adn-nieto"}, "edited": false, "score": 0, "creation_date": 1462561117, "post_id": 37072576, "comment_id": 61703992, "body": "The analysis has nothing to do with the current operation. Check for the current operation to see if you&#39;re in a merge, and you ask the index to see if there are conflicts, so you can avoid committing; if there&#39;s no conflicts, the you can write it as a tree and create a commit with that tree, like any other time"}, {"owner": {"reputation": 5055, "user_id": 1903257, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/op6HW.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1903257/michael"}, "reply_to_user": {"reputation": 5037, "user_id": 1370215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e1295851b018af03706f391b76931?s=128&d=identicon&r=PG", "display_name": "Carlos Mart&#237;n Nieto", "link": "https://stackoverflow.com/users/1370215/carlos-mart%c3%adn-nieto"}, "edited": false, "score": 0, "creation_date": 1462604298, "post_id": 37072576, "comment_id": 61715437, "body": "@CarlosMart&#237;nNieto That was it actually. It works fine now. I had to check if the index has a conflict before I do the analysis and then not do it, but just commit. The working function you find here: <a href=\"https://c2064.org/acp.go\" rel=\"nofollow noreferrer\">c2064.org/acp.go</a> You like put an answer?"}, {"owner": {"reputation": 5055, "user_id": 1903257, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/op6HW.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1903257/michael"}, "reply_to_user": {"reputation": 5037, "user_id": 1370215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e1295851b018af03706f391b76931?s=128&d=identicon&r=PG", "display_name": "Carlos Mart&#237;n Nieto", "link": "https://stackoverflow.com/users/1370215/carlos-mart%c3%adn-nieto"}, "edited": false, "score": 0, "creation_date": 1462689312, "post_id": 37072576, "comment_id": 61737055, "body": "@CarlosMart&#237;nNieto There were some issues with the code I resolved. So now it should work more beta than alpha. ;-) <a href=\"http://c2064.org/acp.go\" rel=\"nofollow noreferrer\">c2064.org/acp.go</a>"}], "answers": [{"tags": [], "owner": {"reputation": 5055, "user_id": 1903257, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/op6HW.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1903257/michael"}, "is_accepted": true, "score": 1, "last_activity_date": 1462859606, "creation_date": 1462859606, "answer_id": 37130254, "question_id": 37072576, "link": "https://stackoverflow.com/questions/37072576/git2go-how-to-handle-simple-merge-conflicts/37130254#37130254", "title": "Git2go: How to handle simple merge conflicts", "body": "<p>I solved the problem. Collision detection worked fine. In case of a not automatically resolvable conflict, the control was given back to the user. He made changes, and those changes weren'T committed before the conflict analysis happened again.</p>\n\n<p>Here is the complete code (the section after \"Merge commit (in case of -- now hopefully resolved -- conflicts) is crucial.\"):</p>\n\n<pre><code>//////////////////////////////////////////////////////////\n// GitAddCommitPush\nfunc GitAddCommitPush(userName string, dir string, message string, firstCommit bool) error {\n\n    ///////////////////////////////////////////////////////////////////////\n    // Add\n    //\n    // 1 Open repository\n    repo, err := git.OpenRepository(dir)\n    if err != nil {\n        beego.Error(\"OpenRepository - \", err)\n    }\n\n    // 2 Retrieve index\n    index, err := repo.Index()\n    if err != nil {\n        beego.Error(\"Index - \", err)\n    }\n\n    // 3 Remember if we had conflicts before we added everything to the index\n    indexHadConflicts := index.HasConflicts()\n\n    // 4 Add everything to the index\n    err = index.AddAll([]string{}, git.IndexAddDefault, nil)\n    if err != nil {\n        beego.Error(\"AddAll - \", err)\n    }\n\n    // 5 Write the index (so git knows about it)\n    err = index.Write()\n    if err != nil {\n        beego.Error(\"Write - \", err)\n    }\n\n    // 6 Write the current index tree to the repo\n    treeId, err := index.WriteTreeTo(repo)\n    if err != nil {\n        beego.Error(\"WriteTreeTo - \", err)\n    }\n\n    /////////////////////////////////////////////////////////////////////////////////////////////\n    // Commit\n    //\n    // 1 Retrieve the tree we just wrote (git's reference of it that it made in the last step)\n    tree, err := repo.LookupTree(treeId)\n    if err != nil {\n        beego.Error(\"LookupTree - \", err)\n    }\n\n    // 2 Create a signature\n    sig := &amp;git.Signature{\n        Name:  userName,\n        Email: userName + \"@\" + beego.AppConfig.String(\"userdata::emailserver\"),\n        When:  time.Now(),\n    }\n\n    // 3 Get remote now (as we need it for both, fetch and later push )\n    remote, err := repo.LookupRemote(\"origin\")\n    if err != nil {\n        remote, err = repo.CreateRemote(\"origin\", repo.Path())\n        if err != nil {\n            beego.Error(\"CreateRemote - \", err)\n        }\n    }\n\n    // 4 Read the remote branch\n    remoteBranch, err := repo.LookupReference(\"refs/remotes/origin/master\")\n    if err != nil {\n        beego.Error(\"Fetch 2 - \", err)\n    }\n\n    // 5 Determine if this is a first commit ...\n    if firstCommit == true {\n\n        // 5a ... then create a new one\n        _, err = repo.CreateCommit(\"HEAD\", sig, sig, message, tree)\n\n    } else {\n\n        // 5b ... or retrieve current head\n        currentBranch, err := repo.Head()\n        if err != nil {\n            beego.Error(\"Head - \", err)\n        }\n\n        // 6 Retrieve current commit\n        currentTip, err := repo.LookupCommit(currentBranch.Target())\n        if err != nil {\n            beego.Error(\"LookupCommit - \", err)\n        }\n\n        // 7 Create a new one on top\n        currentCommit, err := repo.CreateCommit(\"HEAD\", sig, sig, message, tree, currentTip)\n        if err != nil {\n            beego.Error(\"CreateCommit - \", err)\n        }\n\n        ////////////////////////////////////////////////////////////////////////////////////\n        // Merge commit (in case of -- now hopefully resolved -- conflicts)\n        //\n        // 1 If there were conflicts, do the merge commit\n        if indexHadConflicts == true {\n\n            // 2 Retrieve the local commit\n            localCommit, err := repo.LookupCommit(currentCommit)\n            if err != nil {\n                beego.Error(\"Fetch 11 - \", err)\n            }\n\n            // 3 Retrieve the remote commit\n            remoteCommit, err := repo.LookupCommit(remoteBranch.Target())\n            if err != nil {\n                beego.Error(\"Fetch 12 - \", err)\n            }\n\n            // 4 Create a new one\n            repo.CreateCommit(\"HEAD\", sig, sig, \"Merge commit\", tree, localCommit, remoteCommit)\n\n            // 5 Clean up\n            repo.StateCleanup()\n        }\n\n        ///////////////////////////////////////////////////////////////////////////////////\n        // Pull (Fetch and Commit)\n        //\n        // 1 Fetch it (pull without commit)\n        err = remote.Fetch([]string{}, nil, \"\")\n        if err != nil {\n            beego.Error(\"Fetch 1 - \", err)\n        }\n\n        // 2 Perform an annotated commit\n        annotatedCommit, err := repo.AnnotatedCommitFromRef(remoteBranch)\n        if err != nil {\n            beego.Error(\"Fetch 3 - \", err)\n        }\n\n        // 3 Do the merge analysis\n        mergeHeads := make([]*git.AnnotatedCommit, 1)\n        mergeHeads[0] = annotatedCommit\n        analysis, _, err := repo.MergeAnalysis(mergeHeads)\n        if err != nil {\n            beego.Error(\"Fetch 4 - \", err)\n        }\n\n        // 4 Check if something happend\n        if analysis&amp;git.MergeAnalysisUpToDate == 0 &amp;&amp; analysis&amp;git.MergeAnalysisNormal != 0 {\n\n            // 5 Yes! First just merge changes\n            if err := repo.Merge([]*git.AnnotatedCommit{annotatedCommit}, nil, nil); err != nil {\n                beego.Error(\"Fetch 5 - \", err)\n            }\n\n            // 6 Retrieve the index after that treatment\n            index, err := repo.Index()\n            if err != nil {\n                beego.Error(\"Fetch 6 - \", err)\n            }\n\n            // 7 Check for conflicts\n            if index.HasConflicts() {\n\n                // 7a There are not automaticly solvable conflicts ... give them back to the user\n                beego.Trace(\"Conflicts! Write new index and return.\", index)\n                err = index.Write()\n                if err != nil {\n                    beego.Error(\"Write - \", err)\n                }\n\n                return errors.New(\"Conflicts\")\n            }\n\n            // 8 Write the new tree\n            treeId, err := index.WriteTree()\n            if err != nil {\n                beego.Error(\"Fetch 9 - \", err)\n            }\n\n            // 9 Retrieve the new tree\n            tree, err := repo.LookupTree(treeId)\n            if err != nil {\n                beego.Error(\"Fetch 10 - \", err)\n            }\n\n            // 10 Retrieve the local commit\n            localCommit, err := repo.LookupCommit(currentCommit)\n            if err != nil {\n                beego.Error(\"Fetch 11 - \", err)\n            }\n\n            // 11 Retrieve the remote commit\n            remoteCommit, err := repo.LookupCommit(remoteBranch.Target())\n            if err != nil {\n                beego.Error(\"Fetch 12 - \", err)\n            }\n\n            // 12 Create a new one\n            repo.CreateCommit(\"HEAD\", sig, sig, \"Merge commit\", tree, localCommit, remoteCommit)\n\n            // 13 Clean up\n            repo.StateCleanup()\n        }\n    }\n\n    //////////////////////////////////////////////////////////////////////////////////////////////////////\n    // Push\n    err = remote.Push([]string{\"refs/heads/master\"}, nil, sig, message)\n    if err != nil {\n        beego.Error(\"Push - \", err)\n    }\n\n    return err\n}\n</code></pre>\n"}], "owner": {"reputation": 5055, "user_id": 1903257, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/op6HW.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1903257/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 0, "accepted_answer_id": 37130254, "answer_count": 1, "score": 3, "last_activity_date": 1462859606, "creation_date": 1462538131, "question_id": 37072576, "link": "https://stackoverflow.com/questions/37072576/git2go-how-to-handle-simple-merge-conflicts", "title": "Git2go: How to handle simple merge conflicts", "body": "<p>For a simple live coding environment I'm writing a git add, commit and push function, which is working fine, except of the case of conflicts, when two users code in the same part of a file. It performs the conflict analysis correctly and loads the result:</p>\n\n<pre><code>// Live-Editor, Processing / Javascript\nfill(130, 52, 130);\n&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD\ntextSize(130);\n=======\ntextSize(120);\n&gt;&gt;&gt;&gt;&gt;&gt;&gt; master\ntext( \"\ud834\udd20\",160, 100);\n</code></pre>\n\n<p>showing the differences in git style. But when I then make the changes in the editor and add/commit/push again, then it results in the same conflict. It is like it doesn't \"remember\" that the conflict was already there and presents it again. (unlike git command line behaviour.) </p>\n\n<p>Here is my code (I took the error handling out to make it shorter ...)</p>\n\n<pre><code>// Add\nrepo, err := git.OpenRepository(dir)\nindex, err := repo.Index()\nerr = index.AddAll([]string{}, git.IndexAddDefault, nil)\nerr = index.Write()  \ntreeId, err := index.WriteTreeTo(repo)\ntree, err := repo.LookupTree(treeId)\n\n// Commit\nsig := &amp;git.Signature{\n    Name:  userName,\n    Email: userName + \"@\" + beego.AppConfig.String(\"userdata::emailserver\"),\n    When:  time.Now(),\n}\nvar currentCommit *git.Oid\nif firstCommit == true {\n    _, err = repo.CreateCommit(\"HEAD\", sig, sig, message, tree)\n} else {\n    currentBranch, err := repo.Head()\n    currentTip, err := repo.LookupCommit(currentBranch.Target())\n    currentCommit, err = repo.CreateCommit(\"HEAD\", sig, sig, message, tree, currentTip)\n}\n\nremote, err := repo.LookupRemote(\"origin\")\n\n// Pull\nif firstCommit == false {\n    // Pull possible changes from remote repo\n    err = remote.Fetch([]string{}, nil, \"\")\n    remoteBranch, err := repo.LookupReference(\"refs/remotes/origin/master\")\n    annotatedCommit, err := repo.AnnotatedCommitFromRef(remoteBranch)\n\n    // Do the merge analysis\n    mergeHeads := make([]*git.AnnotatedCommit, 1)\n    mergeHeads[0] = annotatedCommit\n    analysis, _, err := repo.MergeAnalysis(mergeHeads)\n\n    if analysis&amp;git.MergeAnalysisUpToDate == 0 &amp;&amp; analysis&amp;git.MergeAnalysisNormal != 0 {\n\n        err := repo.Merge([]*git.AnnotatedCommit{annotatedCommit}, nil, nil)\n\n        // Check for conflicts\n        index, err := repo.Index()    \n        if index.HasConflicts() {\n            err = index.Write()\n            return errors.New(\"Conflicts\")\n        }\n\n        // No unsolvable conflicts, commit it\n        treeId, err := index.WriteTree()\n        tree, err := repo.LookupTree(treeId)\n        localCommit, err := repo.LookupCommit(currentCommit)\n        remoteCommit, err := repo.LookupCommit(remoteBranch.Target())\n        repo.CreateCommit(\"HEAD\", sig, sig, \"Merge commit\", tree, localCommit, remoteCommit)\n        repo.StateCleanup()\n    }\n}\n\n// Push\nerr = remote.Push([]string{\"refs/heads/master\"}, nil, sig, message)\n</code></pre>\n\n<p>I guess the critical section is after <code>// Check for conflicts</code> Somehow that leaves the git directory in a state that let's it perform just the same analysis. I thought about not doing the analysis after the user made the changes and commits the project again, but it is possible that in the meantime another user has already changed something in the remote repo.</p>\n\n<p>How is a good way to handle such conflicts with git2go?</p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 2, "creation_date": 1462537924, "post_id": 37072318, "comment_id": 61689647, "body": "You can launch a console window first (cmd) then run your .exe inside it."}], "answers": [{"comments": [{"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "reply_to_user": {"reputation": 51, "user_id": 6299775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3687ab7df0251586e378bf0bfb76df6?s=128&d=identicon&r=PG&f=1", "display_name": "go-php-2016", "link": "https://stackoverflow.com/users/6299775/go-php-2016"}, "edited": false, "score": 0, "creation_date": 1462539204, "post_id": 37072504, "comment_id": 61690492, "body": "why? It might be easier to solve the problem than to fix your attempt at solving the problem @go-php-2016"}, {"owner": {"reputation": 51, "user_id": 6299775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3687ab7df0251586e378bf0bfb76df6?s=128&d=identicon&r=PG&f=1", "display_name": "go-php-2016", "link": "https://stackoverflow.com/users/6299775/go-php-2016"}, "edited": false, "score": 0, "creation_date": 1462539685, "post_id": 37072504, "comment_id": 61690766, "body": "that the needs of the projects.and I know your the normal way to startup the program."}, {"owner": {"reputation": 51, "user_id": 6299775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3687ab7df0251586e378bf0bfb76df6?s=128&d=identicon&r=PG&f=1", "display_name": "go-php-2016", "link": "https://stackoverflow.com/users/6299775/go-php-2016"}, "edited": false, "score": 0, "creation_date": 1462539776, "post_id": 37072504, "comment_id": 61690829, "body": "and ,we can discuss ,if there is some way to auto build this bat file  or some ?"}], "tags": [], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "is_accepted": false, "score": 2, "last_activity_date": 1462539143, "last_edit_date": 1462539143, "creation_date": 1462537877, "answer_id": 37072504, "question_id": 37072318, "link": "https://stackoverflow.com/questions/37072318/in-golang-how-can-keep-console-window-open-when-the-program-is-done-which-startu/37072504#37072504", "title": "in golang,how can keep console window open when the program is done which startup the exe by double click", "body": "<p>If you need the program to exit completely, but keep the window open, run the program from a console. </p>\n\n<ol>\n<li><code>win+r</code></li>\n<li>type <code>cmd</code></li>\n<li>enter</li>\n<li>navigate to the folder you have the binary in, by using <code>cd myFolder</code> to move into a folder, and <code>cd ..</code> to move one folder up</li>\n<li>run the binary by typing <code>./myBinary.exe</code> and pressing enter</li>\n<li>binary finishes running, and console stays open.</li>\n</ol>\n\n<p><strong>EDIT:</strong><br>\nTo be able to double-click, using pause in a batch-file is the simplest solution:</p>\n\n<p>launch.bat </p>\n\n<pre><code>./myBinary.exe\npause\n</code></pre>\n\n<p>save in same folder as binary, and double-click to run.</p>\n\n<p>You could write a program in a language of your choice that does the same thing as that batch file, if you really want to.</p>\n"}, {"tags": [], "owner": {"reputation": 9975, "user_id": 14738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef8b68858adef176d6dc71a727867b38?s=128&d=identicon&r=PG", "display_name": "jussij", "link": "https://stackoverflow.com/users/14738/jussij"}, "is_accepted": false, "score": 0, "last_activity_date": 1463713699, "creation_date": 1463713699, "answer_id": 37337321, "question_id": 37072318, "link": "https://stackoverflow.com/questions/37072318/in-golang-how-can-keep-console-window-open-when-the-program-is-done-which-startu/37337321#37337321", "title": "in golang,how can keep console window open when the program is done which startup the exe by double click", "body": "<blockquote>\n  <p>BTW,I think some way of open another console window,but fail with this\n  code</p>\n</blockquote>\n\n<p>If you run <em>your_executable.exe</em> using the <em>cmd.exe</em> processor using the <em>/k</em> option it should run the executable and also keep the console open.</p>\n\n<pre><code>cmd.exe /k your_executable.exe\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 573, "user_id": 6349934, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/m7H5u.png?s=128&g=1", "display_name": "CloudBranch", "link": "https://stackoverflow.com/users/6349934/cloudbranch"}, "is_accepted": false, "score": 1, "last_activity_date": 1568929836, "creation_date": 1568929836, "answer_id": 58019320, "question_id": 37072318, "link": "https://stackoverflow.com/questions/37072318/in-golang-how-can-keep-console-window-open-when-the-program-is-done-which-startu/58019320#58019320", "title": "in golang,how can keep console window open when the program is done which startup the exe by double click", "body": "<p>You could call <code>fmt.Scanf()</code>. I know it's hack and you wouldn't want to do it in a production application, but it works.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Printf(\"hello, world\\n\")\n    fmt.Scanf(\"h\")\n}\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 6299775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3687ab7df0251586e378bf0bfb76df6?s=128&d=identicon&r=PG&f=1", "display_name": "go-php-2016", "link": "https://stackoverflow.com/users/6299775/go-php-2016"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4843, "favorite_count": 0, "answer_count": 3, "score": 5, "last_activity_date": 1568929836, "creation_date": 1462537290, "last_edit_date": 1462539310, "question_id": 37072318, "link": "https://stackoverflow.com/questions/37072318/in-golang-how-can-keep-console-window-open-when-the-program-is-done-which-startu", "title": "in golang,how can keep console window open when the program is done which startup the exe by double click", "body": "<p>in windows when startup by double click the .exe\nand when the programe is done by os.Exit(...)\nso,is there anyway to  keep the console window open,just like auto run an cmd command.\nI dontn want some solution with some PAUSE or some others thing to let it wait close.I  need completed exit the program,and keep the console window .</p>\n\n<p>BTW,I think some way of open another console window,but fail with this code</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>c :=exec.Command(\"start\")\r\n\r\n\tif err := c.Run(); err != nil {\r\n\t\tfmt.Println(\"Error: \", err)\r\n\t}\r\n\tos.Exit(0)</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": ["ssl", "curl", "go", "tls1.2"], "answers": [{"tags": [], "owner": {"reputation": 5041, "user_id": 4288305, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-SabTTMIHSb8/AAAAAAAAAAI/AAAAAAAAAjQ/EmdFmLWi2MY/photo.jpg?sz=128", "display_name": "Integralist", "link": "https://stackoverflow.com/users/4288305/integralist"}, "is_accepted": true, "score": 0, "last_activity_date": 1462538150, "creation_date": 1462538150, "answer_id": 37072584, "question_id": 37070394, "link": "https://stackoverflow.com/questions/37070394/go-tls-connection-with-self-signed-certs-failing/37072584#37072584", "title": "Go TLS connection with self-signed certs failing", "body": "<p>So the actual problem here is part related to my organisations infrastructure and part related to how nginx uses <code>ssl_client_certificate</code>.</p>\n\n<p>We have int, test and live environments</p>\n\n<p>I was led to believe that the environments could communicate between each other. </p>\n\n<p>So I had my service setup on int, and I was able to use curl from there to communicate with another service setup in a live environment.</p>\n\n<p>The problem occurred when using Go to communicate across environments.</p>\n\n<p>The quick solution for me was to ensure when I made a GET to this other service, that instead of using:</p>\n\n<pre><code>https://service.live.me.com\n</code></pre>\n\n<p>I would use:</p>\n\n<pre><code>https://service.int.me.com\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>https://service.test.me.com\n</code></pre>\n\n<p>Depending on the environment my code was running within.</p>\n\n<p>Obviously this isn't a solution for other people who have a similar issue but don't have the same setup.</p>\n\n<hr>\n\n<p>So for those of you who still need a solution...</p>\n\n<hr>\n\n<p>What I was also going to try (and apparently worked for <a href=\"http://grokbase.com/t/gg/golang-nuts/153hxbx83h/go-nuts-client-certificate-not-sent-to-server#20150330g5wl7qynxinmtue35cvjcznqf4\" rel=\"nofollow\">this guy</a>) was to get the service that I was trying to communicate with to modify their nginx conf so that they set <code>ssl_client_certificate</code> to not point to just a client cert, but a <em>combined</em> cert (one that includes the entire CA chain).</p>\n\n<p>This was because apparently Go doesn't send back any certs with its response <em>unless</em> the server has passed a CA along with its response.</p>\n\n<p>I had originally suspected this was the classic renegotiation bug in Go 1.6 and below, but that wasn't the case in this scenario.</p>\n\n<p>Hope this helps anyone else in the same boat.</p>\n"}], "owner": {"reputation": 5041, "user_id": 4288305, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-SabTTMIHSb8/AAAAAAAAAAI/AAAAAAAAAjQ/EmdFmLWi2MY/photo.jpg?sz=128", "display_name": "Integralist", "link": "https://stackoverflow.com/users/4288305/integralist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 37072584, "answer_count": 1, "score": 0, "last_activity_date": 1462538150, "creation_date": 1462531460, "question_id": 37070394, "link": "https://stackoverflow.com/questions/37070394/go-tls-connection-with-self-signed-certs-failing", "title": "Go TLS connection with self-signed certs failing", "body": "<p>This following reduced test case code works when run locally on my laptop using my own 'developer' certs for accessing internal services</p>\n\n<p>If I run on a remote machine with dynamically generated certs (all of which is handled by a separate team in my organisation) it fails with a 400 and \"No required SSL certificate was sent\" error</p>\n\n<p>But if I use curl on the remote machine, and specify the same certs as referenced in my Go code, it will work</p>\n\n<p>So seems the certs aren't the issue but the Go code, but that itself doesn't seem to be the issue as it works with my own certs locally</p>\n\n<pre><code>package main\n\nimport (\n  \"crypto/tls\"\n  \"crypto/x509\"\n  \"fmt\"\n  \"io/ioutil\"\n  \"net/http\"\n  \"os\"\n  \"time\"\n)\n\nfunc main() {\n  transport, transErr := configureTLS()\n  if transErr != nil {\n    fmt.Printf(\"trans error: %s\", transErr.Error())\n    return\n  }\n\n  timeout := time.Duration(1 * time.Second)\n  client := http.Client{\n    Transport: transport,\n    Timeout:   timeout,\n  }\n  resp, clientErr := client.Get(\"https://my-service-with-nginx/\")\n\n  if clientErr != nil {\n    fmt.Printf(\"client error: %s\", clientErr.Error())\n  } else {\n    defer resp.Body.Close()\n\n    contents, contErr := ioutil.ReadAll(resp.Body)\n    if contErr != nil {\n      fmt.Printf(\"contents error: %s\", contErr.Error())\n    }\n\n    fmt.Printf(\"\\n\\ncontents:\\n\\n%+v\", string(contents))\n  }\n}\n\nfunc configureTLS() (*http.Transport, error) {\n  certPath := \"/path/to/client.crt\"\n  keyPath := \"/path/to/client.key\"\n  caPath := \"/path/to/ca.crt\"\n\n  // Load client cert\n  cert, err := tls.LoadX509KeyPair(certPath, keyPath)\n  if err != nil {\n    return nil, err\n  }\n\n  // Load CA cert\n  caCert, err := ioutil.ReadFile(caPath)\n  if err != nil {\n    return nil, err\n  }\n  caCertPool := x509.NewCertPool()\n  caCertPool.AppendCertsFromPEM(caCert)\n\n  // Setup HTTPS client\n  tlsConfig := &amp;tls.Config{\n    Certificates:       []tls.Certificate{cert},\n    RootCAs:            caCertPool,\n    InsecureSkipVerify: true,\n  }\n  tlsConfig.BuildNameToCertificate()\n\n  return &amp;http.Transport{TLSClientConfig: tlsConfig}, nil\n}\n</code></pre>\n\n<p>Does anyone know why this would be happening? </p>\n\n<p>I thought it might be the renegotiation bug that Go has (as of 1.6) but I don't think that's the case here as otherwise it would fail for me when running the app locally (but it doesn't, using my own dev certs and running locally works fine - the problem only occurs when run on a remote instance with different certs; and those certs aren't the problem as they work fine when used by <code>curl</code>)</p>\n"}, {"tags": ["ssl", "go", "ssl-certificate"], "comments": [{"owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "edited": false, "score": 0, "creation_date": 1462502907, "post_id": 37060315, "comment_id": 61673237, "body": ".csr &#39;s format is PKCS10, and .crt&#39;s format is PEM. more: <a href=\"http://serverfault.com/questions/9708/what-is-a-pem-file-and-how-does-it-differ-from-other-openssl-generated-key-file\" title=\"what is a pem file and how does it differ from other openssl generated key file\">serverfault.com/questions/9708/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "is_accepted": false, "score": 4, "last_activity_date": 1462483803, "creation_date": 1462483803, "answer_id": 37060595, "question_id": 37060315, "link": "https://stackoverflow.com/questions/37060315/how-do-i-fix-my-pem-block-in-ssl-certificate/37060595#37060595", "title": "How do I fix my PEM block in ssl certificate?", "body": "<p>I was confusing .csr file vs a .crt file.</p>\n"}], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6854, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1462483803, "creation_date": 1462482540, "last_edit_date": 1462483043, "question_id": 37060315, "link": "https://stackoverflow.com/questions/37060315/how-do-i-fix-my-pem-block-in-ssl-certificate", "title": "How do I fix my PEM block in ssl certificate?", "body": "<p>Using golang and gin for an SSL webserver. I made my csr and key files. But I get:</p>\n\n<pre><code>crypto/tls: failed to find \"CERTIFICATE\" PEM block in certificate input\nafter skipping PEM blocks of the following types: [CERTIFICATE REQUEST]\n</code></pre>\n\n<p>Any idea where to go from here? The line that reads the file is:</p>\n\n<p><a href=\"https://github.com/gin-gonic/gin/blob/develop/gin.go#L230\" rel=\"nofollow\">https://github.com/gin-gonic/gin/blob/develop/gin.go#L230</a></p>\n\n<p>I made my files with:</p>\n\n<pre><code>openssl genrsa -des3 -out &lt;private key file name&gt;.key 2048\n\nopenssl req -new -key &lt;private key file name&gt;.key -out &lt;csr file name&gt;.csr \n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 306537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1be452993105b99454b1ed83cae55f33?s=128&d=identicon&r=PG", "display_name": "davidr", "link": "https://stackoverflow.com/users/306537/davidr"}, "edited": false, "score": 0, "creation_date": 1462481415, "post_id": 37059589, "comment_id": 61667064, "body": "Thanks very much for the answer; I feared as much. The actual application I intended this behavior for was for testing Go bindings for a C library for hardware management. I have cgo calls in functions, and when those functions are being tested, I wanted to create a &quot;testdevice&quot; embedding the original &quot;device&quot; type, where I replaced the cgo function-calling functions with functions for the &quot;testdevice&quot; with test functions that just returned C structures from a table. I suspect I need to go back to the drawing board."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 35, "user_id": 306537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1be452993105b99454b1ed83cae55f33?s=128&d=identicon&r=PG", "display_name": "davidr", "link": "https://stackoverflow.com/users/306537/davidr"}, "edited": false, "score": 0, "creation_date": 1462483023, "post_id": 37059589, "comment_id": 61667804, "body": "@user306537 as hobbs also points out below, the way to do this is with an interface. Rather than using embedding, make it so those functions are called from an interface. Then in the test code you have your own implementation of the interface which you use in place of the real one. This is in my experience by far the most common way to achieve things like this in test. You also see similar design quite a bit in the std lib, with things like httproundtripper."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1462480296, "last_edit_date": 1462480296, "creation_date": 1462479740, "answer_id": 37059589, "question_id": 37059377, "link": "https://stackoverflow.com/questions/37059377/accessing-functions-within-embedded-functions/37059589#37059589", "title": "Accessing functions within embedded functions", "body": "<p>What you would like to do is not possible. As you stated, the <code>Human</code> type could never know that it's embedded in the <code>Child</code> type and therefor when <code>Introduce</code> is called it has no way of invoking the <code>Child</code> types version of <code>sayName()</code>. You're trying to invert the relationship, to have an embedded type call out to another version of it's method in the embeddor.</p>\n\n<p>Methods for an embedded type are hoisted to the scope of the embeddor but that is a one way street, which is sensible. In this situation you would just need to structure your code differently. Most likely, whatever behavior you're looking for can be achieved with the use of interfaces rather than embedding. I would provide more of an example but with your code sample there isn't much to say, obviously to solve the problem here you would just call <code>sayName()</code> and would never define <code>Introduce</code> in the first place since it does nothing.</p>\n\n<p>It's possible you should just be embedding in the opposite direction. <code>Human</code> contains no reference to <code>Child</code> but <code>Child</code> does have a reference to <code>Human</code> and, in a case like this, where both have a definition for <code>sayName()</code>, <code>Child</code> could call <code>Human</code>'s by doing <code>c.Human.sayName()</code>. So my intuition says you've embedded in the wrong direction or you should use interfaces. This is purely an assumption, but I would guess you might have the wrong idea since you're referring to <code>Human</code> as the and 'adult' (like the parent) and <code>Child</code> as child (like a child class). This isn't the case at all. Embedding is the same as composition only the embedded types methods and fields are hoisted or lifted or whatever term you like to say they're moved up to the scope of the embeddor. That being said, I see a lot of confusion around this on SO and it's almost always because the asker is looking at this like it's inheritance when really it's composition.</p>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 306537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1be452993105b99454b1ed83cae55f33?s=128&d=identicon&r=PG", "display_name": "davidr", "link": "https://stackoverflow.com/users/306537/davidr"}, "edited": false, "score": 0, "creation_date": 1462483390, "post_id": 37059908, "comment_id": 61667939, "body": "I think I see what you mean. Instead of Introduce() being a function that is received by any particular struct, it changes to a function that has no defined receiver, but instead takes <b>as an argument</b> a &quot;Talker&quot; interface where Talker is defined as a struct implementing sayName()?"}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "reply_to_user": {"reputation": 35, "user_id": 306537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1be452993105b99454b1ed83cae55f33?s=128&d=identicon&r=PG", "display_name": "davidr", "link": "https://stackoverflow.com/users/306537/davidr"}, "edited": false, "score": 0, "creation_date": 1462483682, "post_id": 37059908, "comment_id": 61668065, "body": "@user306537 yes. Sadly go doesn&#39;t allow defining methods with interface recievers (which would allow interfaces to function as roles)."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 1, "last_activity_date": 1462480959, "creation_date": 1462480959, "answer_id": 37059908, "question_id": 37059377, "link": "https://stackoverflow.com/questions/37059377/accessing-functions-within-embedded-functions/37059908#37059908", "title": "Accessing functions within embedded functions", "body": "<p>The way to get this kind of late-bound behavior is to use interfaces. If <code>Introduce</code> was a method on an interface that required a <code>sayName</code> method, then <code>Human</code> and <code>Child</code>  would both satisfy that interface, and could <code>Introduce</code> themselves, and the proper <code>sayName</code> method would be called in either case, because it would be dispatched via the interface type, instead of via <code>Human</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 35, "user_id": 306537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1be452993105b99454b1ed83cae55f33?s=128&d=identicon&r=PG", "display_name": "davidr", "link": "https://stackoverflow.com/users/306537/davidr"}, "is_accepted": false, "score": 0, "last_activity_date": 1462485897, "creation_date": 1462485897, "answer_id": 37061050, "question_id": 37059377, "link": "https://stackoverflow.com/questions/37059377/accessing-functions-within-embedded-functions/37061050#37061050", "title": "Accessing functions within embedded functions", "body": "<p>I was thinking about it incorrectly. as hobbs and evanmcdonnal said, the \"correct\" way to do this is to make the Introduce() function a function with an interface argument and then to create an interface which both Child and Human implement.</p>\n\n<p>The following gives the desired output:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Talker interface {\n    sayName() error\n}\n\ntype Human struct {\n    age  uint\n    name string\n}\n\nfunc (h Human) sayName() error {\n    fmt.Println(\"I am the Adult\")\n    return nil\n}\n\ntype Child struct {\n    Human\n}\n\nfunc Introduce(t Talker) error {\n    t.sayName()\n    return nil\n}\n\nfunc (c Child) sayName() error {\n    fmt.Println(\"I am the Child\")\n    return nil\n}\n\nfunc main() {\n    h := Human{}\n    Introduce(h)\n\n    c := Child{Human{}}\n    Introduce(c)\n}\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 306537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1be452993105b99454b1ed83cae55f33?s=128&d=identicon&r=PG", "display_name": "davidr", "link": "https://stackoverflow.com/users/306537/davidr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 37059908, "answer_count": 3, "score": 1, "last_activity_date": 1462485897, "creation_date": 1462479001, "question_id": 37059377, "link": "https://stackoverflow.com/questions/37059377/accessing-functions-within-embedded-functions", "title": "Accessing functions within embedded functions", "body": "<p>First, I'm quite new to Go, so please forgive any lapses or errors in terminology. I suspect my lack of command with the terminology is also partially to blame for not finding an answer to the following question after many hours of looking.</p>\n\n<p>In short, I would like the output of the following code to be</p>\n\n<pre><code>I am the Adult\nI am the Child\n</code></pre>\n\n<p>Where instead the output is</p>\n\n<pre><code>I am the Adult\nI am the Adult\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Human struct {\n    age  uint\n    name string\n}\n\nfunc (h Human) sayName() error {\n    fmt.Println(\"I am the Adult\")\n    return nil\n}\n\nfunc (h Human) Introduce() error {\n    h.sayName()\n    return nil\n}\n\ntype Child struct {\n    Human\n}\n\nfunc (c Child) sayName() error {\n    fmt.Println(\"I am the Child\")\n    return nil\n}\n\nfunc main() {\n    h := Human{}\n    h.Introduce()\n\n    c := Child{Human{}}\n    c.Introduce()\n}\n</code></pre>\n\n<p>So in essence, though Introduce() is only implemented in the embedded type, Human, it calls sayName(), which is implemented in both the embedded type and the embedding type.</p>\n\n<p>I understand that the current output is the way as it is because the embedded Human struct doesn't \"know\" it's embedded and thus could never call Child.sayName and would only call its own sayName() function.</p>\n\n<p>Is there a way to instantiate a Human struct (or a struct embedding one) in which you can \"replace\" Human.sayName() with an alternate sayName() function?</p>\n"}, {"tags": ["ssl", "go", "tls1.2"], "answers": [{"comments": [{"owner": {"reputation": 1945, "user_id": 451664, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7GIPx.jpg?s=128&g=1", "display_name": "Bryan", "link": "https://stackoverflow.com/users/451664/bryan"}, "edited": false, "score": 0, "creation_date": 1462630075, "post_id": 37072590, "comment_id": 61722901, "body": "Thanks @flowlo, I&#39;ll dig deeper into the PeerCertificates option you suggested. As for Adam&#39;s post on CRLs, I get what he&#39;s saying from a client-side perspective. When using certs for server-side auth though, CRLs are still vital."}, {"owner": {"reputation": 1945, "user_id": 451664, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7GIPx.jpg?s=128&g=1", "display_name": "Bryan", "link": "https://stackoverflow.com/users/451664/bryan"}, "edited": false, "score": 3, "creation_date": 1462631215, "post_id": 37072590, "comment_id": 61723288, "body": "Manually verifying the peer certificates looks to be a valid approach. Would just have to be done as middleware somewhere in the server call stack. For future reference, the code at <a href=\"https://github.com/cloudflare/cfssl/blob/master/revoke/revoke.go\" rel=\"nofollow noreferrer\">github.com/cloudflare/cfssl/blob/master/revoke/revoke.go</a> has some good examples of how to actually compare peer certificates against a CRL."}], "tags": [], "owner": {"reputation": 384, "user_id": 1835188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M582S.png?s=128&g=1", "display_name": "Lorenz Leutgeb", "link": "https://stackoverflow.com/users/1835188/lorenz-leutgeb"}, "is_accepted": true, "score": 9, "last_activity_date": 1462538483, "last_edit_date": 1462538483, "creation_date": 1462538174, "answer_id": 37072590, "question_id": 37058322, "link": "https://stackoverflow.com/questions/37058322/how-can-i-verify-client-certificates-against-a-crl-in-golang/37072590#37072590", "title": "How can I verify client certificates against a CRL in Golang?", "body": "<blockquote>\n  <p>Is it possible to also verify the client certs against a provided CRL?</p>\n</blockquote>\n\n<p>Yes, it is possible, by means of the functionality provided in the <code>crypto/x509</code> package (as you correctly stated in your question). However, higher-level interfaces such as <code>crypto/tls.Config</code> (consumed by <code>net/http</code>) do not offer that. A good chance to implement a check against a CRL probably is by inspecting <code>net/http.Request.TLS.PeerCertificates</code>.</p>\n\n<p>A little bit of background: <a href=\"https://github.com/golang/go/commits/master?author=agl\" rel=\"noreferrer\"><code>crypto/tls</code> is maintained by security expert Adam Langley</a> who has an <a href=\"https://news.ycombinator.com/item?id=7615273\" rel=\"noreferrer\">opinion on revocation checking</a> (original source is <a href=\"https://www.imperialviolet.org/2014/04/19/revchecking.html\" rel=\"noreferrer\">his blog</a>). Though I have no evidence, one might assume that this was a deliberate design decision.</p>\n"}], "owner": {"reputation": 1945, "user_id": 451664, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7GIPx.jpg?s=128&g=1", "display_name": "Bryan", "link": "https://stackoverflow.com/users/451664/bryan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4710, "favorite_count": 2, "accepted_answer_id": 37072590, "answer_count": 1, "score": 4, "last_activity_date": 1462538483, "creation_date": 1462474944, "question_id": 37058322, "link": "https://stackoverflow.com/questions/37058322/how-can-i-verify-client-certificates-against-a-crl-in-golang", "title": "How can I verify client certificates against a CRL in Golang?", "body": "<p>I'm using the <code>ClientCAs</code> and <code>ClientAuth</code> options in <code>tls.Config</code> to do cert-based client authentication in my Go HTTP application. Is it possible to also verify the client certs against a provided CRL? I see in the <code>x509</code> package there are some functions around CRLs, but I'm not sure how to configure the HTTP server to use them (ie. there doesn't seem to be any options in <code>tls.Config</code> that would cause a CRL to also be used).</p>\n"}, {"tags": ["go", "interface"], "answers": [{"tags": [], "owner": {"reputation": 18231, "user_id": 475052, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/dcf2e8035affcf18eef28b9e0d3f1569?s=128&d=identicon&r=PG", "display_name": "Carl Veazey", "link": "https://stackoverflow.com/users/475052/carl-veazey"}, "is_accepted": true, "score": 5, "last_activity_date": 1462476198, "creation_date": 1462476198, "answer_id": 37058695, "question_id": 37058057, "link": "https://stackoverflow.com/questions/37058057/confused-implement-multiple-interfaces-in-go/37058695#37058695", "title": "Confused: implement multiple interfaces in Go", "body": "<p>The <a href=\"https://golang.org/pkg/fmt/#Println\" rel=\"noreferrer\">documentation for Package <code>fmt</code></a> states that:</p>\n\n<blockquote>\n  <p>... special formatting\n  considerations apply for operands that implement certain interfaces.\n  In order of application:</p>\n  \n  <p>...</p>\n  \n  <ol start=\"3\">\n  <li>If the %v verb is used with the # flag (%#v) and the operand implements the GoStringer interface, that will be invoked.</li>\n  </ol>\n  \n  <p>If the format (which is implicitly %v for Println etc.) is valid for a\n  string (%s %q %v %x %X), the following two rules apply:</p>\n  \n  <ol start=\"4\">\n  <li><p>If an operand implements the error interface, the Error method will be invoked ...</p></li>\n  <li><p>If an operand implements method String() string, that method will be invoked ...</p></li>\n  </ol>\n</blockquote>\n\n<p>Since you are using <code>fmt.Println</code>, rules 4 and 5 come into play, which prefers to call <code>Error()</code> over <code>String()</code></p>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 3, "last_activity_date": 1462476209, "creation_date": 1462476209, "answer_id": 37058700, "question_id": 37058057, "link": "https://stackoverflow.com/questions/37058057/confused-implement-multiple-interfaces-in-go/37058700#37058700", "title": "Confused: implement multiple interfaces in Go", "body": "<p>You're ignoring the fact that your function returns a <code>fmt.Stringer</code> by passing the resulting value to <code>fmt.Println</code> as an <code>interface{}</code>.</p>\n\n<p>You see the result from the <code>Error()</code> method only because the <code>fmt</code> package checks for the <code>error</code> interface before it checks for the <code>fmt.Stringer</code> interface.</p>\n"}], "owner": {"reputation": 1037, "user_id": 1070486, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/a5ce3caa2e39211059ca4ee29ca1fdfe?s=128&d=identicon&r=PG", "display_name": "zgcharley", "link": "https://stackoverflow.com/users/1070486/zgcharley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 768, "favorite_count": 0, "accepted_answer_id": 37058695, "answer_count": 2, "score": 1, "last_activity_date": 1462476362, "creation_date": 1462474007, "last_edit_date": 1592644375, "question_id": 37058057, "link": "https://stackoverflow.com/questions/37058057/confused-implement-multiple-interfaces-in-go", "title": "Confused: implement multiple interfaces in Go", "body": "<p>In the below code the type <code>ErrNegativeSqrt</code> implements both <code>Stringer</code> and <code>error</code> interfaces. Since in <code>Sqrt</code> method the return type is <code>fmt.Stringer</code>, I would except the execution result to be:</p>\n<blockquote>\n<p>0 nil</p>\n<p>0 Impl Stringer type</p>\n</blockquote>\n<p>But the actual result is the following, why?</p>\n<blockquote>\n<p>0 nil</p>\n<p>0 Impl error type</p>\n</blockquote>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n)\n\ntype ErrNegativeSqrt float64\n\nfunc Sqrt(x ErrNegativeSqrt) (float64, fmt.Stringer) {\n    if x &lt; 0 {\n        return 0, ErrNegativeSqrt(x)\n    }\n    return 0, nil\n}\n\nfunc (e ErrNegativeSqrt) String() string {\n    return &quot;Impl Stringer type&quot;\n}\n\nfunc (e ErrNegativeSqrt) Error() string {\n    return &quot;Impl error type&quot;\n}\n\nfunc main() {\n    fmt.Println(Sqrt(2))\n    fmt.Println(Sqrt(-2))\n}\n</code></pre>\n"}, {"tags": ["reflection", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 9, "last_activity_date": 1462467388, "creation_date": 1462467388, "answer_id": 37056131, "question_id": 37055400, "link": "https://stackoverflow.com/questions/37055400/using-reflect-to-print-struct-pointer-field-types-in-golang/37056131#37056131", "title": "Using reflect to print struct pointer field types in golang", "body": "<p>Work with <a href=\"https://godoc.org/reflect#Type\" rel=\"noreferrer\">types</a> instead of <a href=\"https://godoc.org/reflect#Value\" rel=\"noreferrer\">values</a>:</p>\n\n<pre><code>t := reflect.TypeOf(item)\nfor i := 0; i &lt; t.NumField(); i++ {\n    ft := t.Field(i).Type\n    if ft.Kind() == reflect.Ptr {\n        ft = ft.Elem()\n    }\n    fmt.Println(ft.Kind())\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/_fmg7NvoPt\" rel=\"noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 1141, "user_id": 2268807, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d2e3bba058d67754cee5d2188a4b5004?s=128&d=identicon&r=PG", "display_name": "circuitry", "link": "https://stackoverflow.com/users/2268807/circuitry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4439, "favorite_count": 2, "accepted_answer_id": 37056131, "answer_count": 1, "score": 5, "last_activity_date": 1462467388, "creation_date": 1462464950, "last_edit_date": 1462467008, "question_id": 37055400, "link": "https://stackoverflow.com/questions/37055400/using-reflect-to-print-struct-pointer-field-types-in-golang", "title": "Using reflect to print struct pointer field types in golang", "body": "<p>I have a struct and I am trying to iterate through all fields to determine whether or not the field is a map (or a pointer to a map). I'm able to compare field kind to reflect.Map for non-pointer fields, but I am having trouble doing the same for pointer fields. If the field has a value I can use Elem() to determine the pointer field type, but if the field is nil that method won't work and I get \"invalid.\" Any ideas on how to accomplish this? <a href=\"https://play.golang.org/p/8hKe4Jh94C\" rel=\"noreferrer\">Playground</a> is here.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Item struct {\n    itemMap    map[string]interface{}\n    itemMapPtr *map[string]interface{}\n}\n\nfunc main() {\n    item := new(Item)\n    printTypes(*item)\n}\n\nfunc printTypes(item Item) {\n    itemVal := reflect.ValueOf(item)\n    for i := 0; i &lt; itemVal.NumField(); i++ {\n        fieldVal := itemVal.Field(i)\n        if fieldVal.Kind() == reflect.Ptr {\n            fieldVal = fieldVal.Elem() // This is only helpful if the field is not nil\n        }\n        fmt.Println(fieldVal.Kind())\n    }\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "data-structures", "struct", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 6290542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc8b430c552f5b187829d9f084769404?s=128&d=identicon&r=PG&f=1", "display_name": "csmallon", "link": "https://stackoverflow.com/users/6290542/csmallon"}, "edited": false, "score": 0, "creation_date": 1462464599, "post_id": 37055171, "comment_id": 61657526, "body": "Unfortunately that isn&#39;t a solution, as sensible as it is, as I didn&#39;t create the dataset I&#39;m using.  Ideally it would be good to know if it was possible to define some kind of mapping from property name -&gt; struct field but the GAE Datastore API doesn&#39;t appear to have anything like this."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1462465199, "post_id": 37055171, "comment_id": 61657892, "body": "It does have the mapping + indexing settings. See my answer."}], "tags": [], "owner": {"reputation": 38473, "user_id": 821657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/qDRGg.png?s=128&g=1", "display_name": "Andrei Volgin", "link": "https://stackoverflow.com/users/821657/andrei-volgin"}, "is_accepted": false, "score": 0, "last_activity_date": 1462464271, "creation_date": 1462464271, "answer_id": 37055171, "question_id": 37054969, "link": "https://stackoverflow.com/questions/37054969/is-there-any-way-to-handle-google-datastore-kind-property-names-with-spaces-in-g/37055171#37055171", "title": "Is there any way to handle Google Datastore Kind Property names with spaces in Golang?", "body": "<p>All programming languages that I know treat a space as the end of a variable/constant name. The obvious solution is to avoid using spaces in property names.</p>\n\n<p>I would also note that a property name becomes a part of every entity and every index entry. I don't know if Google somehow compresses them, but I tend to use short property names in any case.</p>\n"}, {"tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 0, "last_activity_date": 1462465160, "creation_date": 1462465160, "answer_id": 37055452, "question_id": 37054969, "link": "https://stackoverflow.com/questions/37054969/is-there-any-way-to-handle-google-datastore-kind-property-names-with-spaces-in-g/37055452#37055452", "title": "Is there any way to handle Google Datastore Kind Property names with spaces in Golang?", "body": "<p>You can use annotations to rename properties.</p>\n\n<p>From the <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference\" rel=\"nofollow\">docs</a>:</p>\n\n<pre><code>// A and B are renamed to a and b.\n// A, C and J are not indexed.\n// D's tag is equivalent to having no tag at all (E).\n// I is ignored entirely by the datastore.\n// J has tag information for both the datastore and json packages.\ntype TaggedStruct struct {\n    A int `datastore:\"a,noindex\"`\n    B int `datastore:\"b\"`\n    C int `datastore:\",noindex\"`\n    D int `datastore:\"\"`\n    E int\n    I int `datastore:\"-\"`\n    J int `datastore:\",noindex\" json:\"j\"`\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 1, "creation_date": 1462466785, "post_id": 37055454, "comment_id": 61658844, "body": "Cool. Thanks for bring to my knowledge the PropertyList type! You answer is way superior to mine."}, {"owner": {"reputation": 63, "user_id": 6290542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc8b430c552f5b187829d9f084769404?s=128&d=identicon&r=PG&f=1", "display_name": "csmallon", "link": "https://stackoverflow.com/users/6290542/csmallon"}, "edited": false, "score": 0, "creation_date": 1462467497, "post_id": 37055454, "comment_id": 61659242, "body": "That&#39;s a cracking answer, even if it didn&#39;t give me what I needed. I <i>may</i> actually do what you suggest on my struct in this case, as I&#39;m 99% there with my app and it would be a shame to give up now :) Cheers!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1470645305, "last_edit_date": 1495540301, "creation_date": 1462465168, "answer_id": 37055454, "question_id": 37054969, "link": "https://stackoverflow.com/questions/37054969/is-there-any-way-to-handle-google-datastore-kind-property-names-with-spaces-in-g/37055454#37055454", "title": "Is there any way to handle Google Datastore Kind Property names with spaces in Golang?", "body": "<p>Actually Go supports mapping entity property names to different struct field names using tags (see this answer for details: <a href=\"https://stackoverflow.com/a/30889373/1705598\">What are the use(s) for tags in Go?</a>).</p>\n\n<p>For example:</p>\n\n<pre><code>type Row struct {\n    Prop1    string `datastore:\"Prop1InDs\"`\n    Prop2    int    `datastore:\"p2\"`\n}\n</code></pre>\n\n<p>But the Go implementation of the <code>datastore</code> package panics if you attempt to use a property name which contains a space.</p>\n\n<p>To sum it up: <strong>you can't map property names having spaces to struct fields in Go</strong> (this is an implementation restriction which may change in the future).</p>\n\n<p>But the good news is that you can still load these entities, just not into struct values.</p>\n\n<p>You may load them into a variable of type <code>datastore.PropertyList</code>. <code>datastore.PropertyList</code> is basically a slice of <code>datastore.Property</code>, where <code>Property</code> is a struct which holds the name of the property, its value and other info.</p>\n\n<p>This is how it can be done:</p>\n\n<pre><code>k := datastore.NewKey(ctx, \"YourEntityName\", \"\", 1, nil) // Create the key\ne := datastore.PropertyList{}\n\nif err := datastore.Get(ctx, k, &amp;e); err != nil {\n    panic(err) // Handle error\n}\n\n// Now e holds your entity, let's list all its properties.\n// PropertyList is a slice, so we can simply \"range\" over it:\nfor _, p := range e {\n    ctx.Infof(\"Property %q = %q\", p.Name, p.Value)\n}\n</code></pre>\n\n<p>If your entity has a property <code>\"Have space\"</code> with value <code>\"the_value\"</code>, you will see for example:</p>\n\n<pre><code>2016-05-05 18:33:47,372 INFO: Property \"Have space\" = \"the_value\"\n</code></pre>\n\n<p>Note that you could implement the <code>datastore.PropertyLoadSaver</code> type on your struct and handle this under the hood, so basically you could still load such entities into struct values, but you have to implement this yourself.</p>\n\n<p>But fight for entity names and property names to not have spaces. You will make your life harder and miserable if you allow these.</p>\n"}], "owner": {"reputation": 63, "user_id": 6290542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc8b430c552f5b187829d9f084769404?s=128&d=identicon&r=PG&f=1", "display_name": "csmallon", "link": "https://stackoverflow.com/users/6290542/csmallon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 794, "favorite_count": 0, "accepted_answer_id": 37055454, "answer_count": 3, "score": 1, "last_activity_date": 1536075835, "creation_date": 1462463689, "last_edit_date": 1536075835, "question_id": 37054969, "link": "https://stackoverflow.com/questions/37054969/is-there-any-way-to-handle-google-datastore-kind-property-names-with-spaces-in-g", "title": "Is there any way to handle Google Datastore Kind Property names with spaces in Golang?", "body": "<p>I'm running in a nasty issue with Datastore that doesn't appear to have any workaround.</p>\n\n<p>I'm using the Google Appengine Datastore package to pull back projection query results into Appengine memory for manipulation, and that is being accomplished with representing each entity as a Struct, with each Struct field corresponding to a Property name, like so:</p>\n\n<pre><code>type Row struct {\nProp1    string\nProp2    int\n}\n</code></pre>\n\n<p>This works great, but I've extended my queries into reading other property names that have spaces. While the query runs fine, it can't pull the data back into structs as it's looking to place the given value into a struct of the same naming convention, and I'm getting this kind of error:</p>\n\n<pre><code>datastore: cannot load field \"Viewed Registration Page\" into a \"main.Row\": no such struct field\n</code></pre>\n\n<p>Obviously Golang cannot represent a struct field like this. There is a field of the relevant type but no obvious way to tell the query to place it there.</p>\n\n<p>What would be the best solution here?    </p>\n\n<p>Cheers</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1462463950, "post_id": 37054878, "comment_id": 61657141, "body": "If you&#39;re working with UDP, you have a UDPConn which has methods to write to a specific address. Can you show an example of what you&#39;re doing?"}], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 1, "last_activity_date": 1462465262, "creation_date": 1462465262, "answer_id": 37055491, "question_id": 37054878, "link": "https://stackoverflow.com/questions/37054878/one-socket-to-reach-multiple-addresses/37055491#37055491", "title": "one socket to reach multiple addresses", "body": "<p>Use <a href=\"https://golang.org/pkg/net/#ListenUDP\" rel=\"nofollow\">net.ListenUDP</a> to create a UDP socket with a desired local port (or 0 to get an available port assigned). This will give you a <a href=\"https://golang.org/pkg/net/#UDPConn\" rel=\"nofollow\">net.UDPConn</a> which has <a href=\"https://golang.org/pkg/net/#UDPConn.WriteTo\" rel=\"nofollow\">WriteTo</a> and <a href=\"https://golang.org/pkg/net/#UDPConn.ReadFrom\" rel=\"nofollow\">ReadFrom</a> methods (equivalent to <code>sendto</code> and <code>recvfrom</code>). The difference between WriteTo/ReadFrom and WriteToUDP/ReadFromUDP is that the former implement the generic <a href=\"https://golang.org/pkg/net/#PacketConn\" rel=\"nofollow\">PacketConn</a> interface, while the latter are UDP-specific, which can reduce the amount of casting if you know you're always using UDP.</p>\n"}], "owner": {"reputation": 196, "user_id": 1191127, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/5ce9db50f4f36076e66d7136ba59ca94?s=128&d=identicon&r=PG", "display_name": "tux_mind", "link": "https://stackoverflow.com/users/1191127/tux-mind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 37055491, "answer_count": 1, "score": 0, "last_activity_date": 1462465262, "creation_date": 1462463420, "question_id": 37054878, "link": "https://stackoverflow.com/questions/37054878/one-socket-to-reach-multiple-addresses", "title": "one socket to reach multiple addresses", "body": "<p>I have to send an UDP packet to each host of the network, say N hosts.</p>\n\n<p>My current C implementation it's pretty simple:</p>\n\n<ul>\n<li>open an UDP socket</li>\n<li>use <code>sendto</code> over the same socket for every host</li>\n</ul>\n\n<p>With Go I have <code>net.Conn</code> ( Connection ), not sockets.</p>\n\n<p>How can I send UDP packets to different hosts using only one fd ?</p>\n\n<p>As now I have to close and open a <code>net.Conn</code> N times.</p>\n\n<p>Thank you in advance for your help :)</p>\n"}, {"tags": ["encryption", "file-io", "go", "cryptography"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1462458938, "post_id": 37052943, "comment_id": 61653810, "body": "Reading and writing to files isn&#39;t going to alter the data. You can test this easily by writing and reading to a buffer in memory. (also, please format your code correctly)"}], "answers": [{"tags": [], "owner": {"reputation": 50, "user_id": 4259293, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4c42a35ecaf014a52ad6a8485dfed72?s=128&d=identicon&r=PG&f=1", "display_name": "Manuel Valle", "link": "https://stackoverflow.com/users/4259293/manuel-valle"}, "is_accepted": true, "score": 3, "last_activity_date": 1462460587, "creation_date": 1462460587, "answer_id": 37053986, "question_id": 37052943, "link": "https://stackoverflow.com/questions/37052943/reading-in-from-file/37053986#37053986", "title": "Reading in from file", "body": "<p>In line 167 you are calling your encrypt function with <code>label = []byte(product)</code>.</p>\n\n<p>In line 120 you are calling your decrypt function with a <code>label</code> variable that has been defined but not initialized (i.e. you are sending an empty byte array) </p>\n\n<pre><code>decrypted = decrypt_oaep(private_key, encrypted, label)\n</code></pre>\n\n<p>Because of that, your decryption won't work. From the docs:</p>\n\n<blockquote>\n  <p>The label parameter must match the value given when encrypting\n  - <a href=\"https://golang.org/pkg/crypto/rsa/#DecryptOAEP\" rel=\"nofollow\">https://golang.org/pkg/crypto/rsa/#DecryptOAEP</a></p>\n</blockquote>\n\n<p><strong>Solution:</strong>\nIn the decryption call (line 120) send <code>[]byte(product)</code> as the label parameter.</p>\n"}], "owner": {"reputation": 25, "user_id": 6150495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3a21b7e3f8800b38f4bf3c28d1b0887?s=128&d=identicon&r=PG&f=1", "display_name": "struggling college kid", "link": "https://stackoverflow.com/users/6150495/struggling-college-kid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 37053986, "answer_count": 1, "score": 2, "last_activity_date": 1462460587, "creation_date": 1462457689, "question_id": 37052943, "link": "https://stackoverflow.com/questions/37052943/reading-in-from-file", "title": "Reading in from file", "body": "<p>I am working on making a basic password keeper in Golang and want to be able to store the passwords encrypted using RSA. My encryption function and decryption functions both work and will encrypt and decrypt correctly. However after storing the password in a file and then reading the password back from the file the decryption function fails. I have checked to make sure that the reading in of the RSA key is correct and that is not my problem as reading in the RSA key works correctly.\nHere is how I am writing my encrypted password to the file</p>\n\n<pre><code>ioutil.WriteFile(filename, encPassword, 0644)\n</code></pre>\n\n<p>and here is how I am reading back the password</p>\n\n<pre><code>encrypted, err = ioutil.ReadFile(encryptedFileName)\n</code></pre>\n\n<p>When I run my program I am currently receiving this error code</p>\n\n<pre><code>failed in decrypt_oaep: crypto/rsa: decryption error\nexit status 1\n</code></pre>\n\n<p>My belief is that Read or Write file is adding something to the contents of the file because if I try and decrypt the password before the encrypted password is written or read from a file it will work fine. Any help would be appreciated.</p>\n\n<p>If you need more code I can post more of it later.</p>\n\n<p>Edit: here is a link to codeshare with my entire code: <a href=\"https://codeshare.io/PtMxk\" rel=\"nofollow\">https://codeshare.io/PtMxk</a></p>\n"}, {"tags": ["http", "ssl", "go", "mutex"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 13, "last_activity_date": 1462457725, "creation_date": 1462457725, "answer_id": 37052960, "question_id": 37052757, "link": "https://stackoverflow.com/questions/37052757/how-to-get-around-assignment-copies-lock-value-to-tr-net-http-transport-contain/37052960#37052960", "title": "How to get around assignment copies lock value to tr: net/http.Transport contains sync.Mutex", "body": "<p>You should be creating a <code>*http.Transport</code> pointer, instead of a value</p>\n\n<pre><code>tr = &amp;http.Transport{\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1529891"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7545, "favorite_count": 0, "accepted_answer_id": 37052960, "answer_count": 1, "score": 7, "last_activity_date": 1462458035, "creation_date": 1462457181, "last_edit_date": 1462458035, "question_id": 37052757, "link": "https://stackoverflow.com/questions/37052757/how-to-get-around-assignment-copies-lock-value-to-tr-net-http-transport-contain", "title": "How to get around assignment copies lock value to tr: net/http.Transport contains sync.Mutex", "body": "<p>When I run <code>go vet</code> the following error is output:</p>\n\n<pre><code>client.go:2345: assignment copies lock value to tr: net/http.Transport contains sync.Mutex\nexit status 1\n</code></pre>\n\n<p>client.go:2345:</p>\n\n<pre><code>var tr http.Transport\n\n// Setup TLS\nif clientConfig.TLSEnabled {\n    tr = http.Transport{ // This is line 2345\n        TLSClientConfig: &amp;tls.Config{\n            InsecureSkipVerify: true,\n            MinVersion: tls.VersionTLS11,\n        },\n    }\n}\n</code></pre>\n\n<p>How can I get around this warning? It's not stopping my builds; but, it's a warning and I don't want warnings.</p>\n"}]