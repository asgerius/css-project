[{"tags": ["go"], "comments": [{"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 1, "creation_date": 1516228978, "post_id": 48311165, "comment_id": 83608197, "body": "You cannot send and receive on channel <code>doneChan</code> in the same goroutine. I suggest sending the done signal from the main goroutine."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516229065, "post_id": 48311165, "comment_id": 83608239, "body": "Are you expecting separate calls to <code>timeTick</code> to somehow execute <code>doneChan &lt;- true</code> from another goroutine?"}, {"owner": {"reputation": 638, "user_id": 1732875, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/2OTKl.png?s=128&g=1", "display_name": "Jahm", "link": "https://stackoverflow.com/users/1732875/jahm"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516232396, "post_id": 48311165, "comment_id": 83609309, "body": "@JimB yes that&#39;s the idea."}, {"owner": {"reputation": 638, "user_id": 1732875, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/2OTKl.png?s=128&g=1", "display_name": "Jahm", "link": "https://stackoverflow.com/users/1732875/jahm"}, "reply_to_user": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 0, "creation_date": 1516232586, "post_id": 48311165, "comment_id": 83609360, "body": "@dev.bmax what are needed to be changed on my code? Can you please show me how?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516232863, "post_id": 48311165, "comment_id": 83609443, "body": "@Jahm: you have some broad misunderstandings of how things work, but in short you&#39;re going to want to pass in the control channels into your functions, either as arguments or in closures."}, {"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 0, "creation_date": 1516234012, "post_id": 48311165, "comment_id": 83609731, "body": "Check out this example: <a href=\"https://stackoverflow.com/a/36709984/4283005\">stackoverflow.com/a/36709984/4283005</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "is_accepted": true, "score": 3, "last_activity_date": 1516237014, "creation_date": 1516237014, "answer_id": 48312313, "question_id": 48311165, "link": "https://stackoverflow.com/questions/48311165/triggering-and-stopping-time-ticker-channel-in-golang-manually/48312313#48312313", "title": "Triggering and stopping time.Ticker channel in Golang manually", "body": "<p>You need to pass in the channel used to signal completion. You always want to cancel the current ticker if there is one, so you can attempt a send in each iteration of the main <code>for</code> loop. Since the channel isn't buffered, a send operation is blocking, so you need to attempt the send in a select statement with a default case to prevent a deadlock in the case you don't have a current ticker attempting to read from the channel.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"strings\"\n    \"time\"\n)\n\nfunc main() {\n    reader := bufio.NewReader(os.Stdin)\n    tickerDone := make(chan struct{})\n\n    for {\n        fmt.Print(\"&gt; \")\n\n        text, _ := reader.ReadString('\\n')\n        text = strings.Replace(text, \"\\n\", \"\", -1)\n\n        select {\n        case tickerDone &lt;- struct{}{}:\n        default:\n        }\n\n        switch text {\n        case \"one\":\n            go timeTick(1, tickerDone)\n        case \"two\":\n            go timeTick(2, tickerDone)\n        case \"three\":\n            go timeTick(3, tickerDone)\n        }\n    }\n}\n\nfunc timeTick(tick int, done &lt;-chan struct{}) {\n    tickChan := time.NewTicker(time.Second * time.Duration(tick))\n\n    for {\n        select {\n        case &lt;-tickChan.C:\n            fmt.Println(\"Ticker ticked\")\n        case &lt;-done:\n            fmt.Println(\"Done\")\n            return\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 306, "user_id": 2536252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e29959d1027ff89ba83767e9d9517a?s=128&d=identicon&r=PG", "display_name": "Adriel Artiza", "link": "https://stackoverflow.com/users/2536252/adriel-artiza"}, "is_accepted": false, "score": 0, "last_activity_date": 1516283508, "last_edit_date": 1516283508, "creation_date": 1516283184, "answer_id": 48322861, "question_id": 48311165, "link": "https://stackoverflow.com/questions/48311165/triggering-and-stopping-time-ticker-channel-in-golang-manually/48322861#48322861", "title": "Triggering and stopping time.Ticker channel in Golang manually", "body": "<p>You can try this code below also. I put buffered channel outside the function for synchronize execution, I also used channel receiver to assign and to stop channel.</p>\n\n<pre><code>func timeTick(flag bool, tick int,doneChan chan bool) {\n    var tickChan *time.Ticker\n    msg := make(&lt;-chan time.Time) // channel receiver\n\n    if flag {\n        tickChan = time.NewTicker(time.Second * time.Duration(tick))\n    }\n\n    if !flag {\n        doneChan &lt;- true    \n        &lt;-msg\n    }\n\n    if tickChan != nil { // Check if nil\n        msg = tickChan.C\n    }\n\n    for {\n        select {\n            case &lt;-msg:\n                fmt.Println(\"Ticker ticked \")\n            case &lt;-doneChan:\n                fmt.Println(\"Done \")\n                return\n        }\n    }\n}\n\nfunc main() {\n\n    reader := bufio.NewReader(os.Stdin)\n    doneChan := make(chan bool,1)\n    for \n    {\n        fmt.Print(\"&gt; \")\n        text, _ := reader.ReadString('\\n')\n        text = strings.Replace(text, \"\\n\", \"\", -1)\n\n        switch text {\n        case \"one\":\n            go timeTick(true, 1, doneChan)\n        case \"two\":\n            go timeTick(true, 2, doneChan)\n        case \"three\":\n            go timeTick(true, 3, doneChan)\n        default:\n            go timeTick(false, 0, doneChan)\n        }\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 638, "user_id": 1732875, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/2OTKl.png?s=128&g=1", "display_name": "Jahm", "link": "https://stackoverflow.com/users/1732875/jahm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3983, "favorite_count": 0, "accepted_answer_id": 48312313, "answer_count": 2, "score": 1, "last_activity_date": 1516283508, "creation_date": 1516228735, "question_id": 48311165, "link": "https://stackoverflow.com/questions/48311165/triggering-and-stopping-time-ticker-channel-in-golang-manually", "title": "Triggering and stopping time.Ticker channel in Golang manually", "body": "<p>So I have this code, it accepts user entry of <code>one</code>, <code>two</code>, or <code>three</code>. It prints <code>Ticker ticked</code> depending on the duration selected. I need help on how to stop the ticker first before activating the ticker again with a different duration.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"strings\"\n    \"time\"\n)\n\nfunc main() {\n    reader := bufio.NewReader(os.Stdin)\n\n    for {\n        fmt.Print(\"&gt; \")\n\n        text, _ := reader.ReadString('\\n')\n        text = strings.Replace(text, \"\\n\", \"\", -1)\n\n        switch text {\n        case \"one\":\n            go timeTick(true, 1)\n        case \"two\":\n            go timeTick(true, 2)\n        case \"three\":\n            go timeTick(true, 3)\n        default:\n            go timeTick(false, 0)\n        }\n    }\n}\n\nfunc timeTick(flag bool, tick int) {\n    var tickChan *time.Ticker\n\n    if flag {\n        tickChan = time.NewTicker(time.Second * time.Duration(tick))\n    }\n\n    doneChan := make(chan bool)\n\n    if !flag {\n        doneChan &lt;- true\n    }\n\n    for {\n        select {\n        case &lt;-tickChan.C:\n            fmt.Println(\"Ticker ticked\")\n        case &lt;-doneChan:\n            fmt.Println(\"Done\")\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>So user inputs either, <code>one</code>, <code>two</code>, or <code>three</code> to activate the ticker else it will send <code>true</code> to <code>doneChan</code> channel.</p>\n\n<p>When I activated the ticker with <code>one</code>. It prints <code>Ticker ticked</code> every second but how do I stop the ticker when I input <code>two</code> or <code>three</code> while the ticker is running? It then brings me to my main question, why is <code>doneChan</code> not triggered at all even inputting a random string?</p>\n"}, {"tags": ["mysql", "database", "go", "orm", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1516230296, "post_id": 48311125, "comment_id": 83608699, "body": "I&#39;m not a gorm user but how would you expect this to work? You don&#39;t provide a foreign key value when inserting, you only provide the currency code which is not the foreign key and is not even unique, how is the orm supposed to know your thoughts?"}, {"owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1516230658, "post_id": 48311125, "comment_id": 83608827, "body": "@mkopriva I&#39;d imagine that there&#39;s at least one way of doing that by using a subquery with WHERE currency_code = &quot;USD&quot;."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1516231329, "post_id": 48311125, "comment_id": 83609039, "body": "Given your table schema <code>WHERE currency_code = &quot;USD&quot;</code> may return multiple rows... regardless of that, without making the currency code the actual foreign key the orm would have to make assumptions based on whatever to meet your expectations, those expectations would most certainly be at odds with the expectations of the majority of gorm&#39;s users. It seems logical to me that the orm creates a new record if no fkey is provided, and links to an existing record if one is provided, don&#39;t you think?"}, {"owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1516268648, "post_id": 48311125, "comment_id": 83621713, "body": "@mkopriva how about something like: <code>INSERT INTO rates (currency_id, price) VALUES     ((SELECT id FROM currencies WHERE currency_code = &quot;USD&quot;), 123.12);</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1516268866, "post_id": 48311125, "comment_id": 83621851, "body": "Seems ok to me if you write that sql yourself as opposed to rely on an orm to do it for you. But make sure currency_code is unique."}], "answers": [{"comments": [{"owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "edited": false, "score": 0, "creation_date": 1516268414, "post_id": 48317711, "comment_id": 83621562, "body": "<code>use fixed number of chars to make it faster, not varchar</code>- I&#39;m already using that right? <code>char(3)</code> in DB schema and <code>CurrencyCode string &#39;gorm:&quot;size:3&quot;&#39;</code> in go code."}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "reply_to_user": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "edited": false, "score": 0, "creation_date": 1516268460, "post_id": 48317711, "comment_id": 83621593, "body": "yeah right, I did not notice that, but it will still make it a varchar of length 3."}, {"owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "edited": false, "score": 0, "creation_date": 1516268512, "post_id": 48317711, "comment_id": 83621623, "body": "And I don&#39;t understand how using <code>currency_code</code> as PRIMARY KEY would help me here"}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "reply_to_user": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "edited": false, "score": 0, "creation_date": 1516268642, "post_id": 48317711, "comment_id": 83621706, "body": "Because you do not have to search by ID anymore, it would just find &quot;USD&quot; as primary key and use it =&gt; no more multiple records per currency."}], "tags": [], "owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "is_accepted": false, "score": 1, "last_activity_date": 1516268864, "last_edit_date": 1516268864, "creation_date": 1516267381, "answer_id": 48317711, "question_id": 48311125, "link": "https://stackoverflow.com/questions/48311125/can-gorm-db-automatically-resolve-foreign-keys/48317711#48317711", "title": "Can gorm.DB automatically resolve foreign keys?", "body": "<p>In their <a href=\"http://jinzhu.me/gorm/crud.html#associations\" rel=\"nofollow noreferrer\">documentation</a> it states: </p>\n\n<blockquote>\n  <p>By default when creating/updating a record, GORM will save its associations, if the association has primary key, GORM will call Update to save it, otherwise it will be created.</p>\n</blockquote>\n\n<p>So when you want to map to a certain entry you must correlate it with the ID, otherwise it will create a new record. </p>\n\n<p>In your case you could use the <code>currency_code</code> as the <strong>PRIMARY KEY</strong> for <code>Currency</code> (use fixed number of chars to make it faster, not varchar, like <code>sql:\"type:char(3);unique\"</code>). </p>\n\n<p>This would eliminate the need of a search by ID anymore, it would just find \"USD\" as primary key and use it => no more multiple records per currency. Also if there is a currency that it does not have, it will create it in the <code>Currency</code> table.</p>\n\n<p>Also you can eliminate the <code>gorm:\"ForeignKey:CurrencyID\"</code> struct tag and let GORM create it's own tables with <a href=\"http://jinzhu.me/gorm/database.html#migration\" rel=\"nofollow noreferrer\">AutoMigrate</a>, and would create the tables with the appropriate FK: </p>\n\n<pre><code>db := gorm.Open(\"mysql\", ...)\ndb.Set(\"gorm:table_options\", \"ENGINE=InnoDB\")\ndb.Set(\"gorm:table_options\", \"collation_connection=utf8_general_ci\")\n// Migrate the schema\ndb.AutoMigrate(&amp;models.Currency{})\ndb.AutoMigrate(&amp;models.Rate{})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 25, "user_id": 12653918, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Ym3zw39nkvU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reHZtmeq-3qATswWR7KNP2nJyr5LA/photo.jpg?sz=128", "display_name": "Aliyu Israel", "link": "https://stackoverflow.com/users/12653918/aliyu-israel"}, "is_accepted": false, "score": 0, "last_activity_date": 1599327776, "creation_date": 1599327776, "answer_id": 63756845, "question_id": 48311125, "link": "https://stackoverflow.com/questions/48311125/can-gorm-db-automatically-resolve-foreign-keys/63756845#63756845", "title": "Can gorm.DB automatically resolve foreign keys?", "body": "<p>In recently released GORM 2.0, foreign keys get added to your database automatically provided your GORM tags are correct. You can say AutoMigrate got smarter.</p>\n<p>Just upgrade and use the new imports</p>\n<pre><code>go get gorm.io/gorm\n\nimport (\n  &quot;gorm.io/gorm&quot;\n  &quot;gorm.io/driver/sqlite&quot; //or whatever driver\n)\n</code></pre>\n<p>PS: There are some breaking changes with the new version, kindly check the official relase note for more info <a href=\"https://gorm.io/docs/v2_release_note.html\" rel=\"nofollow noreferrer\">https://gorm.io/docs/v2_release_note.html</a></p>\n"}], "owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2720, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1599327776, "creation_date": 1516228555, "last_edit_date": 1516268935, "question_id": 48311125, "link": "https://stackoverflow.com/questions/48311125/can-gorm-db-automatically-resolve-foreign-keys", "title": "Can gorm.DB automatically resolve foreign keys?", "body": "<p>I'm trying to use <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm</a> to automatically map foreign keys for me but somehow either I'm doing it wrong or the library cannot do it and I'm in the wrong.</p>\n\n<p>I have the following <code>struct</code>s:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Currency struct {\n  ID           uint64 `gorm:\"primary_key\"`\n  CurrencyCode string `gorm:\"size:3\"`\n}\n\ntype Rate struct {\n  ID          uint64 `gorm:\"primary_key\"`\n  CurrencyID  uint64\n  Currency    Currency `gorm:\"ForeignKey:CurrencyID\"`\n  Price       float64\n}\n</code></pre>\n\n<p>and the following SQL tables (<strong>edited so that currency_code is unique</strong>)</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE TABLE `rates` (\n  `id` serial PRIMARY KEY,\n  `currency_id` bigint unsigned NOT NULL,\n  `price` decimal(12,2) NOT NULL,\n  CONSTRAINT `fk_rate_currency`\n    FOREIGN KEY (currency_id) REFERENCES currencies(id)\n);\n\nCREATE TABLE `currencies` (\n  `id` serial PRIMARY KEY,\n  `currency_code` char(3) NOT NULL UNIQUE\n);\n</code></pre>\n\n<p>Now I thought that when I do something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>rate := Rate{\n  Currency: Currency{\n    CurrencyCode: \"USD\",\n  },\n  Price: 123,\n}\ndb, _  := gorm.Open(\"mysql\", ...)\ndb.Create(&amp;rate)\n</code></pre>\n\n<p>then <code>\"USD\"</code> would get automatically mapped to a <code>currency_id</code> but instead it inserts new <code>\"USD\"</code> entry in <code>currencies</code> table for every <code>db.Create(&amp;rate)</code></p>\n\n<p>Am I doing it wrong or it's the library?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I know that I can do it by querying the DB for currency ID</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>curr := db.Currency{}\ndb.Where(\"currency_code = ?\", \"USD\").First(&amp;curr)\n// use curr with proper ID\n</code></pre>\n\n<p>but then:</p>\n\n<ul>\n<li>I have to make 2 DB calls</li>\n<li>I don't use <code>gorm</code>'s foreign key mapping feature (if there is one)</li>\n</ul>\n"}, {"tags": ["rest", "go", "web-development-server"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1516225564, "post_id": 48310424, "comment_id": 83606752, "body": "If the endpoint is <code>api&#47;user&#47;</code>, that&#39;s the route that should be registered in whatever mux you&#39;re using. If you need to accept POST parameters, you need to read those, not URL parameters - that entire avenue is a red herring. If you&#39;re using the standard library&#39;s HTTP handlers, you can read POST data using <a href=\"https://golang.org/pkg/net/http/#Request.ParseForm\" rel=\"nofollow noreferrer\"><code>Request.ParseForm</code></a>."}, {"owner": {"reputation": 21, "user_id": 7565309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ce55c8809fe20bf64e025ff90edb17b?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7565309/steve"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1516226255, "post_id": 48310424, "comment_id": 83607050, "body": "Brilliant. Thanks very much. I think I&#39;ve got it working now. I had been trying to use ` params := mux.Vars(r)`  like I&#39;d been using when setting things up. Parsing the request using ` request.URL`  seems to have worked."}], "owner": {"reputation": 21, "user_id": 7565309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ce55c8809fe20bf64e025ff90edb17b?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7565309/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1516225141, "creation_date": 1516225141, "question_id": 48310424, "link": "https://stackoverflow.com/questions/48310424/go-rest-api-endpoint-and-encoded-parameters", "title": "Go REST API endpoint and Encoded parameters?", "body": "<p>I'm still new to Go (and web programming in general) so apologies if I don't explain things properly.</p>\n\n<p>I need my server to listen out for POST requests which will have four parameters. \"Your REST API should expect the following parameters.\"</p>\n\n<pre><code>id int\ncon_id  string\nkey  string\nfields  array\n</code></pre>\n\n<p>An example request would be:</p>\n\n<pre><code>uid=5&amp;con_id=3456&amp;key=6nD1a7EATbP7ewmZCpNkxzzyMvuIKqQQ&amp;fields%5Bfield_ds_personal_details%5D%5B0%5D%5B%5D%5Baccess%5D%5Br%5D%5Ba%5D=1&amp;fields%5Bfield_ds_personal_details%5D%5B0%5D%5B%5D%5Baccess%5D%5Br%5D%5Bs%5D=A\n</code></pre>\n\n<p>I'm unsure however how to properly do this in Go. </p>\n\n<p>I've been using my endpoint as</p>\n\n<pre><code>api/user/{id}/{con_id}/{key}/{fields}\n</code></pre>\n\n<p>I can get it to work if I POST to </p>\n\n<pre><code>api/user/5/3456/hhjdd7887334jf but that's not how their API makes the request.\n</code></pre>\n\n<p>Using Postman and adding the parameters (so they're the same, encoded in the way the should be) I get a 404.</p>\n\n<p>Any help would be very much appreciated! Even if it's just somewhere I can read more about how parameters in a request work.</p>\n"}, {"tags": ["sql-server", "go"], "comments": [{"owner": {"reputation": 4570, "user_id": 1385774, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6z25x.jpg?s=128&g=1", "display_name": "maSTAShuFu", "link": "https://stackoverflow.com/users/1385774/mastashufu"}, "edited": false, "score": 0, "creation_date": 1516224280, "post_id": 48310201, "comment_id": 83606217, "body": "normally you don&#39;t connect as a domain user over a script but as a sql user only with limited access of course not SA."}, {"owner": {"reputation": 781, "user_id": 8644283, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f848eda3b3994c341f237c9e53f2923b?s=128&d=identicon&r=PG&f=1", "display_name": "Kade Williams", "link": "https://stackoverflow.com/users/8644283/kade-williams"}, "reply_to_user": {"reputation": 4570, "user_id": 1385774, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6z25x.jpg?s=128&g=1", "display_name": "maSTAShuFu", "link": "https://stackoverflow.com/users/1385774/mastashufu"}, "edited": false, "score": 2, "creation_date": 1516224348, "post_id": 48310201, "comment_id": 83606244, "body": "Oh I just figured it out. &quot;trusted_connection=yes&quot; did work.  I just entered it wrong."}, {"owner": {"reputation": 17115, "user_id": 665377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174cf37a4ad1b48417d5dc8c00e12d2d?s=128&d=identicon&r=PG", "display_name": "Bob Vale", "link": "https://stackoverflow.com/users/665377/bob-vale"}, "edited": false, "score": 0, "creation_date": 1516224579, "post_id": 48310201, "comment_id": 83606336, "body": "@KadeWilliams You cannot use trusted auth when you are connected via TCP, you need to make the connection over a named pipe.  Try removing the port from the connection string. If that doesn&#39;t work, try <code>server: np:%s</code> to force a named pipe connection"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1516270528, "post_id": 48310201, "comment_id": 83622923, "body": "@KadeWilliams so please answer your own question and then mark it as accepted."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 17115, "user_id": 665377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174cf37a4ad1b48417d5dc8c00e12d2d?s=128&d=identicon&r=PG", "display_name": "Bob Vale", "link": "https://stackoverflow.com/users/665377/bob-vale"}, "edited": false, "score": 0, "creation_date": 1516270636, "post_id": 48310201, "comment_id": 83623003, "body": "@BobVale, that&#39;s incorrect: it&#39;s perfectly possible to use trusted authentication over TCP\u2014the MS-TDS protocol uses <a href=\"https://msdn.microsoft.com/en-us/library/dd303223\" rel=\"nofollow noreferrer\">SSPI in its handshake</a>, which is basically a challenge/response protocol (SPNEGO)."}, {"owner": {"reputation": 17115, "user_id": 665377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174cf37a4ad1b48417d5dc8c00e12d2d?s=128&d=identicon&r=PG", "display_name": "Bob Vale", "link": "https://stackoverflow.com/users/665377/bob-vale"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1516271001, "post_id": 48310201, "comment_id": 83623265, "body": "@kostix Ok I stand corrected, I think it&#39;s because historically trusted_connection=yes/true meant NTLM and I could never get it to work over tcp in the past.  Looking further it does depend on the provider you are using - see <a href=\"https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/connection-string-syntax\" rel=\"nofollow noreferrer\">Connection string Syntax</a>"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 17115, "user_id": 665377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/174cf37a4ad1b48417d5dc8c00e12d2d?s=128&d=identicon&r=PG", "display_name": "Bob Vale", "link": "https://stackoverflow.com/users/665377/bob-vale"}, "edited": false, "score": 0, "creation_date": 1516272556, "post_id": 48310201, "comment_id": 83624255, "body": "@BobVale, in fact is <i>should be</i> possible to negotiate NTLM via that SPNEGO exchange since it was specifically designed to be able to negotiate a specific auth mech during the GSSAPI negotiation; so on Windows, Kerberos and NTLM should be supported, in theory. But the problems may lie in a number of places including policies on different machines, two versions of NTLM in existence and whatever else. See <a href=\"http://docs.alfresco.com/4.0/tasks/troubleshoot-ntlm.html\" rel=\"nofollow noreferrer\">this</a> for one example I have personally had to deal with."}, {"owner": {"reputation": 81, "user_id": 7457581, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RgLRs.jpg?s=128&g=1", "display_name": "DB2_Philip", "link": "https://stackoverflow.com/users/7457581/db2-philip"}, "edited": false, "score": 0, "creation_date": 1599653900, "post_id": 48310201, "comment_id": 112838917, "body": "If the username is made up of DOMAIN\\username - be sure to get the case right.  domain != DOMAIN."}], "answers": [{"tags": [], "owner": {"reputation": 5, "user_id": 8903079, "user_type": "registered", "profile_image": "https://graph.facebook.com/1585206641522116/picture?type=large", "display_name": "Alphonse Kurian", "link": "https://stackoverflow.com/users/8903079/alphonse-kurian"}, "is_accepted": false, "score": 0, "last_activity_date": 1516226090, "creation_date": 1516226090, "answer_id": 48310640, "question_id": 48310201, "link": "https://stackoverflow.com/questions/48310201/how-to-connect-to-sql-server-using-windows-auth/48310640#48310640", "title": "How to connect to SQL Server using Windows Auth?", "body": "<p>Your client side setup was correct. Did you add the windows user account to to the Database? I have done this multiple time without issues. Make sure your windows auth is enabled in your Db and the user has sufficient previlages.</p>\n\n<p><a href=\"https://msdn.microsoft.com/en-us/library/ff647396.aspx\" rel=\"nofollow noreferrer\">steps to connect to sql server using windows authenticaton</a></p>\n"}, {"comments": [{"owner": {"reputation": 1029, "user_id": 6579438, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-iIAUwtsCYo8/AAAAAAAAAAI/AAAAAAAAAUQ/emnzLPPlcno/photo.jpg?sz=128", "display_name": "Gaurav Gahlot", "link": "https://stackoverflow.com/users/6579438/gaurav-gahlot"}, "edited": false, "score": 0, "creation_date": 1542341264, "post_id": 48453354, "comment_id": 93542393, "body": "Does not work for me. I&#39;m using it like: <code>connString := fmt.Sprintf(&quot;server=%s;port=%d;trusted_connection=yes;&quot;, server, port)</code>"}], "tags": [], "owner": {"reputation": 781, "user_id": 8644283, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f848eda3b3994c341f237c9e53f2923b?s=128&d=identicon&r=PG&f=1", "display_name": "Kade Williams", "link": "https://stackoverflow.com/users/8644283/kade-williams"}, "is_accepted": true, "score": 4, "last_activity_date": 1516921562, "creation_date": 1516921562, "answer_id": 48453354, "question_id": 48310201, "link": "https://stackoverflow.com/questions/48310201/how-to-connect-to-sql-server-using-windows-auth/48453354#48453354", "title": "How to connect to SQL Server using Windows Auth?", "body": "<p>As I posted earlier...</p>\n\n<p>\"trusted_connection=yes\" did work. I just entered it wrong.</p>\n"}], "owner": {"reputation": 781, "user_id": 8644283, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f848eda3b3994c341f237c9e53f2923b?s=128&d=identicon&r=PG&f=1", "display_name": "Kade Williams", "link": "https://stackoverflow.com/users/8644283/kade-williams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2022, "favorite_count": 1, "accepted_answer_id": 48453354, "answer_count": 2, "score": 3, "last_activity_date": 1541208055, "creation_date": 1516224176, "question_id": 48310201, "link": "https://stackoverflow.com/questions/48310201/how-to-connect-to-sql-server-using-windows-auth", "title": "How to connect to SQL Server using Windows Auth?", "body": "<p>I am currently using this example to connect to SQL Server using Go:</p>\n\n<p><a href=\"https://sqlchoice.azurewebsites.net/en-us/sql-server/developer-get-started/go/rhel/step/2.html\" rel=\"nofollow noreferrer\">Create Go apps</a></p>\n\n<p>Here is the example I am using:</p>\n\n<pre><code>    package main\n\n    import (\n        _ \"github.com/denisenkom/go-mssqldb\"\n        \"database/sql\"\n        \"context\"\n        \"log\"\n        \"fmt\"\n    )\n\n    // Replace with your own connection parameters\n    var server = \"localhost\"\n    var port = 1433\n    var user = \"sa\"\n    var password = \"your_password\"\n\n    var db *sql.DB\n\n    func main() {\n        var err error\n\n        // Create connection string\n        connString := fmt.Sprintf(\"server=%s;user id=%s;password=%s;port=%d\",\n            server, user, password, port)\n\n        // Create connection pool\n        db, err = sql.Open(\"sqlserver\", connString)\n        if err != nil {\n            log.Fatal(\"Error creating connection pool: \" + err.Error())\n        }\n        log.Printf(\"Connected!\\n\")\n\n        // Close the database connection pool after program executes\n        defer db.Close()\n\n        SelectVersion()\n    }\n</code></pre>\n\n<p>Is there any known way to use Windows Authentication to connect to SQL Server?  I have tried adding \"Trusted_Connection=yes\" and removing the username/password.</p>\n\n<p>I have Googled around but have not found any Go Packages that have this option.</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-sdk", "aws-sdk-go", "aws-storage-gateway"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1516220269, "post_id": 48309084, "comment_id": 83604182, "body": "What&#39;s the full error output? Per the docs, &quot;Use runtime type assertions with awserr.Error&#39;s Code and Message methods to get detailed information about the error.&quot;"}, {"owner": {"reputation": 41, "user_id": 4537937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bb8f7e16003e3fb063161d0d0b83172?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/4537937/jacob"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1516220940, "post_id": 48309084, "comment_id": 83604545, "body": "Here is the full error output: <code>InvalidGatewayRequestException InvalidGatewayRequestException: Invalid resource         status code: 400</code>"}, {"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 0, "creation_date": 1516910720, "post_id": 48309084, "comment_id": 83894932, "body": "Well, I was unable to re-create your issue. So while waiting for somebody to work it out here, maybe you can mention it in the Github <a href=\"https://github.com/aws/aws-sdk-go/issues\" rel=\"nofollow noreferrer\">issues page</a>"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1516965656, "post_id": 48309084, "comment_id": 83913465, "body": "@j8kster, Can you check this? Show me the error? <a href=\"https://play.golang.org/p/spCXy-zktgW\" rel=\"nofollow noreferrer\">play.golang.org/p/spCXy-zktgW</a>. Use Your credential in <code>credentials.NewStaticCredentials(&quot;&quot;, &quot;&quot;, &quot;&quot;)</code>"}, {"owner": {"reputation": 41, "user_id": 4537937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bb8f7e16003e3fb063161d0d0b83172?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/4537937/jacob"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1516998883, "post_id": 48309084, "comment_id": 83932000, "body": "@aerokite I ran the code that you provided using my credentials as instructed. Unfortunately, I still got the same error <code>Error listing gateways InvalidGatewayRequestException: Invalid resource status code: 400</code>"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1516998971, "post_id": 48309084, "comment_id": 83932051, "body": "Are you using master for <a href=\"https://github.com/aws/aws-sdk-go\" rel=\"nofollow noreferrer\">github.com/aws/aws-sdk-go</a>"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1516999121, "post_id": 48309084, "comment_id": 83932110, "body": "I have check with <a href=\"https://github.com/aws/aws-sdk-go/releases/tag/v1.7.8\" rel=\"nofollow noreferrer\">github.com/aws/aws-sdk-go/releases/tag/v1.7.8</a>"}, {"owner": {"reputation": 41, "user_id": 4537937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bb8f7e16003e3fb063161d0d0b83172?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/4537937/jacob"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1517004740, "post_id": 48309084, "comment_id": 83934468, "body": "@aerokite I pulled the SDK down with the <code>go get -d github.com&#47;aws&#47;aws-sdk-go&#47;</code> command which in my understanding should grab the latest release."}, {"owner": {"reputation": 41, "user_id": 4537937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bb8f7e16003e3fb063161d0d0b83172?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/4537937/jacob"}, "edited": false, "score": 0, "creation_date": 1517005190, "post_id": 48309084, "comment_id": 83934621, "body": "I will also add that I packaged this code to run in an AWS lambda function now that go is supported and got the same results using an IAM role with proper access to the storage gateway resources as well as AWS&#39;s runtime and SDK version. I am however able to execute other calls such as <code>DescribeTapeArchives</code> successfully in the same runtime using the same session."}, {"owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1517220740, "post_id": 48309084, "comment_id": 83990756, "body": "Can you share the exact aws CLI command which gives you the proper result?"}, {"owner": {"reputation": 41, "user_id": 4537937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bb8f7e16003e3fb063161d0d0b83172?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/4537937/jacob"}, "reply_to_user": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1517236999, "post_id": 48309084, "comment_id": 84001270, "body": "@Anuruddha the aws CLI command is <code>aws storagegateway list-gateways</code>."}, {"owner": {"reputation": 3514, "user_id": 1794802, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9404788dd9ecd74e3070ec684adbf439?s=128&d=identicon&r=PG", "display_name": "strongjz", "link": "https://stackoverflow.com/users/1794802/strongjz"}, "edited": false, "score": 1, "creation_date": 1517346468, "post_id": 48309084, "comment_id": 84056364, "body": "Does the gateway exist? Or started? &quot;After the gateway is shutdown, you cannot call any other API except StartGateway, DescribeGatewayInformation, and ListGateways. For more information, see ActivateGateway. Your applications cannot read from or write to the gateway&#39;s storage volumes, and there are no snapshots taken. &quot;"}, {"owner": {"reputation": 41, "user_id": 4537937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bb8f7e16003e3fb063161d0d0b83172?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/4537937/jacob"}, "reply_to_user": {"reputation": 3514, "user_id": 1794802, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9404788dd9ecd74e3070ec684adbf439?s=128&d=identicon&r=PG", "display_name": "strongjz", "link": "https://stackoverflow.com/users/1794802/strongjz"}, "edited": false, "score": 1, "creation_date": 1517409171, "post_id": 48309084, "comment_id": 84084465, "body": "@strongjz Yes, the gateways exist, are activated, and started. I successfully get a list of them with the AWS CLI command, as well as the python SDK which I have tried now as well. Gateway operational state is reported as active and I am actively using these gateways in production."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 7000092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/993208b659d756dba3ae6608801d830d?s=128&d=identicon&r=PG", "display_name": "rossigee", "link": "https://stackoverflow.com/users/7000092/rossigee"}, "is_accepted": false, "score": 0, "last_activity_date": 1607948953, "creation_date": 1607948953, "answer_id": 65289048, "question_id": 48309084, "link": "https://stackoverflow.com/questions/48309084/storagegateway-listgateways-returning-invalid-resource-with-status-code-400/65289048#65289048", "title": "storagegateway.ListGateways() returning &quot;Invalid resource&quot; with status code: 400", "body": "<p>The example code seems to work as expected for me by simply removing the <code>Marker: aws.String(&quot;1&quot;)</code> line.</p>\n"}], "owner": {"reputation": 41, "user_id": 4537937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bb8f7e16003e3fb063161d0d0b83172?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob", "link": "https://stackoverflow.com/users/4537937/jacob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 244, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1607948953, "creation_date": 1516219218, "question_id": 48309084, "link": "https://stackoverflow.com/questions/48309084/storagegateway-listgateways-returning-invalid-resource-with-status-code-400", "title": "storagegateway.ListGateways() returning &quot;Invalid resource&quot; with status code: 400", "body": "<p>I am having trouble using the go sdk to list all of the storage gateways in a region using the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/storagegateway\"\n)\n\nfunc newSess() (sess *session.Session) {\n    sess, err := session.NewSession(&amp;aws.Config{\n        Region: aws.String(\"us-east-2\"),\n    })\n\n    if err != nil {\n        fmt.Printf(\"Error creating session: %s\\n\", err)\n        return\n    }\n\n    return sess\n}\n\nfunc main() {\n    sgw := storagegateway.New(newSess())\n\n    input := &amp;storagegateway.ListGatewaysInput{\n        Limit:  aws.Int64(5),\n        Marker: aws.String(\"1\"),\n    }\n\n    result, err := sgw.ListGateways(input)\n    if err != nil {\n        fmt.Printf(\"Error listing gateways %s\\n\", err)\n        return\n    }\n\n    fmt.Println(result)\n\n}\n</code></pre>\n\n<p>My environment is the following:</p>\n\n<ul>\n<li><strong>Go version:</strong> 1.9.2 darwin/amd64</li>\n<li><strong>Operating system:</strong> macOS 10.13.2</li>\n<li><strong>aws-sdk-go:</strong> v1.12.63</li>\n</ul>\n\n<p>The SDK is using the default profile specified in <code>~/.aws/config</code> as it should and the credentials are correct as well. Furthermore, I am able to list the gateways using the awscli alone. </p>\n\n<p>This could very well be something simple that I have overlooked as I am no expert. That said, any help would be greatly appreciated.</p>\n"}, {"tags": ["go", "range", "slice"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 5, "creation_date": 1516219467, "post_id": 48309029, "comment_id": 83603786, "body": "<code>[]WhatAreYou{A{}, B{}}</code> <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Composite_literals</a>"}, {"owner": {"reputation": 1428, "user_id": 1695049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2702af7f9a74cb1bae1c92e2fa701c3b?s=128&d=identicon&r=PG", "display_name": "Martin", "link": "https://stackoverflow.com/users/1695049/martin"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1516231276, "post_id": 48309029, "comment_id": 83609022, "body": "Thanks. Seems kind of obvious now I&#39;ve been shown. Thanks for the link that was exactly what i was trying to Google for but didn&#39;t think of the phrase composite literal"}, {"owner": {"reputation": 344, "user_id": 1737644, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/E2Vgq.jpg?s=128&g=1", "display_name": "shful", "link": "https://stackoverflow.com/users/1737644/shful"}, "edited": false, "score": 0, "creation_date": 1516271763, "post_id": 48309029, "comment_id": 83623725, "body": "Why these downvotes - I see a concise question with a working code example. Just beeing a beginners level question is not against the rules, right?"}, {"owner": {"reputation": 1428, "user_id": 1695049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2702af7f9a74cb1bae1c92e2fa701c3b?s=128&d=identicon&r=PG", "display_name": "Martin", "link": "https://stackoverflow.com/users/1695049/martin"}, "reply_to_user": {"reputation": 344, "user_id": 1737644, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/E2Vgq.jpg?s=128&g=1", "display_name": "shful", "link": "https://stackoverflow.com/users/1737644/shful"}, "edited": false, "score": 0, "creation_date": 1516272597, "post_id": 48309029, "comment_id": 83624278, "body": "@shful: I wondered that too but I got the answer and I&#39;ve got golang to learn so I let it be. Would like to know what I can do to improve, but I&#39;m not going to lose sleep over a few down votes."}], "answers": [{"tags": [], "owner": {"reputation": 1428, "user_id": 1695049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2702af7f9a74cb1bae1c92e2fa701c3b?s=128&d=identicon&r=PG", "display_name": "Martin", "link": "https://stackoverflow.com/users/1695049/martin"}, "is_accepted": true, "score": 0, "last_activity_date": 1516290943, "last_edit_date": 1516290943, "creation_date": 1516268791, "answer_id": 48318185, "question_id": 48309029, "link": "https://stackoverflow.com/questions/48309029/can-i-declare-the-list-of-interfaces-inline-within-the-slice/48318185#48318185", "title": "Can I declare the list of interfaces inline within the slice?", "body": "<p>[]WhatAreYou{A{}, B{}} </p>\n\n<p>This is correct, thanks to mkopriva. <a href=\"http://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">Composite Literals</a></p>\n\n<p>Now I understand a little better what I am doing here I think I understand why this question is down voted too. The question doesn't really make sense. I was so hung up on the idea of the interface I didn't think of anything else. var a A is declaring a struct that happens to implement an interface. This is even more obvious if you initialise the struct e.g. var a = A{\"hello\"} or inline A{\"hello\"}, B{2}</p>\n"}], "owner": {"reputation": 1428, "user_id": 1695049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2702af7f9a74cb1bae1c92e2fa701c3b?s=128&d=identicon&r=PG", "display_name": "Martin", "link": "https://stackoverflow.com/users/1695049/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 48318185, "answer_count": 1, "score": -3, "last_activity_date": 1516290943, "creation_date": 1516219013, "last_edit_date": 1516219280, "question_id": 48309029, "link": "https://stackoverflow.com/questions/48309029/can-i-declare-the-list-of-interfaces-inline-within-the-slice", "title": "Can I declare the list of interfaces inline within the slice?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var a A\n    var b B\n\n    for _, v := range []WhatAreYou{a, b} {\n        fmt.Println(v.Question())\n    }\n}\n\ntype WhatAreYou interface {\n    Question() string\n}\n\ntype A struct {\n    string\n}\n\ntype B struct {\n    int\n}\n\nfunc (a A) Question() string {\n    return \"I'm an A\"\n}\n\nfunc (b B) Question() string {\n    return \"I'm a B\"\n}\n</code></pre>\n\n<p>The code above works as I expect and calls the function on each interface as expected. <a href=\"https://play.golang.org/p/8fBbNKATuml\" rel=\"nofollow noreferrer\">Go Play</a></p>\n\n<p>In my actual code I intend to have many different types implementing an interface. How can I get rid of the var a A var b B etc and simply declare them all in the slice? i.e. I tried and failed with the following and other variations</p>\n\n<pre><code>for _, v := range []WhatAreYou{a A, b B} {\n</code></pre>\n"}, {"tags": ["go", "x509certificate"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1516214375, "post_id": 48307863, "comment_id": 83601023, "body": "Please paste the actual error output into the question body."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1516214689, "post_id": 48307863, "comment_id": 83601185, "body": "<a href=\"https://golang.org/pkg/crypto/tls/#LoadX509KeyPair\" rel=\"nofollow noreferrer\">LoadX509KeyPair</a> takes filenames to read from, not file contents. Also, it wants PEM-encoded file contents, but <code>DecryptPEMBlock</code> returns a DER-encoded key. I think you&#39;ll have to modify <a href=\"https://golang.org/src/crypto/tls/tls.go?s=5915:5986#L183\" rel=\"nofollow noreferrer\">X509KeyPair</a> yourself."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1516215282, "post_id": 48307863, "comment_id": 83601536, "body": "The x509.Parse*PrivateKey and x509.ParseCertificate functions can load DER bytes."}, {"owner": {"reputation": 524, "user_id": 4695952, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ddbb13b83fa0193327392265d2b94963?s=128&d=identicon&r=PG&f=1", "display_name": "Dikshant Adhikari", "link": "https://stackoverflow.com/users/4695952/dikshant-adhikari"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1516215800, "post_id": 48307863, "comment_id": 83601800, "body": "@Peter Should I use <code>x509.ParsePKCS8PrivateKey()</code> or <code>x509.ParsePKCS1PrivateKey()</code> ?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1516215918, "post_id": 48307863, "comment_id": 83601866, "body": "@dikshant, well, that depends on your key, of course. If you don&#39;t know in advance, try both and see which one produces an error. This is also what the tls package does: <a href=\"https://golang.org/src/crypto/tls/tls.go?#L280\" rel=\"nofollow noreferrer\">golang.org/src/crypto/tls/tls.go?#L280</a>"}], "owner": {"reputation": 524, "user_id": 4695952, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ddbb13b83fa0193327392265d2b94963?s=128&d=identicon&r=PG&f=1", "display_name": "Dikshant Adhikari", "link": "https://stackoverflow.com/users/4695952/dikshant-adhikari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1352, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1616963592, "creation_date": 1516214280, "last_edit_date": 1616963592, "question_id": 48307863, "link": "https://stackoverflow.com/questions/48307863/how-do-i-load-and-decrypt-an-encrypted-key-file-for-a-cert-in-go", "title": "How do I load and decrypt an encrypted key file for a cert in Go?", "body": "<p>I have a cert file and a key file where the key file is encrypted with a password. I am trying to decrypt the key file programmatically before loading the key pair.</p>\n<pre><code>// Key file and cert file path\ncf := filepath.Join(certPath, certFile)\nkf := filepath.Join(certPath, keyFile)\n\n//Read &amp; decode the encrypted key file with the pass to make tls work\nkeyIn, err := ioutil.ReadFile(kf)\nif err != nil {\n    log.Error(&quot;Read key error&quot;, err)\n    return nil, err\n}\n\n// Decode and decrypt our PEM block\ndecodedPEM, _ := pem.Decode([]byte(keyIn))\ndecrypedPemBlock, err := x509.DecryptPEMBlock(decodedPEM, []byte(&quot;somepassword&quot;))\nif err != nil {\n    log.Error(&quot;decrypt key error&quot;, err)\n    return nil, err\n}\n\n// Load our decrypted key pair\ncrt, err := tls.LoadX509KeyPair(cf, string(decrypedPemBlock))\nif err != nil {\n    log.Error(&quot;load key pair error&quot;, err)\n    return nil, err\n}\n</code></pre>\n<p>The original certs and key were generated using the following openssl parameters</p>\n<pre><code>openssl req -new -newkey rsa:2048 -x509 -keyout $CA_CERT.key -out $CA_CERT -days $validity -passin &quot;pass:$password&quot; -passout &quot;pass:$password&quot; -subj &quot;/C=$C/ST=$ST/L=$L/O=$O/CN=$CN/emailAddress=$EMAIL&quot;\n</code></pre>\n<p>The variables are substituted accordingly with $password being &quot;somepassword&quot;</p>\n<p>I have tried decrypting the key using <code>openssl rsa</code> from the command line and it works fine with the the password above.</p>\n<p>However in Go I get an error in <code>tls.LoadX509KeyPair</code> saying invalid argument.</p>\n<pre><code>time=&quot;2018-01-17T18:57:40Z&quot; level=error msg=&quot;load key pair error: open\n</code></pre>\n<p>My best guess is that the key encoding might be messed up and I was wondering if anything is wrong with my code.</p>\n<p>Update: Added error message and it seems like <code>tls.LoadX509KeyPair</code> can't understand the format as comments have pointed out below.</p>\n"}, {"tags": ["string", "go", "random", "seed", "random-seed"], "comments": [{"owner": {"reputation": 13756, "user_id": 12171, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/9b197571b0eb5e2fbfaf2cee5afabc8a?s=128&d=identicon&r=PG", "display_name": "Adrian Petrescu", "link": "https://stackoverflow.com/users/12171/adrian-petrescu"}, "edited": false, "score": 0, "creation_date": 1516211482, "post_id": 48307105, "comment_id": 83599539, "body": "Is there any requirement for the seed to not be easily manipulable/detectable from the input string, for security reasons? Because if not, I can&#39;t think of any reason why just taking any hash of the string and applying <code>mod MAXINT</code> wouldn&#39;t be sufficient."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1516212366, "last_edit_date": 1516212366, "creation_date": 1516211576, "answer_id": 48307166, "question_id": 48307105, "link": "https://stackoverflow.com/questions/48307105/how-do-i-use-a-string-as-input-to-the-rand-seed-function-in-golang/48307166#48307166", "title": "How do I use a string as input to the rand.Seed() function in Golang?", "body": "<p>Using a hash function is a good direction. And to produce a value that fits into an <code>int64</code> simply take the first 8 bytes of the hash value.</p>\n\n<p>For a good hash function, each byte (or rather each bit) of the hash result depends on all of the input bytes, so the first 8 bytes won't get \"stuck\" after a certain input length.</p>\n\n<p>To convert a slice of 8 bytes to an <code>int64</code> value, you may use the <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow noreferrer\"><code>encoding/binary</code></a> package.</p>\n\n<p>For example:</p>\n\n<pre><code>digest := ... // calculate digest\nseed := int64(binary.BigEndian.Uint64(digest[:8]))\n</code></pre>\n\n<p>Slicing the digest value <code>digest[:8]</code> can also be omitted, as a <code>BigEndian.Uint64()</code> call will only read the first 8 bytes.</p>\n"}, {"comments": [{"owner": {"reputation": 686, "user_id": 1062714, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6ea5efd929017c313d90b52b0a6f01fa?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1062714/james"}, "edited": false, "score": 0, "creation_date": 1516212148, "post_id": 48307199, "comment_id": 83599900, "body": "Wouldn&#39;t CRC64 be a better hashing algorithm than MD5 (or SHA256), since it outputs exactly 64 bits and thus nothing would have to be ignored/truncated?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 686, "user_id": 1062714, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6ea5efd929017c313d90b52b0a6f01fa?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1062714/james"}, "edited": false, "score": 0, "creation_date": 1516212239, "post_id": 48307199, "comment_id": 83599953, "body": "That would definitely work. If this is for something like a game&#39;s random number generator, this would be perfect. However, if this is to seed a random-number generator for crypto-purposes, sha256 would probably be the best of the three mentioned so far."}, {"owner": {"reputation": 686, "user_id": 1062714, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6ea5efd929017c313d90b52b0a6f01fa?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1062714/james"}, "edited": false, "score": 0, "creation_date": 1516212434, "post_id": 48307199, "comment_id": 83600070, "body": "It is for a game. Can you edit in an example for CRC64?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 686, "user_id": 1062714, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6ea5efd929017c313d90b52b0a6f01fa?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1062714/james"}, "edited": false, "score": 0, "creation_date": 1516212653, "post_id": 48307199, "comment_id": 83600169, "body": "CRC64 is a bit more annoying to use. You can see examples in the link I added to my answer (along with many other hashes in Go)."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 8, "last_activity_date": 1516212952, "last_edit_date": 1516212952, "creation_date": 1516211689, "answer_id": 48307199, "question_id": 48307105, "link": "https://stackoverflow.com/questions/48307105/how-do-i-use-a-string-as-input-to-the-rand-seed-function-in-golang/48307199#48307199", "title": "How do I use a string as input to the rand.Seed() function in Golang?", "body": "<p>A hash of the string will do the trick.</p>\n\n<p>You can use:</p>\n\n<ul>\n<li><a href=\"https://golang.org/pkg/crypto/md5/\" rel=\"noreferrer\">md5</a> sum of the string (returns 16 bytes)</li>\n<li>convert the first 8 bytes into a uint64 (<a href=\"https://golang.org/pkg/encoding/binary/#ByteOrder\" rel=\"noreferrer\">binary.BigEndian.Uint64</a> ignores the rest. It will crash if your input is less than 8 bytes though).</li>\n</ul>\n\n<p>Sample code (<a href=\"https://play.golang.org/p/ILgLmgcNYYC\" rel=\"noreferrer\">playground link</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/md5\"\n    \"encoding/binary\"\n    \"fmt\"\n    \"io\"\n    \"math/rand\"\n)\n\nfunc main() {\n    h := md5.New()\n    io.WriteString(h, \"And Leon's getting larger!\")\n    var seed uint64 = binary.BigEndian.Uint64(h.Sum(nil))\n    fmt.Println(seed)\n    rand.Seed(int64(seed))\n    fmt.Println(rand.Int())\n}\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>2458341265858962012\n792667671\n</code></pre>\n\n<p><strong>Note</strong>: md5 is just an example. You can use any hash that generates at least 8 bytes. eg: <a href=\"https://golang.org/pkg/crypto/sha256/\" rel=\"noreferrer\">sha256</a>. Simply replace <code>md5.New()</code> with <code>sha256.New()</code> (and the import).\nYou can find a nice list of hash examples <a href=\"http://www.mrwaggel.be/post/golang-hash-sum-and-checksum-to-string-tutorial-and-examples/\" rel=\"noreferrer\">here</a>.</p>\n\n<p>And a big word of <strong>warning</strong>: this does not talk about crypto applications at all. I'm assuming this is for something like a user-provided seed (eg: a game seed) for non-crypto purposes.</p>\n"}, {"tags": [], "owner": {"reputation": 179, "user_id": 12698841, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mnLhX.png?s=128&g=1", "display_name": "0example.com", "link": "https://stackoverflow.com/users/12698841/0example-com"}, "is_accepted": false, "score": 0, "last_activity_date": 1612950387, "creation_date": 1612950387, "answer_id": 66134449, "question_id": 48307105, "link": "https://stackoverflow.com/questions/48307105/how-do-i-use-a-string-as-input-to-the-rand-seed-function-in-golang/66134449#66134449", "title": "How do I use a string as input to the rand.Seed() function in Golang?", "body": "<p>You can try this. You can give a different sequence for generating random events by generating a different seed by using time.</p>\n<pre><code>package main\n\nimport (\n    &quot;bytes&quot;\n    &quot;fmt&quot;\n    &quot;math/rand&quot;\n    &quot;time&quot;\n)\n\nvar r = rand.New(rand.NewSource(time.Now().UTC().UnixNano()))\nfunc main() {\n    fmt.Println(randomString(10))\n}\n\nfunc randomString(l int) string {\n\n    var result bytes.Buffer\n    var temp string\n    for i := 0; i &lt; l; {\n        if string(randInt(65, 90)) != temp {\n            temp = string(randInt(65, 90))\n            result.WriteString(temp)\n            i++\n        }\n    }\n    return result.String()\n}\n\nfunc randInt(min int, max int) int {\n    return min + r.Intn(max-min)\n}\n</code></pre>\n"}], "owner": {"reputation": 686, "user_id": 1062714, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6ea5efd929017c313d90b52b0a6f01fa?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1062714/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2092, "favorite_count": 0, "accepted_answer_id": 48307199, "answer_count": 3, "score": 4, "last_activity_date": 1612950387, "creation_date": 1516211327, "last_edit_date": 1516212021, "question_id": 48307105, "link": "https://stackoverflow.com/questions/48307105/how-do-i-use-a-string-as-input-to-the-rand-seed-function-in-golang", "title": "How do I use a string as input to the rand.Seed() function in Golang?", "body": "<p><strong>What I want to do:</strong></p>\n\n<p>Based on the contents of a string (like <code>a1b2c3d4e5</code>, for example), I want to generate a bunch of \"repeatable\" random events. Generating repeatable random numbers in Golang is easy - you just seed the random number generator with a specific number using the <a href=\"https://golang.org/pkg/math/rand/#Seed\" rel=\"nofollow noreferrer\">rand.Seed()</a> function, and then you are done. </p>\n\n<p>However, the <a href=\"https://golang.org/pkg/math/rand/#Seed\" rel=\"nofollow noreferrer\">rand.Seed()</a> function takes an int64 as an argument. So I will need to convert a string to a int64 somehow.</p>\n\n<p><strong>What I tried already:</strong></p>\n\n<p>My first thought was to encode the string using base64, and then convert the sequence of bytes to a int64. However, through some basic testing that only seems to support strings of around 7 length. After I add an 8th character, the number just stays the same.</p>\n\n<p>I guess the fundamental problem here is that there are more possible string values than there are possible int64 values.</p>\n\n<p>So what about some kind of hash function? Most hash functions that I know of return a sequence of bytes; I would need some kind of hash function that returns an int64. Perhaps this approach is also misguided?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1516211099, "post_id": 48306985, "comment_id": 83599324, "body": "You should try out your regex on <a href=\"https://regex-golang.appspot.com/assets/html/index.html\" rel=\"nofollow noreferrer\">regex-golang.appspot.com/assets/html/index.html</a>. This also includes a quick reference of regex syntax."}, {"owner": {"reputation": 19159, "user_id": 3600709, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/731c8c4c0029d3414563333de16b8977?s=128&d=identicon&r=PG&f=1", "display_name": "ctwheels", "link": "https://stackoverflow.com/users/3600709/ctwheels"}, "edited": false, "score": 0, "creation_date": 1516211290, "post_id": 48306985, "comment_id": 83599433, "body": "<code>[^.]+</code> means one or more characters that are not in the set (so any character except <code>.</code>). Also, your regex has <code>yahoo+</code>, which means you&#39;ll match <code>yahoo</code>, <code>yahooo</code>, <code>yahoooo</code>, etc."}, {"owner": {"reputation": 1, "user_id": 5357085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0f3932b2d28ceaf80ca02372647b1b5?s=128&d=identicon&r=PG&f=1", "display_name": "heretolearn", "link": "https://stackoverflow.com/users/5357085/heretolearn"}, "edited": false, "score": 0, "creation_date": 1516212841, "post_id": 48306985, "comment_id": 83600272, "body": "^http://(?:www\\.)?yahoo\\.(com|org)/.*$ So this would suffice?"}, {"owner": {"reputation": 1, "user_id": 5357085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0f3932b2d28ceaf80ca02372647b1b5?s=128&d=identicon&r=PG&f=1", "display_name": "heretolearn", "link": "https://stackoverflow.com/users/5357085/heretolearn"}, "edited": false, "score": 0, "creation_date": 1516212882, "post_id": 48306985, "comment_id": 83600293, "body": "nothing is appear in the match section of the regex tester not even .com"}, {"owner": {"reputation": 5979, "user_id": 8534588, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/63d016df9eac3cc0a70b1fb1683dc62b?s=128&d=identicon&r=PG&f=1", "display_name": "Josh Withee", "link": "https://stackoverflow.com/users/8534588/josh-withee"}, "edited": false, "score": 1, "creation_date": 1516213411, "post_id": 48306985, "comment_id": 83600583, "body": "Can you give examples of inputs, some that match and some that don&#39;t?"}], "answers": [{"tags": [], "owner": {"reputation": 956, "user_id": 669493, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ffb12e2cefed1affc0a049c51fbf85eb?s=128&d=identicon&r=PG", "display_name": "zoonman", "link": "https://stackoverflow.com/users/669493/zoonman"}, "is_accepted": false, "score": 2, "last_activity_date": 1516219637, "creation_date": 1516219637, "answer_id": 48309186, "question_id": 48306985, "link": "https://stackoverflow.com/questions/48306985/how-to-extract-exact-name-of-a-website-with-regex/48309186#48309186", "title": "How to extract exact name of a website with regex?", "body": "<p>Please, use \"net/url\" package. It has <a href=\"https://golang.org/pkg/net/url/#example_URL_Hostname\" rel=\"nofollow noreferrer\">Hostname()</a> method which allows you to extract the name of the host from any url. </p>\n\n<p>In your case <code>[^.]</code> means any symbol except dot. Brackets define the symbol class. Plus after means one or more symbols after this class.\nYou can modify regex to look like (this will match all domains starting from yahoo):</p>\n\n<pre><code>^http://(?:www\\.)?yahoo[^.]+\\.(com|org)/.*$\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 5357085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0f3932b2d28ceaf80ca02372647b1b5?s=128&d=identicon&r=PG&f=1", "display_name": "heretolearn", "link": "https://stackoverflow.com/users/5357085/heretolearn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1516219637, "creation_date": 1516210925, "question_id": 48306985, "link": "https://stackoverflow.com/questions/48306985/how-to-extract-exact-name-of-a-website-with-regex", "title": "How to extract exact name of a website with regex?", "body": "<p>This is to extract any website that is com or org, where www. is optional.\nDoes this make http:// a must and also I am failing to understand what [^.]+ means.  </p>\n\n<pre><code>  ^http://(?:www\\.)?[^.]+\\.(com|org)/.*$\n</code></pre>\n\n<p>I want a specific website i.e: </p>\n\n<pre><code>  ^http://(?:www\\.)?yahoo+\\.(com|org)/.*$\n</code></pre>\n\n<p>thanks</p>\n"}, {"tags": ["go", "pprof"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516212625, "post_id": 48306978, "comment_id": 83600156, "body": "Do you have <code>GOPATH</code> set locally, or are you using the default?"}, {"owner": {"reputation": 727, "user_id": 1985162, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/548146a0387d6b4062ede923e39e431b?s=128&d=identicon&r=PG", "display_name": "OhadBasan", "link": "https://stackoverflow.com/users/1985162/ohadbasan"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516268325, "post_id": 48306978, "comment_id": 83621501, "body": "I am using the default and it it is configured to be $HOME/go/ unlike in the remote machine which is just /go"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1531417010, "post_id": 48306978, "comment_id": 89599690, "body": "@OhadBasan Can you add the exact command you&#39;re running on the terminal ?"}], "answers": [{"tags": [], "owner": {"reputation": 990, "user_id": 2681335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa5c2b4a388746403da36ebc31acdda5?s=128&d=identicon&r=PG", "display_name": "menghan", "link": "https://stackoverflow.com/users/2681335/menghan"}, "is_accepted": true, "score": 2, "last_activity_date": 1539944835, "creation_date": 1539944835, "answer_id": 52890544, "question_id": 48306978, "link": "https://stackoverflow.com/questions/48306978/pprof-fails-to-locate-source-files-when-running-over-http/52890544#52890544", "title": "pprof fails to locate source files when running over http", "body": "<pre><code>menghan@gram:/opt$ go tool pprof --help 2&gt;&amp;1 | grep source_path\n    -source_path     Search path for source files\n</code></pre>\n\n<p>Option <code>--source_path</code> may help.</p>\n"}], "owner": {"reputation": 727, "user_id": 1985162, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/548146a0387d6b4062ede923e39e431b?s=128&d=identicon&r=PG", "display_name": "OhadBasan", "link": "https://stackoverflow.com/users/1985162/ohadbasan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1250, "favorite_count": 2, "accepted_answer_id": 52890544, "answer_count": 1, "score": 5, "last_activity_date": 1539944835, "creation_date": 1516210899, "question_id": 48306978, "link": "https://stackoverflow.com/questions/48306978/pprof-fails-to-locate-source-files-when-running-over-http", "title": "pprof fails to locate source files when running over http", "body": "<p>I am running remote profiling of my golang application on a remote server using \"net/http/pprof\".<br>\nI have set PPROF_BINARY_PATH env variable for go tool to be able to find my the local binary on my machine.<br>\nWhen I use the \"list\" keyword in the go tool pprof cli -  I get a \"no such file or directory\" when the go tool is looking for the .go source files.  </p>\n\n<pre><code>Error: open /go/src/github.com/foo/bar/baz.go: no such file or directory\n</code></pre>\n\n<p>it looks like it is looking for the source files in the remote machine's GOPATH which is\n\"/go/\" while on my personal machine it is in my home directory so that file is in . </p>\n\n<pre><code>/Users/myuser/go/src/github.com/foo/bar/baz.go\n</code></pre>\n\n<p>When I copied the desired source code file outside my GOPATH and to the directory the go tool is searching for - the \"list\" keyword works as expected but this is of course not optimal.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1023, "user_id": 1876120, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/3046914c1846e632ce2a45b6537a3ae4?s=128&d=identicon&r=PG", "display_name": "Myone", "link": "https://stackoverflow.com/users/1876120/myone"}, "edited": false, "score": 0, "creation_date": 1516210452, "post_id": 48306450, "comment_id": 83598943, "body": "While you answered the question, I don&#39;t agree that doing explicit select solves the issue at all. You still have ordering in two places (one in a string and the other in arguments) and it is not obvious that these must match which could lead to dangerous bugs. I wasn&#39;t going to use an ORM for Go but after this I might have to (or write a wrapper myself to have a nice way of getting things out of the database)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1023, "user_id": 1876120, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/3046914c1846e632ce2a45b6537a3ae4?s=128&d=identicon&r=PG", "display_name": "Myone", "link": "https://stackoverflow.com/users/1876120/myone"}, "edited": false, "score": 0, "creation_date": 1516262532, "post_id": 48306450, "comment_id": 83618106, "body": "By using explicit columns in your select, you have the ordering of both (the select, and the driver&#39;s interpretation of the select) defined in the same place. Yes, those could fall out of sync, but you&#39;re keeping related concerns close. This is the proper approach, in almost all cases."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1023, "user_id": 1876120, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/3046914c1846e632ce2a45b6537a3ae4?s=128&d=identicon&r=PG", "display_name": "Myone", "link": "https://stackoverflow.com/users/1876120/myone"}, "edited": false, "score": 0, "creation_date": 1516262586, "post_id": 48306450, "comment_id": 83618138, "body": "As for an ORM... there&#39;s absolutely no reason to use an ORM to solve <i>this problem</i> (personal opinion: one should never use ORMs, they invariably introduce more problems than they solve; but I know that&#39;s not a consensus opinion). <code>sqlx</code> should do everything you need."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1516208819, "creation_date": 1516208819, "answer_id": 48306450, "question_id": 48305430, "link": "https://stackoverflow.com/questions/48305430/named-keys-for-go-sql-driver-scan/48306450#48306450", "title": "Named keys for go-sql-driver Scan()", "body": "<blockquote>\n  <p>One problem here is that if I change the order of password and email in the database, my application will silently switch those and I will get no error.</p>\n</blockquote>\n\n<p>Arguably the best solution to this problem is simply not to use <code>SELECT *</code> -- always name your columns.  The problems with <code>*</code> can actually be larger than what you describe--what if new columns are added, which your query doesn't even need? Your code will break, for no useful reason.</p>\n\n<p>But on to your larger question...</p>\n\n<blockquote>\n  <p>Can <code>Scan()</code> take keys somehow or can I do this in some other way?</p>\n</blockquote>\n\n<p>The standard library <code>sql</code> package does not provide this functionality. However, there are third-party libraries that do.  <a href=\"https://github.com/jmoiron/sqlx\" rel=\"nofollow noreferrer\">sqlx</a> is probably the most popular one, which is most similar to the standard library. It is my recommendation.</p>\n\n<p>If you prefer <a href=\"http://blogs.tedneward.com/post/the-vietnam-of-computer-science/\" rel=\"nofollow noreferrer\">pain, suffering, and never-ending bloodshed</a>, something like <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">gorm</a> or <a href=\"https://github.com/go-gorp/gorp\" rel=\"nofollow noreferrer\">gorp</a> are also possibilities.</p>\n"}], "owner": {"reputation": 1023, "user_id": 1876120, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/3046914c1846e632ce2a45b6537a3ae4?s=128&d=identicon&r=PG", "display_name": "Myone", "link": "https://stackoverflow.com/users/1876120/myone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 48306450, "answer_count": 1, "score": 0, "last_activity_date": 1516208819, "creation_date": 1516205430, "question_id": 48305430, "link": "https://stackoverflow.com/questions/48305430/named-keys-for-go-sql-driver-scan", "title": "Named keys for go-sql-driver Scan()", "body": "<p>When using the <code>go-sql-driver</code> it feels like I'm re-inventing the wheel a little bit. I'm used to languages where you have a data model (like a <code>User</code> class) which is strictly related to the database model. Then you can have additional models for what you want to expose on an API of course, but still, you have a model for the database object. In Go I'm not sure how to do this the best way. Below is a <code>GetUserByEmail</code> function.</p>\n\n<pre><code>func GetUserByEmail(email string) (*myapp.User, error) {\n    smt, err := database.Prepare(\"SELECT * FROM users WHERE email = ?\")\n\n    if err != nil {\n        return nil, err\n    }\n\n    rows, err := smt.Query(email)\n    defer rows.Close()\n\n    if err != nil {\n        return nil, err\n    }\n\n    var users []*myapp.User\n\n    for rows.Next() {\n        var id string\n        var confirmed bool\n        var password string\n        var email string\n        var updated string\n        var created string\n        err = rows.Scan(&amp;id, &amp;confirmed, &amp;password, &amp;email, &amp;updated, &amp;created)\n\n        if err != nil {\n            return nil, err\n        }\n\n        user := myapp.User{id, confirmed, created, password, email, updated}\n        users = append(users, &amp;user)\n    }\n\n    if users == nil || len(users) == 0 {\n        return nil, errors.New(\"User not found.\")\n    }\n\n    if len(users) != 1 {\n        return nil, errors.New(\"Nr of users fetched: \" + string(len(users)) + \". Expected: 1.\")\n    }\n\n    return users[0], nil\n}\n</code></pre>\n\n<p>One problem here is that if I change the order of <code>password</code> and <code>email</code> in the database, my application will silently switch those and I will get no error. That's an awful and dangerous behavior. Can <code>Scan()</code> take keys somehow or can I do this in some other way? I could of course look at <code>Columns()</code> and take the index order from there as an int (although Go doesn't seem to have that function built in) and map it to my <code>User</code> variables, but do I really need to do all that for all my database methods? Is it abstracted somewhere or do I need to do that myself?</p>\n"}, {"tags": ["json", "go", "decode"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1516206093, "post_id": 48305425, "comment_id": 83596214, "body": "Show examples of the JSON."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516206267, "post_id": 48305425, "comment_id": 83596308, "body": "Possible duplicates: <a href=\"https://stackoverflow.com/questions/18526046/mapping-strings-to-multiple-types-for-json-objects\" title=\"mapping strings to multiple types for json objects\">stackoverflow.com/questions/18526046/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/44057958/go-unmarshalling-json-with-multiple-types\" title=\"go unmarshalling json with multiple types\">stackoverflow.com/questions/44057958/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/47057240/parsing-multiple-json-types-into-the-same-struct\" title=\"parsing multiple json types into the same struct\">stackoverflow.com/questions/47057240/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/40988252/golang-convert-json-with-variable-types-to-strings\" title=\"golang convert json with variable types to strings\">stackoverflow.com/questions/40988252/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/11066946/partly-json-unmarshal-into-a-map-in-go\" title=\"partly json unmarshal into a map in go\">stackoverflow.com/questions/11066946/&hellip;</a>"}, {"owner": {"reputation": 1319, "user_id": 3877081, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b43ee7c8530d9e455674bf94106c8a7?s=128&d=identicon&r=PG", "display_name": "Phillipp", "link": "https://stackoverflow.com/users/3877081/phillipp"}, "edited": false, "score": 0, "creation_date": 1516206413, "post_id": 48305425, "comment_id": 83596421, "body": "The &quot;duplicates&quot; handle much simpler cases where there are different object types or integer/string, etc. But not string/object in a big nested structure."}, {"owner": {"reputation": 1319, "user_id": 3877081, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b43ee7c8530d9e455674bf94106c8a7?s=128&d=identicon&r=PG", "display_name": "Phillipp", "link": "https://stackoverflow.com/users/3877081/phillipp"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1516206537, "post_id": 48305425, "comment_id": 83596509, "body": "@Cerise Lim&#243;n I added JSON examples"}, {"owner": {"reputation": 807, "user_id": 2120293, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/502PJ.png?s=128&g=1", "display_name": "Tulir", "link": "https://stackoverflow.com/users/2120293/tulir"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1516206742, "post_id": 48305425, "comment_id": 83596635, "body": "@Phillipp Some of the answers in the questions @JimB linked should work for you. Specifically, a struct with the <code>UnmarshalJSON</code> function should work just fine in this case."}], "answers": [{"comments": [{"owner": {"reputation": 1319, "user_id": 3877081, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b43ee7c8530d9e455674bf94106c8a7?s=128&d=identicon&r=PG", "display_name": "Phillipp", "link": "https://stackoverflow.com/users/3877081/phillipp"}, "edited": false, "score": 0, "creation_date": 1516208215, "post_id": 48306186, "comment_id": 83597583, "body": "Thanks, that works! I was already on the right path with the <code>UnmarshalJSON </code> method but had some problems assigning the value."}], "tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": true, "score": 4, "last_activity_date": 1516207893, "creation_date": 1516207893, "answer_id": 48306186, "question_id": 48305425, "link": "https://stackoverflow.com/questions/48305425/json-key-can-either-be-a-string-or-an-object/48306186#48306186", "title": "JSON key can either be a string or an object", "body": "<p>Have a type that has a custom unmarshal method that will first unmarshal into an empty interface and then does a type switch on whether it got a <code>string</code> or a <code>map[string]interface{}</code> such as this:</p>\n\n<pre><code>type example struct {\n    URL myURL `json:\"url\"`\n}\n\ntype myURL struct {\n    url string\n}\n\nfunc (u *myURL) MarshalJSON() ([]byte, error) {\n    return json.Marshal(u.url)\n}\n\nfunc (u *myURL) UnmarshalJSON(data []byte) error {\n    var raw interface{}\n    json.Unmarshal(data, &amp;raw)\n    switch raw := raw.(type) {\n    case string:\n        *u = myURL{raw}\n    case map[string]interface{}:\n        *u = myURL{raw[\"raw\"].(string)}\n    }\n    return nil\n}\n\nconst myStringURL string = `{\"url\": \"http://www.example.com/as-string\"}`\nconst myNestedURL string = `{\"url\": {\"raw\": \"http://www.example.com/as-nested\"}}`\n\nfunc main() {\n    var stringOutput example\n    json.Unmarshal([]byte(myStringURL), &amp;stringOutput)\n    fmt.Println(stringOutput)\n\n    var nestedOutput example\n    json.Unmarshal([]byte(myNestedURL), &amp;nestedOutput)\n    fmt.Println(nestedOutput)\n}\n</code></pre>\n\n<p>Runnable in go playground here:</p>\n\n<p><a href=\"https://play.golang.org/p/I6KC4aXHpxm\" rel=\"nofollow noreferrer\">https://play.golang.org/p/I6KC4aXHpxm</a></p>\n"}], "owner": {"reputation": 1319, "user_id": 3877081, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/6b43ee7c8530d9e455674bf94106c8a7?s=128&d=identicon&r=PG", "display_name": "Phillipp", "link": "https://stackoverflow.com/users/3877081/phillipp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 556, "favorite_count": 1, "accepted_answer_id": 48306186, "answer_count": 1, "score": 3, "last_activity_date": 1516209145, "creation_date": 1516205404, "last_edit_date": 1516209145, "question_id": 48305425, "link": "https://stackoverflow.com/questions/48305425/json-key-can-either-be-a-string-or-an-object", "title": "JSON key can either be a string or an object", "body": "<p>I want to parse some JSON but one key is either a string or an object.</p>\n\n<p>Here is my current struct: <a href=\"https://github.com/PhillippOhlandt/pmtoapib/blob/master/CollectionItemRequest.go#L10\" rel=\"nofollow noreferrer\">https://github.com/PhillippOhlandt/pmtoapib/blob/master/CollectionItemRequest.go#L10</a></p>\n\n<pre><code>type CollectionItemRequest struct {\n    Url         string          `json:\"url\"`\n    Method      string          `json:\"method\"`\n    Header      []RequestHeader `json:\"header\"`\n    Body        RequestBody     `json:\"body\"`\n    Description string          `json:\"description\"`\n}\n</code></pre>\n\n<p>Here the \"Url\" attribute can not only a string but also an object.</p>\n\n<p>I started to create an own struct for it that covers the object case.</p>\n\n<pre><code>type CollectionItemRequestUrl struct {\n    Raw string `json:\"raw\"`\n}\n\ntype CollectionItemRequest struct {\n    Url         CollectionItemRequestUrl `json:\"url\"`\n    Method      string                   `json:\"method\"`\n    Header      []RequestHeader          `json:\"header\"`\n    Body        RequestBody              `json:\"body\"`\n    Description string                   `json:\"description\"`\n}\n</code></pre>\n\n<p>But then the string version won't work anymore. Is there a way to have both cases working and getting the value via a getter, like <code>request.Url.Get</code>?</p>\n\n<p>EDIT:</p>\n\n<p>Here are the two versions of the JSON:</p>\n\n<pre><code>    \"request\": {\n        \"url\": {\n            \"raw\": \"http://localhost:8081/users?per_page=5&amp;page=2\",\n            \"protocol\": \"http\",\n            \"host\": [\n                \"localhost\"\n            ],\n            \"port\": \"8081\",\n            \"path\": [\n                \"users\"\n            ],\n            \"query\": [\n                {\n                    \"key\": \"per_page\",\n                    \"value\": \"5\",\n                    \"equals\": true,\n                    \"description\": \"\"\n                },\n                {\n                    \"key\": \"page\",\n                    \"value\": \"2\",\n                    \"equals\": true,\n                    \"description\": \"\"\n                }\n            ],\n            \"variable\": []\n        },\n</code></pre>\n\n<p>And</p>\n\n<pre><code>\"request\": {\n                \"url\": \"http://localhost:8081/users/2\",\n</code></pre>\n\n<p>Note: Only subsets, the whole JSON would be too long.</p>\n"}, {"tags": ["go", "bazel"], "comments": [{"owner": {"reputation": 10540, "user_id": 521209, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lmaGX.jpg?s=128&g=1", "display_name": "Jin", "link": "https://stackoverflow.com/users/521209/jin"}, "edited": false, "score": 0, "creation_date": 1516215983, "post_id": 48303948, "comment_id": 83601912, "body": "re: [go] tag followers and close voters: please do not flag this just because it&#39;s &quot;unclear to what is being asked&quot; - this is a Bazel and Go specific problem and it is tagged appropriately."}], "answers": [{"tags": [], "owner": {"reputation": 26173, "user_id": 1891, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c40d475927f7a86639ec54aa32517572?s=128&d=identicon&r=PG", "display_name": "Jay Conrod", "link": "https://stackoverflow.com/users/1891/jay-conrod"}, "is_accepted": true, "score": 3, "last_activity_date": 1516636233, "creation_date": 1516636233, "answer_id": 48385449, "question_id": 48303948, "link": "https://stackoverflow.com/questions/48303948/for-gazelle-how-can-i-drop-src-from-the-generated-importpath/48385449#48385449", "title": "For Gazelle, how can I drop src from the generated importpath?", "body": "<p>You can set the import path prefix in a subtree by adding a comment like this (replacing <code>example.com/repo</code> with whatever you want) to the build file in that subtree:</p>\n\n<pre><code># gazelle:prefix example.com/repo\n</code></pre>\n\n<p>In your repo, you can set an empty prefix in the src directory. So in src/BUILD.bazel, add this comment:</p>\n\n<pre><code># gazelle:prefix\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 9092109, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-hrGMno1WHyw/AAAAAAAAAAI/AAAAAAAAJmw/pssDz6hPGQc/photo.jpg?sz=128", "display_name": "Saurabh Garg", "link": "https://stackoverflow.com/users/9092109/saurabh-garg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 48385449, "answer_count": 1, "score": 0, "last_activity_date": 1516636233, "creation_date": 1516200964, "last_edit_date": 1516203125, "question_id": 48303948, "link": "https://stackoverflow.com/questions/48303948/for-gazelle-how-can-i-drop-src-from-the-generated-importpath", "title": "For Gazelle, how can I drop src from the generated importpath?", "body": "<p>Because of the GoPath convention, I have all the code under src directory in my repo. Hence, the generated BUILD.bazel files have src appended to the importpaths. But imports to the go code from within the repo need to not have src in them. Hence, I have to update the generated importpath each time I add a new go directory.  </p>\n\n<p>I believe the support for go-prefix is on its way out. So I don't want to use that. </p>\n\n<p>I can always update the importpath and add a #keep at the end to prevent subsequent updates. But, I was wondering if there was a way of controlling the generated importpath. </p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 6486, "user_id": 1116230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55a894894150db28d6641f0c57e48bac?s=128&d=identicon&r=PG", "display_name": "Nico Haase", "link": "https://stackoverflow.com/users/1116230/nico-haase"}, "edited": false, "score": 1, "creation_date": 1516200401, "post_id": 48303709, "comment_id": 83592279, "body": "You should check whether the generated query contains what you expect or not, this helps you to find the bug. Probably, you don&#39;t want to perform the <code>SUBSTRING</code> stuff within your query - you could simply build it purely in go"}, {"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "reply_to_user": {"reputation": 6486, "user_id": 1116230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55a894894150db28d6641f0c57e48bac?s=128&d=identicon&r=PG", "display_name": "Nico Haase", "link": "https://stackoverflow.com/users/1116230/nico-haase"}, "edited": false, "score": 0, "creation_date": 1516200564, "post_id": 48303709, "comment_id": 83592382, "body": "Thanks for reply Nico, i think you suggest me that first i convert this Hphone into formatted HPhone number like 999-999-9999 in purely go then i passed to it in queryArgs interface. am i right ?"}, {"owner": {"reputation": 6486, "user_id": 1116230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55a894894150db28d6641f0c57e48bac?s=128&d=identicon&r=PG", "display_name": "Nico Haase", "link": "https://stackoverflow.com/users/1116230/nico-haase"}, "edited": false, "score": 0, "creation_date": 1516200821, "post_id": 48303709, "comment_id": 83592559, "body": "Yes - if that really is the problem ;) But the longer I look at the query, the more I think that this is the problem. I&#39;ll post an additional answer"}], "answers": [{"tags": [], "owner": {"reputation": 6486, "user_id": 1116230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55a894894150db28d6641f0c57e48bac?s=128&d=identicon&r=PG", "display_name": "Nico Haase", "link": "https://stackoverflow.com/users/1116230/nico-haase"}, "is_accepted": false, "score": 0, "last_activity_date": 1516200931, "creation_date": 1516200931, "answer_id": 48303936, "question_id": 48303709, "link": "https://stackoverflow.com/questions/48303709/fetch-records-with-query-args-in-go/48303936#48303936", "title": "Fetch records with query Args in Go", "body": "<p>This won't work as you are using prepared statements, and the argument you are building when <code>HPhone</code> is not empty will be used in escaped form - so when executing the query, it won't compare the <code>HPhone</code> values with the <strong>computed result</strong> of some substring, but with a string containing <code>SUBSTRING(9999...</code></p>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1516205801, "creation_date": 1516205801, "answer_id": 48305539, "question_id": 48303709, "link": "https://stackoverflow.com/questions/48303709/fetch-records-with-query-args-in-go/48305539#48305539", "title": "Fetch records with query Args in Go", "body": "<p>Instead of <code>SUBSTRING</code> you can use <a href=\"https://dev.mysql.com/doc/refman/5.7/en/string-functions.html#function_replace\" rel=\"nofollow noreferrer\"><code>REPLACE</code></a> like so:</p>\n\n<pre><code>queryArgs := []interface{}{RouteAvailability.Depot}\n\nif HPhone != \"\" {\n    strQry += ` AND REPLACE(HPhone, '-', '') = ?`\n    queryArgs = append(queryArgs, HPhone)\n}\n</code></pre>\n\n<hr>\n\n<p>If possible I would suggest you normalize your data, i.e. decide on a canonical format for a particular data type and everytime your program receives some input that contains that data type you format it into its canonical form, that way you can avoid having to deal with <code>SUBSTRING</code>, or <code>REPLACE</code>, or multiple inconsistent formats etc.</p>\n"}], "owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 48305539, "answer_count": 2, "score": -2, "last_activity_date": 1522748258, "creation_date": 1516200115, "last_edit_date": 1522748258, "question_id": 48303709, "link": "https://stackoverflow.com/questions/48303709/fetch-records-with-query-args-in-go", "title": "Fetch records with query Args in Go", "body": "<p>I Need help for fetch records from table using Go.</p>\n\n<p>My Problem is that i'm writing MySQL query and add another where clause i.e HPhone number, Here HPhone number inserted in data base with format like <code>999-999-9999</code>.And i passed this HPhone Number in format like <code>9999999999</code>. which is not matching with correct data base field value. And i used <code>SUBSTRING</code> for add hyphen between numbers but it does not get records but when i passed like <code>999-999-9999</code> without <code>SUBSTRING</code> it return records.</p>\n\n<p>Here i demonstrate how i used this.</p>\n\n<pre><code>strQry = `SELECT * from table WHERE Depot = ?`\n\nif HPhone != \"\" {\n    strQry += ` AND HPhone = ?`\n}\n\nqueryArgs := []interface{}{RouteAvailability.Depot}\n\nif HPhone != \"\" {\n    queryArgs = append(queryArgs, \"SUBSTRING(\"+HPhone+\",1,3)\"+\"-\"+\"SUBSTRING(\"+HPhone+\",4,3)\"+\"-\"+\"SUBSTRING(\"+HPhone+\",7,4)\")\n}\n</code></pre>\n\n<p>Help would be appreciated.\nThanks in advance.</p>\n"}, {"tags": ["go", "containers", "stdout", "stdin"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516197667, "post_id": 48302398, "comment_id": 83590417, "body": "You are basically doing a websocket version of ssh. Maybe you can search for that."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1516206351, "post_id": 48302398, "comment_id": 83596373, "body": "The <a href=\"https://github.com/gorilla/websocket/tree/master/examples/command\" rel=\"nofollow noreferrer\">gorilla command example</a> might be useful to you.  Replace the os/exec calls with docker client calls."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 8460744, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q39-9WYGAIM/AAAAAAAAAAI/AAAAAAAAAMQ/roDYvBt2UeY/photo.jpg?sz=128", "display_name": "andy zhang", "link": "https://stackoverflow.com/users/8460744/andy-zhang"}, "edited": false, "score": 0, "creation_date": 1516280374, "post_id": 48305795, "comment_id": 83628975, "body": "Thanks for your answer. But it is not my expect behavior.  I want to get the command&#39;s stdout, if there has a timeout, I don&#39;t have chance to get output. Maybe I need research websocket version of ssh"}, {"owner": {"reputation": 36, "user_id": 4836700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70d3096f5043c96f81363c0737f2f686?s=128&d=identicon&r=PG&f=1", "display_name": "Adri&#225;n Polo Alcaide", "link": "https://stackoverflow.com/users/4836700/adri%c3%a1n-polo-alcaide"}, "reply_to_user": {"reputation": 11, "user_id": 8460744, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q39-9WYGAIM/AAAAAAAAAAI/AAAAAAAAAMQ/roDYvBt2UeY/photo.jpg?sz=128", "display_name": "andy zhang", "link": "https://stackoverflow.com/users/8460744/andy-zhang"}, "edited": false, "score": 0, "creation_date": 1516300677, "post_id": 48305795, "comment_id": 83641860, "body": "For do that I recommend to change the websocket for another library because you need to send the message type and you can&#39;t predefine the message types. I modified the code to connect the stdout to the websocket directly like the ssh does."}, {"owner": {"reputation": 11, "user_id": 8460744, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q39-9WYGAIM/AAAAAAAAAAI/AAAAAAAAAMQ/roDYvBt2UeY/photo.jpg?sz=128", "display_name": "andy zhang", "link": "https://stackoverflow.com/users/8460744/andy-zhang"}, "edited": false, "score": 0, "creation_date": 1516323222, "post_id": 48305795, "comment_id": 83650866, "body": "Still not work. :-(  I try to find another library.  I don&#39;t know docker how to solve it. If have time, I will research docker code to find a way.  Tks  Adri&#225;n Polo Alcaide"}, {"owner": {"reputation": 11, "user_id": 8460744, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q39-9WYGAIM/AAAAAAAAAAI/AAAAAAAAAMQ/roDYvBt2UeY/photo.jpg?sz=128", "display_name": "andy zhang", "link": "https://stackoverflow.com/users/8460744/andy-zhang"}, "edited": false, "score": 0, "creation_date": 1516368183, "post_id": 48305795, "comment_id": 83669417, "body": "O. Line 167 lost a for loop. I add this for loop, but still cannot get stdout like &quot;cd /&quot;.  If I type &quot;cd /&quot; in the web, still block in the &quot;data := &lt;-output&quot;. :-("}, {"owner": {"reputation": 36, "user_id": 4836700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70d3096f5043c96f81363c0737f2f686?s=128&d=identicon&r=PG&f=1", "display_name": "Adri&#225;n Polo Alcaide", "link": "https://stackoverflow.com/users/4836700/adri%c3%a1n-polo-alcaide"}, "reply_to_user": {"reputation": 11, "user_id": 8460744, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q39-9WYGAIM/AAAAAAAAAAI/AAAAAAAAAMQ/roDYvBt2UeY/photo.jpg?sz=128", "display_name": "andy zhang", "link": "https://stackoverflow.com/users/8460744/andy-zhang"}, "edited": false, "score": 0, "creation_date": 1516371488, "post_id": 48305795, "comment_id": 83671551, "body": "If you copy the second code on the answer will work fine. The &quot;cd /&quot; command not have any stdout. You need to create a gorutine to connect the stdout to the websocket."}], "tags": [], "owner": {"reputation": 36, "user_id": 4836700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70d3096f5043c96f81363c0737f2f686?s=128&d=identicon&r=PG&f=1", "display_name": "Adri&#225;n Polo Alcaide", "link": "https://stackoverflow.com/users/4836700/adri%c3%a1n-polo-alcaide"}, "is_accepted": false, "score": 1, "last_activity_date": 1516300581, "last_edit_date": 1516300581, "creation_date": 1516206635, "answer_id": 48305795, "question_id": 48302398, "link": "https://stackoverflow.com/questions/48302398/how-to-connect-container-stdin-stdout-with-websocket/48305795#48305795", "title": "How to connect container stdin &amp; stdout with websocket?", "body": "<p>You need to implement the timeout on the call because in this part:</p>\n\n<pre><code>log.Printf(\"recv: %s\", message)\n    inout &lt;- message\n    data := &lt;-output\n    err = conn.WriteMessage(mt, data)\n    if err != nil {\n        log.Println(\"write:\", err)\n        break\n    }\n</code></pre>\n\n<p>You are waiting always to get the response for the server.</p>\n\n<p>Here are you code working properly with the timeout implemented and an issue on the socket because needs to send utf8 and needs to be parsed to utf8 before send to the client. </p>\n\n<pre><code>package main\n\nimport (\n    dcl \"github.com/docker/docker/client\"\n    \"context\"\n    \"html/template\"\n    \"github.com/docker/docker/api/types\"\n    \"log\"\n    \"net/http\"\n    \"flag\"\n    \"github.com/gorilla/websocket\"\n    \"fmt\"\n    \"io\"\n    \"bufio\"\n    \"time\"\n    \"unicode/utf8\"\n)\n\nvar inout chan []byte\nvar output chan []byte\n\nvar addr = flag.String(\"addr\", \"localhost:8080\", \"http service address\")\n\nvar upgrader = websocket.Upgrader{}\n\nfunc echo(w http.ResponseWriter, r *http.Request) {\n    conn, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        log.Print(err)\n        return\n    }\n    defer conn.Close()\n\n    cli, err := dcl.NewEnvClient()\n    if err != nil {\n        log.Print(err)\n        conn.WriteMessage(websocket.TextMessage, []byte(err.Error()))\n        return\n    }\n\n    ctx := context.Background()\n    execConfig := types.ExecConfig{\n        AttachStderr: true,\n        AttachStdin:  true,\n        AttachStdout: true,\n        Cmd:          []string{\"/bin/sh\"},\n        Tty:          false,\n        Detach:       false,\n    }\n\n    //set target container\n    exec, err := cli.ContainerExecCreate(ctx, \"vigorous_mclean\", execConfig)\n    if err != nil {\n        log.Print(err)\n        conn.WriteMessage(websocket.TextMessage, []byte(err.Error()))\n        return\n    }\n    execAttachConfig := types.ExecStartCheck{\n        Detach: false,\n        Tty:    false,\n    }\n    containerConn, err := cli.ContainerExecAttach(ctx, exec.ID, execAttachConfig)\n    if err != nil {\n        log.Print(err)\n        conn.WriteMessage(websocket.TextMessage, []byte(err.Error()))\n        return\n    }\n    defer containerConn.Close()\n\n    bufin := bufio.NewReader(containerConn.Reader)\n\n    // Write to docker container\n    go func(w io.WriteCloser) {\n        for {\n            data, ok := &lt;-inout\n            log.Println(\"Received to send to docker\", data)\n            if !ok {\n                fmt.Println(\"!ok\")\n                w.Close()\n                return\n            }\n\n            w.Write(append(data, '\\n'))\n        }\n    }(containerConn.Conn)\n\n    // Received of Container Docker\n    go func() {\n        for {\n            buffer := make([]byte, 4096, 4096)\n            c, err := bufin.Read(buffer)\n            if err != nil {\n                fmt.Println(err)\n            }\n            //c, err := containerConn.Reader.Read(buffer)\n            if c &gt; 0 {\n                output &lt;- buffer[:c]\n            }\n            if c == 0 {\n                output &lt;- []byte{' '}\n            }\n            if err != nil {\n                break\n            }\n        }\n    }()\n\n    for {\n        conn.CloseHandler()\n        mt, message, err := conn.ReadMessage()\n        log.Println(mt)\n        if err != nil {\n            log.Println(\"read:\", err)\n            break\n        } else {\n            log.Printf(\"recv: %s\\n\", message)\n            inout &lt;- message\n            select {\n            case data := &lt;-output:\n                stringData := string(data[:])\n                if !utf8.ValidString(stringData) {\n                    v := make([]rune, 0, len(stringData))\n                    for i, r := range stringData {\n                        if r == utf8.RuneError {\n                            _, size := utf8.DecodeRuneInString(stringData[i:])\n                            if size == 1 {\n                                continue\n                            }\n                        }\n                        v = append(v, r)\n                    }\n                    stringData = string(v)\n                }\n                err = conn.WriteMessage(mt, []byte(stringData))\n                if err != nil {\n                    log.Println(\"write:\", err)\n                }\n\n            case &lt;-time.After(time.Second * 1):\n                log.Println(\"Timeout\")\n\n            }\n        }\n\n    }\n}\n\nfunc home(w http.ResponseWriter, r *http.Request) {\n    homeTemplate.Execute(w, \"ws://\"+r.Host+\"/echo\")\n}\n\nfunc main() {\n\n    inout = make(chan []byte)\n    output = make(chan []byte)\n\n    http.HandleFunc(\"/echo\", echo)\n    http.HandleFunc(\"/\", home)\n    log.Fatal(http.ListenAndServe(*addr, nil))\n}\n\nvar homeTemplate = template.Must(template.New(\"\").Parse(`\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;meta charset=\"utf-8\"&gt;\n&lt;script&gt;\nwindow.addEventListener(\"load\", function(evt) {\n    var output = document.getElementById(\"output\");\n    var input = document.getElementById(\"input\");\n    var ws;\n    var print = function(message) {\n        var d = document.createElement(\"div\");\n        d.innerHTML = message;\n        output.appendChild(d);\n    };\n    document.getElementById(\"open\").onclick = function(evt) {\n        if (ws) {\n            return false;\n        }\n        ws = new WebSocket(\"{{.}}\");\n        ws.onopen = function(evt) {\n            print(\"OPEN\");\n        }\n        ws.onclose = function(evt) {\n            print(\"CLOSE\");\n            ws = null;\n        }\n        ws.onmessage = function(evt) {\n            print(\"RESPONSE: \" + evt.data);\n        }\n        ws.onerror = function(evt) {\n            print(\"ERROR: \" + evt.data);\n        }\n        return false;\n    };\n    document.getElementById(\"send\").onclick = function(evt) {\n        if (!ws) {\n            return false;\n        }\n        print(\"SEND: \" + input.value);\n        ws.send(input.value);\n        return false;\n    };\n    document.getElementById(\"close\").onclick = function(evt) {\n        if (!ws) {\n            return false;\n        }\n        ws.close();\n        return false;\n    };\n});\n&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;table&gt;\n&lt;tr&gt;&lt;td valign=\"top\" width=\"50%\"&gt;\n&lt;p&gt;Click \"Open\" to create a connection to the server,\n\"Send\" to send a message to the server and \"Close\" to close the connection.\nYou can change the message and send multiple times.\n&lt;p&gt;\n&lt;form&gt;\n&lt;button id=\"open\"&gt;Open&lt;/button&gt;\n&lt;button id=\"close\"&gt;Close&lt;/button&gt;\n&lt;p&gt;&lt;input id=\"input\" type=\"text\" value=\"ls\"&gt;\n&lt;button id=\"send\"&gt;Send&lt;/button&gt;\n&lt;/form&gt;\n&lt;/td&gt;&lt;td valign=\"top\" width=\"50%\"&gt;\n&lt;div id=\"output\"&gt;&lt;/div&gt;\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n`))\n</code></pre>\n\n<p>Another method to connect directly the stdout to websocket without any timeout is create a goroutine that when you receive something from the docker send to the client directly and the code can be this</p>\n\n<pre><code>package main\n\nimport (\n    dcl \"github.com/docker/docker/client\"\n    \"context\"\n    \"html/template\"\n    \"github.com/docker/docker/api/types\"\n    \"log\"\n    \"net/http\"\n    \"flag\"\n    \"github.com/gorilla/websocket\"\n    \"fmt\"\n    \"io\"\n    \"bufio\"\n    \"unicode/utf8\"\n)\n\nvar inout chan []byte\nvar output chan []byte\n\nvar addr = flag.String(\"addr\", \"localhost:8080\", \"http service address\")\n\nvar upgrader = websocket.Upgrader{}\n\nfunc echo(w http.ResponseWriter, r *http.Request) {\n    conn, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        log.Print(err)\n        return\n    }\n    defer conn.Close()\n\n    cli, err := dcl.NewEnvClient()\n    if err != nil {\n        log.Print(err)\n        conn.WriteMessage(websocket.TextMessage, []byte(err.Error()))\n        return\n    }\n\n    ctx := context.Background()\n    execConfig := types.ExecConfig{\n        AttachStderr: true,\n        AttachStdin:  true,\n        AttachStdout: true,\n        Cmd:          []string{\"/bin/sh\"},\n        Tty:          false,\n        Detach:       false,\n    }\n\n    //set target container\n    exec, err := cli.ContainerExecCreate(ctx, \"sharp_goldwasser\", execConfig)\n    if err != nil {\n        log.Print(err)\n        conn.WriteMessage(websocket.TextMessage, []byte(err.Error()))\n        return\n    }\n    execAttachConfig := types.ExecStartCheck{\n        Detach: false,\n        Tty:    false,\n    }\n    containerConn, err := cli.ContainerExecAttach(ctx, exec.ID, execAttachConfig)\n    if err != nil {\n        log.Print(err)\n        conn.WriteMessage(websocket.TextMessage, []byte(err.Error()))\n        return\n    }\n    defer containerConn.Close()\n\n    bufin := bufio.NewReader(containerConn.Reader)\n\n    // Write to docker container\n    go func(w io.WriteCloser) {\n        for {\n            data, ok := &lt;-inout\n            log.Println(\"Received to send to docker\", data)\n            if !ok {\n                fmt.Println(\"!ok\")\n                w.Close()\n                return\n            }\n\n            w.Write(append(data, '\\n'))\n        }\n    }(containerConn.Conn)\n\n    // Received of Container Docker\n    go func() {\n        for {\n            buffer := make([]byte, 4096, 4096)\n            c, err := bufin.Read(buffer)\n            if err != nil {\n                fmt.Println(err)\n            }\n            //c, err := containerConn.Reader.Read(buffer)\n            if c &gt; 0 {\n                output &lt;- buffer[:c]\n            }\n            if c == 0 {\n                output &lt;- []byte{' '}\n            }\n            if err != nil {\n                break\n            }\n        }\n    }()\n    // Connect the STDOUT to the Socket\n    go func () {\n        data := &lt;-output\n        stringData := string(data[:])\n        if !utf8.ValidString(stringData) {\n            v := make([]rune, 0, len(stringData))\n            for i, r := range stringData {\n                if r == utf8.RuneError {\n                    _, size := utf8.DecodeRuneInString(stringData[i:])\n                    if size == 1 {\n                        continue\n                    }\n                }\n                v = append(v, r)\n            }\n            stringData = string(v)\n        }\n        err = conn.WriteMessage(1, []byte(stringData))\n        if err != nil {\n            log.Println(\"write:\", err)\n        }\n    }()\n\n    for {\n        conn.CloseHandler()\n        _, message, err := conn.ReadMessage()\n        if err != nil {\n            log.Println(\"read:\", err)\n            break\n        } else {\n            log.Printf(\"recv: %s\\n\", message)\n            inout &lt;- message\n\n        }\n\n    }\n}\n\nfunc home(w http.ResponseWriter, r *http.Request) {\n    homeTemplate.Execute(w, \"ws://\"+r.Host+\"/echo\")\n}\n\nfunc main() {\n\n    inout = make(chan []byte)\n    output = make(chan []byte)\n\n    http.HandleFunc(\"/echo\", echo)\n    http.HandleFunc(\"/\", home)\n    log.Fatal(http.ListenAndServe(*addr, nil))\n}\n\nvar homeTemplate = template.Must(template.New(\"\").Parse(`\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;meta charset=\"utf-8\"&gt;\n&lt;script&gt;\nwindow.addEventListener(\"load\", function(evt) {\n    var output = document.getElementById(\"output\");\n    var input = document.getElementById(\"input\");\n    var ws;\n    var print = function(message) {\n        var d = document.createElement(\"div\");\n        d.innerHTML = message;\n        output.appendChild(d);\n    };\n    document.getElementById(\"open\").onclick = function(evt) {\n        if (ws) {\n            return false;\n        }\n        ws = new WebSocket(\"{{.}}\");\n        ws.onopen = function(evt) {\n            print(\"OPEN\");\n        }\n        ws.onclose = function(evt) {\n            print(\"CLOSE\");\n            ws = null;\n        }\n        ws.onmessage = function(evt) {\n            print(\"RESPONSE: \" + evt.data);\n        }\n        ws.onerror = function(evt) {\n            print(\"ERROR: \" + evt.data);\n        }\n        return false;\n    };\n    document.getElementById(\"send\").onclick = function(evt) {\n        if (!ws) {\n            return false;\n        }\n        print(\"SEND: \" + input.value);\n        ws.send(input.value);\n        return false;\n    };\n    document.getElementById(\"close\").onclick = function(evt) {\n        if (!ws) {\n            return false;\n        }\n        ws.close();\n        return false;\n    };\n});\n&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;table&gt;\n&lt;tr&gt;&lt;td valign=\"top\" width=\"50%\"&gt;\n&lt;p&gt;Click \"Open\" to create a connection to the server,\n\"Send\" to send a message to the server and \"Close\" to close the connection.\nYou can change the message and send multiple times.\n&lt;p&gt;\n&lt;form&gt;\n&lt;button id=\"open\"&gt;Open&lt;/button&gt;\n&lt;button id=\"close\"&gt;Close&lt;/button&gt;\n&lt;p&gt;&lt;input id=\"input\" type=\"text\" value=\"ls\"&gt;\n&lt;button id=\"send\"&gt;Send&lt;/button&gt;\n&lt;/form&gt;\n&lt;/td&gt;&lt;td valign=\"top\" width=\"50%\"&gt;\n&lt;div id=\"output\"&gt;&lt;/div&gt;\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n`))\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8460744, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q39-9WYGAIM/AAAAAAAAAAI/AAAAAAAAAMQ/roDYvBt2UeY/photo.jpg?sz=128", "display_name": "andy zhang", "link": "https://stackoverflow.com/users/8460744/andy-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 935, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1516300581, "creation_date": 1516195947, "last_edit_date": 1516197428, "question_id": 48302398, "link": "https://stackoverflow.com/questions/48302398/how-to-connect-container-stdin-stdout-with-websocket", "title": "How to connect container stdin &amp; stdout with websocket?", "body": "<p>At present I want to connect container stdin and stdout with websocket.  But I can not read stdout if there are no output. e.g. \"cd /\"</p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    dcl \"github.com/docker/docker/client\"\n    \"context\"\n    \"html/template\"\n    \"github.com/docker/docker/api/types\"\n    \"log\"\n    \"net/http\"\n    \"flag\"\n    \"github.com/gorilla/websocket\"\n    \"fmt\"\n    \"io\"\n    \"bufio\"\n)\n\nvar inout chan []byte\nvar output chan []byte\n\nvar addr = flag.String(\"addr\", \"localhost:8080\", \"http service address\")\n\nvar upgrader = websocket.Upgrader{}\n\nfunc echo(w http.ResponseWriter, r *http.Request) {\n    conn, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        log.Print(err)\n        return\n    }\n    defer conn.Close()\n\n    cli, err := dcl.NewEnvClient()\n    if err != nil {\n        log.Print(err)\n        conn.WriteMessage(websocket.TextMessage, []byte(err.Error()))\n        return\n    }\n\n    ctx := context.Background()\n    execConfig := types.ExecConfig{\n        AttachStderr: true,\n        AttachStdin:  true,\n        AttachStdout: true,\n        Cmd:          []string{\"/bin/sh\"},\n        Tty:          false,\n        Detach:       false,\n    }\n\n    //set target container\n    exec, err := cli.ContainerExecCreate(ctx, \"ubuntu\", execConfig)\n    if err != nil {\n        log.Print(err)\n        conn.WriteMessage(websocket.TextMessage, []byte(err.Error()))\n        return\n    }\n    execAttachConfig := types.ExecStartCheck{\n        Detach: false,\n        Tty:    false,\n    }\n    containerConn, err := cli.ContainerExecAttach(ctx, exec.ID, execAttachConfig)\n    if err != nil {\n        log.Print(err)\n        conn.WriteMessage(websocket.TextMessage, []byte(err.Error()))\n        return\n    }\n    defer containerConn.Close()\n\n    bufin := bufio.NewReader(containerConn.Reader)\n\n    go func(w io.WriteCloser) {\n        for {\n            data, ok := &lt;-inout\n            if !ok {\n                fmt.Println(\"!ok\")\n                w.Close()\n                return\n            }\n\n            fmt.Println(string(data))\n            w.Write(append(data, '\\n'))\n        }\n    }(containerConn.Conn)\n\n    go func() {\n        for {\n            buffer := make([]byte, 4096, 4096)\n            c, err := bufin.Read(buffer)\n            if err != nil{\n                fmt.Println(err)\n            }\n            //c, err := containerConn.Reader.Read(buffer)\n            if c &gt; 0 {\n                output &lt;- buffer[:c]\n            }\n            if c == 0{\n                output &lt;- []byte{' '}\n            }\n            if err != nil {\n                break\n            }\n        }\n    }()\n\n    for {\n\n        mt, message, err := conn.ReadMessage()\n        if err != nil {\n            log.Println(\"read:\", err)\n            break\n        }\n\n        log.Printf(\"recv: %s\", message)\n        inout &lt;- message\n        data := &lt;-output\n        err = conn.WriteMessage(mt, data)\n        if err != nil {\n            log.Println(\"write:\", err)\n            break\n        }\n    }\n}\n\nfunc home(w http.ResponseWriter, r *http.Request) {\n    homeTemplate.Execute(w, \"ws://\"+r.Host+\"/echo\")\n}\n\nfunc main() {\n\n    inout = make(chan []byte)\n    output = make(chan []byte)\n\n    http.HandleFunc(\"/echo\", echo)\n    http.HandleFunc(\"/\", home)\n    log.Fatal(http.ListenAndServe(*addr, nil))\n}\n\nvar homeTemplate = template.Must(template.New(\"\").Parse(`\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;meta charset=\"utf-8\"&gt;\n&lt;script&gt;\nwindow.addEventListener(\"load\", function(evt) {\n    var output = document.getElementById(\"output\");\n    var input = document.getElementById(\"input\");\n    var ws;\n    var print = function(message) {\n        var d = document.createElement(\"div\");\n        d.innerHTML = message;\n        output.appendChild(d);\n    };\n    document.getElementById(\"open\").onclick = function(evt) {\n        if (ws) {\n            return false;\n        }\n        ws = new WebSocket(\"{{.}}\");\n        ws.onopen = function(evt) {\n            print(\"OPEN\");\n        }\n        ws.onclose = function(evt) {\n            print(\"CLOSE\");\n            ws = null;\n        }\n        ws.onmessage = function(evt) {\n            print(\"RESPONSE: \" + evt.data);\n        }\n        ws.onerror = function(evt) {\n            print(\"ERROR: \" + evt.data);\n        }\n        return false;\n    };\n    document.getElementById(\"send\").onclick = function(evt) {\n        if (!ws) {\n            return false;\n        }\n        print(\"SEND: \" + input.value);\n        ws.send(input.value);\n        return false;\n    };\n    document.getElementById(\"close\").onclick = function(evt) {\n        if (!ws) {\n            return false;\n        }\n        ws.close();\n        return false;\n    };\n});\n&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;table&gt;\n&lt;tr&gt;&lt;td valign=\"top\" width=\"50%\"&gt;\n&lt;p&gt;Click \"Open\" to create a connection to the server,\n\"Send\" to send a message to the server and \"Close\" to close the connection.\nYou can change the message and send multiple times.\n&lt;p&gt;\n&lt;form&gt;\n&lt;button id=\"open\"&gt;Open&lt;/button&gt;\n&lt;button id=\"close\"&gt;Close&lt;/button&gt;\n&lt;p&gt;&lt;input id=\"input\" type=\"text\" value=\"ls\"&gt;\n&lt;button id=\"send\"&gt;Send&lt;/button&gt;\n&lt;/form&gt;\n&lt;/td&gt;&lt;td valign=\"top\" width=\"50%\"&gt;\n&lt;div id=\"output\"&gt;&lt;/div&gt;\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n`))\n</code></pre>\n\n<p>I try many ways, but no way can work :(</p>\n"}, {"tags": ["go", "io"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1516193389, "post_id": 48301307, "comment_id": 83587573, "body": "Why do you want to use readers/writers for this? Normally readers and writers re used for passing data to/from other processes or computers as in over a network. Not between functions in the same program."}, {"owner": {"reputation": 425, "user_id": 5933751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8e19ea67a00c7347f5899aebeb44a51e?s=128&d=identicon&r=PG&f=1", "display_name": "mohd.gadi", "link": "https://stackoverflow.com/users/5933751/mohd-gadi"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1516203679, "post_id": 48301307, "comment_id": 83594604, "body": "Well for the sake of the example i was same program but my use case is actually as you mentioned above"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1516192889, "creation_date": 1516192889, "answer_id": 48301427, "question_id": 48301307, "link": "https://stackoverflow.com/questions/48301307/how-do-i-convert-byte-array-to-io-stream-and-convert-it-back-to-byte-array/48301427#48301427", "title": "How do I convert byte array to io. stream and convert it back to byte array?", "body": "<p><a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"nofollow noreferrer\">bytes.Buffer</a> is what you need. It can convert a byte slice to an io.Reader/io.Writer:</p>\n\n<pre><code>buf := bytes.NewBuffer([]bytes{...})\n</code></pre>\n\n<p>And to read from an io.Reader into a byte slice:</p>\n\n<pre><code>s, err := ioutil.ReadAll(r)\n</code></pre>\n\n<p>Converting to/from byte arrays is left as a trivial exercise for the reader.</p>\n"}], "owner": {"reputation": 425, "user_id": 5933751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8e19ea67a00c7347f5899aebeb44a51e?s=128&d=identicon&r=PG&f=1", "display_name": "mohd.gadi", "link": "https://stackoverflow.com/users/5933751/mohd-gadi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1975, "favorite_count": 0, "accepted_answer_id": 48301427, "answer_count": 1, "score": 0, "last_activity_date": 1516192889, "creation_date": 1516192522, "question_id": 48301307, "link": "https://stackoverflow.com/questions/48301307/how-do-i-convert-byte-array-to-io-stream-and-convert-it-back-to-byte-array", "title": "How do I convert byte array to io. stream and convert it back to byte array?", "body": "<pre><code>func main(){    \nbytearray:=[]byte{\"data\"}\nreader := bytes.NewReader(stdout.Bytes())\ntransfer(reader)\n}\n\nFunction 2\nfunc transfer(reader *Reader){\nbytearray:= //How do I get the original byte array?\n}\n</code></pre>\n\n<p>Basically I want to send byte array from one function to another using readers or writers</p>\n"}, {"tags": ["go", "revel"], "answers": [{"tags": [], "owner": {"reputation": 368, "user_id": 1171706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8e893c1d664ec913b5e752dd7c60393?s=128&d=identicon&r=PG", "display_name": "notzippy", "link": "https://stackoverflow.com/users/1171706/notzippy"}, "is_accepted": false, "score": 0, "last_activity_date": 1528397849, "last_edit_date": 1528397849, "creation_date": 1528396832, "answer_id": 50748151, "question_id": 48300230, "link": "https://stackoverflow.com/questions/48300230/how-to-disable-debug-logs-app-and-revel-both-in-app-conf-file-of-revel-framewo/50748151#50748151", "title": "How to disable debug logs (app and revel both) in app.conf file of revel framework?", "body": "<p>I think what you are seeing is debug output from the proxy. When running the revel application from the command line like</p>\n\n<pre><code> revel run myapp\n</code></pre>\n\n<p>The proxy starts up in debug mode (meaning you will see lots of debug messages), after the application has started the log should be configured to what is set in the app.conf</p>\n\n<p>Also there may be an assumption that off is an active handler, so it would discard the data, unfortunately the handlers are \"or\"ed logically together, not \"and\"ed so setting all outputs to one handler then turning one off does not affect the logger set to all</p>\n"}], "owner": {"reputation": 163, "user_id": 4970944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5115d1b7f1e4b600f4b21462fce45db5?s=128&d=identicon&r=PG", "display_name": "abhijit gupta", "link": "https://stackoverflow.com/users/4970944/abhijit-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 266, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1528397849, "creation_date": 1516188992, "question_id": 48300230, "link": "https://stackoverflow.com/questions/48300230/how-to-disable-debug-logs-app-and-revel-both-in-app-conf-file-of-revel-framewo", "title": "How to disable debug logs (app and revel both) in app.conf file of revel framework?", "body": "<p>I want to disable debug logs and want other logs to put in a file(logfile). I have tried following two snippets. But it doesnt work as expected. </p>\n\n<pre><code>log.all.filter.module.app = logfile\nlog.all.filter.module.revel = logfile\nlog.debug.filter.module.app = off\nlog.debug.filter.module.revel = off\n\n\nlog.all.output = logfile\nlog.debug.output = off\n</code></pre>\n\n<p>Going through the revel log documentation (<a href=\"http://revel.github.io/manual/logging.html\" rel=\"nofollow noreferrer\">http://revel.github.io/manual/logging.html</a>), they have mentioned that order of the log is significant but it isnt working in this case it seems. Am i missing something?</p>\n"}, {"tags": ["json", "regex", "performance", "go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 3, "creation_date": 1516186812, "post_id": 48299385, "comment_id": 83583381, "body": "Why use those? It&#39;s actually much cleaner (and more robust) to just unmarshal the input into json and check the unmarshaled object. Sure, the json package uses <code>reflect</code> internally, so I guess that falls under that category. Oh, and you&#39;re asking for opinions, that&#39;s pretty much <a href=\"https://stackoverflow.com/help/dont-ask\">off topic</a>. If you&#39;re concerned about performance, implement a few solutions and <a href=\"https://golang.org/pkg/testing/#hdr-Benchmarks\" rel=\"nofollow noreferrer\">benchmark</a> them."}, {"owner": {"reputation": 17, "user_id": 8671149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b261476d37d9dbeeab2cf21ec2d81b40?s=128&d=identicon&r=PG", "display_name": "Phong", "link": "https://stackoverflow.com/users/8671149/phong"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516187156, "post_id": 48299385, "comment_id": 83583598, "body": "thanks for the fast response i will try your way as well"}, {"owner": {"reputation": 1858, "user_id": 62398, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b3871a1b301fe93bbb8ab152a6c9693c?s=128&d=identicon&r=PG&f=1", "display_name": "gravitation", "link": "https://stackoverflow.com/users/62398/gravitation"}, "edited": false, "score": 1, "creation_date": 1516187405, "post_id": 48299385, "comment_id": 83583762, "body": "<code>regexp</code> is going to be faster but more error-prone. Probably not a good idea in production code."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1516189124, "post_id": 48299385, "comment_id": 83584811, "body": "&quot;regexp is going to be faster&quot; -- not something you hear very often."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1516189062, "creation_date": 1516189062, "answer_id": 48300248, "question_id": 48299385, "link": "https://stackoverflow.com/questions/48299385/reflect-vs-regex-to-check-for-empty-json-array-properties-in-golang/48300248#48300248", "title": "Reflect vs Regex to check for empty JSON array properties in Golang", "body": "<p>The most performant and error-proof way would be to manually parse the JSON tokens yourself with <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Token\" rel=\"nofollow noreferrer\">json's Decoder.Token</a> and related methods. \n This avoids the <code>json</code> package's normal use of Reflect entirely (since you're not unmarshaling into an arbitrary struct), and it avoids error-prone regular expressions. It will likely out-perform regex, too, but a benchmark will be necessary to be sure.</p>\n\n<p>But it will be some verbose, and arguably ugly code.</p>\n"}], "owner": {"reputation": 17, "user_id": 8671149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b261476d37d9dbeeab2cf21ec2d81b40?s=128&d=identicon&r=PG", "display_name": "Phong", "link": "https://stackoverflow.com/users/8671149/phong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 48300248, "answer_count": 1, "score": -3, "last_activity_date": 1516189062, "creation_date": 1516186579, "last_edit_date": 1516188862, "question_id": 48299385, "link": "https://stackoverflow.com/questions/48299385/reflect-vs-regex-to-check-for-empty-json-array-properties-in-golang", "title": "Reflect vs Regex to check for empty JSON array properties in Golang", "body": "<p>I receive a JSON Array from our Client which properties are empty:</p>\n\n<pre><code>[\n  {},{},{},{},{}\n]\n</code></pre>\n\n<p>Normally it looks like this e.g:</p>\n\n<pre><code>[\n    {\"Name\": \"foo\", \"Text\": \"Costumer\"},\n    {\"Name\": \"foo\", \"Text\": \"Employer\"},\n    {\"Name\": \"foo\", \"Text\": \"Costumer\"},\n    {\"Name\": \"foo\", \"Text\": \"Emplopyer\"},\n    {\"Name\": \"foo\", \"Text\": \"Employer\"}\n]\n</code></pre>\n\n<p>As far as my teacher said there is 2 possible ways to check for those empty properties: </p>\n\n<p>regexp package &amp;&amp; reflect package</p>\n\n<p><strong><em>Which should I use for performance?</em></strong></p>\n\n<p>And please explain why u would choose that package over the other</p>\n"}, {"tags": ["go", "etcd", "etcd3"], "owner": {"reputation": 1546, "user_id": 996895, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7cda552f4efbcbcabd6ef19e7011fa79?s=128&d=identicon&r=PG", "display_name": "svobol13", "link": "https://stackoverflow.com/users/996895/svobol13"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 745, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1543868304, "creation_date": 1516183380, "last_edit_date": 1543868304, "question_id": 48298325, "link": "https://stackoverflow.com/questions/48298325/etcd-watch-different-clients", "title": "Etcd watch different clients", "body": "<p>I struggle with getting <code>etcd</code> <code>watch</code> working with combination of clients. </p>\n\n<p>What works: I do <code>Watch</code>in <code>golang</code> client and I do <code>put</code> also there. Then watch register change. If I use <code>etcdctl</code> in same way i.e. watch/listen both in command line it also work.</p>\n\n<p>What doesnt work: I publish from command line and watch in go or vice versa.</p>\n\n<ul>\n<li>watch commandline, put golang: doesnt work</li>\n<li>watch commandline, put commandline: works</li>\n<li>watch golang, put commandline: doesnt work</li>\n<li>watch golang, put golang: works</li>\n</ul>\n\n<p><em>By \"doesnt work\" I mean watcher is not triggered.</em></p>\n\n<p>Go code I am playing with (you can run like <code>go run main.go (true|false) (true|false))</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/coreos/etcd/clientv3\"\n    \"context\"\n    \"time\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    listen := os.Args[1]\n    submit := os.Args[2]\n    cfg := clientv3.Config{\n        Endpoints: []string{\"http://10.0.75.1:2379\"},\n    }\n    c,_ := clientv3.New(cfg)\n    if listen == \"true\" {\n        fmt.Println(\"listening: on\")\n        ch := c.Watch(context.Background(), \"/foo\")\n        go func() {\n            for s := range ch {\n                fmt.Println(\"change: \", string(s.Events[0].Kv.Value))\n            }\n        }()\n    } else {\n        fmt.Println(\"listening: off\")\n    }\n    if submit == \"true\" {\n        fmt.Println(\"submiting: on\")\n        go func() {\n            for {\n                c.Put(context.Background(), \"/foo\", time.Now().String())\n                time.Sleep(1 * time.Second)\n            }\n        }()\n    } else {\n        fmt.Println(\"submiting: off\")\n    }\n    println(\"waiting 1h\")\n    time.Sleep(1 * time.Hour)\n}\n</code></pre>\n\n<p><code>etcdctl</code> commands I am using to publish/watch:</p>\n\n<p>update:</p>\n\n<pre><code>no_proxy=10.0.75.1 ETCDCTL_API=3 etcdctl.exe --endpoints=http://10.0.75.1:2379 put /foo \"$(date)\"\n</code></pre>\n\n<p>watch:</p>\n\n<pre><code>no_proxy=10.0.75.1 ETCDCTL_API=3 etcdctl.exe --endpoints=http://10.0.75.1:2379 watch /foo\n</code></pre>\n"}, {"tags": ["go", "methods", "interface"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1516183444, "post_id": 48296826, "comment_id": 83581092, "body": "Please note that that&#39;s the FAQ and not the spec, the spec allows for mixed receivers (value/pointer) for a single type, your program will still compile if method A is on a pointer while B on a value. Also <i>should</i> is not the same as <i>must</i>, I personally consider the statement in the FAQ a general recommendation and not something to be blindly followed. You have a case where it does not make sense? Then do not adhere to it!"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1516183969, "post_id": 48296826, "comment_id": 83581480, "body": "Wow! You discovered that later code changes might produce unexpected results! Welcome to the club. Test."}, {"owner": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1516187230, "post_id": 48296826, "comment_id": 83583644, "body": "@mkopriva , My question is about the FAQ consistency with core package &quot;fmt&quot;, which requires by-value receiver (assuming one wishes to use &quot;fmt&quot; methods in the &quot;natural&quot; way of providing the variables themeselves and not a reference/pointer to them). As you suggest, I need to ignore the FAQ in this case, but I ask why would the FAQ state such an approach if in the context of a core package it cannot be adhered?"}, {"owner": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1516187605, "post_id": 48296826, "comment_id": 83583887, "body": "@Volker, addition of a new method to an API should not break existing code if nothing changed in the existing API. This is not a matter of testing but a design problem. Why would an addition of a new independent method affect existing methods? The recommendation of the FAQ to be consistent with the receiver type (value or ptr) across all methods creates a problem that does not exist otherwise."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1516188410, "post_id": 48296826, "comment_id": 83584360, "body": "@ElazarR first off, the <code>fmt</code> package does not require by-value afaik; second, &quot;natural&quot;? &quot;natual&quot; by whose opinion? If a variable is already a pointer is this <code>*v</code> more &quot;natural&quot; than this <code>v</code>? The FAQ states a general recommendation, in my understanding anyway, and it&#39;s up to the users of the Go language, core package or not, whether they adhere to the recommendation or not. As far as using <code>fmt</code> goes, a client library could easily adhere to it, your case may differ, but that does not mean that &quot;it cannot be adhered&quot; to in general."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1516193867, "post_id": 48296826, "comment_id": 83587921, "body": "@ElazarR Adding the method doesn&#39;t break anything. Changing the receivers does. Best advice would be: Stop worrying about non-problems in real life."}], "answers": [{"comments": [{"owner": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516179801, "post_id": 48296967, "comment_id": 83578864, "body": "But in Go one does not really need to derefence a variable to invoke a method that is defined by-pointer. So even for a data type that has methods by-pointer the user of that data type would never bother to dereference the value (of <code>Person</code>, in your example). Only when using &quot;fmt&quot; one is required to recall that for that data type the methods are by-pointer and dereference it. This requires knowing how each data type&#39;s methods are implemented - which is not required for plain method invocation (consider the case when the data type is defined in another package)."}, {"owner": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516181697, "post_id": 48296967, "comment_id": 83580001, "body": "This is not a matter of possible or not and I understand that there are workarounds to this situation and one can always check the definition for a package he uses, however these solutions are not really scalable in a big project involving many independent programmers. Please see my clarification edits in the question."}, {"owner": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516186788, "post_id": 48296967, "comment_id": 83583367, "body": "What do you mean by &quot;modify uses of this type to &quot;switch&quot; to pointers...&quot;?  In GO one does not have to change anything in the using code if a receiver of a method was changed from by-value to by-pointer. All the invocations by-value would still compile and run correctly (thanks to the compiler). The problem remains - only &quot;fmt&quot; related invocations require a modification in this case."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516187332, "post_id": 48296967, "comment_id": 83583718, "body": "@ElazarR By that I mean if someone used the type by creating a non-pointer value of it, you&#39;d have to change it to be a pointer, e.g. <code>p := Person{}</code> to <code>p := &amp;Person{}</code>."}, {"owner": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516207830, "post_id": 48296967, "comment_id": 83597315, "body": "Not really. I can keep using <code>p.SomeMethod()</code> whether the method receives a pointer or a value for both p as a pointer (reference) as well as a value variable. GO compiler does not care. Since there is one method for either the object (value) or its pointer the compiler invokes the correct one and there is no need to change the using (caller) code. Only &quot;fmt&quot; functions distinguish between the by-value and the by-pointer cases of the String() method when invoking it for Println and other functions."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516208556, "post_id": 48296967, "comment_id": 83597796, "body": "@ElazarR That is a shortcut which is replaced by the compiler, I know that. But that only works if the operand is addressable. For example using my <code>Person</code> type from the answer, the following expression gives a compile-time error: <code>map[int]Person{1: {Name: &quot;Bob&quot;}}[1].String()</code>, but if you change <code>Person</code> to <code>*Person</code> it compiles and runs fine:<code>map[int]*Person{1: {Name: &quot;Bob&quot;}}[1].String()</code>. For details on this, check <a href=\"https://stackoverflow.com/a/44543748/1705598\">this answer</a> or this <a href=\"https://stackoverflow.com/a/34197367/1705598\">other answer</a>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516208686, "post_id": 48296967, "comment_id": 83597890, "body": "@ElazarR And stop &quot;beating&quot; the <code>fmt</code> package, it is not particular in any way. It uses reflection to check whether the passed values implement the <code>Stringer</code> interface, that&#39;s all. This technique is used by countless other packages."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1516186117, "last_edit_date": 1516186117, "creation_date": 1516178897, "answer_id": 48296967, "question_id": 48296826, "link": "https://stackoverflow.com/questions/48296826/stringer-method-requires-value/48296967#48296967", "title": "Stringer method requires value", "body": "<p>If you define your methods with pointer receiver, then you should use and pass pointer values and not non-pointer values. Doing so the passed value does indeed implement <code>Stringer</code>, and the <code>fmt</code> package will have no problem \"detecting\" and calling your <code>String()</code> method.</p>\n\n<p>Example:</p>\n\n<pre><code>type Person struct {\n    Name string\n}\n\nfunc (p *Person) String() string {\n    return fmt.Sprintf(\"Person[%s]\", p.Name)\n}\n\nfunc main() {\n    p := &amp;Person{Name: \"Bob\"}\n    fmt.Println(p)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/rQie-iA2kkY\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Person[Bob]\n</code></pre>\n\n<p>If you would pass a value of type <code>Person</code> to <code>fmt.Println()</code> instead of a pointer of type <code>*Person</code>, yes, indeed the <code>Person.String()</code> would not be called. But if all methods of <code>Person</code> has pointer receiver, that's a <em>strong indication</em> that you should use the type and its values as pointers (unless you don't intend its methods to be used).</p>\n\n<p>Yes, you have to know whether you have to use <code>Person</code> or <code>*Person</code>. Deal with it. If you want to write correct and efficient programs, you have to know a lot more than just whether to use pointer or non-pointer values, I don't know why this is a big deal for you. Look it up if you don't know, and if you're lazy, use a pointer as the method set of (the type of) a pointer value contains methods with both pointer and non-pointer receiver.</p>\n\n<p>Also the author of <code>Person</code> may provide you a <code>NewPerson()</code> factory function which you can rely on to return the value of the correct type (e.g. <code>Person</code> if methods have value receivers, and <code>*Person</code> if the methods have pointer receivers), and so you won't have to know which to use.</p>\n\n<p><strong>Answer to later adding a method with pointer receiver to a type which previously only had methods with value receiver:</strong></p>\n\n<p>Yes, as you described in the question, that might not break existing code, yet continuing to use a non-pointer value may not profit from the later added method with pointer receiver.</p>\n\n<p>We might ask: is this a problem? When the type was used, the new method you just added didn't exist. So the original code made no assumption about its existence. So it shouldn't be a problem.</p>\n\n<p>Second consideration: the type only had methods with value receiver, so one could easily assume that by their use, the value was <em>immutable</em> as methods with value receiver cannot alter the value. Code that used the type may have built on this, assuming it was not changed by its methods, so using it from multiple goroutines may have omitted certain synchronization rightfully.</p>\n\n<p>So I do think that adding a new method with pointer receiver to a type that previously only had methods with value receiver should not be \"opaque\", the person who adds this new method has the responsibility to either modify uses of this type to \"switch\" to pointers and make sure the code remains safe and correct, or deal with the fact that non-pointer values will not have this new method.</p>\n\n<p><strong>Tips:</strong></p>\n\n<p>If there's a chance that a type may have mutator methods in the future, you should start creating it with methods with pointer receivers. Doing so you avoid later having to go through the process described above.</p>\n\n<p>Another tip could be to hide the type entirely, and only publish interfaces. Doing so, the users of this type don't have to know whether the interface wraps a pointer or not, it just doesn't matter. They receive an interface value, and they call methods of the interface. It's the responsibility of the package author to take care of proper method receivers, and return the appropriate type that implements the interface. The clients don't see this and they don't depend on this. All they see and use is the interface.</p>\n"}, {"comments": [{"owner": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516190523, "post_id": 48300366, "comment_id": 83585760, "body": "I fail to understand how your example demonstrates my claim. S() is not a method (i.e., a function with receiver, per GO&#39;s jargon) - it is a plain function and as such the type of parameters is explicit. On the other hand, for the String() <i>methods</i>, I can invoke <code>t.String()</code> as well as <code>(&amp;t).String()</code> - both will work. However, fmt.Println(t) works as expected while fmt.Println(&amp;t) does not (and vice-versa for p)."}, {"owner": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516190799, "post_id": 48300366, "comment_id": 83585951, "body": "Anyway, I embrace the example of container/heap as it demonstrates that the 3rd rule (Consistency) is weak. Especially when considering the lack of <code>const</code> method modifier in GO (const method, as in C++), I would prefer avoiding passing a pointer to so many methods that do not mutate the data just to be &quot;consistent&quot;. This would also save me from the problem of the receiver type for <code>String()</code> - I would keep it by-value even if other methods are by-pointer."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516191145, "post_id": 48300366, "comment_id": 83586167, "body": "@ElazarR You should notice that <code>fmt.Println</code> is a plain function, not a method. The point is, <code>interface</code> is influenced (and <code>S()</code> does not take a fix type of parameter but an interface, just very simple in this case)."}, {"owner": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516208877, "post_id": 48300366, "comment_id": 83598016, "body": "I agree that <code>fmt.Println</code> is a plain function, however its implementation would invoke the <code>String()</code> method defined for the type of its argument. However, since there can be only one version of the <code>String()</code> method for a given type (by-value or by-pointer) then when <code>Println</code> is given the other &quot;mode&quot; of the argument it would invoke the default <code>String()</code> method for that data type (e.g., of a Struct) instead of the customized one. This is not the case for normal method invocation, where one can be sure that the respective method would be invoked for either pointer or a value receiver."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516209222, "post_id": 48300366, "comment_id": 83598208, "body": "@ElazarR Nope, that is not how fmt work. <code>Println</code> take a <code>interface{}</code> and do type assertion. It first try to cast it into a <code>Stringer</code> interface, and like the example, it may fail. After failure it use reflect to do some complicated stuff to use the &quot;default&quot; way. It is the same as the example, no magic there."}, {"owner": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516209430, "post_id": 48300366, "comment_id": 83598343, "body": "I understand that. My complain is about the &quot;default&quot; way. I expected that just as the compiler knows to convert a method invocation based on a value to a method invocation by pointer for a type just because it has a method defined by-pointer (and vice versa), &quot;fmt&quot; should check both ways too before falling to the &quot;default&quot; String()."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "edited": false, "score": 0, "creation_date": 1516209677, "post_id": 48300366, "comment_id": 83598493, "body": "@ElazarR It would not make sense to do that. You pass a value into a function, golang will make a copy of the value. And a pointer type has the potential to change the value. If the compiler modify it through an interface to access the pointer method, it will cause confusion of behavior."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 2, "last_activity_date": 1516189451, "creation_date": 1516189451, "answer_id": 48300366, "question_id": 48296826, "link": "https://stackoverflow.com/questions/48296826/stringer-method-requires-value/48300366#48300366", "title": "Stringer method requires value", "body": "<blockquote>\n  <p>In order to emphasize the essence of the problem I mention, consider a case where one has a data type with a set of methods defined with receiver by-value (including String()). Then one wishes to add an additional method that mutates that data type - so he defines it with receiver by-pointer, and (in order to be consistent, per FAQ answer) he also updates all the other methods of that data type to use by-pointer receiver. This change has zero impact on any code that uses the methods of this data type - BUT for invocations of fmt formatting functions (that now require passing a pointer to a variable instead of its value, as before the change). </p>\n</blockquote>\n\n<p>This is not true. All <code>interface</code> of it and some of type assertions will be affected as well - that is why fmt is affected. e.g. :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype I interface {\n    String() string\n}\n\nfunc (t t) String() string { return \"\" }\n\nfunc (p *p) String() string { return \"\" }\n\ntype t struct{}\ntype p struct{}\n\nfunc S(i I) {}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    T := t{}\n    P := p{}\n    _ = P\n    S(T)\n    //S(P) //fail\n}\n</code></pre>\n\n<p>To understand this from the root, you should know that a pointer method and a value method is different from the very base. However, for convenience, like the omit of <code>;</code>, golang compiler looks for cases using pointer methods without a pointer and change it back. </p>\n\n<p>As explained here: <a href=\"https://tour.golang.org/methods/6\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/6</a></p>\n\n<p>So back to the orignal question: consistency of pointer methods. If you read the faq more carefully, you will find it is the very last part of considering to use a value or pointer methods. And you can find counter-example in standard lib examples, in <code>container/heap</code> :</p>\n\n<pre><code>// A PriorityQueue implements heap.Interface and holds Items.\ntype PriorityQueue []*Item\n\nfunc (pq PriorityQueue) Len() int { return len(pq) }\n\nfunc (pq PriorityQueue) Less(i, j int) bool {\n    // We want Pop to give us the highest, not lowest, priority so we use greater than here.\n    return pq[i].priority &gt; pq[j].priority\n}\n\nfunc (pq PriorityQueue) Swap(i, j int) {\n    pq[i], pq[j] = pq[j], pq[i]\n    pq[i].index = i\n    pq[j].index = j\n}\n\nfunc (pq *PriorityQueue) Push(x interface{}) {\n    n := len(*pq)\n    item := x.(*Item)\n    item.index = n\n    *pq = append(*pq, item)\n}\n\nfunc (pq *PriorityQueue) Pop() interface{} {\n    old := *pq\n    n := len(old)\n    item := old[n-1]\n    item.index = -1 // for safety\n    *pq = old[0 : n-1]\n    return item\n}\n\n// update modifies the priority and value of an Item in the queue.\nfunc (pq *PriorityQueue) update(item *Item, value string, priority int) {\n    item.value = value\n    item.priority = priority\n    heap.Fix(pq, item.index)\n}\n</code></pre>\n\n<p>So, indeed, as the FAQ say, to determine whether to use a pointer methods, take the following consideration in order:</p>\n\n<ol>\n<li>Does the method need to modify the receiver? If yes, use a pointer. If not, there should be a good reason or it makes confusion.</li>\n<li>Efficiency. If the receiver is large, a big struct for instance, it will be much cheaper to use a pointer receiver. However, efficiency is not easy to discuss. If you think it is an issue, profile and/or benchmark it before doint so.</li>\n<li>Consistency. If some of the methods of the type must have pointer receivers, the rest should too, so the method set is consistent regardless of how the type is used. This, to me, means that if the type shall be used as a pointer (e.g., frequent modify), it should use the method set to mark so. It does not mean one type can only have solely pointer methods or the other way around.</li>\n</ol>\n"}], "owner": {"reputation": 1928, "user_id": 4359075, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8402c4ebac8daf5089467881855b75a1?s=128&d=identicon&r=PG&f=1", "display_name": "ElazarR", "link": "https://stackoverflow.com/users/4359075/elazarr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 568, "favorite_count": 0, "accepted_answer_id": 48300366, "answer_count": 2, "score": 5, "last_activity_date": 1516189451, "creation_date": 1516178419, "last_edit_date": 1516183674, "question_id": 48296826, "link": "https://stackoverflow.com/questions/48296826/stringer-method-requires-value", "title": "Stringer method requires value", "body": "<p><a href=\"https://golang.org/doc/faq#methods_on_values_or_pointers\" rel=\"nofollow noreferrer\">The Go FAQ answers a question</a> regarding the choice of by-value vs. by-pointer receiver definition in methods. One of the statements in that answer is: </p>\n\n<blockquote>\n  <p>If some of the methods of the type must have pointer receivers, the rest should too, so the method set is consistent regardless of how the type is used. </p>\n</blockquote>\n\n<p>This implies that if I have for a data type a few methods that mutate the data, thus require by-pointer receiver, I should use by-pointer receiver for all the methods defined for that data type. </p>\n\n<p>On the other hand, the <code>\"fmt\"</code> package invokes the <code>String()</code> method as defined in the <code>Stringer</code> interface <strong>by value</strong>. If one defines the <code>String()</code> method with a receiver by-pointer it would not be invoked when the associated data type is given as a parameter to <code>fmt.Println</code> (or other <code>fmt</code> formatting methods). This leaves one no choice but to implement the <code>String()</code> method with a receiver by value. </p>\n\n<p>How can one be consistent with the choice of by-value vs. by-pointer, as the FAQ suggests, while fulfilling <code>fmt</code> requirements for the <code>Stringer</code> interface?</p>\n\n<p>EDIT:</p>\n\n<p>In order to emphasize the essence of the problem I mention, consider a case where one has a data type with a set of methods defined with receiver by-value (including String()). Then one wishes to add an additional method that mutates that data type - so he defines it with receiver by-pointer, and (in order to be consistent, per FAQ answer) he also updates all the other methods of that data type to use by-pointer receiver. This change has zero impact on any code that uses the methods of this data type - BUT for invocations of <code>fmt</code> formatting functions (that now require passing a pointer to a variable instead of its value, as before the change). So consistency requirements are only problematic in the context of <code>fmt</code>. The need to adjust the manner one provides a variable to <code>fmt.Println</code> (or similar function) based on the receiver type breaks the capability to easily refactor one's package.</p>\n"}, {"tags": ["go", "design-patterns", "interface"], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 0, "last_activity_date": 1516182713, "last_edit_date": 1516182713, "creation_date": 1516176477, "answer_id": 48296306, "question_id": 48295982, "link": "https://stackoverflow.com/questions/48295982/what-is-the-best-practice-when-multiple-structs-have-several-common-functions-in/48296306#48296306", "title": "What is the best practice when multiple structs have several common functions in golang", "body": "<p>An interface describes the methods required to perform a certain action. In your case, this is definitely the following:</p>\n\n<pre><code>type API interface {\n    ExternalAPI1() error\n    ExternalAPI2(s string)\n}\n</code></pre>\n\n<p>However, do note that this does not limit the use of non-exported methods when using your <strong>struct</strong> (not class) directly from the same package.</p>\n"}, {"comments": [{"owner": {"reputation": 1858, "user_id": 62398, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b3871a1b301fe93bbb8ab152a6c9693c?s=128&d=identicon&r=PG&f=1", "display_name": "gravitation", "link": "https://stackoverflow.com/users/62398/gravitation"}, "edited": false, "score": 0, "creation_date": 1516186648, "post_id": 48299387, "comment_id": 83583279, "body": "incidentally godoc used to show the unexported methods, so <a href=\"https://github.com/golang/go/issues/10856\" rel=\"nofollow noreferrer\">you can see unexported methods common() and uncommon() in this issue</a>"}], "tags": [], "owner": {"reputation": 1858, "user_id": 62398, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b3871a1b301fe93bbb8ab152a6c9693c?s=128&d=identicon&r=PG&f=1", "display_name": "gravitation", "link": "https://stackoverflow.com/users/62398/gravitation"}, "is_accepted": false, "score": 1, "last_activity_date": 1516186584, "creation_date": 1516186584, "answer_id": 48299387, "question_id": 48295982, "link": "https://stackoverflow.com/questions/48295982/what-is-the-best-practice-when-multiple-structs-have-several-common-functions-in/48299387#48299387", "title": "What is the best practice when multiple structs have several common functions in golang", "body": "<p>If you want the compiler to enforce that all structs which implement the interface have the unexported methods too, the unexported methods can certainly be included in the interface.</p>\n\n<p>reflect.Type is an example from the stdlib (<a href=\"https://godoc.org/reflect#Type\" rel=\"nofollow noreferrer\">see here, godoc notes that the interface contains unexported methods</a>)</p>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 3, "last_activity_date": 1516202371, "creation_date": 1516202371, "answer_id": 48304406, "question_id": 48295982, "link": "https://stackoverflow.com/questions/48295982/what-is-the-best-practice-when-multiple-structs-have-several-common-functions-in/48304406#48304406", "title": "What is the best practice when multiple structs have several common functions in golang", "body": "<p>tl;dr: don't worry about interfaces when creating structs, worry about interfaces when creating functions that would consume them.</p>\n\n<p>The question overlooks an important underlying question: do you need an interface at all? I.e., is something going to accept values of the interface type, and operate on them without knowledge of the underlying type? If so, <em>what methods will it call</em> on the value? <em>Those</em> are the methods that should be in the interface.</p>\n\n<p>Remember that Go uses duck interfaces; therefor, interfaces should be defined to suit the consumer, <em>not</em> the implementation. In fact, they should generally be <em>defined</em> alongside the consumer, not the implementation, because the implementation doesn't need to know anything about the interfaces it implements.</p>\n\n<p>In Go, when a function or method can operate on \"anything that implements method X\", then alongside that function or method, you can define an \"Xer\" interface with that method signature. This allows anything to be passed to that function which meets the interface, and the function doesn't need to worry about what the underlying type is.</p>\n"}], "owner": {"reputation": 361, "user_id": 7229120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5af5b05b1499d40493fb6ed087bf12b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron", "link": "https://stackoverflow.com/users/7229120/aaron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 785, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1516202371, "creation_date": 1516175175, "question_id": 48295982, "link": "https://stackoverflow.com/questions/48295982/what-is-the-best-practice-when-multiple-structs-have-several-common-functions-in", "title": "What is the best practice when multiple structs have several common functions in golang", "body": "<p>I have 3 classes, which have several operation steps implemented in different functions. For example, </p>\n\n<pre><code>func ExternalAPI1() error\nfunc ExternalAPI2(s string)\nfunc internalProcess1() error\nfunc internalProcess2(s []string) error \nfunc internalProcess3(d int) error\n</code></pre>\n\n<p>For the <strong>internalProcessx</strong>, they're internal functions which may not be invoked by other classes, but these functions do have identical signatures.\nShould I generate an interface for them with only <strong>ExternalAPI1</strong> and <strong>ExternalAPI2</strong> included? or should I include all these 5 functions in the interface?</p>\n"}, {"tags": ["go", "system-calls", "setrlimit"], "answers": [{"comments": [{"owner": {"reputation": 2371, "user_id": 4140668, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/50c0905a6e33a9fa6f7e050c09ed1277?s=128&d=identicon&r=PG", "display_name": "lz96", "link": "https://stackoverflow.com/users/4140668/lz96"}, "edited": false, "score": 0, "creation_date": 1516176989, "post_id": 48295815, "comment_id": 83577305, "body": "What if the address space of the new rlimit is lower than current usage? Will the subsequent <code>execve</code> fail in this case?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 2371, "user_id": 4140668, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/50c0905a6e33a9fa6f7e050c09ed1277?s=128&d=identicon&r=PG", "display_name": "lz96", "link": "https://stackoverflow.com/users/4140668/lz96"}, "edited": false, "score": 1, "creation_date": 1516177575, "post_id": 48295815, "comment_id": 83577614, "body": "Depending on which limit you&#39;re setting, you may get killed first, or <code>execve</code> may fail. Also be aware that I have no idea what is necessary to run <code>fork&#47;exec</code> manually in Go (you may want to dig through the <code>os&#47;exec</code> code."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 0, "last_activity_date": 1516179466, "last_edit_date": 1516179466, "creation_date": 1516174454, "answer_id": 48295815, "question_id": 48295074, "link": "https://stackoverflow.com/questions/48295074/limiting-child-processs-memory-usage-with-rlimit-without-affecting-current-proc/48295815#48295815", "title": "Limiting child process&#39;s memory usage with rlimit without affecting current process", "body": "<p>You need to apply <code>rlimit</code> to the child process only rather than relying on rlimit inheritance. Your main blocker here is clearly spelled out in the <code>setrlimit</code> man page:</p>\n\n<blockquote>\n  <p>an unprivileged process may set only its soft limit to a value in the\n  range from 0 up to the hard limit, and (irreversibly) lower its hard\n  limit</p>\n</blockquote>\n\n<p>The standard way to do this is through fork/exec, something along the lines of:</p>\n\n<pre><code>child_pid := fork()\nif pid != 0 {\n  // in child process\n  setrlimit(...)\n  execve(...)\n}\n</code></pre>\n\n<p>If you don't want to do that, you still have a few options:</p>\n\n<ul>\n<li>run as privileged user</li>\n<li><code>cmd.Run</code> a small wrapper (eg: <code>bash ulimit -m ...</code>) that calls the child process. note: <code>-m</code> is not honored by many systems.</li>\n<li>call <code>prlimit</code> (linux-specific and no syscall wrapper. <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/_8_os7mIs2M\" rel=\"nofollow noreferrer\">see this thread</a> for details)</li>\n</ul>\n"}], "owner": {"reputation": 2371, "user_id": 4140668, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/50c0905a6e33a9fa6f7e050c09ed1277?s=128&d=identicon&r=PG", "display_name": "lz96", "link": "https://stackoverflow.com/users/4140668/lz96"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 789, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1516179466, "creation_date": 1516171436, "last_edit_date": 1516174935, "question_id": 48295074, "link": "https://stackoverflow.com/questions/48295074/limiting-child-processs-memory-usage-with-rlimit-without-affecting-current-proc", "title": "Limiting child process&#39;s memory usage with rlimit without affecting current process", "body": "<p>I want to limit the memory usage of a child process using rlimit. Currently our code is as follows:</p>\n\n<pre><code>old_rlimit := get_rlimit()\nset_rlimit(child_process_rlimit)\ncmd.Start()\nset_rlimit(old_rlimit)\ncmd.Wait()\n</code></pre>\n\n<p>However, sometimes Golang runtime will report out of memory error at <code>cmd.Start()</code>. It seems that in <code>cmd.Start()</code> current process will allocate some memory, and if current memory usage is higher than <code>child_process_rlimit</code>, an error will be raised.</p>\n\n<p>I want to know is there any way to limit the memory usage of child process without affecting current one?</p>\n"}, {"tags": ["go", "struct", "initialization", "singly-linked-list"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516167179, "post_id": 48294158, "comment_id": 83573277, "body": "Why, the error is clear. Just change the return type to <code>*StackLinked</code> or remove the <code>&amp;</code>. And for en empty struct, just <code>StackLinked{}</code> is enough."}, {"owner": {"reputation": 23, "user_id": 7187126, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/453b3b2bb0fd17a072a7a49aece9c398?s=128&d=identicon&r=PG&f=1", "display_name": "chrislamprey", "link": "https://stackoverflow.com/users/7187126/chrislamprey"}, "edited": false, "score": 0, "creation_date": 1516167515, "post_id": 48294158, "comment_id": 83573368, "body": "Thank you for your replies. I have gotten rid of the &amp;, that was a silly error. The main concern is the overcomplication."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1516167836, "post_id": 48294158, "comment_id": 83573468, "body": "@chrislamprey I thought the required signature is <code>func makeStackLinked() Stacker</code> where <code>Stacker</code> is an interface specified in your assignment."}, {"owner": {"reputation": 23, "user_id": 7187126, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/453b3b2bb0fd17a072a7a49aece9c398?s=128&d=identicon&r=PG&f=1", "display_name": "chrislamprey", "link": "https://stackoverflow.com/users/7187126/chrislamprey"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1516168027, "post_id": 48294158, "comment_id": 83573535, "body": "@CeriseLim&#243;n That is correct! Thank you for pointing that out."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1516168102, "post_id": 48294158, "comment_id": 83573558, "body": "In that case, you will want to return <code>&amp;StackLinked{}</code>"}, {"owner": {"reputation": 23, "user_id": 7187126, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/453b3b2bb0fd17a072a7a49aece9c398?s=128&d=identicon&r=PG&f=1", "display_name": "chrislamprey", "link": "https://stackoverflow.com/users/7187126/chrislamprey"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1516168628, "post_id": 48294158, "comment_id": 83573710, "body": "@CeriseLim&#243;n Thank you. I have fixed that and removed the prev* as I don&#39;t believe it is necessary for this purpose.."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1516169466, "post_id": 48294158, "comment_id": 83573981, "body": "Where exactly is the overcomplication? I cannot even see any complication at all."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 7187126, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/453b3b2bb0fd17a072a7a49aece9c398?s=128&d=identicon&r=PG&f=1", "display_name": "chrislamprey", "link": "https://stackoverflow.com/users/7187126/chrislamprey"}, "edited": false, "score": 0, "creation_date": 1516170903, "post_id": 48294826, "comment_id": 83574485, "body": "Thank you for all of your help! I&#39;ve got it all working now, I believe. Still similar to my initial implementation but it works so I can&#39;t complain."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1516170418, "creation_date": 1516170418, "answer_id": 48294826, "question_id": 48294158, "link": "https://stackoverflow.com/questions/48294158/initialization-of-singly-linked-list-with-one-struct/48294826#48294826", "title": "Initialization of Singly Linked List with one Struct", "body": "<p>Use the following:</p>\n\n<pre><code>type stackElement struct {\n    next *stackElement\n    data int\n}\n\ntype StackLinked struct {\n    head *stackElement\n    n    int\n}\n\nfunc makeStackLinked() Stacker {\n    return &amp;StackLinked{}\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 306, "user_id": 2536252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e29959d1027ff89ba83767e9d9517a?s=128&d=identicon&r=PG", "display_name": "Adriel Artiza", "link": "https://stackoverflow.com/users/2536252/adriel-artiza"}, "is_accepted": false, "score": 0, "last_activity_date": 1516173263, "creation_date": 1516173263, "answer_id": 48295529, "question_id": 48294158, "link": "https://stackoverflow.com/questions/48294158/initialization-of-singly-linked-list-with-one-struct/48295529#48295529", "title": "Initialization of Singly Linked List with one Struct", "body": "<p>You can use this following:</p>\n\n<pre><code>type Student struct {\n    Name string     `json:\"name\"`\n    ID string       `json:\"id\"`\n    Next *Student   \n}\n\nfunc (s *Student) Insert(name, sid string) {\n    st := &amp;Student {\n        Name: name,\n        ID: sid,\n        Next: s.Next,\n    }\n    s.Next = st\n}\n\nfunc (s *Student) Show() {\n    for st := s.Next; st != nil; st = st.Next {\n        fmt.Println(st.Name,st.ID)\n    }\n}\n\nfunc main ( ) {\n\n    root := new ( Student )\n    root.Insert ( \"Juan\", \"54542\" )\n    root.Insert ( \"Lito\", \"93828\" )\n\n    root.Show()\n}\n\nOutput:\n\nLito 93828\nJuan 54542\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 7187126, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/453b3b2bb0fd17a072a7a49aece9c398?s=128&d=identicon&r=PG&f=1", "display_name": "chrislamprey", "link": "https://stackoverflow.com/users/7187126/chrislamprey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 0, "accepted_answer_id": 48294826, "answer_count": 2, "score": 0, "last_activity_date": 1516173263, "creation_date": 1516166902, "last_edit_date": 1516168301, "question_id": 48294158, "link": "https://stackoverflow.com/questions/48294158/initialization-of-singly-linked-list-with-one-struct", "title": "Initialization of Singly Linked List with one Struct", "body": "<p>For an assignment I am working on, we were instructed to create two data structures that implement a Stack inferface (including push, pop, etc.. methods). While I completed the first structure, the Linked List portion has me at a loss. As someone who is writing their first Go project, I am unsure how to approach the following instruction:</p>\n\n<p>1.Create a new struct called StackLinked that implements Stacker, and uses a singly (or doubly) linked list as its internal representation. </p>\n\n<p>2.In addition to implementing all the methods in Stacker, write a makeStackLinked() function (not method!) with this header that returns a new empty stack using a linked list representation </p>\n\n<p>Which I had attempted to implement as so:</p>\n\n<pre><code>type StackLinked struct{\n    top *StackLinked \n    next *StackLinked\n    data int\n    size int\n}\n\nfunc makeStackLinked() Stacker {\n    list := &amp;StackLinked{\n        top : nil,\n        next : nil,\n        data : 0,\n        size : 0,\n    }\n    return list;\n}\n</code></pre>\n\n<p>I feel I may be over complicating things (I have only worked with Singly Linked Lists in C++). </p>\n\n<p>Does anyone have any suggestions or recommendations on the best way to implement the StackLinked struct and accompanying initialization function? </p>\n\n<p>EDIT: The function header: func makeStackLinked() StackLinked {} is a requirement for the assignment and cannot be altered.</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["json", "go", "marshalling"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1516159491, "post_id": 48293036, "comment_id": 83571284, "body": "What exactly is the problem you\u2019re trying to solve? Maps aren\u2019t ordered so the order of serialization shouldn\u2019t matter. If it does matter for some reason, you have to write it out yourself like in the linked answer."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516159505, "post_id": 48293036, "comment_id": 83571288, "body": "In golang, a map is unordered. If you want to preserve the order, you might need to parse the string to a struct (with fixed fields) or to a custom type with your own parsing methods. If you choose the latter, you will need a slice to store the order."}, {"owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516162056, "post_id": 48293036, "comment_id": 83571876, "body": "@JimB Thank you for your advice. I thought I may be misunderstanding from your advice. I want to update the json object and output it. But when I use Marshal, the json object is reordering. For example, I want to update <code>{&quot;key3&quot;: &quot;value3&quot;, &quot;key2&quot;: &quot;value2&quot;, &quot;key1&quot;: &quot;value1&quot;}</code> to <code>{&quot;key3&quot;: &quot;value3&quot;, &quot;key2&quot;: &quot;updated value2&quot;, &quot;key1&quot;: &quot;value1&quot;}</code>. I use <code>map[string]interface{}</code> because keys of json sometimes changes."}, {"owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516162070, "post_id": 48293036, "comment_id": 83571880, "body": "@leaf bebop Thank you for your advice. I had thought I cannot use a struct because the keys of json sometimes changes. So I used <code>map[string]interface{}</code>."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516162129, "post_id": 48293036, "comment_id": 83571892, "body": "In that case you will need implent your own parsing method."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516162321, "post_id": 48293036, "comment_id": 83571937, "body": "@Elsa but what about the linked answer doesn\u2019t allow you to order the output. Note that not only are maps unordered in Go, but json objects are as well, so whatever is decoding them may not preserve the order either."}, {"owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516162713, "post_id": 48293036, "comment_id": 83572042, "body": "@leaf bebop Thank you for your advice. I will think the solution from your advices."}, {"owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516162718, "post_id": 48293036, "comment_id": 83572044, "body": "@JimB Thank you for your advice. I will think the solution from your advices."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 1, "creation_date": 1516165380, "post_id": 48293036, "comment_id": 83572800, "body": "In JSON, <a href=\"http://json.org\" rel=\"nofollow noreferrer\"><b>&quot;An object is an unordered set of name/value pairs&quot;</b></a> so order doesn&#39;t make any sense on the JSON side of things either."}], "answers": [{"comments": [{"owner": {"reputation": 167, "user_id": 2458761, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3230e7e3b7653d1db3fa556a427910c1?s=128&d=identicon&r=PG", "display_name": "Aditya Raman", "link": "https://stackoverflow.com/users/2458761/aditya-raman"}, "edited": false, "score": 1, "creation_date": 1594152632, "post_id": 48301733, "comment_id": 111025397, "body": "@Ieaf bebop:  Spent whole day to figure out the solution to a similar problem. This idea helped to solve it finally. Thanks a lot"}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 8, "last_activity_date": 1516193763, "creation_date": 1516193763, "answer_id": 48301733, "question_id": 48293036, "link": "https://stackoverflow.com/questions/48293036/prevent-alphabetically-ordering-json-at-marshal/48301733#48301733", "title": "Prevent alphabetically ordering json at Marshal", "body": "<p>You can preserve the order like this:</p>\n\n<pre><code>type OrderedMap struct {\n    Order []string\n    Map map[string]string\n}\n\nfunc (om *OrderedMap) UnmarshalJSON(b []byte) error {\n    json.Unmarshal(b,&amp;om.Map)\n\n    index:=make(map[string]int)\n    for key:=range om.Map {\n        om.Order=append(om.Order,key)\n        esc,_:=json.Marshal(key) //Escape the key\n        index[key]=bytes.Index(b,esc)\n    }\n\n    sort.Slice(om.Order, func(i,j int) bool { return index[om.Order[i]]&lt;index[om.Order[j]] })\n    return nil\n}\n\nfunc (om OrderedMap) MarshalJSON() ([]byte, error) {\n    var b []byte\n    buf:=bytes.NewBuffer(b)\n    buf.WriteRune('{')\n    l:=len(om.Order)\n    for i,key:=range om.Order {\n        km,err:=json.Marshal(key)\n        if err!=nil { return nil,err }\n        buf.Write(km)\n        buf.WriteRune(':')\n        vm,err:=json.Marshal(om.Map[key])\n        if err!=nil { return nil,err }\n        buf.Write(vm)\n        if i!=l-1 { buf.WriteRune(',') }\n        fmt.Println(buf.String())\n    }\n    buf.WriteRune('}')\n    fmt.Println(buf.String())\n    return buf.Bytes(),nil\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/TxenZEuy_u0\" rel=\"noreferrer\">https://play.golang.org/p/TxenZEuy_u0</a></p>\n\n<p>Please note that json spec says objects are unordered, which means other client may not respect the order you preserve.</p>\n"}], "owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4928, "favorite_count": 2, "accepted_answer_id": 48301733, "answer_count": 1, "score": 9, "last_activity_date": 1516193763, "creation_date": 1516158864, "question_id": 48293036, "link": "https://stackoverflow.com/questions/48293036/prevent-alphabetically-ordering-json-at-marshal", "title": "Prevent alphabetically ordering json at Marshal", "body": "<p>I want to prevent alphabetically reordering at Marshal. My script is below. <code>{\"key3\": \"value3\", \"key2\": \"value2\", \"key1\": \"value1\"}</code> is reordered to <code>{\"key1\":\"value1\",\"key2\":\"value2\",\"key3\":\"value3\"}</code> by Marshal. I thought <a href=\"https://stackoverflow.com/questions/25182923/serialize-a-map-using-a-specific-order\">this</a> may be close issue. But I could not solve my issue. Is there way to solve this?</p>\n\n<h3>Script</h3>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    obj := `{\"key3\": \"value3\", \"key2\": \"value2\", \"key1\": \"value1\"}`\n    var o map[string]interface{}\n    json.Unmarshal([]byte(obj), &amp;o)\n    fmt.Println(o)\n    r, _ := json.Marshal(o)\n    fmt.Println(string(r))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/H19JwUwOvr8\" rel=\"noreferrer\">play.golang.org</a></p>\n\n<ul>\n<li><code>fmt.Println(o)</code> is <code>map[key3:value3 key2:value2 key1:value1]</code>.</li>\n<li><code>fmt.Println(string(r))</code> is <code>{\"key1\":\"value1\",\"key2\":\"value2\",\"key3\":\"value3\"}</code>.</li>\n</ul>\n\n<p>Thank you so much for your time. And I'm sorry for my immature question.</p>\n"}, {"tags": ["go", "constructor", "variadic-functions"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516159752, "post_id": 48293026, "comment_id": 83571351, "body": "No, it is not possible unless you assign it manually or use reflect. It raises the question: why don&#39;t use a slice."}, {"owner": {"reputation": 5125, "user_id": 98693, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ef5ae6548ea49522a5ad0e3c57f2bdc7?s=128&d=identicon&r=PG", "display_name": "ovanes", "link": "https://stackoverflow.com/users/98693/ovanes"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516160173, "post_id": 48293026, "comment_id": 83571450, "body": "@leafbebop I don&#39;t mind to use a slice here, but not reflection. Variadic arguments can be converted to a slice, if I learned it properly."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516160767, "post_id": 48293026, "comment_id": 83571589, "body": "I mean, why don&#39;t you make all those fieldN thing into a slice field? like <code>struct { Fields []string }</code>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1516163103, "post_id": 48293026, "comment_id": 83572168, "body": "Looks a bit like you are trying to force something on Go which is not quite right. Leave traditional OOP behind; it will hurt you in Go."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1516165171, "creation_date": 1516165171, "answer_id": 48293880, "question_id": 48293026, "link": "https://stackoverflow.com/questions/48293026/creating-a-type-with-optional-fields-from-variadic-arguments-in-go/48293880#48293880", "title": "Creating a type with optional fields from variadic arguments in Go", "body": "<p>It's possible with a little bit of code:</p>\n\n<pre><code>func CreateMyType(arguments ...string) *MyType {\n    var m MyType\n    switch len(arguments) {\n    case 3:\n        m.field3 = arguments[2]\n        fallthrough\n    case 2:\n        m.field2 = arguments[1]\n        fallthrough\n    case 1:\n        m.field1 = arguments[0]\n    }\n    return &amp;m\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ihXtASguOGv\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 5125, "user_id": 98693, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ef5ae6548ea49522a5ad0e3c57f2bdc7?s=128&d=identicon&r=PG", "display_name": "ovanes", "link": "https://stackoverflow.com/users/98693/ovanes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 48293880, "answer_count": 1, "score": -2, "last_activity_date": 1516235842, "creation_date": 1516158819, "last_edit_date": 1516235842, "question_id": 48293026, "link": "https://stackoverflow.com/questions/48293026/creating-a-type-with-optional-fields-from-variadic-arguments-in-go", "title": "Creating a type with optional fields from variadic arguments in Go", "body": "<p>I am learning Go right now and would like to initialize a type using variadic arguments without using reflection. Is it possible?</p>\n\n<p>Here an example:</p>\n\n<pre><code>type MyType struct {\n    field1 string\n    field2 string\n    ...\n    fieldN string\n}\n\nfunc CreateMyType(arguments ...string) *MyType {\n    inst := MyType{arguments...}  // does not work, is there any other way???\n    return &amp;inst\n}\n</code></pre>\n\n<p><strong>Note</strong> It makes me really sad, that the question is downvoted, where I ask legitimate things and try to learn out of them :(</p>\n"}, {"tags": ["sorting", "dictionary", "go", "slice"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1516144096, "post_id": 48291202, "comment_id": 83567587, "body": "What are the types of the maps, <code>map[string]interface{}</code>? Or are they structs? The easiest way is <a href=\"https://golang.org/pkg/sort/#Slice\" rel=\"nofollow noreferrer\"><code>sort.Slice</code></a>, which even comes with an example."}], "answers": [{"tags": [], "owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "is_accepted": true, "score": 2, "last_activity_date": 1516144590, "creation_date": 1516144590, "answer_id": 48291340, "question_id": 48291202, "link": "https://stackoverflow.com/questions/48291202/sort-slice-of-maps/48291340#48291340", "title": "Sort slice of maps", "body": "<p>just a simple <code>sort.Slice</code>.</p>\n\n<pre><code>sort.Slice(information, \nfunc(i, j int) bool { \n    return information[i].Difference &gt; information[j].Difference \n})\n</code></pre>\n"}], "owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1231, "favorite_count": 0, "accepted_answer_id": 48291340, "answer_count": 1, "score": -2, "last_activity_date": 1516144590, "creation_date": 1516143677, "question_id": 48291202, "link": "https://stackoverflow.com/questions/48291202/sort-slice-of-maps", "title": "Sort slice of maps", "body": "<p>I have a slice of 10 maps, how can I sort by one of the values?</p>\n\n<pre><code>[{\"name\":\"a\",\"score\":100},\n{\"name\":\"z\",\"score\":150},\n{\"name\":\"s\",\"score\":120},\n{\"name\":\"x\",\"score\":110},\n{\"name\":\"r\",\"score\":10},\n{\"name\":\"b\",\"score\":1300},\n{\"name\":\"b\",\"score\":1500},\n{\"name\":\"w\",\"score\":1002},\n{\"name\":\"o\",\"score\":140},\n{\"name\":\"q\",\"score\":101}]\n</code></pre>\n\n<p>I want to sort the slice with the <code>score</code> value, in descending order, but I'm at a loss of how. </p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 4083, "user_id": 1885518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b5971e6c4c6476a1bed2c41e646287f?s=128&d=identicon&r=PG", "display_name": "Murmel", "link": "https://stackoverflow.com/users/1885518/murmel"}, "edited": false, "score": 0, "creation_date": 1516140732, "post_id": 48290599, "comment_id": 83566368, "body": "how far did you get by now on your own?"}, {"owner": {"reputation": 475, "user_id": 8138241, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/1vjoG.jpg?s=128&g=1", "display_name": "Jason Liu", "link": "https://stackoverflow.com/users/8138241/jason-liu"}, "reply_to_user": {"reputation": 4083, "user_id": 1885518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b5971e6c4c6476a1bed2c41e646287f?s=128&d=identicon&r=PG", "display_name": "Murmel", "link": "https://stackoverflow.com/users/1885518/murmel"}, "edited": false, "score": 0, "creation_date": 1516140950, "post_id": 48290599, "comment_id": 83566447, "body": "I am new to golang, I implemented all functions for StackSlice and StackLinked stucture and the stack work perfectly. I cannot release all detail as it is an assignment. I find it is hard to compare different structure as the argument is an interface and I have spent days on it still have no clue how to make it work. You can see my code comment that the ways I tried."}, {"owner": {"reputation": 4083, "user_id": 1885518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b5971e6c4c6476a1bed2c41e646287f?s=128&d=identicon&r=PG", "display_name": "Murmel", "link": "https://stackoverflow.com/users/1885518/murmel"}, "edited": false, "score": 0, "creation_date": 1516141109, "post_id": 48290599, "comment_id": 83566525, "body": "It is always a good starting point to describe your - by now - best approach (even if in the end this can also turn out to be completely useless) to build on top of it and be able to give you better hints into the correct direction. You can use pseudo code too."}, {"owner": {"reputation": 475, "user_id": 8138241, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/1vjoG.jpg?s=128&g=1", "display_name": "Jason Liu", "link": "https://stackoverflow.com/users/8138241/jason-liu"}, "reply_to_user": {"reputation": 4083, "user_id": 1885518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b5971e6c4c6476a1bed2c41e646287f?s=128&d=identicon&r=PG", "display_name": "Murmel", "link": "https://stackoverflow.com/users/1885518/murmel"}, "edited": false, "score": 1, "creation_date": 1516141855, "post_id": 48290599, "comment_id": 83566809, "body": "Thank you for the suggestion, I am trying to make the question clearer"}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1516147783, "post_id": 48290599, "comment_id": 83568605, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/24534072/how-to-compare-struct-slice-map-are-equal\">How to compare struct, slice, map are equal?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 2, "last_activity_date": 1516152408, "last_edit_date": 1516152408, "creation_date": 1516152103, "answer_id": 48292329, "question_id": 48290599, "link": "https://stackoverflow.com/questions/48290599/golang-comparing-two-structs-that-are-implemented-differently/48292329#48292329", "title": "golang comparing two structs that are implemented differently", "body": "<p>If you need to compare two interfaces, you can only use the methods in that interface, so in this case, <code>String</code> does not exist in the interface (even though both of your implementations have it, the interface itself does not).</p>\n\n<p>A possible implementation would be:</p>\n\n<pre><code>func stackEquals(s, t Stacker) bool {\n    // if they are the same object, return true\n    if s == t {\n        return true\n    }\n    // if they have different sizes or the next element is not the same,\n    // then they are different\n    if s.size() != t.size() || s.peek() != t.peek() {\n        return false\n    }\n\n    // they could be the same, so let's copy them so that we don't mess up\n    // the originals\n    ss = s.copy()\n    tt = t.copy()\n\n    // iterate through the values and check if each one is\n    // the same.  If not, return false\n    for ; i, err := ss.pop(); err == nil {\n        if j, err := tt.pop(); err != nil || i != j {\n            return false\n        }\n    }\n\n    return true\n}\n</code></pre>\n\n<p>This assumes that the only error <code>pop</code> would get is when there are no more values, otherwise you will need to do some better error checking and use <code>isEmpty</code>.</p>\n"}], "owner": {"reputation": 475, "user_id": 8138241, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/1vjoG.jpg?s=128&g=1", "display_name": "Jason Liu", "link": "https://stackoverflow.com/users/8138241/jason-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1413, "favorite_count": 0, "accepted_answer_id": 48292329, "answer_count": 1, "score": 1, "last_activity_date": 1516160743, "creation_date": 1516140385, "last_edit_date": 1516160743, "question_id": 48290599, "link": "https://stackoverflow.com/questions/48290599/golang-comparing-two-structs-that-are-implemented-differently", "title": "golang comparing two structs that are implemented differently", "body": "<p>I am new to go language, under learning. I have years OOP experience in C++. There is a stacker interface that is written in go and two implementations of it, one is slice base stack and another one is linkedlist base.</p>\n\n<p>I find it is hard to compare two different structures and tell if they are containing the same data or not. The simple example code list below (notice a lot of functions/implementations are not listed because they are not relative with this question). The key function is <strong>stackEquals</strong>, I have tried different ways to approach it but they failed. Please see the comments in the code.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"errors\"\n)\n\n// The interface is fixed, cannot be modified\ntype Stacker interface {\n    isEmpty() bool\n    size() int\n    push(x int)\n    peek() (int, error)\n    pop() (int, error)\n    copy() Stacker\n} \n\ntype StackSlice struct {\n    slice []int\n}\n\ntype StackLinked struct {\n    next *StackLinked\n    value int\n    // possible with other variables that is not relative\n}\n\n// There are interface function/method implementations did not paste\n\nfunc (s StackSlice) String() string {\n    // return all the value inside the stack as string\n    // like [5 4]\n}\n\nfunc (s StackLinked) String() string {\n    // return all the value inside the stack as string\n    // like [5 4]]\n}\n\n// Pre-condition:\n//    none\n// Post-condition:\n//    returns true if s and t have the same elements in the same order;\n//    both s and t have the same value after calling stackEquals as before\n// Annoying constraint:\n//    Use only Stackers in the body of this functions: don't use arrays,\n//    slices, or any container other than a Stacker.\nfunc stackEquals(s, t Stacker) bool {\n    // This implementation below always return false unless they are the same thing\n    return s == t \n\n    // I tried return s.String() == t.String() but gave an error said interface doesn't have String() method.\n}\n</code></pre>\n\n<p>How can I compare two stacks that implemented in different way and tell if they are the same (same means same values in same order) in the stack.</p>\n"}, {"tags": ["go", "nested-function"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1516137063, "post_id": 48289821, "comment_id": 83564792, "body": "Because you never call <code>makeFunction3</code>, its return value, and never print the <code>name</code> values? I&#39;m not sure what you expect."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1516189755, "post_id": 48289821, "comment_id": 83585235, "body": "If you are going to call a chain of functions, with the same signature, I suggest take a look at implementing a FSM (Finite State Machine) in Go. This is not a full fledged FSM, but provides the essence, which makes these sort of tasks far cleaner. See this part by Rob Pike <a href=\"https://youtu.be/HxaD_trXwRE?t=14m7s\" rel=\"nofollow noreferrer\">youtu.be/HxaD_trXwRE?t=14m7s</a>"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 10, "last_activity_date": 1516137258, "creation_date": 1516137258, "answer_id": 48289933, "question_id": 48289821, "link": "https://stackoverflow.com/questions/48289821/golang-returning-functions/48289933#48289933", "title": "Golang returning functions", "body": "<p>Let's follow the program flow:</p>\n\n<ol>\n<li><code>main</code> starts.</li>\n<li><code>main</code> calls <code>makeFunction</code>.</li>\n<li><code>makeFunction</code> prints <code>00000</code>, and returns an anonymous function.</li>\n<li>Back in <code>main</code>, we call the anonymous function returned by the previous call.</li>\n<li>The anonymous function calls <code>makeFunction2</code>.</li>\n<li><code>makeFunction2</code> prints <code>11111</code>, and returns an anonymous function.</li>\n<li><code>main</code> returns.</li>\n</ol>\n\n<p>Because the return value is discarded after step 6 above, nothing else is printed.</p>\n"}, {"tags": [], "owner": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "is_accepted": true, "score": 6, "last_activity_date": 1516137258, "creation_date": 1516137258, "answer_id": 48289934, "question_id": 48289821, "link": "https://stackoverflow.com/questions/48289821/golang-returning-functions/48289934#48289934", "title": "Golang returning functions", "body": "<p>Let's look at your <code>main</code>:</p>\n\n<h3>Line 1</h3>\n\n<pre><code>f := makeFunction(\"hellooo\")\n</code></pre>\n\n<ul>\n<li>Side effect: printing \"00000\"</li>\n<li>Return value: an anonymous function that executes <code>makeFunction2(\"abcef\")</code>, assigned to the identifier <code>f</code></li>\n</ul>\n\n<h3>Line 2</h3>\n\n<pre><code>f()\n</code></pre>\n\n<p>which is equivalent to:</p>\n\n<pre><code>_ = f()\n</code></pre>\n\n<ul>\n<li>Side effect: printing \"11111\"</li>\n<li>Return value: an anonymous function that executes <code>makeFunction3(\"safsf\")</code>, discarded (you are not assigning the return value of <code>f()</code>).</li>\n</ul>\n\n<p><code>makeFunction3</code> is never assigned to any identifier, and never called.</p>\n"}, {"tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": false, "score": 2, "last_activity_date": 1516149288, "creation_date": 1516149288, "answer_id": 48291984, "question_id": 48289821, "link": "https://stackoverflow.com/questions/48289821/golang-returning-functions/48291984#48291984", "title": "Golang returning functions", "body": "<p>To prints the 3's, you have to call twice:</p>\n\n<pre><code>f()()\n</code></pre>\n\n<p>And to prints the 4's too, just do:</p>\n\n<pre><code>f()()()\n</code></pre>\n\n<p>Because ...</p>\n\n<pre><code>// prints \"00000\" and returns a function that if run\n// will invoked `makeFunction2`\nf := makeFunction(\"hello\")\n\n// `makeFunction2` is called, printing \"11111\" and returns \n// a function that if run will invoked `makeFunction3`\nf1 := f()\n\n// `makeFunction3` is called, printing \"33333\" and returns\n// a function that if run will invoked `makeFunction4`\nf2 := f1()\n</code></pre>\n\n<p>Test question, what does it print out if you do this?</p>\n\n<pre><code>f := makeFunction(\"Hello\")()()\nf()\n</code></pre>\n\n<p>This is known as currying or closure, but in your example you have not closed over any local value so the latter loses its meaning.</p>\n"}, {"tags": [], "owner": {"reputation": 306, "user_id": 2536252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e29959d1027ff89ba83767e9d9517a?s=128&d=identicon&r=PG", "display_name": "Adriel Artiza", "link": "https://stackoverflow.com/users/2536252/adriel-artiza"}, "is_accepted": false, "score": 0, "last_activity_date": 1516158066, "creation_date": 1516158066, "answer_id": 48292939, "question_id": 48289821, "link": "https://stackoverflow.com/questions/48289821/golang-returning-functions/48292939#48292939", "title": "Golang returning functions", "body": "<p>makeFunction only return the function makeFunction2. since this is not a recursive function. If you expecting to behave like recursive function, then you should change return func(){} to (return makeFunction2 or 3)</p>\n\n<pre><code>func makeFunction(name string) func() {\n    fmt.Println(\"00000\")\n    return makeFunction2(\"abcef\")\n}\n\nfunc makeFunction2(name string) func() {\n    fmt.Println(\"11111\")\n    return makeFunction3(\"safsf\")\n}\n\nfunc makeFunction3(name string) func() {\n    fmt.Println(\"33333\")\n    return func() {\n        fmt.Printf(\"444444\")\n    }\n}\n\nfunc main() {\n    f := makeFunction(\"hellooo\")\n    f()\n}\n\n// Output: \n00000\n11111\n33333\n444444\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 179, "user_id": 12698841, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mnLhX.png?s=128&g=1", "display_name": "0example.com", "link": "https://stackoverflow.com/users/12698841/0example-com"}, "is_accepted": false, "score": 0, "last_activity_date": 1612872989, "creation_date": 1612872989, "answer_id": 66118820, "question_id": 48289821, "link": "https://stackoverflow.com/questions/48289821/golang-returning-functions/66118820#66118820", "title": "Golang returning functions", "body": "<p>The Reason is it only returns the anonymous funtions.</p>\n<pre><code>package main\n\nimport &quot;fmt&quot;\n\nfunc makeFunction(name string) func() {\n    fmt.Println(&quot;00000&quot;)\n    return func(){\n        makeFunction2(&quot;abcef&quot;)()\n    }\n}\n\nfunc makeFunction2(name string) func() {\n    fmt.Println(&quot;11111&quot;)\n    return func() {\n        makeFunction3(&quot;safsf&quot;)()\n    }\n}\n\nfunc makeFunction3(name string) func() {\n    fmt.Println(&quot;33333&quot;)\n    return func() {\n        fmt.Printf(&quot;444444&quot;)\n    }\n}\n\nfunc main() {\n    f := makeFunction(&quot;hellooo&quot;)\n    f()\n}\n</code></pre>\n"}], "owner": {"reputation": 271, "user_id": 8859115, "user_type": "registered", "profile_image": "https://graph.facebook.com/10211283633499859/picture?type=large", "display_name": "kunrazor", "link": "https://stackoverflow.com/users/8859115/kunrazor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14805, "favorite_count": 1, "accepted_answer_id": 48289934, "answer_count": 5, "score": 9, "last_activity_date": 1612872989, "creation_date": 1516136745, "question_id": 48289821, "link": "https://stackoverflow.com/questions/48289821/golang-returning-functions", "title": "Golang returning functions", "body": "<blockquote>\n  <p>Can anyone explain why 0's and 1's are printed and not anything else? Thank you!</p>\n</blockquote>\n\n<pre><code>func makeFunction(name string) func() {\n    fmt.Println(\"00000\")\n    return func() {\n        makeFunction2(\"abcef\")\n    }\n}\n\nfunc makeFunction2(name string) func() {\n    fmt.Println(\"11111\")\n    return func() {\n        makeFunction3(\"safsf\")\n    }\n}\n\nfunc makeFunction3(name string) func() {\n    fmt.Println(\"33333\")\n    return func() {\n        fmt.Printf(\"444444\")\n    }\n}\n\nfunc main() {\n    f := makeFunction(\"hellooo\")\n    f()\n}\n</code></pre>\n\n<p>Can anyone explain why 0's and 1's are printed and not anything else? Thank you!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1516133974, "post_id": 48289118, "comment_id": 83563301, "body": "Use <code>==</code> to compare values for equality: <code>func compare(p1, p2 Person) bool { return p1 == p2 }</code>.  This seems obvious.  Perhaps the question is asking you to add methods to Person?"}, {"owner": {"reputation": 475, "user_id": 8138241, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/1vjoG.jpg?s=128&g=1", "display_name": "Jason Liu", "link": "https://stackoverflow.com/users/8138241/jason-liu"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1516134195, "post_id": 48289118, "comment_id": 83563400, "body": "You are absolutely right, could you input it as an answer below and with a little bit explaination why could it work just with p1 instead of a function call?"}, {"owner": {"reputation": 475, "user_id": 8138241, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/1vjoG.jpg?s=128&g=1", "display_name": "Jason Liu", "link": "https://stackoverflow.com/users/8138241/jason-liu"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1516136255, "post_id": 48289118, "comment_id": 83564416, "body": "I updated a bit of the code, now it doesn&#39;t work. Suppose there is another structure but with the same elements (could be in different order), how can I compare those two object now? I am implementing a stack with array and linkedlist in golang and trying to compare them even they are in different implementation. It always return false if they are from different structure."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1516136564, "post_id": 48289118, "comment_id": 83564567, "body": "You are asking a different question in the edit. I answered the original question."}, {"owner": {"reputation": 475, "user_id": 8138241, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/1vjoG.jpg?s=128&g=1", "display_name": "Jason Liu", "link": "https://stackoverflow.com/users/8138241/jason-liu"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1516136869, "post_id": 48289118, "comment_id": 83564711, "body": "Sorry, I will post a new question instead"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1516134238, "creation_date": 1516134238, "answer_id": 48289238, "question_id": 48289118, "link": "https://stackoverflow.com/questions/48289118/golang-comparing-two-structures-with-their-interface-arguments/48289238#48289238", "title": "golang comparing two structures with their interface arguments", "body": "<p>The <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"nofollow noreferrer\">specification says</a>:</p>\n\n<blockquote>\n  <p>Interface values are comparable. Two interface values are equal if they have identical dynamic types and equal dynamic values or if both have value nil.</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>Struct values are comparable if all their fields are comparable. Two struct values are equal if their corresponding non-blank fields are equal.</p>\n</blockquote>\n\n<p>All of the struct fields are comparable.</p>\n\n<p>Given this, you can use the equal operator:</p>\n\n<pre><code>func compare(p1, p2 Person) bool { \n    return p1 == p2\n}\n</code></pre>\n"}], "owner": {"reputation": 475, "user_id": 8138241, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/1vjoG.jpg?s=128&g=1", "display_name": "Jason Liu", "link": "https://stackoverflow.com/users/8138241/jason-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1942, "favorite_count": 0, "accepted_answer_id": 48289238, "answer_count": 1, "score": 1, "last_activity_date": 1516135738, "creation_date": 1516133686, "last_edit_date": 1516135738, "question_id": 48289118, "link": "https://stackoverflow.com/questions/48289118/golang-comparing-two-structures-with-their-interface-arguments", "title": "golang comparing two structures with their interface arguments", "body": "<p>I am currently studying golang. I have OOP knowledge especially on C++.\nHere is the example code:\npackage main</p>\n\n<pre><code>import \"fmt\"\n\ntype Person interface{\n    // Some other functions\n}\n\ntype info struct {\n    Name string\n    Age  int\n}\n\ntype example struct {\n    Description string\n    Other int\n}\n\nfunc (p info) String() string {\n    return fmt.Sprintf(\"%v (%v years)\", p.Name, p.Age)\n}\n\nfunc (p example) String() string {\n    return fmt.Sprintf(\"%v (%v years)\", p.Description, p.Other)\n}\n\n// The argument cannot be changed\n// Try not to access into Person because there will be other different structures\n// that implement the Person interface\nfunc compare(p1, p2 Person) bool {\n    return p1 == p2\n}\n\nfunc main() {\n    a := info{\"Arthur Dent\", 42}\n    z := info{\"Zaphod Beeblebrox\", 9001}\n    b := example{\"Arthur Dent\", 42}\n    fmt.Println(a, z)\n    fmt.Println(compare(a, b))\n}\n</code></pre>\n\n<p>As you can see, there is a interface call Person, implemented by a structure call info. There are functions in Person but for simplifying the question, I didn't post those. The problem now is I have implemented the method String for info but the compare function takes Person elements as input.</p>\n\n<p>Suppose the declaration of  the compare function cannot be changed and use only Person in the body of this functions, how can I solve the problem or achieve the compara functionality?</p>\n"}, {"tags": ["csv", "go", "awk", "cut"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1516130093, "post_id": 48288283, "comment_id": 83561394, "body": "You should start by profiling your app. Working solely with strings, and repeatedly allocating new ones is likely the problem."}, {"owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516130543, "post_id": 48288283, "comment_id": 83561627, "body": "@JimB I am still new to Go. How to avoid repeatedly allocating new strings?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516131281, "post_id": 48288283, "comment_id": 83561967, "body": "use <code>[]byte</code> rather than <code>string</code>, and reuse the slices when possible."}, {"owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516131529, "post_id": 48288283, "comment_id": 83562078, "body": "@JimB Could you show the complete code about how to change the program? I am still not familiar with Go yet about where and how to make the change."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1516132489, "post_id": 48288283, "comment_id": 83562594, "body": "Call <a href=\"https://godoc.org/bufio#Scanner.Bytes\" rel=\"nofollow noreferrer\">Bytes</a> instead of Text.  Use <a href=\"https://godoc.org/bytes#Split\" rel=\"nofollow noreferrer\">bytes.Split</a> on the result or use <a href=\"https://godoc.org/bytes#IndexByte\" rel=\"nofollow noreferrer\">bytes.IndexByte</a> to find the split points."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516140437, "post_id": 48288283, "comment_id": 83566257, "body": "Oh, and looking more closely here, why are you trying to use go like a scripting language? --  <code>#!&#47;usr&#47;bin&#47;env gorun</code>?? Your example here is adding the compile time to the executing time. Just compile the program normally."}, {"owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516140909, "post_id": 48288283, "comment_id": 83566432, "body": "@JimB <code>#!&#47;usr&#47;bin&#47;env gorun</code> is not a problem for my application. It only takes some time upon the first run. For later runs, the code will not be compiled again. It only adds up a little time to find the already compiled code and run it. So it will not cause much slow down especially given my input is very large."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516143417, "post_id": 48288283, "comment_id": 83567379, "body": "Even if it does cache the binary (I&#39;ve never seen gorun in use anywhere), it&#39;s still adding unnecessary variables to your test."}], "answers": [{"comments": [{"owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 0, "creation_date": 1516283972, "post_id": 48291134, "comment_id": 83631244, "body": "This code is still over 30% slower than <code>cut</code>. Is there anything else in Go that can further improve its performance?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 0, "creation_date": 1516284291, "post_id": 48291134, "comment_id": 83631480, "body": "@user1424739: on my system the go program takes <code>0m2.353s</code> while cut takes <code>0m2.591s</code>. You&#39;ll need to come up with a better benchmark and profile the program to figure out what else could be trimmed."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 0, "creation_date": 1516285588, "post_id": 48291134, "comment_id": 83632329, "body": "@user1424739: if I were to take a guess, the next slowest part is the allocations in <code>bytes.Split</code>, so manually parsing the line without allocating is the next step."}, {"owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 0, "creation_date": 1516289615, "post_id": 48291134, "comment_id": 83635109, "body": "There seems to be more than one way to profile Go programs. Which way would you recommend? Thanks."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 0, "creation_date": 1516289776, "post_id": 48291134, "comment_id": 83635226, "body": "@user1424739: all ways use the <code>pprof</code> tool, it&#39;s just a matter of how you set it up. The easiest way is to setup a proper benchmark and use <code>go test</code> which can output a profile directly."}, {"owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 0, "creation_date": 1516629337, "post_id": 48291134, "comment_id": 83753166, "body": "<code>@JimB</code>: <code>bufio.Scanner.Bytes</code> may fail to capture the input line when the input line is too long. To make the code robust <code>bufio.Reader.ReadString</code> should be better."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 0, "creation_date": 1516630817, "post_id": 48291134, "comment_id": 83754131, "body": "@user1424739: yes, I was making the minimal change from your example, but the scanner line is limited to <code>MaxScanTokenSize</code>. If that&#39;s not acceptable, using the <code>bufio.Reader</code> directly is better. Though if you&#39;re benchmarking, <code>ReadString</code> is just re-introducing more copies if data again.  Unless you need the entire line as a string, <a href=\"https://golang.org/pkg/bufio/#Reader.ReadSlice\" rel=\"nofollow noreferrer\"><code>ReadSlice</code></a> will allow you to only copy the data you require."}, {"owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 0, "creation_date": 1517447863, "post_id": 48291134, "comment_id": 84104260, "body": "<code>@JimB</code>: <code>ReadSlice</code> only allow a single byte deliminator, which is not acceptable for my application. For this reason, it seems that I have to stick with <code>ReadString</code>. I&#39;d wish <code>ReadSlice</code> could deal with an arbitrary byte array though."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 0, "creation_date": 1517500924, "post_id": 48291134, "comment_id": 84129956, "body": "I don&#39;t understand. <code>ReadString</code> and <code>ReadSlice</code> both take the same arguments. If you want more complex splitting, use a scanner with the <code>SplitFunc</code> that does what you want. If you want to be able to handle arbitrarily long lines, set an arbitrarily large max buffer size."}, {"owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "edited": false, "score": 0, "creation_date": 1517550089, "post_id": 48291134, "comment_id": 84149171, "body": "<code>@JimB</code>: my mistake. Yes, both <code>ReadString</code> and <code>ReadSlice</code> take the same argument."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1516143267, "creation_date": 1516143267, "answer_id": 48291134, "question_id": 48288283, "link": "https://stackoverflow.com/questions/48288283/how-make-a-tsv-processing-golang-program-that-is-as-efficient-as-cut/48291134#48291134", "title": "How make a TSV processing golang program that is as efficient as `cut`?", "body": "<p>If you profile the application, it will show most of the time is spent in</p>\n\n<pre><code>fmt.Printf(\"%s\\n\", fields[col])\n</code></pre>\n\n<p>The main issue there is really the 10000000 syscalls you're making to write to stdout, so making stdout buffered will significantly reduce the execution time. Removing the overhead of the <code>fmt</code> calls will help even further. </p>\n\n<p>The next step would be to reduce allocations, which you can do by using byte slices rather than strings. Combining these would lead to something like</p>\n\n<pre><code>stdout := bufio.NewWriter(os.Stdout)\ndefer stdout.Flush()\n\nscanner := bufio.NewScanner(os.Stdin)\nfor scanner.Scan() {\n    line := scanner.Bytes()\n    fields := bytes.Split(line, []byte{'\\t'})\n    stdout.Write(fields[col])\n    stdout.Write([]byte{'\\n'})\n}\n</code></pre>\n"}], "owner": {"reputation": 6964, "user_id": 1424739, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/19d3c927744b5ad3b94afbf88e1c3844?s=128&d=identicon&r=PG", "display_name": "user1424739", "link": "https://stackoverflow.com/users/1424739/user1424739"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 577, "favorite_count": 0, "accepted_answer_id": 48291134, "answer_count": 1, "score": 0, "last_activity_date": 1516143267, "creation_date": 1516129934, "last_edit_date": 1516141472, "question_id": 48288283, "link": "https://stackoverflow.com/questions/48288283/how-make-a-tsv-processing-golang-program-that-is-as-efficient-as-cut", "title": "How make a TSV processing golang program that is as efficient as `cut`?", "body": "<p>I have the following Go program to process a TSV input. But it is slower than <code>awk</code> and <code>cut</code>. I know <code>cut</code> uses string manipulate tricks to achieve a fast performance.</p>\n\n<p><a href=\"https://github.com/coreutils/coreutils/blob/master/src/cut.c\" rel=\"nofollow noreferrer\">https://github.com/coreutils/coreutils/blob/master/src/cut.c</a></p>\n\n<p>Is it possible to achieve the same performance as <code>cut</code> with Go (or at least better than <code>awk</code>)? What should things be used in Go to achieve a better performance?</p>\n\n<pre><code>$ ./main_.sh | indent.sh \ntime ./main.go 10 &lt; \"$infile\" &gt; /dev/null\n\nreal    0m1.431s\nuser    0m0.978s\nsys 0m0.436s\ntime cut -f 10 &lt; \"$infile\" &gt; /dev/null\n\nreal    0m0.252s\nuser    0m0.225s\nsys 0m0.025s\ntime awk -v FS='\\t' -v OFS='\\t' -e '{ print $10 }' &lt; \"$infile\" &gt; /dev/null\n\nreal    0m1.134s\nuser    0m1.108s\nsys 0m0.024s\n\n$ cat.sh main_.sh \n#!/usr/bin/env bash\n# vim: set noexpandtab tabstop=2:\n\ninfile=$(mktemp)\nseq 10000000 | paste -s -d $'\\t\\t\\t\\t\\t\\t\\t\\t\\t\\n' &gt; \"$infile\"\nset -v\ntime ./main.go 10 &lt; \"$infile\" &gt; /dev/null\ntime cut -f 10 &lt; \"$infile\" &gt; /dev/null\ntime awk -v FS='\\t' -v OFS='\\t' -e '{ print $10 }' &lt; \"$infile\" &gt; /dev/null\n\n$ cat main.go\n#!/usr/bin/env gorun\n// vim: set noexpandtab tabstop=2:\npackage main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"strings\"\n    \"strconv\"\n)\n\nfunc main() {\n    idx, _ := strconv.Atoi(os.Args[1])\n    col := idx - 1\n\n    scanner := bufio.NewScanner(os.Stdin)\n    for scanner.Scan() {\n        line := strings.TrimRight(scanner.Text(), \"\\n\")\n        fields := strings.Split(line, \"\\t\")\n        fmt.Printf(\"%s\\n\", fields[col])\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1516129500, "post_id": 48288002, "comment_id": 83561123, "body": "There&#39;s no question in this question."}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 0, "last_activity_date": 1516134872, "creation_date": 1516134872, "answer_id": 48289397, "question_id": 48288002, "link": "https://stackoverflow.com/questions/48288002/panic-runtime-error-index-out-of-range-recovered/48289397#48289397", "title": "panic: runtime error: index out of range [recovered]", "body": "<p>One of your test cases is:</p>\n\n<pre><code>{\n    \"silence\",\n    \"\",\n    \"Fine. Be that way!\",\n},\n</code></pre>\n\n<p>This calls <code>Hey(\"\")</code>, meaning that <code>len(remark) == 0</code>.</p>\n\n<p>The panic occurs at L23:</p>\n\n<pre><code>if remark[len(remark)-1] == '?' {\n</code></pre>\n\n<p>With the provided input, that turns into <code>remark[-1]</code> which is definitely out of range and causes a panic.</p>\n\n<p>You should sanitize your inputs which includes handling empty strings.</p>\n"}], "owner": {"reputation": 115, "user_id": 6922087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/47a303e1fd316ffec1cc378f2179140f?s=128&d=identicon&r=PG&f=1", "display_name": "Dbshah", "link": "https://stackoverflow.com/users/6922087/dbshah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1559, "favorite_count": 0, "accepted_answer_id": 48289397, "answer_count": 1, "score": -3, "last_activity_date": 1516134872, "creation_date": 1516128793, "question_id": 48288002, "link": "https://stackoverflow.com/questions/48288002/panic-runtime-error-index-out-of-range-recovered", "title": "panic: runtime error: index out of range [recovered]", "body": "<p>In my code panic error shown after Modify <code>if j == len(remark)</code> to <code>if j == len(remark) &amp;&amp; z &gt; 0</code></p>\n\n<p>Error is :</p>\n\n<pre><code>--- FAIL: TestHey (0.00s)\npanic: runtime error: index out of range [recovered]\n        panic: runtime error: index out of range\n\ngoroutine 5 [running]:\ntesting.tRunner.func1(0xc04207a0f0)\n        C:/Go/src/testing/testing.go:711 +0x2d9\npanic(0x526700, 0x5f57c0)\n        C:/Go/src/runtime/panic.go:491 +0x291\n_/C_/Exercism/Go/bob.Hey(0x0, 0x0, 0x54bda2, 0x5)\n        C:/Exercism/Go/bob/bob.go:23 +0x26a\n_/C_/Exercism/Go/bob.TestHey(0xc04207a0f0)\n        C:/Exercism/Go/bob/bob_test.go:8 +0xd3\ntesting.tRunner(0xc04207a0f0, 0x555e98)\n        C:/Go/src/testing/testing.go:746 +0xd7\ncreated by testing.(*T).Run\n        C:/Go/src/testing/testing.go:789 +0x2e5\nexit status 2\nFAIL    _/C_/Exercism/Go/bob    0.072s\n</code></pre>\n\n<p>bob.go file :</p>\n\n<pre><code>package bob\n\n// Hey should have a comment documenting it.\nfunc Hey(remark string) string {\n    j := 0\n    z := 0\n    for i := 0; i &lt; len(remark); i++ {\n        te := remark[i]\n        if te &lt; 'a' || te &gt; 'z' {\n            j++\n        }\n        if te &gt;= 'A' &amp;&amp; te &lt;= 'Z' {\n            z++\n        }\n    }\n    if j == len(remark) &amp;&amp; z &gt; 0 {\n        if remark[len(remark)-1] == '?' {\n            return \"Calm down, I know what I'm doing!\"\n        } else {\n            return \"Whoa, chill out!\"\n        }\n    }\n    if remark[len(remark)-1] == '?' {\n        return \"Sure.\"\n    }\n    j = 0\n    for i := 0; i &lt; len(remark); i++ {\n        if string(remark[i]) == string(9) || string(remark[i]) == string(10) || string(remark[i]) == string(13) || string(remark[i]) == string(32) {\n            j++\n        }\n    }\n    if j == len(remark) {\n        return \"Fine. Be that way!\"\n    }\n    return \"Whatever.\"\n}\n</code></pre>\n\n<p>bob_test file:</p>\n\n<pre><code>package bob\n\nimport \"testing\"\nimport \"fmt\"\n\nfunc TestHey(t *testing.T) {\n    for _, tt := range testCases {\n        actual := Hey(tt.input)\n        if actual != tt.expected {\n            msg := `\n    ALICE (%s): %q\n    BOB: %s\n\n    Expected Bob to respond: %s`\n            t.Fatalf(msg, tt.description, tt.input, actual, tt.expected)\n        }\n    }\n}\n\nfunc BenchmarkHey(b *testing.B) {\n    for _, tt := range testCases {\n        for i := 0; i &lt; b.N; i++ {\n            Hey(tt.input)\n            fmt.Println(i)\n        }\n    }\n}\n</code></pre>\n\n<p>cases_test file:</p>\n\n<pre><code>package bob\n\n// Source: exercism/problem-specifications\n// Commit: 6dc2014 bob: apply \"input\" policy\n// Problem Specifications Version: 1.2.0\n\nvar testCases = []struct {\n    description string\n    input       string\n    expected    string\n}{\n    {\n        \"stating something\",\n        \"Tom-ay-to, tom-aaaah-to.\",\n        \"Whatever.\",\n    },\n    {\n        \"shouting\",\n        \"WATCH OUT!\",\n        \"Whoa, chill out!\",\n    },\n    {\n        \"shouting gibberish\",\n        \"FCECDFCAAB\",\n        \"Whoa, chill out!\",\n    },\n    {\n        \"asking a question\",\n        \"Does this cryogenic chamber make me look fat?\",\n        \"Sure.\",\n    },\n    {\n        \"asking a numeric question\",\n        \"You are, what, like 15?\",\n        \"Sure.\",\n    },\n    {\n        \"asking gibberish\",\n        \"fffbbcbeab?\",\n        \"Sure.\",\n    },\n    {\n        \"talking forcefully\",\n        \"Let's go make out behind the gym!\",\n        \"Whatever.\",\n    },\n    {\n        \"using acronyms in regular speech\",\n        \"It's OK if you don't want to go to the DMV.\",\n        \"Whatever.\",\n    },\n    {\n        \"forceful question\",\n        \"WHAT THE HELL WERE YOU THINKING?\",\n        \"Calm down, I know what I'm doing!\",\n    },\n    {\n        \"shouting numbers\",\n        \"1, 2, 3 GO!\",\n        \"Whoa, chill out!\",\n    },\n    {\n        \"only numbers\",\n        \"1, 2, 3\",\n        \"Whatever.\",\n    },\n    {\n        \"question with only numbers\",\n        \"4?\",\n        \"Sure.\",\n    },\n    {\n        \"shouting with special characters\",\n        \"ZOMG THE %^*@#$(*^ ZOMBIES ARE COMING!!11!!1!\",\n        \"Whoa, chill out!\",\n    },\n    {\n        \"shouting with no exclamation mark\",\n        \"I HATE YOU\",\n        \"Whoa, chill out!\",\n    },\n    {\n        \"statement containing question mark\",\n        \"Ending with ? means a question.\",\n        \"Whatever.\",\n    },\n    {\n        \"non-letters with question\",\n        \":) ?\",\n        \"Sure.\",\n    },\n    {\n        \"prattling on\",\n        \"Wait! Hang on. Are you going to be OK?\",\n        \"Sure.\",\n    },\n    {\n        \"silence\",\n        \"\",\n        \"Fine. Be that way!\",\n    },\n    {\n        \"prolonged silence\",\n        \"          \",\n        \"Fine. Be that way!\",\n    },\n    {\n        \"alternate silence\",\n        \"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\",\n        \"Fine. Be that way!\",\n    },\n    {\n        \"multiple line question\",\n        \"\\nDoes this cryogenic chamber make me look fat?\\nno\",\n        \"Whatever.\",\n    },\n    {\n        \"starting with whitespace\",\n        \"         hmmmmmmm...\",\n        \"Whatever.\",\n    },\n    {\n        \"ending with whitespace\",\n        \"Okay if like my  spacebar  quite a bit?   \",\n        \"Sure.\",\n    },\n    {\n        \"other whitespace\",\n        \"\\n\\r \\t\",\n        \"Fine. Be that way!\",\n    },\n    {\n        \"non-question ending with whitespace\",\n        \"This is a statement ending with whitespace      \",\n        \"Whatever.\",\n    },\n}\n</code></pre>\n"}, {"tags": ["go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 898, "user_id": 1890157, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/e3Ivi.png?s=128&g=1", "display_name": "Camway", "link": "https://stackoverflow.com/users/1890157/camway"}, "edited": false, "score": 0, "creation_date": 1516126674, "post_id": 48287462, "comment_id": 83559839, "body": "I can&#39;t add this as the accepted answer for another 5 minutes, but thank you so much. Immediately fixed the problem."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1516126526, "creation_date": 1516126526, "answer_id": 48287462, "question_id": 48287373, "link": "https://stackoverflow.com/questions/48287373/golang-imported-fields-do-not-act-the-same-as-standard-field-declarations/48287462#48287462", "title": "Golang imported fields do not act the same as standard field declarations", "body": "<p><a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#Unmarshal\" rel=\"nofollow noreferrer\">Per the documentation</a>, you need to add the <code>inline</code> tag to the field:</p>\n\n<pre><code>type TicketLookupTicket struct{\n  Ticket `bson:\",inline\"`\n  Interactions []TicketInteraction `json:\"interactions\" bson:\"interactions\"`\n}\n</code></pre>\n\n<blockquote>\n  <p><code>inline</code>    Inline the field, which must be a struct or a map.\n             Inlined structs are handled as if its fields were part\n             of the outer struct. An inlined map causes keys that do\n             not match any other struct field to be inserted in the\n             map rather than being discarded as usual.</p>\n</blockquote>\n\n<p>By default, it assumes that the embedded field <code>Ticket</code> should be filled by an object at <code>TicketLookupTicket.Ticket</code>.</p>\n"}], "owner": {"reputation": 898, "user_id": 1890157, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/e3Ivi.png?s=128&g=1", "display_name": "Camway", "link": "https://stackoverflow.com/users/1890157/camway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 48287462, "answer_count": 1, "score": 0, "last_activity_date": 1516126542, "creation_date": 1516126126, "last_edit_date": 1516126542, "question_id": 48287373, "link": "https://stackoverflow.com/questions/48287373/golang-imported-fields-do-not-act-the-same-as-standard-field-declarations", "title": "Golang imported fields do not act the same as standard field declarations", "body": "<p>I'm going to try to simplify the problem down rather than bring the whole project into scope so if you have questions I'll try to update with more information.</p>\n\n<p>I have 3 structs I'm working with:</p>\n\n<pre><code>type Ticket struct{\n  ID bson.ObjectID `json:\"id\" bson:\"_id\"`\n  InteractionIDs []bson.ObjectId `json:\"interactionIds\" bson:\"interactionIds\"`\n  TicketNumber int `json:\"ticketNumber\" bson:\"ticketNumber\"`\n  Active bool `json:\"active\" bson:\"active\"`\n  // Other fields not included\n}\n\ntype TicketInteraction struct{\n  ID bson.ObjectID `json:\"id\" bson:\"_id\"`\n  Active bool `json:\"active\" bson:\"active\"`\n  // Other fields not included\n}\n\ntype TicketLookupTicket struct{\n  Ticket\n  Interactions []TicketInteraction `json:\"interactions\" bson:\"interactions\"`\n}\n</code></pre>\n\n<p>Then I have an mgo pipe that I'm working with to 'join' the two collections together</p>\n\n<pre><code>var tickets []TicketLookupTicket\nc := mongodb.NewCollectionSession(\"tickets\")\ndefer c.Close()\n\npipe := c.Session.Pipe(\n  []bson.M{\n    \"$lookup\": bson.M{\n      \"from\": \"ticketInteractions\",\n      \"localField\": \"interactionIds\",\n      \"foreignField\": \"_id\",\n      \"as\": \"interactions\",\n    }\n  },\n)\npipe.All(&amp;tickets)\n</code></pre>\n\n<p>Now tickets should be populated with the result from the database, but what is actually happening is only the interactions within each ticket has been populated. It ends up looking something like this:</p>\n\n<pre><code>[\n  {\n    ID: ObjectIdHex(\"\"),\n    InteractionIDs: nil,\n    TicketNumber: 0,\n    Active: false,\n    // Other Fields, all with default values\n    Interactions: []{\n      {\n        ID: ObjectIdHex(\"5a441ffea1c9800148669cc7\"),\n        Active: true,\n        // Other Fields, with appropriate values\n      }\n    }\n  }\n]\n</code></pre>\n\n<p>Now if I manually declare some of the Ticket structs fields inside the TicketLookupTicket struct, those fields will start populating. Ex:</p>\n\n<pre><code>type TicketLookupTicket struct{\n  Ticket\n  ID bson.ObjectId `json:\"id\" bson:\"_id\"`\n  TicketNumber int `json:\"ticketNumber\" bson:\"ticketNumber\"`\n  Active bool `json:\"active\" bson:\"active\"`\n  Interactions []TicketInteraction `json:\"interactions\" bson:\"interactions\"`\n}\n</code></pre>\n\n<p>Now ID, TicketNumber, and Active will start populating, but the remaining fields won't.</p>\n\n<p>Can anyone explain why the imported Ticket fields aren't behaving the same as the declared fields?</p>\n"}, {"tags": ["arrays", "json", "object", "go", "typeof"], "answers": [{"tags": [], "owner": {"reputation": 310, "user_id": 2178075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4QBKQ.jpg?s=128&g=1", "display_name": "peiiion", "link": "https://stackoverflow.com/users/2178075/peiiion"}, "is_accepted": false, "score": 1, "last_activity_date": 1516122777, "creation_date": 1516122777, "answer_id": 48286493, "question_id": 48286352, "link": "https://stackoverflow.com/questions/48286352/test-type-of-value-in-go/48286493#48286493", "title": "Test type of value in Go", "body": "<p><code>reflect.TypeOf</code> returns a <code>Type</code> object. See docs at <a href=\"https://golang.org/pkg/reflect/#TypeOf\" rel=\"nofollow noreferrer\">https://golang.org/pkg/reflect/#TypeOf</a></p>\n\n<p>Your code should read: </p>\n\n<pre><code>if reflect.TypeOf(gjson.Get(api_spec, \"tags\").Value()).Name() != \"[]interface {}\" {\n    // some code here ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 3, "last_activity_date": 1516123113, "creation_date": 1516123113, "answer_id": 48286600, "question_id": 48286352, "link": "https://stackoverflow.com/questions/48286352/test-type-of-value-in-go/48286600#48286600", "title": "Test type of value in Go", "body": "<p>When you print a type to console, it's converted to a string; however, <a href=\"https://golang.org/pkg/reflect/#TypeOf\" rel=\"nofollow noreferrer\">as you can see from the documentation for <code>TypeOf</code></a>, it does not return a <code>string</code>, it returns a <code>reflect.Type</code>. You can use <code>Kind()</code> to test programmatically what it is:</p>\n\n<pre><code>        if reflect.TypeOf(gjson.Get(api_spec, \"tags\").Value()).Kind() != reflect.Slice {\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/reflect/#Kind\" rel=\"nofollow noreferrer\">Other <code>Kind</code>s</a> you might be interested in are <code>reflect.String</code> and <code>reflect.Map</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "edited": false, "score": 0, "creation_date": 1516127682, "post_id": 48287037, "comment_id": 83560296, "body": "Thanks so much! Your second example is what I needed!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1516128478, "last_edit_date": 1516128478, "creation_date": 1516124715, "answer_id": 48287037, "question_id": 48286352, "link": "https://stackoverflow.com/questions/48286352/test-type-of-value-in-go/48287037#48287037", "title": "Test type of value in Go", "body": "<p>Use a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> to determine if a value is a <code>[]interface{}</code>:</p>\n\n<pre><code>v := gjson.Get(api_spec, \"tags\").Value()\n_, ok := v.([]interface{}) // ok is true if v is type []interface{}\n</code></pre>\n\n<p>Here's the code in the question modified to use a type assertion:</p>\n\n<pre><code>if gjson.Get(api_spec, \"tags\").Exists() {\n    if _, ok := gjson.Get(api_spec, \"tags\").Value().([]interface{}); !ok {\n        // some code here ...\n    }\n}\n</code></pre>\n\n<p>There's no need to use reflection.  If you do want to use reflection for some reason (and I don't see a reason in the question), then compare reflect.Type values:</p>\n\n<pre><code>// Get type using a dummy value. This can be done once by declaring\n// the variable as a package-level variable.\nvar sliceOfInterface = reflect.TypeOf([]interface{}{})\n\nok = reflect.TypeOf(v) == sliceOfInterface  // ok is true if v is type []interface{}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Rz_cApI8Ska\" rel=\"nofollow noreferrer\">run the code on the playground</a></p>\n"}], "owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 458, "favorite_count": 0, "accepted_answer_id": 48287037, "answer_count": 3, "score": 0, "last_activity_date": 1520880914, "creation_date": 1516122216, "last_edit_date": 1520880914, "question_id": 48286352, "link": "https://stackoverflow.com/questions/48286352/test-type-of-value-in-go", "title": "Test type of value in Go", "body": "<p>Im trying to validate a JSON object in Go. I'm trying to see if the 'tags' attribute is an array.( Later on I'll also want to know if another attribute is an object too).</p>\n\n<p>I have reached to this. If I print <code>reflect.TypeOf(gjson.Get(api_spec, \"tags\").Value()</code> I get : </p>\n\n<pre><code>string   // When the field is a string\n[]interface {} // When the field is an array\nmap[string]interface {} // When the field is an object\n</code></pre>\n\n<p>But when trying to test this on the below code :    </p>\n\n<pre><code>if ( gjson.Get(api_spec, \"tags\").Exists() ) {\n            if ( reflect.TypeOf(gjson.Get(api_spec, \"tags\").Value()) != \"[]interface {}\" ) {\n             // some code here ...\n            }\n        }\n</code></pre>\n\n<p>I get the below error code : </p>\n\n<pre><code>invalid operation: reflect.TypeOf(gjson.Get(api_spec, \"tags\").Value()) != \"[]interface {}\" (mismatched types reflect.Type and string)\n</code></pre>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["regex", "go"], "answers": [{"comments": [{"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "edited": false, "score": 0, "creation_date": 1516113190, "post_id": 48283568, "comment_id": 83551023, "body": "Oh my god I feel like the dumbest ever. Thanks so much!"}, {"owner": {"reputation": 39085, "user_id": 67332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C0tuF.jpg?s=128&g=1", "display_name": "Glavi\u0107", "link": "https://stackoverflow.com/users/67332/glavi%c4%87"}, "reply_to_user": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "edited": false, "score": 0, "creation_date": 1516113725, "post_id": 48283568, "comment_id": 83551406, "body": "@MatiasBarrios: do accept his answer if it solved your problem."}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "reply_to_user": {"reputation": 39085, "user_id": 67332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/C0tuF.jpg?s=128&g=1", "display_name": "Glavi\u0107", "link": "https://stackoverflow.com/users/67332/glavi%c4%87"}, "edited": false, "score": 0, "creation_date": 1516113915, "post_id": 48283568, "comment_id": 83551537, "body": "@Glavi\u0107 Yeah I was gonna do it but it was not allowing me due to time restriction."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1516113820, "last_edit_date": 1516113820, "creation_date": 1516113058, "answer_id": 48283568, "question_id": 48283500, "link": "https://stackoverflow.com/questions/48283500/convert-compiled-regex-to-string/48283568#48283568", "title": "Convert compiled regex to string", "body": "<p>The <a href=\"https://golang.org/pkg/regexp/#Regexp\" rel=\"nofollow noreferrer\"><code>regexp.Regexp</code></a> type has a <a href=\"https://golang.org/pkg/regexp/#Regexp.String\" rel=\"nofollow noreferrer\"><code>Regexp.String()</code></a> method which does this exactly:</p>\n\n<blockquote>\n  <p>String returns the source text used to compile the regular expression.</p>\n</blockquote>\n\n<p>You don't even have to call it manually, as the <code>fmt</code> package checks and calls the <code>String()</code> method if the type of the passed value has it.</p>\n\n<p>Example:</p>\n\n<pre><code>r := regexp.MustCompile(`[0-9][.][0-9]`)\nfmt.Println(\"Regexp:\", r)\n\n// If you need the source text as a string:\ns := r.String()\nfmt.Println(\"Regexp:\", s)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/makN7JPQp7C\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Regexp: [0-9][.][0-9]\nRegexp: [0-9][.][0-9]\n</code></pre>\n"}], "owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 48283568, "answer_count": 1, "score": 2, "last_activity_date": 1516114632, "creation_date": 1516112867, "last_edit_date": 1516114632, "question_id": 48283500, "link": "https://stackoverflow.com/questions/48283500/convert-compiled-regex-to-string", "title": "Convert compiled regex to string", "body": "<p>I don't have much experience in Go, but basically I want to print my regex on the screen after using it. I cant find anything on Google. This seems something rather easy to do but I have tried several things and nothing else worked.</p>\n\n<pre><code>var swagger_regex = regexp.MustCompile(`[0-9][.][0-9]`)\n.... some code here ....\nfmt.Println(\"Your '_.swagger' attribute does not match \" + string(swagger_regex))\n</code></pre>\n"}, {"tags": ["go", "cron", "sh"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516107595, "post_id": 48281827, "comment_id": 83547288, "body": "It is executing, it&#39;s just exiting with a non-zero code because you&#39;re trying to read the list of URLs to get from a file named <code>http:&#47;&#47;example.com</code>. The output clearly tells you: <code>No URLS found in example.com</code>."}, {"owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516107701, "post_id": 48281827, "comment_id": 83547351, "body": "But when I access the same code out of the project it displays <code>&#47;dev&#47;null                           100%[=======================================================&zwnj;&#8203;===========&gt;]      60  --.-KB&#47;s    in 0s        2018-01-16 18:32:08 (4.31 MB&#47;s) - \u2018&#47;dev&#47;null\u2019 saved [60&#47;60] </code>"}, {"owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516107869, "post_id": 48281827, "comment_id": 83547452, "body": "file contains <code>#!&#47;bin&#47;bash   echo &quot;executing......................................&quot; wget -i http:&#47;&#47;example.com:8080&#47;api&#47;v1&#47;test-shfile -O &#47;dev&#47;null</code>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516108209, "post_id": 48281827, "comment_id": 83547663, "body": "It seems like a problem connecting to whatever host you pass. Are you running the script and your program on the same machine? Is the host a plain string, or are you by chance using environment variables? Does it require any credentials?"}], "answers": [{"comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516111850, "post_id": 48282994, "comment_id": 83550137, "body": "Suggestions belong in comments, not in answers."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516115999, "post_id": 48282994, "comment_id": 83552977, "body": "This still does not answer OP&#39;s question. The problem is reaching <code>http:&#47;&#47;example.com&#47;...</code> within the script, not running the actual script."}, {"owner": {"reputation": 1759, "user_id": 8708123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dcmM3.jpg?s=128&g=1", "display_name": "Fendi jatmiko", "link": "https://stackoverflow.com/users/8708123/fendi-jatmiko"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516116339, "post_id": 48282994, "comment_id": 83553242, "body": "ohh jezz.. i didnt even see that. . whooops.. my bad. .i didnt quiet get it tho. ."}], "tags": [], "owner": {"reputation": 1759, "user_id": 8708123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dcmM3.jpg?s=128&g=1", "display_name": "Fendi jatmiko", "link": "https://stackoverflow.com/users/8708123/fendi-jatmiko"}, "is_accepted": false, "score": -1, "last_activity_date": 1516115834, "last_edit_date": 1516115834, "creation_date": 1516111234, "answer_id": 48282994, "question_id": 48281827, "link": "https://stackoverflow.com/questions/48281827/why-command-is-not-executed-inside-the-projects-folder/48282994#48282994", "title": "Why command is not executed inside the project&#39;s folder?", "body": "<p>have you considered using <code>\"os/exec\"</code></p>\n\n<p><code>cmd := exec.Command(\"/bin/sh\", test.sh)</code></p>\n\n<p>edit : a'right,, i didnt sugesting then, ,i test it myself. .</p>\n\n<pre><code>func main() {\n        cmd := exec.Command(\"/bin/sh\", \"test.sh\")\n        out, err := cmd.CombinedOutput()\n        if err != nil {\n                log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n        }\n        fmt.Printf(\"output is :\\n%s\\n\", string(out)) }\n</code></pre>\n"}], "owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1516115834, "creation_date": 1516107444, "last_edit_date": 1516107614, "question_id": 48281827, "link": "https://stackoverflow.com/questions/48281827/why-command-is-not-executed-inside-the-projects-folder", "title": "Why command is not executed inside the project&#39;s folder?", "body": "<p>I am trying to execute the command using the <code>sh</code> file as given below:</p>\n\n<pre><code>#!/bin/bash  \necho \"executing......................................\"\nwget -i http://example.com -O /dev/null\n</code></pre>\n\n<p>Which is running properly when I am accessing directly from my desktop folder. </p>\n\n<p>But when I integrate it with my golang project for example: \nI created a folder named <code>myProject/sh</code> and pasted the file there.</p>\n\n<p>Now using cron in my another package I am trying to access the <code>test.sh</code> file.</p>\n\n<pre><code>func RunCron() {\n    c := cron.New()\n    c.AddFunc(\"10 * * * * *\", ExecuteFunction)\n    c.Start()\n}\n\nfunc ExecuteFunction(){\n    fmt.Println(\"test----------------\")\n    utils.ExecuteCommand(\"sh \"+config.GetBasePath()+\"sh/test.sh\")\n}\n</code></pre>\n\n<p>Now it outputs something like</p>\n\n<pre><code>test----------------\nResult: executing......................................\n\nexit status 4: --2018-01-16 18:25:10--  http://example.com\nResolving http://example.com)... 1.1.1.1\nConnecting to example.com (example.com)|2.2.2.2|:8080... failed: Connection refused.\nNo URLs found in example.com.\n</code></pre>\n\n<p>I am unable to figure out that why the same code runs well in my desktop folder but stops executing inside my project's folder. Can you please save my time by telling me whats wrong am I doing?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["mysql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1516102629, "post_id": 48280183, "comment_id": 83544149, "body": "Not a gorm user but if you do ctrl+f on its docs you can see <a href=\"https://godoc.org/github.com/jinzhu/gorm#DB.SingularTable\" rel=\"nofollow noreferrer\">godoc.org/github.com/jinzhu/gorm#DB.SingularTable</a>, maybe try that."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1516107508, "post_id": 48280183, "comment_id": 83547233, "body": "If you aren&#39;t married to gorm, what&#39;s wrong with <code>CREATE TABLE foo</code>?"}, {"owner": {"reputation": 139, "user_id": 9223835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe290666d33d667fae91b0bf22d76bf8?s=128&d=identicon&r=PG&f=1", "display_name": "Ryo", "link": "https://stackoverflow.com/users/9223835/ryo"}, "edited": false, "score": 0, "creation_date": 1516149187, "post_id": 48280183, "comment_id": 83568999, "body": "SingularTable func works well  ! Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 139, "user_id": 9223835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe290666d33d667fae91b0bf22d76bf8?s=128&d=identicon&r=PG&f=1", "display_name": "Ryo", "link": "https://stackoverflow.com/users/9223835/ryo"}, "edited": false, "score": 0, "creation_date": 1516148781, "post_id": 48280489, "comment_id": 83568898, "body": "Thanks a lot. It&#39;s just I wanna do !"}], "tags": [], "owner": {"reputation": 1283, "user_id": 9079863, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e9c7362282ac6c2b944cb216fa2ab4c?s=128&d=identicon&r=PG&f=1", "display_name": "Ilayaraja", "link": "https://stackoverflow.com/users/9079863/ilayaraja"}, "is_accepted": true, "score": 2, "last_activity_date": 1516103048, "creation_date": 1516103048, "answer_id": 48280489, "question_id": 48280183, "link": "https://stackoverflow.com/questions/48280183/are-there-any-way-to-create-singular-name-db-table/48280489#48280489", "title": "Are there any way to create singular-name DB table?", "body": "<p>Implement function <code>TableName</code> on struct <code>User</code> to return a custom name for the table. The ORM uses this function to get the table name for all DB operations.</p>\n\n<pre><code>func (user *User) TableName() string {\n    return \"user\"\n}\n</code></pre>\n\n<p>Refer docs here: <a href=\"http://jinzhu.me/gorm/models.html#table-name-is-the-pluralized-version-of-struct-name\" rel=\"nofollow noreferrer\">http://jinzhu.me/gorm/models.html#table-name-is-the-pluralized-version-of-struct-name</a></p>\n"}, {"tags": [], "owner": {"reputation": 138, "user_id": 2054726, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hM5QU.jpg?s=128&g=1", "display_name": "Mario Idival", "link": "https://stackoverflow.com/users/2054726/mario-idival"}, "is_accepted": false, "score": 2, "last_activity_date": 1516104499, "creation_date": 1516104499, "answer_id": 48280918, "question_id": 48280183, "link": "https://stackoverflow.com/questions/48280183/are-there-any-way-to-create-singular-name-db-table/48280918#48280918", "title": "Are there any way to create singular-name DB table?", "body": "<p>You have set with db instance to use singular table, like this: \n<code>db.SingularTable(true)</code></p>\n"}], "owner": {"reputation": 139, "user_id": 9223835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe290666d33d667fae91b0bf22d76bf8?s=128&d=identicon&r=PG&f=1", "display_name": "Ryo", "link": "https://stackoverflow.com/users/9223835/ryo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 712, "favorite_count": 0, "accepted_answer_id": 48280489, "answer_count": 2, "score": -2, "last_activity_date": 1516108881, "creation_date": 1516102028, "last_edit_date": 1516108881, "question_id": 48280183, "link": "https://stackoverflow.com/questions/48280183/are-there-any-way-to-create-singular-name-db-table", "title": "Are there any way to create singular-name DB table?", "body": "<ul>\n<li><p>development environment<br>\nLnaguage  : Golang ver.1.9.2<br>\nDB        : mySQL<br>\nFramework : not decided (Maybe I'll use revel)</p></li>\n<li><p>situation<br>\nI already have DB which has singular-name table ,like \"user\", \"page\". It can't be changed.</p>\n\n<p>Now I'll develop new application using this DB.\nI created simple application to connect this DB, and tried to auto migrate using gorm(<a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm</a>).\nI defined some models, like \"user\" which is same as existing DB table name, and run auto-migrate just as it written in (<a href=\"http://jinzhu.me/gorm/database.html#connecting-to-a-database\" rel=\"nofollow noreferrer\">http://jinzhu.me/gorm/database.html#connecting-to-a-database</a> )</p>\n\n<p>db.Set(\"gorm:table_options\", \"ENGINE=InnoDB\").AutoMigrate(&amp;User{})</p>\n\n<p>Then, new table \"users\" was created.</p></li>\n<li><p>Question\nCan I create singular-name table, like \"user\" with auto-migrate or those things ?\nUsing gorm is not required, so I'll use another orm library if it works.</p></li>\n</ul>\n\n<p>I hope anyone help me !</p>\n"}, {"tags": ["api", "go", "structure"], "comments": [{"owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "edited": false, "score": 3, "creation_date": 1516090746, "post_id": 48276724, "comment_id": 83536825, "body": "If you want your code in the same package, then just don&#39;t put files in other  directories."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1516099028, "post_id": 48276724, "comment_id": 83541956, "body": "I suggest take a look at this. It shows the standard structure of a package (though not wildly adopted). Many Go tools (from Google) follow the same convention. And it has semantics like when a package from <code>internal&#47;pkg</code> is referred inside another project, Go compiler will show an error. <a href=\"https://github.com/golang-standards/project-layout\" rel=\"nofollow noreferrer\">github.com/golang-standards/project-layout</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1516111532, "post_id": 48276724, "comment_id": 83549936, "body": "&quot;the language wants that any external file is a package&quot; - not true. Each <i>directory</i> is a package. Go makes no distinction between <i>files</i>. &quot;which may be used by any other golang app&quot; - only if you publish it, and really only if you publish it and say &quot;this is for people to use for XYZ&quot;. If you post <i>any</i> code publicly, someone else might use it; but if you don&#39;t say it&#39;s for others to use, then they shouldn&#39;t expect fitness for any purpose or support for any issues."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1516123640, "post_id": 48276724, "comment_id": 83558179, "body": "Also, use <code>go build</code> or <code>go install</code> to build the executable."}], "answers": [{"comments": [{"owner": {"reputation": 124, "user_id": 6698933, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8TE5wr18GPM/AAAAAAAAAAI/AAAAAAAAAMs/uqS3s_dSrdA/photo.jpg?sz=128", "display_name": "Tisamu", "link": "https://stackoverflow.com/users/6698933/tisamu"}, "edited": false, "score": 0, "creation_date": 1516095818, "post_id": 48276775, "comment_id": 83539757, "body": "For the moment i&#39;m using this solution with <code>go run *.go</code> but that looks like this is more like a trick than a true solution."}, {"owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "reply_to_user": {"reputation": 124, "user_id": 6698933, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8TE5wr18GPM/AAAAAAAAAAI/AAAAAAAAAMs/uqS3s_dSrdA/photo.jpg?sz=128", "display_name": "Tisamu", "link": "https://stackoverflow.com/users/6698933/tisamu"}, "edited": false, "score": 0, "creation_date": 1516095956, "post_id": 48276775, "comment_id": 83539856, "body": "You don&#39;t need to exec <code>go run *.go</code>, just <code>go run main.go</code> should work. Everything under same package don&#39;t need import when used in the same package."}, {"owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "reply_to_user": {"reputation": 124, "user_id": 6698933, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8TE5wr18GPM/AAAAAAAAAAI/AAAAAAAAAMs/uqS3s_dSrdA/photo.jpg?sz=128", "display_name": "Tisamu", "link": "https://stackoverflow.com/users/6698933/tisamu"}, "edited": false, "score": 0, "creation_date": 1516096100, "post_id": 48276775, "comment_id": 83539967, "body": "If you need reference, I recommend you to see how others popular go projects organise their structures. For example <a href=\"https://github.com/gogits/gogs\" rel=\"nofollow noreferrer\">gogs</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 124, "user_id": 6698933, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8TE5wr18GPM/AAAAAAAAAAI/AAAAAAAAAMs/uqS3s_dSrdA/photo.jpg?sz=128", "display_name": "Tisamu", "link": "https://stackoverflow.com/users/6698933/tisamu"}, "edited": false, "score": 1, "creation_date": 1516123526, "post_id": 48276775, "comment_id": 83558095, "body": "@MortyChoi The <code>go run</code> command creates a package from the files specified on the command line.  The <code>go run main.go</code> command will not include model1.go and model2.go in the package.  @Tisamu is correct that <code>go run *.go</code> is the needed when using the <code>go run</code> command."}, {"owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "edited": false, "score": 1, "creation_date": 1516154303, "post_id": 48276775, "comment_id": 83570263, "body": "Ya, you are right. <code>go build</code> don&#39;t need but <code>go run</code> need."}], "tags": [], "owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "is_accepted": false, "score": 3, "last_activity_date": 1516090804, "creation_date": 1516090804, "answer_id": 48276775, "question_id": 48276724, "link": "https://stackoverflow.com/questions/48276724/structure-maintain-a-golang-project-with-multiple-files/48276775#48276775", "title": "Structure &amp; maintain a Golang project with multiple files", "body": "<pre><code>/MyProject\n   |main.go\n   |model1.go\n   |model2.go\n</code></pre>\n\n<p>If you want to keep your code in one package only.</p>\n"}, {"comments": [{"owner": {"reputation": 124, "user_id": 6698933, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8TE5wr18GPM/AAAAAAAAAAI/AAAAAAAAAMs/uqS3s_dSrdA/photo.jpg?sz=128", "display_name": "Tisamu", "link": "https://stackoverflow.com/users/6698933/tisamu"}, "edited": false, "score": 0, "creation_date": 1516095589, "post_id": 48277054, "comment_id": 83539604, "body": "This is a weird structure for a project, I tried the go run *.go tricks with my files declared under the same package in the same folder, but that does not look like the way it meant to be,  Your solution is a bit complicated and it&#39;s look like we need to declare things multiple time etc so that&#39;s not an intuitive and maintainable solution to me,  If you have example where this is used feel free to share them, i&#39;m curious to see that kind of structure in production.  Thanks for your help anyway. :)"}, {"owner": {"reputation": 2221, "user_id": 7359810, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh3.googleusercontent.com/-8MngnLBsx3E/AAAAAAAAAAI/AAAAAAAAetc/OsGMMV3Set4/photo.jpg?sz=128", "display_name": "Neha", "link": "https://stackoverflow.com/users/7359810/neha"}, "reply_to_user": {"reputation": 124, "user_id": 6698933, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8TE5wr18GPM/AAAAAAAAAAI/AAAAAAAAAMs/uqS3s_dSrdA/photo.jpg?sz=128", "display_name": "Tisamu", "link": "https://stackoverflow.com/users/6698933/tisamu"}, "edited": false, "score": 1, "creation_date": 1516101212, "post_id": 48277054, "comment_id": 83543314, "body": "Sure, you can check out the code here. <a href=\"https://github.com/nehagup/golang-web-dev/tree/master/045-code-organization\" rel=\"nofollow noreferrer\">github.com/nehagup/golang-web-dev/tree/master/&hellip;</a>"}, {"owner": {"reputation": 124, "user_id": 6698933, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8TE5wr18GPM/AAAAAAAAAAI/AAAAAAAAAMs/uqS3s_dSrdA/photo.jpg?sz=128", "display_name": "Tisamu", "link": "https://stackoverflow.com/users/6698933/tisamu"}, "edited": false, "score": 0, "creation_date": 1516199161, "post_id": 48277054, "comment_id": 83591435, "body": "After few testing in my project, I choosed to stay with all files in the same folder, that&#39;s simplier to maintain and the multi-package structure you showed is too much complicated to fit with, the logic is very strict and not as manageable as I would want it to be. :/"}, {"owner": {"reputation": 2221, "user_id": 7359810, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh3.googleusercontent.com/-8MngnLBsx3E/AAAAAAAAAAI/AAAAAAAAetc/OsGMMV3Set4/photo.jpg?sz=128", "display_name": "Neha", "link": "https://stackoverflow.com/users/7359810/neha"}, "reply_to_user": {"reputation": 124, "user_id": 6698933, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8TE5wr18GPM/AAAAAAAAAAI/AAAAAAAAAMs/uqS3s_dSrdA/photo.jpg?sz=128", "display_name": "Tisamu", "link": "https://stackoverflow.com/users/6698933/tisamu"}, "edited": false, "score": 0, "creation_date": 1516200012, "post_id": 48277054, "comment_id": 83592011, "body": "For sure you can do it using all the files in the same folder but your question looked more about organized structure used by different organizations. So for small projects it&#39;s okay to keep all files in one place."}], "tags": [], "owner": {"reputation": 2221, "user_id": 7359810, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh3.googleusercontent.com/-8MngnLBsx3E/AAAAAAAAAAI/AAAAAAAAetc/OsGMMV3Set4/photo.jpg?sz=128", "display_name": "Neha", "link": "https://stackoverflow.com/users/7359810/neha"}, "is_accepted": false, "score": 2, "last_activity_date": 1516092284, "last_edit_date": 1516092284, "creation_date": 1516091865, "answer_id": 48277054, "question_id": 48276724, "link": "https://stackoverflow.com/questions/48276724/structure-maintain-a-golang-project-with-multiple-files/48277054#48277054", "title": "Structure &amp; maintain a Golang project with multiple files", "body": "<p><strong>Different Approaches</strong></p>\n\n<p><strong><em>One package</em></strong> \nWhen needed we can put variables in the package scope\n<a href=\"https://i.stack.imgur.com/QEy9D.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QEy9D.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong><em>Two packages</em></strong>\nWe will import the code from the second package when needed</p>\n\n<p><a href=\"https://i.stack.imgur.com/5plGa.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5plGa.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong><em>Three+ packages with package for config variables</em></strong>\nWe will import the code from the config package when needed. The config package will hold variables like DB and TPL.</p>\n\n<p><a href=\"https://i.stack.imgur.com/ZruPM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ZruPM.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/5xj5Z.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5xj5Z.png\" alt=\"enter image description here\"></a></p>\n\n<p>FYI: there is no global scope in Go.\nYou can read more about it at <a href=\"http://www.alexedwards.net/blog/organising-database-access\" rel=\"nofollow noreferrer\">Alex Edwards Code Organization Article</a></p>\n"}], "owner": {"reputation": 124, "user_id": 6698933, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8TE5wr18GPM/AAAAAAAAAAI/AAAAAAAAAMs/uqS3s_dSrdA/photo.jpg?sz=128", "display_name": "Tisamu", "link": "https://stackoverflow.com/users/6698933/tisamu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1465, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1516092284, "creation_date": 1516090580, "last_edit_date": 1516090659, "question_id": 48276724, "link": "https://stackoverflow.com/questions/48276724/structure-maintain-a-golang-project-with-multiple-files", "title": "Structure &amp; maintain a Golang project with multiple files", "body": "<p>I'm currently discovering Golang and I'm currently playing with Mux and Gorm to try to build an API.</p>\n\n<p>So everything is fine until the point where I have too much content in my main.go file so I want to split this API into multiple files,</p>\n\n<p>Naturally, like I would do in a Node.js API, I create a models Folder, and a routes folder, and begin to put my Models in individual files in the models folder (model1.go, model2.go etc) to have a structure like:</p>\n\n<p><code>/MyProject\n   |main.go\n   |/models\n      |model1.go\n      |model2.go\n</code></p>\n\n<p>Then I google a bit (well, a lot now..) to know how to include them in my main.go file, and now i'm facing the fact that in Golang the design of <strong>the language wants that any external file is a package</strong> which may be used by any other golang app, which is not what I'm looking for, <strong>I just want to split the content of my project to have a better maintainability</strong> but it seems to be impossible with that project design in mind.\nI heard about vendoring since 1.6 but that's still not a solution cause that's make necessary to keep the dependencies and the project files at the same place, which is not a conventional (and logical) way to structure a project</p>\n\n<p>I guess heavy and complex Golang projects don't have their entire code base into one single file so <strong>I'm just looking for the good way to structure a project into multiple files</strong> like they would do to maintain their projects.</p>\n"}, {"tags": ["python", "go", "io", "stdin"], "answers": [{"comments": [{"owner": {"reputation": 425, "user_id": 5933751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8e19ea67a00c7347f5899aebeb44a51e?s=128&d=identicon&r=PG&f=1", "display_name": "mohd.gadi", "link": "https://stackoverflow.com/users/5933751/mohd-gadi"}, "edited": false, "score": 0, "creation_date": 1516093521, "post_id": 48277149, "comment_id": 83538334, "body": "Ok thanks almost there I am reading byte array from a .wav file and sending bytes. I cant seem to save the data in the new .wav file in the python"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 425, "user_id": 5933751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8e19ea67a00c7347f5899aebeb44a51e?s=128&d=identicon&r=PG&f=1", "display_name": "mohd.gadi", "link": "https://stackoverflow.com/users/5933751/mohd-gadi"}, "edited": false, "score": 1, "creation_date": 1516093675, "post_id": 48277149, "comment_id": 83538437, "body": "You may need to open the file in binary mode <code>wb</code> (<a href=\"https://docs.python.org/2/tutorial/inputoutput.html#reading-and-writing-files\" rel=\"nofollow noreferrer\">read more about that</a>). Also, don&#39;t forget to close the file. If this is all your python does though, why not save the file using Go?"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1516093828, "last_edit_date": 1516093828, "creation_date": 1516092255, "answer_id": 48277149, "question_id": 48276670, "link": "https://stackoverflow.com/questions/48276670/how-to-send-bytes-data-from-golang-to-python-using-exec-command/48277149#48277149", "title": "How to send bytes data from golang to python using exec command?", "body": "<p>You can access the process' stdin by calling <a href=\"https://golang.org/pkg/os/exec/#Cmd.StdinPipe\" rel=\"nofollow noreferrer\">Cmd.StdinPipe</a> on your <code>exec.Command</code>. This gives you a <a href=\"https://golang.org/pkg/io/#WriteCloser\" rel=\"nofollow noreferrer\">WriteCloser</a> that closes automatically when the process terminates.</p>\n\n<p>The write to stdin must be done in a separate goroutine from the <code>cmd.Run</code> call.</p>\n\n<p>Here is a simple example writing \"Hi There!\" (as a byte array) to stdin.</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"os/exec\"\n)\n\nfunc main() {\n  byteArray := []byte(\"hi there!\")\n  cmd := exec.Command(\"python3\", \"abc.py\")\n\n  stdin, err := cmd.StdinPipe()\n  if err != nil {\n    panic(err)\n  } \n\n  go func() {\n    defer stdin.Close()\n    if _, err := stdin.Write(byteArray); err != nil {\n      panic(err) \n    }\n  }()\n\n  fmt.Println(\"Exec status: \", cmd.Run())\n}\n</code></pre>\n\n<p>You'll also want to actually read from stdin in python:</p>\n\n<pre><code>import sys\nf = open('output', 'w')\nf.write(sys.stdin.read())\n</code></pre>\n"}], "owner": {"reputation": 425, "user_id": 5933751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8e19ea67a00c7347f5899aebeb44a51e?s=128&d=identicon&r=PG&f=1", "display_name": "mohd.gadi", "link": "https://stackoverflow.com/users/5933751/mohd-gadi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1048, "favorite_count": 0, "accepted_answer_id": 48277149, "answer_count": 1, "score": 1, "last_activity_date": 1516094895, "creation_date": 1516090320, "last_edit_date": 1516094895, "question_id": 48276670, "link": "https://stackoverflow.com/questions/48276670/how-to-send-bytes-data-from-golang-to-python-using-exec-command", "title": "How to send bytes data from golang to python using exec command?", "body": "<p>Main.go</p>\n\n<pre><code>func main() {\n    bytearray=getbytearray()//getting an array of bytes\n    cmd := exec.Command(\"python3\", \"abc.py\")\n    in:=cmd.Stdin\n    cmd.Run()\n}\n</code></pre>\n\n<p>I want to send the byte array as input for the python script</p>\n\n<p>abc.py</p>\n\n<pre><code>import sys\nnewFile.write(sys.stdin) //write the byte array got as input to the newfile\n</code></pre>\n\n<p>How do i send bytes from golang to python and save that into a file?</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516076151, "post_id": 48273670, "comment_id": 83531530, "body": "It seems that the first func never gets a chance to run. And I doubt if that is expected behavior. However I am on mobile so I can provide no more information."}, {"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 0, "creation_date": 1516076864, "post_id": 48273670, "comment_id": 83531686, "body": "how many CPU cores? or try run more times(eg 10000?)"}], "answers": [{"comments": [{"owner": {"reputation": 420, "user_id": 4099500, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f3f4e3184632015ab540ee50064f599e?s=128&d=identicon&r=PG&f=1", "display_name": "kemiya", "link": "https://stackoverflow.com/users/4099500/kemiya"}, "edited": false, "score": 2, "creation_date": 1516084662, "post_id": 48274108, "comment_id": 83534095, "body": "I tried it in my local machine, and it did show random result. But I feel a little confused about the explanation, the GOMAXPROCS is actually 1 on the Go Playground, but the scheduler should always switch between main goroutine and other goroutine cause both <code>c1</code> and <code>c2</code> are not buffered,  isn&#39;t it? when a message send to channel, it should block for a very little while so main goroutine can receive it, but why can&#39;t it switch to another sender goroutine?"}, {"owner": {"reputation": 3095, "user_id": 178597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13148e76e55c7429e663480dc900bf77?s=128&d=identicon&r=PG", "display_name": "Christian", "link": "https://stackoverflow.com/users/178597/christian"}, "edited": false, "score": 0, "creation_date": 1516110439, "post_id": 48274108, "comment_id": 83549129, "body": "Process switching is relatively slow so the whole of the chan2 loop is executed before the processor switches to the other process. If you add some <code>time.Sleep(time.Millisecond)</code> into the loop you will see a different behavior on the playground. <a href=\"https://play.golang.org/p/-J0sTQ_b-Qa\" rel=\"nofollow noreferrer\">play.golang.org/p/-J0sTQ_b-Qa</a> Although it is not very random, it&#39;s alternating very regularly, with a step size of 2 which makes me wonder..."}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1565193681, "post_id": 48274108, "comment_id": 101278197, "body": "No reference to <a href=\"https://stackoverflow.com/a/36706499/2541573\">stackoverflow.com/a/36706499/2541573</a> in this answer, although it borrows heavily from it. Don&#39;t forget to give attribution where it&#39;s due."}], "tags": [], "owner": {"reputation": 1759, "user_id": 8708123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dcmM3.jpg?s=128&g=1", "display_name": "Fendi jatmiko", "link": "https://stackoverflow.com/users/8708123/fendi-jatmiko"}, "is_accepted": false, "score": 6, "last_activity_date": 1516076869, "creation_date": 1516076869, "answer_id": 48274108, "question_id": 48273670, "link": "https://stackoverflow.com/questions/48273670/golang-select-seems-not-fair/48274108#48274108", "title": "Golang `select` seems not fair", "body": "<p>the problem is you run it on go playground,, On the Go Playground, <a href=\"https://play.golang.org/p/GIIyXQb643\" rel=\"noreferrer\">GOMAXPROCS</a> is 1,, This means one goroutine is executed at a time, and if that goroutine does not block, the scheduler is not forced to switch to other goroutines.</p>\n\n<p>So, you should run it in your <strong><em>local machine</em></strong>, to see the real results</p>\n\n<blockquote>\n  <p>When you run it locally, most likely GOMAXPROCS will be greater than 1\n  as it defaults to the number of CPU cores available (since Go 1.5). So\n  it doesn't matter if you have a goroutine executing an endless loop,\n  another goroutine will be executed simultaneously, which will be the\n  main(), and when  main() returns, your program terminates; it does not\n  wait for other non-main goroutines to complete</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 420, "user_id": 4099500, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f3f4e3184632015ab540ee50064f599e?s=128&d=identicon&r=PG&f=1", "display_name": "kemiya", "link": "https://stackoverflow.com/users/4099500/kemiya"}, "edited": false, "score": 0, "creation_date": 1516087379, "post_id": 48275498, "comment_id": 83535225, "body": "My Go version is 1.8.3, according to the issue, it should works well perfectly on this version, and I looked into the <code>fastrand()</code> method source code of version 1.7/1.8/1.9,  and it should work perfectly cause no tricky <code>fastrand()</code> method was used by Golang Team."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "reply_to_user": {"reputation": 420, "user_id": 4099500, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f3f4e3184632015ab540ee50064f599e?s=128&d=identicon&r=PG&f=1", "display_name": "kemiya", "link": "https://stackoverflow.com/users/4099500/kemiya"}, "edited": false, "score": 0, "creation_date": 1516088894, "post_id": 48275498, "comment_id": 83535886, "body": "I have Go 1.9.2 on my machine and tested your code. The select statement acts (relatively) fair with this setup. In that thread it is mentioned that, this should work perfectly in Go 1.8.3. Just an observation: calling <code>runtime.Gosched()</code> inside the main loop, makes it even more fair. I do not know exactly how the cooperative scheduler of Go decides on stealing from each goroutine, but <code>runtime.Gosched()</code> seems to force it to act more generously, although is it not considered a good practice. <a href=\"https://play.golang.org/p/VDij1jWucUe\" rel=\"nofollow noreferrer\">play.golang.org/p/VDij1jWucUe</a>"}], "tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 1, "last_activity_date": 1516085498, "creation_date": 1516085498, "answer_id": 48275498, "question_id": 48273670, "link": "https://stackoverflow.com/questions/48273670/golang-select-seems-not-fair/48275498#48275498", "title": "Golang `select` seems not fair", "body": "<p>Depending on the Go version used, it might be; see <a href=\"https://github.com/golang/go/issues/21806\" rel=\"nofollow noreferrer\">this issue</a>. It should be fixed in Go 1.10 (regarding <a href=\"https://github.com/golang/go/issues/22253\" rel=\"nofollow noreferrer\">this one</a>, it is fixed in Go 1.9.2 but I have not tested).</p>\n"}], "owner": {"reputation": 420, "user_id": 4099500, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/f3f4e3184632015ab540ee50064f599e?s=128&d=identicon&r=PG&f=1", "display_name": "kemiya", "link": "https://stackoverflow.com/users/4099500/kemiya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 366, "favorite_count": 2, "closed_date": 1516087766, "answer_count": 2, "score": 6, "last_activity_date": 1516085498, "creation_date": 1516073357, "question_id": 48273670, "link": "https://stackoverflow.com/questions/48273670/golang-select-seems-not-fair", "closed_reason": "Duplicate", "title": "Golang `select` seems not fair", "body": "<p>I am a beginner of Golang, I read from the official <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"noreferrer\">spec of select</a> that I will do uniform pseudo-random when more of communications can proceed, but when I tried the following code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    // For our example we'll select across two channels.\n    c1 := make(chan string)\n    c2 := make(chan string)\n\n    go func() {\n        for {\n            c1 &lt;- \"one\"\n        }\n    }()\n    go func() {\n        for {\n            c2 &lt;- \"two\"\n        }\n    }()\n\n    for i := 0; i &lt; 100; i++ {\n        select {\n        case msg1 := &lt;-c1:\n            fmt.Println(\"received\", msg1)\n        case msg2 := &lt;-c2:\n            fmt.Println(\"received\", msg2)\n        }\n    }\n}\n</code></pre>\n\n<p>It always print 'received two', seems not to be a random result, so where am I wrong?</p>\n\n<p>The code can be test <a href=\"https://play.golang.org/p/mRcJa5fsCuW\" rel=\"noreferrer\">here</a>.</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 956, "user_id": 669493, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ffb12e2cefed1affc0a049c51fbf85eb?s=128&d=identicon&r=PG", "display_name": "zoonman", "link": "https://stackoverflow.com/users/669493/zoonman"}, "edited": false, "score": 0, "creation_date": 1516074353, "post_id": 48273702, "comment_id": 83531159, "body": "It solves one problem but immediately brings another one - <code>file_acl</code> is not getting updated now."}, {"owner": {"reputation": 956, "user_id": 669493, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ffb12e2cefed1affc0a049c51fbf85eb?s=128&d=identicon&r=PG", "display_name": "zoonman", "link": "https://stackoverflow.com/users/669493/zoonman"}, "edited": false, "score": 0, "creation_date": 1516078644, "post_id": 48273702, "comment_id": 83532201, "body": "This is tricky - from one side I want to update File and its metadata (list of users who has access to file) but from the other side just store references to User and Folder."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 0, "last_activity_date": 1516073589, "creation_date": 1516073589, "answer_id": 48273702, "question_id": 48273666, "link": "https://stackoverflow.com/questions/48273666/how-to-correctly-perform-partial-updates-in-gorm/48273702#48273702", "title": "How to correctly perform partial updates in Gorm?", "body": "<p>I think you might want <code>db.Set(\"gorm:save_associations\", false).Save(...)</code></p>\n"}, {"tags": [], "owner": {"reputation": 956, "user_id": 669493, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ffb12e2cefed1affc0a049c51fbf85eb?s=128&d=identicon&r=PG", "display_name": "zoonman", "link": "https://stackoverflow.com/users/669493/zoonman"}, "is_accepted": true, "score": 0, "last_activity_date": 1522348022, "creation_date": 1522348022, "answer_id": 49562807, "question_id": 48273666, "link": "https://stackoverflow.com/questions/48273666/how-to-correctly-perform-partial-updates-in-gorm/49562807#49562807", "title": "How to correctly perform partial updates in Gorm?", "body": "<p>To prevent cascade updates you should use <code>association_autoupdate</code> option.</p>\n\n<pre><code>Db.Set(\"gorm:association_autoupdate\", false).Save(&amp;file)\n</code></pre>\n"}], "owner": {"reputation": 956, "user_id": 669493, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ffb12e2cefed1affc0a049c51fbf85eb?s=128&d=identicon&r=PG", "display_name": "zoonman", "link": "https://stackoverflow.com/users/669493/zoonman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 0, "accepted_answer_id": 49562807, "answer_count": 2, "score": 0, "last_activity_date": 1522348022, "creation_date": 1516073324, "question_id": 48273666, "link": "https://stackoverflow.com/questions/48273666/how-to-correctly-perform-partial-updates-in-gorm", "title": "How to correctly perform partial updates in Gorm?", "body": "<p>I have some sort of virtual file system. List of folders, each folder contains files, and ACL.\nSo structure looks like this:</p>\n\n<pre><code>type Model struct {\n    ID        uint       `gorm:\"primary_key\" json:\"id\"`\n}\n\ntype User struct {\n    Model\n    Name string\n}\n\ntype Folder struct {\n    Model\n    Name string\n}\n\ntype File struct {\n    Model\n    Name string\n    FolderID      uint\n    Folder        Folder\n    Acl           []User `json:\"acl\" gorm:\"many2many:file_acl\"`\n} \n</code></pre>\n\n<p>It comes from frontend as full fledged JSON. It gets demarshalled.\nWhat happens next when I call <code>Save(&amp;file)</code> it correctly stores File, creates record inside <code>file_acl</code>. </p>\n\n<p>Also it updates Folder and Users. </p>\n\n<p>Here comes my question - how to skip those dependent updates but retain autogenerated queries to update/insert into <code>file_acl</code> table?</p>\n"}, {"tags": ["go", "svg"], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 3408605, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n8lUW.jpg?s=128&g=1", "display_name": "RakhuNathan", "link": "https://stackoverflow.com/users/3408605/rakhunathan"}, "edited": false, "score": 0, "creation_date": 1516093863, "post_id": 48274049, "comment_id": 83538552, "body": "This works when I am handling svg&#39;s directly. I am looking for code to do the same via Go Lang."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 53, "user_id": 3408605, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n8lUW.jpg?s=128&g=1", "display_name": "RakhuNathan", "link": "https://stackoverflow.com/users/3408605/rakhunathan"}, "edited": false, "score": 0, "creation_date": 1516114596, "post_id": 48274049, "comment_id": 83551995, "body": "@RakhuNathan the solution is there. It should not be difficult to write the code yourself."}], "tags": [], "owner": {"reputation": 80101, "user_id": 1292848, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bd043aba9d97059108cbc719f73fc4a8?s=128&d=identicon&r=PG", "display_name": "Paul LeBeau", "link": "https://stackoverflow.com/users/1292848/paul-lebeau"}, "is_accepted": true, "score": 1, "last_activity_date": 1516076456, "creation_date": 1516076456, "answer_id": 48274049, "question_id": 48273592, "link": "https://stackoverflow.com/questions/48273592/svg-appending-creation-with-byte-array-in-golang/48274049#48274049", "title": "SVG Appending/Creation with Byte Array in Golang", "body": "<p>To embed the image data in the SVG, you'll need to use a Data URL.  You Base64-encode the image file data, then append it to a prefix string containing the URL scheme <code>data:</code>, the MIME type (eg. <code>image/png</code>) and the encoding (<code>base64</code>).</p>\n\n<p>The SVG will end up looking like the following:</p>\n\n<pre><code>&lt;svg ...&gt;\n\n  &lt;image xlink:href=\"data:image/png;base64,PHN2ZyB4bWxucz0iaHR0cDo...etc...\"/&gt;\n\n&lt;/svg&gt;\n</code></pre>\n\n<p>You can <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs\" rel=\"nofollow noreferrer\">learn more about Data URLs here</a></p>\n"}], "owner": {"reputation": 53, "user_id": 3408605, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n8lUW.jpg?s=128&g=1", "display_name": "RakhuNathan", "link": "https://stackoverflow.com/users/3408605/rakhunathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 0, "accepted_answer_id": 48274049, "answer_count": 1, "score": 0, "last_activity_date": 1516076456, "creation_date": 1516072640, "question_id": 48273592, "link": "https://stackoverflow.com/questions/48273592/svg-appending-creation-with-byte-array-in-golang", "title": "SVG Appending/Creation with Byte Array in Golang", "body": "<p>I have an Image with its height, width and parameters. The objective is to create a file with pngs/jpgs into SVG. This SVG has to be portable without any additional files. When I tried with the approach mentioned in the SVGO documentation (code below), the svg takes a link reference to the Image. So when the image is deleted, svg will not have the Image in it. How do I push Image's byte[] into the SVG so that it becomes portable?\nI have tried the below code.</p>\n\n<pre><code>func createSvgFromImage(ImageObjectStructures []ImageObjectStructure, filename string) {\n    filename += \".svg\"\n    file, err := os.Create(filename)\n    if err != nil {\n        fmt.Println(\"svg file creation error:\", err)\n    }\n    width := int(10000)  // Has to be taken from individual page size\n    height := int(10000) // Has to be taken from individual page size\n    svg := svg.New(file)\n    svg.Start(width, height)\n    for i := 0; i &lt; len(ImageObjectStructures); i++ {\n        svg.Image(ImageObjectStructures[i].XPosition, ImageObjectStructures[i].YPosition, ImageObjectStructures[i].Width, ImageObjectStructures[i].Height, ImageObjectStructures[i].ImagePath, ImageObjectStructures[i].ImageCaption)\n        file.Write(ImageObjectStructures[i].ImageData)\n    }\n    svg.End()\n}\n</code></pre>\n"}, {"tags": ["go", "ssh"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1516094236, "post_id": 48273256, "comment_id": 83538754, "body": "You should be using <a href=\"https://godoc.org/golang.org/x/crypto/ssh#Session.StdoutPipe\" rel=\"nofollow noreferrer\">session.StdoutPipe</a> instead of setting <code>session.Stdout</code>. If returns a <code>io.Reader</code>, allowing you do read and parse the output yourself."}, {"owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516140583, "post_id": 48273256, "comment_id": 83566312, "body": "@Marc Thanks! That worked for excluding the Cisco prompt. Do you know how to read <code>session.StdoutPipe</code> for each sent command? I am trying to make my <code>SendCommand</code> function like so: <code>func SendCommand(stdin io.WriteCloser, cmd string) (output string, err error)</code>."}], "owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2502, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1518982006, "creation_date": 1516069544, "last_edit_date": 1518982006, "question_id": 48273256, "link": "https://stackoverflow.com/questions/48273256/golang-correctly-handle-stdout-of-ssh-session", "title": "Golang Correctly Handle Stdout of SSH Session", "body": "<p>I am writing a Go program to connect to a Cisco wireless controller to run multiple configuration commands on connected access points. I am able to connect to and send commands to the controller via Go's SSH package <code>golang.com/x/crypto/ssh</code>.</p>\n\n<p>I need to <strong>a)</strong> only print the output of each command I send, not the controller's prompt or login prompts, and <strong>b)</strong> figure out how to send successive commands after a command whose output includes <code>--More-- or (q)uit</code> prompts.</p>\n\n<p>Right now I have the <code>os.Stdout</code> assigned to the SSH <code>session.Stdout</code>, which is why I'm printing more than just the output of the commands I send. How would I  manually control the output of <code>session.Stdout</code>? I know the <code>session.Stdout</code> is an <code>io.Writer</code>, but I don't know how to control what it writes to <code>os.Stdout</code>. Here is my code along with its output:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"golang.org/x/crypto/ssh\"\n    \"golang.org/x/crypto/ssh/terminal\"\n    \"log\"\n    \"os\"\n    \"time\"\n    \"io\"\n)\n\nfunc SendCommand(in io.WriteCloser, cmd string) error {\n    if _, err := in.Write([]byte(cmd + \"\\n\")); err != nil {\n        return err\n    }\n\n    return nil\n}\n\nfunc main() {\n    // Prompt for Username\n    fmt.Print(\"Username: \")\n    r := bufio.NewReader(os.Stdin)\n    username, err := r.ReadString('\\n')\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Prompt for password\n    fmt.Print(\"Password: \")\n    password, err := terminal.ReadPassword(int(os.Stdin.Fd()))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Setup configuration for SSH client\n    config := &amp;ssh.ClientConfig{\n        Timeout: time.Second * 5,\n        User:    username,\n        Auth: []ssh.AuthMethod{\n            ssh.Password(string(password)),\n        },\n        HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n    }\n\n    // Connect to the client\n    client, err := ssh.Dial(\"tcp\", \"host:22\", config)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer client.Close()\n\n    // Create a session\n    session, err := client.NewSession()\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer session.Close()\n\n    // Setup StdinPipe to send commands\n    stdin, err := session.StdinPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer stdin.Close()\n\n    // Route session Stdout/Stderr to system Stdout/Stderr\n    session.Stdout = os.Stdout\n    session.Stderr = os.Stderr\n\n    // Start a shell\n    if err := session.Shell(); err != nil {\n        log.Fatal(err)\n    }\n\n    // Send username\n    if _, err := stdin.Write([]byte(username)); err != nil {\n        log.Fatal(err)\n    }\n    // Send password\n    SendCommand(stdin, string(password))\n\n    // Run configuration commands\n    SendCommand(stdin, \"show ap summary\")\n    SendCommand(stdin, \"logout\")\n    SendCommand(stdin, \"N\")\n\n    session.Wait()\n}\n</code></pre>\n\n<p>Sample run:</p>\n\n<pre><code>$ go run main.go \nUsername: username\nPassword: \n\n(Cisco Controller) \nUser: username\nPassword:****************\n(Cisco Controller) &gt;show ap summary\n\nNumber of APs.................................... 1\n\nGlobal AP User Name.............................. its-wap\nGlobal AP Dot1x User Name........................ Not Configured\n\nAP Name             Slots  AP Model              Ethernet MAC       Location          Country     IP Address       Clients   DSE Location  \n------------------  -----  --------------------  -----------------  ----------------  ----------  ---------------  --------  --------------\ncsc-ap3500   2     AIR-CAP3502I-A-K9     00:00:00:00:00:00  csc-TESTLAB-ap35  US          10.10.110.10       0       [0 ,0 ,0 ]\n\n(Cisco Controller) &gt;logout\nThe system has unsaved changes.\nWould you like to save them now? (y/N) N\n</code></pre>\n\n<p>My next problem comes when the output of a command has one or more <code>--More-- or (q)uit</code> prompts and I try to send a successive command. For example, here is the output of my code when running <code>show sysinfo</code> followed by <code>logout</code>:</p>\n\n<pre><code>$ go run main.go \nUsername: username\nPassword: \n\n(Cisco Controller) \nUser: username\nPassword:****************\n(Cisco Controller) &gt;show sysinfo\n\nManufacturer's Name.............................. Cisco Systems Inc.\nProduct Name..................................... Cisco Controller\nProduct Version.................................. 8.2.161.0\nBootloader Version............................... 1.0.20\nField Recovery Image Version..................... 7.6.101.1\nFirmware Version................................. PIC 16.0\n\n\nBuild Type....................................... DATA + WPS\n\n--More-- or (q)uit\n\nConfigured Country............................... US  - United States\nOperating Environment............................ Commercial (0 to 40 C)\nInternal Temp Alarm Limits....................... 0 to 65 C\nInternal Temperature............................. +23 C\nExternal Temperature............................. +28 C\nFan Status....................................... 3900 rpm\n# the \"l\" is missing in \"logout\"\n(Cisco Controller) &gt;ogout\n\nIncorrect usage.  Use the '?' or &lt;TAB&gt; key to list commands.\n\n(Cisco Controller) &gt;N\n\nIncorrect usage.  Use the '?' or &lt;TAB&gt; key to list commands.\n# the program hangs here\n(Cisco Controller) &gt; \n</code></pre>\n\n<p><strong>TL;DR</strong> How to manually control the output of an <code>io.Writer</code> and how to correctly handle sending commands in succession?</p>\n\n<p>Any help is appreciated. Thanks in advance.</p>\n"}, {"tags": ["algorithm", "math", "go"], "answers": [{"comments": [{"owner": {"reputation": 515, "user_id": 7804714, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9e70292d73d503d0ef63de4cda71b1ac?s=128&d=identicon&r=PG", "display_name": "hallazzang", "link": "https://stackoverflow.com/users/7804714/hallazzang"}, "edited": false, "score": 1, "creation_date": 1516062647, "post_id": 48272547, "comment_id": 83528873, "body": "Wow, I never thought this solution. Thank you"}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 0, "creation_date": 1516071006, "post_id": 48272547, "comment_id": 83530558, "body": "the range is only 1-45 so a number can be stored in 6 bits and the 6-tuple would need only 36 bits"}, {"owner": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "edited": false, "score": 0, "creation_date": 1516091030, "post_id": 48272547, "comment_id": 83536996, "body": "... and with a suitably clever encoding, since there are &quot;only&quot; about 8.15 million different combinations, 23 bits should be enough."}], "tags": [], "owner": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "is_accepted": true, "score": 6, "last_activity_date": 1516062494, "creation_date": 1516062494, "answer_id": 48272547, "question_id": 48272453, "link": "https://stackoverflow.com/questions/48272453/what-would-be-a-good-hash-functionor-something-similar-for-an-unique-integer-a/48272547#48272547", "title": "What would be a good hash function(or something similar) for an unique integer array?", "body": "<p>You can skip hashing and just treat it as one 64-bit number. Each lottery number is smaller than 256 and can be contained in 1 byte. You have 6 numbers, so that's 6 bytes and can be contained in 64-bit which is 8 bytes.</p>\n\n<p><a href=\"https://play.golang.org/p/JHLfHIhAUdd\" rel=\"noreferrer\">https://play.golang.org/p/JHLfHIhAUdd</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc hashFunc(v []uint8) uint64 {\n    var hash uint64\n    var i uint\n    for _, x := range v {\n        hash |= uint64(x) &lt;&lt; (i * 8)\n        i++\n    }\n    return hash\n}\n\nfunc main() {\n    fmt.Printf(\"hashFunc ({1,2,3,4,5,6}) = %#x\", hashFunc([]uint8{1,2,3,4,5,6}))\n}\n</code></pre>\n"}], "owner": {"reputation": 515, "user_id": 7804714, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9e70292d73d503d0ef63de4cda71b1ac?s=128&d=identicon&r=PG", "display_name": "hallazzang", "link": "https://stackoverflow.com/users/7804714/hallazzang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "accepted_answer_id": 48272547, "answer_count": 1, "score": 0, "last_activity_date": 1516062494, "creation_date": 1516061663, "question_id": 48272453, "link": "https://stackoverflow.com/questions/48272453/what-would-be-a-good-hash-functionor-something-similar-for-an-unique-integer-a", "title": "What would be a good hash function(or something similar) for an unique integer array?", "body": "<p>I'm writing a simple program to analyse the lottery. I'm curious about how often the same number patterns appear.</p>\n\n<p>Here's my working code in Golang:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"os\"\n    \"sort\"\n    \"sync\"\n\n    \"github.com/mitchellh/hashstructure\"\n)\n\nfunc do(n int, ch chan bool) {\n    hashes := make(map[uint64]struct{})\n\n    for i := 0; i &lt; n; i++ {\n        numbers := rand.Perm(45)[:6]\n        sort.Ints(numbers)\n\n        hash, err := hashstructure.Hash(numbers, nil)\n        if err != nil {\n            panic(err)\n        }\n\n        if _, ok := hashes[hash]; ok {\n            ch &lt;- true\n            break\n        } else {\n            hashes[hash] = struct{}{}\n        }\n    }\n}\n\nfunc main() {\n    n := 1000\n\n    ch := make(chan bool)\n    duplicated := 0.0\n    done := make(chan struct{})\n\n    wg := sync.WaitGroup{}\n    for i := 0; i &lt; n; i++ {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            do(800, ch)\n        }()\n    }\n\n    go func() {\n        wg.Wait()\n        close(done)\n    }()\n\n    for {\n        select {\n        case &lt;-ch:\n            duplicated += 1\n        case &lt;-done:\n            fmt.Printf(\"duplicated ratio: %.2f%%\\n\", duplicated/float64(n)*100)\n            os.Exit(0)\n        }\n    }\n}\n</code></pre>\n\n<p>I'm currently using <a href=\"https://github.com/mitchellh/hashstructure\" rel=\"nofollow noreferrer\">https://github.com/mitchellh/hashstructure</a> for hashing integer array(in Golang, type of <code>[]int</code>). I'm looking for a much efficient way to test if the lottery numbers were duplicated, since the library's function is considered as slow due to the reflections.</p>\n\n<p>I first thought something like this:</p>\n\n<pre><code>func hashFunc(v []int) int {\n    hash := 1\n    for _, x := range v {\n        hash ^= x\n    }\n    return hash\n}\n</code></pre>\n\n<p>But it generated hash collision. Could you suggest me a better way to hash int arrays(elements are unique, and in range 1~45) or even another approach to efficiently test if there were duplicated int array in past? Thank you.</p>\n"}, {"tags": ["for-loop", "go", "channel", "buffered"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1516055721, "post_id": 48271388, "comment_id": 83527018, "body": "It never exits, because you haven\u2019t ended the for loop in any way. You indicate that there\u2019s no more values to recieve from a chan by closing it."}], "answers": [{"tags": [], "owner": {"reputation": 98, "user_id": 8862808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41b7e30f64c8992897bd2668a35ede46?s=128&d=identicon&r=PG&f=1", "display_name": "lucas alcantara", "link": "https://stackoverflow.com/users/8862808/lucas-alcantara"}, "is_accepted": false, "score": 0, "last_activity_date": 1516107872, "last_edit_date": 1516107872, "creation_date": 1516101608, "answer_id": 48280050, "question_id": 48271388, "link": "https://stackoverflow.com/questions/48271388/for-loop-with-buffered-channel/48280050#48280050", "title": "For loop with buffered channel", "body": "<p>Another way that you can do:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nfunc GetPrice(quotes chan string) {\n    client := &amp;http.Client{}\n    req, _ := http.NewRequest(\"GET\", \"https://some/api\", nil)\n    req.Header.Set(\"Accept\", \"application/json\")\n    res, err := client.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    defer res.Body.Close()\n    body, err := ioutil.ReadAll(res.Body)\n    quotes &lt;- string(body)\n}\n\nfunc run(quotes chan string, quit chan bool, max int) {\n    for num := range quotes {\n        fmt.Println(num)\n        max--\n\n        if max == 0 {\n            quit &lt;- true\n        }\n    }\n}\n\nfunc main() {\n    const max = 3\n    quotes := make(chan string)\n    quit := make(chan bool)\n\n    go run(quotes, quit, max)\n\n    for i := 0; i &lt; max; i++ {\n        go GetPrice(quotes)\n    }\n\n    &lt;-quit\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2308, "user_id": 532383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b16537f0f4ce1a484c06d3fc996ea37?s=128&d=identicon&r=PG", "display_name": "Ayub Malik", "link": "https://stackoverflow.com/users/532383/ayub-malik"}, "edited": false, "score": 1, "creation_date": 1516182944, "post_id": 48281874, "comment_id": 83580763, "body": "I&#39;m going to go for this answer as it logically represents what I&#39;m trying to do."}], "tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": true, "score": 3, "last_activity_date": 1614628365, "last_edit_date": 1614628365, "creation_date": 1516107596, "answer_id": 48281874, "question_id": 48271388, "link": "https://stackoverflow.com/questions/48271388/for-loop-with-buffered-channel/48281874#48281874", "title": "For loop with buffered channel", "body": "<p><code>sync.WaitGroup</code> can be used here to wait for all goroutines and then closing the <code>quotes</code> channel:</p>\n<pre><code>func getPrice(quotes chan&lt;- string, onExit func()) {\n    go func() {\n        defer onExit()\n\n        req, _ := http.NewRequest(&quot;GET&quot;, &quot;https://some/api&quot;, nil)\n        req.Header.Set(&quot;Accept&quot;, &quot;application/json&quot;)\n\n        client := &amp;http.Client{}\n        res, err := client.Do(req)\n        if err != nil {\n            panic(err) // should be handled properly\n        }\n        defer res.Body.Close()\n\n        body, err := ioutil.ReadAll(res.Body)\n        quotes &lt;- string(body)\n    }()\n}\n\nfunc main() {\n    const max = 3\n    var wg sync.WaitGroup\n\n    quotes := make(chan string, max)\n    for i := 0; i &lt; max; i++ {\n        wg.Add(1)\n        getPrice(quotes, func() { wg.Done() })\n    }\n\n    go func() {\n        defer close(quotes)\n        wg.Wait()\n    }()\n\n    for n := range quotes {\n        fmt.Printf(&quot;\\n%s&quot;, n)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2198, "user_id": 5968255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c6ef7fa9abbb53a8e495ab5fff44fbf?s=128&d=identicon&r=PG&f=1", "display_name": "L_J", "link": "https://stackoverflow.com/users/5968255/l-j"}, "edited": false, "score": 2, "creation_date": 1534929127, "post_id": 51963367, "comment_id": 90877005, "body": "While this code may answer the question, providing information on how and why it solves the problem improves its long-term value."}, {"owner": {"reputation": 121, "user_id": 10010352, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qrN1R.png?s=128&g=1", "display_name": "jibeeeee", "link": "https://stackoverflow.com/users/10010352/jibeeeee"}, "edited": false, "score": 0, "creation_date": 1604411366, "post_id": 51963367, "comment_id": 114335166, "body": "According to the documentation, higher-level synchronization is better done via channels and communication. It can be a solution for using chans"}], "tags": [], "owner": {"reputation": 67, "user_id": 4418755, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Mjayd5hmHQE/AAAAAAAAAAI/AAAAAAAAADs/uFWBg7vLqmI/photo.jpg?sz=128", "display_name": "Miffa Young", "link": "https://stackoverflow.com/users/4418755/miffa-young"}, "is_accepted": false, "score": 0, "last_activity_date": 1534928827, "creation_date": 1534928827, "answer_id": 51963367, "question_id": 48271388, "link": "https://stackoverflow.com/questions/48271388/for-loop-with-buffered-channel/51963367#51963367", "title": "For loop with buffered channel", "body": "<pre><code>func GetPrice(quotes chan string) {\n    client := &amp;http.Client{}\n    req, _ := http.NewRequest(\"GET\", \"https://some/api\", nil)\n    req.Header.Set(\"Accept\", \"application/json\")\n    res, err := client.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    defer res.Body.Close()\n    body, err := ioutil.ReadAll(res.Body)\n    quotes &lt;- string(body)\n}\n\nfunc Consumer(chan string){\n    for n ,ok:= range quotes {\n        if !ok {\n             break\n        }\n        fmt.Printf(\"\\n%s\", n)\n    }\n}\n\nfunc main() {\n    const max = 3\n    quotes := make(chan string, max)\n    for i := 0; i &lt; max; i++ {\n        go GetPrice(quotes)\n    }\n    go Consumer(quotes)\n    close(quotes)\n}\n</code></pre>\n"}], "owner": {"reputation": 2308, "user_id": 532383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b16537f0f4ce1a484c06d3fc996ea37?s=128&d=identicon&r=PG", "display_name": "Ayub Malik", "link": "https://stackoverflow.com/users/532383/ayub-malik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7507, "favorite_count": 0, "accepted_answer_id": 48281874, "answer_count": 3, "score": 1, "last_activity_date": 1614628365, "creation_date": 1516054259, "last_edit_date": 1577576174, "question_id": 48271388, "link": "https://stackoverflow.com/questions/48271388/for-loop-with-buffered-channel", "title": "For loop with buffered channel", "body": "<p>I'm experimenting with Go channels and have an issue where the simple program below does not terminate.</p>\n\n<p>Essentially I want to make some async HTTP get requests and then <strong>wait</strong> till they are <strong>all</strong> finished. I'm using a buffered channel but I'm not sure this is the idiomatic way.</p>\n\n<pre><code>func GetPrice(quotes chan string) {\n    client := &amp;http.Client{}\n    req, _ := http.NewRequest(\"GET\", \"https://some/api\", nil)\n    req.Header.Set(\"Accept\", \"application/json\")\n    res, err := client.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    defer res.Body.Close()\n    body, err := ioutil.ReadAll(res.Body)\n    quotes &lt;- string(body)\n}\n\nfunc main() {\n    const max = 3\n    quotes := make(chan string, max)\n    for i := 0; i &lt; max; i++ {\n        go GetPrice(quotes)\n    }\n\n    for n := range quotes {\n        fmt.Printf(\"\\n%s\", n)\n    }\n}\n</code></pre>\n\n<p>The program successfully prints 3(max) items </p>\n\n<pre><code>{\"price\":\"1.00\"}\n{\"price\":\"2.00\"}\n{\"price\":\"3.00\"}\n</code></pre>\n\n<p>but then blocks and never exits.</p>\n"}, {"tags": ["go", "cross-compiling"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1516052386, "post_id": 48270988, "comment_id": 83525720, "body": "Remove the extra space after <code>linux</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1086, "user_id": 166436, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e23033c6b6b4cebc44273a4ca7070b?s=128&d=identicon&r=PG", "display_name": "Bolek Tekielski", "link": "https://stackoverflow.com/users/166436/bolek-tekielski"}, "edited": false, "score": 0, "creation_date": 1516053481, "post_id": 48271030, "comment_id": 83526165, "body": "That was it. Thanks @hobbs, an extra pair of eyes can save a day!"}, {"owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "edited": false, "score": 0, "creation_date": 1584479681, "post_id": 48271030, "comment_id": 107448589, "body": "I have had the same issue but I set it go env -w with an empty space but it messed and when I try to update it. it doesn&#39;t let me with the command. Is there a way I can manually fix this?"}, {"owner": {"reputation": 3433, "user_id": 623816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/754b2438628e91b0be05d8faf2f4f4e4?s=128&d=identicon&r=PG", "display_name": "Ferdinand Prantl", "link": "https://stackoverflow.com/users/623816/ferdinand-prantl"}, "edited": false, "score": 0, "creation_date": 1588605370, "post_id": 48271030, "comment_id": 108955719, "body": "I had a space appended behind the line <code>export GOOS=linux</code> in the Makefile. However stupid this mistake might look like, if I had not found this post, I would have probably lost a lot of time..."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 17, "last_activity_date": 1516052404, "creation_date": 1516052404, "answer_id": 48271030, "question_id": 48270988, "link": "https://stackoverflow.com/questions/48270988/error-with-go-cross-compilation-unsupported-goos-goarch-pair-linux-amd64/48271030#48271030", "title": "Error with go cross-compilation: unsupported GOOS/GOARCH pair linux /amd64", "body": "<p>It looks like your GOOS is getting set to \"linux \", not \"linux\".</p>\n"}], "owner": {"reputation": 1086, "user_id": 166436, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/75e23033c6b6b4cebc44273a4ca7070b?s=128&d=identicon&r=PG", "display_name": "Bolek Tekielski", "link": "https://stackoverflow.com/users/166436/bolek-tekielski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3981, "favorite_count": 1, "accepted_answer_id": 48271030, "answer_count": 1, "score": 4, "last_activity_date": 1516055042, "creation_date": 1516052152, "last_edit_date": 1516055042, "question_id": 48270988, "link": "https://stackoverflow.com/questions/48270988/error-with-go-cross-compilation-unsupported-goos-goarch-pair-linux-amd64", "title": "Error with go cross-compilation: unsupported GOOS/GOARCH pair linux /amd64", "body": "<p>I'm trying to cross-compile go code on windows, targeting linux machine.\nI have used simple go code to determine target os/platform,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"runtime\"\n\nfunc main() {\n        fmt.Printf(\"OS: %s\\nArchitecture: %s\\n\", runtime.GOOS, runtime.GOARCH)\n}\n</code></pre>\n\n<p>Running above code gives me </p>\n\n<pre><code>OS: linux\nArchitecture: amd64\n</code></pre>\n\n<p>hovever when I try to cross compile on windows (using JetBrain's Goland IDE) with</p>\n\n<pre><code>&gt; go version\ngo version go1.9.2 windows/amd64\n</code></pre>\n\n<p>using <code>GOOS=linux ;GOARCH=amd64</code> environment flags, I get following error</p>\n\n<pre><code>cmd/go: unsupported GOOS/GOARCH pair linux /amd64\n</code></pre>\n\n<p>I am new to golang, so I might be missing something simple, but this error got me stuck. Any help appreciated...</p>\n"}, {"tags": ["firebase", "go", "google-cloud-firestore"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1516048111, "post_id": 48270139, "comment_id": 83523906, "body": "This seems like a question for the Firestore maintainers or perhaps a Firestore-specific support forum."}], "answers": [{"comments": [{"owner": {"reputation": 9535, "user_id": 5861618, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ug9BL.png?s=128&g=1", "display_name": "Ros&#225;rio Pereira Fernandes", "link": "https://stackoverflow.com/users/5861618/ros%c3%a1rio-pereira-fernandes"}, "edited": false, "score": 0, "creation_date": 1516057711, "post_id": 48271934, "comment_id": 83527640, "body": "Remember that you can always <a href=\"https://firebase.google.com/support/contact/bugs-features/\" rel=\"nofollow noreferrer\">submit a feature request</a>"}], "tags": [], "owner": {"reputation": 9535, "user_id": 5861618, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ug9BL.png?s=128&g=1", "display_name": "Ros&#225;rio Pereira Fernandes", "link": "https://stackoverflow.com/users/5861618/ros%c3%a1rio-pereira-fernandes"}, "is_accepted": true, "score": 5, "last_activity_date": 1516057638, "creation_date": 1516057638, "answer_id": 48271934, "question_id": 48270139, "link": "https://stackoverflow.com/questions/48270139/query-comparisons-with-null-field/48271934#48271934", "title": "Query comparisons with null field", "body": "<p>It was intended to work that way. The <a href=\"https://firebase.google.com/docs/firestore/manage-data/data-types#value_type_ordering\" rel=\"noreferrer\">documentation</a> states that:</p>\n\n<blockquote>\n  <p>When a query involves a field with <strong>values of mixed types</strong>, Cloud\n  Firestore uses a deterministic ordering based on the internal\n  representations. The following list shows the order:</p>\n  \n  <ol>\n  <li>Null values</li>\n  <li>Boolean values</li>\n  <li>Integer and floating-point values, sorted in numerical order</li>\n  <li>Date values</li>\n  <li>Text string values</li>\n  <li>[...]</li>\n  </ol>\n</blockquote>\n\n<p>Note that it only follows this order when you're running a query with values of mixed types. In your query you're passing a <code>Date</code> value, which means it will only query on <strong>values of</strong> <code>Date</code> <strong>type</strong> and not the others (like <code>null</code> for example).</p>\n\n<p>In order to get the <code>null</code> values, you can create a compound query, by adding a second <code>Where</code>:</p>\n\n<pre><code>Collection(\"products\").Where(\"producedDate\", \"&lt;\", \"2018-01-15\").Where(\"producedDate\", \"==\", null)\n</code></pre>\n"}], "owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2480, "favorite_count": 1, "accepted_answer_id": 48271934, "answer_count": 1, "score": 3, "last_activity_date": 1516058075, "creation_date": 1516047706, "last_edit_date": 1516058075, "question_id": 48270139, "link": "https://stackoverflow.com/questions/48270139/query-comparisons-with-null-field", "title": "Query comparisons with null field", "body": "<p>My Firestore collection has documents with a string field, which can be <em>null</em>.</p>\n\n<p>I was expecting that if I query:</p>\n\n<pre><code>Collection(\"products\").Where(\"producedDate\", \"&lt;\", \"2018-01-15\")\n</code></pre>\n\n<p>I would get all products whose \"producedDate\" is earlier than \"2018-10-15\", including those whose \"producedDate\" is null.</p>\n\n<p>But actually I am not getting the <code>null</code>s.</p>\n\n<p>Is this intended or it's a bug?</p>\n"}, {"tags": ["http", "go", "server-push"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1516036235, "post_id": 48267616, "comment_id": 83518481, "body": "If you are using the default <code>http.ResponseWriter</code>, you can try <code>Flush()</code>: <a href=\"https://golang.org/pkg/net/http/#Flusher\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Flusher</a>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1516036550, "post_id": 48267616, "comment_id": 83518642, "body": "related <a href=\"https://stackoverflow.com/questions/19292113/not-buffered-http-responsewritter-in-golang\" title=\"not buffered http responsewritter in golang\">stackoverflow.com/questions/19292113/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 9220255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/967748f9d6a7dc14ad326b64ccf4b20b?s=128&d=identicon&r=PG&f=1", "display_name": "MoishAsh", "link": "https://stackoverflow.com/users/9220255/moishash"}, "edited": false, "score": 0, "creation_date": 1516037855, "post_id": 48267731, "comment_id": 83519251, "body": "If I understand correctly flush is for updating a response, but I have a problem that even the initial response does not execute immediately therefore w.WriteHeader(http.StatusAccepted) would still be delayed."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 105, "user_id": 9220255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/967748f9d6a7dc14ad326b64ccf4b20b?s=128&d=identicon&r=PG&f=1", "display_name": "MoishAsh", "link": "https://stackoverflow.com/users/9220255/moishash"}, "edited": false, "score": 1, "creation_date": 1516037909, "post_id": 48267731, "comment_id": 83519279, "body": "The writer buffers whatever you write to it. <code>Flush</code> causes it to send what&#39;s in the buffer to the client before it would do so automatically."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 105, "user_id": 9220255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/967748f9d6a7dc14ad326b64ccf4b20b?s=128&d=identicon&r=PG&f=1", "display_name": "MoishAsh", "link": "https://stackoverflow.com/users/9220255/moishash"}, "edited": false, "score": 1, "creation_date": 1516126297, "post_id": 48267731, "comment_id": 83559666, "body": "@MoishAsh If the response header was not already written to the network, then <code>Flush</code> will write the response header (including the status set with w.WriteHeader) with any buffered response body data."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 6, "last_activity_date": 1516036254, "creation_date": 1516036254, "answer_id": 48267731, "question_id": 48267616, "link": "https://stackoverflow.com/questions/48267616/why-is-golang-http-responsewriter-execution-being-delayed/48267731#48267731", "title": "Why is Golang http.ResponseWriter execution being delayed?", "body": "<p>You can check if the <code>ResponseWriter</code> is a <a href=\"https://golang.org/pkg/net/http/#Flusher\" rel=\"noreferrer\"><code>http.Flusher</code></a>, and if so, force the flush to network:</p>\n\n<pre><code>if f, ok := w.(http.Flusher); ok {\n    f.Flush()\n}\n</code></pre>\n\n<p>However, bear in mind that this is a very unconventional HTTP handler. Streaming out progress messages to the response as if it were a terminal presents a few problems, particularly if the client is a web browser.</p>\n\n<p>You might want to consider something more fitting with the nature of HTTP, such as returning a <code>202 Accepted</code> response immediately, with a unique identifier the client can use to check on the status of processing using subsequent calls to your API.</p>\n"}, {"comments": [{"owner": {"reputation": 105, "user_id": 9220255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/967748f9d6a7dc14ad326b64ccf4b20b?s=128&d=identicon&r=PG&f=1", "display_name": "MoishAsh", "link": "https://stackoverflow.com/users/9220255/moishash"}, "edited": false, "score": 0, "creation_date": 1516112926, "post_id": 48270817, "comment_id": 83550829, "body": "Thanks for your really detailed answer, I have tried your solution but to me it seems it is only <code>flush</code>ing once its finished the loop as it displays all Rows done: messages at once, rather than every 10,000 row count, if you increase <code>time.Sleep</code> to 10 * time.Second this is more noticable."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 105, "user_id": 9220255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/967748f9d6a7dc14ad326b64ccf4b20b?s=128&d=identicon&r=PG&f=1", "display_name": "MoishAsh", "link": "https://stackoverflow.com/users/9220255/moishash"}, "edited": false, "score": 0, "creation_date": 1516113199, "post_id": 48270817, "comment_id": 83551028, "body": "@MoishAsh To me it works as expected. What client / browser do you use?"}, {"owner": {"reputation": 105, "user_id": 9220255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/967748f9d6a7dc14ad326b64ccf4b20b?s=128&d=identicon&r=PG&f=1", "display_name": "MoishAsh", "link": "https://stackoverflow.com/users/9220255/moishash"}, "edited": false, "score": 0, "creation_date": 1516120458, "post_id": 48270817, "comment_id": 83556133, "body": "I use Chrome, and tested now on Firefox as well, both print all messages in one go after a delay."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 105, "user_id": 9220255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/967748f9d6a7dc14ad326b64ccf4b20b?s=128&d=identicon&r=PG&f=1", "display_name": "MoishAsh", "link": "https://stackoverflow.com/users/9220255/moishash"}, "edited": false, "score": 0, "creation_date": 1516120527, "post_id": 48270817, "comment_id": 83556188, "body": "@MoishAsh Did you use the exact code I posted (and nothing more)? I&#39;ve also tested it with curl, and I see continuous update at the client side."}, {"owner": {"reputation": 105, "user_id": 9220255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/967748f9d6a7dc14ad326b64ccf4b20b?s=128&d=identicon&r=PG&f=1", "display_name": "MoishAsh", "link": "https://stackoverflow.com/users/9220255/moishash"}, "edited": false, "score": 0, "creation_date": 1516120998, "post_id": 48270817, "comment_id": 83556484, "body": "I copied exactly the code on first try then changed the line <code>time.Sleep(time.Second) &#47;&#47; Simulating work...</code> to <code>time.Sleep(10 * time.Second) &#47;&#47; Simulating work...</code> to exaggerate delay as mentioned in my first comment. Just checked in console it <b>does</b> show but not on rendered page, now I need to work out why. Thanks for <b>all</b> your help. This was my first post."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 105, "user_id": 9220255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/967748f9d6a7dc14ad326b64ccf4b20b?s=128&d=identicon&r=PG&f=1", "display_name": "MoishAsh", "link": "https://stackoverflow.com/users/9220255/moishash"}, "edited": false, "score": 0, "creation_date": 1516121435, "post_id": 48270817, "comment_id": 83556736, "body": "@MoishAsh It also works for me if I change the sleep to 10 seconds; then I see a new line appearing in the browser window in every 10 seconds, respectively."}, {"owner": {"reputation": 105, "user_id": 9220255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/967748f9d6a7dc14ad326b64ccf4b20b?s=128&d=identicon&r=PG&f=1", "display_name": "MoishAsh", "link": "https://stackoverflow.com/users/9220255/moishash"}, "edited": false, "score": 1, "creation_date": 1516184224, "post_id": 48270817, "comment_id": 83581618, "body": "I am behind a sophos firewall thats making the problems on browser display <a href=\"https://stackoverflow.com/a/13135995/9220255\">link</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1517325101, "last_edit_date": 1517325101, "creation_date": 1516051257, "answer_id": 48270817, "question_id": 48267616, "link": "https://stackoverflow.com/questions/48267616/why-is-golang-http-responsewriter-execution-being-delayed/48270817#48270817", "title": "Why is Golang http.ResponseWriter execution being delayed?", "body": "<p>The original concept of the <a href=\"https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol\" rel=\"nofollow noreferrer\">HTTP protocol</a> is a simple request-response server-client computation model. There was no streaming or \"continuous\" client update support. It is (was) always the client who first contacted the server should it needed some kind of information.</p>\n\n<p>Also since most web servers cache the response until it is fully ready (or a certain limit is reached\u2013which is typically the buffer size), data you write (send) to the client won't be transmitted immediately.</p>\n\n<p>Several techniques were \"developed\" to get around this \"limitation\" so that the server is able to notify the client about changes or progress, such as HTTP Long polling, HTTP Streaming, HTTP/2 Server Push or Websockets. You can read more about these in this answer: <a href=\"https://stackoverflow.com/questions/8110550/is-there-a-real-server-push-over-http/8337667#8337667\">Is there a real server push over http?</a></p>\n\n<p>So to achieve what you want, you have to step around the original \"borders\" of the HTTP protocol.</p>\n\n<p>If you want to send data periodically, or stream data to the client, you have to tell this to the server. The easiest way is to check if the <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow noreferrer\"><code>http.ResponseWriter</code></a> handed to you implements the <a href=\"https://golang.org/pkg/net/http/#Flusher\" rel=\"nofollow noreferrer\"><code>http.Flusher</code></a> interface (using a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>), and if it does, calling its <code>Flusher.Flush()</code> method will send any buffered data to the client.</p>\n\n<p>Using <code>http.Flusher</code> is only half of the solution. Since this is a non-standard usage of the HTTP protocol, usually client support is also needed to handle this properly.</p>\n\n<p>First, you have to let the client know about the \"streaming\" nature of the response, by setting the <code>ContentType=text/event-stream</code> response header.</p>\n\n<p>Next, to avoid clients caching the response, be sure to also set <code>Cache-Control=no-cache</code>.</p>\n\n<p>And last, to let the client know that you might not send the response as a single unit (but rather as periodic updates or as a stream) and so that the client should keep the connection alive and wait for further data, set the <code>Connection=keep-alive</code> response header.</p>\n\n<p>Once the response headers are set as the above, you may start your long work, and whenever you want to update the client about the progress, write some data and call <code>Flusher.Flush()</code>.</p>\n\n<p>Let's see a simple example that does everything \"right\":</p>\n\n<pre><code>func longHandler(w http.ResponseWriter, r *http.Request) {\n    flusher, ok := w.(http.Flusher)\n    if !ok {\n        http.Error(w, \"Server does not support Flusher!\",\n            http.StatusInternalServerError)\n        return\n    }\n\n    w.Header().Set(\"Content-Type\", \"text/event-stream\")\n    w.Header().Set(\"Cache-Control\", \"no-cache\")\n    w.Header().Set(\"Connection\", \"keep-alive\")\n\n    start := time.Now()\n    for rows, max := 0, 50*1000; rows &lt; max; {\n        time.Sleep(time.Second) // Simulating work...\n        rows += 10 * 1000\n        fmt.Fprintf(w, \"Rows done: %d (%d%%), elapsed: %v\\n\",\n            rows, rows*100/max, time.Since(start).Truncate(time.Millisecond))\n        flusher.Flush()\n    }\n}\n\nfunc main() {\n    http.HandleFunc(\"/long\", longHandler)\n    panic(http.ListenAndServe(\"localhost:8080\", nil))\n}\n</code></pre>\n\n<p>Now if you open <code>http://localhost:8080/long</code> in your browser, you will see an output \"growing\" by every second:</p>\n\n<pre><code>Rows done: 10000 (20%), elapsed: 1s\nRows done: 20000 (40%), elapsed: 2s\nRows done: 30000 (60%), elapsed: 3s\nRows done: 40000 (80%), elapsed: 4.001s\nRows done: 50000 (100%), elapsed: 5.001s\n</code></pre>\n\n<p>Also note that when using SSE, you should \"pack\" updates into SSE frames, that is you should start them with <code>\"data:\"</code> prefix, and end each frame with 2 newline chars: <code>\"\\n\\n\"</code>.</p>\n\n<h3>\"Literature\" and further reading / tutorials</h3>\n\n<p>Read more about <a href=\"https://en.wikipedia.org/wiki/Server-sent_events\" rel=\"nofollow noreferrer\">Server-sent events on Wikipedia</a>.</p>\n\n<p>See a <a href=\"https://github.com/kljensen/golang-html5-sse-example\" rel=\"nofollow noreferrer\">Golang HTML5 SSE example</a>.</p>\n\n<p>See <a href=\"https://gist.github.com/artisonian/3836281\" rel=\"nofollow noreferrer\">Golang SSE server example with client codes using it</a>.</p>\n\n<p>See w3school.com's turorial on <a href=\"https://www.w3schools.com/html/html5_serversentevents.asp\" rel=\"nofollow noreferrer\">Server-Sent Events - One Way Messaging</a>.</p>\n"}], "owner": {"reputation": 105, "user_id": 9220255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/967748f9d6a7dc14ad326b64ccf4b20b?s=128&d=identicon&r=PG&f=1", "display_name": "MoishAsh", "link": "https://stackoverflow.com/users/9220255/moishash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3038, "favorite_count": 1, "accepted_answer_id": 48270817, "answer_count": 2, "score": 5, "last_activity_date": 1539174967, "creation_date": 1516035830, "last_edit_date": 1539174967, "question_id": 48267616, "link": "https://stackoverflow.com/questions/48267616/why-is-golang-http-responsewriter-execution-being-delayed", "title": "Why is Golang http.ResponseWriter execution being delayed?", "body": "<p>I am trying to send a page response as soon as request is received, then process something, but I found the response does not get sent out \"first\" even though it is first in code sequence.In real life I have a page for uploading a excel sheet which gets saved into the database which takes time (50,0000+ rows) and would like to update to user progress. Here is a simplified example; (depending how much RAM you have you may need to add a couple zeros to counter to see result)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc writeAndCount(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Starting to count\"))\n\n    for i := 0; i &lt; 1000000; i++ {\n\n        if i%1000 == 0 {\n            fmt.Println(i)\n        }\n    }\n    w.Write([]byte(\"Finished counting\"))\n\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", writeAndCount)\n    http.ListenAndServe(\":8080\", nil)\n\n}\n</code></pre>\n"}, {"tags": ["go", "cross-platform"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1516030878, "post_id": 48266179, "comment_id": 83515386, "body": "From the GOARCH environment variable, which defaults to the architecture of the machine you&#39;re executing the build on. See the documentation: <a href=\"https://golang.org/pkg/go/build/\" rel=\"nofollow noreferrer\">golang.org/pkg/go/build</a>"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1516039656, "post_id": 48266225, "comment_id": 83520087, "body": "Wow, that&#39;s my comment, almost verbatim."}], "tags": [], "owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "is_accepted": true, "score": 2, "last_activity_date": 1516030942, "creation_date": 1516030942, "answer_id": 48266225, "question_id": 48266179, "link": "https://stackoverflow.com/questions/48266179/how-does-the-compiler-select-the-architecture-for-asm-s-files/48266225#48266225", "title": "How does the compiler select the architecture for asm_*.S files?", "body": "<p>By default, the Go compiler targets the architecture you are running. You can set the <code>GOARCH</code> environment variable to override this. See: <a href=\"https://golang.org/pkg/go/build/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/go/build/</a></p>\n"}], "owner": {"reputation": 385, "user_id": 1849612, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/1rwIy.png?s=128&g=1", "display_name": "Xerusial", "link": "https://stackoverflow.com/users/1849612/xerusial"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 48266225, "answer_count": 1, "score": -6, "last_activity_date": 1516031276, "creation_date": 1516030795, "last_edit_date": 1516031276, "question_id": 48266179, "link": "https://stackoverflow.com/questions/48266179/how-does-the-compiler-select-the-architecture-for-asm-s-files", "title": "How does the compiler select the architecture for asm_*.S files?", "body": "<p>I wanted to know how the Go compiler selects the architecture for assembler files such as in '<a href=\"https://golang.org/src/sync/atomic/\" rel=\"nofollow noreferrer\">sync/atomic</a>'. Is there a compiler flag?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1516026258, "post_id": 48264882, "comment_id": 83512641, "body": "Your question is really not clear. Can you give a concrete example of how your builders are supposed to be called? If you want common code to invoke them, just make a <code>Builder</code> interface with a <code>Build()</code> method. If you want to use a <code>BaseBuilder</code>, have each other builder embed that struct. Again, some clarification and use example would help."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516026325, "post_id": 48264882, "comment_id": 83512675, "body": "@Marc - This is not implemented yet and I want to make the design before written the code and before doing mistakes since im new to golang...any direction will be helpful since all the examples that I find in golang are too basic"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516026488, "post_id": 48264882, "comment_id": 83512756, "body": "Except this isn&#39;t how SO works, especially not with such a vague description. We really need a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a>. I suggest trying some solutions out yourself based on your requirements and seeing what works. Then ask here if you run into specific issues."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1516026516, "post_id": 48264882, "comment_id": 83512778, "body": "There is no inheritance in Go and thus no real &quot;base&quot; types. I would recommend reassessing your design based on the language in which it is being implemented."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1516026577, "post_id": 48264882, "comment_id": 83512814, "body": "@Adrian - Ok thanks, can you give a direction some reference for this such problem ?  how it good to implement ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1516026654, "post_id": 48264882, "comment_id": 83512855, "body": "@Adrian - also git reference for project that are using the same logic will be great..."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1516026661, "post_id": 48264882, "comment_id": 83512860, "body": "That&#39;s much too broad and opinionated a question for SO.  Try Reddit, or maybe reading some of the bountiful Go source that&#39;s already available publicly, including the standard library and 3rd-party libraries on GitHub."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1516040411, "post_id": 48264882, "comment_id": 83520431, "body": "Throughout, you&#39;re talking about <i>&quot;inheritance&quot;</i>. Whilst understandable, you need to come to terms with the simple fact of the matter that golang has no classical inheritance. You can embed types (ie composition), but you cannot inherit. FWIW, I&#39;d look at implementing a generic <code>Builder</code> interface, and just load the builders you need"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1516040619, "post_id": 48264882, "comment_id": 83520526, "body": "@EliasVanOotegem - Thanks a lot for the  direction, it will be great if you can provide some simple example how to do it ...im coming from javasc and it a bit confusing... thanks!!!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1516281619, "post_id": 48264882, "comment_id": 83629725, "body": "@EliasVanOotegem - I&#39;ve update the question with bounty, it will be great if you can have a look and provide example how to do it...thanks"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516281653, "post_id": 48264882, "comment_id": 83629754, "body": "@Marc -I&#39;ve update the question with bounty, it will be great if you can have a look and provide example how to do it...thanks"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516293445, "post_id": 48324049, "comment_id": 83637727, "body": "Thanks for elaborating 1+ , I like the option 1 but what I missing is how to use for example 2-3 builders (im talking just about the structuring)  and if using an interface how it should be done ,example on extended option one will be they way I want to go so it will be very helpful, I mean how you handle the structures, packages copy zip etc, thanks a lot!"}, {"owner": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "edited": false, "score": 0, "creation_date": 1516296289, "post_id": 48324049, "comment_id": 83639422, "body": "In solution1, you have all the builder types in the same package. Theoretically speaking, they could be in the same file, although I prefer to have 1 file per type. <code>copy</code> and <code>zip</code> can be in their own files, in the same package. And you just expose the types: you will define the interface on the consumer package: most probably, the <code>main</code> package."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516297432, "post_id": 48324049, "comment_id": 83640095, "body": "Speaking of tiny packages, Edward Muller had a talk on dotgo against it: <a href=\"https://about.sourcegraph.com/go/idiomatic-go#tiny-package-syndrome\" rel=\"nofollow noreferrer\">about.sourcegraph.com/go/idiomatic-go#tiny-package-syndrome</a>"}], "tags": [], "owner": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "is_accepted": false, "score": 4, "last_activity_date": 1516372536, "last_edit_date": 1516372536, "creation_date": 1516287043, "answer_id": 48324049, "question_id": 48264882, "link": "https://stackoverflow.com/questions/48264882/using-inheritance-of-builders-in-go/48324049#48324049", "title": "Using inheritance of builders in GO", "body": "<p>Go is not an object-oriented language. This means that by design, you don't necessarily have all the behaviour of a type encapsulated in the type itself. And this is handy when you think that we don't have inheritance.</p>\n\n<p>When you want to build a type upon another type, you use composition instead: a <code>struct</code> can embed other types, and expose their methods.</p>\n\n<p>Let's say that you have a <code>MyZipper</code> type that exposes a <code>Zip(string)</code> method, and a <code>MyCopier</code> that exposes a <code>Copy(string)</code> method:</p>\n\n<pre><code>type Builder struct {\n    MyZipper\n    MyCopier\n}\n\nfunc (b Builder) Build(path string) error {\n\n    // some code\n\n    err := b.Zip(path)\n    if err != nil {\n        return err\n    }\n\n    err := b.Copy(path)\n    if err != nil {\n        return err\n    }\n}\n</code></pre>\n\n<p>An this is composition in Go. Going further, you can even embed non-exposed types (e.g. <code>myZipper</code> and <code>myCopier</code>) if you only want them to be called from within the <code>builder</code> package. But then, why embedding them in the first place?</p>\n\n<p>You can chose between several different valid designs for your Go project.</p>\n\n<h3>solution 1: Single package exposing multiple Builder types</h3>\n\n<p>In this case, you want a <code>builder</code> package, that will expose multiple builders.</p>\n\n<p><code>zip</code> and <code>copy</code> are two functions defined somewhere in the package, they don't need to be methods attached to a type.</p>\n\n<pre><code>package builder\n\nfunc zip(zip, args string) error {\n    // zip implementation\n}\n\nfunc cp(copy, arguments string) error {\n    // copy implementation\n}\n\ntype NodeBuilder struct{}\n\nfunc (n NodeBuilder) Build(path string) error {\n    // node-specific code here\n\n    if err := zip(the, args); err != nil {\n        return err\n    }\n\n    if err := cp(the, args); err != nil {\n        return err\n    }\n\n    return nil\n}\n\ntype PythonBuilder struct{}\n\nfunc (n PythonBuilder) Build(path string) error {\n    // python-specific code here\n\n    if err := zip(the, args); err != nil {\n        return err\n    }\n\n    if err := cp(the, args); err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>\n\n<h3>solution 2: single package, single type embedding specific behaviour</h3>\n\n<p>Depending on the complexity of the specific behaviour, you may not want to change the whole behaviour of the Build function, but just to inject a specific behaviour: </p>\n\n<pre><code>package builder\n\nimport (\n    \"github.com/me/myproj/copier\"\n    \"github.com/me/myproj/zipper\"\n)\n\ntype Builder struct {\n    specificBehaviour func(string) error\n}\n\nfunc (b Builder) Build(path string) error {\n    if err := specificBehaviour(path); err != nil {\n        return err\n    }\n\n    if err := zip(the, args); err != nil {\n        return err\n    }\n\n    if err := copy(the, args); err != nil {\n        return err\n    }\n\n    return nil\n}\n\nfunc nodeSpecificBehaviour(path string) error {\n    // node-specific code here\n}\n\nfunc pythonSpecificBehaviour(path string) error {\n    // python-specific code here\n}\n\nfunc NewNode() Builder {\n    return Builder{nodeSpecificBehaviour}\n}\n\nfunc NewPython() Builder {\n    return Builder{pythonSpecificBehaviour}\n}\n</code></pre>\n\n<h3>solution 3: one package per specificBuilder</h3>\n\n<p>On the other end of the scale, depending on the package granularity you want to use in your project, you may want to have a distinct package for every builder. With this premise, you want to generalise the shared functionality enough to give it a citizenship as package too. Example:</p>\n\n<pre><code>package node\n\nimport (\n    \"github.com/me/myproj/copier\"\n    \"github.com/me/myproj/zipper\"\n)\n\ntype Builder struct {\n}\n\nfunc (b Builder) Build(path string) error {\n    // node-specific code here\n\n    if err := zipper.Zip(the, args); err != nil {\n        return err\n    }\n\n    if err := copier.Copy(the, args); err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>\n\n<h3>solution 4: functions!</h3>\n\n<p>If you know your builders will be purely functional, meaning they don't need any internal state, then you may want your Builders to be function types intead of interfaces. You will still be able to manipulate them as a single type from the consumer side, if this is what you want:</p>\n\n<pre><code>package builder\n\ntype Builder func(string) error\n\nfunc NewNode() Builder {\n    return func(string) error {\n\n        // node-specific behaviour\n\n        if err := zip(the, args); err != nil {\n            return err\n        }\n\n        if err := copy(the, args); err != nil {\n            return err\n        }\n\n        return nil\n    }\n}\n\nfunc NewPython() Builder {\n    return func(string) error {\n\n        // python-specific behaviour\n\n        if err := zip(the, args); err != nil {\n            return err\n        }\n\n        if err := copy(the, args); err != nil {\n            return err\n        }\n\n        return nil\n    }\n}\n</code></pre>\n\n<p>I wouldn't go with functions for your particular case, because you will need to solve very different problems with every BUilder, and you will definitely need some state at some point.</p>\n\n<p>... I'll leave you the pleasure to combine together some of these techniques, if you are having a boring afternoon.</p>\n\n<h3>Bonus!</h3>\n\n<ul>\n<li>Don't be afraid of creating multiple packages, as this will help you design clear boundaries between the types, and take full advantage of encapsulation.</li>\n<li>The <code>error</code> keyword is an interface, not a type! You can <code>return nil</code> if you have no errors.</li>\n<li>Ideally, you don't define the <code>Builder</code> interface in the <code>builder</code> package: you don't need it. The <code>Builder</code> interface will sit in the consumer package.</li>\n</ul>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516306541, "post_id": 48324091, "comment_id": 83644924, "body": "Thanks, Assume that I&#39;ve two builders one node and python , how would you write all the process (the main throw the builder and builders ) to handle the logic (just example not real implementations ) , I miss the whole flow ...Thanks a lot"}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1516307545, "post_id": 48324091, "comment_id": 83645350, "body": "@RaynD can you elaborate the question? I don&#39;t think I understand it."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516309495, "post_id": 48324091, "comment_id": 83646274, "body": "Sure :) , Lets say you have <code>main</code> function and you should handle two type of different builders(node/java/any_other ) two is sufficient to get the point ...,  (you can put the method of <code>copy</code> and <code>zip</code> and <code>temp folder</code> as empty  implementation), I just want to get the point how  the <code>process</code> will be executed from <code>main</code> until <code>executing the builders</code>. if you need to write this new project in <code>GitHub</code> how would you <code>structure it</code> ?  where the <code>zip logic</code> will be (which package) same for <code>copy</code> and the <code>specific builders</code> and the builder process. Thanks a lot!"}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1516311676, "post_id": 48324091, "comment_id": 83647340, "body": "I&#39;ve added much more, and there might be typos and a farcry from optimized. The first step in creating a tool is to think hard about how natural it is to use from the user&#39;s POV, and that means the API or methods you expose. For example, you might add extra parameters to <code>Create</code> so the user can write their own <code>pre</code> and <code>post</code> hooks to override or compliment the default ones, but that is a design decision too."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516373589, "post_id": 48324091, "comment_id": 83672991, "body": "Thank you! , I&#39;ve try to play with your direction to understand the concept more and I got some error (some of then was fixed) , can you please have a look , <a href=\"https://play.golang.org/p/O60aSu4nJnO\" rel=\"nofollow noreferrer\">play.golang.org/p/O60aSu4nJnO</a> , in addition if you want to build this project on GITHUB (from scratch) , how would you structure it , where do you put each file , something like this <a href=\"https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1\" rel=\"nofollow noreferrer\">medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1</a>  will be very helpful   (like section 4 drawing the structure will be great ) many thanks!"}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1516464250, "post_id": 48324091, "comment_id": 83703015, "body": "@RaynD thanks for pointing out, the corrected version is here <a href=\"https://play.golang.org/p/xAcqvqNNfOo\" rel=\"nofollow noreferrer\">play.golang.org/p/xAcqvqNNfOo</a>. Note that still you couldn&#39;t use <code>os&#47;exec</code> on playground and previously there were &quot;placeholders&quot; in the code preventing it from being compiled."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516552595, "post_id": 48324091, "comment_id": 83724801, "body": "1. it will be great if you can add to the working version play.golang.org/p/O60aSu4nJnO some high-level content for the wrapper (since I dont understand what it the purpose of it in the flow, I guess i miss something very helpful ...) , inside the wrapper as I understand (not sure if true) you mean to provide the builder specific logic , but its not better to create specific file that will handle each builder logic ? can this adopt in your design ? (I believe in <code>SOC</code> )...  , in addition what is the <code>configs</code> object for ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516552657, "post_id": 48324091, "comment_id": 83724821, "body": "also if I put it like this NodeConfig = &amp;Builder{ Manager: &quot;npm&quot;, Cmd:&quot;npm install&quot;, Postfn: zipAndCopyTo, } noting happen... , any idea? and also what is the need for the <code>npmWrapper</code> and how it should be used ? thanks a lot sir!"}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1516563991, "post_id": 48324091, "comment_id": 83728723, "body": "<code>Cmd</code> should only be the second argument of the command line input. In this case <code>&quot;install&quot;</code>. It should look like this <code>NodeConfig = &amp;Builder{ Manager: &quot;npm&quot;, Cmd: &quot;install&quot;, ... }</code>. Ignore the <code>npmWrapper</code> in playground it was dead code."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516566615, "post_id": 48324091, "comment_id": 83729667, "body": "Can you please explain about the <code>wrapBuilder</code>, why we need it ? which design benefit this give ?  (sorry but I miss the point...) in addition also why we need the <code>configs</code>  var ?  it will be great if you have a time to do last mile and make the example work just with node ...I mean how you see it should work...Thanks a lot sir!"}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1516647057, "post_id": 48324091, "comment_id": 83764443, "body": "I&#39;ve added some more text to explain, if you like this is getting too long let&#39;s take it in <a href=\"https://chat.stackoverflow.com/rooms/163406/go-language-learning\">chat.stackoverflow.com/rooms/163406/go-language-learning</a>."}], "tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": false, "score": 4, "last_activity_date": 1516646753, "last_edit_date": 1516646753, "creation_date": 1516287159, "answer_id": 48324091, "question_id": 48264882, "link": "https://stackoverflow.com/questions/48264882/using-inheritance-of-builders-in-go/48324091#48324091", "title": "Using inheritance of builders in GO", "body": "<p>Let's go through each question one by one:</p>\n\n<p><strong>1. Where should I put the the zip and copy (in the structure) and for example how should I implement them and path them to the builder ?</strong></p>\n\n<p>An interface does not carry any data (assuming you wanted to implement one from your code). It is just a blueprint an object can implements in order to pass as a more generic type. In this case, if you are not passing <code>Builder</code> type anywhere, the interface is redundant.</p>\n\n<p><strong>2. Should I structure the project differently according the assumptions?</strong></p>\n\n<p>This is my take on the project. I'll explain each part separately after the code:</p>\n\n<pre><code>package buildeasy\n\nimport (\n        \"os/exec\"\n)\n\n\n// Builder represents an instance which carries information\n// for building a project using command line interface.\ntype Builder struct {\n        // Manager is a name of the package manager (\"npm\", \"pip\")\n        Manager string\n        Cmd     string\n        Args    []string\n        Prefn   func(string) error\n        Postfn  func(string) error\n}\n\nfunc zipAndCopyTo(path string) error {\n        // implement zipping and copy to the provided path\n        return nil\n}\n\nvar (\n        // Each manager specific configurations\n        // are stored as a Builder instance.\n        // More fields and values can be added.\n        // This technique goes hand-in-hand with\n        // `wrapBuilder` function below, which is\n        // a technique called \"functional options\"\n        // which is considered a cleanest approach in\n        // building API methods.\n        // https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis\n        NodeConfig = &amp;Builder{\n                Manager: \"npm\",\n                Postfn:  zipAndCopyTo,\n        }\n        PythonConfig = &amp;Builder{\n                Manager: \"pip\",\n                Postfn:  zipAndCopyTo,\n        }\n)\n\n// This enum is used by factory function Create to select the\n// right config Builder from the array below.\ntype Manager int\n\nconst (\n    Npm Manager = iota\n    Pip\n    // Yarn\n    // ...\n)\n\nvar configs = [...]*Builder{\n    NodeConfig,\n    PythonConfig,\n    // YarnConfig, \n}\n\n// wrapBuilder accepts an original Builder and a function that can\n// accept a Builder and then assign relevant value to the first.\nfunc wrapBuilder(original *Builder, wrapperfn func(*Builder)) error {\n    if original != nil {\n        wrapperfn(original)\n        return nil\n    }\n    return errors.New(\"Original Builder is nil\")\n}\n\nfunc New(manager Manager) *Builder {\n    builder := new(Builder)\n    // inject / modify properties of builder with relevant\n    // value for the manager we want.\n    wrapBuilder(builder, configs[int(manager)])\n    })\n    return builder\n}\n\n// Now you can have more specific methods like to install.\n// notice that it doesn't matter what this Builder is for.\n// All information is contained in it already.\nfunc (b *Builder) Install(pkg string) ([]byte, error) {\n    b.Cmd = \"install\"\n\n    // if package is provided, push its name to the args list\n    if pkg != \"\" {\n        b.Args = append([]string{pkg}, b.Args...)\n    }\n\n    // This emits \"npm install [pkg] [args...]\"\n    cmd := exec.Command(b.Manager, (append([]string{b.Cmd}, b.Args...))...)\n    // default to executing in the current directory\n    cmd.Dir = \"./\"\n\n    combined, err := cmd.CombinedOutput()\n    if err != nil {\n        return nil, err\n    }\n    return combined, nil\n}\n\n\n\nfunc (b *Builder) Build(path string) error {\n    // so default the path to a temp folder\n    if path == \"\" {\n        path = \"path/to/my/temp\"\n    }\n\n    // maybe prep the source directory?\n    if err := b.Prefn(path); err != nil {\n        return err\n    }\n\n    // Now you can use Install here\n    output, err := b.Install(\"\")\n    if err != nil {\n        return err\n    }\n\n    log.Printf(\"%s\", output)\n\n    // Now zip and copy to where you want\n    if err := b.Postfn(path); err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>Now this <code>Builder</code> is generic enough to handle most build commands. Notice <code>Prefn</code> and <code>Postfn</code> fields. These are hook functions you can run before and after the command runs within <code>Build</code>. <code>Prefn</code> can check if, say, the package manager is installed and install it if it's not (or just return an error). <code>Postfn</code> can run your <code>zip</code> and <code>copy</code> operations, or any clean up routine. Here's a usecase, provided <code>superbuild</code> is our fictional package name and the user is using it from outside:</p>\n\n<pre><code>import \"github.com/yourname/buildeasy\"\n\nfunc main() {\n\n        myNodeBuilder := buildeasy.New(buildeasy.NPM)\n        myPythonBuilder := buildeasy.New(buildeasy.PIP)\n\n        // if you wanna install only\n        myNodeBuilder.Install(\"gulp\")\n\n        // or build the whole thing including pre and post hooks\n        myPythonBuilder.Build(\"my/temp/build\")\n\n        // or get creative with more convenient methods\n        myNodeBuilder.GlobalInstall(\"gulp\")\n}\n</code></pre>\n\n<p>You can predefine a few <code>Prefn</code>s and <code>Postfn</code>s and make them available as option for the user of your program, assuming it's a command line program, or if it's a library, have the user write them herself.</p>\n\n<p><strong>wrapBuilder function</strong></p>\n\n<p>There are a few techniques used in constructing an instance in Go. First, parameters can be passed into a constructor function (this code is for explanation only and not to be used):</p>\n\n<pre><code>func TempNewBuilder(cmd string) *Builder {\n        builder := new(Builder)\n        builder.Cmd = cmd\n        return builder\n}\n</code></pre>\n\n<p>But this approach is very ad-hoc because it is impossible to pass arbitrary values to configure the returned <code>*Builder</code>. A more robust approach is to pass a <code>config</code> instance of <code>*Builder</code>:</p>\n\n<pre><code>func TempNewBuilder(configBuilder *Builder) *Builder {\n     builder := new(Builder)\n     builder.Manager = configBuilder.Manager\n     builder.Cmd = configBuilder.Cmd\n     // ...\n     return builder    \n}\n</code></pre>\n\n<p>By using <code>wrapBuilder</code> function, you can write a function to handle (re)assigning of values of an instance:</p>\n\n<pre><code>func TempNewBuilder(builder *Builder, configBuilderFn func(*Builder)) *Builder {\n     configBuilderFn(builder)\n}\n</code></pre>\n\n<p>Now you can pass in any function for <code>configBuilderFn</code> to configure your <code>*Builder</code> instance.</p>\n\n<p>To read more, see <a href=\"https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis\" rel=\"nofollow noreferrer\">https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis</a>.</p>\n\n<p><strong>configs array</strong></p>\n\n<p><code>configs</code> array goes hand-in-hand with the enum of <code>Manager</code> constants. Take a look at <code>New</code> factory function. the enum constant <code>manager</code> passed in pass the parameter is type <code>Manager</code> which is just an <code>int</code> underneath. This means all we had to do is access <code>configs</code> using the <code>manager</code> as the index in <code>wrapBuilder</code>:</p>\n\n<pre><code>wrapBuilder(builder, configs[int(manager)])\n</code></pre>\n\n<p>For instance, if <code>manager == Npm</code>,<code>configs[int(manager)]</code> will return <code>NodeConfig</code> from <code>configs</code> array.</p>\n\n<p><strong>Structuring package(s)</strong></p>\n\n<p>At this point, it is fine to have <code>zip</code> and <code>copy</code> functions to live in the same package as <code>Build</code> the way I did. There's little use in prematurely optimizing anything or worry about that until you have to. That will only introduce more complexity than you'd want. Optimization comes consistently as you develop the code.</p>\n\n<p>If you feel like structuring the project early is important, you can do it based on the semantic of your API. For instance, to create a new <code>*Builder</code>, it is quite intuitive for the user to call a factory function <code>New</code> or <code>Create</code> from a subpackage <code>buildeasy/builder</code>:</p>\n\n<pre><code>// This is a user using your `buildeasy` package\n\nimport (\n        \"github.com/yourname/buildeasy\"\n        \"github.com/yourname/buildeasy/node\"\n        \"github.com/yourname/buildeasy/python\"\n)\n\nvar targetDir = \"path/to/temp\"\n\nfunc main() {\n        myNodeBuilder := node.New()   \n        myNodeBuilder.Build(targetDir)\n        myPythonBuilder := python.New()\n        myPythonBuilder.Install(\"tensorflow\")   \n}\n</code></pre>\n\n<p>Another more verbose approach is to include the semantic as part of the function's name, which is also used in Go's standard packages:</p>\n\n<pre><code>myNodeBuilder := buildeasy.NewNodeBuilder()\nmyPythonBuilder := buildeasy.NewPipBuilder()\n\n// or \nmySecondNodeBuilder := buildeasy.New(buildeasy.Yarn)\n</code></pre>\n\n<p>In Go's standard packages, verbose functions and methods are common. That's because it normally structure sub-packages (subdirectories) for more specific utilities such as <a href=\"https://golang.org/pkg/path/#pkg-subdirectories\" rel=\"nofollow noreferrer\">path/filepath</a>, which contains utility functions related to file path manipulation while keeping <code>path</code>'s API basic and clean.</p>\n\n<p>Coming back to your project, I would keep most common, more generic functions at the top level directory/package. This is how I would tackle the structure:</p>\n\n<pre><code>buildeasy\n\u251c\u2500\u2500 buildeasy.go\n\u251c\u2500\u2500 python\n\u2502   \u2514\u2500\u2500 python.go\n\u2514\u2500\u2500 node/\n    \u2514\u2500\u2500 node.go\n</code></pre>\n\n<p>While package <code>buildeasy</code> contains functions like <code>NewNodeBuilder</code>, <code>NewPipBuilder</code>, or just <code>New</code> that accepts additional options (like the above code), in subpackage <code>buildeasy/node</code>, for instance, can look like this:</p>\n\n<pre><code>package node\n\nimport \"github.com/yourname/buildeasy\"\n\nfunc New() *buildeasy.Builder {\n        return buildeasy.New(buildeasy.Npm)\n}\n\nfunc NewWithYarn() *buildeasy.Builder {\n        return buildeasy.New(buildeasy.Yarn)\n}\n\n// ...\n</code></pre>\n\n<p>or <code>buildeasy/python</code>:</p>\n\n<pre><code>package python\n\nimport \"github.com/yourname/buildeasy\"\n\nfunc New() *buildeasy.Builder {\n        return buildeasy.New(buildeasy.Pip)\n}\n\nfunc NewWithEasyInstall() *buildeasy.Builder {\n        return buildeasy.New(buildeasy.EasyInstall)\n}\n\n// ...\n</code></pre>\n\n<p>Note that in the subpackages you never have to call <code>buildeasy.zipAndCopy</code> because it is a private function that is lower level than the <code>node</code> and <code>python</code> subpackages should care. these subpackages act like another layer of API calling <code>buildeasy</code>'s functions and passing in some specific values and configurations that make life easier for the user of its API.</p>\n\n<p>Hope this makes sense.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516293677, "post_id": 48326072, "comment_id": 83637873, "body": "Thanks for elaborating 1+  i&#39;ll test this and let you know"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516304703, "post_id": 48326072, "comment_id": 83643981, "body": "Thanks I&#39;ll like your idea, something that I missing here is how I combine the all process with the specific java / node builds , lets say i&#39;ve two builds language how the flow will be, code example will be very helpful, thanks!"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516319421, "post_id": 48326072, "comment_id": 83649989, "body": "@RaynD I have added what I think you are looking for. If it is not, please explain a bit more."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516373986, "post_id": 48326072, "comment_id": 83673255, "body": "Thanks! I&#39;ve tried to play with the code and there is some issue&#39;s , is there a way to make it work simple (with some mocks) that I will be able to debug and understand it better , I&#39;ve tried with <a href=\"https://play.golang.org/p/dAfOTQFRjTG\" rel=\"nofollow noreferrer\">play.golang.org/p/dAfOTQFRjTG</a> and there is some error.last thing , if you need to create the project on GitHUB how would you structure it ? which package you put each file ? (drawing the structure is sufficient  ) . many thanks!"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516375278, "post_id": 48326072, "comment_id": 83674133, "body": "@RaynD Sure there is error, as the code is not fully implented. <code>copyDir</code> is missing and so on. And I have edited the sturcture into the answer. Please note that much is much more causal."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516535812, "post_id": 48326072, "comment_id": 83719542, "body": "Can you please provide some working version , I mean with some mock to all the logic (return true / nil etc) , when I try to run it I got lot of errors which I cannot test the flow with. I just want to test the flow to see how it works e.g. the main just with one  option remove others , just some boilerplate that I can test ...Thank you!"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516536936, "post_id": 48326072, "comment_id": 83719833, "body": "@RaynD I am being sick and busy and the moment, but I will try to write one when I feel less dizzy."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516537226, "post_id": 48326072, "comment_id": 83719915, "body": "ohh, hopefully you feel good soon. have a nice day :). looking forward ....thanks a lot"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516553954, "post_id": 48326072, "comment_id": 83725278, "body": "@RaynD It turns out I am too dissy to decide design on the project I am working on so I write this: <a href=\"https://bitbucket.org/snippets/leafbebop/re7yy5\" rel=\"nofollow noreferrer\">bitbucket.org/snippets/leafbebop/re7yy5</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516567648, "post_id": 48326072, "comment_id": 83729977, "body": "The func ` TargetDirForNodeBuilder` is not part of the interface , if I put all the builders in the same package this is problem, isnt it ? can you update the bit bucket how this function should implemented  with additional builder and how it should call from the main ? (just copy past the node with minor changes to if you can) thank you"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516681613, "post_id": 48326072, "comment_id": 83775979, "body": "@RaynD this function is just a mock or a placeholder.  This is some code I don&#39;t think I can write for you. It very much depends on how you are going to use the package, and what &quot;target dir&quot; means to the package. It might be something the user inputs, or maybe something in a config file, or maybe a hardcoded dir, for that I don&#39;t know."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516681700, "post_id": 48326072, "comment_id": 83776017, "body": "@RaynD Indeed it is not part of the the interface. it is more of how you implent the ui logic. And I don&#39;t think put all the builders in a package would raise any problem. It is not that re-usable, after all."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516866285, "post_id": 48326072, "comment_id": 83866781, "body": "Thanks a lot, it will be great if you can add to your example another builder(mock) and lets say i&#39;ve 10 builder how do you handle it on the main, I mean 5 builders of node (as you write ) and 5 builder of any other language you choose how do you handle it on the main ( im talking about the loop on list of builders etc) , it will be great if you can add it. thanks!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1516912190, "post_id": 48326072, "comment_id": 83895678, "body": "I&#39;ve accepted your answer, it will be great if you can response to my previous question... thanks!"}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 4, "last_activity_date": 1516375227, "last_edit_date": 1516375227, "creation_date": 1516293160, "answer_id": 48326072, "question_id": 48264882, "link": "https://stackoverflow.com/questions/48264882/using-inheritance-of-builders-in-go/48326072#48326072", "title": "Using inheritance of builders in GO", "body": "<p>The first principle of <strong>SOLID</strong> says that a piece of code should have only one responsibility.</p>\n\n<p>Takes the context in, it really makes no sense that any <code>builder</code> to care about the <code>copy</code> and <code>zip</code> part of the build process. It's beyond <code>builder</code>'s responsibility. Even using composition (embedding) is not neat enough.</p>\n\n<p>Narrow it down, the <code>Builder</code>'s core responsibility is to build the code, as the name suggests. But more specifically, the <code>Builder</code>'s responsibility is to build the code at a path. What path? The most idomatic way is the <strong>current path</strong>, the <strong>working dir</strong>. This adds two side methods to the interface: <code>Path() string</code> which returns the <strong>current path</strong> and <code>ChangePath(newPath string) error</code> to change the <strong>current path</strong>. The implentation would be simple, preserve a single string field as the current path would mostly do the job. And it can easily be extended to some remote process. </p>\n\n<p>If we looks it carefully, there auctually is two <em>build</em> concepts. One is the whole building <strong>process</strong>, from making temp dir to copy it back, all five steps; the other is the build <strong>command</strong>, which is the third step of the process.</p>\n\n<p>That is very inspiring. A process is idomatic to be presented as a function, as classic procedural programing would do. So we write a <code>Build</code> function. It serialize all the 5 steps, plain and simple.</p>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n)\n\n//A builder is what used to build the language. It should be able to change working dir.\ntype Builder interface {\n    Build() error //Build builds the code at current dir. It returns an error if failed.\n    Path() string //Path returns the current working dir.\n    ChangePath(newPath string) error //ChangePath changes the working dir to newPath.\n}\n\n//TempDirFunc is what generates a new temp dir. Golang woould requires it in GOPATH, so make it changable.\ntype TempDirFunc func() string\n\nvar DefualtTempDirFunc = func() string {\n    name,_ := ioutil.TempDir(\"\",\"BUILD\")\n    return name\n}\n\n//Build builds a language. It copies the code to a temp dir generated by mkTempdir\n//and call the Builder.ChangePath to change the working dir to the temp dir. After\n//the copy, it use the Builder to build the code, and then zip it in the tempfile,\n//copying the zip file to `toPath`.\nfunc Build(b Builder, toPath string, mkTempDir TempDirFunc) error {\n\n    if mkTempDir == nil {\n        mkTempDir = DefaultTempDirFunc\n    }\n\n    path,newPath:=b.Path(),mkTempDir()\n    defer removeDir(newPath) //clean-up\n\n    if err:=copyDir(path,newPath); err!=nil {\n        return err\n    }\n    if err:=b.ChangePath(newPath) !=nil {\n        return err\n    }\n\n    if err:=b.Build(); err!=nil {\n        return err\n    }\n\n    zipName,err:=zipDir(newPath) // I don't understand what is `dep`.\n    if err!=nil { \n        return err\n    }\n\n    zipPath:=filepath.Join(newPath,zipName)\n    if err:=copyFile(zipPath,toPath); err!=nil {\n        return err\n    }\n\n\n    return nil\n}\n\n//zipDir zips the `path` dir and returns the name of zip. If an error occured, it returns an empty string and an error.\nfunc zipDir(path string) (string,error) {}\n\n//All other funcs is very trivial.\n</code></pre>\n\n<p>Most of things are covered in the comments and I am really felling lazy to write all those <code>copyDir</code>/<code>removeDir</code> things. One thing that is not mentioned in the design part is the <code>mkTempDir</code> func. Golang would be unhappy if the code is in <code>/tmp/xxx/</code> as it is outside the <code>GOPATH</code>, and it would make more trouble to change <code>GOPATH</code> as it will break import path serching, so golang would require a unique function to generate a tempdir inside the <code>GOPATH</code>.</p>\n\n<p>Edit:</p>\n\n<p>Oh, one more thing I forgot to say. It is terribly ugly and irresponsible to handle errors like this. But the idea is there, and more decent error handling mostly requires the usage contents. So do change it yourself, log it, panic or whatever you want. </p>\n\n<p>Edit 2:</p>\n\n<p>You can re-use your npm example as following.</p>\n\n<pre><code>type Node struct {\n    path string\n}\n\nfunc (n Node) Build(path string) error {\n    //e.g. Run npm install which build's nodejs project\n    command := exec.Command(\"npm\", \"install\")\n    command.Dir = n.path\n    Combined, err := command.CombinedOutput()\n    if err != nil {\n        log.Println(err)\n    }\n    log.Printf(\"%s\", Combined)\n    return nil\n}\n\nfunc (n *Node) ChangePath(newPath string) error {\n    n.path = newPath\n}\n\nfunc (n Node) Path() string {\n    return n.path\n}\n</code></pre>\n\n<p>And to combine it with other language all together:</p>\n\n<pre><code>func main() {\n    path := GetPathFromInput()\n    switch GetLanguageName(path) {\n    case \"Java\":\n        Build(&amp;Java{path},targetDirForJava(),nil)\n    case \"Go\":\n        Build(&amp;Golang{path,cgoOptions},targetDirForGo(),GoPathTempDir()) //You can disable cgo compile or something like that.\n    case \"Node\":\n        Build(&amp;Node{path},targetDirForNode(),nil)\n    }\n}\n</code></pre>\n\n<p>One trick is get language name. <code>GetLanguageName</code> should return the name of the language the code in <code>path</code> is using. This can be done by using <code>ioutil.ReadDir</code> to detect filenames.</p>\n\n<p>Also note that although I made the <code>Node</code> struct very simple and only stores a <code>path</code> field, you can extend it easily. Like in <code>Golang</code> part, you might add build options there.</p>\n\n<p>Edit 3:</p>\n\n<p>About package structure:</p>\n\n<p>First of all, I think literally everything: the <code>Build</code> function, language builders and other util/helpers should be put into a single package. They all work for a single task: build a language. There is no need and hardly any expectation to isolate any piece of code as another (sub)package.</p>\n\n<p>So that means one dir. The remaining is really some very personal style but I will share mine:</p>\n\n<p>I would put the function <code>Build</code> and interface <code>Builder</code> into a file called <code>main.go</code>. If the front-end code is minimal and very readable, I would put them into <code>main.go</code> as well, but if it is long and have some ui-logic, I would put it into a <code>front-end.go</code> or <code>cli.go</code> or <code>ui.go</code>, depending on the auctual code.</p>\n\n<p>Next, for each language, I would create a <code>.go</code> file with the language code. It makes clear where I can check them. Alternatively, if the code is really tiny, it is not a bad idea to put them all together into a <code>builders.go</code>. After all, mordern editors can be more than capable to get definitaion of structs and types.</p>\n\n<p>Finally, all the <code>copyDir</code>, <code>zipDir</code> functions goes to a <code>util.go</code>. That is simple - they are utilities, most time we just don't want to bother them.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 968, "favorite_count": 5, "accepted_answer_id": 48326072, "answer_count": 3, "score": 7, "last_activity_date": 1516646753, "creation_date": 1516026030, "last_edit_date": 1516282724, "question_id": 48264882, "link": "https://stackoverflow.com/questions/48264882/using-inheritance-of-builders-in-go", "title": "Using inheritance of builders in GO", "body": "<p>I need to create builder (base) and specific builders for each build type.</p>\n\n<pre><code>e.g.\n\nbuilder for html project\nbuilder for node.js project\nbuilder for python project\nbuilder for java project\n</code></pre>\n\n<p>\u2026.</p>\n\n<p>The main functionality will be like following:</p>\n\n<p><strong>File:Builder.go</strong></p>\n\n<p>interface</p>\n\n<pre><code>type Builder interface {\n    Build(string) error\n}\n</code></pre>\n\n<p><strong>File: nodebuilder.go</strong></p>\n\n<pre><code>//This is the struct ???? not sure what to put here...\ntype Node struct {\n\n\n}\n\n\nfunc (n Node) Build(path string) error {\n\n//e.g. Run npm install which build's nodejs projects\n\n        command := exec.Command(\"npm\", \"install\")\n        command.Dir = \u201c../path2dir/\u201c\n\n        Combined, err := command.CombinedOutput()\n\n        if err != nil {\n            log.Println(err)\n        }\n        log.Printf(\"%s\", Combined)\n    }\n\n    ...\n    //return new(error)\n}\n</code></pre>\n\n<p><strong>Main assumptions/process:</strong></p>\n\n<ol>\n<li>To start build on each module I need to get the path to it</li>\n<li>I need to copy the module to a temp folder</li>\n<li>I need to run the build on it (implement the build interface like <code>mvn build</code> <code>npm install</code> etc) </li>\n<li>After build was finished zip the module with dep</li>\n<li>Copy it to new target folder</li>\n</ol>\n\n<p>Note: beside from the <code>build</code> and the <code>path</code> (that should be handled specifically ) all other functionality are identical<br>\n<strong>like</strong> <code>zip</code> <code>copy</code> </p>\n\n<blockquote>\n  <ol>\n  <li><p>Where should I put the the <code>zip and copy</code> (in the structure) and for example how should I implement them and path them to the builder ?</p></li>\n  <li><p>Should I structure the project differently according the assumptions?</p></li>\n  </ol>\n</blockquote>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 7, "creation_date": 1516024497, "post_id": 48264416, "comment_id": 83511606, "body": "<code>a[0]</code> is a <code>string</code>, <code>a[0][0]</code> is the first byte of this <code>string</code>, which is a <code>byte</code>, a value of type <code>uint8</code>, and its value is <code>97</code> (which is the code for character <code>a</code>) which you see printed."}, {"owner": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "edited": false, "score": 0, "creation_date": 1516024902, "post_id": 48264416, "comment_id": 83511819, "body": "<code>a</code> is an array of three strings that each happen to only be one character long.  <code>a[0]</code> is the string <code>&quot;a&quot;</code>. So <code>a[0][0]</code> is the first character of that string which has ASCII value 97."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1516121935, "post_id": 48266700, "comment_id": 83557057, "body": "Go has both arrays and slices. Array are fixed in length. [3]string is an array type."}, {"owner": {"reputation": 417, "user_id": 3049386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/754afefdb87c446066459a9857d9a0cf?s=128&d=identicon&r=PG&f=1", "display_name": "Bestbug", "link": "https://stackoverflow.com/users/3049386/bestbug"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1516218341, "post_id": 48266700, "comment_id": 83603136, "body": "Yeah but an explicit usage of array is discurage in Golang since the &quot;slice&quot; are more flexible. But I get it what you are say, I&#39;ll fix the question"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516218795, "post_id": 48266700, "comment_id": 83603382, "body": "Go doesn&#39;t discourage arrays, they are used all the time <i>when they are appropriate</i> (the article you linked says nothing about discouraging usage of arrays, just that they are less common)"}, {"owner": {"reputation": 417, "user_id": 3049386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/754afefdb87c446066459a9857d9a0cf?s=128&d=identicon&r=PG&f=1", "display_name": "Bestbug", "link": "https://stackoverflow.com/users/3049386/bestbug"}, "edited": false, "score": 0, "creation_date": 1516219009, "post_id": 48266700, "comment_id": 83603521, "body": "Uhm if you say so maybe I was wrong to understand what the point of the sentence since IMHO if you try to avoid the usage of array there is a reason for that, or am I wrong?"}], "tags": [], "owner": {"reputation": 417, "user_id": 3049386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/754afefdb87c446066459a9857d9a0cf?s=128&d=identicon&r=PG&f=1", "display_name": "Bestbug", "link": "https://stackoverflow.com/users/3049386/bestbug"}, "is_accepted": false, "score": -1, "last_activity_date": 1516218481, "last_edit_date": 1516218481, "creation_date": 1516032545, "answer_id": 48266700, "question_id": 48264416, "link": "https://stackoverflow.com/questions/48264416/golang-could-not-understand-how-below-code-is-executing/48266700#48266700", "title": "Golang: Could not understand how below code is executing", "body": "<p>You are misunderstanding how to access to a string in a slice (Golang discurage the use of <a href=\"http://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">array</a>). If you are interesting to print a single value inside the slice you should do</p>\n\n<pre><code>fmt.Println(a[0]) --&gt; print a\nfmt.Println(a[1]) --&gt; print b\nfmt.Println(a[2]) --&gt; print c\n</code></pre>\n\n<p>What you are doing in your code is to access to the first element of the string (so you are accessing to the byte of the string which is in that case 97 the 'a' value). </p>\n"}, {"tags": [], "owner": {"reputation": 306, "user_id": 2536252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e29959d1027ff89ba83767e9d9517a?s=128&d=identicon&r=PG", "display_name": "Adriel Artiza", "link": "https://stackoverflow.com/users/2536252/adriel-artiza"}, "is_accepted": true, "score": 0, "last_activity_date": 1516160601, "creation_date": 1516160601, "answer_id": 48293250, "question_id": 48264416, "link": "https://stackoverflow.com/questions/48264416/golang-could-not-understand-how-below-code-is-executing/48293250#48293250", "title": "Golang: Could not understand how below code is executing", "body": "<p>Below is the example of code on how it print ascii</p>\n\n<pre><code>a := [3]string{\"a\",\"b\",\"c\"} \n\nfor _, rune := range a {\n   fmt.Println(rune)// It will print a,b,c\n}\n</code></pre>\n\n<p>since you used a[0][0] in your code it is equivalent </p>\n\n<pre><code>for _, rune := range a {\n   fmt.Println(rune[0])// It will print 97,98,99\n   // rune is equal to x := 'a'\n   // when you write it like x := 'a' and\n   // fmt.Println(x) the output is 97\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 9219717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82daac8cc71a639431bf930b550e2e3a?s=128&d=identicon&r=PG&f=1", "display_name": "parul setia", "link": "https://stackoverflow.com/users/9219717/parul-setia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 48293250, "answer_count": 2, "score": -5, "last_activity_date": 1516234557, "creation_date": 1516024434, "last_edit_date": 1516234557, "question_id": 48264416, "link": "https://stackoverflow.com/questions/48264416/golang-could-not-understand-how-below-code-is-executing", "title": "Golang: Could not understand how below code is executing", "body": "<p>Below is the code I have a query upon:\nI have a single dimentional array a\nI could not understand when i printing <code>a[0][0]</code> then why it is returning ascii value of the character <code>a</code>:</p>\n\n<pre><code>package main\nimport (\n        \"fmt\"\n)\n\nfunc main() {\n\n        a := [3]string{\"a\",\"b\",\"c\"} \n\n        fmt.Println(a[0][0])\n }\n</code></pre>\n\n<p>Output: <strong>97</strong></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1516020677, "creation_date": 1516020677, "answer_id": 48263409, "question_id": 48263281, "link": "https://stackoverflow.com/questions/48263281/how-to-find-sshd-service-status-in-golang/48263409#48263409", "title": "how to find sshd service status in golang", "body": "<p>You're exiting if <code>exec.Command</code> returns an error, but you're not checking the type of error returned.\nPer the <a href=\"https://golang.org/pkg/os/exec/#Cmd.Run\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>If the command starts but does not complete successfully, the error is\n  of type *ExitError. Other error types may be returned for other\n  situations.</p>\n</blockquote>\n\n<p>Rather than just exiting, you should check if the error corresponds to a non-zero exit code from <code>systemctl</code> or a problem running it. This can be done with the following:</p>\n\n<pre><code>func main() {\n  cmd := exec.Command(\"systemctl\", \"check\", \"sshd\")\n  out, err := cmd.CombinedOutput()\n  if err != nil {\n    if exitErr, ok := err.(*exec.ExitError); ok {\n      fmt.Printf(\"systemctl finished with non-zero: %v\\n\", exitErr)\n    } else {\n      fmt.Printf(\"failed to run systemctl: %v\", err)\n      os.Exit(1)\n    }\n  }\n  fmt.Printf(\"Status is: %s\\n\", string(out))\n}\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 7861404, "user_type": "registered", "profile_image": "https://graph.facebook.com/824338891037418/picture?type=large", "display_name": "Adrian Cincu", "link": "https://stackoverflow.com/users/7861404/adrian-cincu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1698, "favorite_count": 1, "accepted_answer_id": 48263409, "answer_count": 1, "score": 1, "last_activity_date": 1516023218, "creation_date": 1516020151, "question_id": 48263281, "link": "https://stackoverflow.com/questions/48263281/how-to-find-sshd-service-status-in-golang", "title": "how to find sshd service status in golang", "body": "<p>i have the following code</p>\n\n<pre><code>package main\n\nimport (\n    \"os/exec\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"systemctl\", \"check\", \"sshd\")\n    out, err := cmd.CombinedOutput()\n    if err != nil {\n        fmt.Println(\"Cannot find process\")\n        os.Exit(1)\n    }\n    fmt.Printf(\"Status is: %s\", string(out))\n    fmt.Println(\"Starting Role\")\n</code></pre>\n\n<p>If the service is down, program will exit, althrough i would like to get its status ( 'down' , 'inactive', etc)</p>\n\n<p>If the service is up, program will not exit and will print ' active ' output</p>\n\n<p>Any hints, please ?</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 13228, "user_id": 742082, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0741ba088846ead70c26c6a70d4d783d?s=128&d=identicon&r=PG", "display_name": "Sheena", "link": "https://stackoverflow.com/users/742082/sheena"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516021373, "post_id": 48262519, "comment_id": 83509929, "body": "@Marc: this isn&#39;t a duplicate. I&#39;m asking about assignment specifically. Look at the line with all the &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; on it"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1516022943, "post_id": 48262519, "comment_id": 83510770, "body": "Fair enough, but @icza found one: <a href=\"https://stackoverflow.com/questions/40164896/capture-or-assign-golang-template-output-to-variable/40170999#40170999\" title=\"capture or assign golang template output to variable\">stackoverflow.com/questions/40164896/&hellip;</a>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1516023793, "post_id": 48262519, "comment_id": 83511218, "body": "why not simply call T1 from T2 ? see <code>template</code> action <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template</a>"}, {"owner": {"reputation": 13228, "user_id": 742082, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0741ba088846ead70c26c6a70d4d783d?s=128&d=identicon&r=PG", "display_name": "Sheena", "link": "https://stackoverflow.com/users/742082/sheena"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1516028685, "post_id": 48262519, "comment_id": 83514002, "body": "@mh-cbon: there are a multitude of reasons for wanting to store a result in memory before printing it out. Personally I need to pass it to some regex functions that just wont work out with pipes."}, {"owner": {"reputation": 13228, "user_id": 742082, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0741ba088846ead70c26c6a70d4d783d?s=128&d=identicon&r=PG", "display_name": "Sheena", "link": "https://stackoverflow.com/users/742082/sheena"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516028817, "post_id": 48262519, "comment_id": 83514103, "body": "@Marc: cool beans. Please feel free to mark it as a duplicate. I like to keep duplicates around because it makes finding things easier. Thanks for the input"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1516020518, "last_edit_date": 1516020518, "creation_date": 1516020118, "answer_id": 48263273, "question_id": 48262519, "link": "https://stackoverflow.com/questions/48262519/get-the-value-of-a-go-template-from-inside-another-template/48263273#48263273", "title": "get the value of a go template from inside another template", "body": "<p>There is no builtin support for storing the result of a template in a template variable, only for the inclusion of the result.</p>\n\n<p>But you can register custom functions with any complex functionality you want. You may register a <code>GetOutput</code> function which would execute a template identified by its name, and it could return the result as a <code>string</code>, which you can store in a template variable.</p>\n\n<p>Example doing this:</p>\n\n<pre><code>func main() {\n    t := template.New(\"\")\n\n    t = template.Must(t.Funcs(template.FuncMap{\n        \"GetOutput\": func(name string) (string, error) {\n            buf := &amp;bytes.Buffer{}\n            err := t.ExecuteTemplate(buf, name, nil)\n            return buf.String(), err\n        },\n    }).Parse(src))\n\n    if err := t.ExecuteTemplate(os.Stdout, \"T2\", nil); err != nil {\n        panic(err)\n    }\n}\n\nconst src = `\n{{define \"T1\"}}{{ printf \"%s-%s\" \"complex\" \"stuff\" }}{{end}}\n{{define \"T2\"}}\n    {{ $t1Out := (GetOutput \"T1\")}}\n    {{ printf \"%s-%s\" \"even-more\" $t1Out }}\n{{end}}`\n</code></pre>\n\n<p>Output will be (try it on the <a href=\"https://play.golang.org/p/TXIwXMEj6Rw\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>    even-more-complex-stuff\n</code></pre>\n\n<p>The <code>\"T1\"</code> template simply outputs <code>\"complex-stuff\"</code>, and the <code>\"T2\"</code> template gets the output of <code>\"T1\"</code>, and concatenates the static text <code>\"even-more-\"</code> and the result of <code>\"T1\"</code>.</p>\n\n<p>The registered <code>GetOutput</code> function gets the name of a template to execute, executes it by directing its output to a local buffer, and returns the content of the buffer (along with the optional error of its execution).</p>\n\n<p><strong>Edit:</strong> I've found an exact duplicate: <a href=\"https://stackoverflow.com/questions/40164896/capture-or-assign-golang-template-output-to-variable/40170999#40170999\">Capture or assign golang template output to variable</a></p>\n"}], "owner": {"reputation": 13228, "user_id": 742082, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0741ba088846ead70c26c6a70d4d783d?s=128&d=identicon&r=PG", "display_name": "Sheena", "link": "https://stackoverflow.com/users/742082/sheena"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1246, "favorite_count": 0, "closed_date": 1516028779, "accepted_answer_id": 48263273, "answer_count": 1, "score": 0, "last_activity_date": 1516020518, "creation_date": 1516017355, "question_id": 48262519, "link": "https://stackoverflow.com/questions/48262519/get-the-value-of-a-go-template-from-inside-another-template", "closed_reason": "Duplicate", "title": "get the value of a go template from inside another template", "body": "<p>I have two templates T1 and T2. I want to get the output of T1 and do a some extra processing on it inside T2. My question is:</p>\n\n<p>how do I store the output of T1 in a variable inside T2? Is this even possible?</p>\n\n<p>Here's some pseudo-template:</p>\n\n<pre><code>{{define \"T1\"}}\n    {{ printf \"%s-%s\" complex stuff }}\n{{end}}\n{{define \"T2\"}}\n    {{ $some_var := output_from_template \"T1\"}}  &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;\n    {{ etc }}\n{{end}}\n</code></pre>\n"}, {"tags": ["go", "amazon-s3", "file-upload"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516017132, "post_id": 48262416, "comment_id": 83507667, "body": "Your <code>bytePolicy</code> is created using a <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">string literal</a>, Go doesn&#39;t expand variables inside. Instead, Go has both text and html templates. The docs for the former have <a href=\"https://golang.org/pkg/text/template/#example_Template\" rel=\"nofollow noreferrer\">an example</a> that looks exactly like what you need."}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 0, "last_activity_date": 1516019655, "last_edit_date": 1516019655, "creation_date": 1516019046, "answer_id": 48262983, "question_id": 48262416, "link": "https://stackoverflow.com/questions/48262416/creating-a-post-policy-and-signing-it-for-browser-based-uploads-to-amazon-s3-in/48262983#48262983", "title": "Creating a POST policy and signing it for Browser based uploads to Amazon S3 in golang", "body": "<p>You have at least two options: generate a string using <code>fmt.Sprintf</code>, or use templates.</p>\n\n<p>Formatting your own string with <a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"nofollow noreferrer\">fmt.Sprintf</a> is probably the fastest: <a href=\"https://play.golang.org/p/BbfCejRIiwA\" rel=\"nofollow noreferrer\">playground</a></p>\n\n<pre><code>// The variables to set the contents to.\nkey := \"mykey\"\ncontentType := \"text/plain\"\n\n// The \"template\". Use the proper % modifiers based on your variable types.\ntemplateString := `{ \n                    \"expiration\": \"2013-08-06T12:00:00.000Z\",\n                    \"conditions\": [\n                            {\"bucket\": \"examplebucket\"},\n                            [\"starts-with\", \"%s\", \"user/user1/\"],\n                            {\"acl\": \"public-read\"},\n                            {\"success_action_redirect\": \"http://acl6.s3.amazonaws.com/successful_upload.html\"},\n                            [\"starts-with\", \"%s\", \"image/\"],\n                            // etc...\n                      ]\n                }`\n\n// Format the string.\nfilledTemplate := fmt.Sprintf(templateString, key, contentType)\nfmt.Println(filledTemplate)\n\n// Make a byte slice.\nbytePolicy := []byte(filledTemplate)\nfmt.Println(base64.StdEncoding.EncodeToString(bytePolicy))\n</code></pre>\n\n<p>The other, probably cleaner way is to use <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">text/template</a>: <a href=\"https://play.golang.org/p/VvxoZi14Eng\" rel=\"nofollow noreferrer\">playground</a></p>\n\n<pre><code>templateString := `{ \n                    \"expiration\": \"2013-08-06T12:00:00.000Z\",\n                    \"conditions\": [\n                            {\"bucket\": \"examplebucket\"},\n                            [\"starts-with\", \"{{- .Key -}}\", \"user/user1/\"],\n                            {\"acl\": \"public-read\"},\n                            {\"success_action_redirect\": \"http://acl6.s3.amazonaws.com/successful_upload.html\"},\n                            [\"starts-with\", \"{{- .ContentType -}}\", \"image/\"],\n                            // Etc...\n                      ]\n                }`\n\ntype TemplateInfo struct {\n    Key, ContentType string\n}\n\nmyInfo := TemplateInfo{\n    Key:         \"mykey\",\n    ContentType: \"text/plain\",\n}\n\nt := template.Must(template.New(\"awsfields\").Parse(templateString))\n\nvar out bytes.Buffer\nif err := t.Execute(&amp;out, myInfo); err != nil {\n    panic(err)\n}\nfmt.Println(out.String())\nfmt.Println(base64.StdEncoding.EncodeToString(out.Bytes()))\n</code></pre>\n"}], "owner": {"reputation": 174, "user_id": 5324750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6d1f2ff3eac6208f7ed2e98c1f17bac?s=128&d=identicon&r=PG&f=1", "display_name": "Prashanth Hegde", "link": "https://stackoverflow.com/users/5324750/prashanth-hegde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 209, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1516019655, "creation_date": 1516016973, "question_id": 48262416, "link": "https://stackoverflow.com/questions/48262416/creating-a-post-policy-and-signing-it-for-browser-based-uploads-to-amazon-s3-in", "title": "Creating a POST policy and signing it for Browser based uploads to Amazon S3 in golang", "body": "<p>I am trying to implement browser based upload to amazon S3 from my client side(AngularJS), after some research i came to know that i have to create a policy and sign for POST request of S3.\nBy referring to  <a href=\"http://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-post-example.html\" rel=\"nofollow noreferrer\">http://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-post-example.html</a>, i tried <a href=\"http://play.golang.org/p/3zn5fSDasK\" rel=\"nofollow noreferrer\">http://play.golang.org/p/3zn5fSDasK</a></p>\n\n<pre><code>package main\n  import \"fmt\"\n  import \"encoding/base64\"\n\n  func main() {\n     bytePolicy := []byte(`{ \n                \"expiration\": \"2013-08-06T12:00:00.000Z\",\n                \"conditions\": [\n                         {\"bucket\": \"examplebucket\"},\n                         [\"starts-with\", \"$key\", \"user/user1/\"],\n                         {\"acl\": \"public-read\"},\n                         {\"success_action_redirect\": \"http://acl6.s3.amazonaws.com/successful_upload.html\"},\n                         [\"starts-with\", \"$Content-Type\", \"image/\"],\n                         {\"x-amz-meta-uuid\": \"14365123651274\"},\n                         [\"starts-with\", \"$x-amz-meta-tag\", \"\"],\n                         {\"x-amz-credential\":\"AKIAIOSFODNN7EXAMPLE/20130806/us-east-1/s3/aws4_request\"},\n                         {\"x-amz-algorithm\": \"AWS4-HMAC-SHA256\"},\n                         {\"x-amz-date\": \"20130806T000000Z\" }\n                  ]\n              }`)\n        fmt.Println(base64.StdEncoding.EncodeToString(bytePolicy))\n }\n</code></pre>\n\n<p>and i got the base64 encrypted value also.\nSince the bytepolicy is a type of byte and accepting string as value the policy is hard coded. How can i change the values dynamically as like Javascript's template literals?? (<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals\" rel=\"nofollow noreferrer\">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals</a>) or is there any other way i can create signed policy?</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 2, "creation_date": 1516012405, "post_id": 48261095, "comment_id": 83504983, "body": "You can embed existing structs into your own struct types: <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Struct_types</a>"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516012423, "post_id": 48261095, "comment_id": 83504995, "body": "Please include a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a>. You should show all (or most) of the information needed in the question itself, not in the form of links. It&#39;s also not clear what want to do. You should try embedding the struct in your own type though."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1516013810, "post_id": 48261095, "comment_id": 83505783, "body": "You cannot &quot;extend&quot; a concrete type and then expect your extension to be &quot;passable&quot; to a function that expects the original."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516018169, "post_id": 48261095, "comment_id": 83508237, "body": "The answer below seemed answered the edited question. Is there anything wrong?"}, {"owner": {"reputation": 333, "user_id": 3284058, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/EOGCi.jpg?s=128&g=1", "display_name": "JAttanonRadar", "link": "https://stackoverflow.com/users/3284058/jattanonradar"}, "edited": false, "score": 0, "creation_date": 1516018260, "post_id": 48261095, "comment_id": 83508299, "body": "I edited question and add examples of code."}, {"owner": {"reputation": 333, "user_id": 3284058, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/EOGCi.jpg?s=128&g=1", "display_name": "JAttanonRadar", "link": "https://stackoverflow.com/users/3284058/jattanonradar"}, "edited": false, "score": 0, "creation_date": 1516018297, "post_id": 48261095, "comment_id": 83508319, "body": "I can extend struct like this, but I cannot pass it into function in example above, is it even possible in go to do that?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516018629, "post_id": 48261095, "comment_id": 83508461, "body": "You can do it using <code>s.SetSlackService(pid,&amp;YourStruct.SetSlackServiceOptions,...&zwnj;&#8203;)</code>. Read <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1516127354, "post_id": 48261095, "comment_id": 83560145, "body": "How would you expect this to work with an extended struct, @JAttanonRadar?  Say you added a field for, say, using SSL for the connection.  How would SetSlackService know about your extended fields?  How would it be able to access them without you changing the code in that function itself?"}, {"owner": {"reputation": 333, "user_id": 3284058, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/EOGCi.jpg?s=128&g=1", "display_name": "JAttanonRadar", "link": "https://stackoverflow.com/users/3284058/jattanonradar"}, "edited": false, "score": 0, "creation_date": 1518031588, "post_id": 48261095, "comment_id": 84341595, "body": "Can you please uncheck the downvote? I asked 1 question over last year and now i cannot ask another.. I improve my question, so please remove it"}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 16, "last_activity_date": 1530869156, "last_edit_date": 1530869156, "creation_date": 1516013324, "answer_id": 48261433, "question_id": 48261095, "link": "https://stackoverflow.com/questions/48261095/extend-package-struct-in-golang/48261433#48261433", "title": "Extend package struct in golang", "body": "<p>In go, structures cannot be extended like classes as in other object oriented programming languages. Nor we can add any new field in an existing struct. We can create a new struct embedding the struct that we require to use from different package.</p>\n\n<pre><code>package gitlab\n\n// SetSlackServiceOptions struct\ntype SetSlackServiceOptions struct {\n    WebHook  *string `url:\"webhook,omitempty\" json:\"webhook,omitempty\" `\n    Username *string `url:\"username,omitempty\" json:\"username,omitempty\" `\n    Channel  *string `url:\"channel,omitempty\" json:\"channel,omitempty\"`\n}\n</code></pre>\n\n<p>In our main package we have to import <code>gitlab</code> package and embed our struct as below:</p>\n\n<pre><code>package main\n\nimport \"github.com/user/gitlab\"\n\n// extend SetSlackServiceOptions struct in another struct\ntype ExtendedStruct struct {\n  gitlab.SetSlackServiceOptions\n  MoreValues []string\n}\n</code></pre>\n\n<p><a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"noreferrer\">Golang</a> spec define embedded types in struct as:</p>\n\n<blockquote>\n  <p>A field declared with a type but no explicit field name is called an\n  embedded field. An embedded field must be specified as a type name T\n  or as a pointer to a non-interface type name *T, and T itself may not\n  be a pointer type. The unqualified type name acts as the field name.</p>\n</blockquote>\n\n<pre><code>// A struct with four embedded fields of types T1, *T2, P.T3 and *P.T4\nstruct {\n    T1        // field name is T1\n    *T2       // field name is T2\n    P.T3      // field name is T3\n    *P.T4     // field name is T4\n    x, y int  // field names are x and y\n}\n</code></pre>\n"}], "owner": {"reputation": 333, "user_id": 3284058, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/EOGCi.jpg?s=128&g=1", "display_name": "JAttanonRadar", "link": "https://stackoverflow.com/users/3284058/jattanonradar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 23235, "favorite_count": 0, "answer_count": 1, "score": 15, "last_activity_date": 1530869156, "creation_date": 1516012135, "last_edit_date": 1516018220, "question_id": 48261095, "link": "https://stackoverflow.com/questions/48261095/extend-package-struct-in-golang", "title": "Extend package struct in golang", "body": "<p>is it possible in golang extend struct (something like extend a class in other languages, and use it with functions for old one)</p>\n\n<p>I have <a href=\"https://github.com/xanzy/go-gitlab/blob/master/services.go#L287\" rel=\"noreferrer\">https://github.com/xanzy/go-gitlab/blob/master/services.go#L287</a> type SetSlackServiceOptions</p>\n\n<pre><code>package gitlab\n\n// SetSlackServiceOptions struct\ntype SetSlackServiceOptions struct {\n    WebHook  *string `url:\"webhook,omitempty\" json:\"webhook,omitempty\" `\n    Username *string `url:\"username,omitempty\" json:\"username,omitempty\" `\n    Channel  *string `url:\"channel,omitempty\" json:\"channel,omitempty\"`\n}\n</code></pre>\n\n<p>And I want to add some fields to the type in my own package. Is It possible to do it, that I can call function SetSlackService with this my own new type? </p>\n\n<pre><code>package gitlab\n\nfunc (s *ServicesService) SetSlackService(pid interface{}, opt *SetSlackServiceOptions, options ...OptionFunc) (*Response, error) {\n    project, err := parseID(pid)\n    if err != nil {\n        return nil, err\n    }\n    u := fmt.Sprintf(\"projects/%s/services/slack\", url.QueryEscape(project))\n\n    req, err := s.client.NewRequest(\"PUT\", u, opt, options)\n    if err != nil {\n        return nil, err\n    }\n\n    return s.client.Do(req, nil)\n}\n</code></pre>\n\n<p><a href=\"https://github.com/xanzy/go-gitlab/blob/266c87ba209d842f6c190920a55db959e5b13971/services.go#L297\" rel=\"noreferrer\">https://github.com/xanzy/go-gitlab/blob/266c87ba209d842f6c190920a55db959e5b13971/services.go#L297</a></p>\n\n<p>Edit:</p>\n\n<p>I want to pass own structure into function above. It's function from gitlab package and I want to extend the http request</p>\n"}, {"tags": ["go", "godeps"], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "edited": false, "score": 0, "creation_date": 1516009176, "post_id": 48260212, "comment_id": 83503177, "body": "I am having the import on both packages. my vendor folder is directly under github.com folder of my local machine. Will that be a problem ?"}, {"owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "reply_to_user": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "edited": false, "score": 1, "creation_date": 1516009726, "post_id": 48260212, "comment_id": 83503475, "body": "It&#39;s highly suspicious"}, {"owner": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "edited": false, "score": 0, "creation_date": 1516010054, "post_id": 48260212, "comment_id": 83503642, "body": "yes. I have changed the directory structure. Its worked."}, {"owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "reply_to_user": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "edited": false, "score": 0, "creation_date": 1516010096, "post_id": 48260212, "comment_id": 83503672, "body": "You might consider open an issue in dep github. =]"}], "tags": [], "owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "is_accepted": false, "score": 1, "last_activity_date": 1516008919, "creation_date": 1516008919, "answer_id": 48260212, "question_id": 48260010, "link": "https://stackoverflow.com/questions/48260010/dep-ensure-removing-the-install-folders/48260212#48260212", "title": "dep ensure removing the install folders", "body": "<pre><code>\"github.com/julienschmidt/httprouter\" is not imported by your project, and has been temporarily added to Gopkg.lock and vendor/.\nIf you run \"dep ensure\" again before actually importing it, it will disappear from Gopkg.lock and vendor/.\n</code></pre>\n\n<p>If you just run <code>dep ensure -add {package}</code> without importing it in code. It will got remove in the next <code>dep ensure</code></p>\n"}], "owner": {"reputation": 179, "user_id": 8787614, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/aefd1dcd4a21c583289dc468e7d1e516?s=128&d=identicon&r=PG&f=1", "display_name": "R.Roshan", "link": "https://stackoverflow.com/users/8787614/r-roshan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3027, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1516009346, "creation_date": 1516008092, "last_edit_date": 1516009346, "question_id": 48260010, "link": "https://stackoverflow.com/questions/48260010/dep-ensure-removing-the-install-folders", "title": "dep ensure removing the install folders", "body": "<p>I have installed the httprouter package using the following command</p>\n\n<pre><code>dep ensure -add github.com/julienschmidt/httprouter\n\n      vendor\n        \u2514\u2500\u2500 github.com\n            \u251c\u2500\u2500 julienschmidt\n            \u2502   \u2514\u2500\u2500 httprouter\n</code></pre>\n\n<p>Then I have installed the uuid package</p>\n\n<pre><code>dep ensure -add github.com/satori/go.uuid\n  vendor\n        \u2514\u2500\u2500 github.com\n            \u251c\u2500\u2500 satori\n</code></pre>\n\n<p>The julienschmidt router package gone away. Why dep is deleting the previous installation ?</p>\n\n<p>Deleting the entry on Gopkg.lock</p>\n\n<p>Gopkg.toml has this entry</p>\n\n<pre><code>[[constraint]]\n  name = \"github.com/julienschmidt/httprouter\"\n  version = \"1.1.0\"\n\n[[constraint]]\n  name = \"github.com/satori/go.uuid\"\n  version = \"1.2.0\"\n</code></pre>\n\n<p>Will this affect anything ?</p>\n\n<p>My directory structure</p>\n\n<pre><code>gopath/src/github.com\n- services\n  - service-auth\n  - service-signup\n- vendor\n   - github.com\n</code></pre>\n\n<p>Thanks.</p>\n"}, {"tags": ["http", "go", "httprouter"], "comments": [{"owner": {"reputation": 2089, "user_id": 2215977, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/74ee182aad52dce6955941b1ba4170cd?s=128&d=identicon&r=PG", "display_name": "Morty Choi", "link": "https://stackoverflow.com/users/2215977/morty-choi"}, "edited": false, "score": 1, "creation_date": 1516007843, "post_id": 48259630, "comment_id": 83502523, "body": "From this issues <a href=\"https://github.com/julienschmidt/httprouter/issues/73\" rel=\"nofollow noreferrer\">github.com/julienschmidt/httprouter/issues/73</a>, you can&#39;t achieve it easily using  httprouter"}], "answers": [{"comments": [{"owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "edited": false, "score": 0, "creation_date": 1516009991, "post_id": 48260135, "comment_id": 83503612, "body": "Thanks, this works great. I didn&#39;t find the so question you&#39;ve mentioned. So this is a duplicate."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "edited": false, "score": 1, "creation_date": 1516010223, "post_id": 48260135, "comment_id": 83503752, "body": "@microo8 Not a duplicate, as the other question seeks to achieve this using only the standard lib (where this is possible), and you were asking how to do it with <code>julienschmidt&#47;httprouter</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1516008548, "creation_date": 1516008548, "answer_id": 48260135, "question_id": 48259630, "link": "https://stackoverflow.com/questions/48259630/serve-static-content-on-root-and-rest-on-api/48260135#48260135", "title": "Serve static content on root and rest on /api", "body": "<p>As others pointed out, this is not possible using only <code>github.com/julienschmidt/httprouter</code>.</p>\n\n<p>Note that this is possible using the multiplexer of the standard library, as detailed in this answer: <a href=\"https://stackoverflow.com/questions/47493820/how-do-i-serve-both-web-pages-and-api-routes-by-using-same-port-address-and-diff/47494191#47494191\">How do I serve both web pages and API Routes by using same port address and different Handle pattern</a></p>\n\n<p>If you must serve all your web content at the root, another viable solution could be to mix the standard router and <code>julienschmidt/httprouter</code>. Use the standard router to register and serve your files at the root, and use <code>julienschmidt/httprouter</code> to serve your API requests.</p>\n\n<p>This is how it could look like:</p>\n\n<pre><code>router := httprouter.New()\nrouter.GET(\"/api/:param1/:param2\", apiHandler)\n\nmux := http.NewServeMux()\nmux.Handle(\"/\", http.FileServer(http.Dir(\"static\")))\nmux.Handle(\"/api/\", router)\n\nlog.Fatal(http.ListenAndServe(\":8080\", mux))\n</code></pre>\n\n<p>In the example above, all requests that start with <code>/api/</code> will be forwarded to the <code>router</code> handler, and the rest will be attempted to handle by the file server.</p>\n"}], "owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1646, "favorite_count": 1, "accepted_answer_id": 48260135, "answer_count": 1, "score": 2, "last_activity_date": 1516090648, "creation_date": 1516006561, "last_edit_date": 1516090648, "question_id": 48259630, "link": "https://stackoverflow.com/questions/48259630/serve-static-content-on-root-and-rest-on-api", "title": "Serve static content on root and rest on /api", "body": "<p>I'm using <a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow noreferrer\">httprouter</a> for parsing some parameters from the path in api calls:</p>\n\n<pre><code>router := httprouter.New()\nrouter.GET(\"/api/:param1/:param2\", apiHandler)\n</code></pre>\n\n<p>And wanted to add some files to the root (<code>/</code>) to serve. It's just <code>index.html</code>, <code>script.js</code> and <code>style.css</code>. All in a local directory called <code>static</code></p>\n\n<pre><code>router.ServeFiles(\"/*filepath\", http.Dir(\"static\"))\n</code></pre>\n\n<p>So that I can go with the browser to <code>localhost:8080/</code> and it will serve <code>index.html</code> and the <code>js</code> from the browser will call the <code>/api/:param1/:param2</code></p>\n\n<p>But this path conflicts with the <code>/api</code> path.</p>\n\n<p><code>panic: wildcard route '*filepath' conflicts with existing children in path '/*filepath'</code></p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 4, "creation_date": 1515996428, "post_id": 48257658, "comment_id": 83498001, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/33447334/golang-json-marshal-how-to-omit-empty-nested-struct\">golang json marshal: how to omit empty nested struct</a>"}], "answers": [{"comments": [{"owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "edited": false, "score": 0, "creation_date": 1515997543, "post_id": 48257806, "comment_id": 83498292, "body": "Thank you for your advices. How do I input values to &quot;KeyA.Key1&quot; and &quot;KeyA.Key2&quot; for this script?"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "edited": false, "score": 0, "creation_date": 1515997787, "post_id": 48257806, "comment_id": 83498371, "body": "Try <a href=\"https://play.golang.org/p/b5xM6dFsGVS\" rel=\"nofollow noreferrer\">The Go Playground</a>, and <a href=\"https://play.golang.org/p/uIOq5x1gRvd\" rel=\"nofollow noreferrer\">this</a>.  I hope this helps."}, {"owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "edited": false, "score": 1, "creation_date": 1515997927, "post_id": 48257806, "comment_id": 83498409, "body": "Thank you so much. I could understand."}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 1, "last_activity_date": 1515996931, "creation_date": 1515996931, "answer_id": 48257806, "question_id": 48257658, "link": "https://stackoverflow.com/questions/48257658/remove-elements-with-empty-value-when-no-values/48257806#48257806", "title": "Remove elements with empty value when no values", "body": "<p>Try <a href=\"https://play.golang.org/p/3zjm6j-MjAc\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\ntype KeyA struct {\n    Key1 string `json:\"keyA1,omitempty\"`\n    Key2 string `json:\"keyA2,omitempty\"`\n} \ntype sample struct {\n    KeyA *KeyA  `json:\"keyA,omitempty\"`\n    KeyB string `json:\"keyB,omitempty\"`\n}\n\nfunc main() {\n    var s sample\n    response, _ := json.Marshal(s)\n    fmt.Println(string(response)) // {}\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>{}\n</code></pre>\n"}], "owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 998, "favorite_count": 0, "accepted_answer_id": 48257806, "answer_count": 1, "score": 2, "last_activity_date": 1515996931, "creation_date": 1515996048, "question_id": 48257658, "link": "https://stackoverflow.com/questions/48257658/remove-elements-with-empty-value-when-no-values", "title": "Remove elements with empty value when no values", "body": "<p>I want to remove elements with empty value in struct. My script is below. Output of this script is <code>{\"keyA\":{}}</code>. I used <code>omitempty</code> to KeyA and KeyB. But an element with empty value is left. On the other hand KeyB is not shown. I want to show KeyA when it has values. I don't want to show KeyA when it has no values. Is there way to do this?</p>\n\n<h3>Script</h3>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype sample struct {\n    KeyA struct {\n        Key1 string `json:\"keyA1,omitempty\"`\n        Key2 string `json:\"keyA2,omitempty\"`\n    } `json:\"keyA,omitempty\"`\n    KeyB string `json:\"keyB,omitempty\"`\n}\n\nfunc main() {\n    var s sample\n    response, _ := json.Marshal(s)\n    fmt.Println(string(response)) // {\"keyA\":{}}\n}\n</code></pre>\n\n<p>Thank you so much for your time. And I'm sorry for my immature question.</p>\n"}, {"tags": ["pointers", "dictionary", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 0, "creation_date": 1516000624, "post_id": 48257963, "comment_id": 83499343, "body": "Thanks. If it is of type <code>map[string]string</code> how does it get a key then?"}, {"owner": {"reputation": 1283, "user_id": 9079863, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e9c7362282ac6c2b944cb216fa2ab4c?s=128&d=identicon&r=PG&f=1", "display_name": "Ilayaraja", "link": "https://stackoverflow.com/users/9079863/ilayaraja"}, "reply_to_user": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 0, "creation_date": 1516082982, "post_id": 48257963, "comment_id": 83533525, "body": "What is the database engine used ? What is the type of database field <code>additionalPrices </code> ?"}, {"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 0, "creation_date": 1516083355, "post_id": 48257963, "comment_id": 83533635, "body": "The database is sql server and the column type is decimal(9,2)"}, {"owner": {"reputation": 1283, "user_id": 9079863, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e9c7362282ac6c2b944cb216fa2ab4c?s=128&d=identicon&r=PG&f=1", "display_name": "Ilayaraja", "link": "https://stackoverflow.com/users/9079863/ilayaraja"}, "reply_to_user": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 0, "creation_date": 1516100140, "post_id": 48257963, "comment_id": 83542627, "body": "I thought the type of <code>additionalPrices </code> is something like a JSON. If there are separate decimal type columns for each additional price, then it is not possible to scan using <code>map[string]interface{}</code>"}, {"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 0, "creation_date": 1516102598, "post_id": 48257963, "comment_id": 83544129, "body": "That\u2019s a pain. I will just have to scan to a temporary variable and then build the map up manually. Thanks for your help anyway."}], "tags": [], "owner": {"reputation": 1283, "user_id": 9079863, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e9c7362282ac6c2b944cb216fa2ab4c?s=128&d=identicon&r=PG&f=1", "display_name": "Ilayaraja", "link": "https://stackoverflow.com/users/9079863/ilayaraja"}, "is_accepted": false, "score": 1, "last_activity_date": 1515997914, "creation_date": 1515997914, "answer_id": 48257963, "question_id": 48257544, "link": "https://stackoverflow.com/questions/48257544/scan-error-sql-scan-error-on-column-index-11-destination-not-a-pointer/48257963#48257963", "title": "Scan error: sql: Scan error on column index 11: destination not a pointer", "body": "<p>The row.Scan is meant to scan the fields in a DB row. It cannot scan the values of the field in a nested way.</p>\n\n<p>So just say <code>&amp;item.AdditionalPrices</code> to scan the <code>additionalPrices</code> field of each row, as follows:</p>\n\n<pre><code>    err := rows.Scan(\n        &amp;item.Sku,\n        &amp;item.Name,\n        &amp;item.Category.ID,\n        &amp;item.Category.Name,\n        &amp;item.Category.CategoryPosition,\n        &amp;item.LongDesc,\n        &amp;item.Barcode,\n        &amp;item.UnitPrice,\n        &amp;item.MinQty,\n        &amp;item.MultQty,\n        &amp;item.CategoryPosition,\n        &amp;item.AdditionalPrices,\n        &amp;item.audtdatetime,\n    )\n</code></pre>\n"}], "owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3662, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1515997914, "creation_date": 1515995236, "question_id": 48257544, "link": "https://stackoverflow.com/questions/48257544/scan-error-sql-scan-error-on-column-index-11-destination-not-a-pointer", "title": "Scan error: sql: Scan error on column index 11: destination not a pointer", "body": "<p>I understand what the issue is, I am not providing a pointer address when I am trying to scan the fields from my database call - however in this situation I am not quite sure how to work around it.</p>\n\n<p>I have a struct that looks like this:</p>\n\n<pre><code>type ItemsRequest struct {\n    Sku      string `json:\"sku\"`\n    Name     string `json:\"name\"`\n    Barcode  string `json:\"barcode,omitempty\"`\n    Category struct {\n        ID               string        `json:\"id,omitempty\"`\n        Name             string        `json:\"name,omitempty\"`\n        Subcategories    []interface{} `json:\"subcategories,omitempty\"`\n        CategoryPosition int           `json:\"categoryPosition,omitempty\"`\n        ResourceURI      string        `json:\"resource_uri,omitempty\"`\n    } `json:\"category,omitempty\"`\n    CategoryPosition int               `json:\"categoryPosition,omitempty\"`\n    LongDesc         string            `json:\"longDesc,omitempty\"`\n    MinQty           int               `json:\"minQty,omitempty\"`\n    MultQty          int               `json:\"multQty,omitempty\"`\n    UnitPrice        string            `json:\"unitPrice,omitempty\"`\n    ImageURLs        []string          `json:\"imageURLs,omitempty\"`\n    Variants         []interface{}     `json:\"variants,omitempty\"`\n    AdditionalPrices map[string]string `json:\"additionalPrices,omitempty\"`\n    audtdatetime     int\n}\n</code></pre>\n\n<p>The <code>AdditionalPrices</code> field is meant to represent an object of values, e.g:</p>\n\n<pre><code>{\n    'UK': \"12.34\",\n    'AU': \"14.00\"\n}\n</code></pre>\n\n<p>As such, I'm fairly confident that the <code>map[string]string</code> type for the field is correct...</p>\n\n<p>I am retrieving data to populate this struct from my database and then trying to scan the results into an instance of this struct. In my query, I have a predefined number of columns for which I want to populate <code>AdditionalPrices</code> with.</p>\n\n<p>As such I started off with this:</p>\n\n<pre><code>func getItemsFromDB() []*ItemsRequest {\n    rows, err := bcdataDBConnection.Query(`\n        SELECT  *\n        FROM    vProducts\n        WHERE   max_audit_date_time &gt; @AuditTime\n    `, sql.Named(\"AUDITTIME\", 2016101412000000))\n\n    if err != nil {\n        log.Fatal(\"There was an issue with the query for items: \", err)\n    }\n\n    defer rows.Close()\n\n    var items []*ItemsRequest\n\n    for rows.Next() {\n        var item = &amp;ItemsRequest{}\n        err := rows.Scan(\n            &amp;item.Sku,\n            &amp;item.Name,\n            &amp;item.Category.ID,\n            &amp;item.Category.Name,\n            &amp;item.Category.CategoryPosition,\n            &amp;item.LongDesc,\n            &amp;item.Barcode,\n            &amp;item.UnitPrice,\n            &amp;item.MinQty,\n            &amp;item.MultQty,\n            &amp;item.CategoryPosition,\n            &amp;item.AdditionalPrices[\"NZBASE\"],\n            &amp;item.AdditionalPrices[\"NZWWW\"],\n            &amp;item.AdditionalPrices[\"MMCMFR\"],\n            &amp;item.AdditionalPrices[\"MMBASE\"],\n            &amp;item.AdditionalPrices[\"AUBASE\"],\n            &amp;item.AdditionalPrices[\"MMCMAU\"],\n            &amp;item.AdditionalPrices[\"AUDSA\"],\n            &amp;item.AdditionalPrices[\"AUDVIC\"],\n            &amp;item.AdditionalPrices[\"AUDWWW\"],\n            &amp;item.audtdatetime,\n        )\n        if err != nil {\n            log.Fatal(\"Scan error: \", err)\n        }\n\n        items = append(items, item)\n    }\n\n    return items\n}\n</code></pre>\n\n<p>However this didn't appear to be correct syntax and so I changed it to:</p>\n\n<pre><code>func getItemsFromDB() []*ItemsRequest {\n    rows, err := bcdataDBConnection.Query(`\n        SELECT  *\n        FROM    vHandshakeProducts\n        WHERE   max_audit_date_time &gt; @AuditTime\n    `, sql.Named(\"AUDITTIME\", 2016101412000000))\n\n    if err != nil {\n        log.Fatal(\"There was an issue with the query for items: \", err)\n    }\n\n    defer rows.Close()\n\n    var items []*ItemsRequest\n\n    for rows.Next() {\n        var item = &amp;ItemsRequest{}\n        err := rows.Scan(\n            &amp;item.Sku,\n            &amp;item.Name,\n            &amp;item.Category.ID,\n            &amp;item.Category.Name,\n            &amp;item.Category.CategoryPosition,\n            &amp;item.LongDesc,\n            &amp;item.Barcode,\n            &amp;item.UnitPrice,\n            &amp;item.MinQty,\n            &amp;item.MultQty,\n            &amp;item.CategoryPosition,\n            item.AdditionalPrices[\"NZBASE\"],\n            item.AdditionalPrices[\"NZWWW\"],\n            item.AdditionalPrices[\"MMCMFR\"],\n            item.AdditionalPrices[\"MMBASE\"],\n            item.AdditionalPrices[\"AUBASE\"],\n            item.AdditionalPrices[\"MMCMAU\"],\n            item.AdditionalPrices[\"AUDSA\"],\n            item.AdditionalPrices[\"AUDVIC\"],\n            item.AdditionalPrices[\"AUDWWW\"],\n            &amp;item.audtdatetime,\n        )\n        if err != nil {\n            log.Fatal(\"Scan error: \", err)\n        }\n\n        items = append(items, item)\n    }\n\n    return items\n}\n</code></pre>\n\n<p>Which my IDE likes more, however upon running it I get the error:</p>\n\n<blockquote>\n  <p>2018/01/15 15:35:06 Scan error: sql: Scan error on column index 11: destination not a pointer</p>\n</blockquote>\n\n<p>So at this point, I'm not quite sure how to populate the values for <code>AdditionalPrices</code> from my database call.</p>\n\n<p>What do I need to do to populate the <code>AdditionalPrices</code> map with the values I get from the database?\nAs per the keys in my code, I already know the map keys for which I would like to assign the values to.</p>\n"}, {"tags": ["sorting", "go"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 2, "creation_date": 1515995400, "post_id": 48257435, "comment_id": 83497714, "body": "Can you auctually provide the data structure of what you want to be sorted?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1515996638, "post_id": 48257435, "comment_id": 83498055, "body": "sort.Sort or sort.Slice."}, {"owner": {"reputation": 860, "user_id": 7445374, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/25c50d858990e02d2c93a7ccedb8c025?s=128&d=identicon&r=PG&f=1", "display_name": "Nagireddy Hanisha", "link": "https://stackoverflow.com/users/7445374/nagireddy-hanisha"}, "edited": false, "score": 0, "creation_date": 1516009266, "post_id": 48257435, "comment_id": 83503237, "body": "It is a table as a whole that I wanted to sort as shown above in the code."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 3, "creation_date": 1516014329, "post_id": 48257435, "comment_id": 83506083, "body": "We don&#39;t know what type <code>ui.Table</code> has. For all we know, it&#39;s from a library that already has a <code>SortByColumn</code> method. If you want help, please include a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a>."}], "answers": [{"tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": true, "score": 2, "last_activity_date": 1516085318, "last_edit_date": 1516085318, "creation_date": 1516084984, "answer_id": 48275403, "question_id": 48257435, "link": "https://stackoverflow.com/questions/48257435/sort-a-table-in-golang/48275403#48275403", "title": "Sort a table in golang", "body": "<p>The <a href=\"https://golang.org/pkg/sort/\" rel=\"nofollow noreferrer\">sort package</a> on the standard library includes an <a href=\"https://golang.org/pkg/sort/#Interface\" rel=\"nofollow noreferrer\">interface</a> that if you implement it for any type then it can be sorted using the <code>sort.Sort()</code> function.</p>\n\n<p>Even if the <code>ui.Table</code> object is from a package or library you can't modify, you can always declare a new type using <code>ui.Table</code> as it's base and implement the <code>sort.Interface</code> yourself, something like:</p>\n\n<pre><code>type myTable ui.Table\n\nfunc (m myTable) Len() int           { return len(m) }\nfunc (m myTable) Swap(i, j int)      { m[i], m[j] = m[j], m[i] }\nfunc (m myTable) Less(i, j int) bool { return m[i].col() &lt; m[j].col() }\n</code></pre>\n\n<p>Or you know some implementation that makes sense for the Table type. Here I'm assuming that your rows have a function <code>col()</code> that returns the value of the column you are using to sort for that row and that <code>Table</code> is a slice of rows which is probably not the case.</p>\n\n<p>I wish I could help more but it's not possible to help you with any implementation details if you don't give any details about <code>ui.Table</code>.</p>\n"}], "owner": {"reputation": 860, "user_id": 7445374, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/25c50d858990e02d2c93a7ccedb8c025?s=128&d=identicon&r=PG&f=1", "display_name": "Nagireddy Hanisha", "link": "https://stackoverflow.com/users/7445374/nagireddy-hanisha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 0, "accepted_answer_id": 48275403, "answer_count": 1, "score": -3, "last_activity_date": 1516085318, "creation_date": 1515994540, "last_edit_date": 1516000468, "question_id": 48257435, "link": "https://stackoverflow.com/questions/48257435/sort-a-table-in-golang", "title": "Sort a table in golang", "body": "<p>I have table in golang. I need to sort it based on a particular column. Can someone help me to proceed?</p>\n\n<pre><code>table := ui.Table([]string{\"SI No\",\"Name\",\"ID\",\"status\",\"submitted-at\"})\nstrs := dat[\"resources\"].([]interface{})\nvar ln int = 20\ni:=0\nfor i &lt; ln {\n    table.Add(strconv.Itoa(i+1), metadataName , metadataID, metadataStatus, metadataSubmittedAt)\n    i = i + 1\n}\n</code></pre>\n"}, {"tags": ["go", "domain-driven-design", "value-objects"], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 0, "last_activity_date": 1515992007, "creation_date": 1515992007, "answer_id": 48257112, "question_id": 48256931, "link": "https://stackoverflow.com/questions/48256931/ddd-remove-a-text-value-object-from-a-list-of-value-object/48257112#48257112", "title": "DDD Remove a Text Value Object from A List of Value Object", "body": "<p>In addition to @WeiHuang 's answer:\nIf your notes is an unordered list, you can use swap instead of <code>append</code> or <code>copy</code>.</p>\n\n<pre><code>func (c Crop) removeNote(content string) {\n    j:=len(c.Notes)\n    for i:=0;i&lt;j;i++ {\n        if c.Notes[i]==content {\n            j--\n            c.Notes[j],c.Notes[i]=c.Notes[j],c.Notes[i]\n        }\n    }\n    c.Notes=c.Notes[:j]\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1157, "user_id": 119543, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2bTGF.png?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/119543/joe"}, "is_accepted": true, "score": 1, "last_activity_date": 1516585068, "creation_date": 1516585068, "answer_id": 48373641, "question_id": 48256931, "link": "https://stackoverflow.com/questions/48256931/ddd-remove-a-text-value-object-from-a-list-of-value-object/48373641#48373641", "title": "DDD Remove a Text Value Object from A List of Value Object", "body": "<p>Just use the instance of CropNote itself :</p>\n\n<pre><code>/* sorry for sudo code, not up with GO */\nfunc (c Crop) removeNote(noteToRemove CropNote) {\n    c.Notes= c.Notes.RemoveItem(noteToRemove); /* RemoveItem() is your own array manipulation code */\n}\n</code></pre>\n\n<p>Now its up to your Application layer to identify and call the removal of the note.</p>\n\n<p>Additional thing to think about:</p>\n\n<p>Why is crop notes part of the Crop aggregate root? is the behavior of a Crop influenced by the notes or does Crop behavior influence the notes? Don't try and rebuild your data model inside your domain, it wont make sense. If your system requires the independent adding/removing/updating of crop notes, they may work better as their own aggregate roots that are indirectly dependent on an existing crop entity eg:</p>\n\n<pre><code>/*again, not proficiant with GO - treat as sudo code */\nprivate type CropNote struct {\n    UID uuid.UUID\n    CropUID uuid.UUID\n    Content string\n    CreatedDate time.Time\n}\n\nfunction NewCropNote(crop Crop, content string) *CropNote{\n    cn := new(CropNote)\n    cn.UUID = uuid.new()\n    cn.CropUID = crop.UUID\n    cn.CreatedDate = now()\n    cn.Content = content\n    return cn\n}\n</code></pre>\n"}], "owner": {"reputation": 185, "user_id": 4243035, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/cn7mx.png?s=128&g=1", "display_name": "tama", "link": "https://stackoverflow.com/users/4243035/tama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "accepted_answer_id": 48373641, "answer_count": 2, "score": 0, "last_activity_date": 1516585068, "creation_date": 1515990440, "last_edit_date": 1516001901, "question_id": 48256931, "link": "https://stackoverflow.com/questions/48256931/ddd-remove-a-text-value-object-from-a-list-of-value-object", "title": "DDD Remove a Text Value Object from A List of Value Object", "body": "<p>I have entity with a list of value object like this:<br>\n(I'm using Go, but I hope it generally makes sense) </p>\n\n<pre><code>// this is my Crop entity\ntype Crop struct {\n    UID uuid.UUID\n    Name string\n    Type string\n    Notes []CropNote // This is a list of value object.\n} \n\n// This is my CropNote value object\ntype CropNote struct {\n    Content string\n    CreatedDate time.Time\n}\n</code></pre>\n\n<p>I have Crop behaviour for <code>AddNewNote(content string)</code>. But the business process needs to have remove note behaviour too. I'm thinking something like <code>RemoveNote(content string)</code> behaviour. So I will iterate my <code>Crop.Notes</code>, find the row with the same <code>content</code>, then remove that row from the <code>Crop.Notes</code> list. But I think that finding the value by its note's content is error-prone. And its weird from the API point of view too because I need to send the content to the params.</p>\n\n<p>My question is, how can I implement my Remove Note behaviour above?</p>\n\n<p>EDIT:\nSorry I think I'm not clearly explain myself.<br>\nI know how to remove a value from a slice.<br>\nMy issue is about the DDD. About how to remove Value Object that only have fields above from the <code>Crop.Notes</code> list. Because we know that Value Object cannot have Identifier.<br>\nAnd if I really can only use <code>Content</code> and <code>CreatedDate</code> fields from my Value Object, then I should send that <code>Content</code> or <code>CreatedDate</code> value to the endpoint when I do REST API request which is weird.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1515989052, "post_id": 48256756, "comment_id": 83496206, "body": "You could use a couple channels to send messages between the threads (<code>readFile</code> could send on channel <code>A</code> to indicate an error, and then blocking read on channel <code>B</code> for proper response, while <code>main</code> could non-blocking read on channel <code>A</code> to check for error, prompt for user response if error, then send on <code>B</code> to let <code>readFile</code> know what to do next)"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1515989585, "post_id": 48256756, "comment_id": 83496334, "body": "Though the stickler in me would probably change what everything&#39;s responsible for. I&#39;d have <code>main</code> read the file and send each bit of update to <code>updateMap</code>, which would mutate the map. My reasoning being that all of the IO work is then done in <code>main</code> and we can just use a producer/consumer pattern. Or, quite frankly, cut out the asynchronous bit entirely and do this synchronously."}, {"owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1516079091, "post_id": 48256756, "comment_id": 83532309, "body": "Could you reply a pseudo code as answer?"}], "owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1516094361, "creation_date": 1515988638, "last_edit_date": 1516094361, "question_id": 48256756, "link": "https://stackoverflow.com/questions/48256756/how-to-implement-update-status-by-parallel-reading-file-in-go", "title": "How to implement update status by parallel reading file in Go?", "body": "<p>I'm porting a program in C language. It is using two thread to work.\n* Main thread keeps a status map with a read-write lock.\n* Update thread keeps reading from a continuous growing file to update the status map. If it read failed, the user can press a button to re-read it.</p>\n\n<p>What's the proper way to do same log in Go? Here is my prototype</p>\n\n<pre><code>var status = struct {\n    sync.RWMutex\n    M map[string]string\n}\nfunc readFile(filename string) {\n    // open file\n    for {\n        status.Lock()\n        // update status\n        status.Unlock()\n        // run forever util error occurs\n    }\n}\nfunc main() {\n  go readFile(\"sample.data\") \n  go readFile(\"sample2.data\") \n  for {\n    status.RLock()\n    fmt.Println(status.M)\n    status.RUnlock()\n    // wait for user command (eg. assign new file to read or stop old file or quit)\n  }\n}\n</code></pre>\n\n<p>I know how to use sync.RWMutex and goroutine, but the problem is how to handle the 'reopen the file', it is on other goroutine and maybe the gorouting have already quit for reading fail, or it may still running, I require to stop the gorouting and restart it.</p>\n"}, {"tags": ["go", "bson", "mgo"], "comments": [{"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1515967722, "post_id": 48254402, "comment_id": 83491928, "body": "Wouldn&#39;t that <code>Select</code> try to give you something more like <code>[]struct{Tags []struct{Tag string}}</code>? Other MongoDB interfaces I&#39;ve used didn&#39;t want to unroll embedded documents for you."}, {"owner": {"reputation": 1245, "user_id": 975478, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/057a2e4b28f0ee27db450f0dece3fa6a?s=128&d=identicon&r=PG", "display_name": "xXPhenom22Xx", "link": "https://stackoverflow.com/users/975478/xxphenom22xx"}, "reply_to_user": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1515968436, "post_id": 48254402, "comment_id": 83492120, "body": "D&#39;oh yea your absolutely right, I&#39;ve updated my result definition with no luck:  var result []struct{Tags []struct{Tag string <code>bson:&quot;tag&quot;</code>} <code>bson:&quot;tags&quot;</code>}"}], "answers": [{"comments": [{"owner": {"reputation": 1245, "user_id": 975478, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/057a2e4b28f0ee27db450f0dece3fa6a?s=128&d=identicon&r=PG", "display_name": "xXPhenom22Xx", "link": "https://stackoverflow.com/users/975478/xxphenom22xx"}, "edited": false, "score": 0, "creation_date": 1516021180, "post_id": 48257878, "comment_id": 83509839, "body": "I&#39;ve tried this as well and updated my query above, but I am getting in return empty sets. For instance I should be getting back 3 items, but instead I get back this: [{[]} {[]} {[]}]"}, {"owner": {"reputation": 1283, "user_id": 9079863, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e9c7362282ac6c2b944cb216fa2ab4c?s=128&d=identicon&r=PG&f=1", "display_name": "Ilayaraja", "link": "https://stackoverflow.com/users/9079863/ilayaraja"}, "reply_to_user": {"reputation": 1245, "user_id": 975478, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/057a2e4b28f0ee27db450f0dece3fa6a?s=128&d=identicon&r=PG", "display_name": "xXPhenom22Xx", "link": "https://stackoverflow.com/users/975478/xxphenom22xx"}, "edited": false, "score": 0, "creation_date": 1516082862, "post_id": 48257878, "comment_id": 83533492, "body": "Are you missing <code>json:&quot;description&quot;</code> tagging in the <code>Tag</code> struct ?"}], "tags": [], "owner": {"reputation": 1283, "user_id": 9079863, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e9c7362282ac6c2b944cb216fa2ab4c?s=128&d=identicon&r=PG&f=1", "display_name": "Ilayaraja", "link": "https://stackoverflow.com/users/9079863/ilayaraja"}, "is_accepted": true, "score": 1, "last_activity_date": 1515997335, "creation_date": 1515997335, "answer_id": 48257878, "question_id": 48254402, "link": "https://stackoverflow.com/questions/48254402/select-nested-field-from-collection/48257878#48257878", "title": "Select nested field from collection", "body": "<p>MongoDB will result with an array of objects for the mentioned query, which will be something as follows:</p>\n\n<pre><code>{ \"_id\" : ObjectId(\"5a5c401ddbff3fdea15082ee\"), \"tags\" : [ { \"tag\" : \"query\" }, { \"tag\" : \"something\" } ] }\n{ \"_id\" : ObjectId(\"5a5c423ddbff3fdea15082f0\"), \"tags\" : [ { \"tag\" : \"something\" }, { \"tag\" : \"query\" } ] }\n</code></pre>\n\n<p>So to properly unmarshal this array of objects, the<code>result</code> variable  should be as follows:</p>\n\n<pre><code>var result []struct {\n    Tags []struct {\n        Tag string `bson:\"tag\"`\n    } `bson:\"tags\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 1245, "user_id": 975478, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/057a2e4b28f0ee27db450f0dece3fa6a?s=128&d=identicon&r=PG", "display_name": "xXPhenom22Xx", "link": "https://stackoverflow.com/users/975478/xxphenom22xx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 475, "favorite_count": 0, "accepted_answer_id": 48257878, "answer_count": 1, "score": 1, "last_activity_date": 1516021766, "creation_date": 1515965725, "last_edit_date": 1516021766, "question_id": 48254402, "link": "https://stackoverflow.com/questions/48254402/select-nested-field-from-collection", "title": "Select nested field from collection", "body": "<p>I am trying to grab a single field from a nested object in a Mongo collection.</p>\n\n<p>I need to get all tags that match the criteria. I am able to query and get the whole object but having no luck with getting a list or array of tags.</p>\n\n<pre><code>// Content struct\ntype Content struct {\n    ID                  bson.ObjectId           `json:\"id\" bson:\"_id\"`\n    PrimaryMarket       string                  `json:\"primary_market\" bson:\"primary_market\"`\n    Title               string                  `json:\"title\" bson:\"title\"`\n    Description         string                  `json:\"description\" bson:\"description\"`\n    Owner               User                    `json:\"owner\" bson:\"owner\"`\n    IsActive            bool                    `json:\"is_active\" bson:\"is_active\"`\n    File                string                  `json:\"file\" bson:\"file\"`\n    FileName            string                  `json:\"file_name\" bson:\"file_name\"`\n    FileType            string                  `json:\"file_type\" bson:\"file_type\"`\n    FileSize            string                  `json:\"file_size\" bson:\"file_size\"`\n    FileExt             string                  `json:\"file_ext\" bson:\"file_ext\"`\n    OriginalHeight      int                     `json:\"original_height\" bson:\"original_height\"`\n    OriginalWidth       int                     `json:\"original_width\" bson:\"original_width\"`\n    Height              int                     `json:\"height\" bson:\"height\"`\n    Width               int                     `json:\"width\" bson:\"width\"`\n    Tags                []Tag                   `json:\"tags\" bson:\"tags\"`\n    Flags               []Flagged               `json:\"flags\" bson:\"flags\"`\n    CreatedDate         time.Time               `json:\"created_date\" bson:\"created_date\"`\n}\n\n// Tag struct\ntype Tag struct {\n    ID                  bson.ObjectId           `json:\"id\" bson:\"_id\"`\n    Tag                 string                  `json:\"tag\" bson:\"tag\"`\n    Market              string                  `json:\"market\" bson:\"market\"`\n    CreatedBy           User                    `json:\"created_by\" bson:\"created_by\"`\n    CreatedDate         time.Time               `json:\"created_date\" bson:\"created_date\"`\n    IsActive            bool                    `json:\"is_active\" bson:\"is_active\"`\n}\n</code></pre>\n\n<p><strong>My query</strong></p>\n\n<pre><code>var result []struct {\n    Tags []struct {\n        Description string `bson:\"description\"`\n    } `bson:\"tags\"`\n}\n\nfind := app.Session.DB(\"mydb\").C(\"content\").Find(bson.M{\"primary_market\": \"Photos\", \"tags.description\": &amp;bson.RegEx{Pattern: query, Options: \"i\"}}).All(&amp;result)\n</code></pre>\n\n<p>I've tried using a Select statement using dot notation but that doesnt seem to work. Any help would be appreciated.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "networking", "buffer", "packets"], "comments": [{"owner": {"reputation": 1, "user_id": 9216864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/661d7082d77793b54998fd0295036559?s=128&d=identicon&r=PG&f=1", "display_name": "sadlyconfused", "link": "https://stackoverflow.com/users/9216864/sadlyconfused"}, "edited": false, "score": 0, "creation_date": 1515963035, "post_id": 48254021, "comment_id": 83490606, "body": "p.s. not sure why people downvotes this question, since this issue does not seem to be easy as it seems."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1515963057, "post_id": 48254021, "comment_id": 83490611, "body": "You want to write arbitrary bytes into a buffer and be able to parse it back, but you don&#39;t want separators. Then you&#39;ll have to store a length before the actual data. Better yet, use a common encoding (json, protobuf, gob, etc...). And please show what you&#39;re tried, we won&#39;t just write the code for you. Maybe try <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow noreferrer\">binary</a>."}, {"owner": {"reputation": 1, "user_id": 9216864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/661d7082d77793b54998fd0295036559?s=128&d=identicon&r=PG&f=1", "display_name": "sadlyconfused", "link": "https://stackoverflow.com/users/9216864/sadlyconfused"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1515963233, "post_id": 48254021, "comment_id": 83490664, "body": "Hi Marc, thanks for the anwser. That&#39;s what I was able to do in C++ with operators, but since I can&#39;t define them in Golang I was wondering if there is other way than using structs or protobuf/json."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1515963442, "post_id": 48254021, "comment_id": 83490722, "body": "Take a look at the binary package mentioned above. It gives you convenient methods to read/write fixed-sized numbers, and has lots of examples. You were asking why the downvotes? Probably because you didn&#39;t do any research."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1515992471, "post_id": 48254021, "comment_id": 83496955, "body": "Would you please show the c++ code? I am quite curious at how do you manage to store byte without separators and length of data."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1516045623, "post_id": 48254021, "comment_id": 83522826, "body": "@sadlyconfused don&#39;t take the downvotes personally; the golang community on this website tends to aggressively downvote questions and answers, regardless of their validity, helpfulness, or general usefulness."}, {"owner": {"reputation": 1, "user_id": 9216864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/661d7082d77793b54998fd0295036559?s=128&d=identicon&r=PG&f=1", "display_name": "sadlyconfused", "link": "https://stackoverflow.com/users/9216864/sadlyconfused"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1516048079, "post_id": 48254021, "comment_id": 83523895, "body": "@leafbebop I have used offsets calculation by variable type."}], "answers": [{"comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1516029769, "post_id": 48264788, "comment_id": 83514757, "body": "This does not answer the OP&#39;s question which asks about a way to get the data back."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": -1, "last_activity_date": 1516026370, "last_edit_date": 1516026370, "creation_date": 1516025727, "answer_id": 48264788, "question_id": 48254021, "link": "https://stackoverflow.com/questions/48254021/how-to-deal-with-byte-operators-in-golang/48264788#48264788", "title": "How to deal with byte operators in Golang?", "body": "<p>Try using a <a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"nofollow noreferrer\"><code>bytes.Buffer</code></a>, to which you can write as necessary, including using <a href=\"https://golang.org/pkg/fmt/#Fprintf\" rel=\"nofollow noreferrer\"><code>fmt.Fprintf</code></a> if necessary. When everything is written to the buffer, you can get the bytes back out.</p>\n\n<pre><code>buf := bytes.NewBuffer(nil)\nfmt.Fprint(buf, nickname)\nfmt.Fprint(buf, password)\nfmt.Print(buf.Bytes())\n</code></pre>\n\n<p>Working example here: <a href=\"https://play.golang.org/p/bRL6-N-3qH_n\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bRL6-N-3qH_n</a></p>\n"}, {"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": -1, "last_activity_date": 1516065122, "last_edit_date": 1516065122, "creation_date": 1516033212, "answer_id": 48266887, "question_id": 48254021, "link": "https://stackoverflow.com/questions/48254021/how-to-deal-with-byte-operators-in-golang/48266887#48266887", "title": "How to deal with byte operators in Golang?", "body": "<p>You can do fixed-size encoding using the <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow noreferrer\">encoding/binary</a> package, including choosing endianness.</p>\n\n<p>The example below writes two strings preceded by the length stored as a <code>uint32</code> in network byte order. This would be appropriate to send over the wire. You can use <code>uint16</code>, or even <code>uint8</code> if you're certain this will be enough to represent the string lengths.</p>\n\n<p><strong>Warning</strong>: I'm ignoring all errors in this sample code. Please do not do that in yours.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/binary\"\n    \"fmt\"\n)\n\nfunc main() {\n    user := \"foouser\"\n    password := \"barpassword\"\n\n    // Write \"len(user) user len(password) password\".\n    // Lengths are unsigned 32 bit ints in network byte order.\n    var buf bytes.Buffer\n    binary.Write(&amp;buf, binary.BigEndian, (uint32)(len(user)))\n    buf.WriteString(user)\n    binary.Write(&amp;buf, binary.BigEndian, (uint32)(len(password)))\n    buf.WriteString(password)\n\n    var output []byte = buf.Bytes()\n    fmt.Printf(\"% x\\n\", output)\n\n    // Now read it back (we could use the buffer,\n    // but let's use Reader for clarity)\n    input := bytes.NewReader(output)\n    var uLen, pLen uint32\n\n    binary.Read(input, binary.BigEndian, &amp;uLen)\n    uBytes := make([]byte, uLen)\n    input.Read(uBytes)\n    newUser := string(uBytes)\n\n    binary.Read(input, binary.BigEndian, &amp;pLen)\n    pBytes := make([]byte, pLen)\n    input.Read(pBytes)\n    newPassword := string(pBytes)\n\n    fmt.Printf(\"User: %q, Password: %q\", newUser, newPassword)\n}\n</code></pre>\n\n<p>This outputs the byte array and the strings extracted from it:</p>\n\n<pre><code>00 00 00 07 66 6f 6f 75 73 65 72 00 00 00 0b 62 61 72 70 61 73 73 77 6f 72 64\nUser: \"foouser\", Password: \"barpassword\"\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/crLkz-_Gzuu\" rel=\"nofollow noreferrer\">playground link</a></p>\n"}], "owner": {"reputation": 1, "user_id": 9216864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/661d7082d77793b54998fd0295036559?s=128&d=identicon&r=PG&f=1", "display_name": "sadlyconfused", "link": "https://stackoverflow.com/users/9216864/sadlyconfused"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 539, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1516065122, "creation_date": 1515962911, "question_id": 48254021, "link": "https://stackoverflow.com/questions/48254021/how-to-deal-with-byte-operators-in-golang", "title": "How to deal with byte operators in Golang?", "body": "<p>I would like to create a buffer which will contain information like nickname and password. Let's say I have created empty buffer, which is</p>\n\n<pre><code>00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n</code></pre>\n\n<p>By then I would like to fill it up with data, like\n<code>buffer &lt;&lt; nickname(string) &lt;&lt; password(string)</code>, so in result I'm getting</p>\n\n<pre><code>08 75 73 65 72 6e 61 6d 65 08 70 61 73 73 77 6f 72 64\n</code></pre>\n\n<p>which is <code>len.nickname actual_nickname len.password password</code></p>\n\n<p>Now, after I have created such buffer I would like to parse it to variables.\nThat would look like <code>buffer &gt;&gt; nickname(string) &gt;&gt; password(string)</code></p>\n\n<p>I made something once in c++ which was using operators, but I am not sure how to do so in Golang.</p>\n\n<p>These buffers would be used as packets body in my networking app. I don't want to use structs, but kind of above.</p>\n\n<p>I hope I explained my issue properly. I also do not want to use splitters like <code>:</code> to get these into array table.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "struct", "hash"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1515958904, "post_id": 48253423, "comment_id": 83489441, "body": "maps are unordered by design. Use an array to preserve order."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1515959638, "post_id": 48253423, "comment_id": 83489640, "body": "It&#39;s unclear what you&#39;re asking. Do you want to hash the <b>slice</b> (not array) of structs, or hash the individual structs? It might be better to ask why. Do you want to check contents for equality (regardless of ordering), or do you want to checksum? Please clarify."}, {"owner": {"reputation": 1944, "user_id": 4120554, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-RKmmNTC8iUo/AAAAAAAAAAI/AAAAAAAAAGs/oQQp9tU-Zb4/photo.jpg?sz=128", "display_name": "Marco Talento", "link": "https://stackoverflow.com/users/4120554/marco-talento"}, "edited": false, "score": 0, "creation_date": 1515961451, "post_id": 48253423, "comment_id": 83490178, "body": "Basically the idea is to generate a unique hash for caching! I want to combine the individual hash of each struct!"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1515962945, "post_id": 48253423, "comment_id": 83490578, "body": "So you want the hash of a complex data structure that includes unordered data structures. The fastest way to implement this is to serialize your data (with fields sorted) and hash it using something large enough to avoid collisions. However, I seriously doubt your caching needs to be on the whole data, it&#39;s usually on a very limited subset (eg: someone queries a unique ID and gets a lot of data back. This means your cache key is the unique ID, not the data)."}], "answers": [{"comments": [{"owner": {"reputation": 1944, "user_id": 4120554, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-RKmmNTC8iUo/AAAAAAAAAAI/AAAAAAAAAGs/oQQp9tU-Zb4/photo.jpg?sz=128", "display_name": "Marco Talento", "link": "https://stackoverflow.com/users/4120554/marco-talento"}, "edited": false, "score": 2, "creation_date": 1516023844, "post_id": 48262508, "comment_id": 83511243, "body": "Perfect, I was looking for this: &quot;Since the md5 sum is the hashed sum of the bytes, the order will not matter.&quot;  Maybe I need to start reading more about hashing algorithms :)"}, {"owner": {"reputation": 319, "user_id": 4881213, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/ec8c86d9574e5efc132e66182356161f?s=128&d=identicon&r=PG&f=1", "display_name": "Feng Yu", "link": "https://stackoverflow.com/users/4881213/feng-yu"}, "edited": false, "score": 2, "creation_date": 1528172447, "post_id": 48262508, "comment_id": 88393472, "body": "Because there is none exported field in SomeStruct, so the marshal result is same. If you change param1 and param1 to uppercase, hash result will different. see <a href=\"https://play.golang.org/p/J9mJqSnCvDC\" rel=\"nofollow noreferrer\">play.golang.org/p/J9mJqSnCvDC</a>."}, {"owner": {"reputation": 1161, "user_id": 1849769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1bd80cd843b2791a1312106d13d4fc10?s=128&d=identicon&r=PG", "display_name": "Pezo", "link": "https://stackoverflow.com/users/1849769/pezo"}, "edited": false, "score": 1, "creation_date": 1543481797, "post_id": 48262508, "comment_id": 93937804, "body": "As mentioned before this answer is just plain wrong. For something like this to work the data needs to be in the same order, so you need to sort the structs first."}, {"owner": {"reputation": 167, "user_id": 3074474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca1fb58ec47eebc4ab4ec72de66ed2a2?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/3074474/jeff"}, "reply_to_user": {"reputation": 1944, "user_id": 4120554, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-RKmmNTC8iUo/AAAAAAAAAAI/AAAAAAAAAGs/oQQp9tU-Zb4/photo.jpg?sz=128", "display_name": "Marco Talento", "link": "https://stackoverflow.com/users/4120554/marco-talento"}, "edited": false, "score": 0, "creation_date": 1550880955, "post_id": 48262508, "comment_id": 96448412, "body": "To add to how wrong this is, run it in the debugger and see that <code>jsonBytes</code> == &quot;{}&quot;.  You could also just use a print statement for <code>jsonBytes</code>.  @MarcoTalento please remove this as the accepted answer."}, {"owner": {"reputation": 9793, "user_id": 130580, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13d99a7cea31a89da1004080334cc8cd?s=128&d=identicon&r=PG", "display_name": "elslooo", "link": "https://stackoverflow.com/users/130580/elslooo"}, "edited": false, "score": 0, "creation_date": 1558541863, "post_id": 48262508, "comment_id": 99138794, "body": "Can anyone confirm that the JSON marshaller/encoder is guaranteed to be deterministic, even between versions? Will the resulting hash be the same even one year from now (with a future version of Go)?"}, {"owner": {"reputation": 512, "user_id": 413173, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/49dc4b6bd7730aefe0d5e5e5c4483cb0?s=128&d=identicon&r=PG&f=1", "display_name": "Connor Finn McKelvey", "link": "https://stackoverflow.com/users/413173/connor-finn-mckelvey"}, "edited": false, "score": 0, "creation_date": 1581214980, "post_id": 48262508, "comment_id": 106355105, "body": "Unfortunately this breaks when one of the fields on the struct is a map.  json.Marshal is not deterministic with maps"}], "tags": [], "owner": {"reputation": 563, "user_id": 4539721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d6650d3a6a89e08bd747a07fd06989a?s=128&d=identicon&r=PG", "display_name": "Soham Kamani", "link": "https://stackoverflow.com/users/4539721/soham-kamani"}, "is_accepted": true, "score": -2, "last_activity_date": 1516017312, "creation_date": 1516017312, "answer_id": 48262508, "question_id": 48253423, "link": "https://stackoverflow.com/questions/48253423/unique-hash-from-struct/48262508#48262508", "title": "Unique Hash from struct", "body": "<p>You can do this by serializing the array to an array of bytes, then computing the md5 sum of the byte array. Since the md5 sum is the hashed <strong>sum</strong> of the bytes, the order will not matter.</p>\n\n<p>To serialize each element of the array, you can use <code>json.Marshal</code>, which will work for any type of <code>struct</code>. </p>\n\n<p>The hash function will look something like this :</p>\n\n<pre><code>func Hash(arr []SomeStruct) [16]byte {\n    arrBytes := []byte{}\n    for _, item := range arr {\n        jsonBytes, _ := json.Marshal(item)\n        arrBytes = append(arrBytes, jsonBytes...)\n    }\n    return md5.Sum(arrBytes)\n}\n</code></pre>\n\n<p>You can run the working sample program <a href=\"https://play.golang.org/p/IW1YKmWFlgU\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>func main() {\n    arr1 := []SomeStruct{\n        {\n            param1: \"abc\",\n            param2: 3,\n        },\n        {\n            param1: \"def\",\n            param2: 5,\n        }, {\n            param1: \"deg\",\n            param2: 0,\n        },\n    }\n    arr2 := []SomeStruct{\n    {\n            param1: \"deg\",\n            param2: 0,\n        },\n        {\n            param1: \"def\",\n            param2: 5,\n        },\n        {\n            param1: \"abc\",\n            param2: 3,\n        },\n    }\n\n    fmt.Printf(\"Hash1: %x\\n\", Hash(arr1))\n    fmt.Printf(\"Hash2: %x\\n\", Hash(arr2))\n\n}\n\nfunc Hash(arr []SomeStruct) [16]byte {\n    arrBytes := []byte{}\n    for _, item := range arr {\n        jsonBytes, _ := json.Marshal(item)\n        arrBytes = append(arrBytes, jsonBytes...)\n    }\n    return md5.Sum(arrBytes)\n}\n</code></pre>\n\n<p>Which will output:</p>\n\n<pre><code>Hash1: d065fee603fdcf75115204ec65310e1c\nHash2: d065fee603fdcf75115204ec65310e1c\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 326, "user_id": 7133036, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KRKBW.png?s=128&g=1", "display_name": "woat", "link": "https://stackoverflow.com/users/7133036/woat"}, "is_accepted": false, "score": 7, "last_activity_date": 1536186673, "last_edit_date": 1536186673, "creation_date": 1536164434, "answer_id": 52189658, "question_id": 48253423, "link": "https://stackoverflow.com/questions/48253423/unique-hash-from-struct/52189658#52189658", "title": "Unique Hash from struct", "body": "<p>Feng has a point, the accepted answer doesn't work not only because there are no exported fields in the struct, but also the fact that the way MD5 hashes <strong>does</strong> have order significance, see <a href=\"https://www.ietf.org/rfc/rfc1321.txt\" rel=\"noreferrer\">RFC 1321 3.4</a>.</p>\n\n<p>Not sure on efficacy, but I've got something working by passing in the slice as bytes using <code>encoding/gob</code> and <code>bytes</code> representing a hash to use in <code>Compare</code>.</p>\n\n<p><a href=\"https://play.golang.org/p/DtgWFb0vbIt\" rel=\"noreferrer\">Playground</a></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/gob\"\n    \"fmt\"\n)\n\ntype S struct {\n    K1 string\n    K2 int\n}\n\nfunc main() {\n    sa := []S{{ K1: \"foo\", K2: 1}, {K1: \"bar\", K2: 2}, {K1: \"baz\", K2: 3,}}\n    sb := []S{{ K1: \"baz\", K2: 3}, {K1: \"bar\", K2: 2}, {K1: \"foo\", K2: 1,}}\n    sc := []S{}\n\n    a := Hash(sa)\n    b := Hash(sb)\n    c := Hash(sc)\n\n    fmt.Println(Compare(a, b))\n    fmt.Println(Compare(a, c))\n}\n\nfunc Compare(a, b []byte) bool {\n    a = append(a, b...)\n    c := 0\n    for _, x := range a {\n        c ^= int(x)\n    }\n    return c == 0\n}\n\nfunc Hash(s []S) []byte {\n    var b bytes.Buffer\n    gob.NewEncoder(&amp;b).Encode(s)\n    return b.Bytes()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1360, "user_id": 917492, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q9JJt.jpg?s=128&g=1", "display_name": "jasie", "link": "https://stackoverflow.com/users/917492/jasie"}, "edited": false, "score": 2, "creation_date": 1567428220, "post_id": 57756769, "comment_id": 101950715, "body": "Please read <a href=\"https://stackoverflow.com/help/how-to-answer\">stackoverflow.com/help/how-to-answer</a> and <a href=\"https://stackoverflow.com/help/deleted-answers\">stackoverflow.com/help/deleted-answers</a> and improve your answer. A link is not a valid answer."}], "tags": [], "owner": {"reputation": 39, "user_id": 11691288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7a0368cc6cd15ed1cbf90a7ae18638c?s=128&d=identicon&r=PG&f=1", "display_name": "M C", "link": "https://stackoverflow.com/users/11691288/m-c"}, "is_accepted": false, "score": 3, "last_activity_date": 1567426405, "creation_date": 1567426405, "answer_id": 57756769, "question_id": 48253423, "link": "https://stackoverflow.com/questions/48253423/unique-hash-from-struct/57756769#57756769", "title": "Unique Hash from struct", "body": "<p>Maybe <a href=\"https://github.com/mitchellh/hashstructure\" rel=\"nofollow noreferrer\">https://github.com/mitchellh/hashstructure</a> could  help you. It consistently hashes struct but can be used with slices and arrays.</p>\n"}], "owner": {"reputation": 1944, "user_id": 4120554, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-RKmmNTC8iUo/AAAAAAAAAAI/AAAAAAAAAGs/oQQp9tU-Zb4/photo.jpg?sz=128", "display_name": "Marco Talento", "link": "https://stackoverflow.com/users/4120554/marco-talento"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12687, "favorite_count": 1, "accepted_answer_id": 48262508, "answer_count": 3, "score": 3, "last_activity_date": 1567426405, "creation_date": 1515958712, "last_edit_date": 1515961382, "question_id": 48253423, "link": "https://stackoverflow.com/questions/48253423/unique-hash-from-struct", "title": "Unique Hash from struct", "body": "<p>I would like to generate a unique hash from an array of structs. The order might be different but the values are the same.</p>\n\n<p>Example:</p>\n\n<pre><code>type MyStruct struct {\n   ID string\n   Parameters map[string]interface{}\n}\n\narr:= []MyStruct{MyStruct{ID: \"test\", Parameters: map[string]interface{}{\"key\": true, \"key2\": \"value\"} }, MyStruct{ID: \"test2\", Parameters: map[string]interface{}{\"key2\": \"value\", \"key\": true} }}\n//The order is different even inside the Parameters fields\n\narr:= []MyStruct{MyStruct{ID: \"test2\", Parameters: map[string]interface{}{\"key2\": \"value\", \"key\": true} },MyStruct{ID: \"test\", Parameters: map[string]interface{}{\"key\": true, \"key2\": \"value\"} }}\n</code></pre>\n\n<p>In both cases the hash should be the same since the values inside the structs are the same.</p>\n\n<p>EDIT: Basically the idea is to generate a unique hash for caching! I want to combine the individual hash of each struct!</p>\n"}, {"tags": ["go", "exec", "stdout"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1515957735, "post_id": 48253268, "comment_id": 83489096, "body": "set the stdout property of the cmd instance to whatever sink you need. os.Stdout is the most obvious one. <code>cmd.Stdout = os.Stdout</code>. Do the same for stderr."}, {"owner": {"reputation": 155, "user_id": 4602392, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8ada7d6bff96c8dbed0bc6ce18800a32?s=128&d=identicon&r=PG&f=1", "display_name": "Christian", "link": "https://stackoverflow.com/users/4602392/christian"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1515958008, "post_id": 48253268, "comment_id": 83489177, "body": "Is it possible to improve that? Our answer works but it has two behaviors that make it less attractive to me. For one I need to examine what has been printed out. The second one is more severe. The go program now exits before the command has finished. (I want to execute the command, show the result to the user. After the command has been executed I want to examine the output to decide what to do next.)"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1515958267, "post_id": 48253268, "comment_id": 83489260, "body": "<a href=\"https://golang.org/pkg/io/#MultiWriter\" rel=\"nofollow noreferrer\">golang.org/pkg/io/#MultiWriter</a> then ?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1515958791, "post_id": 48253268, "comment_id": 83489408, "body": "to wait for command completion use Run not Start. If you need to use Start, call Wait to block until command completion."}], "answers": [{"comments": [{"owner": {"reputation": 155, "user_id": 4602392, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8ada7d6bff96c8dbed0bc6ce18800a32?s=128&d=identicon&r=PG&f=1", "display_name": "Christian", "link": "https://stackoverflow.com/users/4602392/christian"}, "edited": false, "score": 0, "creation_date": 1515959069, "post_id": 48253453, "comment_id": 83489485, "body": "If dound a duplicate of my question (<a href=\"https://stackoverflow.com/questions/30993717/how-can-i-redirect-in-go-the-stdout-and-stderr-of-a-command-to-both-the-consol?rq=1\" title=\"how can i redirect in go the stdout and stderr of a command to both the consol\">stackoverflow.com/questions/30993717/&hellip;</a>). Because I don&#39;t have the necessary reputation I can&#39;t mark it as duplicate."}], "tags": [], "owner": {"reputation": 155, "user_id": 4602392, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8ada7d6bff96c8dbed0bc6ce18800a32?s=128&d=identicon&r=PG&f=1", "display_name": "Christian", "link": "https://stackoverflow.com/users/4602392/christian"}, "is_accepted": true, "score": 4, "last_activity_date": 1515958926, "creation_date": 1515958926, "answer_id": 48253453, "question_id": 48253268, "link": "https://stackoverflow.com/questions/48253268/print-the-stdout-from-exec-command-in-real-time-in-go/48253453#48253453", "title": "Print the stdout from exec command in real time in Go", "body": "<p>Thank you mh-cbon. That pushed me in the right direction.</p>\n\n<p>The code now looks like this and does exactly what I want it to do. I also found that when I use <code>Run()</code> instead of <code>Start()</code> the execution of the program only continues after the command has finished.</p>\n\n<pre><code>cmd := exec.Command(command, args...)\ncmd.Dir = dir\n\nvar stdBuffer bytes.Buffer\nmw := io.MultiWriter(os.Stdout, &amp;stdBuffer)\n\ncmd.Stdout = mw\ncmd.Stderr = mw\n\n// Execute the command\nif err := cmd.Run(); err != nil {\n    log.Panic(err)\n}\n\nlog.Println(stdBuffer.String())\n</code></pre>\n"}], "owner": {"reputation": 155, "user_id": 4602392, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8ada7d6bff96c8dbed0bc6ce18800a32?s=128&d=identicon&r=PG&f=1", "display_name": "Christian", "link": "https://stackoverflow.com/users/4602392/christian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5739, "favorite_count": 1, "closed_date": 1515965251, "accepted_answer_id": 48253453, "answer_count": 1, "score": 4, "last_activity_date": 1515958926, "creation_date": 1515957465, "question_id": 48253268, "link": "https://stackoverflow.com/questions/48253268/print-the-stdout-from-exec-command-in-real-time-in-go", "closed_reason": "Duplicate", "title": "Print the stdout from exec command in real time in Go", "body": "<p>I have a small Go tool which basically allows the user to define an command that than will be run using <code>os/exec</code>.</p>\n\n<p>My problem is that I want to show the user the output (stdout/stderr) of the command.</p>\n\n<p>An example could look like this:\nThe user defines a command that in the end is <code>sh test.sh</code>.\nContent of <em>test.sh</em>:</p>\n\n<pre><code>echo \"Start\"\nsleep 7s\necho \"Done\"\n</code></pre>\n\n<p>With my current implementation the user can only see the output once the complete command finished. In the example above the user wouldn't see the output <em>Start</em> until the <code>sleep</code> command and the second <code>echo</code> finish.</p>\n\n<p>I currently retrieve the output of the command like this:</p>\n\n<pre><code>cmd := exec.Command(command, args...)\ncmd.Dir = dir\n// Attach to the standard out to read what the command might print\nstdout, err := cmd.StdoutPipe()\nif err != nil {\n    log.Panic(err)\n}\n// Execute the command\nif err := cmd.Start(); err != nil {\n    log.Panic(err)\n}\n\nbuf := new(bytes.Buffer)\nbuf.ReadFrom(stdout)\nlog.Print(buf.String())\n</code></pre>\n\n<p>Is it somehow possible to read the stdout/stderr in <em>real-time</em>. Meaning that as soon as the user defined command creates and output it is printed?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 5, "creation_date": 1515958436, "post_id": 48253083, "comment_id": 83489313, "body": "the type is already part of the declaration. The meaning is already part of the name. If anything else is required it should go into that doc header."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 6, "last_activity_date": 1600973022, "last_edit_date": 1600973022, "creation_date": 1516024211, "answer_id": 48264341, "question_id": 48253083, "link": "https://stackoverflow.com/questions/48253083/golang-doc-func-parameters/48264341#48264341", "title": "Golang doc func parameters", "body": "<p>There is no explicit documentation of function parameters in godoc. Any necessary details not covered by the name and type of the parameter should go into the doc comment for the function. For examples, see <a href=\"https://golang.org/pkg/\" rel=\"nofollow noreferrer\">every function in the standard library</a>.</p>\n"}], "owner": {"reputation": 425, "user_id": 8749222, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n31Up.png?s=128&g=1", "display_name": "Justin Lin", "link": "https://stackoverflow.com/users/8749222/justin-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7388, "favorite_count": 0, "accepted_answer_id": 48264341, "answer_count": 1, "score": 13, "last_activity_date": 1600973022, "creation_date": 1515956393, "question_id": 48253083, "link": "https://stackoverflow.com/questions/48253083/golang-doc-func-parameters", "title": "Golang doc func parameters", "body": "<p>Reading the godoc <a href=\"https://blog.golang.org/godoc-documenting-go-code\" rel=\"noreferrer\">doc</a>. It does not specify how function parameters documented.</p>\n\n<p>What is the reason for omitting this?</p>\n"}, {"tags": ["go", "http-status-code-404"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1515957921, "post_id": 48252937, "comment_id": 83489155, "body": "one way around is to mock w so it does not allow to change the status code to 200 when passed to http.servefile."}], "answers": [{"comments": [{"owner": {"reputation": 2810, "user_id": 5808504, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/821bb6654d488185345d86bde0a586ef?s=128&d=identicon&r=PG&f=1", "display_name": "twharmon", "link": "https://stackoverflow.com/users/5808504/twharmon"}, "edited": false, "score": 0, "creation_date": 1515956851, "post_id": 48253147, "comment_id": 83488776, "body": "I considered that. Would there be a more memory-efficient way to do this with io.Copy?"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 2810, "user_id": 5808504, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/821bb6654d488185345d86bde0a586ef?s=128&d=identicon&r=PG&f=1", "display_name": "twharmon", "link": "https://stackoverflow.com/users/5808504/twharmon"}, "edited": false, "score": 0, "creation_date": 1516030173, "post_id": 48253147, "comment_id": 83514991, "body": "Most likely, yes.  Is your 404 page big enough to worry about memory efficiency?"}, {"owner": {"reputation": 2810, "user_id": 5808504, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/821bb6654d488185345d86bde0a586ef?s=128&d=identicon&r=PG&f=1", "display_name": "twharmon", "link": "https://stackoverflow.com/users/5808504/twharmon"}, "edited": false, "score": 0, "creation_date": 1516049878, "post_id": 48253147, "comment_id": 83524682, "body": "If the 404 page was really, really small, could ioutil.ReadFile work faster than io.Copy?"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 2810, "user_id": 5808504, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/821bb6654d488185345d86bde0a586ef?s=128&d=identicon&r=PG&f=1", "display_name": "twharmon", "link": "https://stackoverflow.com/users/5808504/twharmon"}, "edited": false, "score": 0, "creation_date": 1516066702, "post_id": 48253147, "comment_id": 83529707, "body": "if you wanted faster, I&#39;d probably just load the content in to a slice at start time and just write it each time.   No reason to load from disk every time and the 404 page is probably not something you&#39;d need to change &quot;live&quot; in the server."}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 0, "last_activity_date": 1515956745, "creation_date": 1515956745, "answer_id": 48253147, "question_id": 48252937, "link": "https://stackoverflow.com/questions/48252937/serve-html-file-with-custom-status-code/48253147#48253147", "title": "Serve html file with custom status code", "body": "<p>You can simply just write the contents yourself.</p>\n\n<p>Something like:</p>\n\n<pre><code>r.NotFound = http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        contents, err := ioutil.ReadFile(\"files/not-found.html\")\n        if err != nil {\n            panic(err) // or do something useful\n        }\n        w.WriteHeader(404)\n        w.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n        w.Write(contents)\n    })\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1515958349, "post_id": 48253328, "comment_id": 83489290, "body": "defer file.Close"}], "tags": [], "owner": {"reputation": 2810, "user_id": 5808504, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/821bb6654d488185345d86bde0a586ef?s=128&d=identicon&r=PG&f=1", "display_name": "twharmon", "link": "https://stackoverflow.com/users/5808504/twharmon"}, "is_accepted": false, "score": 1, "last_activity_date": 1515962852, "last_edit_date": 1515962852, "creation_date": 1515957963, "answer_id": 48253328, "question_id": 48252937, "link": "https://stackoverflow.com/questions/48252937/serve-html-file-with-custom-status-code/48253328#48253328", "title": "Serve html file with custom status code", "body": "<p>David's answer worked, and this is another way.</p>\n\n<pre><code>// other header stuff\nw.WriteHeader(http.StatusNotFound)\nfile, err := os.Open(\"files/not-found.html\")\nif err != nil {\n    log.Println(err)\n    return\n}\n_, err = io.Copy(w, file)\nif err != nil {\n    log.Println(err)\n}\nfile.Close() // consider defer ^\n</code></pre>\n"}], "owner": {"reputation": 2810, "user_id": 5808504, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/821bb6654d488185345d86bde0a586ef?s=128&d=identicon&r=PG&f=1", "display_name": "twharmon", "link": "https://stackoverflow.com/users/5808504/twharmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 431, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1515962852, "creation_date": 1515955460, "question_id": 48252937, "link": "https://stackoverflow.com/questions/48252937/serve-html-file-with-custom-status-code", "title": "Serve html file with custom status code", "body": "<p>I need to have a custom not found html page. Here is what I've tried:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/julienschmidt/httprouter\"\n)\n\nfunc main() {\n    r := httprouter.New()\n\n    r.NotFound = http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.WriteHeader(404)\n        http.ServeFile(w, r, \"files/not-found.html\")\n    })\n\n    http.ListenAndServe(\":8000\", r)\n}\n</code></pre>\n\n<p>I have the line <code>w.WriteHeader(404)</code> to make sure the status code is 404, but the code above gives the error: </p>\n\n<blockquote>\n  <p>http: multiple response.WriteHeader calls</p>\n</blockquote>\n\n<p>Without the line <code>w.WriteHeader(404)</code> there are no errors and the page is shown correctly, but the status code is 200. I want it to be 404.</p>\n"}, {"tags": ["arrays", "string", "go", "floating-point"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1515946748, "post_id": 48251481, "comment_id": 83485568, "body": "<a href=\"https://golang.org/pkg/text/tabwriter/\" rel=\"nofollow noreferrer\">golang.org/pkg/text/tabwriter</a>"}, {"owner": {"reputation": 568, "user_id": 6082378, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/068b373612159246ce9c2e723573e1c8?s=128&d=identicon&r=PG&f=1", "display_name": "Jayendra Parmar", "link": "https://stackoverflow.com/users/6082378/jayendra-parmar"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1515947053, "post_id": 48251481, "comment_id": 83485661, "body": "My bad I think I emphasized wrong part of the question, let me edit it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515947440, "post_id": 48251481, "comment_id": 83485803, "body": "Are you sure that\u2019s not just json?"}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1515948405, "last_edit_date": 1515948405, "creation_date": 1515948071, "answer_id": 48251794, "question_id": 48251481, "link": "https://stackoverflow.com/questions/48251481/string-to-2d-float-array-in-golang/48251794#48251794", "title": "string to 2d float array in golang", "body": "<p>This is just an array of arrays in json. You can parse it using the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">json</a> package:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    input := `[[1514771940,13345.7,13381.01,13381,13345.7,4.276442830000001],[1514771880,13332.12,13387.72,13332.12,13381,14.83685867]]`\n\n    var parsed [][]float64\n    if err := json.Unmarshal([]byte(input), &amp;parsed); err != nil {\n        panic(err)\n    }\n    fmt.Println(parsed)\n}\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>[[1.51477194e+09 13345.7 13381.01 13381 13345.7 4.276442830000001] [1.51477188e+09 13332.12 13387.72 13332.12 13381 14.83685867]]\n</code></pre>\n\n<p>You should check the API docs, they must mention what format the response is in. If this is over http, the content-type will tell you as well.</p>\n"}], "owner": {"reputation": 568, "user_id": 6082378, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/068b373612159246ce9c2e723573e1c8?s=128&d=identicon&r=PG&f=1", "display_name": "Jayendra Parmar", "link": "https://stackoverflow.com/users/6082378/jayendra-parmar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 638, "favorite_count": 0, "accepted_answer_id": 48251794, "answer_count": 1, "score": -2, "last_activity_date": 1515948405, "creation_date": 1515946013, "last_edit_date": 1515946928, "question_id": 48251481, "link": "https://stackoverflow.com/questions/48251481/string-to-2d-float-array-in-golang", "title": "string to 2d float array in golang", "body": "<p>I am writing a code in go to retrieve data through the rest API. The output I am getting is a two-dimensional array as a string, like this</p>\n\n<pre><code>[\n[1514771940,13345.7,13381.01,13381,13345.7,4.276442830000001],\n[1514771880,13332.12,13387.72,13332.12,13381,14.83685867],\n.\n.\n.\n]\n</code></pre>\n\n<p>How can I transform this <code>string</code> to 2-D float array?</p>\n"}, {"tags": ["regex", "go", "string-parsing"], "answers": [{"comments": [{"owner": {"reputation": 3328, "user_id": 1825593, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t3gK8.jpg?s=128&g=1", "display_name": "prl900", "link": "https://stackoverflow.com/users/1825593/prl900"}, "edited": false, "score": 0, "creation_date": 1515934487, "post_id": 48249580, "comment_id": 83482053, "body": "Thanks for your response. Maybe I didn\u2019t explain it correctly but I don\u2019t want single \u2018articles\u2019 or spaces to be matched."}, {"owner": {"reputation": 3328, "user_id": 1825593, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t3gK8.jpg?s=128&g=1", "display_name": "prl900", "link": "https://stackoverflow.com/users/1825593/prl900"}, "edited": false, "score": 0, "creation_date": 1515936305, "post_id": 48249580, "comment_id": 83482577, "body": "But this regexp doesn\u2019t answer the original question: making \u2018article\u2019 optional but requiring at least one \u2018colour\u2019 or \u2018object\u2018."}, {"owner": {"reputation": 3328, "user_id": 1825593, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t3gK8.jpg?s=128&g=1", "display_name": "prl900", "link": "https://stackoverflow.com/users/1825593/prl900"}, "edited": false, "score": 0, "creation_date": 1515938555, "post_id": 48249580, "comment_id": 83483186, "body": "But this regexp doesn\u2019t answer the original question: making \u2018article\u2019 optional but requiring at least one \u2018colour\u2019 or \u2018object\u2018."}, {"owner": {"reputation": 10697, "user_id": 2445864, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/jSfSO.jpg?s=128&g=1", "display_name": "Hubert Grzeskowiak", "link": "https://stackoverflow.com/users/2445864/hubert-grzeskowiak"}, "reply_to_user": {"reputation": 3328, "user_id": 1825593, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t3gK8.jpg?s=128&g=1", "display_name": "prl900", "link": "https://stackoverflow.com/users/1825593/prl900"}, "edited": false, "score": 0, "creation_date": 1515939311, "post_id": 48249580, "comment_id": 83483370, "body": "@MonkeyButter Ah I think I got your question wrong. I thought you wanted at least one of each."}], "tags": [], "owner": {"reputation": 10697, "user_id": 2445864, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/jSfSO.jpg?s=128&g=1", "display_name": "Hubert Grzeskowiak", "link": "https://stackoverflow.com/users/2445864/hubert-grzeskowiak"}, "is_accepted": false, "score": 0, "last_activity_date": 1515934665, "last_edit_date": 1515934665, "creation_date": 1515932888, "answer_id": 48249580, "question_id": 48249480, "link": "https://stackoverflow.com/questions/48249480/regular-expression-enforcing-at-least-one-in-two-groups/48249580#48249580", "title": "Regular expression enforcing at least one in two groups", "body": "<p>In regex, there's a few special signs that indicate the expected number of matches for a character or a group:</p>\n\n<p><code>*</code> - zero or more</p>\n\n<p><code>+</code> - one or more</p>\n\n<p><code>?</code> - zero or one</p>\n\n<p>These applied, your regex looks like this:</p>\n\n<pre><code>(?P&lt;article&gt;(the|a)?)(?P&lt;colour&gt;(red|green|blue|yellow)+)(?P&lt;object&gt;(car|ball|house)+)\\s*\n</code></pre>\n\n<ol>\n<li>None or one article.</li>\n<li>One or more colors.</li>\n<li>Finally one or more objects.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 82895, "user_id": 372239, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/2twLb.jpg?s=128&g=1", "display_name": "Toto", "link": "https://stackoverflow.com/users/372239/toto"}, "is_accepted": true, "score": 3, "last_activity_date": 1515938291, "last_edit_date": 1515938291, "creation_date": 1515937620, "answer_id": 48250214, "question_id": 48249480, "link": "https://stackoverflow.com/questions/48249480/regular-expression-enforcing-at-least-one-in-two-groups/48250214#48250214", "title": "Regular expression enforcing at least one in two groups", "body": "<p>This is working with your testcases.</p>\n\n<pre><code>/\n    (?P&lt;article&gt;the|a)?                         # optional article\n    (?:                                         # non-capture group, mandatory\n        (?P&lt;colour&gt;(?:red|green|blue|yellow)+)  # 1 or more colors  \n        (?P&lt;object&gt;car|ball|house)              # followed by 1 object\n        |                                       # OR\n        (?P&lt;colour&gt;(?:red|green|blue|yellow)+)  # 1 or more colors\n        |                                       # OR\n        (?P&lt;object&gt;car|ball|house)              # 1 object\n    )                                           # end group\n/x        \n</code></pre>\n\n<p>It can be reduced to:</p>\n\n<pre><code>/\n    (?P&lt;article&gt;the|a)?                         # optional article\n    (?:                                         # non-capture group, mandatory\n        (?P&lt;colour&gt;(?:red|green|blue|yellow)+)  # 1 or more colors  \n        (?P&lt;object&gt;car|ball|house)?             # followed by optional object\n        |                                       # OR\n        (?P&lt;object&gt;car|ball|house)              # 1 object\n    )                                           # end group\n/x                                                                                    \n</code></pre>\n"}], "owner": {"reputation": 3328, "user_id": 1825593, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t3gK8.jpg?s=128&g=1", "display_name": "prl900", "link": "https://stackoverflow.com/users/1825593/prl900"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1187, "favorite_count": 0, "accepted_answer_id": 48250214, "answer_count": 2, "score": 3, "last_activity_date": 1515938291, "creation_date": 1515932167, "last_edit_date": 1515938197, "question_id": 48249480, "link": "https://stackoverflow.com/questions/48249480/regular-expression-enforcing-at-least-one-in-two-groups", "title": "Regular expression enforcing at least one in two groups", "body": "<p>I have to parse a string using regular expressions in which at least one group in a set of two is required. I cannot figure out how to write this case.</p>\n\n<p>To illustrate the problem we can think parsing this case:</p>\n\n<pre><code>String: aredhouse theball bluegreencar the\nMatch:  \u2713         \u2713       \u2713            \u2717\n</code></pre>\n\n<ol>\n<li>Items are separated by spaces</li>\n<li><p>Each item is composed by an article, a colour and an object defined by groups in the following expression <code>(?P&lt;article&gt;the|a)?(?P&lt;colour&gt;(red|green|blue|yellow)*)(?P&lt;object&gt;car|ball|house)?\\s*</code></p></li>\n<li><p>An item can have an 'article' but must have a 'colour' or/and an 'object'.</p></li>\n</ol>\n\n<p>Is there a way of making 'article' optional but require at least one 'colour' or 'object' using regular expressions?</p>\n\n<p><a href=\"https://play.golang.org/p/98h3UPZFrgx\" rel=\"nofollow noreferrer\">Here</a> is the coded Go version of this example, however I guess this is generic regexp question that applies to any language.</p>\n"}, {"tags": ["http", "go", "http-status-code-404", "handler"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1516025577, "post_id": 48248509, "comment_id": 83512231, "body": "Also the built-in mux will use exact matches by default. It&#39;s only a prefix (directory) match if the path ends in a slash. So <code>http.Handle(&quot;&#47;pwd&quot;...</code> will match <i>only the exact path</i> <code>&#47;pwd</code>, while <code>http.Handle(&quot;&#47;pwd&#47;&quot;...</code> will match anything beginning with <code>&#47;pwd&#47;</code>, <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\">per the documentation</a>."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 4, "last_activity_date": 1515924479, "creation_date": 1515924479, "answer_id": 48248509, "question_id": 48248442, "link": "https://stackoverflow.com/questions/48248442/golang-net-http-fileserver-giving-404-on-any-pattern-other-than/48248509#48248509", "title": "Golang net/http fileserver giving 404 on any pattern other than &quot;/&quot;", "body": "<p>The <code>http.FileServer</code> as called with your <code>/pwd</code> handler will take a request for <code>/pwdmyfile</code> and will use the URI path to build the filename. This means that it will look for <code>pwdmyfile</code> in the local directory.</p>\n\n<p>I suspect you only want <code>pwd</code> as a prefix on the URI, not in the filenames themselves.</p>\n\n<p>There's an example for how to do this in the <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\">http.FileServer</a> doc:</p>\n\n<pre><code>// To serve a directory on disk (/tmp) under an alternate URL\n// path (/tmpfiles/), use StripPrefix to modify the request\n// URL's path before the FileServer sees it:\nhttp.Handle(\"/tmpfiles/\", http.StripPrefix(\"/tmpfiles/\", http.FileServer(http.Dir(\"/tmp\"))))\n</code></pre>\n\n<p>You'll want to do something similar:</p>\n\n<pre><code>http.Handle(\"/pwd\", http.StripPrefix(\"/pwd\", http.FileServer(http.Dir(\".\"))))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 11142863, "user_type": "registered", "profile_image": "https://graph.facebook.com/402094673950132/picture?type=large", "display_name": "Daniel Osorio", "link": "https://stackoverflow.com/users/11142863/daniel-osorio"}, "is_accepted": false, "score": 0, "last_activity_date": 1564497698, "creation_date": 1564497698, "answer_id": 57274303, "question_id": 48248442, "link": "https://stackoverflow.com/questions/48248442/golang-net-http-fileserver-giving-404-on-any-pattern-other-than/57274303#57274303", "title": "Golang net/http fileserver giving 404 on any pattern other than &quot;/&quot;", "body": "<p>you should write <code>http.Handle(\"/pwd\", http.FileServer(http.Dir(\"./\")))</code></p>\n\n<p>http.Dir references a system directory.</p>\n\n<p>if you want localhost/ then use <code>http.Handle(\"/pwd\", http.StripPrefix(\"/pwd\", http.FileServer(http.Dir(\"./pwd\"))))</code></p>\n\n<p>it will serve all you have into /pwd directory at localhost/</p>\n"}], "owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2189, "favorite_count": 1, "accepted_answer_id": 48248509, "answer_count": 2, "score": 1, "last_activity_date": 1564497698, "creation_date": 1515923840, "question_id": 48248442, "link": "https://stackoverflow.com/questions/48248442/golang-net-http-fileserver-giving-404-on-any-pattern-other-than", "title": "Golang net/http fileserver giving 404 on any pattern other than &quot;/&quot;", "body": "<p>Hello awesome stackoverflow community,</p>\n\n<p>Apologies for the lame question.\nI've been playing around with the net/http package in Go, and was trying to set an <code>http.Handle</code> to serve the contents of a directory. My code to the Handle is </p>\n\n<pre><code> func main() {\n     http.Handle(\"/pwd\", http.FileServer(http.Dir(\".\")))\n     http.HandleFunc(\"/dog\", dogpic)\n     err := http.ListenAndServe(\":8080\", nil)\n     if err != nil {\n         panic(err)\n     }\n } \n</code></pre>\n\n<p>My dogpic handler is using <code>os.Open</code> and an <code>http.ServeContent</code>, which is working fine.</p>\n\n<p>However, when I try to browse <code>localhost:8080/pwd</code> I am getting a 404 page not found, but when I change the pattern to route to <code>/</code>, as</p>\n\n<pre><code>http.Handle(\"/\", http.FileServer(http.Dir(\".\")))\n</code></pre>\n\n<p>it is showing the contents of the current page. Can someone please help me figure out why the <code>fileserver</code> is not working with other patterns but only <code>/</code>?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "redis"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1515915854, "post_id": 48247067, "comment_id": 83477771, "body": "Why does application get a new connection and subscribe on every message received?"}, {"owner": {"reputation": 2577, "user_id": 3512709, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/sA5RZ.jpg?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/3512709/adam"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1515915990, "post_id": 48247067, "comment_id": 83477800, "body": "Maybe I&#39;m misunderstanding how <code>redis.PubSubConn</code> is working. Each client wants to subscribe to a unique channel."}, {"owner": {"reputation": 2577, "user_id": 3512709, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/sA5RZ.jpg?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/3512709/adam"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1515916528, "post_id": 48247067, "comment_id": 83477891, "body": "I simplified my actual code, there&#39;s a channel name string that each websocket client passes."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1515917170, "post_id": 48247067, "comment_id": 83477989, "body": "Please give a high-level description of what the application is doing.  Describe the messages sent to and from the websocket client and how the messages relate to pubsub messages and channel names."}, {"owner": {"reputation": 2577, "user_id": 3512709, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/sA5RZ.jpg?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/3512709/adam"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1515919117, "post_id": 48247067, "comment_id": 83478351, "body": "A trigger in my postgres db sends a notification whenever a certain table changes. A listener in go takes that table change event and publishes it over redis. The channel name is structured in such a way that it can later be pattern matched by interested clients. Clients connect to the server via websocket and send a payload describing the types of table change events they are interested in. The channel they subscribe to is generated based on this payload. There are an infinite number of possible channel names for clients to subscribe to based on the payload."}], "answers": [{"comments": [{"owner": {"reputation": 2577, "user_id": 3512709, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/sA5RZ.jpg?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/3512709/adam"}, "edited": false, "score": 0, "creation_date": 1515965374, "post_id": 48252482, "comment_id": 83491272, "body": "Thanks for this! Just reading the code, it definitely seems like it will accomplish unsubscribing. I&#39;ll give it a try.  &quot;A more typical and scalable approach is to share a single Redis pubsub connection across multiple clients.&quot; Would it be possible to share a single pubsub connection across multiple websocket connections, but then have each websocket subscribe to a unique channel and only receive messages from that channel? I don&#39;t want a websocket receiving messages from channels it is not interested in."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 2577, "user_id": 3512709, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/sA5RZ.jpg?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/3512709/adam"}, "edited": false, "score": 1, "creation_date": 1515965922, "post_id": 48252482, "comment_id": 83491438, "body": "You will need to write a few lines of code to demultiplex the pubsub messages to share a single redis connection.  A tiny step in the right direction is to use a single Redis connection per client.  This is probably an easy change, but I don&#39;t know for sure because I don&#39;t understand what you are trying to do (there&#39;s a big gap between the high level description and the code).  If a client can only subscribe to a single redis channel, then the change is simple."}, {"owner": {"reputation": 2577, "user_id": 3512709, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/sA5RZ.jpg?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/3512709/adam"}, "edited": false, "score": 0, "creation_date": 1515969011, "post_id": 48252482, "comment_id": 83492254, "body": "&quot;You will need to write a few lines of code to demultiplex the pubsub messages to share a single redis connection.&quot; Imagine if I have 10k websocket connections and 1k table change events per second. I&#39;ll then need to be doing 10MM message demultiplexes per second. I could demultiplex messages per websocket client without redis and simply use postgres notify / listen. I chose to add redis to shift the burden of that demultiplexing off my server and onto redis."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 2577, "user_id": 3512709, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/sA5RZ.jpg?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/3512709/adam"}, "edited": false, "score": 1, "creation_date": 1515970567, "post_id": 48252482, "comment_id": 83492671, "body": "You need to demux 1k events per second, not 10mm. Sending the data to Redis and back will not offload work from the frontend server because the cost of demuxing an event (it&#39;s basically a map lookup) is tiny compared to the cost of sending or receiving a Redis message."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1515952561, "creation_date": 1515952561, "answer_id": 48252482, "question_id": 48247067, "link": "https://stackoverflow.com/questions/48247067/closing-a-redis-subscription-and-ending-the-go-routine-when-websocket-connection/48252482#48252482", "title": "Closing a redis subscription and ending the go routine when websocket connection closes", "body": "<p>Make these changes to break out of the read loop when done serving the websocket connection:</p>\n\n<ul>\n<li><p>Maintain a slice of the Redis connections created for this websocket connection.</p></li>\n<li><p>Unsubscribe all connections when done.</p></li>\n<li><p>Modify the read loop to return when the subscription count is zero.</p></li>\n</ul>\n\n<p>Here's the code:</p>\n\n<pre><code>func wsHandler(w http.ResponseWriter, r *http.Request) {\n    var upgrader = websocket.Upgrader{\n        ReadBufferSize:  1024,\n        WriteBufferSize: 1024,\n    }\n\n    conn, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        HandleError(w, err)\n        return\n    }\n    defer conn.Close()\n\n    // Keep slice of all connections. Unsubscribe all connections on exit.\n    var pscs []redis.PubSubConn\n    defer func() {\n        for _, psc := range rcs {\n           psc.Unsubscribe() // unsubscribe with no args unsubs all channels\n        }\n    }()\n\n    for {\n        var req WSRequest\n        err := conn.ReadJSON(&amp;req)\n        if err != nil {\n            HandleWSError(conn, err)\n            return\n        }\n\n        rc := redisPool.Get()\n        psc := redis.PubSubConn{Conn: rc}\n        pscs = append(pscs, psc)\n\n        if err := psc.PSubscribe(req.chanName); err != nil {\n            HandleWSError(conn, err)\n            return\n        }\n\n        go func(req *WSRequest, conn *websocket.Conn) {\n            defer rc.Close()\n            for {\n                switch v := psc.Receive().(type) {\n                case redis.PMessage:\n                    err := handler(conn, req, v)\n                    if err != nil {\n                        HandleWSError(conn, err)\n                    }\n\n                case redis.Subscription:\n                     log.Printf(\"%s: %s %d\\n\", v.Channel, v.Kind, v.Count)\n                     if v.Count == 0 {\n                         return\n                     }\n\n                case error:\n                     log.Printf(\"error in redis subscription; err:\\n%v\\n\", v)\n                     HandleWSError(conn, v)\n\n                default:\n                    // do nothing...\n                    log.Printf(\"unknown redis subscription event type; %s\\n\", reflect.TypeOf(v))\n                }\n            }\n        }(&amp;req, conn)\n    }\n}\n</code></pre>\n\n<p>The code in the question and this answer dial multiple Redis connections for each websocket client. A more typical and scalable approach is to share a single Redis pubsub connection across multiple clients. The typical approach may be appropriate for your application given the high-level description, but I am still unsure of what you are trying to do given the code in the question.</p>\n"}], "owner": {"reputation": 2577, "user_id": 3512709, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/sA5RZ.jpg?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/3512709/adam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1074, "favorite_count": 0, "accepted_answer_id": 48252482, "answer_count": 1, "score": 0, "last_activity_date": 1515952561, "creation_date": 1515909519, "last_edit_date": 1515916588, "question_id": 48247067, "link": "https://stackoverflow.com/questions/48247067/closing-a-redis-subscription-and-ending-the-go-routine-when-websocket-connection", "title": "Closing a redis subscription and ending the go routine when websocket connection closes", "body": "<p>I'm pushing events from a redis subscription to a client who is connected via websocket. I'm having trouble unsubscribing and exiting the redis go routine when the client disconnects the websocket.</p>\n\n<p>Inspired by <a href=\"https://stackoverflow.com/questions/35510557/how-to-kill-blocking-go-routine\">this post</a>, here's what I have thus far. I'm able to receive subscription events and send messages to the client via websocket, but when the client closes the websocket and the <code>defer close(done)</code> code fires, my <code>case b, ok := &lt;-done:</code> doesn't fire. It seems to be overloaded by the default case???</p>\n\n\n\n<pre><code>package api\n\nimport (\n    ...\n\n    \"github.com/garyburd/redigo/redis\"\n    \"github.com/gorilla/websocket\"\n)\n\nfunc wsHandler(w http.ResponseWriter, r *http.Request) {\n    var upgrader = websocket.Upgrader{\n        ReadBufferSize:  1024,\n        WriteBufferSize: 1024,\n    }\n\n    conn, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        HandleError(w, err)\n        return\n    }\n    defer conn.Close()\n\n    done := make(chan bool)\n    defer close(done)\n\n    for {\n        var req WSRequest\n        err := conn.ReadJSON(&amp;req)\n        if err != nil {\n            HandleWSError(conn, err)\n            return\n        }\n        defer conn.Close()\n\n        go func(done chan bool, req *WSRequest, conn *websocket.Conn) {\n            rc := redisPool.Get()\n            defer rc.Close()\n\n            psc := redis.PubSubConn{Conn: rc}\n            if err := psc.PSubscribe(req.chanName); err != nil {\n                HandleWSError(conn, err)\n                return\n            }\n            defer psc.PUnsubscribe()\n\n            for {\n                select {\n                case b, ok := &lt;-done:\n                    if !ok || b == true {\n                        return\n                    }\n                default:\n                    switch v := psc.Receive().(type) {\n                    case redis.PMessage:\n                        err := handler(conn, req, v)\n                        if err != nil {\n                            HandleWSError(conn, err)\n                        }\n\n                    case redis.Subscription:\n                         log.Printf(\"%s: %s %d\\n\", v.Channel, v.Kind, v.Count)\n\n                    case error:\n                         log.Printf(\"error in redis subscription; err:\\n%v\\n\", v)\n                         HandleWSError(conn, v)\n\n                    default:\n                        // do nothing...\n                        log.Printf(\"unknown redis subscription event type; %s\\n\", reflect.TypeOf(v))\n                    }\n                }\n            }\n        }(done, &amp;req, conn)\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 4, "creation_date": 1515874521, "post_id": 48243892, "comment_id": 83470291, "body": "What do you mean by &#39;memory representation&#39;?"}, {"owner": {"reputation": 9300, "user_id": 409102, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/060588f22d2a4c5e049156f23fcf1405?s=128&d=identicon&r=PG", "display_name": "kravemir", "link": "https://stackoverflow.com/users/409102/kravemir"}, "reply_to_user": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1597316911, "post_id": 48243892, "comment_id": 112096257, "body": "@Grzegorz\u017bur this is actually a good question, asking about how are multiple values represented in memory - stored in registers, or on stack, or allocate memory on heap,..."}], "answers": [{"tags": [], "owner": {"reputation": 2137, "user_id": 90797, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7pblP.jpg?s=128&g=1", "display_name": "Virmundi", "link": "https://stackoverflow.com/users/90797/virmundi"}, "is_accepted": true, "score": 2, "last_activity_date": 1515939547, "creation_date": 1515939547, "answer_id": 48250477, "question_id": 48243892, "link": "https://stackoverflow.com/questions/48243892/golang-return-multiple-values-memory-representation/48250477#48250477", "title": "Golang return multiple values memory representation", "body": "<p>What it sounds like you're looking for is the stack frame design of Go. I'm not going into the details here, but you may find it helpful to read <a href=\"https://blog.cloudflare.com/how-stacks-are-handled-in-go/\" rel=\"nofollow noreferrer\">about it here</a>.</p>\n\n<p>In general the compiler can place multiple returns on the out space for the function call. Think an array as a result. The compiler then knows how to access the space on the stack for the subsequent caller.</p>\n"}], "owner": {"reputation": 2364, "user_id": 2226753, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9f4aaabdbd6fc131a2d3503c07d94f6b?s=128&d=identicon&r=PG", "display_name": "Seneca", "link": "https://stackoverflow.com/users/2226753/seneca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 48250477, "answer_count": 1, "score": 0, "last_activity_date": 1515939547, "creation_date": 1515874330, "question_id": 48243892, "link": "https://stackoverflow.com/questions/48243892/golang-return-multiple-values-memory-representation", "title": "Golang return multiple values memory representation", "body": "<p>When a function returns multiple values in go, what's the memory representation of those <code>multiple values</code> when returned?</p>\n"}, {"tags": ["go", "exception", "httpclient", "panic"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 4, "creation_date": 1515859771, "post_id": 48241532, "comment_id": 83465672, "body": "Why are you logging with fatal if you want to catch the error? Just replace <code>log.Fatal(err)</code> with whatever error handling you want to do. Or am I missing something? If you&#39;re ok ignoring it, just use <code>log.Print</code> to log the error and continue."}, {"owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1515860050, "post_id": 48241532, "comment_id": 83465740, "body": "@Marc OMG, I just opened <code>log.Fatal(err)</code> and realised, that it is not just about logging, but <code>os.Exit(1)</code>. Thank you."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1515860253, "post_id": 48241532, "comment_id": 83465816, "body": "And please note that <code>Fatal</code> is not a panic, so it cannot be recovered. It should only be used for unrecoverable errors. Everything else should <code>panic</code> or return the error."}, {"owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1515860554, "post_id": 48241532, "comment_id": 83465923, "body": "@Marc, I got you, thanks"}], "answers": [{"tags": [], "owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "is_accepted": true, "score": 0, "last_activity_date": 1515860150, "creation_date": 1515860150, "answer_id": 48241723, "question_id": 48241532, "link": "https://stackoverflow.com/questions/48241532/how-to-catch-panic-when-http-client-make-request-to-unavailable-url/48241723#48241723", "title": "How to catch panic when HTTP client make request to unavailable url?", "body": "<p>The problem is:</p>\n\n<pre><code>log.Fatal(err)\n</code></pre>\n\n<p>This function performs two things. Firstly, it logs. But this function exits too. </p>\n\n<pre><code>// Fatal is equivalent to Print() followed by a call to os.Exit(1).\nfunc Fatal(v ...interface{}) {\n    std.Output(2, fmt.Sprint(v...))\n    os.Exit(1)\n}\n</code></pre>\n"}], "owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 570, "favorite_count": 0, "accepted_answer_id": 48241723, "answer_count": 1, "score": -2, "last_activity_date": 1556462405, "creation_date": 1515858991, "last_edit_date": 1556462405, "question_id": 48241532, "link": "https://stackoverflow.com/questions/48241532/how-to-catch-panic-when-http-client-make-request-to-unavailable-url", "title": "How to catch panic when HTTP client make request to unavailable url?", "body": "<p>I need to make request to some URLs. It is possible, that someone of them is unavailable. It is OK for me, and I want just ignore these URLs. </p>\n\n<p>My problem is I cannot catch error, which is occurs. I get a error message:</p>\n\n<pre><code>2018/01/13 18:46:24 Get http://fakesite.com: dial tcp [::1]:8084: connectex: No connection could be made because the target machine actively refused it.\n</code></pre>\n\n<p>My sample code is:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n    c := make(chan string, 1)\n\n    go func() {\n        defer func() {\n            if r := recover(); r != nil {\n                fmt.Println(\"try to catch error1\", r)\n            }\n        }()\n\n        resp, err := http.Get(\"http://fakesite.com\")\n        if err != nil {\n            log.Fatal(err)\n            c &lt;- \"\"\n            return\n        }\n\n        defer resp.Body.Close()\n        body, err := ioutil.ReadAll(resp.Body)\n        if err != nil {\n            log.Fatal(err)\n            c &lt;- \"\"\n            return\n        }\n\n        c &lt;- string(body)\n    }()\n\n\n    defer func() {\n        if r := recover(); r != nil {\n            fmt.Println(\"try to catch error2\", r)\n        }\n    }()\n\n    msg := &lt;-c\n    fmt.Println(msg)\n}\n</code></pre>\n"}, {"tags": ["c", "string", "go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515858504, "post_id": 48241246, "comment_id": 83465274, "body": "This is kind of a confused example. You don&#39;t need to allocate C strings in Go if you&#39;re only going to go and allocate the again in C. Your output parameters also need to be a pointer to what you want you want to replace, i.e. <code>char** buffer</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1392416"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515860321, "post_id": 48241246, "comment_id": 83465844, "body": "This would be really strange with <code>char**</code>. How can I wrap standard functions like <code>char * strcpy(char *dest, char *src);</code>? I am sure the c-function have the correct signatures (without thinking of golang)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1515860968, "post_id": 48241246, "comment_id": 83466032, "body": "Well <code>strcpy</code> doesn\u2019t allocate itself, while your functions do. If you want to work like that, then allocate the correct buffer size before hand and reuse it."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1392416"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515864380, "post_id": 48241246, "comment_id": 83467131, "body": "I see, you&#39;re right! Although, it does not answer the question. If there would be not enough buffer, the app wouldcrash, right? But I just get &quot;&quot;."}, {"owner": {"reputation": 18942, "user_id": 894328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3db17c5296335f63e856be44aa821bf6?s=128&d=identicon&r=PG", "display_name": "Ahmed Masud", "link": "https://stackoverflow.com/users/894328/ahmed-masud"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1515876405, "post_id": 48241246, "comment_id": 83470790, "body": "@leafbebop nope that&#39;s not it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1516124032, "post_id": 48241246, "comment_id": 83558428, "body": "@wieschoo: no the app might not crash, because C is not a memory-safe language like Go, and has no automatic bounds checking. You are free to corrupt your own program&#39;s memory however you want."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515896792, "post_id": 48246127, "comment_id": 83474978, "body": "Both of your <code>c_dst</code> are only allocating an empty string (or a single null byte), and then passing them as appropriately sized buffers to the c functions causing buffer overflows. Best case you segfault, but more likely you\u2019re silently currupting the program memory."}], "tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": false, "score": -1, "last_activity_date": 1515896292, "creation_date": 1515896292, "answer_id": 48246127, "question_id": 48241246, "link": "https://stackoverflow.com/questions/48241246/return-strings-from-c-function-in-golang/48246127#48246127", "title": "Return strings from c function in Golang", "body": "<p>You don't need to handle memory allocation in c if you initialize the strings in Go using <code>C.String</code> </p>\n\n<blockquote>\n  <p>// Go string to C string // The C string is allocated in the C heap\n  using malloc. // It is the caller's responsibility to arrange for it\n  to be // freed, such as by calling C.free (be sure to include stdlib.h\n  // if C.free is needed). func C.CString(string) *C.char</p>\n</blockquote>\n\n<p>You can use c.GoString() to convert the C.String back in to go string. Below is a working code snippet of your sample.</p>\n\n<pre><code>package main\n\n/*\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\nvoid my_reverse(char* src, char *dst){\n  printf(\"[c-part] src=%s\\n\", src);\n  int n = strlen(src);\n  for (int i = 0; i &lt; n ; ++i)\n  {\n    dst[i] = src[n - 1 - i];\n  }\n  dst[n] = 0;\n  printf(\"[c-part] dst=%s\\n\", dst);\n}\n\nvoid some_text(char* buffer, unsigned long long int *year){\n  sscanf(\"year 2018d\", \"%s %16llu\", buffer, year);\n  printf(\"will return (%s, %16llu)\\n\", buffer, *year);\n}\n*/\nimport \"C\"\n\nimport \"unsafe\"\nimport \"fmt\"\n\nfunc Reverse(a string) (dst string) {\n    c_src := C.CString(a)\n    defer C.free(unsafe.Pointer(c_src))\n    c_dst := C.CString(dst)\n    defer C.free(unsafe.Pointer(c_dst))\n    C.my_reverse(c_src, c_dst)\n    return C.GoString(c_dst)\n}\n\nfunc Sometext() (dst string, year int64) {\n    c_dst := C.CString(\"\")\n    c_year := C.ulonglong(0)\n    defer C.free(unsafe.Pointer(c_dst))\n    C.some_text(c_dst, &amp;c_year)\n    return C.GoString(c_dst), int64(c_year)\n}\n\nfunc main() {\n    fmt.Printf(\"[gopart] dst=%v\\n\\n\\n\", Reverse(\"Hello World\"))\n\n    buf, year := Sometext()\n    fmt.Printf(\"received (%v, %v)\\n\", buf, year)\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1392416"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1463, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1515896292, "creation_date": 1515856838, "question_id": 48241246, "link": "https://stackoverflow.com/questions/48241246/return-strings-from-c-function-in-golang", "title": "Return strings from c function in Golang", "body": "<p>I am trying to a call <em>C</em> function in <em>GO</em>. This works to some extends (for integers). However, there are issues\nA minimal example is given below</p>\n\n<pre><code>package main\n\n/*\n#include &lt;string.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n\nvoid my_reverse(char* src, int len, char *dst){\n  dst = malloc(sizeof(char) * (len + 1));\n  printf(\"[c-part] src=%s\\n\", src);\n  for (int i = 0; i &lt; len; ++i)\n  {\n    dst[i] = src[len - 1 - i];\n  }\n  dst[len] = 0;\n  printf(\"[c-part] dst=%s\\n\", dst);\n}\n\nvoid some_text(char* buffer, unsigned long long int *year){\n  buffer = malloc(200 * sizeof(char));\n  sscanf(\"year 2018d\", \"%s %16llu\", buffer, year);\n  printf(\"will return (%s, %16llu)\\n\", buffer, *year);\n\n}\n*/\nimport \"C\"\n\nimport \"unsafe\"\nimport \"fmt\"\n\nfunc Reverse(a string) (dst string) {\n\n    c_src := C.CString(a)\n    defer C.free(unsafe.Pointer(c_src))\n    c_len := C.int(len(a))\n    c_dst := C.CString(dst)\n    defer C.free(unsafe.Pointer(c_dst))\n\n    C.my_reverse(c_src, c_len, c_dst)\n\n    return string(*c_dst)\n\n}\n\nfunc Sometext() (dst string, year int64) {\n\n    c_dst := C.CString(\"\")\n    c_year := C.ulonglong(0)\n    defer C.free(unsafe.Pointer(c_dst))\n\n    C.some_text(c_dst, &amp;c_year)\n\n    return string(*c_dst), int64(c_year)\n\n}\n\nfunc main() {\n    fmt.Printf(\"[gopart] dst=%v\\n\\n\\n\", Reverse(\"Hello World\"))\n\n    buf, year := Sometext()\n    fmt.Printf(\"received (%v, %v)\\n\", buf, year)\n}\n</code></pre>\n\n<p>These are two c-function, which allocate a new buffer in c. \nHowever, I get the output</p>\n\n<pre><code>[c-part] src=Hello World\n[c-part] dst=dlroW olleH\n[gopart] dst=\n\n\nwill return (year,             2018)\nreceived (, 2018)\n</code></pre>\n\n<p>This means, these strings are available in C.But I can never use these strings in GO afterwards.\nDoes the Go-Garbage collector remove the string before I can use it?</p>\n\n<p>I expect to see</p>\n\n<pre><code>[gopart] dst=dlroW olleH\nreceived (year, 2018)\n</code></pre>\n\n<p>there as well.</p>\n"}, {"tags": ["go", "configuration", "viper-go"], "comments": [{"owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1515857126, "post_id": 48240461, "comment_id": 83464886, "body": "@Kavesh can you share the yaml version which you are referring?"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "reply_to_user": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1515857795, "post_id": 48240461, "comment_id": 83465063, "body": "@Anuruddha This gist: <a href=\"https://gist.github.com/dc0d/7cb146f6650259d6f299223ff410ecc9\" rel=\"nofollow noreferrer\">gist.github.com/dc0d/7cb146f6650259d6f299223ff410ecc9</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1515856416, "post_id": 48241130, "comment_id": 83464654, "body": "I&#39;ve checked it and this works correctly with <code>hcl</code> package. Also it works correctly with <code>viper</code> and <code>yaml</code>."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1515856740, "post_id": 48241130, "comment_id": 83464761, "body": "I have updated the question. Please consider reviewing the edit too."}], "tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": false, "score": 5, "last_activity_date": 1515855931, "creation_date": 1515855931, "answer_id": 48241130, "question_id": 48240461, "link": "https://stackoverflow.com/questions/48240461/unmarshal-hcl-to-struct-using-viper/48241130#48241130", "title": "Unmarshal hcl to struct using viper", "body": "<p>Your conf struct is not matching the HCL. When converted to json the HCL looks like below</p>\n\n<pre><code>{\n\"NATS\": [\n    {\n      \"HTTPPort\": 10044,\n      \"Password\": \"__Psw__4433__\",\n      \"Port\": 10041,\n      \"Username\": \"cl1\"\n    }\n  ]\n}\n</code></pre>\n\n<p>So the <code>Conf</code> Struct should look like this</p>\n\n<pre><code>type Conf struct {\n    NATS []struct{\n        HTTPPort int\n        Port     int\n        Username string\n        Password string\n    }\n}\n</code></pre>\n\n<p>Modified code</p>\n\n<pre><code>package main\nimport (\n  \"log\"\n  \"github.com/spf13/viper\"\n  \"fmt\"\n)\n\ntype Conf struct {\n    NATS []struct{\n        HTTPPort int\n        Port     int\n        Username string\n        Password string\n    }\n}\n\nfunc main() {\n    var c Conf\n    // config file\n    viper.SetConfigName(\"draft\")\n    viper.AddConfigPath(\".\")\n    viper.SetConfigType(\"hcl\")\n    if err := viper.ReadInConfig(); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(viper.Get(\"NATS\")) // gives [map[port:10041 username:cl1 password:__Psw__4433__ http_port:10044]]\n\n    if err := viper.Unmarshal(&amp;c); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(c.NATS[0].Username)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 4323723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26a47d3c31a2e11bbb78e08146c84c40?s=128&d=identicon&r=PG&f=1", "display_name": "FredQ", "link": "https://stackoverflow.com/users/4323723/fredq"}, "is_accepted": false, "score": 1, "last_activity_date": 1593206981, "creation_date": 1593206981, "answer_id": 62603083, "question_id": 48240461, "link": "https://stackoverflow.com/questions/48240461/unmarshal-hcl-to-struct-using-viper/62603083#62603083", "title": "Unmarshal hcl to struct using viper", "body": "<p>I know this question is more than two years old now, but I came across the same issue recently.</p>\n<p>I'm using viper to be able to load different configuration files into a Go struct, allowing configuration in JSON, YAML, TOML, HCL, just pick your favourite :)</p>\n<p>HCL file format does wrap a map into a slice because it allows redefining a section like:</p>\n<pre><code>section = {\n  key1 = &quot;value&quot;\n}\n\nsection = {\n  key2 = &quot;value&quot;\n}\n</code></pre>\n<p>which is something that is not supported by the other formats.</p>\n<p>And here's how I fixed it:</p>\n<ul>\n<li>My solution implies each new block will override any previous definition of the same key, and keep all the others. You can do some merging magic but I didn't need to.</li>\n</ul>\n<ol>\n<li>You need to make a hook to convert a slice of maps into a map:</li>\n</ol>\n<pre><code>// sliceOfMapsToMapHookFunc merges a slice of maps to a map\nfunc sliceOfMapsToMapHookFunc() mapstructure.DecodeHookFunc {\n    return func(from reflect.Type, to reflect.Type, data interface{}) (interface{}, error) {\n        if from.Kind() == reflect.Slice &amp;&amp; from.Elem().Kind() == reflect.Map &amp;&amp; (to.Kind() == reflect.Struct || to.Kind() == reflect.Map) {\n            source, ok := data.([]map[string]interface{})\n            if !ok {\n                return data, nil\n            }\n            if len(source) == 0 {\n                return data, nil\n            }\n            if len(source) == 1 {\n                return source[0], nil\n            }\n            // flatten the slice into one map\n            convert := make(map[string]interface{})\n            for _, mapItem := range source {\n                for key, value := range mapItem {\n                    convert[key] = value\n                }\n            }\n            return convert, nil\n        }\n        return data, nil\n    }\n}\n\n</code></pre>\n<ol start=\"2\">\n<li>then you need to create a DecodeHook:</li>\n</ol>\n<pre><code>configOption := viper.DecodeHook(mapstructure.ComposeDecodeHookFunc(\n        sliceOfMapsToMapHookFunc(),\n        mapstructure.StringToTimeDurationHookFunc(),\n        mapstructure.StringToSliceHookFunc(&quot;,&quot;),\n    ))\n</code></pre>\n<p>the two other hooks are the default ones so you might want to keep them</p>\n<p>then you pass the option to the Unmarshal method</p>\n<pre><code>viper.Unmarshal(&amp;c, configOption)\n</code></pre>\n<p>With this method you don't need a slice around your structs or your maps. Also that makes it compatible with the other configuration file formats</p>\n"}], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1884, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1593206981, "creation_date": 1515851036, "last_edit_date": 1515856672, "question_id": 48240461, "link": "https://stackoverflow.com/questions/48240461/unmarshal-hcl-to-struct-using-viper", "title": "Unmarshal hcl to struct using viper", "body": "<p>Trying to <code>Unmarshal</code> a <code>hcl</code> config file to a struct, using <code>viper</code>, this error is returned: <code>1 error(s) decoding:\\n\\n* 'NATS' expected a map, got 'slice'</code>. What is missing?</p>\n\n<p>The code:</p>\n\n<pre><code>func lab() {\n    var c conf\n\n    // config file\n    viper.SetConfigName(\"draft\")\n    viper.AddConfigPath(\".\")\n    viper.SetConfigType(\"hcl\")\n    if err := viper.ReadInConfig(); err != nil {\n        log.Error(err)\n        return\n    }\n\n    log.Info(viper.Get(\"NATS\")) // gives [map[port:10041 username:cl1 password:__Psw__4433__ http_port:10044]]\n\n    if err := viper.Unmarshal(&amp;c); err != nil {\n        log.Error(err)\n        return\n    }\n\n    log.Infow(\"got conf\", \"conf\", c)\n}\n\ntype conf struct {\n    NATS struct {\n        HTTPPort int\n        Port     int\n        Username string\n        Password string\n    }\n}\n</code></pre>\n\n<p>And the config file (<code>draft.hcl</code> inside current directory):</p>\n\n<pre><code>NATS {\n    HTTPPort = 10044\n    Port     = 10041\n    Username = \"cl1\"\n    Password = \"__Psw__4433__\"\n}\n</code></pre>\n\n<p><strong>Edit</strong></p>\n\n<p>Have checked this struct with <code>hcl</code> package and it gets marshaled/unmarshalled correctly. Also this works correctly with <code>yaml</code> and <code>viper</code>.</p>\n\n<p>There is a difference between these two where <code>log.Info(viper.Get(\"NATS\"))</code> is called. While the <code>hcl</code> version returns a slice of maps, the <code>yaml</code> version returns a map: <code>map[password:__psw__4433__ httpport:10044 port:10041 username:cl1]</code>.</p>\n"}, {"tags": ["validation", "go", "hostname", "domain-name"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 2, "creation_date": 1515842077, "post_id": 48239113, "comment_id": 83460887, "body": "Currently, there is no solution using standard library only. You need to use third party library/regex. However, if you need to support <i>internationalized domain name</i>, the task may not trivial. See <a href=\"https://stackoverflow.com/questions/11809631/fully-qualified-domain-name-validation\">https://stackoverflow.com/questions/11809631/fully-qualified&zwnj;&#8203;-domain-name-validat&zwnj;&#8203;ion</a>, <a href=\"https://stackoverflow.com/questions/3523028/valid-characters-of-a-hostname\">https://stackoverflow.com/questions/3523028/valid-characters&zwnj;&#8203;-of-a-hostname</a>"}], "answers": [{"comments": [{"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1530001012, "post_id": 48239288, "comment_id": 89067567, "body": "It allows underscore in domain names which is wrong. See RFC1034 section 3.5. A later change to this RFC is to allow digits as first label character. The TLD label can&#39;t start with a digit to avoid confusion between domain names and IPv4 addresses."}], "tags": [], "owner": {"reputation": 114, "user_id": 6818792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lV3xs.jpg?s=128&g=1", "display_name": "phlummox", "link": "https://stackoverflow.com/users/6818792/phlummox"}, "is_accepted": false, "score": 1, "last_activity_date": 1515841807, "creation_date": 1515841807, "answer_id": 48239288, "question_id": 48239113, "link": "https://stackoverflow.com/questions/48239113/how-to-check-whether-hostname-is-domain-name-in-go/48239288#48239288", "title": "How to check whether hostname is domain name in Go?", "body": "<p>The function <a href=\"https://godoc.org/github.com/asaskevich/govalidator#IsDNSName\" rel=\"nofollow noreferrer\">IsDNSName</a> from the <code>govalidator</code> package should do what you want. For details on installing it, see the <a href=\"https://github.com/asaskevich/govalidator/blob/master/README.md\" rel=\"nofollow noreferrer\">README</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "is_accepted": false, "score": 3, "last_activity_date": 1530288427, "creation_date": 1530288427, "answer_id": 51105699, "question_id": 48239113, "link": "https://stackoverflow.com/questions/48239113/how-to-check-whether-hostname-is-domain-name-in-go/51105699#51105699", "title": "How to check whether hostname is domain name in Go?", "body": "<p>See my code <a href=\"https://gist.github.com/chmike/d4126a3247a6d9a70922fc0e8b4f4013\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>The function checks if the provided domain name is valid relative to the rules. It doesn't check if the domain name exist.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5846, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1594036163, "creation_date": 1515840425, "question_id": 48239113, "link": "https://stackoverflow.com/questions/48239113/how-to-check-whether-hostname-is-domain-name-in-go", "title": "How to check whether hostname is domain name in Go?", "body": "<p>How can I check whether <a href=\"https://golang.org/pkg/net/url/#URL.Hostname\" rel=\"nofollow noreferrer\">URL.Hostname</a> is a valid domain name? I am searching for the exact same behaviour as <a href=\"https://docs.microsoft.com/de-de/dotnet/api/system.uri.checkhostname\" rel=\"nofollow noreferrer\">URI.CheckHostName</a> in the .NET framework. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "edited": false, "score": 1, "creation_date": 1515817717, "post_id": 48236901, "comment_id": 83456391, "body": "Delete both strings, and type them back in."}, {"owner": {"reputation": 451, "user_id": 2243777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4410a797c941eec0f2a81abd5f1345d8?s=128&d=identicon&r=PG", "display_name": "Cadel Watson", "link": "https://stackoverflow.com/users/2243777/cadel-watson"}, "reply_to_user": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "edited": false, "score": 1, "creation_date": 1515817835, "post_id": 48236901, "comment_id": 83456408, "body": "Ugh, that was it. Should&#39;ve tried that at the start. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 7, "last_activity_date": 1515817876, "creation_date": 1515817876, "answer_id": 48236927, "question_id": 48236901, "link": "https://stackoverflow.com/questions/48236901/string-literal-in-struct-is-longer-than-the-same-string-outside-struct/48236927#48236927", "title": "String literal in struct is longer than the same string outside struct", "body": "<p>One string starts with two zero width spaces (\\u200b).  The other starts with one.</p>\n\n<p>In situations like this, it's helpful to print using %q to see what's going on. See <a href=\"https://play.golang.org/p/oRCjuN5X7Ti\" rel=\"noreferrer\">the playground example</a>.</p>\n"}], "owner": {"reputation": 451, "user_id": 2243777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4410a797c941eec0f2a81abd5f1345d8?s=128&d=identicon&r=PG", "display_name": "Cadel Watson", "link": "https://stackoverflow.com/users/2243777/cadel-watson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1515817876, "creation_date": 1515817534, "question_id": 48236901, "link": "https://stackoverflow.com/questions/48236901/string-literal-in-struct-is-longer-than-the-same-string-outside-struct", "title": "String literal in struct is longer than the same string outside struct", "body": "<p>I'm running into a really weird issue in my Go code. It seems that identical strings, one declared inside a struct and one outside, have different lengths when used. The following code shows an example:</p>\n\n<pre><code>type evaluateTest struct {\n    name     string\n    expected int\n    fen      string\n\n}\n\nfunc TestEvaluate(t *testing.T) {\n    cases := []evaluateTest{\n        {\"Pawn testing\",  330, \"\u200b\u200b8/8/8/8/4P3/3P4/2P5/8 w KQkq - 0 11\"},\n    }\n\n    for _, test := range cases {\n        outside := \"\u200b8/8/8/8/4P3/3P4/2P5/8 w KQkq - 0 11\"\n        fmt.Printf(\"String in struct has length %v\\n\", len(test.fen))\n        fmt.Printf(\"String outside struct has length %v\\n\", len(outside))\n</code></pre>\n\n<p>This outputs:</p>\n\n<pre><code>String in struct has length 41\nString outside struct has length 38\n</code></pre>\n\n<p>Looping through the string and printing the character codes gives junk characters in the first three positions (decimal 226, 128, 139) of the string in the struct, and none in the one declared outside.</p>\n\n<p>I'm really at a loss as to what's going on here. Any help is very appreciated.</p>\n"}, {"tags": ["go", "data-structures"], "comments": [{"owner": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "edited": false, "score": 1, "creation_date": 1515814142, "post_id": 48236601, "comment_id": 83455965, "body": "You forgot &quot;borrows my pen.&quot;  That&#39;s arguably the most important attribute, without which all the rest are irrelevant."}, {"owner": {"reputation": 521, "user_id": 5587653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tIRpk.jpg?s=128&g=1", "display_name": "Grace", "link": "https://stackoverflow.com/users/5587653/grace"}, "reply_to_user": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "edited": false, "score": 0, "creation_date": 1515818201, "post_id": 48236601, "comment_id": 83456478, "body": "I was going back and forth on adding &quot;at Citibank we will meet accidentally&quot; and &quot;We start to talk when she borrows my pen&quot;, and whether they should be one thing or two."}], "answers": [{"comments": [{"owner": {"reputation": 521, "user_id": 5587653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tIRpk.jpg?s=128&g=1", "display_name": "Grace", "link": "https://stackoverflow.com/users/5587653/grace"}, "edited": false, "score": 0, "creation_date": 1515818946, "post_id": 48236662, "comment_id": 83456568, "body": "I hadn&#39;t considered this! Would you suggest some enum-type constants for addressing these in code, then? <code>girl.Has(constFast)</code>, <code>girl.Set(constIsSharpAsATack)</code>"}, {"owner": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "reply_to_user": {"reputation": 521, "user_id": 5587653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tIRpk.jpg?s=128&g=1", "display_name": "Grace", "link": "https://stackoverflow.com/users/5587653/grace"}, "edited": false, "score": 0, "creation_date": 1515820535, "post_id": 48236662, "comment_id": 83456829, "body": "@GrantHill: Yeah, something like that."}], "tags": [], "owner": {"reputation": 205167, "user_id": 4323, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/qqgFU.png?s=128&g=1", "display_name": "John Zwinck", "link": "https://stackoverflow.com/users/4323/john-zwinck"}, "is_accepted": false, "score": 3, "last_activity_date": 1515813989, "creation_date": 1515813989, "answer_id": 48236662, "question_id": 48236601, "link": "https://stackoverflow.com/questions/48236601/most-elegant-way-to-represent-lots-of-fields/48236662#48236662", "title": "Most elegant way to represent lots of fields", "body": "<p>I'd use a uint64 as a bitset (or an actual bitset type, of which none are built in but some are open source).  It meets your requirements in the following ways:</p>\n\n<ul>\n<li>JSON storage as \"010101\" string or base64 (11 chars).</li>\n<li>Easy display: just define an array of the strings in the same order they are stored in the bitset.</li>\n<li>Easily count how many are \"set\" - use \"popcount\" (open source implementations are easy to come by).</li>\n<li>Order is naturally preserved--the first attribute will always be bit 0, etc.</li>\n</ul>\n\n<p>If you have more than 64 attributes, you can use <code>math/big</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1515826921, "creation_date": 1515826921, "answer_id": 48237654, "question_id": 48236601, "link": "https://stackoverflow.com/questions/48236601/most-elegant-way-to-represent-lots-of-fields/48237654#48237654", "title": "Most elegant way to represent lots of fields", "body": "<p>You can use map[int]interface{} to store the value of any length inside the interface with integer as key or you can also use slice of interface for looping inside the data like this []interface{}. Later on you can easily type assert the interface to get underlying value which is string in your case.\nSince it will be slice of interface or map of interface you can easily marshal it to convert it into json and save into file which can be read or write easily.</p>\n"}], "owner": {"reputation": 521, "user_id": 5587653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tIRpk.jpg?s=128&g=1", "display_name": "Grace", "link": "https://stackoverflow.com/users/5587653/grace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1515826921, "creation_date": 1515813131, "question_id": 48236601, "link": "https://stackoverflow.com/questions/48236601/most-elegant-way-to-represent-lots-of-fields", "title": "Most elegant way to represent lots of fields", "body": "<p>So, I have this list of attributes that I would like to represent in my Go code. That is, I'm looking for some data structure that can convey all these.</p>\n\n<pre><code>Mind like a diamond\nKnows what's best\nShoes that cut                                                                                                                                                                                    \nEyes that burn like cigarettes\nThe right allocations\nFast                                                                                                                                                                                              \nThorough\nSharp as a tack\nPlaying with her jewellry\nPutting up her hair\nTouring the facilities                                                                                                                                                                            \nPicking up slack\nShort skirt\nLong jacket                                                                                                                                                                                       \nGets up early\nStays up late\nUninterrupted prosperity\nUses a machete to cut through red tape\nFingernails that shine like justice\nVoice that is dark like tinted glass\nSmooth liquidation\nRight dividends\nWants a car with a cupholder arm rest\nWants a car that will get her there\nChanging her name from Kitty to Karen\nTrading her MG for a white Chrysler LeBaron\n</code></pre>\n\n<p>They're not going to change any time soon, but I will want to do the following things with them:</p>\n\n<ul>\n<li>Read them from and write them to a JSON file.</li>\n<li>Associate a boolean with each attribute (bonus points for a way to associate any one arbitrary type).</li>\n<li>Easily display these strings to a human.</li>\n<li>Easily count how many are \"set\" (That is, a function that, when called on someone who gets up early, has the right dividends, and is sharp as a tack, but nothing else, returns 3).</li>\n<li>Should be as strongly typed as possible (It should be impossible, or at least difficult, to ask for an attribute that doesn't exist. You should be able to see all the attributes by looking at the code).</li>\n<li>Preserving this order would be a plus, but not strictly necessary.</li>\n</ul>\n\n<p>The approaches I've thought of so far are:</p>\n\n<ul>\n<li><p>A struct with all of these as fields, but the count function is inelegant to write, and the 'nice' string name of the fields has to be stored elsewhere. Even if that can be solved with tags, the count problem remains.</p></li>\n<li><p>A map with constant keys (or an array with enumerated values). Counting is a simple loop, and the keys can be the nice string names. However, this creates the problem of asking for keys that don't exist, and you have to hide the dictionary behind a function to stop users from trying to add new keys.</p></li>\n</ul>\n\n<p>Is there something I'm missing here, or will I have to compromise?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515801920, "post_id": 48235624, "comment_id": 83453928, "body": "The <code>+</code> sign doesn&#39;t mean anything, it&#39;s not valid to add a <code>string</code> and a <code>float64</code>."}, {"owner": {"reputation": 11, "user_id": 9211295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43270fba8e3d60f2b893c50ad62b2d00?s=128&d=identicon&r=PG&f=1", "display_name": "leoperassoli", "link": "https://stackoverflow.com/users/9211295/leoperassoli"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515802516, "post_id": 48235624, "comment_id": 83454079, "body": "So why using it? I&#39;m watching an online course that the instructor writes fmt.Println(&quot;the value is&quot; + x) and fmt.Printfl(&quot;the value is&quot; +xs) (xs is a string)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1515806128, "post_id": 48235624, "comment_id": 83454789, "body": "Yes, you can concatenate strings, but <code>x</code> in your example isn\u2019t a string."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9211295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43270fba8e3d60f2b893c50ad62b2d00?s=128&d=identicon&r=PG&f=1", "display_name": "leoperassoli", "link": "https://stackoverflow.com/users/9211295/leoperassoli"}, "edited": false, "score": 0, "creation_date": 1515803697, "post_id": 48235753, "comment_id": 83454314, "body": "So, it does not work because I&#39;m trying to add a float to a string  But can I omit +? For example:          x := 3.141592  \tfmt.Println(&quot;the value is&quot;, x)  \txs := fmt.Sprint(x)  \tfmt.Println(&quot;the value is &quot; + xs)  \tfmt.Println(&quot;the value is&quot;, xs)  Both ways are right?"}, {"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "reply_to_user": {"reputation": 11, "user_id": 9211295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43270fba8e3d60f2b893c50ad62b2d00?s=128&d=identicon&r=PG&f=1", "display_name": "leoperassoli", "link": "https://stackoverflow.com/users/9211295/leoperassoli"}, "edited": false, "score": 0, "creation_date": 1515806154, "post_id": 48235753, "comment_id": 83454793, "body": "@leoperassoli for the second case. Why not just use fmt.Printf(\u201cthe value is %v\u201c, x)"}, {"owner": {"reputation": 11, "user_id": 9211295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43270fba8e3d60f2b893c50ad62b2d00?s=128&d=identicon&r=PG&f=1", "display_name": "leoperassoli", "link": "https://stackoverflow.com/users/9211295/leoperassoli"}, "edited": false, "score": 0, "creation_date": 1515807929, "post_id": 48235753, "comment_id": 83455104, "body": "Yes, it makes more sense. But, I want to know why the instructor is using +"}, {"owner": {"reputation": 3521, "user_id": 2304215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W708V.png?s=128&g=1", "display_name": "chrk", "link": "https://stackoverflow.com/users/2304215/chrk"}, "reply_to_user": {"reputation": 11, "user_id": 9211295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43270fba8e3d60f2b893c50ad62b2d00?s=128&d=identicon&r=PG&f=1", "display_name": "leoperassoli", "link": "https://stackoverflow.com/users/9211295/leoperassoli"}, "edited": false, "score": 3, "creation_date": 1515809042, "post_id": 48235753, "comment_id": 83455282, "body": "@leoperassoli None of the people here actually know the exact intentions of your instructor; but what matters is that when your instructor used the <code>+</code>, he meant to concatenate the 2 strings and then pass the result of the concatenation as the first (and sole) argument of <code>fmt.Println</code>. In <i>your</i> example, you are trying to use the <code>+</code> operator for two values of different type, which is plain wrong in Go. When you use the <code>,</code> instead, you actually pass <b>two</b> arguments to <code>fmt.Println</code>, which is perfectly valid according to the definition of <code>fmt.Println</code>, hence it works fine."}], "tags": [], "owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "is_accepted": true, "score": 2, "last_activity_date": 1515802646, "creation_date": 1515802646, "answer_id": 48235753, "question_id": 48235624, "link": "https://stackoverflow.com/questions/48235624/why-use-the-sign-in-printfl/48235753#48235753", "title": "Why use the + sign in printfl?", "body": "<p><a href=\"https://golang.org/pkg/fmt/#Println\" rel=\"nofollow noreferrer\">fmt.Println</a> is a variadic function whose arguments are generic interfaces.  Any type can fulfill this interfere, including strings and floats.  The second example works for this reason.</p>\n\n<p>The first example, however, involves the binary operator <code>+</code>.  As <a href=\"https://golang.org/ref/spec#Operators\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Operators</a> says, binary operators work in identical types.  This means you can't \"add\" a float to a string without first explicitly casting to a string.</p>\n\n<p>In general, this is a decision the golang inventors made. If you read the design tenets of go, I think you'll find this aligns well.  But for the purposes of your question, it's sufficient to say, that's how it was made to work.  </p>\n"}], "owner": {"reputation": 11, "user_id": 9211295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43270fba8e3d60f2b893c50ad62b2d00?s=128&d=identicon&r=PG&f=1", "display_name": "leoperassoli", "link": "https://stackoverflow.com/users/9211295/leoperassoli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 48235753, "answer_count": 1, "score": -5, "last_activity_date": 1515802646, "creation_date": 1515801470, "last_edit_date": 1515801674, "question_id": 48235624, "link": "https://stackoverflow.com/questions/48235624/why-use-the-sign-in-printfl", "title": "Why use the + sign in printfl?", "body": "<p>What's the difference between:</p>\n\n<pre><code>var x float64 = 3.141592\nfmt.Println(\"the value is\" + x)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>var x float64 = 3.141592\nfmt.Println(\"the value is\", x)\n</code></pre>\n\n<p>What does the <code>+</code> means?</p>\n\n<p>Why is the first one wrong and the second correct?</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1515825588, "post_id": 48234463, "comment_id": 83457535, "body": "Consider make <code>Type 2</code> embedded in <code>Type 1</code> if it is not against the design."}], "answers": [{"comments": [{"owner": {"reputation": 4878, "user_id": 3773265, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/94b4069275c2a8df3ea87ae79e3abec8?s=128&d=identicon&r=PG&f=1", "display_name": "emil", "link": "https://stackoverflow.com/users/3773265/emil"}, "edited": false, "score": 0, "creation_date": 1515794604, "post_id": 48234526, "comment_id": 83451800, "body": "Thanks for your answer. I can&#39;t encode/decode into JSON because it already has tags for json for other purpose. Could you elaborate more about reflection?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 4878, "user_id": 3773265, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/94b4069275c2a8df3ea87ae79e3abec8?s=128&d=identicon&r=PG&f=1", "display_name": "emil", "link": "https://stackoverflow.com/users/3773265/emil"}, "edited": false, "score": 0, "creation_date": 1515796420, "post_id": 48234526, "comment_id": 83452464, "body": "@emil here&#39;s an example using the <code>reflect</code> package: <a href=\"https://play.golang.org/p/JkZ5Hi_Xyxw\" rel=\"nofollow noreferrer\">play.golang.org/p/JkZ5Hi_Xyxw</a>. It&#39;s just an illustration of how you can do it with reflection and it omits proper value validity checking, using it as is I do not recommend."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 4, "last_activity_date": 1515794034, "creation_date": 1515794034, "answer_id": 48234526, "question_id": 48234463, "link": "https://stackoverflow.com/questions/48234463/how-to-convert-one-struct-to-another-in-go-when-one-includes-another/48234526#48234526", "title": "How to convert one struct to another in Go when one includes another?", "body": "<p>Not directly, no. You can freely convert between <em>identical types</em> only.</p>\n\n<p>You can get various levels of solutions to this type of problem:</p>\n\n<ul>\n<li>writing the assignments out yourself (likely the best performance)</li>\n<li>using reflection to copy from one to the other based on field names</li>\n<li>something quick-and-dirty like marshalling one type to JSON then unmarshalling to the other type (which is basically using reflection under the hood with a plaintext middleman, so it's even less efficient, but can be done with little work on your part)</li>\n</ul>\n"}], "owner": {"reputation": 4878, "user_id": 3773265, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/94b4069275c2a8df3ea87ae79e3abec8?s=128&d=identicon&r=PG&f=1", "display_name": "emil", "link": "https://stackoverflow.com/users/3773265/emil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4074, "favorite_count": 1, "accepted_answer_id": 48234526, "answer_count": 1, "score": 4, "last_activity_date": 1515794695, "creation_date": 1515793751, "last_edit_date": 1515794695, "question_id": 48234463, "link": "https://stackoverflow.com/questions/48234463/how-to-convert-one-struct-to-another-in-go-when-one-includes-another", "title": "How to convert one struct to another in Go when one includes another?", "body": "<p>I would like to know if there is easy way to convert from one struct to another in Go when one struct includes the other.</p>\n\n<p>For example</p>\n\n<pre><code>type Type1 struct {\n  Field1 int\n  Field2 string\n}\n\ntype Type2 struct {\n  Field1 int\n}\n</code></pre>\n\n<p>I know that it can be handled like this</p>\n\n<pre><code>var a Type1{10, \"A\"}\nvar b Type2\nb.Field1 = a.Field1\n</code></pre>\n\n<p>but if there are many fields, I will have to write numerous assignments. Is there any other way to handle it without multiple assignments?</p>\n\n<p>In a word, is there anything like <code>b = _.omit(a, 'Field2')</code> in javascript?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1515793000, "post_id": 48234198, "comment_id": 83451211, "body": "<code>template.Execute</code> doesn&#39;t have anything to do with <code>http.ResponseWriter</code>, it takes any <code>io.Writer</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1515793709, "post_id": 48234198, "comment_id": 83451473, "body": "You might consider sticking to the standard library until you have a firm grasp of Go and the standard library, before looking at replacing it with third-party solutions. It will make it much easier to learn and get help."}], "answers": [{"tags": [], "owner": {"reputation": 807, "user_id": 2120293, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/502PJ.png?s=128&g=1", "display_name": "Tulir", "link": "https://stackoverflow.com/users/2120293/tulir"}, "is_accepted": true, "score": 5, "last_activity_date": 1515792960, "creation_date": 1515792960, "answer_id": 48234330, "question_id": 48234198, "link": "https://stackoverflow.com/questions/48234198/how-to-use-http-responsewriter-in-fasthttp-for-executing-html-templates-etc/48234330#48234330", "title": "How to use http.ResponseWriter in fasthttp for executing HTML templates etc.?", "body": "<p><code>*fasthttp.RequestCtx</code> implements the <code>io.Writer</code> interface (that's why <code>ctx.Write()</code> exists), which means that you can simply pass <code>ctx</code> as the parameter to <code>ExecuteTemplate()</code>:</p>\n\n<pre><code>tpl.ExecuteTemplate(ctx, \"index.html\", pd)\n</code></pre>\n\n<p>Also, the <code>http.Error()</code> call will not work, since <code>RequestCtx</code> is not a <code>http.ResponseWriter</code>. Use the <code>RequestCtx</code>'s <a href=\"https://godoc.org/github.com/valyala/fasthttp#RequestCtx.Error\" rel=\"noreferrer\">own error function</a> instead:</p>\n\n<pre><code>ctx.Error(\"Internal server error\", http.StatusInternalServerError)\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 4157343, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e342a12988be266cf9d95062ccfc47d5?s=128&d=identicon&r=PG&f=1", "display_name": "mac", "link": "https://stackoverflow.com/users/4157343/mac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1208, "favorite_count": 0, "accepted_answer_id": 48234330, "answer_count": 1, "score": -1, "last_activity_date": 1515792960, "creation_date": 1515792285, "question_id": 48234198, "link": "https://stackoverflow.com/questions/48234198/how-to-use-http-responsewriter-in-fasthttp-for-executing-html-templates-etc", "title": "How to use http.ResponseWriter in fasthttp for executing HTML templates etc.?", "body": "<p>I've recently moved from golang net/http to fasthttp owing to rave reviews.</p>\n\n<p>As you know, fasthttp doesn't use (w http.ResponseWriter) but only one syntax which is (ctx *fasthttp.RequestCtx). </p>\n\n<p>I tried using ctx.Write but it didn't work. </p>\n\n<p>So, how can I implement http.ResponseWriter in the code below to excute my html templates? Please also give some explanation so that we could all benefit.</p>\n\n<p>Much Thanks for your help!</p>\n\n<pre><code>package main()\n\nimport (\n    \"html/template\"\n    \"fmt\"\n    \"github.com/valyala/fasthttp\"\n    )\n\n\ntype PageData struct {\n    Title     string\n    }   \n\n\nfunc init() {\n    tpl = template.Must(template.ParseGlob(\"public/templates/*.html\"))\n}\n\nm := func(ctx *fasthttp.RequestCtx) {\n\n    switch string(ctx.Path()) {\n\n        case \"/\":\n        idx(ctx)\n\n        default:\n        ctx.Error(\"not found\", fasthttp.StatusNotFound)\n    }\n}\n\nfasthttp.ListenAndServe(\":8081\", m)\n}\n\nfunc idx(ctx *fasthttp.RequestCtx) {\n\n    pd := new(PageData)\n    pd.Title = \"Index Page\"\n\n    err := tpl.ExecuteTemplate(ctx.write, \"index.html\", pd)\n    if err != nil {\n    log.Println(\"LOGGED\", err)\n    http.Error(ctx.write, \"Internal server error\",      http.StatusInternalServerError)\n    return\n}\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["javascript", "api", "sockets", "go", "photoshop-script"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1515868871, "post_id": 48234018, "comment_id": 83468640, "body": "Lines in HTTP are terminated by \\r\\n, not just \\n."}], "answers": [{"tags": [], "owner": {"reputation": 431, "user_id": 3579289, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/983dc0388721513b4c7ec63e280cb7e1?s=128&d=identicon&r=PG", "display_name": "Adrien", "link": "https://stackoverflow.com/users/3579289/adrien"}, "is_accepted": true, "score": 1, "last_activity_date": 1515810249, "creation_date": 1515810249, "answer_id": 48236394, "question_id": 48234018, "link": "https://stackoverflow.com/questions/48234018/upload-file-from-javascript-socket-ps-to-golang-api-gin-gonic/48236394#48236394", "title": "Upload file from Javascript Socket (Ps) to Golang API (Gin Gonic)", "body": "<p>The fundamental difference was that I am trying to send a PDF, the <code>Content-Type</code> instead of being <code>application/octet-stream</code> was supposed to be <code>application/pdf</code> so it doesn't misread EOF in the middle of the file.</p>\n"}], "owner": {"reputation": 431, "user_id": 3579289, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/983dc0388721513b4c7ec63e280cb7e1?s=128&d=identicon&r=PG", "display_name": "Adrien", "link": "https://stackoverflow.com/users/3579289/adrien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 421, "favorite_count": 0, "accepted_answer_id": 48236394, "answer_count": 1, "score": 1, "last_activity_date": 1515810249, "creation_date": 1515791320, "last_edit_date": 1515797367, "question_id": 48234018, "link": "https://stackoverflow.com/questions/48234018/upload-file-from-javascript-socket-ps-to-golang-api-gin-gonic", "title": "Upload file from Javascript Socket (Ps) to Golang API (Gin Gonic)", "body": "<p>I am trying to upload a file to my server (Golang) from a photoshop script (javascript)</p>\n\n<p>Here is the service reading the file on the server:</p>\n\n<pre><code>func Post(c *gin.Context) {\n    // Read uploaded file\n    file, header, err := c.Request.FormFile(\"file\")\n    if err != nil {\n        c.JSON(utils.BuildError(err))\n    }\n    if file == nil {\n        c.JSON(utils.BuildError(errors.New(\"no file provided\")))\n        return\n    }\n\n    // Get Client's informations ready to be processed\n    var inputDTO InputDTO\n    inputDTO.File = file\n    inputDTO.Name = header.Filename\n    c.JSON(utils.BuildResponse(inputDTO.addService()))\n}\n</code></pre>\n\n<p>I tested it using this curl request and it works as expected:</p>\n\n<pre><code>curl -i -X POST -H \"Content-Type: multipart/form-data\" -F \"file=@FILE.pdf\" localhost:14000/api/v2/items\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>c.Request.Header =&gt; map[Content-Length:[787347] Expect:[100-continue] Content-Type:[multipart/form-data; boundary=------------------------b01a62679831e49b] User-Agent:[curl/7.46.0] Accept:[*/*]]\n\nc.Request.Body =&gt; &amp;{0xc0422a6000 0xc042280180 false false}\n\nheader =&gt; [some binary]\n\nfile =&gt; {0xc042080930}\n</code></pre>\n\n<p>Now, Photoshop javascript only allows the usage of Socket, so I use this script:</p>\n\n<pre><code>conn = new Socket;\nreply = \"\";\n\n// Read file\nvar f = File(filepath);\nf.encoding = 'BINARY';\nf.open(\"r\");\nvar fContent = f.read();\nf.close();\n\n// Connect to server\nif (conn.open(\"127.0.0.1:14000\", \"BINARY\")) {\n    conn.timeout = 20000;\n    boundary = Math.random().toString().substr(2);\n    content = \"--\" + boundary\n        + \"Content-Disposition: form-data; name=file; filename=\" + filename + \".pdf\\n\"\n        + \"Content-Type: application/octet-stream\\n\"\n        + \"\\n\"\n        + fContent;\n        ;\n    cs = \"POST /api/v2/items HTTP/1.1\\n\"\n        + \"Content-Length: \" + content.length + \"\\n\"\n        + \"Content-Type: multipart/form-data; charset=utf-8; boundary=\" + boundary + \"\\n\"\n        + \"Host: 127.0.0.1:14000\\n\"\n        + \"User-Agent: Apache-HttpClient/4.3.1 (java 1.5)\\n\"\n        + \"Accept: */*\\n\"\n        + \"Expect: 100-continue\\n\"\n        + \"\\n\"\n        + content\n        + \"--\" + boundary + \"--\\n\";\n\n    conn.write(cs);\n    reply = conn.read(999999);\n    conn.close();\n    if (reply.indexOf(\"200 OK\") &gt; 0) {\n        alert(\"File successfully uploaded!\");\n    } else {\n        throw new Error(\"Error:\" + reply);\n    }\n} else {\n    throw new Error(\"Can't connect to server\");\n}\n</code></pre>\n\n<p>And I get the same nice request, but header and body are nil...</p>\n\n<pre><code>c.Request.Header =&gt; map[User-Agent:[Apache-HttpClient/4.3.1 (java 1.5)] Accept:[*/*] Expect:[100-continue] Content-Length:[787299] Content-Type:[multipart/form-data; boundary=XLuvdG51D_BRiiAda_0y79ImMN_ddtKYzeFFLlu8]]\n\nc.Request.Body =&gt; &amp;{0xc042278380 0xc04204e2c0 false false}\n\nheader =&gt; nil\n\nfile =&gt; nil\n</code></pre>\n\n<p><strong>Any idea of why the file is nil when sent from the Socket?</strong></p>\n\n<p>Thank you!</p>\n"}, {"tags": ["loops", "go", "concurrency", "crypt"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1515830757, "post_id": 48233009, "comment_id": 83458495, "body": "<a href=\"https://youtu.be/cN_DpYBzKso\" rel=\"nofollow noreferrer\">Concurrency is not Parallelism</a>, and the latter is what you want to mount a brute force in a reasonable amount of time."}], "answers": [{"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1515832557, "post_id": 48235287, "comment_id": 83458805, "body": "The <code>main</code> returns after the first value is sent through <code>out</code>. It makes sense, but the <code>stop</code> goroutine becomes completely useless as it won&#39;t block anything. Maybe you should not use it without<code>go</code>."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1515851509, "post_id": 48235287, "comment_id": 83463288, "body": "If the program does not find password then it would block forever at reading from the <code>out</code> channel. Function <code>stop</code> will wait untill all consumers are finished and then close the channel to signal there is nothing found."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1515851567, "post_id": 48235287, "comment_id": 83463305, "body": "Ah I did not think that. You are right."}, {"owner": {"reputation": 15, "user_id": 8736825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0172a145108fd392a2fa0fda0e4378dd?s=128&d=identicon&r=PG&f=1", "display_name": "Frank Jaeger", "link": "https://stackoverflow.com/users/8736825/frank-jaeger"}, "edited": false, "score": 1, "creation_date": 1516902193, "post_id": 48235287, "comment_id": 83890399, "body": "Just wanted to say thank you for this. I implemented the concurrent version of my program and there was a +300% improvement in execution time!"}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 0, "last_activity_date": 1515798834, "creation_date": 1515798834, "answer_id": 48235287, "question_id": 48233009, "link": "https://stackoverflow.com/questions/48233009/using-concurrency-in-nested-for-loop-brute-force/48235287#48235287", "title": "Using concurrency in nested for loop? (Brute force)", "body": "<p>I will not rewrite your code but I can give you a sample solution so you can fill in blanks.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"sync\"\n)\n\nfunc produce(in chan string) {\n    defer close(in)\n    for i := 0; i &lt; 1000; i++ {\n        in &lt;- fmt.Sprintf(\"%d\", i)\n    }\n}\n\nfunc consume(in, out chan string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    for s := range in {\n        if s == \"500\" {\n            out &lt;- s\n        }\n    }\n}\n\nfunc stop(out chan string, wg *sync.WaitGroup) {\n    wg.Wait()\n    close(out)\n}\n\nfunc main() {\n    in, out := make(chan string), make(chan string)\n    wg := &amp;sync.WaitGroup{}\n    go produce(in)\n    for i := 0; i &lt; runtime.NumCPU(); i++ {\n        wg.Add(1)\n        go consume(in, out, wg)\n    }\n    go stop(out, wg)\n    fmt.Println(&lt;-out)\n}\n</code></pre>\n\n<p>The idea is to produce password proposals in producer and push heavy computation into consumers. There will be as many consumers as CPUs. Producer signals end of work by closing <code>in</code> channel. Consumers pick up the next password proposal form the <code>in</code> channel and try computing the hash. If they succeed they put the password into the <code>out</code> channel.</p>\n\n<p>Stopping the program is a little bit tricky. We need a stoping routine to wait for either all consumers or for the cracked password.</p>\n"}], "owner": {"reputation": 15, "user_id": 8736825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0172a145108fd392a2fa0fda0e4378dd?s=128&d=identicon&r=PG&f=1", "display_name": "Frank Jaeger", "link": "https://stackoverflow.com/users/8736825/frank-jaeger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 520, "favorite_count": 1, "closed_date": 1515801711, "accepted_answer_id": 48235287, "answer_count": 1, "score": 1, "last_activity_date": 1515798834, "creation_date": 1515786030, "last_edit_date": 1515787539, "question_id": 48233009, "link": "https://stackoverflow.com/questions/48233009/using-concurrency-in-nested-for-loop-brute-force", "closed_reason": "Needs more focus", "title": "Using concurrency in nested for loop? (Brute force)", "body": "<p>I'm adapting code from a C program I made in class &amp; I'm trying to convert all the programs I've written in C into Go in order to learn the language. I'm not quite \"getting\" concurrency yet though. How would I apply concurrency to a nested for loop? The current iteration of my program is SLOW, much slower than if i would have written in C.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"unsafe\"\n)\n\n// #cgo LDFLAGS: -lcrypt\n// #define _GNU_SOURCE\n// #include &lt;crypt.h&gt;\n// #include &lt;stdlib.h&gt;\nimport \"C\"\n\n// credit for this solution goes to https://stackoverflow.com/questions/14109915/what-is-gos-equivalent-to-pythons-crypt-crypt\n// for showing that you can wrap go in C via CGO\n// crypt wraps C library crypt_r\nfunc crypt(key, salt string) string {\n    data := C.struct_crypt_data{}\n    ckey := C.CString(key)\n    csalt := C.CString(salt)\n    out := C.GoString(C.crypt_r(ckey, csalt, &amp;data))\n    C.free(unsafe.Pointer(ckey))\n    C.free(unsafe.Pointer(csalt))\n    return out\n}\n\nfunc main() {\n    if len(os.Args) != 2 {\n        fmt.Println(\"Usage: ./cracker k\")\n        return\n    }\n    cipher := os.Args[1]\n    var guess [5]byte\n    for i := 65; i &lt; 123; i++ {\n        if i &gt;= 91 &amp;&amp; i &lt;= 96 {\n\n        } else {\n            guess[0] = byte(i)\n            if cipher == crypt(string(guess[:1]), \"50\") {\n                fmt.Println(string(guess[:1]))\n                return\n            }\n            fmt.Println(string(guess[:1]))\n            for j := 65; j &lt; 123; j++ {\n                if j &gt;= 91 &amp;&amp; j &lt;= 96 {\n                } else {\n                    guess[1] = byte(j)\n                    if cipher == crypt(string(guess[:2]), \"50\") {\n                        fmt.Println(string(guess[:2]))\n                        return\n                    }\n                    fmt.Println(string(guess[:2]))\n                    for k := 65; k &lt; 123; k++ {\n                        if k &gt;= 91 &amp;&amp; k &lt;= 96 {\n                        } else {\n                            guess[2] = byte(k)\n                            if cipher == crypt(string(guess[:3]), \"50\") {\n                                fmt.Println(string(guess[:3]))\n                                return\n                            }\n                            fmt.Println(string(guess[:3]))\n                            for l := 65; l &lt; 123; l++ {\n                                if l &gt;= 91 &amp;&amp; l &lt;= 96 {\n                                } else {\n                                    guess[3] = byte(l)\n                                    if cipher == crypt(string(guess[:4]), \"50\") {\n                                        fmt.Println(string(guess[:4]))\n                                        return\n                                    }\n                                    fmt.Println(string(guess[:4]))\n                                    for m := 65; m &lt; 123; m++ {\n                                        if m &gt;= 91 &amp;&amp; m &lt;= 96 {\n                                        } else {\n                                            guess[4] = byte(m)\n                                            if cipher == crypt(string(guess[:5]), \"50\") {\n                                                fmt.Println(string(guess[:5]))\n                                                return\n                                            }\n                                            fmt.Println(string(guess[:5]))\n                                        }\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>The purpose of the program is to brute force a DES hash, it will work on any password up to 5 characters in length (thus, 5 nested for loops).</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1515784564, "post_id": 48232534, "comment_id": 83447708, "body": "This is not exactly idiomatic Go code. What is the use case for this?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1515784959, "post_id": 48232534, "comment_id": 83447882, "body": "There are 3rd party libs that support this, e.g. <a href=\"https://github.com/icza/dyno\" rel=\"nofollow noreferrer\"><code>github.com&#47;icza&#47;dyno</code></a> (disclosure: I&#39;m the author) which supports indexing maps and slices, embedded in any depth."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1515799479, "post_id": 48232534, "comment_id": 83453315, "body": "for each level you have to cast the exact type"}, {"owner": {"reputation": 923, "user_id": 2525507, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/38075359ff02b2b8edec751cefb36c7a?s=128&d=identicon&r=PG", "display_name": "loonyuni", "link": "https://stackoverflow.com/users/2525507/loonyuni"}, "edited": false, "score": 0, "creation_date": 1515801582, "post_id": 48232534, "comment_id": 83453833, "body": "Yeah, I am realizing that this is not the way to approach my problem, was just wondering if there was something possible - going down a more iterative (and I believe more go-like)  approach. Thanks everyone!"}], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 2, "last_activity_date": 1515820076, "creation_date": 1515820076, "answer_id": 48237092, "question_id": 48232534, "link": "https://stackoverflow.com/questions/48232534/recursively-index-arbitrarily-nested-slice-array/48237092#48237092", "title": "Recursively index arbitrarily nested slice/array", "body": "<p>You can do that with <code>reflect</code>. <code>reflect.Value</code> has a method <code>Index</code> for getting the item of the index in the slice underlying the <code>Value</code>.</p>\n\n<pre><code>func nestedArrayIndex(slice interface{}, indexes []int) interface{} {\n    v := reflect.ValueOf(slice)\n    for _, i := range indexes {\n        v = v.Index(i)\n    }\n    return v.Interface()\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Tmdomx18qPg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Tmdomx18qPg</a></p>\n"}], "owner": {"reputation": 923, "user_id": 2525507, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/38075359ff02b2b8edec751cefb36c7a?s=128&d=identicon&r=PG", "display_name": "loonyuni", "link": "https://stackoverflow.com/users/2525507/loonyuni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 48237092, "answer_count": 1, "score": 0, "last_activity_date": 1515820076, "creation_date": 1515783837, "question_id": 48232534, "link": "https://stackoverflow.com/questions/48232534/recursively-index-arbitrarily-nested-slice-array", "title": "Recursively index arbitrarily nested slice/array", "body": "<p>I'm looking for the go equivalent of something like the below python snippet</p>\n\n<pre><code>indexes = [0,4]\nnestedArray = [[1,2,3,4,5],[6,7,8]] # could be [][][]string, [][][][]float.. etc\ndef getNestedIndex(nestedArray, indexes):\n  curr = nestedArray\n  while indexes {\n    curr = nestedArray[indexes.pop(0)]\n  }\nreturn curr # should be 5\n</code></pre>\n\n<p>I tried something like this</p>\n\n<pre><code>func nestedArrayIndex(slice []interface{}, indexes []int) interface{} {\n    if len(indexes) == 1 {\n        return slice[indexes[0]]\n    }\n    var newSlice []interface{}\n    newSlice = slice[indexes[0]]\n    return nestedArrayIndex(newSlice, indexes[1:])\n}\n</code></pre>\n\n<p>but two things occur here - <code>[]Type != []interface{}</code> and <code>[][]..Type</code> definitely won't work here.</p>\n\n<p>Wondering if there's a way to achieve this in go?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1515783021, "post_id": 48232311, "comment_id": 83446957, "body": "Do <code>e, ok := err.(*pq.Error)</code> if ok is true, then <code>e</code> is of type <a href=\"https://godoc.org/github.com/lib/pq#Error\" rel=\"nofollow noreferrer\">godoc.org/github.com/lib/pq#Error</a> and has access to the fields. Read more on <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">Go type assertion here</a>."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1515798668, "post_id": 48232311, "comment_id": 83453092, "body": "<a href=\"https://github.com/lib/pq/issues/492#issuecomment-243231666\" rel=\"nofollow noreferrer\">github.com/lib/pq/issues/492#issuecomment-243231666</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 13706305, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qAVlEHE__R0/AAAAAAAAAAI/AAAAAAAAAAA/AMZuucmVMjX-6QHjL1c8JpB_AXFW59QewA/photo.jpg?sz=128", "display_name": "Saurabh Agarwal", "link": "https://stackoverflow.com/users/13706305/saurabh-agarwal"}, "is_accepted": false, "score": 0, "last_activity_date": 1591619261, "creation_date": 1591619261, "answer_id": 62262080, "question_id": 48232311, "link": "https://stackoverflow.com/questions/48232311/access-unique-constraint-error-in-lib-pq/62262080#62262080", "title": "Access Unique Constraint error in lib/pq", "body": "<p>You could do something like this if you are using Postgres:</p>\n\n<pre><code>if pgErr, ok := err.(*pq.Error); ok {\n    if pgErr.Code == \"23505\" {\n        //handle duplicate insert\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 819, "user_id": 5136936, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9c1e18e46f49b880d78f0efcec87ee44?s=128&d=identicon&r=PG&f=1", "display_name": "driftavalii", "link": "https://stackoverflow.com/users/5136936/driftavalii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 368, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1591619261, "creation_date": 1515782798, "question_id": 48232311, "link": "https://stackoverflow.com/questions/48232311/access-unique-constraint-error-in-lib-pq", "title": "Access Unique Constraint error in lib/pq", "body": "<p>I would like to handle a postgresql unique constraint error by accessing the error code. I have gone through these articles <a href=\"https://www.goinggo.net/2014/10/error-handling-in-go-part-i.html\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"nofollow noreferrer\">here</a> and also gone through the documentation <a href=\"https://sourcegraph.com/github.com/lib/pq/-/blob/error.go#L446:18$references\" rel=\"nofollow noreferrer\">here</a>, but still don't quite understand how to implement this and access the errorcode returned by the db. It seems only the Message field method was implemented: </p>\n\n<pre><code>func (err Error) Error() string {\n    return \"pq: \" + err.Message\n}\n</code></pre>\n\n<p>If I want to access the SQLSTATE code, Do I implement something like:</p>\n\n<pre><code>func (err *Error) Error() string {\n  return err.Code\n}\n</code></pre>\n\n<p>and assume the Error struct as defined <a href=\"https://godoc.org/github.com/lib/pq#Error\" rel=\"nofollow noreferrer\">here</a> will be available.</p>\n\n<p>I have tried something in my handler like this:</p>\n\n<pre><code>sqlInsert := INSERT INTO usrtable (usrCode, teamName, email, phone) VALUES ($1,$2,$3,$4)\n\n_, err := db.Exec(sqlInsert, Data.UsrCode, Data.Teamname, Data.Email, Data.Phone)\nif err != nil {\n        switch err {\n        case errorCodeNames[\"23505\"]:\n            // Return web page identifying field and advising user what to do.\n            return\n</code></pre>\n\n<p>This returns undefined which makes sense since errorCodeNames is not exported but I am stumped regarding how to achieve this.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515773784, "post_id": 48230042, "comment_id": 83442275, "body": "Are those supposed to be directory names, that you want sorted numerically? From the <code>Walk</code> documentation: `The files are walked in lexical order,&quot; -- you need to implement your own walk to sort them differently, or sort them after walk in complete."}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515774164, "post_id": 48230042, "comment_id": 83442481, "body": "i am renaming 300.000 directories to have numbers in front of them and i change around 200 at a time because people are working in the file system while it is being updated"}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1515773791, "creation_date": 1515773791, "answer_id": 48230106, "question_id": 48230042, "link": "https://stackoverflow.com/questions/48230042/go-filepath-walk-walking-behavior/48230106#48230106", "title": "go filepath.Walk walking behavior", "body": "<p>As mentioned in the <a href=\"https://golang.org/pkg/path/filepath/#Walk\" rel=\"nofollow noreferrer\">docs</a> <code>filepath.Walk</code> traverses entries in lexical order.</p>\n\n<p>If you want to list them in a different order, you can either:</p>\n\n<ul>\n<li>do your own traversal using <a href=\"https://golang.org/pkg/os/#File.Readdirnames\" rel=\"nofollow noreferrer\">File.ReadDirNames</a></li>\n<li>call <code>filepath.Walk</code>, put all the paths into a slice, and sort it as desired.</li>\n</ul>\n"}], "owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "accepted_answer_id": 48230106, "answer_count": 1, "score": -2, "last_activity_date": 1515775234, "creation_date": 1515773551, "last_edit_date": 1515775234, "question_id": 48230042, "link": "https://stackoverflow.com/questions/48230042/go-filepath-walk-walking-behavior", "title": "go filepath.Walk walking behavior", "body": "<p>In my code filepath.Walk walks over directories, in the examples all directories are called dir</p>\n\n<pre><code>1.  dir\n2.  dir\n10.  dir\n100.  dir\netc\n</code></pre>\n\n<p>when walking over the directories it will see </p>\n\n<pre><code>1.  dir\n10.  dir\n2.  dir\n</code></pre>\n\n<p>how do i make my own walkFunc so it goes trough directories like this,</p>\n\n<pre><code>1.  dir\n2.  dir \n10.  dir \n</code></pre>\n"}, {"tags": ["go", "scheduled-tasks", "kill", "preemption"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 5, "creation_date": 1515772551, "post_id": 48229675, "comment_id": 83441551, "body": "You can&#39;t &quot;kill&quot; a function or goroutine, you can only have it periodically check something (variable, channel, etc...) and have it exit on certain conditions. Your <code>case &lt;- ticker.C</code> also works as expected, it just runs <code>inFunc</code>, either in a goroutine (and continues) or inline (and waits). This seems more like an architecural problem, it may help if you were to explain what you want to achieve."}, {"owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1515773238, "post_id": 48229675, "comment_id": 83441974, "body": "@Marc I&#39;ve provided some more details about <code>f</code>, I basically do not have control on its internals."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1515773244, "post_id": 48229675, "comment_id": 83441978, "body": "Another alternative (if you can&#39;t really change <code>f</code>) is to run it in a goroutine, consider it &quot;running&quot; by the scheduler if you only want one at a time, but after the timeout, consider it &quot;dead&quot; (letting another run) and ignore anything it outputs after the deadline. I have no idea what you&#39;re trying to do, so this may not be suitable either. This assume <code>f</code> has a clear &quot;output&quot; you can discard and has no side effects."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1515773590, "post_id": 48229675, "comment_id": 83442171, "body": "If you don&#39;t have control over the internals of <code>f</code>, you can&#39;t interrupt <code>f</code>. Period. Functions meant to be interruptible always need to provide a way to inject that control, either via a context, channel, timeout, or deadline."}, {"owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515774062, "post_id": 48229675, "comment_id": 83442426, "body": "I am not sure why people is down-voting this question without providing feedback, to me it looks well explained in the way I am looking for help and advice. By the way @JimB thanks for the suggestion, I am trying to get the author of <code>f</code> to agree on some sort of control over its execution. If you have some best practices to suggest about which sort of control is better in this scenario, then please let me know. Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "is_accepted": true, "score": 1, "last_activity_date": 1516018037, "creation_date": 1516018037, "answer_id": 48262712, "question_id": 48229675, "link": "https://stackoverflow.com/questions/48229675/how-to-force-an-interrupt-on-function-execution-that-is-taking-too-long-within-a/48262712#48262712", "title": "How to force an interrupt on function execution that is taking too long within a scheduled tick", "body": "<p>I negotiated the usage of a context with timeout (<a href=\"https://golang.org/pkg/context/#WithTimeout\" rel=\"nofollow noreferrer\">https://golang.org/pkg/context/#WithTimeout</a>) with the author of <code>f()</code>.</p>\n\n<p>See below for a working example, paying attention to the timestamps of the <code>dummyLog</code> so it should be clear what's happening on all the go routines involved in this process.</p>\n\n<p>The code:</p>\n\n<pre><code>// dummyLog could be used to log some information using a human readable timestamp and the benefits of `fmt.Sprintf`\nfunc dummyLog(format string, a ...interface{}) (n int, err error) {\n    prefix := fmt.Sprintf(\"[%v] \", time.Now())\n    message := fmt.Sprintf(format, a...)\n    return fmt.Printf(\"%s%s\\n\", prefix, message)\n}\n\n// newContext is providing a brand new context with a upper bound timeout\nfunc newContext(timeoutUpperBound time.Duration) (context.Context, context.CancelFunc) {\n    ctx, cancel := context.WithTimeout(context.Background(), timeoutUpperBound)\n    deadline, ok := ctx.Deadline()\n    dummyLog(\"The context deadline is set to %s is it still valid? %v\", deadline, ok)\n    return ctx, cancel\n}\n\n// schedule could be used to schedule arbitrary functions with a recurring interval\nfunc schedule(f func(ctx context.Context), recurring time.Duration) chan struct{} {\n    ticker := time.NewTicker(recurring)\n    quit := make(chan struct{})\n    go func(inFunc func(ctx context.Context)) {\n        for {\n            select {\n            case &lt;-ticker.C:\n                dummyLog(\"Ticked in the scheduler\")\n                // simulate the \"killing\" of \"inFunc\" when it takes too long\n                go func(recurring time.Duration) {\n                    inCtx, cancel := newContext(recurring)\n                    defer cancel()\n                    inFunc(inCtx)\n                }(recurring)\n            case &lt;-quit:\n                dummyLog(\"Stopping the scheduler\")\n                ticker.Stop()\n                return\n            }\n        }\n    }(f)\n\n    return quit\n}\n</code></pre>\n\n<p>The execution of the code in a testing environment (although not assertions have been performed):</p>\n\n<pre><code>func TestSomething(t *testing.T) {\n\n    // newUuid could be used to generate a UUID to be able to uniquely identify \"fooFunc\"\n    newUuid := func() string {\n        // sudo apt-get install uuid-runtime\n        uuid, _ := exec.Command(\"uuidgen\").Output()\n\n        re := regexp.MustCompile(`\\r?\\n`)\n        uuidStr := re.ReplaceAllString(string(uuid), \"\")\n        return uuidStr\n    }\n\n    // randBetween is a dummy random int generator using \"math/rand\"\n    randBetween := func(min int, max int) int {\n        return min + rand.Intn(max-min)\n    }\n\n    // fooFunc simulates some sort of very slow execution\n    // like database queries or network I/O\n    fooFunc := func(ctx context.Context) {\n        uuid := newUuid()\n        randWait := time.Duration(randBetween(0, 4000)) * time.Millisecond\n        dummyLog(\"Starting task %s taking %s random time\", uuid, randWait)\n        select {\n        case &lt;-time.After(randWait):\n            dummyLog(\"Finished task %s\", uuid)\n        case &lt;-ctx.Done():\n            dummyLog(\"Killed task %s, reason: '%s'\", uuid, ctx.Err())\n        }\n    }\n\n    // test the very slow execution of \"fooFunc\"\n    timeoutUpperBound := 2 * time.Second\n    quitChan := schedule(fooFunc, timeoutUpperBound)\n\n    time.Sleep(6 * timeoutUpperBound)\n    close(quitChan)\n    // wait more to see the \"closing\" message\n    time.Sleep(4 * time.Second)\n}\n</code></pre>\n"}], "owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 344, "favorite_count": 0, "accepted_answer_id": 48262712, "answer_count": 1, "score": 0, "last_activity_date": 1516018037, "creation_date": 1515772301, "last_edit_date": 1515773436, "question_id": 48229675, "link": "https://stackoverflow.com/questions/48229675/how-to-force-an-interrupt-on-function-execution-that-is-taking-too-long-within-a", "title": "How to force an interrupt on function execution that is taking too long within a scheduled tick", "body": "<p>I have written this scheduler, but I am not able to make it \"kill\" that input function <code>f</code> when <code>f</code> takes more than the input <code>recurring</code> time interval.</p>\n\n<p>If that <code>f</code> was a process instead of a thread, then this thing I am looking for could be some sort of defined hard preemption.</p>\n\n<p>That <code>f</code> definition is something I do not have control on. It represents an ETL job involving crunching data from multiple databases during a batch execution. That <code>f</code> it's been written in <code>go</code> and works fine, but I need somehow to have some sort of control on it taking too long to execute.</p>\n\n<p>I know <code>f</code> is atomic, so it either changes the database at the end of its execution or not. So it can be considered safe to \"kill\" it when it takes too long.</p>\n\n<pre><code>func schedule(f func(), recurring time.Duration) chan struct{} {\n    ticker := time.NewTicker(recurring)\n    quit := make(chan struct{})\n    go func(inFunc func()) {\n        for {\n            select {\n            case &lt;-ticker.C:\n                fmt.Println(\"Ticked\")\n                // when \"go\" is removed, then if \"f()\" takes\n                // more than \"recurring\", then it postpones\n                // the following executions of \"f()\"\n                //\n                // instead somehow it should be \"killed\"\n                // \n                // check the timestamps in the execution of the test\n                go inFunc()\n            case &lt;-quit:\n                fmt.Println(\"Stopping the scheduler\")\n                ticker.Stop()\n                return\n            }\n        }\n    }(f)\n\n    return quit\n}\n</code></pre>\n\n<p>To see what's going on I've written this test:</p>\n\n<pre><code>func TestSlowExecutions(t *testing.T) {\n    // log some information using a human readable timestamp\n    dummyLog := func(format string, a ...interface{}) (n int, err error) {\n        prefix := fmt.Sprintf(\"[%v] \", time.Now())\n        message := fmt.Sprintf(format, a...)\n        return fmt.Printf(\"%s%s\\n\", prefix, message)\n    }\n\n    // UUID to be able to uniquely identify \"fooFunc\"\n    newUuid := func() string {\n        // sudo apt-get install uuid-runtime\n        uuid, _ := exec.Command(\"uuidgen\").Output()\n\n        re := regexp.MustCompile(`\\r?\\n`)\n        uuidStr := re.ReplaceAllString(string(uuid), \"\")\n        return uuidStr\n    }\n\n    // simulate some sort of very slow execution\n    fooFunc := func() {\n        uuid := newUuid()\n        dummyLog(\"Ticked\")\n        dummyLog(\"Starting task %s\", uuid)\n        time.Sleep(2 * time.Second)\n        dummyLog(\"Finished task %s\", uuid)\n    }\n\n    // test the very slow execution of \"fooFunc\"\n    quitChan := schedule(fooFunc, 1*time.Second)\n\n    time.Sleep(4 * time.Second)\n    close(quitChan)\n    // wait more to see the \"closing\" message\n    time.Sleep(4 * time.Second)\n}\n</code></pre>\n"}, {"tags": ["unit-testing", "http", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1515767259, "post_id": 48228185, "comment_id": 83438256, "body": "For one thing, your test sets <code>MAPI_ADDR</code>, while your code reads <code>SOME_ADDR</code>. Unless <code>http:&#47;&#47;www.HugeDomains.com</code> (which is in your error message) is hostfiled to localhost, the test is not hitting the test server."}, {"owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1515769381, "post_id": 48228185, "comment_id": 83439569, "body": "@Adrian that is my mistake, actual code is different from here...SOME_ADDR is MAPI_ADDR. How the testserver url can be redirected to localhost."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1515769408, "post_id": 48228185, "comment_id": 83439587, "body": "Then please post the actual code."}, {"owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1515769652, "post_id": 48228185, "comment_id": 83439747, "body": "This is the actual code with only change in key that is MAPI_ADDR"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1515769688, "post_id": 48228185, "comment_id": 83439763, "body": "Which is it? &quot;This is the actual code&quot; or &quot;actual code is different from here&quot;?"}, {"owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1515770275, "post_id": 48228185, "comment_id": 83440130, "body": "This is the actual code Sir."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1515770328, "post_id": 48228185, "comment_id": 83440161, "body": "Then I stand by my original comment. You&#39;re not using the same env var in the test and the code, leading to the error you&#39;re getting about trying to reach some domain instead of trying to reach localhost."}, {"owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1515770409, "post_id": 48228185, "comment_id": 83440215, "body": "Sir i made that mistake in posting the question and i&#39;m not able to edit it now"}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "edited": false, "score": 0, "creation_date": 1515822928, "post_id": 48229884, "comment_id": 83457149, "body": "thank you @Iain Duncan your solution worked, i&#39;m not able to upvote your answer though (Not 15 reputation yet) ."}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "reply_to_user": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "edited": false, "score": 0, "creation_date": 1515823745, "post_id": 48229884, "comment_id": 83457259, "body": "Great, pleased it worked @Utkarsh Mani Tripathi. You should be able to accept the answer if it is correct even without rotation and that&#39;ll give you a bit of reputation too!"}], "tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": true, "score": 7, "last_activity_date": 1515772976, "creation_date": 1515772976, "answer_id": 48229884, "question_id": 48228185, "link": "https://stackoverflow.com/questions/48228185/how-to-write-unit-test-for-http-request-in-golang/48229884#48229884", "title": "How to write unit test for http request in golang?", "body": "<p>You are getting a timeout but you are not specifying what <code>timeout</code> is set to. I suspect that this is not a time.Duration object and that is causing your timeout.  There are a few other issues as well. To get this to work I did:</p>\n\n<ol>\n<li>Change the function being called in the test to <code>getVolDetails</code> to match the code (not the lower case <code>g</code>)</li>\n<li>Set the <code>Timeout</code> when creating the <code>client</code> to <code>Timeout: time.Second * 10</code></li>\n<li>Remove the <code>\"http://\"+</code> from the <code>os.Setenv(\"MAPI_ADDR\", \"http://\"+server.URL)</code> line</li>\n</ol>\n\n<p>Corrected code is:</p>\n\n<pre><code>var timeout time.Duration = time.Second * 1000\n\nfunc getVolDetails(volName string, obj interface{}) error {\n    addr := os.Getenv(\"MAPI_ADDR\")\n    if addr == \"\" {\n        err := errors.New(\"MAPI_ADDR environment variable not set\")\n        fmt.Println(err)\n        return err\n    }\n    url := addr + \"/path/to/somepage/\" + volName\n    client := &amp;http.Client{\n        Timeout: timeout,\n    }\n    resp, err := client.Get(url)\n    if resp != nil {\n        if resp.StatusCode == 500 {\n            fmt.Printf(\"VSM %s not found\\n\", volName)\n            return err\n        } else if resp.StatusCode == 503 {\n            fmt.Println(\"server not reachable\")\n            return err\n        }\n    } else {\n        fmt.Println(\"server not reachable\")\n        return err\n    }\n\n    if err != nil {\n        fmt.Println(err)\n        return err\n    }\n    defer resp.Body.Close()\n\n    return json.NewDecoder(resp.Body).Decode(obj)\n}\n</code></pre>\n\n<p>and test:</p>\n\n<pre><code>func TestGetVolDetails(t *testing.T) {\n    var (\n        volume v1.Volume\n        server *httptest.Server\n    )\n    tests := map[string]struct {\n        volumeName string\n        err        error\n    }{\n        \"TestOne\": {\"vol\", nil},\n    }\n    for name, tt := range tests {\n        t.Run(name, func(t *testing.T) {\n            response := `{\"metadata\":{\"annotations\":{\"vsm.openebs.io/targetportals\":\"10.98.65.136:3260\",\"vsm.openebs.io/cluster-i    ps\":\"10.98.65.136\",\"openebs.io/jiva-iqn\":\"iqn.2016-09.com.openebs.jiva:vol\",\"deployment.kubernetes.io/revision\":\"1\",\"openebs.io/storage-pool\"    :\"default\",\"vsm.openebs.io/replica-count\":\"1\",\"openebs.io/jiva-controller-status\":\"Running\",\"openebs.io/volume-monitor\":\"false\",\"openebs.io/r    eplica-container-status\":\"Running\",\"openebs.io/jiva-controller-cluster-ip\":\"10.98.65.136\",\"openebs.io/jiva-replica-status\":\"Running\",\"vsm.ope    nebs.io/iqn\":\"iqn.2016-09.com.openebs.jiva:vol\",\"openebs.io/capacity\":\"2G\",\"openebs.io/jiva-controller-ips\":\"10.36.0.6\",\"openebs.io/jiva-repl    ica-ips\":\"10.36.0.7\",\"vsm.openebs.io/replica-status\":\"Running\",\"vsm.openebs.io/controller-status\":\"Running\",\"openebs.io/controller-container-    status\":\"Running\",\"vsm.openebs.io/replica-ips\":\"10.36.0.7\",\"openebs.io/jiva-target-portal\":\"10.98.65.136:3260\",\"openebs.io/volume-type\":\"jiva    \",\"openebs.io/jiva-replica-count\":\"1\",\"vsm.openebs.io/volume-size\":\"2G\",\"vsm.openebs.io/controller-ips\":\"10.36.0.6\"},\"creationTimestamp\":null    ,\"labels\":{},\"name\":\"vol\"},\"status\":{\"Message\":\"\",\"Phase\":\"Running\",\"Reason\":\"\"}}`\n            server = httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n                fmt.Fprintln(w, response)\n            }))\n            os.Setenv(\"MAPI_ADDR\", server.URL)\n            if got := getVolDetails(tt.volumeName, &amp;volume); got != tt.err {\n                t.Fatalf(\"GetVolDetails(%v) =&gt; got %v, want %v \", tt.volumeName, got, tt.err)\n            }\n            defer server.Close()\n        })\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6282, "favorite_count": 0, "accepted_answer_id": 48229884, "answer_count": 1, "score": 2, "last_activity_date": 1515772976, "creation_date": 1515767070, "last_edit_date": 1515772713, "question_id": 48228185, "link": "https://stackoverflow.com/questions/48228185/how-to-write-unit-test-for-http-request-in-golang", "title": "How to write unit test for http request in golang?", "body": "<p>I don't know how to test the http response given in the code below.</p>\n\n<pre><code>func getVolDetails(volName string, obj interface{}) error {\n    addr := os.Getenv(\"MAPI_ADDR\")\n    if addr == \"\" {\n        err := errors.New(\"MAPI_ADDR environment variable not set\")\n        fmt.Println(err)\n        return err\n    }\n    url := addr + \"/path/to/somepage/\" + volName\n    client := &amp;http.Client{\n        Timeout: timeout,\n    }\n    resp, err := client.Get(url)\n    if resp != nil {\n        if resp.StatusCode == 500 {\n            fmt.Printf(\"VSM %s not found\\n\", volName)\n            return err\n        } else if resp.StatusCode == 503 {\n            fmt.Println(\"server not reachable\")\n            return err\n        }\n    } else {\n        fmt.Println(\"server not reachable\")\n        return err\n    }\n\n    if err != nil {\n        fmt.Println(err)\n        return err\n    }\n    defer resp.Body.Close()\n\n    return json.NewDecoder(resp.Body).Decode(obj)\n}\n</code></pre>\n\n<p>With the help of some references i wrote unit test for this which is given below</p>\n\n<pre><code>func TestGetVolDetails(t *testing.T) {\n    var (\n        volume v1.Volume\n        server *httptest.Server\n    )\n    tests := map[string]struct {\n        volumeName string\n        err        error\n    }{\n        \"TestOne\": {\"vol\", nil},\n    }\n    for name, tt := range tests {\n        t.Run(name, func(t *testing.T) {\n            response := `{\"metadata\":{\"annotations\":{\"vsm.openebs.io/targetportals\":\"10.98.65.136:3260\",\"vsm.openebs.io/cluster-i    ps\":\"10.98.65.136\",\"openebs.io/jiva-iqn\":\"iqn.2016-09.com.openebs.jiva:vol\",\"deployment.kubernetes.io/revision\":\"1\",\"openebs.io/storage-pool\"    :\"default\",\"vsm.openebs.io/replica-count\":\"1\",\"openebs.io/jiva-controller-status\":\"Running\",\"openebs.io/volume-monitor\":\"false\",\"openebs.io/r    eplica-container-status\":\"Running\",\"openebs.io/jiva-controller-cluster-ip\":\"10.98.65.136\",\"openebs.io/jiva-replica-status\":\"Running\",\"vsm.ope    nebs.io/iqn\":\"iqn.2016-09.com.openebs.jiva:vol\",\"openebs.io/capacity\":\"2G\",\"openebs.io/jiva-controller-ips\":\"10.36.0.6\",\"openebs.io/jiva-repl    ica-ips\":\"10.36.0.7\",\"vsm.openebs.io/replica-status\":\"Running\",\"vsm.openebs.io/controller-status\":\"Running\",\"openebs.io/controller-container-    status\":\"Running\",\"vsm.openebs.io/replica-ips\":\"10.36.0.7\",\"openebs.io/jiva-target-portal\":\"10.98.65.136:3260\",\"openebs.io/volume-type\":\"jiva    \",\"openebs.io/jiva-replica-count\":\"1\",\"vsm.openebs.io/volume-size\":\"2G\",\"vsm.openebs.io/controller-ips\":\"10.36.0.6\"},\"creationTimestamp\":null    ,\"labels\":{},\"name\":\"vol\"},\"status\":{\"Message\":\"\",\"Phase\":\"Running\",\"Reason\":\"\"}}`\n            server = httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n                fmt.Fprintln(w, response)\n            }))\n            os.Setenv(\"MAPI_ADDR\", \"http://\"+server.URL)\n            if got := GetVolDetails(tt.volumeName, &amp;volume); got != tt.err {\n                t.Fatalf(\"GetVolDetails(%v) =&gt; got %v, want %v \", tt.volumeName, got, tt.err)\n            }\n            defer server.Close()\n        })\n    }\n}\n</code></pre>\n\n<p>Where response is the response i'm getting from the server. This gives me always different errors.\n<code>got invalid character '&lt;' looking for beginning of value, want &lt;nil&gt;</code></p>\n\n<p><code>got Get http://www.HugeDomains.com: net/http: request canceled (Client.Timeout exceeded while awaiting headers), want &lt;nil&gt;</code></p>\n\n<p>What am I doing wrong?</p>\n\n<p>Edit: </p>\n\n<p>Updated the code with SOME_ADDR to MAPI_ADDR which was done while posting question. Please don't be confused with that, problem remains as it is.</p>\n"}, {"tags": ["string", "go", "is-empty"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1515762123, "post_id": 48226789, "comment_id": 83435263, "body": "I&#39;d also suggest using <code>http.StatusBadRequest</code> instead of a custom variable/constant <code>UNABLE_TO_PROCEED</code> -- 1. it&#39;s standard, so much more readable (anyone reading your code will know what it does), 2. your variable violates two Go idioms: Don&#39;t use <code>_</code> in variable names, and don&#39;t use all caps."}, {"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 1, "creation_date": 1515762291, "post_id": 48226789, "comment_id": 83435367, "body": "An alternative way could be to add a metod for <i>registerRequest</i> to check if any one of the mandatory fields is empty."}], "answers": [{"comments": [{"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 0, "creation_date": 1515768650, "post_id": 48227081, "comment_id": 83439110, "body": "Terrible name hasZero, correct name should be isNotEmpty (<a href=\"https://talks.golang.org/2014/names.slide#2\" rel=\"nofollow noreferrer\">talks.golang.org/2014/names.slide#2</a>) and registerRequest should be r, but  rename it in whole function do not make alias in if."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 0, "creation_date": 1515770070, "post_id": 48227081, "comment_id": 83439980, "body": "@lofcek <code>isNotEmpty</code> would be a good name for a collection to check if its size is greater than 0. <code>hasZero()</code> tells if the list of passed values <b>has</b> a <b>zero</b> value (the value being equal to the zero value of its type). About <code>registerRequest</code>: I agree."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 0, "creation_date": 1515775182, "post_id": 48227081, "comment_id": 83443096, "body": "@lofcek Although I agree that in case of <code>string</code> values, <code>containsEmpty()</code> would be more intuitive. Updated the answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1515775156, "last_edit_date": 1515775156, "creation_date": 1515763016, "answer_id": 48227081, "question_id": 48226789, "link": "https://stackoverflow.com/questions/48226789/elegant-way-to-check-if-multiple-strings-are-empty/48227081#48227081", "title": "Elegant way to check if multiple strings are empty", "body": "<p>Note: You may use the solution below if you keep the \"is-valid\" condition in your handler, and also if you separate your condition into another function or method.</p>\n\n<p>You can create a simple helper function, which has a variadic parameter, and you can call it with any number of <code>string</code> values:</p>\n\n<pre><code>func containsEmpty(ss ...string) bool {\n    for _, s := range ss {\n        if s == \"\" {\n            return true\n        }\n    }\n    return false\n}\n</code></pre>\n\n<p>Example using it:</p>\n\n<pre><code>if containsEmpty(\"one\", \"two\", \"\") {\n    fmt.Println(\"One is empty!\")\n} else {\n    fmt.Println(\"All is non-empty.\")\n}\n\nif containsEmpty(\"one\", \"two\", \"three\") {\n    fmt.Println(\"One is empty!\")\n} else {\n    fmt.Println(\"All is non-empty.\")\n}\n</code></pre>\n\n<p>Output of the above (try it on the <a href=\"https://play.golang.org/p/m3wy_y4VzMJ\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>One is empty!\nAll is non-empty.\n</code></pre>\n\n<p>Your example would look like this:</p>\n\n<pre><code>if containsEmpty(registerRequest.Email,\n    registerRequest.PhoneNumber,\n    registerRequest.NachName,\n    registerRequest.VorName,\n    registerRequest.Password,\n    registerRequest.VerificationId) {\n\n    // One of the listed strings is empty\n}\n</code></pre>\n\n<p>Also <code>registerRequest</code> is a kinda long name, it could be shortened to like <code>r</code>. If you can't or don't want to rename it in the surrounding code and if you want to shorten the condition, you could also do something like this:</p>\n\n<p>If <code>registerRequest</code> is a pointer (or interface), you could also write:</p>\n\n<pre><code>if r := registerRequest; containsEmpty(r.Email,\n    r.PhoneNumber,\n    r.NachName,\n    r.VorName,\n    r.Password,\n    r.VerificationId) {\n\n    // One of the listed strings is empty\n}\n</code></pre>\n\n<p>Actually you can do this even if <code>registerRequest</code> is not a pointer, but then the struct will be copied. If <code>registerRequest</code> is a <code>struct</code>, then you can take its address to avoid having to copy it like this:</p>\n\n<pre><code>if r := &amp;registerRequest; containsEmpty(r.Email,\n    r.PhoneNumber,\n    r.NachName,\n    r.VorName,\n    r.Password,\n    r.VerificationId) {\n\n    // One of the listed strings is empty\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 5, "last_activity_date": 1515764599, "last_edit_date": 1515764599, "creation_date": 1515763094, "answer_id": 48227109, "question_id": 48226789, "link": "https://stackoverflow.com/questions/48226789/elegant-way-to-check-if-multiple-strings-are-empty/48227109#48227109", "title": "Elegant way to check if multiple strings are empty", "body": "<p>As Mario Santini mentioned in comment, a way to increase testability, encapsulate this logic, and decouple it from your handler method (which judging by the number of fields looks like it is at risk of changing at a different rate than your handler) could be to put this logic in a function:</p>\n\n<pre><code>func validRequest(registerRequest ?) bool {\n   return registerRequest.Email == \"\" ||\n        registerRequest.PhoneNumber == \"\" ||\n        registerRequest.NachName == \"\" ||\n        registerRequest.VorName == \"\" ||\n        registerRequest.Password == \"\" ||\n        registerRequest.VerificationId == \"\"\n}\n</code></pre>\n\n<p>This now supports very focused, table driven tests, that can exercise what it means to be a valid request independent of any method involving writing headers.</p>\n\n<p>It allows you to verify the valid/invalid path of your enclosing function, but to have very focused tests here.  It also allows you to change what it means to be a valid request and verify it independent of your enclosing function.</p>\n"}], "owner": {"reputation": 1369, "user_id": 6525347, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/4NZOi.gif?s=128&g=1", "display_name": "thelearner", "link": "https://stackoverflow.com/users/6525347/thelearner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4113, "favorite_count": 0, "accepted_answer_id": 48227081, "answer_count": 2, "score": 5, "last_activity_date": 1515775156, "creation_date": 1515761934, "last_edit_date": 1515764925, "question_id": 48226789, "link": "https://stackoverflow.com/questions/48226789/elegant-way-to-check-if-multiple-strings-are-empty", "title": "Elegant way to check if multiple strings are empty", "body": "<p>How can I check if multiple strings are empty in an elegant way? This is how I currently do it:</p>\n\n<pre><code>//if one required field is empty, close the connection\n    if (registerRequest.Email == \"\") ||\n        (registerRequest.PhoneNumber == \"\")||\n        (registerRequest.NachName ==\"\") ||\n        (registerRequest.VorName ==\"\") ||\n        (registerRequest.Password ==\"\") ||\n        (registerRequest.VerificationId ==\"\"){\n\n        //Could not proceed\n        w.WriteHeader(UNABLE_TO_PROCEED)\n        w.Write([]byte(\"Unable to register account.\"))\n        return\n\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1515869762, "post_id": 48225863, "comment_id": 83468914, "body": "Why are you trying to hide campaign.Attack&#39;s dependency on CheckToken with a middleware. Consider changing Attack to func(*http.Request) (MyCustomClaims, error) and just call it in campaign.Attack."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9208770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f391a7d289a07abdfe9cd96125121592?s=128&d=identicon&r=PG&f=1", "display_name": "licorpolo", "link": "https://stackoverflow.com/users/9208770/licorpolo"}, "edited": false, "score": 0, "creation_date": 1515760552, "post_id": 48226133, "comment_id": 83434440, "body": "i get this error: .\\main.go:115:49: multiple-value token.CheckToken() in single-value context"}, {"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "reply_to_user": {"reputation": 13, "user_id": 9208770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f391a7d289a07abdfe9cd96125121592?s=128&d=identicon&r=PG&f=1", "display_name": "licorpolo", "link": "https://stackoverflow.com/users/9208770/licorpolo"}, "edited": false, "score": 0, "creation_date": 1515762728, "post_id": 48226133, "comment_id": 83435652, "body": "It make sense .. CheckToken returns two things (MyCustomClaims + http.HandlerFunc), but router.HandleFunc needs only HandlerFunc. Why you tries to return both, not only HandlerFunc? CheckToken could not return reasonable Claims, becase it it called before first request appear."}, {"owner": {"reputation": 13, "user_id": 9208770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f391a7d289a07abdfe9cd96125121592?s=128&d=identicon&r=PG&f=1", "display_name": "licorpolo", "link": "https://stackoverflow.com/users/9208770/licorpolo"}, "edited": false, "score": 0, "creation_date": 1515763159, "post_id": 48226133, "comment_id": 83435899, "body": "then how could i get in campaign.Attack the information of claims.Id? i need to know in the attack function the id of the user who sends me the token in the &quot;authorization: bearer TOKEN_HERE&quot; if there were something like a global variable to store it and retrieve from there later."}, {"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "reply_to_user": {"reputation": 13, "user_id": 9208770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f391a7d289a07abdfe9cd96125121592?s=128&d=identicon&r=PG&f=1", "display_name": "licorpolo", "link": "https://stackoverflow.com/users/9208770/licorpolo"}, "edited": false, "score": 0, "creation_date": 1515763964, "post_id": 48226133, "comment_id": 83436342, "body": "look into my first answer and think - When any request appears, I have to somehow add some supplementary information to request in middleware. How I can do it? By creating a new request with context where I add this information. That is what I&#39;ve done - first line is creating new context, clone it and add a new information under the key &quot;claim_id&quot;. In the second line I&#39;ve pass this new context into next function - I our case into Attack. And how I can obtain it? By calling Context&#39;s method value. But it returns me interface{} - it could be everything, therefore I will try cast it into int."}, {"owner": {"reputation": 13, "user_id": 9208770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f391a7d289a07abdfe9cd96125121592?s=128&d=identicon&r=PG&f=1", "display_name": "licorpolo", "link": "https://stackoverflow.com/users/9208770/licorpolo"}, "edited": false, "score": 0, "creation_date": 1515764974, "post_id": 48226133, "comment_id": 83436908, "body": "ok i understand the solution that you have proposed but what do i need to change to solve the error of: .\\main.go:115:49: multiple-value token.CheckToken() in single-value context.  sorry for the annoyance"}], "tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": false, "score": 0, "last_activity_date": 1515759388, "creation_date": 1515759388, "answer_id": 48226133, "question_id": 48225863, "link": "https://stackoverflow.com/questions/48225863/passing-variable-from-middleware-to-end-function/48226133#48226133", "title": "passing variable from middleware to end function", "body": "<p>Use context's method WithValue. \nInstead next(w, req) write</p>\n\n<pre><code>   ctx := context.WithValue(r.Context(), \"claim_id\", claims.Id)\n   next(w, req.WithContext(ctx))\n</code></pre>\n\n<p>and inside attack:</p>\n\n<pre><code>   claim_id, ok := r.Context().Value(\"claim_id\").(int)\n   if !ok {\n     return // I don't have context .. sorry\n   }\n   // use claim_id\n</code></pre>\n\n<p>What I haven't mention, how to create an unique key ... but sometimes in the future.</p>\n"}, {"tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": true, "score": 0, "last_activity_date": 1515766179, "creation_date": 1515766179, "answer_id": 48227962, "question_id": 48225863, "link": "https://stackoverflow.com/questions/48225863/passing-variable-from-middleware-to-end-function/48227962#48227962", "title": "passing variable from middleware to end function", "body": "<p>Look into CheckToken .. It should be middleware, and typical midleware pass http.Handler and maybe another argument and return another http.Handler (this is bit better than using http.HandlerFunc). Returned function typically call argument and do some action before or after this call.</p>\n\n<pre><code>func CheckToken(next http.Handler) http.Handler\n{\n   return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n     // and body the same as you have in the answer, but instead of next(w, req) put there two lines \"WithValue\"\n   }\n}\n</code></pre>\n\n<p>and into begin of Attack put next few lines that I've already give you</p>\n"}], "owner": {"reputation": 13, "user_id": 9208770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f391a7d289a07abdfe9cd96125121592?s=128&d=identicon&r=PG&f=1", "display_name": "licorpolo", "link": "https://stackoverflow.com/users/9208770/licorpolo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 706, "favorite_count": 0, "accepted_answer_id": 48227962, "answer_count": 2, "score": 1, "last_activity_date": 1515766179, "creation_date": 1515758281, "last_edit_date": 1515758546, "question_id": 48225863, "link": "https://stackoverflow.com/questions/48225863/passing-variable-from-middleware-to-end-function", "title": "passing variable from middleware to end function", "body": "<p>im using a middleware (<code>CheckToken</code>) to check a JWT and get the custom claim (<code>Id</code>) (it will be the id of the user on my DB) but i need to pass it to campaign.Attack (so i can know who is the user who is doing the \"attack\") but i cant find out a way to do it.</p>\n\n<p>i tried to pass it as a parameter in <code>next(w, req, claim.id)</code> in <code>token.go</code> but i would need to touch the <code>http.HandlerFunc</code> function so this isnt a valid option.</p>\n\n<p>any idea about how to pass the <code>claim.id</code> from <code>CheckToken</code>  to <code>campaign.Attack()</code> ?</p>\n\n<p>thank you</p>\n\n<pre><code>         ***** main.go*****\n\n            func main() {\n\n                router := mux.NewRouter()\n\n                router.HandleFunc(\"/attack\", token.CheckToken(campaign.Attack)).Methods(\"GET\", \"OPTIONS\")\n\n               log.Fatal(http.ListenAndServe(\":3000\", handlers.CORS(handlers.AllowedOrigins([]string{\"*\"}),\n                    handlers.AllowedHeaders([]string{\"Content-Type\", \"authorization\"}))(router)))\n            }\n\n\n\n            ******campaign.go*****\n\n            package campaign\n\n            import (\n                \"log\"\n                \"net/http\"\n\n            )\n\n\n            func init() {\n\n            }\n\n            func Attack(w http.ResponseWriter, req *http.Request) {\n                log.Println(\"attack\")\n\n                //i need to get the claim.Id here\n            }\n\n\n            ****token.go****\n\ntype MyCustomClaims struct {\n    Id int `json:\"id\"`  //the Id of the user \n    jwt.StandardClaims\n}\n\n            func CheckToken(next http.HandlerFunc) (MyCustomClaims, http.HandlerFunc) {\n                return MyCustomClaims{}, http.HandlerFunc(func(w http.ResponseWriter, req *http.Request) {\n\n                    authorizationHeader := req.Header.Get(\"authorization\")\n                    if authorizationHeader != \"\" {\n                        bearerToken := strings.Split(authorizationHeader, \" \")\n                        if len(bearerToken) == 2 {\n                            token, err := jwt.ParseWithClaims(bearerToken[1], &amp;MyCustomClaims{}, func(token *jwt.Token) (interface{}, error) {\n                                return []byte(\"magicword\"), nil\n                            })\n\n                            if token.Valid {\n\n\n                                if claims, ok := token.Claims.(*MyCustomClaims); ok &amp;&amp; token.Valid {\n                               //**************************\n                              //***********i have the claims.id here and it works.*******\n                              //**************************\n                                    log.Println(claims.Id)\n\n                              //but i need to pass it or find a way to read it in campaign.Attack()\n                                    next(w, req)\n                                } else {\n                                    log.Println(err)\n                                }\n                            } else if ve, ok := err.(*jwt.ValidationError); ok {\n                                if ve.Errors&amp;jwt.ValidationErrorMalformed != 0 {\n\n\n                                } else if ve.Errors&amp;(jwt.ValidationErrorExpired|jwt.ValidationErrorNotValidYet) != 0 {\n                                    // Token is either expired or not active yet\n\n                                } \n                            } \n                        } \n                    } \n\n\n                })\n\n            }\n</code></pre>\n"}, {"tags": ["http", "go", "web-applications", "error-handling"], "comments": [{"owner": {"reputation": 1481, "user_id": 469898, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/Qf9DF.jpg?s=128&g=1", "display_name": "Dr.eel", "link": "https://stackoverflow.com/users/469898/dr-eel"}, "edited": false, "score": 0, "creation_date": 1516091687, "post_id": 48224908, "comment_id": 83537329, "body": "Here <a href=\"https://github.com/gin-gonic/gin/issues/274\" rel=\"nofollow noreferrer\">github.com/gin-gonic/gin/issues/274</a> I found the similar discussion, but still not found the solution."}], "answers": [{"comments": [{"owner": {"reputation": 820, "user_id": 9127397, "user_type": "registered", "profile_image": "https://graph.facebook.com/1940752652604940/picture?type=large", "display_name": "Mateusz Gebroski", "link": "https://stackoverflow.com/users/9127397/mateusz-gebroski"}, "edited": false, "score": 0, "creation_date": 1606201236, "post_id": 48296422, "comment_id": 114883265, "body": "Hi. Can you explain to me what parsedError = err.(*appError ) means in switch case? Thanks!"}, {"owner": {"reputation": 4009, "user_id": 1560953, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0ff50ca1dd814a955a36e4065a84288?s=128&d=identicon&r=PG&f=1", "display_name": "chresse", "link": "https://stackoverflow.com/users/1560953/chresse"}, "reply_to_user": {"reputation": 820, "user_id": 9127397, "user_type": "registered", "profile_image": "https://graph.facebook.com/1940752652604940/picture?type=large", "display_name": "Mateusz Gebroski", "link": "https://stackoverflow.com/users/9127397/mateusz-gebroski"}, "edited": false, "score": 0, "creation_date": 1609358673, "post_id": 48296422, "comment_id": 115824653, "body": "@MateuszGebroski <code>parsedError = err.(*appError)</code> is a type assertion. That way you get the type <code>appError</code> out of the <code>err</code> (see <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">tour.golang.org/methods/15</a> or <a href=\"https://stackoverflow.com/questions/38816843/explain-type-assertions-in-go\" title=\"explain type assertions in go\">stackoverflow.com/questions/38816843/&hellip;</a>)"}], "tags": [], "owner": {"reputation": 1481, "user_id": 469898, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/Qf9DF.jpg?s=128&g=1", "display_name": "Dr.eel", "link": "https://stackoverflow.com/users/469898/dr-eel"}, "is_accepted": false, "score": 14, "last_activity_date": 1516177938, "last_edit_date": 1516177938, "creation_date": 1516177002, "answer_id": 48296422, "question_id": 48224908, "link": "https://stackoverflow.com/questions/48224908/better-error-handling/48296422#48296422", "title": "Better error handling", "body": "<p><a href=\"https://github.com/gin-gonic/gin/commit/784d73477d056308e8c6ea666d52048906e48a7c#commitcomment-11454378\" rel=\"noreferrer\">Here</a> @manucorporat gin-developer say:</p>\n\n<blockquote>\n  <p>We encourage developers to use a middleware to handle the error responses, so they can split the error logic, from the normal flow logic.</p>\n</blockquote>\n\n<p>In the Gin to implement centralized error handling your should .Use(Middleware) and in the path handler's code use gin.Context.Error() to attach an error info to the request context. The Middleware is aware of gin.Context.Errors and here you can read them and process as you wish after <code>gin.Context.Next()</code>.</p>\n\n<p>The code below.</p>\n\n<p>Error handling Gin Middleware:</p>\n\n<pre><code>//\n// APP error definition\n//\ntype appError struct {\n    Code     int    `json:\"code\"`\n    Message  string `json:\"message\"`\n}\n\n//\n// Middleware Error Handler in server package\n//\nfunc JSONAppErrorReporter() gin.HandlerFunc {\n    return jsonAppErrorReporterT(gin.ErrorTypeAny)\n}\n\nfunc jsonAppErrorReporterT(errType gin.ErrorType) gin.HandlerFunc {\n    return func(c *gin.Context) {\n        c.Next()\n        detectedErrors := c.Errors.ByType(errType)\n\n        log.Println(\"Handle APP error\")\n        if len(detectedErrors) &gt; 0 {\n            err := detectedErrors[0].Err\n            var parsedError *appError\n            switch err.(type) {\n            case *appError:\n                parsedError = err.(*appError )\n            default:\n                parsedError = &amp;appError{ \n                  code: http.StatusInternalServerError,\n                  message: \"Internal Server Error\"\n                }\n            }\n            // Put the error into response\n            c.IndentedJSON(parsedError.Code, parsedError)\n            c.Abort()\n            // or c.AbortWithStatusJSON(parsedError.Code, parsedError)\n            return\n        }\n\n    }\n}\n\n//\n//  Report Error in app\n//\nfunc fetchSingleHostGroup(c *gin.Context) {\n    hostgroupID := c.Param(\"id\")\n\n    hostGroupRes, err := getHostGroupResource(hostgroupID)\n\n    if err != nil {\n        // put the Error to gin.Context.Errors\n        c.Error(err)\n        return\n    }\n    // return data of OK\n    c.JSON(http.StatusOK, *hostGroupRes)\n}\n//\n// Server setup\n//\nfunc main() {\n    router := gin.Default()\n    router.Use(JSONAppErrorReporter())\n    router.GET(\"/hostgroups/:id\", fetchSingleHostGroup)\n    router.Run(\":3000\")\n}\n</code></pre>\n\n<p>Another error handling ideas can be found in: </p>\n\n<ul>\n<li><a href=\"https://github.com/gin-gonic/gin/issues/274\" rel=\"noreferrer\">gin-gonic issue \"Question: Handling errors\"</a></li>\n<li><a href=\"https://github.com/gin-gonic/gin/issues/665\" rel=\"noreferrer\">gin-gonic issue \"Question: Status codes in error handling\"</a></li>\n<li><a href=\"https://github.com/VirrageS/chirp/pull/18/files#diff-f85fda0adb480b0d342d7e4e879e261d\" rel=\"noreferrer\">chirp</a></li>\n<li><a href=\"https://github.com/utrack/gin-merry\" rel=\"noreferrer\">gin-merry error handler</a></li>\n<li><a href=\"https://github.com/slava-vishnyakov/gin-fresh-showerrors-middleware\" rel=\"noreferrer\">gin-frsh-showerrors</a></li>\n</ul>\n"}], "owner": {"reputation": 1481, "user_id": 469898, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/Qf9DF.jpg?s=128&g=1", "display_name": "Dr.eel", "link": "https://stackoverflow.com/users/469898/dr-eel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9585, "favorite_count": 2, "answer_count": 1, "score": 7, "last_activity_date": 1516177938, "creation_date": 1515754904, "last_edit_date": 1515759299, "question_id": 48224908, "link": "https://stackoverflow.com/questions/48224908/better-error-handling", "title": "Better error handling", "body": "<p>Here <a href=\"https://github.com/astaxie/build-web-application-with-golang/blob/master/en/11.1.md\" rel=\"noreferrer\">https://github.com/astaxie/build-web-application-with-golang/blob/master/en/11.1.md</a> described how to enhance error handling with custom router and custom error type according to http package. </p>\n\n<pre><code>type appError struct {\n    Error   error\n    Message string\n    Code    int\n}    \n\ntype appHandler func(http.ResponseWriter, *http.Request) *appError\n// custom handler catching errors\nfunc (fn appHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    if e := fn(w, r); e != nil { // e is *appError, not os.Error.\n        c := appengine.NewContext(r)\n        c.Errorf(\"%v\", e.Error)\n        http.Error(w, e.Message, e.Code)\n    }\n}\n// fetch data or return *appError\nfunc viewRecord(w http.ResponseWriter, r *http.Request) *appError {\n    c := appengine.NewContext(r)\n    key := datastore.NewKey(c, \"Record\", r.FormValue(\"id\"), 0, nil)\n    record := new(Record)\n    if err := datastore.Get(c, key, record); err != nil {\n        return &amp;appError{err, \"Record not found\", 404}\n    }\n    if err := viewTemplate.Execute(w, record); err != nil {\n        return &amp;appError{err, \"Can't display record\", 500}\n    }\n    return nil\n}\n</code></pre>\n\n<p>The aim is to make all the handlers returning *appError in case of error and write it into response in the router, so there is no need to call c.JSON(500, err) directly in the code of <code>viewRecord</code>.</p>\n\n<p>How to do the same with <a href=\"https://github.com/gin-gonic/gin\" rel=\"noreferrer\">Gin</a>?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 220, "user_id": 1684651, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4ee2c7bed85c902a4f8a7af63b692792?s=128&d=identicon&r=PG", "display_name": "user1684651", "link": "https://stackoverflow.com/users/1684651/user1684651"}, "edited": false, "score": 0, "creation_date": 1515749910, "post_id": 48223262, "comment_id": 83428081, "body": "code write message into channel <a href=\"https://github.com/goinaction/code/blob/master/chapter2/sample/search/match.go#L29\" rel=\"nofollow noreferrer\">github.com/goinaction/code/blob/master/chapter2/sample/searc&zwnj;&#8203;h/&hellip;</a> Display function <a href=\"https://github.com/goinaction/code/blob/master/chapter2/sample/search/match.go#L37\" rel=\"nofollow noreferrer\">github.com/goinaction/code/blob/master/chapter2/sample/searc&zwnj;&#8203;h/&hellip;</a> one thing I don&#39;t understand is that it write a few message into channel and WriteGroup counter decreased. Shouldn&#39;t it stop after write first message and only decrease by 1 ?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 220, "user_id": 1684651, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4ee2c7bed85c902a4f8a7af63b692792?s=128&d=identicon&r=PG", "display_name": "user1684651", "link": "https://stackoverflow.com/users/1684651/user1684651"}, "edited": false, "score": 1, "creation_date": 1515749960, "post_id": 48223262, "comment_id": 83428109, "body": "Yes, I saw that by following the link. It should really have been in the question though."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 220, "user_id": 1684651, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4ee2c7bed85c902a4f8a7af63b692792?s=128&d=identicon&r=PG", "display_name": "user1684651", "link": "https://stackoverflow.com/users/1684651/user1684651"}, "edited": false, "score": 0, "creation_date": 1515750555, "post_id": 48223262, "comment_id": 83428480, "body": "Are you sure there are things written to the channel? How do you know, you don&#39;t have anything to read/print the elements. If there are no results, or an error, it won&#39;t write anything and just exit, decreasing the counter. I suspect that if you log the entries just after <code>results &lt;- result</code>, you&#39;ll see exactly one."}, {"owner": {"reputation": 220, "user_id": 1684651, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4ee2c7bed85c902a4f8a7af63b692792?s=128&d=identicon&r=PG", "display_name": "user1684651", "link": "https://stackoverflow.com/users/1684651/user1684651"}, "edited": false, "score": 0, "creation_date": 1515750617, "post_id": 48223262, "comment_id": 83428521, "body": "I put an output messages after WaitGroup.Done() in <a href=\"https://github.com/goinaction/code/blob/master/chapter2/sample/search/search.go#L40\" rel=\"nofollow noreferrer\">github.com/goinaction/code/blob/master/chapter2/sample/searc&zwnj;&#8203;h/&hellip;</a> Is that correct behavior to see like almost 10 output message before suspending ? EDIT : If it won&#39;t write and exit, why it only shows 10, but not the number of the gorouinte in loop ?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 220, "user_id": 1684651, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4ee2c7bed85c902a4f8a7af63b692792?s=128&d=identicon&r=PG", "display_name": "user1684651", "link": "https://stackoverflow.com/users/1684651/user1684651"}, "edited": false, "score": 0, "creation_date": 1515750696, "post_id": 48223262, "comment_id": 83428577, "body": "You may be seeing <code>WaitGroup.Done()</code> called 10 times, but <code>Match</code> can exit without writing anything to the channel."}, {"owner": {"reputation": 220, "user_id": 1684651, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4ee2c7bed85c902a4f8a7af63b692792?s=128&d=identicon&r=PG", "display_name": "user1684651", "link": "https://stackoverflow.com/users/1684651/user1684651"}, "edited": false, "score": 0, "creation_date": 1515751410, "post_id": 48223262, "comment_id": 83429040, "body": "adding an extra log.Printf(&quot;after write&quot;) after results &lt;- result. There is zero message in terminal"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 220, "user_id": 1684651, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4ee2c7bed85c902a4f8a7af63b692792?s=128&d=identicon&r=PG", "display_name": "user1684651", "link": "https://stackoverflow.com/users/1684651/user1684651"}, "edited": false, "score": 0, "creation_date": 1515752165, "post_id": 48223262, "comment_id": 83429515, "body": "If your <code>Printf</code> inside or outside the <code>range</code> loop? If it&#39;s outside, there may be more than one result being sent and only the first one succeeds, blocking on the second one. Or it could just be log buffering or output to non-stdout."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 3, "last_activity_date": 1515749623, "creation_date": 1515749623, "answer_id": 48223262, "question_id": 48222912, "link": "https://stackoverflow.com/questions/48222912/golang-unbuffered-channel-size/48223262#48223262", "title": "Golang unbuffered channel size?", "body": "<p>An <a href=\"https://golang.org/doc/effective_go.html#channels\" rel=\"nofollow noreferrer\">unbuffered channel</a> by definition doesn't have a buffer size. Sending blocks if there is something to read. Please take the <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">go tour</a> to familiarize yourself.</p>\n\n<p>The reason the code above blocks is that you are waiting for the WaitGroup counter to reach zero. I assume this is done after the goroutines (the ones you don't show) are done writing to the channel. One of them writes, but all others are blocking. <code>Display</code> is supposed to read from the channel (you also don't show that code), but never gets called. This means that nothing is ever consuming from the channel.</p>\n\n<p>Changing to a size 100 channel is only a temporary workaround. If you send more than 100 elements to the channel, it will still block as nothing is reading from it.</p>\n"}, {"tags": [], "owner": {"reputation": 2672, "user_id": 1288818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7CfkE.jpg?s=128&g=1", "display_name": "Oleg Butuzov", "link": "https://stackoverflow.com/users/1288818/oleg-butuzov"}, "is_accepted": false, "score": 1, "last_activity_date": 1515749654, "creation_date": 1515749654, "answer_id": 48223275, "question_id": 48222912, "link": "https://stackoverflow.com/questions/48222912/golang-unbuffered-channel-size/48223275#48223275", "title": "Golang unbuffered channel size?", "body": "<p>Buffer size means is a number of elements you can send to it without blocking it. By default, it's 0 (unbuffered channel), so if you sending something to channel its blocking till the moment channel will be read by goroutine. When you making a size of 100 for channel, the channel will be blocked at the 100th message. </p>\n"}, {"comments": [{"owner": {"reputation": 220, "user_id": 1684651, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4ee2c7bed85c902a4f8a7af63b692792?s=128&d=identicon&r=PG", "display_name": "user1684651", "link": "https://stackoverflow.com/users/1684651/user1684651"}, "edited": false, "score": 0, "creation_date": 1515750381, "post_id": 48223338, "comment_id": 83428369, "body": "I was wrong, not passing several messages. it tried to write into channel and blocks. But I still see many waitGroup.Done() is called which means counter is decreased."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1515749855, "creation_date": 1515749855, "answer_id": 48223338, "question_id": 48222912, "link": "https://stackoverflow.com/questions/48222912/golang-unbuffered-channel-size/48223338#48223338", "title": "Golang unbuffered channel size?", "body": "<p>Capacity (number of elements what can be stored in a channel) for unbuffered channel is zero. So it gets blocked right now when one goroutine starts to write to it. And unlocks when another goroutine would read that message from it. </p>\n\n<p>When you make it buffered - that means all your messages (at least in this case 100 is enough) are put into the buffer. And no need to wait until some another goroutine will read them from channel  </p>\n\n<p>Why you can pass several messages in this case? That means other process is reading them. </p>\n"}], "owner": {"reputation": 220, "user_id": 1684651, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/4ee2c7bed85c902a4f8a7af63b692792?s=128&d=identicon&r=PG", "display_name": "user1684651", "link": "https://stackoverflow.com/users/1684651/user1684651"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1808, "favorite_count": 0, "accepted_answer_id": 48223262, "answer_count": 3, "score": -3, "last_activity_date": 1515751171, "creation_date": 1515748405, "last_edit_date": 1515751171, "question_id": 48222912, "link": "https://stackoverflow.com/questions/48222912/golang-unbuffered-channel-size", "title": "Golang unbuffered channel size?", "body": "<p>Here is an example of book go in action <a href=\"https://github.com/goinaction/code/blob/master/chapter2/sample/search/search.go\" rel=\"nofollow noreferrer\">https://github.com/goinaction/code/blob/master/chapter2/sample/search/search.go</a></p>\n\n<pre><code>    // Launch a goroutine to monitor when all the work is done.\n    go func() {\n        // Wait for everything to be processed.\n        waitGroup.Wait()\n\n        // Close the channel to signal to the Display\n        // function that we can exit the program.\n        close(results)\n    }()\n\n    // Start displaying results as they are available and\n    // return after the final result is displayed.\n    Display(results)\n</code></pre>\n\n<p>If I move waitGroup.Wait() and close(results) out of the goroutine function, program is blocked because the results in channel are not read yet, and it blocks at writing other more result into channel after it gets to a \"size\". But if I use a big size buffered channel:</p>\n\n<pre><code>results := make(chan *Result, 100)\n</code></pre>\n\n<p>program recovers back to normal. It seems that channel is blocked due to size limit and can not write more before consuming it. Is there a size limit for unbeffered channel ? why it writes a few messages into channel and decreases WaitGroup counter a little, then blocks itself at there ? </p>\n"}, {"tags": ["go", "amazon-s3", "file-upload", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 3, "last_activity_date": 1515745438, "last_edit_date": 1515745438, "creation_date": 1515743632, "answer_id": 48221811, "question_id": 48221701, "link": "https://stackoverflow.com/questions/48221701/how-to-upload-file-to-amazon-s3-using-gin-framework/48221811#48221811", "title": "How to upload file to amazon s3 using gin framework", "body": "<p>You're not even reading the file from the form.</p>\n\n<p>You need to call <a href=\"https://godoc.org/mime/multipart#FileHeader\" rel=\"nofollow noreferrer\">FileHeader.Open</a>. This returns a <a href=\"https://godoc.org/mime/multipart#File\" rel=\"nofollow noreferrer\">multipart.File</a> which implements the standard <code>io.Reader</code> interface.</p>\n\n<p>You should change <code>AddFilesToS3</code> to take a filename and <code>io.Reader</code>. This can then be called for files from gin as well as regular files.</p>\n\n<pre><code>  fileHeader, err := c.FormFile(\"file\")\n  // check err\n  f, err := fileHeader.Open()\n  // check err\n  err = AddFilesToS3(s, fileHeader.fileName, f)\n</code></pre>\n\n<p>And your <code>AddFilesToS3</code> is now:</p>\n\n<pre><code>func AddFilesToS3(s *session.Session, fileDir string, r io.Reader) error {\n  // left as an exercise for the OP\n</code></pre>\n\n<p>You may need to pass <code>fileHeader.Size()</code> as well.</p>\n"}], "owner": {"reputation": 174, "user_id": 5324750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6d1f2ff3eac6208f7ed2e98c1f17bac?s=128&d=identicon&r=PG&f=1", "display_name": "Prashanth Hegde", "link": "https://stackoverflow.com/users/5324750/prashanth-hegde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2280, "favorite_count": 1, "accepted_answer_id": 48221811, "answer_count": 1, "score": 1, "last_activity_date": 1515745438, "creation_date": 1515743093, "last_edit_date": 1515744197, "question_id": 48221701, "link": "https://stackoverflow.com/questions/48221701/how-to-upload-file-to-amazon-s3-using-gin-framework", "title": "How to upload file to amazon s3 using gin framework", "body": "<p>I am trying to upload a file to Amazon S3 Using gin framework of Go. Since aws-sdc requires to read the file i need to open file using os.open('filename').But since i am getting the file from \"formFile\" I don't have the path of the file to open, so <code>os.Open()</code> is giving error</p>\n\n<blockquote>\n  <p>The system cannot find the file specified.</p>\n</blockquote>\n\n<p>My approach is as follows</p>\n\n<pre><code>package controllers\n\nimport (\n    \"bytes\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n\n    \"github.com/gin-gonic/gin\"\n\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/credentials\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/s3\"\n)\n\nconst (\n    S3_REGION = \"MY REGION\"\n    S3_BUCKET = \"&lt;MY BUCKET&gt;\"\n)\n\nfunc UploadDocument(c *gin.Context) {\n    var Buf bytes.Buffer\n    file, _ := c.FormFile(\"file\")\n\n    creds := credentials.NewSharedCredentials(\"\", \"default\")\n\n    s, err := session.NewSession(&amp;aws.Config{\n        Region:      aws.String(S3_REGION),\n        Credentials: creds,\n    })\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = AddFilesToS3(s, file.fileName)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc AddFilesToS3(s *session.Session, fileDir string) error {\n    file, err := os.Open(fileDir)\n    if err != nil {\n        return err\n    }\n    defer file.Close()\n\n    fileInfo, _ := file.Stat()\n    var size int64 = fileInfo.Size()\n    buffer := make([]byte, size)\n    file.Read(buffer)\n\n    _, err = s3.New(s).PutObject(&amp;s3.PutObjectInput{\n        Bucket:               aws.String(S3_BUCKET),\n        Key:                  aws.String(\"myfolder\" + \"/\" + fileDir),\n        ACL:                  aws.String(\"private\"),\n        Body:                 bytes.NewReader(buffer),\n        ContentLength:        aws.Int64(size),\n        ContentType:          aws.String(http.DetectContentType(buffer)),\n        ContentDisposition:   aws.String(\"attachment\"),\n        ServerSideEncryption: aws.String(\"AES256\"),\n    })\n    return err\n\n}\n</code></pre>\n\n<p>I am sending my file through POSTMAN like this</p>\n\n<p><a href=\"https://i.stack.imgur.com/HRfDa.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/HRfDa.png\" alt=\"enter image description here\"></a></p>\n\n<p>what I need to pass to my 'AddFilesToS3' function, since I am sending just the file name, <code>os.Open(fileDir)</code> is failing to look to the actual path of the file.\nWhere am I doing wrong or is there any better method available to do this?</p>\n"}, {"tags": ["go", "software-design", "circular-dependency"], "answers": [{"comments": [{"owner": {"reputation": 553, "user_id": 6149882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UtD7C.jpg?s=128&g=1", "display_name": "Grail Finder", "link": "https://stackoverflow.com/users/6149882/grail-finder"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1515753471, "post_id": 48221525, "comment_id": 83430407, "body": "Probably some people just envious of my superior graphic skills"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1515820652, "post_id": 48221525, "comment_id": 83456844, "body": "That is because while the practise is common, it is not idomatic and widely critisized in golang community. And would you please try to elaborate to me how would you write the <b>common dependecies</b>? It is even too abstract to be an answer."}, {"owner": {"reputation": 553, "user_id": 6149882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UtD7C.jpg?s=128&g=1", "display_name": "Grail Finder", "link": "https://stackoverflow.com/users/6149882/grail-finder"}, "edited": false, "score": 2, "creation_date": 1515826673, "post_id": 48221525, "comment_id": 83457724, "body": "Is there a source claiming that method not being idiomatic? I tried to google it and top article <a href=\"http://mantish.com/post/dealing-with-import-cycle-go/\" rel=\"nofollow noreferrer\">mantish.com/post/dealing-with-import-cycle-go</a> advise for creating third package. Also read through google talks, there were no bashing of that method. Whats wrong with abstract answer? Its useful to be abstract when we trying to help not one but many users with similar problems."}], "tags": [], "owner": {"reputation": 553, "user_id": 6149882, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UtD7C.jpg?s=128&g=1", "display_name": "Grail Finder", "link": "https://stackoverflow.com/users/6149882/grail-finder"}, "is_accepted": false, "score": 1, "last_activity_date": 1515742219, "creation_date": 1515742219, "answer_id": 48221525, "question_id": 48221414, "link": "https://stackoverflow.com/questions/48221414/re-design-circular-dependency-flaw/48221525#48221525", "title": "re-design circular dependency flaw", "body": "<p>Usually that problem get solved by creating third module that has dependencies for other two:\n<a href=\"https://i.stack.imgur.com/klLB8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/klLB8.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": [], "owner": {"reputation": 12722, "user_id": 393157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PiD4P.png?s=128&g=1", "display_name": "svenwltr", "link": "https://stackoverflow.com/users/393157/svenwltr"}, "is_accepted": false, "score": 1, "last_activity_date": 1515742353, "creation_date": 1515742353, "answer_id": 48221552, "question_id": 48221414, "link": "https://stackoverflow.com/questions/48221414/re-design-circular-dependency-flaw/48221552#48221552", "title": "re-design circular dependency flaw", "body": "<p>I don't know how exactly your <code>Configuration</code> package looks like, but I don't think the <code>Logger</code> should have a dependency to the <code>Configuration</code> package.</p>\n\n<p>In the end you probably want to configure the logger somehow. IMO this configuration shouldn't be more than a struct. So one solution might be:</p>\n\n<ol>\n<li>put the logger dependent configuration into on struct inside the logger package</li>\n<li>let the configuration package generate the logger config struct</li>\n<li>initialize the logger either in the configuration package or in some upper level package</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": false, "score": 2, "last_activity_date": 1515743319, "creation_date": 1515743319, "answer_id": 48221750, "question_id": 48221414, "link": "https://stackoverflow.com/questions/48221414/re-design-circular-dependency-flaw/48221750#48221750", "title": "re-design circular dependency flaw", "body": "<p>Something similar to this came up at GopherCon this year where Edward Muller argued that having config structs increased coupling in your application.  The configuration package is just an extreme version of this.  He argued that instead the dependency should just take in the bits of the configuration that it actually needs rather than the whole struct (or package in this case).  You can see this part of his talk here:</p>\n\n<p><a href=\"https://www.youtube.com/watch?v=ltqV6pDKZD8\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=ltqV6pDKZD8</a></p>\n\n<p>Or a textual version here:</p>\n\n<p><a href=\"https://about.sourcegraph.com/go/idiomatic-go/#config-structs\" rel=\"nofollow noreferrer\">https://about.sourcegraph.com/go/idiomatic-go/#config-structs</a></p>\n\n<p>The essence of his solution would be to have you main do something like:</p>\n\n<pre><code>logSetting1 := configuration.GetLogSetting1()\nlogSetting2 := configuration.GetLogSetting2()\nlogger.SetSettings(logSetting1, logSetting2)\n</code></pre>\n\n<p>You will probably also have a \"what gets created first\" problem if your logger needs some settings from the config in order to initialize itself. I avoid this by creating a logger with sensible defaults, creating the configuration object using the default logger then adjusting the logger based on the loaded configuration.  This means that you temporally have a logger that isn't configured correctly but the <em>only</em> thing you do with it is use it for logging the loading of the configuration.</p>\n"}], "owner": {"reputation": 117, "user_id": 5489736, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2146fd50a716a6dc607451d82e21dd4e?s=128&d=identicon&r=PG&f=1", "display_name": "Cowabunga", "link": "https://stackoverflow.com/users/5489736/cowabunga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1515743319, "creation_date": 1515741745, "question_id": 48221414, "link": "https://stackoverflow.com/questions/48221414/re-design-circular-dependency-flaw", "title": "re-design circular dependency flaw", "body": "<p>I've a bunch of small services that share some common packages like <code>Logger</code>, <code>Configuration</code> and <code>Net</code>. And I wrote each package in separated project.\nThe issue is that my <code>Logger</code> needs package <code>Configuration</code> for set up. And my <code>Configuration</code> (<strong>not</strong> solely used by <code>Logger</code>) wants to write output log when necessary.</p>\n\n<p>Therefore, I've circular dependency flaw <code>Logger</code><strong>--></strong><code>Configuration</code>, <code>Configuration</code><strong>--></strong><code>Logger</code>.</p>\n\n<p>How can I redesign this code?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 57, "user_id": 8880402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2bde9622909477474157cc01e4a3535?s=128&d=identicon&r=PG&f=1", "display_name": "Yanis Bendahmane", "link": "https://stackoverflow.com/users/8880402/yanis-bendahmane"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1515734801, "post_id": 48220023, "comment_id": 83421730, "body": "Actually, here is the error code : panic: runtime error: integer divide by zero [signal 0x8 code=0x1 addr=0x4013c3 pc=0x4013c3]"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 3, "creation_date": 1515735043, "post_id": 48220023, "comment_id": 83421799, "body": "If you don convert to float, <code>2&#47;3=0</code>. And further division will panic."}, {"owner": {"reputation": 581, "user_id": 5863848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/s3w85.jpg?s=128&g=1", "display_name": "NishanthSpShetty", "link": "https://stackoverflow.com/users/5863848/nishanthspshetty"}, "edited": false, "score": 0, "creation_date": 1515735151, "post_id": 48220023, "comment_id": 83421831, "body": "<code>for _, num := range nums {         result = num &#47; total         total = result     }</code> this code eventually does the division by zero. Test it with <code>div(3,2,4)</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1515735693, "post_id": 48220023, "comment_id": 83421986, "body": "@YanisBendahmane The application ignores the error returned from strconv.Atoi. Print this error to find one issue with the program. This error explains why <code>go run calc.go * 2 3</code> prints <code>0</code>."}, {"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1515735761, "post_id": 48220023, "comment_id": 83422004, "body": "Note also that args = [ &quot;/&quot;, &quot;3&quot;, &quot;2&quot; ] in your example (your slicing of os.Args is incorrect)."}, {"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1515767343, "post_id": 48220023, "comment_id": 83438312, "body": "Perhaps I wasn&#39;t clear.  The slicing of os.Args to args fails to account for the fact that the first param in os.Args is the command name as you say.  That means that, instead of a number, args ends up with the operator instead (where the rest of the code assumes a number, which is a problem).  So the first entry of nums is always zero (failed strconv.Atoi()).  (Doesn&#39;t help that both Args and args exist in the code--confusing)."}], "answers": [{"tags": [], "owner": {"reputation": 114, "user_id": 4792198, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bsCFN.jpg?s=128&g=1", "display_name": "dvaltrick", "link": "https://stackoverflow.com/users/4792198/dvaltrick"}, "is_accepted": true, "score": 1, "last_activity_date": 1515753403, "creation_date": 1515753403, "answer_id": 48224457, "question_id": 48220023, "link": "https://stackoverflow.com/questions/48220023/golang-calculator-cant-divide-by-0-error/48224457#48224457", "title": "Golang Calculator -- Can&#39;t divide by 0 error", "body": "<p>If your first parameter will always be a operator select, you can do something like that in your main func, you have a two problems in your main, you are ignoring the convertion error of a string to int and then this index of your array are setted with 0, and you are defining the array larger than you need because your first parameter it's not a number to your div func    </p>\n\n<pre><code>nums := make([]int, len(args)-1)\nfor i := 0; i &lt; len(args); i++ {\n    ret, errAtoi := strconv.Atoi(args[i])\n    if errAtoi != nil {\n        fmt.Println(errAtoi.Error())\n    } else {\n        nums[i-1] = ret\n        d = append(d, nums[i-1])\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 8880402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2bde9622909477474157cc01e4a3535?s=128&d=identicon&r=PG&f=1", "display_name": "Yanis Bendahmane", "link": "https://stackoverflow.com/users/8880402/yanis-bendahmane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1737, "favorite_count": 0, "accepted_answer_id": 48224457, "answer_count": 1, "score": 0, "last_activity_date": 1515753403, "creation_date": 1515734469, "question_id": 48220023, "link": "https://stackoverflow.com/questions/48220023/golang-calculator-cant-divide-by-0-error", "title": "Golang Calculator -- Can&#39;t divide by 0 error", "body": "<p><br>\nI'm actually in a bit of a trouble...<br>\nI have a calculator, but when I want to divide nubers with them, I have a panic err saying that you can't divide by 0.<br>\nWell, I know that in maths we can't divide by 0, but I don't put 0 in my ints.\nAny idea of the problem ?<br>\nHere is the code :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"strconv\"\n)\n\nfunc mult(nums ...int)  {\n    result := 0\n    total := 1\n    for _, num := range nums {\n        result = total * num\n        total = result\n    }\n    fmt.Println(result)\n}\n\nfunc add(nums ...int){\n    result := 0\n    total := 0\n    for _, num := range nums {\n        result = total + num\n        total = result\n    }\n    fmt.Println(result)\n}\n\nfunc sub(nums ...int){\n    result := 0\n    total := 0\n    for _, num := range nums {\n        result = num - total\n        total = result\n    }\n    fmt.Println(result)\n}\n\nfunc div(nums ...int){\n    result := 1\n    total := 1\n    for _, num := range nums {\n        result = num / total\n        total = result\n    }\n    fmt.Println(result)\n}\n\nfunc main() {\n    var d [] int\n    var args= os.Args[1:]\n    nums := make([]int, len(args))\n    for i := 0; i &lt; len(args); i++ {\n        nums[i], _ = strconv.Atoi(args[i]);\n        strconv.Atoi(args[i])\n        d = append(d, nums[i])\n    }\n    num := d\n    if os.Args[1] == \"*\"{\n        mult(num...)\n    } else if os.Args[1] == \"+\"{\n        add(num...)\n    } else if os.Args[1] == \"-\"{\n        sub(num...)\n    } else if os.Args[1] == \"/\"{\n        div(num...)\n    } else {\n        fmt.Println(\"Well well well, you didn't entered a right operand ! Try with +, -, /, or * between double quotes\")\n    }\n}\n</code></pre>\n\n<p>The command I want to run this go code is :<br></p>\n\n<pre><code>go run calc.exe / 3 2 [Infinite args,...]\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "aws-sdk-go"], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 9158081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ba96392acd41a289c1801c9b078231c?s=128&d=identicon&r=PG&f=1", "display_name": "Ruben Kostandyan", "link": "https://stackoverflow.com/users/9158081/ruben-kostandyan"}, "edited": false, "score": 0, "creation_date": 1611531063, "post_id": 48236293, "comment_id": 116475137, "body": "This helped, thanks :)"}], "tags": [], "owner": {"reputation": 41, "user_id": 9206790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/514a00272f4ffd9d0d839800ead641f1?s=128&d=identicon&r=PG&f=1", "display_name": "Mezzi", "link": "https://stackoverflow.com/users/9206790/mezzi"}, "is_accepted": true, "score": 2, "last_activity_date": 1515808829, "creation_date": 1515808829, "answer_id": 48236293, "question_id": 48218433, "link": "https://stackoverflow.com/questions/48218433/go-aws-sdk-unable-to-determine-service-operation-name-to-be-authorized/48236293#48236293", "title": "Go AWS SDK &quot;Unable to determine service/operation name to be authorized&quot;", "body": "<p>I have found the solution. From the docs,</p>\n\n<p>\"You must first call the GetDataEndpoint API to get an endpoint to which you can then send the GetMedia requests.\"</p>\n"}], "owner": {"reputation": 41, "user_id": 9206790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/514a00272f4ffd9d0d839800ead641f1?s=128&d=identicon&r=PG&f=1", "display_name": "Mezzi", "link": "https://stackoverflow.com/users/9206790/mezzi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1498, "favorite_count": 0, "accepted_answer_id": 48236293, "answer_count": 1, "score": 1, "last_activity_date": 1515808829, "creation_date": 1515721595, "last_edit_date": 1515726206, "question_id": 48218433, "link": "https://stackoverflow.com/questions/48218433/go-aws-sdk-unable-to-determine-service-operation-name-to-be-authorized", "title": "Go AWS SDK &quot;Unable to determine service/operation name to be authorized&quot;", "body": "<p>I am using the Go SDK to connect to the Kinesis Video Streams service. When issuing a <code>GetMedia</code> request, I'm receiving a 403 response with the following body:</p>\n\n<pre><code>&lt;AccessDeniedException&gt;\n  &lt;Message&gt;Unable to determine service/operation name to be authorized&lt;/Message&gt;\n&lt;/AccessDeniedException&gt;\n</code></pre>\n\n<p>I am using LogLevel <code>LogDebugWithHTTPBody</code> to see this since the SDK is expecting JSON and receives XML, causing a <code>SerializationError</code>. </p>\n\n<p>I am using Go 1.9.2 and have attempted this operation with both v1 and v2 of aws-sdk-go with the same result.</p>\n\n<p>Here is my request:</p>\n\n<pre><code>POST /getMedia HTTP/1.1\nHost: kinesisvideo.us-west-2.amazonaws.com\nUser-Agent: aws-sdk-go/2.0.0-preview.1 (go1.9.2; darwin; amd64)\nContent-Length: 141\nAuthorization: AWS4-HMAC-SHA256 Credential=AKIAXXXXXXXXXXXXXX/20180112/us-west-2/kinesisvideo/aws4_request, SignedHeaders=content-length;host;x-amz-date, Signature=60c625357b67c64caed32f5a0924882f26ffc776211801e94e7ecae84e7213c2\nX-Amz-Date: 20180112T012511Z\nAccept-Encoding: gzip\n\n{\"StartSelector\":{\"StartSelectorType\":\"NOW\"},\"StreamARN\":\"arn:aws:kinesisvideo:us-west-2:XXXXXXXXXXXXX:stream/StreamTest/XXXXXXXXXXXXX\"}\n</code></pre>\n\n<p>Response:</p>\n\n<pre><code>HTTP/1.1 403 Forbidden\nContent-Length: 130\nDate: Fri, 12 Jan 2018 01:25:11 GMT\nX-Amzn-Requestid: 6f1701aa-f737-11e7-bcd5-c70a68e72add\n\n&lt;AccessDeniedException&gt;\n  &lt;Message&gt;Unable to determine service/operation name to be authorized&lt;/Message&gt;\n&lt;/AccessDeniedException&gt;\n</code></pre>\n\n<p>Any help would be greatly appreciated.</p>\n\n<p>To follow up, I have tried to issue the HTTP request above directly with the <code>Content-Type: application/json</code> header added, and the response is now:</p>\n\n<pre><code>{\n    \"Output\": {\n        \"__type\": \"com.amazon.coral.service#UnknownOperationException\",\n        \"message\": null\n    },\n    \"Version\": \"1.0\"\n}\n</code></pre>\n"}, {"tags": ["json", "go", "notifications", "amazon-sns"], "answers": [{"tags": [], "owner": {"reputation": 5796, "user_id": 272398, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/qYP2D.jpg?s=128&g=1", "display_name": "boddhisattva", "link": "https://stackoverflow.com/users/272398/boddhisattva"}, "is_accepted": false, "score": 0, "last_activity_date": 1515723076, "creation_date": 1515723076, "answer_id": 48218603, "question_id": 48217804, "link": "https://stackoverflow.com/questions/48217804/getting-multiple-backward-slashes-in-the-message-response-as-part-of-nested-info/48218603#48218603", "title": "Getting multiple backward slashes in the message response as part of nested info sent to Amazon SNS - Am I missing something?", "body": "<p>I had made a mistake in my request end point that hits the SNS client service.</p>\n\n<p>I had to pass first_name=tester and last_name=M instead of having them as first_name=\"tester\" and last_name=\"M\".</p>\n"}], "owner": {"reputation": 5796, "user_id": 272398, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/qYP2D.jpg?s=128&g=1", "display_name": "boddhisattva", "link": "https://stackoverflow.com/users/272398/boddhisattva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 265, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1515723076, "creation_date": 1515716211, "question_id": 48217804, "link": "https://stackoverflow.com/questions/48217804/getting-multiple-backward-slashes-in-the-message-response-as-part-of-nested-info", "title": "Getting multiple backward slashes in the message response as part of nested info sent to Amazon SNS - Am I missing something?", "body": "<p>I'm getting the below message response for a golang client script that I've written below to send info to Amazon SNS:</p>\n\n<p><strong>Message response:</strong></p>\n\n<pre><code>{\\\"recipient\\\":\\\"test20@test.com\\\",\\\"template\\\":\\\"welcome_email_v1\\\",\\\"type\\\":\\\"email\\\",\\\"source\\\":\\\"noreply@sender.co\\\",\\\"user\\\":{\\\"first_name\\\":\\\"\\\\\\\"tester\\\\\\\"\\\",\\\"last_name\\\":\\\"\\\\\\\"M\\\\\\\"\\\"}}\"\n</code></pre>\n\n<p>I'm not quite sure if the multiple backward slashes as part of the nested <code>user</code> hash for <code>first_name</code> and <code>last_name</code> as part of the above message response is normal. Can someone with more experience on this please throw some light if I'm missing something?</p>\n\n<pre><code>package services\n\nimport (\n  \"encoding/json\"\n  \"os\"\n  \"github.com/aws/aws-sdk-go/aws\"\n  \"github.com/aws/aws-sdk-go/aws/session\"\n  \"github.com/aws/aws-sdk-go/service/sns\"\n)\n\nvar NotificationType= \"email\"\n\nfunc snsNotificationSender(template, recipient, firstName, lastName string, account_id int) (*sns.PublishOutput, error) {\n  sess := session.Must(session.NewSessionWithOptions(session.Options{\n      Config: aws.Config{Region: aws.String(os.Getenv(\"AWS_REGION\"))},\n      Profile: os.Getenv(\"AWS_SNS_PROFILE\"),\n  }))\n\n  svc := sns.New(sess)\n  var source string = os.Getenv(\"EMAIL_SOURCE\")\n\n  type UserInfo struct {\n    FirstName string `json:\"first_name\"`\n    LastName string `json:\"last_name\"`\n  }\n\n  type MessageBody struct {\n    Recipient string `json:\"recipient\"`\n    Template string `json:\"template\"`\n    NotificationType string `json:\"type\"`\n    Source string `json:\"source\"`\n    UserInfo `json:\"user\"`\n  }\n\n  type Message struct {\n    MessageBody\n  }\n\n  msg := Message{\n    MessageBody: MessageBody{\n      Template: template,\n      Recipient: recipient,\n      Source: source,\n      NotificationType: NotificationType,\n      UserInfo: UserInfo{\n        FirstName: firstName,\n        LastName: lastName,\n      },\n    },\n  }\n\n  encoded_message, err := json.Marshal(msg)\n  message := string(encoded_message)\n\n  msgParams := &amp;sns.PublishInput{\n      MessageStructure: aws.String(\"type: json\"),\n      Message: aws.String(message),\n      TopicArn: aws.String(os.Getenv(\"AWS_SNS_ARN_Topic\")),\n  }\n\n  msgResp, err := svc.Publish(msgParams)\n\n  return msgResp, err\n}\n</code></pre>\n\n<p>Thank you.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26894, "user_id": 19020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpVEj.jpg?s=128&g=1", "display_name": "Dan Esparza", "link": "https://stackoverflow.com/users/19020/dan-esparza"}, "edited": false, "score": 0, "creation_date": 1515715963, "post_id": 48217543, "comment_id": 83417525, "body": "A technical point, but it&#39;s actually the <code>http.ListenAndServe</code> (which is provided by Go itself) that is allowing you to serve a website / application -- not gorilla/mux.  Gorilla is providing a mechanism to route incoming requests to go functions you provide."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1515716321, "post_id": 48217543, "comment_id": 83417607, "body": "The net/http server creates a goroutine per connection. The Gorilla mux does not start or manage goroutines.  It simply calls through to the handler on whichever goroutine it was called on. A request does not complete until the handler returns. Sleeping 15 seconds causes the client to wait 15 seconds.  Don&#39;t sleep. You might be observing the browser throttling requests to a host (and this has nothing to do with server)."}, {"owner": {"reputation": 1369, "user_id": 4748326, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/6kUjW.jpg?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/4748326/alexis"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1515716687, "post_id": 48217543, "comment_id": 83417696, "body": "@Cerise Lim&#243;n: I edited my post, can I use a goroutine for this ? What the best practice for heavy processing request ? But still, that means only one client can access to the same page at the same time... It doesn&#39;t create a goroutine for my second connection."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1515716921, "post_id": 48217543, "comment_id": 83417748, "body": "The best practice is to process the request on goroutine created by the net/http server.  If the application has work to do after the response is written, then start a goroutine to execute that work.  That will free the goroutine to process the next request on the connection."}, {"owner": {"reputation": 1369, "user_id": 4748326, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/6kUjW.jpg?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/4748326/alexis"}, "edited": false, "score": 0, "creation_date": 1515717455, "post_id": 48217543, "comment_id": 83417870, "body": "I am very surprised that Go is working like that. Only one goroutine per route... Why not using one goroutine per connection instead ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1515718162, "post_id": 48217543, "comment_id": 83418043, "body": "<a href=\"https://github.com/golang/go/blob/c13e0e8ceed4395e9ec8176579346ca6a5db269f/src/net/http/server.go#L2795\" rel=\"nofollow noreferrer\">The net/http server starts one goroutine per connection</a>, not one per route."}, {"owner": {"reputation": 1369, "user_id": 4748326, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/6kUjW.jpg?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/4748326/alexis"}, "edited": false, "score": 0, "creation_date": 1515718287, "post_id": 48217543, "comment_id": 83418071, "body": "I might silly then, I don&#39;t understand why I cannot access twice at the same time <code>&#47;foo</code> then. If there is one goroutine per <code>&#47;foo</code> access, I shouldn&#39;t wait for 15sec to see the second one."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1515719859, "post_id": 48217543, "comment_id": 83418411, "body": "The issue is on the client side. Show the code or describe how you are requesting the resource."}, {"owner": {"reputation": 1369, "user_id": 4748326, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/6kUjW.jpg?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/4748326/alexis"}, "edited": false, "score": 0, "creation_date": 1515721460, "post_id": 48217543, "comment_id": 83418783, "body": "I just open 2 tabs in Firefox/Chrome and I send <code>http:&#47;&#47;localhost:9090&#47;foo</code> in both tabs. Ok I see, it might be because my requests go through the <code>loopback</code>. Thank you very much, I understand now, I am reassured."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1515728421, "post_id": 48217543, "comment_id": 83420238, "body": "The browser stalls when requesting the page the second time.  See <a href=\"https://stackoverflow.com/questions/29206067/understanding-chrome-network-log-stalled-state\" title=\"understanding chrome network log stalled state\">stackoverflow.com/questions/29206067/&hellip;</a> for info."}], "answers": [{"comments": [{"owner": {"reputation": 1369, "user_id": 4748326, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/6kUjW.jpg?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/4748326/alexis"}, "edited": false, "score": 0, "creation_date": 1515715722, "post_id": 48217643, "comment_id": 83417474, "body": "The problem is you are using 2 different routes <code>foo</code> and <code>bar</code>, no problem for this. But how about <code>foo</code> and <code>foo</code>: they are processed one after another: <code>2018&#47;01&#47;12 09:04:54 foo is downloading... 2018&#47;01&#47;12 09:05:09 foo is downloading...</code> That means only one client can access to the same page?! It&#39;s a deal-breaker for me, I guess I did something wrong in the implementation."}], "tags": [], "owner": {"reputation": 5608, "user_id": 660828, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2ab261718814b4842efac71a1b6cd1a5?s=128&d=identicon&r=PG", "display_name": "Tom Jowitt", "link": "https://stackoverflow.com/users/660828/tom-jowitt"}, "is_accepted": true, "score": 1, "last_activity_date": 1515883268, "last_edit_date": 1515883268, "creation_date": 1515715032, "answer_id": 48217643, "question_id": 48217543, "link": "https://stackoverflow.com/questions/48217543/listenandserve-does-it-allow-several-connections-at-the-same-time/48217643#48217643", "title": "ListenAndServe: Does it allow several connections at the same time?", "body": "<p>If you add a log call to your handler you can see when responses are being processed:</p>\n\n<pre><code>func downloadFileHandler(w http.ResponseWriter, r *http.Request) {\n   vars := mux.Vars(r)\n   w.WriteHeader(http.StatusOK)\n   fmt.Fprintf(w, \"%s is downloading...\\n\", vars[\"namefile\"])\n   log.Printf(\"%s is downloading...\\n\", vars[\"namefile\"])\n   time.Sleep(15*time.Second)\n}\n</code></pre>\n\n<p>Eg:</p>\n\n<pre><code>2018/01/12 10:52:42 foo is downloading...\n2018/01/12 10:52:44 bar is downloading...\n</code></pre>\n\n<p>Both calls are being processed synchronously due to Gorilla Mux using Go's underlying go routines but the 15-second <code>time.Sleep</code> is preventing you from seeing the results. </p>\n"}], "owner": {"reputation": 1369, "user_id": 4748326, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/6kUjW.jpg?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/4748326/alexis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 505, "favorite_count": 0, "accepted_answer_id": 48217643, "answer_count": 1, "score": -2, "last_activity_date": 1515883268, "creation_date": 1515714217, "last_edit_date": 1515750574, "question_id": 48217543, "link": "https://stackoverflow.com/questions/48217543/listenandserve-does-it-allow-several-connections-at-the-same-time", "title": "ListenAndServe: Does it allow several connections at the same time?", "body": "<p>I made a small web server using <code>gorilla/mux</code>.</p>\n\n<p>I took the small example at the end of the README file in their Github page.</p>\n\n<pre><code>r := mux.NewRouter()\nr.HandleFunc(\"/\", listUrlsHandler)\nr.HandleFunc(\"/foo\", fooHandler)\nhttp.Handle(\"/\", r)\n\nerr := http.ListenAndServe(\":9090\", nil) // set listen port\nif err != nil {\n    log.Fatal(\"ListenAndServe: \", err)\n}\n</code></pre>\n\n<p>To emulate a long processing I added a timer in the callback function.</p>\n\n<pre><code>func fooHandler(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(http.StatusOK)\n    fmt.Fprintln(w, \"foo is downloading...\")\n    log.Println(\"foo is downloading...\")\n    time.Sleep(15*time.Second)\n}\n</code></pre>\n\n<p>I run 2x <code>/foo</code> at the same time:</p>\n\n<pre><code>2018/01/12 09:15:03 foo is downloading...\n2018/01/12 09:15:18 foo is downloading...\n</code></pre>\n\n<ul>\n<li>Only one is processing, the second one is not called. Once the first one is returned (15sec later), the second one starts.</li>\n<li><strong>Why? I want them to be processed in parallel...</strong></li>\n<li>This is deal-breaker, that means clients cannot access to the same page at the same moment.</li>\n</ul>\n\n<p><strong>How can I reply to the client and process later?</strong>\nAdding a goroutine in the handler?</p>\n\n<pre><code>func fooHandler(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(http.StatusOK)\n    fmt.Fprintln(w, \"foo is downloading...\")\n    log.Println(\"foo is downloading...\")\n    go time.Sleep(15*time.Second) // HERE &lt;------------\n    // go myCustomFunc()          // HERE &lt;------------\n}\n</code></pre>\n\n<p>I had an idea of how it's working but obviously I am totally wrong.\nI thought the router created a <code>goroutine</code> at each call.</p>\n\n<p>Could you tell me what's the best practice to do what I want ?</p>\n\n<p><strong>I found the problem using tcp dump:</strong></p>\n\n<p>The second request opens a TCP connection that gets closed 150ms later (FIN from client). Then the second request is processed by the first TCP connection opened by the first request after the first request is done.</p>\n\n<p>Might be Firefox's behavior that close the TCP connection and use the previous connection.</p>\n"}, {"tags": ["json", "templates", "go"], "answers": [{"comments": [{"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1515715235, "post_id": 48217202, "comment_id": 83417348, "body": "hmm, that doesn&#39;t work.  Can you please provide an example?"}], "tags": [], "owner": {"reputation": 110, "user_id": 3508426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/513ec8e6762ef0e4e8833b7e2b320f20?s=128&d=identicon&r=PG&f=1", "display_name": "Sebasti&#225;n Rodriguez", "link": "https://stackoverflow.com/users/3508426/sebasti%c3%a1n-rodriguez"}, "is_accepted": false, "score": 0, "last_activity_date": 1515767104, "last_edit_date": 1515767104, "creation_date": 1515711735, "answer_id": 48217202, "question_id": 48216958, "link": "https://stackoverflow.com/questions/48216958/execute-template-without-a-stuct-of-known-format/48217202#48217202", "title": "Execute template without a stuct of known format", "body": "<p>May be you can unmarshall the json into a map, and then access the data in this way: <del><code>{{ index \"FilePath\" MyMapVar }}</code></del></p>\n\n<p>I think that the <code>index</code> function work in the same way as with the slices.</p>\n\n<hr>\n\n<p>Regards.</p>\n\n<hr>\n\n<h1>Edit:</h1>\n\n<p>Here is an example of what i said:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"html/template\"\n    \"net/http\"\n)\n\nfunc main() {\n    jsonData := make(map[string]interface{})\n\n    body := []byte(`{\n            \"userId\": 1,\n            \"id\": 1,\n            \"title\": \"sunt aut facere repellat provident occaecati excepturi optio reprehenderit\",\n            \"body\": \"quia et suscipit\\nsuscipit recusandae consequuntur expedita et cum\\nreprehenderit molestiae ut ut quas totam\\nnostrum rerum est autem sunt rem eveniet architecto\"\n        }`)\n\n    json.Unmarshal(body, &amp;jsonData)\n\n    mTemplate := `&lt;p&gt;UserID: {{ index . \"userId\" }}&lt;/p&gt;\n        &lt;p&gt;ID: {{ index . \"id\" }}&lt;/p&gt;\n        &lt;p&gt;Title: {{ index . \"title\" }}&lt;/p&gt;\n        &lt;p&gt;Body: {{ index . \"body\" }}&lt;/p&gt;`\n\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, req *http.Request) {\n        templ := template.New(\"CompiledTemplate\")\n        templ = template.Must(templ.Parse(mTemplate))\n\n        templ.Execute(w, jsonData)\n    })\n\n    // Iniciamos el servidor, y retornamos el presunto error que pueda dar.\n    fmt.Printf(\"\\nEscuchando en el puerto %d\\n\", 9090)\n    http.ListenAndServe(\":\"+fmt.Sprint(9090), nil)\n}\n</code></pre>\n\n<p>It is pretty similar to the solution that <a href=\"https://stackoverflow.com/users/5728991/cerise-lim%C3%B3n\">Cerise Lim\u00f3n</a> gave.</p>\n\n<p>Also i was wrong in my first answer, the way to access an slice/map position in the template is not like this: <del><code>{{ index \"FilePath\" MyMapVar }}</code></del>, is like this: <code>{{ index MyMapVar \"FilePath\" }}</code></p>\n"}, {"comments": [{"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1515726854, "post_id": 48218506, "comment_id": 83419865, "body": "Thanks, that&#39;s pretty much what I came up after much searching.  Your answer is correct."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1515722315, "creation_date": 1515722315, "answer_id": 48218506, "question_id": 48216958, "link": "https://stackoverflow.com/questions/48216958/execute-template-without-a-stuct-of-known-format/48218506#48218506", "title": "Execute template without a stuct of known format", "body": "<p>Unmarshal the JSON to an <code>interface{}</code> value and pass that value to the template <code>Execute</code> method.  The template in the question works as is with the JSON in the question.</p>\n\n<pre><code>t := template.Must(template.New(\"\").Parse(tmpl))\nvar v interface{}\nif err := json.Unmarshal(jsonFromClient, &amp;v); err != nil {\n    // handle error\n}\nif err := t.Execute(output, v); err != nil {\n    // handle error\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/rlGH8HIlcc-\" rel=\"noreferrer\">Run the code on the Playground</a>.</p>\n"}], "owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 1, "accepted_answer_id": 48218506, "answer_count": 2, "score": 3, "last_activity_date": 1515767104, "creation_date": 1515710412, "question_id": 48216958, "link": "https://stackoverflow.com/questions/48216958/execute-template-without-a-stuct-of-known-format", "title": "Execute template without a stuct of known format", "body": "<p>I have an app that is quite generic in nature.</p>\n\n<p>Clients talk to it by sending json encoded messages that could contain any number of fields whose names the app does not care to know.</p>\n\n<p>The app loads a configuration file and contains some template fields.</p>\n\n<p>For example:</p>\n\n<pre><code>template = \"Value read from json: {{.FilePath}}\"\n</code></pre>\n\n<p>and</p>\n\n<pre><code>json from client = { \"FilePath\": \"/tmp/filename.abc\", \"OtherField1\":\"value1\" }\n</code></pre>\n\n<p>etc.</p>\n\n<p>When using the normal golang template, a structure first needs to be defined for the json to be unmarshalled to.\nAnd then the template created and executed with values coming from the structure.</p>\n\n<p>That's a problem, I don't want to have to hard code a structure together that ccontains the FilePath as a string an any other fields that a user might decide is useful.  It makes it not generic.</p>\n\n<p>How do I get around this?  or is there perhaps another way to combining json and templates without using golang templates?</p>\n"}, {"tags": ["json", "validation", "go", "syntax"], "answers": [{"tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": false, "score": 5, "last_activity_date": 1515734812, "last_edit_date": 1515734812, "creation_date": 1515733294, "answer_id": 48219821, "question_id": 48216121, "link": "https://stackoverflow.com/questions/48216121/json-file-syntax-validation/48219821#48219821", "title": "Json file syntax validation", "body": "<p>If the error is a syntax error in the input JSON then the error returned from the unmarshal will be a <code>*json.SyntaxError</code>:</p>\n\n<p><a href=\"https://golang.org/pkg/encoding/json/#SyntaxError\" rel=\"noreferrer\">https://golang.org/pkg/encoding/json/#SyntaxError</a></p>\n\n<p>This contains the position in the input byte slice that caused the error as it's Offset field.  To get this you do a type switch to check if it's this type of error and convert it to this type to get the offset value out of it as per the instructions here:</p>\n\n<p><a href=\"https://tour.golang.org/methods/16\" rel=\"noreferrer\">https://tour.golang.org/methods/16</a></p>\n\n<p>You can then use a bufio Scanner to find the line number:</p>\n\n<p><a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"noreferrer\">https://golang.org/pkg/bufio/#Scanner</a></p>\n\n<p>Putting this all together you have this code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nconst myJSON = `\n{ \n    \"totallyValid\": \"this is OK\",\n    \"missing quotes: not OK\n}\n`\n\nfunc main() {\n    var result map[string]interface{}\n    err := json.Unmarshal([]byte(myJSON), &amp;result)\n    switch err := err.(type) {\n    case *json.SyntaxError:\n        fmt.Printf(\"Error in input syntax at byte %d: %s\\n\", err.Offset, err.Error())\n        var line int\n        var readBytes int64\n        for scanner.Scan() {\n            // +1 for the \\n character\n            readBytes += int64(len(scanner.Bytes()) + 1)\n            line += 1\n            if (readBytes &gt;= err.Offset) {\n                fmt.Printf(\"Error in input syntax on line %d: %s\\n\", line, err.Error())\n                break\n            }\n        }\n    default:\n        fmt.Printf(\"Other error decoding JSON: %s\\n\", err.Error())\n    }\n}\n</code></pre>\n\n<p>This is runnable here:</p>\n\n<p><a href=\"https://play.golang.org/p/aZJF20VfvYm\" rel=\"noreferrer\">https://play.golang.org/p/aZJF20VfvYm</a></p>\n"}], "owner": {"reputation": 21, "user_id": 7061297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d9dba030fcddbcb8ef0260d9d2f9f61?s=128&d=identicon&r=PG&f=1", "display_name": "Valentyn Kremeshnyi", "link": "https://stackoverflow.com/users/7061297/valentyn-kremeshnyi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 658, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1610296880, "creation_date": 1515706293, "last_edit_date": 1610296880, "question_id": 48216121, "link": "https://stackoverflow.com/questions/48216121/json-file-syntax-validation", "title": "Json file syntax validation", "body": "<p>The question is how to validate syntax in json file in golang? I know that I can unmarshal slice of bytes and get standard error if I missed comma or brackets. How to get line in file where it happens?</p>\n"}]