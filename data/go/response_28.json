[{"tags": ["mysql", "go"], "answers": [{"comments": [{"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 2, "creation_date": 1437616639, "post_id": 31576288, "comment_id": 51108286, "body": "The struct tag just has to be a string literal.  People usually use the backtick syntax because it removes the need to escape the embedded quotes, but a tag like <code>&quot;db:\\&quot;FMR_Fund_Number\\&quot;&quot;</code> would be just as correct."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 1, "creation_date": 1437617485, "post_id": 31576288, "comment_id": 51108535, "body": "@JamesHenstridge Yep, correct. Was attempting to keep the confusion low\u2014I don&#39;t think I&#39;ve seen a non-backtick case &quot;in the wild&quot; yet either (never say never)."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 2, "last_activity_date": 1437611682, "creation_date": 1437611682, "answer_id": 31576288, "question_id": 31575886, "link": "https://stackoverflow.com/questions/31575886/what-is-the-correct-way-to-use-and-for-indicating-db-column-names/31576288#31576288", "title": "What is the correct way to use &#39; and &quot; for indicating db column names?", "body": "<p>Struct tags use backticks - the ` character (commonly under the Esc key on US keyboard layouts) - not single quotes.</p>\n\n<p>Your struct should look like the below, noting that underscores in variable names aren't particularly idiomatic in Go.</p>\n\n<p>The reason you use struct tags is often to map exported (capitalised) Go struct field names to the names used by other things (JSON, databases, HTML forms, etc).</p>\n\n<pre><code>type pah struct {\n    FMRFundNumber                  string  `db:\"FMR_Fund_Number\"`\n    BusinessDataDate               string  `db:\"Business_Data_Date\"`\n    OutboundCompositionCode        string  `db:\"Outbound_Composition_Code\"`\n    CompositionSubCode             string  `db:\"Composition_Sub_Code\"`\n    CompositionSubCodeDescription string  `db:\"Composition_Sub_Code_Description\"`\n    PositionName                    string  `db:\"Position_Name\"`\n    PrimaryValue                    float64 `db:\"Primary_Value\"`\n    RecordOrder                     int     `db:\"Record_Order\"`\n    TierIndicator                   string  `db:\"Tier_Indicator\"`\n}\n</code></pre>\n\n<p>See the docs: <a href=\"http://golang.org/pkg/reflect/#StructTag\" rel=\"nofollow\">http://golang.org/pkg/reflect/#StructTag</a> and <a href=\"http://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow\">http://golang.org/pkg/encoding/json/#Marshal</a></p>\n"}], "owner": {"reputation": 169, "user_id": 4608248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a1a155709573d1fc48c4f3875e1ea7ec?s=128&d=identicon&r=PG&f=1", "display_name": "rvrtex", "link": "https://stackoverflow.com/users/4608248/rvrtex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 31576288, "answer_count": 1, "score": 1, "last_activity_date": 1437624913, "creation_date": 1437608809, "last_edit_date": 1437624913, "question_id": 31575886, "link": "https://stackoverflow.com/questions/31575886/what-is-the-correct-way-to-use-and-for-indicating-db-column-names", "title": "What is the correct way to use &#39; and &quot; for indicating db column names?", "body": "<p>I have a table in my DB that the column names all start with caps (ie: FMR_Number, Primary_Value). The column name are out of my control. All the other columns in the DB (in other tables) are lower case. I have mapped a struct to the table but I keep getting a missing destination err from the query. I believe it is because the name mapper is set to ToLower (which is what it needs for everywhere else). I attempted to use this format</p>\n\n<pre><code>StructField string 'db:\"RealColumnName\"'  \n</code></pre>\n\n<p>to specify the mapping explicitly but I get an illegal rune literal. When I go look at examples in other peoples code I see it being represented in the way I just tried it. If I reverse the ' and \" to</p>\n\n<pre><code>StructField string \"db:'RealColumnName'\"  \n</code></pre>\n\n<p>I don't get the illegal rune literal error but I do get the missing destination err. What am I doing wrong here? I am using sqlx.</p>\n\n<p>My Struct</p>\n\n<pre><code>type pah struct {\n    FMR_Fund_Number                  string  'db:\"FMR_Fund_Number\"'\n    Business_Data_Date               string  'db:\"Business_Data_Date\"'\n    Outbound_Composition_Code        string  'db:\"Outbound_Composition_Code\"'\n    Composition_Sub_Code             string  'db:\"Composition_Sub_Code\"'\n    Composition_Sub_Code_Description string  'db:\"Composition_Sub_Code_Description\"'\n    Position_Name                    string  'db:\"Position_Name\"'\n    Primary_Value                    float64 'db:\"Primary_Value\"'\n    Record_Order                     int     'db:\"Record_Order\"'\n    Tier_Indicator                   string  'db:\"Tier_Indicator\"'\n}\n</code></pre>\n\n<p>My db call</p>\n\n<pre><code>func loadAssetAllocation() AssetAllocations {\n    pahGroup := []pah{}\n    pahQuery := \"SELECT FMR_Fund_Number,Business_Data_Date,Outbound_Composition_Code,Composition_Sub_Code,Composition_Sub_Code_Description,Primary_Value,Tier_Indicator,Record_Order FROM PAH WHERE FMR_Fund_Number = \\\"312\\\" AND Outbound_Composition_Code = \\\"MDCAT\\\" AND Business_Data_Date = (SELECT Business_Data_Date FROM PAH ORDER BY Business_Data_Date DESC LIMIT 1) AND Composition_Sub_Code &lt;&gt; \\\"TAXADV\\\" ORDER BY Record_Order ASC\"\n    assetAlloc := AssetAllocations{}\n    err := ffDB.Select(&amp;pahGroup, pahQuery)\n    fmt.Println(\"pahQuery AssetAllocation error: \", err)\n    assetAlloc.AssetAll = pahGroup\n    return assetAlloc\n}\n</code></pre>\n"}, {"tags": ["git", "github", "go", "docker"], "comments": [{"owner": {"reputation": 40726, "user_id": 2706422, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpWGi.jpg?s=128&g=1", "display_name": "0x7d7b", "link": "https://stackoverflow.com/users/2706422/0x7d7b"}, "edited": false, "score": 0, "creation_date": 1437643349, "post_id": 31574656, "comment_id": 51119102, "body": "To me that looks more like a network issue (you cannot access github.com) on the Docker host on which you are trying to build that image."}, {"owner": {"reputation": 39, "user_id": 4808032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a52e44ad4c78ce647680cce01e7f3c31?s=128&d=identicon&r=PG&f=1", "display_name": "Yaro", "link": "https://stackoverflow.com/users/4808032/yaro"}, "reply_to_user": {"reputation": 40726, "user_id": 2706422, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpWGi.jpg?s=128&g=1", "display_name": "0x7d7b", "link": "https://stackoverflow.com/users/2706422/0x7d7b"}, "edited": false, "score": 0, "creation_date": 1437671401, "post_id": 31574656, "comment_id": 51139623, "body": "I checked internet connectivity as suggested in <a href=\"http://stackoverflow.com/questions/17002663/how-to-configure-docker-to-be-able-to-have-internet-access-via-wireless-connecti\" title=\"how to configure docker to be able to have internet access via wireless connecti\">stackoverflow.com/questions/17002663/&hellip;</a>, and it was able to connect to google. I&#39;m still getting the same errors when I try to build my image, though."}, {"owner": {"reputation": 40726, "user_id": 2706422, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpWGi.jpg?s=128&g=1", "display_name": "0x7d7b", "link": "https://stackoverflow.com/users/2706422/0x7d7b"}, "edited": false, "score": 0, "creation_date": 1437671649, "post_id": 31574656, "comment_id": 51139787, "body": "Did you try to use a different DNS server for your docker daemon with &#39;docker --dns 8.8.8.8&#39; already?"}, {"owner": {"reputation": 39, "user_id": 4808032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a52e44ad4c78ce647680cce01e7f3c31?s=128&d=identicon&r=PG&f=1", "display_name": "Yaro", "link": "https://stackoverflow.com/users/4808032/yaro"}, "reply_to_user": {"reputation": 40726, "user_id": 2706422, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpWGi.jpg?s=128&g=1", "display_name": "0x7d7b", "link": "https://stackoverflow.com/users/2706422/0x7d7b"}, "edited": false, "score": 0, "creation_date": 1437675639, "post_id": 31574656, "comment_id": 51142181, "body": "Yeah, it gave me the same results as running without --dns."}, {"owner": {"reputation": 856, "user_id": 1127793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f511fb7651bd73b2d005443265bf151?s=128&d=identicon&r=PG", "display_name": "nkhumphreys", "link": "https://stackoverflow.com/users/1127793/nkhumphreys"}, "edited": false, "score": 0, "creation_date": 1438780611, "post_id": 31574656, "comment_id": 51589161, "body": "have you tried using a github machine key with read access and using the git@github syntax for cloning?"}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 1422516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7c8e3c49354dfde5b740d97c893ed5?s=128&d=identicon&r=PG", "display_name": "Chris Jacobs", "link": "https://stackoverflow.com/users/1422516/chris-jacobs"}, "is_accepted": false, "score": 0, "last_activity_date": 1443770650, "last_edit_date": 1443770650, "creation_date": 1443770285, "answer_id": 32902249, "question_id": 31574656, "link": "https://stackoverflow.com/questions/31574656/golang-docker-private-github-repository/32902249#32902249", "title": "golang docker private github repository", "body": "<p>First check DNS on your local machine with <code>dig github.com</code> or <code>nslookup github.com</code>.</p>\n\n<p>What is your docker setup?  Kitematic or Boot2docker?  If it's launching from the helper VM then try running the commands there, which is where it's trying to build, and failing on the lookup.  Often the lookup failure just means no route to the internet, since host resolution is the first step in connecting to its IP.</p>\n"}, {"tags": [], "owner": {"reputation": 133, "user_id": 1230774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/390bccc47405bce56dfa52d2bf2d7c2c?s=128&d=identicon&r=PG", "display_name": "fredriksvensson", "link": "https://stackoverflow.com/users/1230774/fredriksvensson"}, "is_accepted": false, "score": 0, "last_activity_date": 1455961171, "creation_date": 1455961171, "answer_id": 35521468, "question_id": 31574656, "link": "https://stackoverflow.com/questions/31574656/golang-docker-private-github-repository/35521468#35521468", "title": "golang docker private github repository", "body": "<p>For people googling this question.</p>\n\n<p>It is probably boot2docker that for some reason lose network. Just restart it with docker-machine restart default.</p>\n"}], "owner": {"reputation": 39, "user_id": 4808032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a52e44ad4c78ce647680cce01e7f3c31?s=128&d=identicon&r=PG&f=1", "display_name": "Yaro", "link": "https://stackoverflow.com/users/4808032/yaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 864, "favorite_count": 2, "answer_count": 2, "score": 3, "last_activity_date": 1455961171, "creation_date": 1437601971, "question_id": 31574656, "link": "https://stackoverflow.com/questions/31574656/golang-docker-private-github-repository", "title": "golang docker private github repository", "body": "<p>I'm trying to create a docker image that pulls from a both private and public github repositories. The dockerfile I'm using is</p>\n\n<pre><code>FROM golang:1.4.2-onbuild\n\nENV GOPATH /go\nENV PATH /go/bin:$PATH\n\nEXPOSE 3000\n\nRUN mkdir -p /go/src/github.com/eddi/api\nRUN git clone https://&lt;access token&gt;@github.com/owner/repo.git /go/src/github.com/owner/repo\n\nWORKDIR /go/src/github.com/eddi/api\n\nRUN go get github.com/gin-gonic/gin\nRUN go run server.go\n</code></pre>\n\n<p>But when I run docker build . I get the following error:</p>\n\n<blockquote>\n  <p>cd .; git clone <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow\">https://github.com/gin-gonic/gin</a> /go/src/github.com/gin-gonic/gin</p>\n  \n  <p>Cloning into '/go/src/github.com/gin-gonic/gin'...</p>\n  \n  <p>fatal: unable to access '<a href=\"https://github.com/gin-gonic/gin/\" rel=\"nofollow\">https://github.com/gin-gonic/gin/</a>': Could not resolve h ost: github.com</p>\n</blockquote>\n\n<p>for both private and public repositories. How can I get my dockerfile to behave well with importing libraries?</p>\n"}, {"tags": ["ruby", "regex", "go"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 7, "creation_date": 1437601016, "post_id": 31574320, "comment_id": 51103780, "body": "Please check <a href=\"http://stackoverflow.com/a/23968993/3832970\">this answer</a>. In short: it is not possible to use backreferences in Go regex."}], "answers": [{"tags": [], "owner": {"reputation": 66, "user_id": 3512719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0856fcbf5ab5a610e0c3e2dfc77e2c46?s=128&d=identicon&r=PG", "display_name": "marsgoonbars", "link": "https://stackoverflow.com/users/3512719/marsgoonbars"}, "is_accepted": true, "score": 1, "last_activity_date": 1437618881, "creation_date": 1437618881, "answer_id": 31577242, "question_id": 31574320, "link": "https://stackoverflow.com/questions/31574320/how-to-use-lookbehind-regexp-in-go/31577242#31577242", "title": "How to use lookbehind regexp in go?", "body": "<p>lookbehinds aren't supported neither are backreferences like <strong>@stribizhev</strong> mentioned.</p>\n\n<p><strong>Regular Expression 2 (RE2) Syntax Reference:</strong><br />\n<a href=\"https://github.com/google/re2/wiki/Syntax\" rel=\"nofollow\">https://github.com/google/re2/wiki/Syntax</a><br /></p>\n\n<blockquote>\n  <p>The syntax of the regular expressions accepted is the same general\n  syntax used by Perl, Python, and other languages. More precisely, it\n  is the syntax accepted by RE2 and described at\n  //code.google.com/p/re2/wiki/Syntax, except for \\C. <strong>--GoLang Docs</strong><br />\n  (<strong>ref:</strong> <a href=\"https://golang.org/pkg/regexp/\" rel=\"nofollow\">https://golang.org/pkg/regexp/</a>)</p>\n</blockquote>\n"}], "owner": {"reputation": 1929, "user_id": 1163114, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3e37db02fffa5f438329187fea4d287d?s=128&d=identicon&r=PG", "display_name": "bab", "link": "https://stackoverflow.com/users/1163114/bab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1126, "favorite_count": 1, "accepted_answer_id": 31577242, "answer_count": 1, "score": 1, "last_activity_date": 1437618881, "creation_date": 1437600556, "last_edit_date": 1437603148, "question_id": 31574320, "link": "https://stackoverflow.com/questions/31574320/how-to-use-lookbehind-regexp-in-go", "title": "How to use lookbehind regexp in go?", "body": "<p>I'm trying to convert this ruby regex to go. </p>\n\n<pre><code>GROUP_CALL = /^(?&lt;i1&gt;[ \\t]*)group\\(?[ \\t]*(?&lt;grps&gt;#{SYMBOLS})[ \\t]*\\)?[ \\t]+do[ \\t]*?\\n(?&lt;blk&gt;.*?)\\n^\\k&lt;i1&gt;end[ \\t]*$/m\n</code></pre>\n\n<p>I converted it to </p>\n\n<pre><code>groupCall := regexp.MustCompile(\"^(?P&lt;i1&gt;[ \\\\t]*)group\\\\(?[ \\\\t]*(?P&lt;grps&gt;(?::\\\\w+|:\\\"[^\\\"#]+\\\"|:'[^']+')([ \\\\t]*,[ \\\\t]*(?::\\\\w+|:\\\"[^\\\"#]+\\\"|:'[^']+'))*)[ \\\\t]*\\\\)?[ \\\\t]+do[ \\\\t]*?\\\\n(?P&lt;blk&gt;.*?)\\\\n^\\\\k&lt;i1&gt;end[ \\\\t]*$/s\")\n</code></pre>\n\n<p>but when run I get this error</p>\n\n<pre><code>error parsing regexp: invalid escape sequence: \\k\n</code></pre>\n\n<p>There's no mention of <code>\\k</code> in the <a href=\"https://golang.org/pkg/regexp/syntax/\" rel=\"nofollow\">go docs</a>, is there no equivalent in go?</p>\n"}, {"tags": ["go", "docker", "kubernetes"], "answers": [{"comments": [{"owner": {"reputation": 111, "user_id": 18764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f24c67cd0dc74011105047f97b63705?s=128&d=identicon&r=PG", "display_name": "bite-code", "link": "https://stackoverflow.com/users/18764/bite-code"}, "edited": false, "score": 0, "creation_date": 1437992542, "post_id": 31602551, "comment_id": 51246457, "body": "I have done some testing on this and it appears in the most part to work, however I have noted 2 things that I cant seem to find out. When I implement an extreme scale (from 10 containers to 1) I can still get errors. I managed to find a workaround by blocking on the prestop http call for 5 seconds, which seems to give more chance for the system to do a readyness check and successfully remove that container from the proxy.  I have been looking over the doc but cant find any info on how often readyness or liveness checks run? Ideally one would be forced between prestop and SIGTERM?"}], "tags": [], "owner": {"reputation": 3926, "user_id": 4175029, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2ff012ca59db545fb777ea41917504c?s=128&d=identicon&r=PG", "display_name": "brendan", "link": "https://stackoverflow.com/users/4175029/brendan"}, "is_accepted": true, "score": 5, "last_activity_date": 1527675471, "last_edit_date": 1527675471, "creation_date": 1437714190, "answer_id": 31602551, "question_id": 31574038, "link": "https://stackoverflow.com/questions/31574038/how-can-i-ensure-graceful-scaling-in-kubernetes/31602551#31602551", "title": "How can I ensure graceful scaling in kubernetes?", "body": "<p>You should use a readiness check (<a href=\"http://kubernetes.io/v1.0/docs/user-guide/production-pods.html#liveness-and-readiness-probes-aka-health-checks\" rel=\"nofollow noreferrer\">http://kubernetes.io/v1.0/docs/user-guide/production-pods.html#liveness-and-readiness-probes-aka-health-checks</a>)</p>\n\n<p>that transitions the Pod to \"not ready\" after you receive a SIGTERM</p>\n\n<p>Once that happens, the service will remove the Pod from serving, prior to the delete.  </p>\n\n<p>(without a readiness check the Service simply doesn't know that the pod doesn't exist, until it is actually deleted)</p>\n\n<p>You may also want to use a PreStop hook that sets readiness to false, and then drains all existing requests.  PreStop hooks are called synchronously prior to a Pod being deleted and they are described here:</p>\n\n<p><a href=\"https://kubernetes-v1-4.github.io/docs/user-guide/production-pods/#lifecycle-hooks-and-termination-notice\" rel=\"nofollow noreferrer\">https://kubernetes-v1-4.github.io/docs/user-guide/production-pods/#lifecycle-hooks-and-termination-notice</a></p>\n"}, {"tags": [], "owner": {"reputation": 3027, "user_id": 3653449, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/YE2UG.jpg?s=128&g=1", "display_name": "Tim Hockin", "link": "https://stackoverflow.com/users/3653449/tim-hockin"}, "is_accepted": false, "score": 1, "last_activity_date": 1437714793, "creation_date": 1437714793, "answer_id": 31602660, "question_id": 31574038, "link": "https://stackoverflow.com/questions/31574038/how-can-i-ensure-graceful-scaling-in-kubernetes/31602660#31602660", "title": "How can I ensure graceful scaling in kubernetes?", "body": "<p>There is a small window during which a pod that is being removed but is still alive will be part of the load-balancing set.  As Brendan just said (he beat me by seconds), a readiness check should fix this for you completely under your control.</p>\n"}], "owner": {"reputation": 111, "user_id": 18764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f24c67cd0dc74011105047f97b63705?s=128&d=identicon&r=PG", "display_name": "bite-code", "link": "https://stackoverflow.com/users/18764/bite-code"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2513, "favorite_count": 4, "accepted_answer_id": 31602551, "answer_count": 2, "score": 6, "last_activity_date": 1527675471, "creation_date": 1437599402, "question_id": 31574038, "link": "https://stackoverflow.com/questions/31574038/how-can-i-ensure-graceful-scaling-in-kubernetes", "title": "How can I ensure graceful scaling in kubernetes?", "body": "<p>As part of scaling pods in kubernetes I want to ensure I gracefully serve my http connections before shutting down. To that extent I have implemented this code in go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n\n    \"github.com/braintree/manners\"\n)\n\nfunc main() {\n\n    shutdown := make(chan int)\n\n    //create a notification channel to shutdown\n    sigChan := make(chan os.Signal, 1)\n\n    //start the http server\n    http.HandleFunc(\"/\", hello)\n    server := manners.NewWithServer(&amp;http.Server{Addr: \":80\", Handler: nil})\n    go func() {\n        server.ListenAndServe()\n        shutdown &lt;- 1\n    }()\n\n    //register for interupt (Ctrl+C) and SIGTERM (docker)\n    signal.Notify(sigChan, os.Interrupt, syscall.SIGTERM)\n    go func() {\n        &lt;-sigChan\n        fmt.Println(\"Shutting down...\")\n        server.Close()\n    }()\n\n    &lt;-shutdown\n}\n\nfunc hello(w http.ResponseWriter, r *http.Request) {\n    // time.Sleep(3000 * time.Millisecond)\n    io.WriteString(w, \"Hello world!\")\n}\n</code></pre>\n\n<p>This looks out for the docker SIGTERM and gracefully shuts down after existing requests have been served. When I run this container in kubernetes with 10 instances I can scale up and down without incident, as long as I don't scale down to a single instance. When I scale to a single instance I see a short set of http errors, then all looks fine again.</p>\n\n<p>I find it strange as in scaling I would assume the proxy is updated first, then containers are shut down and the code above would allow requests to be served out.</p>\n\n<p>In my current setup I am running 2 nodes, maybe the issue is when scaling drops below the number of nodes and there is some sort of timing issue with etcd updates? Any insight into what is going on here would be really useful</p>\n"}, {"tags": ["go", "concurrency", "channel"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437595676, "post_id": 31572753, "comment_id": 51100807, "body": "What about your channel solution doesn&#39;t work? The range loop will exit if there&#39;s no more items in the channel and it&#39;s closed."}, {"owner": {"reputation": 2337, "user_id": 600061, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bbac8bb4d3ffbceca42b09eb0729e63c?s=128&d=identicon&r=PG", "display_name": "Twisted1919", "link": "https://stackoverflow.com/users/600061/twisted1919"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437595764, "post_id": 31572753, "comment_id": 51100854, "body": "@JimB If i don&#39;t use the sync.WaitGroup there, it hangs for some reason..."}, {"owner": {"reputation": 2337, "user_id": 600061, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bbac8bb4d3ffbceca42b09eb0729e63c?s=128&d=identicon&r=PG", "display_name": "Twisted1919", "link": "https://stackoverflow.com/users/600061/twisted1919"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437596479, "post_id": 31572753, "comment_id": 51101313, "body": "@JimB - I mean the WaitGroup from <code>processWithChannels</code> function. If i remove that then it hangs. Or you mean that that is the correct way to do it since there&#39;s no way to know when all those processes are done and the channel is closed?"}], "answers": [{"comments": [{"owner": {"reputation": 2337, "user_id": 600061, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bbac8bb4d3ffbceca42b09eb0729e63c?s=128&d=identicon&r=PG", "display_name": "Twisted1919", "link": "https://stackoverflow.com/users/600061/twisted1919"}, "edited": false, "score": 0, "creation_date": 1437598142, "post_id": 31573574, "comment_id": 51102304, "body": "Thank you. The only reason i thought of using buffered channels here is that i thought it would send 1000 items into the channel and then the channel will block till items in it are processed making room for new ones till nothing else left, this way, slowing things down and not making 65535 request at once. Does that makes any sense ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2337, "user_id": 600061, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bbac8bb4d3ffbceca42b09eb0729e63c?s=128&d=identicon&r=PG", "display_name": "Twisted1919", "link": "https://stackoverflow.com/users/600061/twisted1919"}, "edited": false, "score": 0, "creation_date": 1437598301, "post_id": 31573574, "comment_id": 51102402, "body": "@Twisted1919: I see what you mean, but that doesn&#39;t work for the reason I cited, as well as the fact that you call <code>worker</code> <i>before</i> you send on the channel. If you want to limit the number of concurrent dials, use a set pool of goroutines (which would be more efficient anyway). I&#39;ll make an example."}, {"owner": {"reputation": 2337, "user_id": 600061, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bbac8bb4d3ffbceca42b09eb0729e63c?s=128&d=identicon&r=PG", "display_name": "Twisted1919", "link": "https://stackoverflow.com/users/600061/twisted1919"}, "edited": false, "score": 0, "creation_date": 1437598436, "post_id": 31573574, "comment_id": 51102485, "body": "I see, okay in this case i think the example would help a lot :)"}, {"owner": {"reputation": 2337, "user_id": 600061, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bbac8bb4d3ffbceca42b09eb0729e63c?s=128&d=identicon&r=PG", "display_name": "Twisted1919", "link": "https://stackoverflow.com/users/600061/twisted1919"}, "edited": false, "score": 0, "creation_date": 1437600179, "post_id": 31573574, "comment_id": 51103366, "body": "the part where 100 workers are spawned to do the actual work makes a world of difference. Thanks for taking the time for this."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1437599131, "last_edit_date": 1437599131, "creation_date": 1437597614, "answer_id": 31573574, "question_id": 31572753, "link": "https://stackoverflow.com/questions/31572753/how-to-properly-loop-through-buffered-channel-in-this-case/31573574#31573574", "title": "How to properly loop through buffered channel in this case?", "body": "<p>The call to <code>processWithChannels</code> will hang if you need to put more than 1000 items into the channel. If you're going to use a buffered channel to hold all values until processing, there has to be enough capacity to accept all values.</p>\n\n<p>If you are going to collect all values into a single slice, then there's no reason to use a channel, and your second solution is just fine.</p>\n\n<p>If you want to \"stream\" the ports back as soon as possible, then you need something in between the two solutions</p>\n\n<pre><code>ports := make(chan string)\n\nvar wg sync.WaitGroup\nfor i := 1; i &lt;= 65535; i++ {\n    wg.Add(1)\n    go func(i int) {\n        defer wg.Done()\n        if port := worker(*host, i); port != \"\" {\n            ports &lt;- port\n        }\n    }(i)\n}\n\ngo func() {\n    wg.Wait()\n    close(ports)\n}()\n\nfor port := range ports {\n    fmt.Println(\"PORT:\", port)\n}\n</code></pre>\n\n<p>This however is likely to run into problems, like missing open ports when you dial all 65535 ports at the same time. Here is one possible pattern to use a pool of workers to dial concurrently:</p>\n\n<pre><code>ports := make(chan string)\ntoScan := make(chan int)\nvar wg sync.WaitGroup\n\n// make 100 workers for dialing\nfor i := 0; i &lt; 100; i++ {\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        for p := range toScan {\n            ports &lt;- worker(*host, p)\n        }\n    }()\n}\n\n// close our receiving ports channel once all workers are done\ngo func() {\n    wg.Wait()\n    close(ports)\n}()\n\n// feed the ports to the worker pool\ngo func() {\n    for i := 1; i &lt;= 65535; i++ {\n        toScan &lt;- i\n    }\n    // signal the workers to stop\n    close(toScan)\n}()\n\nfor port := range ports {\n    if port != \"\" {\n        fmt.Println(\"PORT:\", port)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2337, "user_id": 600061, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bbac8bb4d3ffbceca42b09eb0729e63c?s=128&d=identicon&r=PG", "display_name": "Twisted1919", "link": "https://stackoverflow.com/users/600061/twisted1919"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1831, "favorite_count": 1, "accepted_answer_id": 31573574, "answer_count": 1, "score": 0, "last_activity_date": 1437599131, "creation_date": 1437594738, "last_edit_date": 1437595165, "question_id": 31572753, "link": "https://stackoverflow.com/questions/31572753/how-to-properly-loop-through-buffered-channel-in-this-case", "title": "How to properly loop through buffered channel in this case?", "body": "<p>I am trying to play around with go to make some kind of port scanner using the stdlib. This is more of an exercise than anything else, so please don't comment on the logic involved.</p>\n\n<p>Looking at the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"net\"\n    \"time\"\n    \"strings\"\n    \"strconv\"\n    \"log\"\n    \"sync\"\n)\n\nvar commonPorts = map[int]string {\n    21: \"ftp\",\n    22: \"sftp\",\n    80: \"http\",\n    110: \"pop3\",\n    143: \"imap\",\n    443: \"https\",\n    631: \"ipp\",\n    993: \"imaps\",\n    995: \"pop3s\",\n}\n\ntype OP struct {\n    mu sync.Mutex\n    ports []string\n}\n\nfunc (o *OP) SafeAdd(port string) {\n    o.mu.Lock()\n    defer o.mu.Unlock()\n    o.ports = append(o.ports, port)\n}\n\n\nfunc worker(host string, port int) string {\n    address := fmt.Sprintf(\"%s:%d\", host, port)\n\n    conn, err := net.DialTimeout(\"tcp\", address, time.Second * 3)\n    if err != nil {\n        return \"\"; // is offline, cannot connect\n    }\n    conn.Close()\n\n    stringI := strconv.Itoa(port)\n    if name, ok := commonPorts[port]; ok {\n        stringI += fmt.Sprintf(\"(%s)\", name)\n    }\n\n    return stringI\n}\n\nfunc processWithChannels(host string) &lt;-chan string{\n    openPort := make(chan string, 1000)\n    var wg sync.WaitGroup\n    for i := 1; i &lt;= 65535; i++ {\n        wg.Add(1)\n        go func(openPort chan string, host string, i int) {\n            defer wg.Done()\n            port := worker(host, i)\n            if port != \"\" {\n                openPort &lt;- port\n            }\n        }(openPort, host, i)\n    }\n    wg.Wait()\n    close(openPort)\n    return openPort\n}\n\nfunc main() {\n    var host = flag.String(\"host\", \"127.0.0.1\", \"please insert the host\")\n    var pType = flag.Int(\"type\", 2, \"please insert the type\")\n\n    flag.Parse()\n    fmt.Printf(\"Scanning: %s...\\n\", *host)\n\n    if _, err := net.LookupHost(*host); err != nil {\n        log.Fatal(err)\n    }\n\n    openPorts := &amp;OP{ports: []string{}};\n\n    if *pType == 1 {\n\n        ports := processWithChannels(*host);\n        for port := range ports {\n            openPorts.SafeAdd(port)\n        }\n\n    } else {\n\n        var wg sync.WaitGroup\n        for i := 1; i &lt;= 65535; i++ {\n            wg.Add(1)\n            go func(o *OP, host string, i int){\n                defer wg.Done()\n                if port := worker(host, i); port != \"\" {\n                    o.SafeAdd(port)\n                }\n            }(openPorts, *host, i)\n        }\n        wg.Wait()\n\n    }\n\n    if len(openPorts.ports) &gt; 0 {\n        fmt.Printf(\"Following ports are opened: %s\\n\", strings.Join(openPorts.ports, \", \"))\n    } else {\n        fmt.Printf(\"No open port on the host: %s!\\n\", *host)\n    }\n}\n</code></pre>\n\n<p>There are two ways of starting a scan, either by using a buffered channel or by using sync.GroupWait and bail out once all the scans are done. </p>\n\n<p>It seems to me that in this case, using sync.GroupWait makes more sense than using a buffered channel and loop through it till it's empty. However, using a buffered channel here, i don't see a way to detect that there's nothing else on the channel and that i should bail out from the for loop, except by using another sync.WaitGroup block.</p>\n\n<p>I think my question is, in case i want to use the buffered channel solution only, how do i implement it properly so that i know when the processing is done so that i can proceed with the rest of the code? (don't suggest timeouts please).</p>\n\n<p>Here's also a small benchmark with the two types, in case anyone interested:</p>\n\n<pre><code>MacBook-Pro:PortScanner c$ time ./PortScanner -host yahoo.com -type 1\nScanning: yahoo.com...\nFollowing ports are opened: 80(http), 143(imap), 110(pop3), 995(pop3s), 993(imaps)\n\nreal    0m4.620s\nuser    0m1.193s\nsys     0m1.284s\nMacBook-Pro:PortScanner c$ time ./PortScanner -host yahoo.com -type 2\nScanning: yahoo.com...\nFollowing ports are opened: 110(pop3), 80(http), 143(imap), 995(pop3s), 993(imaps)\n\nreal    0m4.055s\nuser    0m1.051s\nsys     0m0.946s\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 2, "creation_date": 1437583481, "post_id": 31569071, "comment_id": 51093451, "body": "If it&#39;s a &quot;common struct shared among all &#39;instances&#39; of MyType&quot; and &quot;completely constant&quot;, sounds like it could maybe safely be a global, potentially private to the package where these functions are defined. If there&#39;s a reason it can&#39;t be, it might be helpful to revise those comments to help clear up the question."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437658173, "post_id": 31569071, "comment_id": 51129426, "body": "Your example is, at minimum, missing all the <code>func</code> keywords. Ideally sample/example code should compile but (IMO) at minimum it should be syntactically correct."}], "answers": [{"comments": [{"owner": {"reputation": 479, "user_id": 228140, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/NiYQf.png?s=128&g=1", "display_name": "Julian", "link": "https://stackoverflow.com/users/228140/julian"}, "edited": false, "score": 0, "creation_date": 1437583654, "post_id": 31569211, "comment_id": 51093545, "body": "Thank you so much!  I&#39;ll try that and tell you about my progress &amp; upvote accordingly :)"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1437583506, "creation_date": 1437583506, "answer_id": 31569211, "question_id": 31569071, "link": "https://stackoverflow.com/questions/31569071/how-to-reduce-number-of-parameters-in-go-nested-function-calls/31569211#31569211", "title": "How to reduce number of parameters in go nested function calls", "body": "<p>If all of this is within a single package you can simply declare <code>State</code> at the package level and use it everywhere. For example;</p>\n\n<pre><code>package myHttpClient\n\nimport (\n    \"allthatstuff\"\n)\n\nstate State // not exported but available everywhere in 'myHttpClient'\nExternState State // exported so anyone importing myHttpClient can do myHttpClient.ExternState\n</code></pre>\n"}], "owner": {"reputation": 479, "user_id": 228140, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/NiYQf.png?s=128&g=1", "display_name": "Julian", "link": "https://stackoverflow.com/users/228140/julian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 31569211, "answer_count": 1, "score": 0, "last_activity_date": 1437583506, "creation_date": 1437583107, "question_id": 31569071, "link": "https://stackoverflow.com/questions/31569071/how-to-reduce-number-of-parameters-in-go-nested-function-calls", "title": "How to reduce number of parameters in go nested function calls", "body": "<p>I have a go Calltree which is structured as follows:</p>\n\n<pre><code>// state is a common struct shared among all \"instances\" of MyType - simulating member variables for an Interface\n(s MyType) Run(state *State){ // called from outside\n  // define goroutines that fetch something via http\n  HTTPCallback(){ // runs on every http response\n    parseData(record, outputChan)\n  }\n}\n(s MyType) parseData(rec []string, outputChan chan(interface{})){\n  // doesn't need anything from \"state\" so far\n  doIdMapping(string) \n}\n\n\ndoIdMapping(key) { \n   return state.Map[key] \n}\n</code></pre>\n\n<p>Is there a way of getting access to the Map (which is completely constant) <strong>without</strong> being forced to pass the \"state\" through HTTPCallback and all the goroutines above which end up in calling HTTPCallback?</p>\n\n<p>This is not only bad for a clear code but also is bad when it comes to testing. All the intermediate functions carry around that struct pointer which they don't even need to depend on. Did I miss something about the language design of go? :/</p>\n"}, {"tags": ["go", "amazon-dynamodb", "aws-sdk", "aws-sdk-go"], "comments": [{"owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 1, "creation_date": 1437585394, "post_id": 31568081, "comment_id": 51094559, "body": "Please post a bit more of the stack trace, it&#39;ll actually show you the line where the error occurred."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1437594822, "post_id": 31568081, "comment_id": 51100273, "body": "Yes, we need the location of the panic from the stack trace, and where that is in your code. This doesn&#39;t look like a usual nil-pointer dereference, bc the panic addr is 0x20."}, {"owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "edited": false, "score": 0, "creation_date": 1437631937, "post_id": 31568081, "comment_id": 51112496, "body": "Without knowing the line number at which code is panicking, It is very difficult to answer your question."}, {"owner": {"reputation": 349, "user_id": 4651753, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--ox9WCbtwLg/AAAAAAAAAAI/AAAAAAAAB-s/Z0GzoOhBwuI/photo.jpg?sz=128", "display_name": "sr_149", "link": "https://stackoverflow.com/users/4651753/sr-149"}, "edited": false, "score": 0, "creation_date": 1437666233, "post_id": 31568081, "comment_id": 51136172, "body": "Hi, I apologize for the delay, it crashes right after input := &amp;dynamodb.PutItemInput. But after going through some more pages on the web on dynamoDB, got the program to write successfully to dynamo. Thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 293, "user_id": 3094829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ed9627215060e17cfeaab1a80b7ab53?s=128&d=identicon&r=PG&f=1", "display_name": "user3094829", "link": "https://stackoverflow.com/users/3094829/user3094829"}, "is_accepted": false, "score": 2, "last_activity_date": 1438168772, "last_edit_date": 1438168772, "creation_date": 1437585301, "answer_id": 31569806, "question_id": 31568081, "link": "https://stackoverflow.com/questions/31568081/golang-putitem-dynamodb-runtime-error-invalid-memory-address-or-nil-pointer-der/31569806#31569806", "title": "Golang PutItem DynamoDB: Runtime Error invalid memory address or nil pointer dereference", "body": "<p>It would be very helpful if you could show the stack trace of error. But until then i could say that this error usually occurs when you try to access member of any uninitialized variable.\nFor example if this error is comming at following line</p>\n\n<pre><code>a := b.c\n</code></pre>\n\n<p>then you need to check if b is initialized properly. Most probably value of b is nil hence nil pointer dereference.</p>\n"}, {"tags": [], "owner": {"reputation": 349, "user_id": 4651753, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--ox9WCbtwLg/AAAAAAAAAAI/AAAAAAAAB-s/Z0GzoOhBwuI/photo.jpg?sz=128", "display_name": "sr_149", "link": "https://stackoverflow.com/users/4651753/sr-149"}, "is_accepted": false, "score": 1, "last_activity_date": 1437667337, "creation_date": 1437667337, "answer_id": 31592548, "question_id": 31568081, "link": "https://stackoverflow.com/questions/31568081/golang-putitem-dynamodb-runtime-error-invalid-memory-address-or-nil-pointer-der/31592548#31592548", "title": "Golang PutItem DynamoDB: Runtime Error invalid memory address or nil pointer dereference", "body": "<pre><code>Following is what I could come up with from whatever I read across the net.\nWorking on local secondary indexes, range index and timestamps presently.\nThanks again!    \n\n\n    package main\n\n    import (\n        \"github.com/aws/aws-sdk-go/aws\"\n        // \"github.com/aws/aws-sdk-go/aws/awserr\"\n        \"github.com/aws/aws-sdk-go/aws/awsutil\"\n        \"github.com/aws/aws-sdk-go/service/dynamodb\"\n\n        \"log\"\n        \"strconv\"\n        \"time\"\n    )\n\n    type dynamo struct {\n        db            *dynamodb.DynamoDB\n        tableName     string\n        readCapacity  int64\n        writeCapacity int64\n    }\n\n    type metadata struct {\n        dynamoDb  *dynamo\n        batchID   string\n        field1    string\n        field2    string\n        batchSize int //In Bytes\n    }\n\n    func newDynamo(name string, readCapacity, writeCapacity int64) *dynamo {\n        cfg := aws.DefaultConfig\n        return &amp;dynamo{\n            db:            dynamodb.New(cfg),\n            tableName:     name,\n            readCapacity:  readCapacity,\n            writeCapacity: writeCapacity,\n        }\n    }\n\n    func newMetadata(batchID, field1Val, field2Val string, batchSizeVal int) *metadata {\n        return &amp;metadata{\n            batchID:   batchID,\n            field1:    field1Val,\n            field2:    field2Val,\n            batchSize: batchSizeVal,\n        }\n    }\n\n    var dynDB *dynamo\n    var m *metadata\n\n    func main() { //create the *metadata struct object, and it can then call writeToDynamo fn\n        log.Println(\"Entry\")\n\n        dynDB = newDynamo(\"tableName\", 1, 1) //make a new dynamo struct object\n        dynDB.createTable()\n\n        m = newMetadata(\"field1Value\", \"field2Value\", 232)\n        m.setDynamoDB()\n\n        m.writeToDynamo()\n\n        log.Println(\"Exit\")\n    }\n\n    func (d *dynamo) createTable() (err error) {\n        log.Println(\"createTable Entry\")\n        tableDefinition := &amp;dynamodb.CreateTableInput{\n            TableName: aws.String(d.tableName),\n            AttributeDefinitions: []*dynamodb.AttributeDefinition{ // Required\n                { // Required\n                    AttributeName: aws.String(\"batchID\"),\n                    AttributeType: aws.String(\"S\"), // Required\n                },\n            },\n            KeySchema: []*dynamodb.KeySchemaElement{ // Required\n                { // Required\n                    AttributeName: aws.String(\"batchID\"),\n                    KeyType:       aws.String(\"HASH\"), // Required\n                },\n            },\n            ProvisionedThroughput: &amp;dynamodb.ProvisionedThroughput{\n                ReadCapacityUnits:  aws.Long(d.readCapacity),\n                WriteCapacityUnits: aws.Long(d.writeCapacity),\n            },\n        }\n\n        resp, err := dynDB.db.CreateTable(tableDefinition)\n        log.Println(\"After CreateTable---\")\n\n        if err != nil {\n            log.Println(\"create table failed\", err.Error())\n            return err\n        }\n        if resp != nil &amp;&amp; resp.TableDescription != nil {\n            log.Println(\"TableStatus:\", resp.TableDescription.TableStatus)\n        }\n\n        log.Println(\"CreateTable Exit\")\n\n        //Sleep for 15 seconds, this is better when put in a function that validates the table that was created,\n        //But for testing, the program is put to sleep for 15 seconds. Program may fail if writeToDynamo is exedcuted\n        //without the table being in ACTIVE state.\n        time.Sleep(15 * time.Second)\n        return\n    }\n\n    func (m *metadata) writeToDynamo() {\n        log.Println(\"writeToDynamo\")\n\n        //Not exactly able to figure out what was wrong with the prev code snippet\n        params := &amp;dynamodb.PutItemInput{\n            TableName: aws.String(m.dynamoDb.tableName),\n            Item: map[string]*dynamodb.AttributeValue{\n                \"batchID\": &amp;dynamodb.AttributeValue{\n                    S: aws.String(m.batchID),\n                },\n                \"field2\": &amp;dynamodb.AttributeValue{\n                    S: aws.String(m.field2),\n                },\n                \"field3\": &amp;dynamodb.AttributeValue{\n                    S: aws.String(m.field3),\n                },\n                \"batchSize\": &amp;dynamodb.AttributeValue{\n                    N: aws.String(strconv.Itoa(m.batchSize_Compressed)),\n                },\n            },\n        }\n\n        resp2, err2 := dynDB.db.PutItem(params)\n\n        if err2 != nil {\n            // if awsErr, ok := err2.(awserr.Error); ok { // Generic AWS error with Code, Message, and original error (if any)\n            //  log.Println(awsErr.Code(), awsErr.Message(), awsErr.OrigErr())\n            //  if reqErr, ok := err.(awserr.RequestFailure); ok {\n            //      // A service error occurred\n            //      log.Println(reqErr.Code(), reqErr.Message(), reqErr.StatusCode(), reqErr.RequestID())\n            //  }\n            // } else { // This case should never be hit, the SDK should always return an //\n            //  //error which satisfies the awserr.Error interface.\n            //  log.Println(err2.Error())\n            // }\n            log.Println(\"Error while Writing:\", err2.Error())\n        }\n        log.Println(\"Response:\", awsutil.StringValue(resp2))\n    }\n\n    func (m *metadata) setDynamoDB() {\n        m.dynamoDb = dynDB\n    }\n</code></pre>\n"}], "owner": {"reputation": 349, "user_id": 4651753, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--ox9WCbtwLg/AAAAAAAAAAI/AAAAAAAAB-s/Z0GzoOhBwuI/photo.jpg?sz=128", "display_name": "sr_149", "link": "https://stackoverflow.com/users/4651753/sr-149"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2080, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1485816480, "creation_date": 1437580317, "last_edit_date": 1485816480, "question_id": 31568081, "link": "https://stackoverflow.com/questions/31568081/golang-putitem-dynamodb-runtime-error-invalid-memory-address-or-nil-pointer-der", "title": "Golang PutItem DynamoDB: Runtime Error invalid memory address or nil pointer dereference", "body": "<p>New to programming with golang and AWS.\n    Block of code in my function, trying out creating a new table and writing \n    values to it using AWS DynamoDB. \n    Creation is successful, but the program crashes when the Write happens. \n    Not sure why..I'd be really grateful if anyone could help me out!    </p>\n\n<pre><code>**Logs**:\n\n2015/07/22 15:46:46 TableStatus: 0xc208193cb0\n2015/07/22 15:46:46 End\n2015/07/22 15:46:48 Sleep 2: Before Write\n2015/07/22 15:46:48 Before Defining Input\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x20 pc=0x401b28]\n\n**Code Block:**\n {\n    log.Println(\"Entry+++\")\n        cfg := aws.DefaultConfig\n\n        svc := dynamodb.New(cfg)\n\n        tableDefinition := &amp;dynamodb.CreateTableInput{\n            TableName:            aws.String(\"table1\"),\n            AttributeDefinitions: make([]*dynamodb.AttributeDefinition, 1, 1),\n            KeySchema:            make([]*dynamodb.KeySchemaElement, 1, 1),\n            ProvisionedThroughput: &amp;dynamodb.ProvisionedThroughput{\n                ReadCapacityUnits:  aws.Long(1),\n                WriteCapacityUnits: aws.Long(1),\n            },\n        }\n\n        tableDefinition.KeySchema[0] = &amp;dynamodb.KeySchemaElement{\n            AttributeName: aws.String(\"batch_id\"),\n            KeyType:       aws.String(\"HASH\"),\n        }\n        tableDefinition.AttributeDefinitions[0] = &amp;dynamodb.AttributeDefinition{\n            AttributeName: aws.String(\"batch_id\"),\n            AttributeType: aws.String(\"S\"),\n        }\n\n        resp, err := svc.CreateTable(tableDefinition)\n        log.Println(\"After CreateTable---\")\n\n        if err != nil {\n            log.Println(\"create table failed\", err.Error())\n            return\n        }\n        if resp != nil &amp;&amp; resp.TableDescription != nil {\n            log.Println(\n                \"TableStatus:\", resp.TableDescription.TableStatus)\n        }\n\n        log.Println(\"End\")\n        //Some time before the createTable transaction gets committed. \n        time.Sleep(2 * time.Second)\n        log.Println(\"Sleep 2 Before Write\")\n\n        testA := \"batch_1\" //value to be written to the db\n        // testB := \"batch_name\"\n        // testC := \"530\"\n        // testD := \"Sample-Keyy-98\"\n\n        log.Println(\"Before Defining Input\")\n        input := &amp;dynamodb.PutItemInput{\n            TableName: aws.String(\"table1\"),\n            Item: map[string]*dynamodb.AttributeValue{\n                \"batch_id\": &amp;dynamodb.AttributeValue{\n                    S: aws.String(testA),\n                },\n                // \"name\": &amp;dynamodb.AttributeValue{\n                //  S: aws.String(testB),\n                // },\n            },\n        }\n\n        _, err2 := svc.PutItem(input)\n    }\n</code></pre>\n"}, {"tags": ["go", "stack-trace"], "comments": [{"owner": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "edited": false, "score": 2, "creation_date": 1437580480, "post_id": 31567734, "comment_id": 51091532, "body": "Take a look at <a href=\"http://stackoverflow.com/questions/25262754/how-to-get-name-of-current-package-in-go\">this</a>, it may help."}], "answers": [{"tags": [], "owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "is_accepted": true, "score": 1, "last_activity_date": 1437827739, "creation_date": 1437827739, "answer_id": 31626494, "question_id": 31567734, "link": "https://stackoverflow.com/questions/31567734/how-to-find-a-package-name-from-given-call-in-runtime/31626494#31626494", "title": "How to find a package name from given call in runtime?", "body": "<p>I came across a similar problem - from a package path how do you get the package name. The best solution I found is to exec the \"go list\" command. Not ideal but I came up blank elsewhere. </p>\n\n<p>In my case I also had a problem that sometimes the package is an empty directory. With no source files, \"go list\" throws an error, so I added a function to create a sensible package name from the path. </p>\n\n<p>Here's the code:</p>\n\n<pre><code>func getPackageName(path string) string {\n    output, err := exec.Command(\"go\", \"list\", \"-f\", \"{{.Name}}\", path).CombinedOutput()\n    if err != nil {\n        return guessPackageName(path)\n    }\n    return strings.TrimSpace(string(output))\n}\n\nfunc guessPackageName(path string) string {\n    preferred := path\n    if strings.HasSuffix(preferred, \"/\") {\n        // training slashes are usually tolerated, so we can get rid of one if it exists\n        preferred = preferred[:len(preferred)-1]\n    }\n    if strings.Contains(preferred, \"/\") {\n        // if the path contains a \"/\", use the last part\n        preferred = preferred[strings.LastIndex(preferred, \"/\")+1:]\n    }\n    if strings.Contains(preferred, \"-\") {\n        // the name usually follows a hyphen - e.g. github.com/foo/go-bar\n        // if the package name contains a \"-\", use the last part\n        preferred = preferred[strings.LastIndex(preferred, \"-\")+1:]\n    }\n    if strings.Contains(preferred, \".\") {\n        // dot is commonly usually used as a version - e.g. github.com/foo/bar.v1\n        // if the package name contains a \".\", use the first part\n        preferred = preferred[:strings.LastIndex(preferred, \".\")]\n    }\n    return preferred\n}\n</code></pre>\n"}], "owner": {"reputation": 6730, "user_id": 297094, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/08a7e4ec1109264bc3d18a519d15146c?s=128&d=identicon&r=PG", "display_name": "Robert Zaremba", "link": "https://stackoverflow.com/users/297094/robert-zaremba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1086, "favorite_count": 0, "accepted_answer_id": 31626494, "answer_count": 1, "score": 3, "last_activity_date": 1437827739, "creation_date": 1437579339, "question_id": 31567734, "link": "https://stackoverflow.com/questions/31567734/how-to-find-a-package-name-from-given-call-in-runtime", "title": "How to find a package name from given call in runtime?", "body": "<p>For logging purpose I want to write a function which will print a package name.\nI can do it for a directory name:</p>\n\n<pre><code>// file is the full file name\n// 4 - how many calls we want to go up in a stack trace.\n_, file, line, ok := runtime.Caller(4) \n</code></pre>\n\n<p>... but can't find a way for package name (package name can be different from directory name).</p>\n"}, {"tags": ["go", "build"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437576072, "post_id": 31566176, "comment_id": 51088150, "body": "That&#39;s what <code>go build</code> does, except for <code>main</code> packages. Maybe just remove the binary afterwards if it&#39;s a <code>package main</code>?"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 2, "creation_date": 1437576507, "post_id": 31566176, "comment_id": 51088501, "body": "<code>go build bla &amp;&amp; go clean bla</code>, maybe?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1437582484, "post_id": 31566176, "comment_id": 51092855, "body": "Just plain <code>go build</code>. Without any arguments it builds the package in the current directory (or gives an error if it can&#39;t). For a named package <code>go build import_path</code> works. Other than the temporary build dir which is removed on completion, neither updates any <code>$GOPATH&#47;pkg</code> files or otherwise produces anything."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437662192, "post_id": 31577767, "comment_id": 51132808, "body": "&quot;in a tmp directory that the OS will clean for you later&quot;; IMO that should not be assumed. When and <i>if</i> <code>&#47;tmp</code> is cleaned is an admin decision/configuration, it may be days, at next reboot, or not at all. Also <code>&#47;tmp</code> may be limited (e.g. a small partition or a memory filesystem) so it&#39;s a bad idea to litter <code>&#47;tmp</code> without cleaning up after yourself. (i.e. if you do this a lot perhaps an alias or small script that does something <i>like</i> <code>DIR=`mktemp -d -t &quot;gobuild&quot;`; go build -o &quot;$DIR&#47;foo&quot;; rm -rf -- &quot;$DIR&quot;</code>)."}, {"owner": {"reputation": 4577, "user_id": 217965, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/2f56f147c441727ffd27a57d747f131c?s=128&d=identicon&r=PG", "display_name": "Drew", "link": "https://stackoverflow.com/users/217965/drew"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437971024, "post_id": 31577767, "comment_id": 51236223, "body": "You could run out of disk space before such a time, but I did give it a hardcoded tmp location so every new binary would overwrite the previous one. I think it&#39;s hacky to require <code>make clean</code> on every build like this even on the very possible chance of having issues with disk space. This is why people complain about Go on the internet <a href=\"https://github.com/flycheck/flycheck/blob/master/flycheck.el#L6084-L6086\" rel=\"nofollow noreferrer\">github.com/flycheck/flycheck/blob/master/&hellip;</a> It would be awesome if <code>go build</code> could be instructed to leave the bin in the tmp workdir it uses."}], "tags": [], "owner": {"reputation": 4577, "user_id": 217965, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/2f56f147c441727ffd27a57d747f131c?s=128&d=identicon&r=PG", "display_name": "Drew", "link": "https://stackoverflow.com/users/217965/drew"}, "is_accepted": false, "score": 0, "last_activity_date": 1437622871, "creation_date": 1437622871, "answer_id": 31577767, "question_id": 31566176, "link": "https://stackoverflow.com/questions/31566176/check-if-a-package-will-build/31577767#31577767", "title": "Check if a package will build", "body": "<p><code>go build</code></p>\n\n<p>For package main, a binary will be generated by go build. You can dump that in a tmp directory that the OS will clean for you later.</p>\n\n<p><code>go build -o /tmp/oswilldeleteme</code></p>\n\n<p>Unfortunately, you can not pipe the output of <code>go build</code> to the null device. See this issue: <a href=\"https://github.com/golang/go/issues/4851\" rel=\"nofollow\">https://github.com/golang/go/issues/4851</a></p>\n"}], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1437622871, "creation_date": 1437575533, "question_id": 31566176, "link": "https://stackoverflow.com/questions/31566176/check-if-a-package-will-build", "title": "Check if a package will build", "body": "<p>How can I determine if a package will build, without installing it, running its tests, or generating a binary?</p>\n\n<p>There's a mention that using <code>go build</code> with more than one package just tests if they build. How can I do that for a single package?</p>\n"}, {"tags": ["postgresql", "go", "error-handling"], "answers": [{"comments": [{"owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437574314, "post_id": 31565591, "comment_id": 51086709, "body": "Thanks. However, If I insert that into my code I get the following compile error: /server.go:137: undefined: pq"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437574477, "post_id": 31565591, "comment_id": 51086836, "body": "You must&#39;ve used the empty import. Instead of <code>import _ &quot;github.com&#47;lib&#47;pq&quot;</code>, write <code>import &quot;github.com&#47;lib&#47;pq&quot;</code> to actually import the package."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 13, "last_activity_date": 1437574216, "creation_date": 1437574216, "answer_id": 31565591, "question_id": 31565505, "link": "https://stackoverflow.com/questions/31565505/get-error-code-number-from-postgres-in-go/31565591#31565591", "title": "Get error code number from postgres in Go", "body": "<p>You need to type assert the error to the type <code>*pq.Error</code>:</p>\n\n<pre><code>pqErr := err.(*pq.Error)\nlog.Println(pqErr.Code)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 11, "last_activity_date": 1465716829, "creation_date": 1465716829, "answer_id": 37771806, "question_id": 31565505, "link": "https://stackoverflow.com/questions/31565505/get-error-code-number-from-postgres-in-go/37771806#37771806", "title": "Get error code number from postgres in Go", "body": "<p>This is <a href=\"https://godoc.org/github.com/lib/pq#hdr-Errors\" rel=\"noreferrer\">written in the documentation</a>. As you see you can extract it in this way:</p>\n\n<pre><code>if err, ok := err.(*pq.Error); ok {\n    fmt.Println(err.Code)\n}\n</code></pre>\n\n<p>Do not forget to remove the underscore from your import <code>_ \"github.com/lib/pq\"</code>. As you see <code>err</code> has a <a href=\"https://godoc.org/github.com/lib/pq#Error\" rel=\"noreferrer\">lot of information about the error</a> (not only <code>Code</code> but many others).</p>\n\n<p>Notice that you can't compare it directly to some code (it is of <code>ErrorCode type</code>).</p>\n\n<p>So you have to convert it to string and compare against a string.</p>\n\n<p><a href=\"https://godoc.org/github.com/lib/pq#Error\" rel=\"noreferrer\">https://godoc.org/github.com/lib/pq#Error</a></p>\n"}], "owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7877, "favorite_count": 0, "accepted_answer_id": 31565591, "answer_count": 2, "score": 11, "last_activity_date": 1606346832, "creation_date": 1437573980, "last_edit_date": 1437576923, "question_id": 31565505, "link": "https://stackoverflow.com/questions/31565505/get-error-code-number-from-postgres-in-go", "title": "Get error code number from postgres in Go", "body": "<p>I'm simply unable to retrieve the error code number when I get an error in postgres. </p>\n\n<p>In the test of my program I know I'll get the following error \n\" pq: duplicate key value violates unique constraint \"associations_pkey\"\".</p>\n\n<p>Looking in the postgres docs this is most likely an pq error code of 23505.</p>\n\n<p>I need to get that number in my Go program so that I can check on different types of errors and respond to the end user in a helpful way. </p>\n\n<p>However, I can't seem to get hold of the error code in Go, only the error message. My code is as follows:</p>\n\n<pre><code>stmt, _ := DB.Prepare(\"INSERT INTO table (column_1) VALUES ($1)\")\n\n_, err = stmt.Exec(\"12324354\")\n\nif err != nil {\n    log.Println(\"Failed to stmt .Exec while trying to insert new association\")\n    log.Println(err.Error())\n    fmt.Println(err.Code())\n\n} else {\n    Render.JSON(w, 200, \"New row was created succesfully\")\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1437563594, "post_id": 31561369, "comment_id": 51078735, "body": "So you basically want to have a type that can only refer to functions that are bound to a type?"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 2, "creation_date": 1437563990, "post_id": 31561369, "comment_id": 51078990, "body": "<code>type BarFunc func(Foo) bool</code> is equivalent. Please tell us what you&#39;re trying to do."}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 13, "last_activity_date": 1611358686, "last_edit_date": 1611358686, "creation_date": 1437564134, "answer_id": 31561683, "question_id": 31561369, "link": "https://stackoverflow.com/questions/31561369/how-do-i-declare-a-function-pointer-to-a-method-in-go/31561683#31561683", "title": "How do I declare a function pointer to a method in Go", "body": "<p>If you want to create a function pointer to a method, you have two ways. The first is essentially turning a method with two arguments into a function with one:</p>\n<pre><code>type Summable int\n\nfunc (s Summable) Add(n int) int {\n    return s+n\n}\n\nvar f func(s Summable, n int) int = (Summable).Add\n\n// ...\nfmt.Println(f(1, 2))\n</code></pre>\n<p>The second way will &quot;bind&quot; the value of <code>s</code> (at the time of evaluation) to the <code>Summable</code> receiver method <code>Add</code>, and then assign it to the variable <code>f</code>:</p>\n<pre><code>s := Summable(1)\nvar f func(n int) int = s.Add\nfmt.Println(f(2))\n</code></pre>\n<p>Playground: <a href=\"http://play.golang.org/p/ctovxsFV2z\" rel=\"nofollow noreferrer\">http://play.golang.org/p/ctovxsFV2z</a>.</p>\n<p>Any changes to <code>s</code> after <code>f</code> is assigned will have no affect on the result: <a href=\"https://play.golang.org/p/UhPdYW5wUOP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/UhPdYW5wUOP</a></p>\n"}, {"tags": [], "owner": {"reputation": 2908, "user_id": 136087, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2e416152346ae8c9229b87d9f004e656?s=128&d=identicon&r=PG&f=1", "display_name": "EdH", "link": "https://stackoverflow.com/users/136087/edh"}, "is_accepted": false, "score": 1, "last_activity_date": 1491512029, "creation_date": 1491512029, "answer_id": 43265563, "question_id": 31561369, "link": "https://stackoverflow.com/questions/31561369/how-do-i-declare-a-function-pointer-to-a-method-in-go/43265563#43265563", "title": "How do I declare a function pointer to a method in Go", "body": "<p>And for an example more familiar to those of us used to a <code>typedef</code> in C for function pointers:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype DyadicMath func (int, int) int  // your function pointer type\n\nfunc doAdd(one int, two int) (ret int) {\n    ret = one + two;\n    return\n}\n\nfunc Work(input []int, addthis int, workfunc DyadicMath) {\n    for _, val := range input {\n        fmt.Println(\"--&gt; \",workfunc(val, addthis))\n    }\n}\n\nfunc main() {\n    stuff := []int{ 1,2,3,4,5 }\n    Work(stuff,10,doAdd)\n\n    doMult := func (one int, two int) (ret int) {\n        ret = one * two;\n        return\n    }   \n    Work(stuff,10,doMult)\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/G5xzJXLexc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/G5xzJXLexc</a></p>\n"}, {"tags": [], "owner": {"reputation": 29, "user_id": 4451657, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GtPgn.jpg?s=128&g=1", "display_name": "Tom N", "link": "https://stackoverflow.com/users/4451657/tom-n"}, "is_accepted": false, "score": 0, "last_activity_date": 1600399555, "creation_date": 1600399555, "answer_id": 63948904, "question_id": 31561369, "link": "https://stackoverflow.com/questions/31561369/how-do-i-declare-a-function-pointer-to-a-method-in-go/63948904#63948904", "title": "How do I declare a function pointer to a method in Go", "body": "<p>I am very likely off-target (just started on Golang) but what if you create a pointer then examine type:</p>\n<pre><code>pfun := Bar \nfmt.Println(&quot;type of pfun is:&quot;, reflect.TypeOf(pfun))\n</code></pre>\n<p>then it seems that you can declare the type of pointer correctly:<br />\n<a href=\"https://play.golang.org/p/SV8W0J9JDuQ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/SV8W0J9JDuQ</a></p>\n"}], "owner": {"reputation": 951, "user_id": 2924972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/473279b4f6391578eeb0fdeeffbff156?s=128&d=identicon&r=PG&f=1", "display_name": "riklund", "link": "https://stackoverflow.com/users/2924972/riklund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8006, "favorite_count": 3, "accepted_answer_id": 31561683, "answer_count": 3, "score": 7, "last_activity_date": 1611358686, "creation_date": 1437563256, "last_edit_date": 1437573153, "question_id": 31561369, "link": "https://stackoverflow.com/questions/31561369/how-do-i-declare-a-function-pointer-to-a-method-in-go", "title": "How do I declare a function pointer to a method in Go", "body": "<p>I am trying to create function pointer to a function that has a method receiver. However, I can't figure out how to get it to work (if it is possible)?</p>\n\n<p>Essentially, I have the following:</p>\n\n<pre><code>type Foo struct {...}\nfunc (T Foo) Bar bool {\n   ... \n}\n\ntype BarFunc (Foo) func() bool // Does not work.\n</code></pre>\n\n<p>The last line of the code gives the error</p>\n\n<pre><code>syntax error: unexpected func, expecting semicolon or newline\n</code></pre>\n"}, {"tags": ["xml", "http", "url", "go"], "comments": [{"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 2, "creation_date": 1437558629, "post_id": 31559036, "comment_id": 51075354, "body": "It&#39;s response with empty xml for me from browser. Maybe you got result from your browser because you are logged-in or you got something in your coockies. Try open &#39;Private tab&#39; from your browser and check your URL there"}, {"owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "reply_to_user": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 0, "creation_date": 1437559270, "post_id": 31559036, "comment_id": 51075813, "body": "it works, I tried from a local server and it works also"}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1437561181, "post_id": 31559036, "comment_id": 51077169, "body": "I get an empty XML from my browser as well, so I guess problem lies outside of Go. You need to figure out what makes your browser and &quot;a local server&quot; so special to receive the expected content."}, {"owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "edited": false, "score": 0, "creation_date": 1437562215, "post_id": 31559036, "comment_id": 51077812, "body": "Hmm, then I think it has a relation with <b>geolocation</b> because im in Spain and the server is in France  and you&#39;re from UK ^^. from Spain it works and from the other location no."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1437571601, "post_id": 31559036, "comment_id": 51084478, "body": "Don&#39;t test with a browser, which can add other factors that change behavior. I get a full response with curl and Go. You&#39;re not checking the response code or the headers, there might be more information there when the response isn&#39;t correct."}, {"owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437578144, "post_id": 31559036, "comment_id": 51089801, "body": "@JimB I didn&#39;t get what do you mean"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437579797, "post_id": 31559036, "comment_id": 51091010, "body": "@Aziz: What didn&#39;t you get? Check the response code, and headers to see if the server is returning any more information."}, {"owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437591585, "post_id": 31559036, "comment_id": 51098372, "body": "@JimB it doesn&#39;t work, I think as I said it&#39;s a <b>geolocation</b> probleme  I will ask the provider to be sure, thank you."}], "answers": [{"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 0, "last_activity_date": 1437557945, "creation_date": 1437557945, "answer_id": 31559391, "question_id": 31559036, "link": "https://stackoverflow.com/questions/31559036/golang-no-response-from-get-http-url/31559391#31559391", "title": "Golang: No response from get.http( url )", "body": "<p>I think you get an empty response because you haven't specified the response headers type. Try to add:</p>\n\n<pre><code>resp, err := http.Get(url)\nresp.Header.Add(\"Accept\", \"application/xml\")\nresp.Header.Add(\"Content-Type\",\"application/xml; charset=utf-8\")\n\nif err != nil {\n     return \"\", err\n}\n</code></pre>\n\n<p>Maybe this will solve your problem.</p>\n"}], "owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 948, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1437559369, "creation_date": 1437556983, "last_edit_date": 1437559369, "question_id": 31559036, "link": "https://stackoverflow.com/questions/31559036/golang-no-response-from-get-http-url", "title": "Golang: No response from get.http( url )", "body": "<pre><code>http://plg1.yumenetworks.com/dynamic_preroll_playlist.vast2xml?domain=2210cZDclAme\n</code></pre>\n\n<p>when I call the link above from the server using <code>http.Get</code> I get this response, an empty XML:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;VAST version=\"2.0\"&gt;\n\n&lt;/VAST&gt;\n</code></pre>\n\n<p>But when I call it from the browser it responsed with a valid XML,also when I called the link from a local server it works.</p>\n\n<pre><code>func getXmlVast(url string) (string, error) {\n\n        resp, err := http.Get(url)\n        if err != nil {\n            return \"\", err\n        }\n        defer resp.Body.Close()\n        // read xml http response\n        xmlData, err := ioutil.ReadAll(resp.Body)\n        if err != nil {\n            return \"\", err\n        }\n        return string(xmlData), nil\n    }\n</code></pre>\n\n<p>Does anyone have an idea.</p>\n\n<p>Thank you in advance </p>\n"}, {"tags": ["windows", "go"], "answers": [{"tags": [], "owner": {"reputation": 1101, "user_id": 757102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60bb12c55b318f541cb55c7eeb6bec8f?s=128&d=identicon&r=PG", "display_name": "Colin Nicholson", "link": "https://stackoverflow.com/users/757102/colin-nicholson"}, "is_accepted": true, "score": 17, "last_activity_date": 1437562531, "creation_date": 1437562531, "answer_id": 31561120, "question_id": 31558066, "link": "https://stackoverflow.com/questions/31558066/how-to-ask-for-administer-privileges-on-windows-with-go/31561120#31561120", "title": "How to ask for administer privileges on Windows with Go", "body": "<p>You need to embed a <a href=\"http://www.samlogic.net/articles/manifest.htm\">manifest file</a> which will tell Windows that you want elevated privileges.</p>\n\n<p>The example from that page is:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?&gt;\n&lt;assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\"&gt;\n&lt;assemblyIdentity\n    version=\"9.0.0.0\"\n    processorArchitecture=\"x86\"\n    name=\"myapp.exe\"\n    type=\"win32\"\n/&gt;\n&lt;description&gt;My App&lt;/description&gt;\n&lt;trustInfo xmlns=\"urn:schemas-microsoft-com:asm.v3\"&gt;\n    &lt;security&gt;\n        &lt;requestedPrivileges&gt;\n            &lt;requestedExecutionLevel level=\"requireAdministrator\" uiAccess=\"false\"/&gt;\n        &lt;/requestedPrivileges&gt;\n    &lt;/security&gt;\n&lt;/trustInfo&gt;\n&lt;/assembly&gt;\n</code></pre>\n\n<p>This <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/shRlhV3Fe2E\">go-nuts post</a> suggests that using <a href=\"https://github.com/akavel/rsrc\">rsrc</a> should do the trick for you.</p>\n"}, {"comments": [{"owner": {"reputation": 1189, "user_id": 2634332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2eaac490041b2f3ccad6dec6eeacdd43?s=128&d=identicon&r=PG", "display_name": "Joppe", "link": "https://stackoverflow.com/users/2634332/joppe"}, "edited": false, "score": 0, "creation_date": 1587421114, "post_id": 59147866, "comment_id": 108501121, "body": "Excellent technique. Might come in handy in the future."}, {"owner": {"reputation": 14131, "user_id": 2224996, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/EDCvE.jpg?s=128&g=1", "display_name": "maja", "link": "https://stackoverflow.com/users/2224996/maja"}, "edited": false, "score": 0, "creation_date": 1606905702, "post_id": 59147866, "comment_id": 115102534, "body": "Don&#39;t you need to close the file if you are an admin?"}], "tags": [], "owner": {"reputation": 890, "user_id": 2934704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KXMul.jpg?s=128&g=1", "display_name": "jerblack", "link": "https://stackoverflow.com/users/2934704/jerblack"}, "is_accepted": false, "score": 12, "last_activity_date": 1575327555, "creation_date": 1575327555, "answer_id": 59147866, "question_id": 31558066, "link": "https://stackoverflow.com/questions/31558066/how-to-ask-for-administer-privileges-on-windows-with-go/59147866#59147866", "title": "How to ask for administer privileges on Windows with Go", "body": "<p>This is the technique that I use to detect if I am running as administrator, and if not relaunch myself with a UAC prompt. This allows me to run as a standard user in most cases, and only elevate when needed. I use this in command line tools where most functions don't need admin rights, but functions like -install or -uninstall do since they're writing to HKLM in the registry or Program Files. No manifest is necessary with this method.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"golang.org/x/sys/windows\"\n    \"os\"\n    \"syscall\"\n    \"time\"\n)\n\nfunc main() {\n    // if not elevated, relaunch by shellexecute with runas verb set\n    if !amAdmin() {\n        runMeElevated()\n    }\n    time.Sleep(10*time.Second)\n\n}\n\nfunc runMeElevated() {\n    verb := \"runas\"\n    exe, _ := os.Executable()\n    cwd, _ := os.Getwd()\n    args := strings.Join(os.Args[1:], \" \")\n\n    verbPtr, _ := syscall.UTF16PtrFromString(verb)\n    exePtr, _ := syscall.UTF16PtrFromString(exe)\n    cwdPtr, _ := syscall.UTF16PtrFromString(cwd)\n    argPtr, _ := syscall.UTF16PtrFromString(args)\n\n    var showCmd int32 = 1 //SW_NORMAL\n\n    err := windows.ShellExecute(0, verbPtr, exePtr, argPtr, cwdPtr, showCmd)\n    if err != nil {\n        fmt.Println(err)\n    }\n}\n\nfunc amAdmin() bool {\n    _, err := os.Open(\"\\\\\\\\.\\\\PHYSICALDRIVE0\")\n    if err != nil {\n        fmt.Println(\"admin no\")\n        return false\n    }\n    fmt.Println(\"admin yes\")\n    return true\n}\n</code></pre>\n\n<p>More details available here:<br>\n<a href=\"https://gist.github.com/jerblack/d0eb182cc5a1c1d92d92a4c4fcc416c6\" rel=\"noreferrer\">https://gist.github.com/jerblack/d0eb182cc5a1c1d92d92a4c4fcc416c6</a></p>\n"}], "owner": {"reputation": 159, "user_id": 2050150, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2443c843dcc1f7f2df89eacf72e23250?s=128&d=identicon&r=PG", "display_name": "pyed", "link": "https://stackoverflow.com/users/2050150/pyed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7797, "favorite_count": 12, "accepted_answer_id": 31561120, "answer_count": 2, "score": 16, "last_activity_date": 1575327555, "creation_date": 1437554335, "last_edit_date": 1477901324, "question_id": 31558066, "link": "https://stackoverflow.com/questions/31558066/how-to-ask-for-administer-privileges-on-windows-with-go", "title": "How to ask for administer privileges on Windows with Go", "body": "<p>What I want to achieve for my application, is to <strong>not</strong> need to right click and choose <em>Run as administrator</em> each time I want to run it. I want Windows to prompt me to gain admin permissions as with other windows applications.</p>\n\n<p>consider the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"time\"\n)\n\nfunc main() {\n    err := ioutil.WriteFile(\"C:/Windows/test.txt\", []byte(\"TESTING!\"), 0644)\n    if err != nil {\n        fmt.Println(err.Error())\n        time.Sleep(time.Second * 3)\n    }\n}\n</code></pre>\n\n<p>If you compile it and double click on it it will print:</p>\n\n<blockquote>\n  <p>open: C:\\Windows\\test.txt: Access is denied.</p>\n</blockquote>\n\n<p>But if you right-click and run as administrator, it will create and write the file.</p>\n\n<p>How to make it ask for the admin permission just by double clicking on it?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "edited": false, "score": 2, "creation_date": 1437557785, "post_id": 31558503, "comment_id": 51074752, "body": "Yes, it may improve the performance, but sometimes the variant type may include other types, e.g. string or byte array."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "edited": false, "score": 0, "creation_date": 1437562167, "post_id": 31558503, "comment_id": 51077775, "body": "See edit. I&#39;ve removed uses of <code>unsafe</code> since it&#39;s not really needed and added a note about other types."}, {"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "edited": false, "score": 3, "creation_date": 1437568542, "post_id": 31558503, "comment_id": 51082190, "body": "Thanks. I try the binary functions, they seems very expensive. Since the union is not intend to be wire format, so binary representation is not necessary for numeric types. I think unsafe make more sense in my case."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 8, "last_activity_date": 1437561991, "last_edit_date": 1437561991, "creation_date": 1437555536, "answer_id": 31558503, "question_id": 31557539, "link": "https://stackoverflow.com/questions/31557539/golang-how-to-simulate-union-type-efficiently/31558503#31558503", "title": "golang: how to simulate union type efficiently", "body": "<p>You can use arrays to represent a single <code>int32</code> as two <code>int16</code>s and then assemble them with shifts <a href=\"http://commandcenter.blogspot.ru/2012/04/byte-order-fallacy.html\" rel=\"noreferrer\">as Rob Pike recommends</a>:</p>\n\n<pre><code>func test3() (total int64) {\n    type A struct {\n        t int32\n        u [2]int16\n    }\n    a := [...]A{\n        {1, [2]int16{100, 0}},\n        {2, [2]int16{3, 0}},\n    }\n\n    for i := 0; i &lt; N; i++ {\n        p := &amp;a[i%2]\n        switch p.t {\n        case 1:\n            total += int64(p.u[0]&lt;&lt;0 | p.u[1]&lt;&lt;8)\n        case 2:\n            total += int64(p.u[0])\n        }\n    }\n    return\n}\n</code></pre>\n\n<p>With the original Go compiler it runs about 2 times slower than the C version, and with gccgo (-O3) it runs about as fast as C.</p>\n\n<p>Be warned though that this approach assumes little-endian ints. You'll need to switch the order of shifts for big-endian architecture.</p>\n\n<p>Also, if you need to decode structures from a byte slice, you should really be using <a href=\"http://golang.org/pkg/encoding/binary/\" rel=\"noreferrer\"><code>encoding/binary</code></a>. This library is created to translate between byte sequences and other types.</p>\n"}, {"comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1437569178, "post_id": 31563530, "comment_id": 51082657, "body": "Using arrays (or pointers to arrays) instead of slices could theoretically improve performance."}, {"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1437570103, "post_id": 31563530, "comment_id": 51083403, "body": "I try byte array, but the performance is almost the same. Anyway, in my case, the octet string is in variable length, so byte slice should be the only choice."}], "tags": [], "owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "is_accepted": false, "score": 3, "last_activity_date": 1437570614, "last_edit_date": 1437570614, "creation_date": 1437569019, "answer_id": 31563530, "question_id": 31557539, "link": "https://stackoverflow.com/questions/31557539/golang-how-to-simulate-union-type-efficiently/31563530#31563530", "title": "golang: how to simulate union type efficiently", "body": "<p>The union may contains numeric types and octet string, so I try to use byte slice as the value container and use <code>unsafe.Pointer</code> to access it according to the concrete type.</p>\n\n<pre><code>func test3() (total int64) {\n    type A struct {\n        t int32\n        u []byte\n    }   \n\n    a := [...]A{{1, make([]byte, 8)}, {2, make([]byte, 8)}}\n    *(*int32)(unsafe.Pointer(&amp;a[0].u)) = 100 \n    *(*int16)(unsafe.Pointer(&amp;a[1].u)) = 3 \n\n    for i := 0; i &lt; 5000000000; i++ {\n        p := &amp;a[i%2]\n        switch p.t {\n        case 1:\n            total += int64(*(*int32)(unsafe.Pointer(&amp;p.u)))\n        case 2:\n            total += int64(*(*int16)(unsafe.Pointer(&amp;p.u)))\n        }   \n    }   \n    return\n}\n</code></pre>\n\n<p>result:</p>\n\n<pre><code>$ go run union.go\n257500000000\n12.844752701s\n\n$ go run -compiler gccgo -gccgoflags -O3 union.go\n257500000000\n6.640667s\n</code></pre>\n\n<p>Is it the best version?</p>\n"}, {"tags": [], "owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "is_accepted": false, "score": 4, "last_activity_date": 1567865750, "last_edit_date": 1567865750, "creation_date": 1567865065, "answer_id": 57834413, "question_id": 31557539, "link": "https://stackoverflow.com/questions/31557539/golang-how-to-simulate-union-type-efficiently/57834413#57834413", "title": "golang: how to simulate union type efficiently", "body": "<p>I bet myself to make it much closer to C variant, and here's what I got:</p>\n\n<p><code>(full code)</code></p>\n\n<p><a href=\"https://play.golang.org/p/3FJTI6xSsd8\" rel=\"noreferrer\">https://play.golang.org/p/3FJTI6xSsd8</a> </p>\n\n<p>thing is that we going through all struct's fields and redirect them to buffer's storage (which has compile-time len refereed from template struct, for sake of memory salvation and universality) </p>\n\n<p><code>result:</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func test() (total int64) {\n\n    type A struct {\n        t int32\n        u struct {\n            // embedded buffer of union\n            FooSize\n\n            // mark all types inside as pointer types\n            i *int32 // long\n            v *int16 //short\n        }\n    }\n    var a [2]A\n\n    // initialize them\n    Union(&amp;a[0].u)\n    Union(&amp;a[1].u)\n\n    a[0].t = 1\n    *a[0].u.i = 100\n    a[1].t = 2\n    *a[1].u.v = 3\n\n    for c := 0; c &lt; 5000000000; c++ {\n        p := &amp;a[c%2]\n        switch p.t {\n        case 1:\n            total += int64(*p.u.i)\n        case 2:\n            total += int64(*p.u.v)\n        }\n    }\n\n    return\n}\n</code></pre>\n\n<p>// your bench:</p>\n\n<pre><code>257500000000\n8.111239763s\n</code></pre>\n\n<p>// native bench (8,18800064s):</p>\n\n<pre><code>BenchmarkUnion         1        8188000640 ns/op              80 B/op          1 allocs/op\n</code></pre>\n\n<p>Ran it on $5 digitalocean droplet.</p>\n\n<hr>\n\n<p>Implementation is cursed and may be not compatible with future versions of Go (current is 1.13), but usage (as behavior) is C-like, also supports any type (you can replace integers with structs as well)</p>\n"}, {"tags": [], "owner": {"reputation": 4294, "user_id": 3850702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52c0806211f48ca91fe8249db6370c98?s=128&d=identicon&r=PG&f=1", "display_name": "Zach", "link": "https://stackoverflow.com/users/3850702/zach"}, "is_accepted": false, "score": 0, "last_activity_date": 1609709595, "creation_date": 1609709595, "answer_id": 65555141, "question_id": 31557539, "link": "https://stackoverflow.com/questions/31557539/golang-how-to-simulate-union-type-efficiently/65555141#65555141", "title": "golang: how to simulate union type efficiently", "body": "<p>I wrote a small tool to generate C-style unions called <code>unionize</code> which you can find at <a href=\"https://github.com/zyedidia/unionize\" rel=\"nofollow noreferrer\">https://github.com/zyedidia/unionize</a>. You give it a template and then it will generate Go code that acts like a union and has comparable performance to C (warning: it uses the unsafe package, see the github repository for how it works and a detailed discussion of alternatives).</p>\n<p>I copied your C benchmark into Go using unionize. First create a template for the union, for example in <code>union.go</code>:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\ntype Int struct {\n    i int32\n    v int16\n}\n</code></pre>\n<p>Now use <code>unionize</code> to generate the actual union code which will go into <code>a_union.go</code>:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>$ unionize -output=a_union.go Int union.go\n</code></pre>\n<p>This creates a new type <code>IntUnion</code> from the <code>Int</code> template which exposes functions to manipulate the union members. Now we can write the benchmark using that type:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport &quot;fmt&quot;\n\ntype A struct {\n    t int\n    u IntUnion\n}\n\nfunc main() {\n    var a [2]A\n    a[0].t = 1\n    a[0].u.iPut(100)\n    a[1].t = 2\n    a[1].u.vPut(3)\n\n    var total int\n    for i := 0; i &lt; 5000000000; i++ {\n        p := &amp;a[i%2]\n        switch p.t {\n        case 1:\n            total += int(p.u.i())\n        case 2:\n            total += int(p.u.v())\n        }\n    }\n\n    fmt.Println(total)\n}\n</code></pre>\n<p>When I time it I get:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>$ go build main.go a_union.go\n$ time ./main\n257500000000\n\nreal    0m6.202s\nuser    0m6.197s\nsys 0m0.012s\n</code></pre>\n<p>Not bad! (on my machine the C benchmark runs in roughly 3 seconds). The tool is fairly small, so let me know if there are more features you are looking for, or if you find any bugs.</p>\n"}], "owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29903, "favorite_count": 5, "answer_count": 4, "score": 23, "last_activity_date": 1609709595, "creation_date": 1437552922, "question_id": 31557539, "link": "https://stackoverflow.com/questions/31557539/golang-how-to-simulate-union-type-efficiently", "title": "golang: how to simulate union type efficiently", "body": "<p>As known, go has no union type, and should only be simulated via interface.</p>\n\n<p>I try two methods to simulate the union, but the result is far from good as C.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype U interface {\n    i32() int32\n    i16() int16\n}\n\ntype i32 int32\n\nfunc (u i32) i32() int32 {\n    return int32(u)\n}\n\nfunc (u i32) i16() int16 {\n    return int16(u)\n}\n\ntype i16 int16\n\nfunc (u i16) i32() int32 {\n    return int32(u)\n}\n\nfunc (u i16) i16() int16 {\n    return int16(u)\n}\n\nfunc test() (total int64) {\n    type A struct {\n        t int32\n        u interface{}\n    }\n    a := [...]A{{1, int32(100)}, {2, int16(3)}}\n\n    for i := 0; i &lt; 5000000000; i++ {\n        p := &amp;a[i%2]\n        switch p.t {\n        case 1:\n            total += int64(p.u.(int32))\n        case 2:\n            total += int64(p.u.(int16))\n        }\n    }\n    return\n}\n\nfunc test2() (total int64) {\n    type A struct {\n        t int32\n        u U\n    }\n    a := [...]A{{1, i32(100)}, {2, i16(3)}}\n\n    for i := 0; i &lt; 5000000000; i++ {\n        p := &amp;a[i%2]\n        switch p.t {\n        case 1:\n            total += int64(p.u.i32())\n        case 2:\n            total += int64(p.u.i16())\n        }\n    }\n    return\n}\n\ntype testfn func() int64\n\nfunc run(f testfn) {\n    ts := time.Now()\n    total := f()\n    te := time.Now()\n    fmt.Println(total)\n    fmt.Println(te.Sub(ts))\n}\n\nfunc main() {\n    run(test)\n    run(test2)\n}\n</code></pre>\n\n<p>result:</p>\n\n<pre><code>257500000000\n1m23.508223094s\n257500000000\n34.95081661s\n</code></pre>\n\n<p>The method way is better, and the type-cast way cost more CPU time.</p>\n\n<p>The C version:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nstruct A {\n    int t;\n    union {\n        int i;\n        short v;\n    } u;\n};\n\nlong test()\n{\n    struct A a[2];\n    a[0].t = 1;\n    a[0].u.i = 100;\n    a[1].t = 2;\n    a[1].u.v = 3;\n\n    long total = 0;\n    long i;\n    for (i = 0; i &lt; 5000000000; i++) {\n        struct A* p = &amp;a[i % 2];\n        switch(p-&gt;t) {\n        case 1:\n            total += p-&gt;u.i;\n            break;\n        case 2:\n            total += p-&gt;u.v;\n            break;\n        }\n    }\n    return total;\n}\nint main()\n{\n    long total = test();\n    printf(\"%ld\\n\", total);\n}\n</code></pre>\n\n<p>result:</p>\n\n<pre><code>257500000000\n\nreal    0m5.620s\nuser    0m5.620s\nsys 0m0.000s\n</code></pre>\n\n<p>The union type is useful for many applications, e.g. network protocol may contains variant concrete type.\nSo maybe the access of union data may become the bottleneck of the application.</p>\n\n<p>Anybody could help? Thanks.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 1, "creation_date": 1437551281, "post_id": 31555908, "comment_id": 51070595, "body": "Note: that was introduced in <a href=\"https://github.com/golang/go/commit/876e9d1b89cf87f3791153fa9472142cd5294223#diff-21335be6bb7e87c8e655a237f635b095R679\" rel=\"nofollow noreferrer\">commit 876e9d1b</a> in February 2011 by <a href=\"https://github.com/bradfitz\" rel=\"nofollow noreferrer\">Brad Fitzpatrick</a>."}], "tags": [], "owner": {"reputation": 1701, "user_id": 788887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f68a54ea809de360f7049f5c970df1d7?s=128&d=identicon&r=PG", "display_name": "ReyCharles", "link": "https://stackoverflow.com/users/788887/reycharles"}, "is_accepted": true, "score": 8, "last_activity_date": 1437548037, "creation_date": 1437548037, "answer_id": 31555908, "question_id": 31555845, "link": "https://stackoverflow.com/questions/31555845/what-does-port-http-mean-in-http-server/31555908#31555908", "title": "What does port &quot;:http&quot; mean in http.Server?", "body": "<p>Sometimes ports have aliases. <code>http</code> is 80.You can see more names here: <a href=\"http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml\">http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml</a></p>\n"}], "owner": {"reputation": 5024, "user_id": 1419891, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bb825cd3f1905f42c16408393480a65b?s=128&d=identicon&r=PG", "display_name": "425nesp", "link": "https://stackoverflow.com/users/1419891/425nesp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 31555908, "answer_count": 1, "score": 6, "last_activity_date": 1437548037, "creation_date": 1437547870, "question_id": 31555845, "link": "https://stackoverflow.com/questions/31555845/what-does-port-http-mean-in-http-server", "title": "What does port &quot;:http&quot; mean in http.Server?", "body": "<p>I was reading the type declaration for <code>http.Server</code> in the documentation and I came across this.</p>\n\n<pre><code>type Server struct {\n    Addr string // TCP address to listen on, \":http\" if empty\n    // more...\n}\n</code></pre>\n\n<p>If you call <code>srv.ListenAndServe()</code> and <code>srv.Addr</code> is an empty string, then <code>ListenAndServe</code> will pass <code>\":http\"</code> to <code>net.Listen</code> (<a href=\"http://golang.org/src/net/http/server.go?s=51082:51123#L1699\" rel=\"noreferrer\">http/server.go</a>).</p>\n\n<p>What does <code>\":http\"</code> mean?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1437552382, "post_id": 31555672, "comment_id": 51071259, "body": "Can you build the go app with array bounds checks disabled using <code>-gcflag -B</code> option and re-run your benchmark?"}, {"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1437553727, "post_id": 31555672, "comment_id": 51072049, "body": "@kostya, I try the flag, but it does not help."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1437556529, "post_id": 31555672, "comment_id": 51073872, "body": "@kingluo Running your code with <code>gccgo</code> and -O3 yields similar results to C: <code>time go run -compiler gccgo -gccgoflags -O3 foo.go</code> Output: <code>real\t0m3.667s user\t0m3.644s</code>. So it&#39;s probably some optimization gcc is doing."}, {"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1437560388, "post_id": 31555672, "comment_id": 51076632, "body": "@Not_a_Golfer, yes, the gccgo is better in this case. Does gccgo support go 1.3 or higher?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1437563326, "post_id": 31555672, "comment_id": 51078556, "body": "@kingluo gccgo 4.9 is the latest release and it&#39;s compliant with go 1.2, the next release should be compliant with 1.4. But IIRC there weren&#39;t many changes in the language spec since then. I&#39;m not sure if you can use 1.4 std packages with gccgo though."}], "answers": [{"comments": [{"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "edited": false, "score": 0, "creation_date": 1437556245, "post_id": 31558468, "comment_id": 51073700, "body": "As suggested by @kostya, I try -gcflag -B, but it&#39;s just 1 second quicker than original one, and is still far from C. So there is other reasons?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "edited": false, "score": 0, "creation_date": 1437556626, "post_id": 31558468, "comment_id": 51073957, "body": "@kingluo Your creating a local stack variable to a pointer to the array is redundant. You&#39;ll get a couple of seconds speedup by making the whole array an array of pointers."}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1437558950, "post_id": 31558468, "comment_id": 51075600, "body": "@Not_a_Golfer: are you sure about that? It looks like the only memory load after the bounds check (at <code>400c96</code>) is loading the value of <code>p.u</code>.  If you had an array of pointers to structs, it&#39;d need to do two loads."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1437559076, "post_id": 31558468, "comment_id": 51075679, "body": "@JamesHenstridge I haven&#39;t looked at the generated asm, but it just works a bit faster (shaved ~1.5 seconds off on my machine). maybe it triggers some other optimization."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1437559288, "post_id": 31558468, "comment_id": 51075834, "body": "@JamesHenstridge another thing that shaved 2 seconds off was doing <code>i &amp; 1</code> instead of <code>i % 2</code>. So after these 2 optimizations I&#39;m getting 6.3 seconds. But as I wrote in a comment to the question, running via gccgo makes it run just as fast as C."}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1437616436, "post_id": 31558468, "comment_id": 51108241, "body": "It looks like the compiler doesn&#39;t do the <code>i % 2</code> =&gt; <code>i &amp; 1</code> transformation because they are only equivalent for non-negative integers.  If we make i a <code>uint</code>, then the compiler does the transformation automatically.  But still, it isn&#39;t clear what value there is in optimising this micro-benchmark to death."}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": false, "score": 3, "last_activity_date": 1437555417, "creation_date": 1437555417, "answer_id": 31558468, "question_id": 31555672, "link": "https://stackoverflow.com/questions/31555672/golang-index-efficiency-of-array/31558468#31558468", "title": "golang: index efficiency of array", "body": "<p>The main difference is the the array bounds checking.  In the disassembly dump for the Go program, there is:</p>\n\n<pre><code>400c89:       48 83 fb 02             cmp    $0x2,%rbx\n400c8d:       73 2d                   jae    400cbc &lt;main.test+0xbc&gt;\n...\n400cbc:       e8 6f e0 00 00          callq  40ed30 &lt;runtime.panicindex&gt;\n400cc1:       0f 0b                   ud2    \n</code></pre>\n\n<p>So if <code>%rbx</code> is greater than or equal to 2, then it jumps down to a call to <code>runtime.panicindex</code>.  Given you're working with an array of size 2, that is clearly the bounds check.  You could make the argument that the compiler should be smart enough to skip the bounds check in this particular case where the range of the index can be determined statically, but it seems that it isn't smart enough to do so yet.</p>\n\n<p>While you're seeing a noticeable performance difference for this micro-benchmark, it might be worth considering whether this is actually representative of your actual code.  If you're doing other stuff in your loop, the difference is likely to be less noticeable.</p>\n\n<p>And while bounds checking does have a cost, in many cases it is better than the alternative of the program continuing with undefined behaviour.</p>\n"}], "owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 801, "favorite_count": 3, "answer_count": 1, "score": 3, "last_activity_date": 1437555417, "creation_date": 1437547256, "last_edit_date": 1437547974, "question_id": 31555672, "link": "https://stackoverflow.com/questions/31555672/golang-index-efficiency-of-array", "title": "golang: index efficiency of array", "body": "<p>It's a simple program.\ntest environment: debian 8, go 1.4.2</p>\n\n<p>union.go:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype A struct {\n    t int32\n    u int64\n}\n\nfunc test() (total int64) {\n    a := [...]A{{1, 100}, {2, 3}}\n\n    for i := 0; i &lt; 5000000000; i++ {\n        p := &amp;a[i%2]\n        total += p.u\n    }\n    return\n}\nfunc main() {\n    total := test()\n    fmt.Println(total)\n}\n</code></pre>\n\n<p>union.c:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nstruct A {\n    int t;\n    long u;\n};\n\nlong test()\n{\n    struct A a[2];\n    a[0].t = 1;\n    a[0].u = 100;\n    a[1].t = 2;\n    a[1].u = 3;\n\n    long total = 0;\n    long i;\n    for (i = 0; i &lt; 5000000000; i++) {\n        struct A* p = &amp;a[i % 2];\n        total += p-&gt;u;\n    }\n    return total;\n}\nint main()\n{\n    long total = test();\n    printf(\"%ld\\n\", total);\n}\n</code></pre>\n\n<p>result compare:</p>\n\n<p>go:</p>\n\n<pre><code>257500000000\n\nreal    0m9.167s\nuser    0m9.196s\nsys 0m0.012s\n</code></pre>\n\n<p>C:</p>\n\n<pre><code>257500000000\n\nreal    0m3.585s\nuser    0m3.560s\nsys 0m0.008s\n</code></pre>\n\n<p>It seems that the go compiles lot of weird assembly codes (you could use objdump -D to check it).</p>\n\n<p>For example, why <code>movabs $0x12a05f200,%rbp</code> appears twice?</p>\n\n<pre><code>  400c60:       31 c0                   xor    %eax,%eax\n  400c62:       48 bd 00 f2 05 2a 01    movabs $0x12a05f200,%rbp\n  400c69:       00 00 00 \n  400c6c:       48 39 e8                cmp    %rbp,%rax\n  400c6f:       7d 46                   jge    400cb7 &lt;main.test+0xb7&gt;\n  400c71:       48 89 c1                mov    %rax,%rcx\n  400c74:       48 c1 f9 3f             sar    $0x3f,%rcx\n  400c78:       48 89 c3                mov    %rax,%rbx\n  400c7b:       48 29 cb                sub    %rcx,%rbx\n  400c7e:       48 83 e3 01             and    $0x1,%rbx\n  400c82:       48 01 cb                add    %rcx,%rbx\n  400c85:       48 8d 2c 24             lea    (%rsp),%rbp\n  400c89:       48 83 fb 02             cmp    $0x2,%rbx\n  400c8d:       73 2d                   jae    400cbc &lt;main.test+0xbc&gt;\n  400c8f:       48 6b db 10             imul   $0x10,%rbx,%rbx\n  400c93:       48 01 dd                add    %rbx,%rbp\n  400c96:       48 8b 5d 08             mov    0x8(%rbp),%rbx\n  400c9a:       48 01 f3                add    %rsi,%rbx\n  400c9d:       48 89 de                mov    %rbx,%rsi\n  400ca0:       48 89 5c 24 28          mov    %rbx,0x28(%rsp)\n  400ca5:       48 ff c0                inc    %rax\n  400ca8:       48 bd 00 f2 05 2a 01    movabs $0x12a05f200,%rbp\n  400caf:       00 00 00 \n  400cb2:       48 39 e8                cmp    %rbp,%rax\n  400cb5:       7c ba                   jl     400c71 &lt;main.test+0x71&gt;\n  400cb7:       48 83 c4 20             add    $0x20,%rsp\n  400cbb:       c3                      retq   \n  400cbc:       e8 6f e0 00 00          callq  40ed30 &lt;runtime.panicindex&gt;\n  400cc1:       0f 0b                   ud2    \n        ...\n</code></pre>\n\n<p>while the C assembly is more clean:</p>\n\n<pre><code>0000000000400570 &lt;test&gt;:\n  400570:       48 c7 44 24 e0 64 00    movq   $0x64,-0x20(%rsp)\n  400577:       00 00 \n  400579:       48 c7 44 24 f0 03 00    movq   $0x3,-0x10(%rsp)\n  400580:       00 00 \n  400582:       b9 64 00 00 00          mov    $0x64,%ecx\n  400587:       31 d2                   xor    %edx,%edx\n  400589:       31 c0                   xor    %eax,%eax\n  40058b:       48 be 00 f2 05 2a 01    movabs $0x12a05f200,%rsi\n  400592:       00 00 00 \n  400595:       eb 18                   jmp    4005af &lt;test+0x3f&gt;\n  400597:       66 0f 1f 84 00 00 00    nopw   0x0(%rax,%rax,1)\n  40059e:       00 00 \n  4005a0:       48 89 d1                mov    %rdx,%rcx\n  4005a3:       83 e1 01                and    $0x1,%ecx\n  4005a6:       48 c1 e1 04             shl    $0x4,%rcx\n  4005aa:       48 8b 4c 0c e0          mov    -0x20(%rsp,%rcx,1),%rcx\n  4005af:       48 83 c2 01             add    $0x1,%rdx\n  4005b3:       48 01 c8                add    %rcx,%rax\n  4005b6:       48 39 f2                cmp    %rsi,%rdx\n  4005b9:       75 e5                   jne    4005a0 &lt;test+0x30&gt;\n  4005bb:       f3 c3                   repz retq \n  4005bd:       0f 1f 00                nopl   (%rax)\n</code></pre>\n\n<p>Could somebody explain it? Thanks!</p>\n"}, {"tags": ["ssh", "go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437544322, "post_id": 31554196, "comment_id": 51067080, "body": "Yeah, I think doing <code>NewClient()</code> with a <code>Conn</code> you <code>SetDeadline()</code> on is The Way(tm). Commenting not answering &#39;cause I don&#39;t have special familiarity with the <code>ssh</code> package. The output of <code>grep -R Deadline src&#47;golang.org&#47;x&#47;crypto&#47;ssh</code> makes me think the package won&#39;t get in your way but won&#39;t do it for you; the only mentions appear related to ssh port forwarding."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437546251, "post_id": 31554196, "comment_id": 51067972, "body": "Yea the <code>SetDeadline()</code> works, but I gotta say something like a timeout missing from a library meant for making connections seems like a major oversight.. Not to sound ungrateful or anything and maybe if I have the time I will see if I can help include it"}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437548342, "post_id": 31554196, "comment_id": 51068957, "body": "The thing that is a little stranger to me is that when I am setting up a connection to one of my servers that I know has died/is having issues (I can&#39;t ssh into it from the terminal) I don&#39;t get an error from <code>ssh.NewClientConn</code> at all nor does it return a nil Client. That is the main cause of my problem anyways, it is trying to call <code>NewSession</code> with a dead server that is passing as alive."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437575226, "post_id": 31554196, "comment_id": 51087476, "body": "If <code>ssh.NewClientConn</code> returns ok, then the server isn&#39;t really dead since it can complete the ssh handshake."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437579357, "post_id": 31554196, "comment_id": 51090696, "body": "@user3591723 -- I think the philosophy is if you can use another standard package for a piece of functionality, the stdlib authors often won&#39;t provide another way to do it, even if more convenient. For instance, people often use Go&#39;s <code>net&#47;http</code> to write services returning JSON, and you can imagine convenience methods to make it easier to build those, but <code>net&#47;http</code> (on its own) doesn&#39;t provide them; <code>net&#47;http</code> has to be hooked up to <code>encoding&#47;json</code> with other code."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437625829, "post_id": 31554196, "comment_id": 51110492, "body": "@JimB I haven&#39;t looked much at the package source but I can safely say that something making it passed the <code>ssh.NewClientConn</code> can&#39;t necessarily succeed in starting a new session, which seems like strange behavior to me. When I get this <code>ssh: unexpected packet in response to channel open: &lt;nil&gt;</code> from trying <code>StartSession</code> if I go back to look at the error/output of <code>ssh.NewClientConn</code> I had definitely gotten a <code>nil</code> error there. If that is as expected I don&#39;t think it makes much sense."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437626435, "post_id": 31554196, "comment_id": 51110676, "body": "@twotwotwo This feels a little different though. You can do all of that stuff in <code>net&#47;http</code> with json without having to essentially go into the source and rewrite the same function they wrote but with a few lines added. There doesn&#39;t seem to be a way to solve this issue here without rewriting <code>Dial</code>, and while that isn&#39;t a difficult thing to do it is a little strange to me."}], "answers": [{"comments": [{"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1437626030, "post_id": 31566330, "comment_id": 51110560, "body": "That definitely makes it more obvious what you&#39;re doing than what I came up with. Will probably implement something like this."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 18, "last_activity_date": 1544060238, "last_edit_date": 1544060238, "creation_date": 1437575888, "answer_id": 31566330, "question_id": 31554196, "link": "https://stackoverflow.com/questions/31554196/ssh-connection-timeout/31566330#31566330", "title": "SSH Connection Timeout", "body": "<p>One way to handle this transparently with the ssh package, is to create a connection with an idle timeout via a custom <code>net.Conn</code> which sets deadlines for you. However, this will cause the background Reads on a connection to timeout, so we need to use ssh keepalives to keep the connection open. Depending on your use case, simply using ssh keepalives as an alert for a dead connection may suffice.</p>\n\n<pre><code>// Conn wraps a net.Conn, and sets a deadline for every read\n// and write operation.\ntype Conn struct {\n    net.Conn\n    ReadTimeout  time.Duration\n    WriteTimeout time.Duration\n}\n\nfunc (c *Conn) Read(b []byte) (int, error) {\n    err := c.Conn.SetReadDeadline(time.Now().Add(c.ReadTimeout))\n    if err != nil {\n        return 0, err\n    }\n    return c.Conn.Read(b)\n}\n\nfunc (c *Conn) Write(b []byte) (int, error) {\n    err := c.Conn.SetWriteDeadline(time.Now().Add(c.WriteTimeout))\n    if err != nil {\n        return 0, err\n    }\n    return c.Conn.Write(b)\n}\n</code></pre>\n\n<p>You can then use <code>net.DialTimeout</code> or a <code>net.Dialer</code> to get the connection, wrap it in your <code>Conn</code> with timeouts, and pass it into <code>ssh.NewClientConn</code>.</p>\n\n<pre><code>func SSHDialTimeout(network, addr string, config *ssh.ClientConfig, timeout time.Duration) (*ssh.Client, error) {\n    conn, err := net.DialTimeout(network, addr, timeout)\n    if err != nil {\n        return nil, err\n    }\n\n    timeoutConn := &amp;Conn{conn, timeout, timeout}\n    c, chans, reqs, err := ssh.NewClientConn(timeoutConn, addr, config)\n    if err != nil {\n        return nil, err\n    }\n    client := ssh.NewClient(c, chans, reqs)\n\n    // this sends keepalive packets every 2 seconds\n    // there's no useful response from these, so we can just abort if there's an error\n    go func() {\n        t := time.NewTicker(2 * time.Second)\n        defer t.Stop()\n        for range t.C {\n            _, _, err := client.Conn.SendRequest(\"keepalive@golang.org\", true, nil)\n            if err != nil {\n                return\n            }\n        }\n    }()\n    return client, nil\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 438, "user_id": 1699865, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7dfd127ca79430fed151aa1665ac7c84?s=128&d=identicon&r=PG", "display_name": "Elwyn", "link": "https://stackoverflow.com/users/1699865/elwyn"}, "edited": false, "score": 0, "creation_date": 1542115197, "post_id": 45767642, "comment_id": 93445381, "body": "I prefer this answer much more"}], "tags": [], "owner": {"reputation": 1686, "user_id": 1149097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-CgNHgOPLb4w/AAAAAAAAAAI/AAAAAAAACNM/K54VtcEdyik/photo.jpg?sz=128", "display_name": "ryboe", "link": "https://stackoverflow.com/users/1149097/ryboe"}, "is_accepted": false, "score": 7, "last_activity_date": 1503116881, "creation_date": 1503116881, "answer_id": 45767642, "question_id": 31554196, "link": "https://stackoverflow.com/questions/31554196/ssh-connection-timeout/45767642#45767642", "title": "SSH Connection Timeout", "body": "<p>Set the timeout on the <a href=\"http://godoc.org/golang.org/x/crypto/ssh#ClientConfig.Timeout\" rel=\"noreferrer\"><code>ssh.ClientConfig</code></a>.</p>\n\n<pre><code>cfg := ssh.ClientConfig{\n    User: \"root\",\n    Auth: []ssh.AuthMethod{\n        ssh.PublicKeys(signer),\n    },\n    HostKeyCallback: ssh.FixedHostKey(hostKey),\n    Timeout:         15 * time.Second, // max time to establish connection\n}\n\nssh.Dial(\"tcp\", ip+\":22\", &amp;cfg)\n</code></pre>\n\n<p>When you call <a href=\"http://godoc.org/golang.org/x/crypto/ssh#Dial\" rel=\"noreferrer\"><code>ssh.Dial</code></a>, the timeout will be passed to <a href=\"https://github.com/golang/crypto/blob/master/ssh/client.go#L172\" rel=\"noreferrer\"><code>net.DialTimeout</code></a>.</p>\n"}], "owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6652, "favorite_count": 8, "accepted_answer_id": 31566330, "answer_count": 2, "score": 14, "last_activity_date": 1544060238, "creation_date": 1437541244, "question_id": 31554196, "link": "https://stackoverflow.com/questions/31554196/ssh-connection-timeout", "title": "SSH Connection Timeout", "body": "<p>I am trying to make SSH connections using <code>golang.org/x/crypto/ssh</code> and I am kinda surprised that I can't seem to find out how to timeout the <code>NewSession</code> function (I actually don't seen any way to timeout anything). When I try to connect to a server that is having issues, this just hangs for a very long time. I have written something to use <code>select</code> with a <code>time.After</code> but it just feels like a hack. Something I haven't tried yet is to keep the underlying <code>net.Conn</code> in my struct and just keep doing <code>Conn.SetDeadline()</code> calls. Haven't tried this yet because I don't know if the crypto/ssh library overrides this or anything like that.</p>\n\n<p>Anyone have a good way to timeout dead servers with this library? Or does anyone know of a better library?</p>\n"}, {"tags": ["memory", "memory-management", "go", "dynamic-memory-allocation"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 2, "creation_date": 1437533952, "post_id": 31553048, "comment_id": 51064098, "body": "You can depend on Go to do the dirty work. It calls out to the system to get more than just what you&#39;re allocating for small <code>make</code>/<code>new</code> calls. <a href=\"https://github.com/golang/go/blob/master/src/runtime/mem_linux.go\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/runtime/mem_linux.go</a> might be a starting point if you want details. But generally, I think you want to build out your product, then let the profile tell you what&#39;s slow."}, {"owner": {"reputation": 13457, "user_id": 954376, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/08PZK.jpg?s=128&g=1", "display_name": "NeoWang", "link": "https://stackoverflow.com/users/954376/neowang"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437535304, "post_id": 31553048, "comment_id": 51064432, "body": "Quick question: does Go assign slots of different sizes in reserved memory, to avoid fragmentation? Maybe I need to read the source ..."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 4, "creation_date": 1437536748, "post_id": 31553048, "comment_id": 51064764, "body": "<a href=\"https://github.com/golang/go/blob/master/src/runtime/malloc.go\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/runtime/malloc.go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13457, "user_id": 954376, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/08PZK.jpg?s=128&g=1", "display_name": "NeoWang", "link": "https://stackoverflow.com/users/954376/neowang"}, "edited": false, "score": 0, "creation_date": 1437576573, "post_id": 31561221, "comment_id": 51088557, "body": "FYI I am trying to implement a cache server, so memory management is not premature optimization."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 13457, "user_id": 954376, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/08PZK.jpg?s=128&g=1", "display_name": "NeoWang", "link": "https://stackoverflow.com/users/954376/neowang"}, "edited": false, "score": 1, "creation_date": 1437578863, "post_id": 31561221, "comment_id": 51090350, "body": "@NeoWang, then you might be interested in <a href=\"http://www.reddit.com/r/golang/comments/2ap67l/when_to_use_syncpool_and_when_not_to/\" rel=\"nofollow noreferrer\"><code>sync.Pool</code></a> or <a href=\"http://blog.golang.org/qihoo\" rel=\"nofollow noreferrer\">external memory pools</a> or <a href=\"https://blog.cloudflare.com/recycling-memory-buffers-in-go/\" rel=\"nofollow noreferrer\">internal memory pools</a>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 13457, "user_id": 954376, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/08PZK.jpg?s=128&g=1", "display_name": "NeoWang", "link": "https://stackoverflow.com/users/954376/neowang"}, "edited": false, "score": 1, "creation_date": 1437578934, "post_id": 31561221, "comment_id": 51090399, "body": "@NeoWang, in general, I highly advise you to ask a question on the mailing list, explicitly mentioning your task and soliciting comments. SO is a wrong medium for such kind of research, really."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1437579816, "post_id": 31561221, "comment_id": 51091027, "body": "<a href=\"https://github.com/golang/groupcache\" rel=\"nofollow noreferrer\">github.com/golang/groupcache</a> is a library from the author of memcache, with different design goals."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 2, "last_activity_date": 1437562823, "creation_date": 1437562823, "answer_id": 31561221, "question_id": 31553048, "link": "https://stackoverflow.com/questions/31553048/how-does-go-allocate-memory-in-make-or-new-calls/31561221#31561221", "title": "How does Go allocate memory in make or new calls?", "body": "<p>You might suffer from the \"premature optimization\" syndrome here. The language spec says <em>nothing</em> about how exactly the memory allocated by <code>make()</code> will be allocated.</p>\n\n<p>For instance, a conforming implementation of Go might perform thorough analyzis of the function which does <code>make([]foo, ...)</code> and prove that:</p>\n\n<ol>\n<li>The slice value returned does not escape the function's scope.</li>\n<li><code>append()</code> is not called on this slice value.</li>\n<li>The slice value it not passed to any called function.</li>\n</ol>\n\n<p>In this case, the slice's backing store might be allocated right on the stack.</p>\n\n<p>Sure I'm exaggregating but again, the semantics of this are not declared in the language specification.  And there are currently two mature Go implementations (that one originated from Google, dubbed <code>gc</code>, and <code>gccgo</code>) with more to come (<code>llvmgo</code> seems like having a good chances to live up), and they all have their peculiarities.</p>\n\n<p>So please consider reading up on <code>pprof</code> and Go profiling in general, and do profile sample (but real) code.</p>\n\n<p>Searching <a href=\"https://groups.google.com/forum/#!forum/golang-nuts\" rel=\"nofollow\">the mailing list</a> for the words \"profile\", \"profiling\", \"heap AND profile\", \"CPU AND profile\" and \"pprof\" will provide lots of insight on it to you.</p>\n\n<p>Consider also <a href=\"http://blog.golang.org/profiling-go-programs\" rel=\"nofollow\">this</a> and <a href=\"http://dave.cheney.net/2014/10/22/simple-profiling-package-moved-updated\" rel=\"nofollow\">this</a>.</p>\n"}], "owner": {"reputation": 13457, "user_id": 954376, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/08PZK.jpg?s=128&g=1", "display_name": "NeoWang", "link": "https://stackoverflow.com/users/954376/neowang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 750, "favorite_count": 0, "accepted_answer_id": 31561221, "answer_count": 1, "score": 4, "last_activity_date": 1437562823, "creation_date": 1437533510, "question_id": 31553048, "link": "https://stackoverflow.com/questions/31553048/how-does-go-allocate-memory-in-make-or-new-calls", "title": "How does Go allocate memory in make or new calls?", "body": "<p>When I create a new slice or struct with a make or new call:</p>\n\n<pre><code>s := make([]int64, 10, 100)\no := new(MyStruct)\n</code></pre>\n\n<p>How much memory does Go allocate with a memory allocation system call? Does it pre-allocate memory, so that subsequent calls don't trigger new system calls?</p>\n\n<p>I am asking this because I need to allocate memory frequently in my code. I am not sure if I need to implement a memory allocater myself, or if I can depend on Go to do the dirty work. And if Go does pre-allocate memory, can I customize the chunk size for allocation?</p>\n\n<p>I write some experiment code in Go, and run the code under strace, but I do not understand what Go does with the mmap system calls:</p>\n\n<pre><code>mmap(0xc000000000, 65536, PROT_NONE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xc000000000\nmunmap(0xc000000000, 65536)             = 0\nmmap(NULL, 262144, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7efdd1017000\nmmap(0xc208000000, 1048576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xc208000000\nmmap(0xc207ff0000, 65536, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xc207ff0000\nmmap(0xc000000000, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xc000000000\nmmap(NULL, 65536, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7efdd1007000\nmmap(NULL, 1439992, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7efdd0ea7000\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2223, "user_id": 1027857, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eafd8f11220851675483c051a132c570?s=128&d=identicon&r=PG", "display_name": "toth", "link": "https://stackoverflow.com/users/1027857/toth"}, "edited": false, "score": 1, "creation_date": 1437528163, "post_id": 31552290, "comment_id": 51062790, "body": "Did you try <code>go run test.go 2&gt; &#47;dev&#47;null | head</code>?"}, {"owner": {"reputation": 1943, "user_id": 579024, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mccLr.jpg?s=128&g=1", "display_name": "Dani-Br", "link": "https://stackoverflow.com/users/579024/dani-br"}, "reply_to_user": {"reputation": 2223, "user_id": 1027857, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eafd8f11220851675483c051a132c570?s=128&d=identicon&r=PG", "display_name": "toth", "link": "https://stackoverflow.com/users/1027857/toth"}, "edited": false, "score": 0, "creation_date": 1437528410, "post_id": 31552290, "comment_id": 51062845, "body": "I did <code>go run test.go |head 2&gt;&#47;dev&#47;null</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1437528778, "post_id": 31552290, "comment_id": 51062950, "body": "If writing to stdout returns an error, then exit the application."}, {"owner": {"reputation": 1943, "user_id": 579024, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mccLr.jpg?s=128&g=1", "display_name": "Dani-Br", "link": "https://stackoverflow.com/users/579024/dani-br"}, "edited": false, "score": 0, "creation_date": 1437529024, "post_id": 31552290, "comment_id": 51063018, "body": "It returns the <code>signal: broken pipe</code> line only when using with <code>|head</code>. How to catch that error ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1437530823, "post_id": 31552290, "comment_id": 51063433, "body": "You catch the error just like any other in go. Show us the source to test.go if you&#39;re unsure what to do."}], "answers": [{"tags": [], "owner": {"reputation": 303, "user_id": 5140782, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d82db70e2e14792ce50f71defb2a5e3c?s=128&d=identicon&r=PG&f=1", "display_name": "TLOlczyk", "link": "https://stackoverflow.com/users/5140782/tlolczyk"}, "is_accepted": false, "score": 1, "last_activity_date": 1437538127, "last_edit_date": 1437538127, "creation_date": 1437531451, "answer_id": 31552775, "question_id": 31552290, "link": "https://stackoverflow.com/questions/31552290/ignore-output-of-broken-pipe-signal/31552775#31552775", "title": "ignore output of &#39;broken pipe&#39; signal", "body": "<p>You don't print the code <code>test.go</code> so it is hard to judge.\nFor example does it sleep between prints?</p>\n\n<p>Broken pipe would happpen because of a one of the programs in a chain of pipes:</p>\n\n<pre><code>a.exe|b.exe|c.exe|d.exe\n</code></pre>\n\n<p>terminates early. Either <code>test.go</code> terminates while head is still expecting \ninput or more likely head terminates before  <code>test.go</code> finishes running. Especially since the default for head is  10 lines.</p>\n\n<p>The test for that would be to do <code>go run test.go |head -20</code> and see if you get a broken pipe after printing 20.</p>\n\n<p>I was not able to replicate this in C++, and don't know go. If it is the result of the go runtime, I suggest you try catching SIGPIPE in your code and terminating quietly. ( Doesn't matter what language really you, the process is the same the syntax different. )</p>\n\n<p>Otherwise this is more a bash/zsh/whatever the shell du jour is. Before you run the command make a signal handler for SIGPIPE to exit cleanly.</p>\n"}], "owner": {"reputation": 1943, "user_id": 579024, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mccLr.jpg?s=128&g=1", "display_name": "Dani-Br", "link": "https://stackoverflow.com/users/579024/dani-br"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 531, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1437538127, "creation_date": 1437527737, "question_id": 31552290, "link": "https://stackoverflow.com/questions/31552290/ignore-output-of-broken-pipe-signal", "title": "ignore output of &#39;broken pipe&#39; signal", "body": "<p>When executing a command (in Linux):  </p>\n\n<pre><code>go run test.go |head\n</code></pre>\n\n<p>The output is:  </p>\n\n<pre><code>line 0\nline 1\nline 2\nline 3\nline 4\nline 5\nline 6\nline 7\nline 8\nline 9\nsignal: broken pipe\n</code></pre>\n\n<p>How to prevent the program from printing the signal notification (last line) ?  </p>\n\n<p>[BTW: even <code>2&gt;/dev/null</code> dosn't work. probably the last line outputed to TTY]</p>\n"}, {"tags": ["go", "nested", "command-line-interface", "slice"], "comments": [{"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1437524653, "post_id": 31551788, "comment_id": 51061939, "body": "Can you show us what you&#39;ve tried so we can tweak it to show you?"}], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 0, "last_activity_date": 1437524737, "creation_date": 1437524737, "answer_id": 31551874, "question_id": 31551788, "link": "https://stackoverflow.com/questions/31551788/access-field-in-nested-structs/31551874#31551874", "title": "Access field in nested structs", "body": "<p>as you not paste the code reading the <code>Name</code> property, I just guess, you need a interface check</p>\n\n<pre><code>if stringFlag, ok := flags[0].(cli.StringFlag); ok{\n    fmt.Println(stringFlag.Name)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 53, "user_id": 5141349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5194d8632c52f67f57e4bf3deb9c4d4c?s=128&d=identicon&r=PG&f=1", "display_name": "Tim Fall", "link": "https://stackoverflow.com/users/5141349/tim-fall"}, "edited": false, "score": 0, "creation_date": 1437600448, "post_id": 31556917, "comment_id": 51103500, "body": "Thanks, that is indeed what I was doing and looking for. This is perfect, and I suspect it was an interface typing issue. Thanks!"}], "tags": [], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "is_accepted": true, "score": 3, "last_activity_date": 1437551169, "creation_date": 1437551169, "answer_id": 31556917, "question_id": 31551788, "link": "https://stackoverflow.com/questions/31551788/access-field-in-nested-structs/31556917#31556917", "title": "Access field in nested structs", "body": "<p>I assume you are accessing the value something like this</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"github.com/codegangsta/cli\"\n\nfunc main() {\n\n    fmt.Println(\"Hello, playground\")\n    a := Something()\n    fmt.Printf(\"%T \\n\", a[0].Name)\n}\n\nfunc Something() []cli.Flag {\n    return []cli.Flag{\n        cli.StringFlag{\n            Name:  \"awesome\",\n            Usage: \"be awesome\",\n        },\n        cli.StringFlag{\n            Name: \"awesome2\",\n        },\n    }\n}\n</code></pre>\n\n<p>Which will give you following error</p>\n\n<pre><code>./main.go:10: a[0].Name undefined (type cli.Flag has no field or method Name)\n</code></pre>\n\n<p>And the problem with this code is that you are accessing the struct cli.StringFlag values through an interface cli.Flag. You need to type convert this interface to actual struct type.</p>\n\n<p>Hopefully following code will make things clear.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"github.com/codegangsta/cli\"\n\nfunc main() {\n\n    a := Something()\n    stringFlag, ok := a[0].(cli.StringFlag)\n    if ok {\n        fmt.Println(stringFlag.Name)\n    }\n\n}\n\nfunc Something() []cli.Flag {\n    return []cli.Flag{\n        cli.StringFlag{\n            Name:  \"awesome\",\n            Usage: \"be awesome\",\n        },\n        cli.StringFlag{\n            Name: \"awesome2\",\n        },\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 5141349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5194d8632c52f67f57e4bf3deb9c4d4c?s=128&d=identicon&r=PG&f=1", "display_name": "Tim Fall", "link": "https://stackoverflow.com/users/5141349/tim-fall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 726, "favorite_count": 1, "accepted_answer_id": 31556917, "answer_count": 2, "score": 5, "last_activity_date": 1437601338, "creation_date": 1437524154, "last_edit_date": 1437601338, "question_id": 31551788, "link": "https://stackoverflow.com/questions/31551788/access-field-in-nested-structs", "title": "Access field in nested structs", "body": "<p>I'm having trouble with something that should be simple. I'm working on something that uses codegangsta's excellent <code>cli</code> package, but I'm trying to access a property from a nested struct and failing.</p>\n\n<p>As an example, I have:</p>\n\n<pre><code>func Something() []cli.Flag {\n    return []cli.Flag{\n        cli.StringFlag{\n            Name: awesome\n            Usage: \"be awesome\"\n           },\n         cli.StringFlag{\n            Name: awesome2\n           },\n           &lt;etc.&gt;\n         }\n</code></pre>\n\n<p>I have a function that takes in the returned <code>flags []cli.Flag</code> and tries to print out the string value of <code>Name</code> for each member, but I can't seem to access the nested content in the slice. What is the proper way of doing this?</p>\n\n<p>EDIT: Here's what I did, with additions from Mayank's excellent answer</p>\n\n<pre><code>func PrintFlagsForDriver(name string) error {\n\n        for driverName := range drivers {\n                if name == driverName {\n                        driver := drivers[driverName]\n                        flags := driver.GetCreateFlags()\n                        stringFlag, ok := flags[0].(cli.StringFlag)\n                        if ok {\n                                fmt.Println(stringFlag.Name)\n                        }\n                }\n        }\n        return fmt.Errorf(\"Driver %s not found\", name)\n}\n</code></pre>\n\n<p>I'm getting an <code>index out of range</code> runtime error now, but I think that's something else I'm doing wrong.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1437514756, "post_id": 31549980, "comment_id": 51058683, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/3129068/when-should-new-be-used-in-go\">When should `new` be used in Go?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 5, "last_activity_date": 1437515709, "last_edit_date": 1437515709, "creation_date": 1437514777, "answer_id": 31550103, "question_id": 31549980, "link": "https://stackoverflow.com/questions/31549980/what-should-be-used-new-or-var-in-go/31550103#31550103", "title": "what should be used New() or var in go?", "body": "<p>The <code>new</code> syntax you're showing returns a pointer while the other one is a value. Check out this article here; <a href=\"https://golang.org/doc/effective_go.html#allocation_new\">https://golang.org/doc/effective_go.html#allocation_new</a></p>\n\n<p>There's actually even one other option which I prefer. It's called composite literal and looks like this;</p>\n\n<pre><code>object := &amp;struct{}\n</code></pre>\n\n<p>The example above is equivalent to your use of <code>new</code>. The cool thing about it is you can specify values for any property in <code>struct</code> within the brackets there.</p>\n\n<p>When to use what is a decision you need to make on a case by case basis. In Go there are several reasons I would want one or the other; Perhaps only the pointer <code>*myType</code> implements some interface while <code>myType</code> does not, an instance <code>myType</code> could contain about 1 GB of data and you want to ensure you're passing a pointer and not the value to other methods, ect. The choice of which to use depends on the use case. Although I will say, pointers are rarely worse and because that's the case I almost always use them.</p>\n"}, {"comments": [{"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 1, "creation_date": 1437556608, "post_id": 31550593, "comment_id": 51073931, "body": "I think your comment about heap/stack is misleading: consider creating <code>var x T</code> in a function and calling <code>return &amp;x</code> at the end. Also <code>new(T)</code> doesn&#39;t necessarily need to be allocated on heap \u2013 it&#39;s up to compiler&#39;s escape analysis what to do. See: <a href=\"https://golang.org/doc/faq#stack_or_heap\" rel=\"nofollow noreferrer\">golang.org/doc/faq#stack_or_heap</a>"}, {"owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "reply_to_user": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1437561492, "post_id": 31550593, "comment_id": 51077348, "body": "You are correct @tomasz. It edit the answer to make it more clear."}], "tags": [], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "is_accepted": true, "score": 4, "last_activity_date": 1437561601, "last_edit_date": 1437561601, "creation_date": 1437516978, "answer_id": 31550593, "question_id": 31549980, "link": "https://stackoverflow.com/questions/31549980/what-should-be-used-new-or-var-in-go/31550593#31550593", "title": "what should be used New() or var in go?", "body": "<p>When you need a pointer object use new or composite literal else use var.</p>\n\n<p>Use var whenever possible as this is more likely to be allocated in stack and memory get freed as soon as scope ends. I case of new memory gets allocated most likely in heap and need to be garbage collected.</p>\n"}], "owner": {"reputation": 107, "user_id": 5141019, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/fc929e8e8da518d6cf4ce1a946fdf043?s=128&d=identicon&r=PG&f=1", "display_name": "Priyaranjan", "link": "https://stackoverflow.com/users/5141019/priyaranjan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 31550593, "answer_count": 2, "score": 2, "last_activity_date": 1437561601, "creation_date": 1437514288, "last_edit_date": 1437551320, "question_id": 31549980, "link": "https://stackoverflow.com/questions/31549980/what-should-be-used-new-or-var-in-go", "title": "what should be used New() or var in go?", "body": "<p>How a object should be created for a struct?</p>\n\n<pre><code>object := new(struct)\n</code></pre>\n\n<p>or </p>\n\n<pre><code>var object struct\n</code></pre>\n\n<p>I could not understatnd when to use what? and if both are same which one should be prefered?</p>\n"}, {"tags": ["amazon-web-services", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437507712, "post_id": 31547381, "comment_id": 51054904, "body": "What do you mean by &quot;I need to have the out puts indexed&quot;? Do you want to sort the slice of ec2.Snapshot structs?"}, {"owner": {"reputation": 5, "user_id": 5066027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6381489fc0bc5d8f4ed78ea47b0e7c19?s=128&d=identicon&r=PG&f=1", "display_name": "newtogolang", "link": "https://stackoverflow.com/users/5066027/newtogolang"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437508117, "post_id": 31547381, "comment_id": 51055118, "body": "My volumes command give a nice output like this: <a href=\"http://imgur.com/ykUeCct\" rel=\"nofollow noreferrer\">imgur.com/ykUeCct</a> , looking into ec2.Snapshotsstructs now.  I would like volumes to look the way snapshots looks."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437508987, "post_id": 31547381, "comment_id": 51055662, "body": "I still don&#39;t know what you&#39;re looking for. Please ask a question, describing your problem, and what you would like to get as output: <a href=\"http://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>"}, {"owner": {"reputation": 5, "user_id": 5066027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6381489fc0bc5d8f4ed78ea47b0e7c19?s=128&d=identicon&r=PG&f=1", "display_name": "newtogolang", "link": "https://stackoverflow.com/users/5066027/newtogolang"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437509444, "post_id": 31547381, "comment_id": 51055920, "body": "My comment is too long i have to use pastebin: <a href=\"http://pastebin.com/gqGFtjHD\" rel=\"nofollow noreferrer\">pastebin.com/gqGFtjHD</a>        Thank you for helping me with this!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437509816, "post_id": 31547381, "comment_id": 51056122, "body": "You don&#39;t need to put it in the comments, just update your question with all relevant information."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437510724, "post_id": 31547381, "comment_id": 51056605, "body": "Just to be sure, all you&#39;re asking how to print the index number before you print each Snapshot struct?"}, {"owner": {"reputation": 5, "user_id": 5066027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6381489fc0bc5d8f4ed78ea47b0e7c19?s=128&d=identicon&r=PG&f=1", "display_name": "newtogolang", "link": "https://stackoverflow.com/users/5066027/newtogolang"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437510795, "post_id": 31547381, "comment_id": 51056652, "body": "Yes.  I really would love to know how to do that."}], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 5066027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6381489fc0bc5d8f4ed78ea47b0e7c19?s=128&d=identicon&r=PG&f=1", "display_name": "newtogolang", "link": "https://stackoverflow.com/users/5066027/newtogolang"}, "edited": false, "score": 0, "creation_date": 1437511084, "post_id": 31549100, "comment_id": 51056806, "body": "Perfect, THANKYOU.  This is exactly what I needed. :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 5, "user_id": 5066027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6381489fc0bc5d8f4ed78ea47b0e7c19?s=128&d=identicon&r=PG&f=1", "display_name": "newtogolang", "link": "https://stackoverflow.com/users/5066027/newtogolang"}, "edited": false, "score": 0, "creation_date": 1437511246, "post_id": 31549100, "comment_id": 51056920, "body": "@newtogolang: you know you&#39;re already doing this <i>exact</i> same thing elsewhere in your code? I would advise you go back and reevaluate your code, and learn <i>why</i> it does what it does (plus, there&#39;s a lot of questionable pieces in that code which could be cleaned up)"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 0, "last_activity_date": 1437510885, "creation_date": 1437510885, "answer_id": 31549100, "question_id": 31547381, "link": "https://stackoverflow.com/questions/31547381/how-to-index-aws-snapshot-output/31549100#31549100", "title": "How to index aws snapshot output?", "body": "<p>If you want to print the details of the individual snapshots, you can iterate over the response:</p>\n\n<pre><code>resp, err := svc.DescribeSnapshots(params)\nif err != nil {\n    log.Fatal(err)\n}\nfor i, s := range resp.Snapshots {\n    fmt.Printf(\"Snapshot: %d\\n\", i)\n    fmt.Println(s)\n}\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 5066027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6381489fc0bc5d8f4ed78ea47b0e7c19?s=128&d=identicon&r=PG&f=1", "display_name": "newtogolang", "link": "https://stackoverflow.com/users/5066027/newtogolang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 31549100, "answer_count": 1, "score": -1, "last_activity_date": 1437510885, "creation_date": 1437504964, "last_edit_date": 1437510154, "question_id": 31547381, "link": "https://stackoverflow.com/questions/31547381/how-to-index-aws-snapshot-output", "title": "How to index aws snapshot output?", "body": "<p>Here I am printing my snapshots.  I posted below what I would like the snapshot print out to look like, and would also like to be able to print individual snapshots.  I am not sure how to do this any help would be great.  </p>\n\n<pre><code>svc := ec2.New(&amp;aws.Config{Region: \"us-east-1\"})\nparams := &amp;ec2.DescribeSnapshotsInput{\n    OwnerIDs: []*string{\n        aws.String(\"130300684064\"),\n    },\n}\n\nb, err2 := svc.DescribeSnapshots(params)\nif err2 != nil {\n    panic(err2)\n}\nfmt.Printf(awsutil.StringValue(b))\n</code></pre>\n\n<p>Here is what gets outputted: <a href=\"http://imgur.com/3MnBNXI\" rel=\"nofollow\">http://imgur.com/3MnBNXI</a>\nThis is what I would like to be output: </p>\n\n<pre><code>{\n\nSnapshots:\n\n----0\n\n  Description: \"Snapshot from MULTI\",\n\n  Encrypted: false,\n\n  OwnerID: \"130300684064\",\n\n  Progress: \"100%!\"(MISSING),\n\n  SnapshotID: \"snap-81b1dff6\",\n\n  StartTime: 2015-07-21 18:41:54 +0000 UTC,\n\n  State: \"completed\",\n\n  VolumeID: \"vol-5121ebaa\",\n\n  VolumeSize: 1\n\n},{\n\n----1\n\n  Description: \"Snapshot from MULTI\",\n\n  Encrypted: false,\n\n  OwnerID: \"130300684064\",\n\n  Progress: \"100%!\"(MISSING),\n\n  SnapshotID: \"snap-08352a7f\",\n\n  StartTime: 2015-07-21 18:41:54 +0000 UTC,\n\n  State: \"completed\",\n\n  VolumeID: \"vol-9b21eb60\",\n\n  VolumeSize: 1\n\n},{\n\n----2\n\n  Description: \"Snapshot from MULTI\",\n\n  Encrypted: false,\n\n  OwnerID: \"130300684064\",\n\n  Progress: \"100%!\"(MISSING),\n\n  SnapshotID: \"snap-768ffb00\",\n\n  StartTime: 2015-07-21 18:41:54 +0000 UTC,\n\n  State: \"completed\",\n\n  VolumeID: \"vol-5620eaad\",\n\n  VolumeSize: 1\n\n}]\n</code></pre>\n\n<p>Full code here: <a href=\"http://pastebin.com/QgmV6kRj\" rel=\"nofollow\">http://pastebin.com/QgmV6kRj</a></p>\n"}, {"tags": ["dll", "go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1437492718, "post_id": 31543415, "comment_id": 51046107, "body": "You&#39;re ignoring the error from <code>d.Symbol(&quot;GetSum&quot;)</code>. What&#39;s in it?"}, {"owner": {"reputation": 41, "user_id": 2022391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1fcd5d28ea7fa6be8acc520fea71e0?s=128&d=identicon&r=PG", "display_name": "vaish", "link": "https://stackoverflow.com/users/2022391/vaish"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1437492772, "post_id": 31543415, "comment_id": 51046143, "body": "I checked it in actual code. editing question now."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1437497539, "post_id": 31543415, "comment_id": 51049175, "body": "What kind of function is <code>GetSum</code>? What are the arguments and the return value? If it&#39;s a C function, shouldn&#39;t <a href=\"http://golang.org/cmd/cgo/#hdr-Go_references_to_C\" rel=\"nofollow noreferrer\">C strings</a> be used instead of Go strings? Also, have you tried doing it like in <a href=\"http://godoc.org/github.com/andlabs/dl\" rel=\"nofollow noreferrer\">the example</a>, with a C wrapper?"}, {"owner": {"reputation": 41, "user_id": 2022391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1fcd5d28ea7fa6be8acc520fea71e0?s=128&d=identicon&r=PG", "display_name": "vaish", "link": "https://stackoverflow.com/users/2022391/vaish"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1437563014, "post_id": 31543415, "comment_id": 51078366, "body": "True!I changed it to C strings using C.CString(&quot;&quot;),it throws the same error.As you said I also tried using C wrapper,but it gives the following error                                                                                                                   fatal error: unexpected signal during runtime execution [signal 0xb code=0x1 addr=0xc200000000 pc=0x7f12f851caea]"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1437563602, "post_id": 31543415, "comment_id": 51078740, "body": "Please update the question to include the new code and error so that people could look at it."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 2022391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1fcd5d28ea7fa6be8acc520fea71e0?s=128&d=identicon&r=PG", "display_name": "vaish", "link": "https://stackoverflow.com/users/2022391/vaish"}, "edited": false, "score": 2, "creation_date": 1437496179, "post_id": 31543932, "comment_id": 51048406, "body": "Thanks for the suggestion!I get the error in the function call only...on commenting the function call...The output is as follows                                                                                                                            DLL Loaded:: 23405168                      Converted:: 0x7ff0c768ef66                      Loaded at:: 0x7ff0c768ef66                                                                                           So the symbol is present in the dll file,there are no issues in s being nil."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 2, "last_activity_date": 1437493954, "creation_date": 1437493954, "answer_id": 31543932, "question_id": 31543415, "link": "https://stackoverflow.com/questions/31543415/unexpected-fault-address-0x0-while-using-dll-api/31543932#31543932", "title": "unexpected fault address 0x0 while using dll api", "body": "<p>The <a href=\"http://godoc.org/github.com/andlabs/dl#Module.Symbol\" rel=\"nofollow\">package documentation</a> says:</p>\n\n<blockquote>\n  <p>Symbol looks up the given named symbol in the Module. <strong>Note that the value of Symbol can be nil,</strong> so checking symbol for nil will not indicate an error; checking err for nil is. </p>\n</blockquote>\n\n<p>(Emphasis added.)</p>\n\n<p>From the <a href=\"https://github.com/andlabs/dl/blob/796da005555675751ef0b7000963dd5b464f8e48/dl.go#L33\" rel=\"nofollow\">package's source code</a> it seems that there are only two reasons both Symbol and err can be <code>nil</code>. Either the symbol is really null, or it doesn't exist in the library. Make sure that the symbol is really there, and that you've not misspelled the name. Usually you can list all symbols in an <code>.so</code> file with <code>readelf -Ws</code> or <code>nm -g</code>.</p>\n"}], "owner": {"reputation": 41, "user_id": 2022391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1fcd5d28ea7fa6be8acc520fea71e0?s=128&d=identicon&r=PG", "display_name": "vaish", "link": "https://stackoverflow.com/users/2022391/vaish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 821, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1437543479, "creation_date": 1437492586, "last_edit_date": 1437543479, "question_id": 31543415, "link": "https://stackoverflow.com/questions/31543415/unexpected-fault-address-0x0-while-using-dll-api", "title": "unexpected fault address 0x0 while using dll api", "body": "<p>I am trying to use some third party dll in go language. But facing enormous difficulties. I would prefer pure go implementation but that is not a choice.</p>\n\n<p>This my sample program</p>\n\n<pre><code>import (\n\"fmt\"\n\"github.com/andlabs/dl\"\n)\n\ntype GetObject func(string, string) int\n\nfunc main() {\n    gro := new(GetObject)\n    d, err := dl.Open(\"/home/vaishnavi/lib/libVsphere.so\", dl.Lazy)\n    if err!=nil{\n        panic(err)\n    }\n    fmt.Println(\"DLL Loaded::\", d)\n\n    s, err := d.Symbol(\"GetSum\")\n    if err != nil {\n        panic(err)\n    }\n\n    gro = (*GetObject)(s)\n\n    p := (*gro)(\"1\",\"2\")\n    fmt.Println(\"Got returned result::\", p)\n    fmt.Println(\"Converted::\", gro)\n    fmt.Println(\"Loaded at::\", s)\n    if s == nil {\n        fmt.Println(\"Error loading from the dll\")\n    }\n\n}\n</code></pre>\n\n<p>While running this program i am getting following error</p>\n\n<pre><code>DLL Loaded:: 15028848\nunexpected fault address 0x0\nfatal error: fault\n[signal 0xb code=0x80 addr=0x0 pc=0x401923]\n\ngoroutine 1 [running]:\nruntime.gothrow(0x4dcef0, 0x5)\n    /usr/local/go/src/runtime/panic.go:503 +0x8e fp=0xc20805fda0   sp=0xc20805fd88\nruntime.sigpanic()\n/usr/local/go/src/runtime/sigpanic_unix.go:29 +0x265 fp=0xc20805fdf0 sp=0xc20805fda0\nmain.main()\n        /home/vaishnavi/ESXI_VHBS/src/main/main.go:25 +0x343     fp=0xc20805ff98 sp=0xc20805fdf0\nruntime.main()\n        /usr/local/go/src/runtime/proc.go:63 +0xf3 fp=0xc20805ffe0     sp=0xc20805ff98\nruntime.goexit()\n    /usr/local/go/src/runtime/asm_amd64.s:2232 +0x1 fp=0xc20805ffe8 sp=0xc20805ffe0\n\ngoroutine 17 [syscall, locked to thread]:\nruntime.goexit()\n    /usr/local/go/src/runtime/asm_amd64.s:2232 +0x1\nError: process exited with code 2.\n</code></pre>\n\n<p>Any help will be appreciated.</p>\n"}, {"tags": ["go", "cgo", "gccgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437490163, "post_id": 31540974, "comment_id": 51044059, "body": "I would avoid trying to use gccgo <i>and</i> go1.4.2. Stick with the default toolchain until you have a specific need for gccgo, to avoid added confusion."}, {"owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "edited": false, "score": 3, "creation_date": 1437498220, "post_id": 31540974, "comment_id": 51049599, "body": "There are lot of syntactic errors in your code. It would be better if you go through <a href=\"http://blog.golang.org/c-go-cgo\" rel=\"nofollow noreferrer\">this</a> blog post before using cgo."}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 6, "last_activity_date": 1437487286, "creation_date": 1437487286, "answer_id": 31541303, "question_id": 31540974, "link": "https://stackoverflow.com/questions/31540974/not-able-to-run-c-call-from-go/31541303#31541303", "title": "Not able to run C call from go", "body": "<p>Four things:</p>\n\n<ul>\n<li>You should be using double quotes when including <code>proxy.h</code>, as it resides in the same directory as your <code>.go</code> file.</li>\n<li>There cannot be a blank line before you \"C\" comment and the \"C\" import.</li>\n<li>You are missing an <code>#endif</code> at the end <code>proxy.h</code>.</li>\n<li>You need to define <code>CMD_DEFINE</code> before including <code>proxy.h</code>. Otherwise, Go cannot access the static variable.</li>\n</ul>\n\n<p>Below is the corrected code:</p>\n\n<pre><code>package main\n\n// #define CMD_DEFINE\n// #include \"proxy.h\"\nimport \"C\"\nimport \"fmt\"\n\nfunc main(){\n    fmt.Println(C.CMD_SET_ROUTE)\n}\n</code></pre>\n\n\n\n<pre><code>#ifndef PROXY_H\n#define PROXY_H\n\n#include &lt;netinet/in.h&gt;\n\n#ifdef CMD_DEFINE\n#   define cmdexport\n#else\n#   define cmdexport static\n#endif\n\ncmdexport const int CMD_SET_ROUTE = 1;\ncmdexport const int CMD_DEL_ROUTE = 2;\ncmdexport const int CMD_STOP      = 3;\n\n#endif\n</code></pre>\n"}], "owner": {"reputation": 2203, "user_id": 773079, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f494bf18ea8fc96190a398ecee6deedc?s=128&d=identicon&r=PG", "display_name": "Pensu", "link": "https://stackoverflow.com/users/773079/pensu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 475, "favorite_count": 0, "accepted_answer_id": 31541303, "answer_count": 1, "score": 3, "last_activity_date": 1437487286, "creation_date": 1437486512, "question_id": 31540974, "link": "https://stackoverflow.com/questions/31540974/not-able-to-run-c-call-from-go", "title": "Not able to run C call from go", "body": "<p>I am trying to run a C call from go language code. Here is the program I am running:</p>\n\n<pre><code>package main\n\n// #include&lt;proxy.h&gt;\n\nimport \"C\"\nimport \"fmt\"\n\nfunc main(){\n    fmt.Println(C.CMD_SET_ROUTE)\n}\n</code></pre>\n\n<p>Here is the content of the file proxy.h:</p>\n\n<pre><code>#ifndef PROXY_H\n#define PROXY_H\n\n#include &lt;netinet/in.h&gt;\n\n#ifdef CMD_DEFINE\n#   define cmdexport\n#else\n#   define cmdexport static\n#endif\n\ncmdexport const int CMD_SET_ROUTE = 1;\ncmdexport const int CMD_DEL_ROUTE = 2;\ncmdexport const int CMD_STOP      = 3;\n</code></pre>\n\n<p>Now, here is the error I am getting when trying to run that program:</p>\n\n<pre><code>pensu@ubuntu:~$ go run test.go \n# command-line-arguments\ncould not determine kind of name for C.CMD_SET_ROUTE\n</code></pre>\n\n<p>I am using gccgo-5 and go version 1.4.2. Could you please help me figure out what exactly is the issue here? TIA.</p>\n"}, {"tags": ["json", "go", "terraform"], "comments": [{"owner": {"reputation": 2914, "user_id": 1162491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S3MH1.jpg?s=128&g=1", "display_name": "Momer", "link": "https://stackoverflow.com/users/1162491/momer"}, "edited": false, "score": 0, "creation_date": 1437486621, "post_id": 31540705, "comment_id": 51041141, "body": "You could use a lexer based approach like <a href=\"https://github.com/Jeffail/gabs\" rel=\"nofollow noreferrer\">gabs</a>, but then you don&#39;t get the idiomatic struct goodness."}], "answers": [{"comments": [{"owner": {"reputation": 4007, "user_id": 616398, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/83e5ba145326da0edcc404bfff584df5?s=128&d=identicon&r=PG", "display_name": "Gerben Jacobs", "link": "https://stackoverflow.com/users/616398/gerben-jacobs"}, "edited": false, "score": 0, "creation_date": 1437487483, "post_id": 31541299, "comment_id": 51041852, "body": "But that&#39;s a solution for Unmarshalling, in which case a map and a for loop would be sufficient. But I need to dynamic naming on the output/marshalling."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4007, "user_id": 616398, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/83e5ba145326da0edcc404bfff584df5?s=128&d=identicon&r=PG", "display_name": "Gerben Jacobs", "link": "https://stackoverflow.com/users/616398/gerben-jacobs"}, "edited": false, "score": 0, "creation_date": 1437487790, "post_id": 31541299, "comment_id": 51042123, "body": "@GerbenJacobs it works for both input and output. I added a playground example showing how to use it for output."}, {"owner": {"reputation": 4007, "user_id": 616398, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/83e5ba145326da0edcc404bfff584df5?s=128&d=identicon&r=PG", "display_name": "Gerben Jacobs", "link": "https://stackoverflow.com/users/616398/gerben-jacobs"}, "edited": false, "score": 0, "creation_date": 1437489165, "post_id": 31541299, "comment_id": 51043253, "body": "Ahh, naming them when initialising the struct. Hadn&#39;t thought of that, thanks!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1437487667, "last_edit_date": 1437487667, "creation_date": 1437487271, "answer_id": 31541299, "question_id": 31540705, "link": "https://stackoverflow.com/questions/31540705/marshal-dynamic-json-field-tags-in-go/31541299#31541299", "title": "Marshal dynamic JSON field tags in Go", "body": "<p>In most cases where there are names not known at compile time, a map can be used:</p>\n\n<pre><code>type Resource struct {\n    AWSInstance map[string]AWSInstance `json:\"aws_instance\"`\n}\n\ntype AWSInstance struct {\n    AMI string `json:\"ami\"`\n    Count int `json:\"count\"`\n    SourceDestCheck bool `json:\"source_dest_check\"`\n    // ... and so on\n}\n</code></pre>\n\n<p>Here's an example showing how to construct the value for marshalling:</p>\n\n<pre><code>r := Resource{\n    AWSInstance: map[string]AWSInstance{\n        \"web1\": AWSInstance{\n            AMI:   \"qdx\",\n            Count: 2,\n        },\n    },\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/qd869xPhMz\">playground example</a></p>\n"}], "owner": {"reputation": 4007, "user_id": 616398, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/83e5ba145326da0edcc404bfff584df5?s=128&d=identicon&r=PG", "display_name": "Gerben Jacobs", "link": "https://stackoverflow.com/users/616398/gerben-jacobs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1408, "favorite_count": 0, "accepted_answer_id": 31541299, "answer_count": 1, "score": 2, "last_activity_date": 1437487667, "creation_date": 1437485899, "question_id": 31540705, "link": "https://stackoverflow.com/questions/31540705/marshal-dynamic-json-field-tags-in-go", "title": "Marshal dynamic JSON field tags in Go", "body": "<p>I'm trying to generate JSON for a <a href=\"http://www.terraform.io/docs/configuration/syntax.html\" rel=\"nofollow\">Terraform file</a>. Because I (think I) want to use marshalling instead of rolling my own JSON, I'm using Terraforms JSON format instead of the 'native' TF format.</p>\n\n<pre><code>{\n  \"resource\": [\n    {\n      \"aws_instance\": {\n        \"web1\": {\n          \"some\": \"data\"\n        }\n    }]\n}\n</code></pre>\n\n<p><code>resource</code> and <code>aws_instance</code> are static identifiers while <code>web1</code> in this case is the random name. Also it wouldn't be unthinkable to also have <code>web2</code> and <code>web3</code>.</p>\n\n<pre><code>type Resource struct {\n    AwsResource AwsResource `json:\"aws_instance,omitempty\"`\n}\n\ntype AwsResource struct {\n    AwsWebInstance AwsWebInstance `json:\"web1,omitempty\"`\n}\n</code></pre>\n\n<p>The problem however; <strong>how do do I generate random/variable JSON keys with Go's field tags?</strong></p>\n\n<p>I have a feeling the answer is \"You don't\". What other alternatives do I have then?</p>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437498359, "post_id": 31540132, "comment_id": 51049680, "body": "<code>err := \u2026</code> creates a new <code>err</code> variable locally scoped, it shadows any <code>err</code> variable from a more distant scope and the new variable goes away at the end of the current <code>{}</code> block. You could add <code>var err error</code> before the <code>if</code> and use <code>err = \u2026</code> within the <code>if</code> bodies."}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 2, "last_activity_date": 1437484888, "creation_date": 1437484888, "answer_id": 31540261, "question_id": 31540132, "link": "https://stackoverflow.com/questions/31540132/logging-in-with-username-or-email-address/31540261#31540261", "title": "Logging in with username or email address", "body": "<p>Something like this?</p>\n\n<pre><code>field := \"username\"\nif strings.Contains(login.Identifier, \"@\") {\n    field = \"email\"\n}\nerr := collection(\"users\").Find(bson.M{field: login}).One(&amp;user)\nif err != nil {\n    api.WriteError(w, 400, \"USER_NOT_FOUND\", \"No user found with \" + field + \": \" + login)\n}\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 31540261, "answer_count": 1, "score": 0, "last_activity_date": 1437485202, "creation_date": 1437484570, "last_edit_date": 1437485003, "question_id": 31540132, "link": "https://stackoverflow.com/questions/31540132/logging-in-with-username-or-email-address", "title": "Logging in with username or email address", "body": "<p>I'm trying to improve a block of code in my Go app which handles logins. It receives a <code>login</code> value and a <code>password</code> value and then checks either the <code>username</code> field or the <code>email</code> field in the database to see if a user can be found. If the <code>login</code> contains a <code>@</code> symbol then email will be used.</p>\n\n<p>So I've currently got:</p>\n\n<pre><code>if strings.Contains(login, \"@\") {\n    err := collection(\"users\").Find(bson.M{\"email\" : login}).One(&amp;user)\n    if err != nil { //no user found\n        api.WriteError(w, 400, \"USER_NOT_FOUND\", \"No user found with email address: \" + login)\n        return\n    }\n} else {\n    err := collection(\"users\").Find(bson.M{\"username\" : login}).One(&amp;user)\n    if err != nil { //no user found\n        api.WriteError(w, 400, \"USER_NOT_FOUND\", \"No user found with username: \" + login)\n        return\n    }\n}\n//go on and check password\n</code></pre>\n\n<p>but you can see this is not very efficient as I'm having to handle the same error twice. I've also tried:</p>\n\n<pre><code>if strings.Contains(login.Identifier, \"@\") {\n    err := collection(\"users\").Find(bson.M{}).One(&amp;user)\n} else {\n    err := collection(\"users\").Find(bson.M{\"username\" : login}).One(&amp;user)\n}\n\nif err != nil { //no user found\n    api.WriteError(w, 400, \"USER_NOT_FOUND\", \"No user found with email address: \" + login)\n    return\n}\n//go on and check password\n</code></pre>\n\n<p>but <code>err</code> doesn't always exist.</p>\n\n<p>I thought about somehow making the <code>{\"username\" : login}</code> parts a string variable but I can't seem to get this working.</p>\n"}, {"tags": ["go", "blocking", "channel"], "answers": [{"comments": [{"owner": {"reputation": 187, "user_id": 2800522, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002211869160/picture?type=large", "display_name": "Leo Houer", "link": "https://stackoverflow.com/users/2800522/leo-houer"}, "edited": false, "score": 0, "creation_date": 1437484129, "post_id": 31539859, "comment_id": 51039093, "body": "Race condition? Is it safe to do?"}, {"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "reply_to_user": {"reputation": 187, "user_id": 2800522, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002211869160/picture?type=large", "display_name": "Leo Houer", "link": "https://stackoverflow.com/users/2800522/leo-houer"}, "edited": false, "score": 0, "creation_date": 1437484352, "post_id": 31539859, "comment_id": 51039284, "body": "Yeah sure, it&#39;s just racy which goroutine gets the element."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 7, "creation_date": 1437489443, "post_id": 31539859, "comment_id": 51043491, "body": "I wouldn&#39;t call it a &quot;race condition&quot;. That term is conventionally defined to indicate unintended behavior due to unsafe concurrent access of a variable. Channels are designed to be safely accessed concurrently, and there is nothing wrong with multiple readers on an unbuffered channel."}, {"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437489706, "post_id": 31539859, "comment_id": 51043709, "body": "@JimB I know that the term has several uses. If you have a better word feel free to suggest it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1437490021, "post_id": 31539859, "comment_id": 51043959, "body": "I think you don&#39;t need the term at all, and adding it just confuses the matter. There&#39;s nothing inherently &quot;racy&quot; about it, since the internal structure of the channel serializes the receive operations."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 1, "creation_date": 1437491199, "post_id": 31539859, "comment_id": 51044929, "body": "It&#39;s a non-deterministic choice, in CSP terminology. That&#39;s not the same as a race condition. The latter is accidental and harmful, as JimB said. If you want the choice to be deterministic, you might need to use N channels instead of 1, for your N receiving goroutines."}, {"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "reply_to_user": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1437491397, "post_id": 31539859, "comment_id": 51045079, "body": "@Rick-777 Race conditions are not harmful by default. There are critical and non-critical ones (for which this case is an example). Still, non-deterministic is probably the better term as it confuses less people."}, {"owner": {"reputation": 106, "user_id": 3451141, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/m9dA4.png?s=128&g=1", "display_name": "drew.neely", "link": "https://stackoverflow.com/users/3451141/drew-neely"}, "edited": false, "score": 0, "creation_date": 1582564288, "post_id": 31539859, "comment_id": 106812568, "body": "If it doesn&#39;t matter the order something happens in or which routine gets the channel input (ie. having a bunch of worker routines that are all able to process the input) then it is not a race condition."}], "tags": [], "owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "is_accepted": true, "score": 16, "last_activity_date": 1523817336, "last_edit_date": 1523817336, "creation_date": 1437483885, "answer_id": 31539859, "question_id": 31539804, "link": "https://stackoverflow.com/questions/31539804/multiple-receivers-on-a-single-channel-who-gets-the-data/31539859#31539859", "title": "Multiple receivers on a single channel. Who gets the data?", "body": "<p>A single random (non-deterministic) one will receive it.</p>\n\n<p>See the language <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"noreferrer\">spec</a>:</p>\n\n<blockquote>\n  <p>Execution of a \"select\" statement proceeds in several steps:</p>\n  \n  <ol>\n  <li>For all the cases in the statement, the channel operands of receive operations and the channel and right-hand-side expressions of send\n  statements are evaluated exactly once, in source order, upon entering\n  the \"select\" statement. The result is a set of channels to receive\n  from or send to, and the corresponding values to send. Any side\n  effects in that evaluation will occur irrespective of which (if any)\n  communication operation is selected to proceed. Expressions on the\n  left-hand side of a RecvStmt with a short variable declaration or\n  assignment are not yet evaluated.</li>\n  <li><strong>If one or more of the communications can proceed, a single one that can proceed is chosen via a uniform pseudo-random selection.</strong>\n  Otherwise, if there is a default case, that case is chosen. If there\n  is no default case, the \"select\" statement blocks until at least one\n  of the communications can proceed.</li>\n  <li>Unless the selected case is the default case, the respective communication operation is executed.</li>\n  <li>If the selected case is a RecvStmt with a short variable declaration or an assignment, the left-hand side expressions are\n  evaluated and the received value (or values) are assigned.</li>\n  <li>The statement list of the selected case is executed.</li>\n  </ol>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 4, "last_activity_date": 1470212772, "last_edit_date": 1470212772, "creation_date": 1437485215, "answer_id": 31540413, "question_id": 31539804, "link": "https://stackoverflow.com/questions/31539804/multiple-receivers-on-a-single-channel-who-gets-the-data/31540413#31540413", "title": "Multiple receivers on a single channel. Who gets the data?", "body": "<p>By default the goroutine communication is <code>synchronous</code> and <code>unbuffered</code>: sends do not complete until there is a receiver to accept the value. There must be a receiver ready to receive data from the channel and then the sender can hand it over directly to the receiver. </p>\n\n<p>So channel send/receive operations block until the other side is ready:</p>\n\n<p><strong>1.</strong> A send operation on a channel blocks until a receiver is available for the same channel: if there\u2019s no recipient for the value on <code>ch</code>, no other value can be put in the channel. And the other way around: no new value can be sent in <code>ch</code> when the channel is not empty! So the send operation will wait until <code>ch</code> becomes available again.</p>\n\n<p><strong>2.</strong> A receive operation for a channel blocks until a sender is available for the same channel: if there is no value in the channel, the receiver blocks.</p>\n\n<p>This is illustrated in the below example:</p>\n\n<pre><code>package main\nimport \"fmt\"\n\nfunc main() {\n    ch1 := make(chan int)\n    go pump(ch1) // pump hangs\n    fmt.Println(&lt;-ch1) // prints only 0\n}\n\nfunc pump(ch chan int) {\n    for i:= 0; ; i++ {\n        ch &lt;- i\n    }\n}\n</code></pre>\n\n<p>Because there is no receiver the goroutine hangs and print only the first number.</p>\n\n<p>To workaround this we need to define a new goroutine which reads from the channel in an infinite loop.</p>\n\n<pre><code>func receive(ch chan int) {\n    for {\n        fmt.Println(&lt;- ch)\n    }\n}\n</code></pre>\n\n<p>Then in <code>main()</code>:</p>\n\n<pre><code>func main() {\n    ch := make(chan int)\n    go pump(ch)\n    receive(ch)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 129, "user_id": 4199496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a75737447823001e40a5a3e3eeab4636?s=128&d=identicon&r=PG&f=1", "display_name": "drlolly", "link": "https://stackoverflow.com/users/4199496/drlolly"}, "is_accepted": false, "score": 0, "last_activity_date": 1541069659, "creation_date": 1541069659, "answer_id": 53099818, "question_id": 31539804, "link": "https://stackoverflow.com/questions/31539804/multiple-receivers-on-a-single-channel-who-gets-the-data/53099818#53099818", "title": "Multiple receivers on a single channel. Who gets the data?", "body": "<p>If the program is allowing multiple goroutines to receive on a single channel then the sender is broadcasting. Each receiver should be equally able to process the data. So it does not matter what mechanism the go runtime  uses to decide which of the many goroutine receivers will run Cf. <a href=\"https://github.com/golang/go/issues/247\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/247</a>. But only ONE will run for each sent item if the channel is unbuffered. </p>\n"}], "owner": {"reputation": 187, "user_id": 2800522, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002211869160/picture?type=large", "display_name": "Leo Houer", "link": "https://stackoverflow.com/users/2800522/leo-houer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8355, "favorite_count": 2, "accepted_answer_id": 31539859, "answer_count": 3, "score": 14, "last_activity_date": 1541069659, "creation_date": 1437483770, "last_edit_date": 1470212594, "question_id": 31539804, "link": "https://stackoverflow.com/questions/31539804/multiple-receivers-on-a-single-channel-who-gets-the-data", "title": "Multiple receivers on a single channel. Who gets the data?", "body": "<p>Unbuffered channels block receivers until data is available on the channel. It's not clear to me how this blocking behaves with multiple receivers on the same channel (say when using goroutines). I am sure they would all block as long as there is no data sent on that channel.<br>\nBut what happens once I send a single value to that channel? Which receiver/goroutine will get the data and therefore unblock? All of them? The first in line? Random?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 8, "last_activity_date": 1437478296, "creation_date": 1437478296, "answer_id": 31537853, "question_id": 31537549, "link": "https://stackoverflow.com/questions/31537549/accessing-struct-fields-from-embedded-struct/31537853#31537853", "title": "accessing struct fields from embedded struct", "body": "<p>You cannot access outer struct fields from inner struct. Only inner fields from the outer. What you can do is composing:</p>\n\n<pre><code>type CommonThing struct {\n    A int\n    B string\n}\n\nfunc (ct CommonThing) Valid() bool {\n    return ct.A != 0 &amp;&amp; ct.B != \"\"\n}\n\ntype TheThing struct {\n    CommonThing\n    C float64\n}\n\nfunc (tt TheThing) Valid() bool {\n    return tt.CommonThing.Valid() &amp;&amp; tt.C != 0\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 177, "user_id": 5086822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853c6f82008ed7b4728c143159e206f1?s=128&d=identicon&r=PG", "display_name": "Zhuharev", "link": "https://stackoverflow.com/users/5086822/zhuharev"}, "is_accepted": false, "score": 3, "last_activity_date": 1437484365, "creation_date": 1437484365, "answer_id": 31540057, "question_id": 31537549, "link": "https://stackoverflow.com/questions/31537549/accessing-struct-fields-from-embedded-struct/31540057#31540057", "title": "accessing struct fields from embedded struct", "body": "<p>You can define filed with point to himself</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n)\n\ntype ReqAbstract struct{\n    selfPointer interface{}\n}\n\nfunc (r *ReqAbstract) Assign(i interface{}) {\n    r.selfPointer = i\n}\n\nfunc (r *ReqAbstract) Validate() error {\n    log.Printf(\"%+v\", r.selfPointer)\n    return nil\n}\nfunc (r *ReqAbstract) Validate2(req interface{}) error {\n    log.Printf(\"%+v\", req)\n    return nil\n}\n\ntype PostReq struct {\n    ReqAbstract\n    Title string\n}\n\nfunc NewPostReq(title string) *PostReq {\n    pr := &amp;PostReq{Title:title}\n    pr.Assign(pr)\n    return pr\n}\n\nfunc main() {\n    request := NewPostReq(\"Example Title\")\n\n    request.Validate()\n    request.Validate2(request)\n}\n</code></pre>\n\n<p>This will output:</p>\n\n<p><code>2009/11/10 23:00:00 &amp;{ReqAbstract:{selfPointer:0x10438180} Title:Example Title}</code>\n<code>2009/11/10 23:00:00 &amp;{ReqAbstract:{selfPointer:0x10438180} Title:Example Title}</code></p>\n\n<p>Check <a href=\"http://play.golang.org/p/1xKk9S4q1f\" rel=\"nofollow\">playground</a></p>\n"}], "owner": {"reputation": 4746, "user_id": 394572, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1572070193/picture?type=large", "display_name": "alioygur", "link": "https://stackoverflow.com/users/394572/alioygur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3836, "favorite_count": 1, "accepted_answer_id": 31537853, "answer_count": 2, "score": 3, "last_activity_date": 1588573082, "creation_date": 1437477411, "last_edit_date": 1588573082, "question_id": 31537549, "link": "https://stackoverflow.com/questions/31537549/accessing-struct-fields-from-embedded-struct", "title": "accessing struct fields from embedded struct", "body": "<p>I want to define a method on a struct for validating http request. but I have some problems about accessing struct fields.</p>\n\n<p>there is my code.</p>\n\n<pre><code>package main\n\nimport \"log\"\n\ntype ReqAbstract struct{}\n\nfunc (r *ReqAbstract) Validate() error {\n    log.Printf(\"%+v\", r)\n    return nil\n}\nfunc (r *ReqAbstract) Validate2(req interface{}) error {\n    log.Printf(\"%+v\", req)\n    return nil\n}\n\ntype NewPostReq struct {\n    ReqAbstract\n    Title string\n}\n\nfunc main() {\n    request := &amp;NewPostReq{Title: \"Example Title\"}\n\n    request.Validate()\n    request.Validate2(request)\n}\n</code></pre>\n\n<p>When I run this code, I get the below result</p>\n\n<pre><code>2015/07/21 13:59:50 &amp;{}\n2015/07/21 13:59:50 &amp;{ReqAbstract:{} Title:Example Title}\n</code></pre>\n\n<p>is there any way to access struct fields on Validate() method like Validate2() method?</p>\n"}, {"tags": ["json", "go", "marshalling", "hashids"], "comments": [{"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 1, "creation_date": 1437472862, "post_id": 31535710, "comment_id": 51031372, "body": "Can you provide more code? Where that error occure?"}], "answers": [{"comments": [{"owner": {"reputation": 378, "user_id": 1100625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/541a56948a3389504ed00f2a043f0035?s=128&d=identicon&r=PG", "display_name": "Emad Ghasemi", "link": "https://stackoverflow.com/users/1100625/emad-ghasemi"}, "edited": false, "score": 0, "creation_date": 1437474630, "post_id": 31536305, "comment_id": 51032609, "body": "Yes, it might... I had tought the marshaller wrap it it self in &quot; &quot; but don&#39;t know why this happend... anyway this solved it, thanks"}, {"owner": {"reputation": 378, "user_id": 1100625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/541a56948a3389504ed00f2a043f0035?s=128&d=identicon&r=PG", "display_name": "Emad Ghasemi", "link": "https://stackoverflow.com/users/1100625/emad-ghasemi"}, "edited": false, "score": 0, "creation_date": 1437474654, "post_id": 31536305, "comment_id": 51032620, "body": "I hope there&#39;s a better explanation for this behavior"}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "reply_to_user": {"reputation": 378, "user_id": 1100625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/541a56948a3389504ed00f2a043f0035?s=128&d=identicon&r=PG", "display_name": "Emad Ghasemi", "link": "https://stackoverflow.com/users/1100625/emad-ghasemi"}, "edited": false, "score": 2, "creation_date": 1437474878, "post_id": 31536305, "comment_id": 51032752, "body": "Emad, it can&#39;t wrap it for you with <code>&quot;</code> automatically as by implementing marshaller you&#39;re supposed to provide a valid raw JSON. So you can, for example, return <code>{&quot;id&quot;: &quot;abc&quot;}</code> (not a string!). Obviously wrapping it with quotes would be wrong. You can always use <code>return json.Marshal(e)</code> in your code to provide a valid string representation without worrying about quotes (added this comment to my answer)."}], "tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": true, "score": 11, "last_activity_date": 1437474704, "last_edit_date": 1437474704, "creation_date": 1437473878, "answer_id": 31536305, "question_id": 31535710, "link": "https://stackoverflow.com/questions/31535710/marshaljson-error-invalid-character-g-after-top-level/31536305#31536305", "title": "MarshalJSON error , invalid character &quot;g&quot; after top-level", "body": "<p><code>34gj</code> is not a valid JSON and hence not a valid string representation of your ID. You probably want to wrap this with double quotation mark to indicate this is a string, i.e. returning <code>\"34gj\"</code>.</p>\n\n<p>Try:</p>\n\n<pre><code>func (id ID) MarshalJSON() ([]byte, error) {\n    e, _ := HashIDs.Encode([]int{int(id)})\n    fmt.Println(e) /// 34gj\n    return []byte(`\"` + e + `\"`), nil\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/0ESimzPbAx\">http://play.golang.org/p/0ESimzPbAx</a></p>\n\n<p>Instead of doing it by hand you can also call marshaller for the string, by simply replacing your return with <code>return json.Marshal(e)</code>.</p>\n\n<p>My guess would be that <code>invalid character 'g'</code> in your error is due to initial part of the value is being treated as a number and then unexpected character occurs.</p>\n"}], "owner": {"reputation": 378, "user_id": 1100625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/541a56948a3389504ed00f2a043f0035?s=128&d=identicon&r=PG", "display_name": "Emad Ghasemi", "link": "https://stackoverflow.com/users/1100625/emad-ghasemi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9271, "favorite_count": 1, "accepted_answer_id": 31536305, "answer_count": 1, "score": 2, "last_activity_date": 1479170307, "creation_date": 1437472206, "last_edit_date": 1479170307, "question_id": 31535710, "link": "https://stackoverflow.com/questions/31535710/marshaljson-error-invalid-character-g-after-top-level", "title": "MarshalJSON error , invalid character &quot;g&quot; after top-level", "body": "<p>I made a custom type for my IDs:</p>\n\n<pre><code>type ID uint\n\nfunc (id ID) MarshalJSON() ([]byte, error) {\n    e, _ := HashIDs.Encode([]int{int(id)})\n    fmt.Println(e) /// 34gj\n    return []byte(e), nil\n}\n\nfunc (id *ID) Scan(value interface{}) error {\n    *id = ID(value.(int64))\n    return nil\n}\n</code></pre>\n\n<p>I use the HashIDs package to encode my ids so that user wont be able to read them on client side. But I'm getting this error:</p>\n\n<blockquote>\n  <p>json: error calling MarshalJSON for type types.ID: invalid character 'g' after top-level value</p>\n</blockquote>\n"}, {"tags": ["go", "reverse-proxy"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437500496, "post_id": 31536779, "comment_id": 51050913, "body": "This only manages to print out the body one chunk at a time. You would still need to copy it into a another <code>io.Writer</code> to get the entire stream; luckily there&#39;s already something for that: <a href=\"http://golang.org/pkg/io/#TeeReader\" rel=\"nofollow noreferrer\">io.TeeReader</a>. (or make a new RoundTripper if you want the response <i>before</i> it&#39;s being written out)"}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437502664, "post_id": 31536779, "comment_id": 51052195, "body": "Yes, of course. I just show the idea. I personally think that @Ainar-G solution is better than mine."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1437507983, "post_id": 31536779, "comment_id": 51055038, "body": "I don&#39;t think OP&#39;s question is clear enough to discard this answer, in particular it doesn&#39;t say the body should be written to the string as a whole; this example, although a little bit too bloated, shows how to capture the response stream. Good solution for getting hold of response body on the fly and performing, for example, some encoding/decoding."}], "tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": false, "score": 5, "last_activity_date": 1437475221, "creation_date": 1437475221, "answer_id": 31536779, "question_id": 31535569, "link": "https://stackoverflow.com/questions/31535569/golang-how-to-read-response-body-of-reverseproxy/31536779#31536779", "title": "Golang: how to read response body of ReverseProxy?", "body": "<p>I don't know best solution. But you can do something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"net/http/httputil\"\n    \"net/url\"\n)\n\nfunc main() {\n    target := &amp;url.URL{Scheme: \"http\", Host: \"www.google.com\"}\n    proxy := httputil.NewSingleHostReverseProxy(target)\n\n    http.Handle(\"/google\", CustomHandler(proxy))\n    http.ListenAndServe(\":8099\", nil)\n}\n\nfunc CustomHandler(h http.Handler) http.HandlerFunc {\n    return func(res http.ResponseWriter, req *http.Request) {\n        h.ServeHTTP(NewCustomWriter(res), req)\n    }\n}\n\ntype customWriter struct {\n    http.ResponseWriter\n}\n\nfunc NewCustomWriter(w http.ResponseWriter) *customWriter {\n    return &amp;customWriter{w}\n}\n\nfunc (c *customWriter) Header() http.Header {\n    return c.ResponseWriter.Header()\n}\n\nfunc (c *customWriter) Write(data []byte) (int, error) {\n    fmt.Println(string(data)) //get response here\n    return c.ResponseWriter.Write(data)\n}\n\nfunc (c *customWriter) WriteHeader(i int) {\n    c.ResponseWriter.WriteHeader(i)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1437491553, "post_id": 31536962, "comment_id": 51045210, "body": "<i>small</i> nit, <code>b</code> can be wrapped with <code>bytes.NewReader</code>, which is a bit smaller structure."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 26, "last_activity_date": 1437492635, "last_edit_date": 1437492635, "creation_date": 1437475703, "answer_id": 31536962, "question_id": 31535569, "link": "https://stackoverflow.com/questions/31535569/golang-how-to-read-response-body-of-reverseproxy/31536962#31536962", "title": "Golang: how to read response body of ReverseProxy?", "body": "<p><a href=\"http://golang.org/pkg/net/http/httputil/#ReverseProxy\" rel=\"noreferrer\"><code>httputil.ReverseProxy</code></a> has a <code>Transport</code> field. You can use it to modify the response. For example:</p>\n\n<pre><code>type transport struct {\n    http.RoundTripper\n}\n\nfunc (t *transport) RoundTrip(req *http.Request) (resp *http.Response, err error) {\n    resp, err = t.RoundTripper.RoundTrip(req)\n    if err != nil {\n        return nil, err\n    }\n    b, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        return nil, err\n    }\n    err = resp.Body.Close()\n    if err != nil {\n        return nil, err\n    }\n    b = bytes.Replace(b, []byte(\"server\"), []byte(\"schmerver\"), -1)\n    body := ioutil.NopCloser(bytes.NewReader(b))\n    resp.Body = body\n    resp.ContentLength = int64(len(b))\n    resp.Header.Set(\"Content-Length\", strconv.Itoa(len(b)))\n    return resp, nil\n}\n\n// ...\nproxy := httputil.NewSingleHostReverseProxy(target)\nproxy.Transport = &amp;transport{http.DefaultTransport}\n</code></pre>\n\n<p>Playground example of the whole thing: <a href=\"http://play.golang.org/p/b0S5CbCMrI\" rel=\"noreferrer\">http://play.golang.org/p/b0S5CbCMrI</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 0, "creation_date": 1574440671, "post_id": 45648370, "comment_id": 104246948, "body": "Shouldn&#39;t this use <code>defer</code> for <code>resp.Body.Close()</code>?"}], "tags": [], "owner": {"reputation": 251, "user_id": 4403922, "user_type": "registered", "profile_image": "https://graph.facebook.com/100008597250627/picture?type=large", "display_name": "\u9648\u715c\u7199", "link": "https://stackoverflow.com/users/4403922/%e9%99%88%e7%85%9c%e7%86%99"}, "is_accepted": false, "score": 25, "last_activity_date": 1502527826, "creation_date": 1502527826, "answer_id": 45648370, "question_id": 31535569, "link": "https://stackoverflow.com/questions/31535569/golang-how-to-read-response-body-of-reverseproxy/45648370#45648370", "title": "Golang: how to read response body of ReverseProxy?", "body": "<p>now httputil/reverseproxy, support than, see source</p>\n\n<pre><code> type ReverseProxy struct {\n        ...\n\n        // ModifyResponse is an optional function that\n        // modifies the Response from the backend\n        // If it returns an error, the proxy returns a StatusBadGateway error.\n        ModifyResponse func(*http.Response) error\n    }\n\n\n\nfunc rewriteBody(resp *http.Response) (err error) {\n    b, err := ioutil.ReadAll(resp.Body) //Read html\n    if err != nil {\n        return  err\n    }\n    err = resp.Body.Close()\n    if err != nil {\n        return err\n    }\n    b = bytes.Replace(b, []byte(\"server\"), []byte(\"schmerver\"), -1) // replace html\n    body := ioutil.NopCloser(bytes.NewReader(b))\n    resp.Body = body\n    resp.ContentLength = int64(len(b))\n    resp.Header.Set(\"Content-Length\", strconv.Itoa(len(b)))\n    return nil\n}\n\n// ...\ntarget, _ := url.Parse(\"http://example.com\")\nproxy := httputil.NewSingleHostReverseProxy(target)\nproxy.ModifyResponse = rewriteBody\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 6617675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e55fe0c2940665dab9e3452c35a90d3?s=128&d=identicon&r=PG", "display_name": "xuchenCN", "link": "https://stackoverflow.com/users/6617675/xuchencn"}, "is_accepted": false, "score": 0, "last_activity_date": 1611628833, "creation_date": 1611628833, "answer_id": 65895198, "question_id": 31535569, "link": "https://stackoverflow.com/questions/31535569/golang-how-to-read-response-body-of-reverseproxy/65895198#65895198", "title": "Golang: how to read response body of ReverseProxy?", "body": "<p>From source code <code>httptest.ResponseRecorder</code> is use for get the response from the handler</p>\n<pre><code>func TestModifyResponseClosesBody(t *testing.T) {\n    req, _ := http.NewRequest(&quot;GET&quot;, &quot;http://foo.tld/&quot;, nil)\n    req.RemoteAddr = &quot;1.2.3.4:56789&quot;\n    closeCheck := new(checkCloser)\n    logBuf := new(bytes.Buffer)\n    outErr := errors.New(&quot;ModifyResponse error&quot;)\n    rp := &amp;ReverseProxy{\n        Director: func(req *http.Request) {},\n        Transport: &amp;staticTransport{&amp;http.Response{\n            StatusCode: 200,\n            Body:       closeCheck,\n        }},\n        ErrorLog: log.New(logBuf, &quot;&quot;, 0),\n        ModifyResponse: func(*http.Response) error {\n            return outErr\n        },\n    }\n    rec := httptest.NewRecorder()\n    rp.ServeHTTP(rec, req)\n    res := rec.Result()\n    if g, e := res.StatusCode, http.StatusBadGateway; g != e {\n        t.Errorf(&quot;got res.StatusCode %d; expected %d&quot;, g, e)\n    }\n    if !closeCheck.closed {\n        t.Errorf(&quot;body should have been closed&quot;)\n    }\n    if g, e := logBuf.String(), outErr.Error(); !strings.Contains(g, e) {\n        t.Errorf(&quot;ErrorLog %q does not contain %q&quot;, g, e)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 15493, "user_id": 380774, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3772ea86cd39ce7e63280ecfffb6512c?s=128&d=identicon&r=PG", "display_name": "fannheyward", "link": "https://stackoverflow.com/users/380774/fannheyward"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14362, "favorite_count": 12, "accepted_answer_id": 31536962, "answer_count": 4, "score": 21, "last_activity_date": 1611628833, "creation_date": 1437471820, "question_id": 31535569, "link": "https://stackoverflow.com/questions/31535569/golang-how-to-read-response-body-of-reverseproxy", "title": "Golang: how to read response body of ReverseProxy?", "body": "<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"net/http/httputil\"\n    \"net/url\"\n)\n\nfunc main() {\n    target := &amp;url.URL{Scheme: \"http\", Host: \"www.google.com\"}\n    proxy := httputil.NewSingleHostReverseProxy(target)\n\n    http.Handle(\"/google\", proxy)\n    http.ListenAndServe(\":8099\", nil)\n}\n</code></pre>\n\n<p>Reverse Proxy is works. How can I get the response body?</p>\n"}, {"tags": ["go", "websocket"], "answers": [{"comments": [{"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 3, "creation_date": 1444975271, "post_id": 31532724, "comment_id": 54135630, "body": "Can we extract some sample code to put here? Just in case the link dies. <a href=\"http://meta.stackexchange.com/a/8259/306913\">meta.stackexchange.com/a/8259/306913</a>"}], "tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": true, "score": 8, "last_activity_date": 1444978454, "last_edit_date": 1495535359, "creation_date": 1437463347, "answer_id": 31532724, "question_id": 31532652, "link": "https://stackoverflow.com/questions/31532652/go-websocket-send-all-clients-a-message/31532724#31532724", "title": "GO Websocket send all clients a message", "body": "<p>You have to use connection pool to broadcast messages to all connections.\nYou can use that as tutorial/sample <a href=\"http://gary.burd.info/go-websocket-chat\" rel=\"nofollow noreferrer\">http://gary.burd.info/go-websocket-chat</a></p>\n\n<p>Simplifying:<br>\nConnection pool is a collection of registered connections. See <code>hub.connections</code>:</p>\n\n<pre><code>type connection struct {\n    // The websocket connection.\n    ws *websocket.Conn\n\n    // Buffered channel of outbound messages.\n    send chan []byte\n\n    // The hub.\n    h *hub\n}\n\ntype hub struct {\n    // Registered connections. That's a connection pool\n    connections map[*connection]bool\n\n    ...\n}\n</code></pre>\n\n<p>To broadcast message for all clients, we iterate over connection pool like this:  </p>\n\n<pre><code>    case m := &lt;-h.broadcast:\n        for c := range h.connections {\n            select {\n            case c.send &lt;- m:\n            default:\n                delete(h.connections, c)\n                close(c.send)\n            }\n        }\n    }\n</code></pre>\n\n<p><code>h.broadcast</code> in that example is a channel with messages we need to broadcast.<br>\nWe use <code>default</code> section of the <code>select</code> statement to delete connections with full or blocked send channels. See <a href=\"https://stackoverflow.com/questions/32693931/what-is-the-benefit-of-sending-to-a-channel-by-using-select-in-go\">What is the benefit of sending to a channel by using select in Go?</a></p>\n"}], "owner": {"reputation": 1651, "user_id": 3205343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/b4b36c320c0a3ecbb69718be6741f7bf?s=128&d=identicon&r=PG&f=1", "display_name": "Bene", "link": "https://stackoverflow.com/users/3205343/bene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9674, "favorite_count": 0, "accepted_answer_id": 31532724, "answer_count": 1, "score": 4, "last_activity_date": 1465656563, "creation_date": 1437463135, "last_edit_date": 1465656563, "question_id": 31532652, "link": "https://stackoverflow.com/questions/31532652/go-websocket-send-all-clients-a-message", "title": "GO Websocket send all clients a message", "body": "<p>Everything works fine with this code (shortened it for better reading).</p>\n\n<p>When <code>Client1</code> sends a request to the Server, the Server responses to him instantly. But, the other clients can not see the response message.</p>\n\n<p>So I want to make it go further: When a client sends a request to the server, the server will response to all clients so that all clients can see the message.</p>\n\n<p>How can I do that? Any examples or nice tutorials for beginners?</p>\n\n<p>Thanks in advance!</p>\n\n<p>Server:</p>\n\n<pre><code>import (\n        \"github.com/gorilla/websocket\"\n       )\n\nfunc main() {\n    http.Handle(\"/server\", websocket.Handler(echoHandler)) \n}\n\nfunc echoHandler(ws *websocket.Conn) {\n    conn, err := upgrader.Upgrade(w, r, nil) \n    if err != nil { \n      return\n    }\n    for {\n      messageType, p, err := conn.ReadMessage() \n      if err != nil {\n        return\n      }\n\n      print_binary(p) // simple print of the message\n\n      err = conn.WriteMessage(messageType, p);\n      if err != nil {\n        return\n      }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "messaging"], "answers": [{"tags": [], "owner": {"reputation": 96, "user_id": 4123094, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Rx6JQDL7b8Y/AAAAAAAAAAI/AAAAAAAAAdQ/cYJh4FTQtGM/photo.jpg?sz=128", "display_name": "Guillaume Bailleul", "link": "https://stackoverflow.com/users/4123094/guillaume-bailleul"}, "is_accepted": false, "score": 1, "last_activity_date": 1437467168, "creation_date": 1437467168, "answer_id": 31533917, "question_id": 31532305, "link": "https://stackoverflow.com/questions/31532305/embeddable-messaging-component-for-golang-application/31533917#31533917", "title": "Embeddable messaging component for Golang application", "body": "<p>I use RabbitMQ in production with this library <a href=\"https://github.com/streadway/amqp\" rel=\"nofollow\">https://github.com/streadway/amqp</a>. This is not an official library but the implementation is quite good.</p>\n\n<p>I use it to improve fault tolerance and scalability for IOT.</p>\n\n<p>Pro:</p>\n\n<ul>\n<li>Easy to use</li>\n<li>Great administration tools</li>\n<li>Many languages implementations</li>\n<li>Many patterns availables <a href=\"https://www.rabbitmq.com/getstarted.html\" rel=\"nofollow\">https://www.rabbitmq.com/getstarted.html</a></li>\n</ul>\n\n<p>Cons:</p>\n\n<ul>\n<li>Not really efficient for big payloads</li>\n<li>Probably not the fastest (but fast enough to my projects)</li>\n</ul>\n"}], "owner": {"reputation": 149, "user_id": 3573604, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/776772628719c8ba22a2d516e5f1cba5?s=128&d=identicon&r=PG&f=1", "display_name": "anaray", "link": "https://stackoverflow.com/users/3573604/anaray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1437467168, "creation_date": 1437461997, "last_edit_date": 1437462543, "question_id": 31532305, "link": "https://stackoverflow.com/questions/31532305/embeddable-messaging-component-for-golang-application", "title": "Embeddable messaging component for Golang application", "body": "<p>I need a embeddable messaging component for Golang application.I looked into distributed messaging system like NSQ etc, but prefer one which is much simpler, stable and embeddable (no separate daemon). Systems like NSQ would be overkill for my requirement and I don't think it is easily embeddable. </p>\n\n<p>I need such a component to distribute the payload/data reliably (delivered  once atleast) among my processing distributed engines and embeddable would make installation and configurations easy.</p>\n\n<p>Any information would be appreciated.</p>\n"}, {"tags": ["go"], "owner": {"reputation": 31, "user_id": 5136181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15651704a60f7ef1539f9b1fa2506188?s=128&d=identicon&r=PG", "display_name": "Tao Wen", "link": "https://stackoverflow.com/users/5136181/tao-wen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 109, "favorite_count": 1, "closed_date": 1437462259, "answer_count": 0, "score": 1, "last_activity_date": 1437464382, "creation_date": 1437459960, "last_edit_date": 1437464382, "question_id": 31531775, "link": "https://stackoverflow.com/questions/31531775/how-to-count-lines-fast-in-go", "closed_reason": "Duplicate", "title": "how to count lines fast in Go?", "body": "<p>Here is the code</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"os\"\n    \"bufio\"\n)\nfunc main() {\n    fi, err := os.Open(\"/tmp/messages\")\n    if err != nil {\n        panic(err)\n    }\n    defer func() {\n        if err := fi.Close(); err != nil {\n            panic(err)\n        }\n    }()\n    scanner := bufio.NewScanner(fi)\n    lines := 0\n    for scanner.Scan() {\n        scanner.Bytes()\n        lines += 1\n    }\n    fmt.Println(lines)\n    if err := scanner.Err(); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Here is the elapsed time</p>\n\n<pre><code>5675143\n\nreal    0m0.548s\nuser    0m0.437s\nsys     0m0.119s\n</code></pre>\n\n<p>It took twice the time took by \"wc\" for a 588Mb log file</p>\n\n<p>wc -l /tmp/messages</p>\n\n<pre><code>5675142 /tmp/messages\n\nreal    0m0.231s\nuser    0m0.150s\nsys     0m0.081s\n</code></pre>\n\n<p>The result of pprof is</p>\n\n<pre><code>540ms of 540ms total (  100%)\n      flat  flat%   sum%        cum   cum%\n     200ms 37.04% 37.04%      200ms 37.04%  syscall.Syscall\n     190ms 35.19% 72.22%      190ms 35.19%  runtime.indexbytebody\n     100ms 18.52% 90.74%      520ms 96.30%  bufio.(*Scanner).Scan\n      20ms  3.70% 94.44%      210ms 38.89%  bufio.ScanLines\n      10ms  1.85% 96.30%      530ms 98.15%  main.main\n      10ms  1.85% 98.15%      210ms 38.89%  os.(*File).Read\n      10ms  1.85%   100%       10ms  1.85%  runtime.usleep\n         0     0%   100%      200ms 37.04%  os.(*File).read\n         0     0%   100%      530ms 98.15%  runtime.goexit\n         0     0%   100%      530ms 98.15%  runtime.main\n         0     0%   100%       10ms  1.85%  runtime.mstart\n         0     0%   100%       10ms  1.85%  runtime.mstart1\n         0     0%   100%       10ms  1.85%  runtime.sysmon\n         0     0%   100%      200ms 37.04%  syscall.Read\n         0     0%   100%      200ms 37.04%  syscall.read\n</code></pre>\n\n<p>Is there a way to optimize the code to run faster? My guess is the overhead of calling syscall contributes 100ms to the overall time. The majority time might be spent on the data copying inside Scanner. </p>\n"}, {"tags": ["struct", "go", "casting", "byte"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1437444421, "post_id": 31529071, "comment_id": 51124758, "body": "you just control the server side, means you have already have the serial protocol. What protocol you have, is the key point of your question. golang have encoding package support for widely used protocols, like JSON, BSON or PROTOBUF. so find out the serial protocol and choose the encoding package. or if you have private protocol, implement a encoding yourself."}, {"owner": {"reputation": 249, "user_id": 642318, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/7af83b1e5da93133828b49c01b91c5ee?s=128&d=identicon&r=PG", "display_name": "user642318", "link": "https://stackoverflow.com/users/642318/user642318"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1437445398, "post_id": 31529071, "comment_id": 51124759, "body": "It is private protocol. Any examples/article/goplayground?"}], "answers": [{"comments": [{"owner": {"reputation": 249, "user_id": 642318, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/7af83b1e5da93133828b49c01b91c5ee?s=128&d=identicon&r=PG", "display_name": "user642318", "link": "https://stackoverflow.com/users/642318/user642318"}, "edited": false, "score": 0, "creation_date": 1437480520, "post_id": 31531620, "comment_id": 51036391, "body": "Any idea how to cast to variable size"}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "reply_to_user": {"reputation": 249, "user_id": 642318, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/7af83b1e5da93133828b49c01b91c5ee?s=128&d=identicon&r=PG", "display_name": "user642318", "link": "https://stackoverflow.com/users/642318/user642318"}, "edited": false, "score": 0, "creation_date": 1437483734, "post_id": 31531620, "comment_id": 51038753, "body": "Depends on your data structure. You can split your source array onto 2 parts. First part will contains only fixed-size data (A and B in your case 3 bytes). Second part will contains array data. In that way you need to create new structure, without array part, like <code>type T struct { \tA int16 \tB int8 }</code>. And decode both parts separately"}], "tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": false, "score": 3, "last_activity_date": 1442917733, "last_edit_date": 1442917733, "creation_date": 1437459317, "answer_id": 31531620, "question_id": 31529071, "link": "https://stackoverflow.com/questions/31529071/golang-casting-byte-array-to-struct/31531620#31531620", "title": "golang casting byte array to struct", "body": "<p>According to <a href=\"http://golang.org/pkg/encoding/binary/#Read\" rel=\"nofollow\">http://golang.org/pkg/encoding/binary/#Read</a> :</p>\n\n<blockquote>\n  <p>Data must be a pointer to a fixed-size value or a slice of <strong>fixed-size</strong> values.</p>\n</blockquote>\n\n<p>So you can't use slice <code>[]byte</code> <strong>in</strong> your structure. But you can use fixed size array for it.<br>\nLike this: <kbd><a href=\"http://play.golang.org/p/cbHX5Twyrw\" rel=\"nofollow\">Go playground</a></kbd></p>\n"}, {"tags": [], "owner": {"reputation": 445, "user_id": 4265763, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_XuweyYACIs/AAAAAAAAAAI/AAAAAAAAAEI/OvebLDs1Rlo/photo.jpg?sz=128", "display_name": "Sirui Zhuang", "link": "https://stackoverflow.com/users/4265763/sirui-zhuang"}, "is_accepted": false, "score": 2, "last_activity_date": 1455203589, "last_edit_date": 1455203589, "creation_date": 1455203276, "answer_id": 35342925, "question_id": 31529071, "link": "https://stackoverflow.com/questions/31529071/golang-casting-byte-array-to-struct/35342925#35342925", "title": "golang casting byte array to struct", "body": "<p>I think <a href=\"https://github.com/zhuangsirui/binpacker\" rel=\"nofollow\">binpacker</a> will be greate to handle this case:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n\n    \"github.com/zhuangsirui/binpacker\"\n)\n\ntype T struct {\n    A uint16\n    B string\n    C []byte\n}\n\nfunc main() {\n    field1 := uint16(1)\n    field2 := \"Hello World\"\n    field3 := []byte(\"Hello World\")\n    buffer := new(bytes.Buffer)\n    binpacker.NewPacker(buffer).\n        PushUint16(field1).\n        PushUint16(uint16(len(field2))).PushString(field2).\n        PushUint16(uint16(len(field3))).PushBytes(field3)\n\n    t := new(T)\n    unpacker := binpacker.NewUnpacker(buffer)\n    unpacker.FetchUint16(&amp;t.A).StringWithUint16Perfix(&amp;t.B).BytesWithUint16Perfix(&amp;t.C)\n    fmt.Println(t)\n}\n</code></pre>\n"}], "owner": {"reputation": 249, "user_id": 642318, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/7af83b1e5da93133828b49c01b91c5ee?s=128&d=identicon&r=PG", "display_name": "user642318", "link": "https://stackoverflow.com/users/642318/user642318"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20031, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1467626524, "creation_date": 1437443409, "last_edit_date": 1442921589, "question_id": 31529071, "link": "https://stackoverflow.com/questions/31529071/golang-casting-byte-array-to-struct", "title": "golang casting byte array to struct", "body": "<p>I am looking for clean way to cast byte array to struct for client-server application.\nI know most ppl turn to gob package for this solution however I do not control the encoding for the application. that being said, I only programmed the server application not the client, there is a mutual contract for the protocol that is being exchanged.</p>\n\n<p>The best I could come out is the following.</p>\n\n<pre><code>type T struct {\n    A int16\n    B int8\n    C []byte\n}\n\nfunc main() {\n    // Create a struct and write it.\n    t := T{A: 99, B: 10}\n    buf := &amp;bytes.Buffer{}\n\n    buf1 := []byte{5, 100, 100}\n    fmt.Println(buf1)\n\n    buf.Write(buf1)\n\n    //err := binary.Write(buf, binary.BigEndian, t)\n\n    //if err != nil {\n    //  panic(err)\n    //}\n    fmt.Println(buf)\n\n    // Read into an empty struct.\n    t = T{}\n    err := binary.Read(buf, binary.BigEndian, &amp;t)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%d %d\", t.A, t.B)\n}\n</code></pre>\n\n<p>However, as soon as number bytes does not coincide with the size of the struct, then go will send a panic. How can I modify this to work without the panic if undersize or oversize</p>\n\n<p><kbd><a href=\"http://play.golang.org/p/ZQOvQC4yPg\" rel=\"nofollow\">Go playground</a></kbd></p>\n"}, {"tags": ["sql", "go"], "answers": [{"tags": [], "owner": {"reputation": 31570, "user_id": 56837, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/t20K1.jpg?s=128&g=1", "display_name": "Stefan Arentz", "link": "https://stackoverflow.com/users/56837/stefan-arentz"}, "is_accepted": false, "score": 0, "last_activity_date": 1437439163, "creation_date": 1437439163, "answer_id": 31528571, "question_id": 31528168, "link": "https://stackoverflow.com/questions/31528168/go-sql-scanned-rows-getting-overwritten/31528571#31528571", "title": "Go SQL scanned rows getting overwritten", "body": "<p>Move <code>result := make([]string, len(cols))</code> into your <code>for</code> loop that loops over the available rows.</p>\n"}, {"comments": [{"owner": {"reputation": 566, "user_id": 5091163, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/100000663691395/picture?type=large", "display_name": "Barry McNamara", "link": "https://stackoverflow.com/users/5091163/barry-mcnamara"}, "edited": false, "score": 0, "creation_date": 1437489806, "post_id": 31531943, "comment_id": 51043797, "body": "Thanks, that&#39;s very non-intuitive"}], "tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": true, "score": 1, "last_activity_date": 1437468258, "last_edit_date": 1437468258, "creation_date": 1437460587, "answer_id": 31531943, "question_id": 31528168, "link": "https://stackoverflow.com/questions/31528168/go-sql-scanned-rows-getting-overwritten/31531943#31531943", "title": "Go SQL scanned rows getting overwritten", "body": "<p>You should create new slice for each data row. Notice, that a slice has a pointer to underlying array, so every slice you added into <code>results</code> have same pointer on actual data array. That's why you have faced with that behaviour.</p>\n"}, {"comments": [{"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 1, "creation_date": 1437466804, "post_id": 31532439, "comment_id": 51027433, "body": "<code>append</code> does not just copy address of memory, take a look <a href=\"https://play.golang.org/p/7t4ie3JTOL\" rel=\"nofollow noreferrer\">play.golang.org/p/7t4ie3JTOL</a> It copys values. <code>Slice</code> is a struct, but truth is that slice contains pointer to underlying array. So while slice has been copied, pointer stays same"}, {"owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "reply_to_user": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 1, "creation_date": 1437486652, "post_id": 31532439, "comment_id": 51041167, "body": "Yes. Thanks for clarifying."}], "tags": [], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "is_accepted": false, "score": 1, "last_activity_date": 1437486608, "last_edit_date": 1437486608, "creation_date": 1437462464, "answer_id": 31532439, "question_id": 31528168, "link": "https://stackoverflow.com/questions/31528168/go-sql-scanned-rows-getting-overwritten/31532439#31532439", "title": "Go SQL scanned rows getting overwritten", "body": "<p>When you create a slice using func make() it return a type (Not a pointer to type). But it does not allocate new memory each time a element is reassigned. Hence </p>\n\n<p>result := make([]string, 5)</p>\n\n<p>will have fix memory to contain 5 strings. when a element is reassigned, it occupies same memory as before hence overriding the old value.</p>\n\n<p>Hopefully following example make things clear.</p>\n\n<p><a href=\"http://play.golang.org/p/3w2NtEHRuu\" rel=\"nofollow\">http://play.golang.org/p/3w2NtEHRuu</a></p>\n\n<p>Hence in your program you are changing the content of the same memory and appending it again and again. To solve this problem you should create your result slice inside the loop.</p>\n"}], "owner": {"reputation": 566, "user_id": 5091163, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/100000663691395/picture?type=large", "display_name": "Barry McNamara", "link": "https://stackoverflow.com/users/5091163/barry-mcnamara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 31531943, "answer_count": 3, "score": 2, "last_activity_date": 1437486608, "creation_date": 1437436234, "question_id": 31528168, "link": "https://stackoverflow.com/questions/31528168/go-sql-scanned-rows-getting-overwritten", "title": "Go SQL scanned rows getting overwritten", "body": "<p>I'm trying to read all the rows from a table on a SQL server and store them in string slices to use for later. The issue I'm running into is that the previously scanned rows are getting overwritten every time I scan a new row, even though I've converted all the mutable byte slices to immutable strings and saved the result slices to another slice. Here is the code I'm using:</p>\n\n<pre><code>rawResult := make([]interface{}, len(cols)) // holds anything that could be in a row\nresult := make([]string, len(cols)) // will hold all row elements as strings\nvar results [][]string // will hold all the result string slices\ndest := make([]interface{}, len(cols)) // temporary, to pass into scan\nfor i, _ := range rawResult {\n    dest[i] = &amp;rawResult[i] // fill dest with pointers to rawResult to pass into scan\n}\nfor rows.Next() { // for each row\n    err = rows.Scan(dest...) // scan the row\n    if err != nil {\n        log.Fatal(\"Failed to scan row\", err)\n    }\n    for i, raw := range rawResult { // for each scanned byte slice in a row\n        switch rawtype := raw.(type){ // determine type, convert to string\n        case int64:\n            result[i] = strconv.FormatInt(raw.(int64), 10)\n        case float64:\n            result[i] = strconv.FormatFloat(raw.(float64), 'f', -1, 64)\n        case bool:\n            result[i] = strconv.FormatBool(raw.(bool))\n        case []byte:\n            result[i] = string(raw.([]byte))\n        case string:\n            result[i] = raw.(string)\n        case time.Time:\n            result[i] = raw.(time.Time).String()\n        case nil:\n            result[i] = \"\"\n        default: // shouldn't actually be reachable since all types have been covered\n            log.Fatal(\"Unexpected type %T\", rawtype)\n        }\n    }\n    results = append(results, result) // append the result to our slice of results\n}\n</code></pre>\n\n<p>I'm sure this has something to do with the way Go handles variables and memory, but I can't seem to fix it. Can somebody explain what I'm not understanding?</p>\n"}, {"tags": ["http", "go", "client"], "comments": [{"owner": {"reputation": 2312, "user_id": 317512, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8c33f38cdc152bb55b69c9192e401733?s=128&d=identicon&r=PG", "display_name": "Bharat", "link": "https://stackoverflow.com/users/317512/bharat"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1437435792, "post_id": 31527948, "comment_id": 51017425, "body": "@Bravada Zadada, how to I make <code>numRequests</code> with only <code>numConcurrent</code> being concurrent while the rest waits? I thought this can be accomplished by limiting the channel size so that when channel is full, it&#39;ll block until it becomes empty."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 1, "creation_date": 1437436253, "post_id": 31527948, "comment_id": 51017558, "body": "@Bharat the problem is your ` go func(url string) {}` will keep opening connections and block on sending the resp, so you will have few hundred open connections in the same time until your reader starts closing them."}, {"owner": {"reputation": 2312, "user_id": 317512, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8c33f38cdc152bb55b69c9192e401733?s=128&d=identicon&r=PG", "display_name": "Bharat", "link": "https://stackoverflow.com/users/317512/bharat"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1437436445, "post_id": 31527948, "comment_id": 51017623, "body": "@OneOfOne, then how do I implement the goroutine for making requests? I am new to go and still not very clear about the way concurrently works."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1437437279, "post_id": 31527948, "comment_id": 51017866, "body": "@Bharat I added an example, you will want to spawn X amount of processing goroutines and use a channel to send them the urls to process."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437496818, "post_id": 31527948, "comment_id": 51048764, "body": "BTW (unrelated to your question which others have answered): You don&#39;t need a lock on <code>reqsDone</code> since it&#39;s only used by a single goroutine (if  instead you had it in the goroutine doing the requests then you could use <code>sync&#47;atomic</code> to increment and load the counter safely). There is no need to initialize the map and check for key existence; just do <code>rs := make(map[int]int)</code> and <code>rs[status]++</code> (<a href=\"https://play.golang.org/p/kGkOd3lVOd\" rel=\"nofollow noreferrer\">example</a>)."}, {"owner": {"reputation": 2312, "user_id": 317512, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8c33f38cdc152bb55b69c9192e401733?s=128&d=identicon&r=PG", "display_name": "Bharat", "link": "https://stackoverflow.com/users/317512/bharat"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437500676, "post_id": 31527948, "comment_id": 51051019, "body": "@DaveC, thanks for letting me know about using locks. I am trying to understand golang and wrote this program to play around with concurrency.Lots of new concepts which I&#39;m not used to :) And I initialized the map because I got an error, <code>panic: assignment to entry in nil map</code> when I tried to increment by doing <code>responseStatuses[status] += 1</code>."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437572696, "post_id": 31527948, "comment_id": 51085303, "body": "@Bharat, I should have said, no need to initialize the map with data. You can just initialize it as an empty map. Unless you explicitly check for existence you get back the zero value which makes things like <code>if boolMap[key]</code>, <code>sliceMap[key] = append(sliceMap[key], value)</code>, and <code>counterMap[key]++</code> all work well. Unless you really need/want a zero valued entry in the map for some key(s)."}], "answers": [{"comments": [{"owner": {"reputation": 2312, "user_id": 317512, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8c33f38cdc152bb55b69c9192e401733?s=128&d=identicon&r=PG", "display_name": "Bharat", "link": "https://stackoverflow.com/users/317512/bharat"}, "edited": false, "score": 0, "creation_date": 1437456513, "post_id": 31528314, "comment_id": 51022511, "body": "Thanks! In the 2nd goroutine, you are writing url into <code>urlCh</code> and in the 1st goroutine you are reading those urls from the <code>urlCh</code>. The size of <code>urlCh</code> is <code>numConcurrent</code> which is 10 but the for loop in the 2nd goroutine iteration till 500.So after every 10 urls written, that goroutine would do nothing until these are consumed by the 1st goroutine. And the 1st goroutine would be running until this channel is closed. Is this right?"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 2312, "user_id": 317512, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8c33f38cdc152bb55b69c9192e401733?s=128&d=identicon&r=PG", "display_name": "Bharat", "link": "https://stackoverflow.com/users/317512/bharat"}, "edited": false, "score": 0, "creation_date": 1437513462, "post_id": 31528314, "comment_id": 51058080, "body": "@Bharat the 2nd goroutine would block until there&#39;s room for it to push another url."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 1, "last_activity_date": 1437437233, "creation_date": 1437437233, "answer_id": 31528314, "question_id": 31527948, "link": "https://stackoverflow.com/questions/31527948/too-many-open-files-when-making-http-requests/31528314#31528314", "title": "too many open files when making http requests", "body": "<p>Basically you were spawning 100s of goroutines that will start the connection the block until they are closed.</p>\n\n<p>Here's a quick (and very ugly) working code:</p>\n\n<pre><code>var (\n    responseStatuses = make(map[int]int, 63)\n    reqsDone         = 0\n\n    urlCh = make(chan string, numConcurrent)\n    ch    = make(chan *http.Response, numConcurrent)\n)\nlog.Println(numConcurrent, numRequests, len(responseStatuses))\nfor i := 0; i &lt; numConcurrent; i++ {\n    go func() {\n        for url := range urlCh {\n            client := &amp;http.Client{}\n            req, reqErr := http.NewRequest(\"GET\", url, nil)\n            if reqErr != nil {\n                fmt.Println(reqErr)\n            }\n            // adding connection:close header hoping to get rid\n            // of too many files open error. Found this in http://craigwickesser.com/2015/01/golang-http-to-many-open-files/\n            req.Header.Add(\"Connection\", \"close\")\n\n            resp, err := client.Do(req)\n            if err != nil {\n                fmt.Println(err)\n            }\n            ch &lt;- resp\n        }\n\n    }()\n}\ngo func() {\n    for i := 0; i &lt; numRequests; i++ {\n        urlCh &lt;- url\n    }\n    close(urlCh)\n}()\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/67XDsfr2Te\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}, {"tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": 0, "last_activity_date": 1575824551, "creation_date": 1575824551, "answer_id": 59237740, "question_id": 31527948, "link": "https://stackoverflow.com/questions/31527948/too-many-open-files-when-making-http-requests/59237740#59237740", "title": "too many open files when making http requests", "body": "<p>You can use the following library:</p>\n\n<p><strong>Requests</strong>: <em>A Go library for reduce the headache when making HTTP requests (20k/s req)</em></p>\n\n<p><a href=\"https://github.com/alessiosavi/Requests\" rel=\"nofollow noreferrer\">https://github.com/alessiosavi/Requests</a></p>\n\n<p>The idea is to allocate a list of request, than send them with a configurable \"parallel\" factor that allow to run only \"N\" request at time. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// This array will contains the list of request\nvar reqs []requests.Request\n\n// N is the number of request to run in parallel, in order to avoid \"TO MANY OPEN FILES. N have to be lower than ulimit threshold\"\nvar N int = 12\n\n// Create the list of request\nfor i := 0; i &lt; 1000; i++ {\n    // In this case, we init 1000 request with same URL,METHOD,BODY,HEADERS \n    req, err := requests.InitRequest(\"https://127.0.0.1:5000\", \"GET\", nil, nil, true) \n    if err != nil {\n        // Request is not compliant, and will not be add to the list\n        log.Println(\"Skipping request [\", i, \"]. Error: \", err)\n    } else {\n        // If no error occurs, we can append the request created to the list of request that we need to send\n        reqs = append(reqs, *req)\n    }\n}\n</code></pre>\n\n<p>At this point, we have a list that contains the requests that have to be sent.\nLet's send them in parallel!</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// This array will contains the response from the givens request\nvar response []datastructure.Response\n\n// send the request using N request to send in parallel\nresponse = requests.ParallelRequest(reqs, N)\n\n// Print the response\nfor i := range response {\n    // Dump is a method that print every information related to the response\n    log.Println(\"Request [\", i, \"] -&gt; \", response[i].Dump())\n    // Or use the data present in the response\n    log.Println(\"Headers: \", response[i].Headers)\n    log.Println(\"Status code: \", response[i].StatusCode)\n    log.Println(\"Time elapsed: \", response[i].Time)\n    log.Println(\"Error: \", response[i].Error)\n    log.Println(\"Body: \", string(response[i].Body))\n}\n</code></pre>\n\n<p>You can find example usage into the example folder of the repository.</p>\n\n<p><strong><em>SPOILER</em></strong>:  </p>\n\n<blockquote class=\"spoiler\">\n  <p> <em>I'm the author of this little library</em>  </p>\n</blockquote>\n"}], "owner": {"reputation": 2312, "user_id": 317512, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/8c33f38cdc152bb55b69c9192e401733?s=128&d=identicon&r=PG", "display_name": "Bharat", "link": "https://stackoverflow.com/users/317512/bharat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2928, "favorite_count": 0, "accepted_answer_id": 31528314, "answer_count": 2, "score": 2, "last_activity_date": 1575824551, "creation_date": 1437434710, "question_id": 31527948, "link": "https://stackoverflow.com/questions/31527948/too-many-open-files-when-making-http-requests", "title": "too many open files when making http requests", "body": "<p>I am trying to create a http client program in go which would make many http GET requests. I am using a buffered channel to limit the number of concurrent requests. </p>\n\n<p>When I run the program I get </p>\n\n<p><code>Get http://198.18.96.213/: dial tcp 198.18.96.213:80: too many open files</code></p>\n\n<p>Here is my program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc HttpGets(numRequests int, numConcurrent int, url string) map[int]int {\n    // I want number of requests with each status code\n    responseStatuses := map[int]int {\n        100: 0, 101 : 0, 102 : 0, 200 : 0, 201 : 0, 202 : 0, 203 : 0, 204 : 0, 205 : 0, \n        206 : 0, 207 : 0, 208 : 0, 226 : 0, 300 : 0, 301 : 0, 302 : 0, 303 : 0, 304 : 0, \n        305 : 0, 306 : 0, 307 : 0, 308 : 0, 400 : 0, 401 : 0, 402 : 0, 403 : 0, 404 : 0, \n        405 : 0, 406 : 0, 407 : 0, 408 : 0, 409 : 0, 410 : 0, 411 : 0, 412 : 0, 413 : 0, \n        414 : 0, 415 : 0, 416 : 0, 417 : 0, 421 : 0, 422 : 0, 423 : 0, 424 : 0, 425 : 0, \n        426 : 0, 427 : 0, 428 : 0, 429 : 0, 430 : 0, 431 : 0, 500 : 0, 501 : 0, 502 : 0, \n        503 : 0, 504 : 0, 505 : 0, 506 : 0, 507 : 0, 508 : 0, 509 : 0, 510 : 0, 511 : 0, \n    }\n\n    reqsDone := 0\n    ch := make(chan *http.Response, numConcurrent)\n    for i := 0; i &lt; numRequests; i++ {\n        go func(url string) {\n            client := &amp;http.Client{}\n            req, reqErr := http.NewRequest(\"GET\", url, nil)\n            if reqErr != nil {\n                fmt.Println(reqErr)\n            }\n            // adding connection:close header hoping to get rid \n            // of too many files open error. Found this in http://craigwickesser.com/2015/01/golang-http-to-many-open-files/           \n            req.Header.Add(\"Connection\", \"close\") \n\n            resp, err := client.Do(req)\n            if (err !=nil) {\n                fmt.Println(err)\n            }\n            ch &lt;- resp\n\n        }(url)\n    }\n\n    for {\n        select {\n        case r := &lt;-ch:\n            reqsDone += 1 // probably needs a lock?\n            status := r.StatusCode          \n            if _, ok := responseStatuses[status]; ok {\n                responseStatuses[status] += 1           \n\n            } else {\n                responseStatuses[status] = 1\n            }\n            r.Body.Close() // trying to close body hoping to get rid of too many files open error \n            if (reqsDone == numRequests) {\n                return responseStatuses\n            }    \n        }\n    }\n    return responseStatuses\n}\n\nfunc main() {\n    var numRequests, numConcurrent = 500, 10\n    url := \"http://198.18.96.213/\"\n    beginTime := time.Now()\n    results := HttpGets(numRequests, numConcurrent, url)\n    endTime := time.Since(beginTime)\n    fmt.Printf(\"Total time elapsed: %s\\n\", endTime)\n    for k,v := range results {\n        if v!=0 {\n            fmt.Printf(\"%d : %d\\n\", k, v)\n        }       \n    }\n\n}\n</code></pre>\n\n<p>How to I ensure files/socets are closed so that I don't get this error when making multiple requests?</p>\n"}, {"tags": ["git", "go", "libgit2"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1437437096, "post_id": 31527908, "comment_id": 51017819, "body": "I don&#39;t know about that library but you&#39;re probably looking for something roughly equivalent to; foreach branch <code>git log | grep commit</code>. Since it&#39;s all in code probably, list branches, get the log for each, do a string.contains on the commit guid."}], "answers": [{"tags": [], "owner": {"reputation": 5037, "user_id": 1370215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e1295851b018af03706f391b76931?s=128&d=identicon&r=PG", "display_name": "Carlos Mart&#237;n Nieto", "link": "https://stackoverflow.com/users/1370215/carlos-mart%c3%adn-nieto"}, "is_accepted": true, "score": 1, "last_activity_date": 1438260040, "creation_date": 1438260040, "answer_id": 31724046, "question_id": 31527908, "link": "https://stackoverflow.com/questions/31527908/how-to-list-branches-that-contain-a-given-commit-in-git2go-libgit2/31724046#31724046", "title": "How to list branches that contain a given commit in git2go (libgit2)?", "body": "<p>The question here, graph-wise is \"how do I know if A is an ancestor of B?\" (repeated a few times for each branch which you want to be B). The only way to answer that is to walk down the history graph starting at B and check if you find A.</p>\n\n<p>You can do this in a few ways, but the most efficient is generally going to be to reduce the question to the equivalent \"is A a merge-base of A and B?\". You can ask this question in git2go via <code>Repository.MergeBase()</code>. This will return the best merge-base between the two commits you give it. In the case where you want one of the commits to be the merge base, this should always provide the right answer, even though it cuts the answer down to a single merge base.</p>\n"}], "owner": {"reputation": 1598, "user_id": 1104534, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad2bdd8c4d37364f52e6ab7aa92ef570?s=128&d=identicon&r=PG", "display_name": "Calin", "link": "https://stackoverflow.com/users/1104534/calin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 402, "favorite_count": 0, "accepted_answer_id": 31724046, "answer_count": 1, "score": 0, "last_activity_date": 1438260040, "creation_date": 1437434470, "last_edit_date": 1437753547, "question_id": 31527908, "link": "https://stackoverflow.com/questions/31527908/how-to-list-branches-that-contain-a-given-commit-in-git2go-libgit2", "title": "How to list branches that contain a given commit in git2go (libgit2)?", "body": "<p>Given a specific reference (a tag in this case) how can you list the branches that contain that commit in <a href=\"https://github.com/libgit2/git2go\" rel=\"nofollow\">git2go</a>? Similar to <code>git branch --contains &lt;commit&gt;</code>.</p>\n"}, {"tags": ["html", "templates", "go"], "comments": [{"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 0, "creation_date": 1437423479, "post_id": 31525535, "comment_id": 51012378, "body": "You definitely can use template conditions for that. See <a href=\"http://stackoverflow.com/questions/16985469/switch-or-if-elseif-else-inside-golang-html-templates\" title=\"switch or if elseif else inside golang html templates\">stackoverflow.com/questions/16985469/&hellip;</a>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1437423677, "post_id": 31525535, "comment_id": 51012505, "body": "If you&#39;re using templates; <a href=\"http://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template</a> then just make parts of them conditionally load. I&#39;m not too experienced with that package myself but it would be appalling if it didn&#39;t support such a simple set up. I recommend making your login bit it&#39;s own template so you can reference it repeatedly in these various locations rather than inlining it over and over."}, {"owner": {"reputation": 229, "user_id": 2593209, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/CybVs.jpg?s=128&g=1", "display_name": "calmandniceperson", "link": "https://stackoverflow.com/users/2593209/calmandniceperson"}, "reply_to_user": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 0, "creation_date": 1437425772, "post_id": 31525535, "comment_id": 51013579, "body": "@RoninDev,evanmcdonnal  Thank you for your answers and the helpful links :) I&#39;ll try to work with the template package of Go. I just wanted to see what other developers think about this. I also thought i was maybe taking a completely wrong approach."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1437435886, "post_id": 31525535, "comment_id": 51017447, "body": "Note: make sure to use <a href=\"http://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\">golang.org/pkg/html/template</a> and <i>not</i> text/template for a user-facing web application."}], "answers": [{"comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1437423604, "post_id": 31525592, "comment_id": 51012465, "body": "I disagree... If you want to hide the content behind a login you can&#39;t serve it to client then rely on their script to block it. All I have to do is open my developer tools and boom, there&#39;s your content I wasn&#39;t supposed to be looking at."}, {"owner": {"reputation": 1, "user_id": 5136505, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-q3E-2nPOiWs/AAAAAAAAAAI/AAAAAAAAAHI/SXBPBhIVYMc/photo.jpg?sz=128", "display_name": "sahil rana", "link": "https://stackoverflow.com/users/5136505/sahil-rana"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1437423948, "post_id": 31525592, "comment_id": 51012671, "body": "see the question first. he is just asking to hide few details,no the important ones and see everyone can disable javascript and still it is used very much . its ok to use where security is not an issue and i think here the user want to hide a login button from user once user is logged in. thats it .it much easier and  faster to do with js rather then doing with serverside coding which is also hackable ."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1437424966, "post_id": 31525592, "comment_id": 51013165, "body": "If you&#39;re using a templating product like ASP, JSP, go templates ect it is no  more code to do server side and no, it can&#39;t be &quot;hacked&quot; the page will be written differently before it&#39;s served so you couldn&#39;t re-expose the text on the client side as you could with javascript hiding. JS is also not faster, rewriting the DOM in JS is never faster than the token replacement that would occur in Go if you did it in your template. Doing it in JS is fine and not a big deal in most cases but definitely a hack and objectively worse for you applications security/consistency/performance ect."}, {"owner": {"reputation": 229, "user_id": 2593209, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/CybVs.jpg?s=128&g=1", "display_name": "calmandniceperson", "link": "https://stackoverflow.com/users/2593209/calmandniceperson"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1437425500, "post_id": 31525592, "comment_id": 51013444, "body": "@evanmcdonnal So you would recommend looking at the template package of Go for security/performance reasons? I already figured this would be a popular approach."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 229, "user_id": 2593209, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/CybVs.jpg?s=128&g=1", "display_name": "calmandniceperson", "link": "https://stackoverflow.com/users/2593209/calmandniceperson"}, "edited": false, "score": 1, "creation_date": 1437426158, "post_id": 31525592, "comment_id": 51013773, "body": "@mkocs I would say if you&#39;re making any kind of reasonable web app (like not a website I could make in a weekend) then you need to be using something like the templates package to serve content dynamically. If you&#39;re not using them to begin with then it might not be worth the effort. I would be personally using it for the sake of having a clean/well organized application and then as far as content hiding goes, it just makes more sense. I don&#39;t think it&#39;s really very important either way, I&#39;m just not going to go a route that I know is worse when it&#39;s no more work to do it better."}], "tags": [], "owner": {"reputation": 1, "user_id": 5136505, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-q3E-2nPOiWs/AAAAAAAAAAI/AAAAAAAAAHI/SXBPBhIVYMc/photo.jpg?sz=128", "display_name": "sahil rana", "link": "https://stackoverflow.com/users/5136505/sahil-rana"}, "is_accepted": false, "score": -1, "last_activity_date": 1437423529, "creation_date": 1437423529, "answer_id": 31525592, "question_id": 31525535, "link": "https://stackoverflow.com/questions/31525535/hide-html-content-if-a-user-is-logged-in/31525592#31525592", "title": "Hide HTML content if a user is logged in", "body": "<p>Simply start session on user login .Set the necessary values in session and then hide the html u want with if tag in javascript using  session. Its very simple and best way to solve this type of problems. </p>\n"}, {"comments": [{"owner": {"reputation": 139, "user_id": 4085881, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LyKKR.png?s=128&g=1", "display_name": "kittenparry", "link": "https://stackoverflow.com/users/4085881/kittenparry"}, "edited": false, "score": 0, "creation_date": 1437423935, "post_id": 31525673, "comment_id": 51012662, "body": "Oh, my ignorance of Go language. Sorry about that."}, {"owner": {"reputation": 229, "user_id": 2593209, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/CybVs.jpg?s=128&g=1", "display_name": "calmandniceperson", "link": "https://stackoverflow.com/users/2593209/calmandniceperson"}, "edited": false, "score": 1, "creation_date": 1437425361, "post_id": 31525673, "comment_id": 51013369, "body": "Thank you very much for taking the time to answer my question anyway :)"}], "tags": [], "owner": {"reputation": 139, "user_id": 4085881, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LyKKR.png?s=128&g=1", "display_name": "kittenparry", "link": "https://stackoverflow.com/users/4085881/kittenparry"}, "is_accepted": false, "score": -3, "last_activity_date": 1437423800, "creation_date": 1437423800, "answer_id": 31525673, "question_id": 31525535, "link": "https://stackoverflow.com/questions/31525535/hide-html-content-if-a-user-is-logged-in/31525673#31525673", "title": "Hide HTML content if a user is logged in", "body": "<p>You might try something like this </p>\n\n<pre><code>&lt;?php\n    if($_SESSION['user']){}else{\n        echo '&lt;button onclick=\"yourfunction();\"&gt;sign in&lt;/button&gt;';\n    }\n?&gt;\n</code></pre>\n\n<p>Thus, if they aren't logged in, this'll show up.</p>\n"}, {"comments": [{"owner": {"reputation": 229, "user_id": 2593209, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/CybVs.jpg?s=128&g=1", "display_name": "calmandniceperson", "link": "https://stackoverflow.com/users/2593209/calmandniceperson"}, "edited": false, "score": 0, "creation_date": 1437456785, "post_id": 31527618, "comment_id": 51022595, "body": "Great example! I just tried to do it the same way and it works perfectly. Thanks you!"}], "tags": [], "owner": {"reputation": 96, "user_id": 4123094, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Rx6JQDL7b8Y/AAAAAAAAAAI/AAAAAAAAAdQ/cYJh4FTQtGM/photo.jpg?sz=128", "display_name": "Guillaume Bailleul", "link": "https://stackoverflow.com/users/4123094/guillaume-bailleul"}, "is_accepted": true, "score": 3, "last_activity_date": 1437432675, "creation_date": 1437432675, "answer_id": 31527618, "question_id": 31525535, "link": "https://stackoverflow.com/questions/31525535/hide-html-content-if-a-user-is-logged-in/31527618#31527618", "title": "Hide HTML content if a user is logged in", "body": "<p>you just have to give a struct to your template and manage the rendering inside it.</p>\n\n<p>Here is a working exemple to test:</p>\n\n<pre><code>package main\n\nimport (\n    \"html/template\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", helloHandler)\n    http.ListenAndServe(\":8000\", nil)\n}\n\ntype User struct {\n    Name string\n}\n\nfunc helloHandler(w http.ResponseWriter, r *http.Request) {\n    t := template.New(\"logged exemple\")\n    t, _ = t.Parse(`\n        &lt;html&gt;\n        &lt;head&gt;\n            &lt;title&gt;Login test&lt;/title&gt;\n        &lt;/head&gt;\n        &lt;body&gt;\n\n        {{if .Logged}}\n            It's me {{ .User.Name }}\n        {{else}}\n            -- menu --\n        {{end}}\n\n\n        &lt;/body&gt;\n        &lt;/html&gt;\n    `)\n\n    // Put the login logic in a middleware\n    p := struct {\n        Logged bool\n        User   *User\n    }{\n        Logged: true,\n        User:   &amp;User{Name: \"Mario\"},\n    }\n\n    t.Execute(w, p)\n}\n</code></pre>\n\n<p>To manage the connexion you can use <a href=\"http://www.gorillatoolkit.org/pkg/sessions\" rel=\"nofollow\">http://www.gorillatoolkit.org/pkg/sessions</a> with <a href=\"https://github.com/codegangsta/negroni\" rel=\"nofollow\">https://github.com/codegangsta/negroni</a> and create the connection logic inside a middleware.</p>\n"}], "owner": {"reputation": 229, "user_id": 2593209, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/CybVs.jpg?s=128&g=1", "display_name": "calmandniceperson", "link": "https://stackoverflow.com/users/2593209/calmandniceperson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1514, "favorite_count": 1, "accepted_answer_id": 31527618, "answer_count": 3, "score": 3, "last_activity_date": 1437432675, "creation_date": 1437423299, "question_id": 31525535, "link": "https://stackoverflow.com/questions/31525535/hide-html-content-if-a-user-is-logged-in", "title": "Hide HTML content if a user is logged in", "body": "<p>I'm writing a web server in Go and was asking myself, what the conventional way of conditionally hiding a part of an HTML page is.\nIf I wanted a \"sign in\" button only to show up, when the user is NOT logged in, how would I achieve something like this?\nIs it achieved with template engines or something else?</p>\n\n<p>Thank you for taking the time to read and answer this :)</p>\n"}, {"tags": ["arrays", "input", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437422058, "post_id": 31525175, "comment_id": 51011543, "body": "An array&#39;s size must be a constant. You have to use a slice."}, {"owner": {"reputation": 930, "user_id": 3713926, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4644674624a85763e1932e6058fc2be1?s=128&d=identicon&r=PG&f=1", "display_name": "Akiiino", "link": "https://stackoverflow.com/users/3713926/akiiino"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437422249, "post_id": 31525175, "comment_id": 51011650, "body": "@JimB, no, you misunderstood. I don&#39;t want to change the size of an array; I just want to create one with size chosen by user"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1437422345, "post_id": 31525175, "comment_id": 51011715, "body": "Yes, I understand. It doesn&#39;t matter if you want to change the size or not, the value must be a <a href=\"http://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">constant value</a>."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1437422441, "post_id": 31525175, "comment_id": 51011769, "body": "JimB is not saying &quot;change the size&quot; he&#39;s noting the difference between  the size being available at the time you compile the application vs input at runtime. As far as the runtimes concerned you are &quot;changing the size&quot; when the application executes that line of code."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1437422463, "post_id": 31525175, "comment_id": 51011784, "body": "I&#39;d recommend reading <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">The Go Blog - Arrays, slices (and strings)</a>."}], "answers": [{"comments": [{"owner": {"reputation": 930, "user_id": 3713926, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4644674624a85763e1932e6058fc2be1?s=128&d=identicon&r=PG&f=1", "display_name": "Akiiino", "link": "https://stackoverflow.com/users/3713926/akiiino"}, "edited": false, "score": 0, "creation_date": 1437422650, "post_id": 31525194, "comment_id": 51011870, "body": "Works like a charm. Thank you! I&#39;ll mark as accepted as soon as possible"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 0, "last_activity_date": 1437422058, "creation_date": 1437422058, "answer_id": 31525194, "question_id": 31525175, "link": "https://stackoverflow.com/questions/31525175/array-with-size-from-user-input/31525194#31525194", "title": "Array with size from user input", "body": "<p>I think you're looking for;</p>\n\n<pre><code>grid := make([][]int, sizex)\nfor i := 0; i &lt; len(grid) i++ {\n     grid[i] = make([]int, sizey)\n}\n</code></pre>\n\n<p>This is sort of like using the <code>new</code> keyword in C++ verse regular \"on the stack\" allocation. To use the declaration in your question the size args would have to be values known at compile time.</p>\n\n<p>In the example above <code>make</code> only applies to the first dimension, giving me an array of <code>[]int</code> arrays, however, none of those arrays have been initialized so I have to iterate over grid and call make with the <code>sizey</code> to get the second dimension allocated.</p>\n"}], "owner": {"reputation": 930, "user_id": 3713926, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4644674624a85763e1932e6058fc2be1?s=128&d=identicon&r=PG&f=1", "display_name": "Akiiino", "link": "https://stackoverflow.com/users/3713926/akiiino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1036, "favorite_count": 0, "closed_date": 1437516528, "accepted_answer_id": 31525194, "answer_count": 1, "score": -2, "last_activity_date": 1437422058, "creation_date": 1437421981, "question_id": 31525175, "link": "https://stackoverflow.com/questions/31525175/array-with-size-from-user-input", "closed_reason": "Duplicate", "title": "Array with size from user input", "body": "<p>I have this bit of code:</p>\n\n<pre><code>fmt.Scanf(\"%dx%d\", &amp;sizex, &amp;sizey)  \nvar grid [sizex][sizey]int\n</code></pre>\n\n<p>I'm currently getting the \"non-constant array bound sizex\" error. How can I create array with dimensions chosen by user? Of course, I don't want to modify its size later, but I obviously can't use constants.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1437406757, "post_id": 31520167, "comment_id": 51002498, "body": "Is the <code>index</code> your application&#39;s name? The compiled Go executable is normally just a regular executable that reads/writes to stdin/stdout, opens sockets, etc."}, {"owner": {"reputation": 5089, "user_id": 2650277, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/6d7f954b8221b1affc0886a8900d53e9?s=128&d=identicon&r=PG", "display_name": "user2650277", "link": "https://stackoverflow.com/users/2650277/user2650277"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1437411237, "post_id": 31520167, "comment_id": 51005235, "body": "@AlexAtNet yes my app is named index.go"}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 3, "creation_date": 1437418938, "post_id": 31520167, "comment_id": 51009731, "body": "<code>index</code> is running in the foreground, <code>Ctrl+C</code> sends a SIGINT to <code>index</code> shutting down the process."}, {"owner": {"reputation": 81, "user_id": 4257253, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/23SFY.png?s=128&g=1", "display_name": "bluehexagons", "link": "https://stackoverflow.com/users/4257253/bluehexagons"}, "edited": false, "score": 1, "creation_date": 1437425066, "post_id": 31520167, "comment_id": 51013211, "body": "If that explanation doesn&#39;t help you enough, Go&#39;s http package starts a web server process. Your &quot;index&quot; file is an executable by itself, index.go isn&#39;t run by an interpreter or managed by a service like Apache or nginx. If you&#39;re looking for a way to make it run as a service, it&#39;s a bit more complicated and depends on your OS (and is more to do with systems administration than programming in Go). You could use <code>ctrl+z</code> to send the process to the background (<code>fg</code> brings it back), but the process will still be tied to your current session."}], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 3, "creation_date": 1437436200, "post_id": 31526040, "comment_id": 51017538, "body": "Note that if you <code>nohup</code> the process it will run &quot;indefinitely&quot; until you call <code>kill &lt;PID&gt;</code> on it. Further, if it binds to a HTTP port you&#39;ll need to remember to kill the running process else your new/rebuilt process won&#39;t be able to bind. Using something simple like Supervisor (<a href=\"https://elithrar.github.io/article/running-go-applications-in-the-background/\" rel=\"nofollow noreferrer\">guide here</a>) or daemontools is a more sane way to run manage processes."}, {"owner": {"reputation": 5089, "user_id": 2650277, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/6d7f954b8221b1affc0886a8900d53e9?s=128&d=identicon&r=PG", "display_name": "user2650277", "link": "https://stackoverflow.com/users/2650277/user2650277"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1437458401, "post_id": 31526040, "comment_id": 51023165, "body": "@elithrar that&#39;s exactly what i needed .Thank you for your guide and kindly post  the above as an answer to my question so that i can accept it"}], "tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": false, "score": 1, "last_activity_date": 1437425760, "last_edit_date": 1437425760, "creation_date": 1437425214, "answer_id": 31526040, "question_id": 31520167, "link": "https://stackoverflow.com/questions/31520167/building-go-app/31526040#31526040", "title": "Building Go app", "body": "<p>You can use <a href=\"https://en.wikipedia.org/wiki/Nohup\" rel=\"nofollow\">nohup</a> for that like this:</p>\n\n<p><code>nohup ./index &amp;</code></p>\n\n<p><code>nohup</code> used to prevent termination of the process after user logout and <code>&amp;</code> used to start process in background.\nAfter it you can exit from console.</p>\n"}, {"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 0, "last_activity_date": 1437519666, "creation_date": 1437519666, "answer_id": 31551097, "question_id": 31520167, "link": "https://stackoverflow.com/questions/31520167/building-go-app/31551097#31551097", "title": "Building Go app", "body": "<p>Note that if you <code>nohup</code> the process it will run \"indefinitely\" until you call <code>kill &lt;PID&gt;</code> on it. Further, if it binds to a HTTP port you'll need to remember to kill the running process else your new/rebuilt process won't be able to bind.</p>\n\n<p>Using something simple like Supervisor (<a href=\"http://elithrar.github.io/article/running-go-applications-in-the-background/\" rel=\"nofollow\">guide here</a>) or daemontools is a more sane way to run manage processes. Here's a quick Supervisor config for a Go application:</p>\n\n<pre><code>[program:index]\ncommand=/home/yourappuser/bin/index\nautostart=true\nautorestart=true\nstartretries=10\n# the user your app should run as (i.e. *not* root!)\nuser=yourappuser\n# where your application runs from\ndirectory=/srv/www/yourapp.com/\n# environmental variables\nenvironment=APP_SETTINGS=\"/srv/www/yourapp.com/prod.env\"\nredirect_stderr=true\n# the name of the log file.\nstdout_logfile=/var/log/supervisor/yourapp.log\nstdout_logfile_maxbytes=50MB\nstdout_logfile_backups=10\n</code></pre>\n\n<p>This will work if your Go application doesn't need to bind to port 80. If it does, use <code>setcap</code> (and never run your application as root) with <code>setcap cap_net_bind_service=+ep /home/yourappuser/bin/index</code>.</p>\n"}], "owner": {"reputation": 5089, "user_id": 2650277, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/6d7f954b8221b1affc0886a8900d53e9?s=128&d=identicon&r=PG", "display_name": "user2650277", "link": "https://stackoverflow.com/users/2650277/user2650277"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 31551097, "answer_count": 2, "score": -4, "last_activity_date": 1437519666, "creation_date": 1437405272, "question_id": 31520167, "link": "https://stackoverflow.com/questions/31520167/building-go-app", "title": "Building Go app", "body": "<p>I just started learning golang and I want tried to build a hello world webpage  as per <a href=\"http://mwholt.blogspot.com/2013/05/writing-go-golang-web-app-with-nginx.html\" rel=\"nofollow noreferrer\">here</a>.However when I use <code>run</code> or <code>build</code> via SSH i don't \"regain\" control of the prompt.</p>\n\n<p><img src=\"https://i.stack.imgur.com/sGdD8.png\" alt=\"enter image description here\">   </p>\n\n<p>If I do <code>Ctrl + C</code> , my app no longer work , I think i am misunderstanding how Go work </p>\n"}, {"tags": ["http", "go", "proxy"], "answers": [{"comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1437404426, "post_id": 31519745, "comment_id": 51000871, "body": "I guess it&#39;s <code>NopCloser</code> with a single o."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 4, "last_activity_date": 1437420986, "last_edit_date": 1437420986, "creation_date": 1437404233, "answer_id": 31519745, "question_id": 31519365, "link": "https://stackoverflow.com/questions/31519365/reading-a-buffer-and-rewriting-it-to-a-http-response-in-go/31519745#31519745", "title": "Reading a Buffer and Rewriting it to a http.Response in Go", "body": "<p>You're going to have to read <em>all</em> of the body first, so you can properly close it. Once you have the entire body read, you can simply replace the <code>Response.Body</code> with your buffer. </p>\n\n<pre><code>readBody, err := ioutil.ReadAll(resp.Body)\nif err != nil {\n    // handle error\n}\nresp.Body.Close()\n// use readBody\n\nresp.Body = ioutil.NopCloser(bytes.NewReader(readBody))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 2, "last_activity_date": 1437411205, "creation_date": 1437411205, "answer_id": 31522062, "question_id": 31519365, "link": "https://stackoverflow.com/questions/31519365/reading-a-buffer-and-rewriting-it-to-a-http-response-in-go/31522062#31522062", "title": "Reading a Buffer and Rewriting it to a http.Response in Go", "body": "<p>That's because the <code>io.Reader</code> acts more as a buffer, when you read it, you've consumed that data in the buffer and are left with an empty body. To solve that problem you just need to close the responses body and create a new <code>ReadCloser</code> out of the body which is now a string.</p>\n\n<pre><code>import \"io/ioutil\"\n\nreadBody, err := ioutil.ReadAll(resp.Body)\n\nif err != nil {\n     // \n}\n\nresp.Body.Close()\nresp.Body = ioutil.NopCloser(bytes.NewReader(readBody))\n</code></pre>\n"}], "owner": {"reputation": 118, "user_id": 4543065, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/9b010767e27b2824d75b978245d530ea?s=128&d=identicon&r=PG&f=1", "display_name": "Max Rumpf", "link": "https://stackoverflow.com/users/4543065/max-rumpf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1316, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1437420986, "creation_date": 1437403163, "question_id": 31519365, "link": "https://stackoverflow.com/questions/31519365/reading-a-buffer-and-rewriting-it-to-a-http-response-in-go", "title": "Reading a Buffer and Rewriting it to a http.Response in Go", "body": "<p>I want to program a HTTP-Proxy in golang. I use this module for the proxy: <a href=\"https://github.com/elazarl/goproxy\" rel=\"nofollow\">https://github.com/elazarl/goproxy</a>. When someone uses my proxy, it calls a function with an http.Response as an Input. Let's call it \"resp\". resp.Body is an io.ReadCloser. I can read from it into a []byte array by using it's Read Method. But then the contents of it are gone from the resp.Body. But I have to return an http.Response with the Body that I read into a []byte array. How can I do that?</p>\n\n<p>Greetings, </p>\n\n<p>Max</p>\n\n<p>My Code:</p>\n\n<pre><code>proxy.OnResponse().DoFunc(func(resp *http.Response, ctx *goproxy.ProxyCtx) *http.Response {\n\n   body := resp.Body\n   var readBody []byte\n   nread, readerr := body.Read(readBody)\n   //the body is now empty\n   //and i have to return a body\n   //with the contents i read.\n   //how can i do that?\n   //doing return resp gives a Response with an empty body\n}\n</code></pre>\n"}, {"tags": ["api", "authentication", "oauth", "go", "architecture"], "answers": [{"comments": [{"owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437401550, "post_id": 31518657, "comment_id": 50998617, "body": "Hi. Thanks for your answer. My question is how do I trust the web server. How does it authenticate itself to the API. I&#39;m not sure I understand what you mean by &quot;trusted subsystem model&quot;. Could you please explain in a bit more depth? Is my solution a bit impractical as you say but still safe?"}, {"owner": {"reputation": 2281, "user_id": 2778089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7OqZN.jpg?s=128&g=1", "display_name": "BhavO", "link": "https://stackoverflow.com/users/2778089/bhavo"}, "reply_to_user": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437401778, "post_id": 31518657, "comment_id": 50998752, "body": "With trusted subsys model The web server is treated as a super user and given an account to use the api, the web server is then responsible for given access to the end users as appropriate."}, {"owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437401915, "post_id": 31518657, "comment_id": 50998865, "body": "So basically what I&#39;ve painted in my diagram?"}, {"owner": {"reputation": 2281, "user_id": 2778089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7OqZN.jpg?s=128&g=1", "display_name": "BhavO", "link": "https://stackoverflow.com/users/2778089/bhavo"}, "reply_to_user": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 1, "creation_date": 1437402183, "post_id": 31518657, "comment_id": 50999088, "body": "Yes exactly, however one disadvantage of the TSM model if the web server is compromised the end user could have direct api in a bad way. Delegation model is more inline with a defense in depth approach where each layer is authenticating each request from its source user"}, {"owner": {"reputation": 2281, "user_id": 2778089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7OqZN.jpg?s=128&g=1", "display_name": "BhavO", "link": "https://stackoverflow.com/users/2778089/bhavo"}, "reply_to_user": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437402445, "post_id": 31518657, "comment_id": 50999301, "body": "The way you propose is totally valid, as long as your web app is robust and fails safe, remember to keep the vulnerabilities in mind."}, {"owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437402616, "post_id": 31518657, "comment_id": 50999421, "body": "Okay. :) So to make sure that I understand the delegation model. If I choose to use the delegation model I would have OAuth both between my web server and the client(web browser) AND between my API and the web server?"}, {"owner": {"reputation": 2281, "user_id": 2778089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7OqZN.jpg?s=128&g=1", "display_name": "BhavO", "link": "https://stackoverflow.com/users/2778089/bhavo"}, "reply_to_user": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437403001, "post_id": 31518657, "comment_id": 50999734, "body": "Oauth is a authorization technology which can be to get way with authentication, take a look at <a href=\"http://oauth.net/articles/authentication\" rel=\"nofollow noreferrer\">oauth.net/articles/authentication</a>, to understand it, You could use openid or openid connect instead which is oauth 2 with authentication. :)"}], "tags": [], "owner": {"reputation": 2281, "user_id": 2778089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7OqZN.jpg?s=128&g=1", "display_name": "BhavO", "link": "https://stackoverflow.com/users/2778089/bhavo"}, "is_accepted": true, "score": 2, "last_activity_date": 1437401671, "last_edit_date": 1437401671, "creation_date": 1437401208, "answer_id": 31518657, "question_id": 31518501, "link": "https://stackoverflow.com/questions/31518501/api-authentication-design/31518657#31518657", "title": "API authentication design", "body": "<p>Two common approached to tacking the problem:</p>\n\n<p><strong>Trusted subsystem model vs Delegation model</strong></p>\n\n<p><strong>Trusted subsystem</strong></p>\n\n<p>Use a trusted subsystem model, it maybe impractical to maintain a separate key and secret for every user of the front end, the trusted subsystem model basically states that a system (web server) with authority to an api is responsible or trusted to authenticate/authorise users access to that api, and is given authority to do so.</p>\n\n<p>What you do is provision a account for the web server, and allow the web server to authorize access to the api.</p>\n\n<p><strong>Delegation model</strong></p>\n\n<p>If you have control over how the api authenticates you can use the same method as the frontend and reuse the end users security principal to authenticate to the back end api.</p>\n"}], "owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 1, "accepted_answer_id": 31518657, "answer_count": 1, "score": 1, "last_activity_date": 1437401671, "creation_date": 1437400822, "question_id": 31518501, "link": "https://stackoverflow.com/questions/31518501/api-authentication-design", "title": "API authentication design", "body": "<p>I'm planning on building a web service consisting of two servers - an API backend (RESTful &amp; stateless) and a web server frontend. The backend will be build with Go and the web server with PHP or Java. </p>\n\n<p>Basically I'd like multiple users to log in with their web browsers through the use of their facebook or google credentials which I understand I must use OAuth for. </p>\n\n<p>I'm however deeply confused about how I should design the authentication. \nCan I simply implement OAuth on the webserver alone and then use an API-key/secret to validate the webserver with my API and communicate over an encrypted connection between the two of them. Would that be secure and work just fine or should I implement authentication in some other way? </p>\n\n<p>I've made a simple diregram showing my idea of how this could be done. </p>\n\n<p><img src=\"https://i.stack.imgur.com/yVXtj.png\" alt=\"Authentication diagram\"></p>\n\n<p>I really hope that you guys can point me in the right direction.</p>\n"}, {"tags": ["regex", "go"], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 3151724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/509bf4117075d202ae3a31696f1c8d3f?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Gatu", "link": "https://stackoverflow.com/users/3151724/gabriel-gatu"}, "edited": false, "score": 0, "creation_date": 1437400379, "post_id": 31518252, "comment_id": 50997759, "body": "Thank you so much! Resolved ! The problem was that I continued to use the &#39; char thinking that was equal to the ` one. (Italian keyboard...)"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 3, "last_activity_date": 1437400146, "creation_date": 1437400146, "answer_id": 31518252, "question_id": 31518130, "link": "https://stackoverflow.com/questions/31518130/go-lang-error-using-regex/31518252#31518252", "title": "Go-lang Error using regex", "body": "<p>It's much easier if you just use a raw string literal for regexes, rather than trying to double escape reserved characters. This will compile correctly, and work the same as the fiddle.re example you posted:</p>\n\n<pre><code>re := regexp.MustCompile(`\\[(.*?)\\]`)\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 3151724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/509bf4117075d202ae3a31696f1c8d3f?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Gatu", "link": "https://stackoverflow.com/users/3151724/gabriel-gatu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1437400149, "creation_date": 1437399845, "last_edit_date": 1437400149, "question_id": 31518130, "link": "https://stackoverflow.com/questions/31518130/go-lang-error-using-regex", "title": "Go-lang Error using regex", "body": "<p>I have a little problem with a regex using the \"regexp\" package in go.</p>\n\n<p>This regex should return to me the substring inside the brackets \"[]\"</p>\n\n<p><code>\\[(.*?)\\]</code> used on <code>@class my-div [button] {</code> should return <code>[ button, hello ]</code></p>\n\n<p>So, in Go I tried something like:</p>\n\n<pre><code>re := regexp.MustCompile('\\[(.*?)\\]')\n\nfmt.Println(re.MatchString(header)) // false\n\nreturn re.FindString(header) // header = \"@class my-div [button] {\"\n</code></pre>\n\n<p>And also:</p>\n\n<pre><code>re := regexp.QuoteMeta(\"\\\\\\[\\(\\.\\*\\?\\)\\\\\\]\") // &lt;= Changed\n\nfmt.Println(re.MatchString(header)) // false\n\nreturn re.FindString(header) // header = \"@class my-div [button] {\"\n</code></pre>\n\n<p>And many other variants, but still doesn't work...</p>\n\n<p>I also tried to use an online regex tester for go, and it works perfectly, so I really don't understand why it doesn't work in go....\n<a href=\"http://fiddle.re/57y4c6\" rel=\"nofollow\">http://fiddle.re/57y4c6</a></p>\n\n<p>Playground: <a href=\"http://play.golang.org/p/Z_-1EEKgaW\" rel=\"nofollow\">http://play.golang.org/p/Z_-1EEKgaW</a></p>\n\n<p>Help me please and Thank You for your time!</p>\n"}, {"tags": ["macos", "go", "sublimetext2", "gosublime"], "answers": [{"comments": [{"owner": {"reputation": 5291, "user_id": 2852424, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/AIdLu.png?s=128&g=1", "display_name": "Thibaud Clement", "link": "https://stackoverflow.com/users/2852424/thibaud-clement"}, "edited": false, "score": 0, "creation_date": 1437396490, "post_id": 31516897, "comment_id": 50994925, "body": "Perfect, it fixed the problem. Thank you very much."}, {"owner": {"reputation": 8157, "user_id": 978502, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ljiCK.png?s=128&g=1", "display_name": "yair", "link": "https://stackoverflow.com/users/978502/yair"}, "edited": false, "score": 0, "creation_date": 1448316470, "post_id": 31516897, "comment_id": 55527701, "body": "this actually helped me with setting PATH for node.js :) Thanks!"}], "tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": true, "score": 15, "last_activity_date": 1437396618, "last_edit_date": 1437396618, "creation_date": 1437396328, "answer_id": 31516897, "question_id": 31516808, "link": "https://stackoverflow.com/questions/31516808/sublime-text-margo-missing-required-environment-variables-gopath/31516897#31516897", "title": "Sublime Text: &quot;MarGo: Missing required environment variables: GOPATH&quot;", "body": "<p>You need to set gopath in the GoSublime settings.\nGo to: </p>\n\n<pre><code>Preferences -&gt; Package Settings -&gt; GoSublime -&gt; Settings \u2013 User\n</code></pre>\n\n<p>And paste that code there:</p>\n\n<pre><code>{\n    \"env\": {\n        \"GOPATH\": \"$HOME/code/go\"\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 5291, "user_id": 2852424, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/AIdLu.png?s=128&g=1", "display_name": "Thibaud Clement", "link": "https://stackoverflow.com/users/2852424/thibaud-clement"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2579, "favorite_count": 0, "accepted_answer_id": 31516897, "answer_count": 1, "score": 2, "last_activity_date": 1437396618, "creation_date": 1437396087, "question_id": 31516808, "link": "https://stackoverflow.com/questions/31516808/sublime-text-margo-missing-required-environment-variables-gopath", "title": "Sublime Text: &quot;MarGo: Missing required environment variables: GOPATH&quot;", "body": "<p>In order to program with Golang in a more productive way, I just installed GoSublime for Sublime Text 2, as explained on their <a href=\"https://github.com/DisposaBoy/GoSublime#installation\" rel=\"nofollow\">official GitHub repository</a>:</p>\n\n<blockquote>\n  <p><strong>Installation</strong></p>\n  \n  <p>Sublime Package Control allows you to easily install or remove\n  GoSublime (and many other ST2 packages) from within the editor. It\n  offers automatically updating packages as well so you no longer need\n  to keep track of changes in GoSublime.</p>\n  \n  <ol>\n  <li><p>Install Sublime Package Control (if you haven't done so already) from\n  <a href=\"http://wbond.net/sublime_packages/package_control\" rel=\"nofollow\">http://wbond.net/sublime_packages/package_control</a> .</p></li>\n  <li><p>Be sure to restart\n  ST2 to complete the installation.</p></li>\n  </ol>\n  \n  <p>Bring up the command palette (default <code>ctrl+shift+p</code> or <code>cmd+shift+p</code>) and\n  start typing <code>Package Control: Install Package</code> then press return or\n  click on that option to activate it. You will be presented with a new\n  Quick Panel with the list of available packages. Type <code>GoSublime</code> and\n  press return or on its entry to install GoSublime. If there is no\n  entry for GoSublime, you most likely already have it installed.</p>\n</blockquote>\n\n<p>Now, whenever I launch Sublime Text, I have the following error message:</p>\n\n<pre><code>MarGo: Missing required environment variables: GOPATH\nSee the `Quirks` section of USAGE.md for info \n</code></pre>\n\n<p>And a <code>usage.md</code> file opens automatically, with the following content:</p>\n\n<pre><code>Usage\n=====\n\nNote\n----\n\n* Unless otherwise mentioned, `super` replaces `ctrl` in key bindings on OS X.\n* A mention of a (GO)PATH variable uses a colon(`:`) as the separator.\nThis is the PATH separator on Linux and OS X, Windows uses a semi-colon(`;`)\n\nSettings\n--------\n\nYou may customize GoSublime's behaviour by (creating and) customizing the file `Packages/User/GoSublime.sublime-settings`. Default settings are documented in `Packages/GoSublime/GoSublime.sublime-settings`. **WARNING** Do not edit any package file outside of `Packages/User/`, including files inside `Packages/GoSublime/` unless you have a reason to. These files are subject to being overwritten on update of the respective package and/or Sublime Text itself. You may also inadvertently prevent the respective package from being able to update via git etc.\n\nQuirks\n------\n\nThis section assumes you know what `GOPATH` is and how to set it. If you don't, please see http://golang.org/doc/code.html\n\nIn some systems, environment variables are not passed around as expected.\nThe result of which is that some commands e.g `go build` don't work\nas the command cannot be found or `GOPATH` is not set. To get around this\nthe simplest thing to do is to set these variables in the settings file.\nSee the documentation for the `env` and/or `shell` setting, both documented in the default\nsettings file `Packages/User/GoSublime.sublime-settings`\n\nCode Completion\n---------------\n\nCompletion can be accessed by typing the (default) key combination `CTRL+[SPACE]` inside a Golang file.\n\nKey Bindings\n------------\n\nBy default, a number of key bindings are provided. They can be viewed by opening the command palette\nand typing `GoSublime:` or via the key binding `ctrl+dot`,`ctrl+dot` (or `super+dot`,`super+dot` on OS X).\nWherever I refer to a key binding with `ctrl+` it is by default defined as `super+` on OS X unless stated otherwise.\n\nUseful Key Bindings\n-------------------\n\nOften when commenting out a line, the immediate action following this is to move the cursor to the next line either to continue working or comment out the following line.\n\nWith this key binding, you can have the line commented out and the cursor automatically moved to the next line.\n\n{ \"keys\": [\"ctrl+/\"], \"command\": \"gs_comment_forward\", \"context\": [{ \"key\": \"selector\", \"operator\": \"equal\", \"operand\": \"source.go\" }] },\n\nPackage Imports\n---------------\n\nPressing `ctrl+dot`,`ctrl+p` will open the package list from which you can quickly import or delete a package import.\nThe usage is the same for both operations. If the package is already imported then it will appear near the top\nand be marked as a *delete* operation, so in effect it is a toggle. If you want to edit the alias of a package e.g\na database driver: first import the package as normal and then press `ctrl+dot`,`ctrl+i` to quickly jump\nthe last imported package. Once edited you can return to where you were by pressing `ctrl+dot`,`ctrl+[`\n\nBuilding, Testing and the Go command\n------------------------------------\n\nGoSublime comes with partial command/shell integration `9o`. For more information about 9o, see Packages/GoSublime/9o.md\nor from within Sublime Text press `ctrl+9` or `super+9` and type `help`.\n\nTo run package tests you have 3 options.\n\n* press `ctrl+dot`,`ctrl+t` to open the testing quick panel. This offers basic/common options such\nas running all benchmark functions or running a single test function.\n\n* inside a `_test.go` file, press `ctrl+shift` and left-click on the name of a Test, Benchmark or Example\nfunction e.g. `TestAbc` to execute that function only.\n\n* if the above options are too minimalistic or you would otherwise like to call `go test` with your own options,\nopen 9o by pressing `ctrl+9` where you have access to the `go` command.\n\nIn the case of building a package, 9o provides a replay command (see 9o.md for details) that will execute\nthe command if the pkg is a command pkg (package main) or run all tests if it's a normal pkg.\nThe replay command is bound to `ctrl+dot`,`ctrl+r` for easy access.\n\nGoSublime provides an override for the Sublime Text build-system via `ctrl+b`. In the menu `Tools &gt; Build System` it's named `GoSublime`.\n`ctrl+b` is automatically handled by Sublime Text, so if you have another `Go` build system chosen, `ctrl+b`\nwill execute that instead. To access the `GoSublime` build system directly press `ctrl+dot`,`ctrl+b`.\nThis build system simply opens 9o and expand the last command. i.e. executes the 9o command `^1`.\n\nPer-project Settings &amp; Project-based GOPATH\n-------------------------------------------\n\nIf you have a settings object called `GoSublime` in your project settings its values will override those\ninside the `GoSublime.sublime-settings` file. As a side-effect you may set a specific GOPATH for a single\nproject.\n\n`my-project.sublime-project`\n\n    {\n        \"settings\": {\n            \"GoSublime\": {\n                \"env\": {\n                    \"GOPATH\": \"$HOME/my-project\"\n                }\n            }\n        },\n        \"folders\": []\n    }\n\nIf the only setting you use this functionality to change is the GOPATH, then you may be able to find\nsuccess by adding the string `$GS_GOPATH` to your global `GOPATH` setting e.g.\n\n    {\n        \"env\": { \"GOPATH\": \"$HOME/go:$GS_GOPATH\" }\n    }\n\n\n`GS_GOPATH` is a pseudo-environment-variable. It's changed to match a possible GOPATH based on:\n\n* the current working directory, e.g. `~/go/src/pkg` then `$GS_GOPATH` will be `~/go/`\n\n* or the path the current `.go` file (or last activated `.go` file if the current file is not `.go`) e.g. if your file path is `/tmp/go/src/hello/main.go` then it will be `/tmp/go`\n\nIf you would like to use `GS_GOPATH` exclusively, you may set the option `use_gs_gopath` to true.\nThis automatically changes `GOPATH` to the value of `$GS_GOPATH` if `$GS_GOPATH` is not empty.\nThis allows you to e.g. automatically adapt `GOPATH` to your current project rather than\nreverting to your normal `GOPATH`.\n\nLint/Syntax Check\n-----------------\n\nThe source is continuously scanned for syntax errors. GoSublime will try to catch some common errors, like\nforgetting to call flag.Parse (if this causes false positives, please file a bug report).\n\nApart from the highlighting in the view using a dot icon in the gutter and usually underlining the\nfirst character of an error region. You are given an entry in the status bar in the form: `GsLint (N)`\nwhere `N` is the number of errors found in that file. You can show the list of errors and navigate to\nthem by pressing `ctrl+dot`,`ctrl+e`. Errors for the current line are shown in the status bar.\n\nFmt\n---\n\nBy default `ctrl+s` and `ctrl+shift+s` are overridden to fmt the the file before saving it. You may also\nfmt a file without saving it by pressing `ctrl+dot`,`ctrl+f`\n\nGodoc/Goto Definition\n---------------------\n\nTo show the source and associated comments(documentation) of a variable press `ctrl+dot`,`ctrl+h` or\nusing the mouse `ctrl+shift+right-click`. This will show an output panel that presents the full\ndefinition of the variable or function under the (first) cursor along with its comments.\nTo goto the definition instead, press `ctrl+dot`,`ctrl+g` or alternatively using the mouse `ctrl+shift+left-click`.\n\nDeclarations/Code Outline?\n--------------------------\n\nA very minimal form of code outline is provided. You can press `ctrl+dot`,`ctrl+d` to list all the declarations\nin the current file.\n\nNew File\n--------\n\nPressing `ctrl+dot`,`ctrl+n` will create a new Go file with the package declaration filled out.\nIt will try to be intelligent about it, so if the current directory contains package `mypkg` it will use that as the package name.\n\nMisc. Helper Commands\n---------------------\n\nThe following commands can be assigned key bindings to further improve your editing experience.\n\n* gs_fmt - this command runs `gofmt` on the current buffer. Also available via the key binding `ctrl+dot`,`ctrl+f`.\n\n* gs_fmt_save, gs_fmt_prompt_save_as - these commands will run the `go_fmt` followed by `save` or `prompt_save_as` - these are bound to `ctrl+s` and `ctrl+shift+s` respectively, by default.\n\n* gs_comment_forward - this command will activate the `ctrl+/` commenting and move the cursor to the next line, allowing you to comment/uncomment multiple lines in sequence without breaking to move the cursor. You can replace the default behaviour by overriding it in your user key bindings (Preferences &gt; Key Bindings - User) with `{ \"keys\": [\"ctrl+/\"], \"command\": \"gs_comment_forward\", \"context\": [{ \"key\": \"selector\", \"operator\": \"equal\", \"operand\": \"source.go\" }] }`\n</code></pre>\n\n<p>Some people seem to have had the same issue:</p>\n\n<ol>\n<li><a href=\"https://github.com/DisposaBoy/GoSublime/issues/310\" rel=\"nofollow\">Idiotproof instructions for MarGo: Missing required environment variables: GOPATH #310</a></li>\n<li><a href=\"https://github.com/DisposaBoy/GoSublime/issues/601\" rel=\"nofollow\">How come USAGE.MD opens everytime I open Sublime? #601</a></li>\n<li><a href=\"https://github.com/DisposaBoy/GoSublime/issues/520\" rel=\"nofollow\">gopath is set, but still show \"MarGo: Missing required environment variables: GOPATH\" #520</a></li>\n</ol>\n\n<p>And the root cause of the problem could be that the GOPATH has not been defined.</p>\n\n<p>Mine has been \u2014 <code>export GOPATH=$HOME/code/go</code>\u00a0\u2014 and I am able to run Go (and .go files) on my computer.</p>\n\n<p>Any idea of how this can be fixed?</p>\n"}, {"tags": ["html", "go", "goquery"], "comments": [{"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 1, "creation_date": 1437389155, "post_id": 31514414, "comment_id": 50990284, "body": "Maybe you just need to use <code>regexp</code> to extract your data?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1437389160, "post_id": 31514414, "comment_id": 50990288, "body": "Can you give an example of how that HTML looks?"}, {"owner": {"reputation": 232, "user_id": 4999035, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/9d76a1cd7adf79d16508210a751d04ee?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/4999035/priyanka"}, "edited": false, "score": 0, "creation_date": 1437389333, "post_id": 31514414, "comment_id": 50990383, "body": "&lt;h2&gt;When it is not to be taken (Contraindications):&amp;nbsp;&lt;/h2&gt; &lt;br&gt; Contraindicated in patients with severe liver impairment, and hypersensitivity."}, {"owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "edited": false, "score": 0, "creation_date": 1437422449, "post_id": 31514414, "comment_id": 51011773, "body": "I would edit your questions with that comment @Shirin"}, {"owner": {"reputation": 232, "user_id": 4999035, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/9d76a1cd7adf79d16508210a751d04ee?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/4999035/priyanka"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1437480844, "post_id": 31514414, "comment_id": 51036601, "body": "Edited. Have a look @Not_a_Golfer"}], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 5136181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15651704a60f7ef1539f9b1fa2506188?s=128&d=identicon&r=PG", "display_name": "Tao Wen", "link": "https://stackoverflow.com/users/5136181/tao-wen"}, "is_accepted": false, "score": 0, "last_activity_date": 1437467580, "creation_date": 1437467580, "answer_id": 31534045, "question_id": 31514414, "link": "https://stackoverflow.com/questions/31514414/how-to-get-simple-text-from-html-page-with-goquery/31534045#31534045", "title": "How to get simple text from HTML page with goquery?", "body": "<p>Try query for <br> and get its siblings </p>\n\n<p><a href=\"http://godoc.org/github.com/PuerkitoBio/goquery#Selection.Siblings\" rel=\"nofollow\">http://godoc.org/github.com/PuerkitoBio/goquery#Selection.Siblings</a></p>\n"}, {"tags": [], "owner": {"reputation": 81, "user_id": 2350927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04bc57502c714d1021e7bf5a78ef39c2?s=128&d=identicon&r=PG", "display_name": "siongui", "link": "https://stackoverflow.com/users/2350927/siongui"}, "is_accepted": false, "score": 2, "last_activity_date": 1460901852, "last_edit_date": 1460901852, "creation_date": 1460898456, "answer_id": 36676926, "question_id": 31514414, "link": "https://stackoverflow.com/questions/31514414/how-to-get-simple-text-from-html-page-with-goquery/36676926#36676926", "title": "How to get simple text from HTML page with goquery?", "body": "<p>The following is what you want:</p>\n\n<pre><code>doc.Find(\".container\").Find(\"[align=\\\"justify\\\"]\").Each(func(_ int, s *goquery.Selection) {\n    prefix := s.Find(\"b\").Text()\n    result := strings.TrimPrefix(s.Text(), prefix)\n    println(result)\n})\n</code></pre>\n\n<p>import <a href=\"https://golang.org/pkg/strings/\" rel=\"nofollow\">strings</a> in front of your code. If you need complete code example, check <a href=\"https://siongui.github.io/2016/04/17/goquery-example-get-simple-text-from-html-page/\" rel=\"nofollow\">here</a>.</p>\n"}], "owner": {"reputation": 232, "user_id": 4999035, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/9d76a1cd7adf79d16508210a751d04ee?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/4999035/priyanka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2219, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1571013822, "creation_date": 1437388837, "last_edit_date": 1445405542, "question_id": 31514414, "link": "https://stackoverflow.com/questions/31514414/how-to-get-simple-text-from-html-page-with-goquery", "title": "How to get simple text from HTML page with goquery?", "body": "<p>I am new to Go. I am using <a href=\"https://github.com/PuerkitoBio/goquery\" rel=\"nofollow\">goquery</a> to extract data from an HTML page. \nBut the problem is the data I am looking for is not bounded by any HTML tag. It is simple text after a <code>&lt;br&gt;</code> tag. How can I extract it?</p>\n\n<p>Edit : Here is HTML code.</p>\n\n<pre><code>&lt;div class=\"container\"&gt;\n    &lt;div class=\"row\"&gt;\n      &lt;div class=\"col-lg-8\"&gt;\n        &lt;p align=\"justify\"&gt;&lt;b&gt;Name&lt;/b&gt;Priyaka&lt;/p&gt;\n        &lt;p align=\"justify\"&gt;&lt;b&gt;Surname&lt;/b&gt;Patil&lt;/p&gt;\n        &lt;p align=\"justify\"&gt;&lt;b&gt;Adress&lt;/b&gt;&lt;br&gt;India,Kolhapur&lt;/p&gt;\n        &lt;p align=\"justify\"&gt;&lt;b&gt;Hobbies&amp;nbsp;&lt;/b&gt;&lt;br&gt;Playing&lt;/p&gt;\n        &lt;p align=\"justify\"&gt;&lt;b&gt;Eduction&lt;/b&gt;&lt;br&gt;12th&lt;/p&gt;\n        &lt;p align=\"justify\"&gt;&lt;b&gt;School&lt;/b&gt;&lt;br&gt;New Highschool&lt;/p&gt;\n       &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>From this I want \"Priyanka\" and \"12th\".</p>\n"}, {"tags": ["http", "go", "proxy"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1437381612, "post_id": 31512022, "comment_id": 50985911, "body": "what is the panic output?"}, {"owner": {"reputation": 1829, "user_id": 538695, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/851a64b8c41036d8747cf8f8f07ce6e4?s=128&d=identicon&r=PG", "display_name": "Deck", "link": "https://stackoverflow.com/users/538695/deck"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1437382145, "post_id": 31512022, "comment_id": 50986191, "body": "@thwd sorry but no panic. It just ends the execution and takes new url to fetch."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1437382346, "post_id": 31512022, "comment_id": 50986294, "body": "that&#39;s not possible. Maybe I misunderstood something?"}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 4, "creation_date": 1437384844, "post_id": 31512022, "comment_id": 50987733, "body": "Try to add Timeout option to the http.Client. Maybe server just not respond"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437407884, "post_id": 31512022, "comment_id": 51003246, "body": "wrt [4]; checking errors is never useless, <code>Do</code> can return errors. However since you just pass errors up you don&#39;t need any <code>if</code>; just use <code>resp, err := client.Do(req); log.Println(&quot;done&quot;, url, err); return resp, err</code> or if you don&#39;t need the logging just <code>return client.Do(req)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "is_accepted": false, "score": 0, "last_activity_date": 1437421534, "creation_date": 1437421534, "answer_id": 31525068, "question_id": 31512022, "link": "https://stackoverflow.com/questions/31512022/http-client-do-stops-execution-without-any-errors/31525068#31525068", "title": "http.Client.Do stops execution without any errors", "body": "<p>Your code seems to work - I would suspect that there is something happening with the proxy that you are actually using ?</p>\n\n<p>code : </p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    urllib \"net/url\"\n)\n\nfunc FetchUrlWithProxy(url string, proxy string) (*http.Response, error) {\n    proxyUrl, err := urllib.Parse(proxy) // [1]\n    if err != nil {\n        return nil, err\n    }\n\n    client := &amp;http.Client{Transport: &amp;http.Transport{Proxy: http.ProxyURL(proxyUrl)}}\n    request, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        return nil, err\n    }\n\n    log.Println(\"try \", url) // [2]\n    response, err := client.Do(request)\n    log.Println(\"done \", url) // [3]\n\n    if err != nil { // [4]\n        return nil, err\n    }\n\n    return response, nil\n}\n\nfunc main() {\n    res, err := FetchUrlWithProxy(\"https://www.google.com\", \"https://www.google.com\")\n    log.Printf(\"R %v E %v\\n\", res, err)\n}\n</code></pre>\n\n<p>And the output :</p>\n\n<pre><code>\u279c go run p.go\n2015/07/20 21:44:45 try  https://www.google.com\n2015/07/20 21:44:46 done  https://www.google.com\n2015/07/20 21:44:46 &lt;nil&gt; Get https://www.google.com: unexpected EOF\n</code></pre>\n"}], "owner": {"reputation": 1829, "user_id": 538695, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/851a64b8c41036d8747cf8f8f07ce6e4?s=128&d=identicon&r=PG", "display_name": "Deck", "link": "https://stackoverflow.com/users/538695/deck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1437421534, "creation_date": 1437381421, "question_id": 31512022, "link": "https://stackoverflow.com/questions/31512022/http-client-do-stops-execution-without-any-errors", "title": "http.Client.Do stops execution without any errors", "body": "<p>I faced with weird behavior of <code>Do</code> function in http library.\nIn my program I have a worker reading a channel. On each message worker calls a function which makes a http request. Here are the function:</p>\n\n<pre><code>func FetchUrlWithProxy(url string, proxy string) (*http.Response, error) {\n    proxyUrl, err := urllib.Parse(proxy) // [1]\n    if err != nil {\n        return nil, err\n    }\n\n    client := &amp;http.Client{Transport: &amp;http.Transport{Proxy: http.ProxyURL(proxyUrl)}}\n    request, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        return nil, err\n    }\n\n    log.Println(\"try \", url) // [2]\n    response, err := client.Do(request)\n    log.Println(\"done \", url) // [3]\n\n    if err != nil { // [4]\n        return nil, err\n    }\n\n    return response, nil\n}\n</code></pre>\n\n<ul>\n<li><code>[1]</code> - it's just <code>net/url</code> imported this this name.</li>\n<li><code>[2]</code> - this line is printed eveytime.</li>\n<li><code>[3]</code> - this line is never printed without any\nerrors/panics.</li>\n<li><code>[4]</code> - so this checking of return value is useless.\nExecution doesn't reach this point.</li>\n</ul>\n\n<p>This behavior definitely is not what I expected. But if I remove proxy usage and create <code>client</code> as <code>client := &amp;http.Client{}</code> it will work. On other hand the proxy is not broken. I checked it using <code>curl</code>. How can it be?</p>\n\n<p>I will provide any additional information if you need.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4498, "user_id": 58768, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9bbffd2d873441279b4661070e8add4b?s=128&d=identicon&r=PG", "display_name": "bohdan_trotsenko", "link": "https://stackoverflow.com/users/58768/bohdan-trotsenko"}, "edited": false, "score": 0, "creation_date": 1437385878, "post_id": 31513091, "comment_id": 50988416, "body": "Mind that, as no bytes from the string are copied, GC won&#39;t free the string while you keep a reference to at least one chunk."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1437386596, "post_id": 31513091, "comment_id": 50988832, "body": "If the rune starts in one chunk and ends in another the code will break it."}, {"owner": {"reputation": 2911, "user_id": 702065, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/ae529fa78546d54e42c26bd3713946a2?s=128&d=identicon&r=PG", "display_name": "Johan Wikstr&#246;m", "link": "https://stackoverflow.com/users/702065/johan-wikstr%c3%b6m"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1437387836, "post_id": 31513091, "comment_id": 50989562, "body": "@AlexAtNet <code>i</code> is always the byte index to the first byte in the rune, so subslicing right before any <code>i</code> should not break any runes. I haven&#39;t tested the code though and there may be bugs."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1437388258, "post_id": 31513091, "comment_id": 50989796, "body": "I do not think so. <code>&quot;\u4e16\u754c&quot;[0:3]</code> is <code>\u4e16</code> but <code>&quot;\u4e16\u754c&quot;[0:1]</code> and <code>&quot;\u4e16\u754c&quot;[0:2]</code> are incomplete runes."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 1, "creation_date": 1437389140, "post_id": 31513091, "comment_id": 50990273, "body": "Thanks! I did not realise that the <code>range</code> is so smart."}, {"owner": {"reputation": 3551, "user_id": 2137314, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/LjaqW.jpg?s=128&g=1", "display_name": "siritinga", "link": "https://stackoverflow.com/users/2137314/siritinga"}, "edited": false, "score": 0, "creation_date": 1437394310, "post_id": 31513091, "comment_id": 50993373, "body": "I&#39;m afraid this solution won&#39;t compile (a couple of errors) and it will miss the last chuck. I&#39;ve tried briefly to complete it but failed (last chuck can be bigger). I don&#39;t have time right now to complete it, but if you want to try: <a href=\"http://play.golang.org/p/yzEr8-B5-2\" rel=\"nofollow noreferrer\">play.golang.org/p/yzEr8-B5-2</a> configured for 6 bytes."}], "tags": [], "owner": {"reputation": 2911, "user_id": 702065, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/ae529fa78546d54e42c26bd3713946a2?s=128&d=identicon&r=PG", "display_name": "Johan Wikstr&#246;m", "link": "https://stackoverflow.com/users/702065/johan-wikstr%c3%b6m"}, "is_accepted": false, "score": 3, "last_activity_date": 1437421593, "last_edit_date": 1437421593, "creation_date": 1437384845, "answer_id": 31513091, "question_id": 31511952, "link": "https://stackoverflow.com/questions/31511952/split-a-string-into-10kb-chunks-in-go/31513091#31513091", "title": "Split a String into 10kb chunks in Go", "body": "<p>The idiomatic way to split a string (or any slice or array) is by using slicing. Since you want to split by rune you'd have to loop through the entire string since you don't know in advance how many bytes each slice will contain.</p>\n\n<pre><code>slices := []string{}\ncount := 0\nlastIndex := 0\nfor i, r := range longString {\n    count++\n    if count%10001 == 0 {\n        slices = append(slices, longString[lastIndex:i])\n        lastIndex = i\n    }\n}\n</code></pre>\n\n<p>Warning: I have not run or tested this code, but it conveys the general principles. Looping over a string loops over the runes and not the bytes, <a href=\"http://blog.golang.org/strings\" rel=\"nofollow\">automatically decoding the UTF-8</a> for you. And using the slice operator <code>[]</code> <a href=\"http://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow\">represents your new strings as subslices</a> of <code>longString</code> which means that no bytes from the string needs to be copied.</p>\n\n<p>Note that <code>i</code> is the byte index in the string and may be incremented by more that 1 in each loop iteration.</p>\n\n<p>EDIT:</p>\n\n<p>Sorry, I didn't see you wanted to limit the number of bytes, not Unicode code points. You can implement that as well relatively easily.</p>\n\n<pre><code>slices := []string{}\nlastIndex := 0\nlastI := 0\nfor i, r := range longString {\n    if i-lastIndex &gt; 10000 {\n        slices = append(slices, longString[lastIndex:lastI])\n        lastIndex = lastI\n    }\n    lastI = i\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/Ou2UE3pApi\" rel=\"nofollow\">A working example at play.golang.org</a>, which also takes care of the leftover bytes at the end of the string.</p>\n"}, {"comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1437431286, "post_id": 31514256, "comment_id": 51015948, "body": "You&#39;re not accounting for 1-byte characters at the end of the string (those starting with 0... in binary form)."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1437470495, "post_id": 31514256, "comment_id": 51029774, "body": "You&#39;re right, I went over the code again and it&#39;s correct and very concise, like it a lot."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 8, "last_activity_date": 1437393808, "last_edit_date": 1437393808, "creation_date": 1437388393, "answer_id": 31514256, "question_id": 31511952, "link": "https://stackoverflow.com/questions/31511952/split-a-string-into-10kb-chunks-in-go/31514256#31514256", "title": "Split a String into 10kb chunks in Go", "body": "<p>Use <a href=\"http://godoc.org/unicode/utf8#RuneStart\" rel=\"nofollow\">RuneStart</a> to scan for a rune boundary. Slice the string at the boundary.</p>\n\n<pre><code>var chunks []string\nfor len(s) &gt; 10000 {\n    i := 10000\n    for i &gt;= 10000 - utf8.UTFMax &amp;&amp; !utf8.RuneStart(s[i]) {\n        i--\n    }\n    chunks = append(chunks, s[:i])\n    s = s[i:]\n}\nif len(s) &gt; 0 {\n    chunks = append(chunks, s)\n}\n</code></pre>\n\n<p>Using the approach, the application examines a few bytes at the chunk boundaries instead of the entire string.</p>\n\n<p>The code is written to guarantee progress when the string is not a valid UTF-8 encoding. You might want to handle this situation as an error or split the string in a different way.</p>\n\n<p><a href=\"http://play.golang.org/p/p_bMlxgMwh\" rel=\"nofollow\">playground example</a></p>\n"}, {"comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1437469564, "post_id": 31527317, "comment_id": 51029185, "body": "You were right, there was a typo and an off-by-one. Thanks!"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1437497524, "post_id": 31527317, "comment_id": 51049168, "body": "Why muck around with intimate details of UTF-8 when <code>utf8.RuneStart</code> does everything needed?"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1437547948, "post_id": 31527317, "comment_id": 51068754, "body": "For me it was more of an exercise and refresher on UTF-8, i&#39;ll leave it for anyone else looking to learn."}], "tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": false, "score": 0, "last_activity_date": 1437469765, "last_edit_date": 1437469765, "creation_date": 1437430882, "answer_id": 31527317, "question_id": 31511952, "link": "https://stackoverflow.com/questions/31511952/split-a-string-into-10kb-chunks-in-go/31527317#31527317", "title": "Split a String into 10kb chunks in Go", "body": "<p>Check out <a href=\"http://play.golang.org/p/Nyd0EVQQUF\" rel=\"nofollow noreferrer\">this code</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc init() {\n    rand.Seed(time.Now().UnixNano())\n}\n\nvar alphabet = []rune{\n    'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p',\n    'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '\u00e6', '\u00f8', '\u00e5', 'A', 'B', 'C',\n    'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S',\n    'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '\u00c6', '\u00d8', '\u00c5',\n}\n\nfunc randomString(n int) string {\n    b := make([]rune, n, n)\n    for k, _ := range b {\n        b[k] = alphabet[rand.Intn(len(alphabet))]\n    }\n    return string(b)\n}\n\nconst (\n    chunkSize int  = 100\n    lead4Mask byte = 0xF8 // must equal 0xF0\n    lead3Mask byte = 0xF0 // must equal 0xE0\n    lead2Mask byte = 0xE0 // must equal 0xC0\n    lead1Mask byte = 0x80 // must equal 0x00\n    trailMask byte = 0xC0 // must equal 0x80\n)\n\n\nfunc longestPrefix(s string, n int) int {\n    for i := (n - 1); ; i-- {\n        if (s[i] &amp; lead1Mask) == 0x00 {\n            return i + 1\n        }\n        if (s[i] &amp; trailMask) != 0x80 {\n            return i\n        }\n    }\n    panic(\"never reached\")\n}\n\nfunc main() {\n    s := randomString(100000)\n    for len(s) &gt; chunkSize {\n        cut := longestPrefix(s, chunkSize)\n        fmt.Println(s[:cut])\n        s = s[cut:]\n    }\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>I'm using the danish/norwegian alphabet to generate a random string of 100000 runes.</p>\n\n<p>Then, the \"magic\" lays in <code>longestPrefix</code>. To help you with the bit-shifting part, refer to the following graphic:</p>\n\n<p><img src=\"https://i.stack.imgur.com/YLTHd.jpg\" alt=\"enter image description here\"> </p>\n\n<p>The program prints out the respective longest possible chunks &lt;= chunkSize, one per line.</p>\n"}], "owner": {"reputation": 5101, "user_id": 125429, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/aef4370f36ff714d2861af1e5333e075?s=128&d=identicon&r=PG", "display_name": "aloo", "link": "https://stackoverflow.com/users/125429/aloo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1846, "favorite_count": 2, "answer_count": 3, "score": 9, "last_activity_date": 1437469765, "creation_date": 1437381138, "question_id": 31511952, "link": "https://stackoverflow.com/questions/31511952/split-a-string-into-10kb-chunks-in-go", "title": "Split a String into 10kb chunks in Go", "body": "<p>I have a large string in Go and I'd like to split it up into smaller chunks. Each chunk should be at most 10kb. The chunks should be split on runes (not in the middle of a rune).</p>\n\n<p>What is the idiomatic way to do this in go? Should I just be looping over the range of the string bytes? Am I missing some helpful stdlib packages?</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1437384456, "post_id": 31509424, "comment_id": 50987507, "body": "Is the request logged in the app engine request log?  Try running  <code>curl --request DELETE http:&#47;&#47;&lt;your application host&gt;&#47;</code> to see what&#39;s logged."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1437384896, "post_id": 31509424, "comment_id": 50987766, "body": "Can you also post the code that handles the DELETE request?"}, {"owner": {"reputation": 49, "user_id": 2622516, "user_type": "registered", "profile_image": "https://graph.facebook.com/1560109979/picture?type=large", "display_name": "Pradeep Raja", "link": "https://stackoverflow.com/users/2622516/pradeep-raja"}, "edited": false, "score": 0, "creation_date": 1437387628, "post_id": 31509424, "comment_id": 50989434, "body": "The request is not logged in appengine request log. But POST, PUT &amp; GET requests are logged."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1437425929, "post_id": 31509424, "comment_id": 51013655, "body": "I&#39;d recommend looking for some top level AppEngine settings that might be doing some pre-filtering. The request is getting blocked before it goes to your Go code."}, {"owner": {"reputation": 49, "user_id": 2622516, "user_type": "registered", "profile_image": "https://graph.facebook.com/1560109979/picture?type=large", "display_name": "Pradeep Raja", "link": "https://stackoverflow.com/users/2622516/pradeep-raja"}, "edited": false, "score": 0, "creation_date": 1437449716, "post_id": 31509424, "comment_id": 51020727, "body": "I don&#39;t find any settings related to pre-filtering."}, {"owner": {"reputation": 49, "user_id": 2622516, "user_type": "registered", "profile_image": "https://graph.facebook.com/1560109979/picture?type=large", "display_name": "Pradeep Raja", "link": "https://stackoverflow.com/users/2622516/pradeep-raja"}, "edited": false, "score": 0, "creation_date": 1437918360, "post_id": 31509424, "comment_id": 51221742, "body": "I have verified today without changing any code. The HTTP delete method is working without any issues. I don&#39;t find any data about this problem else where."}], "owner": {"reputation": 49, "user_id": 2622516, "user_type": "registered", "profile_image": "https://graph.facebook.com/1560109979/picture?type=large", "display_name": "Pradeep Raja", "link": "https://stackoverflow.com/users/2622516/pradeep-raja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 140, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1437412236, "creation_date": 1437370578, "last_edit_date": 1437412236, "question_id": 31509424, "link": "https://stackoverflow.com/questions/31509424/gae-go-http-call-with-delete-method-returning-403-access-denied", "title": "GAE GO Http call with Delete method returning 403 (Access Denied)", "body": "<p>I am having Google App Engine Go application. Recently I have noticed all HTTP DELETE calls are failing with 403 and an html page returned saying \"Access Denied\". The call is not going to the actual application the error seems to be returned by App Engine.</p>\n\n<p>No error found in GAE logs.</p>\n\n<p>This seems to be recent security changes in GAE causing this. But I don't find a way to enable DELETE method. All other methods GET, POST and PUT are working without any issue. I have searched GAE help but not able to find any information related to this issue.</p>\n\n<p>Any idea how to enable DELETE method?</p>\n\n<p>To make simpler I have created new sample app with following code. For any http call to \"/\" it returns \"test\"(by default it should return 200 OK). </p>\n\n<pre><code>package hello\n\nimport (\n   \"fmt\"\n   \"net/http\"\n)\n\nfunc init() {\n   http.HandleFunc(\"/\", handler)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n  fmt.Fprint(w, \"Test\")\n}\n</code></pre>\n\n<p>Now If call GET, PUT and POST it is successfully returning test with 200.\nFor DELETE it is returning following html text with http error code 403.</p>\n\n<pre><code>&lt;HTML&gt;\n&lt;HEAD&gt;\n&lt;TITLE&gt;Access Denied&lt;/TITLE&gt;\n&lt;/HEAD&gt;\n\n&lt;BODY BGCOLOR=\"white\" FGCOLOR=\"black\"&gt;\n&lt;H1&gt;Access Denied&lt;/H1&gt;\n&lt;HR&gt;\n\n&lt;FONT FACE=\"Helvetica,Arial\"&gt;&lt;B&gt;\n Description: You are not allowed to access the document you  requested.\n&lt;/B&gt;&lt;/FONT&gt;\n&lt;HR&gt;\n&lt;/BODY&gt;\n</code></pre>\n\n<p>For local server DELETE method working fine and returning 200 OK with \"test\"</p>\n"}, {"tags": ["macos", "go", "osx-yosemite"], "comments": [{"owner": {"reputation": 5608, "user_id": 660828, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2ab261718814b4842efac71a1b6cd1a5?s=128&d=identicon&r=PG", "display_name": "Tom Jowitt", "link": "https://stackoverflow.com/users/660828/tom-jowitt"}, "edited": false, "score": 0, "creation_date": 1437365719, "post_id": 31508738, "comment_id": 50979951, "body": "What happens when you run &quot;go version&quot;?"}, {"owner": {"reputation": 5291, "user_id": 2852424, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/AIdLu.png?s=128&g=1", "display_name": "Thibaud Clement", "link": "https://stackoverflow.com/users/2852424/thibaud-clement"}, "reply_to_user": {"reputation": 5608, "user_id": 660828, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2ab261718814b4842efac71a1b6cd1a5?s=128&d=identicon&r=PG", "display_name": "Tom Jowitt", "link": "https://stackoverflow.com/users/660828/tom-jowitt"}, "edited": false, "score": 0, "creation_date": 1437365802, "post_id": 31508738, "comment_id": 50979967, "body": "I get <code>go version go1.4.2 darwin&#47;amd64</code>."}], "answers": [{"tags": [], "owner": {"reputation": 5291, "user_id": 2852424, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/AIdLu.png?s=128&g=1", "display_name": "Thibaud Clement", "link": "https://stackoverflow.com/users/2852424/thibaud-clement"}, "is_accepted": true, "score": -1, "last_activity_date": 1437367907, "creation_date": 1437367907, "answer_id": 31509046, "question_id": 31508738, "link": "https://stackoverflow.com/questions/31508738/go-stat-hello-go-no-such-file-or-directory/31509046#31509046", "title": "Go: &quot;stat hello.go: no such file or directory&quot;", "body": "<p>Following the explanation of Andrew Gerrand in <em><a href=\"https://www.youtube.com/watch?v=XCsL89YtqCs\" rel=\"nofollow\">Writing, building, installing, and testing Go code</a></em>, I configured my Go workspace as follows:</p>\n\n<p><strong>1. Create workspace</strong></p>\n\n<p>First, since I want my Go code to be in <code>my_user_name/code/go</code>, I started by creating the corresponding folder:</p>\n\n<pre><code>$ cd code\n$ mkdir go\n</code></pre>\n\n<p><strong>2. Setup GOPATH</strong></p>\n\n<p>Then I configured the GOPATH:</p>\n\n<pre><code>$ cd\n$ export GOPATH=$HOME/code/go\n$ cd code/go\n</code></pre>\n\n<p><strong>3. Add files to workspace</strong></p>\n\n<p>Last, I manually (through the Finder) moved my hello.go file into the workspace and ran:</p>\n\n<pre><code>$ go run hello.go\n</code></pre>\n\n<p>Worked like a charm.</p>\n"}], "owner": {"reputation": 5291, "user_id": 2852424, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/AIdLu.png?s=128&g=1", "display_name": "Thibaud Clement", "link": "https://stackoverflow.com/users/2852424/thibaud-clement"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6092, "favorite_count": 0, "accepted_answer_id": 31509046, "answer_count": 1, "score": 1, "last_activity_date": 1437367907, "creation_date": 1437365442, "last_edit_date": 1437366198, "question_id": 31508738, "link": "https://stackoverflow.com/questions/31508738/go-stat-hello-go-no-such-file-or-directory", "title": "Go: &quot;stat hello.go: no such file or directory&quot;", "body": "<p>Just installed Go on Mac OS X, Yosemite Version 10.10.3, as explained in the <a href=\"https://golang.org/doc/install\" rel=\"nofollow\">Getting Started</a> page of the official website:</p>\n\n<blockquote>\n  <p><strong>Mac OS X package installer</strong></p>\n  \n  <p>Download the package file, open it, and follow the prompts to install\n  the Go tools. The package installs the Go distribution to\n  <code>/usr/local/go</code>.</p>\n  \n  <p>The package should put the <code>/usr/local/go/bin</code> directory in your PATH\n  environment variable. You may need to restart any open Terminal\n  sessions for the change to take effect.</p>\n</blockquote>\n\n<p>I am now in the <em>Test your installation</em> section, which states:</p>\n\n<blockquote>\n  <p>Check that Go is installed correctly by building a simple program, as\n  follows.</p>\n  \n  <p>Create a file named <code>hello.go</code> and put the following program in it:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Printf(\"hello, world\\n\") }\n</code></pre>\n  \n  <p>Then run it with the go tool:</p>\n\n<pre><code>$ go run hello.go\nhello, world\n</code></pre>\n  \n  <p>If you see the \"hello, world\" message then your Go installation is\n  working.</p>\n</blockquote>\n\n<p>So, I created a <code>hello.go</code> file and, since I could not (ie: did not know how to) access the <code>/usr/local/go/bin</code> directory, I saved it on my desktop.</p>\n\n<p>Obviously, I got the following error message:</p>\n\n<pre><code>stat hello.go: no such file or directory\n</code></pre>\n\n<p>So, where should I save my Go files to be able to run them?</p>\n\n<p><strong>UPDATE</strong>: after some research, I stumbled upond this video, explaining how to set the GOPATH.</p>\n\n<p>If I want my Go workspace to be in <code>user/code/go</code>, how should I write my <code>export GOPATH=</code> command?</p>\n"}, {"tags": ["macos", "go", "osx-yosemite"], "comments": [{"owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "edited": false, "score": 0, "creation_date": 1437422644, "post_id": 31508390, "comment_id": 51011869, "body": "for ease of management HomeBrew (<a href=\"http://brew.sh/\" rel=\"nofollow noreferrer\">brew.sh</a>) has a version og Go packaged"}], "answers": [{"comments": [{"owner": {"reputation": 5291, "user_id": 2852424, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/AIdLu.png?s=128&g=1", "display_name": "Thibaud Clement", "link": "https://stackoverflow.com/users/2852424/thibaud-clement"}, "edited": false, "score": 0, "creation_date": 1437364054, "post_id": 31508527, "comment_id": 50979617, "body": "Thanks a lot for your answer."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 5, "last_activity_date": 1437363663, "creation_date": 1437363663, "answer_id": 31508527, "question_id": 31508390, "link": "https://stackoverflow.com/questions/31508390/how-to-decode-which-version-of-golang-to-install-on-mac-os-x/31508527#31508527", "title": "How to decode which version of Golang to install on Mac OS X?", "body": "<p>You'll want this one:</p>\n\n<blockquote>\n  <p>go1.4.2.darwin-amd64-osx10.8.pkg Installer OS X 10.8+ 64-bit</p>\n</blockquote>\n\n<p>Note the key parts: amd64 (64-bit), OS X 10.8+ (of which 10.10.3 satisfies). It's the GUI installer, which automates a lot of the work.</p>\n\n<p>Mac OS X is often referred to as \"darwin\", which is the name for the low-level OS.</p>\n"}], "owner": {"reputation": 5291, "user_id": 2852424, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/AIdLu.png?s=128&g=1", "display_name": "Thibaud Clement", "link": "https://stackoverflow.com/users/2852424/thibaud-clement"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1070, "favorite_count": 0, "accepted_answer_id": 31508527, "answer_count": 1, "score": 1, "last_activity_date": 1437363663, "creation_date": 1437362494, "question_id": 31508390, "link": "https://stackoverflow.com/questions/31508390/how-to-decode-which-version-of-golang-to-install-on-mac-os-x", "title": "How to decode which version of Golang to install on Mac OS X?", "body": "<p>On the official Golang website, in the <a href=\"https://golang.org/doc/install\" rel=\"nofollow\">Get Started</a> section, we read:</p>\n\n<blockquote>\n  <p><strong>Install the Go tools</strong></p>\n  \n  <p>If you are upgrading from an older version of Go you must first remove\n  the existing version.</p>\n  \n  <p>Linux, Mac OS X, and FreeBSD tarballs</p>\n  \n  <p>Download the archive and extract it into /usr/local, creating a Go\n  tree in <code>/usr/local/go</code>. For example:</p>\n  \n  <p><code>tar -C /usr/local -xzf go$VERSION.$OS-$ARCH.tar.gz</code> </p>\n  \n  <p>Choose the archive\n  file appropriate for your installation. For instance, if you are\n  installing Go version 1.2.1 for 64-bit x86 on Linux, the archive you\n  want is called go1.2.1.linux-amd64.tar.gz.</p>\n  \n  <p>(Typically these commands must be run as root or through sudo.)</p>\n  \n  <p>Add <code>/usr/local/go/bin</code> to the PATH environment variable. You can do\n  this by adding this line to your <code>/etc/profile</code> (for a system-wide\n  installation) or <code>$HOME/.profile</code>:</p>\n  \n  <p><code>export PATH=$PATH:/usr/local/go/bin</code></p>\n</blockquote>\n\n<p>When we visit the <a href=\"https://golang.org/dl/\" rel=\"nofollow\">Downloads</a> section, we are presented with many options:</p>\n\n<blockquote>\n  <p>go1.4.2</p>\n  \n  <p><strong>File name  Kind    OS  Arch    SHA1 Checksum</strong></p>\n  \n  <p>go1.4.2.src.tar.gz    Source          460caac03379f746c473814a65223397e9c9a2f6</p>\n  \n  <p>go1.4.2.darwin-386-osx10.6.tar.gz Archive OS X\n  10.6+ 32-bit  fb3e6b30f4e1b1be47bbb98d79dd53da8dec24ec</p>\n  \n  <p>go1.4.2.darwin-386-osx10.8.tar.gz Archive OS X\n  10.8+ 32-bit  65f5610fdb38febd869aeffbd426c83b650bb408</p>\n  \n  <p>go1.4.2.darwin-386-osx10.6.pkg    Installer   OS X\n  10.6+ 32-bit  3ed569ce33616d5d36f963e5d7cefb55727c8621</p>\n  \n  <p>go1.4.2.darwin-386-osx10.8.pkg    Installer   OS X\n  10.8+ 32-bit  7f3fb2438fa0212febef13749d8d144934bb1c80</p>\n  \n  <p>go1.4.2.darwin-amd64-osx10.6.tar.gz   Archive OS X\n  10.6+ 64-bit  00c3f9a03daff818b2132ac31d57f054925c60e7</p>\n  \n  <p>go1.4.2.darwin-amd64-osx10.8.tar.gz   Archive OS X\n  10.8+ 64-bit  58a04b3eb9853c75319d9076df6f3ac8b7430f7f</p>\n  \n  <p>go1.4.2.darwin-amd64-osx10.6.pkg  Installer   OS X\n  10.6+ 64-bit  3fa5455e211a70c0a920abd53cb3093269c5149c</p>\n  \n  <p>go1.4.2.darwin-amd64-osx10.8.pkg  Installer   OS X\n  10.8+ 64-bit  8fde619d48864cb1c77ddc2a1aec0b7b20406b38</p>\n</blockquote>\n\n<p>I run <strong>Mac OS X Yosemite, Version 10.10.3</strong>, with the following configuration:</p>\n\n<ul>\n<li><strong>Processor</strong>: 2.8 GHz Intel Core i5</li>\n<li><strong>Memory</strong>: 8 Go 1600 MHz DDR3</li>\n<li><strong>Graphics</strong>: Intel Iris 1536 Mo</li>\n</ul>\n\n<p>Which version of Go should I install?</p>\n\n<p>And most importantly, why (so that I can make a decision for myself in the future)?</p>\n"}, {"tags": ["concurrency", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1437346606, "post_id": 31506770, "comment_id": 50976337, "body": "What is your setting for GOMAXPROCS?"}, {"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1437347770, "post_id": 31506770, "comment_id": 50976553, "body": "When GOMAXPROCS is 1 a goroutine are more like thread than a process so you can&#39;t get more speed out a single CPU core. This is useful when you have some blocking I/O but does not help in your code. Increasing GOMAXPROCS should help, because the go runtime will split the goroutines across multiple processes."}, {"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "reply_to_user": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1437355118, "post_id": 31506770, "comment_id": 50977988, "body": "Processors or processes @TheHippo? They&#39;re ... kinda different :P"}, {"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "reply_to_user": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1437361511, "post_id": 31506770, "comment_id": 50979138, "body": "@SimonWhitehead I think I got it right. Increasing GOMAXPROCS will make sure your program will use multiple processes and therefore has a change to use multiple processors."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1437402366, "post_id": 31506770, "comment_id": 50999234, "body": "@TheHippo: <code>GOMAXPROCS</code> sets the number of OS <i>threads</i> that will be used to schedule user goroutines. There is only ever 1 process (for the conventional definition of &quot;process&quot;)."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1437402631, "post_id": 31507980, "comment_id": 50999436, "body": "Note, due to scheduler improvements, for go1.5 <code>GOMAXPROCS</code> will now default to <code>runtime.NumCPU()</code> (though the <code>runtime.GOMAXPROCS</code> call still remains, since NumCPU isn&#39;t universally optimal)"}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": true, "score": 1, "last_activity_date": 1437358332, "creation_date": 1437358332, "answer_id": 31507980, "question_id": 31506770, "link": "https://stackoverflow.com/questions/31506770/go-worker-pool-doesnt-seem-to-be-processing-concurrently/31507980#31507980", "title": "Go Worker Pool doesn&#39;t seem to be processing Concurrently", "body": "<p><a href=\"http://golang.org/doc/effective_go.html#parallel\" rel=\"nofollow\">http://golang.org/doc/effective_go.html#parallel</a></p>\n\n<p>The current implementation of the Go runtime will not parallelize this code by default. It dedicates only a single core to user-level processing. An arbitrary number of goroutines can be blocked in system calls, but by default only one can be executing user-level code at any time. It should be smarter and one day it will be smarter, but until it is if you want CPU parallelism you must tell the run-time how many goroutines you want executing code simultaneously. There are two related ways to do this. Either run your job with environment variable GOMAXPROCS set to the number of cores to use or import the runtime package and call runtime.GOMAXPROCS(NCPU). A helpful value might be runtime.NumCPU(), which reports the number of logical CPUs on the local machine. Again, this requirement is expected to be retired as the scheduling and run-time improve.</p>\n"}], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 548, "favorite_count": 0, "accepted_answer_id": 31507980, "answer_count": 1, "score": 0, "last_activity_date": 1437358332, "creation_date": 1437346286, "last_edit_date": 1437347271, "question_id": 31506770, "link": "https://stackoverflow.com/questions/31506770/go-worker-pool-doesnt-seem-to-be-processing-concurrently", "title": "Go Worker Pool doesn&#39;t seem to be processing Concurrently", "body": "<p>Hello I'm brand new to go (and concurrent programming in general :() and trying to distribute a slow computation to a pool of workers.</p>\n\n<p><a href=\"http://play.golang.org/p/lTv4Tm75A4\" rel=\"nofollow\">http://play.golang.org/p/lTv4Tm75A4</a></p>\n\n<pre><code>func main() {\n    test := []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}\n    answer := getSmallestMultiple(test)\n    fmt.Println(answer)\n}\n</code></pre>\n\n<p>I am trying to find the smallest number that is evenly divisible by all the numbers in <code>test</code>. </p>\n\n<p>I have created a pool of workers and am sending them values until one of the goroutines finds a number that can be evenly divided by all the numbers in <code>test</code></p>\n\n<pre><code>for w := 0; w &lt; 100; w++ {\n    go divisibleByAllNumbers(&amp;numbers, jobs, answer)\n}\n\n\ngo func() {\n    for i := max; ; i += max {\n        fmt.Printf(\"Sending # %d\\n\", i)\n        jobs &lt;- i\n    }\n}() \n</code></pre>\n\n<p>The program seems to be running at the same speed despite how many workers I start. I have tried many number of workers and it always takes the same number of seconds to run, which seems like the work is not being done concurrently at all.</p>\n\n<p>Each worker is consuming work from the queue using <code>range</code>:</p>\n\n<pre><code>for j := range jobs {}\n</code></pre>\n\n<p>And i was hoping the more processes consuming off the <code>jobs</code> channel the faster the program would execute.</p>\n\n<p>I have also tried different values for the <code>jobs := make(chan int)</code> buffer value</p>\n\n<p>I have stared at this all day and was hoping someone could see what the issue is.  I would expect the more workers I add the faster the computation takes but am not experiencing that.  I'm sure I\"m missing some key concepts,</p>\n\n<p>Thank you</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1437378466, "post_id": 31506881, "comment_id": 50984387, "body": "We&#39;re speculating about the semantics of something not in the language, but it would be very surprising if conversion from *I to *P happened automatically (and so your snippet is unambiguous). If <code>P</code> was defined as <code>type P I</code>, then <code>I(0).Get()</code> is already unambiguous and I don&#39;t see why adding pointers would make any difference."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1437380372, "post_id": 31506881, "comment_id": 50985254, "body": "I would&#39;ve gone for P.Get"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1437398626, "post_id": 31506881, "comment_id": 50996486, "body": "@PaulHankin: yeah, that wasn&#39;t as clear as I would have liked. I expanded it a little to emphasize the automatic type conversion problem. Note that there&#39;s no definitive reason it <i>couldn&#39;t</i> be defined, but because it doesn&#39;t solve a real problem, and only makes the code less clear, it never passed as a feature worth adding to the language."}, {"owner": {"reputation": 175, "user_id": 6249688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/465ae66ea36ea277d33528789e9cab3d?s=128&d=identicon&r=PG&f=1", "display_name": "Blue Joy", "link": "https://stackoverflow.com/users/6249688/blue-joy"}, "edited": false, "score": 0, "creation_date": 1523514454, "post_id": 31506881, "comment_id": 86593733, "body": "The receiver type must be of the form T or *T where T is a type name. The type denoted by T is called the receiver base type; it must not be a pointer or interface type and it must be declared in the same package as the method."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1437398315, "last_edit_date": 1437398315, "creation_date": 1437347320, "answer_id": 31506881, "question_id": 31506625, "link": "https://stackoverflow.com/questions/31506625/why-no-methods-defined-for-named-pointer-types/31506881#31506881", "title": "Why no methods defined for named pointer types?", "body": "<p>Named pointer types could lead to ambiguities like so:</p>\n\n<pre><code>type T int \n\nfunc (t *T) Get() T { \n    return *t + 1 \n} \n\ntype P *T \n\nfunc (p P) Get() T { \n    return *p + 2 \n} \n\nfunc F() { \n    var v1 T \n    var v2 = &amp;v1 \n    var v3 P = &amp;v1 \n    fmt.Println(v1.Get(), v2.Get(), v3.Get()) \n}\n</code></pre>\n\n<p>In the last case (esp. <code>v3</code>) per the current spec, it's ambiguous which <code>Get()</code> method should be called. Yes, there's no reason that the method resolution couldn't be defined, but it's one more detail to add to the language for something that already has a solution.</p>\n"}, {"comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1437377016, "post_id": 31506886, "comment_id": 50983611, "body": "Clear enough that&#39;s what the document for effective Go and the language specification says. The question is why ?"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1437378160, "post_id": 31506886, "comment_id": 50984219, "body": "I expect the answer would be along the lines of it would make the language more complicated and it&#39;s not clear what the benefit would be."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1437380582, "post_id": 31506886, "comment_id": 50985359, "body": "Fair enough. The other answer does provide one example of potential complication. Naively, type just looks like a typedef to me - not clear why there should be restrictions on the usage."}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": false, "score": 2, "last_activity_date": 1437347667, "last_edit_date": 1437347667, "creation_date": 1437347363, "answer_id": 31506886, "question_id": 31506625, "link": "https://stackoverflow.com/questions/31506625/why-no-methods-defined-for-named-pointer-types/31506886#31506886", "title": "Why no methods defined for named pointer types?", "body": "<p>A named type that is a pointer isn't the same as a pointer to a named type. </p>\n\n<p>This is what the language reference says:</p>\n\n<blockquote>\n  <p>That parameter section must declare a single parameter, the receiver.\n  Its type must be of the form T or *T (possibly using parentheses)\n  where T is a type name. The type denoted by T is called the receiver\n  base type; it must not be a pointer or interface type and it must be\n  declared in the same package as the method.</p>\n</blockquote>\n\n<p>That's clear enough: if T denotes a pointer type, then you can't use it as a method receiver.</p>\n\n<p>Note the careful language of the reference here: the phrase \"Its type must be of the form T or T*\" refers to the syntax-level specification of the method receiver (that is, the \"form\" of the type). That's different from the phrase \"The type denoted by T\", where it's talking about the type that T names (that is, what the type \"denotes\").</p>\n"}], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 31506881, "answer_count": 2, "score": 4, "last_activity_date": 1437398315, "creation_date": 1437345102, "question_id": 31506625, "link": "https://stackoverflow.com/questions/31506625/why-no-methods-defined-for-named-pointer-types", "title": "Why no methods defined for named pointer types?", "body": "<p>In the documentation for <a href=\"https://golang.org/doc/effective_go.html#pointers_vs_values\" rel=\"nofollow\">effective Go</a> it states:</p>\n\n<blockquote>\n  <p>As we saw with ByteSize, methods can be defined for any named type\n  (except a pointer ...</p>\n</blockquote>\n\n<pre><code>type ByteSlice []byte\nfunc (slice ByteSlice) Append(data []byte) []byte {\n  // Body exactly the same as above\n}\n</code></pre>\n\n<p>It then goes on to provide an example with a pointer as receiver:</p>\n\n<pre><code>func (p *ByteSlice) Append(data []byte) {\n  slice := *p\n  // Body as above, without the return.\n  *p = slice\n}\n</code></pre>\n\n<p>Doesn't that contradict ? Or does it mean that this isn't valid:</p>\n\n<pre><code>type ByteSlice []byte\ntype Pb *ByteSlice\nfunc (p Pb) Append(data []byte) []byte {\n} \n</code></pre>\n\n<p>Though it looks just like a typedef!</p>\n"}, {"tags": ["caching", "web-applications", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1437347541, "post_id": 31506412, "comment_id": 50976512, "body": "&quot;Potentially&quot;. 1 req per second is not a lot (how many concurrent users?) and it may be faster to just hit the DB. Tweak your indexes + cache sizing. Storing in memory might be acceptable (a mutex-protected <code>map[sessionID]data</code>) but you would need a way to evict members (which would require timestamping + locking during eviction). Redis (via <code>SETEX</code>) likely to be better. I would benchmark the &quot;check Redis, doesn&#39;t exist, check mySQL, respond, then add to Redis&quot; pipeline carefully: you might increase client latency by adding a cache."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 1, "creation_date": 1437358452, "post_id": 31506412, "comment_id": 50978621, "body": "but it is not a golang question."}], "owner": {"reputation": 91, "user_id": 4189313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3288caa1dd250ee7994238993230a74d?s=128&d=identicon&r=PG&f=1", "display_name": "Maxim Dvorkin", "link": "https://stackoverflow.com/users/4189313/maxim-dvorkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 237, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1437343975, "creation_date": 1437343470, "last_edit_date": 1437343975, "question_id": 31506412, "link": "https://stackoverflow.com/questions/31506412/golang-caching-active-users-in-global-var-context-its-a-good-idea", "title": "Golang. Caching active users in global var/context. Its a good idea?", "body": "<p>We have a web app in which data is loaded from mysql database.<br>\nActive users make a request every second.<br>\n<code>http.Handler</code> on each request retrieves same data from db.\nI want to save last 100(or 200) in global app memory and first will try to check this by key in cookies. If user not in cache then make request to db and add data to cache.<br>\nThe same approach can be used with other frequently requested data.</p>\n\n<p><strong>I want to know what gophers think about this approach.</strong><br>\nI would be grateful for your advice and useful links.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 4, "creation_date": 1437338855, "post_id": 31505587, "comment_id": 50974422, "body": "It also seems a little bit redundant to have 2 structs with the same types."}, {"owner": {"reputation": 239, "user_id": 2358889, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b0682a626070985def49274915de5006?s=128&d=identicon&r=PG", "display_name": "Ekaterina", "link": "https://stackoverflow.com/users/2358889/ekaterina"}, "reply_to_user": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 6, "creation_date": 1437339243, "post_id": 31505587, "comment_id": 50974542, "body": "Yes, but this is a toy example. First and Second could share some fields and not others. The point is that I want a function to behave in the exact same way for two different types, without having repeated code."}], "answers": [{"comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1590138235, "post_id": 31505807, "comment_id": 109571967, "body": "This answer is the same as @TheHippo. See <a href=\"https://play.golang.org/p/yyRG9B_K7lk\" rel=\"nofollow noreferrer\">play.golang.org/p/yyRG9B_K7lk</a>. Except no interface."}], "tags": [], "owner": {"reputation": 125, "user_id": 3336936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d71d43a57e155f08b4e6323e030e07f?s=128&d=identicon&r=PG&f=1", "display_name": "mihaic", "link": "https://stackoverflow.com/users/3336936/mihaic"}, "is_accepted": false, "score": 2, "last_activity_date": 1437339093, "creation_date": 1437339093, "answer_id": 31505807, "question_id": 31505587, "link": "https://stackoverflow.com/questions/31505587/how-can-two-different-types-implement-the-same-method-in-golang-using-interfaces/31505807#31505807", "title": "How can two different types implement the same method in golang using interfaces?", "body": "<p>Maybe not the best way to solve your problem, but you could use a wrapper in order to avoid \"implementing\" the function twice, something like this:</p>\n\n<pre><code>type First struct {\n    str StringWrapper\n}\ntype Second struct {\n    str StringWrapper\n}\n\n\ntype StringWrapper struct {\n    str string\n}\nfunc (f StringWrapper) PrintStr() {\n    fmt.Print(f.str)\n}\n\nfunc main() {\n    var a First = First{str:StringWrapper{str: \"aaa\"}};\n    a.str.PrintStr();\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1541, "user_id": 395059, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ad82e88848bab09d379e402207405874?s=128&d=identicon&r=PG", "display_name": "Joey", "link": "https://stackoverflow.com/users/395059/joey"}, "edited": false, "score": 3, "creation_date": 1437417253, "post_id": 31505875, "comment_id": 51008708, "body": "what is this sorcery where you define a struct with a non-variable member?! from your answer: <code>type First struct { WithString }</code>... is there any documentation on this? defining a type struct as another type?"}, {"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "reply_to_user": {"reputation": 1541, "user_id": 395059, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ad82e88848bab09d379e402207405874?s=128&d=identicon&r=PG", "display_name": "Joey", "link": "https://stackoverflow.com/users/395059/joey"}, "edited": false, "score": 1, "creation_date": 1437417559, "post_id": 31505875, "comment_id": 51008887, "body": "@Joey this is called embedding and it is a well known technique, see <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#embedding</a>"}, {"owner": {"reputation": 1967, "user_id": 1031871, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7g8bJ.jpg?s=128&g=1", "display_name": "Arun Gopalpuri", "link": "https://stackoverflow.com/users/1031871/arun-gopalpuri"}, "edited": false, "score": 0, "creation_date": 1585028748, "post_id": 31505875, "comment_id": 107616401, "body": "@TheHippo - what&#39;s the point of that interface in your example?"}, {"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1590138062, "post_id": 31505875, "comment_id": 109571886, "body": "I agree with Arun. See the answer by @mihaic."}], "tags": [], "owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "is_accepted": true, "score": 18, "last_activity_date": 1437499872, "last_edit_date": 1437499872, "creation_date": 1437339559, "answer_id": 31505875, "question_id": 31505587, "link": "https://stackoverflow.com/questions/31505587/how-can-two-different-types-implement-the-same-method-in-golang-using-interfaces/31505875#31505875", "title": "How can two different types implement the same method in golang using interfaces?", "body": "<p>No you can't, <strong>but</strong> you could create a base type and then embed it into your 2 struct, therefore only needing an implementation for the base type:</p>\n\n<pre><code>type WithString struct {\n    str string\n}\n\ntype First struct {\n    WithString\n}\n\ntype Second struct {\n    WithString\n}\n\ntype A interface {\n    PrintStr() //print First.str or Second.str\n}\n\nfunc (w WithString) PrintStr() {\n    fmt.Print(w.str)\n}\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>a := First{\n    WithString: WithString{\n        str: \"foo\",\n    },\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/thw2e0Qznn\" rel=\"noreferrer\">Complete Example on Playground</a></p>\n\n<p><a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"noreferrer\">Embed documentation</a></p>\n"}, {"tags": [], "owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "is_accepted": false, "score": 5, "last_activity_date": 1437381318, "last_edit_date": 1437381318, "creation_date": 1437340944, "answer_id": 31506057, "question_id": 31505587, "link": "https://stackoverflow.com/questions/31505587/how-can-two-different-types-implement-the-same-method-in-golang-using-interfaces/31506057#31506057", "title": "How can two different types implement the same method in golang using interfaces?", "body": "<p>If the printing logic depends on the interface but not on the structs themselves, then it is better to move printing to a free function that operates over an interface.</p>\n\n<p>In your case, the <code>PrintStr</code> method is used to print a string which is a member of each structure.<br>\nIn this case, it means that each structure should implement an interface that returns the necessary string used for printing, and <code>PrintStr</code> becomes a function taking a <code>Printable</code> parameter.</p>\n\n<pre><code>type First struct {\n    str string\n}\ntype Second struct {\n    str string\n}\n\ntype Printable interface {\n     String() string\n}\n\nfunc (p First) String() string {\n    return p.str\n}\n\nfunc (p Second) String() string {\n    return p.str\n}\n\nfunc PrintStr(p Printable) {\n    fmt.Print(p.String())\n}\n</code></pre>\n\n<p>Your use of the <code>A</code> interface is non-idiomatic because an interface should not depend on the <strong>implementation</strong> of its functionality.</p>\n\n<p>Instead, with this solution, you can still keep the A interface, but simplify each implementation:</p>\n\n<pre><code>func (f First) PrintStr() {\n    PrintStr(f)\n}\n\nfunc (s Second) PrintStr() {\n    PrintStr(s)\n}\n</code></pre>\n\n<p>It is still redundant, but the logic lies in the function that is called from there, limiting the need to do copy-pasting in case of modification of the printing logic.</p>\n\n<p>This pattern is common in the Go standard library, because many useful functions are built upon interfaces which they cannot extend, for example <a href=\"http://golang.org/pkg/io/#Reader\" rel=\"nofollow\">io.Reader</a>.<br>\nIt is a simple interface with only one method, but it is used thoroughly from many other packages.<br>\nIf you look at the <a href=\"https://golang.org/pkg/io/ioutil/#ReadAll\" rel=\"nofollow\">ioutil.ReadAll</a> function, it could be argued that it could have been implemented as another method of the <code>io.Reader</code> interface, however this keeps readers simpler, concentrating on their single method, while allowing any implementor to use ReadAll for free.</p>\n"}, {"comments": [{"owner": {"reputation": 953, "user_id": 1993536, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/17a3a074b629368c391549294af55654?s=128&d=identicon&r=PG", "display_name": "izaban", "link": "https://stackoverflow.com/users/1993536/izaban"}, "edited": false, "score": 0, "creation_date": 1595172166, "post_id": 54298159, "comment_id": 111376044, "body": "This is wrong, you will get the following error when trying to define the PrintStr function <code>a.str undefined (type A is interface with no methods)</code>"}], "tags": [], "owner": {"reputation": 19, "user_id": 6543811, "user_type": "registered", "profile_image": "https://graph.facebook.com/998885033560280/picture?type=large", "display_name": "Pablo Arranz", "link": "https://stackoverflow.com/users/6543811/pablo-arranz"}, "is_accepted": false, "score": 1, "last_activity_date": 1548107075, "creation_date": 1548107075, "answer_id": 54298159, "question_id": 31505587, "link": "https://stackoverflow.com/questions/31505587/how-can-two-different-types-implement-the-same-method-in-golang-using-interfaces/54298159#54298159", "title": "How can two different types implement the same method in golang using interfaces?", "body": "<p>Why don't you just leave that function out of the interface and pass type A as a parameter?</p>\n\n<pre><code>type A interface {}\n\ntype First struct {\n    str string\n}\ntype Second struct {\n    str string\n}\n\nfunc PrintStr(a A) {\n    fmt.Print(a.str)\n}\n</code></pre>\n"}], "owner": {"reputation": 239, "user_id": 2358889, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b0682a626070985def49274915de5006?s=128&d=identicon&r=PG", "display_name": "Ekaterina", "link": "https://stackoverflow.com/users/2358889/ekaterina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10144, "favorite_count": 2, "accepted_answer_id": 31505875, "answer_count": 4, "score": 18, "last_activity_date": 1548107075, "creation_date": 1437337452, "question_id": 31505587, "link": "https://stackoverflow.com/questions/31505587/how-can-two-different-types-implement-the-same-method-in-golang-using-interfaces", "title": "How can two different types implement the same method in golang using interfaces?", "body": "<p>Say I have two structs:</p>\n\n<pre><code>type First struct {\n    str string\n}\ntype Second struct {\n    str string\n}\n</code></pre>\n\n<p>And I want both of them to implement interface A:</p>\n\n<pre><code>type A interface {\n    PrintStr() //print First.str or Second.str\n}\n</code></pre>\n\n<p>It seems redundant to have an implementation for both First and Second structs like so:</p>\n\n<pre><code>func (f First) PrintStr() {\n    fmt.Print(f.str)\n}\n\nfunc (s Second) PrintStr() {\n    fmt.Print(s.str)\n}\n</code></pre>\n\n<p>Is there a way I can have one implementation for all the structs implementing interface A? Something like this, but it doesn't seem to work:</p>\n\n<pre><code>func (a A) PrintStr() {\n    fmt.Print(a.str)\n}\n</code></pre>\n\n<p>Thank you! </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 2, "creation_date": 1437333803, "post_id": 31504975, "comment_id": 50972935, "body": "I&#39;m not sure I understand, why not check <code>if len(user.Username) == 0 { noUsername(); }</code>?"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1437333954, "post_id": 31504975, "comment_id": 50972983, "body": "If a user object is posted without <code>username</code> then <code>len(user.Username)</code> will still equal 0. I want to conditionally validate - that is, I want to validate the username only if it was included in the POST object. Sorry if it&#39;s unclear!"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1437334204, "post_id": 31504975, "comment_id": 50973056, "body": "So I need to be able to distinguish between a User object than contains a username with value <code>&quot;&quot;</code> (i.e. username has been forgotten) and User object without a username."}], "answers": [{"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 2, "creation_date": 1437334509, "post_id": 31505089, "comment_id": 50973149, "body": "Interesting, I didn&#39;t know it could be done like this. I&#39;m going to test in the morning and will tick then if it&#39;s all good!"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1437380799, "post_id": 31505089, "comment_id": 50985451, "body": "I&#39;ve got this going. Quick question - if I want to check the length of the <code>username</code> after I&#39;ve checked whether it&#39;s <code>nil</code> do I need to de-reference it? e.g. <code>len(*user.Username)</code>"}, {"owner": {"reputation": 1541, "user_id": 395059, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ad82e88848bab09d379e402207405874?s=128&d=identicon&r=PG", "display_name": "Joey", "link": "https://stackoverflow.com/users/395059/joey"}, "edited": false, "score": 1, "creation_date": 1437417659, "post_id": 31505089, "comment_id": 51008935, "body": "yes, the <code>len</code> function cannot take type <code>*string</code> as an argument. <a href=\"http://golang.org/pkg/builtin/#len\" rel=\"nofollow noreferrer\">golang.org/pkg/builtin/#len</a>"}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 11, "last_activity_date": 1437334258, "creation_date": 1437334258, "answer_id": 31505089, "question_id": 31504975, "link": "https://stackoverflow.com/questions/31504975/validate-struct-field-if-it-exists/31505089#31505089", "title": "Validate struct field if it exists", "body": "<p>You can use a pointer to a string:</p>\n\n<pre><code>type User struct {\n    Name     string  `json:\"name,omitempty\"`\n    Username *string `json:\"username,omitempty\"`\n    Email    string  `json:\"email,omitempty\"`\n    Town     string  `json:\"town,omitempty\"`\n    //more fields here\n}\n\nfunc main() {\n    var u, u2 User\n    json.Unmarshal([]byte(`{\"username\":\"hi\"}`), &amp;u)\n    fmt.Println(\"username set:\", u.Username != nil, *u.Username)\n    json.Unmarshal([]byte(`{}`), &amp;u2)\n    fmt.Println(\"username set:\", u2.Username != nil)\n    fmt.Println(\"Hello, playground\")\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/LpvXWh1m65\"><kbd>playground</kbd></a></p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12954, "favorite_count": 4, "accepted_answer_id": 31505089, "answer_count": 1, "score": 10, "last_activity_date": 1437334258, "creation_date": 1437333468, "question_id": 31504975, "link": "https://stackoverflow.com/questions/31504975/validate-struct-field-if-it-exists", "title": "Validate struct field if it exists", "body": "<p>I'm POSTing a JSON user object to my Golang application where I decode the 'req.body' into a 'User' struct.</p>\n\n<pre><code>err := json.NewDecoder(req.Body).Decode(user)\n//handle err if there is one\n</code></pre>\n\n<p>and the 'User' struct:</p>\n\n<pre><code>type User struct {\n    Name      string  `json:\"name,omitempty\"`\n    Username  string  `json:\"username,omitempty\"`\n    Email     string  `json:\"email,omitempty\"`\n    Town      string  `json:\"town,omitempty\"`\n    //more fields here\n}\n</code></pre>\n\n<p>While I don't need help with the actual validation, I would like know how to validate usernames only if it is included as part of the JSON object. At the moment, if a username isn't included then <code>User.Username</code> will still exist but be empty i.e. <code>\"\"</code></p>\n\n<p><strong>How can I check to see if '\"username\"' was included as part of the POSTed object?</strong></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 7, "last_activity_date": 1437330853, "last_edit_date": 1437330853, "creation_date": 1437330529, "answer_id": 31504516, "question_id": 31504456, "link": "https://stackoverflow.com/questions/31504456/how-can-i-pass-data-from-middleware-to-handlers/31504516#31504516", "title": "How can I pass data from middleware to handlers?", "body": "<p>A first approach, similar to the question, is in <a href=\"https://github.com/codemodus/chain\" rel=\"noreferrer\"><code>codemodus/chain</code></a> by <a href=\"https://github.com/daved\" rel=\"noreferrer\">Daved</a>.</p>\n\n<blockquote>\n  <p>Package chain aids the composition of Handler wrapper chains that carry request-scoped data.</p>\n</blockquote>\n\n<p>It uses the <a href=\"https://blog.golang.org/context\" rel=\"noreferrer\">notion of <code>Context</code></a>, coupled with a Context handler:</p>\n\n<pre><code>func ctxHandler(ctx context.Context, w http.ResponseWriter, r *http.Request) {\n    // ...\n\n    if s, ok := getMyString(ctx); ok {\n        // s = \"Send this down the line.\"\n    }\n\n    // ...\n}\n</code></pre>\n\n<hr>\n\n<p>Another approach: You can have a look at \"<a href=\"https://elithrar.github.io/article/custom-handlers-avoiding-globals/\" rel=\"noreferrer\">Custom Handlers and Avoiding Globals in Go Web Applications</a>\", by <a href=\"https://github.com/elithrar\" rel=\"noreferrer\">Matt Silverlock (<code>elithrar</code>)</a>. (<a href=\"https://gist.github.com/elithrar/5aef354a54ba71a32e23\" rel=\"noreferrer\">full example here</a>)</p>\n\n<p>The idea is to define <code>ServeHTTP</code> on a type which include the relevant context.</p>\n\n<pre><code>// We've turned our original appHandler into a struct with two fields:\n// - A function type similar to our original handler type (but that now takes an *appContext)\n// - An embedded field of type *appContext\ntype appHandler struct {\n    *appContext\n    h func(*appContext, http.ResponseWriter, *http.Request) (int, error)\n}\n\n// Our ServeHTTP method is mostly the same, and also has the ability to\n// access our *appContext's fields (templates, loggers, etc.) as well.\nfunc (ah appHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    // Updated to pass ah.appContext as a parameter to our handler type.\n    status, err := ah.h(ah.appContext, w, r)\n    if err != nil {\n        log.Printf(\"HTTP %d: %q\", status, err)\n        switch status {\n        case http.StatusNotFound:\n            http.NotFound(w, r)\n            // And if we wanted a friendlier error page, we can\n            // now leverage our context instance - e.g.\n            // err := ah.renderTemplate(w, \"http_404.tmpl\", nil)\n        case http.StatusInternalServerError:\n            http.Error(w, http.StatusText(status), status)\n        default:\n            http.Error(w, http.StatusText(status), status)\n        }\n    }\n}\n</code></pre>\n\n<p>In the <code>appContext</code> struct, you would put any data you want to pass around.</p>\n"}, {"comments": [{"owner": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "edited": false, "score": 0, "creation_date": 1611828862, "post_id": 31542773, "comment_id": 116577942, "body": "What&#39;s the upside vs. using built-in golang context directly?"}, {"owner": {"reputation": 3894, "user_id": 191347, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7226597774ed3751d939858a9affbd68?s=128&d=identicon&r=PG", "display_name": "Justin", "link": "https://stackoverflow.com/users/191347/justin"}, "reply_to_user": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "edited": false, "score": 1, "creation_date": 1612230935, "post_id": 31542773, "comment_id": 116696371, "body": "@KarelB&#237;lek Poster mentioned using the Gorilla toolkit, which had it&#39;s own context package that predated Go&#39;s (as did many other libraries). It is now in maintenance mode, and they recommend using the context package of Go.  Updated this answer to reflect, thx."}, {"owner": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "edited": false, "score": 0, "creation_date": 1612235296, "post_id": 31542773, "comment_id": 116697198, "body": "ah I missed the date. OK"}], "tags": [], "owner": {"reputation": 3894, "user_id": 191347, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7226597774ed3751d939858a9affbd68?s=128&d=identicon&r=PG", "display_name": "Justin", "link": "https://stackoverflow.com/users/191347/justin"}, "is_accepted": false, "score": 17, "last_activity_date": 1612231150, "last_edit_date": 1612231150, "creation_date": 1437490952, "answer_id": 31542773, "question_id": 31504456, "link": "https://stackoverflow.com/questions/31504456/how-can-i-pass-data-from-middleware-to-handlers/31542773#31542773", "title": "How can I pass data from middleware to handlers?", "body": "<p>Since you're already using <a href=\"http://www.gorillatoolkit.org\" rel=\"nofollow noreferrer\">Gorilla</a> take a look at the <a href=\"http://www.gorillatoolkit.org/pkg/context\" rel=\"nofollow noreferrer\">context</a> package.</p>\n<p><em>(This is nice if you don't want to change your method signatures.)</em></p>\n<pre><code>import (\n    &quot;github.com/gorilla/context&quot;\n)\n\n...\n\nfunc Middleware(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        // Middleware operations\n        // Parse body/get token.\n        context.Set(r, &quot;token&quot;, token)\n\n        next.ServeHTTP(w, r)\n    })\n}\n\n...\n\nfunc Handler() http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        token := context.Get(r, &quot;token&quot;)\n    })\n}\n</code></pre>\n<h3>Update</h3>\n<p>The Gorilla <code>context</code> package is now in maintenance mode<br />\n<em>per the repo:</em></p>\n<blockquote>\n<p>Note gorilla/context, having been born well before context.Context existed, does not play well with the shallow copying of the request that http.Request.WithContext (added to net/http Go 1.7 onwards) performs.</p>\n<p>Using gorilla/context may lead to memory leaks under those conditions, as the pointers to each http.Request become &quot;islanded&quot; and will not be cleaned up when the response is sent.</p>\n<p>You should use the http.Request.Context() feature in Go 1.7.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 1310, "user_id": 8620945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oNs64.jpg?s=128&g=1", "display_name": "Adam D", "link": "https://stackoverflow.com/users/8620945/adam-d"}, "edited": false, "score": 1, "creation_date": 1563266143, "post_id": 42877062, "comment_id": 100632631, "body": "Yes, this works great. You can find more examples and explanations here: <a href=\"https://gocodecloud.com/blog/2016/11/15/simple-golang-http-request-context-example/\" rel=\"nofollow noreferrer\">gocodecloud.com/blog/2016/11/15/&hellip;</a>"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 8, "last_activity_date": 1489855408, "creation_date": 1489855408, "answer_id": 42877062, "question_id": 31504456, "link": "https://stackoverflow.com/questions/31504456/how-can-i-pass-data-from-middleware-to-handlers/42877062#42877062", "title": "How can I pass data from middleware to handlers?", "body": "<p>The proper way to pass request scoped data would now be the context package in the standard library.</p>\n\n<p><a href=\"https://golang.org/pkg/context/\" rel=\"noreferrer\">https://golang.org/pkg/context/</a></p>\n\n<p>You can access it with request.Context on an http.Request.</p>\n"}], "owner": {"reputation": 287, "user_id": 4418309, "user_type": "registered", "accept_rate": 22, "profile_image": "https://i.stack.imgur.com/NqKTU.jpg?s=128&g=1", "display_name": "Dipen", "link": "https://stackoverflow.com/users/4418309/dipen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9758, "favorite_count": 2, "answer_count": 3, "score": 17, "last_activity_date": 1612231150, "creation_date": 1437330172, "question_id": 31504456, "link": "https://stackoverflow.com/questions/31504456/how-can-i-pass-data-from-middleware-to-handlers", "title": "How can I pass data from middleware to handlers?", "body": "<p>I am designing my handlers to return a http.Handler. Here's the design of my handlers:</p>\n\n<pre><code> func Handler() http.Handler {\n  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n  })\n}\n</code></pre>\n\n<p>My middleware is designed to accept an http.Handler and then call the handler once the middleware has finished performing its operations. Here's the design of my middleware:</p>\n\n<pre><code> func Middleware(next http.Handler) http.Handler {\n  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    // Middleware operations\n\n    next.ServeHTTP(w, r)\n  })\n}\n</code></pre>\n\n<p>Considering the design of my middleware and handlers, what is the proper way of passing information from the middleware to the handler? The information that I am trying to pass from my middleware to the handlers is a JSON web token parsed from the request body. If I do not pass the parsed JWT to the handler, then I will need to parse the JWT again in my handlers. Parsing the request body for a JWT in both the middleware and handler seems wasteful. Just in case this information is relevant, I am using the standard net/http library with gorilla mux. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "edited": false, "score": 2, "creation_date": 1437421770, "post_id": 31503742, "comment_id": 51011380, "body": "Never ever ever use float&#39;s for storing currency, its such a bad idea ! - See <a href=\"http://play.golang.org/p/TQBd4yJe6B\" rel=\"nofollow noreferrer\">play.golang.org/p/TQBd4yJe6B</a>"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 1, "creation_date": 1437457360, "post_id": 31503742, "comment_id": 51022781, "body": "I have amended my answer to propose an alternative."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1440234861, "post_id": 31503742, "comment_id": 52197101, "body": "You can checkout the leekchan/accounting project, using Go1.5 big.Float. See <a href=\"http://stackoverflow.com/a/31503800/6309\">my edited answer below</a>."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "edited": false, "score": 0, "creation_date": 1437328051, "post_id": 31503765, "comment_id": 50971022, "body": "it gets the decimals but not the commas"}, {"owner": {"reputation": 24080, "user_id": 1816093, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ZImpg.jpg?s=128&g=1", "display_name": "Drew", "link": "https://stackoverflow.com/users/1816093/drew"}, "edited": false, "score": 2, "creation_date": 1437329499, "post_id": 31503765, "comment_id": 50971482, "body": "perhaps FormatFloat(&quot;$#,###.##&quot;, the_float). I don&#39;t have go in front of me"}], "tags": [], "owner": {"reputation": 24080, "user_id": 1816093, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/ZImpg.jpg?s=128&g=1", "display_name": "Drew", "link": "https://stackoverflow.com/users/1816093/drew"}, "is_accepted": false, "score": 1, "last_activity_date": 1486298344, "last_edit_date": 1486298344, "creation_date": 1437325944, "answer_id": 31503765, "question_id": 31503742, "link": "https://stackoverflow.com/questions/31503742/how-do-i-format-a-currency-with-commas-and-2-decimal-places/31503765#31503765", "title": "How do I format a currency with commas and 2 decimal places?", "body": "<pre><code>fmt.Printf(\"%.2f\", 12.3456) \n</code></pre>\n\n<p>-- output is 12.34</p>\n"}, {"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1437326274, "post_id": 31503800, "comment_id": 50970480, "body": "This seems to be more practical than Commaf that the OP mentioned in <a href=\"https://github.com/dustin/go-humanize/issues/18#issuecomment-122625518\" rel=\"nofollow noreferrer\">github.com/dustin/go-humanize/issues/18#issuecomment-1226255&zwnj;&#8203;18</a>"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 9, "last_activity_date": 1440234815, "last_edit_date": 1495542741, "creation_date": 1437326182, "answer_id": 31503800, "question_id": 31503742, "link": "https://stackoverflow.com/questions/31503742/how-do-i-format-a-currency-with-commas-and-2-decimal-places/31503800#31503800", "title": "How do I format a currency with commas and 2 decimal places?", "body": "<p>That would be what the <a href=\"https://github.com/dustin/go-humanize/blob/00897f070f09f194c26d65afae734ba4c32404e8/number.go#L52-L65\" rel=\"nofollow noreferrer\">humanize.FormatFloat()</a> does:</p>\n\n<pre><code>// FormatFloat produces a formatted number as string based on the following user-specified criteria:\n// * thousands separator\n// * decimal separator\n// * decimal precision\n</code></pre>\n\n<p>In your case:</p>\n\n<pre><code>FormatFloat(\"$#,###.##\", afloat)\n</code></pre>\n\n<p>That being said, as <a href=\"https://stackoverflow.com/questions/31503742/how-do-i-format-a-currency-with-commas-and-2-decimal-places/31503800#comment51011380_31503742\">commented</a> by <a href=\"https://stackoverflow.com/users/41292/lenw\">LenW</a>, <code>float</code> (<a href=\"https://stackoverflow.com/a/24354495/6309\">in Go, <code>float64</code></a>) is not a good fit for currency.<br>\nSee <a href=\"http://floating-point-gui.de/\" rel=\"nofollow noreferrer\">floating-point-gui.de</a>.</p>\n\n<p>Using a package like <a href=\"https://github.com/go-inf/inf/tree/master\" rel=\"nofollow noreferrer\"><code>go-inf/inf</code></a> (previously go/dec, used for instance in <a href=\"https://github.com/fritzpay/paymentd/blob/b3f3fbb80176bc882e6e7ca21b0e56aea81add64/pkg/decimal/decimal.go#L6-L11\" rel=\"nofollow noreferrer\">this currency implementation</a>) is better.</p>\n\n<p>See <a href=\"https://github.com/go-inf/inf/blob/c85f1217d51339c0fa3a498cc8b2075de695dae6/dec.go#L35\" rel=\"nofollow noreferrer\">Dec.go</a>:</p>\n\n<pre><code>// A Dec represents a signed arbitrary-precision decimal.\n// It is a combination of a sign, an arbitrary-precision integer coefficient\n// value, and a signed fixed-precision exponent value.\n// The sign and the coefficient value are handled together as a signed value\n// and referred to as the unscaled value.\n</code></pre>\n\n<p>That type <code>Dec</code> does include <a href=\"https://github.com/go-inf/inf/blob/c85f1217d51339c0fa3a498cc8b2075de695dae6/dec.go#L459-L468\" rel=\"nofollow noreferrer\">a <code>Format()</code> method</a>.</p>\n\n<hr>\n\n<p>Since July 2015, you now have <strong><a href=\"https://github.com/leekchan/accounting\" rel=\"nofollow noreferrer\"><code>leekchan/accounting</code></a></strong> from <a href=\"https://github.com/leekchan\" rel=\"nofollow noreferrer\">Kyoung-chan Lee (<code>leekchan</code>)</a> with the same advice:</p>\n\n<blockquote>\n  <p>Please do not use <code>float64</code> to count money. Floats can have errors when you perform operations on them.<br>\n  Using <a href=\"https://golang.org/pkg/math/big/#Rat\" rel=\"nofollow noreferrer\"><code>big.Rat</code></a> (&lt; Go 1.5) or <a href=\"https://golang.org/pkg/math/big/#Float\" rel=\"nofollow noreferrer\"><code>big.Float</code></a> (>= Go 1.5) is highly recommended. (accounting supports <code>float64</code>, but it is just for convenience.)</p>\n</blockquote>\n\n<pre><code>fmt.Println(ac.FormatMoneyBigFloat(big.NewFloat(123456789.213123))) // \"$123,456,789.21\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "is_accepted": true, "score": 3, "last_activity_date": 1437422224, "creation_date": 1437422224, "answer_id": 31525248, "question_id": 31503742, "link": "https://stackoverflow.com/questions/31503742/how-do-i-format-a-currency-with-commas-and-2-decimal-places/31525248#31525248", "title": "How do I format a currency with commas and 2 decimal places?", "body": "<p>There is a good blog post about why you should never use floats to represent currency here - <a href=\"http://engineering.shopspring.com/2015/03/03/decimal/\" rel=\"nofollow\">http://engineering.shopspring.com/2015/03/03/decimal/</a></p>\n\n<p>From their examples you can : </p>\n\n<pre><code>  d := New(-12345, -3)\n  println(d.String())\n</code></pre>\n\n<p>Will give you : </p>\n\n<pre><code>-12.345\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1440000921, "post_id": 32092139, "comment_id": 52095787, "body": "Did you see the <a href=\"https://stackoverflow.com/questions/tagged/go\">go</a> tag on this question?? Non-Go code is not an answer."}], "tags": [], "owner": {"reputation": 332, "user_id": 3811125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MlDbt.jpg?s=128&g=1", "display_name": "Farah Nawaz", "link": "https://stackoverflow.com/users/3811125/farah-nawaz"}, "is_accepted": false, "score": -5, "last_activity_date": 1439977929, "creation_date": 1439977929, "answer_id": 32092139, "question_id": 31503742, "link": "https://stackoverflow.com/questions/31503742/how-do-i-format-a-currency-with-commas-and-2-decimal-places/32092139#32092139", "title": "How do I format a currency with commas and 2 decimal places?", "body": "<p>Try:</p>\n\n<pre><code>ToString(\"#,##0.00\");\n</code></pre>\n\n<p>or you can try this too:</p>\n\n<pre><code>int number = 1234567890;\nConvert.ToDecimal(number).ToString(\"#,##0.00\");\n</code></pre>\n\n<p>You will get the result like this 1,234,567,890.00.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8288, "favorite_count": 1, "accepted_answer_id": 31525248, "answer_count": 4, "score": 9, "last_activity_date": 1486298344, "creation_date": 1437325776, "question_id": 31503742, "link": "https://stackoverflow.com/questions/31503742/how-do-i-format-a-currency-with-commas-and-2-decimal-places", "title": "How do I format a currency with commas and 2 decimal places?", "body": "<p>I am trying to format some numbers as a currency, with commas and 2 decimal places. I've found \"github.com/dustin/go-humanize\" for the commas but it doesn't allow for specifying the number of decimal places. fmt.Sprintf will do the currency and decimal formatting but not the commas. </p>\n\n<pre><code>for _, fl := range []float64{123456.789, 123456.0, 123456.0100} {\n    log.Println(humanize.Commaf(fl))\n  }\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>123,456.789\n123,456\n123,456.01\n</code></pre>\n\n<p>I am expecting:</p>\n\n<pre><code>$123,456.79\n$123,456.00\n$123,456.01\n</code></pre>\n"}, {"tags": ["go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "is_accepted": false, "score": 0, "last_activity_date": 1437325130, "creation_date": 1437325130, "answer_id": 31503648, "question_id": 31502195, "link": "https://stackoverflow.com/questions/31502195/mgo-query-objectid-for-range-of-time-values/31503648#31503648", "title": "mgo: Query ObjectId for range of time values", "body": "<p>You should add a <code>date</code> field into the documents, over which you can query. That is the easiest option.</p>\n\n<pre><code>type Post struct {\n    Id bson.ObjectId `bson:\"_id\"`\n    date time.Time `bson:\"date\"`\n}\n</code></pre>\n\n<p>Then you can write your queries over the date object.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user2312578"}, "is_accepted": true, "score": 1, "last_activity_date": 1437488746, "creation_date": 1437488746, "answer_id": 31541855, "question_id": 31502195, "link": "https://stackoverflow.com/questions/31502195/mgo-query-objectid-for-range-of-time-values/31541855#31541855", "title": "mgo: Query ObjectId for range of time values", "body": "<p>Here's how you do it.</p>\n\n<ul>\n<li>Assemble fromDate and toDate.</li>\n<li>Create <code>bson.ObjectId</code> with <code>bson.NewObjectIdWithTime()</code></li>\n<li>Query for date range</li>\n</ul>\n\n<p>Example: Query for posts created 2015</p>\n\n<pre><code>year := 2015\nfromDate := time.Date(year, time.January, 1, 0, 0, 0, 0, time.UTC)\ntoDate := time.Date(year+1, time.January, 1, 0, 0, 0, 0, time.UTC)\nfromId := bson.NewObjectIdWithTime(fromDate)\ntoId := bson.NewObjectIdWithTime(toDate)\nposts := []*Post{}\nif e := cPost.Find(bson.M{\"_id\": bson.M{\"$gte\": fromId, \"$lt\": toId}}).All(&amp;posts); e != nil {\n}\n</code></pre>\n\n<p>note: Because <code>ObjectId</code> isn't <code>ISODate</code> assemble <code>ObjectId</code> from <code>ISODate</code></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2312578"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1059, "favorite_count": 0, "accepted_answer_id": 31541855, "answer_count": 2, "score": 0, "last_activity_date": 1437488746, "creation_date": 1437315767, "last_edit_date": 1495539832, "question_id": 31502195, "link": "https://stackoverflow.com/questions/31502195/mgo-query-objectid-for-range-of-time-values", "title": "mgo: Query ObjectId for range of time values", "body": "<p>Ok, say you have a number of posts</p>\n\n<pre><code>type Post struct {\n    Id bson.ObjectId `bson:\"_id,omitempty\"`\n}\n</code></pre>\n\n<p>and each post of course has a unique id that was created at a certain time.</p>\n\n<p>I can get the time value with <code>post.Id.Time()</code>.</p>\n\n<p>However how do I query for posts from let's say the year 2015?</p>\n\n<p>And how would I do a range query for posts since 01.01.2014-31.12.2015?</p>\n\n<p>I would assume that I need to iterate over results, check if <code>post.Id.Time()</code> is between 01.01.2014 and 31.12.2015 and if it is add it to a posts slice.</p>\n\n<p>Is there a less complicated way to search for posts made between certain ranges or at a certain date using the mgo driver?</p>\n\n<p>If there isn't I will accept No as an answer. If there is I will accept and answer that shows how, with code example.</p>\n\n<p>I have found this post on Stackoverflow:<a href=\"https://stackoverflow.com/questions/26773979/how-can-i-query-mongodb-with-date-range-using-mgo-and-go\">1</a></p>\n\n<p>However I don't know how this would apply to a bson.ObjectId since they type isn't time.Time but bson.ObjectId.</p>\n"}, {"tags": ["algorithm", "go", "primes"], "comments": [{"owner": {"reputation": 61404, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 1, "creation_date": 1437306352, "post_id": 31499007, "comment_id": 50964690, "body": "have you tried running it standalone, say on ideone.com, with your own input, and checking the answers?"}, {"owner": {"reputation": 10774, "user_id": 2741705, "user_type": "registered", "profile_image": "https://graph.facebook.com/1478197909/picture?type=large", "display_name": "Pham Trung", "link": "https://stackoverflow.com/users/2741705/pham-trung"}, "edited": false, "score": 0, "creation_date": 1437318553, "post_id": 31499007, "comment_id": 50967969, "body": "Can you explain more about ur approach?"}, {"owner": {"reputation": 537, "user_id": 2382404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f61bf3fa5a8f6649f3dffd02e0473bb7?s=128&d=identicon&r=PG", "display_name": "Freeznet", "link": "https://stackoverflow.com/users/2382404/freeznet"}, "reply_to_user": {"reputation": 61404, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "edited": false, "score": 0, "creation_date": 1437319284, "post_id": 31499007, "comment_id": 50968197, "body": "@WillNess sure I did, I tested different data range, such as primes from 1 to 100, -100 to -1, 100 to 5000, 10000 to 110000 etc, all answers are correct."}, {"owner": {"reputation": 537, "user_id": 2382404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f61bf3fa5a8f6649f3dffd02e0473bb7?s=128&d=identicon&r=PG", "display_name": "Freeznet", "link": "https://stackoverflow.com/users/2382404/freeznet"}, "reply_to_user": {"reputation": 10774, "user_id": 2741705, "user_type": "registered", "profile_image": "https://graph.facebook.com/1478197909/picture?type=large", "display_name": "Pham Trung", "link": "https://stackoverflow.com/users/2741705/pham-trung"}, "edited": false, "score": 0, "creation_date": 1437319618, "post_id": 31499007, "comment_id": 50968319, "body": "@PhamTrung according to the problem, we need print out prime numbers in a given range, in order to reduce the time consumption and memory consumption, I use a modified <a href=\"https://en.wikipedia.org/wiki/Sieve_of_Eratosthenes\" rel=\"nofollow noreferrer\">Sieve of Eratosthenes</a> algorithm. Firstly, find the <code>max_n</code> and <code>max_m</code>, so we can use it to generate a Eratosthenes array range from 1 to <code>sort(max_n)</code>, then we can inferring the non-prime number to the requested range."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1437322899, "post_id": 31499007, "comment_id": 50969410, "body": "Running your code with the provided example input does <i>not</i> produce the required output and should clearly show you at least one problem (the 3 5 test case gives only 3 with your code)."}, {"owner": {"reputation": 537, "user_id": 2382404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f61bf3fa5a8f6649f3dffd02e0473bb7?s=128&d=identicon&r=PG", "display_name": "Freeznet", "link": "https://stackoverflow.com/users/2382404/freeznet"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437324549, "post_id": 31499007, "comment_id": 50969937, "body": "@DaveC ohh... I located the problem... thanks! stupid me!"}, {"owner": {"reputation": 61404, "user_id": 849891, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MbEO3.png?s=128&g=1", "display_name": "Will Ness", "link": "https://stackoverflow.com/users/849891/will-ness"}, "reply_to_user": {"reputation": 10774, "user_id": 2741705, "user_type": "registered", "profile_image": "https://graph.facebook.com/1478197909/picture?type=large", "display_name": "Pham Trung", "link": "https://stackoverflow.com/users/2741705/pham-trung"}, "edited": false, "score": 0, "creation_date": 1437339400, "post_id": 31499007, "comment_id": 50974597, "body": "@PhamTrung re your answer, there are so few core primes below the square root that  it won&#39;t matter if you find them with trial division instead of the sive."}], "answers": [{"tags": [], "owner": {"reputation": 537, "user_id": 2382404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f61bf3fa5a8f6649f3dffd02e0473bb7?s=128&d=identicon&r=PG", "display_name": "Freeznet", "link": "https://stackoverflow.com/users/2382404/freeznet"}, "is_accepted": true, "score": 1, "last_activity_date": 1437362229, "creation_date": 1437362229, "answer_id": 31508359, "question_id": 31499007, "link": "https://stackoverflow.com/questions/31499007/prime-generator-program-spoj-wrong-answer/31508359#31508359", "title": "Prime generator program SPOJ wrong answer", "body": "<p>according to the comments, the output for each prime number range is always have one line short, so here is the ACCEPTED solution</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc main() {\n    var k, j, i, max_m, max_n, test_cases, kase int64\n    fmt.Scanln(&amp;test_cases)\n    case_m, case_n := make([]int64, test_cases), make([]int64, test_cases)\n    EratosthenesArray := make(map[int64][]bool)\n    max_m = 0\n    max_n = 0\n    for i = 0; i &lt; test_cases; i++ {\n        fmt.Scanf(\"%d %d\", &amp;case_m[i], &amp;case_n[i])\n        if case_m[i] &gt; case_n[i] {\n            case_m[i] = 0\n            case_n[i] = 0\n        }\n        if max_m &lt; case_m[i] {\n            max_m = case_m[i]\n        }\n        if max_n &lt; case_n[i] {\n            max_n = case_n[i]\n        }\n        length := case_n[i] - case_m[i] + 1\n        EratosthenesArray[i] = make([]bool, length)\n    }\n\n    if max_m &lt;= max_n {\n        upperbound := int64(math.Sqrt(float64(max_n)))\n        UpperboundArray := make([]bool, upperbound+1)\n        for i = 2; i &lt;= upperbound; i++ {\n            if !UpperboundArray[i] {\n                for k = i * i; k &lt;= upperbound; k += i {\n                    UpperboundArray[k] = true\n                }\n                for kase = 0; kase &lt; test_cases; kase++ {\n                    start := (case_m[kase] - i*i) / i\n\n                    if case_m[kase]-i*i &lt; 0 {\n                        start = i\n                    }\n                    for k = start * i; k &lt;= case_n[kase]; k += i {\n                        if k &gt;= case_m[kase] &amp;&amp; k &lt;= case_n[kase] {\n                            EratosthenesArray[kase][k-case_m[kase]] = true\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    for i = 0; i &lt; test_cases; i++ {\n        k = 0\n        for j = 0; j &lt;= case_n[i]-case_m[i]; j++ {\n            if !EratosthenesArray[i][j] {\n                ret := case_m[i] + j\n                if ret &gt; 1 {\n                    fmt.Println(ret)\n                }\n            }\n        }\n        fmt.Println()\n    }\n}\n</code></pre>\n\n<p>Note that I only changed one line from <code>for j = 0; j &lt; case_n[i]-case_m[i]; j++ {</code> to <code>for j = 0; j &lt;= case_n[i]-case_m[i]; j++ {</code></p>\n\n<p>And the execution time is about 1.08s, memory is about 772M (but seems the initial memory for golang in spoj is 771M, so it might be about 1M memory usage)</p>\n"}], "owner": {"reputation": 537, "user_id": 2382404, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f61bf3fa5a8f6649f3dffd02e0473bb7?s=128&d=identicon&r=PG", "display_name": "Freeznet", "link": "https://stackoverflow.com/users/2382404/freeznet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 31508359, "answer_count": 1, "score": 0, "last_activity_date": 1437362229, "creation_date": 1437291541, "last_edit_date": 1592644375, "question_id": 31499007, "link": "https://stackoverflow.com/questions/31499007/prime-generator-program-spoj-wrong-answer", "title": "Prime generator program SPOJ wrong answer", "body": "<h1>Problem Statement</h1>\n<blockquote>\n<p><strong>Input</strong></p>\n<p>The input begins with the number t of test cases in a single line\n(t&lt;=10). In each of the next t lines there are two numbers m and n (1\n&lt;= m &lt;= n &lt;= 1000000000, n-m&lt;=100000) separated by a space.</p>\n<p><strong>Output</strong></p>\n<p>For every test case print all prime numbers p such that m &lt;= p &lt;= n,\none number per line, test cases separated by an empty line.</p>\n<p><strong>Example</strong></p>\n<p>Input:</p>\n<pre><code>2\n1 10\n3 5\n</code></pre>\n<p>Output:</p>\n<pre><code>2\n3\n5\n7\n\n3\n5\n</code></pre>\n</blockquote>\n<p><strong>My Problem</strong></p>\n<p>I have tried to write this problem with <code>golang</code>, at beginning I got time limit exceed error, then I solved it with finding the biggest <code>n</code> and only generate prime once. But now I got wrong answer error. Anyone can help to to find the bug? I can't figure it out. Thanks.</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;math&quot;\n)\n\nfunc main() {\n    var k, j, i, max_m, max_n, test_cases, kase int64\n    fmt.Scanln(&amp;test_cases)\n    case_m, case_n := make([]int64, test_cases), make([]int64, test_cases)\n    EratosthenesArray := make(map[int64][]bool)\n    max_m = 0\n    max_n = 0\n    for i = 0; i &lt; test_cases; i++ {\n        fmt.Scanf(&quot;%d %d&quot;, &amp;case_m[i], &amp;case_n[i])\n        if case_m[i] &gt; case_n[i] {\n            case_m[i] = 0\n            case_n[i] = 0\n        }\n        if max_m &lt; case_m[i] {\n            max_m = case_m[i]\n        }\n        if max_n &lt; case_n[i] {\n            max_n = case_n[i]\n        }\n        length := case_n[i] - case_m[i] + 1\n        EratosthenesArray[i] = make([]bool, length)\n    }\n\n    if max_m &lt;= max_n {\n        upperbound := int64(math.Sqrt(float64(max_n)))\n        UpperboundArray := make([]bool, upperbound+1)\n        for i = 2; i &lt;= upperbound; i++ {\n            if !UpperboundArray[i] {\n                for k = i * i; k &lt;= upperbound; k += i {\n                    UpperboundArray[k] = true\n                }\n                for kase = 0; kase &lt; test_cases; kase++ {\n                    start := (case_m[kase] - i*i) / i\n\n                    if case_m[kase]-i*i &lt; 0 {\n                        start = i\n                    }\n                    for k = start * i; k &lt;= case_n[kase]; k += i {\n                        if k &gt;= case_m[kase] &amp;&amp; k &lt;= case_n[kase] {\n                            EratosthenesArray[kase][k-case_m[kase]] = true\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    for i = 0; i &lt; test_cases; i++ {\n        k = 0\n        for j = 0; j &lt; case_n[i]-case_m[i]; j++ {\n            if !EratosthenesArray[i][j] {\n                ret := case_m[i] + j\n                if ret &gt; 1 {\n                    fmt.Println(ret)\n                }\n            }\n        }\n        fmt.Println()\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "redis"], "comments": [{"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1437287911, "post_id": 31498296, "comment_id": 50960767, "body": "Your code snippet works for me. It printed a bunch of keys in the first iteration."}], "answers": [{"comments": [{"owner": {"reputation": 2671, "user_id": 33991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9770614c66b56331b6947c79b622a7af?s=128&d=identicon&r=PG", "display_name": "FGM", "link": "https://stackoverflow.com/users/33991/fgm"}, "edited": false, "score": 0, "creation_date": 1584033755, "post_id": 31499121, "comment_id": 107319470, "body": "Note that in current releases (03/2020), <code>MultiBulk</code> is deprecated: the exemple works the same with <code>Values</code> instead."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 13, "last_activity_date": 1437300737, "last_edit_date": 1437300737, "creation_date": 1437292618, "answer_id": 31499121, "question_id": 31498296, "link": "https://stackoverflow.com/questions/31498296/how-to-scan-keys-from-redis-using-golang-using-scan-not-keys/31499121#31499121", "title": "How to scan keys from redis using golang using &quot;SCAN&quot; not &quot;KEYS&quot;", "body": "<p>The thing about the SCAN command is that it doesn't just return a bunch of keys, but it returns an \"iterator\" number that you should put in your next call to SCAN. so the structure of the reply can be seen as</p>\n\n<pre><code>[ iterator, [k1, k2, ... k10] ]\n</code></pre>\n\n<p>You start by calling <code>SCAN 0</code> and in consecutive calls you need to call <code>SCAN &lt;iterator&gt;</code>.</p>\n\n<p>Doing this using redigo goes like this (my error handling is incorrect, but this is just to show the idea):</p>\n\n<pre><code>// here we'll store our iterator value\niter := 0\n\n// this will store the keys of each iteration\nvar keys []string\nfor {\n\n    // we scan with our iter offset, starting at 0\n    if arr, err := redis.MultiBulk(conn.Do(\"SCAN\", iter)); err != nil {\n        panic(err)\n    } else {\n\n        // now we get the iter and the keys from the multi-bulk reply\n        iter, _ = redis.Int(arr[0], nil)\n        keys, _ = redis.Strings(arr[1], nil)\n    }\n\n    fmt.Println(keys)\n\n    // check if we need to stop...\n    if iter == 0  {\n        break\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 4129156, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RKHULpH6JiE/AAAAAAAAAAI/AAAAAAAABY0/402SkRPAsp8/photo.jpg?sz=128", "display_name": "Pravin Haldankar", "link": "https://stackoverflow.com/users/4129156/pravin-haldankar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7415, "favorite_count": 2, "accepted_answer_id": 31499121, "answer_count": 1, "score": 4, "last_activity_date": 1437311161, "creation_date": 1437283852, "last_edit_date": 1437311161, "question_id": 31498296, "link": "https://stackoverflow.com/questions/31498296/how-to-scan-keys-from-redis-using-golang-using-scan-not-keys", "title": "How to scan keys from redis using golang using &quot;SCAN&quot; not &quot;KEYS&quot;", "body": "<p>This is My Code</p>\n\n<pre><code>redisPool := redis.NewPool(func() (redis.Conn, error) {\n        con, err := redis.Dial(\"tcp\", *redisAddress)\n        con.Do(\"SELECT\", 0)\n        if err != nil {\n            return nil, err\n        }\n        return con, err\n    }, *maxConnections)\n    fmt.Println(\"Redis Connection Establ...!\")\n    con := redisPool.Get()\n    data, err1 := con.Do(\"scan\", \"0\")\n    //data, err1 := con.Do(\"KEYS\", \"*\")\n    if err1 != nil {\n        fmt.Println(err1)\n    } else {\n        fmt.Println(reflect.TypeOf(data))\n        fmt.Println(data)\n    }\n</code></pre>\n\n<p>my output is not coming in string</p>\n"}, {"tags": ["list", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1437320822, "post_id": 31498004, "comment_id": 50968681, "body": "In addition to <a href=\"http://stackoverflow.com/a/31498076/55504\">OneOfOne&#39;s answer</a>, abusing the string representation of integers like this is silly, slow, and won&#39;t work (e.g. {123, 12} --&gt; &quot;123&quot; --&gt; {1, 2, 3}). If you want fast duplicate detection you want a set type which in Go usually means a map. E.g. with a <code>var m map[int]bool</code> and then something like <code>m[e.Value.(int)] = true</code> in the loop and finally <code>for v := range m { newList.PushBack(v) }</code>."}, {"owner": {"reputation": 4504, "user_id": 3681199, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/70b2072de3d0d43e1af48fd2d416157f?s=128&d=identicon&r=PG&f=1", "display_name": "Nona", "link": "https://stackoverflow.com/users/3681199/nona"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437347736, "post_id": 31498004, "comment_id": 50976550, "body": "thanks Dave, great point.  I&#39;m so new to static typed languages &amp; Go that I&#39;m grasping at straws at times, just trying to do anything I can to speed up the learning"}], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 1, "last_activity_date": 1437282149, "last_edit_date": 1437282149, "creation_date": 1437281154, "answer_id": 31498076, "question_id": 31498004, "link": "https://stackoverflow.com/questions/31498004/why-am-i-getting-interface-conversion-interface-is-int32-for-converting-a-lis/31498076#31498076", "title": "Why am I getting &quot;interface conversion: interface is int32&quot; for converting a list integer element to a string?", "body": "<p><code>rune</code> is aliased to <code>int32</code>, </p>\n\n<pre><code>for _, c := range dupString {\n    newList.PushBack(c) // c is a rune aka int32\n}\n</code></pre>\n\n<p>is pushing <code>int32</code>s, while <code>int</code> is aliased to <code>int64</code> on 64bit CPUs, so one way to do it is to just force the type:</p>\n\n<pre><code>for _, c := range dupString {\n    newList.PushBack(int(c))\n}\n</code></pre>\n"}], "owner": {"reputation": 4504, "user_id": 3681199, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/70b2072de3d0d43e1af48fd2d416157f?s=128&d=identicon&r=PG&f=1", "display_name": "Nona", "link": "https://stackoverflow.com/users/3681199/nona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 31498076, "answer_count": 1, "score": -1, "last_activity_date": 1437282149, "creation_date": 1437280211, "question_id": 31498004, "link": "https://stackoverflow.com/questions/31498004/why-am-i-getting-interface-conversion-interface-is-int32-for-converting-a-lis", "title": "Why am I getting &quot;interface conversion: interface is int32&quot; for converting a list integer element to a string?", "body": "<p>New to Go...I wrote a program to remove duplicate integers stored in a list.  When I run the following test for the removeDuplicates function, I get the following error which points to this line: <em>testString += strconv.Itoa(e.Value.(int))</em> in <em>linked_test.go</em>.  Why is this and how do I fix it?  I store integers in <em>testList</em> and fetch them with e.Value and typecast with <em>.(int)</em>.</p>\n\n<pre><code>panic: interface conversion: interface is int32, not int [recovered]\n    panic: interface conversion: interface is int32, not int\n</code></pre>\n\n<p><strong>linked_test.go</strong></p>\n\n<pre><code>package linked\n\nimport (\n    \"container/list\"\n    \"strconv\"\n    \"testing\"\n)\n\nfunc TestDuplicates(t *testing.T) {\n    var (\n        testList           = list.New()\n        exampleList        = list.New()\n        testString  string = \"\"\n    )\n    testList.PushBack(1)\n    testList.PushBack(2)\n    testList.PushBack(3)\n    testList.PushBack(2)\n    exampleList = removeDuplicates(testList)\n    for e := exampleList.Front(); e.Next() != nil; e = e.Next() {\n        testString += strconv.Itoa(e.Value.(int))\n    }\n    if testString != \"123\" {\n        t.Fatalf(\"removeDuplicates failed\")\n    }\n}\n</code></pre>\n\n<p><strong>linked.go</strong></p>\n\n<pre><code>package linked\n\nimport (\n    \"container/list\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc removeDuplicates(l *list.List) *list.List {\n    var newList = list.New()\n    var dupString string = \"\"\n    for e := l.Front(); e.Next() != nil; e = e.Next() {\n        if strings.Index(dupString, strconv.Itoa(e.Value.(int))) == -1 {\n            dupString += strconv.Itoa(e.Value.(int))\n        }\n    }\n    for _, c := range dupString {\n        newList.PushBack(c)\n    }\n    return newList\n}\n</code></pre>\n"}, {"tags": ["memory", "go"], "comments": [{"owner": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "edited": false, "score": 0, "creation_date": 1437267924, "post_id": 31496804, "comment_id": 50957563, "body": "Quick question, isn&#39;t struct <code>ASDF</code> fixed size since you declare all variable types? Then you can just multiply the size of the struct pointer of <code>ASDF</code> by <code>len(a)</code>? As you can only append same sized element into slice? Or do I misunderstand how slice work?"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 1, "creation_date": 1437292684, "post_id": 31496804, "comment_id": 50961580, "body": "There would be a problem with <code>string</code> field though."}], "answers": [{"comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1437265617, "post_id": 31496809, "comment_id": 50957194, "body": "The <a href=\"http://golang.org/pkg/builtin/#len\" rel=\"nofollow noreferrer\"><code>len(...)</code></a> function only seems to work with arrays, strings, slices, and channels.  No help with structs =("}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "reply_to_user": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1437265654, "post_id": 31496809, "comment_id": 50957199, "body": "@maerics Just to have a better understanding of what you are trying to achieve, what do you believe this information to be useful for?"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 1, "creation_date": 1437265699, "post_id": 31496809, "comment_id": 50957207, "body": "@FUZxxl: no idea, ask OP =)  I&#39;m just commenting from the peanut gallery"}], "tags": [], "owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "is_accepted": false, "score": 2, "last_activity_date": 1437265970, "last_edit_date": 1437265970, "creation_date": 1437265116, "answer_id": 31496809, "question_id": 31496804, "link": "https://stackoverflow.com/questions/31496804/how-to-get-the-size-of-struct-and-its-contents-in-bytes-in-golang/31496809#31496809", "title": "How to get the size of struct and its contents in bytes in golang?", "body": "<p>I'm afraid to say that <code>unsafe.Sizeof</code> is the way to go here if you want to get any result at all. The in-memory size of a structure is nothing you should rely on. Notice that even the result of <code>unsafe.Sizeof</code> is inaccurate: The runtime may add headers to the data that you cannot observe to aid with garbage collection.</p>\n\n<p>For your particular example (finding a cache size) I suggest you to go with a static size that is sensible for many processors. In almost all cases doing such micro-optimizations is not going to pay itself off.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 6, "last_activity_date": 1437270213, "last_edit_date": 1437270213, "creation_date": 1437269912, "answer_id": 31497191, "question_id": 31496804, "link": "https://stackoverflow.com/questions/31496804/how-to-get-the-size-of-struct-and-its-contents-in-bytes-in-golang/31497191#31497191", "title": "How to get the size of struct and its contents in bytes in golang?", "body": "<p>Sum the size of all memory, excluding garbage collector and other overhead. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype ASDF struct {\n    A uint64\n    B uint64\n    C uint64\n    D uint64\n    E uint64\n    F string\n}\n\nfunc (s *ASDF) size() int {\n    size := int(unsafe.Sizeof(*s))\n    size += len(s.F)\n    return size\n}\n\nfunc sizeASDF(s []ASDF) int {\n    size := 0\n    s = s[:cap(s)]\n    size += cap(s) * int(unsafe.Sizeof(s))\n    for i := range s {\n        size += (&amp;s[i]).size()\n    }\n    return size\n}\n\nfunc main() {\n    a := []ASDF{}\n\n    b := ASDF{}\n    b.A = 1\n    b.B = 2\n    b.C = 3\n    b.D = 4\n    b.E = 5\n    b.F = \"ASrtertetetetetetetDF\"\n    fmt.Println((&amp;b).size())\n    a = append(a, b)\n\n    c := ASDF{}\n    c.A = 10\n    c.B = 20\n    c.C = 30\n    c.D = 40\n    c.E = 50\n    c.F = \"ASetDF\"\n    fmt.Println((&amp;c).size())\n    a = append(a, c)\n\n    fmt.Println(len(a))\n    fmt.Println(cap(a))\n    fmt.Println(sizeASDF(a))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>69\n54\n2\n2\n147\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/5z30vkyuNM\" rel=\"noreferrer\">http://play.golang.org/p/5z30vkyuNM</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1529891"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17607, "favorite_count": 1, "accepted_answer_id": 31497191, "answer_count": 2, "score": 11, "last_activity_date": 1437270213, "creation_date": 1437265016, "last_edit_date": 1437265613, "question_id": 31496804, "link": "https://stackoverflow.com/questions/31496804/how-to-get-the-size-of-struct-and-its-contents-in-bytes-in-golang", "title": "How to get the size of struct and its contents in bytes in golang?", "body": "<p>I have a struct, say:</p>\n\n<pre><code>type ASDF struct {\n    A   uint64\n    B   uint64\n    C   uint64\n    D   uint64\n    E   uint64\n    F   string\n}\n</code></pre>\n\n<p>I create a slice of that struct: <code>a := []ASDF{}</code></p>\n\n<p>I do operations on that slice of the struct (adding/removing/updating structs that vary in contents); how can I get the total size <em>in bytes</em> (for memory) of the slice and its contents? Is there a built-in to do this or do I need to manually run a calculation using <code>unsafe.Sizeof</code> and then <code>len</code> each string?</p>\n"}, {"tags": ["rest", "go"], "answers": [{"comments": [{"owner": {"reputation": 2258, "user_id": 1952811, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/3d2de061c9d12cd53ff7674556694d8a?s=128&d=identicon&r=PG", "display_name": "user1952811", "link": "https://stackoverflow.com/users/1952811/user1952811"}, "edited": false, "score": 0, "creation_date": 1437264557, "post_id": 31496730, "comment_id": 50957028, "body": "Why do you think this is a better way?"}, {"owner": {"reputation": 24278, "user_id": 6013, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/2c21bed614c58c9e1c48fe272e79efd2?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/6013/joshua"}, "reply_to_user": {"reputation": 2258, "user_id": 1952811, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/3d2de061c9d12cd53ff7674556694d8a?s=128&d=identicon&r=PG", "display_name": "user1952811", "link": "https://stackoverflow.com/users/1952811/user1952811"}, "edited": false, "score": 0, "creation_date": 1437265523, "post_id": 31496730, "comment_id": 50957176, "body": "packages in go are not meant to be super fine grained"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1437266033, "post_id": 31496730, "comment_id": 50957254, "body": "I wrote about cycles a bunch <a href=\"http://stackoverflow.com/questions/20380333/cyclic-dependencies-and-interfaces-in-golang/20394211#20394211\">here</a>, including a user/group example near the end, and an example of a biggish Go package (<code>net&#47;http</code>) near the top. In the example there I also tried to say how you could prevent a cycle if the types were in two packages, but really I should edit that to more emphasize that you should maybe stick to one--if you can&#39;t conceive of users without groups or groups without users and they&#39;re both at the same &quot;layer&quot; of your app, probably want to package together."}], "tags": [], "owner": {"reputation": 24278, "user_id": 6013, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/2c21bed614c58c9e1c48fe272e79efd2?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/6013/joshua"}, "is_accepted": false, "score": 5, "last_activity_date": 1437264048, "creation_date": 1437264048, "answer_id": 31496730, "question_id": 31496665, "link": "https://stackoverflow.com/questions/31496665/merge-two-packages-or-try-to-solve-circular-dependency-in-go-lang/31496730#31496730", "title": "Merge two packages or try to solve circular dependency in Go lang", "body": "<p>Put them in the same package, but leave them in separate files.</p>\n"}, {"tags": [], "owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "is_accepted": false, "score": 0, "last_activity_date": 1437325653, "creation_date": 1437325653, "answer_id": 31503730, "question_id": 31496665, "link": "https://stackoverflow.com/questions/31496665/merge-two-packages-or-try-to-solve-circular-dependency-in-go-lang/31503730#31503730", "title": "Merge two packages or try to solve circular dependency in Go lang", "body": "<p>What I have done in the same situation is:</p>\n\n<p>I put the structures alone into a separate package <code>models</code>, which contains the structures for both as <code>userModel.go</code> and <code>groupModel.go</code> and have kept the functions related to <code>user</code> and <code>group</code> in their own package.</p>\n\n<p>Both <code>user</code> and <code>group</code> packages include the <code>model</code> package. </p>\n\n<p>However, this is a very opinionated answer. As <code>Joshua's post says</code>, we can also put everything together. The deciding factor should be, whether <code>user</code> and <code>group</code> functionalities would be used in other packages outside them or not. If so, then to keep a model package would have its benefits.</p>\n"}], "owner": {"reputation": 2258, "user_id": 1952811, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/3d2de061c9d12cd53ff7674556694d8a?s=128&d=identicon&r=PG", "display_name": "user1952811", "link": "https://stackoverflow.com/users/1952811/user1952811"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 282, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1437325653, "creation_date": 1437263390, "question_id": 31496665, "link": "https://stackoverflow.com/questions/31496665/merge-two-packages-or-try-to-solve-circular-dependency-in-go-lang", "title": "Merge two packages or try to solve circular dependency in Go lang", "body": "<p>I'm creating a REST API, and I've separated each resource into it's own package. I've got a <code>User</code> and a <code>Group</code> package. There is a many to many relationship between the two resources. So I need <code>User</code> imported into the <code>Group</code> and <code>Group</code> imported to the <code>User</code>. Since both structs need them as fields. </p>\n\n<p>My question is, should I create another package and import both and then import that package into each of these packages? </p>\n\n<p>Or does it make more sense to combine these two packages into one in go lang? </p>\n"}, {"tags": ["git", "go", "libgit2"], "comments": [{"owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "edited": false, "score": 0, "creation_date": 1437422345, "post_id": 31496175, "comment_id": 51011714, "body": "What error are you seeing ?"}, {"owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "reply_to_user": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "edited": false, "score": 0, "creation_date": 1437433557, "post_id": 31496175, "comment_id": 51016739, "body": "Please see the updates on the question."}, {"owner": {"reputation": 63488, "user_id": 729881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fdfaf0aad74fef442e2ffc9999ef9c1?s=128&d=identicon&r=PG", "display_name": "Edward Thomson", "link": "https://stackoverflow.com/users/729881/edward-thomson"}, "edited": false, "score": 0, "creation_date": 1437453546, "post_id": 31496175, "comment_id": 51021672, "body": "Why are you doing a checkout at all?  <code>git checkout -b</code> (despite the name) merely creates a new branch and sets <code>HEAD</code> to that.  What do you want your checkout to do?"}, {"owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "edited": false, "score": 0, "creation_date": 1437454750, "post_id": 31496175, "comment_id": 51021985, "body": "@Sthe thanks for the update - still not sure what error you get?"}, {"owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "edited": false, "score": 0, "creation_date": 1437471853, "post_id": 31496175, "comment_id": 51030681, "body": "I&#39;m not getting an error, but you know when you run <code>git checkout &lt;somebranch&gt;</code>, the files on the working directory get updated based on what on the working tree of that branch (I believe)? That&#39;s the effect I&#39;m looking for."}], "answers": [{"tags": [], "owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "is_accepted": true, "score": 3, "last_activity_date": 1438255366, "creation_date": 1438255366, "answer_id": 31722440, "question_id": 31496175, "link": "https://stackoverflow.com/questions/31496175/git2go-simulate-git-checkout-and-an-immediate-git-push/31722440#31722440", "title": "Git2go: Simulate git checkout and an immediate git push", "body": "<p>I finally got it working. Here is the code if anyone is wondering about the same thing:</p>\n\n<p><strong>git checkout</strong></p>\n\n<pre><code>head, err := repository.Head()\nif err != nil {\n    return err\n}\n\nheadCommit, err := repository.LookupCommit(head.Target())\nif err != nil {\n    return err\n}\n\n_, err = cs.repository.CreateBranch(name, headCommit, false)\nif err != nil {\n    return err\n}\n\n_, err = cs.repository.References.CreateSymbolic(\"HEAD\",\"refs/heads/\"+name, true, \"headOne\")\nif err != nil {\n    return err\n}\n\nopts := &amp;git.CheckoutOpts{\n    Strategy: git.CheckoutSafe | git.CheckoutRecreateMissing,\n}\nif err := repository.CheckoutHead(opts); err != nil {\n    return err\n}\n</code></pre>\n\n<p><strong>git push</strong></p>\n\n<pre><code>// Get remote\nremote, err := repo.Remotes.Lookup(\"origin\")\nif err != nil {\n    remote, err = repo.Remotes.Create(\"origin\", repo.Path())\n    if err != nil {\n        return err\n    }\n}\n\n// Get the branch\nbranch, err := repo.Branch()\nif err != nil {\n    return err\n}\n\n// Get the name\nbranchName, err := branch.Name()\nif err != nil {\n    return err\n}\n\nif err := remote.Push([]string{\"refs/heads/\"+branchName}, &amp;git.PushOptions{}); err != nil {\n    return err\n}\n\nreturn nil\n</code></pre>\n\n<p>Depending on what version of <code>git2go</code> you are using, this might also be helpful: <a href=\"http://blog.gopheracademy.com/advent-2014/git2go-tutorial/\" rel=\"nofollow\">http://blog.gopheracademy.com/advent-2014/git2go-tutorial/</a> (great article)</p>\n\n<p>Things have changed quite a bit since then though.</p>\n\n<p>Thank you</p>\n"}], "owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 980, "favorite_count": 4, "accepted_answer_id": 31722440, "answer_count": 1, "score": 4, "last_activity_date": 1438255366, "creation_date": 1437258481, "last_edit_date": 1437433530, "question_id": 31496175, "link": "https://stackoverflow.com/questions/31496175/git2go-simulate-git-checkout-and-an-immediate-git-push", "title": "Git2go: Simulate git checkout and an immediate git push", "body": "<p>How can I achieve the following using <code>git2go</code>.</p>\n\n<pre><code>$ git checkout -b feature_branch_name\n... edit files, add and commit ...\n$ git push -u origin feature_branch_name\n</code></pre>\n\n<p>I'm stuck here:</p>\n\n<pre><code>branch, err = repo.CreateBranch(\"test\", headCommit, false, \n    signature, \"Test branch that I was to push immediately\")\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I have the following now, it creates the branch and point to the correct branch, but I can't get it to update the working directory just like <code>git checkout</code> does:</p>\n\n<pre><code>head, err := repository.Head()\nif err != nil {\n    return err\n}\n\nheadCommit, err := repository.LookupCommit(head.Target())\nif err != nil {\n    return err\n}\n\n_, err = cs.repository.CreateBranch(name, headCommit, false)\nif err != nil {\n    return err\n}\n\n_, err = cs.repository.References.CreateSymbolic(\"HEAD\",\"refs/heads/\"+name, true, \"headOne\")\nif err != nil {\n    return err\n}\n\nopts := &amp;git.CheckoutOpts{\n    Strategy: git.CheckoutSafe | git.CheckoutRecreateMissing,\n}\nif err := repository.CheckoutHead(opts); err != nil {\n    return err\n}\n</code></pre>\n\n<p>I think I'm struggling with the <strong>checkout options now</strong>.</p>\n\n<p>I'm still working on the push part.</p>\n"}, {"tags": ["php", "api", "authentication", "oauth", "go"], "answers": [{"comments": [{"owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437314401, "post_id": 31495285, "comment_id": 50966752, "body": "Thanks for you answer. How would a URI look like to the API from the web  server frontend for let&#39;s say a show profile page? I imagine something like a GET call to &quot;http.//backend.com:3000/[api-key]/[api-secret][oauth-token?&zwnj;&#8203;]/profile. Then some middleware to authenticate the web client and another piece of middleware to authenticate the user. Would that be &quot;the right&quot; approach?"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437318670, "post_id": 31495285, "comment_id": 50968007, "body": "Kind of depends on if you plan on using their google/fb credentials for anything than just authentication.  For example, do you want to post on their FB wall from your server?   For my apps, it&#39;s auth only.  Once I verify the login, i just create my own session to track my user.  Basically, i have sites where I don&#39;t have any passwords, just users associated to google/fb profiles.  I&#39;d rather leave the security to people with more to lose than I.   for Go sessions, look at: <a href=\"http://www.gorillatoolkit.org/pkg/sessions\" rel=\"nofollow noreferrer\">gorillatoolkit.org/pkg/sessions</a>"}, {"owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437334034, "post_id": 31495285, "comment_id": 50973005, "body": "I&#39;m only going to use it for authentication as well. Hmm, see I&#39;ve a small problem with the session stuff since I&#39;ve been taught that a RESTful API should be stateless and keeping sessions kinda breaks that rule - at the same time maybe that what gets me confused."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437342356, "post_id": 31495285, "comment_id": 50975357, "body": "the problem is that you can&#39;t trust the client to not be a bad guy.  so you need something to store who they are.  the gorilla sessions can store them as cookies, which makes them server side stateless.   but cookies are weird to manage for non-browser based clients."}, {"owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437388018, "post_id": 31495285, "comment_id": 50989656, "body": "But I can trust the web server if I use an api key/secret between my client and my own web server, right? That would only allow my client to talk to the api. Furthermore I could encrypt the communication between the two of them."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437394707, "post_id": 31495285, "comment_id": 50993609, "body": "If you have web based clients, how do you expect to keep secret key, secret?  All someone has to do is view source and they have your key and can now talk to your api server.   Or use a proxy / sniffer with the mobile app"}, {"owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "edited": false, "score": 0, "creation_date": 1437395744, "post_id": 31495285, "comment_id": 50994330, "body": "I see your point but then again if they can read the source code they already have access to the server. They would be able to read the database password anyway then. I could use an encrypted connection between the webserver and the api server too and I have both servers on the same infrastructure so listening to them requires some kind of access to the system. The customers webbrowser is not going to show the URI for the API but only for the web server."}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 2, "last_activity_date": 1437251399, "creation_date": 1437251399, "answer_id": 31495285, "question_id": 31494979, "link": "https://stackoverflow.com/questions/31494979/api-authentication-confusion/31495285#31495285", "title": "API authentication confusion", "body": "<p>If you look at your facebook or google developer docs, you will find examples on how to integrate with their oauth login systems.</p>\n\n<p>OAuth, or at least the last step of it, really must be done on the back end as you have to assume your front end is a bad guy hitting your system.</p>\n\n<p>For go oauth, take a look at: <a href=\"https://github.com/golang/oauth2\" rel=\"nofollow\">https://github.com/golang/oauth2</a></p>\n\n<p>You will likely have a <code>http.HandlerFunc(\"/oauth/google\",yourGoogleFunc)</code> \nand <code>http.HandlerFunc(\"/oauth/facebook\",yourFBFunc)</code>\ntype thing, then you register that URL on your dev account with those companies.</p>\n\n<p>while testing, it's easiest to use localhost:8080 (or whatever) as the callback url so it works on any machine as long as you are using a local browser.</p>\n"}], "owner": {"reputation": 696, "user_id": 1126722, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8421dc16b450b3b287fa75c86352b99e?s=128&d=identicon&r=PG&f=1", "display_name": "Cyberlurk", "link": "https://stackoverflow.com/users/1126722/cyberlurk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1437315120, "creation_date": 1437249017, "last_edit_date": 1437315120, "question_id": 31494979, "link": "https://stackoverflow.com/questions/31494979/api-authentication-confusion", "title": "API authentication confusion", "body": "<p>My question is not deeply technical but more of a system architectural one. </p>\n\n<p>I'm designing an API backend in Go Lang. I'd like to have several clients, like a web server, cell phones etc.. I imagine that all these clients should have a secret API key so to validate that they can use the API. At the same time the web frontend is going to have a lot of users with different restrictions. I'd like for these users to be able to log in with their facebook or Google account. That should require OAuth authentication as I understand. My question is now where should I add the OAuth. Only in the frontend and then save the user in session or also between the frontend and the backend. I'm highly confused about how I should set up this communication and authentication.</p>\n\n<p>I'm building the web  server in PHP and I'd like the web frontend to be really light weight and more or less only function as en empty shell/view for the Go API. I've build systems in plain PHP/MySQL before but I'd like to make a shift to Go based APIs.  </p>\n\n<p>How would a URI look like to the API from the web server frontend for let's say a show profile page? I imagine something like a GET call to \"http.//backend.com:3000/[api-key]/[api-secret][oauth-token?]/profile. Then some middleware to authenticate the web client and another piece of middleware to authenticate the user. Would that be \"the right\" approach? </p>\n\n<p>I hope you guys can point me in the right direction. </p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["dictionary", "go"], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 2, "last_activity_date": 1437247372, "creation_date": 1437247372, "answer_id": 31494744, "question_id": 31494710, "link": "https://stackoverflow.com/questions/31494710/map-interface-pointer-method-receiver/31494744#31494744", "title": "map interface pointer method receiver", "body": "<p>Yes, same reason. In order to call a method with a pointer receiver, you either need to have a pointer in the first place, or you need an <em>addressable</em> value and Go will automatically take the pointer for you.</p>\n\n<p>What you can do, then, is to make <code>mValue</code> a <code>map[string]*Variables</code> instead of a <code>map[string]Variables</code>. Then you will be storing a pointer to an already-allocated, guaranteed-addressable <code>Variables</code> in the map, and you'll be able to call methods on that pointer.</p>\n"}, {"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 0, "last_activity_date": 1437319000, "last_edit_date": 1495540270, "creation_date": 1437319000, "answer_id": 31502716, "question_id": 31494710, "link": "https://stackoverflow.com/questions/31494710/map-interface-pointer-method-receiver/31502716#31502716", "title": "map interface pointer method receiver", "body": "<p>To expand on the previous answer\u2026</p>\n\n<p>In practice, this isn't usually a problem. If the type makes more sense without pointers (e.g.\u00a0a small struct where value semantics make more sense) then you wouldn't have pointer receivers and the issue wouldn't arise.</p>\n\n<p>If pointer receivers make sense then you should probably be using pointers to the type in most places, such as in maps (as <a href=\"https://stackoverflow.com/a/31494744/55504\">hobbs said</a>) and you wouldn't have methods that took non-pointer arguments or returned non-pointer values (non-pointer receivers could still make sense and would be easy to use). Again, the issue wouldn't arise.</p>\n\n<p>In the first case if you wanted to use a pointer receiver with a non-pointer map entry, you could use a <a href=\"https://play.golang.org/p/QEKvdd9y5j\" rel=\"nofollow noreferrer\">temporary (addressable) variable</a> and reassign it back into the map.</p>\n\n<pre><code>    x := d.mValue[\"two\"]\n    x.AddPointer(instances[i])\n    // AddPointer uses a pointer receiver; `x` needs to be addressable,\n    // it will contain a copy of the value from the map and that copy may\n    // be changed by the method so we need to copy the new version back\n    // into the map.\n    d.mValue[\"two\"] = x\n</code></pre>\n\n<p>In the second case a few issues arise. First, to avoid <code>nil</code> pointers you need to either initialize the map entries or check for <code>nil</code>/existance on map reads (or make  make your pointer receiver methods handle <code>nil</code> valued receivers, but that doesn't help for non-pointer receiver methods though). Second, if for some silly reason you have pointers but still have a method that returned a non-pointer you'd have to use a different syntax to assign to the map.</p>\n\n<p><a href=\"https://play.golang.org/p/YqEEIGKgxW\" rel=\"nofollow noreferrer\">Something like this perhaps</a>:</p>\n\n<pre><code>    // Initialize some map entries to avoid nil pointers\n    d.mValue = map[string]*Variables{\n        \"one\": &amp;Variables{},\n        \"two\": &amp;Variables{},\n    }\n    for i := 0; i &lt; len(instances); i++ {\n        // Just calling the non-pointer reciever is easy/fine:\n        d.mValue[\"one\"].Add(instances[i])\n\n        // But you can't do this:\n        //d.mValue[\"one\"] = d.mValue[\"one\"].Add(instances[i])\n        // cannot use d.mValue[\"one\"].Add(instances[i]) (type Variables) as type *Variables in assignment\n\n        *d.mValue[\"one\"] = d.mValue[\"one\"].Add(instances[i])\n        d.mValue[\"two\"].AddPointer(instances[i])\n    }\n</code></pre>\n"}], "owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 458, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1437319000, "creation_date": 1437247073, "question_id": 31494710, "link": "https://stackoverflow.com/questions/31494710/map-interface-pointer-method-receiver", "title": "map interface pointer method receiver", "body": "<p>I have a the following code</p>\n\n<p><a href=\"http://play.golang.org/p/d-bZxL72az\" rel=\"nofollow\">http://play.golang.org/p/d-bZxL72az</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Variables struct {\n    sum     uint64\n    highest uint64\n}\n\ntype Data struct {\n    count  uint64\n    mValue map[string]Variables\n}\n\nfunc (v Variables) Add(value Variables) Variables {\n    v.sum += value.sum\n    if v.highest == 0 {\n        v.highest = value.highest\n    } else if v.highest &lt; value.highest {\n        v.highest = value.highest\n    }\n    return v\n}\n\nfunc (v *Variables) AddPointer(value Variables) {\n    v.sum += value.sum\n    if v.highest == 0 {\n        v.highest = value.highest\n    } else if v.highest &lt; value.highest {\n        v.highest = value.highest\n    }\n}\n\nfunc main() {\n    var instances [2]Variables\n    instances[0] = Variables{sum: 5, highest: 3}\n    instances[1] = Variables{sum: 10, highest: 2}\n    var d Data\n    d.mValue = make(map[string]Variables)\n    for i:= 0; i &lt; len(instances); i++ {\n        d.mValue[\"one\"] = d.mValue[\"one\"].Add(instances[i])\n        d.mValue[\"two\"].AddPointer(instances[i])\n    }\n    fmt.Println(d.mValue[\"one\"])\n    fmt.Println(d.mValue[\"two\"])\n}\n</code></pre>\n\n<p>I get the error</p>\n\n<pre><code># command-line-arguments\n/tmp/sandbox209565070/main.go:42: cannot call pointer method on d.mValue[\"two\"]\n/tmp/sandbox209565070/main.go:42: cannot take the address of d.mValue[\"two\"]\n</code></pre>\n\n<p>(I think) I understand the second error <code>cannot take address</code> - because, it is a map, it cannot take the address (is that correct?)</p>\n\n<p>Is it the same reason for the first error as well (cannot call pointer method)?</p>\n\n<p>Is there a way to use pointer methods on structures that are within the maps.. </p>\n"}, {"tags": ["go", "dropbox-api", "hmac", "sha256", "webhooks"], "comments": [{"owner": {"reputation": 249, "user_id": 3602982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f498120f2b82de0f4e2a9440f7c039d7?s=128&d=identicon&r=PG&f=1", "display_name": "Sam Phomsopha", "link": "https://stackoverflow.com/users/3602982/sam-phomsopha"}, "edited": false, "score": 0, "creation_date": 1437235978, "post_id": 31492897, "comment_id": 50949548, "body": "Have you tried logging the request body to verify it matches the data sent?"}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 2, "creation_date": 1437240310, "post_id": 31492897, "comment_id": 50950846, "body": "I assume what you&#39;re seeing is &quot;Signature Check unsuccessful&quot;? Another random guess: the signature in the header will be hex encoded, so make sure wherever you parse that, you&#39;re doing it properly. This question would be more answerable if you gave example inputs and the hash you&#39;re computing, since the error could be in lots of places."}, {"owner": {"reputation": 23, "user_id": 4078846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10f6b3f2313f47b8c4d9c35b4604d2b5?s=128&d=identicon&r=PG&f=1", "display_name": "MarkTro", "link": "https://stackoverflow.com/users/4078846/marktro"}, "edited": false, "score": 0, "creation_date": 1437267743, "post_id": 31492897, "comment_id": 50957539, "body": "<code>w.Signature</code> is the hex encoded key sent by DropBox. On my side, according to DropBox&#39;s documentation, I am supposed to encode the request body being sent, using my <i>secret</i> string as the key. Then I need to compare the two values and make sure they are the same. But, at the moment, they aren&#39;t."}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 0, "creation_date": 1437317245, "post_id": 31492897, "comment_id": 50967564, "body": "If the signature you&#39;re comparing to is hex encoded, then you need to hex encode the signature you compute also. It doesn&#39;t look like you&#39;re doing that."}, {"owner": {"reputation": 23, "user_id": 4078846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10f6b3f2313f47b8c4d9c35b4604d2b5?s=128&d=identicon&r=PG&f=1", "display_name": "MarkTro", "link": "https://stackoverflow.com/users/4078846/marktro"}, "edited": false, "score": 0, "creation_date": 1437327562, "post_id": 31492897, "comment_id": 50970880, "body": "isn&#39;t <code>expectedMac</code> hex-encoded? what am I doing wrong?"}, {"owner": {"reputation": 1541, "user_id": 395059, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ad82e88848bab09d379e402207405874?s=128&d=identicon&r=PG", "display_name": "Joey", "link": "https://stackoverflow.com/users/395059/joey"}, "edited": false, "score": 0, "creation_date": 1437418419, "post_id": 31492897, "comment_id": 51009427, "body": "<code>expectedMac</code> is of type <code>[]byte</code>. <a href=\"https://golang.org/src/crypto/hmac/hmac.go?s=1395:1434#L53\" rel=\"nofollow noreferrer\">golang.org/src/crypto/hmac/hmac.go?s=1395:1434#L53</a>"}, {"owner": {"reputation": 1541, "user_id": 395059, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ad82e88848bab09d379e402207405874?s=128&d=identicon&r=PG", "display_name": "Joey", "link": "https://stackoverflow.com/users/395059/joey"}, "edited": false, "score": 0, "creation_date": 1437418512, "post_id": 31492897, "comment_id": 51009480, "body": "it seems likely that you have a string representation of hex characters stored in <code>w.Signature</code>, since dropbox is sending you hex-encoded bytes over the wire as a string most likely (how you handle this is not provided in your question so i&#39;m just guessing). can you post some more of your code?"}], "answers": [{"tags": [], "owner": {"reputation": 182, "user_id": 538817, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/T1JVl.png?s=128&g=1", "display_name": "Kinobi", "link": "https://stackoverflow.com/users/538817/kinobi"}, "is_accepted": false, "score": 5, "last_activity_date": 1514905190, "creation_date": 1514905190, "answer_id": 48063187, "question_id": 31492897, "link": "https://stackoverflow.com/questions/31492897/golang-dropbox-webhook-signature-validation-hmac/48063187#48063187", "title": "Golang - Dropbox webhook signature validation hmac", "body": "<p>The Dropbox signature is sent as string in the HTTP header <code>X-Dropbox-Signature</code>.</p>\n\n<p>So as to use it with <code>hmac.Equal</code>, you need to decode the hex string representation to a slice of byte first using package <a href=\"https://golang.org/pkg/encoding/hex/\" rel=\"noreferrer\">encoding/hex</a>.</p>\n\n<pre><code>    import \"encoding/hex\"\n\n    [...]\n    hexSignature, err := hex.DecodeString(w.Signature)\n    [...]\n</code></pre>\n\n<p>Then you can use the hex bytes in the comparison</p>\n\n<pre><code>    [...]\n    // compare if it corresponds with the signature sent by DropBox\n    comparison := hmac.Equal(hexSignature, expectedMac)\n    [...]\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 4078846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10f6b3f2313f47b8c4d9c35b4604d2b5?s=128&d=identicon&r=PG&f=1", "display_name": "MarkTro", "link": "https://stackoverflow.com/users/4078846/marktro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 698, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1514905190, "creation_date": 1437234744, "last_edit_date": 1437420901, "question_id": 31492897, "link": "https://stackoverflow.com/questions/31492897/golang-dropbox-webhook-signature-validation-hmac", "title": "Golang - Dropbox webhook signature validation hmac", "body": "<p>I am writing a program that needs to use Dropbox's webhooks. I haven't been able to find any Go implementation already in place, so I've decided to write mine. Unfortunately, it doesn't seem to work. </p>\n\n<p>I think the issue here is with <strong>hmac</strong>, as I am most probably doing something wrong, but I just can't seem to understand where exactly the issue here. Any idea?</p>\n\n<p>The following is what I have:</p>\n\n<pre><code>package dboxwebhook\n\nimport (\n    \"bytes\"\n    \"crypto/hmac\"\n    \"crypto/sha256\"\n    \"errors\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n)\n\ntype Signature struct {\n    AppSecret []byte\n    Signature []byte\n}\n\nfunc (w *Signature) Check(reqBody io.ReadCloser) error {\n\n    if bytes.Compare(w.Signature, nil) == 0 {\n        return errors.New(\"DropBox signature doesnt exist\")\n    }\n\n    // building HMAC key (https://golang.org/pkg/crypto/hmac/)\n    mac := hmac.New(sha256.New, w.AppSecret)\n    requestBody, err := ioutil.ReadAll(reqBody)\n    if err != nil {\n        return err\n    }\n\n    mac.Write(requestBody)\n    expectedMac := mac.Sum(nil)\n\n    log.Println(w.AppSecret)\n    log.Println(expectedMac)\n    log.Println(w.Signature)\n\n    // compare if it corresponds with the signature sent by DropBox\n    comparison := hmac.Equal(w.Signature, expectedMac)\n\n    if !comparison {\n        return errors.New(\"Signature Check unsuccessful\")\n    }\n\n    return nil\n\n}\n</code></pre>\n\n<p>To test this, the only way I know is to use <a href=\"https://github.com/dropbox/dropbox_hook\" rel=\"nofollow\">this Python script</a> from Dropbox.</p>\n"}, {"tags": ["networking", "tcp", "go", "network-programming"], "answers": [{"comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1437233623, "post_id": 31492671, "comment_id": 50948852, "body": "That means he&#39;d have to keep all the data in memory."}, {"owner": {"reputation": 15, "user_id": 189501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/024cace8631c2ccc6f3f7613170c110a?s=128&d=identicon&r=PG", "display_name": "Cooy", "link": "https://stackoverflow.com/users/189501/cooy"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1437233792, "post_id": 31492671, "comment_id": 50948888, "body": "Not if he set a proper buffer size for the channel."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1437234193, "post_id": 31492671, "comment_id": 50948996, "body": "no? he&#39;d have to create a channel per request, read all the data to a buffer, send it through the channel."}, {"owner": {"reputation": 15, "user_id": 189501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/024cace8631c2ccc6f3f7613170c110a?s=128&d=identicon&r=PG", "display_name": "Cooy", "link": "https://stackoverflow.com/users/189501/cooy"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1437234335, "post_id": 31492671, "comment_id": 50949043, "body": "I guess you (or me?) misunderstood his question. He&#39;s trying to fan out the read. Not multicast the read."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1437234404, "post_id": 31492671, "comment_id": 50949064, "body": "The way I understood it is that he wanted to multicast it, you could be right."}], "tags": [], "owner": {"reputation": 15, "user_id": 189501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/024cace8631c2ccc6f3f7613170c110a?s=128&d=identicon&r=PG", "display_name": "Cooy", "link": "https://stackoverflow.com/users/189501/cooy"}, "is_accepted": false, "score": 0, "last_activity_date": 1437234590, "last_edit_date": 1437234590, "creation_date": 1437233219, "answer_id": 31492671, "question_id": 31492519, "link": "https://stackoverflow.com/questions/31492519/go-read-data-from-tcp-connection-from-multiple-readers/31492671#31492671", "title": "Go - Read data from TCP connection from multiple readers", "body": "<p>Start a single go routine to perform conn.Read(data) and put the result into a channel.</p>\n\n<p>Then (concurrently, without waiting for the first go routine to finish) start multiple go routines to read from this channel.</p>\n\n<p>You don't want to directly read from the conn concurrently from multiple go routine since it is not thread-safe (the fact that it runs, and only run only on a single go routine probably because your MAXGOPROCS == 1).</p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1437236090, "post_id": 31492712, "comment_id": 50949581, "body": "Or, <a href=\"https://play.golang.org/p/IYZ-Jnq4g3\" rel=\"nofollow noreferrer\">using slices of arbitrary size</a> rather than a hard coded fan out of three (and that also passes any read error along to each processor)."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 2, "last_activity_date": 1437233584, "creation_date": 1437233584, "answer_id": 31492712, "question_id": 31492519, "link": "https://stackoverflow.com/questions/31492519/go-read-data-from-tcp-connection-from-multiple-readers/31492712#31492712", "title": "Go - Read data from TCP connection from multiple readers", "body": "<p>One way to do it is using <a href=\"http://golang.org/pkg/io/#MultiWriter\" rel=\"nofollow\"><code>io.MultiWriter</code></a> and <a href=\"http://golang.org/pkg/io/#Pipe\" rel=\"nofollow\"><code>io.Pipe</code></a>:</p>\n\n<pre><code>func main() {\n    var wg sync.WaitGroup\n    r := strings.NewReader(hello)\n    pr1, pw1 := io.Pipe()\n    pr2, pw2 := io.Pipe()\n    pr3, pw3 := io.Pipe()\n    mw := io.MultiWriter(pw1, pw2, pw3)\n\n    wg.Add(4)\n    go process(&amp;wg, 0, pr1)\n    go process(&amp;wg, 1, pr2)\n    go process(&amp;wg, 2, pr3)\n    go func() {\n        io.Copy(mw, r)\n        pw1.Close()\n        pw2.Close()\n        pw3.Close()\n        wg.Done()\n    }()\n\n    wg.Wait()\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/ZIU6RZ79ZG\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}, {"tags": [], "owner": {"reputation": 337, "user_id": 799341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfc0d2b6382b24d36cda1d30da9b0d8c?s=128&d=identicon&r=PG", "display_name": "Nevio Vesi\u0107", "link": "https://stackoverflow.com/users/799341/nevio-vesi%c4%87"}, "is_accepted": false, "score": -1, "last_activity_date": 1437251968, "creation_date": 1437251968, "answer_id": 31495358, "question_id": 31492519, "link": "https://stackoverflow.com/questions/31492519/go-read-data-from-tcp-connection-from-multiple-readers/31495358#31495358", "title": "Go - Read data from TCP connection from multiple readers", "body": "<p>Ok so first of all. You're doing it wrong friend.</p>\n\n<p>What you should do is create workers (pre-create), create channel and aggregate that channel with incoming connections. Than you should take that same connection inside of worker and handle it. On this way you'll get X concurrent workers that runs against your connections. </p>\n\n<p>I went ahead and wrote you down one nice example of how to gracefully handle workers but did not had time to write down how to gracefully handle incoming connections. Never the less, you'll see what i mean.</p>\n\n<p><a href=\"http://play.golang.org/p/YkQVmBEWly\" rel=\"nofollow\">http://play.golang.org/p/YkQVmBEWly</a></p>\n\n<p>Hope this helps,</p>\n"}], "owner": {"reputation": 213, "user_id": 2422492, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/IC81j.jpg?s=128&g=1", "display_name": "Tigran Bayburtsyan", "link": "https://stackoverflow.com/users/2422492/tigran-bayburtsyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1491, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1437251968, "creation_date": 1437232068, "question_id": 31492519, "link": "https://stackoverflow.com/questions/31492519/go-read-data-from-tcp-connection-from-multiple-readers", "title": "Go - Read data from TCP connection from multiple readers", "body": "<p>I'm working on Cloud Server's networking thing using Go programming language.\nAnd I faced a problem with <b>reading same TCPconn at the same time from different Goroutines</b>.</p>\n\n<p>Here is a simple example</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n)\n\nfunc main() {\n    addr, _ := net.ResolveTCPAddr(\"tcp\", \":8888\")\n    listener, _ := net.ListenTCP(\"tcp\", addr)\n\n    for {\n        conn, err := listener.AcceptTCP()\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n        go Handle(conn) // output always coming from here\n        go Handle(conn)\n    }\n}\n\nfunc Handle(conn *net.TCPConn) {\n    data := make([]byte, 1024)\n    fmt.Println(\"Ok\")\n    for {\n        len_data, err := conn.Read(data)\n        fmt.Println(err)\n        fmt.Println(len_data)\n    }\n}\n</code></pre>\n\n<p>In this example console output always coming from 1st goroutine <code>go Handle(conn)</code> ...</p>\n\n<p>How to make Read functionality from 2 Goroutines at the same time ?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 3, "creation_date": 1437205700, "post_id": 31488985, "comment_id": 50942164, "body": "<a href=\"http://stackoverflow.com/questions/19979178/what-is-idiomatic-gos-equivalent-of-cs-ternary-operator\" title=\"what is idiomatic gos equivalent of cs ternary operator\">stackoverflow.com/questions/19979178/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1608, "user_id": 3787144, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/392be72d51169882853bbaaf5a4d7a95?s=128&d=identicon&r=PG&f=1", "display_name": "jorgbrown", "link": "https://stackoverflow.com/users/3787144/jorgbrown"}, "edited": false, "score": 1, "creation_date": 1437378085, "post_id": 31489124, "comment_id": 50984182, "body": "I like your answer best, but while I was in the playground you linked to, I saw another referenced question and made this ugly one-liner:  return (map[bool]int{true: 3, false: 45})[mybool]  // See <a href=\"http://play.golang.org/p/7fDTkm_kKX\" rel=\"nofollow noreferrer\">play.golang.org/p/7fDTkm_kKX</a>"}], "tags": [], "owner": {"reputation": 1436, "user_id": 3066972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55ee784dcb5e3afadd6b5cae7949a5f5?s=128&d=identicon&r=PG&f=1", "display_name": "ssnobody", "link": "https://stackoverflow.com/users/3066972/ssnobody"}, "is_accepted": true, "score": 12, "last_activity_date": 1601965627, "last_edit_date": 1601965627, "creation_date": 1437206601, "answer_id": 31489124, "question_id": 31488985, "link": "https://stackoverflow.com/questions/31488985/how-do-i-turn-a-bool-into-an-int/31489124#31489124", "title": "How do I turn a bool into an int?", "body": "<p>You can use the following:</p>\n<pre><code>func g(mybool bool) int {\n    if mybool {\n        return 3\n    } else {\n        return 45\n    }\n}\n</code></pre>\n<p>And I generated a <a href=\"http://play.golang.org/p/QlGfrCptAM\" rel=\"nofollow noreferrer\">playground</a> for you to test.</p>\n<p>As pointed to by Atomic_alarm and the <a href=\"http://golang.org/doc/faq#Does_Go_have_a_ternary_form\" rel=\"nofollow noreferrer\">FAQ</a> &quot;There is no ternary form in Go.&quot;</p>\n<p>As a more general answer to your question of &quot;how to turn a bool into a int&quot; programmers would generally expect true to be 1 and false to be 0, but go doesn't have a direct conversion between bool and int such that <code>int(true)</code> or <code>int(false)</code> will work.</p>\n<p>You can create the trivial function in this case as they did in <a href=\"https://github.com/golang/image/blob/e162460cd6b5176292c0a160614547bab9a90788/vp8/reconstruct.go#L145\" rel=\"nofollow noreferrer\">VP8</a>:</p>\n<pre><code>func btou(b bool) uint8 {\n        if b {\n                return 1\n        }\n        return 0\n}\n</code></pre>\n"}], "owner": {"reputation": 1608, "user_id": 3787144, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/392be72d51169882853bbaaf5a4d7a95?s=128&d=identicon&r=PG&f=1", "display_name": "jorgbrown", "link": "https://stackoverflow.com/users/3787144/jorgbrown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5217, "favorite_count": 0, "closed_date": 1568792081, "accepted_answer_id": 31489124, "answer_count": 1, "score": 4, "last_activity_date": 1601965627, "creation_date": 1437205376, "last_edit_date": 1568792094, "question_id": 31488985, "link": "https://stackoverflow.com/questions/31488985/how-do-i-turn-a-bool-into-an-int", "closed_reason": "Duplicate", "title": "How do I turn a bool into an int?", "body": "<p>I'm used to C/Java, where I could use ?: as in:</p>\n\n<pre><code>func g(arg bool) int {\n  return mybool ? 3 : 45;\n}\n</code></pre>\n\n<p>Since <a href=\"http://golang.org/doc/faq#Does_Go_have_a_ternary_form\" rel=\"nofollow\">Go does not have a ternary operator</a>, \nhow do I do that in go?</p>\n"}, {"tags": ["go", "casting", "type-conversion"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1437195419, "post_id": 31487694, "comment_id": 50940167, "body": "&quot;65.0&quot; is a float, not an int."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 3, "creation_date": 1437197553, "post_id": 31487694, "comment_id": 50940580, "body": "See <a href=\"http://stackoverflow.com/q/19101419/6309\">stackoverflow.com/q/19101419/6309</a>"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1437209341, "post_id": 31487694, "comment_id": 50942884, "body": "Why not parse as a float and convert to string? or try first an int, fall back to parsing a float, etc?"}, {"owner": {"reputation": 233, "user_id": 1118584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f511f1e434de049eb7b34d5a57128bdd?s=128&d=identicon&r=PG", "display_name": "shenli3514", "link": "https://stackoverflow.com/users/1118584/shenli3514"}, "edited": false, "score": 1, "creation_date": 1437279922, "post_id": 31487694, "comment_id": 50959447, "body": "This can not solve &quot;11xx&quot;-&gt;11."}, {"owner": {"reputation": 1182, "user_id": 135553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/daea62b54662a201ffc4ab1920dd522c?s=128&d=identicon&r=PG", "display_name": "Narendra N", "link": "https://stackoverflow.com/users/135553/narendra-n"}, "edited": false, "score": 0, "creation_date": 1470035861, "post_id": 31487694, "comment_id": 64764708, "body": "<a href=\"http://stackoverflow.com/questions/31487694/how-can-i-convert-string-to-integer-in-golang\" title=\"how can i convert string to integer in golang\">stackoverflow.com/questions/31487694/&hellip;</a>"}, {"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1594338244, "post_id": 31487694, "comment_id": 111099217, "body": "<code>strconv.Atoi(&quot;10&quot;)</code> to convert a string to integer. <code>strconv.Itoa(10)</code> to convert an integer to a string. See <a href=\"https://stackoverflow.com/a/62740786/12817546\">stackoverflow.com/a/62740786/12817546</a>."}], "answers": [{"comments": [{"owner": {"reputation": 233, "user_id": 1118584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f511f1e434de049eb7b34d5a57128bdd?s=128&d=identicon&r=PG", "display_name": "shenli3514", "link": "https://stackoverflow.com/users/1118584/shenli3514"}, "edited": false, "score": 0, "creation_date": 1437217716, "post_id": 31489456, "comment_id": 50944827, "body": "This solution can not deal with &quot;11xx&quot; -&gt; 11 and &quot;xx11&quot;-&gt;0"}, {"owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "reply_to_user": {"reputation": 233, "user_id": 1118584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f511f1e434de049eb7b34d5a57128bdd?s=128&d=identicon&r=PG", "display_name": "shenli3514", "link": "https://stackoverflow.com/users/1118584/shenli3514"}, "edited": false, "score": 1, "creation_date": 1437239953, "post_id": 31489456, "comment_id": 50950751, "body": "That is correct. From the question it is not clear that you need to handle cases like &quot;11xx&quot; -&gt; 11 and i don&#39;t think it is good practice to parse integer and leave other character."}, {"owner": {"reputation": 233, "user_id": 1118584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f511f1e434de049eb7b34d5a57128bdd?s=128&d=identicon&r=PG", "display_name": "shenli3514", "link": "https://stackoverflow.com/users/1118584/shenli3514"}, "edited": false, "score": 0, "creation_date": 1437266778, "post_id": 31489456, "comment_id": 50957362, "body": "Yes, I do not make my question clear. I will update it. Thanks!"}], "tags": [], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "is_accepted": false, "score": 10, "last_activity_date": 1496600877, "last_edit_date": 1496600877, "creation_date": 1437209369, "answer_id": 31489456, "question_id": 31487694, "link": "https://stackoverflow.com/questions/31487694/how-can-i-convert-string-to-integer-in-golang/31489456#31489456", "title": "How can I convert string to integer in golang", "body": "<p>I believe function you are looking for is </p>\n\n<pre><code>strconv.ParseFloat()\n</code></pre>\n\n<p>see example <a href=\"http://play.golang.org/p/WX-td3yFGF\" rel=\"noreferrer\">here</a> </p>\n\n<p>But return type of this function is float64.</p>\n\n<p>If you don't need fractional part of the number passed as the string following function would do the job:</p>\n\n<pre><code>func StrToInt(str string) (int, error) {\n    nonFractionalPart := strings.Split(str, \".\")\n    return strconv.Atoi(nonFractionalPart[0])\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437234636, "post_id": 31490461, "comment_id": 50949116, "body": "You&#39;re looping over <code>str</code> by byte but comparing as runes. I&#39;d just use <code>for _, r := range str[i:]</code> to loop over the string by rune (or don&#39;t bother with unicode and just test against ASCII 0 and 9 literals)."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437234711, "post_id": 31490461, "comment_id": 50949133, "body": "IMO, if you want an API that will stop parsing early and ignore trailing characters you should have the API return either the number of bytes consumed/parsed or the remaining unparsed portion of the input (in addition to the existing return values of course)."}], "tags": [], "owner": {"reputation": 233, "user_id": 1118584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f511f1e434de049eb7b34d5a57128bdd?s=128&d=identicon&r=PG", "display_name": "shenli3514", "link": "https://stackoverflow.com/users/1118584/shenli3514"}, "is_accepted": false, "score": 0, "last_activity_date": 1437230445, "last_edit_date": 1437230445, "creation_date": 1437217254, "answer_id": 31490461, "question_id": 31487694, "link": "https://stackoverflow.com/questions/31487694/how-can-i-convert-string-to-integer-in-golang/31490461#31490461", "title": "How can I convert string to integer in golang", "body": "<p>My current solution is:</p>\n\n<pre><code>// Convert string to integer in best effort.                                                                                \n // TODO: handle overflow and add unittest                                                                                   \nfunc StrToInt(str string) (int64, error) {                                                                                  \n    if len(str) == 0 {                                                                                                      \n        return 0, nil                                                                                                       \n     }                                                                                                                       \n     negative := false                                                                                                       \n     i := 0                                                                                                                  \n     if str[i] == '-' {                                                                                                      \n         negative = true                                                                                                     \n         i++                                                                                                                 \n     } else if str[i] == '+' {                                                                                               \n         i++                                                                                                                 \n     }                                                                                                                       \n     r := int64(0)                                                                                                           \n     for ; i &lt; len(str); i++ {                                                                                             \n         if unicode.IsDigit(rune(str[i])) {                                                                                  \n             r = r*10 + int64(str[i]-'0')                                                                                    \n         } else {\n             break\n          }                                                                                                                   \n     }                                                                                                                       \n     if negative {                                                                                                           \n         r = -r                                                                                                              \n     }                                                                                                                       \n     // TODO: if i &lt; len(str), we should return error                                                                        \n     return r, nil                                                                                                           \n }    \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "is_accepted": false, "score": 1, "last_activity_date": 1437324940, "creation_date": 1437324940, "answer_id": 31503615, "question_id": 31487694, "link": "https://stackoverflow.com/questions/31487694/how-can-i-convert-string-to-integer-in-golang/31503615#31503615", "title": "How can I convert string to integer in golang", "body": "<p>You can write a <code>FieldsFunc</code> to parse and get the number values alone separately.</p>\n\n<p><a href=\"http://play.golang.org/p/3RV_wLTiqN\" rel=\"nofollow\">Play it here</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n    \"unicode\"\n)\n\nfunc stripNonIntFloat(s string) string {\n    f := func(c rune) bool {\n        return !unicode.IsNumber(c) &amp;&amp; (c != 46)\n    }\n    output := strings.FieldsFunc(s, f)\n    if len(output) &gt; 0 {\n        return output[0]\n    } else {\n        return \"\"\n    }\n}\n\nfunc main() {\n    strList := []string{\"10\", \"65.0\", \"xx\", \"11xx\", \"xx11\"}\n    for i := 0; i &lt; len(strList); i++ {\n        s := stripNonIntFloat(strList[i])\n        v, err := strconv.ParseFloat(s, 10)\n        if err != nil {\n            fmt.Println(strList[i], 0)\n        } else {\n            fmt.Println(strList[i], v)\n        }\n    }\n}\n</code></pre>\n\n<p>The output here is</p>\n\n<pre><code>10 10\n65.0 65\nxx 0\n11xx 11\nxx11 11\n</code></pre>\n\n<p>Note that your last condition of xx11 handles it as 11.</p>\n"}, {"tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": false, "score": 2, "last_activity_date": 1437334719, "creation_date": 1437334719, "answer_id": 31505162, "question_id": 31487694, "link": "https://stackoverflow.com/questions/31487694/how-can-i-convert-string-to-integer-in-golang/31505162#31505162", "title": "How can I convert string to integer in golang", "body": "<blockquote>\n  <p>I want to convert string to integer in golang. </p>\n</blockquote>\n\n<p>As you've already mentioned, there is a <code>strconv.ParseInt</code> function that does exactly this!</p>\n\n<blockquote>\n  <p>But I don't know the format of string.</p>\n</blockquote>\n\n<p>That sounds scary (and challenging), but after looking at your examples I can easily conclude you know the format and the problem can be stated like this:</p>\n\n<p><em>How can I parse an initial portion of a string as an integer?</em></p>\n\n<p>As <code>strconv.ParseInt</code> returns 0 on syntax error it's not a good fit; well, at least not a good fit directly. But it <em>can</em> parse your initial portion if you <em>extract</em> it. I'm sure you've already figured it out, but this is really the cleanest solution: extract your content from the string, parse it.</p>\n\n<p>You can extract the leading integer in a few ways, one of them is by using <code>regexp</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n    \"strconv\"\n)\n\n// Extract what you need\nvar leadingInt = regexp.MustCompile(`^[-+]?\\d+`)\n\nfunc ParseLeadingInt(s string) (int64, error) {\n    s = leadingInt.FindString(s)\n    if s == \"\" { // add this if you don't want error on \"xx\" etc\n        return 0, nil\n    }\n    return strconv.ParseInt(s, 10, 64)\n}\n\nfunc main() {\n    for _, s := range []string{\"10\", \"65.0\", \"xx\", \"11xx\", \"xx11\"} {\n        i, err := ParseLeadingInt(s)\n        fmt.Printf(\"%s\\t%d\\t%v\\n\", s, i, err)\n    }\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/d7sS5_WpLj\" rel=\"nofollow\">http://play.golang.org/p/d7sS5_WpLj</a></p>\n\n<p>I believe this code is simple and clearly demonstrates the intentions. You're also using standard <code>ParseInt</code> which <em>works</em> and gives you all the error checking you need.</p>\n\n<p>If for any reason you can't afford extracting the leading integer (you need it blazing fast parsing terabytes of data and your boss is screaming at you they need it now now now and better yesterday so bend the time and deliver it :hiss:) than I suggest diving into the <a href=\"http://golang.org/src/strconv/atoi.go?s=3482:3549#L140\" rel=\"nofollow\">source code</a> and amending the standard parser so it doesn't report syntax errors, but returns a parsed portion of the string.</p>\n"}, {"comments": [{"owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "edited": false, "score": 0, "creation_date": 1503289764, "post_id": 45789289, "comment_id": 78536343, "body": "As well a checking for a leading minus sign you might first want to skip leading whitespace, for completeness. I leave this as an exercise."}], "tags": [], "owner": {"reputation": 2292, "user_id": 767903, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ae9acb5bf16896b78a9708403da20ca?s=128&d=identicon&r=PG", "display_name": "Andrew W. Phillips", "link": "https://stackoverflow.com/users/767903/andrew-w-phillips"}, "is_accepted": false, "score": 1, "last_activity_date": 1503289444, "creation_date": 1503289444, "answer_id": 45789289, "question_id": 31487694, "link": "https://stackoverflow.com/questions/31487694/how-can-i-convert-string-to-integer-in-golang/45789289#45789289", "title": "How can I convert string to integer in golang", "body": "<p>Extracting an int from the start of a string is one of the most common things I do. In C you can use atoi() or strtol(). It's ridiculous that Go does not have a std library function to do it.  Anyway here is one I just rolled up:</p>\n\n<pre><code>// strToInt gets the integer from the start of the string.\n// It returns the value and the offset of the first non-digit.\nfunc StrToInt(s string) (v int, offset int) {\n    offset = strings.IndexFunc(s, func(r rune) bool { return r &lt; '0' || r &gt; '9' })\n    if offset == -1 { offset = len(s) }\n    if offset == 0 { return }   // Avoid Atoi on empty string\n    v, _ = strconv.Atoi(s[:offset])\n    return\n}\n</code></pre>\n\n<p>You'll need a slight fix if you want to handle -ve integers.</p>\n"}, {"tags": [], "owner": {"reputation": 394, "user_id": 4228257, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-d6X-UaktgH4/AAAAAAAAAAI/AAAAAAAAAQ4/fJ0efBOlRHA/photo.jpg?sz=128", "display_name": "Deepak G", "link": "https://stackoverflow.com/users/4228257/deepak-g"}, "is_accepted": false, "score": 4, "last_activity_date": 1587429334, "last_edit_date": 1587429334, "creation_date": 1535981811, "answer_id": 52150889, "question_id": 31487694, "link": "https://stackoverflow.com/questions/31487694/how-can-i-convert-string-to-integer-in-golang/52150889#52150889", "title": "How can I convert string to integer in golang", "body": "<pre><code>package main\n\nimport \"strconv\"\nimport \"fmt\"\n\n// The built-in package \"strconv\" provides the number parsing.\n\n// For `ParseInt`, the `0` means infer the base from\n// the string. `64` requires that the result fit in 64\n// bits.\n\n\nvalue, err := strconv.ParseInt(\"123\", 0, 64)\nif err != nil {\n    panic(err)\n}\nfmt.Println(value)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/N90EppECFk\" rel=\"nofollow noreferrer\">For reference, Click Here</a></p>\n\n<p>You can also pass a non-zero base (like <code>10</code>) if you always want the same thing.</p>\n"}, {"comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1594114085, "post_id": 62740786, "comment_id": 111005469, "body": "A boolean, numeric, or string type can be set to another type. For<code>[]byte</code> see <a href=\"https://stackoverflow.com/a/62725637/12817546\">stackoverflow.com/a/62725637/12817546</a>, for <code>float64</code> see <a href=\"https://stackoverflow.com/a/62753031/12817546\">stackoverflow.com/a/62753031/12817546</a>, <code>int</code> see <a href=\"https://stackoverflow.com/a/62737936/12817546\">stackoverflow.com/a/62737936/12817546</a>, <code>[]rune</code> see <a href=\"https://stackoverflow.com/a/62739051/12817546\">stackoverflow.com/a/62739051/12817546</a>, and for <code>bool</code> see <a href=\"https://stackoverflow.com/a/62726854/12817546\">stackoverflow.com/a/62726854/12817546</a>."}], "tags": [], "owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "is_accepted": false, "score": 2, "last_activity_date": 1602310855, "last_edit_date": 1602310855, "creation_date": 1593952650, "answer_id": 62740786, "question_id": 31487694, "link": "https://stackoverflow.com/questions/31487694/how-can-i-convert-string-to-integer-in-golang/62740786#62740786", "title": "How can I convert string to integer in golang", "body": "<p>To add to the excellent answer by @MayankPatel and by @DeepakG. A string can be set to various numeric types. Various numeric types can be set to a string. Likewise, &quot;true&quot; can be set to a bool and <code>true</code> can be set to a string.</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;strconv&quot;\n)\n\nfunc main() {\n    //convert a string to another type\n    f, _ := strconv.ParseFloat(&quot;70.99&quot;, 64)\n    i, _ := strconv.Atoi(fmt.Sprintf(&quot;%.f&quot;, f))\n    t, _ := strconv.ParseBool(&quot;true&quot;)\n    c := []interface{}{[]byte(&quot;70.99&quot;), f, i, rune(i), t}\n    checkType(c) //[]uint8 [55 48 46 57 57], float64 70.99, int 71, int32 71, bool true\n\n    //convert another type to a string\n    c = []interface{}{fmt.Sprintf(&quot;%s&quot;, []byte(&quot;70.99&quot;)), fmt.Sprintf(&quot;%.f&quot;, f), strconv.Itoa(i), string(rune(i)), strconv.FormatBool(t)}\n    checkType(c) //string 70.99, string 71, string 71, string G, string true\n}\n\nfunc checkType(s []interface{}) {\n    for k, _ := range s {\n        fmt.Printf(&quot;%T %v\\n&quot;, s[k], s[k])\n    }\n}\n</code></pre>\n<p>A string type represents the set of string values. A string value is a (possibly empty) sequence of bytes. The number of bytes is called the length of the string and is never negative. Strings are immutable. See <a href=\"https://Golang.org/ref/spec#String_types\" rel=\"nofollow noreferrer\">https://Golang.org/ref/spec#String_types</a>.</p>\n<p>Here are three ways to parse strings into integers, from fastest runtime to slowest: 1. strconv.ParseInt(...) fastest 2. strconv.Atoi(...) still very fast 3. fmt.Sscanf(...) not terribly fast but most flexible. See <a href=\"https://stackoverflow.com/a/47317150/12817546\">https://stackoverflow.com/a/47317150/12817546</a>.</p>\n<p>Avoid converting a string to []byte: b := []byte(s). It allocates a new memory space and copies the whole content into it. See <a href=\"https://stackoverflow.com/a/52943136/12817546\">https://stackoverflow.com/a/52943136/12817546</a>. See <a href=\"https://stackoverflow.com/a/41460993/12817546\">https://stackoverflow.com/a/41460993/12817546</a>. Quotes edited.</p>\n"}, {"tags": [], "owner": {"reputation": 179, "user_id": 12698841, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mnLhX.png?s=128&g=1", "display_name": "0example.com", "link": "https://stackoverflow.com/users/12698841/0example-com"}, "is_accepted": false, "score": 0, "last_activity_date": 1612875185, "creation_date": 1612875185, "answer_id": 66119399, "question_id": 31487694, "link": "https://stackoverflow.com/questions/31487694/how-can-i-convert-string-to-integer-in-golang/66119399#66119399", "title": "How can I convert string to integer in golang", "body": "<p>You can use these three functions to convert a string value to an integer or a float.\nNote : strconv inbuilt package must be imported to execute these functions.</p>\n<ol>\n<li><p>func Atoi(s string) (int, error)</p>\n</li>\n<li><p>func ParseInt(s string, base int, bitSize int) (i int64, err error)</p>\n</li>\n<li><p>func ParseFloat(s string, bitSize int) (float64, error)</p>\n<pre><code>package main\nimport (\n    &quot;fmt&quot;\n    &quot;strconv&quot;\n)\nfunc main() {\n    i, _ := strconv.Atoi(&quot;-42&quot;)\n    fmt.Println(i)\n\n    j,_ := strconv.ParseInt(&quot;-42&quot;,10,8)\n    fmt.Println(j)\n\n    k,_ := strconv.ParseFloat(&quot;-42.8&quot;,8)\n    fmt.Println(k)\n</code></pre>\n<p>}</p>\n</li>\n</ol>\n"}], "owner": {"reputation": 233, "user_id": 1118584, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f511f1e434de049eb7b34d5a57128bdd?s=128&d=identicon&r=PG", "display_name": "shenli3514", "link": "https://stackoverflow.com/users/1118584/shenli3514"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33872, "favorite_count": 0, "answer_count": 8, "score": 15, "last_activity_date": 1612875185, "creation_date": 1437192519, "last_edit_date": 1437327253, "question_id": 31487694, "link": "https://stackoverflow.com/questions/31487694/how-can-i-convert-string-to-integer-in-golang", "title": "How can I convert string to integer in golang", "body": "<p>I want to convert string to integer in golang. But I don't know the format of string. For example, <code>\"10\"</code> -> <code>10</code>, <code>\"65.0\"</code> -> <code>65</code>, <code>\"xx\"</code> -> <code>0</code>, \"11xx\" -> 11, \"xx11\"->0</p>\n\n<p>I do some searching and find <code>strconv.ParseInt()</code>. But it can not handle <code>\"65.0\"</code>. So I have to check string's format.</p>\n\n<p>Is there a better way?</p>\n"}, {"tags": ["ubuntu", "go", "installation"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1437166362, "post_id": 31484085, "comment_id": 50934058, "body": "Why not just install it with apt-get? <a href=\"https://github.com/golang/go/wiki/Ubuntu\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/Ubuntu</a>"}, {"owner": {"reputation": 6843, "user_id": 544094, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/per08.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/544094/chris"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1437166430, "post_id": 31484085, "comment_id": 50934079, "body": "@OneOfOne I did, but I ran into a different issue. I&#39;ll give it another go and update my question with the issue"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1437168260, "post_id": 31484085, "comment_id": 50934746, "body": "I&#39;m not sure but if you get that error with the official package, you should submit a bug."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1437174646, "post_id": 31484085, "comment_id": 50936536, "body": "Show the output of <code>go env</code>."}, {"owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "edited": false, "score": 2, "creation_date": 1437181765, "post_id": 31484085, "comment_id": 50938044, "body": "Do not use apt-get. Versions are way too outdated. Take a look to <a href=\"https://github.com/moovweb/gvm\" rel=\"nofollow noreferrer\">github.com/moovweb/gvm</a>"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1437184488, "post_id": 31484085, "comment_id": 50938461, "body": "It sounds like you have artifacts left over from an older install. The newer versions aren&#39;t compatible, hence the errors. Hose out <code>&#47;usr&#47;local&#47;go&#47;...</code> before reinstalling. <a href=\"https://github.com/travis-ci/gimme\" rel=\"nofollow noreferrer\">github.com/travis-ci/gimme</a> is a simple way to install the latest Go version on Ubuntu."}, {"owner": {"reputation": 605, "user_id": 917268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/187887731a1307f80996ca2eec88bd51?s=128&d=identicon&r=PG", "display_name": "coffekid", "link": "https://stackoverflow.com/users/917268/coffekid"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1437187818, "post_id": 31484085, "comment_id": 50938955, "body": "I agree with @elithrar before installing anything else, first make sure you have totally removed go. You can check if its there just typing: which go. To install the latest version see my answer below."}, {"owner": {"reputation": 6843, "user_id": 544094, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/per08.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/544094/chris"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1437399809, "post_id": 31484085, "comment_id": 50997316, "body": "Thanks for the help everyone. I ended up clearing go out completely, then using the script posted by @elithrar to install and it works now!"}], "answers": [{"tags": [], "owner": {"reputation": 605, "user_id": 917268, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/187887731a1307f80996ca2eec88bd51?s=128&d=identicon&r=PG", "display_name": "coffekid", "link": "https://stackoverflow.com/users/917268/coffekid"}, "is_accepted": false, "score": 8, "last_activity_date": 1475265195, "last_edit_date": 1475265195, "creation_date": 1437187139, "answer_id": 31487233, "question_id": 31484085, "link": "https://stackoverflow.com/questions/31484085/trouble-installing-go-correctly-on-ubuntu/31487233#31487233", "title": "Trouble installing Go correctly on Ubuntu", "body": "<p>This method is how I usually install on ubuntu machines and never fails. Hope it helps you.</p>\n\n<ol>\n<li><p>download go </p>\n\n<p><code>wget https://storage.googleapis.com/golang/go1.4.2.linux-amd64.tar.gz</code></p></li>\n<li><p>extract into /usr/local</p>\n\n<p><code>sudo tar -C /usr/local -xzf go1.4.2.linux-amd64.tar.gz</code></p></li>\n<li><p>add these lines to modify ~/.bashrc</p>\n\n<p><code>export PATH=$PATH:/usr/local/go/bin</code> </p>\n\n<p><code>export GOPATH=$HOME/go</code>  </p>\n\n<p><code>export GOBIN=$GOPATH/bin</code></p>\n\n<p><code>export PATH=$PATH:$GOPATH/bin</code></p></li>\n<li><p>save and reload sources</p>\n\n<p><code>source ~/.bashrc</code></p></li>\n<li><p>verify installation</p>\n\n<p><code>go env</code></p></li>\n<li><p>Create go directory</p>\n\n<p><code>mkdir ~/go</code></p></li>\n<li><p>Try getting some package</p>\n\n<p><code>go get github.com/smartystreets/goconvey</code></p></li>\n</ol>\n\n<p><strong>EDIT</strong></p>\n\n<p>I have created a bash script which does the above automatically for you. It always points to the latest go version, so be careful with that.</p>\n\n<p><code>wget -O - https://raw.githubusercontent.com/mauleyzaola/scripts/master/go/go.install.sh | sh</code></p>\n\n<p>Then, just reload <code>.bashrc</code></p>\n\n<p><code>source ~/.bashrc</code></p>\n"}, {"tags": [], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "is_accepted": false, "score": 9, "last_activity_date": 1539522714, "last_edit_date": 1539522714, "creation_date": 1437207266, "answer_id": 31489187, "question_id": 31484085, "link": "https://stackoverflow.com/questions/31484085/trouble-installing-go-correctly-on-ubuntu/31489187#31489187", "title": "Trouble installing Go correctly on Ubuntu", "body": "<p>These are the steps I followed for installing Go in my Ubuntu system :</p>\n\n<p><strong>Short Version :</strong>\n1. Run following commands for installation:</p>\n\n<pre><code>sudo apt-get remove -y gccgo-go &amp;&amp; wget http://golang.org/dl/go1.8.linux-amd64.tar.gz &amp;&amp; sudo apt-get -y install gcc &amp;&amp; sudo tar -C /usr/local -xzf go1.8.2.linux-amd64.tar.gz &amp;&amp; echo \"export PATH=\\$PATH:/usr/local/go/bin\" &gt;&gt; ~/.bashrc\n</code></pre>\n\n<blockquote>\n  <p><strong>Note:</strong> Changes the version number to install a specific version of Go. For example, to install 1.9 instead of 1.8 change the file name to go1.9.linux-amd64.tar.gz. The latest Go distributions can always be found at <a href=\"https://golang.org/dl/\" rel=\"nofollow noreferrer\">the official Go downloads page</a></p>\n</blockquote>\n\n<ol start=\"2\">\n<li>Setup workplace. (Point 6)</li>\n</ol>\n\n<p><strong>Long Version:</strong></p>\n\n<ol>\n<li><p>Download the binary release from <a href=\"https://www.google.com/url?q=https%3A%2F%2Fgolang.org%2Fdl%2F\" rel=\"nofollow noreferrer\">here</a>. Use go x.x.x.linux-amd64.tar.gz for ubuntu.\nFor version 1.4.2 you can type following in terminal.</p>\n\n<pre><code>wget http://golang.org/dl/go1.8.linux-amd64.tar.gz\n</code></pre></li>\n<li><p>Install gcc for cgo</p>\n\n<pre><code>sudo apt-get install gcc \n</code></pre></li>\n<li><p>Extract the tarball in /usr/local. It should create a go directory.</p>\n\n<pre><code>tar -C /usr/local -xzf go1.8.linux-amd64.tar.gz\n</code></pre>\n\n<p>(Typically these commands must be run as root or through sudo.) </p></li>\n<li><p>Add /usr/local/go/bin to the PATH environment variable.</p>\n\n<pre><code>gksu gedit ~/.bashrc\n</code></pre></li>\n<li><p>Add following line in the end of file</p>\n\n<pre><code>export PATH=$PATH:/usr/local/go/bin\n</code></pre></li>\n<li><p>Setup Workspace</p>\n\n<p>a. Create a workspace directory name go in your preferred location (<strong>unless you are using the default go installation location</strong>). I am using /home/vembu/work/projects/go</p>\n\n<pre><code>mkdir -p /home/vembu/work/projects/go\n</code></pre>\n\n<p>b. Export GOPATH</p>\n\n<pre><code>gedit ~/.bashrc\n</code></pre>\n\n<p>c. Add following line in the second last line</p>\n\n<pre><code>export GOPATH=/home/vembu/work/projects/go\n</code></pre>\n\n<p>d. For convenience, add the workspace's bin subdirectory to your PATH:  </p>\n\n<pre><code>export PATH=/usr/local/go/bin:$PATH:$GOPATH/bin\n</code></pre>\n\n<p>e. Finally .bashrc\u2019s last two line should look like this </p>\n\n<pre><code>export GOPATH=/home/vembu/work/projects/go\nexport PATH=/usr/local/go/bin:$GOPATH/bin:$PATH\n</code></pre>\n\n<p>f. Restart terminal.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 13151, "user_id": 3329664, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OU5vg.jpg?s=128&g=1", "display_name": "Billal Begueradj", "link": "https://stackoverflow.com/users/3329664/billal-begueradj"}, "is_accepted": false, "score": 1, "last_activity_date": 1547708020, "creation_date": 1547708020, "answer_id": 54230501, "question_id": 31484085, "link": "https://stackoverflow.com/questions/31484085/trouble-installing-go-correctly-on-ubuntu/54230501#54230501", "title": "Trouble installing Go correctly on Ubuntu", "body": "<p>You have chosen a system wide installation, so you could remove this line: <code>export GOPATH=$HOME/go</code> from <code>/etc/profile</code> source again this later file. All other steps you mentioned are not necessary at all.  And instead of restarting Terminal as mentioned by a previous answer, you will need to reboot your machine. So by the end all  what you have to do is to carefully follow the steps mentioned in the official documentation itself.</p>\n"}], "owner": {"reputation": 6843, "user_id": 544094, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/per08.jpg?s=128&g=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/544094/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10637, "favorite_count": 1, "answer_count": 3, "score": 11, "last_activity_date": 1547708020, "creation_date": 1437164485, "last_edit_date": 1525252529, "question_id": 31484085, "link": "https://stackoverflow.com/questions/31484085/trouble-installing-go-correctly-on-ubuntu", "title": "Trouble installing Go correctly on Ubuntu", "body": "<p>I successfully installed this on my Mac, just having trouble on Linux. I'm following along their doc <a href=\"https://golang.org/doc/install\" rel=\"noreferrer\">https://golang.org/doc/install</a>. I'm running a 64bit machine so I downloaded the 64bit archive. Once downloaded I run</p>\n\n<pre><code>sudo tar -C /usr/local/ -xzf ~/Downloads/go1.4.2.linux-amd64.tar.gz\n</code></pre>\n\n<p>I created a <code>go</code> directory in my home folder. I have the structure</p>\n\n<pre><code>/home\n--/chrism\n----/go\n------/src\n------/pkg\n------/bin\n</code></pre>\n\n<p>And I add the following to <code>/etc/profile</code>. After saving I run <code>source /etc/profile</code></p>\n\n<pre><code>export PATH=$PATH:/usr/local/go/bin\nexport GOPATH=$HOME/go\n</code></pre>\n\n<p>In <code>src/</code> I added a directory <code>git.mycompany.com</code> and in their another directory called <code>test</code>. In <code>test/</code> I made <code>test.go</code> and pasted the block of code from the tutorial above in </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Printf(\"hello, world\\n\")\n}\n</code></pre>\n\n<p>When I run <code>go run test.go</code>, it outputs the following</p>\n\n<pre><code>chrism@ubuntu:~/go/src/git.mycompany.com/test$ go run test.go \n# fmt\nUsage: pack op file.a [name....]\nWhere op is one of cprtx optionally followed by v for verbose output.\nFor compatibility with old Go build environments the op string grc is\naccepted as a synonym for c.\n\nFor more information, run\n    godoc cmd/pack\n# runtime\nUsage: pack op file.a [name....]\nWhere op is one of cprtx optionally followed by v for verbose output.\nFor compatibility with old Go build environments the op string grc is\naccepted as a synonym for c.\n\nFor more information, run\n    godoc cmd/pack\n</code></pre>\n\n<p>If I add more packages to my import statement, it'll output the documentation for all those packages as well.</p>\n\n<p>EDIT 0:\nI also tried to install with <code>apt-get</code>. I uninstalled and removed my previous changes and then installed. This resulted in the following when running:</p>\n\n<pre><code>chrism@ubuntu:~/go/src/git.mycompany.com/test$ go run test.go \ngo build fmt: exec: \"/usr/local/go/pkg/tool/linux_amd64/pack\": stat /usr/local/go/pkg/tool/linux_amd64/pack: no such file or directory\ngo build runtime: exec: \"/usr/local/go/pkg/tool/linux_amd64/pack\": stat /usr/local/go/pkg/tool/linux_amd64/pack: no such file or directory\n</code></pre>\n\n<p>EDIT 1:\nThis is the output of running <code>go env</code></p>\n\n<pre><code>GOROOT=\"/usr/lib/go\"\nGOBIN=\"\"\nGOARCH=\"amd64\"\nGOCHAR=\"6\"\nGOOS=\"linux\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOTOOLDIR=\"/usr/lib/go/pkg/tool/linux_amd64\"\nGOGCCFLAGS=\"-g -O2 -fPIC -m64 -pthread\"\nCGO_ENABLED=\"1\"\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "goji"], "answers": [{"comments": [{"owner": {"reputation": 204, "user_id": 138581, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7fec48a9caf9959bf9121e5b2bff2f5b?s=128&d=identicon&r=PG", "display_name": "Pascal Dennerly", "link": "https://stackoverflow.com/users/138581/pascal-dennerly"}, "edited": false, "score": 0, "creation_date": 1437341530, "post_id": 31486875, "comment_id": 50975128, "body": "Excellent - that was exactly it. Thanks very much for your help!"}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 1, "last_activity_date": 1437184166, "last_edit_date": 1437184166, "creation_date": 1437182768, "answer_id": 31486875, "question_id": 31483787, "link": "https://stackoverflow.com/questions/31483787/defined-a-goji-route-with-bound-parameter-but-getting-404/31486875#31486875", "title": "Defined a Goji route with bound parameter but getting 404", "body": "<p>The 404 isn't being returned by Goji\u2014any 404 from Goji should be logged to console (stdout) by the <code>Logger</code> middleware. The upstream handler passing requests to the Goji router is bouncing anything that isn't <code>/api/list</code>.</p>\n\n<p>You can fix this with a more lenient match:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/zenazn/goji/web\"\n    \"github.com/zenazn/goji/web/middleware\"\n)\n\nfunc main() {\n    mux := web.New()\n    http.Handle(\"/api/\", mux)\n\n    mux.Use(middleware.EnvInit)\n    mux.Use(middleware.Logger)\n\n    mux.Get(\"/api/list/:id\", debugHandler)\n    mux.Get(\"/api/list\", debugHandler)\n    mux.Post(\"/api/list\", debugHandler)\n\n    // If Goji's router 404's, we should call our custom handler, and it\n    // should also be apparent in the logs.\n    mux.NotFound(notFoundHandler)\n    http.ListenAndServe(\":8000\", nil)\n}\n\nfunc debugHandler(c web.C, w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"%v\\n\", r.URL.Path)\n}\n\nfunc notFoundHandler(c web.C, w http.ResponseWriter, r *http.Request) {\n    http.Error(w, fmt.Sprintf(\"Goji 404: %s\", r.URL.Path), 404)\n}\n</code></pre>\n\n<p>Note that I've changed the upstream <code>http.Handle</code> to <code>http.Handle(\"/api/\", mux)</code> to provide a more lenient match. The <code>net/http</code> router is very simple and because <code>/api/list/131313</code> (e.g. with an id) doesn't match <code>/api/list</code> it 404's before it even hits the Goji mux instance you created.</p>\n\n<p>Hope that helps.</p>\n"}], "owner": {"reputation": 204, "user_id": 138581, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7fec48a9caf9959bf9121e5b2bff2f5b?s=128&d=identicon&r=PG", "display_name": "Pascal Dennerly", "link": "https://stackoverflow.com/users/138581/pascal-dennerly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 218, "favorite_count": 0, "accepted_answer_id": 31486875, "answer_count": 1, "score": 0, "last_activity_date": 1437184166, "creation_date": 1437163163, "question_id": 31483787, "link": "https://stackoverflow.com/questions/31483787/defined-a-goji-route-with-bound-parameter-but-getting-404", "title": "Defined a Goji route with bound parameter but getting 404", "body": "<p>I've got a Google App Engine app using Goji and defined the following routes:</p>\n\n<pre><code>func init() {\n    mux := web.New()\n    http.Handle(\"/api/list\", mux)\n\n    mux.Use(middleware.EnvInit)\n    mux.Use(middleware.Logger)\n\n    mux.Get( \"/api/list\",       list.HandleListGetAll)\n    mux.Post(\"/api/list\",       list.HandleListNewList)\n    mux.Get( \"/api/list/:id\",   list.HandleListGetSingle)\n}\n</code></pre>\n\n<p>I can GET and POST to /api/list but GETing /api/list/0 just results in a 404, I think from Goji itself.</p>\n\n<p>Does anyone have any idea what I'm doing wrong?</p>\n"}, {"tags": ["linux", "go", "arm", "package", "raspberry-pi"], "answers": [{"comments": [{"owner": {"reputation": 1227, "user_id": 679692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9e06dfdd4b7e811f1b452c652f54d9e?s=128&d=identicon&r=PG", "display_name": "allonhadaya", "link": "https://stackoverflow.com/users/679692/allonhadaya"}, "edited": false, "score": 1, "creation_date": 1437186143, "post_id": 31486795, "comment_id": 50938705, "body": "Another approach to running the latest go on a raspberry pi is cross compiling. I&#39;ve had success using <a href=\"https://github.com/laher/goxc\" rel=\"nofollow noreferrer\">goxc</a> to do the job."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 1227, "user_id": 679692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9e06dfdd4b7e811f1b452c652f54d9e?s=128&d=identicon&r=PG", "display_name": "allonhadaya", "link": "https://stackoverflow.com/users/679692/allonhadaya"}, "edited": false, "score": 0, "creation_date": 1437194400, "post_id": 31486795, "comment_id": 50940014, "body": "Ha, good point. Been running Dave&#39;s Go builds on an ARM Chromebook for a while so reflexively suggested the Raspberry Pi version of that."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 1227, "user_id": 679692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9e06dfdd4b7e811f1b452c652f54d9e?s=128&d=identicon&r=PG", "display_name": "allonhadaya", "link": "https://stackoverflow.com/users/679692/allonhadaya"}, "edited": false, "score": 1, "creation_date": 1437200441, "post_id": 31486795, "comment_id": 50941150, "body": "Added a para on cross-compilation referencing goxc (and Go 1.5, which promises to simplify cross-compilation with the built-in tools)."}], "tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": false, "score": 3, "last_activity_date": 1437200326, "last_edit_date": 1437200326, "creation_date": 1437181812, "answer_id": 31486795, "question_id": 31483734, "link": "https://stackoverflow.com/questions/31483734/installing-a-go-package-on-a-raspberry-pi/31486795#31486795", "title": "Installing a Go package on a Raspberry Pi", "body": "<p>This message came up at <a href=\"https://github.com/revel/revel/issues/342\" rel=\"nofollow\">https://github.com/revel/revel/issues/342</a>: you likely have the old version of Go that came with your distribution and it lacks that package. You can download a recent go (1.4.2 as I'm writing) for ARMv6 from <a href=\"http://dave.cheney.net/unofficial-arm-tarballs\" rel=\"nofollow\">Dave Cheney's site</a>. You'll probably want to unpack that, move/rename the resulting dir to <code>~/go</code>, and change your <code>.bashrc</code> to set up a PATH and GOPATH in your homedir by adding lines like:</p>\n\n<pre><code># optional; makes bin/, pkg/ and src/ under your homedir for Go\nexport GOPATH=~    \n# puts the 'go' tool + built go binaries + anything else in ~/bin in PATH\n# remove the :~/bin bit if you don't want it\nexport PATH=~/go/bin:~/bin/:$PATH\n# lets Go know that it's not in /usr/local/go\nexport GOROOT=~/go\n</code></pre>\n\n<p>then <code>. ~/bashrc</code> or log out and in to put the latest in your environment. You might then run into other problems; if you get stuck, maybe post those as additional questions with all the details you can and a reference to this question. And <code>bash</code>-specific details vary if you use another shell.</p>\n\n<p>You can also (as user allonhadaya points out) cross-compile: build binaries to be transferred to your Raspberry Pi from a desktop or laptop. Tools like <a href=\"https://github.com/laher/goxc\" rel=\"nofollow\">goxc</a> help manage this (you can also do it by hand with environment variables like <code>GOOS</code> and <code>GOARCH</code> if you want). <a href=\"http://dave.cheney.net/2015/03/03/cross-compilation-just-got-a-whole-lot-better-in-go-1-5\" rel=\"nofollow\">In Go 1.5, scheduled to come out at the end of 2015, it will get simpler.</a></p>\n\n<p>\"Text file busy\" right after <code>chmod</code> is apparently <a href=\"https://github.com/docker/docker/issues/9547\" rel=\"nofollow\">something that happens</a>. Running <code>sync</code> between the chmod and running the binary may help. It could plausibly happen if the file were still downloading, too. Either way, it's still useful to have a Go environment for any other projects you want to build or potentially any coding you want to do yourself.</p>\n\n<p>Good luck with what you're doing!</p>\n"}], "owner": {"reputation": 1210, "user_id": 4867148, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5d91b0057ed27b336f7aac48e0373fb9?s=128&d=identicon&r=PG&f=1", "display_name": "Johnathon64", "link": "https://stackoverflow.com/users/4867148/johnathon64"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 809, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1437200326, "creation_date": 1437162927, "last_edit_date": 1437182685, "question_id": 31483734, "link": "https://stackoverflow.com/questions/31483734/installing-a-go-package-on-a-raspberry-pi", "title": "Installing a Go package on a Raspberry Pi", "body": "<p>I am currently using Raspbian on my Raspberry Pi Model B+. I already have Go installed and want to install <a href=\"http://bosun.org/scollector/\" rel=\"nofollow\">scollector</a>.  I tried</p>\n\n<pre><code>$ go get bosun.org/cmd/scollector\n</code></pre>\n\n<p>but got the error </p>\n\n<pre><code>package net/http/cookiejar: unrecognized import path \"net/http/cookiejar\"\n</code></pre>\n\n<p>I also tried to install via the ARMv6 binary. I ran the chmod +x command on the binary and then tried to execute it using <code>./scollector-linux-armv6</code> but got an error saying \"Text file busy.\"</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1437184222, "post_id": 31483088, "comment_id": 50938424, "body": "<a href=\"http://play.golang.org/p/oblO0tESu3\" rel=\"nofollow noreferrer\">play.golang.org/p/oblO0tESu3</a>"}, {"owner": {"reputation": 119, "user_id": 2460434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a46cd77114d95704a9fc5aee25dab4cb?s=128&d=identicon&r=PG", "display_name": "k3v", "link": "https://stackoverflow.com/users/2460434/k3v"}, "reply_to_user": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1437184398, "post_id": 31483088, "comment_id": 50938445, "body": "When you add the pointer receiver, the struct is no longer implementing the interface as shown in the image in the question."}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1437185901, "post_id": 31483088, "comment_id": 50938670, "body": "you can use pointer for <code>b</code> <a href=\"http://play.golang.org/p/kYQS5Skic8\" rel=\"nofollow noreferrer\">play.golang.org/p/kYQS5Skic8</a>"}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 2460434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a46cd77114d95704a9fc5aee25dab4cb?s=128&d=identicon&r=PG", "display_name": "k3v", "link": "https://stackoverflow.com/users/2460434/k3v"}, "edited": false, "score": 0, "creation_date": 1437168971, "post_id": 31483406, "comment_id": 50934981, "body": "I think by adding the * to the methods you are no longer implementing the interface."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1437169028, "post_id": 31483406, "comment_id": 50934996, "body": "The usual suspect: You cannot modify a value from within non-pointer-receiver methods. The OPs problem has nothing to do with &quot;pointer of a variable&quot;."}, {"owner": {"reputation": 119, "user_id": 2460434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a46cd77114d95704a9fc5aee25dab4cb?s=128&d=identicon&r=PG", "display_name": "k3v", "link": "https://stackoverflow.com/users/2460434/k3v"}, "edited": false, "score": 0, "creation_date": 1437169800, "post_id": 31483406, "comment_id": 50935260, "body": "It does have to do with the pointer of a variable because I can change the value of an *int by mutating the deference but I can&#39;t do that here because I need to change the reference itself."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1437170930, "post_id": 31483406, "comment_id": 50935603, "body": "&gt; I think by adding the * to the methods you are no longer implementing the interface. &lt; In fact, it does, but a bit differently - <code>b := BlahInterface(&amp;BlahImpl{id: &amp;i})</code> works well."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1437171120, "post_id": 31483406, "comment_id": 50935663, "body": "&gt; It does have to do with the pointer of a variable because I can change the value of an *int by mutating the deference but I can&#39;t do that here because I need to change the reference itself. &lt; Actually, you cannot change any other struct field as well. Just add normal int and try to change it: <a href=\"http://play.golang.org/p/7L37pHJlbJ\" rel=\"nofollow noreferrer\">play.golang.org/p/7L37pHJlbJ</a>"}, {"owner": {"reputation": 119, "user_id": 2460434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a46cd77114d95704a9fc5aee25dab4cb?s=128&d=identicon&r=PG", "display_name": "k3v", "link": "https://stackoverflow.com/users/2460434/k3v"}, "edited": false, "score": 0, "creation_date": 1437176673, "post_id": 31483406, "comment_id": 50937010, "body": "I&#39;m getting this error when I add an * to the method receiver. <a href=\"http://imgur.com/E0Gg46f\" rel=\"nofollow noreferrer\">imgur.com/E0Gg46f</a>"}, {"owner": {"reputation": 119, "user_id": 2460434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a46cd77114d95704a9fc5aee25dab4cb?s=128&d=identicon&r=PG", "display_name": "k3v", "link": "https://stackoverflow.com/users/2460434/k3v"}, "edited": false, "score": 0, "creation_date": 1437177070, "post_id": 31483406, "comment_id": 50937092, "body": "I added an image to the OP with this issue."}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 1, "last_activity_date": 1437161616, "creation_date": 1437161616, "answer_id": 31483406, "question_id": 31483088, "link": "https://stackoverflow.com/questions/31483088/how-to-change-the-pointer-of-a-variable-in-a-struct-with-method-implemented-from/31483406#31483406", "title": "How to change the pointer of a variable in a struct with method implemented from interface", "body": "<p>Well, to be honest I do not quite get why it works this way, but this works as you want it to:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    i := 1\n    b := BlahImpl{id: &amp;i}\n\n    fmt.Println(b.ID())\n    j := 2\n    b.SetID(&amp;j)\n\n    fmt.Println(b.ID())\n}\n\ntype BlahInterface interface {\n    SetID(*int)\n    ID() int\n}\n\ntype BlahImpl struct {\n    id *int\n}\n\nfunc (b *BlahImpl) SetID(i *int) {\n    b.id = i\n}\n\nfunc (b *BlahImpl) ID() int {\n    return *b.id\n}\n</code></pre>\n\n<p>The difference is how the structure's methods are defined. I've added <code>*</code> before the name so reference on the structure is passed into the method. It looks like without <code>*</code> the method gets copy of the struct so the modification does not work.</p>\n"}], "owner": {"reputation": 119, "user_id": 2460434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a46cd77114d95704a9fc5aee25dab4cb?s=128&d=identicon&r=PG", "display_name": "k3v", "link": "https://stackoverflow.com/users/2460434/k3v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "accepted_answer_id": 31483406, "answer_count": 1, "score": -4, "last_activity_date": 1437184456, "creation_date": 1437160341, "last_edit_date": 1437184456, "question_id": 31483088, "link": "https://stackoverflow.com/questions/31483088/how-to-change-the-pointer-of-a-variable-in-a-struct-with-method-implemented-from", "title": "How to change the pointer of a variable in a struct with method implemented from interface", "body": "<p>Edit: For everyone suggesting using a pointer receiver in the function: By changing the method to have a pointer receiver, the structure no longer implements the interface. I have a image at the bottom of my question showing that.</p>\n\n<p>I am trying to make a setter that will mutate the pointer of a variable in a struct with a method implemented from an interface.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    i := 1\n    b := BlahImpl {id:&amp;i}\n\n    fmt.Println(b.ID())\n    j := 2\n    b.SetID(&amp;j)\n\n    fmt.Println(b.ID())\n}\n\ntype BlahInterface interface {\n    SetID(*int)\n    ID() int\n}\n\ntype BlahImpl struct {\n    id *int\n}\n\nfunc (b BlahImpl) SetID(i *int) {\n    b.id = i\n}\n\nfunc (b BlahImpl) ID() int {\n    return *b.id\n}\n</code></pre>\n\n<p>The current output is:</p>\n\n<pre><code>1\n1\n</code></pre>\n\n<p>But I would like:</p>\n\n<pre><code>1\n2\n</code></pre>\n\n<p>When I use pointer receiver I get this error because the struct is no longer implementing the interface.\n<img src=\"https://i.stack.imgur.com/QRfRB.png\" alt=\"error\"></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 1, "creation_date": 1437165952, "post_id": 31482900, "comment_id": 50933932, "body": "Not that in Go 1.5 there &quot;is&quot; a <a href=\"https://github.com/golang/go/blob/master/src/strings/compare.go\" rel=\"nofollow noreferrer\">strings.Compare</a>, however it&#39;s by design extremely inefficient."}], "answers": [{"comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1437169174, "post_id": 31484416, "comment_id": 50935061, "body": "I don&#39;t think one should not propose to use package unsafe for premature optimizations. If the OP would have demonstrated that the conversion is the main bottleneck of his code, well maybe."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1437169351, "post_id": 31484416, "comment_id": 50935123, "body": "@Volker he explained that for his workload <code>str == string(byteSlice)</code> is inefficient because it copies it, which is understandable."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1437174576, "post_id": 31484416, "comment_id": 50936527, "body": "If it is not on his hot path it just does not matter if it is inefficient or very inefficient."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1437187818, "post_id": 31484416, "comment_id": 50938956, "body": "@Volker that highly depends on what he&#39;s trying to do, my method is a valid alternative."}, {"owner": {"reputation": 2900, "user_id": 2898400, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8d5c75d8d2fe7f1cd7b57119f5c4852a?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Bukanov", "link": "https://stackoverflow.com/users/2898400/igor-bukanov"}, "edited": false, "score": 0, "creation_date": 1437210184, "post_id": 31484416, "comment_id": 50943056, "body": "The benchmark here assumes that the match is expected so the whole string should be scanned when nothing beats hand-coded assembler. Still this is a valid answer if one looks for fast universal solution and using unsafe code is OK."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 8, "last_activity_date": 1437188050, "last_edit_date": 1437188050, "creation_date": 1437165826, "answer_id": 31484416, "question_id": 31482900, "link": "https://stackoverflow.com/questions/31482900/compare-string-and-byte-slice-in-go-without-copy/31484416#31484416", "title": "Compare string and byte slice in Go without copy", "body": "<p>If you're comfortable enough with the fact that this can break on a later release (doubtful though), you can use <code>unsafe</code>:</p>\n\n<pre><code>func unsafeCompare(a string, b []byte) int {\n    abp := *(*[]byte)(unsafe.Pointer(&amp;a))\n    return bytes.Compare(abp, b)\n}\n\nfunc unsafeEqual(a string, b []byte) bool {\n    bbp := *(*string)(unsafe.Pointer(&amp;b))\n    return a == bbp\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/oXO4AH9L_q\" rel=\"noreferrer\"><kbd>playground</kbd></a></p>\n\n<p><a href=\"http://play.golang.org/p/WAR6RvJ203\" rel=\"noreferrer\">Benchmarks</a>:</p>\n\n<pre><code>// using:\n//  aaa = strings.Repeat(\"a\", 100)\n//  bbb = []byte(strings.Repeat(\"a\", 99) + \"b\")\n\n// go 1.5\nBenchmarkCopy-8         20000000                75.4 ns/op\nBenchmarkPetersEqual-8  20000000                83.1 ns/op\nBenchmarkUnsafe-8       100000000               12.2 ns/op\nBenchmarkUnsafeEqual-8  200000000               8.94 ns/op\n// go 1.4\nBenchmarkCopy           10000000                233  ns/op\nBenchmarkPetersEqual    20000000                72.3 ns/op\nBenchmarkUnsafe         100000000               15.5 ns/op\nBenchmarkUnsafeEqual    100000000               10.7 ns/op\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2900, "user_id": 2898400, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8d5c75d8d2fe7f1cd7b57119f5c4852a?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Bukanov", "link": "https://stackoverflow.com/users/2898400/igor-bukanov"}, "edited": false, "score": 2, "creation_date": 1437208445, "post_id": 31486302, "comment_id": 50942693, "body": "In absence of a native implementation this is good enough universal replacement especially when on average match is not expected and the loop terminates after the first or second character"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 6, "last_activity_date": 1437177512, "last_edit_date": 1437177512, "creation_date": 1437176878, "answer_id": 31486302, "question_id": 31482900, "link": "https://stackoverflow.com/questions/31482900/compare-string-and-byte-slice-in-go-without-copy/31486302#31486302", "title": "Compare string and byte slice in Go without copy", "body": "<blockquote>\n  <p><a href=\"http://golang.org/ref/spec\" rel=\"noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"http://golang.org/ref/spec#String_types\" rel=\"noreferrer\">String types</a></p>\n  \n  <p>A string type represents the set of string values. A string value is a\n  (possibly empty) sequence of bytes. The predeclared string type is\n  string.</p>\n  \n  <p>The length of a string s (its size in bytes) can be discovered using\n  the built-in function len. A string's bytes can be accessed by integer\n  indices 0 through len(s)-1.</p>\n</blockquote>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc equal(s string, b []byte) bool {\n    if len(s) != len(b) {\n        return false\n    }\n    for i, x := range b {\n        if x != s[i] {\n            return false\n        }\n    }\n    return true\n}\n\nfunc main() {\n    s := \"equal\"\n    b := []byte(s)\n    fmt.Println(equal(s, b))\n    s = \"not\" + s\n    fmt.Println(equal(s, b))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>true\nfalse\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 104432, "user_id": 53212, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0fbce15f81d6308656931250db267a1?s=128&d=identicon&r=PG", "display_name": "thomasrutter", "link": "https://stackoverflow.com/users/53212/thomasrutter"}, "edited": false, "score": 0, "creation_date": 1504847020, "post_id": 35342389, "comment_id": 79180435, "body": "Even in 1.7, I find that comparing the lengths first is faster in the case they are different: <code>len(str) == len(byteSlice) &amp;&amp; str == string(byteSlice)</code> - it looks like this is because Go does the creation of the temporary slice (with no alloc, but still takes a little time) before it compares length."}], "tags": [], "owner": {"reputation": 2900, "user_id": 2898400, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8d5c75d8d2fe7f1cd7b57119f5c4852a?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Bukanov", "link": "https://stackoverflow.com/users/2898400/igor-bukanov"}, "is_accepted": true, "score": 9, "last_activity_date": 1455201816, "creation_date": 1455201816, "answer_id": 35342389, "question_id": 31482900, "link": "https://stackoverflow.com/questions/31482900/compare-string-and-byte-slice-in-go-without-copy/35342389#35342389", "title": "Compare string and byte slice in Go without copy", "body": "<p>Starting from Go 1.5 the compiler optimizes string(bytes) when comparing to a string using a <a href=\"https://github.com/golang/go/commit/69cd91a5981c49eaaa59b33196bdb5586c18d289\" rel=\"noreferrer\">stack-allocated temporary</a>. Thus since Go 1.5</p>\n\n<pre><code>str == string(byteSlice)\n</code></pre>\n\n<p>became a canonical and efficient way to compare string to a byte slice. </p>\n"}, {"tags": [], "owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "is_accepted": false, "score": 0, "last_activity_date": 1573313240, "creation_date": 1573313240, "answer_id": 58780680, "question_id": 31482900, "link": "https://stackoverflow.com/questions/31482900/compare-string-and-byte-slice-in-go-without-copy/58780680#58780680", "title": "Compare string and byte slice in Go without copy", "body": "<p>There is no reason to use the unsafe package or something just to compare <code>[]byte</code> and <code>string</code>. The Go compiler is clever enough now, and it can optimize such conversions.</p>\n\n<p><strong><a href=\"https://play.golang.org/p/8kefbW8q2et\" rel=\"nofollow noreferrer\">Here's a benchmark</a>:</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>BenchmarkEqual-8                172135624                6.96 ns/op &lt;--\nBenchmarkUnsafe-8               179866616                6.65 ns/op &lt;--\nBenchmarkUnsafeEqual-8          175588575                6.85 ns/op &lt;--\nBenchmarkCopy-8                 23715144                 47.3 ns/op\nBenchmarkPetersEqual-8          24709376                 47.3 ns/op\n</code></pre>\n\n<p><strong>Just convert a byte slice to a string and compare:</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var (\n    aaa = strings.Repeat(\"a\", 100)\n    bbb = []byte(strings.Repeat(\"a\", 99) + \"b\")\n)\n\nfunc BenchmarkEqual(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        _ = aaa == string(bbb)\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>\ud83d\udc49 <a href=\"https://go-review.googlesource.com/c/gofrontend/+/170894\" rel=\"nofollow noreferrer\">Here is more information about the optimization</a>, and <a href=\"https://go-review.googlesource.com/c/go/+/173323/\" rel=\"nofollow noreferrer\">this</a>.</p>\n"}], "owner": {"reputation": 2900, "user_id": 2898400, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8d5c75d8d2fe7f1cd7b57119f5c4852a?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Bukanov", "link": "https://stackoverflow.com/users/2898400/igor-bukanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8640, "favorite_count": 2, "accepted_answer_id": 35342389, "answer_count": 4, "score": 12, "last_activity_date": 1573313240, "creation_date": 1437159533, "question_id": 31482900, "link": "https://stackoverflow.com/questions/31482900/compare-string-and-byte-slice-in-go-without-copy", "title": "Compare string and byte slice in Go without copy", "body": "<p>What is the best way to check that Go string and a byte slice contain the same bytes? The simplest <code>str == string(byteSlice)</code> is inefficient as it copies <code>byteSlice</code> first.</p>\n\n<p>I was looking for a version of <a href=\"https://golang.org/src/bytes/bytes_decl.go?s=523:551#L7\" rel=\"noreferrer\">Equal(a, b []byte)</a> that takes a string as its argument, but could not find anything suitable.</p>\n"}, {"tags": ["validation", "go"], "answers": [{"comments": [{"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 0, "creation_date": 1488996710, "post_id": 31480759, "comment_id": 72481930, "body": "Here is an example of <a href=\"https://play.golang.org/p/-TFUkUdDlU\" rel=\"nofollow noreferrer\">both of these returning junk</a>"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 1, "creation_date": 1489009655, "post_id": 31480759, "comment_id": 72489188, "body": "@Xeoncross I&#39;m pretty sure that&#39;s a valid URL"}, {"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 3, "creation_date": 1489012390, "post_id": 31480759, "comment_id": 72490478, "body": "Looked <a href=\"https://www.ietf.org/rfc/rfc3986.txt\" rel=\"nofollow noreferrer\">at the spec RFC 3986</a>, you are right @Not_a_Golfer"}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "edited": false, "score": 14, "creation_date": 1502422612, "post_id": 31480759, "comment_id": 78212514, "body": "did something change? relative URLs now pass. <a href=\"https://play.golang.org/p/7v5YF24DUP\" rel=\"nofollow noreferrer\">play.golang.org/p/7v5YF24DUP</a>"}, {"owner": {"reputation": 704, "user_id": 4792552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a528513962a9c962ff32df92a1a350b?s=128&d=identicon&r=PG", "display_name": "Berkant Ipek", "link": "https://stackoverflow.com/users/4792552/berkant-ipek"}, "edited": false, "score": 2, "creation_date": 1604406319, "post_id": 31480759, "comment_id": 114332748, "body": "<code>u, err := url.ParseRequestURI(&quot;&#47;foo&#47;bar&quot;)</code>  This passes with Go 1.15."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 82, "last_activity_date": 1501902701, "last_edit_date": 1501902701, "creation_date": 1437151471, "answer_id": 31480759, "question_id": 31480710, "link": "https://stackoverflow.com/questions/31480710/validate-url-with-standard-package-in-go/31480759#31480759", "title": "Validate URL with standard package in GO", "body": "<p>Yep, <a href=\"https://golang.org/pkg/net/url/#ParseRequestURI\" rel=\"noreferrer\"><code>url.ParseRequestURI</code></a> returns an error if the URL is not valid, not an absolute url, etc etc. <a href=\"https://golang.org/pkg/net/url/#Parse\" rel=\"noreferrer\"><code>url.Parse</code></a> returns valid on almost anything...</p>\n\n<pre><code>import \"net/url\"\n\n...\n\n\nu, err := url.ParseRequestURI(\"http://google.com/\")\nif err != nil {\n   panic(err)\n}\n</code></pre>\n\n<p>The above example will not fail, but these will:</p>\n\n<pre><code>u, err := url.ParseRequestURI(\"http//google.com\")\n\nu, err := url.ParseRequestURI(\"google.com\")\n\nu, err := url.ParseRequestURI(\"/foo/bar\")\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 351, "user_id": 5212325, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/201484d825af1cb0f27706dd14617d8f?s=128&d=identicon&r=PG&f=1", "display_name": "gkarthiks", "link": "https://stackoverflow.com/users/5212325/gkarthiks"}, "edited": false, "score": 0, "creation_date": 1599620597, "post_id": 55328193, "comment_id": 112826318, "body": "this makes me not to implement the built-in as is."}], "tags": [], "owner": {"reputation": 970, "user_id": 4770888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c24c9b16fef0f5b9bf359aea27466e00?s=128&d=identicon&r=PG", "display_name": "Tommy May", "link": "https://stackoverflow.com/users/4770888/tommy-may"}, "is_accepted": false, "score": 6, "last_activity_date": 1553458910, "creation_date": 1553458910, "answer_id": 55328193, "question_id": 31480710, "link": "https://stackoverflow.com/questions/31480710/validate-url-with-standard-package-in-go/55328193#55328193", "title": "Validate URL with standard package in GO", "body": "<p>This helped me understand how the standard library <a href=\"https://golang.org/pkg/net/url/#Parse\" rel=\"noreferrer\">url.Parse</a> method works, hope it helps some of you as well. Notice that all these values never throw an error.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/url\"\n)\n\nfunc main() {\n    urls := []string{\n        \"https\",\n        \"https://\",\n        \"\",\n        \"http://www\",\n        \"http://www.dumpsters.com\",\n        \"https://www.dumpsters.com:443\",\n        \"/testing-path\",\n        \"testing-path\",\n        \"alskjff#?asf//dfas\",\n    }\n    for _, u := range urls {\n        val, err := url.Parse(u)\n        scheme := val.Scheme\n        host := val.Host\n        hostname := val.Hostname()\n        path := val.Path\n        fmt.Println(\"val        : \"+u+\" : \", val)\n        fmt.Println(\"error      : \"+u+\" : \", err)\n        fmt.Println(\"scheme     : \"+u+\" : \", scheme)\n        fmt.Println(\"host       : \"+u+\" : \", host)\n        fmt.Println(\"hostname   : \"+u+\" : \", hostname)\n        fmt.Println(\"path       : \"+u+\" : \", path)\n        fmt.Println()\n    }\n}\n</code></pre>\n\n<p>The results</p>\n\n<pre><code>val        : https :  https\nerror      : https :  &lt;nil&gt;\nscheme     : https :\nhost       : https :\nhostname   : https :\npath       : https :  https\n\nval        : https:// :  https:\nerror      : https:// :  &lt;nil&gt;\nscheme     : https:// :  https\nhost       : https:// :\nhostname   : https:// :\npath       : https:// :\n\nval        :  :\nerror      :  :  &lt;nil&gt;\nscheme     :  :\nhost       :  :\nhostname   :  :\npath       :  :\n\nval        : http://www :  http://www\nerror      : http://www :  &lt;nil&gt;\nscheme     : http://www :  http\nhost       : http://www :  www\nhostname   : http://www :  www\npath       : http://www :\n\nval        : http://www.dumpsters.com :  http://www.dumpsters.com\nerror      : http://www.dumpsters.com :  &lt;nil&gt;\nscheme     : http://www.dumpsters.com :  http\nhost       : http://www.dumpsters.com :  www.dumpsters.com\nhostname   : http://www.dumpsters.com :  www.dumpsters.com\npath       : http://www.dumpsters.com :\n\nval        : https://www.dumpsters.com:443 :  https://www.dumpsters.com:443\nerror      : https://www.dumpsters.com:443 :  &lt;nil&gt;\nscheme     : https://www.dumpsters.com:443 :  https\nhost       : https://www.dumpsters.com:443 :  www.dumpsters.com:443\nhostname   : https://www.dumpsters.com:443 :  www.dumpsters.com\npath       : https://www.dumpsters.com:443 :\n\nval        : /testing-path :  /testing-path\nerror      : /testing-path :  &lt;nil&gt;\nscheme     : /testing-path :\nhost       : /testing-path :\nhostname   : /testing-path :\npath       : /testing-path :  /testing-path\n\nval        : testing-path :  testing-path\nerror      : testing-path :  &lt;nil&gt;\nscheme     : testing-path :\nhost       : testing-path :\nhostname   : testing-path :\npath       : testing-path :  testing-path\n\nval        : alskjff#?asf//dfas :  alskjff#?asf//dfas\nerror      : alskjff#?asf//dfas :  &lt;nil&gt;\nscheme     : alskjff#?asf//dfas :\nhost       : alskjff#?asf//dfas :\nhostname   : alskjff#?asf//dfas :\npath       : alskjff#?asf//dfas :  alskjff\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 443, "user_id": 1255101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/21fd1996db75007951e2f68a897e67a2?s=128&d=identicon&r=PG", "display_name": "Seven4X", "link": "https://stackoverflow.com/users/1255101/seven4x"}, "edited": false, "score": 0, "creation_date": 1605247588, "post_id": 55551215, "comment_id": 114598037, "body": "alse need validate  if  &quot;.&quot; in str when str not ip"}], "tags": [], "owner": {"reputation": 1900, "user_id": 744298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5b57a2e31a8167f66f1a2fa64a01c26?s=128&d=identicon&r=PG", "display_name": "jchavannes", "link": "https://stackoverflow.com/users/744298/jchavannes"}, "is_accepted": false, "score": 21, "last_activity_date": 1555396937, "last_edit_date": 1555396937, "creation_date": 1554568971, "answer_id": 55551215, "question_id": 31480710, "link": "https://stackoverflow.com/questions/31480710/validate-url-with-standard-package-in-go/55551215#55551215", "title": "Validate URL with standard package in GO", "body": "<p>The accepted answer allows empty <code>http://</code> and  relative urls like <code>/foo/bar</code>.  If you want a stricter check, this will reject those:</p>\n\n<pre><code>import \"net/url\"\n\nfunc IsUrl(str string) bool {\n    u, err := url.Parse(str)\n    return err == nil &amp;&amp; u.Scheme != \"\" &amp;&amp; u.Host != \"\"\n}\n</code></pre>\n\n<p>Example: <a href=\"https://play.golang.org/p/JngFarWPF2-\" rel=\"noreferrer\">https://play.golang.org/p/JngFarWPF2-</a></p>\n\n<p>Which came from this answer: <a href=\"https://stackoverflow.com/a/25747925/744298\">https://stackoverflow.com/a/25747925/744298</a></p>\n"}, {"comments": [{"owner": {"reputation": 2725, "user_id": 303114, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/kBVST.jpg?s=128&g=1", "display_name": "danfromisrael", "link": "https://stackoverflow.com/users/303114/danfromisrael"}, "edited": false, "score": 0, "creation_date": 1610963862, "post_id": 63804228, "comment_id": 116289197, "body": "in this case i believe its better to use a tested solution like you suggest here than writing it yourself"}], "tags": [], "owner": {"reputation": 351, "user_id": 5212325, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/201484d825af1cb0f27706dd14617d8f?s=128&d=identicon&r=PG&f=1", "display_name": "gkarthiks", "link": "https://stackoverflow.com/users/5212325/gkarthiks"}, "is_accepted": false, "score": 2, "last_activity_date": 1599621052, "creation_date": 1599621052, "answer_id": 63804228, "question_id": 31480710, "link": "https://stackoverflow.com/questions/31480710/validate-url-with-standard-package-in-go/63804228#63804228", "title": "Validate URL with standard package in GO", "body": "<p>I believe it's not intelligent with standard package. What I ended up is using <a href=\"https://github.com/asaskevich/govalidator\" rel=\"nofollow noreferrer\">https://github.com/asaskevich/govalidator</a></p>\n"}, {"tags": [], "owner": {"reputation": 443, "user_id": 1255101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/21fd1996db75007951e2f68a897e67a2?s=128&d=identicon&r=PG", "display_name": "Seven4X", "link": "https://stackoverflow.com/users/1255101/seven4x"}, "is_accepted": false, "score": 0, "last_activity_date": 1605248626, "creation_date": 1605248626, "answer_id": 64816381, "question_id": 31480710, "link": "https://stackoverflow.com/questions/31480710/validate-url-with-standard-package-in-go/64816381#64816381", "title": "Validate URL with standard package in GO", "body": "<pre><code>func IsUrl(str string) bool {\n    url, err := url.ParseRequestURI(str)\n    if err != nil {\n        log.Info(err.Error())\n        return false\n    }\n\n    address := net.ParseIP(url.Host)\n    log.Infow(&quot;url-info&quot;, &quot;host&quot;, address)\n\n    if address == nil {\n        log.Infow(&quot;url-info&quot;, &quot;host&quot;, url.Host)\n\n        return  strings.Contains(url.Host, &quot;.&quot;) \n    }\n\n    return true\n}\nfunc Test_IsAllowUrl(t *testing.T) {\n    assert.True(t, IsUrl(&quot;http://google.com&quot;))\n    assert.True(t, IsUrl(&quot;http://w.com/cn&quot;))\n    assert.True(t, IsUrl(&quot;http://192.158.0.1:90&quot;))\n    assert.False(t, IsUrl(&quot;http://w&quot;))\n    assert.False(t, IsUrl(&quot;fsw&quot;))\n    assert.False(t, IsUrl(&quot;http://192.158.1/1&quot;))\n\n}\n</code></pre>\n<p>the last &quot;http:/192.158.1/1&quot; not pass. may be should match all allow domains,but will be to complex\n<a href=\"https://www.iana.org/domains/root/db\" rel=\"nofollow noreferrer\">https://www.iana.org/domains/root/db</a></p>\n"}], "owner": {"reputation": 2692, "user_id": 625791, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/996a20b9eae1def21e8db462e9bf1cf7?s=128&d=identicon&r=PG", "display_name": "theduke", "link": "https://stackoverflow.com/users/625791/theduke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 26906, "favorite_count": 7, "accepted_answer_id": 31480759, "answer_count": 5, "score": 36, "last_activity_date": 1605248626, "creation_date": 1437151295, "question_id": 31480710, "link": "https://stackoverflow.com/questions/31480710/validate-url-with-standard-package-in-go", "title": "Validate URL with standard package in GO", "body": "<p>Is there any function in a standard package in GO that allows to validate a URL?</p>\n\n<p>I have not found anything on my initial search,\nand I would prefer not to resort to regex checking.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "edited": false, "score": 0, "creation_date": 1437149856, "post_id": 31480167, "comment_id": 50925778, "body": "Who ever was editing we where editing at the same time sorry :)"}, {"owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "edited": false, "score": 4, "creation_date": 1437151158, "post_id": 31480167, "comment_id": 50926527, "body": "In your example, you do not show where encode and decode are called. Please note os.Create creates a new file, and truncates it if it already exists. You need to create the file, encode to it, close it, open it again (but not with os.Create) and decode from it."}, {"owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "reply_to_user": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "edited": false, "score": 0, "creation_date": 1437151298, "post_id": 31480167, "comment_id": 50926598, "body": "Ok you are probably right here let me try to edit the code"}, {"owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "reply_to_user": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "edited": false, "score": 0, "creation_date": 1437151754, "post_id": 31480167, "comment_id": 50926846, "body": "done that is about it I think"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "edited": false, "score": 2, "creation_date": 1437156412, "post_id": 31480167, "comment_id": 50929276, "body": "Yeah, like @Didier said, to decode, you need to <code>Open</code> the file or <code>f.Seek(0, 0)</code> to read it from the start. In this respect files work differently from buffers."}, {"owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "edited": false, "score": 0, "creation_date": 1437157428, "post_id": 31480167, "comment_id": 50929814, "body": "Confirmed <code>f.Seek(0, 0)</code> is working, I don&#39;t think I would have figured that out myself :) please make answer so I can accept."}], "answers": [{"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 1, "last_activity_date": 1437157506, "creation_date": 1437157506, "answer_id": 31482352, "question_id": 31480167, "link": "https://stackoverflow.com/questions/31480167/gob-encoding-to-decoding-from-os-file-not-working/31482352#31482352", "title": "gob encoding to/decoding from *os.File not working", "body": "<p>The solution is already mentioned in the comments, so the update method <code>main()</code> is following:</p>\n\n<pre><code>func main() {\n    var err error\n    f, err = os.Create(\"_memcache.txt\")\n    if err != nil {\n        log.Print(err.Error())\n    }\n    defer f.Close()\n\n    memcache = make(map[string]interface{})\n    buf = new(bytes.Buffer)\n    gob.Register(map[string]interface{}{})\n\n    err = write()\n    if err != nil {\n        log.Print(err.Error())\n    }\n\n    // after write the file pointer is at the end of the file,\n    // so it should be moved:      \n    f.Seek(0, 0)\n\n    // alternatively, open the file in read()\n    err = read()\n    if err != nil {\n        log.Print(err.Error())\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 0, "accepted_answer_id": 31482352, "answer_count": 1, "score": -1, "last_activity_date": 1437157506, "creation_date": 1437149462, "last_edit_date": 1437156251, "question_id": 31480167, "link": "https://stackoverflow.com/questions/31480167/gob-encoding-to-decoding-from-os-file-not-working", "title": "gob encoding to/decoding from *os.File not working", "body": "<p>When I use a file pointer <code>f *os.File</code> I get a empty map back</p>\n\n<pre><code>func decode(f *os.File, b map[string]interface{}) error {\n    err := gob.NewDecoder(f).Decode(&amp;b)\n    fmt.Printf(\"%+v\\n\", b)\n    return err\n}\n\nfunc encode(f *os.File, b map[string]interface{}) error {\n    bb := map[string]interface{}{\n        \"X\":        1,\n        \"Greeting\": \"hello\",\n    }\n    err := gob.NewEncoder(f).Encode(bb)\n    f.Sync()\n    //fmt.Println(buf.Bytes())\n    return err\n}\n</code></pre>\n\n<p>prints <code>map[]</code></p>\n\n<p>If I replace it with a global buffer pointer <code>buf *bytes.Buffer</code> it works</p>\n\n<pre><code>func decode(f *os.File, b map[string]interface{}) error {\n    err := gob.NewDecoder(buf).Decode(&amp;b)\n    fmt.Printf(\"%+v\\n\", b)\n    return err\n}\n\nfunc encode(f *os.File, b map[string]interface{}) error {\n    bb := map[string]interface{}{\n        \"X\":        1,\n        \"Greeting\": \"hello\",\n    }\n    err := gob.NewEncoder(buf).Encode(bb)\n    return err\n}\n</code></pre>\n\n<p>prints <code>map[Greeting:hello X:1]</code></p>\n\n<p>f is opened in main like this </p>\n\n<pre><code>var (\n    buf      *bytes.Buffer\n    f       *os.File\n    memcache map[string]interface{}        \n)\n\nfunc main() {\n    var err error\n    f, err = os.Create(\"_memcache.txt\")\n    if err != nil {\n        log.Print(err.Error())\n    }\n    defer f.Close() \n\n    memcache = make(map[string]interface{})\n    buf = new(bytes.Buffer)\n    gob.Register(map[string]interface{}{})\n    err = write()\n    if err != nil {\n       log.Print(err.Error())\n    }\n    err = read()\n    if err != nil {\n        log.Print(err.Error())\n    }\n}\n\nfunc read() (err error) {\n    err = decode(f, memcache)\n    if err != nil &amp;&amp; err != io.EOF {\n        return err\n    }\n}\n\nfunc write() (err error) {\n    err = encode(f, memcache)\n    if err != nil {\n        return err\n    }\n }\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1437155341, "creation_date": 1437155341, "answer_id": 31481793, "question_id": 31480124, "link": "https://stackoverflow.com/questions/31480124/go-language-duplicate-string-constants-compilation/31481793#31481793", "title": "Go language: duplicate string constants compilation", "body": "<p>The language spec says nothing regarding the internal storage of string constants or literals. Based on this discussion I would assume there is currently no interning in the language; <a href=\"https://github.com/golang/go/issues/5160\" rel=\"nofollow\">https://github.com/golang/go/issues/5160</a> though that is a bit dated now.</p>\n\n<p>That same search turned up this project which you may find helpful; <a href=\"https://gist.github.com/karlseguin/6570372\" rel=\"nofollow\">https://gist.github.com/karlseguin/6570372</a> </p>\n"}], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 31481793, "answer_count": 1, "score": 0, "last_activity_date": 1437155691, "creation_date": 1437149284, "last_edit_date": 1437155691, "question_id": 31480124, "link": "https://stackoverflow.com/questions/31480124/go-language-duplicate-string-constants-compilation", "title": "Go language: duplicate string constants compilation", "body": "<p>I'm considering writing a template to Go code generator and wonder:</p>\n\n<p>If I have many string constants and/or variables with the same value would they be stored in an executable file multiple times or compiler will make an optimisation and store just 1 instance per duplicate and refer it wherever needed?</p>\n\n<p>E.g.</p>\n\n<pre><code>File1.go\n========\ns1 := \"some_string_1\"\ns2 := \"some_string_2\"\n\nFileN.go\n========\na1 := \"some_string_1\"\na1 := \"some_string_2\"\n</code></pre>\n\n<p>Would it affect file size if I have multiple files with the same constants or compiler is smart enough to make optimization?</p>\n\n<p>Imagine that in many templates I have somthing like:</p>\n\n<pre><code>Template 1\n==========\n{% for a in list1 %}&lt;td&gt;{{a}}&lt;/td&gt;{% endfor %}\n\nTempalte 2\n==========\n{% for b in list2 %}&lt;td&gt;{{b.c}}&lt;/td&gt;&lt;td&gt;{{b.d}}&lt;/td&gt;{% endfor %}\n</code></pre>\n\n<p>that would be translated to something like:</p>\n\n<pre><code>for i, a := range list {\n    write(\"&lt;td&gt;\")\n    write(a)\n    write(\"&lt;/td&gt;\")\n}\n\nfor i, b := range list2 {\n    write(\"&lt;td&gt;\")\n    write(b.c)\n    write(\"&lt;/td&gt;&lt;/td&gt;\")\n    write(b.d)\n    write(\"&lt;/td&gt;\")\n}\n</code></pre>\n\n<p>Obviously the <code>&lt;td&gt;</code> &amp; <code>&lt;/td&gt;</code> would be repeated many times in code. So would it make any sense to create a global array of strings and takes values from it? Something like:</p>\n\n<pre><code>myStrings := [...]string{\n    \"&lt;td&gt;\",\n    \"&lt;/td&gt;\"\n}\nfor i, a := range list {\n    write(myStrings[0])\n    write(a)\n    write(myStrings[1])\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "redis", "scalability"], "comments": [{"owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "edited": false, "score": 0, "creation_date": 1437151400, "post_id": 31479764, "comment_id": 50926649, "body": "RPOPLPUSH does dequeue and requeue to another list in one single atomic operation. If your process fails after this operation, nothing is lost (the item still exists in the other list). That said, achieving true guaranteed delivery with Redis is not trivial."}, {"owner": {"reputation": 21589, "user_id": 4875631, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/fGuXb.png?s=128&g=1", "display_name": "Goodbye StackExchange", "link": "https://stackoverflow.com/users/4875631/goodbye-stackexchange"}, "reply_to_user": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "edited": false, "score": 0, "creation_date": 1437153705, "post_id": 31479764, "comment_id": 50927856, "body": "@DidierSpezia Do you recommend any other solutions?"}, {"owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "edited": false, "score": 0, "creation_date": 1437153937, "post_id": 31479764, "comment_id": 50927977, "body": "A real queuing system is probably what you are looking for. See RabbitMQ, ActiveMQ, etc ... Here is a RabbitMQ Go client: <a href=\"https://github.com/streadway/amqp\" rel=\"nofollow noreferrer\">github.com/streadway/amqp</a>"}, {"owner": {"reputation": 21589, "user_id": 4875631, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/fGuXb.png?s=128&g=1", "display_name": "Goodbye StackExchange", "link": "https://stackoverflow.com/users/4875631/goodbye-stackexchange"}, "reply_to_user": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "edited": false, "score": 0, "creation_date": 1437154693, "post_id": 31479764, "comment_id": 50928376, "body": "@DidierSpezia Turn this into an answer, and I&#39;ll give you my thumbs up approval."}, {"owner": {"reputation": 6632, "user_id": 210547, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/70ebc83b42f07ad8e3363085e722500e?s=128&d=identicon&r=PG", "display_name": "MDrollette", "link": "https://stackoverflow.com/users/210547/mdrollette"}, "edited": false, "score": 0, "creation_date": 1437155199, "post_id": 31479764, "comment_id": 50928659, "body": "If you want a lightweight non-distributed work queue, beanstalkd would satisfy your requirements <a href=\"https://kr.github.io/beanstalkd/\" rel=\"nofollow noreferrer\">kr.github.io/beanstalkd</a>"}, {"owner": {"reputation": 506, "user_id": 3835333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1c838f6bc14ea3297f3305aca42f8bf?s=128&d=identicon&r=PG&f=1", "display_name": "SkyeC", "link": "https://stackoverflow.com/users/3835333/skyec"}, "edited": false, "score": 0, "creation_date": 1437239699, "post_id": 31479764, "comment_id": 50950689, "body": "If you need high performance and strong durability with fault tolerance you should include Kafka in the systems you are considering. Take a look at their design approach: <a href=\"http://kafka.apache.org/documentation.html#design\" rel=\"nofollow noreferrer\">kafka.apache.org/documentation.html#design</a>"}], "answers": [{"comments": [{"owner": {"reputation": 9234, "user_id": 4629810, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh4.googleusercontent.com/-gcabh64Le4c/AAAAAAAAAAI/AAAAAAAAAQ8/GquVsg_lVoA/photo.jpg?sz=128", "display_name": "Mircea", "link": "https://stackoverflow.com/users/4629810/mircea"}, "edited": false, "score": 0, "creation_date": 1437192454, "post_id": 31482862, "comment_id": 50939707, "body": "redis is additional work to setup and maintain. same for rabbitmq"}], "tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": true, "score": 2, "last_activity_date": 1437159440, "creation_date": 1437159440, "answer_id": 31482862, "question_id": 31479764, "link": "https://stackoverflow.com/questions/31479764/queue-based-processing/31482862#31482862", "title": "Queue based processing", "body": "<p>Redis is a basic component on which you can build a queuing system. That said, implementing a true guaranteed delivery system on top of Redis is not trivial, especially if you need a transactional behavior.</p>\n\n<p>Here are some queuing systems implemented with Redis in various languages:</p>\n\n<ul>\n<li><a href=\"http://python-rq.org/\" rel=\"nofollow\">http://python-rq.org/</a></li>\n<li><a href=\"https://github.com/resque/resque\" rel=\"nofollow\">https://github.com/resque/resque</a></li>\n<li><a href=\"https://github.com/ask/celery\" rel=\"nofollow\">https://github.com/ask/celery</a></li>\n<li><a href=\"https://pypi.python.org/pypi/rpqueue\" rel=\"nofollow\">https://pypi.python.org/pypi/rpqueue</a></li>\n</ul>\n\n<p>Similar things could be developed in Go, but when it comes to a true guaranteed delivery semantic, the devil is in the details.</p>\n\n<p>You will probably be better served by a dedicated queuing system, such as RabbitMQ or ActiveMQ. While they are more complex, they offer more features, and probably better guarantees.</p>\n\n<p>Here is a Go client for RabbitMQ: <a href=\"https://github.com/streadway/amqp\" rel=\"nofollow\">https://github.com/streadway/amqp</a></p>\n\n<p>You might also be interested by looking at <a href=\"https://github.com/antirez/disque\" rel=\"nofollow\">disque</a> (a dedicated queuing solution from Redis author), and the corresponding Go client at <a href=\"https://github.com/EverythingMe/go-disque\" rel=\"nofollow\">https://github.com/EverythingMe/go-disque</a></p>\n\n<p>Finally, <a href=\"http://kr.github.io/beanstalkd/\" rel=\"nofollow\">beanstalkd</a> is another lightweight solution; you can find the Go client at: <a href=\"https://github.com/kr/beanstalk\" rel=\"nofollow\">https://github.com/kr/beanstalk</a></p>\n"}, {"comments": [{"owner": {"reputation": 21589, "user_id": 4875631, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/fGuXb.png?s=128&g=1", "display_name": "Goodbye StackExchange", "link": "https://stackoverflow.com/users/4875631/goodbye-stackexchange"}, "edited": false, "score": 0, "creation_date": 1437163053, "post_id": 31483323, "comment_id": 50932625, "body": "I&#39;m worried about the fact that multiple workers can receive a message with SQS. The point of a queue is one worker should be working on a task at one time. Not sure why amazon allows multiple workers to work on the same task."}, {"owner": {"reputation": 5553, "user_id": 788433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d61d8ed3faf498777c94ad1f443cda3b?s=128&d=identicon&r=PG", "display_name": "JaredHatfield", "link": "https://stackoverflow.com/users/788433/jaredhatfield"}, "edited": false, "score": 0, "creation_date": 1437164999, "post_id": 31483323, "comment_id": 50933518, "body": "Messages in SQS are given a timeout before they will be delivered to a second queue worker assuming the message was not processed (deleted)."}, {"owner": {"reputation": 9234, "user_id": 4629810, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh4.googleusercontent.com/-gcabh64Le4c/AAAAAAAAAAI/AAAAAAAAAQ8/GquVsg_lVoA/photo.jpg?sz=128", "display_name": "Mircea", "link": "https://stackoverflow.com/users/4629810/mircea"}, "reply_to_user": {"reputation": 21589, "user_id": 4875631, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/fGuXb.png?s=128&g=1", "display_name": "Goodbye StackExchange", "link": "https://stackoverflow.com/users/4875631/goodbye-stackexchange"}, "edited": false, "score": 0, "creation_date": 1437166495, "post_id": 31483323, "comment_id": 50934112, "body": "@FrankerZ in normal operation you will have one worker working on the message. you need to handle 2 workers having the same message anyway  for the case the worker takes longer than the timeout and the message is given to the 2nd worker."}, {"owner": {"reputation": 9234, "user_id": 4629810, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh4.googleusercontent.com/-gcabh64Le4c/AAAAAAAAAAI/AAAAAAAAAQ8/GquVsg_lVoA/photo.jpg?sz=128", "display_name": "Mircea", "link": "https://stackoverflow.com/users/4629810/mircea"}, "edited": false, "score": 0, "creation_date": 1437166928, "post_id": 31483323, "comment_id": 50934268, "body": "stepping back: guaranteeing exactly-once delivery is extremely hard (i.e. impossible) in the presence of faulty clients/network/server. the way to go would be to actually make the effects of the actions you are making idempotent so a 2nd client processing the same message would not cause harm. you can figure out the granularity of this (i.e. not all actions have to be idempotent as long as you have checkpoints)"}], "tags": [], "owner": {"reputation": 9234, "user_id": 4629810, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh4.googleusercontent.com/-gcabh64Le4c/AAAAAAAAAAI/AAAAAAAAAQ8/GquVsg_lVoA/photo.jpg?sz=128", "display_name": "Mircea", "link": "https://stackoverflow.com/users/4629810/mircea"}, "is_accepted": false, "score": 1, "last_activity_date": 1437161248, "creation_date": 1437161248, "answer_id": 31483323, "question_id": 31479764, "link": "https://stackoverflow.com/questions/31479764/queue-based-processing/31483323#31483323", "title": "Queue based processing", "body": "<p>Going to probably state the obvious here, but SQS (<a href=\"http://aws.amazon.com/sqs/\" rel=\"nofollow\">http://aws.amazon.com/sqs/</a>) gives you what you need out of the box. You don't need to worry about managing the queueing system,  it will scale automatically for you, you are going to focus on writing the application.</p>\n\n<p>you push messages to the queue. workers pull them from the queue, process them and ack the message when done. if the workers don't ack the message after the timeout you specify the message will be surfaced back to another worker. </p>\n"}], "owner": {"reputation": 21589, "user_id": 4875631, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/fGuXb.png?s=128&g=1", "display_name": "Goodbye StackExchange", "link": "https://stackoverflow.com/users/4875631/goodbye-stackexchange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 1, "accepted_answer_id": 31482862, "answer_count": 2, "score": 3, "last_activity_date": 1437161248, "creation_date": 1437148205, "question_id": 31479764, "link": "https://stackoverflow.com/questions/31479764/queue-based-processing", "title": "Queue based processing", "body": "<p>So I've been looking into building an application that relies on something similar to a messaging bus. The idea is to be extremely fault tolerant. I have a queue of tasks that need to be performed, and here are the steps that I believe would be the end goal in a queue based system.</p>\n\n<ul>\n<li>A/B server initially adds an item to the queue to be worked on.</li>\n<li>C server listening on queue sees a new item on the queue, and begins to work on it. I believe it should lock the item with a timeout, (If the server crashes, etc..., I need other workers to be able to work on it.)</li>\n</ul>\n\n<p>One of two things happens now:</p>\n\n<ul>\n<li>C server fails to respond to said task, or it has taken long past the timeout, and the queue unlocks it and passes it to server D for processing</li>\n</ul>\n\n<p><strong>- OR -</strong></p>\n\n<ul>\n<li>C server completes the task and ultimately removes the entry from the queue.</li>\n</ul>\n\n<p>I was looking into different solutions, and I see a lot of people using REDIS as a backend for performing this operation, but it's queue is fairly simplistic. For example <a href=\"http://redis.io/commands/rpoplpush\" rel=\"nofollow\"><code>RPOPLPUSH</code></a> will remove the key from the queue. What happens if the server crashes? The queue now thinks it processed that item, and we have a lost task.</p>\n\n<p>What steps are recommended for ensuring task completions, and noting task failures to be able to be reproccessed by another server? I intend to write the tasks in go and I'm open to using cloud services such as AWS.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 2, "creation_date": 1437143495, "post_id": 31478069, "comment_id": 50921630, "body": "However this works in Go, please don&#39;t write code like this it&#39;s very confusing."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1437144102, "post_id": 31478069, "comment_id": 50922090, "body": "Writing the assignments on a single line doesn&#39;t make the assignments any more &quot;immediate&quot;. Everything has to be evaluated in the specified order regardless of it being in one or more statements."}], "answers": [{"tags": [], "owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "is_accepted": false, "score": 3, "last_activity_date": 1437143825, "creation_date": 1437143825, "answer_id": 31478359, "question_id": 31478069, "link": "https://stackoverflow.com/questions/31478069/how-does-multiple-variable-assignment-work/31478359#31478359", "title": "How does multiple variable assignment work?", "body": "<p>This is intended and described in the <a href=\"http://golang.org/ref/spec#Assignments\" rel=\"nofollow\">Go language specs</a>.</p>\n\n<p>Basically it is one statement which happens to assign 2 values to 2 variables. The effects of the statement are available/visible when the statement is fully executed, like with any other expression.</p>\n\n<p>The value of <code>i</code> changes the moment you \"hit\" line 4, so at the time of the assignment to <code>a[3]</code> its value is still <code>50</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 4, "last_activity_date": 1437144208, "creation_date": 1437144208, "answer_id": 31478495, "question_id": 31478069, "link": "https://stackoverflow.com/questions/31478069/how-does-multiple-variable-assignment-work/31478495#31478495", "title": "How does multiple variable assignment work?", "body": "<p>The <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"nofollow\">assigment section</a> of the Go spec mentions:</p>\n\n<blockquote>\n  <p>The assignment proceeds in two phases. </p>\n  \n  <ul>\n  <li>First, the operands of <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow\">index expressions</a> and <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow\">pointer indirections</a> (including implicit pointer indirections in <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow\">selectors</a>) on the left and the expressions on the right are <a href=\"https://golang.org/ref/spec#Order_of_evaluation\" rel=\"nofollow\">all evaluated in the usual order</a>.  </li>\n  <li>Second, the assignments are carried out in left-to-right order. </li>\n  </ul>\n</blockquote>\n\n<p>That means:</p>\n\n<pre><code>var i int = 50\ni, a[2] = 100, i\n</code></pre>\n\n<ul>\n<li><code>a[2]</code> is assigned the <code>i</code> evaluated <em>before</em> assignment (<code>50</code>)</li>\n<li><code>i</code> is assigned <code>100</code></li>\n</ul>\n"}], "owner": {"reputation": 1455, "user_id": 465147, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/e824e3adb5aa777566fa8e53f89bebbe?s=128&d=identicon&r=PG", "display_name": "sprabhakaran", "link": "https://stackoverflow.com/users/465147/sprabhakaran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 2, "accepted_answer_id": 31478495, "answer_count": 2, "score": 2, "last_activity_date": 1573380039, "creation_date": 1437142931, "last_edit_date": 1573380039, "question_id": 31478069, "link": "https://stackoverflow.com/questions/31478069/how-does-multiple-variable-assignment-work", "title": "How does multiple variable assignment work?", "body": "<p>Please check the below sample code, and look into 3rd line.</p>\n\n<pre><code>a := [3]int{10,20} \nvar i int = 50\ni, a[2] = 100, i\n\nfmt.Println(i)   //100\nfmt.Println(a)   //[10 20 50]\n</code></pre>\n\n<p>I have overwritten the value <code>100</code> in <code>i</code> variable and immediately applied the int array. When I printed the array, the new value was not printed. How does multiple variable assignment work in Go? Why the <code>i</code> value is not updated into the array immediately?</p>\n"}, {"tags": ["c++", "opencv", "go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 14855, "user_id": 3159253, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/046000bcd9bbb664fc01891f558baa0d?s=128&d=identicon&r=PG&f=1", "display_name": "user3159253", "link": "https://stackoverflow.com/users/3159253/user3159253"}, "edited": false, "score": 0, "creation_date": 1459816103, "post_id": 32229234, "comment_id": 60445658, "body": "Well, almost. He/she should <i>declare</i> <code>mysurf()</code> as <code>extern &quot;C&quot;</code> and then it&#39;s possible to defined it whatever way is needed"}], "tags": [], "owner": {"reputation": 604, "user_id": 3884974, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a1f5eca7d4c975bd4ad5886c04a942fc?s=128&d=identicon&r=PG", "display_name": "Adri&#225;n Arroyo Calle", "link": "https://stackoverflow.com/users/3884974/adri%c3%a1n-arroyo-calle"}, "is_accepted": false, "score": 2, "last_activity_date": 1440598787, "creation_date": 1440598787, "answer_id": 32229234, "question_id": 31476014, "link": "https://stackoverflow.com/questions/31476014/linking-c-with-go/32229234#32229234", "title": "Linking C++ with Go", "body": "<p>C++ isn't C, and call conventions are different. It's almost impossible to call C++ directly. If you want to call it from Go, first do a C wrapper. In your case by adding \"extern C\" to function declarations should work.</p>\n\n<pre><code>extern \"C\"\nint mysurf(int myarg)\n{\n // code here\n} \n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 5127454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0813eeb7ad0dc7d396cffe08298b92b4?s=128&d=identicon&r=PG&f=1", "display_name": "annjohn", "link": "https://stackoverflow.com/users/5127454/annjohn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 793, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1459814913, "creation_date": 1437136623, "last_edit_date": 1495539908, "question_id": 31476014, "link": "https://stackoverflow.com/questions/31476014/linking-c-with-go", "title": "Linking C++ with Go", "body": "<p>I am trying to bind C++ OpenCV programs with Go. I am using the concept from <a href=\"https://stackoverflow.com/questions/16747021/how-do-you-statically-link-a-c-library-in-go-using-cgo\">How do you statically link a c library in go using cgo?</a>[1]. My <code>myimgcom.cpp</code> file is:</p>\n\n<pre><code>/**\n* @file SURF_FlannMatcher\n* @brief SURF detector + descriptor + FLANN Matcher\n* @author A. Huaman\n Edited: nnnnn\n*/\n\n#include &lt;stdio.h&gt;\n#include &lt;string&gt;\n#include &lt;iostream&gt;\n#include \"opencv2/core/core.hpp\"\n#include \"opencv2/features2d/features2d.hpp\"\n#include \"opencv2/highgui/highgui.hpp\"\n#include \"opencv2/nonfree/features2d.hpp\"\n\nusing namespace cv;\n\nvoid readme();\n\nint mysurf( int myarg)\n{\n\n string option1= \"./Lenna.png\";\n string option2= \"./Lenna.png\";\n\n if( myarg != 3 )\n { readme(); return -1; }\n\n std::cout &lt;&lt; option1 &lt;&lt; option2;\n\n Mat img_1 = imread( option1, CV_LOAD_IMAGE_GRAYSCALE );\n Mat img_2 = imread( option2, CV_LOAD_IMAGE_GRAYSCALE );\n\n if( !img_1.data || !img_2.data )\n { std::cout&lt;&lt; \" --(!) Error reading images \" &lt;&lt; std::endl; return -1; }\n\n //-- Step 1: Detect the keypoints using SURF Detector\n int minHessian = 400;\n\n SurfFeatureDetector detector( minHessian );\n\n std::vector&lt;KeyPoint&gt; keypoints_1, keypoints_2;\n\n detector.detect( img_1, keypoints_1 );\n detector.detect( img_2, keypoints_2 );\n\n //-- Step 2: Calculate descriptors (feature vectors)\n SurfDescriptorExtractor extractor;\n\n Mat descriptors_1, descriptors_2;\n\n extractor.compute( img_1, keypoints_1, descriptors_1 );\n extractor.compute( img_2, keypoints_2, descriptors_2 );\n\n //-- Step 3: Matching descriptor vectors using FLANN matcher\n FlannBasedMatcher matcher;\n std::vector&lt; DMatch &gt; matches;\n matcher.match( descriptors_1, descriptors_2, matches );\n\n double max_dist = 0; double min_dist = 100;\n\n //-- Quick calculation of max and min distances between keypoints\n for( int i = 0; i &lt; descriptors_1.rows; i++ )\n { double dist = matches[i].distance;\n    if( dist &lt; min_dist ) min_dist = dist;\n    if( dist &gt; max_dist ) max_dist = dist;\n }\n\n  printf(\"-- Max dist : %f \\n\", max_dist );\n  printf(\"-- Min dist : %f \\n\", min_dist );\n\n  std::vector&lt; DMatch &gt; good_matches;\n\n  for( int i = 0; i &lt; descriptors_1.rows; i++ )\n  { if( matches[i].distance &lt;= max(4*min_dist, 0.02) )\n  { good_matches.push_back( matches[i]); }\n  }\n\n  //-- Draw only \"good\" matches\n  Mat img_matches;\n  drawMatches( img_1, keypoints_1, img_2, keypoints_2,\n           good_matches, img_matches, Scalar::all(-1), Scalar::all(-1),\n           vector&lt;char&gt;(), DrawMatchesFlags::NOT_DRAW_SINGLE_POINTS );\n\n  //-- Show detected matches\n  imshow( \"Good Matches\", img_matches );\n\n   for( int i = 0; i &lt; (int)good_matches.size(); i++ )\n  { printf( \"-- Good Match [%d] Keypoint 1: %d  -- Keypoint 2: %d  \\n\", i,    good_matches[i].queryIdx, good_matches[i].trainIdx ); }\n\n  waitKey(0);\n\n  return 0;\n }\n\n\n void readme()\n { std::cout &lt;&lt; \" Usage: ./SURF_FlannMatcher &lt;img1&gt; &lt;img2&gt;\" &lt;&lt; std::endl; }\n</code></pre>\n\n<p>Next, my header file <code>myimgcom.h</code> file is:</p>\n\n<pre><code>int mysurf( int);\nvoid readme();\n</code></pre>\n\n<p>Next, my <code>imagetest.go</code> file is:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// #include \"myimgcom.h\"\nimport \"C\"\n\nfunc main() {\n\n  fmt.Printf(\"Invoking c library...\\n\")\n  C.mysurf( 3)\n\n}\n</code></pre>\n\n<p>I am doing the following commands:</p>\n\n<pre><code> gcc -O2 -c myimgcom.cpp  -&gt; runs successfully\n ar q libgb.a myimgcom.o  -&gt; runs successfully\n go build imagetest.go    -&gt; Here I get the following error:\n\n # command-line-arguments\n Undefined symbols for architecture x86_64:\n \"_mysurf\", referenced from:\n  __cgo_8db0969da00f_Cfunc_mysurf in imagetest.cgo2.o\n (maybe you meant: __cgo_8db0969da00f_Cfunc_mysurf)\n ld: symbol(s) not found for architecture x86_64\n clang: error: linker command failed with exit code 1 (use -v to see invocation)\n</code></pre>\n\n<p>I think the problem is linking the pkg config and cflags with cgo. Can anybody suggest me how can I solve the issue? I am working with Mac OS.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1751, "user_id": 3973406, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2d94768947ebd5fd0f38ee5b3f472c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dac0d3r", "link": "https://stackoverflow.com/users/3973406/dac0d3r"}, "edited": false, "score": 0, "creation_date": 1437134824, "post_id": 31474686, "comment_id": 50915906, "body": "I know this very well, but my application is not a fixed one. It&#39;s a CMS which need to be as flexible and easy to customize as possible. I know it&#39;s not the ideal way to do it this way, but sometimes it&#39;s just worth it. Of course I&#39;ve been thinking I might need to implement this in handlers, but really - this would have been the best way for my specific situation. That&#39;s why I did not ask if it&#39;s the best way, but how to make this possible. I guess if it isn&#39;t, I have no choice  but to make a pipeline for hijacking handlers. But thanks for your answer anyways."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 1751, "user_id": 3973406, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2d94768947ebd5fd0f38ee5b3f472c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dac0d3r", "link": "https://stackoverflow.com/users/3973406/dac0d3r"}, "edited": false, "score": 1, "creation_date": 1437142023, "post_id": 31474686, "comment_id": 50920583, "body": "Curiosity took over me and I decided to check if it would actually work. It did. I added the code that works if you still think this is a good solution."}, {"owner": {"reputation": 1751, "user_id": 3973406, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2d94768947ebd5fd0f38ee5b3f472c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dac0d3r", "link": "https://stackoverflow.com/users/3973406/dac0d3r"}, "edited": false, "score": 0, "creation_date": 1437211294, "post_id": 31474686, "comment_id": 50943281, "body": "1) buf := &amp;bytes.Buffer{} 2) tpl.ExecuteTemplate(buf, templateName, content) 3) io.Copy(w, buf) did the trick. How did you figure this out? Since ASP.Net Razor is implementing this functionality with c# in views, isn&#39;t there situations where it can be justified to do it this way? My app is a CMS, with lots of dynamically added templates, directly or through plugins. Is it really THAT bad practice, or does it make sense to do it this way for flexibility and customizability? It wouldn&#39;t be impossible to create handlers and inject those.. Is the performance hit big when using io.Copy?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 1751, "user_id": 3973406, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2d94768947ebd5fd0f38ee5b3f472c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dac0d3r", "link": "https://stackoverflow.com/users/3973406/dac0d3r"}, "edited": false, "score": 0, "creation_date": 1437216877, "post_id": 31474686, "comment_id": 50944658, "body": "By trying things and carefully reading <a href=\"http://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow noreferrer\">the docs</a>. Performance is probably not an issue. I&#39;m wary about this because of <a href=\"https://en.wikipedia.org/wiki/Separation_of_concerns\" rel=\"nofollow noreferrer\">SoC</a>. Routing rules should be in a routing config, not scattered around views, shouldn&#39;t they? Adding more functions to templates will eventually turn them into a (bad) scripting language. And if you do need a scripting language, why not just use Lua?"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 6, "last_activity_date": 1437141901, "last_edit_date": 1437141901, "creation_date": 1437132164, "answer_id": 31474686, "question_id": 31474263, "link": "https://stackoverflow.com/questions/31474263/golang-redirect-function-inside-template-file-fails/31474686#31474686", "title": "Golang Redirect function inside template file fails", "body": "<p>Logic like this should go into handlers. Templates are for presenting data only. They are not designed to be anything more. Any decisions about what and how to render should be done in the handler code.</p>\n\n<p>With that in mind, here is how you could do that: <a href=\"http://play.golang.org/p/Md5A54rLm7\" rel=\"nofollow\">http://play.golang.org/p/Md5A54rLm7</a>.</p>\n\n<p>You can't write directly to <code>w</code> because this will cause it to set response code to 200. You should also register the <code>redirect</code> function inside a wrapper because all template functions must return one or two (with error) values. Again, just because you can, it doesn't mean you should.</p>\n"}], "owner": {"reputation": 1751, "user_id": 3973406, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2d94768947ebd5fd0f38ee5b3f472c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dac0d3r", "link": "https://stackoverflow.com/users/3973406/dac0d3r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 714, "favorite_count": 0, "accepted_answer_id": 31474686, "answer_count": 1, "score": 1, "last_activity_date": 1437210953, "creation_date": 1437130700, "last_edit_date": 1437210953, "question_id": 31474263, "link": "https://stackoverflow.com/questions/31474263/golang-redirect-function-inside-template-file-fails", "title": "Golang Redirect function inside template file fails", "body": "<p>As the golang documentation states, a template function has to have at least 1 return parameter, so I think I can rule out template functions already.</p>\n\n<p>So I thought I could just create the function directly on the Content model, but I guess not?</p>\n\n<p>I think the markup below is pretty self explaining (index.tmpl file in root folder):</p>\n\n<pre><code>{{$request := .Request}}\n{{$response := .Response}}\n{{if eq $request.Method \"POST\"}}\n    {{.Redirect \"page1\" 301}}\n{{end}}\n\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;{{.Title | title}}&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;h1&gt;{{.Title}}&lt;/h1&gt;\n    {{.Body}}\n    &lt;p&gt;{{.ContentType}}&lt;/p&gt;\n    &lt;p&gt;{{$request}}&lt;/p&gt;\n    &lt;p&gt;{{lol}}&lt;/p&gt;\n    &lt;form method=\"POST\"&gt;\n        &lt;input type=\"text\" name=\"lolcat\"/&gt;\n        &lt;input type=\"submit\" value=\"submit\"/&gt;\n    &lt;/form&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>This is kinda equivalent to how one would do it in ASP.Net/Razor, but it doesn't work.</p>\n\n<p>The rest of the code is here <a href=\"http://play.golang.org/p/LMKdflA9RS\" rel=\"nofollow\">http://play.golang.org/p/LMKdflA9RS</a></p>\n\n<p>To test the program locally you need to have:</p>\n\n<pre><code>main.go\nindex.tmpl\npage1.tmpl (just use the same as index.tmpl)\n</code></pre>\n\n<p>What am I doing wrong, and how can this be achieved? :-)</p>\n\n<p><strong>Solution:</strong></p>\n\n<p><a href=\"http://play.golang.org/p/b2I_uzjiSH\" rel=\"nofollow\">http://play.golang.org/p/b2I_uzjiSH</a></p>\n\n<p>Thanks to Ainar-G!</p>\n"}, {"tags": ["go", "redis", "redigo"], "answers": [{"comments": [{"owner": {"reputation": 135, "user_id": 3841436, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/100000631286631/picture?type=large", "display_name": "Vinay Sawant", "link": "https://stackoverflow.com/users/3841436/vinay-sawant"}, "edited": false, "score": 0, "creation_date": 1437138206, "post_id": 31475784, "comment_id": 50918051, "body": "Thanks for your time and efforts.Cheers :)"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 15, "last_activity_date": 1437135792, "creation_date": 1437135792, "answer_id": 31475784, "question_id": 31473676, "link": "https://stackoverflow.com/questions/31473676/get-all-keys-from-redis-in-go/31475784#31475784", "title": "Get All keys From redis in go", "body": "<p>Use the <a href=\"http://godoc.org/github.com/garyburd/redigo/redis#Strings\" rel=\"noreferrer\">Strings</a> function to convert the result to a slice of strings:</p>\n\n<pre><code>keys, err := redis.Strings(cn.Do(\"KEYS\", \"*\"))\nif err != nil {\n    // handle error\n}\nfor _, key := range keys {\n   fmt.Println(key)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 12410, "user_id": 650424, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/17b6cb58e7de35e82f094681aa5321c5?s=128&d=identicon&r=PG", "display_name": "Cmag", "link": "https://stackoverflow.com/users/650424/cmag"}, "edited": false, "score": 0, "creation_date": 1589414431, "post_id": 55796498, "comment_id": 109288770, "body": "question, does the <code>KEYS</code> operation block requests to DB0, or will it block all DB requests, not just the one being queried?  As redis is single threaded, i have a feeling the answer is a yes...   <code>KEYS</code> will block requests to all DBs"}], "tags": [], "owner": {"reputation": 555, "user_id": 8337498, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8b22e7b8121ee9ea74b80f0783247a02?s=128&d=identicon&r=PG&f=1", "display_name": "taraf", "link": "https://stackoverflow.com/users/8337498/taraf"}, "is_accepted": false, "score": 6, "last_activity_date": 1555949961, "last_edit_date": 1555949961, "creation_date": 1555945335, "answer_id": 55796498, "question_id": 31473676, "link": "https://stackoverflow.com/questions/31473676/get-all-keys-from-redis-in-go/55796498#55796498", "title": "Get All keys From redis in go", "body": "<p>Since Redis only has one thread, the <code>KEYS</code> command will block all other requests until it has finished, so it's not a good approach for production. Instead, use <code>SCAN</code>. <a href=\"https://redis.io/commands/scan\" rel=\"noreferrer\">see SCAN documentation here</a></p>\n"}], "owner": {"reputation": 135, "user_id": 3841436, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/100000631286631/picture?type=large", "display_name": "Vinay Sawant", "link": "https://stackoverflow.com/users/3841436/vinay-sawant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11444, "favorite_count": 2, "accepted_answer_id": 31475784, "answer_count": 2, "score": 6, "last_activity_date": 1555949961, "creation_date": 1437128685, "last_edit_date": 1437128796, "question_id": 31473676, "link": "https://stackoverflow.com/questions/31473676/get-all-keys-from-redis-in-go", "title": "Get All keys From redis in go", "body": "<p>How to get all keys of Redis in db and store it in list or array in golang using redigo?</p>\n\n<pre><code>redisPool := redis.NewPool(func() (redis.Conn, error) {\n    con, err := redis.Dial(\"tcp\", *redisAddress)\n    con.Do(\"SELECT\", 0)\n    if err != nil {\n        return nil, err\n    }\n    return con, err\n}, *maxConnections)\nfmt.Println(\"Redis Connection Established...!\")\ncon := redisPool.Get()\n\n//defer con.Close()\nfmt.Println(\"Redis Connected...!\")\n//var sl []string = make([]string, len, cap)\nvar ab interface{}\nab, errA := con.Do(\"Keys\", \"*\")\nfmt.Println(ab)\nfmt.Println(errA)\n</code></pre>\n"}, {"tags": ["tcp", "go", "error-handling", "read-write"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1437130498, "post_id": 31473522, "comment_id": 50913472, "body": "What specific errors it returns depends on the architecture. Handle it like any other error, though."}], "answers": [{"comments": [{"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 0, "creation_date": 1437183472, "post_id": 31477004, "comment_id": 50938316, "body": "robust code must handle all errors correctly. For example, in Linux, in order to keep an alive tcp connection,  some errors must redial the connection and others not.  Just cann&#39;t mess it.  nice answer."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1437139782, "creation_date": 1437139782, "answer_id": 31477004, "question_id": 31473522, "link": "https://stackoverflow.com/questions/31473522/in-golang-what-error-will-tcpconn-write-read-return/31477004#31477004", "title": "In golang what error will TCPConn.Write/Read return?", "body": "<p><code>Read</code> and <code>Write</code> on a <code>TCPConn</code> could return most of errors that your combination of OS, hardware and drivers could return, along with some <code>net</code> package errors, and <code>io.EOF</code> when applicable. So it's really up to you to know what errors to look for, and how to handle them. Every layer of network API, even the berkeley socket api, is a leaky abstraction, and you can't make full use of it without understanding how the actual sockets and network protocols work. </p>\n\n<p>Usually you only need be concerned with <code>io.EOF</code>, which is returned by <code>Conn.Read</code> when the connection is closed. On a TCP socket, this is the equivalent of <code>recv</code> returning 0 bytes on a blocking connection.  </p>\n\n<p>Any other errors that you could handle are usually wrapped in a <a href=\"http://golang.org/pkg/net/#Error\" rel=\"noreferrer\"><code>net.Error</code></a>, which provides the <code>Temporary()</code> and <code>Timeout()</code> methods. Often the real error type is a <a href=\"http://golang.org/pkg/net/#OpError\" rel=\"noreferrer\"><code>*net.OpError</code></a>, which can provide even more information about when the error occurred, as well as encapsulate the actual error returned by the operation.</p>\n"}], "owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2535, "favorite_count": 2, "accepted_answer_id": 31477004, "answer_count": 1, "score": 3, "last_activity_date": 1437139782, "creation_date": 1437128186, "question_id": 31473522, "link": "https://stackoverflow.com/questions/31473522/in-golang-what-error-will-tcpconn-write-read-return", "title": "In golang what error will TCPConn.Write/Read return?", "body": "<p>In golang, how would you handle error return by TCPConn.Read/Write?\nthis <a href=\"http://golang.org/pkg/net/#Conn\" rel=\"nofollow\">document</a> did not say anything about read/write errors. </p>\n"}, {"tags": ["go", "conventions", "convention"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 0, "creation_date": 1437130111, "post_id": 31473429, "comment_id": 50913278, "body": "Yes,if you will understand that such Trips. Experts recommend to name the types in the context of the problem being solved."}], "answers": [{"comments": [{"owner": {"reputation": 384, "user_id": 9327848, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210596712787152/picture?type=large", "display_name": "Eden Trainor", "link": "https://stackoverflow.com/users/9327848/eden-trainor"}, "edited": false, "score": 1, "creation_date": 1586761660, "post_id": 31474039, "comment_id": 108236678, "body": "In this case we could just write that method in one line as <code>func (trips Trips) TotalLenght() int {return len(trips)}</code>"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 16, "last_activity_date": 1437132577, "last_edit_date": 1437132577, "creation_date": 1437129916, "answer_id": 31474039, "question_id": 31473429, "link": "https://stackoverflow.com/questions/31473429/golang-conventions-create-custom-type-from-slice/31474039#31474039", "title": "GoLang conventions - create custom type from slice", "body": "<p>There's no convention, as far as I am aware of. It's OK to create a slice type if you really need it. In fact, if you ever want to sort your data, this is pretty much the only way: create a type and define the <a href=\"http://golang.org/pkg/sort/#Interface\" rel=\"noreferrer\"><code>sort.Interface</code></a> methods on it.</p>\n\n<p>Also, in your example there is no need to take the address of <code>Trips</code> since slice is already a \"fat pointer\" of a kind. So you can simplify your method to:</p>\n\n<pre><code>func (trips Trips) TotalLength() (tl int) {\n    for _, l := range trips {\n        tl += l.Length\n    }\n    return tl\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": false, "score": 8, "last_activity_date": 1437131442, "last_edit_date": 1437131442, "creation_date": 1437130089, "answer_id": 31474074, "question_id": 31473429, "link": "https://stackoverflow.com/questions/31473429/golang-conventions-create-custom-type-from-slice/31474074#31474074", "title": "GoLang conventions - create custom type from slice", "body": "<p>If this is what your type is (a slice), it's just fine. It gives you an easy access to underlying elements (and allows for <code>range</code> iteration) while providing additional methods.</p>\n\n<p>Of course you probably should only keep <em>essential</em> set of methods on this type and not bloating it with everything that would take <code>[]Trip</code> as an argument. (For example I would suggest having <code>DrawTripsOnTheGlobe(t Trips)</code> rather than having it as a Trips' method.)</p>\n\n<p>To calm your mind there are plenty of such slice-types in standard packages:</p>\n\n<p><a href=\"http://golang.org/pkg/net/#IP\" rel=\"noreferrer\">http://golang.org/pkg/net/#IP</a></p>\n\n<p><a href=\"http://golang.org/pkg/sort/#Float64Slice\" rel=\"noreferrer\">http://golang.org/pkg/sort/#Float64Slice</a></p>\n\n<p><a href=\"http://golang.org/pkg/sort/#IntSlice\" rel=\"noreferrer\">http://golang.org/pkg/sort/#IntSlice</a></p>\n\n<p><a href=\"http://golang.org/pkg/encoding/json/#RawMessage\" rel=\"noreferrer\">http://golang.org/pkg/encoding/json/#RawMessage</a></p>\n"}], "owner": {"reputation": 12133, "user_id": 1268533, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f82bbe1fe38e5f96058bb88e09b74000?s=128&d=identicon&r=PG", "display_name": "DHlavaty", "link": "https://stackoverflow.com/users/1268533/dhlavaty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7142, "favorite_count": 0, "answer_count": 2, "score": 13, "last_activity_date": 1437132577, "creation_date": 1437127891, "question_id": 31473429, "link": "https://stackoverflow.com/questions/31473429/golang-conventions-create-custom-type-from-slice", "title": "GoLang conventions - create custom type from slice", "body": "<p>Is it a good idea to create own type from a slice in Golang?</p>\n\n<p>Example:</p>\n\n<pre><code>type Trip struct {\n    From   string\n    To     string\n    Length int\n}\n\ntype Trips []Trip // &lt;-- is this a good idea?\n\nfunc (trips *Trips) TotalLength() int {\n    ret := 0\n    for _, i := range *trips {\n        ret += i.Length\n    }\n\n    return ret\n}\n</code></pre>\n\n<p>Is it somehow a convention in Golang to create types like <code>Trips</code> in my example? Or it is better to use <code>[]Trip</code> in the whole project? Any pros and cons?</p>\n"}, {"tags": ["go", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 8010, "user_id": 1141692, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/3e9d9d70096a7db8f587cbd5e4453327?s=128&d=identicon&r=PG&f=1", "display_name": "dgh", "link": "https://stackoverflow.com/users/1141692/dgh"}, "edited": false, "score": 0, "creation_date": 1437208362, "post_id": 31483968, "comment_id": 50942672, "body": "Thanks for the reply. I suppose my question really boils down to &#39;can pending/incomplete keys be used as a sort of &quot;promise&quot; in a transaction&#39; and it seems the answer is no. I prefer your suggestion using AllocateIds bc I would like Datastore to pick the numeric ID, but the downside is AllocateIds isn&#39;t available in transactions. I&#39;ll explore these approaches and return"}, {"owner": {"reputation": 2917, "user_id": 2300755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/412477c4e9148bdff2e30f283d7794b0?s=128&d=identicon&r=PG", "display_name": "Ed Davisson", "link": "https://stackoverflow.com/users/2300755/ed-davisson"}, "reply_to_user": {"reputation": 8010, "user_id": 1141692, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/3e9d9d70096a7db8f587cbd5e4453327?s=128&d=identicon&r=PG&f=1", "display_name": "dgh", "link": "https://stackoverflow.com/users/1141692/dgh"}, "edited": false, "score": 0, "creation_date": 1437411760, "post_id": 31483968, "comment_id": 51005535, "body": "Yeah, that&#39;s a nice way to summarize it, and you&#39;re correct that it&#39;s not currently supported. As for AllocateIds: it is non-transactional in the sense that the allocation isn&#39;t be rolled back if the transaction fails, but that doesn&#39;t stop you from calling it while the transaction is active. If the transaction fails, you just end up allocating an ID that doesn&#39;t get used -- no big deal."}, {"owner": {"reputation": 8010, "user_id": 1141692, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/3e9d9d70096a7db8f587cbd5e4453327?s=128&d=identicon&r=PG&f=1", "display_name": "dgh", "link": "https://stackoverflow.com/users/1141692/dgh"}, "edited": false, "score": 0, "creation_date": 1437430932, "post_id": 31483968, "comment_id": 51015829, "body": "This weekend I took the AllocateIDs approach to do transactions requiring the key be complete and decided its pretty unlikely I&#39;d ever need to reclaim allocated but unused ids because the space is so large."}], "tags": [], "owner": {"reputation": 2917, "user_id": 2300755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/412477c4e9148bdff2e30f283d7794b0?s=128&d=identicon&r=PG", "display_name": "Ed Davisson", "link": "https://stackoverflow.com/users/2300755/ed-davisson"}, "is_accepted": true, "score": 5, "last_activity_date": 1437163969, "creation_date": 1437163969, "answer_id": 31483968, "question_id": 31468274, "link": "https://stackoverflow.com/questions/31468274/datastore-create-parent-and-child-entity-in-an-entity-group-transaction/31483968#31483968", "title": "Datastore: Create parent and child entity in an entity group transaction?", "body": "<p>One thing to note is that transactions in the Cloud Datastore API <a href=\"https://cloud.google.com/datastore/docs/concepts/overview#Datastore_Transactions_and_entity_groups\" rel=\"noreferrer\">can operate on up to 25 entity groups</a>, but this doesn't answer the question of how to create two entities in the same entity group as part of a single transaction.</p>\n\n<p>There are a few ways to approach this (note that this applies to any use of the Cloud Datastore API, not just the <code>gcloud-golang</code> library):</p>\n\n<ol>\n<li><p>Use a (string) name for the parent key instead of having Datastore automatically assign a numeric ID:</p>\n\n<pre><code>parentKey := datastore.NewKey(ctx, \"Parent\", \"parent-name\", 0, nil)\nchildKey := datastore.NewIncompleteKey(ctx, \"Child\", parentKey)\n</code></pre></li>\n<li><p>Make an explicit call to <code>AllocateIds</code> to have the Datastore pick a numeric ID for the parent key:</p>\n\n<pre><code>incompleteKeys := [1]*datastore.Key{datastore.NewIncompleteKey(ctx, \"Parent\", nil)}\ncompleteKeys, err := datastore.AllocateIDs(ctx, incompleteKeys)\nif err != nil {\n  // ...\n}\nparentKey := completeKeys[0]\nchildKey := datastore.NewIncompleteKey(ctx, \"Child\", parentKey)\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 8010, "user_id": 1141692, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/3e9d9d70096a7db8f587cbd5e4453327?s=128&d=identicon&r=PG&f=1", "display_name": "dgh", "link": "https://stackoverflow.com/users/1141692/dgh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 949, "favorite_count": 1, "accepted_answer_id": 31483968, "answer_count": 1, "score": 4, "last_activity_date": 1475243856, "creation_date": 1437106311, "last_edit_date": 1475243856, "question_id": 31468274, "link": "https://stackoverflow.com/questions/31468274/datastore-create-parent-and-child-entity-in-an-entity-group-transaction", "title": "Datastore: Create parent and child entity in an entity group transaction?", "body": "<p>After reading about Google Datastore concepts/theory I started using the <a href=\"https://godoc.org/google.golang.org/cloud/datastore#example-Transaction\" rel=\"nofollow\">Go datastore package</a> </p>\n\n<p>Scenario:\nKinds <code>User</code> and <code>LinkedAccount</code> require that every user has one or more linked accounts (yay 3rd party login). For strong consistency, LinkedAccounts will be children of the associated User. New User creation then involves creating both a User and a LinkedAccount, never just one. </p>\n\n<p>User creation seems like the perfect use case for transactions. If, say LinkedAccount creation fails, the transaction rolls back an fails. This doesn't currently seem possible. The goal is to create a parent and then a child within a transaction.</p>\n\n<p>According to docs</p>\n\n<blockquote>\n  <p>All Datastore operations in a transaction must operate on entities in\n  the same entity group if the transaction is a single group transaction</p>\n</blockquote>\n\n<p>We want a new <code>User</code> and <code>LinkedAccount</code> to be in the same group, so to me it sounds like Datastore should support this scenario. My fear is that the intended meaning is that operations on <em>existing</em> entities in the same group can be performed in a single transaction.</p>\n\n<pre><code>tx, err := datastore.NewTransaction(ctx)\nif err != nil {\n    return err\n}\nincompleteUserKey := datastore.NewIncompleteKey(ctx, \"User\", nil)\npendingKey, err := tx.Put(incompleteUserKey, user)\nif err != nil {\n    return err\n}\nincompleteLinkedAccountKey := datastore.NewIncompleteKey(ctx, \"GithubAccount\", incompleteUserKey)\n// also tried PendingKey as parent, but its a separate struct type\n_, err = tx.Put(incompleteLinkedAccountKey, linkedAccount)\nif err != nil {\n    return err\n}\n// attempt to commit\nif _, err := tx.Commit(); err != nil {\n    return err\n}\nreturn nil\n</code></pre>\n\n<p>From the <a href=\"https://github.com/GoogleCloudPlatform/gcloud-golang\" rel=\"nofollow\">library source</a> its clear why this doesn't work. <code>PendingKey</code>'s aren't keys and incomplete keys can't be used as parents.</p>\n\n<p>Is this a necessary limitation of Datastore or of the library? For those experienced with this type of requirement, did you just sacrifice the strong consistency and make both kinds global?</p>\n\n<p>For Google-ability:</p>\n\n<ul>\n<li>datastore: invalid key</li>\n<li>datastore: cannot use pendingKey as type *\"google.golang.org/cloud/datastore\".Key</li>\n</ul>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "edited": false, "score": 0, "creation_date": 1437113466, "post_id": 31467623, "comment_id": 50904485, "body": "I&#39;ve added a full example to the answer (now that I have time to sit down and do that!)"}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 2, "last_activity_date": 1437113446, "last_edit_date": 1437113446, "creation_date": 1437100590, "answer_id": 31467623, "question_id": 31467602, "link": "https://stackoverflow.com/questions/31467602/gob-register-by-type-or-for-each-variable/31467623#31467623", "title": "gob.Register() by type or for each variable?", "body": "<p>As per <a href=\"https://golang.org/pkg/encoding/gob/#Register\" rel=\"nofollow\">https://golang.org/pkg/encoding/gob/#Register</a> -</p>\n\n<blockquote>\n  <p>Register records a type, identified by a value for that type, under its internal type name.</p>\n</blockquote>\n\n<p>Register the empty type - e.g.</p>\n\n<pre><code>gob.Register(map[string]interface{}{})\n</code></pre>\n\n<p>Full example:</p>\n\n<pre><code>func main() {\n    gob.Register(map[string]interface{}{})\n    a := map[string]interface{}{\n        \"X\":        1,\n        \"Greeting\": \"hello\",\n    }\n    buf := new(bytes.Buffer)\n    err := gob.NewEncoder(buf).Encode(a)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(buf.Bytes())\n\n    val := make(map[string]interface{})\n    err = gob.NewDecoder(buf).Decode(&amp;val)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"%+v\\n\", val)\n}\n</code></pre>\n\n<p>Run it here: <a href=\"http://play.golang.org/p/e5vXER_dz-\" rel=\"nofollow\">http://play.golang.org/p/e5vXER_dz-</a></p>\n"}], "owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 0, "accepted_answer_id": 31467623, "answer_count": 1, "score": 2, "last_activity_date": 1437113446, "creation_date": 1437100406, "question_id": 31467602, "link": "https://stackoverflow.com/questions/31467602/gob-register-by-type-or-for-each-variable", "title": "gob.Register() by type or for each variable?", "body": "<p>I am doing something like this in my code</p>\n\n<pre><code>test1 = make(map[string]interface{})\ntest2 = make(map[string]interface{})\ntest3 = make(map[string]interface{})\ntest4 = make(map[string]interface{})\n\ngob.Register(test1)\ngob.Register(test2)\ngob.Register(test3)\ngob.Register(test4)\n</code></pre>\n\n<p>It compiles but am I suppose to be doing it that way? Or do I just need to register one of them because they have the same type?</p>\n\n<pre><code>gob.Register(test1)\n</code></pre>\n"}, {"tags": ["go", "null-pointer", "go-gorm"], "comments": [{"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1437102563, "post_id": 31467498, "comment_id": 50901552, "body": "My advice would be to assign each part of the <code>newScope.Set(&quot;gorm:order_by_primary_key&quot;, &quot;ASC&quot;).inlineCondition(where...).callCallbacks(s.parent.call&zwnj;&#8203;back.queries).db</code> to variables then print out their values to find what is <code>nil</code>. That means getting down and dirty and modifying gorm&#39;s code to debug ... which unfortunately needs to happen sometimes."}, {"owner": {"reputation": 15493, "user_id": 380774, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3772ea86cd39ce7e63280ecfffb6512c?s=128&d=identicon&r=PG", "display_name": "fannheyward", "link": "https://stackoverflow.com/users/380774/fannheyward"}, "edited": false, "score": 0, "creation_date": 1437102726, "post_id": 31467498, "comment_id": 50901602, "body": "\ud83d\udc4d for the detailed description."}], "answers": [{"tags": [], "owner": {"reputation": 10767, "user_id": 154513, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/a06e0137aec91f26b0bc1d736c574bad?s=128&d=identicon&r=PG", "display_name": "Todd Moses", "link": "https://stackoverflow.com/users/154513/todd-moses"}, "is_accepted": false, "score": 3, "last_activity_date": 1437102022, "creation_date": 1437102022, "answer_id": 31467764, "question_id": 31467498, "link": "https://stackoverflow.com/questions/31467498/why-does-gorm-db-first-panic-with-invalid-memory-address-or-nil-pointer-deref/31467764#31467764", "title": "Why does gorm db.First() panic with &quot;invalid memory address or nil pointer dereference&quot;?", "body": "<p>This occurs when a variable is nil.</p>\n\n<p>in <code>query := db.First(&amp;m, vars[\"id\"])</code> </p>\n\n<p>I suspect that db is nil. I do not see where you are creating it. You need to do something like:</p>\n\n<pre><code>db, err := gorm.Open(\"sqlite3\", \"/tmp/gorm.db\")\n</code></pre>\n\n<p>and import \"github.com/mattn/go-sqlite3\"</p>\n\n<p>Otherwise the db will be nil and a panic will occur.</p>\n"}, {"comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 2, "creation_date": 1437105821, "post_id": 31468146, "comment_id": 50902398, "body": "Brilliant! (You, not me...) BTW, thanks for your writing. I found <a href=\"http://elithrar.github.io/article/approximating-html-template-inheritance/\" rel=\"nofollow noreferrer\">Approximating html/template inheritance</a> especially helpful."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 25, "last_activity_date": 1437105178, "creation_date": 1437105178, "answer_id": 31468146, "question_id": 31467498, "link": "https://stackoverflow.com/questions/31467498/why-does-gorm-db-first-panic-with-invalid-memory-address-or-nil-pointer-deref/31468146#31468146", "title": "Why does gorm db.First() panic with &quot;invalid memory address or nil pointer dereference&quot;?", "body": "<p>You're shadowing your global <code>db</code> variable:</p>\n\n<pre><code>var db = gorm.DB{} // garbage\n</code></pre>\n\n<p>Your initialisation in <code>main()</code> should be changed to:</p>\n\n<pre><code>var err error\n// Note the assignment and not initialise + assign operator\ndb, err = gorm.Open(\"sqlite3\", \"/tmp/gorm.db\")\n</code></pre>\n\n<p>Otherwise, <code>db</code> is <code>nil</code> and results in the panic.</p>\n"}], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7738, "favorite_count": 1, "closed_date": 1575484145, "accepted_answer_id": 31468146, "answer_count": 2, "score": 10, "last_activity_date": 1437105178, "creation_date": 1437099679, "last_edit_date": 1437103253, "question_id": 31467498, "link": "https://stackoverflow.com/questions/31467498/why-does-gorm-db-first-panic-with-invalid-memory-address-or-nil-pointer-deref", "closed_reason": "Duplicate", "title": "Why does gorm db.First() panic with &quot;invalid memory address or nil pointer dereference&quot;?", "body": "<p>I can't figure out if I've done something silly or if I've found a bug in gorm. While I'm very well aware of what \"invalid memory address or nil pointer dereference\" means, I am completely mystified as to why it appears here.</p>\n\n<p>In short, I call <code>db.First()</code> and I receive a panic for no obvious reason.</p>\n\n<p>The relevant bits of my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/gorilla/mux\"\n    \"github.com/jinzhu/gorm\"\n    \"net/http\"\n    \"os\"\n)\n\ntype message struct {\n    gorm.Model\n    Title string\n    Body  string `sql:\"size:0\"` // blob\n}\n\nvar db = gorm.DB{} // garbage\n\nfunc messageHandler(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    m := message{}\n    query := db.First(&amp;m, vars[\"id\"])\n    if query.Error != nil {\n        if query.Error == gorm.RecordNotFound {\n            notFoundHandler(w, r)\n            return\n        } else {\n            fmt.Fprintf(os.Stderr, \"database query failed: %v\", query.Error)\n            internalServerErrorHandler(w, r)\n            return\n        }\n    }\n\n    // actually do something useful\n}\n\nfunc main() {\n    db, err := gorm.Open(\"sqlite3\", \"/tmp/gorm.db\")\n    // ...\n}\n</code></pre>\n\n<p><code>db</code> is opened in <code>main()</code> in the package, and is stored as a package variable. This doesn't seem very clean, but it appears to work...</p>\n\n<p>The panic:</p>\n\n<pre><code>2015/07/16 20:56:12 http: panic serving [::1]:37326: runtime error: invalid memory address or nil pointer dereference\ngoroutine 26 [running]:\nnet/http.func\u00b7011()\n        /usr/lib/golang/src/net/http/server.go:1130 +0xbb\ngithub.com/jinzhu/gorm.(*DB).First(0xd28720, 0x79f220, 0xc2080b2600, 0xc2080ef220, 0x1, 0x1, 0xd)\n        /home/error/go/src/github.com/jinzhu/gorm/main.go:200 +0x154\nmain.messageHandler(0x7f4f2e785bd8, 0xc208051c20, 0xc208035790)\n        /home/error/go/src/myproject/messages.go:28 +0x2c1\nnet/http.HandlerFunc.ServeHTTP(0x9c3948, 0x7f4f2e785bd8, 0xc208051c20, 0xc208035790)\n        /usr/lib/golang/src/net/http/server.go:1265 +0x41\ngithub.com/gorilla/mux.(*Router).ServeHTTP(0xc2080d9630, 0x7f4f2e785bd8, 0xc208051c20, 0xc208035790)\n        /home/error/go/src/github.com/gorilla/mux/mux.go:98 +0x297\nnet/http.serverHandler.ServeHTTP(0xc2080890e0, 0x7f4f2e785bd8, 0xc208051c20, 0xc208035790)\n        /usr/lib/golang/src/net/http/server.go:1703 +0x19a\nnet/http.(*conn).serve(0xc208051b80)\n        /usr/lib/golang/src/net/http/server.go:1204 +0xb57\ncreated by net/http.(*Server).Serve\n        /usr/lib/golang/src/net/http/server.go:1751 +0x35e\n</code></pre>\n\n<p>...where line 28 of my code is <code>query := db.First(&amp;m, vars[\"id\"])</code></p>\n\n<p>I reviewed <a href=\"https://github.com/jinzhu/gorm/blob/2a1d64c3e067bd1af99987157f9625a4605ed85e/main.go#L200\" rel=\"noreferrer\">the noted line in gorm</a> and the <code>First()</code> function, but this also isn't terribly obvious.</p>\n\n<pre><code>    return newScope.Set(\"gorm:order_by_primary_key\", \"ASC\").\n        inlineCondition(where...).callCallbacks(s.parent.callback.queries).db\n</code></pre>\n\n<p>In order to figure out what might be going on, I made the following changes to my code:</p>\n\n<p>First attempt: Is it complaining about being passed a string? Let's give it an integer instead. After all, the example uses an integer.</p>\n\n<pre><code>    id, _ := strconv.Atoi(vars[\"id\"])\n    query := db.First(&amp;m, id)\n</code></pre>\n\n<p>Panic again, at exactly the same place.</p>\n\n<p>Second attempt: Did I create my variable <code>m</code> the wrong way? Maybe it really needs to be allocated with <code>new</code> first.</p>\n\n<pre><code>    m := new(message)\n    query := db.First(m, vars[\"id\"])\n</code></pre>\n\n<p>Panic again, at exactly the same place.</p>\n\n<p>Third attempt: I simply hardcoded the ID to be looked up, just in case gorilla/mux was misbehaving.</p>\n\n<pre><code>    m := message{}\n    query := db.First(&amp;m, 3)\n</code></pre>\n\n<p>Panic again, at exactly the same place.</p>\n\n<p>Finally, I tested with an empty database table, with a populated table requesting an ID that exists, and with a populated table requesting an ID that does not exist. In all three cases I receive the same panic.</p>\n\n<p>The most interesting part of all is that apparently net/http is recovering the panic, and then my <code>notFoundHandler()</code> runs and I see its template output in the browser.</p>\n\n<p>I am currently using the <a href=\"https://github.com/mattn/go-sqlite3\" rel=\"noreferrer\">mattn/go-sqlite3</a> driver.</p>\n\n<p>My environment is Fedora 22 x86_64 with cgo 1.4.2 as provided in Fedora RPM packages.</p>\n\n<pre><code>$ go version\ngo version go1.4.2 linux/amd64\n\n$ go env\nGOARCH=\"amd64\"\nGOBIN=\"\"\nGOCHAR=\"6\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/error/go\"\nGORACE=\"\"\nGOROOT=\"/usr/lib/golang\"\nGOTOOLDIR=\"/usr/lib/golang/pkg/tool/linux_amd64\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n\n<p>What's going on? Where is this panic coming from? How do I fix it?</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 2, "creation_date": 1437099651, "post_id": 31467465, "comment_id": 50900903, "body": "could you provide the code to add <code>&quot;Extra2&quot;</code> in json.Raw format? Thats the tricky part"}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 3, "last_activity_date": 1599111916, "last_edit_date": 1599111916, "creation_date": 1437099382, "answer_id": 31467465, "question_id": 31467326, "link": "https://stackoverflow.com/questions/31467326/golang-modify-json-without-struct/31467465#31467465", "title": "Golang modify json without struct", "body": "<p>yes. there is a type json.Raw which not a struct but []byte. you can manage it out of struct, in any marshal/unmarshal way.</p>\n<p><strong>UPDATE</strong></p>\n<p>use any way to edit json string on the fly</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;encoding/json&quot;\n    &quot;strings&quot;\n)\n\ntype Struct struct {\n   Value  string `json:&quot;value&quot;`\n   Value1 string `json:&quot;value_one&quot;`\n   Nest   json.RawMessage`json:&quot;nest&quot;`\n}\n\nfunc main() {\n    s := Struct{Value1: &quot;struct string&quot;}\n    buf, _ := json.Marshal(s)\n    fmt.Println(string(buf))\n    s2 := strings.ReplaceAll(string(buf), &quot;null&quot;, `{&quot;extra2&quot;:{&quot;anykey&quot;:3.1415926535}}`)\n    fmt.Println(s2)\n}\n</code></pre>\n<p><a href=\"https://play.golang.org/p/lOCxJBs5iRJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/lOCxJBs5iRJ</a></p>\n"}, {"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 2, "last_activity_date": 1577147234, "last_edit_date": 1577147234, "creation_date": 1437166280, "answer_id": 31484523, "question_id": 31467326, "link": "https://stackoverflow.com/questions/31467326/golang-modify-json-without-struct/31484523#31484523", "title": "Golang modify json without struct", "body": "<p>The map approach is the only sane way to do it, everything else (like <code>json.RawMessage</code> fields would require an extra marshalling step anyway.</p>\n"}, {"comments": [{"owner": {"reputation": 253, "user_id": 657161, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4eddef6a78dad0b44ccd255e5ccc3dff?s=128&d=identicon&r=PG", "display_name": "Nate Finch", "link": "https://stackoverflow.com/users/657161/nate-finch"}, "edited": false, "score": 2, "creation_date": 1437420082, "post_id": 31515037, "comment_id": 51010419, "body": "Since my perfectly valid edit was rejected by the mods as &quot;should be a comment&quot; (even though this is a huge waste of space as a comment) - note that you don&#39;t need <code>json:&quot;-&quot;</code> to prevent extra from serializing, since it&#39;s not exported."}, {"owner": {"reputation": 13693, "user_id": 462233, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b1019ca5714cf8e9951868d6bc517827?s=128&d=identicon&r=PG", "display_name": "Fatih Arslan", "link": "https://stackoverflow.com/users/462233/fatih-arslan"}, "reply_to_user": {"reputation": 253, "user_id": 657161, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4eddef6a78dad0b44ccd255e5ccc3dff?s=128&d=identicon&r=PG", "display_name": "Nate Finch", "link": "https://stackoverflow.com/users/657161/nate-finch"}, "edited": false, "score": 0, "creation_date": 1437420266, "post_id": 31515037, "comment_id": 51010516, "body": "Thanks @NateFinch for the info, makes sense. I&#39;m editing it on behalf of you."}], "tags": [], "owner": {"reputation": 13693, "user_id": 462233, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b1019ca5714cf8e9951868d6bc517827?s=128&d=identicon&r=PG", "display_name": "Fatih Arslan", "link": "https://stackoverflow.com/users/462233/fatih-arslan"}, "is_accepted": true, "score": 8, "last_activity_date": 1437420285, "last_edit_date": 1495540124, "creation_date": 1437390850, "answer_id": 31515037, "question_id": 31467326, "link": "https://stackoverflow.com/questions/31467326/golang-modify-json-without-struct/31515037#31515037", "title": "Golang modify json without struct", "body": "<p>Based on this answer: <a href=\"https://stackoverflow.com/questions/23045884/can-i-use-marshaljson-to-add-arbitrary-fields-to-a-json-encoding-in-golang\">Can I use MarshalJSON to add arbitrary fields to a json encoding in golang?</a></p>\n\n<p>You could do something like (demo: <a href=\"http://play.golang.org/p/dDiTwxhoNn\" rel=\"nofollow noreferrer\">http://play.golang.org/p/dDiTwxhoNn</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\ntype Book struct {\n    Title  string\n    Author string\n\n    // extra is used for additional dynamic element marshalling\n    extra func() interface{}\n}\n\ntype FakeBook Book\n\nfunc (b *Book) SetExtra(fn func() interface{}) {\n    b.extra = fn\n}\n\nfunc (b *Book) MarshalJSON() ([]byte, error) {\n    if b.extra == nil {\n        b.extra = func() interface{} { return *b }\n    }\n\n    return json.Marshal(b.extra())\n}\n\nfunc main() {\n    ms := &amp;Book{\n        Title:  \"Catch-22\",\n        Author: \"Joseph Heller\",\n    }\n\n    ms.SetExtra(func() interface{} {\n        return struct {\n            FakeBook\n            Extra1 struct {\n                Something string `json:\"something\"`\n            } `json:\"extra1\"`\n        }{\n            FakeBook: FakeBook(*ms),\n            Extra1: struct {\n                Something string `json:\"something\"`\n            }{\n                Something: \"yy\",\n            },\n        }\n    })\n\n    out, err := json.MarshalIndent(ms, \"\", \"  \")\n    if err != nil {\n        log.Fatalln(err)\n    }\n    fmt.Println(string(out))\n\n    mb := &amp;Book{\n        Title:  \"Vim-go\",\n        Author: \"Fatih Arslan\",\n    }\n\n    mb.SetExtra(func() interface{} {\n        return struct {\n            FakeBook\n            Something string `json:\"something\"`\n        }{\n            FakeBook:  FakeBook(*mb),\n            Something: \"xx\",\n        }\n    })\n\n    out, err = json.MarshalIndent(mb, \"\", \"  \")\n    if err != nil {\n        log.Fatalln(err)\n    }\n    fmt.Println(string(out))\n\n    mc := &amp;Book{\n        Title:  \"Another-Title\",\n        Author: \"Fatih Arslan\",\n    }\n\n    out, err = json.MarshalIndent(mc, \"\", \"  \")\n    if err != nil {\n        log.Fatalln(err)\n    }\n    fmt.Println(string(out))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1470, "user_id": 3827487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/v2CLE.jpg?s=128&g=1", "display_name": "Dhruv Batheja", "link": "https://stackoverflow.com/users/3827487/dhruv-batheja"}, "is_accepted": false, "score": 4, "last_activity_date": 1570787416, "creation_date": 1570787416, "answer_id": 58338643, "question_id": 31467326, "link": "https://stackoverflow.com/questions/31467326/golang-modify-json-without-struct/58338643#58338643", "title": "Golang modify json without struct", "body": "<p>If someone is <strong>not happy</strong> with the solution provided:</p>\n\n<p>Try <a href=\"https://github.com/tidwall/sjson\" rel=\"nofollow noreferrer\">tidwall/sjson</a>. It provides functions for quick JSON editing without having to define any structure. It saved me a bunch of time yesterday :D</p>\n\n<p>Example usage:</p>\n\n<pre><code>value, _ := sjson.Set(`{\"name\":{\"last\":\"Anderson\"}}`, \"name.last\", \"Smith\")\nprintln(value)\n\n// Output:\n// {\"name\":{\"last\":\"Smith\"}}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 6573606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YUFjt.jpg?s=128&g=1", "display_name": "asimov", "link": "https://stackoverflow.com/users/6573606/asimov"}, "is_accepted": false, "score": 0, "last_activity_date": 1614950527, "creation_date": 1614950527, "answer_id": 66493361, "question_id": 31467326, "link": "https://stackoverflow.com/questions/31467326/golang-modify-json-without-struct/66493361#66493361", "title": "Golang modify json without struct", "body": "<p>if you don't want install extra package, you can change or add new values with this code :</p>\n<pre><code>package main\n\nimport &quot;fmt&quot;\nimport &quot;strings&quot;\nimport &quot;encoding/json&quot;\n\nfunc main() {\n    s := []byte(`{ &quot;level1a&quot;:&quot;aaa&quot;, &quot;level1b&quot;:{&quot;level2a&quot;:&quot;bbb&quot;, &quot;level2b&quot;:{&quot;level3&quot;:&quot;aaa&quot;} } }`)\n    var j interface{}\n    json.Unmarshal(s, &amp;j)\n    SetValueInJSON(j, &quot;level1a&quot;, &quot;new value 1a&quot;)\n    SetValueInJSON(j, &quot;level1b.level2a&quot;, &quot;new value 2a&quot;)\n    SetValueInJSON(j, &quot;level1b.level2b.level3&quot;, &quot;new value 3&quot;)\n    SetValueInJSON(j, &quot;level1b.level2c&quot;, &quot;new key&quot;)\n    s,_ = json.Marshal(j)\n    fmt.Println(string(s))\n    // result: {&quot;level1a&quot;:&quot;new value 1a&quot;,&quot;level1b&quot;:{&quot;level2a&quot;:&quot;new value 2a&quot;,&quot;level2b&quot;:{&quot;level3&quot;:&quot;new value 3&quot;},&quot;level2c&quot;:&quot;new key&quot;}}\n\n}\n\nfunc SetValueInJSON(iface interface{}, path string, value interface{}) interface{} {\n    m := iface.(map[string]interface{})\n    split := strings.Split(path, &quot;.&quot;)\n    for k, v := range m {\n        if strings.EqualFold(k, split[0]) {\n            if len(split) == 1 {\n                m[k] = value\n                return m\n            }\n            switch v.(type) {\n            case map[string]interface{}:\n                return SetValueInJSON(v, strings.Join(split[1:], &quot;.&quot;), value)\n            default:\n                return m\n            }\n        }\n    }\n    // path not found -&gt; create\n    if len(split) == 1 {\n        m[split[0]] = value\n    } else {\n        newMap := make(map[string]interface{})\n        newMap[split[len(split)-1]] = value\n        for i := len(split) - 2; i &gt; 0; i-- {\n            mTmp := make(map[string]interface{})\n            mTmp[split[i]] = newMap\n            newMap = mTmp\n        }\n        m[split[0]] = newMap\n    }\n    return m\n}\n</code></pre>\n"}], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15089, "favorite_count": 3, "accepted_answer_id": 31515037, "answer_count": 5, "score": 12, "last_activity_date": 1614950527, "creation_date": 1437098389, "last_edit_date": 1511983373, "question_id": 31467326, "link": "https://stackoverflow.com/questions/31467326/golang-modify-json-without-struct", "title": "Golang modify json without struct", "body": "<pre><code>type Struct struct {\n   Value  string `json:\"value\"`\n   Value1 string `json:\"value_one\"`\n   Nest   Nested `json:\"nest\"`\n}\n\ntype Nested struct {\n   Something string `json:\"something\"`\n}\n</code></pre>\n\n<p>I want to add elements which are not in the structs definitions without creating another struct type. For example</p>\n\n<pre><code>Struct.Extra1 = Nested{\"yy\"}\nStruct.Nested.Extra2 = \"zz\"\n</code></pre>\n\n<p>Which will result</p>\n\n<pre><code>{\n    \"Value\": \"xx\",\n    \"Value1\": \"xx\",\n    \"Extra1\": {\n      \"Something\", \"yy\"\n    },\n    \"Nest\": {\n      \"Something\": \"xx\",\n      \"Extra2\": \"zz\"\n    }\n}\n</code></pre>\n\n<p><strong>SOLUTION1:</strong>\nI thought of adding <code>omitempty</code> to achieve this but it makes the structs complex.</p>\n\n<pre><code>type Struct struct {\n   Value  string\n   Value1 string\n   Nest   Nested\n   Extra1 Nested `json:\"omitempty\"`\n}\n\ntype Nested struct {\n   Something string\n   Extra2 string `json:\"omitempty\"`\n}\n</code></pre>\n\n<p><strong>SOLUTION2:</strong></p>\n\n<pre><code>myextras := make(map[string]interface{})\n// get Struct.Nested in map[string]interface{} format\nmyextras = Struct.Nest\nmyextras[\"Extra2\"] = \"zz\"\n\n// get Struct in map[string]interface{} format\nstruct[\"Nest\"] = myextras\nstruct[\"Extra1\"] = Nested{\"yy\"}\n\n// solves the problem with lots of type casting but doesn't support json tag naming\n</code></pre>\n\n<p>Is there a better solution to add nested elements which are not represented in struct datatype with json-tag support and could be used to output to user.</p>\n"}, {"tags": ["python", "go"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1437119570, "post_id": 31467321, "comment_id": 50907355, "body": "try to sleep 2000ms and 3000ms in the goroutines. I think the result will be two-&gt;one."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1437127083, "post_id": 31467321, "comment_id": 50911595, "body": "synchronization by timing is not synchronization. I don&#39;t know why it doesn&#39;t work but you shouldn&#39;t sleep to try and establish a happens-before guarantee -- it&#39;s not deterministic."}], "answers": [{"tags": [], "owner": {"reputation": 19827, "user_id": 342553, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/zjZ6d.jpg?s=128&g=1", "display_name": "James Lin", "link": "https://stackoverflow.com/users/342553/james-lin"}, "is_accepted": true, "score": 0, "last_activity_date": 1437338901, "creation_date": 1437338901, "answer_id": 31505780, "question_id": 31467321, "link": "https://stackoverflow.com/questions/31467321/understand-goless-select-from-the-sample-code/31505780#31505780", "title": "Understand goless.select from the sample code", "body": "<p>Since there is no answer so I went to have a dig on the project repo, found a similar question here:</p>\n\n<p><a href=\"https://github.com/rgalanakis/goless/issues/42\" rel=\"nofollow\">https://github.com/rgalanakis/goless/issues/42</a></p>\n\n<p>Most notable:</p>\n\n<blockquote>\n  <p>using time.sleep just pauses the current thread. It does not do any switching between coroutines. You would have to use gevent.sleep or a similar mechanism for Stackless (or goless.backend.yield).</p>\n</blockquote>\n\n<p>So it seemed that I misunderstood the goless would create different threads but I was wrong.</p>\n"}], "owner": {"reputation": 19827, "user_id": 342553, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/zjZ6d.jpg?s=128&g=1", "display_name": "James Lin", "link": "https://stackoverflow.com/users/342553/james-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 31505780, "answer_count": 1, "score": 1, "last_activity_date": 1437338901, "creation_date": 1437098347, "question_id": 31467321, "link": "https://stackoverflow.com/questions/31467321/understand-goless-select-from-the-sample-code", "title": "Understand goless.select from the sample code", "body": "<p>I have discovered python implementation of Goroutines, <a href=\"https://goless.readthedocs.org/en/latest/\" rel=\"nofollow\">https://goless.readthedocs.org/en/latest/</a> and having a play</p>\n\n<p>Given the following code from the documentation:</p>\n\n<pre><code>c1 = goless.chan()\nc2 = goless.chan()\n\ndef func1():\n    time.sleep(1)\n    c1.send('one')\ngoless.go(func1)\n\ndef func2():\n    time.sleep(2)\n    c2.send('two')\ngoless.go(func2)\n\nfor i in range(2):\n    case, val = goless.select([goless.rcase(c1), goless.rcase(c2)])\n    print(val)\n</code></pre>\n\n<p>And it prints:</p>\n\n<pre><code>one\ntwo\n</code></pre>\n\n<p>Documentation about the <code>select</code> method</p>\n\n<blockquote>\n  <p>Select the first case that becomes ready. If a default case\n  (goless.dcase) is present, return that if no other cases are ready. If\n  there is no default case and no case is ready, block until one becomes\n  ready.</p>\n</blockquote>\n\n<p>So I went ahead and change the <code>sleep(1)</code> to <code>sleep(3)</code> as below:</p>\n\n<pre><code>c1 = goless.chan()\nc2 = goless.chan()\n\ndef func1():\n    time.sleep(3)\n    c1.send('one')\ngoless.go(func1)\n\ndef func2():\n    time.sleep(2)\n    c2.send('two')\ngoless.go(func2)\n\nfor i in range(2):\n    case, val = goless.select([goless.rcase(c1), goless.rcase(c2)])\n    print(val)\n</code></pre>\n\n<p>And I thought it would print:</p>\n\n<pre><code>two\none\n</code></pre>\n\n<p>But it printed:</p>\n\n<pre><code>one\ntwo\n</code></pre>\n\n<p>Why is that?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1437154434, "post_id": 31467153, "comment_id": 50928240, "body": "It only got one downvote, who knows why. I brought it back to 0."}, {"owner": {"reputation": 1802, "user_id": 754854, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4acefbd570391b3abbae9cab3beeb7f1?s=128&d=identicon&r=PG", "display_name": "JoeMoe1984", "link": "https://stackoverflow.com/users/754854/joemoe1984"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1437162016, "post_id": 31467153, "comment_id": 50932110, "body": "@hobbs thanks. When I first looked at it, it was at -2"}], "answers": [{"comments": [{"owner": {"reputation": 1802, "user_id": 754854, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4acefbd570391b3abbae9cab3beeb7f1?s=128&d=identicon&r=PG", "display_name": "JoeMoe1984", "link": "https://stackoverflow.com/users/754854/joemoe1984"}, "edited": false, "score": 0, "creation_date": 1437097732, "post_id": 31467182, "comment_id": 50900447, "body": "I will give that a try when I get home tonight"}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 29, "last_activity_date": 1437097253, "creation_date": 1437097253, "answer_id": 31467182, "question_id": 31467153, "link": "https://stackoverflow.com/questions/31467153/golang-failed-exec-command-that-works-in-terminal/31467182#31467182", "title": "golang failed exec command that works in terminal", "body": "<p>When you type the command at the shell, the shell takes <code>./source_dir/*</code> and replaces it with a list of all of the files that match, one per argument. The <code>mv</code> command sees a list of filenames, not a wildcard.</p>\n\n<p>What you need to do is either do the same thing yourself (using <a href=\"http://golang.org/pkg/path/filepath/#Glob\" rel=\"noreferrer\">filepath.Glob</a> which returns a <code>[]string</code> of matching files), or to invoke the shell so that it can do the work (using <code>exec.Command(\"/bin/sh\", \"-c\", \"mv ./source_dir/* ./dest_dir\")</code>).</p>\n"}], "owner": {"reputation": 1802, "user_id": 754854, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/4acefbd570391b3abbae9cab3beeb7f1?s=128&d=identicon&r=PG", "display_name": "JoeMoe1984", "link": "https://stackoverflow.com/users/754854/joemoe1984"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6132, "favorite_count": 0, "accepted_answer_id": 31467182, "answer_count": 1, "score": 13, "last_activity_date": 1437097253, "creation_date": 1437096968, "question_id": 31467153, "link": "https://stackoverflow.com/questions/31467153/golang-failed-exec-command-that-works-in-terminal", "title": "golang failed exec command that works in terminal", "body": "<p>I am getting an error when I try to use the <code>exec</code> package to run a <code>mv</code> command.</p>\n\n<p>Here is an example of what I am trying to do:</p>\n\n<pre><code>cmd := exec.Command(\"mv\", \"./source-dir/*\", \"./dest-dir\")\noutput, err := cmd.CombinedOutput()\n\ncmd.Run()\n</code></pre>\n\n<p>err returns the following\n<code>exit status 1</code></p>\n\n<p>output returns this <code>mv: rename ./source-dir/* to ./dest-dir/*: No such file or directory</code></p>\n\n<p>I can actually get the script to work when I change this line:</p>\n\n<p><code>cmd := exec.Command(\"mv\", \"./source-dir/*\", \"./dest-dir\")</code></p>\n\n<p>to the following:</p>\n\n<p><code>cmd := exec.Command(\"mv\", \"./source-dir/file.txt\", \"./dest-dir\")</code></p>\n\n<p>The command works and moves the file successfully but using the wildcard doesn't work. It appears that the asterisk isn't being used as a wildcard in the command. Why is that? Is there another way to use wildcards in GO? If not then how else would I be able to recursively move all files from the <code>source-dir</code> to the <code>dest-dir</code>?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "google-apps", "google-admin-sdk", "google-oauth", "service-accounts"], "comments": [{"owner": {"reputation": 70965, "user_id": 1841839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/ZyKjr.png?s=128&g=1", "display_name": "DaImTo", "link": "https://stackoverflow.com/users/1841839/daimto"}, "edited": false, "score": 1, "creation_date": 1437116856, "post_id": 31466252, "comment_id": 50906046, "body": "did you give the service account access?"}, {"owner": {"reputation": 977, "user_id": 4204155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b97cac237052e03909c015c998f96e1?s=128&d=identicon&r=PG&f=1", "display_name": "SGC", "link": "https://stackoverflow.com/users/4204155/sgc"}, "edited": false, "score": 1, "creation_date": 1437148195, "post_id": 31466252, "comment_id": 50924789, "body": "You should give your service account domain wide delegation <a href=\"https://developers.google.com/drive/web/delegation\" rel=\"nofollow noreferrer\">developers.google.com/drive/web/delegation</a> . Follow the steps mentioned in the documentation."}, {"owner": {"reputation": 1318, "user_id": 1763664, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/63a82b7c52574ade60a1cf313f50aeb8?s=128&d=identicon&r=PG", "display_name": "Nate Brennand", "link": "https://stackoverflow.com/users/1763664/nate-brennand"}, "edited": false, "score": 0, "creation_date": 1437155591, "post_id": 31466252, "comment_id": 50928847, "body": "I&#39;ve now given the Service Account access and am waiting for that to propagate. Thanks for the tip."}, {"owner": {"reputation": 1318, "user_id": 1763664, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/63a82b7c52574ade60a1cf313f50aeb8?s=128&d=identicon&r=PG", "display_name": "Nate Brennand", "link": "https://stackoverflow.com/users/1763664/nate-brennand"}, "edited": false, "score": 0, "creation_date": 1437173877, "post_id": 31466252, "comment_id": 50936344, "body": "Despite adding the service account access I am still receiving the same 403 error for this API call. Any other ideas?"}], "answers": [{"comments": [{"owner": {"reputation": 190, "user_id": 6135889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hVeBA.png?s=128&g=1", "display_name": "kwiesmueller", "link": "https://stackoverflow.com/users/6135889/kwiesmueller"}, "edited": false, "score": 0, "creation_date": 1524684630, "post_id": 38981127, "comment_id": 87076115, "body": "The question is some time old again, but I have been searching for a solution for some time as well. For your proposed solution we keep getting <code>Client is unauthorized to retrieve access tokens using this method.</code>"}, {"owner": {"reputation": 155, "user_id": 4050144, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8cd10e9e624b36774c47224d3ba28fdf?s=128&d=identicon&r=PG", "display_name": "Chronojam", "link": "https://stackoverflow.com/users/4050144/chronojam"}, "reply_to_user": {"reputation": 190, "user_id": 6135889, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hVeBA.png?s=128&g=1", "display_name": "kwiesmueller", "link": "https://stackoverflow.com/users/6135889/kwiesmueller"}, "edited": false, "score": 0, "creation_date": 1524742731, "post_id": 38981127, "comment_id": 87099860, "body": "so it&#39;s been a little while since ive worked on this, but that sounds like your service account doesnt have domain-wide delegation enabled? <a href=\"https://developers.google.com/admin-sdk/directory/v1/guides/delegation\" rel=\"nofollow noreferrer\">developers.google.com/admin-sdk/directory/v1/guides/delegati&zwnj;&#8203;on</a>"}], "tags": [], "owner": {"reputation": 155, "user_id": 4050144, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8cd10e9e624b36774c47224d3ba28fdf?s=128&d=identicon&r=PG", "display_name": "Chronojam", "link": "https://stackoverflow.com/users/4050144/chronojam"}, "is_accepted": false, "score": 4, "last_activity_date": 1471368807, "creation_date": 1471368807, "answer_id": 38981127, "question_id": 31466252, "link": "https://stackoverflow.com/questions/31466252/google-apps-api-403-with-service-account/38981127#38981127", "title": "Google Apps API 403 with Service Account", "body": "<p>I know this question is a year old, but I couldnt find anything about this anywhere - but ive just managed to fix it after running into the same error as you.</p>\n\n<p>basically you need to set a delegation user to your config, eg:</p>\n\n<pre><code>func main() {\n    serviceAccountJSON, err := ioutil.ReadFile(serviceAccountFile)\n    if err != nil {\n        log.Fatalf(\"Could not read service account credentials file, %s =&gt; {%s}\", serviceAccountFile, err)\n    }\n    config, err := google.JWTConfigFromJSON(serviceAccountJSON,\n        directory.AdminDirectoryUserScope,\n        directory.AdminDirectoryUserReadonlyScope,\n    )\n\n    // Add me\n    config.Subject = \"someone@example.com\"\n\n    client, err := directory.New(config.Client(context.Background()))\n    if err != nil {\n        log.Fatalf(\"Could not create directory service client =&gt; {%s}\", err)\n    }\n\n    users, err := client.Users.List().ViewType(publicDataView).Domain(domain).Do()\n    if err != nil {\n        log.Fatalf(\"Failed to query all users =&gt; {%s}\", err)\n    }\n\n    for _, u := range users.Users {\n        fmt.Println(u.Name.FullName)\n    }\n}\n</code></pre>\n\n<p>See <a href=\"https://github.com/golang/oauth2/blob/master/google/example_test.go#L118\" rel=\"nofollow\">https://github.com/golang/oauth2/blob/master/google/example_test.go#L118</a></p>\n\n<p>hope this helps someone else!</p>\n"}], "owner": {"reputation": 1318, "user_id": 1763664, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/63a82b7c52574ade60a1cf313f50aeb8?s=128&d=identicon&r=PG", "display_name": "Nate Brennand", "link": "https://stackoverflow.com/users/1763664/nate-brennand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1272, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1471368807, "creation_date": 1437089627, "last_edit_date": 1437123794, "question_id": 31466252, "link": "https://stackoverflow.com/questions/31466252/google-apps-api-403-with-service-account", "title": "Google Apps API 403 with Service Account", "body": "<p>I've been trying make a query against Google's Admin API to list all users in my Google Apps Organization. I have permissions to make this query in the <a href=\"https://developers.google.com/admin-sdk/directory/v1/reference/users/list\" rel=\"nofollow\">web UI example</a> and get results, but it 403's when I try to make the query with a service account.</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n\n    \"golang.org/x/net/context\"\n    \"golang.org/x/oauth2/google\"\n    directory \"google.golang.org/api/admin/directory_v1\"\n)\n\nfunc main() {\n    serviceAccountJSON, err := ioutil.ReadFile(serviceAccountFile)\n    if err != nil {\n        log.Fatalf(\"Could not read service account credentials file, %s =&gt; {%s}\", serviceAccountFile, err)\n    }\n    config, err := google.JWTConfigFromJSON(serviceAccountJSON,\n        directory.AdminDirectoryUserScope,\n        directory.AdminDirectoryUserReadonlyScope,\n    )\n\n    client, err := directory.New(config.Client(context.Background()))\n    if err != nil {\n        log.Fatalf(\"Could not create directory service client =&gt; {%s}\", err)\n    }\n\n    users, err := client.Users.List().ViewType(publicDataView).Domain(domain).Do()\n    if err != nil {\n        log.Fatalf(\"Failed to query all users =&gt; {%s}\", err)\n    }\n\n    for _, u := range users.Users {\n        fmt.Println(u.Name.FullName)\n    }\n}\n</code></pre>\n\n<p>Every time I execute I get a 403. The same query parameters works in the <code>Try it!</code> section <a href=\"https://developers.google.com/admin-sdk/directory/v1/reference/users/list#try-it\" rel=\"nofollow\">here</a> so I'm not sure why it fails.</p>\n\n<p>result: <code>Failed to query all users =&gt; {googleapi: Error 403: Not Authorized to access this resource/api, forbidden}</code></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 2, "last_activity_date": 1437079792, "last_edit_date": 1437079792, "creation_date": 1437079466, "answer_id": 31464188, "question_id": 31464142, "link": "https://stackoverflow.com/questions/31464142/what-is-wrong-with-this-go-switch-statement/31464188#31464188", "title": "What is wrong with this go switch statement?", "body": "<p><code>text</code> contains \"\\n\", you need to either match it or trim.</p>\n\n<pre><code>switch text = strings.TrimSpace(text); text {\ncase \"a\":\n    fmt.Println(\"A\")\ncase \"b\":\n    fmt.Println(\"B\")\ncase \"c\":\n    fmt.Println(\"C\")\ndefault:\n    fmt.Println(\"DEFAULT: \" + text)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 249, "user_id": 1369826, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0de450449ed01f4d3de6e500c0858a7f?s=128&d=identicon&r=PG", "display_name": "donpisci", "link": "https://stackoverflow.com/users/1369826/donpisci"}, "edited": false, "score": 0, "creation_date": 1437080689, "post_id": 31464310, "comment_id": 50895252, "body": "@donpisci this is something that is hard to spot."}], "tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": true, "score": 1, "last_activity_date": 1437079974, "creation_date": 1437079974, "answer_id": 31464310, "question_id": 31464142, "link": "https://stackoverflow.com/questions/31464142/what-is-wrong-with-this-go-switch-statement/31464310#31464310", "title": "What is wrong with this go switch statement?", "body": "<p>Your text consists of two bytes: <code>fmt.Print(len(text))</code> is 2 and <code>fmt.Print(len(\"a\"))</code> is one.</p>\n\n<p>You the second symbol is invisible and you can try to remove it with <code>text = strings.TrimSpace(text)</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 13632, "user_id": 1071383, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f4bf0fbd4cc6de6159d78f9f9fb3aa6?s=128&d=identicon&r=PG", "display_name": "jabclab", "link": "https://stackoverflow.com/users/1071383/jabclab"}, "reply_to_user": {"reputation": 249, "user_id": 1369826, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0de450449ed01f4d3de6e500c0858a7f?s=128&d=identicon&r=PG", "display_name": "donpisci", "link": "https://stackoverflow.com/users/1369826/donpisci"}, "edited": false, "score": 0, "creation_date": 1437080825, "post_id": 31464318, "comment_id": 50895319, "body": "@donpisci glad it helped :-)"}], "tags": [], "owner": {"reputation": 13632, "user_id": 1071383, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f4bf0fbd4cc6de6159d78f9f9fb3aa6?s=128&d=identicon&r=PG", "display_name": "jabclab", "link": "https://stackoverflow.com/users/1071383/jabclab"}, "is_accepted": false, "score": 3, "last_activity_date": 1437127044, "last_edit_date": 1437127044, "creation_date": 1437079996, "answer_id": 31464318, "question_id": 31464142, "link": "https://stackoverflow.com/questions/31464142/what-is-wrong-with-this-go-switch-statement/31464318#31464318", "title": "What is wrong with this go switch statement?", "body": "<p>Per the <a href=\"http://golang.org/pkg/bufio/#Reader.ReadString\" rel=\"nofollow\">docs</a>:</p>\n\n<blockquote>\n  <p>ReadString reads until the first occurrence of delim in the input, returning a string containing the data up to <strong>and including</strong> the delimiter.</p>\n</blockquote>\n\n<p>Therefore you can do something like:</p>\n\n<pre><code>reader := bufio.NewReader(os.Stdin)\ndelim := byte('\\n')\ntext, _ := reader.ReadString(delim)\n\nswitch text = strings.TrimRight(text, string(delim)); text {\n  // ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 179, "user_id": 12698841, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mnLhX.png?s=128&g=1", "display_name": "0example.com", "link": "https://stackoverflow.com/users/12698841/0example-com"}, "is_accepted": false, "score": 0, "last_activity_date": 1612873174, "creation_date": 1612873174, "answer_id": 66118859, "question_id": 31464142, "link": "https://stackoverflow.com/questions/31464142/what-is-wrong-with-this-go-switch-statement/66118859#66118859", "title": "What is wrong with this go switch statement?", "body": "<p>Because of \\n text has space. you have to remove it by strings.Trimspace() method.</p>\n<p>package main</p>\n<pre><code>import (\n    &quot;bufio&quot;\n    &quot;fmt&quot;\n    &quot;os&quot;\n    &quot;strings&quot;\n)\n\nfunc main() {\n\n    reader := bufio.NewReader(os.Stdin)\n    text, _ := reader.ReadString('\\n')\n    fmt.Print(text)\n    \n    switch strings.TrimSpace(text) {\n    case &quot;a&quot;:\n        fmt.Print(&quot;A\\n&quot;)\n    case &quot;b&quot;:\n        fmt.Print(&quot;B\\n&quot;)\n    case &quot;c&quot;:\n        fmt.Print(&quot;C\\n&quot;)\n    default:\n        fmt.Print(&quot;DEFAULT\\n&quot;)\n    }\n}  \n</code></pre>\n"}], "owner": {"reputation": 249, "user_id": 1369826, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0de450449ed01f4d3de6e500c0858a7f?s=128&d=identicon&r=PG", "display_name": "donpisci", "link": "https://stackoverflow.com/users/1369826/donpisci"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 31464310, "answer_count": 4, "score": 1, "last_activity_date": 1612873174, "creation_date": 1437079314, "last_edit_date": 1437099748, "question_id": 31464142, "link": "https://stackoverflow.com/questions/31464142/what-is-wrong-with-this-go-switch-statement", "title": "What is wrong with this go switch statement?", "body": "<p>Can anybody see why this switch won't work?</p>\n\n<pre><code>func main() {\n\n    reader := bufio.NewReader(os.Stdin)\n    text, _ := reader.ReadString('\\n')\n\n    fmt.Print(text)\n\n    switch text {\n    case \"a\":\n        fmt.Print(\"A\\n\")\n    case \"b\":\n        fmt.Print(\"B\\n\")\n    case \"c\":\n        fmt.Print(\"C\\n\")\n    default:\n        fmt.Print(\"DEFAULT\\n\")\n    }\n}   \n</code></pre>\n\n<p>In this statement, the default value is always returned yet when hard coding the switch expression, the switch block works as it should. Looking at the ReadString() func code, it returns a string so I can't see any reason for my example to not work.</p>\n\n<p>Am I doing something wrong?!</p>\n"}, {"tags": ["image", "go"], "comments": [{"owner": {"reputation": 165, "user_id": 314508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/14MlZ.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/314508/andy"}, "edited": false, "score": 0, "creation_date": 1437078477, "post_id": 31463756, "comment_id": 50894134, "body": "I thought it might have something to do with type assertions, but when I tried that I got the error: <code>impossible type assertion: image.NRGBA does not implement image.Image (At method has pointer receiver)</code>"}, {"owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "edited": false, "score": 0, "creation_date": 1580822269, "post_id": 31463756, "comment_id": 106217690, "body": "you should do a type assertion for a pointer to NRGBA: <code>i2 = i1.(*image.NRGBA)</code>, since the pointer type implements the image interface."}], "answers": [{"comments": [{"owner": {"reputation": 165, "user_id": 314508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/14MlZ.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/314508/andy"}, "edited": false, "score": 0, "creation_date": 1437079978, "post_id": 31464019, "comment_id": 50894906, "body": "Ahh, thank you. I got an <code>impossible type assertion</code> error when I tried <code>i.(image.RGBA)</code> but <code>i.(*image.RGBA)</code> followed by dereferencing <code>i</code> works. Clearly there&#39;s some stuff I need to learn about pointers in type assertions."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 165, "user_id": 314508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/14MlZ.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/314508/andy"}, "edited": false, "score": 2, "creation_date": 1437080190, "post_id": 31464019, "comment_id": 50895006, "body": "@Andy: why do you need to dereference it? Just keep the pointer."}, {"owner": {"reputation": 165, "user_id": 314508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/14MlZ.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/314508/andy"}, "edited": false, "score": 0, "creation_date": 1437125803, "post_id": 31464019, "comment_id": 50910728, "body": "I have functions which accept <code>image.NRGBA</code> arguments. Perhaps I should redesign them to accept pointers though. It seems sensible to pass images by reference."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 165, "user_id": 314508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/14MlZ.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/314508/andy"}, "edited": false, "score": 1, "creation_date": 1437145395, "post_id": 31464019, "comment_id": 50923035, "body": "@Andy, you&#39;ll never want any function to take an <code>image.NRGBA</code>; at minimum use <code>*image.NRGBA</code>. However, much better (<i>if</i> you don&#39;t need low level access to a specific pixel format) is to just use <code>image.Image</code> (your question only mentions needing <code>At</code> which is part of that interface). If you need to be able to set pixels, then use a <a href=\"https://golang.org/pkg/image/draw/#Image\" rel=\"nofollow noreferrer\"><code>draw.Image</code></a> argument (which adds a <code>Set</code> method)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1437146069, "post_id": 31464019, "comment_id": 50923443, "body": "@DaveC: the <code>At</code> and <code>Set</code> methods aren&#39;t great for bulk operations. It&#39;s very slow to go through the interface, dereference, and return value conversions for every pixel. Large image manipulations require direct access to the <code>Pix</code> slice. (though that is probably implied by your caveat, I just wanted to make sure it was clear to someone new)."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1437146623, "post_id": 31464019, "comment_id": 50923798, "body": "@JimB, true and definitely worth mentioning! IMO from an API point of view it&#39;s still best to accept an <code>image.Image</code> (or <code>draw.Image</code>) rather than a specific image format. If the code needs fast pixel access, it can use a type switch to special case access to common <code>Pix</code> members (like what the draw package does itself). Depending on the what&#39;s being done and the size of the image it can be reasonable to work with a specific underlying type and if a type assertion on the input <code>image.Image</code> fails use <code>image&#47;draw</code> to semi-efficiently copy it to the required type and work with that."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1437146717, "post_id": 31464019, "comment_id": 50923861, "body": "Of course I&#39;m talking about exported APIs; if you&#39;re writing code that is non-exported or otherwise knows it will <i>never</i> need to deal with more than a single image format, then it&#39;s fine to just use <code>*image.NRGBA</code> (or whatever underlying type is appropriate)."}, {"owner": {"reputation": 165, "user_id": 314508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/14MlZ.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/314508/andy"}, "edited": false, "score": 0, "creation_date": 1438531449, "post_id": 31464019, "comment_id": 51477981, "body": "Yes, I keep hearing about how it&#39;s not efficient to iterate over pixels with <code>At</code> and <code>Set</code>, but I&#39;m not sure how else to do it.  Is there a way I can specify a kernel operation like I would in something such as OpenGL. Or should I just be iterating over <code>Pix</code> using a pointer, like in C?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 165, "user_id": 314508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/14MlZ.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/314508/andy"}, "edited": false, "score": 0, "creation_date": 1438609294, "post_id": 31464019, "comment_id": 51506017, "body": "@Andy: yes, you iterate over <code>Pix</code> (though there&#39;s no pointer involved here, you just use a for loop and index into Pix)"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1437079597, "last_edit_date": 1437079597, "creation_date": 1437078848, "answer_id": 31464019, "question_id": 31463756, "link": "https://stackoverflow.com/questions/31463756/convert-image-image-to-image-nrgba/31464019#31464019", "title": "Convert image.Image to image.NRGBA", "body": "<p>If you don't need to \"convert\" the image type, and just want to extract the underlying type from the interface, use a \"type assertion\":</p>\n\n<pre><code>if img, ok := i.(*image.RGBA); ok {\n    // img is now an *image.RGBA\n}\n</code></pre>\n\n<p>Or with a type switch:</p>\n\n<pre><code>switch i := i.(type) {\ncase *image.RGBA:\n    // i in an *image.RGBA\ncase *image.NRGBA:\n    // i in an *image.NRBGA\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 10223, "user_id": 221650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/68a2471aa6fae5bfec71d8d09afbb2f1?s=128&d=identicon&r=PG&f=1", "display_name": "Petruza", "link": "https://stackoverflow.com/users/221650/petruza"}, "edited": false, "score": 0, "creation_date": 1580821169, "post_id": 58259978, "comment_id": 106217089, "body": "Wow that&#39;s weird, since when you examine <code>png.Decode()</code> return value, it is an <code>image</code> but in the debug panel you can see it has a <code>data *image.NRGBA</code> member. Where is that member coming from and how can one access it?"}, {"owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "reply_to_user": {"reputation": 10223, "user_id": 221650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/68a2471aa6fae5bfec71d8d09afbb2f1?s=128&d=identicon&r=PG&f=1", "display_name": "Petruza", "link": "https://stackoverflow.com/users/221650/petruza"}, "edited": false, "score": 0, "creation_date": 1580822115, "post_id": 58259978, "comment_id": 106217606, "body": "@Petruza I believe the <code>Draw</code> function is clever, and does something efficient when the source already has the correct format.  If you are sure that your source image is NRGBA, you could just use a type assertion: <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">tour.golang.org/methods/15</a>"}], "tags": [], "owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "is_accepted": false, "score": 3, "last_activity_date": 1570386669, "last_edit_date": 1570386669, "creation_date": 1570385157, "answer_id": 58259978, "question_id": 31463756, "link": "https://stackoverflow.com/questions/31463756/convert-image-image-to-image-nrgba/58259978#58259978", "title": "Convert image.Image to image.NRGBA", "body": "<p>The solution to the question in the title, how to <em>convert</em> an image to <code>image.NRGBA</code>, can be found <a href=\"https://blog.golang.org/go-imagedraw-package#TOC_6.\" rel=\"nofollow noreferrer\">in the Go Blog</a>: The trick is to create a new, empty <code>image.NRGBA</code> and then to \"draw\" the original image into the NRGBA image:</p>\n\n<pre><code>import \"image/draw\"\n\n...\n\nsrc := ...image to be converted...\nb := src.Bounds()\nm := image.NewNRGBA(image.Rect(0, 0, b.Dx(), b.Dy()))\ndraw.Draw(m, m.Bounds(), src, b.Min, draw.Src)\n</code></pre>\n"}], "owner": {"reputation": 165, "user_id": 314508, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/14MlZ.jpg?s=128&g=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/314508/andy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5639, "favorite_count": 1, "accepted_answer_id": 31464019, "answer_count": 2, "score": 7, "last_activity_date": 1570386669, "creation_date": 1437077861, "question_id": 31463756, "link": "https://stackoverflow.com/questions/31463756/convert-image-image-to-image-nrgba", "title": "Convert image.Image to image.NRGBA", "body": "<p>When I call <code>png.Decode(imageFile)</code> it returns a type <code>image.Image</code>. But I can't find a documented way to convert this to an <code>image.NRGBA</code> or <code>image.RGBA</code> on which I can call methods like <code>At()</code>.</p>\n\n<p>How can I achieve this?</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1437074749, "post_id": 31462642, "comment_id": 50892118, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/8270816/converting-go-struct-to-json\">Converting Go struct to JSON</a>"}, {"owner": {"reputation": 2337, "user_id": 600061, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bbac8bb4d3ffbceca42b09eb0729e63c?s=128&d=identicon&r=PG", "display_name": "Twisted1919", "link": "https://stackoverflow.com/users/600061/twisted1919"}, "edited": false, "score": 0, "creation_date": 1437075083, "post_id": 31462642, "comment_id": 50892306, "body": "You are not that far though, here&#39;s a simple playground code to help you <a href=\"http://play.golang.org/p/6IvVM3bzDU\" rel=\"nofollow noreferrer\">play.golang.org/p/6IvVM3bzDU</a>"}], "answers": [{"comments": [{"owner": {"reputation": 111, "user_id": 4159145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mW0Lp.png?s=128&g=1", "display_name": "JacksGT", "link": "https://stackoverflow.com/users/4159145/jacksgt"}, "edited": false, "score": 0, "creation_date": 1437074849, "post_id": 31462792, "comment_id": 50892161, "body": "Thanks for the tip about &#39;uppercase&#39;, you just solved another problem of mine :-)  How can I access the slice / object? apps[0].Name gave me a &quot;index out of range&quot; error"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 111, "user_id": 4159145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mW0Lp.png?s=128&g=1", "display_name": "JacksGT", "link": "https://stackoverflow.com/users/4159145/jacksgt"}, "edited": false, "score": 0, "creation_date": 1437075444, "post_id": 31462792, "comment_id": 50892502, "body": "@JacksGT that was the comment about append or composite literal for initilization, I&#39;ll update with an example of each."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 0, "last_activity_date": 1437075596, "last_edit_date": 1437075596, "creation_date": 1437074539, "answer_id": 31462792, "question_id": 31462642, "link": "https://stackoverflow.com/questions/31462642/object-inside-slice-in-go/31462792#31462792", "title": "Object inside slice in Go", "body": "<p>The form of your 'model' (the struct in Go in this case) isn't quite right. You really just want this;</p>\n\n<pre><code>type application struct {\n        Name        string `json:\"name\"`   // gotta uppercase these so they're exported \n        Version     string `json:\"version\"` // otherwise you can't marshal them\n    }\napps := []application{\n     application{Name:\"Windows\", Version:\"10\"}\n}\napp := application{Name:\"Linux\", Vesion:\"14.2\"}\napps = append(apps, app)\n</code></pre>\n\n<p>The json opens with <code>[</code> meaning it is just an array, there is no enclosing object. If there were you would want another type with an application array ( <code>[]application</code> ) property. To add items to that array you can use <code>append</code> or initialize it with some instance using the 'composite literal' syntax.</p>\n\n<p>EDIT: I added some annotations so the json produced will have lower cased names like in your example. If a property isn't exported in Go other libraries like <code>encoding/json</code> won't be able to use it.</p>\n"}], "owner": {"reputation": 111, "user_id": 4159145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mW0Lp.png?s=128&g=1", "display_name": "JacksGT", "link": "https://stackoverflow.com/users/4159145/jacksgt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 31462792, "answer_count": 1, "score": -1, "last_activity_date": 1437075596, "creation_date": 1437074063, "last_edit_date": 1437074905, "question_id": 31462642, "link": "https://stackoverflow.com/questions/31462642/object-inside-slice-in-go", "title": "Object inside slice in Go", "body": "<p>I am trying to embed multiple objects inside a slice, so I can later export them as JSON. The JSON should look something like this:</p>\n\n<pre><code>[\n   {\n       name: \"Nginx\"\n       version: \"1.9\"\n   },\n   {\n       name: ircd-hybrid\"\n       version: \"8.2\"\n    }\n]\n</code></pre>\n\n<p>So far I have this struct in Go:</p>\n\n<pre><code>type response struct {\n    application []struct {\n        name        string\n        version     string\n    }\n}\n</code></pre>\n\n<p>Now (I'm not even sure if the struct is correct), I'm trying to access it this way (again, not sure if this is correct):</p>\n\n<pre><code>   var d response\n   d[0].name = \"Nginx\"\n   d[0].version = \"1.9\"\n</code></pre>\n\n<p>And so on and so forth. However, it is not working, so I assume I went wrong somewhere. I just don't know where.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1437072083, "post_id": 31461723, "comment_id": 50890685, "body": "Can you define methods on <code>data</code>? Otherwise, what Emrakul says - write a function."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1437076785, "post_id": 31463330, "comment_id": 50893248, "body": "you don&#39;t even need to copy the values, you can convert the map directly: <code>dm := detailsMap(data.Objects)</code>"}], "tags": [], "owner": {"reputation": 13632, "user_id": 1071383, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4f4bf0fbd4cc6de6159d78f9f9fb3aa6?s=128&d=identicon&r=PG", "display_name": "jabclab", "link": "https://stackoverflow.com/users/1071383/jabclab"}, "is_accepted": true, "score": 1, "last_activity_date": 1437077824, "last_edit_date": 1437077824, "creation_date": 1437076313, "answer_id": 31463330, "question_id": 31461723, "link": "https://stackoverflow.com/questions/31461723/improve-multiple-map-access-and-avoid-incorrect-type-conversion/31463330#31463330", "title": "Improve multiple map access and avoid incorrect type conversion", "body": "<p>As <strong>@JimB</strong> mentions you can use a custom type, e.g.</p>\n\n<pre><code>type detailsMap map[string]interface{}\n\nfunc (dm detailsMap) String(key string) string {\n    if val, ok := dm[key].(string); ok {\n        return val\n    }\n    return \"\"\n}\n\nfunc (dm detailsMap) Int64(key string) int64 {\n    if val, ok := dm[key].(int64); ok {\n        return val\n    }\n    return 0\n}\n</code></pre>\n\n<p>Note that default <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow\">zero values</a> are returned if the desired <code>key</code> is not present in the type's underlying <code>map[string]interface{}</code>.</p>\n\n<p>If you haven't got control of the original <code>data.Objects</code> then you can convert it to a <code>detailsMap</code> via <code>detailsMap(data.Objects)</code>.</p>\n\n<p>You can then get values out as follows:</p>\n\n<pre><code>corporateName := dm.String(\"corporateName\")\nwebsite := dm.String(\"website\")\nbillingCode := dm.Int64(\"billingCode\")\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/qNxQHQQ5RX\" rel=\"nofollow\">Here</a>'s an example on the playground.</p>\n"}], "owner": {"reputation": 1803, "user_id": 3531912, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/Qh3Y8.png?s=128&g=1", "display_name": "Alessandro Suglia", "link": "https://stackoverflow.com/users/3531912/alessandro-suglia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 31463330, "answer_count": 1, "score": 0, "last_activity_date": 1437077824, "creation_date": 1437070775, "question_id": 31461723, "link": "https://stackoverflow.com/questions/31461723/improve-multiple-map-access-and-avoid-incorrect-type-conversion", "title": "Improve multiple map access and avoid incorrect type conversion", "body": "<p>I have this code in my project:</p>\n\n<pre><code>//data.Objects is a map[string]interface{}\ncorporateName := data.Objects[\"corporateName\"].(string)\ndba := data.Objects[\"dba\"].(string)\nlicence := data.Objects[\"licence\"].(string)\nresaleCert := data.Objects[\"resaleCert\"].(string)\neinNumber := data.Objects[\"einNumber\"].(string)\nphoneNumber := data.Objects[\"phoneNumber\"].(string)\nwebsite := data.Objects[\"website\"].(string)\ncontactName := data.Objects[\"contactName\"].(string)\nemail := data.Objects[\"email\"].(string)\nbillingAddress := data.Objects[\"billingStreet\"].(string)\nbillingCity := data.Objects[\"billingCity\"].(string)\nbillingCode := data.Objects[\"billingCode\"].(int64)\nbillingState := data.Objects[\"billingState\"].(string)\nbillingCountry := data.Objects[\"billingContry\"].(string)\ndeliveryAddress := data.Objects[\"deliveryAddress\"].(string)\n</code></pre>\n\n<p>In the declared map, some of these key couldn't have a value associated so they can return <em>nil</em>. If they do that I'm not able to do a type conversion.\nI'm looking for a way in order to improve this access and prevent the incorrect conversion. </p>\n\n<p>Using some if else to check it it's quite annoying and verbose. Is there a way in order to avoid it?</p>\n\n<p>N.B.\nThe <em>nil</em> values for the structure are perfectly legal in this case so it's not a problem that I can avoid before.</p>\n"}, {"tags": ["go", "atom-editor"], "comments": [{"owner": {"reputation": 4680, "user_id": 652259, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/I4urp.png?s=128&g=1", "display_name": "Dave", "link": "https://stackoverflow.com/users/652259/dave"}, "edited": false, "score": 1, "creation_date": 1470885334, "post_id": 31455131, "comment_id": 65133827, "body": "I struggled for weeks with Atom and Go To Declaration.  I gave up and took 1 minute to install Sublime Text which worked right out of the box, no packages, tags file, or any other configuration needed."}, {"owner": {"reputation": 665, "user_id": 1928660, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/rnpOq.png?s=128&g=1", "display_name": "ATN", "link": "https://stackoverflow.com/users/1928660/atn"}, "edited": false, "score": 0, "creation_date": 1473083098, "post_id": 31455131, "comment_id": 65995357, "body": "Did you install <code>godef</code> separately?"}], "answers": [{"comments": [{"owner": {"reputation": 462, "user_id": 1365520, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aa5f0c4003145813dec46fddbf8c470a?s=128&d=identicon&r=PG", "display_name": "mcbain83", "link": "https://stackoverflow.com/users/1365520/mcbain83"}, "edited": false, "score": 0, "creation_date": 1437305783, "post_id": 31455262, "comment_id": 50964534, "body": "I&#39;m using 3.4.2 go-plus and it&#39;s still not working. I&#39;m really very stumped with this one. My GOPATH is set ok no errors from the editor it can find go-def everything looks ok.. Any other suggestions?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 462, "user_id": 1365520, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aa5f0c4003145813dec46fddbf8c470a?s=128&d=identicon&r=PG", "display_name": "mcbain83", "link": "https://stackoverflow.com/users/1365520/mcbain83"}, "edited": false, "score": 0, "creation_date": 1437305951, "post_id": 31455262, "comment_id": 50964579, "body": "@mcbain83 try install it from the command line: <code>go install github.com&#47;rogpeppe&#47;godef</code>: you should see a <code>godef.exe</code> in <code>%GOPATH%\\bin</code> (I am seeing one myself in my environment). Once in place, the Go-Plus / Display Go Information does list godef correctly."}, {"owner": {"reputation": 462, "user_id": 1365520, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aa5f0c4003145813dec46fddbf8c470a?s=128&d=identicon&r=PG", "display_name": "mcbain83", "link": "https://stackoverflow.com/users/1365520/mcbain83"}, "edited": false, "score": 0, "creation_date": 1437479789, "post_id": 31455262, "comment_id": 51035912, "body": "Nope still not working. When the package loads in atom there are no errors. The gopath is set to my workspace and the $GOAPTH/bin dir has all the right exe&#39;s in there."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1437052483, "creation_date": 1437052483, "answer_id": 31455262, "question_id": 31455131, "link": "https://stackoverflow.com/questions/31455131/atom-editor-golang-go-to-declaration-not-working/31455262#31455262", "title": "Atom Editor Golang - Go To Declaration not working", "body": "<p>That might be related to the <code>godef</code> package, which has recently changed location.</p>\n\n<p>See \"<a href=\"https://github.com/joefitzgerald/go-plus/pull/239\" rel=\"nofollow\">PR 239</a>\" (merged in <a href=\"https://github.com/joefitzgerald/go-plus/commit/7a32e22c2c9bca392c4bd41ffef3dfc2cafc791e\" rel=\"nofollow\">7a32e22</a>):</p>\n\n<blockquote>\n  <p>The godef package has been <a href=\"https://github.com/rogpeppe/godef\" rel=\"nofollow\">moved to github</a> (see <a href=\"http://godoc.org/code.google.com/p/rog-go/exp/cmd/godef\" rel=\"nofollow\">http://godoc.org/code.google.com/p/rog-go/exp/cmd/godef</a>).<br>\n  This change will allow Get Missing Tools to install it.</p>\n</blockquote>\n\n<p>That will be available in go-plus 3.4.2 (currently I see 3.4.1 in my Atom package list)</p>\n"}, {"tags": [], "owner": {"reputation": 1778, "user_id": 2303988, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/VcVRc.jpg?s=128&g=1", "display_name": "Alessio", "link": "https://stackoverflow.com/users/2303988/alessio"}, "is_accepted": false, "score": 10, "last_activity_date": 1482405951, "last_edit_date": 1482405951, "creation_date": 1452766032, "answer_id": 34786713, "question_id": 31455131, "link": "https://stackoverflow.com/questions/31455131/atom-editor-golang-go-to-declaration-not-working/34786713#34786713", "title": "Atom Editor Golang - Go To Declaration not working", "body": "<p>Fresh install of <code>Atom 1.3.3</code> with <code>go-plus 3.5.2</code> and it worked.</p>\n\n<p>By default, the shortcut is <code>Alt+Cmd+G</code>, but you can change as explained <a href=\"http://www.bhyuu.com/set-a-shortcut-in-atom-editor-for-go-to-definition-using-go-plus/\" rel=\"noreferrer\">here</a></p>\n\n<p><strong>Update December, 22th:</strong></p>\n\n<p>With the latest update of <code>Atom (1.12.7)</code> and <code>go-plus (5.0.6)</code>, the <code>hyperclick</code> package (v 0.0.39) is installed and CMD+click will take you to the definition</p>\n"}, {"tags": [], "owner": {"reputation": 622, "user_id": 5604249, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7bed34ebe08c34a10addbea1bf85ff17?s=128&d=identicon&r=PG&f=1", "display_name": "Pharaoh", "link": "https://stackoverflow.com/users/5604249/pharaoh"}, "is_accepted": false, "score": 2, "last_activity_date": 1473238024, "creation_date": 1473238024, "answer_id": 39365238, "question_id": 31455131, "link": "https://stackoverflow.com/questions/31455131/atom-editor-golang-go-to-declaration-not-working/39365238#39365238", "title": "Atom Editor Golang - Go To Declaration not working", "body": "<p>On Ubuntu, Press ctrl-alt-g on the variable for which you want to do \"go to declaration\", Atom will ask if you want to install go-def, click yes, once installed it will show you a notification, after which Go to declaration works. </p>\n"}, {"tags": [], "owner": {"reputation": 5455, "user_id": 555493, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7f71360d1b97bf28012fffa173ec0eb0?s=128&d=identicon&r=PG", "display_name": "U Avalos", "link": "https://stackoverflow.com/users/555493/u-avalos"}, "is_accepted": false, "score": 2, "last_activity_date": 1475730801, "creation_date": 1475730801, "answer_id": 39887986, "question_id": 31455131, "link": "https://stackoverflow.com/questions/31455131/atom-editor-golang-go-to-declaration-not-working/39887986#39887986", "title": "Atom Editor Golang - Go To Declaration not working", "body": "<p>It was two things that got <code>godef</code> working for me:</p>\n\n<ol>\n<li>fixing GOROOT when go is installed by brew. You need to use the <code>libexec</code> subdirectory. See below.</li>\n<li>understanding GOPATH. It's the <em>workspace</em>. In Intellij terminology, the GOPATH is the path to the project. It has as <em>immediate</em> subfolders <code>src</code>, <code>bin</code>, and other go-specific folders.</li>\n</ol>\n\n<p>Below is what my <code>bash_profile</code> looks like. </p>\n\n<pre><code>export GOPATH=$HOME/Documents/gocode\nexport GOROOT=/usr/local/Cellar/go/1.7.1/libexec\nexport PATH=$PATH:$GOROOT/bin\nexport PATH=$PATH:$GOPATH/bin\n</code></pre>\n\n<p>After making this change, atom (as well as emacs) started to work</p>\n"}, {"tags": [], "owner": {"reputation": 433, "user_id": 252402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0325d6bce43e07125d7f9768392f50f5?s=128&d=identicon&r=PG", "display_name": "JoshMahowald", "link": "https://stackoverflow.com/users/252402/joshmahowald"}, "is_accepted": false, "score": 0, "last_activity_date": 1480793810, "creation_date": 1480793810, "answer_id": 40951715, "question_id": 31455131, "link": "https://stackoverflow.com/questions/31455131/atom-editor-golang-go-to-declaration-not-working/40951715#40951715", "title": "Atom Editor Golang - Go To Declaration not working", "body": "<p>I had goplus and it wasn't working but the <a href=\"https://atom.io/packages/godef\" rel=\"nofollow noreferrer\">godef atom package</a> worked like a charm</p>\n\n<p><code>apm install godef</code> </p>\n"}], "owner": {"reputation": 462, "user_id": 1365520, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aa5f0c4003145813dec46fddbf8c470a?s=128&d=identicon&r=PG", "display_name": "mcbain83", "link": "https://stackoverflow.com/users/1365520/mcbain83"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8710, "favorite_count": 1, "answer_count": 5, "score": 8, "last_activity_date": 1482405951, "creation_date": 1437052170, "question_id": 31455131, "link": "https://stackoverflow.com/questions/31455131/atom-editor-golang-go-to-declaration-not-working", "title": "Atom Editor Golang - Go To Declaration not working", "body": "<p>I've done a fresh install of atom and installed go-plus package. The one feature I can't get working is the \"Go To Declaration\" which is why I'm still stuck in sublime land... Does anyone know if this works with golang? I't appears that I need to have ctags for my project? Whats the best way to get this going for atom? I've tried installing other packages that geverate the ctags but I don't think that helped. Has anyone got this working? What did you do? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1437038170, "post_id": 31450023, "comment_id": 50867941, "body": "Thanks but as I mentioned in my question I changed from string to byte so that it works with the bcrypt package. Would you just recommend typecasting the string value to byte for bcrypt and then back to string for saving?"}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1437038534, "post_id": 31450023, "comment_id": 50868195, "body": "@tommyd456 Welcome :) . At first I missed the reason why you were using []byte, focusing just on the error. Sorry for that!"}, {"owner": {"reputation": 14728, "user_id": 2142577, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/820c611835bb6eea4851c318a3b73345?s=128&d=identicon&r=PG", "display_name": "laike9m", "link": "https://stackoverflow.com/users/2142577/laike9m"}, "edited": false, "score": 0, "creation_date": 1476200808, "post_id": 31450023, "comment_id": 67241198, "body": "So generally it&#39;s better to just use <code>string</code> for json field?"}], "tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": true, "score": 10, "last_activity_date": 1437038185, "last_edit_date": 1437038185, "creation_date": 1437037931, "answer_id": 31450023, "question_id": 31449610, "link": "https://stackoverflow.com/questions/31449610/illegal-base64-data-error-message/31450023#31450023", "title": "illegal base64 data error message", "body": "<p>The problem lies in using <code>[]byte</code> instead of <code>string</code> for password. This is because the <code>encoding/json</code> package will expect a base64 encoded string when decoding to <code>[]byte</code>.</p>\n\n<p>The documentation for <a href=\"http://golang.org/pkg/encoding/json/#Marshal\" rel=\"noreferrer\"><code>encoding/json</code></a> says:</p>\n\n<blockquote>\n  <p>Array and slice values encode as JSON arrays, except that []byte encodes as a base64-encoded string, and a nil slice encodes as the null JSON object.</p>\n</blockquote>\n\n<p>So, just change it to <code>string</code>:</p>\n\n<pre><code>Password string `json:\"password,omitempty\"`\n</code></pre>\n\n<p>When you want to use it with bcrypt, then you just convert the <code>string</code> to <code>[]byte</code>:</p>\n\n<pre><code>[]byte(user.Password)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5287, "user_id": 1813169, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wTAkF.jpg?s=128&g=1", "display_name": "MTCoster", "link": "https://stackoverflow.com/users/1813169/mtcoster"}, "is_accepted": false, "score": 0, "last_activity_date": 1506337975, "creation_date": 1506337975, "answer_id": 46403837, "question_id": 31449610, "link": "https://stackoverflow.com/questions/31449610/illegal-base64-data-error-message/46403837#46403837", "title": "illegal base64 data error message", "body": "<p>If you want to extract a byte array directly from JSON, you can use the datatype <code>*json.RawMessage</code>, which is defined at <code>encoding/json/stream.go:247</code> (in Go 1.9) as:</p>\n\n<pre><code>type RawMessage []byte\n</code></pre>\n\n<p>This special type instructs the unmarshaller to skip decoding and simply create a slice of the relevant bytes.  Since this is still just a byte array though, you can use it directly with bcrypt functions:</p>\n\n<pre><code>type User struct {\n    ...\n    Password     *json.RawMessage   `json:\"password,omitempty\"`\n    ...\n}\n\n...\n\nerr := bcrypt.CompareHashAndPassword(*user.Password, storedPassword)\n</code></pre>\n\n<p>Note the pointer dereference (<code>*</code>) when reading the value.</p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8401, "favorite_count": 3, "accepted_answer_id": 31450023, "answer_count": 2, "score": 7, "last_activity_date": 1506337975, "creation_date": 1437036733, "last_edit_date": 1437037395, "question_id": 31449610, "link": "https://stackoverflow.com/questions/31449610/illegal-base64-data-error-message", "title": "illegal base64 data error message", "body": "<p>I'm building an API that accepts JSON data POSTed to it.</p>\n\n<p>I have the following <code>user</code> struct and recently I changed the <code>password</code> datatype to <code>[]byte</code> from <code>string</code> so that it \"plays nicely\" with the bcrypt package.</p>\n\n<pre><code>type User struct {\n    Id           string             `json:\"id,omitempty\"`\n    Email        string             `json:\"email,omitempty\"`\n    Username     string             `json:\"username,omitempty\"`\n    Password     []byte             `json:\"password,omitempty\"`\n    Name         string             `json:\"name,omitempty\"`\n}\n</code></pre>\n\n<p>However, I'm now getting an internal error returned in the JSON response <strong>illegal base64 data at input byte 4</strong> when a user is POSTed with a password of 5 or more characters to the API. There are no issues if the password is 4 or less characters.</p>\n\n<p>I've pinpointed the error to this block of code:</p>\n\n<pre><code>err := json.NewDecoder(req.Body).Decode(User)\nif err != nil &amp;&amp; err != io.EOF {\n    return err\n}\n</code></pre>\n\n<p>Any ideas on a fix?</p>\n"}, {"tags": ["session", "go", "gorilla"], "comments": [{"owner": {"reputation": 2749, "user_id": 718981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd2b5c3cd12ceaa6a42cb683d4d75b1?s=128&d=identicon&r=PG", "display_name": "simonmenke", "link": "https://stackoverflow.com/users/718981/simonmenke"}, "edited": false, "score": 2, "creation_date": 1437046871, "post_id": 31448642, "comment_id": 50873538, "body": "Seems like this might be a problem with how your client handles cookies. Could you add the client code?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1437078219, "post_id": 31448642, "comment_id": 50893979, "body": "Can you use another tool like fiddler to inspect and provide the request headers and body for both cases? My approach to this problem would be, fiddle each, copy the data into a text editor, compare the two, make it so my clients request is identical to Postmans."}, {"owner": {"reputation": 249, "user_id": 3602982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f498120f2b82de0f4e2a9440f7c039d7?s=128&d=identicon&r=PG&f=1", "display_name": "Sam Phomsopha", "link": "https://stackoverflow.com/users/3602982/sam-phomsopha"}, "edited": false, "score": 0, "creation_date": 1437236323, "post_id": 31448642, "comment_id": 50949660, "body": "When you say from the &quot;client&quot;, is this on the same domain? Sounds like it&#39;s not."}, {"owner": {"reputation": 1482, "user_id": 4658431, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-wW3C8BFxvpU/AAAAAAAAAAI/AAAAAAAAAWk/60SAn3qGEuo/photo.jpg?sz=128", "display_name": "Victor Balan", "link": "https://stackoverflow.com/users/4658431/victor-balan"}, "edited": false, "score": 0, "creation_date": 1437372284, "post_id": 31448642, "comment_id": 50981726, "body": "The word CORS is in the title =&gt; it`s not the same domain"}], "answers": [{"comments": [{"owner": {"reputation": 1355, "user_id": 721019, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cYL8U.jpg?s=128&g=1", "display_name": "n0nag0n", "link": "https://stackoverflow.com/users/721019/n0nag0n"}, "edited": false, "score": 0, "creation_date": 1507839716, "post_id": 31509775, "comment_id": 80382808, "body": "For those seeking clarification on withCredientials, this is part of the XMLHttpRequest object, so in the original post, the user would need to add the <code>xmlhttp.withCredentials = true;</code> line."}], "tags": [], "owner": {"reputation": 1482, "user_id": 4658431, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-wW3C8BFxvpU/AAAAAAAAAAI/AAAAAAAAAWk/60SAn3qGEuo/photo.jpg?sz=128", "display_name": "Victor Balan", "link": "https://stackoverflow.com/users/4658431/victor-balan"}, "is_accepted": true, "score": 3, "last_activity_date": 1437372446, "creation_date": 1437372446, "answer_id": 31509775, "question_id": 31448642, "link": "https://stackoverflow.com/questions/31448642/gorilla-sessions-not-working-for-cors-from-client/31509775#31509775", "title": "Gorilla sessions not working for CORS from client", "body": "<p>The problem is that in the client the requests need to have <code>withCredentials = true</code> and after that the browser deals with everything. It gets the cookie from the <code>set-cookie</code> header and it sends the cookies via the <code>cookie</code> header. So, after all, it was not a gorilla sessions problem.</p>\n"}, {"tags": [], "owner": {"reputation": 1355, "user_id": 721019, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/cYL8U.jpg?s=128&g=1", "display_name": "n0nag0n", "link": "https://stackoverflow.com/users/721019/n0nag0n"}, "is_accepted": false, "score": 0, "last_activity_date": 1507850700, "creation_date": 1507850700, "answer_id": 46720321, "question_id": 31448642, "link": "https://stackoverflow.com/questions/31448642/gorilla-sessions-not-working-for-cors-from-client/46720321#46720321", "title": "Gorilla sessions not working for CORS from client", "body": "<p>If anyone else is having the same problem I was having and you want to whitelist all domains/wildcards (or have a list of domains in an array you can scan through), you can do something like this. </p>\n\n<pre><code>domain_raw := r.Host\ndomain_host_parts := strings.Split(domain_raw, \".\")\ndomain := domain_host_parts[1] + \".\" + domain_host_parts[2]\ndomains := getDomains() // stores a slice of all your allowable domains\nhas_domain := false\nfor _, d := range domains {\n    if d == domain {\n        has_domain = true\n        break\n    }\n}\n\nif has_domain == false {\n    return\n} else {\n    w.Header().Add(\"Access-Control-Allow-Origin\", \"https://\"+domain_raw)\n    w.Header().Add(\"Access-Control-Allow-Credentials\", \"true\")\n}\n</code></pre>\n\n<p>I love go</p>\n"}], "owner": {"reputation": 1482, "user_id": 4658431, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-wW3C8BFxvpU/AAAAAAAAAAI/AAAAAAAAAWk/60SAn3qGEuo/photo.jpg?sz=128", "display_name": "Victor Balan", "link": "https://stackoverflow.com/users/4658431/victor-balan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1428, "favorite_count": 0, "accepted_answer_id": 31509775, "answer_count": 2, "score": 3, "last_activity_date": 1575196489, "creation_date": 1437034005, "last_edit_date": 1575196489, "question_id": 31448642, "link": "https://stackoverflow.com/questions/31448642/gorilla-sessions-not-working-for-cors-from-client", "title": "Gorilla sessions not working for CORS from client", "body": "<p>I have set up a Go rest api. And on login I do this:</p>\n\n<pre><code>session, _ := store.New(r, sessionId)\nsession.Options.MaxAge = 12 * 3600\nerr := session.Save(r, w)\n//treat error\n</code></pre>\n\n<p>and for checking the session i have smth like this:</p>\n\n<pre><code>    session, err := store.Get(r, sessionId)\n    //treat error\n    if session.IsNew {\n        http.Error(w, \"Unauthorized session.\", http.StatusUnauthorized)\n        return\n    }\n</code></pre>\n\n<p>If I do the requests from postman it works fine, but when I do them from my client I get 401. Has any of you experienced something like this? The store is a CookieStore.</p>\n\n<p>I already checked the id's, I replaced sessionId variable with a static string. Gorilla session uses gorilla context to register a new request and when I do the request from postman <code>context.data[r]</code> is not null, but from the client it is always null -> always a new session.</p>\n\n<p><a href=\"https://github.com/gorilla/context/blob/master/context.go\" rel=\"nofollow noreferrer\">https://github.com/gorilla/context/blob/master/context.go</a> - line 33</p>\n\n<p>it is called in</p>\n\n<p><a href=\"https://github.com/gorilla/sessions/blob/master/sessions.go\" rel=\"nofollow noreferrer\">https://github.com/gorilla/sessions/blob/master/sessions.go</a> - line 122</p>\n\n<p>wich is used in the CookieStore.Get function in</p>\n\n<p><a href=\"https://github.com/gorilla/sessions/blob/master/store.go\" rel=\"nofollow noreferrer\">https://github.com/gorilla/sessions/blob/master/store.go</a> - line 77</p>\n\n<p>EDIT 1:\nFor the client I use polymer and I tried xmlhttp too.\nPolymer:</p>\n\n<pre><code>&lt;iron-ajax\n  id=\"ajaxRequest\"\n  auto\n  url=\"{{requestUrl}}\"\n  headers=\"{{requestHeaders}}\"\n  handle-as=\"json\"\n  on-response=\"onResponse\"\n  on-error=\"onError\"\n  content-type=\"application/json\"\n  &gt;\n&lt;/iron-ajax&gt;\n</code></pre>\n\n<p>and the handlers</p>\n\n<pre><code>  onResponse: function(response){\n    console.log(response.detail.response);\n    this.items = response.detail.response\n  },\n  onError: function(error){\n    console.log(error.detail)\n  },\n  ready: function(){\n    this.requestUrl = \"http://localhost:8080/api/fingerprint/company/\" + getCookie(\"companyId\");\n    this.requestHeaders = {\"Set-cookie\": getCookie(\"api_token\")}\n  }\n</code></pre>\n\n<p>and the cookie successfully reaches the backend.</p>\n\n<p>And xmlhttp:</p>\n\n<pre><code>  var xmlhttp = new XMLHttpRequest();\n  xmlhttp.onreadystatechange = function() {\n    if (xmlhttp.readyState == XMLHttpRequest.DONE ) {\n      if(xmlhttp.status == 200){\n        //do stuff\n      }else if(xmlhttp.status == 401){\n        page.redirect(\"/unauthorized\")\n      }else{\n        page.redirect(\"/error\")\n      }\n    }\n  }\n\n  xmlhttp.open(\"GET\",\"http://localhost:8080/api/fingerprint/company/\" + getCookie(\"companyId\"),true);\n  xmlhttp.setRequestHeader(\"Set-cookie\", getCookie(\"api_token\"));\n  xmlhttp.send();\n</code></pre>\n\n<p>EDIT 2:</p>\n\n<p>So I tried debugging with fiddler(thanks for the suggestion) and i found out that the request from postman has an bold entry <code>Cookies / Login</code> and the request from the client does not. Any idea how to get/set that value? It is somehow automatically set in Postman. In the authentication request I get a set-cookie header that has all the data that I need but I can't get it on the client. I get <code>Refused to get unsafe header set-cookie</code>.</p>\n"}, {"tags": ["go", "revel"], "answers": [{"comments": [{"owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "edited": false, "score": 0, "creation_date": 1437038656, "post_id": 31450112, "comment_id": 50868279, "body": "Is it possible to use a syntax like /public/&lt;resourceVersion&gt;/css instead of the query parameter?"}, {"owner": {"reputation": 1101, "user_id": 757102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60bb12c55b318f541cb55c7eeb6bec8f?s=128&d=identicon&r=PG", "display_name": "Colin Nicholson", "link": "https://stackoverflow.com/users/757102/colin-nicholson"}, "reply_to_user": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "edited": false, "score": 0, "creation_date": 1437038737, "post_id": 31450112, "comment_id": 50868322, "body": "Yes, that works fine - just change the template to whatever format you want.  <i>/public/{{.resourceVersion}}/css/style.css</i>"}, {"owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "edited": false, "score": 0, "creation_date": 1437039529, "post_id": 31450112, "comment_id": 50868851, "body": "It works but how would I go about making the content serve on that route? preferably without changing folder names. Sorry for all the though questions Im quite new to revel and go aswell."}, {"owner": {"reputation": 1101, "user_id": 757102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60bb12c55b318f541cb55c7eeb6bec8f?s=128&d=identicon&r=PG", "display_name": "Colin Nicholson", "link": "https://stackoverflow.com/users/757102/colin-nicholson"}, "reply_to_user": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "edited": false, "score": 0, "creation_date": 1437040668, "post_id": 31450112, "comment_id": 50869601, "body": "Sorry, you&#39;re right - that doesn&#39;t work. You could try adding a variable into your route - like <i>GET     /public/:version/*filepath              Static.Serve(&quot;public&quot;)</i>.   That seems to work, but seems to me like it might have issues with that variable part matching real paths, so you&#39;d need to be a bit careful."}, {"owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "edited": false, "score": 0, "creation_date": 1437041415, "post_id": 31450112, "comment_id": 50870101, "body": "I&#39;m trying to extend the Static controller at the moment with a new controller that strips the version part out and passes to the normal Static Controller but im having some problems with it."}, {"owner": {"reputation": 1101, "user_id": 757102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60bb12c55b318f541cb55c7eeb6bec8f?s=128&d=identicon&r=PG", "display_name": "Colin Nicholson", "link": "https://stackoverflow.com/users/757102/colin-nicholson"}, "reply_to_user": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "edited": false, "score": 0, "creation_date": 1437041866, "post_id": 31450112, "comment_id": 50870402, "body": "My first thought was to try and change the Static controller, but that seemed like it was changing too much. Should certainly be possible though, there isn&#39;t much code in it."}, {"owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "reply_to_user": {"reputation": 1101, "user_id": 757102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60bb12c55b318f541cb55c7eeb6bec8f?s=128&d=identicon&r=PG", "display_name": "Colin Nicholson", "link": "https://stackoverflow.com/users/757102/colin-nicholson"}, "edited": false, "score": 0, "creation_date": 1437041976, "post_id": 31450112, "comment_id": 50870475, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/83415/discussion-between-pablo-karlsson-and-colin-nicholson\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 1101, "user_id": 757102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60bb12c55b318f541cb55c7eeb6bec8f?s=128&d=identicon&r=PG", "display_name": "Colin Nicholson", "link": "https://stackoverflow.com/users/757102/colin-nicholson"}, "is_accepted": true, "score": 1, "last_activity_date": 1437038176, "creation_date": 1437038176, "answer_id": 31450112, "question_id": 31448099, "link": "https://stackoverflow.com/questions/31448099/cache-invalidation-in-revel-framework/31450112#31450112", "title": "Cache invalidation in revel framework", "body": "<p>You could do it manually via a config variable and an intercept method.</p>\n\n<h2>resourceversion.go</h2>\n\n<p>Create this file in your controllers folder:</p>\n\n<pre><code>package controllers\n\nimport (\n    \"github.com/revel/revel\"\n)\n\n// interceptor method, called before every request. \n// Sets a template variable to the resourceVersion read from app.conf\nfunc SetVersion(c *revel.Controller) revel.Result {\n    c.RenderArgs[\"resourceVersion\"] = revel.Config.StringDefault(\"resourceVersion\", \"1\")\n    return nil\n}\n</code></pre>\n\n<h2>init.go</h2>\n\n<p>In the init() method, append this line:</p>\n\n<pre><code>revel.InterceptMethod(controllers.SetVersion, revel.BEFORE)\n</code></pre>\n\n<h2>templates</h2>\n\n<p>In your templates, where you want to use the resource version:</p>\n\n<pre><code>&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"/public/css/style.css?{{.resourceVersion}}\"&gt;\n</code></pre>\n\n<h2>app.conf</h2>\n\n<p>And finally, the place you will update it - add this line above the dev section to apply to dev and prod, or have a different one in each, whatever suits.</p>\n\n<pre><code>resourceVersion=20150716\n</code></pre>\n\n<p>I guess you could create a script as part of your build and release process that would automatically edit this config variable.</p>\n"}, {"tags": [], "owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "is_accepted": false, "score": 0, "last_activity_date": 1437043905, "creation_date": 1437043905, "answer_id": 31452129, "question_id": 31448099, "link": "https://stackoverflow.com/questions/31448099/cache-invalidation-in-revel-framework/31452129#31452129", "title": "Cache invalidation in revel framework", "body": "<p>I did the things that Colin Nicholson suggested but I also created a controller called staticversionbasedcacheinvalidator and placed it in the controller folder. You can find it below. It allows you to ignore the first part of the request string allowing you to use a wildcard path to your public folder. For instance I use this route config row</p>\n\n<pre><code>GET     /public/*filepath                             StaticVersionbasedCacheInvalidator.Serve(\"public\")\n</code></pre>\n\n<p>I then added the {{.resourceVersion}} in my route instead of as a query param.</p>\n\n<pre><code>package controllers\n\nimport (\n    \"github.com/revel/revel\"\n    \"os\"\n    fpath \"path/filepath\"\n    \"strings\"\n    \"syscall\"\n)\n\ntype StaticVersionbasedCacheInvalidator struct {\n    *revel.Controller\n}\n\n// This method handles requests for files. The supplied prefix may be absolute\n// or relative. If the prefix is relative it is assumed to be relative to the\n// application directory. The filepath may either be just a file or an\n// additional filepath to search for the given file. This response may return\n// the following responses in the event of an error or invalid request;\n//   403(Forbidden): If the prefix filepath combination results in a directory.\n//   404(Not found): If the prefix and filepath combination results in a non-existent file.\n//   500(Internal Server Error): There are a few edge cases that would likely indicate some configuration error outside of revel.\n//\n// Note that when defining routes in routes/conf the parameters must not have\n// spaces around the comma.\n//   Bad:  StaticVersionbasedCacheInvalidator.Serve(\"public/img\", \"favicon.png\")\n//   Good: StaticVersionbasedCacheInvalidator.Serve(\"public/img\",\"favicon.png\")\n//\n// Examples:\n// Serving a directory\n//   Route (conf/routes):\n//     GET /public/{&lt;.*&gt;filepath} StaticVersionbasedCacheInvalidator.Serve(\"public\")\n//   Request:\n//     public/js/sessvars.js\n//   Calls\n//     StaticVersionbasedCacheInvalidator.Serve(\"public\",\"js/sessvars.js\")\n//\n// Serving a file\n//   Route (conf/routes):\n//     GET /favicon.ico StaticVersionbasedCacheInvalidator.Serve(\"public/img\",\"favicon.png\")\n//   Request:\n//     favicon.ico\n//   Calls:\n//     StaticVersionbasedCacheInvalidator.Serve(\"public/img\", \"favicon.png\")\nfunc (c StaticVersionbasedCacheInvalidator) Serve(prefix, filepath string) revel.Result {\n\n    firstSplice := strings.Index(filepath,\"/\")\n    if(firstSplice != -1) {\n            filepath = filepath[firstSplice:len(filepath)];\n    }\n\n    // Fix for #503.\n    prefix = c.Params.Fixed.Get(\"prefix\")\n    if prefix == \"\" {\n        return c.NotFound(\"\")\n    }\n\n    return serve(c, prefix, filepath)\n}\n\n// This method allows modules to serve binary files. The parameters are the same\n// as StaticVersionbasedCacheInvalidator.Serve with the additional module name pre-pended to the list of\n// arguments.\nfunc (c StaticVersionbasedCacheInvalidator) ServeModule(moduleName, prefix, filepath string) revel.Result {\n    // Fix for #503.\n    prefix = c.Params.Fixed.Get(\"prefix\")\n    if prefix == \"\" {\n        return c.NotFound(\"\")\n    }\n\n    var basePath string\n    for _, module := range revel.Modules {\n        if module.Name == moduleName {\n            basePath = module.Path\n        }\n    }\n\n    absPath := fpath.Join(basePath, fpath.FromSlash(prefix))\n\n    return serve(c, absPath, filepath)\n}\n\n\n// This method allows StaticVersionbasedCacheInvalidator serving of application files in a verified manner.\nfunc serve(c StaticVersionbasedCacheInvalidator, prefix, filepath string) revel.Result {\n    var basePath string\n    if !fpath.IsAbs(prefix) {\n        basePath = revel.BasePath\n    }\n\n    basePathPrefix := fpath.Join(basePath, fpath.FromSlash(prefix))\n    fname := fpath.Join(basePathPrefix, fpath.FromSlash(filepath))\n    // Verify the request file path is within the application's scope of access\n    if !strings.HasPrefix(fname, basePathPrefix) {\n        revel.WARN.Printf(\"Attempted to read file outside of base path: %s\", fname)\n        return c.NotFound(\"\")\n    }\n\n    // Verify file path is accessible\n    finfo, err := os.Stat(fname)\n    if err != nil {\n        if os.IsNotExist(err) || err.(*os.PathError).Err == syscall.ENOTDIR {\n            revel.WARN.Printf(\"File not found (%s): %s \", fname, err)\n            return c.NotFound(\"File not found\")\n        }\n        revel.ERROR.Printf(\"Error trying to get fileinfo for '%s': %s\", fname, err)\n        return c.RenderError(err)\n    }\n\n    // Disallow directory listing\n    if finfo.Mode().IsDir() {\n        revel.WARN.Printf(\"Attempted directory listing of %s\", fname)\n        return c.Forbidden(\"Directory listing not allowed\")\n    }\n\n    // Open request file path\n    file, err := os.Open(fname)\n    if err != nil {\n        if os.IsNotExist(err) {\n            revel.WARN.Printf(\"File not found (%s): %s \", fname, err)\n            return c.NotFound(\"File not found\")\n        }\n        revel.ERROR.Printf(\"Error opening '%s': %s\", fname, err)\n        return c.RenderError(err)\n    }\n    return c.RenderFile(file, revel.Inline)\n}\n</code></pre>\n"}], "owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 0, "accepted_answer_id": 31450112, "answer_count": 2, "score": 1, "last_activity_date": 1437052279, "creation_date": 1437032262, "last_edit_date": 1437052279, "question_id": 31448099, "link": "https://stackoverflow.com/questions/31448099/cache-invalidation-in-revel-framework", "title": "Cache invalidation in revel framework", "body": "<p>I'm looking for a way to invalidate cached static content upon version change. Preferably using commit id to invalidate. Is there anyway to do this in revel framework ?</p>\n\n<p>I would prefer if its automatic but I could live with updating it each time if its a single place I have to edit.</p>\n\n<p>The current strategy I have is changing the name of the static content route to include version but this requires several changes. In places that feel unnatural, for instance in the routing file.</p>\n"}]