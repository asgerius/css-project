[{"tags": ["json", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491428307, "post_id": 43242001, "comment_id": 73554305, "body": "Why not return a <code>*json.UnmarshalTypeError</code>?"}, {"owner": {"reputation": 45, "user_id": 7691972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/daf473b5857c17bba65791a1eaadbb10?s=128&d=identicon&r=PG&f=1", "display_name": "abc", "link": "https://stackoverflow.com/users/7691972/abc"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491430227, "post_id": 43242001, "comment_id": 73555064, "body": "@JimB That works, thank you!  I would accept this as the answer if I could.   Here&#39;s an updated example: <a href=\"https://play.golang.org/p/SXCHEkEp0Z\" rel=\"nofollow noreferrer\">play.golang.org/p/SXCHEkEp0Z</a>"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1491432795, "creation_date": 1491432795, "answer_id": 43242930, "question_id": 43242001, "link": "https://stackoverflow.com/questions/43242001/error-returned-from-custom-json-umarshaller-lacks-context/43242930#43242930", "title": "Error returned from custom json Umarshaller lacks context", "body": "<p><a href=\"https://golang.org/pkg/encoding/json/#UnmarshalTypeError\" rel=\"nofollow noreferrer\"><code>json.UnmarshalTypeError</code></a> is exported, as are all of its fields. There's no reason you can't return this error type from your custom marshalers. In fact, I'd venture this is an <em>intended use</em> of this type!</p>\n\n<pre><code>func (third *Second) UnmarshalJSON(data []byte) error {\n    return &amp;json.UnmarshalTypeError{\n        // ...\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 7691972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/daf473b5857c17bba65791a1eaadbb10?s=128&d=identicon&r=PG&f=1", "display_name": "abc", "link": "https://stackoverflow.com/users/7691972/abc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 43242930, "answer_count": 1, "score": 1, "last_activity_date": 1491432795, "creation_date": 1491427936, "question_id": 43242001, "link": "https://stackoverflow.com/questions/43242001/error-returned-from-custom-json-umarshaller-lacks-context", "title": "Error returned from custom json Umarshaller lacks context", "body": "<p>I am writing a function that parses a JSON object.  I would like to emit structured error messages that indicate which specific fields have errors in them.</p>\n\n<p>Originally I checked if the error type was <code>*json.UnmarshalTypeError</code> and then retrieved the json tag name from its <code>Field</code> property.  Unfortunately this fails if the struct to which I'm unmarshalling the JSON has custom types that implement their own <code>UnmarshalJSON</code> functions.  The errors they return are my custom errors and there is no way to determine which field from the struct they came from.</p>\n\n<p>Playground contrasting the built in vs custom error: <a href=\"https://play.golang.org/p/auH3PE7j5H\" rel=\"nofollow noreferrer\">https://play.golang.org/p/auH3PE7j5H</a></p>\n\n<p>At this point I'm considering changing to using reflection, unmarshalling the object into a map of <code>json.RawMessage</code> initially and then unmarshalling one field at a time so that I can identify the problematic field(s).  Is there any simpler way?  This will require me to basically duplicate the internal json package logic to analyze the json tags to figure out which field to unmarshal each raw message into.</p>\n"}, {"tags": ["unit-testing", "testing", "go", "mocking"], "answers": [{"tags": [], "owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "is_accepted": true, "score": 46, "last_activity_date": 1491426174, "last_edit_date": 1491426174, "creation_date": 1491425115, "answer_id": 43241303, "question_id": 43240970, "link": "https://stackoverflow.com/questions/43240970/how-to-mock-http-client-do-method/43241303#43241303", "title": "How to mock http.Client Do method", "body": "<p>Any struct with a method matching the signature you have in your interface will implement the interface. For example, you could create a struct <code>ClientMock</code></p>\n\n<pre><code>type ClientMock struct {\n}\n</code></pre>\n\n<p>with the method</p>\n\n<pre><code>func (c *ClientMock) Do(req *http.Request) (*http.Response, error) {\n    return &amp;http.Response{}, nil\n}\n</code></pre>\n\n<p>You could then inject this <code>ClientMock</code> struct into your <code>GetOverview</code> func. <a href=\"https://play.golang.org/p/fWwW1ZMRvi\" rel=\"noreferrer\">Here</a>'s an example in the Go Playground.</p>\n"}, {"comments": [{"owner": {"reputation": 201, "user_id": 1154507, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/18cfde828744c1b45a41aa170f594af1?s=128&d=identicon&r=PG", "display_name": "rajk", "link": "https://stackoverflow.com/users/1154507/rajk"}, "edited": false, "score": 0, "creation_date": 1549268026, "post_id": 43245191, "comment_id": 95827572, "body": "How can I verify multiple scenarios with this approach? Let&#39;s say I want to test multiple return codes and errors."}, {"owner": {"reputation": 254, "user_id": 4256881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bbee7374e65b3220ef2785cae0b552b?s=128&d=identicon&r=PG&f=1", "display_name": "mwarzynski", "link": "https://stackoverflow.com/users/4256881/mwarzynski"}, "reply_to_user": {"reputation": 201, "user_id": 1154507, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/18cfde828744c1b45a41aa170f594af1?s=128&d=identicon&r=PG", "display_name": "rajk", "link": "https://stackoverflow.com/users/1154507/rajk"}, "edited": false, "score": 0, "creation_date": 1557267485, "post_id": 43245191, "comment_id": 98705752, "body": "@rajk You may overwrite the <code>DoFunc</code> method to behave differently. Notice that you shouldn&#39;t run tests in parallel with this approach."}], "tags": [], "owner": {"reputation": 254, "user_id": 4256881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bbee7374e65b3220ef2785cae0b552b?s=128&d=identicon&r=PG&f=1", "display_name": "mwarzynski", "link": "https://stackoverflow.com/users/4256881/mwarzynski"}, "is_accepted": false, "score": 5, "last_activity_date": 1491449505, "creation_date": 1491449505, "answer_id": 43245191, "question_id": 43240970, "link": "https://stackoverflow.com/questions/43240970/how-to-mock-http-client-do-method/43245191#43245191", "title": "How to mock http.Client Do method", "body": "<p>You have to create a struct with methods that match interface. Mocks are commonly used for testing purposes, therefore people want the ability to prepare return values of mock methods. To achieve this, we create struct with <em>func attributes</em> corresponding to methods.</p>\n\n<p>As your interface is:</p>\n\n<pre><code>type HttpClient interface {\n    Do(req *http.Request) (*http.Response, error)\n}\n</code></pre>\n\n<p>Equivalent mock:</p>\n\n<pre><code>type MockClient struct {\n    DoFunc func(req *http.Request) (*http.Response, error)\n}\n\nfunc (m *MockClient) Do(req *http.Request) (*http.Response, error) {\n    if m.DoFunc != nil {\n        return m.DoFunc(req)\n    }\n    return &amp;http.Response{}, nil\n}\n</code></pre>\n\n<p>Then, next step is to write some tests. Example <a href=\"https://play.golang.org/p/l9HJQW37bi\" rel=\"noreferrer\">here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 50853, "user_id": 181087, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85700c2c160866ef6924fc491a3ce574?s=128&d=identicon&r=PG", "display_name": "NightOwl888", "link": "https://stackoverflow.com/users/181087/nightowl888"}, "edited": false, "score": 4, "creation_date": 1524763262, "post_id": 50048406, "comment_id": 87113611, "body": "While adding links to references is a good idea, it is important that there is enough context in the answer so it can stand on its own if the links go dead in the future. Adding a code example or two would surely help with that and prevent your answer from being deleted during review."}], "tags": [], "owner": {"reputation": 31, "user_id": 4351347, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EthrageVZDw/AAAAAAAAAAI/AAAAAAAAA8A/aDCk1rqI6wo/photo.jpg?sz=128", "display_name": "Dan", "link": "https://stackoverflow.com/users/4351347/dan"}, "is_accepted": false, "score": 3, "last_activity_date": 1524761852, "creation_date": 1524761852, "answer_id": 50048406, "question_id": 43240970, "link": "https://stackoverflow.com/questions/43240970/how-to-mock-http-client-do-method/50048406#50048406", "title": "How to mock http.Client Do method", "body": "<p>I know it's been a little while but I just wrote something to help with this recently.</p>\n\n<p>Generally to mock HTTP requests I recommend starting up a real HTTP server locally, since in Go this is easy to do. <a href=\"https://golang.org/pkg/net/http/httptest/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/httptest/</a> is a pretty standard way to do that (see the example code given under the Server type).</p>\n\n<p>However having done a lot of HTTP mocking I wanted something that does a little more, like a good mock library would: easy setting of expectations, validation that all requests were made, etc. I have generally used <a href=\"https://godoc.org/github.com/stretchr/testify/mock\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/stretchr/testify/mock</a> for mocking and wanted features like that.</p>\n\n<p>So I wrote <a href=\"https://github.com/dankinder/httpmock\" rel=\"nofollow noreferrer\">https://github.com/dankinder/httpmock</a>, which basically combines the two.</p>\n"}, {"comments": [{"owner": {"reputation": 331, "user_id": 3757059, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/7670aea2a59f111b892d45d9cf6c84fd?s=128&d=identicon&r=PG&f=1", "display_name": "ldanilek", "link": "https://stackoverflow.com/users/3757059/ldanilek"}, "edited": false, "score": 2, "creation_date": 1537380523, "post_id": 51227660, "comment_id": 91767364, "body": "I don&#39;t see how this could be used to confirm that a function calls <code>http.DefaultClient.Do</code> with a specific external URL. Is that possible?"}, {"owner": {"reputation": 3131, "user_id": 4318281, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/TFbTV.png?s=128&g=1", "display_name": "rocketspacer", "link": "https://stackoverflow.com/users/4318281/rocketspacer"}, "reply_to_user": {"reputation": 331, "user_id": 3757059, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/7670aea2a59f111b892d45d9cf6c84fd?s=128&d=identicon&r=PG&f=1", "display_name": "ldanilek", "link": "https://stackoverflow.com/users/3757059/ldanilek"}, "edited": false, "score": 0, "creation_date": 1538566204, "post_id": 51227660, "comment_id": 92185313, "body": "No, you can&#39;t. In that case, you need to create a wrapping INTERFACE and do mocking on top. I often use this <a href=\"https://github.com/vektra/mockery\" rel=\"nofollow noreferrer\">github.com/vektra/mockery</a>"}, {"owner": {"reputation": 2368, "user_id": 1255828, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fz5qi.jpg?s=128&g=1", "display_name": "aqn", "link": "https://stackoverflow.com/users/1255828/aqn"}, "edited": false, "score": 0, "creation_date": 1556199140, "post_id": 51227660, "comment_id": 98362894, "body": "@rocketspacer: I am having issues with <code>httpmock</code> causing &quot;data race&quot; conditions when used to run tests via ginkgo which parallelizes tests and also when the code includes multiple goroutines.  Is using <code>http.DefaultClient</code> thread safe?  Thank you!"}, {"owner": {"reputation": 3131, "user_id": 4318281, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/TFbTV.png?s=128&g=1", "display_name": "rocketspacer", "link": "https://stackoverflow.com/users/4318281/rocketspacer"}, "edited": false, "score": 0, "creation_date": 1576053588, "post_id": 51227660, "comment_id": 104769587, "body": "According to Go documentation <code>http.Client</code> is concurrently-safe <a href=\"https://golang.org/pkg/net/http/#Client\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Client</a>"}], "tags": [], "owner": {"reputation": 3131, "user_id": 4318281, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/TFbTV.png?s=128&g=1", "display_name": "rocketspacer", "link": "https://stackoverflow.com/users/4318281/rocketspacer"}, "is_accepted": false, "score": 30, "last_activity_date": 1531005729, "creation_date": 1531005729, "answer_id": 51227660, "question_id": 43240970, "link": "https://stackoverflow.com/questions/43240970/how-to-mock-http-client-do-method/51227660#51227660", "title": "How to mock http.Client Do method", "body": "<p>The <a href=\"https://golang.org/pkg/net/http/httptest/\" rel=\"noreferrer\"><code>net/http/httptest</code></a> package is your best friend:</p>\n\n<pre><code>// generate a test server so we can capture and inspect the request\ntestServer := httptest.NewServer(http.HandlerFunc(func(res http.ResponseWriter, req *http.Request) {\n    res.WriteHeader(scenario.expectedRespStatus)\n    res.Write([]byte(\"body\"))\n}))\ndefer func() { testServer.Close() }()\n\nreq, err := http.NewRequest(http.MethodGet, testServer.URL, nil)\nassert.NoError(t, err)\n\nres, err := http.DefaultClient.Do(req)\nassert.NoError(t, err)\nassert.Equal(t, scenario.expectedRespStatus, res.StatusCode, \"status code should match the expected response\")\n</code></pre>\n"}], "owner": {"reputation": 702, "user_id": 2924810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cd3ca43f8677ce430f0b837ef2bcff9?s=128&d=identicon&r=PG&f=1", "display_name": "quentino", "link": "https://stackoverflow.com/users/2924810/quentino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43919, "favorite_count": 6, "accepted_answer_id": 43241303, "answer_count": 4, "score": 41, "last_activity_date": 1563770978, "creation_date": 1491423880, "question_id": 43240970, "link": "https://stackoverflow.com/questions/43240970/how-to-mock-http-client-do-method", "title": "How to mock http.Client Do method", "body": "<p>I'm trying to find a solution to write test and mock HTTP response.\nIn my function where I accept interface:</p>\n\n<pre><code>type HttpClient interface {\n    Do(req *http.Request) (*http.Response, error)\n}\n</code></pre>\n\n<p>I makes http get request with base auth</p>\n\n<pre><code>func GetOverview(client HttpClient, overview *Overview) (*Overview, error) {\n\n    request, err := http.NewRequest(\"GET\", fmt.Sprintf(\"%s:%s/api/overview\", overview.Config.Url, overview.Config.Port), nil)\n    if (err != nil) {\n        log.Println(err)\n    }\n    request.SetBasicAuth(overview.Config.User, overview.Config.Password)\n    resp, err := client.Do(request)\n</code></pre>\n\n<p>How can I mock this HttpClient?\nI'm looking for mock library, for instance: <a href=\"https://github.com/h2non/gock\" rel=\"noreferrer\">https://github.com/h2non/gock</a>\nbut there is only mock for Get and Post</p>\n\n<p>Maybe I should do it in a different way.\nI'll be grateful for advice</p>\n"}, {"tags": ["go", "reflection", "types", "interface"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1491409535, "post_id": 43236589, "comment_id": 73543546, "body": "Why are you creating an instance with <code>reflect</code> then immediately overwriting the variable that contains it?"}, {"owner": {"reputation": 2971, "user_id": 496351, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/ce4ddeab530fecaf1270a1bf5cccea90?s=128&d=identicon&r=PG", "display_name": "Tristian", "link": "https://stackoverflow.com/users/496351/tristian"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491409844, "post_id": 43236589, "comment_id": 73543738, "body": "To copy the values, of the <code>base</code> variable."}, {"owner": {"reputation": 2971, "user_id": 496351, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/ce4ddeab530fecaf1270a1bf5cccea90?s=128&d=identicon&r=PG", "display_name": "Tristian", "link": "https://stackoverflow.com/users/496351/tristian"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491410041, "post_id": 43236589, "comment_id": 73543850, "body": "Or at least experimenting with copying it, <code>reflect.New()</code> returns a zeroed pointer, and I&#39;ve haven&#39;t found a way to unzero it. I know that currently it will modify the <code>base</code> var"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1491410108, "post_id": 43236589, "comment_id": 73543892, "body": "But you already have the <code>base</code> variable.... all you are doing is creating a new pointer that points to the same data. Is that what you are trying to accomplish?"}, {"owner": {"reputation": 2971, "user_id": 496351, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/ce4ddeab530fecaf1270a1bf5cccea90?s=128&d=identicon&r=PG", "display_name": "Tristian", "link": "https://stackoverflow.com/users/496351/tristian"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491410302, "post_id": 43236589, "comment_id": 73544009, "body": "Yes, I need to copy the <code>base</code> variable values into the <code>aliased</code> one, the intent there is to do something like this <code>*dest = *src</code>, <code>dest</code> and <code>src</code> same type but different pointers., trying to figure out how that would be done without explicitly using each of <code>base</code>&#39;s and with the <code>reflect</code> package"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1491410675, "post_id": 43236589, "comment_id": 73544234, "body": "I also can&#39;t figure out what exactly you&#39;re trying to accomplish, but does this get you closer? <a href=\"https://play.golang.org/p/n-G5YwYkaH\" rel=\"nofollow noreferrer\">play.golang.org/p/n-G5YwYkaH</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1491410921, "post_id": 43236589, "comment_id": 73544384, "body": "I can&#39;t quite figure out either, but in the code I c/p and modified, I get similar output, but <code>missing method A</code>. <a href=\"https://play.golang.org/p/860uAE7qLc\" rel=\"nofollow noreferrer\">play.golang.org/p/860uAE7qLc</a>"}, {"owner": {"reputation": 2971, "user_id": 496351, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/ce4ddeab530fecaf1270a1bf5cccea90?s=128&d=identicon&r=PG", "display_name": "Tristian", "link": "https://stackoverflow.com/users/496351/tristian"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491412299, "post_id": 43236589, "comment_id": 73545162, "body": "@JimB It helps me replicate the issue faster: <a href=\"https://play.golang.org/p/OsFrEKP-eo\" rel=\"nofollow noreferrer\">play.golang.org/p/OsFrEKP-eo</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1491412665, "post_id": 43236589, "comment_id": 73545387, "body": "Updated @RayfenWindspear&#39;s link, <a href=\"https://play.golang.org/p/h1cl4FNUGY\" rel=\"nofollow noreferrer\">play.golang.org/p/h1cl4FNUGY</a>, is this what you want?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1491413149, "post_id": 43236589, "comment_id": 73545686, "body": "@mkopriva I added a test to modify the values to your link. The pointers do indeed point to different values. I&#39;d say you are spot on."}, {"owner": {"reputation": 2971, "user_id": 496351, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/ce4ddeab530fecaf1270a1bf5cccea90?s=128&d=identicon&r=PG", "display_name": "Tristian", "link": "https://stackoverflow.com/users/496351/tristian"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491417035, "post_id": 43236589, "comment_id": 73548084, "body": "thanks!, @mkopriva it definitely is closer however the <code>base.M</code> field is changed to <code>destID</code>, see: <a href=\"https://play.golang.org/p/DzQOnjYW2X\" rel=\"nofollow noreferrer\">play.golang.org/p/DzQOnjYW2X</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491417310, "post_id": 43236589, "comment_id": 73548241, "body": "and you want it to be what? What do you expect the output to be? an existing pointer? which one? and pointing to what value? Or a new pointer? pointing to what value?"}], "answers": [{"comments": [{"owner": {"reputation": 2971, "user_id": 496351, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/ce4ddeab530fecaf1270a1bf5cccea90?s=128&d=identicon&r=PG", "display_name": "Tristian", "link": "https://stackoverflow.com/users/496351/tristian"}, "edited": false, "score": 0, "creation_date": 1491423528, "post_id": 43240495, "comment_id": 73551890, "body": "that is the solution, it is indeed traversing the fields of <code>B</code> and copying one by one. I did a small change which is to set the <code>M</code> field to <code>dest</code> and it works, I&#39;ll just add the &quot;deep&quot; copy because <code>B</code> will have subfields that are pointers."}, {"owner": {"reputation": 2971, "user_id": 496351, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/ce4ddeab530fecaf1270a1bf5cccea90?s=128&d=identicon&r=PG", "display_name": "Tristian", "link": "https://stackoverflow.com/users/496351/tristian"}, "edited": false, "score": 0, "creation_date": 1491423670, "post_id": 43240495, "comment_id": 73551969, "body": "I appreciated the time you put into it!!"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 2971, "user_id": 496351, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/ce4ddeab530fecaf1270a1bf5cccea90?s=128&d=identicon&r=PG", "display_name": "Tristian", "link": "https://stackoverflow.com/users/496351/tristian"}, "edited": false, "score": 0, "creation_date": 1491424197, "post_id": 43240495, "comment_id": 73552241, "body": "I&#39;m glad I could be of help!"}, {"owner": {"reputation": 2971, "user_id": 496351, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/ce4ddeab530fecaf1270a1bf5cccea90?s=128&d=identicon&r=PG", "display_name": "Tristian", "link": "https://stackoverflow.com/users/496351/tristian"}, "edited": false, "score": 0, "creation_date": 1491425669, "post_id": 43240495, "comment_id": 73553037, "body": "Just as I note, I found a package that performs deep copy: <a href=\"https://github.com/ulule/deepcopier\" rel=\"nofollow noreferrer\">github.com/ulule/deepcopier</a>"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1491422207, "creation_date": 1491422207, "answer_id": 43240495, "question_id": 43236589, "link": "https://stackoverflow.com/questions/43236589/how-can-i-convert-struct-value-into-struct-pointer-using-reflection/43240495#43240495", "title": "How can I convert struct value into struct pointer using reflection", "body": "<p>Not sure if this is what you want, but if I understood you correctly, in your updated example from the comments the returned <code>base</code> is what you want to copy, modify, and then return the copy of, without changing anything in <code>base</code>. If that's the case, this code <code>aliased = base</code> is not gonna do what you want if the base's underlying type is a pointer, which is true in this case.</p>\n\n<p>Note, I've modified the var names to better <code>reflect</code> your assignment.</p>\n\n<pre><code>// Having a variable B that satisfies a specific\n// interface I through pointer receivers type.\nB, err := find(src)\nif err != nil {\n    return nil, err\n}\n\n// create another variable C (with reflection and using B),\nC := reflect.New(reflect.TypeOf(B).Elem())\n\n// copy B's values into C\nbv := reflect.ValueOf(B).Elem()\nfor i :=0; i &lt; bv.NumField(); i++ {\n    fv := bv.Field(i)\n    if fv.Kind() == reflect.Ptr {\n        v := reflect.New(fv.Elem().Type()) // allocate a new pointer of the same type as the B's pointer field is pointing to, in this case 'Meta'\n        v.Elem().Set(fv.Elem()) // set the newly allocated pointer's value to the same value as B's pointer field is pointing to, in this case 'Meta{S: \"SRC\"}'\n        C.Elem().Field(i).Set(v) // set the newly allocated pointer as the C's field\n    } else {\n        C.Elem().Field(i).Set(fv) // non pointer field? just set and that's it\n    }\n    // NOTE: if B's field's have subfields that are pointers you'll have to do this for all of them if you want a deep copy\n}\n\n// modify C (without changing B)\nC.Elem().FieldByName(\"M\").Elem().FieldByName(\"S\").Set(reflect.ValueOf(\"Hello, \u4e16\u754c\"))\n</code></pre>\n\n<p>Here's the playground: <a href=\"https://play.golang.org/p/bGTdy2vYUu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bGTdy2vYUu</a></p>\n\n<p>Sorry if this not what you're looking for.</p>\n"}], "owner": {"reputation": 2971, "user_id": 496351, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/ce4ddeab530fecaf1270a1bf5cccea90?s=128&d=identicon&r=PG", "display_name": "Tristian", "link": "https://stackoverflow.com/users/496351/tristian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 846, "favorite_count": 1, "accepted_answer_id": 43240495, "answer_count": 1, "score": 1, "last_activity_date": 1507483748, "creation_date": 1491409127, "last_edit_date": 1507483748, "question_id": 43236589, "link": "https://stackoverflow.com/questions/43236589/how-can-i-convert-struct-value-into-struct-pointer-using-reflection", "title": "How can I convert struct value into struct pointer using reflection", "body": "<p>The goal is </p>\n\n<blockquote>\n  <p>Having a variable <code>B</code> that satisfies a specific interface <code>I</code> through pointer receivers type, create another variable <code>C</code> (with reflection and using <code>B</code>), copy <code>B</code>'s values into <code>C</code>,  modify <code>C</code> (without changing <code>B</code>) and return <code>C</code> as type <code>I</code>.</p>\n</blockquote>\n\n<p>Suppose that I have the following types, the following snippets mimic production code:</p>\n\n<pre><code>import (\n    \"reflect\"\n)\n\ntype IFace interface {\n    A() \n    B()\n    C()\n}\n\ntype Meta struct {\n    s string\n}\n\nfunc (m *Meta) A() {}\nfunc (m *Meta) B() {}\nfunc (m *Meta) C() {}\n\ntype One struct {\n    M *Meta\n    B bool\n}\n\nfunc (o *One) A() {}\nfunc (o *One) B() {}\nfunc (o *One) C() {}\n</code></pre>\n\n<p>And I have a method that does the following:</p>\n\n<pre><code>func Alias(src, dest *Meta) (IFace, error) {\n    base, err := find(src) //asume that `find` is implemented and err is nil\n    if err != nil { \n       return err\n    }\n\n    // trouble starts here ...\n    // allocate new \"instance\"\n    aliased := reflect.New(reflect.TypeOf(base)).Elem().Interface()\n\n    // copy the base value\n    aliased = base \n\n    aliasedV := reflect.ValueOf(aliased).Elem()\n    fm := aliasedV.FieldByName(\"M\")\n    fm.Set(reflect.ValueOf(dest))\n\n    return aliasedV.Interface().(Iface), nil\n}\n</code></pre>\n\n<p>It compiles and runs however with the following TestFunction it gives me this error message:</p>\n\n<pre><code>interface conversion: One is not IFace: missing method C [recovered]\n    panic: interface conversion: One is not IFace: missing method C\n</code></pre>\n\n<p>and the test function: </p>\n\n<pre><code>func TestOne(t *testing.T) {\n   srcID := &amp;Meta{S: \"SRC\"}\n   destID := &amp;Meta{S: \"DEST\"}\n   aliased, err := Alias(srcID, destID)\n   if err != nil {\n       t.Error(err)\n   }\n\n   one, isOne := aliased.(*One)\n   if !isOne {\n       t.Error(\"fail\")\n   }\n}\n</code></pre>\n\n<p>Is there a way to have an <code>interface{}</code> type that wraps a struct value become an <code>interface{}</code> type that wraps a struct pointer without using the underlying struct type directly, like avoiding: <code>var any interface{} = aliased.(*One)</code>\n??, </p>\n\n<p>Could the <code>unsafe</code> package be of help here?</p>\n\n<p>Here is a playground that replicates the panic, thanks to <a href=\"https://stackoverflow.com/users/1276480/rayfenwindspear\">RayfenWindspear</a></p>\n\n<p><a href=\"https://play.golang.org/p/860uAE7qLc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/860uAE7qLc</a></p>\n"}, {"tags": ["go", "vim"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7821698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fbef1b0873ebf771924260abba2786?s=128&d=identicon&r=PG&f=1", "display_name": "ron-acad", "link": "https://stackoverflow.com/users/7821698/ron-acad"}, "edited": false, "score": 0, "creation_date": 1491511077, "post_id": 43243304, "comment_id": 73599153, "body": "Is <code>GoImplements</code> supposed to run when I place my cursor on the function call? When I do that, it gives me <code>vim-go: guru: no initial packages were loaded^@</code>"}, {"owner": {"reputation": 2144, "user_id": 9760, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ixxpj.jpg?s=128&g=1", "display_name": "Daniel Waechter", "link": "https://stackoverflow.com/users/9760/daniel-waechter"}, "reply_to_user": {"reputation": 11, "user_id": 7821698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fbef1b0873ebf771924260abba2786?s=128&d=identicon&r=PG&f=1", "display_name": "ron-acad", "link": "https://stackoverflow.com/users/7821698/ron-acad"}, "edited": false, "score": 0, "creation_date": 1491516614, "post_id": 43243304, "comment_id": 73601727, "body": "Yes, it should work that way. Is your GOPATH set up right?"}, {"owner": {"reputation": 2144, "user_id": 9760, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ixxpj.jpg?s=128&g=1", "display_name": "Daniel Waechter", "link": "https://stackoverflow.com/users/9760/daniel-waechter"}, "reply_to_user": {"reputation": 11, "user_id": 7821698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fbef1b0873ebf771924260abba2786?s=128&d=identicon&r=PG&f=1", "display_name": "ron-acad", "link": "https://stackoverflow.com/users/7821698/ron-acad"}, "edited": false, "score": 0, "creation_date": 1491516705, "post_id": 43243304, "comment_id": 73601764, "body": "See this vim-go issue for someone with a related problem: <a href=\"https://github.com/fatih/vim-go/issues/1037\" rel=\"nofollow noreferrer\">github.com/fatih/vim-go/issues/1037</a>"}], "tags": [], "owner": {"reputation": 2144, "user_id": 9760, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ixxpj.jpg?s=128&g=1", "display_name": "Daniel Waechter", "link": "https://stackoverflow.com/users/9760/daniel-waechter"}, "is_accepted": false, "score": 0, "last_activity_date": 1491435335, "creation_date": 1491435335, "answer_id": 43243304, "question_id": 43235910, "link": "https://stackoverflow.com/questions/43235910/vim-go-search-for-function-specification-rather-than-the-declaration/43243304#43243304", "title": "vim-go: search for function specification rather than the declaration", "body": "<p>If <code>:GoDef</code> (which by default is mapped to <code>gd</code> and <code>CTRL-]</code>) doesn't work because it is a function in an interface, you can use <code>:GoImplements</code> to find implementations of that function. See the <a href=\"https://github.com/fatih/vim-go-tutorial#guru\" rel=\"nofollow noreferrer\">vim-go tutorial</a> for more.</p>\n"}], "owner": {"reputation": 11, "user_id": 7821698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6fbef1b0873ebf771924260abba2786?s=128&d=identicon&r=PG&f=1", "display_name": "ron-acad", "link": "https://stackoverflow.com/users/7821698/ron-acad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 961, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1491435335, "creation_date": 1491407143, "last_edit_date": 1491408675, "question_id": 43235910, "link": "https://stackoverflow.com/questions/43235910/vim-go-search-for-function-specification-rather-than-the-declaration", "title": "vim-go: search for function specification rather than the declaration", "body": "<p>I have installed vim-go, and use ctrl+] to go to the definition. For a function, Sometimes it ends up in the interface declaration (if it was declared in an interface), but what I really intended to do was to go to function definition/specification. How can go to actual function definition? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1491406551, "post_id": 43235647, "comment_id": 73541458, "body": "Yep, bitwise logic FTW :)"}], "tags": [], "owner": {"reputation": 9723, "user_id": 112936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcc21b0d91b22e3ece4d75d8d1ca87ce?s=128&d=identicon&r=PG", "display_name": "Pavel Morshenyuk", "link": "https://stackoverflow.com/users/112936/pavel-morshenyuk"}, "is_accepted": true, "score": 4, "last_activity_date": 1491406379, "creation_date": 1491406379, "answer_id": 43235647, "question_id": 43235199, "link": "https://stackoverflow.com/questions/43235199/turn-multiple-bool-values-from-html-form-into-a-string-go/43235647#43235647", "title": "Turn multiple bool values (from HTML form) into a string (Go)", "body": "<p>I think you should look into the <a href=\"https://en.wikipedia.org/wiki/Bitwise_operation\" rel=\"nofollow noreferrer\">bitwise</a> operations topic. There is no need to keep an array, your four operations can be represented as integers instead:</p>\n\n<pre><code>create = 1 (0001 in binary representation)\nview   = 2 (0010 in binary representation)\nedit   = 4 (0100 in binary representation)\ndelete = 8 (1000 in binary representation)\n</code></pre>\n\n<p>In order get all selected rights you can use <code>bitwise OR</code> operation:</p>\n\n<pre><code>rights := 0\nrights |= 2\nrights |= 4\n// rights is 6 now, i.e. view and edit\n</code></pre>\n\n<p>Then when you need to check if specific right is enabled, you can use <code>bitwise AND</code> opration:</p>\n\n<pre><code>func hasPermission(rights int, item int) bool {\n    return (rights &amp; item) == item \n}\n</code></pre>\n\n<p>See my complete example: <a href=\"https://play.golang.org/p/UPZkqsrDS4\" rel=\"nofollow noreferrer\">https://play.golang.org/p/UPZkqsrDS4</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n\nfunc main() {\n    create := 1\n    view   := 2\n    edit   := 4\n    delete := 8\n\n    rights := 0\n    rights |= view\n    rights |= edit\n\n\n    fmt.Println(hasPermission(rights , create))\n    fmt.Println(hasPermission(rights , view))\n    fmt.Println(hasPermission(rights , edit))\n    fmt.Println(hasPermission(rights , delete))\n}\n\n\nfunc hasPermission(rights int, item int) bool {\n    return (rights &amp; item) == item \n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1491408116, "post_id": 43235723, "comment_id": 73542554, "body": "I think your answer did exactly what I asked, and I&#39;d like to accept it, but I know I will end up using Pavel&#39;s method for my implementation, so can sadly just upvote it.."}], "tags": [], "owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "is_accepted": false, "score": 2, "last_activity_date": 1491406974, "last_edit_date": 1491406974, "creation_date": 1491406570, "answer_id": 43235723, "question_id": 43235199, "link": "https://stackoverflow.com/questions/43235199/turn-multiple-bool-values-from-html-form-into-a-string-go/43235723#43235723", "title": "Turn multiple bool values (from HTML form) into a string (Go)", "body": "<p>Perhaps something like</p>\n\n<pre><code>keys := []string{\"create\", \"view\", \"edit\", \"delete\"}\nb := 0\nfor idx, key := range keys {\n    if len(r.Form[key]) != 0 {\n        b += 1 &lt;&lt; uint(idx)\n    }\n}\nfmt.Printf(\"%04b\", b)\n</code></pre>\n\n<p>use <code>s := fmt.Sprintf(\"%04b\", b)</code> to store the \"binari rights string\" into an string variable.</p>\n"}], "owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 43235647, "answer_count": 2, "score": 1, "last_activity_date": 1491406974, "creation_date": 1491405126, "question_id": 43235199, "link": "https://stackoverflow.com/questions/43235199/turn-multiple-bool-values-from-html-form-into-a-string-go", "title": "Turn multiple bool values (from HTML form) into a string (Go)", "body": "<p>I know the title is really bad, but not sure how to ask this question.. I have a HTML form with a select input returning multiple values, e.g.:</p>\n\n<pre><code>&lt;select name=\"rights\" multiple&gt;\n  &lt;option value=\"create\"&gt;create&lt;/option&gt;\n  &lt;option value=\"view\"&gt;view&lt;/option&gt;\n  &lt;option value=\"edit\"&gt;edit&lt;/option&gt;\n  &lt;option value=\"delete\"&gt;delete&lt;/option&gt;\n&lt;/select&gt;\n</code></pre>\n\n<p>I then have a function that can check which values the form contains:</p>\n\n<pre><code>func formContains(slice []string, item string) bool {\n    set := make(map[string]struct{}, len(slice))\n    for _, s := range slice {\n        set[s] = struct{}{}\n    }\n    _, ok := set[item]\n    return ok\n}\n</code></pre>\n\n<p>so I can call:</p>\n\n<pre><code>err := r.ParseForm()\n// err check\nrights := r.Form[\"rights\"]\nlog.Println(formContains(rights, \"create\"))\n</code></pre>\n\n<p>What I would like to do is to check which values the form contains, and then return a string, e.g., if the form contains the rights \"create\" and \"delete\" then it should return:\n\"1001\", if it contains the rights \"view\", \"edit\" and \"delete\" then it should return \"0111\".</p>\n\n<p>I would be able to achieve the desired result with a lot of if/else or switch statements, but I know there must be a smarter way.. I considered the possibility of creating an array that would end up looking like this: [0] [1] [0] [1] (in case the rights were \"view\" and \"delete\"), and then convert the array to a string.. but so far it's been unsuccessful..</p>\n"}, {"tags": ["http", "go", "cors"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491400960, "post_id": 43232463, "comment_id": 73536941, "body": "can you share a chrome devtools screenshot of the options request that is failing, request sent, response received?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1491490969, "post_id": 43232463, "comment_id": 73586444, "body": "CORS uses a probe request using the OPTIONS verb to check if cross-origin is allowed, before executing the actual request. You must allow OPTIONS and respond to it with a success code (2xx)."}], "answers": [{"tags": [], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "is_accepted": false, "score": 1, "last_activity_date": 1491404990, "creation_date": 1491404990, "answer_id": 43235143, "question_id": 43232463, "link": "https://stackoverflow.com/questions/43232463/cors-request-with-golang-backend-doesnt-works/43235143#43235143", "title": "CORS request with golang backend doesn&#39;t works", "body": "<p>I use Negroni as middleware and this code:</p>\n\n<pre><code>func main() {\n\n    c := cors.New(cors.Options{\n        AllowedOrigins: []string{\"*\"},\n        AllowedMethods: []string{\"POST\", \"GET\", \"OPTIONS\", \"PUT\", \"DELETE\"},\n        AllowedHeaders: []string{\"Accept\", \"content-type\", \"Content-Length\", \"Accept-Encoding\", \"X-CSRF-Token\", \"Authorization\"},\n    })\n\n    router := mux.NewRouter()\n    router = routers.SetAuthRoute(router)\n\n    apiRoutes := routers.InitRoutes()\n\n    router.PathPrefix(\"/api\").Handler(negroni.New(\n        negroni.HandlerFunc(controllers.ValidateTokenMiddleware),\n        negroni.Wrap(apiRoutes),\n    ))\n\n    server := negroni.Classic()\n    server.Use(c)\n    server.UseHandler(router)\n    server.Run(\"0.0.0.0:\" + os.Getenv(\"PORT\"))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 153, "user_id": 2291886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d94d277ece247295c9ca745b28c60067?s=128&d=identicon&r=PG", "display_name": "Gianfranco Reppucci", "link": "https://stackoverflow.com/users/2291886/gianfranco-reppucci"}, "is_accepted": true, "score": 5, "last_activity_date": 1491556128, "last_edit_date": 1495541866, "creation_date": 1491556128, "answer_id": 43274147, "question_id": 43232463, "link": "https://stackoverflow.com/questions/43232463/cors-request-with-golang-backend-doesnt-works/43274147#43274147", "title": "CORS request with golang backend doesn&#39;t works", "body": "<p>As <a href=\"https://stackoverflow.com/users/7426/adrian\">Adrian</a> pointed out, you need to add the <code>OPTIONS</code> Method to the <code>AllowedMethods</code> array.</p>\n\n<p>Please also consider to add <code>Accept</code>, <code>Accept-Language</code> and <code>Content-Type</code> to the <code>AllowedHeaders</code> as good practice.</p>\n\n<p>If you don't want to use the <code>github.com/rs/cors</code> package, you can write a simple CORS decorator middleware on your own like this:</p>\n\n<p><strong>CORS decorator</strong></p>\n\n<pre><code>import (\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\n// CORSRouterDecorator applies CORS headers to a mux.Router\ntype CORSRouterDecorator struct {\n    R *mux.Router\n}\n\n// ServeHTTP wraps the HTTP server enabling CORS headers.\n// For more info about CORS, visit https://www.w3.org/TR/cors/\nfunc (c *CORSRouterDecorator) ServeHTTP(rw http.ResponseWriter, req *http.Request) {\n    if origin := req.Header.Get(\"Origin\"); origin != \"\" {\n        rw.Header().Set(\"Access-Control-Allow-Origin\", origin)\n        rw.Header().Set(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, PUT, DELETE\")\n        rw.Header().Set(\"Access-Control-Allow-Headers\", \"Accept, Accept-Language, Content-Type, YourOwnHeader\")\n    }\n    // Stop here if its Preflighted OPTIONS request\n    if req.Method == \"OPTIONS\" {\n        return\n    }\n\n    c.R.ServeHTTP(rw, req)\n}\n</code></pre>\n\n<p><strong>HTTP server</strong></p>\n\n<pre><code>r := mux.NewRouter()\nr.Handle(\"/authentication\", handleAuthentication)\n\nhttp.Handle(\"/\", &amp;CORSRouterDecorator{r})\n</code></pre>\n\n<p>et voil\u00e0.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 1208921, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/447cb26831505b363ba0d42ec9d4f0ad?s=128&d=identicon&r=PG", "display_name": "myleftboot", "link": "https://stackoverflow.com/users/1208921/myleftboot"}, "is_accepted": false, "score": 1, "last_activity_date": 1535097657, "creation_date": 1535097657, "answer_id": 51999966, "question_id": 43232463, "link": "https://stackoverflow.com/questions/43232463/cors-request-with-golang-backend-doesnt-works/51999966#51999966", "title": "CORS request with golang backend doesn&#39;t works", "body": "<p>Similar to the other two responses, but I my case my project is hosted on cloud9 so I had a couple of tweaks to do.</p>\n\n<p>This is the code i added:</p>\n\n<pre><code>    cor := cors.New(cors.Options{\n        AllowedOrigins:   []string{\"https://*.c9users.io\", \"http://myapp.c9users.io:8080\", \"https://*.c9.io\"},\n        AllowedMethods:   []string{\"POST\", \"GET\", \"OPTIONS\", \"PUT\"},\n        AllowedHeaders:   []string{\"Accept\", \"Accept-Language\", \"Content-Type\"},\n        AllowCredentials: true,\n        Debug:            true,\n    });\n</code></pre>\n\n<p>I had to add the extra http origin as Safari makes the initial options request using http instead of https.</p>\n\n<p>Sorted.</p>\n"}], "owner": {"reputation": 82, "user_id": 7394755, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh5.googleusercontent.com/-CWhIvBEAA-w/AAAAAAAAAAI/AAAAAAAAATI/Op5eKvv2U_Q/photo.jpg?sz=128", "display_name": "Devid Fabris", "link": "https://stackoverflow.com/users/7394755/devid-fabris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6748, "favorite_count": 1, "accepted_answer_id": 43274147, "answer_count": 3, "score": 2, "last_activity_date": 1613840685, "creation_date": 1491398404, "last_edit_date": 1491554337, "question_id": 43232463, "link": "https://stackoverflow.com/questions/43232463/cors-request-with-golang-backend-doesnt-works", "title": "CORS request with golang backend doesn&#39;t works", "body": "<p>I'm facing some issue with my implementation.\nI have a backend written in Golang and the UI (in Angular2) which are on the same server.</p>\n\n<p>I've tried to set the CORS handling in my backend but it still doesn't work and I'm not getting why.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/rs/cors\"\n)\n\nvar router *mux.Router\n\nfunc main() {\n    router = mux.NewRouter()\n\n    HandleFuncEx(\"/authentication\", handleAuthentication)\n    HandleFuncEx(\"/callA\", handleCallA)\n    HandleFuncEx(\"/callB\", handleCallB)\n    HandleFuncEx(\"/callC\", handleCallC)\n\n    handler := cors.New(cors.Options{\n        AllowedOrigins: []string{\"*\"},\n        AllowedMethods: []string{\"GET\", \"POST\", \"PATCH\"},\n        AllowedHeaders: []string{\"a_custom_header\", \"content_type\"},\n    }).Handler(router)\n    http.ListenAndServe(\":8000\", handler)\n\n}\n\nfunc HandleFuncEx(pattern string, handler func(http.ResponseWriter, *http.Request)) {\n    log.Println(\"handled function\", pattern)\n    router.HandleFunc(pattern, handler)\n}\n</code></pre>\n\n<p>The authentication pattern works correctly (is the first called by the UI)\nall the others calls fails the preflight request.\nWhy is it happening?</p>\n\n<p>Thanks everybody for the help!</p>\n\n<p>EDIT:</p>\n\n<p>This is an example of a non-working response Headers:</p>\n\n<pre><code>HTTP/1.1 200 OK\nVary: Origin\nVary: Access-Control-Request-Method\nVary: Access-Control-Request-Headers\nDate: Fri, 07 Apr 2017 08:33:12 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n</code></pre>\n\n<p>And these are request's headers:</p>\n\n<pre><code>OPTIONS /users HTTP/1.1\nHost: /* Removed by my company policy */\nConnection: keep-alive\nAccess-Control-Request-Method: GET\nOrigin: /* Removed by my company policy */\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) \nAppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.36\nAccess-Control-Request-Headers: access_token\nAccept: */*\nReferer: /* Removed by my company policy */\nAccept-Encoding: gzip, deflate, sdch\nAccept-Language: en-GB,en;q=0.8,en-US;q=0.6,it;q=0.4,la;q=0.2\n</code></pre>\n"}, {"tags": ["json", "go", "marshalling"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 3620473, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000990031767/picture?type=large", "display_name": "user3620473", "link": "https://stackoverflow.com/users/3620473/user3620473"}, "edited": false, "score": 0, "creation_date": 1491393114, "post_id": 43230067, "comment_id": 73530548, "body": "Thank you very much Zoyd for this hint. Yeah, it is working as expected. I think this is what happens when we switch between multiple programming languages :-)"}], "tags": [], "owner": {"reputation": 3055, "user_id": 3528562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356446110eb2675dfd9190c0e8e69ace?s=128&d=identicon&r=PG&f=1", "display_name": "Zoyd", "link": "https://stackoverflow.com/users/3528562/zoyd"}, "is_accepted": false, "score": 2, "last_activity_date": 1491392157, "creation_date": 1491392157, "answer_id": 43230067, "question_id": 43229634, "link": "https://stackoverflow.com/questions/43229634/how-to-send-receive-go-unix-socket-json-string-using-encoder-decoder/43230067#43230067", "title": "How to Send/Receive Go Unix Socket JSON string using encoder/decoder", "body": "<p>JSON marshalling / unmarshalling only takes into account the public fields in a struct; i.e., their name must start with an uppercase letter.</p>\n"}], "owner": {"reputation": 11, "user_id": 3620473, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000990031767/picture?type=large", "display_name": "user3620473", "link": "https://stackoverflow.com/users/3620473/user3620473"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1066, "favorite_count": 0, "closed_date": 1491392465, "answer_count": 1, "score": 0, "last_activity_date": 1491392381, "creation_date": 1491391036, "last_edit_date": 1491392381, "question_id": 43229634, "link": "https://stackoverflow.com/questions/43229634/how-to-send-receive-go-unix-socket-json-string-using-encoder-decoder", "closed_reason": "Duplicate", "title": "How to Send/Receive Go Unix Socket JSON string using encoder/decoder", "body": "<p>We are building a trivial cache process which runs on every node. Each has multiple services up and running and tries to connect to this local cache process which receives the JSON string as an input, and sends the required details in JSON format.</p>\n\n<p>As of now, we have tried the below approach and it seems the local socket communication with encoder, decoder is giving empty results.</p>\n\n<p><strong>Server Code</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"net\"\n    \"os\"\n)\n\nvar sockLocArg = \"/tmp/.testsock\"\n\ntype sockOut struct {\n    keyCheckSum   uint32 `json:\"keyCheckSum\"`\n    valueCheckSum uint32 `json:\"valueCheckSum\"`\n    emsg          string `json:\"emsg\"`\n}\n\ntype sockIn struct {\n    action   string `json:\"action\"`\n    compName string `json:\"compname\"`\n}\n\nfunc processSockRequest(c net.Conn) {\n\n    defer c.Close()\n    decode := json.NewDecoder(c)\n    encode := json.NewEncoder(c)\n\n    var inputJSON sockIn\n    err := decode.Decode(&amp;inputJSON)\n    if err != nil {\n        fmt.Printf(\"Error is %v\", err)\n    }\n    fmt.Printf(\"Action: %s, CompName: %s\\n\", inputJSON.action, inputJSON.compName)\n\n    outputJSON := sockOut{\n        keyCheckSum:   10,\n        valueCheckSum: 10,\n        emsg:          \"\",\n    }\n    // Send response back to the socket request\n    err = encode.Encode(outputJSON)\n    if err != nil {\n        fmt.Printf(\"Error is %v\", err)\n    }\n}\n\nfunc initSocket() {\n    // Creating the unix domain TCP socket\n    //\n    localSocket, err := net.Listen(\"unix\", sockLocArg)\n    if err != nil {\n        fmt.Printf(\"Unable to create unix domain socket. Error: %v\", err)\n        os.Exit(1)\n    }\n    // Set the permissions 700 on this\n    //\n    if err = os.Chmod(sockLocArg, 0700); err != nil {\n        fmt.Printf(\"Unable to change the permissions for the socket. Error: %v\", err)\n        os.Exit(1)\n    }\n    // Initiate and listen to the socket\n    //\n    for {\n        SockFileDescriptor, err := localSocket.Accept()\n        if err != nil {\n            fmt.Printf(\"Unable to accept incoming messages over the socket. Error: %v\", err)\n            os.Exit(1)\n        }\n        processSockRequest(SockFileDescriptor)\n    }\n}\n\nfunc main() {\n    initSocket()\n}\n</code></pre>\n\n<p><strong>Client Code</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"net\"\n)\n\ntype sockOut struct {\n    keyCheckSum   uint32 `json:\"keyCheckSum\"`\n    valueCheckSum uint32 `json:\"valueCheckSum\"`\n    emsg          string `json:\"emsg\"`\n}\n\ntype sockIn struct {\n    action   string `json:\"action\"`\n    compName string `json:\"compname\"`\n}\n\nfunc main() {\n    c, err := net.Dial(\"unix\", \"/tmp/.testsock\")\n    if err != nil {\n        panic(err)\n    }\n    defer c.Close()\n\n    //go reader(c)\n\n    decode := json.NewDecoder(c)\n    encode := json.NewEncoder(c)\n\n    inputJSON := sockIn{\n        action:   \"GET\",\n        compName: \"TEST\",\n    }\n    err = encode.Encode(inputJSON)\n\n    if err != nil {\n        fmt.Printf(\"Error is: %v\", err)\n    }\n    var outputJSON sockOut\n    err = decode.Decode(&amp;outputJSON)\n\n    if err != nil {\n        fmt.Printf(\"Error is %v\", err)\n    }\n    fmt.Printf(\"KeyCheckSum: %d, ValueCheckSum: %d Error: %s\\n\", outputJSON.keyCheckSum, outputJSON.valueCheckSum, outputJSON.emsg)\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<p><em>Starting Server</em></p>\n\n<pre><code>bin/serv &amp;\n[1] 6195\n</code></pre>\n\n<p><em>Running Client</em></p>\n\n<pre><code>$ bin/client \nAction: , CompName: \nKeyCheckSum: 0, ValueCheckSum: 0 Error: \n</code></pre>\n\n<p>Would someone provide some guidance on why we are getting this empty string between server and client communication. We are using Go version go1.8 darwin/amd64.</p>\n"}, {"tags": ["go", "atom-editor"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 6, "last_activity_date": 1491382212, "creation_date": 1491382212, "answer_id": 43226295, "question_id": 43225916, "link": "https://stackoverflow.com/questions/43225916/atom-editor-1-15-0-with-go-plus-has-red-background-in-function-source-code/43226295#43226295", "title": "Atom Editor 1.15.0 with Go-Plus has red background in function source code", "body": "<p>The code in red is not covered by tests.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 20, "last_activity_date": 1491408127, "last_edit_date": 1491408127, "creation_date": 1491388169, "answer_id": 43228572, "question_id": 43225916, "link": "https://stackoverflow.com/questions/43225916/atom-editor-1-15-0-with-go-plus-has-red-background-in-function-source-code/43228572#43228572", "title": "Atom Editor 1.15.0 with Go-Plus has red background in function source code", "body": "<p>If a package has no test files, Atom will show the default background for all source code lines.</p>\n\n<p>If a package has at least 1 test file, by default tests are run on every save. While the tests are run, the lines are displayed with default background, and when tests complete, code lines that can be tested but were not covered by tests will appear with red background.</p>\n\n<p>You can change this in settings:</p>\n\n<pre><code>View -&gt; Preferences -&gt; Packages -&gt; go-plus settings -&gt; Test section\n</code></pre>\n\n<ul>\n<li><strong>Run Tests On Save:</strong> with this you can disable running tests on save</li>\n<li><strong>Run Tests With Coverage:</strong> disabling this will still run your tests, but will not run them with coverage mode, and thus will not highlight untested lines</li>\n<li><strong>Coverage Highlight Mode:</strong> with this setting you can choose what to highlight, by default <em>untested</em> code is highlighted in red background, you can opt to highlight <em>tested</em> lines with green background, or highhlight both, or none of them (disabled)</li>\n<li><strong>Coverage Display Mode:</strong> now this comes handy; default option is <code>highlight</code>, which shows the <em>whole</em> lines using different background. Change it to <code>gutter</code>, and now only the line numbers will have different background, but not the code itself, this is much less disturbing</li>\n</ul>\n\n<p>This was introduced in <a href=\"https://github.com/joefitzgerald/go-plus/releases/tag/v5.0.0\" rel=\"noreferrer\">go-plus v5.0</a>. Here's an animated gif to highlight the differences:</p>\n\n<p><a href=\"https://i.stack.imgur.com/D4UJH.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/D4UJH.gif\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 1197, "user_id": 2066562, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e00cdac0f8df4e4652d43fffced215eb?s=128&d=identicon&r=PG", "display_name": "Artem", "link": "https://stackoverflow.com/users/2066562/artem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1415, "favorite_count": 0, "accepted_answer_id": 43228572, "answer_count": 2, "score": 10, "last_activity_date": 1491408127, "creation_date": 1491381073, "last_edit_date": 1491381906, "question_id": 43225916, "link": "https://stackoverflow.com/questions/43225916/atom-editor-1-15-0-with-go-plus-has-red-background-in-function-source-code", "title": "Atom Editor 1.15.0 with Go-Plus has red background in function source code", "body": "<p>I have updated Atom to latest (1.15.0) and updated all plugin.\nI have go-plus and go-debug plugins.</p>\n\n<p>I get randomly red background for large number of methods in Go files. If I save file it disappears for few seconds.</p>\n\n<p><a href=\"https://i.stack.imgur.com/GQxWh.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/GQxWh.png\" alt=\"enter image description here\"></a></p>\n\n<p>I thought it is some warning but I do not see warning in go-plus.</p>\n\n<p>Any ideas.. What does red bg means and how to disable it?</p>\n"}, {"tags": ["go", "hashtable", "hash-collision", "linear-probing"], "answers": [{"tags": [], "owner": {"reputation": 9723, "user_id": 112936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcc21b0d91b22e3ece4d75d8d1ca87ce?s=128&d=identicon&r=PG", "display_name": "Pavel Morshenyuk", "link": "https://stackoverflow.com/users/112936/pavel-morshenyuk"}, "is_accepted": true, "score": 5, "last_activity_date": 1491381196, "creation_date": 1491381196, "answer_id": 43225953, "question_id": 43225520, "link": "https://stackoverflow.com/questions/43225520/how-to-retrieve-values-from-hashtable-after-resolving-collision-using-linear-pro/43225953#43225953", "title": "How to retrieve values from hashtable after resolving collision using linear probing?", "body": "<p>The problem in your solution is that you are using \"linear probing\" for insert operation, but you are not using the same approach for retrieving it.</p>\n\n<p>First of all - I would change your underlining storage to keep whole struct instead of value:</p>\n\n<pre><code>var hasharray [15]Item\n</code></pre>\n\n<p>Second, I would change the retrieve method to check value of the item with calculated hash index, and after that iterate items one by one to find actual item if there was a collision:</p>\n\n<pre><code>func retrieve(key string) {\n    index := hashmethod(key)\n    found := false\n    for !found {\n        item:= hasharray[index];\n        if key == item.key {\n         found = true;\n         fmt.Println(index, item)\n        } else if index != size-1 {\n            index++\n        } else {\n            index = 0\n        }\n    }   \n}\n</code></pre>\n\n<p>See here: <a href=\"https://play.golang.org/p/8JfTpbJcWx\" rel=\"noreferrer\">https://play.golang.org/p/8JfTpbJcWx</a></p>\n"}], "owner": {"reputation": 149, "user_id": 6661634, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/4ec239aa2f9a59d1a62c707c92c3d19a?s=128&d=identicon&r=PG&f=1", "display_name": "codinggirl", "link": "https://stackoverflow.com/users/6661634/codinggirl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 1, "accepted_answer_id": 43225953, "answer_count": 1, "score": 2, "last_activity_date": 1491381196, "creation_date": 1491380022, "question_id": 43225520, "link": "https://stackoverflow.com/questions/43225520/how-to-retrieve-values-from-hashtable-after-resolving-collision-using-linear-pro", "title": "How to retrieve values from hashtable after resolving collision using linear probing?", "body": "<p>I am trying to implement a hash program in go, I did insertion and resolved collisions using linear probing. When I'm trying to retrieve values back, i'm getting different values as I used linear probing to fix collisions.</p>\n\n<p>This is my program : <a href=\"https://play.golang.org/p/7Pmqu6A313\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7Pmqu6A313</a></p>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 119, "user_id": 7509214, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/619339d8852f4be726058017a86ac2cd?s=128&d=identicon&r=PG&f=1", "display_name": "user7509214", "link": "https://stackoverflow.com/users/7509214/user7509214"}, "edited": false, "score": 1, "creation_date": 1491381757, "post_id": 43225340, "comment_id": 73522222, "body": "After studying inside the package, if I didn&#39;t misread it, the ping and pong callback functions are actually executing in the same GoRoutine as the ReadMessage() is called. So the example still guarantees the concurrency. And SetPingHandler() and SetPongHandler() they also need to be synchronized, but in the example they are called before any ReadMessage() is called, so it is ok."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1491404292, "last_edit_date": 1491404292, "creation_date": 1491403147, "answer_id": 43234372, "question_id": 43225340, "link": "https://stackoverflow.com/questions/43225340/how-to-ensure-concurrency-in-golang-gorilla-websocket-package/43234372#43234372", "title": "How to ensure concurrency in Golang gorilla WebSocket package", "body": "<p>The best way to ensure that there are no concurrent calls to the read methods is to execute all of the read methods from a single goroutine.</p>\n\n<p>All of the Gorilla websocket examples use this approach including the example pasted in the question. In the example, all calls to the read methods are from the <code>readPump</code> method.  The <code>readPump</code> method is called once for a connection on a single goroutine. It follows that the connection read methods are not called concurrently.</p>\n\n<p>The <a href=\"https://godoc.org/github.com/gorilla/websocket#hdr-Control_Messages\" rel=\"noreferrer\">section of the documentation on control messages</a> says that the application must read the connection to process control messages.  Based on this and Gorilla's own examples, I think it's safe to assume that the ping, pong and close handlers will be called from the application's reading goroutine as it is in the current implementation.  It would be nice if the documentation could be more explicit about this.  Maybe file an issue?</p>\n"}], "owner": {"reputation": 119, "user_id": 7509214, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/619339d8852f4be726058017a86ac2cd?s=128&d=identicon&r=PG&f=1", "display_name": "user7509214", "link": "https://stackoverflow.com/users/7509214/user7509214"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4319, "favorite_count": 4, "accepted_answer_id": 43234372, "answer_count": 1, "score": 7, "last_activity_date": 1491404292, "creation_date": 1491379457, "question_id": 43225340, "link": "https://stackoverflow.com/questions/43225340/how-to-ensure-concurrency-in-golang-gorilla-websocket-package", "title": "How to ensure concurrency in Golang gorilla WebSocket package", "body": "<p>I have studied the Godoc of the gorilla/websocket package.</p>\n\n<p>In the Godoc it is clearly stated that</p>\n\n<blockquote>\n  <p>Concurrency\n  Connections support one concurrent reader and one concurrent writer.</p>\n  \n  <p>Applications are responsible for ensuring that no more than one goroutine calls the write methods (NextWriter, SetWriteDeadline, WriteMessage, WriteJSON, EnableWriteCompression, SetCompressionLevel) concurrently and that no more than one goroutine calls the read methods (NextReader, SetReadDeadline, ReadMessage, ReadJSON, SetPongHandler, SetPingHandler) concurrently.</p>\n  \n  <p>The Close and WriteControl methods can be called concurrently with all other \n   methods.</p>\n</blockquote>\n\n<p>However, in one of the example provided by the package</p>\n\n<pre><code>func (c *Conn) readPump() {\n    defer func() {\n        hub.unregister &lt;- c\n        c.ws.Close()\n    }()\n    c.ws.SetReadLimit(maxMessageSize)\n    c.ws.SetReadDeadline(time.Now().Add(pongWait))\n    c.ws.SetPongHandler(func(string) error { \n        c.ws.SetReadDeadline(time.Now().Add(pongWait)); return nil\n    })\n    for {\n        _, message, err := c.ws.ReadMessage()\n        if err != nil {\n            if websocket.IsUnexpectedCloseError(err, websocket.CloseGoingAway) {\n                log.Printf(\"error: %v\", err)\n            }\n            break\n        }\n        message = bytes.TrimSpace(bytes.Replace(message, newline, space, -1))\n        hub.broadcast &lt;- message\n    }\n}\n</code></pre>\n\n<p>Source: <a href=\"https://github.com/gorilla/websocket/blob/a68708917c6a4f06314ab4e52493cc61359c9d42/examples/chat/conn.go#L50\" rel=\"noreferrer\">https://github.com/gorilla/websocket/blob/a68708917c6a4f06314ab4e52493cc61359c9d42/examples/chat/conn.go#L50</a></p>\n\n<p>This line</p>\n\n<pre><code>c.ws.SetPongHandler(func(string) error { \n    c.ws.SetReadDeadline(time.Now().Add(pongWait)); return nil\n})\n</code></pre>\n\n<p>and this line</p>\n\n<pre><code>_, message, err := c.ws.ReadMessage()\n</code></pre>\n\n<p>seems to be not synchronized because the first line is a callback function so it should be invoked in a Goroutine created in the package and the second line is executing in the Goroutine that invoke <code>serveWs</code></p>\n\n<p>More importantly, how should I ensure that no more than one goroutine calls the <code>SetReadDeadline</code>, <code>ReadMessage</code>, <code>SetPongHandler</code>, <code>SetPingHandler</code> concurrently?</p>\n\n<p>I tries to use a Mutex lock and lock it whenever I call the above functions, and unlock it afterwards, but quickly I realize a problem. It is usual (also in the example) that <code>ReadMessage</code> is being called in a for-loop. But if the Mutext is locked before the ReadMessage, then no other Read-functions can acquire the lock and execute until next message is received</p>\n\n<p>Is there any better way in handling this concurrency issue? Thanks in advance.</p>\n"}, {"tags": ["go", "metrics", "prometheus"], "answers": [{"tags": [], "owner": {"reputation": 24634, "user_id": 83591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CuiTl.jpg?s=128&g=1", "display_name": "brian-brazil", "link": "https://stackoverflow.com/users/83591/brian-brazil"}, "is_accepted": false, "score": 1, "last_activity_date": 1491379929, "creation_date": 1491379929, "answer_id": 43225482, "question_id": 43225278, "link": "https://stackoverflow.com/questions/43225278/prometheus-send-a-list-of-metrics-to-gauge/43225482#43225482", "title": "Prometheus - send a list of metrics to Gauge", "body": "<p>You are looking to write a custom collector as part of an exporter, see <a href=\"https://github.com/prometheus/consul_exporter/blob/master/consul_exporter.go#L156\" rel=\"nofollow noreferrer\">https://github.com/prometheus/consul_exporter/blob/master/consul_exporter.go#L156</a> as one example.</p>\n\n<p>Docker also has Prometheus metrics built in that can be enabled, so you may not need to write this.</p>\n"}], "owner": {"reputation": 2491, "user_id": 1117320, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/LA0T3.jpg?s=128&g=1", "display_name": "ambikanair", "link": "https://stackoverflow.com/users/1117320/ambikanair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 800, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1491379929, "creation_date": 1491379288, "question_id": 43225278, "link": "https://stackoverflow.com/questions/43225278/prometheus-send-a-list-of-metrics-to-gauge", "title": "Prometheus - send a list of metrics to Gauge", "body": "<p>I have a list of metrics in json format to be send to prometheus.How would I use Guage metrics type in client_golang to send these metrics to prometheus all at once?</p>\n\n<p>Right now I have below code</p>\n\n<pre><code>var (\n      dockerVer = prometheus.NewGauge(prometheus.GaugeOpts{\n            Name: \"docker_version_latency\",\n            Help: \"Latency of docker version command.\",\n      }))\nfunc init() {\n    // Metrics have to be registered to be exposed:\n    prometheus.MustRegister(dockerVer)\n}\n\nfunc main() {\n\n    for {\n        get_json_response(1234,\"version\")\n        dockerVer.Set(jsonData[0].Latency)\n\n        // The Handler function provides a default handler to expose    metrics\n        // via an HTTP server. \"/metrics\" is the usual endpoint for that.\n\n        http.Handle(\"/metrics\", promhttp.Handler())\n        log.Fatal(http.ListenAndServe(\":8081\", nil))\n    }\n</code></pre>\n\n<p>}</p>\n\n<p>I have many more metrics and I have to read these from the json and send it to gauge dynamically.</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491408475, "post_id": 43224314, "comment_id": 73542819, "body": "You can&#39;t call /_ah/start yourself. The App Engine subsystem calls it, which is the reason you are getting <code>401</code> Unauthorized errors."}, {"owner": {"reputation": 1713, "user_id": 4052858, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/710d5f65b404307fea9b5a1564c60549?s=128&d=identicon&r=PG&f=1", "display_name": "N.F.", "link": "https://stackoverflow.com/users/4052858/n-f"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491434836, "post_id": 43224314, "comment_id": 73556502, "body": "@RayfenWindspear I know GAE call /_ah/start. My question is why my app returns 401 error."}], "owner": {"reputation": 1713, "user_id": 4052858, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/710d5f65b404307fea9b5a1564c60549?s=128&d=identicon&r=PG&f=1", "display_name": "N.F.", "link": "https://stackoverflow.com/users/4052858/n-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1491376482, "creation_date": 1491376482, "question_id": 43224314, "link": "https://stackoverflow.com/questions/43224314/gae-go-ah-start-returns-401", "title": "GAE/Go: /_ah/start returns 401", "body": "<p>Our GAE/Go application returns 401 response to /_ah/start like below.</p>\n\n<p><a href=\"https://i.stack.imgur.com/vOO2k.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vOO2k.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>app.yaml is this.</p>\n\n<pre><code>runtime: go\napi_version: go1\napplication: (out app)\nversion: 777\nthreadsafe: true\nmanual_scaling:\n  instances: 1  \n\nhandlers:\n\n- url: /_ah/.*\n  script: _go_app\n\n- url: /.*\n  script: _go_app\n  login: required\n  secure: always\n</code></pre>\n\n<p>Why we have this error? How can I fix this?\nWe know deleting <code>manual_scaling</code> can fix this error, but we would like to restrict the number of our instance.</p>\n"}, {"tags": ["macos", "go", "ceph"], "comments": [{"owner": {"reputation": 947, "user_id": 7589131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f027d0ec78aed0c15818d13f687831f?s=128&d=identicon&r=PG&f=1", "display_name": "litanhua", "link": "https://stackoverflow.com/users/7589131/litanhua"}, "edited": false, "score": 0, "creation_date": 1491374158, "post_id": 43223531, "comment_id": 73517365, "body": "Documents about install librados posted <a href=\"http://docs.ceph.com/docs/hammer/rados/api/librados-intro/\" rel=\"nofollow noreferrer\">here</a>"}], "answers": [{"tags": [], "owner": {"reputation": 947, "user_id": 7589131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f027d0ec78aed0c15818d13f687831f?s=128&d=identicon&r=PG&f=1", "display_name": "litanhua", "link": "https://stackoverflow.com/users/7589131/litanhua"}, "is_accepted": false, "score": 2, "last_activity_date": 1491384995, "creation_date": 1491384995, "answer_id": 43227341, "question_id": 43223531, "link": "https://stackoverflow.com/questions/43223531/how-can-i-install-librados-on-mac-osx/43227341#43227341", "title": "How can I install librados on mac osx?", "body": "<p>Find a simple APIs to access any Amazon S3 compatible object storage: <a href=\"https://github.com/minio/minio-go\" rel=\"nofollow noreferrer\">Minio Go Client SDK for Amazon S3 Compatible Cloud</a>. </p>\n\n<p>Do not need to install a client on osx.</p>\n\n<p>thanks.</p>\n"}], "owner": {"reputation": 947, "user_id": 7589131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f027d0ec78aed0c15818d13f687831f?s=128&d=identicon&r=PG&f=1", "display_name": "litanhua", "link": "https://stackoverflow.com/users/7589131/litanhua"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 822, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1491384995, "creation_date": 1491374077, "question_id": 43223531, "link": "https://stackoverflow.com/questions/43223531/how-can-i-install-librados-on-mac-osx", "title": "How can I install librados on mac osx?", "body": "<p>I want to develop a object storage appliaction using ceph. Official client library include java/c++/php/python but exclude golang. Our team use golang as primary develop language and mac osx as default develop environment. </p>\n\n<p><a href=\"https://github.com/ceph/go-ceph\" rel=\"nofollow noreferrer\">go-ceph</a> is a golang client for ceph, but it requires libredos, but I don't know how to install librados on maxos.</p>\n\n<p>thanks you~</p>\n"}, {"tags": ["amazon-web-services", "docker", "go", "amazon-s3", "cdn"], "answers": [{"tags": [], "owner": {"reputation": 107, "user_id": 6337763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a99a7c67ac11e16616d1e5eda34b9e4e?s=128&d=identicon&r=PG&f=1", "display_name": "marclave", "link": "https://stackoverflow.com/users/6337763/marclave"}, "is_accepted": true, "score": 1, "last_activity_date": 1491679989, "creation_date": 1491679989, "answer_id": 43299515, "question_id": 43220027, "link": "https://stackoverflow.com/questions/43220027/aws-elastic-beanstalk-application-and-static-assets-deployment-isolation/43299515#43299515", "title": "AWS Elastic Beanstalk Application and Static Assets Deployment Isolation", "body": "<p>What I ended up doing was using cloudfront, pointing my <code>www.website.com</code> to the cloudfront site, set up ssl so now my front end deployment is just pushing to s3 essentially. </p>\n\n<p>Then I have my api running on elastic beanstalk and also have ssl set up, so now if I want to hit the api i forward any <code>api.website.com</code> to the name of the server. I also setup ssl so everything is encrypted.</p>\n\n<p>I am also versioning my api like so\n<code>api.website.com/v1/&lt;endpoint&gt;</code>\nDeployments are a breeze now!</p>\n"}], "owner": {"reputation": 107, "user_id": 6337763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a99a7c67ac11e16616d1e5eda34b9e4e?s=128&d=identicon&r=PG&f=1", "display_name": "marclave", "link": "https://stackoverflow.com/users/6337763/marclave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "accepted_answer_id": 43299515, "answer_count": 1, "score": 4, "last_activity_date": 1491679989, "creation_date": 1491353103, "question_id": 43220027, "link": "https://stackoverflow.com/questions/43220027/aws-elastic-beanstalk-application-and-static-assets-deployment-isolation", "title": "AWS Elastic Beanstalk Application and Static Assets Deployment Isolation", "body": "<p>I have my application code which handles routing and the restful API, written in golang, however all my client side code is written in Vue and I wanted to isolate the two so I did not have to deploy the entire container when I modified a div. I looked into hosting all my static content on a CDN however its a bit hard to dynamically reference the hash</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n\n&lt;head&gt;\n  &lt;meta charset=utf-8&gt;\n  &lt;title&gt;Test&lt;/title&gt;\n  &lt;link href=/static/css/app.c6d9c9fc12c1dbaee77703a4dd731a8b.css rel=stylesheet&gt;\n&lt;/head&gt;\n\n&lt;body&gt;\n  &lt;div id=app&gt;\n  &lt;/div&gt;\n  &lt;script type=text/javascript src=/static/js/manifest.c40d98f512f01d44a02f.js&gt;\n\n  &lt;/script&gt;\n  &lt;script type=text/javascript src=/static/js/vendor.94202f7575960a15f341.js&gt;\n\n  &lt;/script&gt;\n  &lt;script type=text/javascript src=/static/js/app.7a2bba27be158abd2c91.js&gt;\n\n  &lt;/script&gt;\n&lt;/body&gt;\n\n&lt;/html&gt;\n</code></pre>\n\n<p>I have thought of dynamically pulling from S3 front end, however, this could be costly even if I cache it. Is there any way to tie AWS EB git hooks and pulling onto the appropriate docker containers? </p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 3, "creation_date": 1491345341, "post_id": 43218693, "comment_id": 73508931, "body": "Looks like the websocket protocol is not implemented on the server, just a network connection"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 4, "creation_date": 1491345357, "post_id": 43218693, "comment_id": 73508937, "body": "I would save yourself a lot of pain and try using Gorilla websockets.  <a href=\"https://github.com/gorilla/websocket\" rel=\"nofollow noreferrer\">github.com/gorilla/websocket</a>  There is more to websockets then just a tcp connection, there is the web socket protocol to contend with: <a href=\"https://tools.ietf.org/html/rfc6455\" rel=\"nofollow noreferrer\">tools.ietf.org/html/rfc6455</a>"}, {"owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 0, "creation_date": 1491345540, "post_id": 43218693, "comment_id": 73508991, "body": "I&#39;d use gorilla as a last resort since I need to learn the underlying work, and the chat system is basic, peer to peer conversation only and I&#39;ve time for this. If someone can help me with some code to start with (sending receiving messages) and show some direction to research more, I&#39;d appreciate."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1491345791, "post_id": 43218693, "comment_id": 73509062, "body": "@Developer If you look at the link I sent you can see in examples/chat: <a href=\"https://github.com/gorilla/websocket/tree/master/examples/chat\" rel=\"nofollow noreferrer\">github.com/gorilla/websocket/tree/master/examples/chat</a>"}, {"owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 0, "creation_date": 1491346012, "post_id": 43218693, "comment_id": 73509139, "body": "I&#39;ve seen gorilla implementation but would like to see how the native platform approaches the sockets, if anyone can modify the above code to make it work with web sockets without gorilla, that&#39;d achieve the objective"}, {"owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1491346474, "post_id": 43218693, "comment_id": 73509272, "body": "@Mark can you help fix it, what am I missing in here?"}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 1, "creation_date": 1491351145, "post_id": 43218693, "comment_id": 73510562, "body": "@Developer, you&#39;re missing code implementing the websocket protocol. sberry helpfully linked to the definition of the protocol, describing what needs to be done. If you don&#39;t want to do this yourself, sberry&#39;s other helpful link to Gorilla is a defacto standard implementation of the protocol, providing a well tested, production ready solution. The protocol isn&#39;t implemented by the Go standard library, but the Go authors wrote <a href=\"https://godoc.org/golang.org/x/net/websocket\" rel=\"nofollow noreferrer\">x/net/websocket</a>. Note they also recommend Gorilla. Either use a package, or read the source to guide your implementation."}, {"owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 1, "creation_date": 1491351331, "post_id": 43218693, "comment_id": 73510619, "body": "Ok. It&#39;s clearing things up a little bit. Tomorrow I&#39;ll read both specs and gorilla source code to understand more how it&#39;s done at the lower level. I&#39;ll still ask question in comments for something I don&#39;t get."}], "owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 211, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1491345057, "creation_date": 1491344592, "last_edit_date": 1491345057, "question_id": 43218693, "link": "https://stackoverflow.com/questions/43218693/chat-and-web-socket-not-connecting", "title": "Chat and web socket not connecting", "body": "<p>I'm implementing chat with html5 web sockets in go lang and having errors both at client and server end.</p>\n\n<p><strong>Client Error:</strong></p>\n\n<blockquote>\n  <p>WebSocket connectiont to 'ws://192.168.16.90:4000` failed: Invalid HTTP version string GET</p>\n</blockquote>\n\n<p><strong>Server Error:</strong></p>\n\n<p>continous looping of the following log message in the terminal,</p>\n\n<blockquote>\n  <p>connection closed\\n received message:\\n message sent:\\n</p>\n</blockquote>\n\n<p><strong>Server Code:</strong></p>\n\n<pre><code>func (s *Service) InitializeService() {\n    listener, err := net.Listen(\"tcp\", \":4000\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Println(\"Chat server started to listen on port \", listener.Addr())\n\n    defer listener.Close()\n\n    for {\n        conn, err := listener.Accept()\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Println(\"A new connection accepted.\")\n\n        go listenConnection(conn)\n    }\n}\n\nfunc listenConnection(conn net.Conn) {\n    for {\n        buffer := make([]byte, 1400)\n        dataSize, err := conn.Read(buffer)\n        if err != nil {\n            fmt.Println(\"connection closed\")\n        }\n\n        data := buffer[:dataSize]\n        fmt.Println(\"received message: \", string(data))\n\n        _, err = conn.Write(data)\n        if err != nil {\n            log.Fatalln(err)\n        }\n\n        fmt.Println(\"message sent: \", string(data))\n    }\n}\n</code></pre>\n\n<p><strong>Client Code:</strong></p>\n\n<pre><code>var connection = new WebSocket(\"ws://192.168.16.90:4000\");\n\nconnection.onopen = function() {\n    console.log(\"onopen\");\n    connection.send(\"Ping\");\n};\n\nconnection.onerror = function(error) {\n    console.log(\"WebSocket Error\", error);\n};\n\nconnection.onmessage = function(e) {\n    console.log(\"Server: \", e.data);\n};\n</code></pre>\n"}, {"tags": ["go", "toml"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491345079, "post_id": 43218484, "comment_id": 73508825, "body": "All the fields of your substructs are unexported. Here <a href=\"https://play.golang.org/p/OdVDj81KWw\" rel=\"nofollow noreferrer\">play.golang.org/p/OdVDj81KWw</a> this will decode it as you want it, almost, it will fail on the <code>MetricMap</code> stuff, you&#39;ll have to debug there a little."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491345893, "post_id": 43218484, "comment_id": 73509101, "body": "Btw to fix the <code>MetricMap</code> issue, you should wrap <code>Collectors.MetricMap</code> in double brackets like this <code>[[Collectors.MetricMap]]</code> since you define the field as a <code>[]MetricMap</code>."}, {"owner": {"reputation": 135, "user_id": 2277674, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4f7d09788f6fff37f4896423fe507866?s=128&d=identicon&r=PG", "display_name": "sujitv", "link": "https://stackoverflow.com/users/2277674/sujitv"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491404365, "post_id": 43218484, "comment_id": 73539882, "body": "@mkopriva - thanks! that worked. If you can add that as a reply, I can mark it as an answer."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1491413437, "creation_date": 1491413437, "answer_id": 43237907, "question_id": 43218484, "link": "https://stackoverflow.com/questions/43218484/not-able-to-read-toml-file-using-go-with-burntsushi-library/43237907#43237907", "title": "Not able to read TOML file using Go with BurntSushi library", "body": "<p>You need to export any fields that you want <code>BurntSushi/toml</code> to unmarshal into, including subfields:</p>\n\n<pre><code>//ConfigurationParameters provides the struct to hold configuration parameters from config file\ntype ConfigurationParameters struct {\n    Title string\n    //serviceDiscovery captures configuration parameters needed for service discovery registration with Consul\n    ServiceDiscovery ConsulConf `toml:\"ServiceDiscovery\"`\n    //metadataReporting captures which metadata to be registered with service into consul for use during discovery\n    MetadataReporting MetaDataConf `toml:\"MetadataReporting\"`\n    //awsTagsToLabels captures the aws tags that should be added to reported metrics as Labels\n    AwsTagsToLabels LabelConf `toml:\"AwsTagsToLabels\"`\n    //collectors captures the list of collectors to use\n    Collectors CollectorConf `toml:\"Collectors\"`\n    //service captures agent related configurations\n    Service ServiceConf `toml:\"Service\"`\n}\n\n//ConsulConf captures configuration parameters needed for service discovery registration with Consul\ntype ConsulConf struct {\n    Enabled    bool\n    Endpoint   string\n    Port       int\n    Datacenter string\n    ServiceID  string\n}\n\n//MetaDataConf captures which metadata to be registered with service into consul for use during discovery\ntype MetaDataConf struct {\n    Enabled   bool\n    Awsregion string\n}\n\n//LabelConf captures the aws tags that should be added to reported metrics as Labels\ntype LabelConf struct {\n    Enabled       bool\n    RefreshPeriod int\n}\n\n//CollectorConf captures the list of collectors to use\ntype CollectorConf struct {\n    GoCollectionEnabled       bool\n    ExporterCollectionEnabled bool\n    WmiCollectionEnabled      bool\n    AgentCollectionEnabled    bool\n    EnabledCollectors         string\n    MetricMap                 []MetricMap\n}\n\n//MetricMap captures a mapping between one or more WMI metrics and the name it should be reported with\ntype MetricMap struct {\n    WmiMetricName  []string\n    ExportName     string\n    DropMetric     bool\n    ComputedMetric bool\n    ComputeLogic   string\n}\n\n//ServiceConf captures agent related configurations\ntype ServiceConf struct {\n    ListenIP           string\n    ListenPort         int\n    MetricPath         string\n    CollectionInterval int\n    ServiceName        string\n}\n</code></pre>\n\n<p>Also i'm not sure what this <code>Collectors.MetricMap.0</code> syntax is supposed to represent but to unmarshal your toml values into the <code>[]MetricMap</code> field\nwhat you want to do is something like this instead:</p>\n\n<pre><code>[[Collectors.MetricMap]]\n    wmiMetricName = [\"test\"]\n    exportName = \"export_test\"\n</code></pre>\n"}], "owner": {"reputation": 135, "user_id": 2277674, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4f7d09788f6fff37f4896423fe507866?s=128&d=identicon&r=PG", "display_name": "sujitv", "link": "https://stackoverflow.com/users/2277674/sujitv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 824, "favorite_count": 0, "accepted_answer_id": 43237907, "answer_count": 1, "score": 1, "last_activity_date": 1491413437, "creation_date": 1491343499, "last_edit_date": 1495542741, "question_id": 43218484, "link": "https://stackoverflow.com/questions/43218484/not-able-to-read-toml-file-using-go-with-burntsushi-library", "title": "Not able to read TOML file using Go with BurntSushi library", "body": "<p>I am using the BurntSushi library to load a TOML configuration file in my GO application. I have followed the instructions on the library to write the structs and the configuration toml file itself. I am running into some trouble, and I cant seem to find the source of my issues.</p>\n\n<p>Here are the details:</p>\n\n<p>Structs:</p>\n\n<pre><code>package main\n\n\n//ConfigurationParameters provides the struct to hold configuration parameters from config file\ntype ConfigurationParameters struct {\n    Title string\n    //serviceDiscovery captures configuration parameters needed for service discovery registration with Consul\n    ServiceDiscovery ConsulConf `toml:\"ServiceDiscovery\"`\n    //metadataReporting captures which metadata to be registered with service into consul for use during discovery\n    MetadataReporting MetaDataConf `toml:\"MetadataReporting\"`\n    //awsTagsToLabels captures the aws tags that should be added to reported metrics as Labels\n    AwsTagsToLabels LabelConf `toml:\"AwsTagsToLabels\"`\n    //collectors captures the list of collectors to use\n    Collectors CollectorConf `toml:\"Collectors\"`\n    //service captures agent related configurations\n    Service ServiceConf `toml:\"Service\"`\n}\n\n//ConsulConf captures configuration parameters needed for service discovery registration with Consul\ntype ConsulConf struct {\n    enabled    bool\n    endpoint   string\n    port       int\n    datacenter string\n    serviceID  string\n}\n//MetaDataConf captures which metadata to be registered with service into consul for use during discovery\n    type MetaDataConf struct {\n        enabled   bool\n        awsregion string\n    }\n//LabelConf captures the aws tags that should be added to reported metrics as Labels\ntype LabelConf struct {\n    enabled       bool\n    refreshPeriod int\n}\n\n//CollectorConf captures the list of collectors to use\ntype CollectorConf struct {\n    goCollectionEnabled       bool\n    exporterCollectionEnabled bool\n    wmiCollectionEnabled      bool\n    agentCollectionEnabled    bool\n    enabledCollectors         string\n    metricMap                 []MetricMap\n}\n\n//MetricMap captures a mapping between one or more WMI metrics and the name it should be reported with\ntype MetricMap struct {\n    wmiMetricName  []string\n    exportName     string\n    dropMetric     bool\n    computedMetric bool\n    computeLogic   string\n}\n\n//ServiceConf captures agent related configurations\ntype ServiceConf struct {\n    listenIP           string\n    listenPort         int\n    metricPath         string\n    collectionInterval int\n    serviceName        string\n}\n</code></pre>\n\n<p>and the configuration toml file:</p>\n\n<pre><code>Title = \"WMI Exporter Configuration\"\n\n[ServiceDiscovery]\n    enabled = true\n    endpoint = \"my.consul.server\"\n    port = 5500\n    datacenter = \"ucm-west\"\n    serviceID = \"ucm.agent.wmiExporter\"\n\n[MetadataReporting]\n    enabled = true\n    awsregion = \"us-west-2\"\n\n[AwsTagsToLabels]\n    enabled = true\n    refreshPeriod = 3600\n\n[Collectors]\n    goCollectionEnabled = true\n    exporterCollectionEnabled = true\n    wmiCollectionEnabled = true\n    agentCollectionEnabled = false\n    enabledCollectors   = \"cpu,os\"\n    [Collectors.MetricMap.0]\n        wmiMetricName = [\"test\"]\n        exportName = \"export_test\"\n\n[Service]\n    listenPort =  9103\n    metricPath = \"/metrics\"\n    collectionInterval = 60\n    serviceName = \"wmi_exporter\"\n</code></pre>\n\n<p>And the code that reads the config file:</p>\n\n<pre><code>// InitializeFromConfig reads configuration parameters from configuration file and initializes this service\nfunc InitializeFromConfig(configfile string) ConfigurationParameters {\n    conf := ConfigurationParameters{}\n\n    if configfile == \"\" {\n        return conf\n    }\n\n    _, err := toml.DecodeFile(configfile, &amp;conf)\n    if err != nil {\n        log.Fatalf(\"Cannot parse configuration file at %s. Error=%s\", configfile, err)\n    }\n    //at this point, conf is a fully loaded configuration now; now initialize everything from conf\n    return conf\n}\n</code></pre>\n\n<p>The issue I am facing is that only the value for the Title attribute gets mapped into the GO struct members. All of the other configs stay unmapped. Looking at all of the examples on github for BurntSushi and <a href=\"https://stackoverflow.com/questions/34307488/go-how-to-use-toml-files\">(Go) How to use toml files?</a>, I cant see any difference from what I am currently doing in code.</p>\n\n<p>I also used the tomlv validator from the BurntSushi package to look at the types from the TOML file, and I believe they look correct.</p>\n\n<p>Datatypes: </p>\n\n<pre><code>Title                                             String\nServiceDiscovery                                  Hash\n    ServiceDiscovery.enabled                      Bool\n    ServiceDiscovery.endpoint                     String\n    ServiceDiscovery.port                         Integer\n    ServiceDiscovery.datacenter                   String\n    ServiceDiscovery.serviceID                    String\nMetadataReporting                                 Hash\n    MetadataReporting.enabled                     Bool\n    MetadataReporting.awsregion                   String\nAwsTagsToLabels                                   Hash\n    AwsTagsToLabels.enabled                       Bool\n    AwsTagsToLabels.refreshPeriod                 Integer\nCollectors                                        Hash\n    Collectors.goCollectionEnabled                Bool\n    Collectors.exporterCollectionEnabled          Bool\n    Collectors.wmiCollectionEnabled               Bool\n    Collectors.agentCollectionEnabled             Bool\n    Collectors.enabledCollectors                  String\n        Collectors.MetricMap.0                    Hash\n            Collectors.MetricMap.0.wmiMetricName  Array\n            Collectors.MetricMap.0.exportName     String\nService                                           Hash\n    Service.listenPort                            Integer\n    Service.metricPath                            String\n    Service.collectionInterval                    Integer\n    Service.serviceName                           String\n</code></pre>\n\n<p>I tried debugging into the BurntSushi package code, but it was not very helpful (the Delve debugger was not able to display some of the variables in that package, and seemed to randomly jump between the lines in that package).</p>\n\n<p>Any help or pointers on what I could be doing wrong?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["debugging", "go", "revel", "goland"], "comments": [{"owner": {"reputation": 509, "user_id": 5462132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42bf54b25a6c3789897fc4b008aeaac1?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Zolotov", "link": "https://stackoverflow.com/users/5462132/alexander-zolotov"}, "edited": false, "score": 1, "creation_date": 1491559729, "post_id": 43217056, "comment_id": 73618617, "body": "Debugging processes is not implemented yet (Gogland EAP 7). Here is related issue that you can follow to get updates on this: <a href=\"https://youtrack.jetbrains.com/issue/GO-620\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issue/GO-620</a>"}, {"owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "reply_to_user": {"reputation": 509, "user_id": 5462132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42bf54b25a6c3789897fc4b008aeaac1?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Zolotov", "link": "https://stackoverflow.com/users/5462132/alexander-zolotov"}, "edited": false, "score": 0, "creation_date": 1491570447, "post_id": 43217056, "comment_id": 73625764, "body": "Thanks for the link."}], "answers": [{"comments": [{"owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "edited": false, "score": 0, "creation_date": 1491377367, "post_id": 43219769, "comment_id": 73519325, "body": "The thing is, I don&#39;t want to install delve separatly. I would rather use gogland&#39;s bundled binary of delve and use GUI debugger which is in gogland."}, {"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "reply_to_user": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "edited": false, "score": 0, "creation_date": 1491392191, "post_id": 43219769, "comment_id": 73529846, "body": "In fact, I&#39;ve installed gogland. I&#39;ve found <code>dlv</code> in bin. But I did not found a possibility to customize start of <code>dlv</code>.  Than I look here: <a href=\"https://youtrack.jetbrains.com/issues/GO?q=dlv%20attach\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issues/GO?q=dlv%20attach</a>  I don&#39;t see a possibility to configure attach to pid from gogland."}], "tags": [], "owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "is_accepted": false, "score": 0, "last_activity_date": 1491350980, "creation_date": 1491350980, "answer_id": 43219769, "question_id": 43217056, "link": "https://stackoverflow.com/questions/43217056/how-to-debug-revel-app-in-goland/43219769#43219769", "title": "How to debug revel app in goland?", "body": "<p>AFAIK, Gogland built-in debugger is <a href=\"https://github.com/derekparker/delve\" rel=\"nofollow noreferrer\">delve</a>.</p>\n\n<p>I think you must try run debug with option <code>attach</code>:</p>\n\n<pre>\nAttach to an already running process and begin debugging it.\n\nThis command will cause Delve to take control of an already running process, and\nbegin a new debug session.  When exiting the debug session you will have the\noption to let the process continue or kill it.\n\nUsage:\n  dlv attach pid [flags]\n</pre>\n\n<p>I don't have installed gogland now, but I had similar problem in past.</p>\n"}, {"comments": [{"owner": {"reputation": 2040, "user_id": 441739, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/76000397999476e51ba926813ddde09c?s=128&d=identicon&r=PG", "display_name": "Jon L.", "link": "https://stackoverflow.com/users/441739/jon-l"}, "edited": false, "score": 0, "creation_date": 1525708034, "post_id": 47993438, "comment_id": 87452941, "body": "The revel build command requires two arguments, the app itself (which you have), and the target path which will be overwritten. The instructions above fail due to the missing target path."}], "tags": [], "owner": {"reputation": 41, "user_id": 9145429, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-qHZtlGRh-x8/AAAAAAAAAAI/AAAAAAAAAE4/kUbexePmdN8/photo.jpg?sz=128", "display_name": "\u0418\u043b\u044c\u044f \u0416\u0443\u0440\u0430\u0432\u043b\u0435\u0432", "link": "https://stackoverflow.com/users/9145429/%d0%98%d0%bb%d1%8c%d1%8f-%d0%96%d1%83%d1%80%d0%b0%d0%b2%d0%bb%d0%b5%d0%b2"}, "is_accepted": true, "score": 1, "last_activity_date": 1514382937, "last_edit_date": 1592644375, "creation_date": 1514382937, "answer_id": 47993438, "question_id": 43217056, "link": "https://stackoverflow.com/questions/43217056/how-to-debug-revel-app-in-goland/47993438#47993438", "title": "How to debug revel app in goland?", "body": "<p>Now Gogland is <a href=\"https://www.jetbrains.com/go/\" rel=\"nofollow noreferrer\">Goland</a></p>\n<p>I find official <a href=\"https://revel.github.io/manual/debug.html\" rel=\"nofollow noreferrer\">manual</a> for create debug-config. I'll post here if you do not mind...</p>\n<p><strong>INTELLIJ DEBUGGING (GOLAND)</strong></p>\n<ol>\n<li>Create your project, for this example i will be using canonical \u201crevel new github.com/myaccount/my-app\u201d</li>\n<li>\u201crevel run github.com/myaccount/my-app\u201d to generate tmp/main.go - this file is needed by intellij</li>\n<li>Shutdown the running server</li>\n<li>Create run configuration and in \u201cProgram arguments\u201d add \u201c-importPath github.com\\myaccount\\my-app -srcPath \\src -runMode dev&quot;</li>\n<li>Point \u201cFile\u201d to \\src\\github.com\\myaccount\\my-app\\app\\tmp\\main.go</li>\n<li>In \u201cbefore launch\u201d add \u201cRun external tool\u201d. There: Program: \\bin\\revel(.exe) Paramerets: build github.com/myaccount/my-app</li>\n</ol>\n<p><em>It works for Linux&amp;Windows</em></p>\n"}], "owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1074, "favorite_count": 0, "accepted_answer_id": 47993438, "answer_count": 2, "score": 0, "last_activity_date": 1530255654, "creation_date": 1491337564, "last_edit_date": 1530255654, "question_id": 43217056, "link": "https://stackoverflow.com/questions/43217056/how-to-debug-revel-app-in-goland", "title": "How to debug revel app in goland?", "body": "<p>I would like to debug my revel application with Jetbrain's gogland built in debugger but gogland run configuration allowing to setup either package or file run scenario not debug process started by <code>revel run myapp</code>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1491336107, "post_id": 43216602, "comment_id": 73504546, "body": "The directory name is not related to the package name"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1491337265, "post_id": 43216602, "comment_id": 73505170, "body": "As an example of what @JimB is talking about package <code>import &quot;google.golang.org&#47;api&#47;oauth2&#47;v2&quot;</code> imports the <code>oauth2</code> package and is used as such: <code>oauth2.New(...)</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1491337411, "post_id": 43216602, "comment_id": 73505247, "body": "Or pretty much <i>any</i> <code>package main</code>"}, {"owner": {"reputation": 29, "user_id": 4838226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e46298eb4f7b64dec22fbfda6369b6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Egor Shalashnikov", "link": "https://stackoverflow.com/users/4838226/egor-shalashnikov"}, "edited": false, "score": 0, "creation_date": 1491340327, "post_id": 43216602, "comment_id": 73506779, "body": "I understand that it is NOT related. BUT my question was not about the current implementation. It is about the advantages of current implementation versus the old one plain directories."}, {"owner": {"reputation": 29, "user_id": 4838226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e46298eb4f7b64dec22fbfda6369b6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Egor Shalashnikov", "link": "https://stackoverflow.com/users/4838226/egor-shalashnikov"}, "edited": false, "score": 0, "creation_date": 1491340417, "post_id": 43216602, "comment_id": 73506825, "body": "Package main is just as simple as putting your main proc into main folder."}, {"owner": {"reputation": 29, "user_id": 4838226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e46298eb4f7b64dec22fbfda6369b6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Egor Shalashnikov", "link": "https://stackoverflow.com/users/4838226/egor-shalashnikov"}, "edited": false, "score": 0, "creation_date": 1491340537, "post_id": 43216602, "comment_id": 73506870, "body": "Anyway, I&#39;ve seen the doc from Rob Pike or some related guys with the detailed description of their package ideology , with explanations and examples. If you remeber link to it, it&#39;ll be great"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1491377832, "post_id": 43216602, "comment_id": 73519613, "body": "The use of the package declaration is that you may use a Go <i>identifier</i> as the package name. A folder name may not be a valid Go identifier, and a Go identifier may not be a valid folder name. More on this in this answer: <a href=\"http://stackoverflow.com/questions/38563990/what-is-the-purpose-of-the-package-declaration/38564329#38564329\">What is the purpose of the package declaration?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "is_accepted": true, "score": 1, "last_activity_date": 1491349910, "creation_date": 1491349910, "answer_id": 43219621, "question_id": 43216602, "link": "https://stackoverflow.com/questions/43216602/why-there-is-a-package-declaration-in-go/43219621#43219621", "title": "Why there is a package declaration in Go?", "body": "<blockquote>\n  <blockquote>\n    <p>Instead the directory name itself could be a package name for all files it contains.</p>\n  </blockquote>\n</blockquote>\n\n<p>Egor, you probably suppose that  in one directory go-files only from one package.</p>\n\n<p>You are almost correct if you exclude tests.</p>\n\n<p>Tests are exception from rule \"one directory - one package\".</p>\n"}], "owner": {"reputation": 29, "user_id": 4838226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e46298eb4f7b64dec22fbfda6369b6e0?s=128&d=identicon&r=PG&f=1", "display_name": "Egor Shalashnikov", "link": "https://stackoverflow.com/users/4838226/egor-shalashnikov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "closed_date": 1491377497, "accepted_answer_id": 43219621, "answer_count": 1, "score": -2, "last_activity_date": 1491349910, "creation_date": 1491335997, "question_id": 43216602, "link": "https://stackoverflow.com/questions/43216602/why-there-is-a-package-declaration-in-go", "closed_reason": "Duplicate", "title": "Why there is a package declaration in Go?", "body": "<p>Why do we need to put a package declaration in every file in folder to mark the specified .go files as a part of a package?</p>\n\n<p>Instead the directory name itself could be a package name for all files it contains.</p>\n\n<p>So what the ideological point for this decision?</p>\n"}, {"tags": ["go", "build", "interface", "packages"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491333497, "post_id": 43215655, "comment_id": 73503127, "body": "What do you mean by populating the interface? If you just need to assign a value, why not do it in the proper file with the corresponding build tags?"}, {"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491334382, "post_id": 43215655, "comment_id": 73503625, "body": "@JimB By populating the interface I meant setting a variable that has an interface type. e.g. <code>var eng RenderEngine = OpenGLES</code> or <code>var eng RenderEngine = OpenGL</code> depending on the build tag. Sorry I realize that wasn&#39;t clear."}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1491341134, "post_id": 43215655, "comment_id": 73507171, "body": "@FanusduToit see my answer for your <code>var eng RenderEngine</code> variable, defined in the <code>main()</code> as simply <code>r</code>.  You can place this on the heap if you like by making it global as well, and initializing it with an <code>init()</code>."}], "answers": [{"comments": [{"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "edited": false, "score": 0, "creation_date": 1491334080, "post_id": 43215936, "comment_id": 73503465, "body": "Seems like this will do the trick. Will try it out and get back. I&#39;m slightly against globally setting a variable but not sure if I have a choice."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1491339250, "post_id": 43215936, "comment_id": 73506213, "body": "It could just as easily be two definitions of a global function that return different types, if that would be preferable. I understand the reluctance to use package-global variables, but it&#39;s not unidiomatic."}, {"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1491449946, "post_id": 43215936, "comment_id": 73560268, "body": "@Adrian I&#39;m getting nil value when I try print the important variable in my main package and function. Something I&#39;m missing?"}], "tags": [], "owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "is_accepted": true, "score": 3, "last_activity_date": 1491333798, "creation_date": 1491333798, "answer_id": 43215936, "question_id": 43215655, "link": "https://stackoverflow.com/questions/43215655/building-multiple-binaries-using-different-packages-and-build-tags/43215936#43215936", "title": "Building multiple binaries using different packages and build tags", "body": "<p>Create two files somewhat like these:</p>\n\n<pre><code>// +build myBuildFlag\n\npackage mypackage\n\nimport package1\n\nvar important = package1.Foo\n</code></pre>\n\n<p>Other one:</p>\n\n<pre><code>// +build !myBuildFlag\n\npackage mypackage\n\nimport package2\n\nvar important = package2.Foo\n</code></pre>\n\n<p>Now whenever you use <code>important</code> it something different depending on your build flag.</p>\n"}, {"comments": [{"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "edited": false, "score": 0, "creation_date": 1491449954, "post_id": 43217403, "comment_id": 73560273, "body": "Great detailed answer! The reason I want to stick to build tags and not file suffixes is because there could be many systems added (each with their own build tag). So if the application has 8 systems (which should be possible), file suffixes will get ugly. A build tag isn&#39;t only for a OS or ARCH, but also different package configurations of the same application."}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "reply_to_user": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "edited": false, "score": 0, "creation_date": 1491486196, "post_id": 43217403, "comment_id": 73582542, "body": "Doesn&#39;t matter between file suffixes and/or build tags (u can combine them too). The main point was to use an interface and functions to create instances on a new Stack, instead of the heap as global vars would do.  This pattern frees you from mutex locks during concurrency.  I just used file suffixes as an example - could easily use build tags as well with this pattern."}], "tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": false, "score": 3, "last_activity_date": 1491362789, "last_edit_date": 1491362789, "creation_date": 1491338864, "answer_id": 43217403, "question_id": 43215655, "link": "https://stackoverflow.com/questions/43215655/building-multiple-binaries-using-different-packages-and-build-tags/43217403#43217403", "title": "Building multiple binaries using different packages and build tags", "body": "<p>Whichever <a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"nofollow noreferrer\">Build Constraints</a> you chose, you can achieve this with interfaces and implementing the interface with New() constructors.  And each of those special files will have the special packages you seek, on a per file basis.  This approach also enforces good decoupling by forcing you to break off only the raw parts you need to implement specific to each architecture.  </p>\n\n<p>I am a personal fan of file suffixes, instead of build tags, as it makes it extremely easy to know which file binds to what architecture - just by looking at the filename.  A big plus is you don't have to mess with any build tags and it will <strong>JustWork\u2122</strong>.  So my examples below will use file file suffixes.  Specifically, the format is:</p>\n\n<pre><code>*_GOOS\n*_GOARCH\n*_GOOS_GOARCH\n</code></pre>\n\n<p>For example, <code>renderer_windows_amd64.go</code>, <code>renderer_windows_amd64_test.go</code>, <code>renderer_linux.go</code>, <code>renderer_linux_test.go</code>, etc.  You can find <a href=\"https://golang.org/doc/install/source#environment\" rel=\"nofollow noreferrer\">all the GOOS and GOARCH that Go supports here</a>.</p>\n\n<p>EDIT: Validated code on kiddo's laptop (tweaking a build error).  ;)  Note though, you can't call <code>go run main.go</code> as the architecture isn't known.  You'll have to <code>go build &amp;&amp; ./mybinary</code> to execute it locally to test.</p>\n\n<h2>main.go</h2>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    r, err := NewRenderer()\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n\n    // call the Render() method for the specific goarch-goos.\n    if err := r.Render(); err != nil {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<h2>renderer.go</h2>\n\n<p>This is a simple file that only defines the interface.  And maybe some common enums.</p>\n\n<pre><code>package main\n\n// Renderer renders performs the platform-specific rendering.\ntype Renderer interface {\n    Render() error\n}\n\n// alternatively, you could define a global renderer struct\n// here to use in each of hte files below if they are always\n// the same.  often not though, as you want to keep states of\n// of specific architectures within each struct.\n// type renderer struct {\n//     ...\n// }\n//\n// func (r *renderer) Render() error {\n//  ...\n// }\n</code></pre>\n\n<h2>renderer_windows.go</h2>\n\n<p>Includes 32 and 64 bit builds.  If you want to target, say 64 bit only for specific 64bit compiled DLLs, then you can target more specifically with <code>renderer_windows_amd64.go</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    // \"WindowsDLLPackage\"  specific package to import for Windows\n)\n\n// renderer implements Renderer interface.\ntype renderer struct {\n    // you can include some stateful info here for Windows versions,\n    // to keep it out of the global heap.\n    GOOS         string\n    WindowsRules bool\n}\n\n// NewRenderer instantiates a Windows version.\nfunc NewRenderer() (Renderer, error) {\n    return &amp;renderer{\n        GOOS:         \"Windows\",\n        WindowsRules: true,\n    }, nil\n}\n\n// Render renders the Windows version.\nfunc (r *renderer) Render() error {\n\n    // use WindowsDLLPackage.NewSomething()\n\n    fmt.Println(r.GOOS, r.WindowsRules)\n    return nil\n}\n</code></pre>\n\n<h2>renderer_linux.go</h2>\n\n<p>Linux does not include Android (nor darwin, aka macOS) builds.  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    // \"LinuxPackage\"  specific package to import for Linux\n)\n\n// renderer implements Renderer interface.\ntype renderer struct {\n    // you can include some stateful info here for Linux versions,\n    // to keep it out of the global heap.\n    GOOS       string\n    LinuxRules bool\n}\n\n// NewRenderer instantiates a Linux version.\nfunc NewRenderer() (Renderer, error) {\n    return &amp;renderer{\n        GOOS:       \"Linux\",\n        LinuxRules: true,\n    }, nil\n}\n\n// Render renders the Linux version.\nfunc (r *renderer) Render() error {\n\n    // use LinuxPackage.NewSomething()\n\n    fmt.Println(r.GOOS, r.LinuxRules)\n    return nil\n}\n</code></pre>\n\n<h2>renderer_android.go</h2>\n\n<p>Android only specific version.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    // \"AndroidPackage\"  specific package to import for Android\n)\n\n// renderer implements Renderer interface.\ntype renderer struct {\n    // you can include some stateful info here for Android versions,\n    // to keep it out of the global heap.\n    GOOS         string\n    AndroidRules bool\n}\n\n// NewRenderer instantiates a Android version.\nfunc NewRenderer() (Renderer, error) {\n    return &amp;renderer{\n        GOOS:         \"Linux\",\n        AndroidRules: true,\n    }, nil\n}\n\n// Render renders the Android version.\nfunc (r *renderer) Render() error {\n\n    // use AndroidPackage.NewSomething()\n\n    fmt.Println(r.GOOS, r.AndroidRules)\n    return nil\n}\n</code></pre>\n\n<h2>generate different binaries</h2>\n\n<p>All that's left is to cross-compile:</p>\n\n<pre><code>$ GOOS=windows GOARCH=amd64 go build -o mybinary.exe\n$ GOOS=linux GOARCH=amd64 go build -o mybinary_linux\n$ GOOS=darwin GOARCH=amd64 go build -o mybinary_macos\n# and whatever u do to get ios/android builds...\n</code></pre>\n\n<p>Notice how all of the files above are part of the single <code>package main</code> and they exist all in the same directory?  This works because the compiler only picks the one file suffix for the GOOS (windows, linux or android - you can do darwin, freebsd and a lot more).  During compilation, the compiler only implements <code>NewRenderer()</code> once by using that one file.  This is also how you can use specific packages per file.</p>\n\n<p>Also notice how <code>func NewRenderer() (Renderer, error)</code> returns the <code>Renderer</code> interface, not the <code>renderer</code> struct type.</p>\n\n<p>The <code>type renderer struct</code> is completely agnostic to the rest of the package, and can be used for any architecture's means by holding any state you need.</p>\n\n<p>Also note that there aren't any global variables here.  I've often use this pattern with <code>goroutines</code> and <code>channels</code> for highly concurrent applications - with no mutex locking bottlenecks.  Keeping things off the heap is critical to avoid mutex locking.  You could easily do <code>go r.Render()</code> and let it spawn a goroutine.  Or, call it a few million times.</p>\n\n<p>Finally, notice how all of the filenames above are easily distinguishable of what platform they target?  </p>\n\n<p>Don't fight the tooling with build tags, let the tools work <em>for</em> you.</p>\n\n<p>Coding tips above:</p>\n\n<ul>\n<li>I exported the interface, <code>Renderer</code>, as all of this could be moved to a package outside of main quite easily.  You don't want to export the struct versions.  But, you may want to export the <code>NewRenderer()</code> init method.</li>\n<li>Renderer follows <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">GoLang Effective Go guidelines</a> in using simple interfaces with a single function: Render.  And those functions become the name of the interface with the suffix of \"er\" - yes, even if the name ends in 'er', we add 'er' to the end and it becomes <code>type Renderer interface</code>.  IOW: it shouldn't be called <code>RenderEngine</code> and instead it should be called <code>Renderer</code> with a single method you are manipulating: <code>Render()</code>.  This clearly defines a single focus for the tooling and code.  Aka, \"the Go Way.\"</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 0, "last_activity_date": 1491397043, "creation_date": 1491397043, "answer_id": 43231924, "question_id": 43215655, "link": "https://stackoverflow.com/questions/43215655/building-multiple-binaries-using-different-packages-and-build-tags/43231924#43231924", "title": "Building multiple binaries using different packages and build tags", "body": "<p>Take a look at Dave Chaney's post which explains how to deal with building for specific platforms/architectures quite clearly: <a href=\"https://dave.cheney.net/2013/10/12/how-to-use-conditional-compilation-with-the-go-build-tool\" rel=\"nofollow noreferrer\">https://dave.cheney.net/2013/10/12/how-to-use-conditional-compilation-with-the-go-build-tool</a></p>\n"}], "owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1005, "favorite_count": 0, "accepted_answer_id": 43215936, "answer_count": 3, "score": 2, "last_activity_date": 1491397043, "creation_date": 1491332846, "last_edit_date": 1491339234, "question_id": 43215655, "link": "https://stackoverflow.com/questions/43215655/building-multiple-binaries-using-different-packages-and-build-tags", "title": "Building multiple binaries using different packages and build tags", "body": "<p>I have an application that needs to use different packages depending on the target operating system and then generate an executable. The core package has an interface that needs to be populated depending on the package that is used.</p>\n\n<p>I've recently found out the best way to achieve this is by using build tags. But what I'm struggling with is getting the interface populated by the loaded package with the correct build tag(s). Or perhaps there is a better alternative approach.</p>\n\n<p>Here is a visual of how I imagined this to look like:\n<a href=\"https://i.stack.imgur.com/HnnfE.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/HnnfE.jpg\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["unit-testing", "testing", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1491330842, "post_id": 43214776, "comment_id": 73501677, "body": "Those values that aren&#39;t &quot;deterministic&quot; you could check for their presence to make sure that they were set, then set them to their zero value (<code>&quot;&quot;</code>, <code>nil</code>, etc.) before passing the rest to <code>reflect.DeepEqual</code>. Not ideal, but works."}], "answers": [{"comments": [{"owner": {"reputation": 297, "user_id": 7467314, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4715513d18c3b7c8c20346296c85da?s=128&d=identicon&r=PG&f=1", "display_name": "user7467314", "link": "https://stackoverflow.com/users/7467314/user7467314"}, "edited": false, "score": 0, "creation_date": 1491340039, "post_id": 43215339, "comment_id": 73506637, "body": "Thanks for looking at the question. I&#39;m curious as to what you would consider &#39;not right&#39; about this type of custom error. What alternative is there when you have an error that requires more context than just a simple error string? Like the above example when you have a JSON endpoint that return specific error codes and reasons for the failure. How can this be accomplished with just error variables?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 297, "user_id": 7467314, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4715513d18c3b7c8c20346296c85da?s=128&d=identicon&r=PG&f=1", "display_name": "user7467314", "link": "https://stackoverflow.com/users/7467314/user7467314"}, "edited": false, "score": 0, "creation_date": 1491340533, "post_id": 43215339, "comment_id": 73506868, "body": "The problem is that people code along and decide &quot;this is an error case&quot;, so they lazily do this <code>if something { return errors.New(&quot;bad&quot;) }</code>. Then they post their library on github for the masses to use. But the error returned is completely worthless, it only tells you something went wrong. The problem then propagates and people continue to do this and now we have a crapton of worthless errors being returned. Also, you CAN return more useful errors because you only have to implement the <code>Error()</code> interface. I&#39;ll update my answer with an example."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 297, "user_id": 7467314, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4715513d18c3b7c8c20346296c85da?s=128&d=identicon&r=PG&f=1", "display_name": "user7467314", "link": "https://stackoverflow.com/users/7467314/user7467314"}, "edited": false, "score": 0, "creation_date": 1491340614, "post_id": 43215339, "comment_id": 73506910, "body": "As far as dealing with these worthless errors, you probably will just have to string match them and hope whatever library tossed it doesn&#39;t decide to change the wording."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 297, "user_id": 7467314, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4715513d18c3b7c8c20346296c85da?s=128&d=identicon&r=PG&f=1", "display_name": "user7467314", "link": "https://stackoverflow.com/users/7467314/user7467314"}, "edited": false, "score": 0, "creation_date": 1491342926, "post_id": 43215339, "comment_id": 73507930, "body": "See new edit and note that sometimes when a seemingly simple <code>error</code> is returned, there can be far more than initially meets the eye."}, {"owner": {"reputation": 297, "user_id": 7467314, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4715513d18c3b7c8c20346296c85da?s=128&d=identicon&r=PG&f=1", "display_name": "user7467314", "link": "https://stackoverflow.com/users/7467314/user7467314"}, "edited": false, "score": 0, "creation_date": 1491347541, "post_id": 43215339, "comment_id": 73509560, "body": "Yeah that&#39;s pretty much the solution I arrived at. It was between Dave Cheney&#39;s suggestion (asserting on error behaviours instead of concrete types) and type casting, but I found that casting the error to a concrete type to be the only viable way in this type of scenario. So really, the only way to compare errors of this type would be either to zero-out the non-deterministic fields as @mkopriva suggests, or just manually compare whatever field you&#39;re interested in. I don&#39;t know... I can&#39;t help but feel this is a hacky way of doing things."}, {"owner": {"reputation": 297, "user_id": 7467314, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4715513d18c3b7c8c20346296c85da?s=128&d=identicon&r=PG&f=1", "display_name": "user7467314", "link": "https://stackoverflow.com/users/7467314/user7467314"}, "edited": false, "score": 0, "creation_date": 1491347564, "post_id": 43215339, "comment_id": 73509573, "body": "It&#39;d look something like <a href=\"https://play.golang.org/p/sjNb_9Gb35\" rel=\"nofollow noreferrer\">this</a> and i&#39;ve never seen any Go app with error testing like that"}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 1, "last_activity_date": 1491343028, "last_edit_date": 1491343028, "creation_date": 1491331803, "answer_id": 43215339, "question_id": 43214776, "link": "https://stackoverflow.com/questions/43214776/testing-non-opaque-error-values/43215339#43215339", "title": "Testing non-opaque error values", "body": "<p>While this may not answer your question pertaining to checking errors that are not done the right way, here is at least an example of how to create and use errors the right way.</p>\n\n<p>What is commonly done in the standard library packages is errors are created as exported variables and then those can be thrown and compared. Here is an example... however unimaginative it may be.</p>\n\n<p><a href=\"https://play.golang.org/p/JlpguFn2NX\" rel=\"nofollow noreferrer\">https://play.golang.org/p/JlpguFn2NX</a></p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n)\n\nvar ErrBadIdea = errors.New(\"that was dumb\")\nvar ErrNoValue = errors.New(\"not a real value\")\n\nfunc DoSomething(i int) error {\n    if i == 0 {\n        return ErrNoValue\n    }\n    if i &lt; 0 {\n        return ErrBadIdea\n    }\n    // does something that doesn't like negative or zero values\n    return nil\n}\n\nfunc main() {\n    err := DoSomething(-1)\n    fmt.Println(err == ErrBadIdea, err)\n    err = DoSomething(0)\n    fmt.Println(err == ErrNoValue, err)\n}\n</code></pre>\n\n<p>An excellent example of this is in the <code>database/sql</code> package of the standard library.</p>\n\n<p><a href=\"https://godoc.org/database/sql#pkg-variables\" rel=\"nofollow noreferrer\">https://godoc.org/database/sql#pkg-variables</a></p>\n\n<p>These variables exist so you can test like so</p>\n\n<pre><code>if err == sql.ErrNoRows { // these are not the rows you are looking for }\n</code></pre>\n\n<p>It gets better!</p>\n\n<p>Because <code>error</code> is an <code>interface</code>, all you have to do is implement it. Which only requires you have a <code>func Error() string</code>. See the following example and marvel at the power of <code>interface</code>s.</p>\n\n<p><a href=\"https://play.golang.org/p/3RFrxKGkdm\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3RFrxKGkdm</a></p>\n\n<p>Also read the following blog about errors.</p>\n\n<p><a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"nofollow noreferrer\">https://blog.golang.org/error-handling-and-go</a></p>\n"}], "owner": {"reputation": 297, "user_id": 7467314, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4715513d18c3b7c8c20346296c85da?s=128&d=identicon&r=PG&f=1", "display_name": "user7467314", "link": "https://stackoverflow.com/users/7467314/user7467314"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1491343028, "creation_date": 1491329954, "question_id": 43214776, "link": "https://stackoverflow.com/questions/43214776/testing-non-opaque-error-values", "title": "Testing non-opaque error values", "body": "<p>Is there a best practice for comparing non-opaque error values in Go?</p>\n\n<p>Most code bases seem to treat errors as opaque (either the operation succeeded or it failed, with no visibility into internal details about what caused the error).</p>\n\n<p>This makes it easy to write unit tests since all you need to do is assert the actual error against the expected error. The most I've seen people do in addition to that is compare error strings to make sure that it includes at minimum some key information. For example:</p>\n\n<pre><code>if err == nil || !strings.Contains(err.Error(), \"not found in the Raft configuration\") {\n  t.Fatalf(\"err: %v\", err)\n}\n</code></pre>\n\n<p>But for cases where the additional error information is needed (like in form validation where you need to specify the invalid field name, the value, an error code and possibly some nested errors too), what do you do?</p>\n\n<p>I can't simply do a <code>reflect.DeepEqual()</code> since the error will contain a unique stack trace which will make the comparison fail every time. Also, having nested errors makes the testing logic even more complex and you'll need all kinds of error-prone logic (loops, recursion) to compare the desired fields. Is there a standard way of testing errors of this nature?</p>\n"}, {"tags": ["csv", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491329608, "post_id": 43214523, "comment_id": 73500905, "body": "The carriage return doesn&#39;t matter here. Your csv has one quote too much at the end, visible in the first image, not in the second."}, {"owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491331722, "post_id": 43214523, "comment_id": 73502142, "body": "I corrected that wrong snapshot still throws error"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1491405836, "post_id": 43214523, "comment_id": 73540961, "body": "changing the screenshot doesn&#39;t change the datasource. Did you make sure the CSV doesn&#39;t actually contain the extra <code>&quot;</code> anywhere?"}, {"owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1491416796, "post_id": 43214523, "comment_id": 73547958, "body": "Yes Elias i have doubled checked this thing and this is always happening when ever i am using csv created from windows or excel. I can forward you the exact data source."}], "answers": [{"comments": [{"owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1491331764, "post_id": 43214908, "comment_id": 73502169, "body": "Thanks for pointing out wrong snapshot but i have corrected snapshot this case is failing."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1491332185, "post_id": 43214908, "comment_id": 73502430, "body": "Ok, in that case log the error with <code>log.Printf(&quot;%#v&quot;, err)</code> that should tell you on which line and what column the undesired quote is and i&#39;ll try updating my answer accordingly."}, {"owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1491377883, "post_id": 43214908, "comment_id": 73519657, "body": "Yes is not there some standard set of carriage returns in standard library. like i am trying to implement some generic upload but i am blocked in this"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1491379133, "post_id": 43214908, "comment_id": 73520427, "body": "I&#39;m not sure about the rest of the std lib, but the <code>encoding&#47;csv.Reader</code> treats <code>\\r</code> as a normal character as long as it&#39;s not followed by a <code>\\n</code>, if it is then it&#39;s folded into just <code>\\n</code> which is treated as a new line.. so you&#39;ll have to either look for some 3rd party csv packages that handle <code>\\r</code> out of the box, or you&#39;ll have to do something like in the example i&#39;ve given, where you filter the lone <code>\\r</code>s, replace them with <code>\\n</code>s, and then pass the bytes to the csv reader."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 1, "last_activity_date": 1491335086, "last_edit_date": 1491335086, "creation_date": 1491330433, "answer_id": 43214908, "question_id": 43214523, "link": "https://stackoverflow.com/questions/43214523/golang-csv-read-extraneous-in-field-error/43214908#43214908", "title": "Golang CSV read : extraneous &quot; in field error", "body": "<p>Your file clearly shows that you've got an extra quote at the end of the content. While programs like <code>pandas</code> may be fine with that, I assume it's not valid <code>csv</code> so go does return an error.</p>\n\n<p>Quick example of what's wrong with your data: <a href=\"https://play.golang.org/p/KBikSc1nzD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/KBikSc1nzD</a></p>\n\n<p><strong>Update</strong>: After your update and a little bit of searching, I have to apoligize, the carriage return does matter and seems to be tha main culprit here, Go seems to be ok handling the <code>\\r\\n</code> windows variant but not the <code>\\r</code> one. In that case what you can do is wrap the <code>bytes.Reader</code> into a custom reader that replaces the <code>\\r</code> byte with the <code>\\n</code> byte.</p>\n\n<p>Here's an example: <a href=\"https://play.golang.org/p/vNjzwAHmtg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vNjzwAHmtg</a></p>\n\n<p>Please note, that the example is just that, an example, it's not handling all the possible cases where <code>\\r</code> might be a legit byte.</p>\n"}], "owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2042, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1491335086, "creation_date": 1491329120, "last_edit_date": 1491331693, "question_id": 43214523, "link": "https://stackoverflow.com/questions/43214523/golang-csv-read-extraneous-in-field-error", "title": "Golang CSV read : extraneous &quot; in field error", "body": "<p>I am using a simple program to read CSV file, somehow I noticed when I created a CSV using EXCEL or windows based computer go library fails to read it. even when I use cat command it only shows me last line on the terminal. It always results in this error <code>extraneous \" in field</code>.</p>\n\n<p>I researched somewhat than I found it is somewhat related to carriage return differences between OS.\nBut I really want to ask how to make a generic csv reader. I tried reading the same csv using <code>pandas</code> and it was reading successfully. But i am not been able to achieve this using my Go code.</p>\n\n<p><a href=\"https://i.stack.imgur.com/LGYx2.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/LGYx2.png\" alt=\"enter image description here\"></a></p>\n\n<p>Also screen shot of correct csv Is here</p>\n\n<p><a href=\"https://i.stack.imgur.com/7w6y9.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/7w6y9.png\" alt=\"Csv is working fine\"></a></p>\n"}, {"tags": ["dictionary", "go", "iterator"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1491325580, "post_id": 43213129, "comment_id": 73498578, "body": "I don&#39;t understand what it is you are trying to do. Changing values in a map while iterating over it is perfectly valid. Is it that you are wanting specifically to have a data structure you can carry around that will resume a partially iterated map?"}, {"owner": {"reputation": 1192, "user_id": 4969945, "user_type": "registered", "accept_rate": 11, "profile_image": "https://lh3.googleusercontent.com/-V_gW7xpKyDI/AAAAAAAAAAI/AAAAAAAAH7o/Fvn3wFRSbMA/photo.jpg?sz=128", "display_name": "cpcallen", "link": "https://stackoverflow.com/users/4969945/cpcallen"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491326074, "post_id": 43213129, "comment_id": 73498863, "body": "Correct: I want a datastructure I can carry around that will let me resume a partially-completed iteration of a map."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491334791, "post_id": 43213886, "comment_id": 73503880, "body": "Looked at the go source for the range statement. It&#39;s a tough read, but from what I can tell, it might be possible to code another keyword <code>from</code> into the language. It wouldn&#39;t be an iterator per se, but given <code>m map[string]interface{}</code> you could do <code>for k, v := range m from &quot;hello&quot; {  }</code>. Of course, for any type of key. Could do for slices too, <code>... from 42 {  }</code> to start from index 42. Of course you could do your own iteration on a slice, but range is kinda nice."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491336399, "post_id": 43213886, "comment_id": 73504686, "body": "Nevermind that comment. I&#39;ll leave it up for possible discussion, but given the nature of maps, iterators for them just don&#39;t make sense on a fundamental level. At least not enough sense to add a keyword to the language."}], "tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": false, "score": 4, "last_activity_date": 1491326895, "creation_date": 1491326895, "answer_id": 43213886, "question_id": 43213129, "link": "https://stackoverflow.com/questions/43213129/how-can-i-create-a-first-class-map-iterator-in-go/43213886#43213886", "title": "How can I create a first-class map iterator in Go?", "body": "<p>You can't :(</p>\n\n<p>The only way to iterate over a <code>map</code> is by using <code>for range</code> and you can't get an iterator object out of that.</p>\n"}, {"comments": [{"owner": {"reputation": 1192, "user_id": 4969945, "user_type": "registered", "accept_rate": 11, "profile_image": "https://lh3.googleusercontent.com/-V_gW7xpKyDI/AAAAAAAAAAI/AAAAAAAAH7o/Fvn3wFRSbMA/photo.jpg?sz=128", "display_name": "cpcallen", "link": "https://stackoverflow.com/users/4969945/cpcallen"}, "edited": false, "score": 0, "creation_date": 1491480174, "post_id": 43220181, "comment_id": 73577836, "body": "I like this.  It <a href=\"https://play.golang.org/p/qtyNwkVBHG\" rel=\"nofollow noreferrer\">does not quite handle deletion correctly, though</a>, and I&#39;m slightly concerned that it could fall foul of the internal checks hashmap.go does to try to detect concurrent access to the map from different goroutines."}, {"owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "reply_to_user": {"reputation": 1192, "user_id": 4969945, "user_type": "registered", "accept_rate": 11, "profile_image": "https://lh3.googleusercontent.com/-V_gW7xpKyDI/AAAAAAAAAAI/AAAAAAAAH7o/Fvn3wFRSbMA/photo.jpg?sz=128", "display_name": "cpcallen", "link": "https://stackoverflow.com/users/4969945/cpcallen"}, "edited": false, "score": 0, "creation_date": 1491486533, "post_id": 43220181, "comment_id": 73582825, "body": "Ah, yeah I forgot about the modification part, sorry. In that case you&#39;d probably have to model the modification in the iterator and then it would look less nice than this."}], "tags": [], "owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "is_accepted": false, "score": 3, "last_activity_date": 1491354452, "creation_date": 1491354452, "answer_id": 43220181, "question_id": 43213129, "link": "https://stackoverflow.com/questions/43213129/how-can-i-create-a-first-class-map-iterator-in-go/43220181#43220181", "title": "How can I create a first-class map iterator in Go?", "body": "<p>You can use channels as iterators.</p>\n\n<p>Your iterator would be a function returning a channel that communicates the current iteration value to whoever receives it:</p>\n\n<pre><code>func iterator(m map[string]widget) chan iteration {\n    c := make(chan iteration)\n    go func() {\n        for k,v := range m {\n            c &lt;- iteration{k,v}\n        }\n        close(c)\n    }()\n    return c\n}\n</code></pre>\n\n<p>This is of course not generic, you could make it generic using <code>interface{}</code> and/or reflection but that shouldn't be too hard if you actually need it.\nClosing the channel at the end of iteration will notify the end of iteration, demonstrated later.</p>\n\n<p>The <code>iteration</code> type is just there so you can send key and value at the same time, it would look something like this:</p>\n\n<pre><code>type iteration struct {\n    key string\n    value widget\n}\n</code></pre>\n\n<p>With this you can then do this (<a href=\"https://play.golang.org/p/oIuHv3kqs_\" rel=\"nofollow noreferrer\">on play</a>):</p>\n\n<pre><code>m := map[string]widget{\"foo\": widget{3}, \"bar\": widget{4}}\ni := iterator(m)\n\niter, ok := &lt;- i\nfmt.Println(iter, ok)\niter, ok = &lt;- i\nfmt.Println(iter, ok)\niter, ok = &lt;- i\nfmt.Println(iter, ok)\n</code></pre>\n\n<p>which yields</p>\n\n<pre><code>{foo {3}} true\n{bar {4}} true\n{ {0}} false\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1192, "user_id": 4969945, "user_type": "registered", "accept_rate": 11, "profile_image": "https://lh3.googleusercontent.com/-V_gW7xpKyDI/AAAAAAAAAAI/AAAAAAAAH7o/Fvn3wFRSbMA/photo.jpg?sz=128", "display_name": "cpcallen", "link": "https://stackoverflow.com/users/4969945/cpcallen"}, "edited": false, "score": 0, "creation_date": 1491480480, "post_id": 43221497, "comment_id": 73578081, "body": "The sync mutex will prevent panics due to concurrent map access, but it will (if used correctly) also prevent modifications to the map while iterating over it.  I need to be able to modify the map while iterating.  This works great (provided iteration and modification are done in the same goroutine) with an ordinary map."}], "tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": false, "score": 0, "last_activity_date": 1491364323, "creation_date": 1491364323, "answer_id": 43221497, "question_id": 43213129, "link": "https://stackoverflow.com/questions/43213129/how-can-i-create-a-first-class-map-iterator-in-go/43221497#43221497", "title": "How can I create a first-class map iterator in Go?", "body": "<p>You can define your own map type. Also it will be good to solve concurrency problem:</p>\n\n<pre><code>type ConcurrentMap struct {\n    sync.RWMutex\n    items map[string]interface{}\n}\n\ntype ConcurrentMapItem struct {\n    Key   string\n    Value interface{}\n}\n\nfunc (cm *ConcurrentMap) Iter() &lt;-chan ConcurrentMapItem {\n    c := make(chan ConcurrentMapItem)\n\n    f := func() {\n        cm.Lock()\n        defer cm.Unlock()\n\n        for k, v := range cm.items {\n            c &lt;- ConcurrentMapItem{k, v}\n        }\n        close(c)\n    }\n    go f()\n\n    return c\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1192, "user_id": 4969945, "user_type": "registered", "accept_rate": 11, "profile_image": "https://lh3.googleusercontent.com/-V_gW7xpKyDI/AAAAAAAAAAI/AAAAAAAAH7o/Fvn3wFRSbMA/photo.jpg?sz=128", "display_name": "cpcallen", "link": "https://stackoverflow.com/users/4969945/cpcallen"}, "is_accepted": false, "score": 2, "last_activity_date": 1491482232, "creation_date": 1491482232, "answer_id": 43255439, "question_id": 43213129, "link": "https://stackoverflow.com/questions/43213129/how-can-i-create-a-first-class-map-iterator-in-go/43255439#43255439", "title": "How can I create a first-class map iterator in Go?", "body": "<p>A very simple approach is to obtain a list of all the keys in the map, and package the list and the map up in an iterator struct.  When we want the next key, we take the next one from the list that hasn't been deleted from the map:</p>\n\n<pre><code>type iterator struct {\n    m    map[string]widget\n    keys []string\n}\n\nfunc newIterator(m map[string]widget) *iterator {\n    it := iterator{m, make([]string, len(m))}\n    i := 0\n    for k, _ := range m {\n        it.keys[i] = k\n        i++\n    }\n    return &amp;it\n}\n\nfunc (it *iterator) next() (string, widget, bool) {\n    for len(it.keys) &gt; 0 {\n        k := it.keys[0]\n        it.keys = it.keys[1:]\n        if _, exists := it.m[k]; exists {\n            return k, it.m[k], true\n        }\n    }\n    return \"\", widget{0}, false\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/PKGB_TCr3u\" rel=\"nofollow noreferrer\">See running example on play.</a></p>\n"}], "owner": {"reputation": 1192, "user_id": 4969945, "user_type": "registered", "accept_rate": 11, "profile_image": "https://lh3.googleusercontent.com/-V_gW7xpKyDI/AAAAAAAAAAI/AAAAAAAAH7o/Fvn3wFRSbMA/photo.jpg?sz=128", "display_name": "cpcallen", "link": "https://stackoverflow.com/users/4969945/cpcallen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 0, "answer_count": 4, "score": 3, "last_activity_date": 1491482232, "creation_date": 1491324366, "question_id": 43213129, "link": "https://stackoverflow.com/questions/43213129/how-can-i-create-a-first-class-map-iterator-in-go", "title": "How can I create a first-class map iterator in Go?", "body": "<p>I am writing a function that iterates over the entries in a map.  I want to be able to deal cleanly with items which are added or deleted from the map while iterating, like <code>for k, v := range myMap { //...</code> does, but I am processing just one key/value pair per iteration so I can't use range.  I want something like:</p>\n\n<pre><code>func processItem(i iterator) bool {\n     k, v, ok := i.next()\n     if(!ok) {\n         return false\n     }\n     process(v)\n     return true\n}\n\nvar m = make(map[string]widget)\n// ...\ni := makeIterator(m)\nfor processItem(i) {\n    // code which might add/remove item from m here\n}\n</code></pre>\n\n<p>I know that range is using a '<code>hiter</code>' struct and associated functions, as defined in <code>src/runtime/hashmap.go</code>, to perform iteration.  Is there some way to gain access to this iterator as a reified (first-class) Go object?</p>\n\n<p>Is there an alternative strategy for iterating over a map which would deal well with insertions/deletions but give a first-class iterator object?</p>\n\n<p><strong>Bonus question:</strong> is there an alternative strategy for iterating over a map which could <em>also</em> deal with the map and iterator being serialised to disk and then restored, with iteration continuing from where it left off?  (Obviously the built-in <code>range</code> iterator does not have this capability!)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 23028, "user_id": 107156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mSIVv.jpg?s=128&g=1", "display_name": "Kyle Brandt", "link": "https://stackoverflow.com/users/107156/kyle-brandt"}, "edited": false, "score": 0, "creation_date": 1491322830, "post_id": 43212593, "comment_id": 73496904, "body": "In terms of &quot;Why would you want to do this, this seems nutso&quot; is that in my system users can create templates. And I want to protect the main runtime from any errors generated while rendering templates. The real world issue is on github <a href=\"https://github.com/bosun-monitor/bosun/issues/2054\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 23028, "user_id": 107156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mSIVv.jpg?s=128&g=1", "display_name": "Kyle Brandt", "link": "https://stackoverflow.com/users/107156/kyle-brandt"}, "edited": false, "score": 3, "creation_date": 1491324995, "post_id": 43212593, "comment_id": 73498247, "body": "Chatting with people in Gopher slack the idea seems to be that sigsegv puts the program in an undefined state and can&#39;t be recovered from safely."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1491325050, "post_id": 43212593, "comment_id": 73498282, "body": "You can&#39;t recover from a <code>fatal error</code>, it&#39;s not a <code>panic</code>"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1491325051, "post_id": 43212593, "comment_id": 73498283, "body": "So your code does not recover, because your example don&#39;t panic: <a href=\"https://play.golang.org/p/XtfxlLzr51\" rel=\"nofollow noreferrer\">play.golang.org/p/XtfxlLzr51</a>"}, {"owner": {"reputation": 23028, "user_id": 107156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mSIVv.jpg?s=128&g=1", "display_name": "Kyle Brandt", "link": "https://stackoverflow.com/users/107156/kyle-brandt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491325677, "post_id": 43212593, "comment_id": 73498641, "body": "@JimB Does that mean the quoted documentation in os/signal is wrong and it is not converted to panic? Or am not interpreting the documentation incorrectly?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1491329487, "post_id": 43212593, "comment_id": 73500827, "body": "@KyleBrandt: it can be converted to a panic, but in this case with &quot;unexpected fault address&quot; the runtime doesn&#39;t know how to proceed. <a href=\"https://play.golang.org/p/dhRRq2--64\" rel=\"nofollow noreferrer\">play.golang.org/p/dhRRq2--64</a>"}, {"owner": {"reputation": 238, "user_id": 2774608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df58642bc090e9cd11bb6d710f623cca?s=128&d=identicon&r=PG&f=1", "display_name": "bmkessler", "link": "https://stackoverflow.com/users/2774608/bmkessler"}, "edited": false, "score": 0, "creation_date": 1539297024, "post_id": 43212593, "comment_id": 92462139, "body": "@KyleBrandt Yes, the documentation in that section appears to be incomplete and should be updated.  Under some conditions SIGBUS and SIGSEGV are converted to fatal errors instead of panics.  See sigpanic function in runtime/signal_unix.go for the specific cases.   <a href=\"https://github.com/golang/go/blob/master/src/runtime/signal_unix.go#L358-L413\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/runtime/&hellip;</a>  Note that these cases can be overridden by applying debug.SetPanicOnFault as noted below."}], "answers": [{"tags": [], "owner": {"reputation": 1435, "user_id": 180656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c91c0ae420dcaf04e5e9061be6a93c?s=128&d=identicon&r=PG", "display_name": "Josef Grahn", "link": "https://stackoverflow.com/users/180656/josef-grahn"}, "is_accepted": false, "score": 1, "last_activity_date": 1505047020, "creation_date": 1505047020, "answer_id": 46140761, "question_id": 43212593, "link": "https://stackoverflow.com/questions/43212593/handling-sigsegv-with-recover/46140761#46140761", "title": "Handling SIGSEGV with recover?", "body": "<p>When you encounter a sigsegv, you're really in an all-bets-are-off situation with regards to the program state. The only generally safe thing to do is to stop everything, and possibly have the system dump your memory to file for debugging, which is what Go does. There isn't really any way to \"protect the main runtime\" in this situation.</p>\n\n<p>If you have a runtime that is running code that is untrusted or unsafe, you really should isolate it into a separate process instead. And if <em>you</em> are the one running the code received from the users (rather than the users themselves), this process should most definitely be sandboxed.</p>\n\n<p>So my advice is, do either of the following:</p>\n\n<ol>\n<li>Let it crash and let the user handle it from there. The user writing code causing a sigsegv in Go normally requires more or less active attempts of shooting in the direction of one's foot, so it should be rare and arguably filed under things they are doing at their own risk anyway.</li>\n<li>Separate it into a supervisor process and an \"untrusted/unsafe\" child process, where the supervisor picks up improper exit conditions from the child process and reports them appropriately.</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 1435, "user_id": 180656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c91c0ae420dcaf04e5e9061be6a93c?s=128&d=identicon&r=PG", "display_name": "Josef Grahn", "link": "https://stackoverflow.com/users/180656/josef-grahn"}, "edited": false, "score": 0, "creation_date": 1541111463, "post_id": 52524196, "comment_id": 93115719, "body": "This would be inappropriate for the scenario @KyleBrandt is describing, though. It does not &quot;protect the main runtime from any errors generated [in other goroutines]&quot;. As the documentation above indicates, it allows you to prevent the runtime from exiting in situations where you know that the faults you&#39;re triggering are benign. With code that the user has provided, you know nothing, and it is quite possible that a fault it generates has corrupted the memory of the process and left it in an undefined state, where continued execution in <i>any</i> goroutine could go haywire."}], "tags": [], "owner": {"reputation": 238, "user_id": 2774608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df58642bc090e9cd11bb6d710f623cca?s=128&d=identicon&r=PG&f=1", "display_name": "bmkessler", "link": "https://stackoverflow.com/users/2774608/bmkessler"}, "is_accepted": true, "score": 5, "last_activity_date": 1537987115, "creation_date": 1537987115, "answer_id": 52524196, "question_id": 43212593, "link": "https://stackoverflow.com/questions/43212593/handling-sigsegv-with-recover/52524196#52524196", "title": "Handling SIGSEGV with recover?", "body": "<p>Yes, you will want to use <a href=\"https://golang.org/pkg/runtime/debug/#SetPanicOnFault\" rel=\"noreferrer\">debug.SetPanicOnFault</a> to convert faults at an unexpected (non-nil) address into panics from which you can recover.  From the docs:</p>\n\n<blockquote>\n  <p>SetPanicOnFault controls the runtime's behavior when a program faults at an unexpected (non-nil) address. Such faults are typically caused by bugs such as runtime memory corruption, so the default response is to crash the program. Programs working with memory-mapped files or unsafe manipulation of memory may cause faults at non-nil addresses in less dramatic situations; SetPanicOnFault allows such programs to request that the runtime trigger only a panic, not a crash. SetPanicOnFault applies only to the current goroutine. It returns the previous setting.</p>\n</blockquote>\n\n<p>For the localization of the impact, note that SetPanicOnFault is set at the goroutine level, so a single goroutine can deal with known unsafe access.</p>\n"}], "owner": {"reputation": 23028, "user_id": 107156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mSIVv.jpg?s=128&g=1", "display_name": "Kyle Brandt", "link": "https://stackoverflow.com/users/107156/kyle-brandt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2612, "favorite_count": 3, "accepted_answer_id": 52524196, "answer_count": 2, "score": 9, "last_activity_date": 1537987115, "creation_date": 1491322676, "question_id": 43212593, "link": "https://stackoverflow.com/questions/43212593/handling-sigsegv-with-recover", "title": "Handling SIGSEGV with recover?", "body": "<p>The <a href=\"https://golang.org/pkg/os/signal/\" rel=\"noreferrer\">signal package</a> states:</p>\n\n<blockquote>\n  <p>Synchronous signals are signals triggered by errors in program\n  execution: SIGBUS, SIGFPE, and SIGSEGV. These are only considered\n  synchronous when caused by program execution, not when sent using\n  os.Process.Kill or the kill program or some similar mechanism. In\n  general, except as discussed below, Go programs will convert a\n  synchronous signal into a run-time panic.</p>\n</blockquote>\n\n<p>However, it seems <code>recover()</code> is not catching this.</p>\n\n<p>Program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n\n    \"log\"\n)\n\nfunc seeAnotherDay() {\n    defer func() {\n        if p := recover(); p != nil {\n            err := fmt.Errorf(\"recover panic: panic call\")\n            log.Println(err)\n            return\n        }\n    }()\n    panic(\"oops\")\n}\n\nfunc notSoMuch() {\n    defer func() {\n        if p := recover(); p != nil {\n            err := fmt.Errorf(\"recover panic: sigseg\")\n            log.Println(err)\n            return\n        }\n    }()\n    b := make([]byte, 1)\n    log.Println(\"access some memory\")\n    foo := (*int)(unsafe.Pointer(uintptr(unsafe.Pointer(&amp;b[0])) + uintptr(9999999999999999)))\n    fmt.Print(*foo + 1)\n}\n\nfunc main() {\n    seeAnotherDay()\n    notSoMuch()\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2017/04/04 12:13:16 recover panic: panic call\n2017/04/04 12:13:16 access some memory\nunexpected fault address 0xb01dfacedebac1e\nfatal error: fault\n[signal SIGSEGV: segmentation violation code=0x1 addr=0xb01dfacedebac1e pc=0x108aa8a]\n\ngoroutine 1 [running]:\nruntime.throw(0x10b5807, 0x5)\n        /usr/local/go/src/runtime/panic.go:596 +0x95 fp=0xc420043ea8 sp=0xc420043e88\nruntime.sigpanic()\n        /usr/local/go/src/runtime/signal_unix.go:297 +0x28c fp=0xc420043ef8 sp=0xc420043ea8\nmain.notSoMuch()\n        /Users/kbrandt/src/sigseg/main.go:32 +0xca fp=0xc420043f78 sp=0xc420043ef8\nmain.main()\n        /Users/kbrandt/src/sigseg/main.go:37 +0x25 fp=0xc420043f88 sp=0xc420043f78\nruntime.main()\n        /usr/local/go/src/runtime/proc.go:185 +0x20a fp=0xc420043fe0 sp=0xc420043f88\nruntime.goexit()\n        /usr/local/go/src/runtime/asm_amd64.s:2197 +0x1 fp=0xc420043fe8 sp=0xc420043fe0\nexit status 2\n</code></pre>\n\n<p>Is there any way I could handle SIGSEGV in a way localized to certain parts of the code?</p>\n"}, {"tags": ["file", "go", "base64"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1491322567, "post_id": 43212213, "comment_id": 73496712, "body": "What errors are you getting and where from? Your example does not actually show how you&#39;re trying to save the decoded base64 string into a file.. Did you try opening/creating a file and writing to it?"}], "answers": [{"comments": [{"owner": {"reputation": 764, "user_id": 1969935, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0d6f6c9d8a6b99e363bf439c42280621?s=128&d=identicon&r=PG", "display_name": "Paul A.T. Wilson", "link": "https://stackoverflow.com/users/1969935/paul-a-t-wilson"}, "edited": false, "score": 0, "creation_date": 1491325566, "post_id": 43212815, "comment_id": 73498571, "body": "What if the file that is encoded is a PDF or a .tar.gz can I sill use WriteString? I might have completely missed the point but I thought WriteString was just for writing a text file?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 764, "user_id": 1969935, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0d6f6c9d8a6b99e363bf439c42280621?s=128&d=identicon&r=PG", "display_name": "Paul A.T. Wilson", "link": "https://stackoverflow.com/users/1969935/paul-a-t-wilson"}, "edited": false, "score": 1, "creation_date": 1491326017, "post_id": 43212815, "comment_id": 73498831, "body": "Are you looking for how to write bytes into a file? Something like this? <a href=\"https://play.golang.org/p/QfY5leW4O9\" rel=\"nofollow noreferrer\">play.golang.org/p/QfY5leW4O9</a> I&#39;ll update my answer if that&#39;s the case."}, {"owner": {"reputation": 764, "user_id": 1969935, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0d6f6c9d8a6b99e363bf439c42280621?s=128&d=identicon&r=PG", "display_name": "Paul A.T. Wilson", "link": "https://stackoverflow.com/users/1969935/paul-a-t-wilson"}, "edited": false, "score": 0, "creation_date": 1491326367, "post_id": 43212815, "comment_id": 73499039, "body": "I actually used your example and it worked for a .gz file, a pdf, an image and a HUGE binary file. So it appears I was just missing the obvious on this one."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 764, "user_id": 1969935, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0d6f6c9d8a6b99e363bf439c42280621?s=128&d=identicon&r=PG", "display_name": "Paul A.T. Wilson", "link": "https://stackoverflow.com/users/1969935/paul-a-t-wilson"}, "edited": false, "score": 0, "creation_date": 1491326514, "post_id": 43212815, "comment_id": 73499130, "body": "Ok, glad you got it working, I&#39;ve updated the answer anyway to write bytes instead of a string which is the way to go, I think. I don&#39;t know why I used <code>io.WriteString</code> first :F"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 17, "last_activity_date": 1515580529, "last_edit_date": 1515580529, "creation_date": 1491323364, "answer_id": 43212815, "question_id": 43212213, "link": "https://stackoverflow.com/questions/43212213/base64-string-decode-and-save-as-file/43212815#43212815", "title": "Base64 string decode and save as file", "body": "<p><strong>Update</strong>: I forgot to mention that, if you use <a href=\"https://golang.org/pkg/os/#File.Write\" rel=\"noreferrer\">f.Write</a> make sure to also call <a href=\"https://golang.org/pkg/os/#File.Sync\" rel=\"noreferrer\">f.Sync</a> after you're done writing to ensure that all the contents you've written are actually stored. The example shows the updated code.</p>\n\n<p>Not sure if your code example is incomplete, so this answer might be irrelevant but to save your decoded string bytes to a file you first need to open or create a file and then write the bytes into it. Something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/base64\"\n    \"io\"\n    \"os\"\n)\n\nvar b64 = `TWFuIGlzIGRpc3Rpbmd1aXNoZWQsIG5vdCBvbmx5IGJ5IGhpcyByZWFzb24sIGJ1dCBieSB0aGlz\nIHNpbmd1bGFyIHBhc3Npb24gZnJvbSBvdGhlciBhbmltYWxzLCB3aGljaCBpcyBhIGx1c3Qgb2Yg\ndGhlIG1pbmQsIHRoYXQgYnkgYSBwZXJzZXZlcmFuY2Ugb2YgZGVsaWdodCBpbiB0aGUgY29udGlu\ndWVkIGFuZCBpbmRlZmF0aWdhYmxlIGdlbmVyYXRpb24gb2Yga25vd2xlZGdlLCBleGNlZWRzIHRo\nZSBzaG9ydCB2ZWhlbWVuY2Ugb2YgYW55IGNhcm5hbCBwbGVhc3VyZS4=`\n\nfunc main() {\n    dec, err := base64.StdEncoding.DecodeString(b64)\n    if err != nil {\n        panic(err)\n    }\n\n    f, err := os.Create(\"myfilename\")\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n\n    if _, err := f.Write(dec); err != nil {\n        panic(err)\n    }\n    if err := f.Sync(); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Run it here: <a href=\"https://play.golang.org/p/SZVquhZdXC\" rel=\"noreferrer\">https://play.golang.org/p/SZVquhZdXC</a></p>\n"}], "owner": {"reputation": 764, "user_id": 1969935, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0d6f6c9d8a6b99e363bf439c42280621?s=128&d=identicon&r=PG", "display_name": "Paul A.T. Wilson", "link": "https://stackoverflow.com/users/1969935/paul-a-t-wilson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11236, "favorite_count": 1, "accepted_answer_id": 43212815, "answer_count": 1, "score": 5, "last_activity_date": 1515580529, "creation_date": 1491321588, "last_edit_date": 1491348212, "question_id": 43212213, "link": "https://stackoverflow.com/questions/43212213/base64-string-decode-and-save-as-file", "title": "Base64 string decode and save as file", "body": "<p>This has been doing my head in and I hope someone can help. Please forgive me if it's a stupid question as I am very new to Go.</p>\n\n<p>I have a struct that has base64 in it. the struct looks like this:</p>\n\n<pre><code> type UploadedFile struct {\n    PartnerId string\n    FileName string\n    UploadDateTime string\n    FileChecksum string\n    FileBase64 string\n }\n</code></pre>\n\n<p>I want to take that base64 string, decode it and then save it, sounds simple right and it probably is, but I am struck.</p>\n\n<p>The code looks like this:</p>\n\n<pre><code>decoder := json.NewDecoder(r.Body)\nuploadedFile := models.UploadedFile{}\nerr := decoder.Decode(&amp;uploadedFile)\ndec, _ := base64.StdEncoding.DecodeString(uploadedFile.FileBase64)\n</code></pre>\n\n<p>Where do I go from here? I have tried so many things and I just keep getting errors all over the file.</p>\n\n<p>I have tried adapting code that people use for images, but I always crash and burn as the file isn't an image, it could be anything</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go", "frameworks"], "owner": {"reputation": 629, "user_id": 3737786, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/aa0d239b2b0aaba3206246d52a87f268?s=128&d=identicon&r=PG&f=1", "display_name": "bsbak", "link": "https://stackoverflow.com/users/3737786/bsbak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 574, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1491322162, "creation_date": 1491319245, "last_edit_date": 1491322162, "question_id": 43211340, "link": "https://stackoverflow.com/questions/43211340/golang-struct-organization-with-validation-methods", "title": "golang Struct organization with validation, methods", "body": "<p>Many golang frameworks with validation, how you write struct validation and method for work with sql</p>\n\n<p>Example 1:</p>\n\n<pre><code>//create struct register form\ntype UserRegister struct {\n    Email    string    `validate:\"required,max=20,min=8\"`\n    Password string `validate:\"required,max=20,min=8\"`\n    Captcha  string `validate:\"required,captcha\"`\n} \n\n//method Insert for UserRegister struct if validation success\nfunc (u *UserRegister) Insert() {\n    //insert code\n}\n\n//validate -&gt; insert\nfunc Controller(n *N) {\n    var userRegister UserRegister\n    err := validator.Validate(&amp;userRegister)\n    if err == nil {\n        userRegister.Insert()\n    }\n}\n</code></pre>\n\n<p>Example 2:</p>\n\n<pre><code>//Main struct User\ntype User struct {\n   Id       int\n   Email    string\n   Password string\n   Active   int\n   //another fields from user table\n}\n\n//methods for work with User: user.Insert(), user.SelectById() etc.\nfunc (u *UserRegister) Insert() {\n    //insert code\n}\nfunc (u *UserRegister) IsUniqueEmail() {\n    //check unique code\n}\n\n//struct for validation register form\ntype UserRegister struct {\n    Email    string    `validate:\"required,max=20,min=8\"`\n    Password string `validate:\"required,max=20,min=8\"`\n    Captcha  string `validate:\"required,captcha\"`\n}\n\n//validate userRegister if succeess -&gt; transfer data to main user struct -&gt; insert \nfunc Controller(n *N) {\n    var userLogin UserRegister\n    err := validator.Validate(&amp;userRegister)\n    if err == nil {\n        //transfer data from userRegister to user\n        user := User{\n           Email:       userRegister.Email,\n           Password: userRegister.Password,\n           ...\n        }   \n        //insert\n        user.Insert()\n    }\n}\n</code></pre>\n\n<p>About example 1: we create struct with validation and database methods. Sometime i need the same methods in different structs, so need every time copy this methods.</p>\n\n<p>About example 2: we create main struct with database methods and additional structs for validation. Becouse I cant use struct <code>User</code> with fields Password and PasswordRepeat that has validation <code>required</code> in controllers login and register becouse validation will fail in login cuz struct has PasswordRepeat required.</p>\n\n<p>What is the best approach to arganize code?</p>\n"}, {"tags": ["go", "interface", "casting", "type-conversion"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 4046566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0035921b0001752e44b823c78accc97e?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4046566/david"}, "edited": false, "score": 0, "creation_date": 1491337015, "post_id": 43211284, "comment_id": 73505030, "body": "Hey @Andy Schweig, thanks for the reply. It turns out that I should have been a little more explicit in my example since I am unmarshalling json into a slice of Car structs I can&#39;t just return it.  I guess I could iterate through those and build a slice Vehicle to return, but that seems like a waste.  Take a look at my updated example and let me know if you have a better answer <a href=\"https://play.golang.org/p/KQb7mNXH01\" rel=\"nofollow noreferrer\">play.golang.org/p/KQb7mNXH01</a>"}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 0, "last_activity_date": 1491319095, "creation_date": 1491319095, "answer_id": 43211284, "question_id": 43210961, "link": "https://stackoverflow.com/questions/43210961/golang-sorting-slice-of-interfaces/43211284#43211284", "title": "Golang sorting slice of interfaces", "body": "<p>You can't use <code>[]Car</code> where <code>Vehicles</code> (or <code>[]Vehicle</code>) is expected, even though <code>Car</code> implements the <code>Vehicle</code> interface. (Even though the element types are compatible, the slice types are different types, and types must match exactly.)</p>\n\n<p>Fortunately, it's easy to fix your code. You just have to change the first few lines of <code>GetVehicles</code> to this:</p>\n\n<pre><code>func GetVehicles() Vehicles {\n    return Vehicles{\n        Car{\n            CarManufacturer: \"Chevrolet\",\n            CarModel:        \"Corvette\",\n            CarYear:         1965,\n            CarColor:        \"Red\",\n        },\n</code></pre>\n\n<p>This works because <code>Car</code> can be used where <code>Vehicle</code> is expected, because <code>Car</code> implements the <code>Vehicle</code> interface.</p>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1491339718, "creation_date": 1491339718, "answer_id": 43217643, "question_id": 43210961, "link": "https://stackoverflow.com/questions/43210961/golang-sorting-slice-of-interfaces/43217643#43217643", "title": "Golang sorting slice of interfaces", "body": "<p>Extending on Andy's answer... If you're using Go 1.8 (or have the option to update for your project), you can use the newly-added sort.Slice function to do this with regular slices, like you'd get from unmarshalling JSON: <a href=\"https://golang.org/pkg/sort/#Slice\" rel=\"nofollow noreferrer\">https://golang.org/pkg/sort/#Slice</a></p>\n"}, {"tags": [], "owner": {"reputation": 2036, "user_id": 2251549, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dc4a07b6f8c1d95e8835b5346a8d3fb7?s=128&d=identicon&r=PG", "display_name": "Bogdan Iulian Bursuc", "link": "https://stackoverflow.com/users/2251549/bogdan-iulian-bursuc"}, "is_accepted": true, "score": 1, "last_activity_date": 1491379335, "creation_date": 1491379335, "answer_id": 43225298, "question_id": 43210961, "link": "https://stackoverflow.com/questions/43210961/golang-sorting-slice-of-interfaces/43225298#43225298", "title": "Golang sorting slice of interfaces", "body": "<p>The problem is that <code>Car</code> implements <code>Vehicle</code>, but <code>[]Car</code> is not <code>[]Vehicle</code>. One is a slice of objects and the other is a slice of interfaces.\nWhat you need as Andy Scheweig said, you need GetVehicles to return Vehicles ([]Vehicle). You can do the conversion inside the <code>GetVehicles</code> and afterwards if you need the Cars you can do type assertion.</p>\n\n<p>Made some changes to your code, and works as you need it now.</p>\n\n<p><a href=\"https://play.golang.org/p/fM8EhSfsCU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/fM8EhSfsCU</a></p>\n"}], "owner": {"reputation": 41, "user_id": 4046566, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0035921b0001752e44b823c78accc97e?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4046566/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1954, "favorite_count": 0, "accepted_answer_id": 43225298, "answer_count": 3, "score": 1, "last_activity_date": 1491379335, "creation_date": 1491318265, "last_edit_date": 1491337218, "question_id": 43210961, "link": "https://stackoverflow.com/questions/43210961/golang-sorting-slice-of-interfaces", "title": "Golang sorting slice of interfaces", "body": "<p>I wrote a CLI tool in Golang to wrap an API and I love how simple it was to put together.  Now I want to incorporate another API with a different JSON structure to get similar values.  I created an interface for the structs to implement, but I don't quite understand how the type casting works in Golang.  </p>\n\n<p>Here is an example I put together: </p>\n\n<p>I have a common interface Vehicle that exposes some methods</p>\n\n<pre><code>type Vehicle interface {\n    Manufacturer() string\n    Model() string\n    Year() int\n    Color() string\n    String() string\n}\n</code></pre>\n\n<p>I also want to sort all structs that implement this interface so I added a Vehicles type that implements the sort interface</p>\n\n<pre><code>type Vehicles []Vehicle\n\nfunc (s Vehicles) Len() int {\n    return len(s)\n}\n\nfunc (s Vehicles) Less(i, j int) bool {\n    if s[i].Manufacturer() != s[j].Manufacturer() {\n        return s[i].Manufacturer() &lt; s[j].Manufacturer()\n    } else {\n        if s[i].Model() != s[j].Model() {\n            return s[i].Model() &lt; s[j].Model()\n        } else {\n            return s[i].Year() &lt; s[j].Year()\n        }\n    }\n}\n\nfunc (s Vehicles) Swap(i, j int) {\n    s[i], s[j] = s[j], s[i]\n}\n</code></pre>\n\n<p>The issue is when I implement the Vehicle interface with a new struct Car and try to sort a slice of Cars I get this exception</p>\n\n<pre><code>tmp/sandbox022796256/main.go:107: cannot use vehicles (type []Car) as type sort.Interface in argument to sort.Sort:\n    []Car does not implement sort.Interface (missing Len method)\n</code></pre>\n\n<p>Here is the full code: <a href=\"https://play.golang.org/p/KQb7mNXH01\" rel=\"nofollow noreferrer\">https://play.golang.org/p/KQb7mNXH01</a></p>\n\n<h2>Update:</h2>\n\n<p>@Andy Schweig provided a good answer to the problem I posed, but i should have been more explicit that I am unmarshalling JSON into a slice of Car structs so his solution doesn't work in this more explicit case\n( Please see the updated link to my code )</p>\n"}, {"tags": ["go", "compilation", "mips"], "comments": [{"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 4, "creation_date": 1491312437, "post_id": 43208366, "comment_id": 73488684, "body": "Which version of Go are you using? For me all your examples work. What is the log output when you compile with <code>-v</code>?"}, {"owner": {"reputation": 1366, "user_id": 4931643, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/702807200eaef92e4d1c6896893d7888?s=128&d=identicon&r=PG&f=1", "display_name": "Mbded", "link": "https://stackoverflow.com/users/4931643/mbded"}, "reply_to_user": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1491325344, "post_id": 43208366, "comment_id": 73498449, "body": "version is <code>go version go1.6 linux&#47;amd64</code> compiling using command <code>GOOS=linux GOARCH=mipsle go  build -v</code> give me this same information as above nothing more :("}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491325917, "post_id": 43208366, "comment_id": 73498766, "body": "You realize that go 1.8 is out now, which means that 1.6 is over a year old right?"}, {"owner": {"reputation": 1366, "user_id": 4931643, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/702807200eaef92e4d1c6896893d7888?s=128&d=identicon&r=PG&f=1", "display_name": "Mbded", "link": "https://stackoverflow.com/users/4931643/mbded"}, "edited": false, "score": 0, "creation_date": 1491329290, "post_id": 43208366, "comment_id": 73500717, "body": "Yeah... That was is. Oldest version golang a update to 1.8 and every works"}, {"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 2, "creation_date": 1491333520, "post_id": 43208366, "comment_id": 73503141, "body": "I&#39;m voting to close this question as off-topic because, it could be solved by installing the newest version of Go."}, {"owner": {"reputation": 151, "user_id": 700973, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rJ8fe.jpg?s=128&g=1", "display_name": "Marius", "link": "https://stackoverflow.com/users/700973/marius"}, "edited": false, "score": 0, "creation_date": 1540039069, "post_id": 43208366, "comment_id": 92722072, "body": "I&#39;m looking how to compile for this cpu: cpu model\t\t: MIPS 34Kc V5.6"}, {"owner": {"reputation": 68611, "user_id": 53897, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/2e71c1745ebc5401c8c8dfbf7c9a5d30?s=128&d=identicon&r=PG", "display_name": "Thorbj&#248;rn Ravn Andersen", "link": "https://stackoverflow.com/users/53897/thorbj%c3%b8rn-ravn-andersen"}, "reply_to_user": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1601018572, "post_id": 43208366, "comment_id": 113278602, "body": "@TheHippo It is not off-topic just because it has a simple solution."}], "answers": [{"tags": [], "owner": {"reputation": 1851, "user_id": 762175, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b0aa8cfe6ad2d1060dd861c28343c38c?s=128&d=identicon&r=PG", "display_name": "Ethan Reesor", "link": "https://stackoverflow.com/users/762175/ethan-reesor"}, "is_accepted": false, "score": 2, "last_activity_date": 1502674071, "creation_date": 1502674071, "answer_id": 45666344, "question_id": 43208366, "link": "https://stackoverflow.com/questions/43208366/golang-cross-compiling-for-mips/45666344#45666344", "title": "Golang. Cross Compiling for MIPS", "body": "<p>Go 1.6 does not support MIPS or MIPSLE. 1.6 supports MIPS64(LE). 1.8 supports MIPS(LE).</p>\n\n<p>From <a href=\"https://golang.org/doc/install/source\" rel=\"nofollow noreferrer\">https://golang.org/doc/install/source</a>:</p>\n\n<blockquote>\n  <ul>\n  <li>amd64 (also known as x86-64)\n  \n  <ul>\n  <li>A mature implementation.</li>\n  </ul></li>\n  <li>386 (x86 or x86-32)\n  \n  <ul>\n  <li>Comparable to the amd64 port.</li>\n  </ul></li>\n  <li>arm (ARM)\n  \n  <ul>\n  <li>Supports Linux, FreeBSD, NetBSD, OpenBSD and Darwin binaries. Less widely used than the other ports.</li>\n  </ul></li>\n  <li>arm64 (AArch64)\n  \n  <ul>\n  <li>Supports Linux and Darwin binaries. New in 1.5 and not as well exercised as other ports.</li>\n  </ul></li>\n  <li>ppc64, ppc64le (64-bit PowerPC big- and little-endian)\n  \n  <ul>\n  <li>Supports Linux binaries. New in 1.5 and not as well exercised as other ports.</li>\n  </ul></li>\n  <li>mips, mipsle (32-bit MIPS big- and little-endian)\n  \n  <ul>\n  <li>Supports Linux binaries. New in 1.8 and not as well exercised as other ports.</li>\n  </ul></li>\n  <li>mips64, mips64le (64-bit MIPS big- and little-endian)\n  \n  <ul>\n  <li>Supports Linux binaries. New in 1.6 and not as well exercised as other ports.</li>\n  </ul></li>\n  <li>s390x (IBM System z)\n  \n  <ul>\n  <li>Supports Linux binaries. New in 1.7 and not as well exercised as other ports.</li>\n  </ul></li>\n  </ul>\n</blockquote>\n"}], "owner": {"reputation": 1366, "user_id": 4931643, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/702807200eaef92e4d1c6896893d7888?s=128&d=identicon&r=PG&f=1", "display_name": "Mbded", "link": "https://stackoverflow.com/users/4931643/mbded"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9222, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1502674071, "creation_date": 1491311763, "last_edit_date": 1502536506, "question_id": 43208366, "link": "https://stackoverflow.com/questions/43208366/golang-cross-compiling-for-mips", "title": "Golang. Cross Compiling for MIPS", "body": "<p>I have tried compiling my simply program:</p>\n\n<pre><code>func main(){fmt.Printf(\"Hello\")}\n</code></pre>\n\n<p>to <strong>MIPS architecture</strong> on my PC wit 64 bit Debian Linux according to documentation</p>\n\n<p><a href=\"https://golang.org/doc/install/source#environment\" rel=\"nofollow noreferrer\">https://golang.org/doc/install/source#environment</a></p>\n\n<p>via using command</p>\n\n<pre><code>GOOS=linux GOARCH=mipsle go build \nGOOS=linux GOARCH=mips go build\n</code></pre>\n\n<p>Every time I get the error:</p>\n\n<blockquote>\n  <p>runtime/internal/sys compile</p>\n  \n  <p>unknown architecture \"mipsle(mips)\"</p>\n</blockquote>\n\n<p>The interesting thing is, if a try using command:</p>\n\n<pre><code>GOOS=linux GOARCH=mipsle64 go build\n</code></pre>\n\n<p>The program was build.</p>\n\n<p>Is it dependent on system OS on my PC ? How can I build a binary for MIPS or MIPSLE ?</p>\n"}, {"tags": ["go", "oauth", "oauth-2.0"], "answers": [{"tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": false, "score": 0, "last_activity_date": 1491317415, "creation_date": 1491317415, "answer_id": 43210619, "question_id": 43206889, "link": "https://stackoverflow.com/questions/43206889/develop-oauth2-application-using-golang-that-allows-signin-from-other-applcation/43210619#43210619", "title": "develop oauth2 application using golang that allows signin from other applcation", "body": "<p>I think there are a lot of packages to do it. For example <a href=\"https://github.com/go-oauth2/oauth2\" rel=\"nofollow noreferrer\">https://github.com/go-oauth2/oauth2</a></p>\n"}, {"comments": [{"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1491370948, "post_id": 43213146, "comment_id": 73515782, "body": "i want create a login which i can provide other apps to sign-in using my login.Can this be achieved using buffalo"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "reply_to_user": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1491375791, "post_id": 43213146, "comment_id": 73518334, "body": "Yes, but the OAuth part does not need the Buffalo package around it. It depends on what exactly you plan. If I understand you correct you plant something like <a href=\"https://auth0.com/\" rel=\"nofollow noreferrer\">auth0.com</a> ?"}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": true, "score": 0, "last_activity_date": 1491324417, "creation_date": 1491324417, "answer_id": 43213146, "question_id": 43206889, "link": "https://stackoverflow.com/questions/43206889/develop-oauth2-application-using-golang-that-allows-signin-from-other-applcation/43213146#43213146", "title": "develop oauth2 application using golang that allows signin from other applcation", "body": "<p>So there are a lot of packages. A very good package, which wraps all the different providers is <a href=\"https://github.com/markbates/goth\" rel=\"nofollow noreferrer\">goth</a>. I wrote a <a href=\"https://blog.gobuffalo.io/buffalo-tutorial-create-a-site-with-github-auth-629582e2763e\" rel=\"nofollow noreferrer\">short tutorial using goth with Buffalo</a>, which you could use an example.</p>\n"}], "owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 1, "accepted_answer_id": 43213146, "answer_count": 2, "score": 0, "last_activity_date": 1491324417, "creation_date": 1491307885, "question_id": 43206889, "link": "https://stackoverflow.com/questions/43206889/develop-oauth2-application-using-golang-that-allows-signin-from-other-applcation", "title": "develop oauth2 application using golang that allows signin from other applcation", "body": "<p>what is the best way to develop an application which allows clients to authenticate their user by logging into my application.\nLike we can do google sign in, i want give myapp signin.</p>\n"}, {"tags": ["go", "metrics", "prometheus"], "answers": [{"comments": [{"owner": {"reputation": 5639, "user_id": 1277048, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/tGJVH.jpg?s=128&g=1", "display_name": "FuzzyAmi", "link": "https://stackoverflow.com/users/1277048/fuzzyami"}, "edited": false, "score": 0, "creation_date": 1491308100, "post_id": 43206469, "comment_id": 73485279, "body": "and if you&#39;re wondering exactly how to do this, we&#39;ll need to know how you export metrics. one option would be to add custom metrics using Telegraf."}, {"owner": {"reputation": 2491, "user_id": 1117320, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/LA0T3.jpg?s=128&g=1", "display_name": "ambikanair", "link": "https://stackoverflow.com/users/1117320/ambikanair"}, "edited": false, "score": 0, "creation_date": 1491367511, "post_id": 43206469, "comment_id": 73514501, "body": "I am using client_golang and exporting using the Guage metric type. May I know how this can be done using the inbuilt Guage functionality. Right now I have something like this dockerVer = prometheus.NewGauge(prometheus.GaugeOpts{                 Name: &quot;docker_version_latency&quot;,                 Help: &quot;Latency of docker version command.&quot;,           })  I need to append additional info as well in the comment section.Say,  #Info On OS Version : xxxxx # HELP docker_version_latency Latency of docker version command. # TYPE docker_version_latency gauge docker_version_latency 35.9"}, {"owner": {"reputation": 5639, "user_id": 1277048, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/tGJVH.jpg?s=128&g=1", "display_name": "FuzzyAmi", "link": "https://stackoverflow.com/users/1277048/fuzzyami"}, "reply_to_user": {"reputation": 2491, "user_id": 1117320, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/LA0T3.jpg?s=128&g=1", "display_name": "ambikanair", "link": "https://stackoverflow.com/users/1117320/ambikanair"}, "edited": false, "score": 0, "creation_date": 1491372447, "post_id": 43206469, "comment_id": 73516433, "body": "I dont know how to edit the comments, but as explained above, you can add dimensions (or &quot;labels&quot;) to metrics. I edited my answer to include a link to an example for the golang client."}], "tags": [], "owner": {"reputation": 5639, "user_id": 1277048, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/tGJVH.jpg?s=128&g=1", "display_name": "FuzzyAmi", "link": "https://stackoverflow.com/users/1277048/fuzzyami"}, "is_accepted": false, "score": 2, "last_activity_date": 1491372371, "last_edit_date": 1491372371, "creation_date": 1491306743, "answer_id": 43206469, "question_id": 43206171, "link": "https://stackoverflow.com/questions/43206171/prometheus-how-to-include-comments-in-metrics/43206469#43206469", "title": "Prometheus - How to include comments in metrics", "body": "<p>Whatever additional info you want to slap on top of the metric, add it as dimensions (labels, in Prometheus's lingo). That way the same metrics can be used across your entire infrastructure, but you can slice them anyway you want. for example,\nthe CPU_usage_percent metric can be enriched with the 'cloud_zone' dimension to specify which cloud it belongs to: </p>\n\n<pre><code>CPU_usage_percent{cloud_zone:\u201dNYC\u201d, application_name:\u201dvideo-server\u201d}, 5, 1487578310 //example of a metric from zone NYC\n</code></pre>\n\n<p>and then you can slice it in Prometheus with queries like:</p>\n\n<pre><code>CPU_usage_percent{cloud_zone=\"NYC\"}\n</code></pre>\n\n<p>and get only the metrics you want. or their sum/average/etc.\nin sense, these are self-documenting.</p>\n\n<p>I shamelessly point you to my <a href=\"https://blog.kik.com/2017/03/03/monitoring-ephemeral-cloud-infrastructure-kiks-video-service/\" rel=\"nofollow noreferrer\">article</a> which explains this in more detail.</p>\n\n<p>An somewhat alternative approach - ie rather than adding a dimension to an existing metric - you could just export these as new metrics, with <em>bogus</em> values (values are limited to numeric values) and encode the value in a dimension.</p>\n\n<pre><code>kernel_version 0 {ip_addr:\u201d1.1.1.1\u201d, version:\"the actual kernel value\"}\n</code></pre>\n\n<p>EDIT: how to add dimensions with the golang_client:\nrefer to this code - it shows how to add labels and then populate them (in line 68)- <a href=\"https://github.com/prometheus/client_golang/blob/master/prometheus/examples_test.go#L51\" rel=\"nofollow noreferrer\">https://github.com/prometheus/client_golang/blob/master/prometheus/examples_test.go#L51</a></p>\n"}], "owner": {"reputation": 2491, "user_id": 1117320, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/LA0T3.jpg?s=128&g=1", "display_name": "ambikanair", "link": "https://stackoverflow.com/users/1117320/ambikanair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 576, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1491372371, "creation_date": 1491305964, "question_id": 43206171, "link": "https://stackoverflow.com/questions/43206171/prometheus-how-to-include-comments-in-metrics", "title": "Prometheus - How to include comments in metrics", "body": "<p>I want to add dynamic comments to metrics which gives some info on the service. Something like OS version, kernel version etc. How can I include this in the Guage metric type.\nI am able to add HELP and TYPE but not the OS version. </p>\n\n<pre><code>**OS version is xxxx**\n\n# HELP http_request_duration_seconds A histogram of the request duration.\n# TYPE http_request_duration_seconds histogram\n</code></pre>\n"}, {"tags": ["go", "scalability"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1491324550, "post_id": 43205224, "comment_id": 73497989, "body": "The scalability of Go is vastly superior to Node. A compiled language will (almost) always outperform an interpreted one."}], "answers": [{"tags": [], "owner": {"reputation": 91104, "user_id": 613198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0a8a4fb43f9c19b3391a7b1066d491f?s=128&d=identicon&r=PG", "display_name": "rsp", "link": "https://stackoverflow.com/users/613198/rsp"}, "is_accepted": true, "score": 5, "last_activity_date": 1491305066, "creation_date": 1491305066, "answer_id": 43205854, "question_id": 43205224, "link": "https://stackoverflow.com/questions/43205224/building-a-restful-api-with-high-scalability/43205854#43205854", "title": "Building a RESTful API with high scalability", "body": "<p>It is doable in Go and it is doable in Node. It is doable in other languages like Erlang or Python as well. But since you're asking about Node then this is what I'll answer about.</p>\n\n<p>The most important thing for high concurrency in Node is to never block the event loop or do any blocking operation ever (unless it's the first tick of the event loop). This is the number one thing that people do and ruin the concurrency - like putting a little innocent-looking <code>fs.statSync()</code> now and then (see <a href=\"https://stackoverflow.com/questions/5823722/how-to-serve-an-image-using-nodejs/40899767#40899767\">this answer</a> for examples of such mistakes right in the <strong>answers</strong> on Stack Overflow). Using any blocking operation (including long running <code>for</code> or <code>while</code> loop) after the first tick is always a mistake and in fact I think it should throw exceptions.</p>\n\n<p>Another thing that while not being an outright mistake in all situations may still harm the scalability is storing any state in your application. If you need to have any persistent state (and try to minimize that need at all cost) then you should use a database for that. For data that needs to be shared between requests quickly like session data you should use a fast database like Redis, but only if you cannot achieve the same with things like JWT etc.</p>\n\n<p>Prefer horizontal instead of vertical scalability, because at some point there will be no bigger server, but there will always be more servers.</p>\n\n<p>To sum it up:</p>\n\n<ol>\n<li>Never block the event loop</li>\n<li>Do all CPU-heavy computations in external processes</li>\n<li>Never block the event loop</li>\n<li>Use Redis or Memcached for shared state</li>\n<li>Never block the event loop</li>\n<li>Use clustering for horizontal scalability</li>\n<li>Never block the event loop</li>\n</ol>\n\n<p>Did I mention never blocking the event loop?</p>\n"}, {"tags": [], "owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "is_accepted": false, "score": 1, "last_activity_date": 1491305574, "creation_date": 1491305574, "answer_id": 43206044, "question_id": 43205224, "link": "https://stackoverflow.com/questions/43205224/building-a-restful-api-with-high-scalability/43206044#43206044", "title": "Building a RESTful API with high scalability", "body": "<p>First of all using the \"net/http\" package has everything you need to impelement a simple router and even custom middlewares (like auth), using routing frameworks for simple routing is not very efficient. And you could design the application to support multiple instances on multiple servers.</p>\n\n<p>Here is an example of mine in Go:  <a href=\"https://github.com/efimovalex/EventKitAPI/tree/master/consumerapi\" rel=\"nofollow noreferrer\">https://github.com/efimovalex/EventKitAPI/tree/master/consumerapi</a> that uses an in memory worker pool </p>\n"}], "owner": {"reputation": 515, "user_id": 5981599, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f07d949b47e83927035a030a9356bb95?s=128&d=identicon&r=PG", "display_name": "azekirel555", "link": "https://stackoverflow.com/users/5981599/azekirel555"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1316, "favorite_count": 0, "closed_date": 1491329548, "accepted_answer_id": 43205854, "answer_count": 2, "score": 2, "last_activity_date": 1491311059, "creation_date": 1491303346, "last_edit_date": 1491311059, "question_id": 43205224, "link": "https://stackoverflow.com/questions/43205224/building-a-restful-api-with-high-scalability", "closed_reason": "Opinion-based", "title": "Building a RESTful API with high scalability", "body": "<p>I'm looking to build a RESTful API that would be in charge of inserting datas based on the data sent by multiple mobile apps (stored in an Amazon redshift database).</p>\n\n<p>I've already developed an API that you can find here: <a href=\"https://github.com/Noeru14/fms\" rel=\"nofollow noreferrer\">https://github.com/Noeru14/fms</a>. It uses Gin: <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow noreferrer\">https://github.com/gin-gonic/gin</a>. If I opened too many parallel connections, it used to crash / not work properly.</p>\n\n<p>A friend of mine has talked about using Node instead as it allows to have really short client-server interaction.</p>\n\n<p>I'd like to know which factors I'd have to take into account to build a RESTful API that could handle up to hundreds of thousands requests per second with Go and Node. Do you also know if it's doable in Golang ?</p>\n\n<p>Thanks a lot.</p>\n"}, {"tags": ["serialization", "go", "encoding", "binary", "gob"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1491311046, "post_id": 43199137, "comment_id": 73487548, "body": "If you absolutely need to use <code>gob</code> I would suggest using boltdb. Write a hook for your logger and log them into boltdb. Also moving boltdb file around is easy since it&#39;s just a file - you can also create new boltdb files based on size or time or level. If you absolutely need plain files, I suggest using lumberjack and write a hook for your logger to transform entries to base64. Anyway using gob make analytical and monitoring hard, so InfluxDB or Prometheus are also valid options."}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 7594540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/knf91.jpg?s=128&g=1", "display_name": "Frank", "link": "https://stackoverflow.com/users/7594540/frank"}, "edited": false, "score": 0, "creation_date": 1585054552, "post_id": 43199852, "comment_id": 107626406, "body": "if the data is homogeneous, then you can use my approach with the separation of the header from the file with encode through a mediocre structure"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1538855903, "last_edit_date": 1538855903, "creation_date": 1491287402, "answer_id": 43199852, "question_id": 43199137, "link": "https://stackoverflow.com/questions/43199137/use-gob-to-write-logs-to-a-file-in-an-append-style/43199852#43199852", "title": "Use Gob to write logs to a file in an append style", "body": "<p>The <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow noreferrer\"><code>gob</code></a> package wasn't designed to be used this way. A gob stream has to be written by a single <a href=\"https://golang.org/pkg/encoding/gob/#Encoder\" rel=\"nofollow noreferrer\"><code>gob.Encoder</code></a>, and it also has to be read by a single <a href=\"https://golang.org/pkg/encoding/gob/#Decoder\" rel=\"nofollow noreferrer\"><code>gob.Decoder</code></a>.</p>\n\n<p>The reason for this is because the <code>gob</code> package not only serializes the values you pass to it, it also transmits data to describe their types:</p>\n\n<blockquote>\n  <p>A stream of gobs is self-describing. Each data item in the stream is preceded by a specification of its type, expressed in terms of a small set of predefined types.</p>\n</blockquote>\n\n<p>This is a state of the encoder / decoder\u2013about what types and how they have been transmitted\u2013, a subsequent new encoder / decoder will not (cannot) analyze the \"preceeding\" stream to reconstruct the same state and continue where a previous encoder / decoder left off.</p>\n\n<p>Of course if you create a single <code>gob.Encoder</code>, you may use it to serialize as many values as you'd like to.</p>\n\n<p>Also you can create a <code>gob.Encoder</code> and write to a file, and then later create a new <code>gob.Encoder</code>, and append to the same file, <strong>but</strong> you must use 2 <code>gob.Decoder</code>s to read those values, exactly matching the encoding process.</p>\n\n<p>As a demonstration, let's follow an example. This example will write to an in-memory buffer (<a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"nofollow noreferrer\"><code>bytes.Buffer</code></a>). 2 subsequent encoders will write to it, then we will use 2 subsequent decoders to read the values. We'll write values of this struct:</p>\n\n<pre><code>type Point struct {\n    X, Y int\n}\n</code></pre>\n\n<p>For short, compact code, I use this \"error handler\" function:</p>\n\n<pre><code>func he(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>And now the code:</p>\n\n<pre><code>const n, m = 3, 2\nbuf := &amp;bytes.Buffer{}\n\ne := gob.NewEncoder(buf)\nfor i := 0; i &lt; n; i++ {\n    he(e.Encode(&amp;Point{X: i, Y: i * 2}))\n}\n\ne = gob.NewEncoder(buf)\nfor i := 0; i &lt; m; i++ {\n    he(e.Encode(&amp;Point{X: i, Y: 10 + i}))\n}\n\nd := gob.NewDecoder(buf)\nfor i := 0; i &lt; n; i++ {\n    var p *Point\n    he(d.Decode(&amp;p))\n    fmt.Println(p)\n}\n\nd = gob.NewDecoder(buf)\nfor i := 0; i &lt; m; i++ {\n    var p *Point\n    he(d.Decode(&amp;p))\n    fmt.Println(p)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/Boqlix1QMr\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&amp;{0 0}\n&amp;{1 2}\n&amp;{2 4}\n&amp;{0 10}\n&amp;{1 11}\n</code></pre>\n\n<p>Note that if we'd use only 1 decoder to read all the values (looping until <code>i &lt; n + m</code>, we'd get the same error message you posted in your question when the iteration reaches <code>n + 1</code>, because the subsequent data is not a serialized <code>Point</code>, but the start of a new <code>gob</code> stream.</p>\n\n<p>So if you want to stick with the <code>gob</code> package for doing what you want to do, you have to slightly modify, <em>enhance</em> your encoding / decoding process. You have to somehow <em>mark the boundaries</em> when a new encoder is used (so when decoding, you'll know you have to create a new decoder to read subsequent values).</p>\n\n<p>You may use different techniques to achieve this: </p>\n\n<ul>\n<li>You may write out a number, a count before you proceed to write values, and this number would tell how many values were written using the current encoder.</li>\n<li>If you don't want to or can't tell how many values will be written with the current encoder, you may opt to write out a special <em>end-of-encoder</em> value when you don't write more values with the current encoder. When decoding, if you encounter this special <em>end-of-encoder</em> value, you'll know you have to create a new decoder to be able to read more values.</li>\n</ul>\n\n<p>Some things to note here:</p>\n\n<ul>\n<li>The <code>gob</code> package is most efficient, most <em>compact</em> if only a single encoder is used, because each time you create and use a new encoder, the type specifications will have to be re-transmitted, causing more overhead, and making the encoding / decoding process slower.</li>\n<li>You can't seek in the data stream, you can only decode any value if you read the whole file from the beginning up until the value you want. Note that this somewhat applies even if you use other formats (such as JSON or XML).</li>\n</ul>\n\n<p>If you want seeking functionality, you'd need to manage an <em>index</em> file separately, which would tell at which positions new encoders / decoders start, so you could seek to that position, create a new decoder, and start reading values from there.</p>\n\n<p>Check a related question: <a href=\"https://stackoverflow.com/questions/37618399/efficient-go-serialization-of-struct-to-disk/37620399#37620399\">Efficient Go serialization of struct to disk</a></p>\n"}, {"comments": [{"owner": {"reputation": 91, "user_id": 7594540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/knf91.jpg?s=128&g=1", "display_name": "Frank", "link": "https://stackoverflow.com/users/7594540/frank"}, "edited": false, "score": 0, "creation_date": 1585039300, "post_id": 59409766, "comment_id": 107619700, "body": "I have slightly reduced your option in my answer using a separate structure"}], "tags": [], "owner": {"reputation": 4835, "user_id": 512378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/214e767631bd5a3ddc524639ad126735?s=128&d=identicon&r=PG", "display_name": "martinezdelariva", "link": "https://stackoverflow.com/users/512378/martinezdelariva"}, "is_accepted": false, "score": 0, "last_activity_date": 1576758262, "creation_date": 1576758262, "answer_id": 59409766, "question_id": 43199137, "link": "https://stackoverflow.com/questions/43199137/use-gob-to-write-logs-to-a-file-in-an-append-style/59409766#59409766", "title": "Use Gob to write logs to a file in an append style", "body": "<p>Additionally to great icza answer, you could use the following trick to append to a gob file with already written data: when append the first time write and discard the first encode:</p>\n\n<ol>\n<li>Create the file Encode gob as usual (first encode write headers)</li>\n<li>Close file </li>\n<li>Open file for <em>append</em> </li>\n<li>Using and intermediate writer encode dummy struct (which write headers) </li>\n<li>Reset the writer </li>\n<li>Encode gob as usual (writes no headers)</li>\n</ol>\n\n<p>Example:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/gob\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n)\n\ntype Record struct {\n    ID   int\n    Body string\n}\n\nfunc main() {\n    r1 := Record{ID: 1, Body: \"abc\"}\n    r2 := Record{ID: 2, Body: \"def\"}\n\n    // encode r1\n    var buf1 bytes.Buffer\n    enc := gob.NewEncoder(&amp;buf1)\n    err := enc.Encode(r1)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // write to file\n    err = ioutil.WriteFile(\"/tmp/log.gob\", buf1.Bytes(), 0600)\n    if err != nil {\n        log.Fatal()\n    }\n\n    // encode dummy (which write headers)\n    var buf2 bytes.Buffer\n    enc = gob.NewEncoder(&amp;buf2)\n    err = enc.Encode(Record{})\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // remove dummy\n    buf2.Reset()\n\n    // encode r2\n    err = enc.Encode(r2)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // open file\n    f, err := os.OpenFile(\"/tmp/log.gob\", os.O_WRONLY|os.O_APPEND, 0600)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // write r2\n    _, err = f.Write(buf2.Bytes())\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // decode file\n    data, err := ioutil.ReadFile(\"/tmp/log.gob\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    var r Record\n    dec := gob.NewDecoder(bytes.NewReader(data))\n    for {\n        err = dec.Decode(&amp;r)\n        if err == io.EOF {\n            break\n        }\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Println(r)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 91, "user_id": 7594540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/knf91.jpg?s=128&g=1", "display_name": "Frank", "link": "https://stackoverflow.com/users/7594540/frank"}, "is_accepted": false, "score": 0, "last_activity_date": 1585054268, "last_edit_date": 1585054268, "creation_date": 1585039108, "answer_id": 60827466, "question_id": 43199137, "link": "https://stackoverflow.com/questions/43199137/use-gob-to-write-logs-to-a-file-in-an-append-style/60827466#60827466", "title": "Use Gob to write logs to a file in an append style", "body": "<p>In addition to the above, I suggest using an intermediate structure to exclude the gob header:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/gob\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n)\n\ntype Point struct {\n    X, Y int\n}\n\nfunc main() {\n    buf := new(bytes.Buffer)\n    enc, _, err := NewEncoderWithoutHeader(buf, new(Point))\n    if err != nil {\n        log.Fatal(err)\n    }\n    enc.Encode(&amp;Point{10, 10})\n    fmt.Println(buf.Bytes())\n}\n\n\ntype HeaderSkiper struct {\n    src io.Reader\n    dst io.Writer\n}\n\nfunc (hs *HeaderSkiper) Read(p []byte) (int, error) {\n    return hs.src.Read(p)\n}\n\nfunc (hs *HeaderSkiper) Write(p []byte) (int, error) {\n    return hs.dst.Write(p)\n}\n\nfunc NewEncoderWithoutHeader(w io.Writer, sample interface{}) (*gob.Encoder, *bytes.Buffer, error) {\n    hs := new(HeaderSkiper)\n    hdr := new(bytes.Buffer)\n    hs.dst = hdr\n\n    enc := gob.NewEncoder(hs)\n    // Write sample with header info\n    if err := enc.Encode(sample); err != nil {\n        return nil, nil, err\n    }\n    // Change writer\n    hs.dst = w\n    return enc, hdr, nil\n}\n\nfunc NewDecoderWithoutHeader(r io.Reader, hdr *bytes.Buffer, dummy interface{}) (*gob.Decoder, error) {\n    hs := new(HeaderSkiper)\n    hs.src = hdr\n\n    dec := gob.NewDecoder(hs)\n    if err := dec.Decode(dummy); err != nil {\n        return nil, err\n    }\n\n    hs.src = r\n    return dec, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 5764, "user_id": 1336532, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/93e5830761f6e85757991d5915369349?s=128&d=identicon&r=PG", "display_name": "Mahoni", "link": "https://stackoverflow.com/users/1336532/mahoni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1051, "favorite_count": 1, "accepted_answer_id": 43199852, "answer_count": 3, "score": 5, "last_activity_date": 1585054268, "creation_date": 1491284683, "last_edit_date": 1491293021, "question_id": 43199137, "link": "https://stackoverflow.com/questions/43199137/use-gob-to-write-logs-to-a-file-in-an-append-style", "title": "Use Gob to write logs to a file in an append style", "body": "<p>Would it be possible to use Gob encoding for appending structs in series to the same file using append? It works for writing, but when reading with the decoder more than once I run into:</p>\n\n<pre><code>extra data in buffer\n</code></pre>\n\n<p>So I wonder if that's possible in the first place or whether I should use something like JSON to append JSON documents on a per line basis instead. Because the alternative would be to serialize a slice, but then again reading it as a whole would defeat the purpose of append.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "edited": false, "score": 0, "creation_date": 1491287157, "post_id": 43198959, "comment_id": 73471408, "body": "Related/possible duplicate : <a href=\"http://stackoverflow.com/questions/6395076/in-golang-using-reflect-how-do-you-set-the-value-of-a-struct-field\">in golang, using reflect, how do you set the value of a struct field?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "is_accepted": true, "score": 2, "last_activity_date": 1491286864, "creation_date": 1491286864, "answer_id": 43199680, "question_id": 43198959, "link": "https://stackoverflow.com/questions/43198959/how-do-i-append-to-a-slice-with-reflect/43199680#43199680", "title": "How do I append to a slice with reflect?", "body": "<p>Use <code>&amp;s</code> to obtain addressable <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>Value</code></a> of your struct :</p>\n\n<pre><code>c := reflect.ValueOf(s).FieldByName(\"Children\")\nnewSlice := reflect.Append(c, reflect.ValueOf(\"Jane\"))\nreflect.ValueOf(&amp;s).Elem().FieldByName(\"Children\").Set(newSlice)\nfmt.Printf(\"%v\", s)\n//output:\n//{Bob [Tom Jane]}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/y3t7mC4Lqi\" rel=\"nofollow noreferrer\">https://play.golang.org/p/y3t7mC4Lqi</a></p>\n"}], "owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 980, "favorite_count": 0, "accepted_answer_id": 43199680, "answer_count": 1, "score": 1, "last_activity_date": 1491286864, "creation_date": 1491283887, "question_id": 43198959, "link": "https://stackoverflow.com/questions/43198959/how-do-i-append-to-a-slice-with-reflect", "title": "How do I append to a slice with reflect?", "body": "<p>I am trying to do this:</p>\n\n<pre><code>type S struct {\n    Name string\n    Children []interface{}\n}\n\nfunc main() {\n    s := S{Name: \"Bob\", Children: []interface{}{}}\n    fmt.Println(\"%v\", s)\n\n    s.Children = append(s.Children, \"Tom\")\n    fmt.Println(\"%v\", s)\n\n    // How do I do the above line with reflect? To add \"Jane\"?\n    c := reflect.ValueOf(s).FieldByName(\"Children\")\n    newSlice := reflect.Append(c, reflect.ValueOf(\"Jane\"))\n    reflect.ValueOf(s).FieldByName(\"Children\").Set(newSlice)\n    fmt.Println(\"%v\", s)\n}\n</code></pre>\n\n<p>But I am getting the error:</p>\n\n<pre><code>panic: reflect: reflect.Value.Set using unaddressable value\n</code></pre>\n\n<p>What am I doing wrong?</p>\n\n<p><a href=\"https://play.golang.org/p/Fwy_AAF-Ls\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Fwy_AAF-Ls</a></p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-endpoints"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491323904, "post_id": 43196287, "comment_id": 73497593, "body": "Is this what you are looking for? <a href=\"https://godoc.org/github.com/GoogleCloudPlatform/go-endpoints/endpoints\" rel=\"nofollow noreferrer\">godoc.org/github.com/GoogleCloudPlatform/go-endpoints/endpoi&zwnj;&#8203;nts</a>"}, {"owner": {"reputation": 147, "user_id": 5728873, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/R37ba.jpg?s=128&g=1", "display_name": "Dheeraj Sarwaiya", "link": "https://stackoverflow.com/users/5728873/dheeraj-sarwaiya"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1491340556, "post_id": 43196287, "comment_id": 73506881, "body": "No.. this you cant use in standard environment. It doesn&#39;t work. Please let me know if somehow you managed it to work. Thanks"}, {"owner": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "edited": false, "score": 0, "creation_date": 1491427438, "post_id": 43196287, "comment_id": 73553948, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/40513743/are-cloud-endpoints-with-go-google-app-engine-standard-possible\">Are Cloud Endpoints with Go Google App Engine Standard possible?</a>"}, {"owner": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "edited": false, "score": 0, "creation_date": 1491427484, "post_id": 43196287, "comment_id": 73553976, "body": "Sadly, I think the answer is currently No."}, {"owner": {"reputation": 147, "user_id": 5728873, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/R37ba.jpg?s=128&g=1", "display_name": "Dheeraj Sarwaiya", "link": "https://stackoverflow.com/users/5728873/dheeraj-sarwaiya"}, "reply_to_user": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "edited": false, "score": 0, "creation_date": 1492668807, "post_id": 43196287, "comment_id": 74076921, "body": "@ChrisDrew what about these examples?  <a href=\"https://github.com/GoogleCloudPlatform/go-endpoints\" rel=\"nofollow noreferrer\">github.com/GoogleCloudPlatform/go-endpoints</a>  <a href=\"https://github.com/googlesamples/cloud-polymer-go\" rel=\"nofollow noreferrer\">github.com/googlesamples/cloud-polymer-go</a>"}], "owner": {"reputation": 147, "user_id": 5728873, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/R37ba.jpg?s=128&g=1", "display_name": "Dheeraj Sarwaiya", "link": "https://stackoverflow.com/users/5728873/dheeraj-sarwaiya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1539493730, "creation_date": 1491264713, "last_edit_date": 1539493730, "question_id": 43196287, "link": "https://stackoverflow.com/questions/43196287/google-endpoint-in-golang-standard-environment", "title": "Google endpoint in Golang standard Environment", "body": "<p>I have developed an application using Google App Engine's Standard environment in Golang. Now I want to use Google Endpoint to use the same backhand for developing Android and IOS app. However, it seeps google do not support endpoint in golang standard environment.</p>\n\n<p>Is there a work around for this without actually getting into Flexi environment? I am afraid that if I have to move into Flexi Environment then I had to rewrite lot of code.</p>\n\n<p><a href=\"https://cloud.google.com/endpoints/docs/quickstarts-app-engine-standard\" rel=\"nofollow noreferrer\">https://cloud.google.com/endpoints/docs/quickstarts-app-engine-standard</a></p>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 3, "creation_date": 1491259413, "post_id": 43195476, "comment_id": 73463732, "body": "This is a compile time error, there is nothing to &quot;catch&quot; and print because you&#39;ll never get to run this."}, {"owner": {"reputation": 13, "user_id": 2804894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e19b1519485c7eafa0d76dfaba2c59d8?s=128&d=identicon&r=PG&f=1", "display_name": "user2804894", "link": "https://stackoverflow.com/users/2804894/user2804894"}, "reply_to_user": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 0, "creation_date": 1491259737, "post_id": 43195476, "comment_id": 73463828, "body": "Thanks Verran I thought so."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1491259995, "creation_date": 1491259995, "answer_id": 43195609, "question_id": 43195476, "link": "https://stackoverflow.com/questions/43195476/golang-error-handling-types-mismatched/43195609#43195609", "title": "golang error handling types mismatched", "body": "<p>Trying to add two different types in Go is a compile-time error. The program will never compile, and therefore never run, so there's nothing to catch--except when writing your program.</p>\n\n<p>You'll only check <code>err</code> when it's returned from a function. You have no function here, so your <code>err</code> is never set (aside from the fact that your code won't compile).</p>\n\n<p>This is different from languages like JavaScript or Perl, which don't have strict type checking, so you do get runtime errors with things like this.</p>\n"}], "owner": {"reputation": 13, "user_id": 2804894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e19b1519485c7eafa0d76dfaba2c59d8?s=128&d=identicon&r=PG&f=1", "display_name": "user2804894", "link": "https://stackoverflow.com/users/2804894/user2804894"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1491259995, "creation_date": 1491259239, "last_edit_date": 1491259459, "question_id": 43195476, "link": "https://stackoverflow.com/questions/43195476/golang-error-handling-types-mismatched", "title": "golang error handling types mismatched", "body": "<p>I trying to learn error handling in golang to understand how error handling works. I have the following code: </p>\n\n<pre><code>var a int8\nvar b int32    \nvar err error\nc := a + b //types mismatched error\nif err != nil {\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>when I try to run this from within vim with <code>:GoRun</code> I get types mismatched error.</p>\n\n<p>My question is how do I catch that error and print message to screen if this is even possible as the error occurs during compiling?  </p>\n"}, {"tags": ["go", "arm"], "comments": [{"owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "edited": false, "score": 4, "creation_date": 1491253847, "post_id": 43193685, "comment_id": 73461546, "body": "This definitely belongs on the <a href=\"https://github.com/golang/go/issues\" rel=\"nofollow noreferrer\">golang issue tracker</a>."}, {"owner": {"reputation": 582, "user_id": 139673, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f2b82b95491bc5a64840a3841a722e5b?s=128&d=identicon&r=PG", "display_name": "plastic chris", "link": "https://stackoverflow.com/users/139673/plastic-chris"}, "reply_to_user": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "edited": false, "score": 0, "creation_date": 1491267046, "post_id": 43193685, "comment_id": 73465629, "body": "Ok thanks, I&#39;ll copy it there."}], "answers": [{"tags": [], "owner": {"reputation": 582, "user_id": 139673, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f2b82b95491bc5a64840a3841a722e5b?s=128&d=identicon&r=PG", "display_name": "plastic chris", "link": "https://stackoverflow.com/users/139673/plastic-chris"}, "is_accepted": false, "score": 1, "last_activity_date": 1493149665, "creation_date": 1493149665, "answer_id": 43619684, "question_id": 43193685, "link": "https://stackoverflow.com/questions/43193685/why-does-go-v1-8-fail-to-allocate-heap-bitmap-on-armv7-when-importing-zmq4/43619684#43619684", "title": "Why does go v1.8 fail to allocate heap bitmap on armv7 when importing zmq4?", "body": "<p>Fixed by <a href=\"https://github.com/golang/go/commit/bb6309cd63b35a81a8527efaad58847a83039947\" rel=\"nofollow noreferrer\">https://github.com/golang/go/commit/bb6309cd63b35a81a8527efaad58847a83039947</a></p>\n\n<p>libzmq must contain some global constructors which adjust the process memory map before the go runtime starts.</p>\n"}], "owner": {"reputation": 582, "user_id": 139673, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f2b82b95491bc5a64840a3841a722e5b?s=128&d=identicon&r=PG", "display_name": "plastic chris", "link": "https://stackoverflow.com/users/139673/plastic-chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1493149665, "creation_date": 1491251365, "question_id": 43193685, "link": "https://stackoverflow.com/questions/43193685/why-does-go-v1-8-fail-to-allocate-heap-bitmap-on-armv7-when-importing-zmq4", "title": "Why does go v1.8 fail to allocate heap bitmap on armv7 when importing zmq4?", "body": "<p>I'm using go v1.8 on an armv7 target and everything works until I import zeromq, and then not even this works:</p>\n\n<pre><code>package main\n\nimport (\n    zmq \"github.com/pebbe/zmq4\"\n    \"fmt\"\n)\n\nfunc main() {\nfmt.Println(zmq.Version())\n}\n</code></pre>\n\n<p>Running it on the target gives the following:</p>\n\n<pre><code>./zmq \nfatal error: runtime: out of memory\n\nruntime stack:\nruntime.throw(0xc8d3d, 0x16)\n        /usr/lib/go/src/runtime/panic.go:596 +0x70 fp=0x7eb018a0 sp=0x7eb01894\nruntime.sysMap(0x6d752000, 0x74d4000, 0x1, 0x146b60)\n        /usr/lib/go/src/runtime/mem_linux.go:227 +0xb0 fp=0x7eb018c4 sp=0x7eb018a0\nruntime.(*mheap).mapBits(0x139d58, 0x74d26000)\n        /usr/lib/go/src/runtime/mbitmap.go:159 +0x94 fp=0x7eb018dc sp=0x7eb018c4\nruntime.(*mheap).sysAlloc(0x139d58, 0x100000, 0x30414)\n        /usr/lib/go/src/runtime/malloc.go:428 +0x2dc fp=0x7eb0191c sp=0x7eb018dc\nruntime.(*mheap).grow(0x139d58, 0x8, 0x0)\n        /usr/lib/go/src/runtime/mheap.go:774 +0xd0 fp=0x7eb0194c sp=0x7eb0191c\nruntime.(*mheap).allocSpanLocked(0x139d58, 0x1, 0x0)\n        /usr/lib/go/src/runtime/mheap.go:678 +0x468 fp=0x7eb0196c sp=0x7eb0194c\nruntime.(*mheap).alloc_m(0x139d58, 0x1, 0x10, 0x0, 0x0)\n        /usr/lib/go/src/runtime/mheap.go:562 +0xdc fp=0x7eb019a4 sp=0x7eb0196c\nruntime.(*mheap).alloc.func1()\n        /usr/lib/go/src/runtime/mheap.go:627 +0x3c fp=0x7eb019c0 sp=0x7eb019a4\nruntime.systemstack(0x7eb019d4)\n        /usr/lib/go/src/runtime/asm_arm.s:278 +0xa8 fp=0x7eb019c4 sp=0x7eb019c0\nruntime.(*mheap).alloc(0x139d58, 0x1, 0x10, 0x100, 0x1)\n        /usr/lib/go/src/runtime/mheap.go:628 +0x60 fp=0x7eb019ec sp=0x7eb019c4\nruntime.(*mcentral).grow(0x13ab98, 0x0)\n        /usr/lib/go/src/runtime/mcentral.go:212 +0x84 fp=0x7eb01a18 sp=0x7eb019ec\nruntime.(*mcentral).cacheSpan(0x13ab98, 0x146b68)\n        /usr/lib/go/src/runtime/mcentral.go:93 +0x104 fp=0x7eb01a5c sp=0x7eb01a18\nruntime.(*mcache).refill(0x649e5000, 0x10, 0x146b68)\n        /usr/lib/go/src/runtime/mcache.go:122 +0x7c fp=0x7eb01a70 sp=0x7eb01a5c\nruntime.(*mcache).nextFree.func1()\n        /usr/lib/go/src/runtime/malloc.go:525 +0x24 fp=0x7eb01a80 sp=0x7eb01a70\nruntime.systemstack(0x7eb01aa4)\n        /usr/lib/go/src/runtime/asm_arm.s:278 +0xa8 fp=0x7eb01a84 sp=0x7eb01a80\nruntime.(*mcache).nextFree(0x649e5000, 0x649e5010, 0x7eb01acc, 0x1ebd4, 0x21c40)\n        /usr/lib/go/src/runtime/malloc.go:526 +0x9c fp=0x7eb01ab0 sp=0x7eb01a84\nruntime.mallocgc(0xf0, 0xc2548, 0x1, 0x64a26001)\n        /usr/lib/go/src/runtime/malloc.go:678 +0x8c0 fp=0x7eb01b08 sp=0x7eb01ab0\nruntime.newobject(0xc2548, 0x1384a0)\n        /usr/lib/go/src/runtime/malloc.go:807 +0x2c fp=0x7eb01b1c sp=0x7eb01b08\nruntime.malg(0x8000, 0x2710)\n        /usr/lib/go/src/runtime/proc.go:2821 +0x1c fp=0x7eb01b38 sp=0x7eb01b1c\nruntime.mpreinit(0x138730)\n        /usr/lib/go/src/runtime/os_linux.go:302 +0x1c fp=0x7eb01b44 sp=0x7eb01b38\nruntime.mcommoninit(0x138730)\n        /usr/lib/go/src/runtime/proc.go:540 +0x94 fp=0x7eb01b5c sp=0x7eb01b44\nruntime.schedinit()\n        /usr/lib/go/src/runtime/proc.go:476 +0x40 fp=0x7eb01b78 sp=0x7eb01b5c\nruntime.rt0_go(0x7eb01d14, 0x76ee4000, 0x7eb01d14, 0x1, 0x5cd10, 0x7eb01c58, 0x76f8e000, 0xcef6f281, 0xc6a63e08, 0x128, ...)\n        /usr/lib/go/src/runtime/asm_arm.s:61 +0x84 fp=0x7eb01bb8 sp=0x7eb01b78\n</code></pre>\n\n<p>Tracing shows the offending mmap:</p>\n\n<pre><code>mmap2(0x74c54000, 1048576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x74c54000\nmmap2(0x6d77e000, 122511360, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = -1 ENOMEM (Cannot allocate memory)\n</code></pre>\n\n<p>The first one is right, that's the chunk size, but the second is where it allocates the bitmap. It should be probably 16x smaller.</p>\n\n<p>I tried debugging but it works under GDB. Maybe GDB does some virtualization?</p>\n\n<pre><code>gdbserver :1000 zmq\nProcess zmq created; pid = 817\nListening on port 1000\nRemote debugging from host 10.0.0.36\n4 2 1\n\nChild exited with status 0\n</code></pre>\n\n<p>So far, all pure go programs I've tested work as well.</p>\n\n<p>Why does importing zeromq cause it to fail? Is there a bug in the arm port of go?</p>\n"}, {"tags": ["go", "casting", "package", "cgo"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491249118, "post_id": 43192754, "comment_id": 73459183, "body": "There is a lot going on in that one line. I would suggest trying each piece by one to see which one fails."}, {"owner": {"reputation": 1462, "user_id": 83802, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/yPrSf.png?s=128&g=1", "display_name": "haroldcampbell", "link": "https://stackoverflow.com/users/83802/haroldcampbell"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491249574, "post_id": 43192754, "comment_id": 73459414, "body": "The error is happening on the return. I&#39;ve simplified the code to highlight the casting error. Everything else works :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491250272, "post_id": 43192754, "comment_id": 73459746, "body": "What is the definition of <code>avcodec.Codec </code>? If you&#39;re defining a Go type, you only need to define it in once place. Types are not aliases, so I&#39;m not sure what you&#39;re trying to do by defining <code>Codec</code> in each package."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491250519, "post_id": 43192754, "comment_id": 73459864, "body": "@JimB Looks like that redefinition was just as an experiment."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1491250819, "post_id": 43192754, "comment_id": 73460021, "body": "Even with the type redefinitions I can&#39;t replicate the failure. What we need is a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 1462, "user_id": 83802, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/yPrSf.png?s=128&g=1", "display_name": "haroldcampbell", "link": "https://stackoverflow.com/users/83802/haroldcampbell"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491252407, "post_id": 43192754, "comment_id": 73460832, "body": "Thanks for taking a stab at this. I&#39;ve found a workable solution. @JimB the problem pops-up when you are using C imports. Nonetheless, thanks for trying."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491252649, "post_id": 43192754, "comment_id": 73460941, "body": "@haroldcampbell: yes, I understand the C types can differ slightly, especially when the C type is a typedef. You also should be able to convert these types if everything is declared correctly. I fail to see the benefit to the solution below at all though, since if you&#39;re gong to accept an <code>interface{}</code>, what&#39;s the point of defining the extra types at all?"}, {"owner": {"reputation": 1462, "user_id": 83802, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/yPrSf.png?s=128&g=1", "display_name": "haroldcampbell", "link": "https://stackoverflow.com/users/83802/haroldcampbell"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491296814, "post_id": 43192754, "comment_id": 73477266, "body": "@JimB: I use the <code>Codec</code> type elsewhere in the program, and do require the underlying <code>C.struct_AVCodec</code> for several methods. By using the type assertion, I&#39;m in essence solving the problem of accepting and forcing a check that the underlying type is <code>C.struct_AVCodec</code> (eg. in the <code>AvformatNewStream(...)</code> method below. I&#39;ll agree that this solution with the <code>interface{}</code> is not prettiest, but I haven&#39;t been able to find a better solution."}, {"owner": {"reputation": 1462, "user_id": 83802, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/yPrSf.png?s=128&g=1", "display_name": "haroldcampbell", "link": "https://stackoverflow.com/users/83802/haroldcampbell"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491297345, "post_id": 43192754, "comment_id": 73477643, "body": "@JimB: I&#39;ve updated the question to make it adhere to Minimal, Complete, and Verifiable example. Hopefully you&#39;ll be able to reproduce the problem."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1491313057, "post_id": 43192754, "comment_id": 73489197, "body": "@haroldcampbell: I think I see what you&#39;re trying to do now. Yes, a <code>C.struct_AVCodec</code> defined in one package is a different type than a <code>C.struct_AVCodec</code> defined in another, so converting between them doesn&#39;t work. If you want to be able to covert that to an <code>avcodec.Codec</code> from within other packages, you need to use <code>unsafe</code>, or just use the C types directly throughout. The C type system is not the Go type system, and manual conversions are often necessary."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1491323625, "post_id": 43193888, "comment_id": 73497420, "body": "Excellent answer about how things work in the innards of <code>cgo</code>. I&#39;m definitely going to remember this gotcha."}], "tags": [], "owner": {"reputation": 1462, "user_id": 83802, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/yPrSf.png?s=128&g=1", "display_name": "haroldcampbell", "link": "https://stackoverflow.com/users/83802/haroldcampbell"}, "is_accepted": true, "score": 1, "last_activity_date": 1491334473, "last_edit_date": 1491334473, "creation_date": 1491252169, "answer_id": 43193888, "question_id": 43192754, "link": "https://stackoverflow.com/questions/43192754/repackaging-c-types-causes-type-cast-error-in-go/43193888#43193888", "title": "Repackaging C types causes type cast error in Go", "body": "<p>This was failing due to how Go represents types.</p>\n\n<p>For instance, given:</p>\n\n<pre><code>//Ex1\npackage avformat \n//.. deleted for simplicity\n\ntype Codec C.struct_AVCodec\n</code></pre>\n\n<p>...and</p>\n\n<pre><code>//Ex2\npackage avcode \n//.. deleted for simplicity\n\ntype Codec C.struct_AVCodec\n</code></pre>\n\n<p>In the code above, the <code>C.struct_AVCodec</code> in ex1 is different from the <code>C.struct_AVCodec</code> in ex2, even though the same are lexically the same.</p>\n\n<p>Specifically, the fully qualified type in ex1 is <code>avformat._Ctype_struct_AVCodec</code>, while ex2 is <code>avcodec._Ctype_struct_AVCodec</code></p>\n\n<p>This explains why the functions in the <code>package avformat</code> that were trying to cast anything from an external type (in this case from <code>package avcodec</code>) to the local <code>C.struct_AVCodec</code> were failing.</p>\n\n<h1>Solution</h1>\n\n<p>To get this to work, I relied on type assertions.</p>\n\n<pre><code>package avformat\n\nfunc (s *FormatContext) AvformatNewStream(c avcodec.ICodec) *Stream {\n  v, _ := c.(*C.struct_AVCodec)\n  return (*Stream)(C.avformat_new_stream((*C.struct_AVFormatContext)(s), (*C.struct_AVCodec)(v)))\n}\n</code></pre>\n\n<p>...and</p>\n\n<pre><code>package avcodec\n\ntype ICodec interface{}\n</code></pre>\n"}], "owner": {"reputation": 1462, "user_id": 83802, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/yPrSf.png?s=128&g=1", "display_name": "haroldcampbell", "link": "https://stackoverflow.com/users/83802/haroldcampbell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 2, "accepted_answer_id": 43193888, "answer_count": 1, "score": 3, "last_activity_date": 1491334473, "creation_date": 1491247620, "last_edit_date": 1491297285, "question_id": 43192754, "link": "https://stackoverflow.com/questions/43192754/repackaging-c-types-causes-type-cast-error-in-go", "title": "Repackaging C types causes type cast error in Go", "body": "<p>I'm trying to repackage some go code that integrates with an existing C library.</p>\n\n<p>The following works perfectly.</p>\n\n<p>File 1:</p>\n\n<pre><code>package avcodec\n\ntype Codec C.struct_AVCodec\n</code></pre>\n\n<p>File 2:</p>\n\n<pre><code>package avformat\n\n//#cgo pkg-config: libavformat libavcodec\n//#include &lt;libavformat/avformat.h&gt;\n//#include &lt;libavcodec/avcodec.h&gt;\nimport \"C\" \nimport (    \n\"unsafe\" \n) \n\ntype Codec C.struct_AVCodec\n\nfunc (s *FormatContext) AvFormatGetVideoCodec() *Codec {    \n  result := C.av_format_get_video_codec((*C.struct_AVFormatContext)(s))\n  return (*Codec)(result) // &lt;- This works. Codec is defined in this package.\n}\n</code></pre>\n\n<p>If I try to reference or move Codec from <em>File 2</em> into a separate package (eg. <em>File 1</em>) I get the error: </p>\n\n<p><strong>cannot convert (func literal)((*C.struct_AVFormatContext)(s)) (type *C.struct_AVCodec) to type *Codec</strong></p>\n\n<p>For example, this fails:</p>\n\n<pre><code>package avformat\n\n//#cgo pkg-config: libavformat libavcodec\n//#include &lt;libavformat/avformat.h&gt;\n//#include &lt;libavcodec/avcodec.h&gt;\nimport \"C\" \nimport (    \n\"avcodec\"\n\"unsafe\" \n) \n\nfunc (s *FormatContext) AvFormatGetVideoCodec() *avcodec.Codec {    \n result := C.av_format_get_video_codec((*C.struct_AVFormatContext)(s))      \n return (*avcodec.Codec)(result) // &lt;- This fails. Codec defined in avcodec.\n}\n</code></pre>\n\n<p>This also fails:</p>\n\n<pre><code>package avformat\n\n//#cgo pkg-config: libavformat libavcodec\n//#include &lt;libavformat/avformat.h&gt;\n//#include &lt;libavcodec/avcodec.h&gt;    \nimport \"C\" \nimport ( \n\"avcodec\"   \n\"unsafe\" \n) \n\ntype Codec avcodec.Codec\n\nfunc (s *FormatContext) AvFormatGetVideoCodec() *Codec {    \n  result := C.av_format_get_video_codec((*C.struct_AVFormatContext)(s))\n  return (*Codec)(result) // &lt;- This also fails. Codec is based on avcodec.Codec.\n}\n</code></pre>\n\n<p>I'd like to:</p>\n\n<ol>\n<li>Understand why it fails, and </li>\n<li>Identify how I can change the packaging so that the function uses the <code>Codec</code> type that is defined in the <code>avcodec</code> package.</li>\n</ol>\n\n<p>Thanks in advance.    </p>\n"}, {"tags": ["mongodb", "go", "dao", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 2065, "user_id": 1367192, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b8541d7729fff6737972059ded409793?s=128&d=identicon&r=PG", "display_name": "dds", "link": "https://stackoverflow.com/users/1367192/dds"}, "edited": false, "score": 0, "creation_date": 1491247556, "post_id": 43192687, "comment_id": 73458433, "body": "No, it does not work. The result: <code>[restful] recover from panic situation: - result argument must be a slice address     &#47;usr&#47;local&#47;go&#47;src&#47;runtime&#47;asm_amd64.s:514     &#47;usr&#47;local&#47;go&#47;src&#47;runtime&#47;panic.go:489     &#47;home&#47;dds&#47;gopath&#47;src&#47;gopkg.in&#47;mgo.v2&#47;session.go:3791</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 2065, "user_id": 1367192, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b8541d7729fff6737972059ded409793?s=128&d=identicon&r=PG", "display_name": "dds", "link": "https://stackoverflow.com/users/1367192/dds"}, "edited": false, "score": 0, "creation_date": 1491248968, "post_id": 43192687, "comment_id": 73459103, "body": "Look, in your sample code you&#39;re not passing a pointer to a slice <code>dao.FindAll([]*entity.User{})</code> &lt;-- this is why you&#39;re getting that error, this is not a pointer to a slice, it&#39;s a slice of pointers to User structs, ok? In my example I added comments to point this out... Just tested the code in my example and it works. If you&#39;re sure you&#39;re passing a pointer to a slice please share more of your code so I can help."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1491247322, "creation_date": 1491247322, "answer_id": 43192687, "question_id": 43191883, "link": "https://stackoverflow.com/questions/43191883/go-and-mongodb-generic-dao-implementation-issue/43192687#43192687", "title": "Go and MongoDB: generic DAO implementation issue", "body": "<p>You should be able to pass a <code>result interface{}</code> to your <code>FindAll</code> function and just pass it along to mgo's <a href=\"https://godoc.org/gopkg.in/mgo.v2#Query.All\" rel=\"nofollow noreferrer\">Query.All</a> method since the argument's would have the same type.</p>\n\n<pre><code>func (thisDao ClusterDao) FindAll(result interface{}) error {\n    session, collection := thisDao.getCollection()\n    defer session.Close()\n    q := bson.M{}\n    // just pass result as is, don't do &amp; here\n    // because that would be a pointer to the interface not\n    // to the underlying slice, which mgo probably doesn't like\n    return collection.Find(q).All(result)\n}\n\n// ...\n\nusers := []*entity.User{}\nif err := dao.FindAll(&amp;users); err != nil { // pass pointer to slice here\n    panic(err)\n}\nlog.Println(users)\n</code></pre>\n"}], "owner": {"reputation": 2065, "user_id": 1367192, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b8541d7729fff6737972059ded409793?s=128&d=identicon&r=PG", "display_name": "dds", "link": "https://stackoverflow.com/users/1367192/dds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 793, "favorite_count": 0, "accepted_answer_id": 43192687, "answer_count": 1, "score": 2, "last_activity_date": 1524852431, "creation_date": 1491244308, "last_edit_date": 1491248115, "question_id": 43191883, "link": "https://stackoverflow.com/questions/43191883/go-and-mongodb-generic-dao-implementation-issue", "title": "Go and MongoDB: generic DAO implementation issue", "body": "<p>In the current project we use Go and MongoDB via mgo driver.\nFor every entity we have to implement DAO for CRUD operations, and it's basically copy-paste, e.g.</p>\n\n<pre><code>func (thisDao ClusterDao) FindAll() ([]*entity.User, error) {\n    session, collection := thisDao.getCollection()\n    defer session.Close()\n    result := []*entity.User{} //create a new empty slice to return \n    q := bson.M{}\n    err := collection.Find(q).All(&amp;result)\n    return result, err\n}\n</code></pre>\n\n<p>For every other entity it's all the same but the result type.</p>\n\n<p>Since Go has no generics, how could we avoid code duplication?</p>\n\n<p>I've tried to pass the <code>result interface{}</code> param instead of creating it in the method, and call the method like this:</p>\n\n<pre><code>dao.FindAll([]*entity.User{})\n</code></pre>\n\n<p>but the <code>collection.Find().All()</code> method need a slice as the input, not just interface:</p>\n\n<pre><code>[restful] recover from panic situation: - result argument must be a slice address\n/usr/local/go/src/runtime/asm_amd64.s:514\n/usr/local/go/src/runtime/panic.go:489\n/home/dds/gopath/src/gopkg.in/mgo.v2/session.go:3791\n/home/dds/gopath/src/gopkg.in/mgo.v2/session.go:3818\n</code></pre>\n\n<p>Then I tried to make this param <code>result []interface{}</code>, but in that case it's impossible to pass <code>[]*entity.User{}</code>:</p>\n\n<blockquote>\n  <p>cannot use []*entity.User literal (type []*entity.User) as type []interface {} in argument to thisDao.GenericDao.FindAll</p>\n</blockquote>\n\n<p>Any idea how could I implement generic DAO in Go?</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 1, "creation_date": 1491244226, "post_id": 43191051, "comment_id": 73456568, "body": "Why don&#39;t you turn on logging and see if the generated SQL is what you expect?  <code>db.LogMode(true)</code> before your <code>db.Preload</code>, and then let us know what it says.  If it&#39;s what you expect, show us your db structure and the relevant data."}, {"owner": {"reputation": 63, "user_id": 4152742, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBQTlg4mSiI/AAAAAAAAAAI/AAAAAAAAAgo/2O8Hyn6Ca7A/photo.jpg?sz=128", "display_name": "jwthanh", "link": "https://stackoverflow.com/users/4152742/jwthanh"}, "reply_to_user": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1491244938, "post_id": 43191051, "comment_id": 73456972, "body": "@dave only see SELECT query on users table"}, {"owner": {"reputation": 11499, "user_id": 1236090, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q0I6m.jpg?s=128&g=1", "display_name": "David Faber", "link": "https://stackoverflow.com/users/1236090/david-faber"}, "edited": false, "score": 0, "creation_date": 1491254422, "post_id": 43191051, "comment_id": 73461804, "body": "I&#39;m surprised you get any results at all since <code>AND ((1 &lt;&gt; 1))</code> would tend to exclude everything from your <code>SELECT</code> query. Are you sure the results you&#39;re getting aren&#39;t some kind of default results?"}, {"owner": {"reputation": 63, "user_id": 4152742, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBQTlg4mSiI/AAAAAAAAAAI/AAAAAAAAAgo/2O8Hyn6Ca7A/photo.jpg?sz=128", "display_name": "jwthanh", "link": "https://stackoverflow.com/users/4152742/jwthanh"}, "reply_to_user": {"reputation": 11499, "user_id": 1236090, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q0I6m.jpg?s=128&g=1", "display_name": "David Faber", "link": "https://stackoverflow.com/users/1236090/david-faber"}, "edited": false, "score": 0, "creation_date": 1491258398, "post_id": 43191051, "comment_id": 73463413, "body": "@DavidFaber thank for your comment, I think I was wrong when debug to show SQL query so it&#39;s the wrong log."}], "answers": [{"tags": [], "owner": {"reputation": 63, "user_id": 4152742, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBQTlg4mSiI/AAAAAAAAAAI/AAAAAAAAAgo/2O8Hyn6Ca7A/photo.jpg?sz=128", "display_name": "jwthanh", "link": "https://stackoverflow.com/users/4152742/jwthanh"}, "is_accepted": true, "score": 3, "last_activity_date": 1491258270, "last_edit_date": 1491258270, "creation_date": 1491248938, "answer_id": 43193104, "question_id": 43191051, "link": "https://stackoverflow.com/questions/43191051/how-to-implement-preloading-in-gorm/43193104#43193104", "title": "How to implement preloading in gorm", "body": "<p>Select missing <code>id</code> fields so preloading was not applied. Bellow code will be resolve issue</p>\n\n<pre><code>if err := db.Select(\"id, name\").Preload(\"Addresses\").Find(&amp;users).Error; err != nil {\n    // Display error message\n} else {\n    //\n}\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 4152742, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBQTlg4mSiI/AAAAAAAAAAI/AAAAAAAAAgo/2O8Hyn6Ca7A/photo.jpg?sz=128", "display_name": "jwthanh", "link": "https://stackoverflow.com/users/4152742/jwthanh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2383, "favorite_count": 0, "accepted_answer_id": 43193104, "answer_count": 1, "score": 2, "last_activity_date": 1491258270, "creation_date": 1491241391, "last_edit_date": 1491248810, "question_id": 43191051, "link": "https://stackoverflow.com/questions/43191051/how-to-implement-preloading-in-gorm", "title": "How to implement preloading in gorm", "body": "<p>I'm using <a href=\"http://jinzhu.me/gorm/crud.html#preloading-eager-loading\" rel=\"nofollow noreferrer\">gorm</a>.</p>\n\n<p>I have an issue bellow, hope somebody can help me resolve or explain more about that </p>\n\n<pre><code>type User struct {\n    ID        int\n    Name      string\n    Addresses []Address\n}\n\ntype Address struct {\n    UserID   int `gorm:\"index;not null\"`\n    Address string\n    City     string\n    Zipcode  int\n    Country  string\n}\n\nif err := db.Select(\"name\").Preload(\"Addresses\").Find(&amp;users).Error; err != nil {\n    // Display error message\n} else {\n    //\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>[\n    {\n      \"created_at\": \"2017-04-02T00:07:59Z\",\n      \"updated_at\": \"2017-04-02T00:07:59Z\",\n      \"name\": \"Richard\"\n    }\n  ]\n</code></pre>\n\n<p>SQL log:</p>\n\n<pre><code>SELECT * FROM `users` WHERE `users`.deleted_at IS NULL AND ((1 &lt;&gt; 1))\n</code></pre>\n\n<p>Expect result:</p>\n\n<pre><code>[\n  {\n    \"created_at\": \"2017-04-02T00:07:59Z\",\n    \"updated_at\": \"2017-04-02T00:07:59Z\",\n    \"name\": \"Richard\",\n    \"addresses\": [\n      {\n        \"address\": \"No 1, Street 5\",\n        \"city\": \"New York\",\n        \"country\": \"US\"\n      }\n    ]\n  }\n]\n</code></pre>\n\n<p>I have researched some other post on StackOverflow but don't  see any solutions</p>\n"}, {"tags": ["html", "http", "go", "get"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1491240873, "post_id": 43190185, "comment_id": 73454685, "body": "You can use Go&#39;s <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\">html/template</a> package to render the scores inside the <code>Scores.html</code> page."}, {"owner": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491247532, "post_id": 43190185, "comment_id": 73458421, "body": "Hi mkopriva. I&#39;m very new to Golang, only started learning it in college this semester so I&#39;m unfamiliar with the html/template package and how it would integrate with JSON. Is there any particular tutorials you&#39;ve heard of that could get me started?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1491252123, "post_id": 43190185, "comment_id": 73460697, "body": "At that point you wouldn&#39;t be working with JSON, you&#39;d be working with structured data in Go; the template package doesn&#39;t provide a way to use JSON directly, you&#39;d umarshal the JSON to something (struct, map, whatever) and then pass that to your template."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "edited": false, "score": 0, "creation_date": 1491569438, "post_id": 43194002, "comment_id": 73625066, "body": "Hi. I&#39;ve been looking at the code and I&#39;ve gotten the HTML to output like so: <a href=\"https://postimg.org/image/4kzd34ntf/\" rel=\"nofollow noreferrer\">postimg.org/image/4kzd34ntf</a> Thank you very much for that help. I get the concept of the HTML being output into the console, but I&#39;m not sure how ParseFiles would work to output this HTML onto the website? Also, seeing as the values are output in HTML and manually added into the struct, this would make the data static. If I played my game and a new score was added to the database, would I have to manually input that score into the JSON struct?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "edited": false, "score": 0, "creation_date": 1491571724, "post_id": 43194002, "comment_id": 73626617, "body": "<code>ParseFiles</code> parses your html files and returns a template (<code>*template.Template</code>), that&#39;s it, nothing more, <code>ParseFiles</code> does not ouput the contents of those files to stdout or to your website. For that, you will need to use the returned <b>template</b>, to be more precise, the template&#39;s <code>Execute</code> method. If you look at <a href=\"https://golang.org/pkg/html/template/#Template.Execute\" rel=\"nofollow noreferrer\">Execute</a>&#39;s documentation you can see that the first argument is of type <code>io.Writer</code>, an interface type, which is already satisfied by <code>http.ResponseWriter</code>, the first argument of your <code>scoresPage</code> function, right?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "edited": false, "score": 0, "creation_date": 1491572060, "post_id": 43194002, "comment_id": 73626852, "body": "So that means, that when you pass <b>res</b> (<code>http.ResponseWriter</code>) to the template&#39;s <code>Execute</code> method, the contents of the template will be written &quot;to your website&quot; using the <code>http.ResponseWriter</code>... That&#39;s all you need to do to output your html files to you website."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "edited": false, "score": 0, "creation_date": 1491572675, "post_id": 43194002, "comment_id": 73627307, "body": "The data will only be static if the data at &quot;<a href=\"https://brainworksappservice.azurewebsites.net\" rel=\"nofollow noreferrer\">brainworksappservice.azurewebsites.net</a>&quot; is static as well. Your <code>scoresPage</code> function is making a request to <code>brainworksappservice</code> to get the data, and whatever data is returned, whether static or dynamic, that data will be rendered on your website by the template. Btw you can also &quot;cache&quot; your template by parsing the files only once, someplace outsite of the <code>scoresPages</code> function and then call <code>Execute</code> any number of times, with new data, and it will render that new data correctly. Let me know if something still doesn&#39;t make sense."}, {"owner": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "edited": false, "score": 0, "creation_date": 1491573084, "post_id": 43194002, "comment_id": 73627658, "body": "But if I try to pass res to the execute method I get an error: [link] <a href=\"https://postimg.org/image/72ydgaf1n/\" rel=\"nofollow noreferrer\">postimg.org/image/72ydgaf1n</a> The error is that res is undefined. How do I parsefiles exactly? Am I parsing the Scores.HTML where I want the data to be output? Oh I get what you mean there, the data on the database isn&#39;t static so that should clear up that part of the problem. Thank you."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "edited": false, "score": 0, "creation_date": 1491573307, "post_id": 43194002, "comment_id": 73627841, "body": "I used <code>res</code> because the first line in your initial example code used <code>res</code> as the name of its first argument the <code>http.ResponseWriter</code>. Here&#39;s the first line from your example <code>func scoresPage(res http.ResponseWriter, req *http.Request) {</code> inside this function <code>res</code> cannot be undefined... Can you screenshot your whole function?"}, {"owner": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "edited": false, "score": 0, "creation_date": 1491573443, "post_id": 43194002, "comment_id": 73627937, "body": "I&#39;m doing all of the outputting within main so that might be why it&#39;s undefined. I&#39;ll try to put my data into the scoresPage function but that usually errors out. I&#39;ll screenshot it when I have that done."}, {"owner": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "edited": false, "score": 0, "creation_date": 1491573746, "post_id": 43194002, "comment_id": 73628170, "body": "This is defined outside Main [link] (<a href=\"https://postimg.org/image/oan7crlrf/\" rel=\"nofollow noreferrer\">postimg.org/image/oan7crlrf</a>) And then within main: (Split into two images because it all wouldn&#39;t fit) [link] (<a href=\"https://postimg.org/image/rd4c43xm3/\" rel=\"nofollow noreferrer\">postimg.org/image/rd4c43xm3</a>) and [link] (<a href=\"https://postimg.org/image/jf82937bh/\" rel=\"nofollow noreferrer\">postimg.org/image/jf82937bh</a>)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "edited": false, "score": 0, "creation_date": 1491574114, "post_id": 43194002, "comment_id": 73628459, "body": "Here&#39;s how your <code>scoresPage</code> function could look like: <a href=\"https://play.golang.org/p/sKkG3XsOH3\" rel=\"nofollow noreferrer\">play.golang.org/p/sKkG3XsOH3</a>. Updated version with the template string instead of the Scores.html file: <a href=\"https://play.golang.org/p/3lOQQNvUtU\" rel=\"nofollow noreferrer\">play.golang.org/p/3lOQQNvUtU</a>"}, {"owner": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "edited": false, "score": 0, "creation_date": 1491835501, "post_id": 43194002, "comment_id": 73716771, "body": "Everything compiles properly but as soon as I try to navigate to the Scores.html page I get the following error:  [link] (<a href=\"https://postimg.org/image/ey605rbft/\" rel=\"nofollow noreferrer\">postimg.org/image/ey605rbft</a>) . I get no errors in the console though. This is what my code looks like now: [link] (<a href=\"https://play.golang.org/p/1tQyGGrRk9\" rel=\"nofollow noreferrer\">play.golang.org/p/1tQyGGrRk9</a>) . Am I supposed to have something on the Scores.html page? The Scores.html looks like this: [link] (<a href=\"https://play.golang.org/p/uyX7FRuCMC\" rel=\"nofollow noreferrer\">play.golang.org/p/uyX7FRuCMC</a>) (I shouldn&#39;t have html in the GO playground but it&#39;s just for sharing purposes)"}, {"owner": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "edited": false, "score": 0, "creation_date": 1491836595, "post_id": 43194002, "comment_id": 73717613, "body": "The error didn&#39;t show straight away but it was the fact that I had declared the &#39;Id&#39; wrong in the html template. Now when I run the website I get some data back on the Scores.html page! [link] (<a href=\"https://postimg.org/image/t298ol3kf/\" rel=\"nofollow noreferrer\">postimg.org/image/t298ol3kf</a>) Is there any way to get rid of the scores that are blank? If not its fine. Thanks for your help!"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "edited": false, "score": 0, "creation_date": 1491836960, "post_id": 43194002, "comment_id": 73717848, "body": "Ah good to hear that it works, you can avoid empty scores by checking whether they are present, with an {{if ...}} action, either by checking the .Id or .Score, etc. it&#39;s up to you. <a href=\"https://play.golang.org/p/tHb9EGY38l\" rel=\"nofollow noreferrer\">play.golang.org/p/tHb9EGY38l</a>"}, {"owner": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "edited": false, "score": 0, "creation_date": 1491844355, "post_id": 43194002, "comment_id": 73722517, "body": "Thank you, great help. I handled the scores being blank on the game side with an if statement in C#. The game doesn&#39;t allow blanks anymore. My Scores look like this now with a bit of tidying up. I put them into a table on the website. <a href=\"https://postimg.org/image/yzd0ib505/\" rel=\"nofollow noreferrer\">postimg.org/image/yzd0ib505</a>"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 0, "last_activity_date": 1491252560, "creation_date": 1491252560, "answer_id": 43194002, "question_id": 43190185, "link": "https://stackoverflow.com/questions/43190185/how-to-output-golang-http-json-body-to-website-page-using-html-javascript-jquery/43194002#43194002", "title": "How to output golang http json body to website page using html/javascript/jquery", "body": "<p>Assuming, that you don't want to dump the json as is onto you page but instead format it in some way with html and css, then you could first decode the returned body into a slice of structs that mirror the structure of your json. For example like this:</p>\n\n<pre><code>type Score struct {\n    Id        string    `json:\"id\"`\n    CreatedAt time.Time `json:\"createdAt\"`\n    UpdatedAt time.Time `json:\"updatedAt\"`\n    Version   string    `json:\"version\"`\n    Deleted   bool      `json:\"deleted\"`\n    Text      string    `json:\"text\"`\n    Complete  bool      `json:\"complete\"`\n    Score     string    `json:\"score\"`\n}\n\nscores := []*Score{}\nif err := json.Unmarshal(body, &amp;scores); err != nil {\n    panic(err)\n}\nfmt.Println(scores[0])\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/m_ySdZulqy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/m_ySdZulqy</a></p>\n\n<p>After you've decoded the json you can use Go's template package to loop over the scores and format them as you wish. While you should use the <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\">html/template</a> package for rendering html you should check out <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">text/template</a> for the documentation on how to actually program the templates, they have the same interface.</p>\n\n<p>Here's a quick example: <a href=\"https://play.golang.org/p/EYfV-TzoA0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/EYfV-TzoA0</a></p>\n\n<p>In that example I'm using the template package to parse a string (<code>scoresPage</code>) and output the result to stdout, but you can just as easily parse your <code>Scores.html</code> file with <a href=\"https://golang.org/pkg/html/template/#ParseFiles\" rel=\"nofollow noreferrer\">ParseFiles</a> and return the output in the http response by passing the <code>res http.ResponseWriter</code> instead of <code>os.Stdout</code> as the first argument to <a href=\"https://golang.org/pkg/html/template/#Template.Execute\" rel=\"nofollow noreferrer\">template.Execute</a>.</p>\n"}], "owner": {"reputation": 11, "user_id": 7419195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4a7b61919d5856b42a7c688a693e875?s=128&d=identicon&r=PG&f=1", "display_name": "wishfulcoder", "link": "https://stackoverflow.com/users/7419195/wishfulcoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2358, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1491252560, "creation_date": 1491238379, "last_edit_date": 1491240119, "question_id": 43190185, "link": "https://stackoverflow.com/questions/43190185/how-to-output-golang-http-json-body-to-website-page-using-html-javascript-jquery", "title": "How to output golang http json body to website page using html/javascript/jquery", "body": "<p>I've got a Golang Website where I want to display 'scores' from my UWP Game using SQLite's Mobile App Quickstart's API called SwaggerUI. I am getting the scores by doing a HTTP GET request. The problem is that the scores output to the Golang console in JSON Format. I want to display the scores onto the actual website. How could I call my golang function in the Frontend in order to do this? The frontend is written in HTML/Javascript/JQuery.</p>\n\n<p>This is my Golang Function that does the HTTP Request to SwaggerUI and outputs to the Golang Console:</p>\n\n<pre><code>func scoresPage(res http.ResponseWriter, req *http.Request) {\n\n//Connecting to SwaggerUI API to get Scores from Azure for UWP Application\n\nreq, err := http.NewRequest(\"GET\", os.ExpandEnv(\"https://brainworksappservice.azurewebsites.net/tables/TodoItem?$select=score\"), nil)\nif err != nil {\n    log.Fatal(err)\n}\n//You have to specify these headers\nreq.Header.Set(\"Accept\", \"application/json\")\n//If you do not specify what version your API is, you cannot receive the JSON\nreq.Header.Set(\"Zumo-Api-Version\", \"2.0.0\")\n\n//Do the request\nresp, err := http.DefaultClient.Do(req)\n//Error if the request cannot be done\nif err != nil {\n    log.Fatal(err)\n}\n\n//You need to close the Body everytime, as if you don't you could leak information\ndefer resp.Body.Close()\n\n//Read all of the information from the body\nbody, err := ioutil.ReadAll(resp.Body)\n\n//Error if the info cannot be read\nif err != nil {\n    log.Fatal(err)\n}\n\n//Write the JSON to the standard output (the Console)\n_, err = os.Stdout.Write(body)\n//Error if the info cannot be output to the console\nif err != nil {\n    log.Fatal(err)\n }\n\nhttp.ServeFile(res, req, \"Scores.html\")\n} `\n</code></pre>\n\n<p>This is the main Function which serves up the website and handles the scores page:</p>\n\n<pre><code>func main() {\nhttp.HandleFunc(\"/scores\", scoresPage)\n\n//serve on the port 8000 forever\nhttp.ListenAndServe(\":8000\", nil)\n} \n</code></pre>\n"}, {"tags": ["http", "curl", "go", "httpresponse"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 19, "last_activity_date": 1491313329, "last_edit_date": 1491313329, "creation_date": 1491236670, "answer_id": 43189683, "question_id": 43189375, "link": "https://stackoverflow.com/questions/43189375/why-is-golang-http-server-failing-with-broken-pipe-when-response-exceeds-8kb/43189683#43189683", "title": "why is golang http server failing with &quot;broken pipe&quot; when response exceeds 8kb?", "body": "<p>In <code>net/http/server.go</code> the output buffer is set to <code>4&lt;&lt;10</code>, i.e. 4KB.</p>\n\n<p>The reason you see the error at 8KB, is that it takes at least 2 writes to a socket to detect a closed remote connection. The first write succeeds, but the remote host sends an RST packet. The second write will be to a closed socket, which is what returns the <code>broken pipe</code> error. </p>\n\n<p>Depending on the socket write buffer, and the connection latency, it's possible that even more writes could succeed before the first RST packet is registered. </p>\n"}], "owner": {"reputation": 293, "user_id": 2080218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b1903d44812b65577d9460d714bed0d?s=128&d=identicon&r=PG", "display_name": "eldosoa", "link": "https://stackoverflow.com/users/2080218/eldosoa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11130, "favorite_count": 1, "accepted_answer_id": 43189683, "answer_count": 1, "score": 17, "last_activity_date": 1491313329, "creation_date": 1491235610, "question_id": 43189375, "link": "https://stackoverflow.com/questions/43189375/why-is-golang-http-server-failing-with-broken-pipe-when-response-exceeds-8kb", "title": "why is golang http server failing with &quot;broken pipe&quot; when response exceeds 8kb?", "body": "<p>I have a example web server below where if you call <code>curl localhost:3000 -v</code> then <code>^C</code> (cancel) it immediately (before 1 second), it will report <code>write tcp 127.0.0.1:3000-&gt;127.0.0.1:XXXXX: write: broken pipe</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc main() {\n    log.Fatal(http.ListenAndServe(\":3000\", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            time.Sleep(1 * time.Second)\n\n            // Why 8061 bytes? Because the response header on my computer\n            // is 132 bytes, adding up the entire response to 8193 (1 byte \n            // over 8kb)\n            if _, err := w.Write(make([]byte, 8061)); err != nil {\n                    fmt.Println(err)\n                    return\n            }   \n    })))\n}\n</code></pre>\n\n<p>Based on my debugging, I have been able to conclude that this will only happen if the entire response is writing more than 8192 bytes (or 8kb). If my entire response write less than 8192, the <code>broken pipe</code> error is not returned.</p>\n\n<p>My question is <strong>where is this 8192 bytes (or 8kb) buffer limit set?</strong> Is this a limit in Golang's HTTP write buffer? Is this related to the response being chunked? Is this only related to the <code>curl</code> client or the browser client? How can I change this limit so I can have a bigger buffer written before the connection is closed (for debugging purposes)?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["azure", "go", "image-uploading", "azure-storage-blobs"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 6319004, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OompcPJILx8/AAAAAAAAAAI/AAAAAAAAARo/KnK64817TWY/photo.jpg?sz=128", "display_name": "Andrew Chung", "link": "https://stackoverflow.com/users/6319004/andrew-chung"}, "edited": false, "score": 0, "creation_date": 1491290315, "post_id": 43196734, "comment_id": 73473234, "body": "Hi Mark thanks for answering. I was trying to see if I could pass in part directly to CreateBlockBlobFromReader, but I get an error from Azure saying that the body length is 0 and therefore there is a mismatch with the Content-Length (what I pass in as &#39;read&#39;). Do you know why that is? I&#39;ll try passing in part directly again."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "reply_to_user": {"reputation": 21, "user_id": 6319004, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OompcPJILx8/AAAAAAAAAAI/AAAAAAAAARo/KnK64817TWY/photo.jpg?sz=128", "display_name": "Andrew Chung", "link": "https://stackoverflow.com/users/6319004/andrew-chung"}, "edited": false, "score": 0, "creation_date": 1491294117, "post_id": 43196734, "comment_id": 73475491, "body": "Andrew see Peter&#39;s helpful answer above."}], "tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": false, "score": 0, "last_activity_date": 1491268255, "creation_date": 1491268255, "answer_id": 43196734, "question_id": 43187362, "link": "https://stackoverflow.com/questions/43187362/golang-processing-images-via-multipart-and-streaming-to-azure/43196734#43196734", "title": "Golang processing images via multipart and streaming to Azure", "body": "<p>A <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\">Reader</a> can return both an io.EOF and a valid final bytes read, it looks like the final bytes (cBytes) is not added to <code>read</code> total bytes. Also, careful: if an error is returned by <code>part.Read(buffer)</code> other than io.EOF, the read loop might not exit. Consider <a href=\"https://golang.org/pkg/io/ioutil/#ReadAll\" rel=\"nofollow noreferrer\">ioutil.ReadAll</a> instead.</p>\n\n<p>CreateBlockBlobFromReader takes a Reader, and part is a Reader, so you may be able to pass the part in directly.</p>\n\n<p>You may also want to consider Azure block size limits might be smaller than the image, see <a href=\"https://docs.microsoft.com/en-us/rest/api/storageservices/fileservices/understanding-block-blobs--append-blobs--and-page-blobs\" rel=\"nofollow noreferrer\">Asure blobs</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1491294707, "post_id": 43201496, "comment_id": 73475890, "body": "Thanks for answering @Peter, do you know why CreateBlockBlobFromReader requires the size up front, alongside the reader?"}, {"owner": {"reputation": 20467, "user_id": 4989676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jP8H6.jpg?s=128&g=1", "display_name": "Peter Pan", "link": "https://stackoverflow.com/users/4989676/peter-pan"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 1, "creation_date": 1491295558, "post_id": 43201496, "comment_id": 73476441, "body": "@Mark Azure Storage SDK for Golang or other languages is wrappered Storage REST APIs. The <a href=\"https://docs.microsoft.com/en-us/rest/api/storageservices/fileservices/put-blob\" rel=\"nofollow noreferrer\"><code>Put Blob</code></a>/<a href=\"https://docs.microsoft.com/en-us/rest/api/storageservices/fileservices/put-block\" rel=\"nofollow noreferrer\"><code>Put Block</code></a> require <code>Content-Length</code> header in the rest request."}], "tags": [], "owner": {"reputation": 20467, "user_id": 4989676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jP8H6.jpg?s=128&g=1", "display_name": "Peter Pan", "link": "https://stackoverflow.com/users/4989676/peter-pan"}, "is_accepted": false, "score": 3, "last_activity_date": 1491292809, "creation_date": 1491292809, "answer_id": 43201496, "question_id": 43187362, "link": "https://stackoverflow.com/questions/43187362/golang-processing-images-via-multipart-and-streaming-to-azure/43201496#43201496", "title": "Golang processing images via multipart and streaming to Azure", "body": "<p>As @Mark said, you can use <a href=\"https://godoc.org/io/ioutil#ReadAll\" rel=\"nofollow noreferrer\"><code>ioutil.ReadAll</code></a> to read the content into a byte array, the code like below.</p>\n\n<pre><code>import (\n   \"bytes\"\n   \"io/ioutil\"\n)\n\npartBytes, _ := ioutil.ReadAll(part)\nsize := uint64(len(partBytes))\nblob := bytes.NewReader(partBytes)\nerr := blobClient.CreateBlockBlobFromReader(container, fileName, size, blob, nil)\n</code></pre>\n\n<p>According to the godoc for <a href=\"https://godoc.org/github.com/curoverse/azure-sdk-for-go/storage#BlobStorageClient.CreateBlockBlobFromReader\" rel=\"nofollow noreferrer\"><code>CreateBlockBlobFromReader</code></a>, as below.</p>\n\n<blockquote>\n  <p>The API <strong>rejects</strong> requests with <strong>size > 64 MiB</strong> (but this limit is not checked by the SDK). To write a larger blob, use <a href=\"https://godoc.org/github.com/curoverse/azure-sdk-for-go/storage#BlobStorageClient.CreateBlockBlob\" rel=\"nofollow noreferrer\">CreateBlockBlob</a>, PutBlock, and PutBlockList.</p>\n</blockquote>\n\n<p>So if the size is larger than 64MB, the code shoule be like below.</p>\n\n<pre><code>import \"encoding/base64\"\n\nconst BLOB_LENGTH_LIMITS uint64 = 64 * 1024 * 1024\n\npartBytes, _ := ioutil.ReadAll(part)\nsize := uint64(len(partBytes))\nif size &lt;= BLOB_LENGTH_LIMITS {\n   blob := bytes.NewReader(partBytes)\n   err := blobClient.CreateBlockBlobFromReader(container, fileName, size, blob, nil)\n} else {\n   // Create an empty blob\n   blobClient.CreateBlockBlob(container, fileName)\n   // Create a block list, and upload each block\n   length := size / BLOB_LENGTH_LIMITS\n   if length%limits != 0 {\n       length = length + 1\n   }\n   blocks := make([]Block, length)\n   for i := uint64(0); i &lt; length; i++ {\n        start := i * BLOB_LENGTH_LIMITS\n        end := (i+1) * BLOB_LENGTH_LIMITS\n        if end &gt; size {\n            end = size\n        }\n        chunk := partBytes[start: end]\n        blockId := base64.StdEncoding.EncodeToString(chunk)\n        block := Block{blockId, storage.BlockStatusCommitted}\n        blocks[i] = block\n        err = blobClient.PutBlock(container, fileName, blockID, chunk)\n        if err != nil {\n        .......\n        }\n   }\n   err = blobClient.PutBlockList(container, fileName, blocks)\n   if err != nil {\n      .......\n   }\n}\n</code></pre>\n\n<p>Hope it helps.</p>\n"}], "owner": {"reputation": 21, "user_id": 6319004, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OompcPJILx8/AAAAAAAAAAI/AAAAAAAAARo/KnK64817TWY/photo.jpg?sz=128", "display_name": "Andrew Chung", "link": "https://stackoverflow.com/users/6319004/andrew-chung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1264, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1491292809, "creation_date": 1491229843, "question_id": 43187362, "link": "https://stackoverflow.com/questions/43187362/golang-processing-images-via-multipart-and-streaming-to-azure", "title": "Golang processing images via multipart and streaming to Azure", "body": "<p>In the process of learning golang, I'm trying to write a web app with multiple image upload functionality.</p>\n\n<p>I'm using Azure Blob Storage to store images, but I am having trouble streaming the images from the multipart request to Blob Storage.</p>\n\n<p>Here's the handler I've written so far:</p>\n\n<pre><code>func (imgc *ImageController) UploadInstanceImageHandler(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\nreader, err := r.MultipartReader()\n\nif err != nil {\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n    return\n}\n\nfor {\n    part, partErr := reader.NextPart()\n\n    // No more parts to process\n    if partErr == io.EOF {\n        break\n    }\n\n    // if part.FileName() is empty, skip this iteration.\n    if part.FileName() == \"\" {\n        continue\n    }\n\n    // Check file type\n    if part.Header[\"Content-Type\"][0] != \"image/jpeg\" {\n        fmt.Printf(\"\\nNot image/jpeg!\")\n        break\n    }\n\n    var read uint64\n    fileName := uuid.NewV4().String() + \".jpg\"\n    buffer := make([]byte, 100000000)\n\n    // Get Size\n    for {\n        cBytes, err := part.Read(buffer)\n\n        if err == io.EOF {\n            fmt.Printf(\"\\nLast buffer read!\")\n            break\n        }\n\n        read = read + uint64(cBytes)\n    }\n\n    stream := bytes.NewReader(buffer[0:read])\n    err = imgc.blobClient.CreateBlockBlobFromReader(imgc.imageContainer, fileName, read, stream, nil)\n\n    if err != nil {\n        fmt.Println(err)\n        break\n    }\n}\n\nw.WriteHeader(http.StatusOK)\n</code></pre>\n\n<p>}</p>\n\n<p>In the process of my research, I've read through using r.FormFile, ParseMultipartForm, but decided on trying to learn how to use MultiPartReader.</p>\n\n<p>I was able to upload an image to the golang backend and save the file to my machine using MultiPartReader.</p>\n\n<p>At the moment, I'm able to upload files to Azure but they end up being corrupted. The file sizes seem on point but clearly something is not working.</p>\n\n<p>Am I misunderstanding how to create a io.Reader for CreateBlockBlobFromReader?</p>\n\n<p>Any help is much appreciated!</p>\n"}, {"tags": ["go", "interface", "packages", "embedding"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1491235309, "post_id": 43186081, "comment_id": 73451631, "body": "If all of your <code>Descriptor</code>s have different functionality, and i don&#39;t mean one method implemented differently, but different methods altogether, then i think using an interface makes no sense and you should just use your <code>struct</code> type with its embedded members."}, {"owner": {"reputation": 442, "user_id": 5935455, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/LKtm8.jpg?s=128&g=1", "display_name": "Adrien Luxey", "link": "https://stackoverflow.com/users/5935455/adrien-luxey"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491236005, "post_id": 43186081, "comment_id": 73452034, "body": "I would, if I could! Two points make me think I am stuck with this interface/struct pair. 1: If X is embedded in Y, I believe I can&#39;t provide a type Y to a <code>func f(x X)</code> ; 2: I can&#39;t do type conversions like <code>y.(X)</code>, which I use in View&#39;s <code>IncrementAge</code> below. In other words, I can&#39;t store more than X in my original <code>type View map[string]X</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491236202, "post_id": 43186081, "comment_id": 73452166, "body": "How about embedding Y in X and passing X to all your <code>func</code>&#39;s that need to handle X and Y? then you can access increment age of y by <code>x.Y.IncrementAge()</code>"}, {"owner": {"reputation": 442, "user_id": 5935455, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/LKtm8.jpg?s=128&g=1", "display_name": "Adrien Luxey", "link": "https://stackoverflow.com/users/5935455/adrien-luxey"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491236647, "post_id": 43186081, "comment_id": 73452435, "body": "In this case you revert the dependency tree. (But really, thanks for trying! I&#39;m too OO for Go, it drives me crazy!) The whole point of my problem is to have package A offering minimal standalone View functionality, with by B (and C and D...) making their own additions independently, while allowing to pass around the same data structure (the View)."}], "owner": {"reputation": 442, "user_id": 5935455, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/LKtm8.jpg?s=128&g=1", "display_name": "Adrien Luxey", "link": "https://stackoverflow.com/users/5935455/adrien-luxey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1491244846, "creation_date": 1491226461, "last_edit_date": 1491244846, "question_id": 43186081, "link": "https://stackoverflow.com/questions/43186081/questions-on-embedding", "title": "Questions on embedding", "body": "<p>I have trouble constructing the main type of my project: the Descriptor, and its corresponding View (<code>type View map[string]Descriptor</code>).</p>\n\n<p>Several sub-algorithms all make use of the View, but they want to add data to the base Descriptors, that is to add methods to the View.</p>\n\n<p>Say I have a base package A and a sub-package B, with the following code:</p>\n\n<pre><code>package A\n\n// A.Descriptor only takes care in a Descriptor's address\ntype Descriptor interface {\n    GetAddr() string\n}\n\n// Are the names OK?\n// I thought of \"Describer\" for interface name and \"Descriptor\" for the struct\n// But is not that better than Descriptor/BaseDescriptor    \ntype BaseDescriptor struct {\n    Addr string\n}\nfunc (d BaseDescriptor) GetAddr() string { return d.Addr }\n\ntype View map[string]Descriptor\n\n// A.View implements basic set functionality like Add, Remove, Union...\nfunc (v *View) Add(descs... Descriptor) {\n    for _, d := range descs {\n        (*v)[d.GetAddr()] = item\n    }\n}\n</code></pre>\n\n<p>In another package:</p>\n\n<pre><code>package B\n\nimport (\n    \"my_project/A\"\n)\n\n// This package needs an \"age\" integer associated with each Descriptor\ntype Descriptor struct {\n    gossip.BaseDescriptor\n\n    age int\n}\n\n// Now, I want a new version of View with the ability to increment\n// its Descriptors' age\nfunc (v *NewView) IncrementAge() {\n    for key, val := range *v {\n        // If NewView directly handles B.Descriptor *struct*:\n        (*v)[key].age += 1\n        // Else, I could implement a\n        // \"func (d Descriptor) IncrementAge() Descriptor\" to do so:\n        (*v)[key] = val.IncrementAge()\n    }\n}\n\n// But how should I define NewView?\n</code></pre>\n\n<p>I have been banging my head on the wall listening to Rob Pike tell me how simpler interfaces are much better than big ones. But now that I tackle Descriptor, that used to be a bigger \"all-in-one\" interface, I really can't figure out how to split it well. So any advice is welcome!</p>\n\n<p>Basically, my goal is to be able to pass the same Descriptor struct around my different sub-algorithms, the final Descriptor being an embedding of A.Descriptor, B.Descriptor etc. Each embedding adding a bit of functionality.</p>\n"}, {"tags": ["github", "go", "cockroachdb"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1491225823, "post_id": 43184477, "comment_id": 73444678, "body": "A clone of the cockroach repo is &gt;300MB. What are you looking at that is only 30MB? Cockroachdb isn&#39;t meant to be installed via <code>go get</code>, so you need to read through their documentation on how to build from source if that&#39;s your goal. If their build instructions don&#39;t work, then you can raise an issue with them."}, {"owner": {"reputation": 16323, "user_id": 355499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/78892b9338a302a4ba3cc1aa77edd99f?s=128&d=identicon&r=PG", "display_name": "Emil H", "link": "https://stackoverflow.com/users/355499/emil-h"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491228353, "post_id": 43184477, "comment_id": 73446617, "body": "@JimB I believe that the 30MB comes from downloading the zip/tar file from the github ui."}], "answers": [{"comments": [{"owner": {"reputation": 996, "user_id": 5266767, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/852b19120d60f4852964889f5a6dc01e?s=128&d=identicon&r=PG&f=1", "display_name": "d9ngle", "link": "https://stackoverflow.com/users/5266767/d9ngle"}, "edited": false, "score": 0, "creation_date": 1491241956, "post_id": 43186516, "comment_id": 73455313, "body": "replaced zip content with the <code>&#47;cockroach</code> folder, copied <code>.go-version</code> and <code>.bootstrap</code> from <code>go get</code> version, ran <code>make build</code> and here&#39;s what I encountered :  <code># github.com&#47;cockroachdb&#47;cockroach&#47;pkg&#47;util&#47;log pkg&#47;util&#47;log&#47;flags.go:28: not enough arguments in call to logflags.InitFlags \thave (*syncutil.Mutex, *bool, *logDirName, *bool, *level, *moduleSpec, *traceLocation) \twant (sync.Locker, *bool, flag.Value, *bool, *bool, flag.Value, flag.Value, flag.Value) Makefile:122: recipe for target &#39;install&#39; failed make: *** [install] Error 2</code>"}, {"owner": {"reputation": 996, "user_id": 5266767, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/852b19120d60f4852964889f5a6dc01e?s=128&d=identicon&r=PG&f=1", "display_name": "d9ngle", "link": "https://stackoverflow.com/users/5266767/d9ngle"}, "edited": false, "score": 0, "creation_date": 1491242171, "post_id": 43186516, "comment_id": 73455444, "body": "changed <code>sync.Locker</code> on line 74 in <code>logflags.go</code> to <code>*syncutil.Mutex</code>, encountered this error :   <code># github.com&#47;cockroachdb&#47;cockroach&#47;pkg&#47;util&#47;log&#47;logflags pkg&#47;util&#47;log&#47;logflags&#47;logflags.go:74: undefined: syncutil in syncutil.Mutex Makefile:122: recipe for target &#39;install&#39; failed make: *** [install] Error 2</code>  reverted the change. ran <code>make build</code> again. somehow it works now!!!!!!! the exec file is in <code>&#47;bin</code>, naturally. I <code>make clean</code> to try again, just to be sure and next time I run build, the exec file is in cockroach folder. Why does it act so random!?"}, {"owner": {"reputation": 16323, "user_id": 355499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/78892b9338a302a4ba3cc1aa77edd99f?s=128&d=identicon&r=PG", "display_name": "Emil H", "link": "https://stackoverflow.com/users/355499/emil-h"}, "reply_to_user": {"reputation": 996, "user_id": 5266767, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/852b19120d60f4852964889f5a6dc01e?s=128&d=identicon&r=PG&f=1", "display_name": "d9ngle", "link": "https://stackoverflow.com/users/5266767/d9ngle"}, "edited": false, "score": 0, "creation_date": 1491287011, "post_id": 43186516, "comment_id": 73471332, "body": "@d9ngle Are you sure that you are using a download from the correct branch? I would think it would contain all the files in the source tree. Also if you just need to build the app then once you have built the app you could delete the source (if you need the space). Is this an issue where you&#39;re building cockroachdb for use in a docker image or something where the image size matters?"}], "tags": [], "owner": {"reputation": 16323, "user_id": 355499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/78892b9338a302a4ba3cc1aa77edd99f?s=128&d=identicon&r=PG", "display_name": "Emil H", "link": "https://stackoverflow.com/users/355499/emil-h"}, "is_accepted": true, "score": 0, "last_activity_date": 1491228990, "last_edit_date": 1491228990, "creation_date": 1491227597, "answer_id": 43186516, "question_id": 43184477, "link": "https://stackoverflow.com/questions/43184477/how-to-install-a-go-app-without-using-go-get/43186516#43186516", "title": "How to install a Go app without using go get?", "body": "<p>Downloading cockroachdb using <code>go get</code> I get a <code>$GOPATH/src/github.com/cockroachdb/cockroach</code> with a size of 664MB.</p>\n\n<p>I then tried to clone the github repo for cockroachdb it has a size of 304MB most of which is because of the <code>.git</code> hidden folder which is 263MB.</p>\n\n<p>Downloading a zipfile from the github ui and unpacking it I end up with a 42MB folder. </p>\n\n<p>The pure git cloned repo and the zipfile version however lacks the <a href=\"https://blog.gopheracademy.com/advent-2015/vendor-folder/\" rel=\"nofollow noreferrer\"><code>vendor</code> folder which you can read about here</a>. It accounts for another 302MB. The folder is populated with the dependencies of cockroachdb when <code>go get</code> is used to download the repo (I'm guessing that it follows the link to the vendor repo for cockroach that you can see on the github page).</p>\n\n<p>Since I've done this from the master branch my sizes are a bit different from the <code>v0.1-alpha</code> version. But I'm guessing that it has a similar cause for the size difference. </p>\n\n<p>To get it to \"work\" using the zipfile you could try to extract the zipfile to <code>$GOPATH/src/github.com/cockroachdb/cockroach</code>. Then do a <code>git init</code> in that folder. And then follow the instructions in the README for in that tag which indicate that you should run <code>make build</code>. However, I believe you will still need to get some of cockroachdb's dependencies, so it is probably a lot simpler to just follow the official instructions.</p>\n\n<p>I haven't tried it, but are you certain that <code>make install</code> causes new downloads each time you run it?</p>\n"}, {"comments": [{"owner": {"reputation": 996, "user_id": 5266767, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/852b19120d60f4852964889f5a6dc01e?s=128&d=identicon&r=PG&f=1", "display_name": "d9ngle", "link": "https://stackoverflow.com/users/5266767/d9ngle"}, "edited": false, "score": 0, "creation_date": 1491244659, "post_id": 43187785, "comment_id": 73456823, "body": "Managed to get it to build! By the way this blog post is repeated twice <a href=\"https://www.cockroachlabs.com/blog/cant-run-100-node-cockroachdb-cluster/\" rel=\"nofollow noreferrer\">Why Can\u2019t I Run a 100-Node CockroachDB Cluster?</a>"}], "tags": [], "owner": {"reputation": 20703, "user_id": 2805033, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TasHL.jpg?s=128&g=1", "display_name": "Ben Darnell", "link": "https://stackoverflow.com/users/2805033/ben-darnell"}, "is_accepted": false, "score": 4, "last_activity_date": 1491231026, "creation_date": 1491231026, "answer_id": 43187785, "question_id": 43184477, "link": "https://stackoverflow.com/questions/43184477/how-to-install-a-go-app-without-using-go-get/43187785#43187785", "title": "How to install a Go app without using go get?", "body": "<blockquote>\n  <p>I used git checkout v0.1-alpha to switch to the version I want</p>\n</blockquote>\n\n<p><code>v0.1-alpha</code> is ancient, and surely not what you want (I'm not too surprised that it doesn't build any more; we've improved the repeatability of our build process since then). The most current releases (as of this writing) are the ones of the form <code>beta-YYYYMMDD</code>. </p>\n\n<p>CockroachDB <a href=\"https://www.cockroachlabs.com/docs/install-cockroachdb.html\" rel=\"nofollow noreferrer\">binary releases</a> can be installed without <code>go get</code>. We're currently reworking the installation instructions to use a source tarball instead of <code>go get</code> or <code>git clone</code>. </p>\n"}], "owner": {"reputation": 996, "user_id": 5266767, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/852b19120d60f4852964889f5a6dc01e?s=128&d=identicon&r=PG&f=1", "display_name": "d9ngle", "link": "https://stackoverflow.com/users/5266767/d9ngle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1140, "favorite_count": 0, "accepted_answer_id": 43186516, "answer_count": 2, "score": 2, "last_activity_date": 1491231026, "creation_date": 1491221895, "question_id": 43184477, "link": "https://stackoverflow.com/questions/43184477/how-to-install-a-go-app-without-using-go-get", "title": "How to install a Go app without using go get?", "body": "<p>I'm trying to install a specific version of CockroachDB on my ubuntu machine. I followed the guide on the site and after downloading ~200MB, the latest version is installed :</p>\n\n<pre><code>$ go get -d github.com/cockroachdb/cockroach\n$ cd $GOPATH/src/github.com/cockroachdb/cockroach\n$ git checkout beta-20170330\n$ make install\n</code></pre>\n\n<p>One issue is that <code>/src/github.com/cockroachdb/cockroach</code> is 300MB while if I download last version from the GitHub page it is only 30MB. Why?</p>\n\n<p>I used <code>git checkout v0.1-alpha</code> to switch to the version I want :</p>\n\n<pre><code>warning: unable to rmdir vendor: Directory not empty\nPrevious HEAD position was f0f5783... Merge pull request #14448 from BramGruneir/vendorsnappy\nHEAD is now at 26088f8... Merge pull request #3475 from mrtracy/mtracy/code_review_feedback\n</code></pre>\n\n<p>But it fails after running <code>make install</code> :</p>\n\n<pre><code>github.com/agtorre/gocolorize                      99fea4bc9517 [checkout f42b554bf7f0]\ngithub.com/biogo/store                             913427a1d5e8 [checkout 3b4c041f52c2]\ngithub.com/cockroachdb/c-lz4                       834d3303c9e8 [checkout c40aaae2fc50]\ngithub.com/cockroachdb/c-protobuf                  323984796a7b [checkout 6a18bfcdd516]\ngithub.com/cockroachdb/c-rocksdb                   0dd42399d1f0 [checkout bf15ead80bdc]\ngithub.com/cockroachdb/c-snappy                    c0cd3c9ce92f [checkout 5c6d0932e0ad]\ngithub.com/cockroachdb/yacc                        7c99dfd2164a [get checkout 443154b1852a]\ngithub.com/coreos/etcd                             38a914973544 [checkout 0eb46eb1457b]\ngithub.com/cpuguy83/go-md2man                      a65d4d2de4d5 [get checkout 71acacd42f85]\ngithub.com/docker/docker                           6311e9fc9d34 [get checkout 5e0283effa73]\ngithub.com/elazarl/go-bindata-assetfs              30f82fa23fd8 [checkout d5cac425555c]\ngithub.com/go-sql-driver/mysql                     9dee4ca50b83 [get checkout d512f204a577]\ngithub.com/gogo/protobuf                           c0656edd0d9e [checkout 8658879224bd]\ngithub.com/golang/lint                             cb00e5669539 [get checkout 32a87160691b]\ngithub.com/google/btree                            316fb6d3f031 [checkout cc6329d4279e]\ngithub.com/gordonklaus/ineffassign                 f0c5cfc1817d [get checkout 507e48671a07]\ngithub.com/inconshreveable/mousetrap               76626ae9c91c [get OK]\ngithub.com/jteeuwen/go-bindata                     a0ff2567cfb7 [get OK]\ngithub.com/julienschmidt/httprouter                6f3f3919c878 [checkout f30ab90cccbd]\ngithub.com/kisielk/errcheck                        23699b7e2cbf [get checkout 12fd1ab9811e]\ngithub.com/kisielk/gotool                          0de1eaf82fa3 [get checkout 58a7a198f2ec]\ngithub.com/kr/pretty                               cfb55aafdaf3 [get checkout e6ac2fc51e89]\ngithub.com/kr/text                                 7cafcd837844 [get checkout bb797dc4fb83]\ngithub.com/lib/pq                                  2704adc878c2 [checkout 11fc39a580a0]\ngithub.com/mattn/go-runewidth                      14207d285c6c [checkout d96d1bd051f2]\ngithub.com/mibk/dupl                               3447d9b0cb5a [get checkout 47b66d6a523f]\ngithub.com/montanaflynn/stats                      f8cd06f93c6c [checkout 4dd27fe9ac79]\ngithub.com/olekukonko/tablewriter                  febf2d34b54a [checkout 333c0610de34]\ngithub.com/opennota/check                          11e2eec79ec4 [get checkout 591428223a6a]\ngithub.com/peterh/liner                            88609521dc4b [checkout 4d47685ab2fd]\ngithub.com/rcrowley/go-metrics                     1f30fe9094a5 [checkout 7839c01b09d2]\ngithub.com/robfig/glock                            39b969c32281 [checkout cb3c3ec56de9]\ngithub.com/russross/blackfriday                    5f33e7b78783 [get checkout d18b67ae0afd]\ngithub.com/samalba/dockerclient                    a30362618471 [get checkout 4656b1bc6cbc]\ngithub.com/shurcooL/sanitized_anchor_name          1dba4b3954bc [get checkout 10ef21a441db]\ngithub.com/spf13/cobra                             7aeaa2cce6ae [checkout ee6224d01f6a]\ngithub.com/spf13/pflag                             d16db1e50e33 [checkout 08b1a584251b]\ngithub.com/tebeka/go2xunit                         13c29c7515e6 [get checkout 0519fcc9b45b]\ngithub.com/termie/go-shutil                        bcacb06fecae [get OK]\ngolang.org/x/crypto                                88915ccf7aeb [checkout 7b85b097bf75]\ngolang.org/x/net                                   ffcf1bedda3b [checkout 21af302bb527]\ngolang.org/x/text                                  f4b4367115ec [checkout 00e205363f74]\ngolang.org/x/tools                                 620ecdb8d794 [checkout 1cdaff4a02c5]\ngopkg.in/yaml.v1                                   9f9df34309c0 [OK]\ncmd github.com/cockroachdb/c-protobuf/cmd/protoc                [built]\ncmd github.com/cockroachdb/cockroach/protoc-gen-gogoroach       [error exit status 2]\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/protoc-gen-gogo/descriptor\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/gogoproto\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/protoc-gen-gogo/plugin\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/vanity\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/protoc-gen-gogo/generator\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/testgen\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/defaultcheck\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/embedcheck\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/enumstringer\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/marshalto\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/oneofcheck\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/populate\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/unmarshal\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/compare\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/description\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/equal\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/face\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/gostring\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/size\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/stringer\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/plugin/union\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/protoc-gen-gogo/grpc\ngithub.com/cockroachdb/cockroach/vendor/github.com/gogo/protobuf/vanity/command\ngithub.com/cockroachdb/cockroach/protoc-gen-gogoroach\n# github.com/cockroachdb/cockroach/protoc-gen-gogoroach\nprotoc-gen-gogoroach/main.go:12: undefined: vanity.NotInPackageGoogleProtobuf\ngo install -tags ''  -ldflags '-X \"github.com/cockroachdb/cockroach/util.buildTag=alpha-6447-g26088f8\" -X \"github.com/cockroachdb/cockroach/util.buildTime=2017/04/03 11:46:56\" -X \"github.com/cockroachdb/cockroach/util.buildDeps=github.com/cockroachdb/c-lz4:c40aaae2fc50293eb8750b34632bc3efe813e23f github.com/cockroachdb/cockroach:26088f81e5ecfb2fd63f8f15f524102c9a0c1c05 github.com/cockroachdb/cockroach/vendor:17711805119083543d94edac10e423260a597426 github.com/julienschmidt/httprouter:f30ab90cccbd5171771d26b6557d3c2f49e047a6 github.com/peterh/liner:4d47685ab2fd2dbb46c66b831344d558bc4be5b9 gopkg.in/yaml.v1:9f9df34309c04878acc86042b16630b0f696e1de\"'\n# github.com/cockroachdb/cockroach/cli\ncli/sql_util.go:148: table.Append(row) used as value\nMakefile:71: recipe for target 'install' failed\nmake: *** [install] Error 2\n</code></pre>\n\n<p>I'd really appreciate if I could install the specific version I downloaded from GitHub because it's smaller in size and it has a cleaner structure. But it's missing some files such as <code>.go-version</code> <code>.bootstrap</code> and <code>fatal: Not a git repository (or any of the parent directories): .git</code></p>\n\n<p>Does <code>go get</code> insert these files itself? How do I initialize them?</p>\n\n<p>Shouldn't there be a better way to do this, without having to download an extra 100MB everytime I run <code>make install</code>?</p>\n"}, {"tags": ["go", "google-cloud-datastore", "google-cloud-platform"], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1491225738, "post_id": 43184046, "comment_id": 73444604, "body": "You are my hero &lt;3.. regarding the noindex tag, most of the articles I&#39;ve read, <a href=\"https://cloud.google.com/appengine/docs/flexible/go/configuring-datastore-indexes-with-index-yaml\" rel=\"nofollow noreferrer\">such as this one</a> set the indexes using a yaml file.. but your code makes me wonder if it&#39;s also possible to set index in the struct like you just did, e.g. <code>datastore:&quot;index&quot;</code>?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1491226662, "post_id": 43184046, "comment_id": 73445314, "body": "@fisker You use the index configuration file (e.g. <code>index.yaml</code>) to define the <i>composite</i> indices. What you specify in the tag of a struct field only tells if that property is indexed (or in other words: if the entity is indexed by that property). These are 2 different things."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1491228608, "post_id": 43184046, "comment_id": 73446812, "body": "if I understand correctly then it&#39;s not necessary to specify <code>datastore:&quot;,index&quot;</code> because the fields already take advantage of built-in indices? So assuming the Post struct had a Date and a Tag field, then it wouldn&#39;t be necessary to do anything to filter the Tag field since it can be achieved with equality filters, whereas for the Date field then it would be recommended to define composite indices in order to perform filters that sort by date? (sorry for being off-topic and taking advantage of your brilliance)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1491230231, "post_id": 43184046, "comment_id": 73448106, "body": "@fisker Fields (except for <code>[]byte</code>) are indexed by default, so specifying the <code>&quot;index&quot;</code> tag is not needed. You create composite indices to support more advanced queries that include inequality filters and sorting. For more on the topic, read <a href=\"https://cloud.google.com/appengine/docs/standard/go/datastore/indexes\" rel=\"nofollow noreferrer\">Cloud Datastore Indexes</a> and <a href=\"https://cloud.google.com/appengine/articles/indexselection\" rel=\"nofollow noreferrer\">Index Selection and Advanced Search</a>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1491237762, "last_edit_date": 1495540925, "creation_date": 1491220613, "answer_id": 43184046, "question_id": 43183353, "link": "https://stackoverflow.com/questions/43183353/storing-long-text-in-datastore/43184046#43184046", "title": "Storing long text in Datastore", "body": "<p>Yes, it's suitable if you're OK with certain limitations.</p>\n\n<p>These limitations are:</p>\n\n<ul>\n<li>the overall entity size (properties + indices) must not exceed 1 MB (this should be OK for profiles and most articles)</li>\n<li>texts longer than a certain limit (currently 1500 bytes) cannot be indexed, so the entity may store a longer string, but you won't be able to search in it / include it in query filters; don't forget to <a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go/30889373#30889373\">tag</a> these fields with <code>\"noindex\"</code></li>\n</ul>\n\n<p>As for the type, you may simply use <code>string</code>, e.g.:</p>\n\n<pre><code>type Post struct {\n    UserID  int64  `datastore:\"uid\"`\n    Content string `datastore:\"content,noindex\"`\n}\n</code></pre>\n\n<p><code>string</code> types preserve all formatting, including newlines, HTML, markup and whatever formatting.</p>\n\n<p><em>\"Dirty user input?\"</em> That's the issue of rendering / presenting the data. The datastore will not try to interpret it or attempt to perform any action based on its content, nor will transform it. So from the Datastore point of view, you have nothing to worry about (you don't create text GQLs by appending text ever, right?!).</p>\n\n<p>Also note that if you're going to store large texts in your entities, those large texts will be fetched whenever you load / query such entities, and you also must send it when you modify and (re)save such an entity.</p>\n\n<p><strong>Tip #1:</strong> Use <a href=\"https://cloud.google.com/appengine/docs/standard/go/datastore/reference#Query.Project\" rel=\"nofollow noreferrer\">projection queries</a> if you don't need the whole texts in certain queries to avoid \"big\" data movement (and so to ultimately speed up queries).</p>\n\n<p><strong>Tip #2:</strong> To \"ease\" the burden of not being able to index large texts, you may add duplicate properties like a short summary or title of the large text, because <code>string</code> values shorter than 1500 bytes can be indexed.</p>\n\n<p><strong>Tip #3:</strong> If you want to go over the 1 MB entity size limit, or you just want to generally decrease your datastore size usage, you may opt to store large texts <em>compressed</em> inside entities. Since they are long, you can't search / filter them anyway, but they are very well compressed (often below 40% of the original). So if you have many long texts, you can shrink your datastore size to like 1 third just by storing all texts compressed. Of course this will add to the entity save / load time (as you have to compress / decompress the texts), but often it is still worth it.</p>\n"}], "owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1108, "favorite_count": 0, "accepted_answer_id": 43184046, "answer_count": 1, "score": 2, "last_activity_date": 1491237762, "creation_date": 1491218550, "question_id": 43183353, "link": "https://stackoverflow.com/questions/43183353/storing-long-text-in-datastore", "title": "Storing long text in Datastore", "body": "<p>Is Datastore suitable to store really long text, e.g. profile descriptions and articles? </p>\n\n<p>If not, what's the Google Cloud alternative?</p>\n\n<p>If yes, what would be the ideal way to store it in order to maintain formatting such as linebreaks and markdown supported keywords? Simply store as string or convert to byte? And should I be worried about dirty user input?</p>\n\n<p>I need it for a Go project (I don't think language is relevant, but maybe Go have some useful features for this)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491216108, "post_id": 43182427, "comment_id": 73437645, "body": "Any thoughts? .."}, {"owner": {"reputation": 272630, "user_id": 105929, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/414213a8181616151fe73334532746ab?s=128&d=identicon&r=PG", "display_name": "Remus Rusanu", "link": "https://stackoverflow.com/users/105929/remus-rusanu"}, "edited": false, "score": 0, "creation_date": 1491216185, "post_id": 43182427, "comment_id": 73437695, "body": "Test if its equal to its own <a href=\"https://golang.org/pkg/math/#Floor\" rel=\"nofollow noreferrer\"><code>Floor</code></a> ?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1491217259, "post_id": 43182427, "comment_id": 73438402, "body": "<a href=\"https://golang.org/pkg/math/#Trunc\" rel=\"nofollow noreferrer\">golang.org/pkg/math/#Trunc</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1641, "user_id": 1519937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XDdSU.jpg?s=128&g=1", "display_name": "Dovydas Bartkevi\u010dius", "link": "https://stackoverflow.com/users/1519937/dovydas-bartkevi%c4%8dius"}, "is_accepted": false, "score": 5, "last_activity_date": 1491216300, "creation_date": 1491216300, "answer_id": 43182538, "question_id": 43182427, "link": "https://stackoverflow.com/questions/43182427/go-lang-how-to-check-if-float-value-is-actually-int/43182538#43182538", "title": "Go lang how to check if float value is actually int", "body": "<p>You could achieve it by doing a modulus</p>\n\n<pre><code>func isFloatInt(floatValue float64) bool {\n    return math.Mod(floatValue, 1.0) == 0\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 7808038, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a411832d88981dde99c1305922fead0?s=128&d=identicon&r=PG&f=1", "display_name": "dongyan", "link": "https://stackoverflow.com/users/7808038/dongyan"}, "edited": false, "score": 0, "creation_date": 1491221886, "post_id": 43182566, "comment_id": 73441623, "body": "As a fresh hand of go lang, thank you for your help!"}], "tags": [], "owner": {"reputation": 7769, "user_id": 38851, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9526779da056a47fb468095836dc0f73?s=128&d=identicon&r=PG", "display_name": "babbageclunk", "link": "https://stackoverflow.com/users/38851/babbageclunk"}, "is_accepted": true, "score": 10, "last_activity_date": 1491216691, "last_edit_date": 1491216691, "creation_date": 1491216371, "answer_id": 43182566, "question_id": 43182427, "link": "https://stackoverflow.com/questions/43182427/go-lang-how-to-check-if-float-value-is-actually-int/43182566#43182566", "title": "Go lang how to check if float value is actually int", "body": "<p>I just <a href=\"https://play.golang.org/p/1C9GdJWK_6\" rel=\"noreferrer\">checked on the playground</a>, this does the right thing with NaN as well.</p>\n\n<pre><code>func isIntegral(val float64) bool {\n    return val == float64(int(val))\n}\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 7808038, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0a411832d88981dde99c1305922fead0?s=128&d=identicon&r=PG&f=1", "display_name": "dongyan", "link": "https://stackoverflow.com/users/7808038/dongyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4708, "favorite_count": 1, "closed_date": 1491221617, "accepted_answer_id": 43182566, "answer_count": 2, "score": 2, "last_activity_date": 1491216691, "creation_date": 1491215926, "question_id": 43182427, "link": "https://stackoverflow.com/questions/43182427/go-lang-how-to-check-if-float-value-is-actually-int", "closed_reason": "Duplicate", "title": "Go lang how to check if float value is actually int", "body": "<pre><code>func isFloatInt(floatValue float64) bool{\n//What's the implementation here?\n\n}\n</code></pre>\n\n<p><b>Test cases:</b> <br>\ninput: 1.5 output: false;<br>\ninput: 1 output: true;<br>\ninput:1.0 output: true;<br></p>\n"}, {"tags": ["go", "plugins"], "answers": [{"comments": [{"owner": {"reputation": 3889, "user_id": 100405, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/924e4500ab6bdce291ab6346099ede26?s=128&d=identicon&r=PG", "display_name": "weima", "link": "https://stackoverflow.com/users/100405/weima"}, "edited": false, "score": 0, "creation_date": 1491216153, "post_id": 43181795, "comment_id": 73437670, "body": "thanks for your answer. 1) the logger is created by a framework, so i cannot create a logger from within the plugin. the logger framework lies in the executable which opens the plugin, 2) my point is to make plugin not contain the logger framework in itself. rather depend on the logger interface which will be initialized when plugin is loaded. plugin just needs to tell which type of logger it wants. and after that plugin works on the interface. 3) <code>init</code> cannot be used because it is called before any <code>plugin.Lookup</code> can be performed"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3889, "user_id": 100405, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/924e4500ab6bdce291ab6346099ede26?s=128&d=identicon&r=PG", "display_name": "weima", "link": "https://stackoverflow.com/users/100405/weima"}, "edited": false, "score": 0, "creation_date": 1491216251, "post_id": 43181795, "comment_id": 73437741, "body": "@weima See edited answer. Now the plugin does not create loggers, it does not refer to the logger implementation."}, {"owner": {"reputation": 3889, "user_id": 100405, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/924e4500ab6bdce291ab6346099ede26?s=128&d=identicon&r=PG", "display_name": "weima", "link": "https://stackoverflow.com/users/100405/weima"}, "edited": false, "score": 0, "creation_date": 1491217954, "post_id": 43181795, "comment_id": 73438873, "body": "in other words, your solution is: instead of passing the <code>createLoggerType</code> to the plugin as an argument to its <code>InitPlugin</code> function, create a new package in the executable which holds the same function in an exported variable, and this <code>package store</code> has a minimum set of dependencies. This is what i wanted to avoid actually, the plugin importing anything other than the interface and implementation being supplied to the plugin rather than plugin deciding the implementation. and what if i want to decide at runtime the Factory for the Logger, depending on the plugin type."}, {"owner": {"reputation": 3889, "user_id": 100405, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/924e4500ab6bdce291ab6346099ede26?s=128&d=identicon&r=PG", "display_name": "weima", "link": "https://stackoverflow.com/users/100405/weima"}, "edited": false, "score": 0, "creation_date": 1491217972, "post_id": 43181795, "comment_id": 73438887, "body": "This is not so much problem in C/C++, i was expecting same way. in Go, even a very simple plugin, when built copies in itself a large amount of packages. i somehow don&#39;t like it."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3889, "user_id": 100405, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/924e4500ab6bdce291ab6346099ede26?s=128&d=identicon&r=PG", "display_name": "weima", "link": "https://stackoverflow.com/users/100405/weima"}, "edited": false, "score": 0, "creation_date": 1491218063, "post_id": 43181795, "comment_id": 73438950, "body": "@weima There is nothing wrong with your solution, but I thought you wanted to be able to use it in variable declarations and package <code>init()</code> functions, and my solution allows you to do so."}, {"owner": {"reputation": 3889, "user_id": 100405, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/924e4500ab6bdce291ab6346099ede26?s=128&d=identicon&r=PG", "display_name": "weima", "link": "https://stackoverflow.com/users/100405/weima"}, "edited": false, "score": 0, "creation_date": 1491218296, "post_id": 43181795, "comment_id": 73439159, "body": "i mean to say that, if i use my solution way, variables cannot be initialized when plugin is opened. it has to be done via spacially written <code>Init</code>functions just for this purpose, and for every package. But i will try to use your suggestion. Thanks ! :)"}, {"owner": {"reputation": 3889, "user_id": 100405, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/924e4500ab6bdce291ab6346099ede26?s=128&d=identicon&r=PG", "display_name": "weima", "link": "https://stackoverflow.com/users/100405/weima"}, "edited": false, "score": 0, "creation_date": 1491218398, "post_id": 43181795, "comment_id": 73439232, "body": "and lately i am getting fatal errors randomly, raised an issue  <a href=\"https://github.com/golang/go/issues/19824\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/19824</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1491233823, "last_edit_date": 1491233823, "creation_date": 1491214058, "answer_id": 43181795, "question_id": 43181410, "link": "https://stackoverflow.com/questions/43181410/go-plugin-variable-initialization/43181795#43181795", "title": "Go Plugin variable initialization", "body": "<p>There is nothing wrong with your solution, but if you want to be able to use it in variable declarations and package <code>init()</code> functions, this is how you can do it. I also think it's easier to use the plugin this way, but this requires a common, shared package between your main app and the plugin.</p>\n\n<p>One option would be to create a \"store\" package, which could store factory functions or pre-created loggers.</p>\n\n<p>Let's say the <code>Logger</code> interface definition is in <code>mylogger</code>:</p>\n\n<pre><code>package mylogger\n\ntype Logger interface { Log(string) }\n</code></pre>\n\n<p>The <code>store</code> for example:</p>\n\n<pre><code>package store\n\nimport \"mylogger\"\n\nvar LoggerFactory func(string) mylogger.Logger\n</code></pre>\n\n<p>And in your main app initialize it <strong>before</strong> you load / open the <code>mypackage</code> plugin:</p>\n\n<pre><code>package main\n\nimport \"store\"\n\nfunc main() {\n    store.LoggerFactory = logger.CreateLogger\n\n    // Now proceed to load / open mypackage plugin\n}\n</code></pre>\n\n<p>Then the <code>mypackage</code> plugin may look like this:</p>\n\n<pre><code>package mypackage\n\nimport \"store\"\n\nvar dlog = store.LoggerFactory(\"mypackage\")\n</code></pre>\n"}], "owner": {"reputation": 3889, "user_id": 100405, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/924e4500ab6bdce291ab6346099ede26?s=128&d=identicon&r=PG", "display_name": "weima", "link": "https://stackoverflow.com/users/100405/weima"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 338, "favorite_count": 0, "accepted_answer_id": 43181795, "answer_count": 1, "score": 3, "last_activity_date": 1491233823, "creation_date": 1491212842, "last_edit_date": 1491213557, "question_id": 43181410, "link": "https://stackoverflow.com/questions/43181410/go-plugin-variable-initialization", "title": "Go Plugin variable initialization", "body": "<p>This is a general question about Go Plugin initialization.</p>\n\n<p>I want to make a certain package in a Go program to a Go Plugin.</p>\n\n<p>The package (say <code>mypackage</code>) has a variable which is initialized with a function call from a certain package in the executable. (E.g. a variable of type <code>interface Logger</code> which is to be initialized by a <code>logger.CreateLogger</code> function.)</p>\n\n<p>In order to make <code>mypackage</code> a plugin, I need to create a <code>main</code> package, embed <code>mypackage</code> inside <code>main</code>, and export an api <code>Init</code> in package <code>main</code> which accepts a function which can get me a logger. </p>\n\n<p>I want to do this so as to reduce the dependencies of my plugin. The <code>mypackage</code> plugin should depend on the <code>interface Logger</code> rather than Logger's implementation.</p>\n\n<p>Now the problem is the initialization, in the case of executable, the initialization could have happened as below:</p>\n\n<pre><code>package mypackage\n\nvar dlog = logger.CreateLogger(\"mypackage\")\n</code></pre>\n\n<p>And the logger can be used in any <code>func init()</code> function of <code>mypackage</code>.</p>\n\n<p>After converting to a plugin, it can't be initialized like this. It has to be initialized at a later point after the <code>main.Init</code> is invoked.</p>\n\n<p>The <code>func init</code> is invoked when the plugin is Opened, so it cannot be used to initialize variables.</p>\n\n<p>Only solution seems to be a creating a function per package, and invoke it from an exported function in <code>main</code> package.</p>\n\n<pre><code>package mypackage\n\nvar dlog Logger\n\nfunc Init(f createLoggerType){\n   dlog = f()\n   yetanotherpackage.Init(f)\n}\n\npackage main\n\nfunc Init(f createLoogerType) {\n    mypackage.Init(f)\n    anotherpackage.Init(f)        \n}\n</code></pre>\n\n<p>Is there a better way to initialize? I tried checking <code>github.com/facebookgo/inject</code> but couldn't figure out how it can be used in case of plugins.</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 21412, "user_id": 333698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ca080b4ef1c6cb4df9bc123d3b3af61?s=128&d=identicon&r=PG", "display_name": "psmears", "link": "https://stackoverflow.com/users/333698/psmears"}, "edited": false, "score": 5, "creation_date": 1491211648, "post_id": 43180936, "comment_id": 73434724, "body": "No, it executes when the previous line finishes. There&#39;s no <code>go</code>, so it&#39;s not a goroutine. (The <code>gen</code> function may <i>start</i> a goroutine, but that&#39;s entirely separate and runs in the background.)"}], "answers": [{"tags": [], "owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "is_accepted": true, "score": 0, "last_activity_date": 1491234691, "creation_date": 1491234691, "answer_id": 43189046, "question_id": 43180936, "link": "https://stackoverflow.com/questions/43180936/when-next-goroutine-is-executed/43189046#43189046", "title": "When next goroutine is executed?", "body": "<p>Your code does not use goroutines, in order to use go routines you should  do something like this: </p>\n\n<pre><code>q := make(chan type) \ngo sq(in, q)\ngo sq(in, q)\n\nfor elem := range q {\n    fmt.Println(elem)\n}\n</code></pre>\n\n<p>and sq must return the value through a channel</p>\n\n<pre><code>func sq(in type, q chan type) {\n     ...\n     q &lt;- valueFromIn\n     ...\n}\n</code></pre>\n\n<p>Also you can use <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">WaitGroup</a> to wait for goroutines to finish.</p>\n"}], "owner": {"reputation": 42794, "user_id": 135829, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/zfWZK.jpg?s=128&g=1", "display_name": "Sergei Basharov", "link": "https://stackoverflow.com/users/135829/sergei-basharov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 43189046, "answer_count": 1, "score": -4, "last_activity_date": 1491234691, "creation_date": 1491211430, "question_id": 43180936, "link": "https://stackoverflow.com/questions/43180936/when-next-goroutine-is-executed", "title": "When next goroutine is executed?", "body": "<p>I am looking at the example from <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">https://blog.golang.org/pipelines</a>:</p>\n\n<pre><code>func main() {\n    in := gen(2, 3)\n\n    // Distribute the sq work across two goroutines that both read from in.\n    c1 := sq(in)\n\n    // When does this line below execute and what is in `in`?\n    c2 := sq(in)\n\n    // Consume the merged output from c1 and c2.\n    for n := range merge(c1, c2) {\n        fmt.Println(n) // 4 then 9, or 9 then 4\n    }\n}\n</code></pre>\n\n<p>When does <code>c2 := sq(in)</code> run? As what I understand, it executes not when previous line finishes, but instantly as that is a goroutine.</p>\n\n<p>Will <code>c2</code> receive the next incoming message that is after coming after the message that is received by <code>c1</code>?</p>\n"}, {"tags": ["google-app-engine", "go", "google-bigquery"], "comments": [{"owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 1, "creation_date": 1491402395, "post_id": 43176652, "comment_id": 73538175, "body": "try to see if this solution works for you: <a href=\"http://stackoverflow.com/questions/43221963/google-app-engine-ssl-certificate-error/43233424#43233424\" title=\"google app engine ssl certificate error\">stackoverflow.com/questions/43221963/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1929, "user_id": 749658, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/38221f32af50a9b9df3fd437c14fc40d?s=128&d=identicon&r=PG", "display_name": "Craig", "link": "https://stackoverflow.com/users/749658/craig"}, "edited": false, "score": 0, "creation_date": 1494809074, "post_id": 43295486, "comment_id": 74970249, "body": "I upgraded from 1.9.50 to 1.9.53, I had to get the cacerts.txt and urlfetch_cacerts.txt from 1.9.50 to get it to work again. Tried 1.9.52 and 1.9.51 with no success."}], "tags": [], "owner": {"reputation": 329, "user_id": 138826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81234bae63b40ff85b5b6f35201b8d65?s=128&d=identicon&r=PG", "display_name": "Strom", "link": "https://stackoverflow.com/users/138826/strom"}, "is_accepted": true, "score": 2, "last_activity_date": 1491662846, "creation_date": 1491662846, "answer_id": 43295486, "question_id": 43176652, "link": "https://stackoverflow.com/questions/43176652/ssl-certificate-verify-failed-on-gae-go/43295486#43295486", "title": "SSL: CERTIFICATE_VERIFY_FAILED on GAE/Go", "body": "<p>This is because Google has updated their server certificates but have not notified the Go SDK team of this, which still has the old certs.</p>\n\n<p>The solution seems fairly simple.</p>\n\n<ol>\n<li>Go to <code>google_appengine\\lib\\cacerts\\</code></li>\n<li>Rename <code>cacerts.txt</code> to <code>cacerts.txt.old</code>, and <code>urlfetch_cacerts.txt</code> to <code>urlfetch_cacerts.txt.old</code></li>\n<li>Download the <a href=\"https://storage.googleapis.com/appengine-sdks/featured/google_appengine_1.9.52.zip\" rel=\"nofollow noreferrer\">Python Linux SDK 1.9.52</a>.</li>\n<li>In this Python SDK there's also <code>google_appengine\\lib\\cacerts\\</code> directory with those two cert files. Copy them over to your Go SDK.</li>\n<li>Rejoice! You now have newer certs.</li>\n</ol>\n"}], "owner": {"reputation": 1713, "user_id": 4052858, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/710d5f65b404307fea9b5a1564c60549?s=128&d=identicon&r=PG&f=1", "display_name": "N.F.", "link": "https://stackoverflow.com/users/4052858/n-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1095, "favorite_count": 0, "accepted_answer_id": 43295486, "answer_count": 1, "score": 2, "last_activity_date": 1491662846, "creation_date": 1491194777, "last_edit_date": 1491195351, "question_id": 43176652, "link": "https://stackoverflow.com/questions/43176652/ssl-certificate-verify-failed-on-gae-go", "title": "SSL: CERTIFICATE_VERIFY_FAILED on GAE/Go", "body": "<p>I am developing GAE/Go application and trying to connect Google Big Query from local development server.</p>\n\n<p>My code is like this.</p>\n\n<pre><code>import (\n  \"cloud.google.com/go/bigquery\"\n  \"golang.org/x/net/context\"\n  \"google.golang.org/api/option\"\n  gaeLog \"google.golang.org/appengine/log\"\n  newappengine \"google.golang.org/appengine\"\n)\n\nfunc MyFunc(c *gin.Context) {\n  r := c.Request\n  ctx := newappengine.NewContext(r)\n  client, err := bigquery.NewClient(ctx, PROJECT_ID, option.WithServiceAccountFile(SERVICE_ACCOUNT_JSON_FILE_PATH))\n  if err != nil {\n      (Error Handling)\n  }\n\n  tableList := client.Dataset(DATASET_ID).Tables(ctx)\n  for {\n    v, err := tableList.Next()\n    if err == iterator.Done {\n        break\n    } else if err != nil {\n        gaeLog.Errorf(ctx, \"Failed to get meta-info: %v\", err)\n        return\n    }\n    :\n  }\n}\n</code></pre>\n\n<p>I invoked local development server with <code>goapp.bat serve</code> command.\nWhen I posted a request, I got an error.</p>\n\n<pre><code>api_dev.go:344: ERROR: Failed to get meta-info: Get https://www.googleapis.com/bigquery/v2/projects/myproject/datasets/mydataset/tables?alt=json&amp;pageToken=: oauth2: cannot fetch token: Post https://accounts.google.com/o/oauth2/token: API error 6 (urlfetch: SSL_CERTIFICATE_ERROR): [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:661)\n</code></pre>\n\n<p>I googled \"CERTIFICATE_VERIFY_FAILED\", but all I can find is python program. My application is GAE/Go program.</p>\n\n<p>How can I avoid this error?</p>\n"}, {"tags": ["json", "serialization", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1491197369, "post_id": 43176625, "comment_id": 73427572, "body": "Show what you have so far."}], "answers": [{"comments": [{"owner": {"reputation": 464, "user_id": 185333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e1f5636588cf15a48b2c827588abcbf?s=128&d=identicon&r=PG", "display_name": "waynethec", "link": "https://stackoverflow.com/users/185333/waynethec"}, "edited": false, "score": 1, "creation_date": 1525474325, "post_id": 43178272, "comment_id": 87385353, "body": "Wouldn&#39;t reframing your example from <code>type person2 Person</code> to use <code>type person2 *Person</code> provide more clarity?  The type conversion is then <code>person2(p)</code> instead of <code>(*person2)(p)</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 20, "last_activity_date": 1582834300, "last_edit_date": 1582834300, "creation_date": 1491202449, "answer_id": 43178272, "question_id": 43176625, "link": "https://stackoverflow.com/questions/43176625/call-json-unmarshal-inside-unmarshaljson-function-without-causing-stack-overflow/43178272#43178272", "title": "Call json.Unmarshal inside UnmarshalJSON function without causing stack overflow", "body": "<p>An easy and common way to avoid this / protect from it is to create a new type with the <a href=\"https://golang.org/ref/spec#Types\" rel=\"noreferrer\"><code>type</code></a> keyword, and use a type <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">conversion</a> to pass a value of this type (the value may be your original value, type conversion is possible because the new type has the original type as its underlying type).</p>\n\n<p>This works because the <code>type</code> keyword creates a new type, and the new type will have zero methods (it does not \"inherit\" the methods of the underlying type).</p>\n\n<p>Does this incur some run-time overhead? No. Quoting from <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">Spec: Conversions:</a></p>\n\n<blockquote>\n  <p>Specific rules apply to (non-constant) conversions between numeric types or to and from a string type. These conversions may change the representation of <code>x</code> and incur a run-time cost. <strong>All other conversions only change the type but not the representation of <code>x</code>.</strong></p>\n</blockquote>\n\n<p>Let's see an example. We have a <code>Person</code> type with a numeric <code>Age</code>, and we want to make sure the <code>Age</code> cannot be negative (less than <code>0</code>).</p>\n\n<pre><code>type Person struct {\n    Name string `json:\"name\"`\n    Age  int    `json:\"age\"`\n}\n\nfunc (p *Person) UnmarshalJSON(data []byte) error {\n    type person2 Person\n    if err := json.Unmarshal(data, (*person2)(p)); err != nil {\n        return err\n    }\n\n    // Post-processing after unmarshaling:\n    if p.Age &lt; 0 {\n        p.Age = 0\n    }\n    return nil\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>var p *Person\nfmt.Println(json.Unmarshal([]byte(`{\"name\":\"Bob\",\"age\":10}`), &amp;p))\nfmt.Println(p)\n\nfmt.Println(json.Unmarshal([]byte(`{\"name\":\"Bob\",\"age\":-1}`), &amp;p))\nfmt.Println(p)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/tYgPm14yNx\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&lt;nil&gt;\n&amp;{Bob 10}\n&lt;nil&gt;\n&amp;{Bob 0}\n</code></pre>\n\n<p>Of course the same technique works for custom marshaling (<code>MarshalJSON()</code>) too:</p>\n\n<pre><code>func (p *Person) MarshalJSON() ([]byte, error) {\n    // Pre-processing before marshaling:\n    if p.Age &lt; 0 {\n        p.Age = 0\n    }\n\n    type person2 Person\n    return json.Marshal((*person2)(p))\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>p = &amp;Person{\"Bob\", 10}\nfmt.Println(json.NewEncoder(os.Stdout).Encode(p))\np = &amp;Person{\"Bob\", -1}\nfmt.Println(json.NewEncoder(os.Stdout).Encode(p))\n</code></pre>\n\n<p>Output (on the same <a href=\"https://play.golang.org/p/tYgPm14yNx\" rel=\"noreferrer\">Go Playground</a> example):</p>\n\n<pre><code>{\"name\":\"Bob\",\"age\":10}\n&lt;nil&gt;\n{\"name\":\"Bob\",\"age\":0}\n&lt;nil&gt;\n</code></pre>\n\n<p>A very similar issue is when you define the <code>String() string</code> method for custom text representation for the <a href=\"https://golang.org/pkg/fmt/\" rel=\"noreferrer\"><code>fmt</code></a> package, and you want to use the default string representation which you modify. Read more about it here: <a href=\"https://stackoverflow.com/questions/43065856/the-difference-between-t-and-t/43065979#43065979\">The difference between t and *t</a></p>\n"}], "owner": {"reputation": 5764, "user_id": 1336532, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/93e5830761f6e85757991d5915369349?s=128&d=identicon&r=PG", "display_name": "Mahoni", "link": "https://stackoverflow.com/users/1336532/mahoni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2266, "favorite_count": 0, "accepted_answer_id": 43178272, "answer_count": 1, "score": 13, "last_activity_date": 1582834300, "creation_date": 1491194606, "question_id": 43176625, "link": "https://stackoverflow.com/questions/43176625/call-json-unmarshal-inside-unmarshaljson-function-without-causing-stack-overflow", "title": "Call json.Unmarshal inside UnmarshalJSON function without causing stack overflow", "body": "<p>I wanted to perform some additional steps for initializing a data structure inside my implementation <code>UnmarshalJSON</code>. Calling <code>json.Unmarshal(b, type)</code> inside that implementation, naturally, causes a stack overflow.</p>\n\n<p>The JSON decoder is continiously trying to look up, if there is a custom <code>UnmarshalJSON</code> implementation which then again, calls <code>json.Unmarshal</code>.</p>\n\n<p>Is there another way to do this? Just call the underlying default implementation without causing this?</p>\n"}, {"tags": ["go", "time", "format"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491240845, "post_id": 43176465, "comment_id": 73454673, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/25845172/parsing-date-string-in-golang\">Parsing date string in golang</a>"}], "answers": [{"tags": [], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "is_accepted": false, "score": 7, "last_activity_date": 1491193989, "creation_date": 1491193989, "answer_id": 43176522, "question_id": 43176465, "link": "https://stackoverflow.com/questions/43176465/go-time-parse-getting-month-out-of-range-error/43176522#43176522", "title": "Go time.Parse() getting \u201cmonth out of range\u201d error", "body": "<p>Your parsing format does not match the reference format and the input format in 2 places:</p>\n\n<ol>\n<li><p>The year in the reference format should be <code>2006</code></p></li>\n<li><p>The timezone offset is to be specified by numbers, not by timezone name: <code>-0700</code></p></li>\n</ol>\n\n<p>So:</p>\n\n<pre><code>t, err := time.Parse(\"02/Jan/2006:15:04:05 -0700\", nginx_time)\n</code></pre>\n\n<p>play.golang: <a href=\"https://play.golang.org/p/enJY0VBt3a\" rel=\"noreferrer\">https://play.golang.org/p/enJY0VBt3a</a></p>\n"}], "owner": {"reputation": 21, "user_id": 3160434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7447f8243854986291b5ba963085f2e8?s=128&d=identicon&r=PG&f=1", "display_name": "Sinopex", "link": "https://stackoverflow.com/users/3160434/sinopex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2461, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1491193989, "creation_date": 1491193496, "last_edit_date": 1491193647, "question_id": 43176465, "link": "https://stackoverflow.com/questions/43176465/go-time-parse-getting-month-out-of-range-error", "title": "Go time.Parse() getting \u201cmonth out of range\u201d error", "body": "<p>I'm new to Go and I was parsing a nginx time format string. You can check my code here:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>package main\r\n\r\nimport (\r\n\t\"time\"\r\n\t\"log\"\r\n\t\"fmt\"\r\n)\r\n\r\nfunc main(){\r\n\t//nginx time format\r\n\tnginx_time :=\"03/Apr/2017:08:29:05 +0800\"\r\n\tt,err:=time.Parse(\"02/Jan/2016:15:04:05 MST\",nginx_time)\r\n\r\n\tif err != nil {\r\n\t\tlog.Fatal(err)\r\n\t}\r\n\r\n\tfmt.Println(t.Format(\"2006-01-02 15:04:05\"))\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>I received the following error:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>GOROOT=/usr/local/go\r\nGOPATH=/usr/local/share/go:/Users/sinopex/goroot:/Users/sinopex/goroot\r\n/usr/local/go/bin/go build -o \"/private/var/folders/5b/yf1f_9lj06bfvqvcq2h9myph0000gn/T/Build 1.go and rungo\" /Users/sinopex/goroot/src/github.com/sinopex/golang/example/test/1.go\r\n\"/private/var/folders/5b/yf1f_9lj06bfvqvcq2h9myph0000gn/T/Build 1.go and rungo\"\r\n2017/04/03 12:17:12 parsing time \"03/Apr/2017:08:29:05 +0800\": month out of range\r\nhttp://stackoverflow.com/questions/ask#\r\nProcess finished with exit code 1</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Any ideas on what I am doing incorrectly?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "viper-go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491193189, "post_id": 43176391, "comment_id": 73426501, "body": "Seems like you need to do that manually after unmarshalling."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491193271, "post_id": 43176391, "comment_id": 73426518, "body": "Apparently it works if you use a config file but not with environmental variables. <a href=\"http://stackoverflow.com/questions/38955605/reading-a-slice-of-maps-with-golang-viper\" title=\"reading a slice of maps with golang viper\">stackoverflow.com/questions/38955605/&hellip;</a>"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1491193309, "post_id": 43176391, "comment_id": 73426528, "body": "Yep, because config files are structured, and environment variables is a collection of strings."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491262380, "post_id": 43176391, "comment_id": 73464496, "body": "@zerkms please make an answer so I can accept it."}, {"owner": {"reputation": 15512, "user_id": 10202, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/34f5afe635b1be9b8ac2c355fd548d0a?s=128&d=identicon&r=PG", "display_name": "Charlino", "link": "https://stackoverflow.com/users/10202/charlino"}, "edited": false, "score": 1, "creation_date": 1491264221, "post_id": 43176391, "comment_id": 73464960, "body": "What&#39;s the value for <code>viper.Get(&quot;languages&quot;)</code> ... ? Reason I ask is that I had a quick look at the source for viper and found this line: <a href=\"https://github.com/spf13/viper/blob/master/viper.go#L560\" rel=\"nofollow noreferrer\">github.com/spf13/viper/blob/master/viper.go#L560</a> which leads me to believe that what you want can be done... just maybe not by the .<code>Unmarshall</code> func."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 15512, "user_id": 10202, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/34f5afe635b1be9b8ac2c355fd548d0a?s=128&d=identicon&r=PG", "display_name": "Charlino", "link": "https://stackoverflow.com/users/10202/charlino"}, "edited": false, "score": 0, "creation_date": 1491269912, "post_id": 43176391, "comment_id": 73466249, "body": "@Charlino Actually, that is the correct answer. Setting that to true will unmarshall it correctly. Please make an answer."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "is_accepted": true, "score": 5, "last_activity_date": 1491427281, "creation_date": 1491427281, "answer_id": 43241844, "question_id": 43176391, "link": "https://stackoverflow.com/questions/43176391/how-do-i-unmarshal-environment-variables-to-a-slice-using-viper/43241844#43241844", "title": "How do I unmarshal environment variables to a slice using viper?", "body": "<p>Thanks to @Charlino here is the answer:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n\n    \"github.com/spf13/viper\"\n)\n\nfunc main() {\n    viper.SetEnvPrefix(\"myprefix\")\n    viper.SetTypeByDefaultValue(true)\n    viper.SetDefault(\"languages\", []string{\"french\", \"spanish\"})\n    viper.BindEnv(\"name\")\n    viper.BindEnv(\"languages\")\n\n    type config struct {\n        Name      string\n        Languages []string\n    }\n\n    var C config\n\n    err := viper.Unmarshal(&amp;C)\n    if err != nil {\n        log.Fatalln(\"unable to decode into struct, %v\", err)\n    }\n\n    log.Println(C)\n    log.Println(len(C.Languages))\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2536, "favorite_count": 1, "accepted_answer_id": 43241844, "answer_count": 1, "score": 2, "last_activity_date": 1491427281, "creation_date": 1491192871, "last_edit_date": 1491198037, "question_id": 43176391, "link": "https://stackoverflow.com/questions/43176391/how-do-i-unmarshal-environment-variables-to-a-slice-using-viper", "title": "How do I unmarshal environment variables to a slice using viper?", "body": "<p>I have the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n\n    \"github.com/spf13/viper\"\n)\n\nfunc main() {\n    viper.SetEnvPrefix(\"myprefix\")\n    viper.SetDefault(\"languages\", []string{\"french\", \"spanish\"})\n    viper.BindEnv(\"name\")\n    viper.BindEnv(\"languages\")\n\n    type config struct {\n        Name      string\n        Languages []string\n    }\n\n    var C config\n\n    err := viper.Unmarshal(&amp;C)\n    if err != nil {\n        log.Fatalln(\"unable to decode into struct, %v\", err)\n    }\n\n    log.Println(C)\n    log.Println(len(C.Languages))\n}\n</code></pre>\n\n<p>When <code>$MYPREFIX_LANGUAGES</code> is not set the length of C.Languages is 2 (eg the default). When I set <code>$MYPREFIX_LANGUAGES</code> to \"english spanish french russian\" I get a length of 1. It is just taking the variable as 1 long string, not a slice. How do I get a slice (<code>[]string{\"english\", \"spanish\", \"french\", \"russian\"}</code>?</p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491186487, "post_id": 43175681, "comment_id": 73425159, "body": "That&#39;s how you learn that global variables is evil and one must have followed the dependency inversion principle instead."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1491187011, "post_id": 43175681, "comment_id": 73425246, "body": "The <code>log.Println</code> function is already tested. Don&#39;t try to test other packages&#39; code, make you&#39;re code independently testable."}, {"owner": {"reputation": 13872, "user_id": 10176, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/b2507d479af955f05ee995b8d5daa6ac?s=128&d=identicon&r=PG", "display_name": "Jonathan Hartley", "link": "https://stackoverflow.com/users/10176/jonathan-hartley"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518747368, "post_id": 43175681, "comment_id": 84642256, "body": "@JimB The question is not &quot;<i>How do I test log.Println?</i>&quot; (which, as you rightly point out, would be silly) but instead is &quot;<i>How do I test that my main is calling log.Println properly?</i>&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 13872, "user_id": 10176, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/b2507d479af955f05ee995b8d5daa6ac?s=128&d=identicon&r=PG", "display_name": "Jonathan Hartley", "link": "https://stackoverflow.com/users/10176/jonathan-hartley"}, "edited": false, "score": 1, "creation_date": 1518747411, "post_id": 43175866, "comment_id": 84642267, "body": "The question is asking for a way to write an automated test - not how to manually demonstrate that it works."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 0, "last_activity_date": 1491188046, "creation_date": 1491188046, "answer_id": 43175866, "question_id": 43175681, "link": "https://stackoverflow.com/questions/43175681/how-to-test-logginglog-println-in-golang/43175866#43175866", "title": "How to test logging(log.Println) in Golang?", "body": "<p>Your program writes to the <code>log</code> package standard logger which writes to standard error. Compile and run your program and see what appears on standard error. </p>\n"}], "owner": {"reputation": 29, "user_id": 6135645, "user_type": "registered", "profile_image": "https://graph.facebook.com/1014809671935280/picture?type=large", "display_name": "sion_cojp", "link": "https://stackoverflow.com/users/6135645/sion-cojp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 785, "favorite_count": 1, "accepted_answer_id": 43175866, "answer_count": 1, "score": -1, "last_activity_date": 1491188046, "creation_date": 1491186420, "question_id": 43175681, "link": "https://stackoverflow.com/questions/43175681/how-to-test-logginglog-println-in-golang", "title": "How to test logging(log.Println) in Golang?", "body": "<p>How to test below the code in Golang?</p>\n\n<pre><code>package main\n\nimport \"log\"\n\nfunc main() {\n    log.Println(\"hello world\")\n}\n</code></pre>\n"}, {"tags": ["windows", "go", "environment-variables", "standard-library"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1491178979, "post_id": 43174876, "comment_id": 73423758, "body": "What is the <code>windows</code> package/variable? Please show your complete source code."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1491179834, "post_id": 43174876, "comment_id": 73423893, "body": "@Flimzy: You should know that: <a href=\"https://godoc.org/golang.org/x/sys/windows#Environ\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/sys/windows#Environ</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 3, "creation_date": 1491179875, "post_id": 43174876, "comment_id": 73423904, "body": "@peterSO: Why should I know that? It&#39;s not part of the standard library."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1491180246, "post_id": 43174876, "comment_id": 73423965, "body": "Are you using <code>x&#47;sys&#47;windows</code>? If so, why? &quot;The primary use of this package is inside other packages that provide a more portable interface to the system, such as &quot;os&quot;, &quot;time&quot; and &quot;net&quot;. Use those packages rather than this one if you can.&quot; Is there a reason <code>os.Env</code> doesn&#39;t work for you?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1491182349, "post_id": 43174876, "comment_id": 73424361, "body": "@Flimzy: <code>golang.org&#47;x&#47;sys&#47;windows</code> is an official Go package, it&#39;s an extension of the OS dependent <code>sycall</code> package. If you are going to answer Go OS dependent questions you should know that. Especially if you downvote or vote to close."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1491186145, "last_edit_date": 1491186145, "creation_date": 1491183574, "answer_id": 43175393, "question_id": 43174876, "link": "https://stackoverflow.com/questions/43174876/windows-environ-strings-0-and-1/43175393#43175393", "title": "windows.Environ() strings [0] and [1]", "body": "<p>The relevant Go code is:</p>\n\n<pre><code>func Environ() []string {\n    s, e := GetEnvironmentStrings()\n    if e != nil {\n        return nil\n    }\n    defer FreeEnvironmentStrings(s)\n    r := make([]string, 0, 50) // Empty with room to grow.\n    for from, i, p := 0, 0, (*[1 &lt;&lt; 24]uint16)(unsafe.Pointer(s)); true; i++ {\n        if p[i] == 0 {\n            // empty string marks the end\n            if i &lt;= from {\n                break\n            }\n            r = append(r, string(utf16.Decode(p[from:i])))\n            from = i + 1\n        }\n    }\n    return r\n}\n</code></pre>\n\n<p>The code is using the Windows <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms683187.aspx\" rel=\"nofollow noreferrer\">GetEnvironmentStrings</a> function. The values come from Windows. See the Microsoft Windows documentation of environment variables. Also, see <a href=\"https://blogs.msdn.microsoft.com/oldnewthing/20100506-00/?p=14133/\" rel=\"nofollow noreferrer\">What are these strange =C: environment variables?</a></p>\n"}], "owner": {"reputation": 608, "user_id": 1368561, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/fHj5Q.png?s=128&g=1", "display_name": "mnemotronic", "link": "https://stackoverflow.com/users/1368561/mnemotronic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 1, "accepted_answer_id": 43175393, "answer_count": 1, "score": -1, "last_activity_date": 1491186145, "creation_date": 1491178116, "last_edit_date": 1491178806, "question_id": 43174876, "link": "https://stackoverflow.com/questions/43174876/windows-environ-strings-0-and-1", "title": "windows.Environ() strings [0] and [1]", "body": "<p>I'm confused by the first 2 strings returned by \"windows.Environ()\" on a Windows pro 7 system (go version go1.8 windows/amd64).  env[0] apparently has a key of \"=::\"; env[1] has a key \"=C:\".  Can anyone point me to where this is documented?  Thx in advance.</p>\n\n<pre><code>str_EnvStrs := windows.Environ()\n// \n//    str_EnvStrs[0] == '=::=::\\'\nfmt.Printf(\"str_EnvStrs[0] == '%v'\\n\",str_EnvStrs[0])\n//\n//    str_EnvStrs[1] == '=C:=C:\\Users\\(WINLOGIN)\\Documents\\Source\\go\\src \n//                       \\github.com\\(GITLOGIN)\\maps_arrays_slices'\nfmt.Printf(\"str_EnvStrs[1] == '%v'\\n\",str_EnvStrs[1])\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491166318, "post_id": 43173217, "comment_id": 73420809, "body": "Sorry, I was wrong and downvoted by mistake. I cannot de-unvote this unless it&#39;s edited, so as an excuse I upvoted another your answer."}, {"owner": {"reputation": 63, "user_id": 4152742, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBQTlg4mSiI/AAAAAAAAAAI/AAAAAAAAAgo/2O8Hyn6Ca7A/photo.jpg?sz=128", "display_name": "jwthanh", "link": "https://stackoverflow.com/users/4152742/jwthanh"}, "edited": false, "score": 0, "creation_date": 1491166419, "post_id": 43173217, "comment_id": 73420835, "body": "Checked again on Limit function: <code>&#47;&#47; Limit specify the number of records to be retrieved func (s *DB) Limit(limit interface{}) *DB {     return s.clone().search.Limit(limit).db }</code> so this is a correct answer"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1491165045, "creation_date": 1491165045, "answer_id": 43173217, "question_id": 43173042, "link": "https://stackoverflow.com/questions/43173042/build-custom-query-with-gorm-golang-lib/43173217#43173217", "title": "Build custom query with gorm Golang lib", "body": "<blockquote>\n  <p>Why limit is not applied?</p>\n</blockquote>\n\n<p>Because you're ignoring the return value of <a href=\"https://godoc.org/github.com/jinzhu/gorm#DB.Limit\" rel=\"nofollow noreferrer\">Limit</a>. In effect, you're creating a query with a limit, then throwing it away without ever executing it.</p>\n\n<p>You need to use:</p>\n\n<pre><code>selectQuery = selectQuery.Limit(10)\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 4152742, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BBQTlg4mSiI/AAAAAAAAAAI/AAAAAAAAAgo/2O8Hyn6Ca7A/photo.jpg?sz=128", "display_name": "jwthanh", "link": "https://stackoverflow.com/users/4152742/jwthanh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 834, "favorite_count": 0, "accepted_answer_id": 43173217, "answer_count": 1, "score": 1, "last_activity_date": 1491165449, "creation_date": 1491163838, "last_edit_date": 1491165449, "question_id": 43173042, "link": "https://stackoverflow.com/questions/43173042/build-custom-query-with-gorm-golang-lib", "title": "Build custom query with gorm Golang lib", "body": "<p>I'm using <a href=\"http://jinzhu.me/gorm/crud.html#query\" rel=\"nofollow noreferrer\">http://jinzhu.me/gorm/crud.html#query</a></p>\n\n<p>I want to build selectQuery base on some custom conditions</p>\n\n<pre><code>selectQuery := db.Select(\"username\").Where(\"status = 'active'\")\nselectQuery.Limit(10)\nif err := selectQuery.Find(&amp;users).Error; err != nil {\n//\n} else {\n//\n}\n</code></pre>\n\n<p>Why limit is not applied?</p>\n\n<p>It\u2019s working if implemented with below code:</p>\n\n<pre><code>if err := db.Select(\"username\").Where(\"status = 'active\").Limit(10).Find(&amp;users).Error; err != nil {\n//\n} else {\n//\n}\n</code></pre>\n"}, {"tags": ["go", "subclass", "embedding"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 6, "last_activity_date": 1491164560, "creation_date": 1491164560, "answer_id": 43173139, "question_id": 43173041, "link": "https://stackoverflow.com/questions/43173041/can-i-subclass-and-redefine-a-method-in-golang/43173139#43173139", "title": "Can I subclass and redefine a method in Golang?", "body": "<blockquote>\n  <p>Can I subclass ... in Golang?</p>\n</blockquote>\n\n<p>Short answer: No. Go is not object oriented, therefore it has no classes, therefore subclassing is categorically an impossibility.</p>\n\n<p>Longer answer:</p>\n\n<p>You're on the right track with embedding, but you won't be able to substitute your custom client for anything that expects an <code>*http.Client</code>. This is what Go interfaces are for.  But the standard library doesn't use an interface here (it does for some things, where it makes sense).</p>\n\n<p>Another possible approach which may, depending on exact needs, work, is to use a custom transport, rather than a custom client. This does use an interface. You may be able to use a custom <a href=\"https://golang.org/pkg/net/http/#RoundTripper\" rel=\"noreferrer\">RoundTripper</a> that adds the necessary headers, and this you can assign to an <code>*http.Client</code> struct.</p>\n"}], "owner": {"reputation": 9981, "user_id": 436721, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d8f984927a179bde19a89e4b634cbf57?s=128&d=identicon&r=PG&f=1", "display_name": "Felipe", "link": "https://stackoverflow.com/users/436721/felipe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 644, "favorite_count": 0, "accepted_answer_id": 43173139, "answer_count": 1, "score": 4, "last_activity_date": 1491164574, "creation_date": 1491163832, "last_edit_date": 1491164574, "question_id": 43173041, "link": "https://stackoverflow.com/questions/43173041/can-i-subclass-and-redefine-a-method-in-golang", "title": "Can I subclass and redefine a method in Golang?", "body": "<p>I'm using a Github Client that allows me to call github API methods more easily.</p>\n\n<p>This library allows me to provide my own <code>*http.Client</code> when I initialize it:</p>\n\n<pre><code>httpClient := &amp;http.Client{}\ngithubClient := github.NewClient(httpClient)\n</code></pre>\n\n<p>It works fine but now I need something else. I want to customize the Client so that every request (i.e. the <code>Do</code> method) gets a custom header added.</p>\n\n<p>I've read a bit about <em>embedding</em> and this is what I've tried so far:</p>\n\n<pre><code>package trackerapi\n\nimport(\n    \"net/http\"\n)\n\ntype MyClient struct{\n    *http.Client\n}\n\nfunc (my *MyClient)Do(req *http.Request) (*http.Response, error){\n\n    req.Header.Set(\"cache-control\",\"max-stale=3600\")\n\n    return my.Client.Do(req)\n\n}\n</code></pre>\n\n<p>But the compiler does not let me use my custom <code>MyClient</code> in place of the default one:</p>\n\n<pre><code>httpClient := &amp;trackerapi.MyClient{}\n\n// ERROR: Cannot use httpClient (type *MyClient) as type \n//*http.Client. \ngithubClient := github.NewClient(httpClient)\n</code></pre>\n\n<p>I'm a bit of a golang newbie so my question is: Is this the right way to do what I want to and, if not, what's the recommended approach?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 0, "creation_date": 1491156838, "post_id": 43171097, "comment_id": 73417489, "body": "If you have only 3 rows of test text - you can stick with basic Examples. Look at: <a href=\"https://golang.org/pkg/testing/#pkg-examples\" rel=\"nofollow noreferrer\">golang.org/pkg/testing/#pkg-examples</a>  If you really need to compare by file content - I would try to exploite <a href=\"https://golang.org/src/testing/example.go\" rel=\"nofollow noreferrer\">golang.org/src/testing/example.go</a>."}, {"owner": {"reputation": 11, "user_id": 4008057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2714a97790ab67f2c896c3165836b85?s=128&d=identicon&r=PG&f=1", "display_name": "Spitfire", "link": "https://stackoverflow.com/users/4008057/spitfire"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1491161708, "post_id": 43171097, "comment_id": 73419307, "body": "@Flimzy I&#39;ve read through that question trying to gleam useful information, and it doesn&#39;t seem to fit my question. An idea that I have is that I could write a function that accepts any input file as a function parameter (maybe, just an idea) and test against a file containing expected output. Maybe what I&#39;m looking for is that testing function that takes an input file as a parameter, then passes the output of that function to a buffer, and then finally compares that buffer&#39;s contents to the expected output file."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1491164262, "post_id": 43171097, "comment_id": 73420194, "body": "I&#39;m not sure what the problem is. It should be easy to write a test function and capture its output (as described in the linked question/answers).  Then you can compare it to whatever you want, however you want. What specific questions remain?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1491165633, "post_id": 43171097, "comment_id": 73420630, "body": "you need to use testing package.  <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\">golang.org/pkg/testing</a>  1) Create a file in package main. 2) Create a function func TestOutPut(*testing.T) 3) write logic 4) run with go test myfile_test.go"}, {"owner": {"reputation": 11, "user_id": 4008057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2714a97790ab67f2c896c3165836b85?s=128&d=identicon&r=PG&f=1", "display_name": "Spitfire", "link": "https://stackoverflow.com/users/4008057/spitfire"}, "edited": false, "score": 0, "creation_date": 1491178110, "post_id": 43171097, "comment_id": 73423607, "body": "Yep I think I&#39;m grasping my head around the duplicate mentioned and how I can use it. I&#39;ll close/delete this question since it doesn&#39;t provide any new information."}], "owner": {"reputation": 11, "user_id": 4008057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2714a97790ab67f2c896c3165836b85?s=128&d=identicon&r=PG&f=1", "display_name": "Spitfire", "link": "https://stackoverflow.com/users/4008057/spitfire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 167, "favorite_count": 0, "closed_date": 1491181355, "answer_count": 0, "score": 0, "last_activity_date": 1491165864, "creation_date": 1491152941, "question_id": 43171097, "link": "https://stackoverflow.com/questions/43171097/compare-go-stdout-to-file-contents-with-testing-package", "closed_reason": "Duplicate", "title": "Compare Go stdout to file contents with testing package", "body": "<p>I am writing a program that reads input from a file, parses the text in that file, and then prints out text to stdout. I have the expected output in a text file. How would I go about using the testing package to compare my program's output to the expected output saved in a text file?</p>\n\n<p>Let's say my code is the following:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"bufio\"\n    \"strings\"\n)\n\nfunc main() {\n    if len(os.Args) &gt; 1 {\n        file, err := os.Open(os.Args[1])\n        if err != nil {\n            log.Fatal(err)\n        }\n        defer file.Close()\n\n        scanner := bufio.NewScanner(file)\n        for scanner.Scan() {\n            fmt.Println(strings.ToUpper(scanner.Text()))\n        }\n    } else {\n        fmt.Println(\"Need input file as argument\")\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>This is simply taking each line of the input text file, capitalizing all letters, and then printing each line.</p>\n\n<p>In my input file, I have:</p>\n\n<pre><code>hello, wOrlD!\nfoo\nBAR\n</code></pre>\n\n<p>And in my expected output file, I have:</p>\n\n<pre><code>HELLO, WORLD!\nFOO\nBAR\n</code></pre>\n\n<p>What is the best way to use the testing package to compare my output to the expected output file?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["json", "go", "goroutine"], "comments": [{"owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1491145013, "post_id": 43169737, "comment_id": 73413225, "body": "The bottleneck, somewhat unsurprisingly, is json.Marshal.  There are a few other 3rd party libraries out there that claim to be faster handling JSON data.  Are you strictly required to use JSON?"}, {"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1491173900, "post_id": 43169737, "comment_id": 73422818, "body": "See if your db will do the conversion for you. Postgres definitely will, ZeroDB seems to accept JSON queries but I&#39;m not sure what the response format is."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1491207487, "post_id": 43169737, "comment_id": 73432317, "body": "@tier1 it is the early version of this project so I&#39;m ready to hear your advice instead of JSON."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1491207490, "post_id": 43169737, "comment_id": 73432318, "body": "@DmitriGoldring What do you mean my DB do this? On DB level or on programing language level?"}, {"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1491230262, "post_id": 43169737, "comment_id": 73448131, "body": "In Postgres you can use functions like <a href=\"https://www.postgresql.org/docs/current/static/functions-json.html\" rel=\"nofollow noreferrer\">to_json</a> to format your SQL query results as JSON. This allows you to send it straight to the caller without having to marshal it in your application code."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491240612, "post_id": 43169737, "comment_id": 73454543, "body": "Using JSON in an SQL database only makes sense in certain instances. People underestimate how slow it is to work with strings instead of better suited concrete types. I suggest you reformat your data."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1491248031, "post_id": 43169737, "comment_id": 73458657, "body": "@DmitriGoldring unfortunately I&#39;m using MySQL which isn&#39;t support it."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491248089, "post_id": 43169737, "comment_id": 73458698, "body": "@RayfenWindspear, we have a symfony app where the data is coming from, impossible to reformat it. So we are talking about existing data."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491250035, "post_id": 43169737, "comment_id": 73459641, "body": "In that case, it might be necessary to duplicate the data in a more speed friendly format. Keep doing whatever your other app requires, but duplicate all the current data, and any new data added, in standard DB types so that this current project is able to function properly. We don&#39;t know what your data looks like, so we don&#39;t know how difficult that might be, but it might be the best option. I&#39;m doing something similar in a project I&#39;m working on to speed up certain API calls and queries."}, {"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 1, "creation_date": 1491258357, "post_id": 43169737, "comment_id": 73463395, "body": "It looks like MySQL 5.7(+?) has <a href=\"https://dev.mysql.com/doc/refman/5.7/en/json-creation-functions.html\" rel=\"nofollow noreferrer\">JSON</a> support."}, {"owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1491318905, "post_id": 43169737, "comment_id": 73494086, "body": "You might find this useful.  It&#39;s a list of serialization benchmarks in Go.  <a href=\"https://github.com/alecthomas/go_serialization_benchmarks\" rel=\"nofollow noreferrer\">github.com/alecthomas/go_serialization_benchmarks</a>"}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491425375, "post_id": 43169737, "comment_id": 73552877, "body": "@RayfenWindspear I think it&#39;s really hard to do, because in this case have to syncronize the both database model in realtime. But it&#39;s not too easy to migrate, becuase there is a big monolitic app which is not too good for that."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1491425437, "post_id": 43169737, "comment_id": 73552913, "body": "@DmitriGoldring I tryed it out, but unfortunately it is not what I want they just provide JSON as a datatype. MySQL no supported JSON response yet."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1491425458, "post_id": 43169737, "comment_id": 73552926, "body": "@tier1 Thanx, I will check it out."}], "answers": [{"comments": [{"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1491159230, "post_id": 43170543, "comment_id": 73418424, "body": "Updated the post, and you are right the JSON marshal takes too much time, but I tryed the ffjson and I got the same numbers."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 0, "last_activity_date": 1491149556, "creation_date": 1491149556, "answer_id": 43170543, "question_id": 43169737, "link": "https://stackoverflow.com/questions/43169737/sql-result-to-json-as-fast-as-possible/43170543#43170543", "title": "SQL result to JSON as fast as possible", "body": "<p>Go routines won't improve performance on CPU-bound operations like JSON marshaling. What you need is a more efficient JSON marshaler. There are some available, although I haven't used any.  A simple Google search for 'faster JSON marshaling' will turn up many results. A popular one is <a href=\"https://github.com/pquerna/ffjson\" rel=\"nofollow noreferrer\">ffjson</a>.  I suggest starting there.</p>\n"}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 650, "favorite_count": 1, "accepted_answer_id": 43170543, "answer_count": 1, "score": 0, "last_activity_date": 1491159180, "creation_date": 1491144737, "last_edit_date": 1491159180, "question_id": 43169737, "link": "https://stackoverflow.com/questions/43169737/sql-result-to-json-as-fast-as-possible", "title": "SQL result to JSON as fast as possible", "body": "<p>I'm trying to transform the Go built-in sql result to JSON. I'm using goroutines for that but I got problems. </p>\n\n<p><strong>The base problem:</strong></p>\n\n<p>There is a really big database with around 200k user and I have to serve them through tcp sockets in a microservice based system. To get the users from the database spent 20ms but transform this bunch of data to JSON spend 10 seconds with the current solution. This is why I want to use goroutines. </p>\n\n<p><strong>Solution with Goroutines:</strong> </p>\n\n<pre><code>func getJSON(rows *sql.Rows, cnf configure.Config) ([]byte, error) {\n    log := logan.Log{\n        Cnf: cnf,\n    }\n\n    cols, _ := rows.Columns()\n\n    defer rows.Close()\n\n    done := make(chan struct{})\n    go func() {\n        defer close(done)\n        for result := range resultChannel {\n            results = append(\n                results,\n                result,\n            )\n        }\n    }()\n\n    wg.Add(1)\n    go func() {\n        for rows.Next() {\n            wg.Add(1)\n            go handleSQLRow(cols, rows)\n        }\n        wg.Done()\n    }()\n\n    go func() {\n        wg.Wait()\n        defer close(resultChannel)\n    }()\n\n    &lt;-done\n\n    s, err := json.Marshal(results)\n    results = []resultContainer{}\n    if err != nil {\n        log.Context(1).Error(err)\n    }\n    rows.Close()\n    return s, nil\n}\n\nfunc handleSQLRow(cols []string, rows *sql.Rows) {\n    defer wg.Done()\n    result := make(map[string]string, len(cols))\n    fmt.Println(\"asd -&gt; \" + strconv.Itoa(counter))\n    counter++\n    rawResult := make([][]byte, len(cols))\n    dest := make([]interface{}, len(cols))\n\n    for i := range rawResult {\n        dest[i] = &amp;rawResult[i]\n    }\n    rows.Scan(dest...) // GET PANIC\n    for i, raw := range rawResult {\n        if raw == nil {\n            result[cols[i]] = \"\"\n        } else {\n            fmt.Println(string(raw))\n            result[cols[i]] = string(raw)\n        }\n    }\n    resultChannel &lt;- result\n}\n</code></pre>\n\n<p>This solution give me a panic with the following message: </p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x45974c]\n\ngoroutine 408 [running]:\npanic(0x7ca140, 0xc420010150)\n    /usr/lib/golang/src/runtime/panic.go:500 +0x1a1\ndatabase/sql.convertAssign(0x793960, 0xc420529210, 0x7a5240, 0x0, 0x0, 0x0)\n    /usr/lib/golang/src/database/sql/convert.go:88 +0x1ef1\ndatabase/sql.(*Rows).Scan(0xc4203e4060, 0xc42021fb00, 0x44, 0x44, 0x44, 0x44)\n    /usr/lib/golang/src/database/sql/sql.go:1850 +0xc2\ngithub.com/PumpkinSeed/zerodb/operations.handleSQLRow(0xc420402000, 0x44, 0x44, 0xc4203e4060)\n    /home/loow/gopath/src/github.com/PumpkinSeed/zerodb/operations/operations.go:290 +0x19c\ncreated by github.com/PumpkinSeed/zerodb/operations.getJSON.func2\n    /home/loow/gopath/src/github.com/PumpkinSeed/zerodb/operations/operations.go:258 +0x91\nexit status 2\n</code></pre>\n\n<p><strong>The current solution which is working but spend too much time:</strong></p>\n\n<pre><code>func getJSON(rows *sql.Rows, cnf configure.Config) ([]byte, error) {\n    log := logan.Log{\n        Cnf: cnf,\n    }\n    var results []resultContainer\n    cols, _ := rows.Columns()\n    rawResult := make([][]byte, len(cols))\n    dest := make([]interface{}, len(cols))\n\n    for i := range rawResult {\n        dest[i] = &amp;rawResult[i]\n    }\n\n    defer rows.Close()\n\n    for rows.Next() {\n\n        result := make(map[string]string, len(cols))\n        rows.Scan(dest...)\n        for i, raw := range rawResult {\n            if raw == nil {\n\n                result[cols[i]] = \"\"\n\n            } else {\n                result[cols[i]] = string(raw)\n            }\n        }\n\n        results = append(results, result)\n    }\n    s, err := json.Marshal(results)\n    if err != nil {\n        log.Context(1).Error(err)\n    }\n    rows.Close()\n    return s, nil\n}\n</code></pre>\n\n<p><strong>Question:</strong></p>\n\n<p>Why the goroutine solution give me an error, where it is not an obvious panic, because the first ~200 goroutine running properly?!</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Performance test for the original working solution:</p>\n\n<pre><code>INFO[0020] setup taken -&gt; 3.149124658s                   file=operations.go func=operations.getJSON line=260 service=\"Database manager\" ts=\"2017-04-02 19:45:27.132881211 +0100 BST\"\nINFO[0025] toJSON taken -&gt; 5.317647046s                  file=operations.go func=operations.getJSON line=263 service=\"Database manager\" ts=\"2017-04-02 19:45:32.450551417 +0100 BST\"\n</code></pre>\n\n<p>The sql to map is 3 sec and to json is 5 sec.</p>\n"}, {"tags": ["json", "go", "protocol-buffers", "grpc"], "answers": [{"tags": [], "owner": {"reputation": 5298, "user_id": 12606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1086eadc88de1e47fbffca9a73fd82?s=128&d=identicon&r=PG", "display_name": "Stuart Carnie", "link": "https://stackoverflow.com/users/12606/stuart-carnie"}, "is_accepted": true, "score": 2, "last_activity_date": 1491605720, "last_edit_date": 1491605720, "creation_date": 1491154042, "answer_id": 43171315, "question_id": 43169640, "link": "https://stackoverflow.com/questions/43169640/using-structs-in-oneof-field-in-protocol-buffers-v3-via-go/43171315#43171315", "title": "Using structs in oneOf field in Protocol Buffers v3 via Go", "body": "<p>Nothing in the Protocol Buffer documentation indicates <code>oneof</code> cannot be structs, and in fact the <a href=\"https://github.com/gogo/protobuf\" rel=\"nofollow noreferrer\">example</a> generates structs for a <code>union</code> field.</p>\n\n<p>I recommend using <a href=\"https://github.com/gogo/protobuf\" rel=\"nofollow noreferrer\">gogo</a>, which I have personally used for previous commercial projects. Specifically, <code>use protoc-gen-gogoslick</code></p>\n\n<p>See <a href=\"https://github.com/gogo/protobuf#more-speed-and-more-generated-code\" rel=\"nofollow noreferrer\">this section</a> for installing the necessary packages, then run the following for your project</p>\n\n<pre><code>protoc --gogoslick_out=Mgoogle/protobuf/timestamp.proto=github.com/gogo/protobuf/types:. example.proto\n</code></pre>\n"}], "owner": {"reputation": 979, "user_id": 2008856, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/dFtO2.jpg?s=128&g=1", "display_name": "Delaney", "link": "https://stackoverflow.com/users/2008856/delaney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7459, "favorite_count": 1, "accepted_answer_id": 43171315, "answer_count": 1, "score": 5, "last_activity_date": 1491605720, "creation_date": 1491144230, "last_edit_date": 1491146235, "question_id": 43169640, "link": "https://stackoverflow.com/questions/43169640/using-structs-in-oneof-field-in-protocol-buffers-v3-via-go", "title": "Using structs in oneOf field in Protocol Buffers v3 via Go", "body": "<p>So trying to using Protocol Buffers v3 and Go together (new to both).</p>\n\n<p><strong>example.proto</strong></p>\n\n<pre><code>syntax = \"proto3\";\n\npackage test;\n\nimport \"google/protobuf/timestamp.proto\";\n\nmessage Metadata {\n    uint64 userID = 2;\n    google.protobuf.Timestamp time= 3; \n}\n\n//SignOff when user logs out of Glory\nmessage SignOff {\n    Metadata metadata =1;\n}\n\n//SignOn when user logs into Glory\nmessage SignOn {\n    Metadata metadata =1;\n}\n\nmessage EventWrapper {\n    oneof event {\n        SignOff signOff = 1;\n        SignOn signOn = 2;\n    }\n}\n</code></pre>\n\n<p>Converting with <code>protoc</code> and using in Go </p>\n\n<pre><code>now, _ := ptypes.TimestampProto(time.Now())\nevent := &amp;pb_test.EventWrapper{\n    Event: &amp;pb_test.EventWrapper_SignOn{\n        SignOn: &amp;pb_test.SignOn{\n            Metadata: &amp;pb_test.Metadata{\n                UserID: 1234,\n                Time:   now,\n            },\n        },\n    },\n}\nprotoBytes, err := proto.Marshal(event)\nif err != nil {\n    log.Fatal(err)\n}\nlog.Println(len(protoBytes) == 0)\n\njsonBytes, _ = json.MarshalIndent(event, \"\", \"\\t\")\nlog.Println(string(jsonBytes))\n</code></pre>\n\n<p>The output shows the JSON is right but the protobuf encoded byte array is empty.</p>\n\n<pre><code>{\n    \"Event\": {\n        \"SignOn\": {\n            \"metadata\": {\n                \"userID\": 1234,\n                \"time\": {\n                    \"seconds\": 1491143507,\n                    \"nanos\": 654053400\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>The intent is the have a array of these (<code>repeated *EventWrapper</code>) to send along the wire via gRPC, but the individual ones don't work at the moment.  The protobuf <a href=\"https://developers.google.com/protocol-buffers/docs/proto#oneof\" rel=\"noreferrer\">Language Guide</a> doesn't say anything about structs not being allowed.  Is there something I'm missing?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 10578, "user_id": 3233827, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/LVngi.jpg?s=128&g=1", "display_name": "ssc-hrep3", "link": "https://stackoverflow.com/users/3233827/ssc-hrep3"}, "edited": false, "score": 0, "creation_date": 1491138832, "post_id": 43168329, "comment_id": 73411409, "body": "I&#39;m not sure if conditionals are supported in <code>go</code>, but they would be the way to go. See also <a href=\"http://stackoverflow.com/questions/6804586/how-to-conditional-regex\" title=\"how to conditional regex\">stackoverflow.com/questions/6804586/how-to-conditional-regex</a>"}, {"owner": {"reputation": 389, "user_id": 446235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a62e576944a3cbed8e198d7413e413e?s=128&d=identicon&r=PG", "display_name": "Stefan Buynov", "link": "https://stackoverflow.com/users/446235/stefan-buynov"}, "reply_to_user": {"reputation": 10578, "user_id": 3233827, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/LVngi.jpg?s=128&g=1", "display_name": "ssc-hrep3", "link": "https://stackoverflow.com/users/3233827/ssc-hrep3"}, "edited": false, "score": 0, "creation_date": 1491158973, "post_id": 43168329, "comment_id": 73418325, "body": "This doesn&#39;t seem to be supported in Go regex, unfortunately. Thanks for the tip, though!"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1491166265, "post_id": 43168329, "comment_id": 73420794, "body": "You&#39;ll have to added a custom function, to the template.funcmap()  <a href=\"https://golang.org/pkg/text/template/#FuncMap\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template/#FuncMap</a>  Then your template call your custom function which does the regex and returns data back to the template, also call funcmap before parsing the template or it will throw an error.  See here for more examples  <a href=\"http://technosophos.com/2013/11/23/using-custom-template-functions-in-go.html\" rel=\"nofollow noreferrer\">technosophos.com/2013/11/23/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "is_accepted": true, "score": 1, "last_activity_date": 1491180857, "creation_date": 1491180857, "answer_id": 43175130, "question_id": 43168329, "link": "https://stackoverflow.com/questions/43168329/how-to-replace-optional-group-with-regex-and-golang/43175130#43175130", "title": "How to replace optional group with regex and Golang", "body": "<p>Go regexp do not support conditional statements and the <code>Replace</code> family of regexp functions doesn't either. \nThe solution to this depends on the number of special cases you have.</p>\n\n<p>If you only have the one case I'd suggest to just do a two pass replacement: First replace all occurences with the attribute set, then replace all the cases without the attribute (<a href=\"https://play.golang.org/p/OtICQGLenJ\" rel=\"nofollow noreferrer\">on play</a>):</p>\n\n<pre><code>txt := `{% img right /images/testing %}\\n{% img /images/testing %}`\n\n// without attribute\ntxt = regexp.MustCompile(`{%\\s*img\\s*([/\\S]+)\\s+%}`).\n  ReplaceAllString(txt, \"{{&lt; figure src=\\\"$1\\\" &gt;}}\")\n\n// with attribute\ntxt = regexp.MustCompile(`{%\\s*img\\s*(\\p{L}*)\\s+([/\\S]+)\\s+%}`).\n  ReplaceAllString(txt, \"{{&lt; figure class=\\\"$1\\\" src=\\\"$2\\\" &gt;}}\")\n</code></pre>\n\n<p>If you say this is inefficient I say: probably, yes. If you want something more efficient (i.e. something that does not iterate the source string twice) then you have to build something more akin to a parser which decides at the time of detection which format to use. A rough sketch of this would be something like this (<a href=\"https://play.golang.org/p/32H9PVn05w\" rel=\"nofollow noreferrer\">on play</a>):</p>\n\n<pre><code>src := []byte(\"ok\" + \"{% img right /images/testing %}\" + \"this\" + \n              \"{% img /images/testing %}\" + \"no?\")\ndst := bytes.NewBufferString(\"\")\ncidx := 0\n\nfor _, match := range p.FindAllSubmatchIndex(src, -1) {\n    dst.Write(src[cidx:match[0]])\n    dst.WriteString(newFormat(src, src[match[2]:match[3]], src[match[4]:match[5]]))\n    cidx = match[1]\n}\ndst.Write(src[cidx:])\n</code></pre>\n\n<p>In this example you copy everything from your source text <code>src</code> to a buffer <code>dst</code>, replacing every occurrence of your pattern with the output of the value of a function. This function can then decide to include specific formatting or not.</p>\n"}], "owner": {"reputation": 389, "user_id": 446235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a62e576944a3cbed8e198d7413e413e?s=128&d=identicon&r=PG", "display_name": "Stefan Buynov", "link": "https://stackoverflow.com/users/446235/stefan-buynov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1654, "favorite_count": 0, "accepted_answer_id": 43175130, "answer_count": 1, "score": 1, "last_activity_date": 1491180857, "creation_date": 1491136194, "question_id": 43168329, "link": "https://stackoverflow.com/questions/43168329/how-to-replace-optional-group-with-regex-and-golang", "title": "How to replace optional group with regex and Golang", "body": "<p>I am trying to translate this:</p>\n\n<pre><code>{% img &lt;right&gt; /images/testing %}\n</code></pre>\n\n<p>into this:</p>\n\n<pre><code>{{&lt; figure &lt;class=\"right\"&gt; src=\"/images/testing\" &gt;}}\n</code></pre>\n\n<p>with regex in Golang. The part in <code>&lt;&gt;</code> in the source string is optional.</p>\n\n<p>I have this code, which seems to work in the main test case, when the first capturing group exists (\"<strong>right</strong>\"):</p>\n\n<pre><code>regexp.MustCompile(`{%\\s*img\\s*(\\p{L}*)\\s+([/\\S]+)\\s+%}`)\n.ReplaceAllString(\"{% img right /images/testing %}\", \"{{&lt; figure class=\\\"$1\\\" src=\\\"$2\\\" &gt;}}\")\n</code></pre>\n\n<p>If the optional group is missing, however, I get:</p>\n\n<pre><code>{{&lt; figure class=\"\" src=\"/images/testing\" &gt;}}\n</code></pre>\n\n<p>which is not what I need - I want the entire <code>class=\"\"</code> section gone, like this: </p>\n\n<pre><code>{{&lt; figure src=\"/images/testing\" &gt;}}\n</code></pre>\n\n<p>Is this possible? Can I indicate somehow in the replacing string:</p>\n\n<pre><code>{{&lt; figure class=\\\"$1\\\" src=\\\"$2\\\" &gt;}}\n</code></pre>\n\n<p>that I want the additional text (\"<strong>class=</strong>\") gone if the optional group is empty?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1491125753, "post_id": 43166750, "comment_id": 73407715, "body": "See for example <a href=\"http://stackoverflow.com/questions/42085173/channel-deadlock-in-go/42086959#42086959\" title=\"channel deadlock in go\">stackoverflow.com/questions/42085173/channel-deadlock-in-go/&zwnj;&#8203;&hellip;</a> - this is quite similar to your example."}], "answers": [{"comments": [{"owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 1, "creation_date": 1491130479, "post_id": 43166800, "comment_id": 73408941, "body": "I don&#39;t think calling close would be enough in this situation. Even after close, the goroutine reading the channel could still be in the body of its loop and so still able to modify the slice."}, {"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 0, "creation_date": 1491132712, "post_id": 43166800, "comment_id": 73409629, "body": "I suppose that kostix proposing this modification: <a href=\"https://play.golang.org/p/A4S5pfd7_O\" rel=\"nofollow noreferrer\">play.golang.org/p/A4S5pfd7_O</a> ."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1491142698, "post_id": 43166800, "comment_id": 73412541, "body": "Thank you for the answer."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 4, "last_activity_date": 1491125967, "last_edit_date": 1491125967, "creation_date": 1491125660, "answer_id": 43166800, "question_id": 43166750, "link": "https://stackoverflow.com/questions/43166750/goroutines-with-sync-waitgroup-end-before-last-wg-done/43166800#43166800", "title": "Goroutines with sync.WaitGroup end before last wg.Done()", "body": "<p>The last goroutine you spawn\u2014that one intended to collect the results\u2014is not waited by <code>main()</code> so <code>wg.Wait()</code> in there returns, <code>main()</code> quits and reaps the remainin goroutines.\nSupposedly just a single\u2014collecting\u2014goroutine remains by that time but it fails to update the slice.</p>\n\n<p>Also note that due to the same reason you have a data race in your program: by the time <code>main()</code> reads the slice of results, it does not <em>know</em> whether it's safe to read it\u2014that is, whether the writer is done writing to there.</p>\n\n<p>An easy fix is to do add <code>wg.Add(1)</code> for that goroutine and <code>defer wg.Done()</code> in it, too.</p>\n\n<p>A better solution is to <code>close()</code> the <code>messages</code> channel after <code>wg.Wait()</code>\nand before reading from the slice.  This would make the collecting goroutine's <code>range</code> loop to terminate and this would also create a proper synchronization point between that goroutine and <code>main()</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 1, "creation_date": 1491142744, "post_id": 43167476, "comment_id": 73412560, "body": "Thanks for the answer, basically I did the same followed by the previouse comment."}, {"owner": {"reputation": 2370, "user_id": 5453049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8e2c00b88d6175b93b0360c8057a15a?s=128&d=identicon&r=PG&f=1", "display_name": "Fabio Venturi Pastor", "link": "https://stackoverflow.com/users/5453049/fabio-venturi-pastor"}, "edited": false, "score": 2, "creation_date": 1542879772, "post_id": 43167476, "comment_id": 93729997, "body": "this part  go func() {         wg.Wait()         close(messages)     }() save my day, thanks!"}], "tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 3, "last_activity_date": 1598247992, "last_edit_date": 1598247992, "creation_date": 1491130566, "answer_id": 43167476, "question_id": 43166750, "link": "https://stackoverflow.com/questions/43166750/goroutines-with-sync-waitgroup-end-before-last-wg-done/43167476#43167476", "title": "Goroutines with sync.WaitGroup end before last wg.Done()", "body": "<p>Closing channels is an idiomatic Go pattern for signalling and if you close a buffered channel, the consumer can read all the queued data then stop.</p>\n<p>This code works correctly:</p>\n<pre><code>func main() {\n    messages := make(chan int)\n    var wg sync.WaitGroup\n    var result []int\n\n    // you can also add these one at\n    // a time if you need to\n\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        time.Sleep(time.Second * 1)\n        messages &lt;- 1\n    }()\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        time.Sleep(time.Second * 1)\n        messages &lt;- 2\n    }()\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        time.Sleep(time.Second * 1)\n        messages &lt;- 3\n    }()\n\n    // this goroutine added to signal end of data stream\n    // by closing messages channel\n    go func() {\n        wg.Wait()\n        close(messages)\n    }()\n\n    // if you need this to happen inside a go routine,\n    // this channel is used for signalling end of the work,\n    // also another sync.WaitGroup could be used, but for just one\n    // goroutine, a single channel as a signal makes sense (there is no\n    // groups)\n    done := make(chan struct{})\n    go func() {\n        defer close(done)\n        for i := range messages {\n            fmt.Println(i)\n            result = append(result, i)\n        }\n    }()\n\n    &lt;-done\n    fmt.Println(result)\n}\n</code></pre>\n<p>As you see we just added another goroutine that closes the <code>messages</code> channel, when all producers are done.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 11287120, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--zgNi-DYxNI/AAAAAAAAAAI/AAAAAAAAABw/yErpGJuLKlQ/photo.jpg?sz=128", "display_name": "Shoukry", "link": "https://stackoverflow.com/users/11287120/shoukry"}, "is_accepted": false, "score": 0, "last_activity_date": 1555341338, "creation_date": 1555341338, "answer_id": 55692309, "question_id": 43166750, "link": "https://stackoverflow.com/questions/43166750/goroutines-with-sync-waitgroup-end-before-last-wg-done/55692309#55692309", "title": "Goroutines with sync.WaitGroup end before last wg.Done()", "body": "<p><strong>kostix</strong>'s answer was correct till they mentioned </p>\n\n<blockquote>\n  <p>An easy fix is to do add <code>wg.Add(1)</code> for that goroutine and defer <code>wg.Done()</code> in it, too.</p>\n</blockquote>\n\n<p>That would cause your loop to never finish without the messages channel being closed! So the main goroutine would again finish before your last \"collecting\" goroutine finishes. You would also get an error for having a goroutine tied to your <code>wg</code> WaitGroup that will never send the <code>Done()</code> signal.</p>\n\n<p>Then again when they mentioned </p>\n\n<blockquote>\n  <p>A better solution is to <code>close()</code> the messages channel after <code>wg.Wait()</code> and before reading from the slice</p>\n</blockquote>\n\n<p>The placement they suggested will again give you the same error since you'll be waiting on the same WaitGroup <code>wg</code>. While your last \"collecting\" goroutine will keep looking for more messages in your <code>messages</code> channel and will never reach the deferred <code>wg.Done()</code></p>\n\n<p>Then <strong>Alex Yu</strong>'s comment fixed it by waiting before reading the results altogether, which is a good fix. But if you want your collecting goroutine to start right away and NOT wait for all previous goroutines (that write to <code>messages</code> channel) to finish before it starts reading from said channel, I would suggest the following...</p>\n\n<p>Create a result WaitGroup, <code>Add(1)</code> before starting your last \"collecting\" goroutine, <code>defer wgResult.Done()</code> inside your last \"collecting\" goroutine, then at the end, between your <code>wg.Wait()</code> and your <code>fmt.Println(result)</code>, you should <code>close(messages)</code> and <code>wgResult.Wait()</code>.</p>\n\n<p>This allows all your go routines to start as soon as possible and waiting only when needed on the writing goroutines as well as the reading one.</p>\n\n<p>Here's a GoPlayground link with the suggested solution</p>\n\n<p><a href=\"https://play.golang.org/p/na0JS1HTwNP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/na0JS1HTwNP</a></p>\n"}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3831, "favorite_count": 0, "accepted_answer_id": 43166800, "answer_count": 3, "score": 0, "last_activity_date": 1598247992, "creation_date": 1491125285, "question_id": 43166750, "link": "https://stackoverflow.com/questions/43166750/goroutines-with-sync-waitgroup-end-before-last-wg-done", "title": "Goroutines with sync.WaitGroup end before last wg.Done()", "body": "<p>I have an example code (you can find it on <a href=\"https://play.golang.org/p/bvTAgequnD\" rel=\"nofollow noreferrer\">Go Playground</a>): </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    messages := make(chan int)\n    var wg sync.WaitGroup\n    var result []int\n\n    // you can also add these one at \n    // a time if you need to \n\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        time.Sleep(time.Second * 1)\n        messages &lt;- 1\n    }()\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        time.Sleep(time.Second * 1)\n        messages &lt;- 2\n    }() \n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        time.Sleep(time.Second * 1)\n        messages &lt;- 3\n    }()\n    go func() {\n        for i := range messages {\n            fmt.Println(i)\n        result = append(result, i)\n        }\n\n    }()\n\n    wg.Wait()\n    fmt.Println(result)\n}\n</code></pre>\n\n<p>I got this output:</p>\n\n<pre><code>2\n1\n[2 1]\n</code></pre>\n\n<p>I think I know why is it happening, but I can't solve it. There is 3 item in the WaitGroup I mean the three goroutine, and the 4th groutine consume the data from the channel. When the last groutine say <code>wg.Done()</code> the program is over because of the wg.Wait() said every goroutine finished and the last goroutine result the 4th goroutine couldn't have consume, because the program ended. I tryed to add plus one with wg.Add(1) and the wg.Done() in the 4th function but in this case I got deadlock. </p>\n"}, {"tags": ["go", "orm"], "comments": [{"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 1, "creation_date": 1491133725, "post_id": 43165507, "comment_id": 73409898, "body": "I&#39;m not an user of go-xorm,  my guess is based only on source code.  In source code we can find : package <a href=\"https://github.com/go-xorm/xorm/tree/master/migrate\" rel=\"nofollow noreferrer\">xorm/migrate</a> And in migrate_test.go  I see example of versioned migration. Good luck!"}], "answers": [{"tags": [], "owner": {"reputation": 1230, "user_id": 11306392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f712ad3fe37ee35c0f5c2dcaa373f2e3?s=128&d=identicon&r=PG&f=1", "display_name": "Bohdan Stupak", "link": "https://stackoverflow.com/users/11306392/bohdan-stupak"}, "is_accepted": false, "score": 1, "last_activity_date": 1560170555, "creation_date": 1560170555, "answer_id": 56526674, "question_id": 43165507, "link": "https://stackoverflow.com/questions/43165507/how-to-maintain-migration-and-schema-in-xorm/56526674#56526674", "title": "How to maintain migration and schema in xorm?", "body": "<p>I know it's been a while since the question asked but I've recently had to research over scarce information regarding the issue so I've decided to elaborate on @Alex Yu comment and post my findings.</p>\n\n<p>Indeed in order to perform a migration, we need xorm/migrate package.</p>\n\n<p>Consider initial migration which adds 2 tables.</p>\n\n<pre><code>var migrations = []*migrate.Migration{\n    {\n        ID: \"201608301400\",\n        Migrate: func(tx *xorm.Engine) error {\n            return tx.Sync2(&amp;Person{})\n        },\n        Rollback: func(tx *xorm.Engine) error {\n            return tx.DropTables(&amp;Person{})\n        },\n    },\n    {\n        ID: \"201608301430\",\n        Migrate: func(tx *xorm.Engine) error {\n            return tx.Sync2(&amp;Pet{})\n        },\n        Rollback: func(tx *xorm.Engine) error {\n            return tx.DropTables(&amp;Person{})\n        },\n    },\n}\n</code></pre>\n\n<p>We can consume it as follows</p>\n\n<pre><code>m := migrate.New(engine, &amp;migrate.Options{\n    TableName:    \"migrations\",\n    IDColumnName: \"id\",\n}, migrations)\n\nerr = m.Migrate()\n</code></pre>\n\n<p>Now let's imagine the scenario when we add a field to a table Person. Contrary to approach that one might find as default when we explicitly tell engine to add column, here we just sync our db once again. </p>\n\n<p>Also upon my research I have not found a way to explicitly drop column on rollback  so I suggest using raw SQL.</p>\n\n<p>Now migration will look as below. Note that your SQL may vary.</p>\n\n<pre><code>var migrations = []*migrate.Migration{\n    {\n        ID: \"201608301400\",\n        Migrate: func(tx *xorm.Engine) error {\n            return tx.Sync2(&amp;Person{})\n        },\n        Rollback: func(tx *xorm.Engine) error {\n            return tx.DropTables(&amp;Person{})\n        },\n    },\n    {\n        ID: \"201608301430\",\n        Migrate: func(tx *xorm.Engine) error {\n            return tx.Sync2(&amp;Pet{})\n        },\n        Rollback: func(tx *xorm.Engine) error {\n            return tx.DropTables(&amp;Person{})\n        },\n    },\n    {\n        ID: \"201608301460\",\n        Migrate: func(tx *xorm.Engine) error {\n            return tx.Sync2(&amp;Person{})\n        },\n        Rollback: func(tx *xorm.Engine) error {\n            _, e := tx.QueryString(\"ALTER TABLE dbo.person DROP COLUMN IF EXISTS your_new_column\")\n            return e\n        },\n    },\n}\n</code></pre>\n\n<p>Xorm keeps track of migrations that are alsready executed, so only the last one will be run.</p>\n"}], "owner": {"reputation": 309, "user_id": 4517341, "user_type": "registered", "accept_rate": 36, "profile_image": "https://graph.facebook.com/100000867481103/picture?type=large", "display_name": "Kumar Siva", "link": "https://stackoverflow.com/users/4517341/kumar-siva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 902, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1560170555, "creation_date": 1491116326, "question_id": 43165507, "link": "https://stackoverflow.com/questions/43165507/how-to-maintain-migration-and-schema-in-xorm", "title": "How to maintain migration and schema in xorm?", "body": "<p>How to maintain migration and schema in xorm?</p>\n\n<pre><code>type Version struct {\n    ID      int64\n    Name string\n}\n\nengine.Sync(new(Version))\n</code></pre>\n\n<p>This will only sync the xorm model with database. \nBut I need data migrations in some cases. Is there any option like rails schema.rb and migrations?</p>\n"}, {"tags": ["go", "azure-sdk"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491237856, "post_id": 43164497, "comment_id": 73453093, "body": "What is the output of <code>glide list</code> ?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491239999, "post_id": 43164497, "comment_id": 73454233, "body": "Just reading the docs, it appears (correct me if I&#39;m wrong) glide doesn&#39;t actually install to the normal <code>pkg</code> directory, but to the <code>vendor</code> directory in your app directory."}], "owner": {"reputation": 37, "user_id": 6726270, "user_type": "registered", "profile_image": "https://graph.facebook.com/1235134769859672/picture?type=large", "display_name": "sandayuu", "link": "https://stackoverflow.com/users/6726270/sandayuu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1491105539, "creation_date": 1491105539, "question_id": 43164497, "link": "https://stackoverflow.com/questions/43164497/can-not-fetch-submodule-using-glide", "title": "Can not fetch submodule using glide", "body": "<p><a href=\"https://github.com/Masterminds/glide\" rel=\"nofollow noreferrer\">https://github.com/Masterminds/glide</a></p>\n\n<p>I try to use glide with Azure go sdk. </p>\n\n<p><a href=\"https://github.com/Azure/azure-sdk-for-go\" rel=\"nofollow noreferrer\">https://github.com/Azure/azure-sdk-for-go</a></p>\n\n<p>In this repository, it uses submodule. </p>\n\n<p>I create a simple glide.yaml like this.</p>\n\n<pre><code>package: cf-engine\nimport:\n- package: github.com/Azure/azure-sdk-for-go\n</code></pre>\n\n<p>then</p>\n\n<pre><code>glide install\n</code></pre>\n\n<p>However, the submodule directory(storage) still empty. \nI tried</p>\n\n<pre><code>glide update --all-dependencies\n</code></pre>\n\n<p>Also it is still the empty.</p>\n\n<p>I tried go get. Then the submodule directory was filled. </p>\n\n<pre><code> go get github.com/Azure/azure-sdk-for-go\n</code></pre>\n\n<p>How can I fetch the submodule directory using glide? </p>\n"}, {"tags": ["pointers", "go", "struct", "receiver"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491102519, "post_id": 43164183, "comment_id": 73403037, "body": "&quot;when <code>type Dat struct</code> is changed to <code>type Dat struct</code>&quot; --- is it a typo here?"}, {"owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491105796, "post_id": 43164183, "comment_id": 73403611, "body": "@zerkms Yes. I have mistaken it.  That is &quot;when type Dat struct is changed to type dat struct&quot;."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491133285, "post_id": 43164183, "comment_id": 73409786, "body": "The main difference between those two examples is, in my opinion, that <code>Fn1a</code> modifies an existing value, while <code>Fn1b</code> allocates and returns a new value. As to which is better, that depends entirely on your use case."}, {"owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "edited": false, "score": 0, "creation_date": 1491173339, "post_id": 43164183, "comment_id": 73422693, "body": "\uff20mkopriva Thank you for your advices. What each function do you think is appropriate for what case?"}], "answers": [{"comments": [{"owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "edited": false, "score": 0, "creation_date": 1491173408, "post_id": 43169744, "comment_id": 73422711, "body": "Thank you for your advices. I think that I could understand the difference of these. I would like to create a function to initialize struct, use sample 2. If I don&#39;t want to use <code>Dat</code> as public, namely I want to use <code>dat</code>, how should I do? Although I thought that I return int, which isn&#39;t struct, using interface, it cannot be used like sample 2. In the case like sample 2, is it no problem even if <code>Dat</code> is public? I&#39;m sorry the basic question."}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 1, "last_activity_date": 1491144764, "creation_date": 1491144764, "answer_id": 43169744, "question_id": 43164183, "link": "https://stackoverflow.com/questions/43164183/how-to-use-receivers-in-go/43169744#43169744", "title": "How to use receivers in Go?", "body": "<p>There are some different topics inside your question:</p>\n\n<p><strong>1) Exported and unexported types</strong></p>\n\n<p>If you have a function, which is exported and that function returns an unexported type this will cause to an error, when you call that function outside of your package.</p>\n\n<p>So let's say that it is not allowed to make your type <code>Dat</code> unexported. </p>\n\n<p><strong>2) Which solution is better?</strong></p>\n\n<p>That depends on, but at all it would be sample 2. You see how much cleaner your main function is. If your struct will be more complicated you can do some stuff there. For example your struct has a parameter which is a map you need to initialize that map by using <code>make()</code>. In sample 1 you need to do this every time you create a new Dat type.</p>\n\n<p>Normally you would call that function <code>NewDat()</code>. If you always use that function when creating a new Dat variable that makes your code also more flexible for changes.</p>\n"}], "owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1491155102, "creation_date": 1491102236, "last_edit_date": 1491155102, "question_id": 43164183, "link": "https://stackoverflow.com/questions/43164183/how-to-use-receivers-in-go", "title": "How to use receivers in Go?", "body": "<p>There are two code samples as follows.</p>\n\n<p><strong>Sample 1:</strong></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Dat struct {\n    Num int\n}\n\nfunc (d *Dat) Fn1a(i int) {\n    d.Num = i\n}\n\nfunc (d *Dat) Fn2a() {\n    d.Num++\n}\n\nfunc main() {\n    var d Dat\n    d.Fn1a(1)\n    d.Fn2a()\n    fmt.Println(d)\n}\n</code></pre>\n\n<p><strong>Sample 2:</strong></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Dat struct {\n    Num int\n}\n\nfunc Fn1b(i int) *Dat {\n    d := &amp;Dat{i}\n    return d\n}\n\nfunc (d *Dat) Fn2b() *Dat {\n    d.Num++\n    return d\n}\n\nfunc main() {\n    d := Fn1b(1).Fn2b()\n    fmt.Println(d)\n}\n</code></pre>\n\n<p>Both samples output the same results.</p>\n\n<p>My question is about the difference between these samples. I could notice the following difference.</p>\n\n<p>Although in Sample 1, <code>type Dat struct</code> can be changed to <code>type dat struct</code>, in Sample 2, when <code>type Dat struct</code> is changed to <code>type dat struct</code>, golint shows a warning: <code>exported func Fn1b returns unexported type *main.dat, which can be annoying to use</code>. So in Sample 1, <code>dat</code> can be used directly as a <code>struct</code> without being public.</p>\n\n<p>Are there any other differences? For example, which is better? </p>\n\n<p>Thank you so much for your time and advices. And I'm sorry for my immature question.</p>\n"}, {"tags": ["go", "datetime-format"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491100445, "post_id": 43163913, "comment_id": 73402747, "body": "What do you mean the digits have no meaning? They <i>are</i> the representation of the format."}, {"owner": {"reputation": 747, "user_id": 5539547, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/z3y7F.jpg?s=128&g=1", "display_name": "Tahseen", "link": "https://stackoverflow.com/users/5539547/tahseen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491100817, "post_id": 43163913, "comment_id": 73402793, "body": "the digits inside Format, do they really make a difference whether 2006 or 2005 ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491101093, "post_id": 43163913, "comment_id": 73402838, "body": "Yes. How else would you differentiate the numbers if the values didn&#39;t matter?"}, {"owner": {"reputation": 747, "user_id": 5539547, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/z3y7F.jpg?s=128&g=1", "display_name": "Tahseen", "link": "https://stackoverflow.com/users/5539547/tahseen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491101463, "post_id": 43163913, "comment_id": 73402892, "body": "So you mean if I write  fmt.Println(time.Now().Format(&quot;2006-01-02 15:04:05-07:00&quot;)) it means different from  fmt.Println(time.Now().Format(&quot;2007-01-02 15:04:05-07:00&quot;))"}], "answers": [{"tags": [], "owner": {"reputation": 4764, "user_id": 2419922, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/41e095cca8abbfde0f1f52d73a1efcd7?s=128&d=identicon&r=PG", "display_name": "cshu", "link": "https://stackoverflow.com/users/2419922/cshu"}, "is_accepted": true, "score": 7, "last_activity_date": 1491102508, "creation_date": 1491102508, "answer_id": 43164201, "question_id": 43163913, "link": "https://stackoverflow.com/questions/43163913/time-format-weird-behavior/43164201#43164201", "title": "Time format weird behavior", "body": "<p>From <a href=\"https://golang.org/pkg/time/\" rel=\"noreferrer\">https://golang.org/pkg/time/</a>:</p>\n\n<blockquote>\n  <p><strong>func (Time) Format</strong></p>\n  \n  <p>func (t Time) Format(layout string) string</p>\n  \n  <p>Format returns a textual representation of the time value formatted\n  according to layout, which defines the format by showing how the\n  <strong>reference time</strong>, defined to be</p>\n  \n  <p><code>Mon Jan 2 15:04:05 -0700 MST 2006</code></p>\n  \n  <p>would be displayed if it were the value;</p>\n</blockquote>\n\n<p>So you must use the reference time. You should not change it to another time.</p>\n"}], "owner": {"reputation": 747, "user_id": 5539547, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/z3y7F.jpg?s=128&g=1", "display_name": "Tahseen", "link": "https://stackoverflow.com/users/5539547/tahseen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1247, "favorite_count": 0, "closed_date": 1491508763, "accepted_answer_id": 43164201, "answer_count": 1, "score": 3, "last_activity_date": 1573619606, "creation_date": 1491099045, "last_edit_date": 1573619606, "question_id": 43163913, "link": "https://stackoverflow.com/questions/43163913/time-format-weird-behavior", "closed_reason": "Duplicate", "title": "Time format weird behavior", "body": "<p>This is a part of a bigger code. I am little confused that if I use any other digit in the below format it results in wrong values. </p>\n\n<p>so instead of</p>\n\n<pre><code>fmt.Println(time.Now().Format(\"2006-01-02 15:04:05-07:00\"))\n</code></pre>\n\n<p>if I try to use </p>\n\n<pre><code> fmt.Println(time.Now().Format(\"2006-01-02 12:04:05-04:00\"))\n</code></pre>\n\n<p>Result is wrong. Even when it is same format, just digit change</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\n\nfunc main() {\n\n    fmt.Println(time.Now().Format(\"2006-01-02 15:04:05-07:00\"))\n\n}\n</code></pre>\n\n<p>So my question is why is it so. Digits inside format have no meaning. They are just for representation of the format.</p>\n"}, {"tags": ["http", "go", "https", "beego"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491237109, "post_id": 43162125, "comment_id": 73452677, "body": "If I understand correctly, you have two separate apps written in Go running on the same unix machine? And what you want to do is forward a regular https call (which would be intercepted by Beego app), to the Centrifugo app?"}, {"owner": {"reputation": 67, "user_id": 2652329, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dd8e5e6271f53ad83222a6785028dc10?s=128&d=identicon&r=PG", "display_name": "Ernie", "link": "https://stackoverflow.com/users/2652329/ernie"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491278427, "post_id": 43162125, "comment_id": 73468060, "body": "@RayfenWindspear, yes, exactly! I&#39;ve added some descriptions to explain more clearly."}], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 6444105, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8587d1b32788267843c4fc18f5a32c5e?s=128&d=identicon&r=PG&f=1", "display_name": "m13r", "link": "https://stackoverflow.com/users/6444105/m13r"}, "is_accepted": true, "score": 1, "last_activity_date": 1491290765, "creation_date": 1491290765, "answer_id": 43200819, "question_id": 43162125, "link": "https://stackoverflow.com/questions/43162125/forward-server-api-to-another-port-using-beego/43200819#43200819", "title": "Forward server API to another port using Beego", "body": "<p>You dont need to implement this in Beego.</p>\n\n<p>Just set up a reverse proxy: (here is an example how to set up a reverse proxy with nginx)</p>\n\n<pre><code>server {\n   listen 443;\n   server_name example.com;\n\n   location /chat_api {\n      proxy_set_header   X-Forwarded-For $remote_addr;\n      proxy_set_header   Host $http_host;\n      proxy_pass         \"http://127.0.0.1:8000\";\n   }\n   location /beego {\n      proxy_set_header   X-Forwarded-For $remote_addr;\n      proxy_set_header   Host $http_host;\n      proxy_pass         \"http://127.0.0.1:8080\";\n   }\n}\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 2652329, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dd8e5e6271f53ad83222a6785028dc10?s=128&d=identicon&r=PG", "display_name": "Ernie", "link": "https://stackoverflow.com/users/2652329/ernie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "accepted_answer_id": 43200819, "answer_count": 1, "score": 0, "last_activity_date": 1491343570, "creation_date": 1491081428, "last_edit_date": 1491343570, "question_id": 43162125, "link": "https://stackoverflow.com/questions/43162125/forward-server-api-to-another-port-using-beego", "title": "Forward server API to another port using Beego", "body": "<p>I have two web apps running in the same virtual machine. One is Beego listening to port 443, and another is Centrifugo messaging server at port 8000. </p>\n\n<p>If a user is not allowed to connect port 8000 due to his ISP, is it possible that I forward <a href=\"https://my.domain/chat_api\" rel=\"nofollow noreferrer\">https://my.domain/chat_api</a> (intercepted by Beego at port 443) to <a href=\"https://my.domain:8000/chat_api\" rel=\"nofollow noreferrer\">https://my.domain:8000/chat_api</a> (served by Centrifugo at port 8000), so that my chat client connects port 443 just like connecting port 8000? If yes, how do I implement under Beego's structure?</p>\n"}, {"tags": ["ssl", "go", "ssl-certificate", "lets-encrypt"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1491078393, "post_id": 43161559, "comment_id": 73398159, "body": "If you have a server on the open internet, you&#39;re going to get broken and malformed TLS requests. Are you getting errors with any of your own clients?"}, {"owner": {"reputation": 1105, "user_id": 3079922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RdiYz.png?s=128&g=1", "display_name": "Marco M", "link": "https://stackoverflow.com/users/3079922/marco-m"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491079025, "post_id": 43161559, "comment_id": 73398332, "body": "No it seems, I just tried to refresh the page from chrome and it does not seems to trigger any error... still I get a lot of them anyway, 5-20 x minute..."}, {"owner": {"reputation": 9266, "user_id": 1465640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b64a91edcfaad3c6290039008deea285?s=128&d=identicon&r=PG", "display_name": "Pylinux", "link": "https://stackoverflow.com/users/1465640/pylinux"}, "edited": false, "score": 0, "creation_date": 1491298216, "post_id": 43161559, "comment_id": 73478306, "body": "Have you tried to run the code in <a href=\"http://stackoverflow.com/a/40494806/1465640\">stackoverflow.com/a/40494806/1465640</a> and <i>just</i> updating with your domain info? And you are sure that you are accessing the server on port 443"}, {"owner": {"reputation": 1105, "user_id": 3079922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RdiYz.png?s=128&g=1", "display_name": "Marco M", "link": "https://stackoverflow.com/users/3079922/marco-m"}, "reply_to_user": {"reputation": 9266, "user_id": 1465640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b64a91edcfaad3c6290039008deea285?s=128&d=identicon&r=PG", "display_name": "Pylinux", "link": "https://stackoverflow.com/users/1465640/pylinux"}, "edited": false, "score": 0, "creation_date": 1491311477, "post_id": 43161559, "comment_id": 73487861, "body": "@Pylinux yes! I tried basically any possible configuration, only 443, 443 + 80, 80 redirect to 443, all this with autocert and also with the manually created certificates. The site works, I&#39;ve got A+ rating with my actual configuration... my clients work just fine, no errors, and I also get the logo &quot;secure&quot; on both safari and chrome. I just continue to get errors and errors from unknown IPs... I would like to be able to stop the logs at least, anyway I find it very strange, I mean 30 wrong requests per minute???"}, {"owner": {"reputation": 9266, "user_id": 1465640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b64a91edcfaad3c6290039008deea285?s=128&d=identicon&r=PG", "display_name": "Pylinux", "link": "https://stackoverflow.com/users/1465640/pylinux"}, "edited": false, "score": 1, "creation_date": 1491312366, "post_id": 43161559, "comment_id": 73488632, "body": "Aaaa, so it works but you&#39;re getting erros from some IPs, could it be that old clients are trying to access your site? Golang only supports the new secure encryption protocols: <a href=\"https://github.com/golang/go/issues/3930\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/3930</a>"}, {"owner": {"reputation": 1105, "user_id": 3079922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RdiYz.png?s=128&g=1", "display_name": "Marco M", "link": "https://stackoverflow.com/users/3079922/marco-m"}, "edited": false, "score": 0, "creation_date": 1491313481, "post_id": 43161559, "comment_id": 73489587, "body": "We&#39;re on a hosting platform so yes, I think it&#39;s possible that old clients of a service previously parked at this IP continue to send requests... very annoying."}, {"owner": {"reputation": 1105, "user_id": 3079922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RdiYz.png?s=128&g=1", "display_name": "Marco M", "link": "https://stackoverflow.com/users/3079922/marco-m"}, "edited": false, "score": 0, "creation_date": 1491313565, "post_id": 43161559, "comment_id": 73489676, "body": "Anyway they comes from different ports also, so may be those are not old clients of this IP..."}, {"owner": {"reputation": 1351, "user_id": 879047, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ee933b5bf986de605ee48c1ae3e3f7ee?s=128&d=identicon&r=PG", "display_name": "Duru Can Celasun", "link": "https://stackoverflow.com/users/879047/duru-can-celasun"}, "edited": false, "score": 0, "creation_date": 1514976753, "post_id": 43161559, "comment_id": 83125400, "body": "@MarcoM did you ever find out what was causing these errors?"}, {"owner": {"reputation": 1105, "user_id": 3079922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RdiYz.png?s=128&g=1", "display_name": "Marco M", "link": "https://stackoverflow.com/users/3079922/marco-m"}, "reply_to_user": {"reputation": 1351, "user_id": 879047, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ee933b5bf986de605ee48c1ae3e3f7ee?s=128&d=identicon&r=PG", "display_name": "Duru Can Celasun", "link": "https://stackoverflow.com/users/879047/duru-can-celasun"}, "edited": false, "score": 0, "creation_date": 1514994444, "post_id": 43161559, "comment_id": 83135439, "body": "@DuruCanCelasun I had no time to check, it works anyway... I&#39;ve been busy with other aspects of our backend. I was able to run one instance with Echo framework (which also use let&#39;s encrypt) without errors, I will check it eventually."}, {"owner": {"reputation": 1079, "user_id": 813503, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/474a8742d5971d0152fdb2da28b40ce9?s=128&d=identicon&r=PG", "display_name": "emptyflash", "link": "https://stackoverflow.com/users/813503/emptyflash"}, "edited": false, "score": 0, "creation_date": 1561429232, "post_id": 43161559, "comment_id": 100050472, "body": "I&#39;m actually experiencing the same thing, but it actually causes a problem where I can&#39;t retrieve my certs from cache any more."}], "answers": [{"tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": false, "score": 1, "last_activity_date": 1517109571, "creation_date": 1517109571, "answer_id": 48482855, "question_id": 43161559, "link": "https://stackoverflow.com/questions/43161559/setting-up-lets-encrypt-with-go-handshake-errors/48482855#48482855", "title": "Setting up Let&#39;s encrypt with Go - handshake errors", "body": "<p>As JimB and others said in the comments, this can be the result of bad requests. Invalid requests will be logged when using <a href=\"https://www.ssllabs.com/ssltest/\" rel=\"nofollow noreferrer\">https://www.ssllabs.com/ssltest/</a> to test a site's https configuration. A good test score can give you confidence the log messages are benign and can be safely ignored. </p>\n\n<p>Also the <a href=\"https://godoc.org/golang.org/x/crypto/acme/autocert\" rel=\"nofollow noreferrer\">acme/autocert</a> package is evolving rapidly (at Jan 2018), please check your version is up to date.</p>\n"}], "owner": {"reputation": 1105, "user_id": 3079922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RdiYz.png?s=128&g=1", "display_name": "Marco M", "link": "https://stackoverflow.com/users/3079922/marco-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4531, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1517109571, "creation_date": 1491077776, "question_id": 43161559, "link": "https://stackoverflow.com/questions/43161559/setting-up-lets-encrypt-with-go-handshake-errors", "title": "Setting up Let&#39;s encrypt with Go - handshake errors", "body": "<p>I'm trying to set up let's encrypt on a load balancer written in Go, I tried both the automatic and manual setup but I always get errors.</p>\n\n<p>The domain is pointing correctly to our server (Digital Ocean) and I can even open the site from a browser without errors, also an ssl check report no errors on this domain. The fact is that when I run the Go executable on server from CLI I get errors repeatedly.</p>\n\n<ol>\n<li>Automatic (acme/autocert) setup:</li>\n</ol>\n\n<p>The server code is that, the certificate and the key are created when I look at the domain from a browser for the first time after the server start:</p>\n\n<pre><code>    go func() {\n        log.Printf(\"Staring HTTP service on %s ...\", \":80\")\n\n        http.HandleFunc(\"/*\", http.HandlerFunc(func (w http.ResponseWriter, r *http.Request) {\n            http.Redirect(w, r, \"https://\" + app.Cfg.S_HOST + \":443\" + r.RequestURI, http.StatusMovedPermanently)\n        }))\n\n        if err := http.ListenAndServe(\":80\", nil); err != nil {\n            errs &lt;- err\n        }\n\n    }()\n\n\n\n    log.Printf(\"Staring HTTPS service on %s ...\", \":443\")\n\n    http.HandleFunc(\"/hello\", http.HandlerFunc(func (w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Content-Type\", \"text/plain\")\n        w.Write([]byte(\"This is an example server.\\n\"))\n    }))\n\n\n    certManager := autocert.Manager{\n        Prompt:     autocert.AcceptTOS,\n        HostPolicy: autocert.HostWhitelist(app.Cfg.S_HOST), //your domain here\n        Cache:      autocert.DirCache(\"certs\"), //folder for storing certificates\n    }\n\n    server := &amp;http.Server{\n        Addr: \":443\",\n        TLSConfig: &amp;tls.Config{\n            ServerName: app.Cfg.S_HOST,\n            GetCertificate: certManager.GetCertificate,\n        },\n    }\n\n    if err := server.ListenAndServeTLS(\"\", \"\"); err != nil {\n        print(err.Error())\n    } //key and cert are comming from Let's Encrypt\n</code></pre>\n\n<p>I get those errors:</p>\n\n<ol>\n<li><p>http: TLS handshake error from (ip):59451: read tcp (myserver IP):443->(ip):59451: read: connection reset by peer</p></li>\n<li><p>hello.ServerName empty:2017/04/01 17:14:38 http: TLS handshake error from (ip):58193: acme/autocert: missing server name</p></li>\n<li><p>http: TLS handshake error from (ip):45822: acme/autocert: host not configured</p></li>\n<li><p>http: TLS handshake error from (ip):58440: EOF</p></li>\n</ol>\n\n<p>Then I tried also creating the certificate manually (succesfully) and simply using that code and I get errors again and again:</p>\n\n<p>The server code is:</p>\n\n<pre><code>    go func() {\n        log.Printf(\"Staring HTTP service on %s ...\", \":80\")\n\n        http.HandleFunc(\"/*\", http.HandlerFunc(func (w http.ResponseWriter, r *http.Request) {\n            http.Redirect(w, r, \"https://\" + app.Cfg.S_HOST + \":443\" + r.RequestURI, http.StatusMovedPermanently)\n        }))\n\n        if err := http.ListenAndServe(\":80\", nil); err != nil {\n            errs &lt;- err\n        }\n\n    }()\n\n\n\n    log.Printf(\"Staring HTTPS service on %s ...\", \":443\")\n\n    http.HandleFunc(\"/hello\", http.HandlerFunc(func (w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Content-Type\", \"text/plain\")\n        w.Write([]byte(\"This is an example server.\\n\"))\n    }))\n\n\n    // ssl[\"cert\"] and ssl[\"key\"] are the cert and key path (letsencrypt/live...)\n    if err := http.ListenAndServeTLS(sslAddr, ssl[\"cert\"], ssl[\"key\"], nil); err != nil {\n        errs &lt;- err\n    }\n</code></pre>\n\n<p>Errors:</p>\n\n<ol>\n<li><p>http2: server: error reading preface from client (ip):10319: bogus\ngreeting \"POST / HTTP/1.1\\r\\nHost: 4\"</p></li>\n<li><p>http: TLS handshake error from (ip):10322: EOF</p></li>\n<li><p>http: TLS handshake error from (ip):13504: read tcp (my server ip):443->(ip):13504: read: connection reset by peer</p></li>\n<li><p>http2: server: error reading preface from client (ip):9672: timeout waiting for client preface</p></li>\n</ol>\n\n<p>Can someone help me please? Thanks</p>\n"}, {"tags": ["go", "file-io"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1491074435, "post_id": 43160991, "comment_id": 73397014, "body": "It&#39;s the same concept in any language. Are you asking you to scan a file by lines? <a href=\"https://golang.org/pkg/bufio/#example_Scanner_lines\" rel=\"nofollow noreferrer\">golang.org/pkg/bufio/#example_Scanner_lines</a>"}, {"owner": {"reputation": 318, "user_id": 4015297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/827cf44882f40849d3b6f2540915a901?s=128&d=identicon&r=PG", "display_name": "MaxCodes", "link": "https://stackoverflow.com/users/4015297/maxcodes"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491074740, "post_id": 43160991, "comment_id": 73397100, "body": "@JimB That is correct. Could you perhaps offer an explanation in Go?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1491075414, "post_id": 43160991, "comment_id": 73397296, "body": "What question do you have about the example given, or other answers like <a href=\"https://stackoverflow.com/questions/8757389/reading-file-line-by-line-in-go/16615559#16615559\" title=\"reading file line by line in go\">stackoverflow.com/questions/8757389/&hellip;</a>?"}, {"owner": {"reputation": 318, "user_id": 4015297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/827cf44882f40849d3b6f2540915a901?s=128&d=identicon&r=PG", "display_name": "MaxCodes", "link": "https://stackoverflow.com/users/4015297/maxcodes"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491075691, "post_id": 43160991, "comment_id": 73397366, "body": "@JimB Where in that code returns the final line of the file. I&#39;m still a bit confused about how to get that information."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491076005, "post_id": 43160991, "comment_id": 73397449, "body": "I&#39;m not sure how else to state it, the last line you read will be the final line."}, {"owner": {"reputation": 318, "user_id": 4015297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/827cf44882f40849d3b6f2540915a901?s=128&d=identicon&r=PG", "display_name": "MaxCodes", "link": "https://stackoverflow.com/users/4015297/maxcodes"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491076037, "post_id": 43160991, "comment_id": 73397464, "body": "@JimB But how do I catch that?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1491078912, "post_id": 43160991, "comment_id": 73398305, "body": "you assign it to a variable: <a href=\"https://play.golang.org/p/6mCIJDW2jy\" rel=\"nofollow noreferrer\">play.golang.org/p/6mCIJDW2jy</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": true, "score": 3, "last_activity_date": 1491123705, "creation_date": 1491123705, "answer_id": 43166534, "question_id": 43160991, "link": "https://stackoverflow.com/questions/43160991/read-the-final-line-in-a-text-file/43166534#43166534", "title": "Read the final line in a text file", "body": "<p>Starting the search from the very beginning of the file can be an expensive option esp. if your file(s) are large. </p>\n\n<p>A better option may be to - Use os.Open to open the file and stat method (<a href=\"https://golang.org/pkg/os/#File.Stat\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#File.Stat</a>) to get the size of the file. Start reading from end of the file using ReadAt (<a href=\"https://golang.org/pkg/os/#File.ReadAt\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#File.ReadAt</a> - read the last byte first, second last byte next..), all the way reverse till you find the second newline character. That's the beginning of the last line. Hope this helps.</p>\n"}], "owner": {"reputation": 318, "user_id": 4015297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/827cf44882f40849d3b6f2540915a901?s=128&d=identicon&r=PG", "display_name": "MaxCodes", "link": "https://stackoverflow.com/users/4015297/maxcodes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1420, "favorite_count": 0, "accepted_answer_id": 43166534, "answer_count": 1, "score": -1, "last_activity_date": 1491123705, "creation_date": 1491074285, "question_id": 43160991, "link": "https://stackoverflow.com/questions/43160991/read-the-final-line-in-a-text-file", "title": "Read the final line in a text file", "body": "<p>I am currently learning Go, and I need to read the final line in a text file. </p>\n\n<p>I have searched everywhere and there does not seem to be a definitive explanation on how one would do this.</p>\n\n<p>How would I do this?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491078584, "post_id": 43160569, "comment_id": 73398211, "body": "As far as I know that&#39;s not possible with plain <code>encoding&#47;json.Unmarshal</code> and without you doing some extra work... Either unmarshal it first into the map and then loop over that map to construct your slice of <code>Status</code> structs, or create a type like <code>type Result []Status</code> and implement the unmarshaler interface for that type."}], "answers": [{"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": true, "score": 2, "last_activity_date": 1585120094, "last_edit_date": 1585120094, "creation_date": 1491079782, "answer_id": 43161892, "question_id": 43160569, "link": "https://stackoverflow.com/questions/43160569/custom-json-marshaling/43161892#43161892", "title": "Custom Json Marshaling", "body": "<p>As @mkopriva stated in the comment, it's not possible without some extra work. This code does provide means to Marshal/Unmarshal data to/from a slice of <code>Status</code>s:</p>\n\n<pre><code>func main() {\n    sr := new(StatusReposne)\n\n    json.Unmarshal([]byte(input), sr)\n    fmt.Printf(\"%+v\\n\", sr)\n\n    js, _ := json.Marshal(sr)\n    fmt.Printf(\"%s\\n\", js)\n}\n\ntype StatusReposne struct {\n    Result []Status `json:\"result\"`\n}\n\ntype Status struct {\n    Id     int\n    Status string\n}\n\nfunc (x *StatusReposne) MarshalJSON() ([]byte, error) {\n    var buffer struct {\n        Result map[string]string `json:\"result\"`\n    }\n    buffer.Result = make(map[string]string)\n    for _, v := range x.Result {\n        buffer.Result[strconv.Itoa(v.Id)] = v.Status\n    }\n    return json.Marshal(&amp;buffer)\n}\n\nfunc (x *StatusReposne) UnmarshalJSON(b []byte) error {\n    var buffer struct {\n        Result map[string]string `json:\"result\"`\n    }\n    buffer.Result = make(map[string]string)\n    json.Unmarshal(b, &amp;buffer)\n    for k, v := range buffer.Result {\n        k, _ := strconv.Atoi(k)\n        x.Result = append(x.Result, Status{Id: k, Status: v})\n    }\n    return nil\n}\n\nvar input = `{\n  \"result\": {\n    \"0\": \"done\",\n    \"1\": \"incomplete\",\n    \"2\": \"completed\"\n  }\n}`\n</code></pre>\n"}], "owner": {"reputation": 4530, "user_id": 1078753, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/c97a66302509102c6e04d69b018bf6c2?s=128&d=identicon&r=PG&f=1", "display_name": "Ruslan F.", "link": "https://stackoverflow.com/users/1078753/ruslan-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 504, "favorite_count": 0, "accepted_answer_id": 43161892, "answer_count": 1, "score": 1, "last_activity_date": 1585120094, "creation_date": 1491071638, "last_edit_date": 1491071943, "question_id": 43160569, "link": "https://stackoverflow.com/questions/43160569/custom-json-marshaling", "title": "Custom Json Marshaling", "body": "<p>I have a third-party json api to work with in go.<br>\nIt has some endpoints which return data as key-value.<br>\nFor example here is json for statuses:</p>\n\n<pre><code>{\n  \"result\": {\n    \"0\": \"done\",\n    \"1\": \"incomplete\",\n    \"2\": \"completed\",\n    ....\n  }\n}\n</code></pre>\n\n<p>So as you see it is not an array it is an object.<br>\nIs it possible to marshal this kind of json to array of objects like </p>\n\n<pre><code>type Status struct {\n    Id int\n    Status string\n}\n</code></pre>\n\n<p>without using additional struct like</p>\n\n<pre><code>type StatusReposne struct {\n    Result map[string]string `json:\"result\"`\n}\n</code></pre>\n\n<p>and code to extract values?</p>\n"}, {"tags": ["google-app-engine", "debugging", "go"], "comments": [{"owner": {"reputation": 1657, "user_id": 2864464, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c606da71fcfa488180a8d81c8fdcc7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Kohler", "link": "https://stackoverflow.com/users/2864464/alexander-kohler"}, "edited": false, "score": 0, "creation_date": 1491070869, "post_id": 43159962, "comment_id": 73395929, "body": "If I&#39;m understanding what you&#39;re asking.. Simply run <code>ps aux | grep _app_go</code> to get your pid, then attach from there."}, {"owner": {"reputation": 23, "user_id": 7753220, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ursIHdPiNdU/AAAAAAAAAAI/AAAAAAAAAIg/RGUTXZQbeV0/photo.jpg?sz=128", "display_name": "Francois Hattingh", "link": "https://stackoverflow.com/users/7753220/francois-hattingh"}, "reply_to_user": {"reputation": 1657, "user_id": 2864464, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c606da71fcfa488180a8d81c8fdcc7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Kohler", "link": "https://stackoverflow.com/users/2864464/alexander-kohler"}, "edited": false, "score": 0, "creation_date": 1491160019, "post_id": 43159962, "comment_id": 73418710, "body": "I have seen that proposed solution, but running dev_appserver.py doesn&#39;t create a process like that. App engine doc mentions running goapp serve but there is no goapp command with the latest SDK."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491235692, "post_id": 43159962, "comment_id": 73451859, "body": "Yeah, the latest &quot;preferred&quot; way is to use the gcloud sdk and run as you are doing. I personally have not updated to this and still use the old packaged SDK simply because many of these types of issues arise. <code>goapp</code> is still my friend...."}], "answers": [{"tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 0, "last_activity_date": 1491238821, "last_edit_date": 1491238821, "creation_date": 1491238461, "answer_id": 43190210, "question_id": 43159962, "link": "https://stackoverflow.com/questions/43159962/go-app-engine-debugging/43190210#43190210", "title": "Go App Engine debugging", "body": "<p>The process you are looking for when running the go-appengine-sdk using the google-cloud-sdk is <code>_go_app</code>. Simply modifying my app to start with a NoOp infinite for loop was enough to send it to the top of the CPU usage list so I could find it.</p>\n\n<p><a href=\"https://i.stack.imgur.com/pfs9X.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/pfs9X.png\" alt=\"enter image description here\"></a></p>\n\n<p>So on Ubuntu, a simple <code>ps aux | grep _go_app</code> should list the PID.</p>\n\n<p>P.S. This was done on a Mac, so it's possible (however unlikely) that it could be different. But doing your own NoOp for loop to find it would work anyway.</p>\n"}], "owner": {"reputation": 23, "user_id": 7753220, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ursIHdPiNdU/AAAAAAAAAAI/AAAAAAAAAIg/RGUTXZQbeV0/photo.jpg?sz=128", "display_name": "Francois Hattingh", "link": "https://stackoverflow.com/users/7753220/francois-hattingh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1491238821, "creation_date": 1491068049, "question_id": 43159962, "link": "https://stackoverflow.com/questions/43159962/go-app-engine-debugging", "title": "Go App Engine debugging", "body": "<p>I'm using dev_appserver.py to run my Go App locally on my Ubuntu machine. I'm trying to debug the application but can't seem to find the go process to attach a debugger to. Can anyone point me in the right direction?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1491063468, "post_id": 43159021, "comment_id": 73393281, "body": "<code>time.Sleep</code> takes a <code>time.Duration</code>. See the docs: <a href=\"https://golang.org/pkg/time/#Sleep\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#Sleep</a>"}, {"owner": {"reputation": 10078, "user_id": 2709018, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p98Vl.png?s=128&g=1", "display_name": "myaut", "link": "https://stackoverflow.com/users/2709018/myaut"}, "edited": false, "score": 0, "creation_date": 1491063489, "post_id": 43159021, "comment_id": 73393290, "body": "If you print <code>time.Duration</code> to console, you&#39;ll get output of <code>(time.Duration) String() string</code> method result"}], "answers": [{"comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1491063718, "post_id": 43159122, "comment_id": 73393356, "body": "I gave you an upvote for trying to be helpful as you answered at the same time, no idea why people would downvote your answer, and then answer in the comments when the guidelines say - &#39;Avoid answering questions in comments&#39;."}, {"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1491082714, "post_id": 43159122, "comment_id": 73399328, "body": "@KennyGrant this answer was previously incomplete and incorrect. My downvote is now withdrawn. Additionally, answering poor questions in comments is preferred to providing proper answers to poor questions."}], "tags": [], "owner": {"reputation": 494, "user_id": 6909517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b765611d68ae57c7c4b1b8677b4715ed?s=128&d=identicon&r=PG&f=1", "display_name": "Isuranga Perera", "link": "https://stackoverflow.com/users/6909517/isuranga-perera"}, "is_accepted": true, "score": 5, "last_activity_date": 1491066827, "last_edit_date": 1491066827, "creation_date": 1491063092, "answer_id": 43159122, "question_id": 43159021, "link": "https://stackoverflow.com/questions/43159021/go-operator-overloading/43159122#43159122", "title": "Go - operator overloading", "body": "<p><code>Sleep()</code> accept a <code>Duration type</code> which is <code>int64</code>. So you can't pass string type object as an argument without typecasting it.</p>\n\n<p>You got the output <code>1ms</code> because of this method </p>\n\n<pre><code>(time.Duration) String() string\n</code></pre>\n"}], "owner": {"reputation": 273, "user_id": 7301400, "user_type": "registered", "accept_rate": 53, "profile_image": "https://lh6.googleusercontent.com/-ikx3NlkHPok/AAAAAAAAAAI/AAAAAAAAAHI/ODfnxH6xEJ4/photo.jpg?sz=128", "display_name": "Metal Evolution Studio", "link": "https://stackoverflow.com/users/7301400/metal-evolution-studio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 0, "closed_date": 1491082718, "accepted_answer_id": 43159122, "answer_count": 1, "score": -3, "last_activity_date": 1491131144, "creation_date": 1491062537, "last_edit_date": 1491131144, "question_id": 43159021, "link": "https://stackoverflow.com/questions/43159021/go-operator-overloading", "closed_reason": "Needs details or clarity", "title": "Go - operator overloading", "body": "<p>I have started to study Go and I am trying to understand what happens below:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>time.Sleep(1000 * time.Millisecond) // Works\ntime.Sleep(\"1000ms\") // Doesn't work\n</code></pre>\n\n\n\n<p>If you print to the console <code>time.Milliseconds</code> you can see <code>1ms</code>. So I think that I can simply call that method with the value <code>\"1000ms\"</code>, but I get an error. Next I searched for operator overloading in Go, but it doesn't support it. I understand that <code>time.Sleep</code> gets the <code>time.Milliseconds</code> data type, but how does Go allow it if it doesn't support overloading operators like <code>*</code>?</p>\n"}, {"tags": ["recursion", "go"], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 2, "last_activity_date": 1491076772, "last_edit_date": 1491076772, "creation_date": 1491076415, "answer_id": 43161329, "question_id": 43158984, "link": "https://stackoverflow.com/questions/43158984/combination-sum-in-go/43161329#43161329", "title": "Combination Sum in Go", "body": "<p>This happens because of the way slices work. A slice object is a reference to an underlying array, along with the length of the slice, a pointer to the start of the slice in the array, and the slice's capacity. The capacity of a slice is the number of elements from the beginning of the slice to the end of the array. When you append to a slice, if there is available capacity for the new element, it is added to the existing array. However, if there isn't sufficient capacity, <code>append</code> allocates a new array and copies the elements. The new array is allocated with extra capacity so that an allocation isn't required for every append.</p>\n\n<p>In your <code>for</code> loop, when <code>curComb</code> is <code>[1, 1, 1]</code>, its capacity is 4. On successive iterations of the loop, you append 1 and then 2, neither of which causes a reallocation because there's enough room in the array for the new element. When <code>curComb</code> is <code>[1, 1, 1, 1]</code>, it is put on the results list, but in the next iteration of the <code>for</code> loop, the <code>append</code> changes the last element to 2 (remember that it's the same underlying array), so that's what you see when you print the results at the end.</p>\n\n<p>The solution to this is to return a copy of <code>curComb</code> when the sum equals the target:</p>\n\n<pre><code>if sum == target {\n    fmt.Println(curComb)\n    tmpCurComb := make([]int, len(curComb))\n    copy(tmpCurComb, curComb)\n    return [][]int{tmpCurComb}\n</code></pre>\n\n<p><a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">This article</a> gives a good explanation of how slices work.</p>\n"}], "owner": {"reputation": 23, "user_id": 3286648, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003596481960/picture?type=large", "display_name": "Yun Chen", "link": "https://stackoverflow.com/users/3286648/yun-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 613, "favorite_count": 0, "accepted_answer_id": 43161329, "answer_count": 1, "score": 2, "last_activity_date": 1491110891, "creation_date": 1491062358, "last_edit_date": 1491110891, "question_id": 43158984, "link": "https://stackoverflow.com/questions/43158984/combination-sum-in-go", "title": "Combination Sum in Go", "body": "<pre><code>/*\nGiven an array: [1,2] and a target: 4\nFind the solution set that adds up to the target\nin this case:\n[1,1,1,1]\n[1,1,2]\n[2,2]\n*/\nimport \"sort\"\nfunc combinationSum(candidates []int, target int) [][]int {\n    sort.Ints(candidates)\n    return combine(0, target, []int{}, candidates)\n}\nfunc combine(sum int, target int, curComb []int, candidates []int) [][]int {\n    var tmp [][]int\n    var result [][]int\n    if sum == target {\n        fmt.Println(curComb)\n        return [][]int{curComb}\n    } else if sum &lt; target {\n        for i,v := range candidates {\n            tmp = combine(sum+v, target, append(curComb, v), candidates[i:])\n            result = append(result,tmp...)\n        }\n    }\n    return result\n}\n</code></pre>\n\n<p>This is a problem in Leetcode and I use recursion to solve it.</p>\n\n<p>In line 18, I print every case when the sum is equal to the target.\nThe output is :</p>\n\n<pre><code>[1,1,1,1]\n[1,1,2]\n[2,2]\n</code></pre>\n\n<p>And that is the answer that I want!\nBut why is the final answer (two-dimensional):</p>\n\n<pre><code>[[1,1,1,2],[1,1,2],[2,2]]\n</code></pre>\n\n<p>Expected answer is : [[1,1,1,1],[1,1,2],[2,2]]</p>\n\n<p>Please help me find the mistake in the code. Thanks for your time.</p>\n"}, {"tags": ["mongodb", "go", "random", "slice", "mgo"], "comments": [{"owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1491055105, "post_id": 43157290, "comment_id": 73390643, "body": "Do you want mongo to randomize the data or do you want this to happen in Golang?  The mongo $sample selector might be what you are looking for.  <a href=\"https://docs.mongodb.com/master/reference/operator/aggregation/sample/#definition\" rel=\"nofollow noreferrer\">docs.mongodb.com/master/reference/operator/aggregation/sampl&zwnj;&#8203;e/&hellip;</a>"}, {"owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "reply_to_user": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1491057087, "post_id": 43157290, "comment_id": 73391178, "body": "I would prefer in golang but sample could be fine for me , but  i would love an example with mgo thanks"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1491128152, "last_edit_date": 1491128152, "creation_date": 1491122702, "answer_id": 43166390, "question_id": 43157290, "link": "https://stackoverflow.com/questions/43157290/randomize-order-of-a-mongodb-query-in-go/43166390#43166390", "title": "Randomize order of a MongoDB query in Go", "body": "<h3>Manual shuffling</h3>\n\n<p>Here's a simple shuffle algorithm, which shuffles (randomizes) a <code>[]BadVido</code> slice:</p>\n\n<pre><code>func shuffle(r []BadVideo) {\n    for i := len(r) - 1; i &gt; 0; i-- {\n        j := rand.Intn(i + 1)\n        r[i], r[j] = r[j], r[i]\n    }\n}\n</code></pre>\n\n<p>So after you loaded your results, simply call <code>shuffle(results)</code> on it.</p>\n\n<p>For testing, I will use a simple <code>BadVideo</code> type:</p>\n\n<pre><code>type BadVideo struct {\n    Name string\n}\n\nfunc main() {\n    rand.Seed(time.Now().UnixNano())\n    results := []BadVideo{{\"a\"}, {\"b\"}, {\"c\"}, {\"d\"}, {\"e\"}}\n    shuffle(results)\n    fmt.Println(results)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/ZFbH32Nqnw\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[{c} {d} {b} {e} {a}]\n</code></pre>\n\n<p><strong>How it works:</strong></p>\n\n<p>To shuffle a slice, the <code>shuffle()</code> function randomly selects one element from the slice for each index. It does it like iterating over all elements downward, and selects a random element from the remaining slice (including index of the element we're currently selecting, because random orders also include ones where an element \"stays in place\"), and using a random index to swaps the element with the chosen random one. The loop goes until <code>i &gt; 0</code> (and not until <code>i &gt;=0</code>), because if only 1 element left, no need to swap it with itself.</p>\n\n<h3>Using <code>rand.Perm()</code></h3>\n\n<p>Another variant of <code>shuffle()</code> could take advantage of <a href=\"https://golang.org/pkg/math/rand/#Perm\" rel=\"nofollow noreferrer\"><code>rand.Perm()</code></a> which returns a slice containing shuffled numbers. We can use these random numbers to tell how to reorder the results:</p>\n\n<pre><code>func shuffle(r []BadVideo) {\n    r2 := append([]BadVideo(nil), r...)\n    for i, j := range rand.Perm(len(r)) {\n        r[i] = r2[j]\n    }\n}\n</code></pre>\n\n<p>Try this variant on the <a href=\"https://play.golang.org/p/kowmP2FWeB\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>One thing to note here: before we do the reordering, we have to save the original slice (make a copy of it), so we can select the original elements specified by random indices when writing the results in the slice. I created a copy by appending the complete slice to a <code>nil</code> slice.</p>\n"}], "owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 550, "favorite_count": 0, "accepted_answer_id": 43166390, "answer_count": 1, "score": 1, "last_activity_date": 1491128152, "creation_date": 1491052205, "last_edit_date": 1491123395, "question_id": 43157290, "link": "https://stackoverflow.com/questions/43157290/randomize-order-of-a-mongodb-query-in-go", "title": "Randomize order of a MongoDB query in Go", "body": "<p>Here is my query :</p>\n\n<pre><code>c := session.DB(\"searchV\").C(\"video\")\nvar results []BadVideo\nerr5 := c.Find(nil).All(&amp;results)\nfmt.Println(\"request done\")\nif err5 != nil {\n    panic(err5)\n}\nvar i = 0\nfor _,badvideo := range results {\n}\n</code></pre>\n\n<p>I would like to randomize the order of browsing the items of the query for making operation on each item of the request ...</p>\n\n<p>So each time I run it, I browse it in a different order.</p>\n"}, {"tags": ["go", "goland"], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 0, "last_activity_date": 1491736253, "creation_date": 1491736253, "answer_id": 43306023, "question_id": 43156656, "link": "https://stackoverflow.com/questions/43156656/managing-projects-in-gogland/43306023#43306023", "title": "Managing projects in Gogland", "body": "<p>The project structure you are using is not a proper Go structure.\nYou should follow the instructions here: <a href=\"https://golang.org/doc/code.html#Workspaces\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html#Workspaces</a> for how to do that.\nAs for completion, the projects are part of the same GOPATH (when configured correctly) so it's normal to have them show in each-others completion mode. However, you can exclude them by using Settings | Go | Imports</p>\n"}], "owner": {"reputation": 412, "user_id": 6498438, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/OFuAw.png?s=128&g=1", "display_name": "trashgenerator", "link": "https://stackoverflow.com/users/6498438/trashgenerator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 491, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1491736253, "creation_date": 1491048335, "question_id": 43156656, "link": "https://stackoverflow.com/questions/43156656/managing-projects-in-gogland", "title": "Managing projects in Gogland", "body": "<p>I'm new in GO and need some help. I've got this structure of all my projects:</p>\n\n<pre><code>go_projects\n-bin\n-pkg\n-src\n--FirstProject\n--SecondProject\n</code></pre>\n\n<p>Working in <strong>Gogland Build #GO-171.3780.106, built on March 22, 2017</strong> I like this autocompletion which is standart now for IDEs. But when I'm working with SecondProject - Gogland always show in list files from FirstProject and some of them has equal names. My <strong>GOPATH</strong> is <strong>../go_projects</strong>. Can I do something to exclude FirstProject modules from autocomplete for SecondProject and SecondProject from FirstProject??</p>\n"}, {"tags": ["go", "switch-statement", "goquery"], "comments": [{"owner": {"reputation": 3416, "user_id": 2484972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ea1c4b2c5aa3c7da2f2740bc1a643ee0?s=128&d=identicon&r=PG", "display_name": "Tatsuyuki Ishi", "link": "https://stackoverflow.com/users/2484972/tatsuyuki-ishi"}, "edited": false, "score": 0, "creation_date": 1491047305, "post_id": 43156455, "comment_id": 73388304, "body": "goto is your friend"}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1491047532, "creation_date": 1491047532, "answer_id": 43156507, "question_id": 43156455, "link": "https://stackoverflow.com/questions/43156455/how-to-break-out-of-switch-case-from-inside-a-function-defined-inside-the-switch/43156507#43156507", "title": "How to break out of switch case from inside a function defined inside the switch case in golang?", "body": "<p>You should make use of goquery's <a href=\"https://godoc.org/github.com/PuerkitoBio/goquery#Selection.EachWithBreak\" rel=\"nofollow noreferrer\"><code>EachWithBreak</code></a> method to stop iterating over the selection:</p>\n\n<pre><code>switch {\n    case url == url1:\n        doc.Find(\"xyz\").EachWithBreak(func(i int,s *goquery.Selection) bool {\n            a,_ := s.Attr(\"href\")\n            return a != b\n        })\n}\n</code></pre>\n\n<p>As long as there's no remaining code in your switch case, you do not need to use a <code>break</code>.</p>\n"}], "owner": {"reputation": 1589, "user_id": 7205620, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d192b6e443c87744c05a745b951f8fde?s=128&d=identicon&r=PG&f=1", "display_name": "Krash", "link": "https://stackoverflow.com/users/7205620/krash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 0, "accepted_answer_id": 43156507, "answer_count": 1, "score": 1, "last_activity_date": 1491047532, "creation_date": 1491047181, "question_id": 43156455, "link": "https://stackoverflow.com/questions/43156455/how-to-break-out-of-switch-case-from-inside-a-function-defined-inside-the-switch", "title": "How to break out of switch case from inside a function defined inside the switch case in golang?", "body": "<p>The question sounds weird but I didn't know any better way to put it. I am using goquery and I am inside a <code>switch-case</code>:</p>\n\n<pre><code>switch{\n    case url == url1:\n        doc.Find(\"xyz\").Each(func(i int,s *goquery.Selection){\n            a,_ := s.Attr(\"href\")\n            if a== b{\n                //I want to break out of the switch case right now. I dont want to iterate through all the selections. This is the value.\n                break\n            }\n        })\n}\n</code></pre>\n\n<p>Using <code>break</code> gives the following error:\n<code>break is not in a loop</code></p>\n\n<p>What should I use here to break out of the switch-case instead of letting the program iterate over each of the selections and run my function over each of them?</p>\n"}, {"tags": ["go", "tcp", "concurrency"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491056790, "post_id": 43155017, "comment_id": 73391115, "body": "It makes no sense to send things concurrently to a socket. What use is data that&#39;s randomly interleaved?"}, {"owner": {"reputation": 77, "user_id": 4224311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1594330aaf87d4790e20873fd53e1172?s=128&d=identicon&r=PG&f=1", "display_name": "vc25", "link": "https://stackoverflow.com/users/4224311/vc25"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491070474, "post_id": 43155017, "comment_id": 73395789, "body": "You are right, thanks for the reply. Just to confirm, I want to ask: so sending things concurrently to a socket means that data are properly gonna be interleaved. But if I send it using a different socket (same IP+port from server, different IP+port from client) then data will not be interleaved?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491070867, "post_id": 43155017, "comment_id": 73395927, "body": "No, there is no way for the data to somehow cross between connections. Each TCP socket is a separate stream."}, {"owner": {"reputation": 77, "user_id": 4224311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1594330aaf87d4790e20873fd53e1172?s=128&d=identicon&r=PG&f=1", "display_name": "vc25", "link": "https://stackoverflow.com/users/4224311/vc25"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491072753, "post_id": 43155017, "comment_id": 73396525, "body": "I see. I was just asking because I want to know what happens when there are concurrent upload from multiple clients. Thanks"}, {"owner": {"reputation": 77, "user_id": 4224311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1594330aaf87d4790e20873fd53e1172?s=128&d=identicon&r=PG&f=1", "display_name": "vc25", "link": "https://stackoverflow.com/users/4224311/vc25"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491147551, "post_id": 43155017, "comment_id": 73414061, "body": "I just checked that each time the goroutines connect to the server, it uses a new port, which means it is a different socket pair. Shouldn&#39;t it mean that data will not be randomly interleaved as they are in separate streams?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1491153474, "post_id": 43155017, "comment_id": 73416155, "body": "Ah yes, that&#39;s correct. The question sounded like it was about writing to a connection concurrently, but the code does have a single connection per goroutine."}], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 4224311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1594330aaf87d4790e20873fd53e1172?s=128&d=identicon&r=PG&f=1", "display_name": "vc25", "link": "https://stackoverflow.com/users/4224311/vc25"}, "edited": false, "score": 0, "creation_date": 1491054421, "post_id": 43156050, "comment_id": 73390423, "body": "Thanks, it solves my problem. But I have got another problem now. Although I can upload the files to the server without dropping any bytes, some bytes are incorrect (I checked the bytes using cmp and od). Would you know why?"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 77, "user_id": 4224311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1594330aaf87d4790e20873fd53e1172?s=128&d=identicon&r=PG&f=1", "display_name": "vc25", "link": "https://stackoverflow.com/users/4224311/vc25"}, "edited": false, "score": 0, "creation_date": 1491088552, "post_id": 43156050, "comment_id": 73400777, "body": "I think that&#39;s because of your buffer size check in the client. There might be some edge condition that&#39;s maybe sending same bits of data twice.For example, the very last chunk of the file may not have enough bytes to fill up the chunk causing the condition <code>sentByte == CHUNKSIZE</code> to behave badly."}, {"owner": {"reputation": 77, "user_id": 4224311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1594330aaf87d4790e20873fd53e1172?s=128&d=identicon&r=PG&f=1", "display_name": "vc25", "link": "https://stackoverflow.com/users/4224311/vc25"}, "edited": false, "score": 0, "creation_date": 1491215710, "post_id": 43156050, "comment_id": 73437380, "body": "Thanks, actually I did check but I just didn&#39;t put that in the code snippet above. The loop for sending the chunk will break when there is a read error from reading the file (eg. EOF). So that shouldn&#39;t be the problem. The number of bytes of the file I received by downloading and assembling the chunks is the same as the file I uploaded, but the content is not."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 3, "last_activity_date": 1491044818, "creation_date": 1491044818, "answer_id": 43156050, "question_id": 43155017, "link": "https://stackoverflow.com/questions/43155017/strip-file-and-write-the-chunks-concurrently-to-server-through-tcp-shows-broken/43156050#43156050", "title": "Strip file and write the chunks concurrently to server through TCP shows broken pipe error", "body": "<p>In your client <code>sentByte</code> should be a local variable to the sender goroutine. Since you have declared it as a global, there is a race condition in your code. Try the below fix:</p>\n\n<pre><code>go func(i int){\n    index := i%len(serverList)\n    vsConnection, _ := net.Dial(\"tcp\", serverList[index])\n\n    sentByte := 0 // make sentByte a local variable, so each goroutine \n                  // has its own copy \n    file, _ := os.Open(fileName)\n    file.Seek(int64(i)*CHUNKSIZE,0) //CHUNKSIZE is 134217728\n    for { \n        n, _ := file.Read(sendBuffer)\n        // ...\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 4224311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1594330aaf87d4790e20873fd53e1172?s=128&d=identicon&r=PG&f=1", "display_name": "vc25", "link": "https://stackoverflow.com/users/4224311/vc25"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 0, "accepted_answer_id": 43156050, "answer_count": 1, "score": 1, "last_activity_date": 1535809183, "creation_date": 1491038530, "question_id": 43155017, "link": "https://stackoverflow.com/questions/43155017/strip-file-and-write-the-chunks-concurrently-to-server-through-tcp-shows-broken", "title": "Strip file and write the chunks concurrently to server through TCP shows broken pipe error", "body": "<p>My client divides a file into multiple amount of chunks (128mb each), then it will upload the chunks to multiple servers concurrently using goroutines.</p>\n\n<p>However, when I use more than 1 goroutine, I got an error from the my client program.</p>\n\n<pre><code>write tcp [::1]:49324-&gt;[::1]:2001: write: broken pipe\n</code></pre>\n\n<p>And in my server, the error is </p>\n\n<pre><code>EOF\n</code></pre>\n\n<p>Note that the broken pipe error and EOF error occurs in different chunks. For example, broken pipe error might happen when writing chunk 1 while EOF error might happen when server is receiving chunk 2.</p>\n\n<p>Below is the client code:</p>\n\n<pre><code>//set maximum no. of goroutine running in the back\nmaxGoroutines := 3\nguard := make(chan struct{}, maxGoroutines)\n\nvar sentByte int64\n\nfor i:= 0; i &lt; chunkCount; i += 1{\n    guard &lt;- struct{}{} \n\n    go func(i int){\n        index := i%len(serverList)\n        vsConnection, _ := net.Dial(\"tcp\", serverList[index])\n\n        sentByte=0\n        file, _ := os.Open(fileName)\n        file.Seek(int64(i)*CHUNKSIZE,0) //CHUNKSIZE is 134217728\n        for { \n            n, _ := file.Read(sendBuffer)\n\n            n2, err2 := vsConnection.Write(sendBuffer[:n])\n            if err2 != nil {\n                fmt.Println(\"err2\",err2,chunkName)              \n            }\n            if(n2!=65536){ //65536 is size of sendBuffer\n                fmt.Println(\"n2\",n2)\n            }\n            sentByte = sentByte+int64(n)\n            if(sentByte == CHUNKSIZE){\n                break;\n            }\n        }\n        vsConnection.Close()\n        file.Close()\n        &lt;-guard\n    }(i)\n}\n</code></pre>\n\n<p>Below is the server code:</p>\n\n<pre><code>func main() {\n    mapping := cmap.New()\n    server, error := net.Listen(\"tcp\", \":2001\")\n    if error != nil {\n        fmt.Println(\"There was an error starting the server\" +    error.Error())\n        return\n    }\n\n    for {\n        connection, error := server.Accept()\n        if error != nil {\n            fmt.Println(\"There was am error with the connection\" + error.Error())\n            return\n        }\n        //one goroutine per connection\n        go ConnectionHandler(connection,mapping)\n    }\n}\n\nfunc ConnectionHandler(connection net.Conn, mapping cmap.ConcurrentMap) {\n    fmt.Println(\"Connected\")\n    //make a buffer to hold data        \n    var bufferFile bytes.Buffer\n    writer := bufio.NewWriter(&amp;bufferFile)\n\n    var receivedBytes int64\n    receivedBytes=0\n    for {\n\n        if(CHUNKSIZE&lt;=receivedBytes){\n            break\n        }\n        n,err := io.CopyN(writer, connection, BUFFERSIZE)\n        receivedBytes += n\n        if err != nil {\n            fmt.Println(\"err\", err.Error(), fileName)\n            break\n        }\n    }\n    mapping.Set(fileName,bufferFile.Bytes())\n    connection.Close()\n\n}\n</code></pre>\n\n<p>Big thanks in advance.</p>\n"}, {"tags": ["json", "go", "struct", "marshalling", "encode"], "answers": [{"comments": [{"owner": {"reputation": 500, "user_id": 705117, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a7eaf5a5e729890e0903feb3ed7e288f?s=128&d=identicon&r=PG", "display_name": "pablomolnar", "link": "https://stackoverflow.com/users/705117/pablomolnar"}, "edited": false, "score": 0, "creation_date": 1491113212, "post_id": 43154041, "comment_id": 73404803, "body": "Yes, it&#39;s possible but to be honest the way you need to build the objects and to reference *Base looks fill of clutter. For instance compare golang version (<a href=\"https://play.golang.org/p/4Mwx3dxck_\" rel=\"nofollow noreferrer\">play.golang.org/p/4Mwx3dxck_</a>) vs an inheritance approach in Groovy (<a href=\"https://cafe-huitre.appspot.com/script/5715999101812736\" rel=\"nofollow noreferrer\">cafe-huitre.appspot.com/script/5715999101812736</a>)"}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "reply_to_user": {"reputation": 500, "user_id": 705117, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a7eaf5a5e729890e0903feb3ed7e288f?s=128&d=identicon&r=PG", "display_name": "pablomolnar", "link": "https://stackoverflow.com/users/705117/pablomolnar"}, "edited": false, "score": 0, "creation_date": 1491152927, "post_id": 43154041, "comment_id": 73415946, "body": "Well go doesn&#39;t support inheritance, it supports composition and embedding.  <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#embedding</a>"}], "tags": [], "owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "is_accepted": false, "score": 2, "last_activity_date": 1491033177, "last_edit_date": 1491033177, "creation_date": 1491031412, "answer_id": 43154041, "question_id": 43153181, "link": "https://stackoverflow.com/questions/43153181/json-and-struct-composition-in-go/43154041#43154041", "title": "JSON and struct composition in Go", "body": "<p>Why not rename the propriety? But keep the json tags, and go will marshal/unmarshal based on that tag </p>\n\n<pre><code>type Base struct {\n    ID   string `json:\"id\"`\n    Name string `json:\"name\"`\n}\n\ntype Network struct {\n    Base\n}\n\ntype Series struct {\n    Network          // Flatten out all Network properties (ID + Name)\n    NetworkBase Base `json:\"network\"`\n}\n\ntype Season struct {\n    Series          // Flatten out all Series properties (ID + Name + Network)\n    SeriesBase Base `json:\"series\"`\n}\n\ntype Episode struct {\n    Season              // Flatten out all Season properties (ID + Name + Network + Series)\n    SeasonBase Base `json:\"season\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 500, "user_id": 705117, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a7eaf5a5e729890e0903feb3ed7e288f?s=128&d=identicon&r=PG", "display_name": "pablomolnar", "link": "https://stackoverflow.com/users/705117/pablomolnar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1344, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1491033177, "creation_date": 1491024514, "question_id": 43153181, "link": "https://stackoverflow.com/questions/43153181/json-and-struct-composition-in-go", "title": "JSON and struct composition in Go", "body": "<p>I have hierarchical structure similar to this <code>Network -&gt; Serie -&gt; Season -&gt; Episodes</code>. This is a simplified version my real hierarchy is 7 levels deep.</p>\n\n<p>I need to decode/encode these objects with the following JSON:</p>\n\n<pre><code>Network:\n{\n  id: 1,\n  name: 'Fox'\n}\n\nSeries:\n{\n   id: 2,\n   name: 'The Simpsons',\n   network: {\n      id: 1,\n      name: 'Fox'\n   }\n}\n\nSeason:\n{\n   id: 3,\n   name: 'Season 3',\n   network: {\n      id: 1,\n      name: 'Fox'\n\n   },\n   series: {\n      id: 2,\n      name: 'The Simpsons'\n   }\n}\n\nEpisode:\n{\n   id: 4,\n   name: 'Pilot',\n   network: {\n      id: 1,\n      name: 'Fox'\n   },\n   series: {\n      id: 2,\n      name: 'The Simpsons'\n   },\n   season: {\n      id: 3,\n      name: 'Season 3'\n   }\n}\n</code></pre>\n\n<p>I tried composing my objects like these:</p>\n\n<pre><code>type Base struct {\n  ID   string `json:\"id\"`\n  Name string `json:\"name\"`\n}\n\ntype Network struct {\n  Base\n}\n\ntype Series struct {\n  Network // Flatten out all Network properties (ID + Name)\n  Network Base `json:\"network\"`\n}\n\ntype Season struct {\n  Series  // Flatten out all Series properties (ID + Name + Network)\n  Series Base `json:\"series\"`\n}\n\ntype Episode struct {\n  Season  // Flatten out all Season properties (ID + Name + Network + Series)\n  Season Season `json:\"season\"`\n}\n</code></pre>\n\n<p>Of course it doesn't work due <code>\"duplicate field error\"</code>. In addition the JSON result would be deeply nested.\nIn classic OOP this is fairly easy using normal inheritance, in prototype languages it's also doable (Object.create/Mixins)</p>\n\n<p>Is there an elegant way of do this with golang? I would prefer to keep code DRY.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491024490, "post_id": 43153133, "comment_id": 73382813, "body": "How about using the function types instead, and choosing what function to run <a href=\"https://play.golang.org/p/aY3zIBRw9w\" rel=\"nofollow noreferrer\">play.golang.org/p/aY3zIBRw9w</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "edited": false, "score": 0, "creation_date": 1491025963, "post_id": 43153229, "comment_id": 73383114, "body": "O, this seems to be what I need, Thanks! But now it says: <code>cannot refer to unexported name foo.foo</code>"}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "reply_to_user": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "edited": false, "score": 0, "creation_date": 1491027877, "post_id": 43153229, "comment_id": 73383479, "body": "sorry, name the struct with a capital letter to be visible outside the package: <code>type Foo struct {}</code>"}, {"owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "edited": false, "score": 0, "creation_date": 1491028068, "post_id": 43153229, "comment_id": 73383522, "body": "Thanks, updated the question. They are now available but I now get: <code>howToSetThis declared and not used</code>... Almost there :-)"}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "reply_to_user": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "edited": false, "score": 0, "creation_date": 1491028186, "post_id": 43153229, "comment_id": 73383549, "body": "are you calling the function <code>howToSetThis.Test() </code>, because if you just assign a variable without using it the compiler will give that error."}, {"owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "edited": false, "score": 0, "creation_date": 1491028823, "post_id": 43153229, "comment_id": 73383703, "body": "Oh no, sorry. The example of above gives: <code>type foo.Foo is not an expression</code> and <code>type foo.Baz is not an expression</code>. I&#39;ve tried <code>howToSetThis := foo.Foo{}</code> and that gives the error from above."}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "reply_to_user": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "edited": false, "score": 0, "creation_date": 1491029577, "post_id": 43153229, "comment_id": 73383880, "body": "I made it work in the playground, you can take a look here: <a href=\"https://play.golang.org/p/CBDz9WW_NF\" rel=\"nofollow noreferrer\">play.golang.org/p/CBDz9WW_NF</a>"}, {"owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "edited": false, "score": 0, "creation_date": 1491030531, "post_id": 43153229, "comment_id": 73384165, "body": "Yes! This works. Many thanks. Just one little thing I don&#39;t understand. Why: <code>howToSetThis = foo.Foo{}</code> and not <code>howToSetThis = foo.Foo</code>"}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "reply_to_user": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "edited": false, "score": 0, "creation_date": 1491030648, "post_id": 43153229, "comment_id": 73384193, "body": "Because the struct must be allocated in the memory in order to call the function associated to it. <code>Foo{}</code> is equal to <code>new(Foo)</code>"}, {"owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "edited": false, "score": 0, "creation_date": 1494187819, "post_id": 43153229, "comment_id": 74708936, "body": "Hi @Alex, Any chance you can help with this related question? <a href=\"http://stackoverflow.com/questions/43755892/in-golang-how-to-deal-with-unknown-variables-or-how-to-deal-with-multiple-datab\" title=\"in golang how to deal with unknown variables or how to deal with multiple datab\">stackoverflow.com/questions/43755892/&hellip;</a> Thanks :-)"}], "tags": [], "owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "is_accepted": true, "score": 3, "last_activity_date": 1491030432, "last_edit_date": 1491030432, "creation_date": 1491024896, "answer_id": 43153229, "question_id": 43153133, "link": "https://stackoverflow.com/questions/43153133/how-to-assign-a-package-to-a-variable-in-go/43153229#43153229", "title": "How to assign a package to a variable in Go?", "body": "<p>You could define a interface in a package that requires the functions you want to have in those two packages .</p>\n\n<pre><code>package intfc\n\ntype Intfc interface {\n    Test()\n}\n</code></pre>\n\n<p>And then two structs in different packages which implements that interface</p>\n\n<pre><code>package foo\n\nimport \"fmt\"\n\ntype Foo struct {\n\n}\n\nfunc (f Foo) Test() {\n    fmt.Println(\"hola from foo\")\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>package baz\n\nimport \"fmt\"\n\ntype Baz struct {\n\n}\n\nfunc (f Baz) Test() {\n    fmt.Println(\"hola from baz\")\n}\n</code></pre>\n\n<p>And then in main do something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"foo\"\n    \"baz\"\n    \"intfc\"\n    \"flag\"\n)\n\nfunc main() {\n\n    var howToSetThis intfc.Intfc\n\n    thePackage := flag.String(\"package\", \"foo\", \"a package\")\n\n    if *thePackage == \"foo\" {\n        howToSetThis = foo.Foo{}\n    } else {\n        howToSetThis = baz.Baz{}\n    }\n\n    howToSetThis.Test() // execs Println from one of the two bar.go files\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "edited": false, "score": 0, "creation_date": 1491025483, "post_id": 43153271, "comment_id": 73383016, "body": "Thanks @believesInSanta, I see your point, but it is more that I would like to have this set to like in Cerise Lim&#243;n&#39;s answer. So that I later in the code always can call the same function."}], "tags": [], "owner": {"reputation": 2887, "user_id": 3068541, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/787075573/picture?type=large", "display_name": "JackyJohnson", "link": "https://stackoverflow.com/users/3068541/jackyjohnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1491025327, "creation_date": 1491025327, "answer_id": 43153271, "question_id": 43153133, "link": "https://stackoverflow.com/questions/43153133/how-to-assign-a-package-to-a-variable-in-go/43153271#43153271", "title": "How to assign a package to a variable in Go?", "body": "<p>At compile time <code>import</code> is practically if not the first directive to get parsed.  That means whatever package name is present in the import directive will be the one used as reference in parsing everything else.</p>\n\n<p>Hence you can't use a dynamic language structure like what you did in Javascript.  Cerise's answer is correct.</p>\n"}], "owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1077, "favorite_count": 2, "accepted_answer_id": 43153229, "answer_count": 2, "score": 1, "last_activity_date": 1491030432, "creation_date": 1491024084, "question_id": 43153133, "link": "https://stackoverflow.com/questions/43153133/how-to-assign-a-package-to-a-variable-in-go", "title": "How to assign a package to a variable in Go?", "body": "<p><em>First of all, the word \"variable\" might be wrong in the question but I assume the detailed question explains why I'm using the word \"variable\".</em></p>\n\n<p>I have two packages with different names but the exact same function(s).</p>\n\n<p>Depending on the input of the user I want to use the function of a package. But instead of switching over the packages I would like to assign the package to a new function with a generic name, how to do this? And if it's not possible, why?</p>\n\n<pre><code>// foo/bar.go\n\npackage foo\n\nfunc Test() {\n    fmt.Println(\"hola from bar\")\n}\n</code></pre>\n\n<hr>\n\n<pre><code>// baz/bar.go\n\npackage baz\n\nfunc Test() {\n    fmt.Println(\"hola from baz\")\n}\n</code></pre>\n\n<hr>\n\n<pre><code>// main.go\n\npackage main\n\nimport (\n    \"foo\"\n    \"baz\"\n)\n\nfunc main() {\n\n    thePackage := flag.String(\"package\", \"foo\", \"a package\")\n\n    if thePackage == \"foo\" {\n        howToSetThis := foo // How to do this?\n    } else {\n        howToSetThis := baz // How to do this?\n    }\n\n    howToSetThis.Test() // execs Println from one of the two bar.go files\n\n}\n</code></pre>\n\n<p>In JavaScript I would do something like (simplified):</p>\n\n<pre><code>function foo(){\n  console.log(\"hola from foo\")\n}\n\nfunction baz(){\n  console.log(\"hola from baz\")\n}\n\nif(somethingInput == \"foo\"){\n  var howToSetThis = foo;\n} else {\n  var howToSetThis = baz;\n}\n\nhowToSetThis();\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 103, "user_id": 7239851, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0e24becccd87d2573c6e8fc63b24baf3?s=128&d=identicon&r=PG&f=1", "display_name": "Innocentguy", "link": "https://stackoverflow.com/users/7239851/innocentguy"}, "edited": false, "score": 0, "creation_date": 1491024509, "post_id": 43152892, "comment_id": 73382819, "body": "This link helped me! Sorry for the dup question <a href=\"http://stackoverflow.com/questions/37757683/parsing-integer-from-exec-command-output\" title=\"parsing integer from exec command output\">stackoverflow.com/questions/37757683/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 2, "last_activity_date": 1615483843, "last_edit_date": 1615483843, "creation_date": 1491023862, "answer_id": 43153108, "question_id": 43152892, "link": "https://stackoverflow.com/questions/43152892/issue-with-parsing-go-command-output/43153108#43153108", "title": "Issue with parsing Go Command().Output()", "body": "<p>The output contains special characters. First, you need to strip any these characters (e.g. <code>\\n</code> or <code>\\r</code>).<br />\nYou can use <a href=\"https://golang.org/pkg/strings/#TrimSpace\" rel=\"nofollow noreferrer\"><code>strings.TrimSpace</code></a>.</p>\n<p>Then to parse a string as an <code>int64</code>, <a href=\"https://stackoverflow.com/a/29841190/6309\">you would use</a>:</p>\n<pre><code>if i, err := strconv.ParseInt(s, 10, 64); err == nil {\n    fmt.Printf(&quot;i=%d, type: %T\\n&quot;, i, i)\n}\n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 7239851, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0e24becccd87d2573c6e8fc63b24baf3?s=128&d=identicon&r=PG&f=1", "display_name": "Innocentguy", "link": "https://stackoverflow.com/users/7239851/innocentguy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 431, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1615483843, "creation_date": 1491021435, "question_id": 43152892, "link": "https://stackoverflow.com/questions/43152892/issue-with-parsing-go-command-output", "title": "Issue with parsing Go Command().Output()", "body": "<p>I am using a third party tool in Go with the help of exec.Command and that program will print out a large integer value which obviously is in string format. I having trouble converting that string to int (or more specifically uint64).</p>\n\n<p>Details: \n(You can ignore what program it is etc. but after running it will return me a large integer)</p>\n\n<pre><code>cmd := exec.Command(app, arg0, arg1, arg3)\nstdout, err := cmd.Output()\nif err != nil {\n    fmt.Println(err.Error())\n    return\n}\ntemp := string(stdout)\n</code></pre>\n\n<p>After I ran above, I am trying to parse it as below</p>\n\n<pre><code>myanswer, err = strconv.Atoi(temp)  //I know this is not for uint64 but I am first trying for int but I actually need uint64 conversion\nif err != nil {\n    fmt.Println(err)\n    return\n}\n</code></pre>\n\n<p>Problem here is that the stdout is appending \\r\\n to its output which AtoI is not able to parse and gives the error</p>\n\n<p>strconv.Atoi: parsing \"8101832828\\r\\n\": invalid syntax</p>\n\n<p>Can someone pls help me on how to convert this string output to a uint64 and also int format pls?</p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491020820, "post_id": 43152776, "comment_id": 73382158, "body": "It&#39;s not obvious what actually is not clear for you with this code. What do you expect to get and what you actually get?"}, {"owner": {"reputation": 1, "user_id": 3706965, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/VnzSS.jpg?s=128&g=1", "display_name": "Khalid Adisendjaja", "link": "https://stackoverflow.com/users/3706965/khalid-adisendjaja"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491021149, "post_id": 43152776, "comment_id": 73382218, "body": "Have u run the code? please check the runner function,  if u sent to channel c first and then b, u will have the right condition, this is what I don&#39;t understand, I hope someone would explain this channel behaviour"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491021237, "post_id": 43152776, "comment_id": 73382228, "body": "&quot;u will have the right condition&quot; --- that&#39;s the problem with the question: you have not explained what the &quot;right&quot; is, and what the &quot;wrong&quot; is. PS: please try to avoid using &quot;c&quot;, &quot;u&quot;, &quot;b&quot; and other shortenings."}, {"owner": {"reputation": 1, "user_id": 3706965, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/VnzSS.jpg?s=128&g=1", "display_name": "Khalid Adisendjaja", "link": "https://stackoverflow.com/users/3706965/khalid-adisendjaja"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1491022276, "post_id": 43152776, "comment_id": 73382401, "body": "thx @zerkms , kennytm just point it out right"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 3706965, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/VnzSS.jpg?s=128&g=1", "display_name": "Khalid Adisendjaja", "link": "https://stackoverflow.com/users/3706965/khalid-adisendjaja"}, "edited": false, "score": 0, "creation_date": 1491022035, "post_id": 43152837, "comment_id": 73382362, "body": "Ahhh I see now, no other routine read the channel <code>&lt;-b</code>, so then it will stuck forever on <code>b &lt;- bucket</code>, so then I made change on printer func for reading the b channel  <code>func printer(c chan []int, b chan []int) {      for {           select {           case msg := &lt;-c:                fmt.Println(msg)                &#47;&#47;time.Sleep(time.Second * 1)           case msg := &lt;-b:                fmt.Println(msg)           }      } }</code>"}, {"owner": {"reputation": 1, "user_id": 3706965, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/VnzSS.jpg?s=128&g=1", "display_name": "Khalid Adisendjaja", "link": "https://stackoverflow.com/users/3706965/khalid-adisendjaja"}, "edited": false, "score": 0, "creation_date": 1491022079, "post_id": 43152837, "comment_id": 73382372, "body": "Thank you very very very much"}, {"owner": {"reputation": 1, "user_id": 3706965, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/VnzSS.jpg?s=128&g=1", "display_name": "Khalid Adisendjaja", "link": "https://stackoverflow.com/users/3706965/khalid-adisendjaja"}, "edited": false, "score": 0, "creation_date": 1491022210, "post_id": 43152837, "comment_id": 73382391, "body": "the problem is no one read the last b channel so it will stuck or block"}], "tags": [], "owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "is_accepted": true, "score": 3, "last_activity_date": 1491020982, "creation_date": 1491020982, "answer_id": 43152837, "question_id": 43152776, "link": "https://stackoverflow.com/questions/43152776/is-it-one-channel-ops-affect-another-channel-ops/43152837#43152837", "title": "Is it one channel ops affect another channel ops", "body": "<pre><code>  bucket := make(chan []int)\n</code></pre>\n\n<p>Your <code>b</code> channel's capacity is 0. This means whenever you send something to this channel, the channel is full immediately and will block until a receiver reads the channel.</p>\n\n<p>When there is only one runner left, no one is going to call <code>bucket := &lt;-b</code> to read the last bucket, thus this last goroutine is stuck forever on the <code>b &lt;- bucket</code> line, and thus the next line <code>c &lt;- temp</code> will never be called for this last goroutine.</p>\n"}], "owner": {"reputation": 1, "user_id": 3706965, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/VnzSS.jpg?s=128&g=1", "display_name": "Khalid Adisendjaja", "link": "https://stackoverflow.com/users/3706965/khalid-adisendjaja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 43152837, "answer_count": 1, "score": -2, "last_activity_date": 1491020982, "creation_date": 1491020309, "question_id": 43152776, "link": "https://stackoverflow.com/questions/43152776/is-it-one-channel-ops-affect-another-channel-ops", "title": "Is it one channel ops affect another channel ops", "body": "<p>I made this simple code, trying to know how's channel works, somehow if channel c is sent after channel b is sent, channel in last routine is not being sent,</p>\n\n<p>I have 2 channel, channel c is for spliting channel b to 4 part of slice.</p>\n\n<pre><code> package main\n\n import (\n      \"fmt\"\n      \"strconv\"\n )\n\n func runner(idx int, c chan []int, b chan []int) {\n      var temp []int\n      fmt.Println(\"runner \" + strconv.Itoa(idx))\n      bucket := &lt;-b\n      for k, v := range bucket {\n           if v != 0 {\n                temp = append(temp, v)\n                bucket[k] = 0\n           }\n           if len(temp) == 5 {\n                break\n           }\n      }\n\n      //Strange condition if channel c is sent after channel b is sent,\n      //somehow the last chan is not being sent\n      b &lt;- bucket\n      c &lt;- temp\n\n      //this is right if channel b is sent after channel c is sent\n    //c &lt;- temp\n    //b &lt;- bucket\n\n }\n\n func printer(c chan []int) {\n      for {\n           select {\n           case msg := &lt;-c:\n                fmt.Println(msg)\n                //time.Sleep(time.Second * 1)\n           }\n      }\n }\n\n func main() {\n\n      c := make(chan []int, 5)\n      bucket := make(chan []int)\n\n      go runner(1, c, bucket)\n      go runner(2, c, bucket)\n      go runner(3, c, bucket)\n      go runner(4, c, bucket)\n\n      bucket &lt;- []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20}\n\n      go printer(c)\n\n      var input string\n      fmt.Scanln(&amp;input)\n\n }\n</code></pre>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491001208, "post_id": 43150775, "comment_id": 73378626, "body": "Your <code>ErrorHandler</code> is not an <code>http.Handler</code> it is a function that retuns a handler, and takes one as argument, that you can then pass to <code>ListenAndServe</code>. So this compiles <code>http.ListenAndServe(&quot;:8000&quot;, ErrorHandler(nil))</code>. Presumably you pass an actual handler value instead of <code>nil</code> to the <code>ErrorHandler</code> call or else <code>h.ServeHTTP</code> will eventually panic"}, {"owner": {"reputation": 2489, "user_id": 1923869, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zLRld.jpg?s=128&g=1", "display_name": "xhallix", "link": "https://stackoverflow.com/users/1923869/xhallix"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1491001509, "post_id": 43150775, "comment_id": 73378680, "body": "I see, I guess I need to think this over then:)"}], "answers": [{"comments": [{"owner": {"reputation": 2489, "user_id": 1923869, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zLRld.jpg?s=128&g=1", "display_name": "xhallix", "link": "https://stackoverflow.com/users/1923869/xhallix"}, "edited": false, "score": 0, "creation_date": 1491003345, "post_id": 43151024, "comment_id": 73379101, "body": "thanks. that looks promising. I just gave it a quick shot and will look at this in depth later on. As far as I could see, this will handle all requests, not just the error one, correct?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 2489, "user_id": 1923869, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zLRld.jpg?s=128&g=1", "display_name": "xhallix", "link": "https://stackoverflow.com/users/1923869/xhallix"}, "edited": false, "score": 0, "creation_date": 1491003578, "post_id": 43151024, "comment_id": 73379149, "body": "Well since you&#39;re passing it to <code>ListenAndServe</code> that is correct. What you usually want to do is to instantiate a <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\">mux</a> register your handlers by path patterns and then pass the mux to <code>ListenAndServe</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 2489, "user_id": 1923869, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zLRld.jpg?s=128&g=1", "display_name": "xhallix", "link": "https://stackoverflow.com/users/1923869/xhallix"}, "edited": false, "score": 0, "creation_date": 1491003863, "post_id": 43151024, "comment_id": 73379226, "body": "@xhallix quick example of what that would look like <a href=\"https://play.golang.org/p/htxoXo7f8U\" rel=\"nofollow noreferrer\">play.golang.org/p/htxoXo7f8U</a>"}, {"owner": {"reputation": 2489, "user_id": 1923869, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zLRld.jpg?s=128&g=1", "display_name": "xhallix", "link": "https://stackoverflow.com/users/1923869/xhallix"}, "edited": false, "score": 0, "creation_date": 1491035554, "post_id": 43151024, "comment_id": 73385207, "body": "thank you, your help did the trick  <a href=\"https://github.com/xhallix/go-router/blob/master/router.go#L22\" rel=\"nofollow noreferrer\">github.com/xhallix/go-router/blob/master/router.go#L22</a>"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 4, "last_activity_date": 1491002910, "creation_date": 1491002910, "answer_id": 43151024, "question_id": 43150775, "link": "https://stackoverflow.com/questions/43150775/golang-custom-handler-for-server/43151024#43151024", "title": "Golang custom handler for server", "body": "<p>Your <code>ErrorHandler(h http.Handler) http.Handler</code> func is basically just \"middleware\" and not a real handler. It takes a handler <code>h</code> and returns a new handler. <a href=\"https://github.com/golang/go/blob/f1e880386b668a26dd6b7afdea43c9041a917fa5/src/net/http/server.go#L1965-L1986\" rel=\"nofollow noreferrer\">http.StripPrefix</a> is an example of such \"middleware\".</p>\n\n<p>If you don't want middleware, but just a handler then you need to define your function a little differently:</p>\n\n<pre><code>func ErrorHandler(w http.ResponseWriter, r *http.Request) {\n    // do stuff with r and w\n}\n</code></pre>\n\n<p>Now you can pass your <code>ErrorHandler</code> to <code>ListenAndServe</code> although you still need to cast it to the proper <code>http.Handler</code> type like so:</p>\n\n<pre><code>http.ListenAndServe(\":8000\", http.HandlerFunc(ErrorHandler))\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"nofollow noreferrer\">http.HandlerFunc</a> is an adapter that turns a function, if it has the right signature, into an <code>http.Handler</code>.</p>\n\n<p>Finally, if you don't like the casting, you'll need to define a type instead of a just a function and you'll need to define a method on that type that is required for it to satisfy the <code>http.Handler</code> interface type.</p>\n\n<pre><code>type ErrorHandler struct{}\n\nfunc (h *ErrorHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    // do stuff with r and w\n}\n\nhttp.ListenAndServe(\":8080\", &amp;ErrorHandler{})\n</code></pre>\n\n<p>Read more about it here <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Handler</a></p>\n"}], "owner": {"reputation": 2489, "user_id": 1923869, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zLRld.jpg?s=128&g=1", "display_name": "xhallix", "link": "https://stackoverflow.com/users/1923869/xhallix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4360, "favorite_count": 0, "accepted_answer_id": 43151024, "answer_count": 1, "score": 0, "last_activity_date": 1491002910, "creation_date": 1491000873, "question_id": 43150775, "link": "https://stackoverflow.com/questions/43150775/golang-custom-handler-for-server", "title": "Golang custom handler for server", "body": "<p>I want to use a custom method on <code>http.ListenAndServe</code></p>\n\n<p>Here is what I have </p>\n\n<pre><code>http.ListenAndServe(\":8000\", ErrorHandler)\n\nfunc ErrorHandler(h http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        h.ServeHTTP(w, r)\n    })\n}\n</code></pre>\n\n<p>Error</p>\n\n<pre><code>cannot use ErrorHandler (type func(http.Handler) http.Handler) as type http.Handler in argument to http.ListenAndServe:\n        func(http.Handler) http.Handler does not implement http.Handler (missing ServeHTTP method)\n</code></pre>\n\n<p>How can I add a custom method to <code>ListenAndServe</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 4, "creation_date": 1490988426, "post_id": 43148238, "comment_id": 73373908, "body": "Might be just me, but if you have millions of stuff in one package, it&#39;s time to refactor."}, {"owner": {"reputation": 412, "user_id": 6498438, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/OFuAw.png?s=128&g=1", "display_name": "trashgenerator", "link": "https://stackoverflow.com/users/6498438/trashgenerator"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1490989149, "post_id": 43148238, "comment_id": 73374250, "body": "Man it&#39;s just an example. But if I had 10 - it&#39;s not so bad. But each of those ten has some big alogirithm for 500 strings"}], "answers": [{"comments": [{"owner": {"reputation": 412, "user_id": 6498438, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/OFuAw.png?s=128&g=1", "display_name": "trashgenerator", "link": "https://stackoverflow.com/users/6498438/trashgenerator"}, "edited": false, "score": 0, "creation_date": 1490989206, "post_id": 43148312, "comment_id": 73374278, "body": "Thanks man. I don&#39;t know about &quot;the compiler generally only includes in the compiled binary functions and types actually reference&quot; you told."}, {"owner": {"reputation": 5609, "user_id": 1226748, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/RfDKy.jpg?s=128&g=1", "display_name": "Jimmy Obonyo Abor", "link": "https://stackoverflow.com/users/1226748/jimmy-obonyo-abor"}, "edited": false, "score": 0, "creation_date": 1490990364, "post_id": 43148312, "comment_id": 73416696, "body": "Just to add to @kaedys , suppose you want to break your package/application to several files for readability purposes eg one file file-operations.go holding all structs , types related to file operations , server.go handling servers , main.go holding the main function , just put all file s in the package directory and name them your package name , go will compile all automatically ."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1490992336, "post_id": 43148312, "comment_id": 73375738, "body": "I&#39;m not sure about the compiler optimization given - it seems to include everything in each referenced package. I don&#39;t think it culls at any finer granularity than that. I haven&#39;t read the compiler/linker source, it&#39;s just the impression I&#39;ve gotten from usage."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1490998067, "post_id": 43148312, "comment_id": 73416697, "body": "Just to add to this general packaging advice. Be sure you don&#39;t introduce circular dependencies. e.g. you can <code>import &quot;myapp&#47;pack&quot;</code> from <code>myapp</code> and vice versa, but NOT BOTH ways at the same time."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1490999606, "post_id": 43148312, "comment_id": 73416698, "body": "Or any other way that would create a loop, such as <code>a -&gt; b -&gt; c -&gt; a</code>."}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 12, "last_activity_date": 1490988503, "creation_date": 1490988503, "answer_id": 43148312, "question_id": 43148238, "link": "https://stackoverflow.com/questions/43148238/golang-import-only-one-file-from-package/43148312#43148312", "title": "Golang. Import only one file from package", "body": "<p>No, in Go you import packages, not files.  However, the compiler generally only includes in the compiled binary functions and types actually referenced, so even if you include a <em>massive</em> package in your import (which is discouraged anyway), they'll not usually be included in the final binary unless needed.</p>\n\n<p>And as RayfenWindspear pointed out, if a package is large enough that you want to only import a file or two, that's probably a pretty good smell test that you need to refactor that package.</p>\n"}, {"tags": [], "owner": {"reputation": 1069, "user_id": 1287536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bdf040ab9024de588b911d0e6365612?s=128&d=identicon&r=PG", "display_name": "lee8oi", "link": "https://stackoverflow.com/users/1287536/lee8oi"}, "is_accepted": false, "score": 1, "last_activity_date": 1491021246, "creation_date": 1491021246, "answer_id": 43152874, "question_id": 43148238, "link": "https://stackoverflow.com/questions/43148238/golang-import-only-one-file-from-package/43152874#43152874", "title": "Golang. Import only one file from package", "body": "<p>I realize this question is largely already answered. But here are my thoughts anyways.</p>\n\n<p>If the specific files can work independently from the rest of the package or do so with some minor modifications you can just simply copy those files to the project you want to use them in. Then reference the functions/methods/etc directly. But if you are using parts of a big package in various projects it would definitely be more suitable to break it into smaller packages. Then you can use those parts independently in as many projects as you wish without the excess baggage.</p>\n"}], "owner": {"reputation": 412, "user_id": 6498438, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/OFuAw.png?s=128&g=1", "display_name": "trashgenerator", "link": "https://stackoverflow.com/users/6498438/trashgenerator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3421, "favorite_count": 0, "accepted_answer_id": 43148312, "answer_count": 2, "score": 5, "last_activity_date": 1491021246, "creation_date": 1490988224, "question_id": 43148238, "link": "https://stackoverflow.com/questions/43148238/golang-import-only-one-file-from-package", "title": "Golang. Import only one file from package", "body": "<p>Hi all. I am new in GO and need some help. I've got a project with this structure</p>\n\n<p><a href=\"https://i.stack.imgur.com/OVpzT.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/OVpzT.png\" alt=\"GO Project structure\"></a></p>\n\n<p>But let's pretend that I have 100500 items in my <strong>logic package</strong>. What if I need import only one or two files for the specific package. Can I do it or I only can import a full package?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3870, "user_id": 1769777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/06763dd36a45c8966c7171ba3697847d?s=128&d=identicon&r=PG", "display_name": "Adam", "link": "https://stackoverflow.com/users/1769777/adam"}, "edited": false, "score": 1, "creation_date": 1490987364, "post_id": 43147973, "comment_id": 73373381, "body": "This answer might provide some insight <a href=\"http://stackoverflow.com/questions/21251242/is-it-possible-to-call-overridden-method-from-parent-struct-in-golang\" title=\"is it possible to call overridden method from parent struct in golang\">stackoverflow.com/questions/21251242/&hellip;</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1490988158, "post_id": 43147973, "comment_id": 73373785, "body": "<a href=\"https://play.golang.org/p/Lp3aP2dqpt\" rel=\"nofollow noreferrer\">play.golang.org/p/Lp3aP2dqpt</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1490990094, "post_id": 43147973, "comment_id": 73374716, "body": "@mkopriva &#39;s particular way of doing this is probably more preferred than mine. But then again, it still contains the issue of being able to access the internal struct data members. But at least the Method itself is a real method."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1490988574, "post_id": 43148207, "comment_id": 73373975, "body": "This is not a method though, therefor it is not part of the method set."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1490988752, "post_id": 43148207, "comment_id": 73374058, "body": "@JimB True, but this is an alternative way to do what is desired. If modifying methods is really what is wanted, I don&#39;t think it can be done."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1490989216, "post_id": 43148207, "comment_id": 73374288, "body": "Actually, no, you are right, this is not ideal because you cannot access the struct values this way. You could define the function var to accept the struct pointer though <code>PrintHello func(ms *MyStruct)</code>. Answer edited to account for this."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1490991493, "post_id": 43148207, "comment_id": 73375374, "body": "You can definitely use plug-and-play methods using the same strategy: <a href=\"https://play.golang.org/p/s7xmU33dXY\" rel=\"nofollow noreferrer\">play.golang.org/p/s7xmU33dXY</a>.  Downside is the ad hoc methods cannot access the fields of the structure in question unless the structure is passed as an argument to the functions, which is annoying but not a game-breaker: <a href=\"https://play.golang.org/p/luLt8bVq80\" rel=\"nofollow noreferrer\">play.golang.org/p/luLt8bVq80</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1490995365, "post_id": 43148207, "comment_id": 73376963, "body": "Looking forward, there also another problem with doing this beyond package boundaries if the struct fields are not exported. Testing this I got <code>ms.id undefined (cannot refer to unexported field or method id)</code>"}, {"owner": {"reputation": 2530, "user_id": 1153227, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/073b4ec28e5d044afae98d52a980fd8b?s=128&d=identicon&r=PG", "display_name": "Omn", "link": "https://stackoverflow.com/users/1153227/omn"}, "edited": false, "score": 0, "creation_date": 1519779368, "post_id": 43148207, "comment_id": 85045914, "body": "this solution also won&#39;t allow to wrap MyStruct&#39;s functionality inside an interface, which limits the usability of this approach"}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 10, "last_activity_date": 1491255448, "last_edit_date": 1491255448, "creation_date": 1490988073, "answer_id": 43148207, "question_id": 43147973, "link": "https://stackoverflow.com/questions/43147973/how-to-assign-a-method-to-an-existing-struct-object/43148207#43148207", "title": "How to assign a method to an existing struct object", "body": "<p>Given that Go is a statically typed language, you cannot do this specific piece of code. However, functions are variables, so you CAN do something like this. Just remember that this is technically NOT the same as assigning a new method, as JimB states in the comments.</p>\n\n<p><a href=\"https://play.golang.org/p/rfuCzXD8fP\" rel=\"noreferrer\">https://play.golang.org/p/rfuCzXD8fP</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype MyStruct struct {\n    id         int\n    PrintHello func(ms * MyStruct)\n}\n\nfunc (ms *MyStruct) init() {\n    ms.PrintHello = func(ms *MyStruct) { fmt.Printf(\"Hello from original method %v\\n\", ms.id) }\n}\n\nfunc main() {\n    m := &amp;MyStruct{id: 42}\n    m.init()\n    m.PrintHello(m)\n\n    m.PrintHello = func(ms *MyStruct) { fmt.Printf(\"Hello from newer method 2 %d\\n\", ms.id) }\n    m.PrintHello(m)\n}\n</code></pre>\n\n<p>Because this function is not really a method, you can only access the internal struct values by passing it as an argument. This means that if this ever has to cross package boundaries, unexported values will not be available.</p>\n\n<p>It is also important to note that the function type needs to be the same. So if you defined the function as <code>PrintHello func(ms * MyStruct) error</code> in the struct, you would need to assign a function that returns an error.</p>\n"}], "owner": {"reputation": 365, "user_id": 6343341, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2cfad4d968ba2edc5b151b66965e9fae?s=128&d=identicon&r=PG&f=1", "display_name": "ultimoo", "link": "https://stackoverflow.com/users/6343341/ultimoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11163, "favorite_count": 2, "accepted_answer_id": 43148207, "answer_count": 1, "score": 3, "last_activity_date": 1577102062, "creation_date": 1490987259, "last_edit_date": 1577102062, "question_id": 43147973, "link": "https://stackoverflow.com/questions/43147973/how-to-assign-a-method-to-an-existing-struct-object", "title": "How to assign a method to an existing struct object", "body": "<p>I was wondering if doing something like this in Go is even possible.</p>\n\n<pre><code>type MyStruct struct {\n    id int\n}\n\nfunc (ms *MyStruct) PrintHello() {\n    fmt.Printf(\"Hello from original method %v\", ms.id)\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    m := MyStruct{}\n    m.PrintHello()\n\n    m.PrintHello = func() {fmt.Printf(\"Hello from newer method 2\")}\n}\n\nError: cannot assign to m.PrintHello\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/2oJQFFH4O5\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2oJQFFH4O5</a></p>\n\n<p>Sorry if this doesn't make sense for Go programmers, I am new to Go and wondering if some of the things that can be done in dynamically typed languages can be done in Go.</p>\n"}, {"tags": ["http", "go"], "answers": [{"comments": [{"owner": {"reputation": 572, "user_id": 1451794, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f682ac306d65d34f0450df5710ba3314?s=128&d=identicon&r=PG", "display_name": "Dumitru", "link": "https://stackoverflow.com/users/1451794/dumitru"}, "edited": false, "score": 0, "creation_date": 1490975432, "post_id": 43144651, "comment_id": 73366924, "body": "I would have loved to avoid string building if possible. In your example I have to concatenate the host header with the path and add the scheme too."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 572, "user_id": 1451794, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f682ac306d65d34f0450df5710ba3314?s=128&d=identicon&r=PG", "display_name": "Dumitru", "link": "https://stackoverflow.com/users/1451794/dumitru"}, "edited": false, "score": 0, "creation_date": 1490975519, "post_id": 43144651, "comment_id": 73366986, "body": "The <code>url</code> package may help you with that. It can do the URL encoding/concatenation for you. Whether that&#39;s easier or not may depend on how you receive the query params."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 4, "last_activity_date": 1490975836, "last_edit_date": 1490975836, "creation_date": 1490974800, "answer_id": 43144651, "question_id": 43144508, "link": "https://stackoverflow.com/questions/43144508/build-http-request-based-on-constituent-parts/43144651#43144651", "title": "Build HTTP request based on constituent parts", "body": "<p>There's really only one way to create an <code>http.Request</code>, and that is with <a href=\"https://golang.org/pkg/net/http/#NewRequest\" rel=\"nofollow noreferrer\"><code>http.NewRequest</code></a>.  And it already takes three of your constituent parts as arguments: Method, path, and body.</p>\n\n<p>You'll need to assemble your query params into the URL before calling <code>NewRequest</code>. The <a href=\"https://golang.org/pkg/net/url\" rel=\"nofollow noreferrer\">url</a> package, and in particular, <a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"nofollow noreferrer\">url.Values</a> may be of assistance with this.</p>\n\n<p>Once you have the new request, you can add headers as you would expect:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", \"http://example.com/?foo=bar\", body)\nreq.Header.Add(\"Content-Type\", \"application/json\")\n</code></pre>\n\n<p>And in case it needs stating, the body must be an <code>io.Reader</code>, but that gives you complete flexibility.</p>\n"}], "owner": {"reputation": 572, "user_id": 1451794, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f682ac306d65d34f0450df5710ba3314?s=128&d=identicon&r=PG", "display_name": "Dumitru", "link": "https://stackoverflow.com/users/1451794/dumitru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1490975836, "creation_date": 1490974319, "question_id": 43144508, "link": "https://stackoverflow.com/questions/43144508/build-http-request-based-on-constituent-parts", "title": "Build HTTP request based on constituent parts", "body": "<p>Say I have a representation of an HTTP request broken down to parts like so: method, URI, query params, headers, body.</p>\n\n<p>So I might have something like:</p>\n\n<pre><code>Method: POST\nHeaders: [Content-Type: application/json, Host: localhost:8080, etc...]\nPath: /home/sweet\nQuery: name=dan&amp;id=1\nBody: \"some JSON here\"\n</code></pre>\n\n<p>How can I rebuild this into a valid net/http Request object? I would like to avoid string formatting and building as much as possible.</p>\n"}, {"tags": ["go", "google-bigquery"], "owner": {"reputation": 33, "user_id": 6449790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e53ff69dd29612f3618b58a650cf13d?s=128&d=identicon&r=PG&f=1", "display_name": "Mat Evans", "link": "https://stackoverflow.com/users/6449790/mat-evans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 703, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1490973810, "creation_date": 1490972358, "last_edit_date": 1490973810, "question_id": 43143801, "link": "https://stackoverflow.com/questions/43143801/seeing-a-lot-of-stream-error-stream-id-1221-protocol-error-since-23rd-march", "title": "Seeing a lot of &quot;stream error: stream ID 1221; PROTOCOL_ERROR&quot; since 23rd March from a single Linode DC", "body": "<p>We've had a lot of these errors from only one of our DCs - running the same code as others globally. </p>\n\n<p>For example:</p>\n\n<blockquote>\n  <p>2017/03/31 13:22:03 Error sending request to BigQuery (attempt 1 of 3): Post <a href=\"https://www.googleapis.com/bigquery/v2/projects/coull-delta/datasets/demand/tables/table_name/insertAll?alt=json\" rel=\"nofollow noreferrer\">https://www.googleapis.com/bigquery/v2/projects/coull-delta/datasets/demand/tables/table_name/insertAll?alt=json</a>: stream error: stream ID 1221; PROTOCOL_ERROR</p>\n</blockquote>\n\n<p>It uses the Big Query Go package from google - <a href=\"https://godoc.org/google.golang.org/api\" rel=\"nofollow noreferrer\">https://godoc.org/google.golang.org/api</a></p>\n\n<p>Anyone got any ideas? Seen this before? As I said, exactly the same code running in other places with no issue.</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1490972381, "post_id": 43143632, "comment_id": 73364956, "body": "Why not just have 10 goroutines and have them process strings as fast as they can?"}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1490985975, "post_id": 43145292, "comment_id": 73372662, "body": "Slices are, however, thread safe if they are used read only. His question specifically states he is reading this slice and writing to a different one. As long as the results are separate slices that are combined at the end, reading from the input is OK to do concurrently."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 2, "creation_date": 1490991609, "post_id": 43145292, "comment_id": 73375414, "body": "Ya, use a fan-in to collect the results so only a single goroutine is writing to the destination slice.  Avoids the need for a mutex."}, {"owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1490991739, "post_id": 43145292, "comment_id": 73375459, "body": "Thanks @Kaedys. I&#39;ve also added your comment to make it clear."}], "tags": [], "owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "is_accepted": true, "score": 3, "last_activity_date": 1490991686, "last_edit_date": 1490991686, "creation_date": 1490976910, "answer_id": 43145292, "question_id": 43143632, "link": "https://stackoverflow.com/questions/43143632/how-to-separate-array-processing-into-goroutines/43145292#43145292", "title": "How to separate array processing into goroutines?", "body": "<p>Using a channel, read the elements from the slice, use a Fan out to distribute load and pass messages. Then, process the strings in goroutines and collect the results back (fan in ) in a single goroutine to avoid mutexes.</p>\n\n<p>You may want to set the number of Max concurrent concurrent goroutines.</p>\n\n<p>Keep in mind that slices are not thread safe when writing to them.</p>\n\n<p>Useful info:</p>\n\n<blockquote>\n  <p><a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">https://blog.golang.org/pipelines</a>\n  <a href=\"https://talks.golang.org/2012/concurrency.slide#1\" rel=\"nofollow noreferrer\">https://talks.golang.org/2012/concurrency.slide#1</a>\n  <a href=\"https://blog.golang.org/advanced-go-concurrency-patterns\" rel=\"nofollow noreferrer\">https://blog.golang.org/advanced-go-concurrency-patterns</a>\n  <a href=\"https://talks.golang.org/2013/advconc.slide#1\" rel=\"nofollow noreferrer\">https://talks.golang.org/2013/advconc.slide#1</a></p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1490991722, "post_id": 43147903, "comment_id": 73375453, "body": "Seems like it would be easier to just subslice the input list into <code>w</code> subslices and process each, instead of mucking with a goroutine.  Or use a fan-out input channel in addition to a fan-in output channel."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1490992833, "post_id": 43147903, "comment_id": 73375944, "body": "I agree didnt think of it"}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 0, "last_activity_date": 1491018291, "last_edit_date": 1491018291, "creation_date": 1490986965, "answer_id": 43147903, "question_id": 43143632, "link": "https://stackoverflow.com/questions/43143632/how-to-separate-array-processing-into-goroutines/43147903#43147903", "title": "How to separate array processing into goroutines?", "body": "<p>I agree with @JimB in that why limit the go routines.  However since that's your inquiry I'd maybe so something like this.. If you really want to have each gorountine do 3000 items, then it might be easier to create a 2d slice. [[3000 items],[3000 items],..] then have 1 go routine process per index in that 2d array. Otherwise below just limits the gorountines to 10.\n<strong>METHOD 1</strong>\n    package main</p>\n\n<pre><code>import (\n    \"crypto/rand\"\n    \"fmt\"\n    \"log\"\n    \"sync\"\n    \"time\"\n)\n\nvar s []string\n\n// genetate some mock data\nfunc init() {\n    s = make([]string, 30000)\n    n := 5\n    for i := 0; i &lt; 30000; i++ {\n        b := make([]byte, n)\n        if _, err := rand.Read(b); err != nil {\n            panic(err)\n        }\n        s[i] = fmt.Sprintf(\"%X\", b)\n    }\n}\n\nfunc main() {\n    // set the number of workers\n    ch := make(chan string)\n    var mut sync.Mutex\n    counter := 0\n\n    // limit the number of gorountines to 10\n    for w := 0; w &lt; 10; w++ {\n        go func(ch chan string, mut *sync.Mutex) {\n            for {\n                // get and update counter using mux to stop race condtions\n                mut.Lock()\n                i := counter\n                counter++\n                mut.Unlock()\n                // break the loop\n                if counter &gt; len(s) {\n                    return\n                }\n                // get string\n                myString := s[i]\n                // to some work then pass to channel\n                ch &lt;- myString\n\n            }\n        }(ch, &amp;mut)\n    }\n    // adding time.  If you play wiht the number of gorountines youll see how changing the number above can efficiency \n    t := time.Now()\n    for i := 0; i &lt; len(s); i++ {\n        result := &lt;-ch\n        log.Println(time.Since(t), result, i)\n    }\n}\n</code></pre>\n\n<p><strong>METHOD2</strong> the init function is creating a 2d array chunked out into 10 arrays each containing 3000 elements.. if you parse your data that way the logic below that needs very little modification to work</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/rand\"\n    \"fmt\"\n    \"log\"\n    \"sync\"\n)\n\nvar chunkedSlice [10][3000]string\n\n// genetate some mock data\n// 2d array, each chunk has 3000 items in it\n// there are 10 chunks, 1 go rountine per chunk\nfunc init() {\n    n := 5\n    for i := 0; i &lt; 10; i++ {\n        for j := 0; j &lt; 3000; j++ {\n            b := make([]byte, n)\n            if _, err := rand.Read(b); err != nil {\n                panic(err)\n            }\n            chunkedSlice[i][j] = fmt.Sprintf(\"%X\", b)\n        }\n    }\n}\n\nfunc main() {\n    // channel to send parsed data to\n\n    ch := make(chan string)\n    var wg sync.WaitGroup\n\n    // 10 chunks\n    for _, chunk := range chunkedSlice {\n        wg.Add(1)\n        // if defining the 2d array e.g [10][3000]string, you need to pass it as a pointer to avoid stack error\n        go func(ch chan string, wg *sync.WaitGroup, chunk *[3000]string) {\n            defer wg.Done()\n            for i := 0; i &lt; len(chunk); i++ {\n                str := chunk[i]\n                // fmt.Println(str)\n                // parse the data (emulating)\n                parsedData := str\n                // send parsed data to the channel\n                ch &lt;- parsedData\n            }\n        }(ch, &amp;wg, &amp;chunk)\n    }\n    // wait for all the routines to finish and close the channel\n    go func() {\n        wg.Wait()\n        close(ch)\n    }()\n\n    var counter int // adding to check that the right number of items was parsed\n    // get the data from the channel\n    for res := range ch {\n        log.Println(res, counter)\n        counter++\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 2586038, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000709427555/picture?type=large", "display_name": "Yuriy Nazarenko", "link": "https://stackoverflow.com/users/2586038/yuriy-nazarenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1618807261, "last_edit_date": 1618807261, "creation_date": 1618735682, "answer_id": 67146702, "question_id": 43143632, "link": "https://stackoverflow.com/questions/43143632/how-to-separate-array-processing-into-goroutines/67146702#67146702", "title": "How to separate array processing into goroutines?", "body": "<p>I have developed a library <a href=\"https://github.com/nazar256/parapipe\" rel=\"nofollow noreferrer\">parapipe</a> to solve such task. Just slice your slice into 10 parts and send them to Pipeline, which will process them concurrently:</p>\n<pre><code>import &quot;github.com/nazar256/parapipe&quot;\n//...\nvar longStringSlice []string\n// ...\npipeline := parapipe.NewPipeline(10).\n    Pipe(func(msg interface{}) interface{} {\n    slicePart := msg.([]string)\n    // process here to result\n    return result\n})\n// chop the slice and stream parts\nchopSize := int(math.Ceil(float64(len(longStringSlice)) / 10))\nfor i:=0;i&lt;10;i++ {\n    firstIdx := i * chopSize\n    lastIdx := (i+1) * chopSize\n    if lastIdx &gt; len(longStringSlice) {\n        lastIdx = len(longStringSlice)\n    }\n    pipeline.In() &lt;- longStringSlice[firstIdx:lastIdx]\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 15598936, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kw2LQ.png?s=128&g=1", "display_name": "Yep", "link": "https://stackoverflow.com/users/15598936/yep"}, "is_accepted": false, "score": 0, "last_activity_date": 1618740934, "creation_date": 1618740934, "answer_id": 67147422, "question_id": 43143632, "link": "https://stackoverflow.com/questions/43143632/how-to-separate-array-processing-into-goroutines/67147422#67147422", "title": "How to separate array processing into goroutines?", "body": "<p>There is no problem handling different memory addresses in different goroutines. If your read and write actions do not overshadow the chunks, that you can simply work with ranges in massif.\n<a href=\"https://play.golang.org/p/MU5njoNmIf7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MU5njoNmIf7</a></p>\n"}], "owner": {"reputation": 42794, "user_id": 135829, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/zfWZK.jpg?s=128&g=1", "display_name": "Sergei Basharov", "link": "https://stackoverflow.com/users/135829/sergei-basharov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3782, "favorite_count": 1, "accepted_answer_id": 43145292, "answer_count": 4, "score": 6, "last_activity_date": 1618807261, "creation_date": 1490971848, "question_id": 43143632, "link": "https://stackoverflow.com/questions/43143632/how-to-separate-array-processing-into-goroutines", "title": "How to separate array processing into goroutines?", "body": "<p>I have a slice of 30'000 strings. How do I separate processing this slice into, say, 10 goroutines that would take 3000 strings from the slice, extract some data from them and push into a new slice?</p>\n\n<p>So, in the end, I will have 10 slices with 3000 processed results in each. What's the pattern to handle this problem?</p>\n\n<p>I have had a look at <a href=\"http://divan.github.io/posts/go_concurrency_visualize/\" rel=\"noreferrer\">this article</a>, but not sure which of these patterns applies to my case.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1490967662, "post_id": 43142080, "comment_id": 73361534, "body": "That error is because you haven&#39;t imported a sql driver. Did you intend to use &quot;github.com/lib/pq&quot;, or is &quot;github.com/demas/cowl-go/pkg/postgres&quot; supposed to be a driver?"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1490967855, "post_id": 43142080, "comment_id": 73361677, "body": "I have added <code>_ &quot;github.com&#47;lib&#47;pq&quot;</code> but the error remains."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1490969742, "post_id": 43142080, "comment_id": 73362969, "body": "Does any one of those dependencies maybe attempt to open a connection, without first importing <code>_ &quot;github.com&#47;lib&#47;pq&quot;</code>? Inside an <code>init</code> func or a func call setting a global <code>var</code>?"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1490969844, "post_id": 43142080, "comment_id": 73363062, "body": "@mkopriva, thanks - it helps me. but why it worked fine from root of the project ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1490971303, "post_id": 43142080, "comment_id": 73364198, "body": "@demas that&#39;s hard for me to tell without knowing the contents of the root folder at the time when it was working :)"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1490971360, "post_id": 43142080, "comment_id": 73364234, "body": "@mkopriva, thank you. can you create an answer to the question ?"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 4, "last_activity_date": 1490975038, "creation_date": 1490975038, "answer_id": 43144718, "question_id": 43142080, "link": "https://stackoverflow.com/questions/43142080/can-not-run-tests-from-non-root-folder/43144718#43144718", "title": "Can not run tests from non-root folder", "body": "<p>As already mentioned by @JimB in the comments, the error means that you're trying to open a db connection, using <code>sqlx.Open</code>, without first importing a db driver. This can be fixed by, in your case, adding this <code>_ \"github.com/lib/pq\"</code> import spec.</p>\n\n<p>If, even after adding that import, you're still seeing the same error, then that means that one of your dependencies is also trying to open a db connection without first importing the necessary driver.</p>\n\n<p>Please note that while <code>log.Fatal</code> is a nice and clean way to stop your program it can sometimes be lacking, as you already know. You might want to consider using <code>panic</code> instead, its output is much more chaotic but, on the other hand, you'll get the line number and file name that caused the panic and eventually you'll learn to parse it quickly.</p>\n"}], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 43144718, "answer_count": 1, "score": 0, "last_activity_date": 1490975038, "creation_date": 1490967277, "last_edit_date": 1490967831, "question_id": 43142080, "link": "https://stackoverflow.com/questions/43142080/can-not-run-tests-from-non-root-folder", "title": "Can not run tests from non-root folder", "body": "<p>I have a tests which looks like:</p>\n\n<pre><code>package tst\n\nimport (\n    \"testing\"\n    \"github.com/demas/cowl-go/pkg/postgres\"\n    \"log\"\n    \"os\"\n    \"fmt\"\n    \"github.com/jmoiron/sqlx\"\n    \"github.com/demas/cowl-go/pkg/quzx-crawler\"\n    \"github.com/SlyMarbo/rss\"\n    \"time\"\n    _ \"github.com/lib/pq\"\n)\n\nfunc TestMain(m *testing.M) {\n\n    prepare()\n    retCode := m.Run()\n    os.Exit(retCode)\n}\n\nfunc prepare() {\n    connectionString := fmt.Sprintf(\"user=%s password=%s host=%s port=%s dbname=%s sslmode=disable\",\n        os.Getenv(\"DBUSER\"),\n        os.Getenv(\"DBPASS\"),\n        os.Getenv(\"DBHOST\"),\n        os.Getenv(\"DBPORT\"),\n        os.Getenv(\"DBNAME\"))\n\n    db, err := sqlx.Open(\"postgres\", connectionString)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    db.Exec(`DELETE FROM Settings`)\n    db.Exec(`DELETE FROM HackerNews`)\n    // ....\n}\n</code></pre>\n\n<p>Tests works fine if I keep in the root project folder, but if I move them to <code>tst</code> folder I get error message:</p>\n\n<pre><code>D:\\development\\gopath\\src\\github.com\\demas\\cowl-go\\tst&gt;go test -v\n2017/03/31 16:30:06 sql: unknown driver \"postgres\" (forgotten import?)\nexit status 1\nFAIL    github.com/demas/cowl-go/tst    0.085s\n</code></pre>\n\n<p>Why ?</p>\n"}, {"tags": ["go", "thread-safety"], "answers": [{"comments": [{"owner": {"reputation": 1749, "user_id": 3243380, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrCc3.jpg?s=128&g=1", "display_name": "nussjustin", "link": "https://stackoverflow.com/users/3243380/nussjustin"}, "edited": false, "score": 0, "creation_date": 1490964215, "post_id": 43140308, "comment_id": 73358978, "body": "The documentation is a bit misleading here as there is still a possible race condition when the writers are not comparable. The documentation should probably be updated to be more clear on when exactly Stdout and Stderr are considered &quot;the same&quot;. I filled <a href=\"https://golang.org/issue/19804\" rel=\"nofollow noreferrer\">golang.org/issue/19804</a> for this"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1490962443, "last_edit_date": 1490962443, "creation_date": 1490962129, "answer_id": 43140308, "question_id": 43138596, "link": "https://stackoverflow.com/questions/43138596/why-doesnt-os-exec-combinedoutput-have-a-race-condition/43140308#43140308", "title": "Why doesn&#39;t os/exec.CombinedOutput() have a race condition?", "body": "<p>Stderr and Stdout are not written concurrently if they are the same writer as stated in the <a href=\"https://godoc.org/os/exec#Cmd.Stdout\" rel=\"nofollow noreferrer\">Cmd documentation</a>:</p>\n\n<blockquote>\n  <p>If Stdout and Stderr are the same writer, at most one goroutine at a time will call Write.</p>\n</blockquote>\n\n<p>This feature is implemented in the <a href=\"https://golang.org/src/os/exec/exec.go#L226\" rel=\"nofollow noreferrer\">Cmd.stderr</a> function. If Stdout and Stderr are the same, then the same fd is passed the child process stdout and stderr. In the case where the fd is a pipe with a goroutine to pump it, there's only one goroutine writing to Stdout/Stderr.</p>\n"}], "owner": {"reputation": 11281, "user_id": 260805, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/34e031251528689dd8f8039fef24a65f?s=128&d=identicon&r=PG", "display_name": "Ztyx", "link": "https://stackoverflow.com/users/260805/ztyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 43140308, "answer_count": 1, "score": 2, "last_activity_date": 1490974171, "creation_date": 1490956607, "last_edit_date": 1495541381, "question_id": 43138596, "link": "https://stackoverflow.com/questions/43138596/why-doesnt-os-exec-combinedoutput-have-a-race-condition", "title": "Why doesn&#39;t os/exec.CombinedOutput() have a race condition?", "body": "<p>The Go <a href=\"https://stackoverflow.com/a/19646892/260805\"><code>bytes.Buffer</code> isn't thread-safe</a>. Yet, when I read the source code I notice that <a href=\"https://golang.org/src/os/exec/exec.go?s=12881:12927#L475\" rel=\"nofollow noreferrer\"><code>os/exec.CombinedOutput()</code></a> uses the same buffer for both <code>c.Stdout</code> and <code>c.Stderr</code>. Further reading the implementation of the package it looks like there is no synchronisation when writing to the <code>c.Stderr</code>/<code>c.Stdout</code> <a href=\"https://golang.org/src/os/exec/exec.go?s=12881:12927#L254\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>Am I missing something or have I found a possible synchronisation issue? AFAIK stderr and stdout can be written to concurrently by the child process.</p>\n"}, {"tags": ["go", "types", "interface", "switch-statement"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1490955386, "post_id": 43136897, "comment_id": 73353219, "body": "Added an example how you can make the interfaces distinct which solves your issue. See edited answer."}, {"owner": {"reputation": 55, "user_id": 2604750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23cd703c803f32c6d4a69298652898f8?s=128&d=identicon&r=PG", "display_name": "Dmitriy.Sh.", "link": "https://stackoverflow.com/users/2604750/dmitriy-sh"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1490955585, "post_id": 43136897, "comment_id": 73353359, "body": "@icza Thank you very much for your answer! I found it very usefull."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1490963385, "last_edit_date": 1592644375, "creation_date": 1490952309, "answer_id": 43137111, "question_id": 43136897, "link": "https://stackoverflow.com/questions/43136897/code-behaviour-depends-on-type-order-in-switch-operator-how-to-get-rid-of-this/43137111#43137111", "title": "Code behaviour depends on type order in switch operator, how to get rid of this?", "body": "<p>This is the intended working, as defined by the language spec.</p>\n<p>There are 2 types of <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\"><code>switch</code></a> statement, <a href=\"https://golang.org/ref/spec#Expression_switches\" rel=\"nofollow noreferrer\">Expression switches</a> and <a href=\"https://golang.org/ref/spec#Type_switches\" rel=\"nofollow noreferrer\">Type switches</a>, and this behavior is documented at the Expression switches:</p>\n<blockquote>\n<p>In an expression switch, the switch expression is evaluated and the case expressions, which need not be constants, are <strong>evaluated left-to-right and top-to-bottom</strong>; <strong>the first one that equals the switch expression triggers execution of the statements of the associated case;</strong> the other cases are skipped. If no case matches and there is a &quot;default&quot; case, its statements are executed. There can be at most one default case and it may appear anywhere in the &quot;switch&quot; statement.</p>\n<p>[...]</p>\n<p>A type switch compares types rather than values. <strong>It is otherwise similar to an expression switch.</strong></p>\n</blockquote>\n<p>In Go a type <em>implicitly</em> implements an interface if its <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">method set</a> is a superset of the interface. There is no declaration of the intent. So in Go it doesn't matter which interface defines the methods, only thing that matters is the method signatures: if a type has all the methods an interface &quot;prescribes&quot;, then that type implicitly implements the said interface.</p>\n<p>The problem is that you want to use the Type switch to something it was not designed for. You want to find the &quot;widest&quot; type (with the most methods) that is still implemented by the value. It will only do this if you enumerate the cases (the different types) in this intended order.</p>\n<p>That being said, in your case there's no such thing that a value is <em>only</em> <code>InterfaceC</code> implementation. Your code doesn't lie: all values that implement <code>InterfaceC</code> will also implement <code>InterfaceA</code> and <code>InterfaceB</code> too, because the method sets of both <code>InterfaceA</code> and <code>InterfaceB</code> are subsets of the method set of <code>InterfaceC</code>.</p>\n<p>If you want to be able to &quot;differentiate&quot; <code>InterfaceC</code> implementations, you have to &quot;alter&quot; the method sets so that the above mentioned relation will not hold (method set of <code>InterfaceC</code> will not be a superset of the method set of <code>InterfaceA</code> and <code>InterfaceB</code>). If you want <code>StructC</code> to not be an <code>InterfaceA</code> implementation, you must change the method signature of <code>ActionA()</code> (either in <code>InterfaceA</code> or in <code>InterfaceC</code>), and similarly <code>ActionB()</code> to not be an <code>InterfaceB</code> implementation.</p>\n<p>You could also add a method to <code>InterfaceA</code> (and to <code>InterfaceB</code>) which is missing from <code>InterfaceC</code>:</p>\n<pre><code>type InterfaceA interface {\n    ActionA() string\n    implementsA()\n}\n\ntype InteraceB interface {\n    ActionB() string\n    implementsB()\n}\n</code></pre>\n<p>And you have to add them to <code>StructA</code> and <code>StructB</code> of course:</p>\n<pre><code>func (a StructA) implementsA() {}\n\nfunc (b StructB) implementsB() {}\n</code></pre>\n<p>This way you get the desired output. Try it on the <a href=\"https://play.golang.org/p/OhwERL3Swl\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n<p>If you can't or don't want to do this, your only option is to enumerate the cases in the right order. Or don't use type switch for this.</p>\n"}], "owner": {"reputation": 55, "user_id": 2604750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23cd703c803f32c6d4a69298652898f8?s=128&d=identicon&r=PG", "display_name": "Dmitriy.Sh.", "link": "https://stackoverflow.com/users/2604750/dmitriy-sh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 43137111, "answer_count": 1, "score": 0, "last_activity_date": 1490974133, "creation_date": 1490951693, "last_edit_date": 1490974133, "question_id": 43136897, "link": "https://stackoverflow.com/questions/43136897/code-behaviour-depends-on-type-order-in-switch-operator-how-to-get-rid-of-this", "title": "Code behaviour depends on type order in switch operator, how to get rid of this?", "body": "<p>Recently I started to learn the Go language.<br>\nI am trying to understand interface principles in Go and was completely puzzled by one thing.<br>\nThe duck principle says: if something quacks like a duck and walks like a duck, then it's a duck.<br>\nBut I wondered how Go will behave if we have three interfaces like this:</p>\n\n<pre><code>// Interface A\ntype InterfaceA interface {\n    ActionA() string\n}\n\n// Interface B\ntype InterfaceB interface {\n    ActionB() string\n}\n</code></pre>\n\n<p>And interface <code>C</code>, which does something different but has functions which are similar to interfaces <code>A</code> and <code>B</code> functions:</p>\n\n<pre><code>// Interface C with methods A and B interfaces\ntype InterfaceC interface {\n    ActionA() string\n    ActionB() string\n}\n</code></pre>\n\n<p>Then we have three structures which implement the interfaces above:</p>\n\n<pre><code>type StructA struct{}\n\n// If it does ActionA then it's interface A\nfunc (a StructA) ActionA() string {\n    return \"Interface A implementation\"\n}\n\ntype StructB struct{}\n\n// If it does ActionB then it's interface B\nfunc (b StructB) ActionB() string {\n    return \"Interface B implementation\"\n}\n\ntype StructC struct{}\n\n// If it does ActionA and ActionB, it's an Interface C\nfunc (c StructC) ActionA() string {\n    return \"Interface C implementation\"\n}\n\nfunc (c StructC) ActionB() string {\n    return \"Interface C implementation\"\n}\n</code></pre>\n\n<p>And a function that identifies which type it gets:</p>\n\n<pre><code>func getType(data interface{}) string {\n    switch data.(type) {\n    default:\n        return \"Unknown\"\n    case InterfaceA:\n        return \"Interface A\"\n    case InterfaceB:\n        return \"Interface B\"\n    case InterfaceC:\n        return \"Interface C\"\n    }\n}\n</code></pre>\n\n<p>Code inside <code>main</code> function:</p>\n\n<pre><code>func main() {\n    a := StructA{}\n    fmt.Println(a.ActionA())\n    fmt.Println(getType(a)) // should return InterfaceA\n    fmt.Println(\"\")\n    b := StructB{}\n    fmt.Println(b.ActionB())\n    fmt.Println(getType(b)) // should return InterfaceB\n    fmt.Println(\"\")\n    c := StructC{}\n    fmt.Println(c.ActionA())\n    fmt.Println(c.ActionB())\n    fmt.Println(getType(c)) // should return InterfaceC\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Interface A implementation\nInterface A\n\nInterface B implementation\nInterface B\n\nInterface C implementation\nInterface C implementation\nInterface A\n</code></pre>\n\n<p>After some experiments I found out if we change the <code>case</code> order inside <code>switch</code> then the function identifies the type correctly:</p>\n\n<pre><code>func getType(data interface{}) string {\n    switch data.(type) {\n    default:\n        return \"Unknown\"\n    case InterfaceC:\n        return \"Interface C\"\n    case InterfaceB:\n        return \"Interface B\"\n    case InterfaceA:\n        return \"Interface A\"\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Interface A implementation\nInterface A\n\nInterface B implementation\nInterface B\n\nInterface C implementation\nInterface C implementation\nInterface C\n</code></pre>\n\n<p>See also full code on <a href=\"https://play.golang.org/p/SguuEYbmE9\" rel=\"nofollow noreferrer\">play.golang.org</a></p>\n\n<p><strong>My question</strong>: Is it a bug or a feature? And if it's a feature, how should I change <code>getType</code> so that the function doesn't depend on <code>case</code> order?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1490984298, "post_id": 43137296, "comment_id": 73371829, "body": "Almost upvoted, but mentioning the <code>reflect</code> package to someone who is obviously new to Go is..."}, {"owner": {"reputation": 8433, "user_id": 2667536, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/UfmAF.png?s=128&g=1", "display_name": "Derlin", "link": "https://stackoverflow.com/users/2667536/derlin"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1490986952, "post_id": 43137296, "comment_id": 73373167, "body": "I don&#39;t see any other way to avoid the reflect package... And reflection is common in many languages! If you have an improvement to propose, I am happy to edit my answer (and it would be a more helpful comment)."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1490987633, "post_id": 43137296, "comment_id": 73373535, "body": "Type casting, Type switches, etc. Of course, this doesn&#39;t work with the struct being defined inside the function (which is certainly a mistake here)."}], "tags": [], "owner": {"reputation": 8433, "user_id": 2667536, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/UfmAF.png?s=128&g=1", "display_name": "Derlin", "link": "https://stackoverflow.com/users/2667536/derlin"}, "is_accepted": false, "score": 1, "last_activity_date": 1490954099, "last_edit_date": 1495535452, "creation_date": 1490952777, "answer_id": 43137296, "question_id": 43136686, "link": "https://stackoverflow.com/questions/43136686/how-do-i-pass-a-pointer-to-a-structure-in-a-function/43137296#43137296", "title": "How do I pass a pointer to a structure in a function?", "body": "<p>I am not sure to understand your question. </p>\n\n<p><strong>If you want <code>out</code> to work only with structs of type <code>DataIP</code></strong>:</p>\n\n<p>simply define <code>DataIP</code> outside of main and use the signature <code>func out(k *DataIP)</code>.</p>\n\n<hr>\n\n<p><strong>if what you want is to be able to pass any type of structure to <code>out</code></strong>:</p>\n\n<p>In golang, this sort of <em>generic</em> methods can be implemented using the <em>interface</em> type. As <a href=\"https://stackoverflow.com/a/27178682/2667536\">this answer</a> explains, an interface is a container with two words of data:</p>\n\n<ol>\n<li>one word is used to point to a method table for the value\u2019s underlying type,</li>\n<li>and the other word is used to point to the actual data being held by that value.</li>\n</ol>\n\n<p>An interface can hold anything and is often used as a function parameter to be able to process many sort of inputs.</p>\n\n<p>In your case, you can do:</p>\n\n<pre><code>func out(k interface{}) {\n    fmt.Println(k)\n}\n</code></pre>\n\n<p>This will print <code>&amp;{Hello! Hello GO!}</code>. In case you want the <code>&amp;</code> to disappear (i.e. you always pass it pointers), you can use the <code>reflect</code> package to \"dereference\" <code>k</code>:</p>\n\n<pre><code>func out(k interface{}) {\n    fmt.Println(reflect.ValueOf(k).Elem())\n}\n</code></pre>\n\n<p>which yields <code>{Hello! Hello GO!}</code></p>\n\n<p>Here is a <a href=\"https://play.golang.org/p/s8flwi2HIe\" rel=\"nofollow noreferrer\">playground example</a>.</p>\n\n<hr>\n\n<p><strong>if what you want is to print the address of <code>Data</code></strong>:</p>\n\n<p>you can use the <code>%p</code> pattern with <code>fmt.Printf</code>:</p>\n\n<pre><code>fmt.Printf(\"%p\", &amp;Data) // 0x1040a130\n</code></pre>\n\n<p>Using the <code>out</code> function, you get:</p>\n\n<pre><code>func out(k interface{}) {\n    fmt.Printf(\"%p\\n\", k)\n}\n</code></pre>\n\n<p>See this <a href=\"https://play.golang.org/p/6gHoHYmoBM\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}, {"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 1, "last_activity_date": 1490952908, "creation_date": 1490952908, "answer_id": 43137339, "question_id": 43136686, "link": "https://stackoverflow.com/questions/43136686/how-do-i-pass-a-pointer-to-a-structure-in-a-function/43137339#43137339", "title": "How do I pass a pointer to a structure in a function?", "body": "<p>You need to define the type DataIP outside of <code>main()</code> that the type is in the scope of the package and not just inside of the main function:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype DataIP struct{ Title, Desc string }\n\nfunc out(k *DataIP) {\n    fmt.Println(k)\n}\n\nfunc main() {\n\n    Data := DataIP{\n        \"Hello!\",\n        \"Hello GO!\",\n    }\n    out(&amp;Data)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/cUS6ttcUy-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/cUS6ttcUy-</a></p>\n"}], "owner": {"reputation": 1, "user_id": 7796691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4be89752d1ccc76d6e1c389799fe03bf?s=128&d=identicon&r=PG&f=1", "display_name": "Mika", "link": "https://stackoverflow.com/users/7796691/mika"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1491024096, "creation_date": 1490951086, "last_edit_date": 1491024096, "question_id": 43136686, "link": "https://stackoverflow.com/questions/43136686/how-do-i-pass-a-pointer-to-a-structure-in-a-function", "title": "How do I pass a pointer to a structure in a function?", "body": "<p>I wonder how to replace <code>*Type</code>  by ? What address has the structure inside?</p>\n\n<pre><code>//mycode.go\n\npackage main\n\nimport \"fmt\"\n\nfunc out(k *Type) {\n    fmt.Println(k)\n}\n\nfunc main() {\n\n    type DataIP struct{ Title, Desc string }\n\n    Data := DataIP{\n        \"Hello!\",\n        \"Hello GO!\",\n    }\n    out(&amp;Data)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 1, "creation_date": 1490948748, "post_id": 43135919, "comment_id": 73349194, "body": "Have you tried <code>os.Chdir</code>? <a href=\"https://golang.org/pkg/os/#Chdir\" rel=\"nofollow noreferrer\">golang.org/pkg/os/#Chdir</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 84, "last_activity_date": 1510124513, "last_edit_date": 1510124513, "creation_date": 1490948781, "answer_id": 43135978, "question_id": 43135919, "link": "https://stackoverflow.com/questions/43135919/how-to-run-a-shell-command-in-a-specific-folder/43135978#43135978", "title": "How to run a shell command in a specific folder", "body": "<p><a href=\"https://golang.org/pkg/os/exec/#Command\" rel=\"noreferrer\"><code>exec.Command()</code></a> returns you a value of type <a href=\"https://golang.org/pkg/os/exec/#Cmd\" rel=\"noreferrer\"><code>*exec.Cmd</code></a>. <code>Cmd</code> is a struct and has a <a href=\"https://golang.org/pkg/os/exec/#Cmd.Dir\" rel=\"noreferrer\"><code>Dir</code></a> field:</p>\n\n<pre><code>// Dir specifies the working directory of the command.\n// If Dir is the empty string, Run runs the command in the\n// calling process's current directory.\nDir string\n</code></pre>\n\n<p>So simply set it before calling <code>Cmd.Output()</code>:</p>\n\n<pre><code>cmd:= exec.Command(\"git\", \"log\")\ncmd.Dir = \"your/intended/working/directory\"\nout, err := cmd.Output()\n</code></pre>\n\n<p>Also note that this is specific to <code>git</code> command; <code>git</code> allows you to pass the path using the <code>-C</code> flag, so you may also do what you want like this:</p>\n\n<pre><code>out, err := exec.Command(\"git\", \"-C\", \"your/intended/working/directory\", \"log\").\n    Output()\n</code></pre>\n"}], "owner": {"reputation": 42794, "user_id": 135829, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/zfWZK.jpg?s=128&g=1", "display_name": "Sergei Basharov", "link": "https://stackoverflow.com/users/135829/sergei-basharov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17373, "favorite_count": 6, "accepted_answer_id": 43135978, "answer_count": 1, "score": 31, "last_activity_date": 1578434980, "creation_date": 1490948607, "last_edit_date": 1578434980, "question_id": 43135919, "link": "https://stackoverflow.com/questions/43135919/how-to-run-a-shell-command-in-a-specific-folder", "title": "How to run a shell command in a specific folder", "body": "<p>I can use this <code>out, err := exec.Command(\"git\", \"log\").Output()</code> to get an output of the command which will run in the same path as the executable  location.</p>\n\n<p>How do I specify in which folder I want to run the command?</p>\n"}, {"tags": ["go", "heap"], "comments": [{"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1490944449, "post_id": 43132743, "comment_id": 73346884, "body": "Hello, you should post the significant code in your question."}], "answers": [{"comments": [{"owner": {"reputation": 1376, "user_id": 326174, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/44cecdf8f3ed94d8f5bc063d4e8d9d3a?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/326174/dave"}, "edited": false, "score": 1, "creation_date": 1491034196, "post_id": 43134869, "comment_id": 73384933, "body": "Ah, mis-read the push call. Didn&#39;t notice it was heap.Push, as opposed to the custom type&#39;s Push"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 4, "last_activity_date": 1490945045, "creation_date": 1490945045, "answer_id": 43134869, "question_id": 43132743, "link": "https://stackoverflow.com/questions/43132743/how-does-gos-heap-interface-work/43134869#43134869", "title": "How does Go&#39;s heap interface work?", "body": "<p>To keep heap implementation simple, you are only required to provide queuing logic for your custom type. Heapification is done by the <code>heap</code> package itself. It does so by calling the <code>Push</code>/<code>Pop</code> defined on your type, and then calling the heapification procedure:</p>\n\n<pre><code>// from golang.org/src/container/heap/heap.go\n\n// Push pushes the element x onto the heap. The complexity is\n// O(log(n)) where n = h.Len().\n//\nfunc Push(h Interface, x interface{}) {\n    h.Push(x)        // call to Push defined on your custom type\n    up(h, h.Len()-1) // **heapification**\n}\n\n// Pop removes the minimum element (according to Less) from the heap\n// and returns it. The complexity is O(log(n)) where n = h.Len().\n// It is equivalent to Remove(h, 0).\n//\nfunc Pop(h Interface) interface{} {\n    n := h.Len() - 1\n    h.Swap(0, n)\n    down(h, 0, n) // **heapification**\n    return h.Pop()\n}\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 326174, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/44cecdf8f3ed94d8f5bc063d4e8d9d3a?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/326174/dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1763, "favorite_count": 0, "accepted_answer_id": 43134869, "answer_count": 1, "score": 4, "last_activity_date": 1490945045, "creation_date": 1490936195, "question_id": 43132743, "link": "https://stackoverflow.com/questions/43132743/how-does-gos-heap-interface-work", "title": "How does Go&#39;s heap interface work?", "body": "<p>In Go, you can implement a heap as such: <a href=\"https://golang.org/src/container/heap/example_pq_test.go\" rel=\"nofollow noreferrer\">https://golang.org/src/container/heap/example_pq_test.go</a></p>\n\n<p>You implement the <code>sort.Interface</code>, <code>Pop</code>, and <code>Push</code> and you've got yourself a priority queue/heap. In the example of both <code>Pop</code> and <code>Push</code> implementations the <code>heap.Fix</code> function isn't called. I see that <code>heap.Init</code> is called, so I can understand some heap-ifying happening then. However, you are able to push and pop items, which runs your own code, and the heap property is maintained. </p>\n\n<p>If you push or pop items after init without calling <code>heap.fix</code>, how does the heap property get maintained?</p>\n\n<p>Here's a playground of the example: <a href=\"https://play.golang.org/p/wE413xwmxE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/wE413xwmxE</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1490945243, "post_id": 43132005, "comment_id": 73347294, "body": "What&#39;s the purpose of handling all those separate paths if all your static files live in one folder? Your first <code>myRouter.PathPrefix(&quot;&#47;static&#47;&quot;).Handler(http.StripPrefix(&quot;&#47;s&zwnj;&#8203;tatic&#47;&quot;, fs))</code> should be enough to serve any file inside <code>&#47;statict&#47;</code>."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1490961967, "post_id": 43132005, "comment_id": 73357469, "body": "You would think, but that is not the case. I promise you if you remove the other paths then it will only serve files on the root path. / however when you have real navigation on a page /admin/reports/some_report_type go will not be able to locate the files. If you dont believe me try it."}], "answers": [{"comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1490961772, "post_id": 43135058, "comment_id": 73357338, "body": "You need both go and ngnix to do it. Go must server static files when you&#39;re working local. Nginx serves in production."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1490963016, "post_id": 43135058, "comment_id": 73358191, "body": "Regardless of the Go stuff, ill try this in the test production environment. Because if this works at least that&#39;s half the issue taken care of. Ill comment back if that solves the repitition on the nginx level."}, {"owner": {"reputation": 2756, "user_id": 1375316, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/62627013dd03b525ba5954cff57b0f9b?s=128&d=identicon&r=PG", "display_name": "threeve", "link": "https://stackoverflow.com/users/1375316/threeve"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1490968156, "post_id": 43135058, "comment_id": 73361866, "body": "@reticentroot Why must you serve static files with the go server if running locally?  Your dev environment should be a &quot;reasonable facsimile of production&quot;.  I use docker for this, but there are other tools out there.  If I&#39;m going to use nginx/apache as a reverse proxy in production, I&#39;m certainly going to do it in development as well."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1490968978, "post_id": 43135058, "comment_id": 73362453, "body": "Running locally means running on my mac(s) we don&#39;t use docker. Local so in my local environment we I just spin up the server go run server.go and start coding or editing, push to git, pull on the server, go clean, go build server.go, restart process. All in that means that when I run it local go is serving the static files and in production NGINX is."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1490970030, "post_id": 43135058, "comment_id": 73363229, "body": "Either way, that nginx stuff you wrote above, worked like a charm, I was able to work with just this lines."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": false, "score": 2, "last_activity_date": 1490945659, "creation_date": 1490945659, "answer_id": 43135058, "question_id": 43132005, "link": "https://stackoverflow.com/questions/43132005/serving-static-files-go-seems-inefficient-or-maybe-its-just-me/43135058#43135058", "title": "Serving static files Go seems inefficient..or maybe its just me :-)", "body": "<p>If you are using nginx to do this work then you don't need Go to do it too (unless you want to be able to run standalone without nginx).  If that is the case then you can use a Path call instead of PathPrefix so you can do pattern matching.</p>\n\n<p>If you are just trying to do this via nginx then something like this should work:</p>\n\n<pre><code>server {\n    listen 8080;\n\n    location ~* ^/static/ {\n        root /path/to/directory/containing_static;\n    }\n\n    location  ~* ^.*/static/(.*)$ {\n        rewrite \"^.*/static/(.*)$\" /static/$1 last;\n    }\n\n\n    location @forward_to_app {\n       # send to your go app here\n    }\n\n  }\n</code></pre>\n\n<p>You can probably do without the rewrite, but that was an easy approach to take.</p>\n"}, {"comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1490969551, "post_id": 43142282, "comment_id": 73362826, "body": "I&#39;ve attached screen shots of how the errors I get when I don&#39;t add each path"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1490970278, "post_id": 43142282, "comment_id": 73363433, "body": "@reticentroot fix your html <code>script</code>, <code>link</code>, and <code>a</code> links, you are linking by using relative paths, use absolute paths instead. Instead of <code>&lt;script type=&quot;text&#47;javascript&quot; src=&quot;static&#47;foobar.js&quot;&gt;&lt;&#47;script&gt;</code> use <code>&lt;script type=&quot;text&#47;javascript&quot; src=&quot;&#47;static&#47;foobar.js&quot;&gt;&lt;&#47;script&gt;</code>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1490970556, "post_id": 43142282, "comment_id": 73363625, "body": "bro...  no words LOL.. its one of those issues that annoyed me..forget about it.. see it again think about it, etc.  My title was spot on.  Thanks."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1490967875, "creation_date": 1490967875, "answer_id": 43142282, "question_id": 43132005, "link": "https://stackoverflow.com/questions/43132005/serving-static-files-go-seems-inefficient-or-maybe-its-just-me/43142282#43142282", "title": "Serving static files Go seems inefficient..or maybe its just me :-)", "body": "<p>All those <code>PathPrefix</code> and <code>StripPrefix</code> calls seem to me to be functionally pointless. If your static directory is inside your Go project and its structure looks something like this:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 static\n    \u251c\u2500\u2500 admin\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 accounts\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 file.txt\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 file.txt\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 reports\n    \u2502\u00a0\u00a0     \u2514\u2500\u2500 file.txt\n    \u2514\u2500\u2500 file.txt\n</code></pre>\n\n<p>then to serve files from that static directory with Go, all you should really need is this.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    fs := http.FileServer(http.Dir(\"static/\"))\n    http.Handle(\"/\", fs)\n\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/futaA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/futaA.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 1, "accepted_answer_id": 43142282, "answer_count": 2, "score": 2, "last_activity_date": 1490970592, "creation_date": 1490931473, "last_edit_date": 1490970592, "question_id": 43132005, "link": "https://stackoverflow.com/questions/43132005/serving-static-files-go-seems-inefficient-or-maybe-its-just-me", "title": "Serving static files Go seems inefficient..or maybe its just me :-)", "body": "<p>Over months I've read tons of articles about Go and best practices.  Among those articles are numerous google searches and SOF searches regarding how to and the best way to serve static files.  </p>\n\n<p>This is what I currently have</p>\n\n<pre><code>fs := http.FileServer(http.Dir(\"static/\"))\nmyRouter.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static/\", fs))\n\nmyRouter.PathPrefix(\"/admin/static/\").Handler(http.StripPrefix(\"/admin/static/\", fs))\nmyRouter.PathPrefix(\"/admin/accounts/static/\").Handler(http.StripPrefix(\"/admin/accounts/static/\", fs))\nmyRouter.PathPrefix(\"/admin/admin_tools/static/\").Handler(http.StripPrefix(\"/admin/admin_tools/static/\", fs))\nmyRouter.PathPrefix(\"/admin/audit_tools/static/\").Handler(http.StripPrefix(\"/admin/audit_tools/static/\", fs))\nmyRouter.PathPrefix(\"/admin/demand/static/\").Handler(http.StripPrefix(\"/admin/demand/static/\", fs))\nmyRouter.PathPrefix(\"/admin/optimization/static/\").Handler(http.StripPrefix(\"/admin/optimization/static/\", fs))\nmyRouter.PathPrefix(\"/admin/reports/static/\").Handler(http.StripPrefix(\"/admin/reports/static/\", fs))\nmyRouter.PathPrefix(\"/admin/setups/static/\").Handler(http.StripPrefix(\"/admin/setups/static/\", fs))\nmyRouter.PathPrefix(\"/admin/queue/static/\").Handler(http.StripPrefix(\"/admin/queue/static/\", fs))\nmyRouter.PathPrefix(\"/admin/tagservers/static/\").Handler(http.StripPrefix(\"/admin/tagservers/static/\", fs))\nmyRouter.PathPrefix(\"/admin/client/static/\").Handler(http.StripPrefix(\"/admin/client/static/\", fs))\nmyRouter.PathPrefix(\"/client/static/\").Handler(http.StripPrefix(\"/client/static/\", fs))\n</code></pre>\n\n<p>My issue with this is that for <strong>every</strong> path I have to add a new line to cover where the static files come from.  Most examples show how it's done when you have a single landing page with no real navigations built into it. Coming from a Python background I suppose I was bit spoiled with some of the lightweight frameworks, such as Flask and Tornado, where one just points to the static folder once.</p>\n\n<p>Another issue with this current setup is it doesn't play nice with NGINX.  Again with frameworks like Flask and Tornado, all you have to do in NGINX is set the static location once.  With Go I have to set the static location just like the code above (by defining each path).</p>\n\n<p><strong>Has anyone found a better way to serve static files?</strong>  I know in theory a function could probably be written to automate it, but it wouldn't really change the fact that each path has to be accounted for on the app level and NGINX level.     </p>\n\n<p><strong>UPDATE:</strong> In reply to @mkopriva I've attached two screenshots.  The first is of the browser running the app with dev tools open to show the 404s on the static files. The Second is of the server code, to produce those errors all I did was comment out one line.  The line that handles the audit_tools path. If I uncomment it everything routes no problem. </p>\n\n<p><a href=\"https://i.stack.imgur.com/MD1B2.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/MD1B2.png\" alt=\"Browser Errors\"></a>\n<a href=\"https://i.stack.imgur.com/O2nXc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/O2nXc.png\" alt=\"Server code with commented out line\"></a></p>\n\n<p>Edit, both @mkopriva and @sberry did a great job. I wish I could pick two correct answers. </p>\n"}, {"tags": ["sockets", "networking", "go", "tcp"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1490981191, "post_id": 43131419, "comment_id": 73370220, "body": "Why not test it yourself? It shouldn&#39;t be difficult to set up."}, {"owner": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1491010664, "post_id": 43131419, "comment_id": 73380496, "body": "@RayfenWindspear Thanks. I&#39;ve done the test and turns out p2 can still accept TCP connections. It&#39;s confusing."}], "answers": [{"comments": [{"owner": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "edited": false, "score": 0, "creation_date": 1491376259, "post_id": 43168575, "comment_id": 73518626, "body": "Packets those can be handled by kernel tcp/ip stack (like tcp, udp) will be delivered to kernel stack, packets those can&#39;t be handled by kernel stack will be delivered to raw sockets. Am I understanding you right?"}, {"owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "reply_to_user": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "edited": false, "score": 0, "creation_date": 1491379394, "post_id": 43168575, "comment_id": 73520597, "body": "Almost, note that copies of ICMP packets are delivered to a matching raw socket. For example, you can call <code>net.ListenIP(&quot;ip4:icmp&quot;, laddr)</code> to get ICMP echo packets(ping request) but kernel has already send replies to the sender(by default)."}, {"owner": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "edited": false, "score": 0, "creation_date": 1491380251, "post_id": 43168575, "comment_id": 73521168, "body": "If I want to intercept all packets (dested to an ip address or a network interface) so that other processes will never receive tcp or udp packets. Is that possible? Imaging I&#39;m implementing a switch/router in userspace."}], "tags": [], "owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "is_accepted": true, "score": 2, "last_activity_date": 1491137657, "creation_date": 1491137657, "answer_id": 43168575, "question_id": 43131419, "link": "https://stackoverflow.com/questions/43131419/listen-all-ip-packets-including-icmp-tcp-and-udp/43168575#43168575", "title": "Listen all IP packets including ICMP, TCP and UDP?", "body": "<p>Here is the source code of <code>net.ListenIP()</code>:</p>\n\n<pre><code>// ListenIP listens for incoming IP packets addressed to the local\n// address laddr.  The returned connection's ReadFrom and WriteTo\n// methods can be used to receive and send IP packets with per-packet\n// addressing.\nfunc ListenIP(netProto string, laddr *IPAddr) (*IPConn, error) {\n    net, proto, err := parseNetwork(netProto)\n    if err != nil {\n        return nil, &amp;OpError{Op: \"listen\", Net: netProto, Source: nil, Addr: laddr.opAddr(), Err: err}\n    }   \n    switch net {\n    case \"ip\", \"ip4\", \"ip6\":\n    default:\n        return nil, &amp;OpError{Op: \"listen\", Net: netProto, Source: nil, Addr: laddr.opAddr(), Err: UnknownNetworkError(netProto)}\n    }   \n    fd, err := internetSocket(net, laddr, nil, noDeadline, syscall.SOCK_RAW, proto, \"listen\", noCancel)\n    if err != nil {\n        return nil, &amp;OpError{Op: \"listen\", Net: netProto, Source: nil, Addr: laddr.opAddr(), Err: err}\n    }   \n    return newIPConn(fd), nil \n}\n</code></pre>\n\n<p>it creates a raw socket, on linux, an <a href=\"http://man7.org/linux/man-pages/man7/raw.7.html\" rel=\"nofollow noreferrer\"><code>IPPROTO_RAW</code> socket</a> is send only. TCP and UDP packets are never delivered to raw sockets, they are always handled by the kernel protocol stack. Copies of ICMP packets are delivered to a matching raw socket. All other packets destined for protocols that are not processed by a kernel subsystem are delivered to raw sockets.</p>\n"}, {"tags": [], "owner": {"reputation": 111, "user_id": 1234111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1245a630b95b570e5979053fc4095f0f?s=128&d=identicon&r=PG", "display_name": "Vinicius Fortuna", "link": "https://stackoverflow.com/users/1234111/vinicius-fortuna"}, "is_accepted": false, "score": 0, "last_activity_date": 1603036725, "creation_date": 1603036725, "answer_id": 64415379, "question_id": 43131419, "link": "https://stackoverflow.com/questions/43131419/listen-all-ip-packets-including-icmp-tcp-and-udp/64415379#64415379", "title": "Listen all IP packets including ICMP, TCP and UDP?", "body": "<p>You probably want to use a <a href=\"https://en.wikipedia.org/wiki/TUN/TAP\" rel=\"nofollow noreferrer\">TUN device</a> instead. That's really the only way to intercept all IP traffic.</p>\n<p>You may use a library like <a href=\"https://github.com/songgao/water\" rel=\"nofollow noreferrer\">https://github.com/songgao/water</a>.</p>\n"}], "owner": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 862, "favorite_count": 0, "accepted_answer_id": 43168575, "answer_count": 2, "score": 1, "last_activity_date": 1603036725, "creation_date": 1490927583, "question_id": 43131419, "link": "https://stackoverflow.com/questions/43131419/listen-all-ip-packets-including-icmp-tcp-and-udp", "title": "Listen all IP packets including ICMP, TCP and UDP?", "body": "<p>Specially in golang, there are interfaces like <code>net.ListenIP</code> and <code>net.ListenTCP</code>.   </p>\n\n<p>I'm wondering that, if process p1 <code>ListenIP(192.168.1.1)</code> and process p2 <code>ListenTCP(192.168.1.1:80)</code>, will all packets dest to 192.168.1.1 (no matter TCP or UDP) are intercepted by p1, and p2 will never accept a TCP connection?</p>\n"}, {"tags": ["windows", "file", "go", "directory"], "comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1490908475, "post_id": 43128059, "comment_id": 73335719, "body": "Quick note: <code>if proceed == true</code> can be reduced to <code>if proceed</code>."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1490909278, "post_id": 43128059, "comment_id": 73336074, "body": "This may require some Windows specific syscalls. See <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/mQnKRPuHvEQ\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/mQnKRPuHvEQ</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1490913184, "post_id": 43128059, "comment_id": 73337483, "body": "Can you add to your question which line it is that it stops at? There is probably an easier way to skip over these locked files without resorting to difficult syscalls."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1490942376, "post_id": 43128059, "comment_id": 73345704, "body": "Please provide a stacktrace on any pastebin resource and update your question with a link to it.  Also please tell us your Go version."}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 1540982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea8b822bbb234d8df7bd681c4af0b78c?s=128&d=identicon&r=PG", "display_name": "user1540982", "link": "https://stackoverflow.com/users/1540982/user1540982"}, "edited": false, "score": 0, "creation_date": 1490961391, "post_id": 43135787, "comment_id": 73357071, "body": "By caller you mean filepath.Walk?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1490974459, "post_id": 43135787, "comment_id": 73366374, "body": "You will have to make <code>myErrors</code> a global variable here. It is <code>filepath.Walk</code> calling the <code>VisitFile</code> function. But I like the idea, you get the files walked, then you can inspect the errors afterward."}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 1, "last_activity_date": 1490976771, "last_edit_date": 1490976771, "creation_date": 1490948200, "answer_id": 43135787, "question_id": 43128059, "link": "https://stackoverflow.com/questions/43128059/directory-walker-written-in-go-stops-with-file-in-use-locked-error/43135787#43135787", "title": "Directory walker written in Go stops with file in use (locked) error", "body": "<p>If you want your walk to finish, you should not return the error inside your function. You should collect the errors inside a slice.\nChange your function to:</p>\n\n<pre><code>// Put this var outside your function\nvar myErrors []error\nfunc VisitFile(fp string, fi os.FileInfo, err error) []error {\n</code></pre>\n\n<p>Just make a variable as slice of errors. And then change the <code>return err</code></p>\n\n<pre><code>   if proceed == true {\n        for _, value := range exts {\n            matched, err := filepath.Match(value, fi.Name())\n            if err != nil {\n                fmt.Println(err) // malformed pattern\n                // collect the error\n                myErrors = append(myErrors,err)\n                // you could jump out of this by \n                return nil\n            }\n            if matched {\n                fmt.Println(fp)\n            }\n        }\n    }\n</code></pre>\n\n<p>At the end you can check the <code>myErrors</code> slice.</p>\n"}], "owner": {"reputation": 61, "user_id": 1540982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea8b822bbb234d8df7bd681c4af0b78c?s=128&d=identicon&r=PG", "display_name": "user1540982", "link": "https://stackoverflow.com/users/1540982/user1540982"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 316, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1490976771, "creation_date": 1490907035, "last_edit_date": 1490918254, "question_id": 43128059, "link": "https://stackoverflow.com/questions/43128059/directory-walker-written-in-go-stops-with-file-in-use-locked-error", "title": "Directory walker written in Go stops with file in use (locked) error", "body": "<p>I have this directory walker:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"path/filepath\"\n    \"strings\"\n)\n\nvar exts = [...]string{\"*.psd\", \"*.cdr\", \"*.tiff\", \"*.svg\", \"*.png\", \"*.jpeg\", \"*.jpg\", \"*.pdf\", \"*.txt\", \"*.rtf\", \"*.docx\", \"*.doc\", \"*.xlsx\", \"*.xls\", \"*.ppt\", \"*.pptx\", \"*.accdb\", \"*.csv\", \"*.dwg\", \"*.dxf\", \"*.dng\", \"*.arw\", \"*.srf\", \"*.sr2\", \"*.bay\", \"*.crw\", \"*.cr2\", \"*.dcr\", \"*.kdc\", \"*.erf\", \"*.mef\", \"*.mrw\", \"*.nef\", \"*.nrw\", \"*.orf\", \"*.raf\", \"*.raw\", \"*.rwl\", \"*.rw2\", \"*.r3d\", \"*.ptx\", \"*.pef\", \"*.srw\"}\nvar skipdir = [...]string{\"WINDOWS\", \"Program Files\"}\n\nfunc VisitFile(fp string, fi os.FileInfo, err error) error {\n    proceed := true\n    if err != nil {\n        fmt.Println(err) // can't walk here,\n        return nil       // but continue walking elsewhere\n    }\n    if fi.IsDir() {\n        return nil // not a file.  ignore.\n    }\n    for _, value := range skipdir {\n        if strings.Contains(filepath.Dir(fp), value) {\n            proceed = false\n            break\n        }\n    }\n    if proceed == true {\n        for _, value := range exts {\n            matched, err := filepath.Match(value, fi.Name())\n            if err != nil {\n                fmt.Println(err) // malformed pattern\n                return err       // this is fatal.\n            }\n            if matched {\n                fmt.Println(fp)\n            }\n        }\n    } else {\n        //fmt.Println(proceed)\n        return nil\n    }\n    return nil\n}\n\nfunc getdrives() (r []string) {\n    for _, drive := range \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" {\n        _, err := os.Open(string(drive) + \":\\\\\")\n        if err == nil {\n            r = append(r, string(drive))\n        }\n    }\n    return\n}\n\nfunc main() {\n    drives := getdrives()\n    for _, value := range drives {\n        filepath.Walk(value+\":/\", VisitFile)\n    }\n}\n</code></pre>\n\n<p>However, when it gets to pagefile.sys, I get this message: </p>\n\n<blockquote>\n  <p>GetFileAttributesEx C:\\pagefile.sys: The process cannot access the file because\n      it is being used by another process.</p>\n</blockquote>\n\n<p>because the file is in use, and program stops. How do I suppress this message to continue walking?</p>\n"}, {"tags": ["web", "go"], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 7794030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-x_0Be_wIKoo/AAAAAAAAAAI/AAAAAAAAAN8/PSsGQJ36U5U/photo.jpg?sz=128", "display_name": "Cleo Rebert", "link": "https://stackoverflow.com/users/7794030/cleo-rebert"}, "edited": false, "score": 0, "creation_date": 1490901753, "post_id": 43126616, "comment_id": 73332123, "body": "Ho my god thanks you. In the golang doc they used <code>nil</code> as an exemple so I thought I needed to use that. But what does <code>r</code> mean exactly?"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "reply_to_user": {"reputation": 5, "user_id": 7794030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-x_0Be_wIKoo/AAAAAAAAAAI/AAAAAAAAAN8/PSsGQJ36U5U/photo.jpg?sz=128", "display_name": "Cleo Rebert", "link": "https://stackoverflow.com/users/7794030/cleo-rebert"}, "edited": false, "score": 3, "creation_date": 1490902067, "post_id": 43126616, "comment_id": 73332286, "body": "That last parameter is the handler, which is what services the request. <code>r</code> is a router which takes the request and figures out what to do with it based on the way you have it set up. If you pass a nil handler to <code>ListenAndServeTLS</code>, it uses the default one (<code>DefaultServeMux</code>). See <a href=\"https://golang.org/pkg/net/http\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http</a> for more info."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 2, "last_activity_date": 1490901428, "creation_date": 1490901428, "answer_id": 43126616, "question_id": 43126301, "link": "https://stackoverflow.com/questions/43126301/golang-route-not-working/43126616#43126616", "title": "Golang route not working", "body": "<p>I think you need to give <code>r</code> as the last parameter to <code>http.ListenAndServeTLS</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 339, "user_id": 7219771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3625497f5527ed686fc7c51051a9face?s=128&d=identicon&r=PG&f=1", "display_name": "safi eddine", "link": "https://stackoverflow.com/users/7219771/safi-eddine"}, "is_accepted": false, "score": 0, "last_activity_date": 1552741008, "creation_date": 1552741008, "answer_id": 55197049, "question_id": 43126301, "link": "https://stackoverflow.com/questions/43126301/golang-route-not-working/55197049#55197049", "title": "Golang route not working", "body": "<p>you can also use a <strong>http.server</strong> instance </p>\n\n<pre><code>//create server instance\nserver := http.Server{\n    Addr:      \":443\",\n    TLSConfig: tlsConfig(cert),\n}\n\nrtr := mux.NewRouter()\nrtr.HandleFunc(\"/profile\", HandlerProfile).Methods(\"GET\")\n//rtr.HandleFunc( other routes...\n\n//pass mux handler to server\nserver.Handler = rtr\nserver.ListenAndServeTLS(\"\", \"\")\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 7794030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-x_0Be_wIKoo/AAAAAAAAAAI/AAAAAAAAAN8/PSsGQJ36U5U/photo.jpg?sz=128", "display_name": "Cleo Rebert", "link": "https://stackoverflow.com/users/7794030/cleo-rebert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 750, "favorite_count": 0, "accepted_answer_id": 43126616, "answer_count": 2, "score": -2, "last_activity_date": 1552741008, "creation_date": 1490900368, "question_id": 43126301, "link": "https://stackoverflow.com/questions/43126301/golang-route-not-working", "title": "Golang route not working", "body": "<p>I just started to get into golang and as I plan to host at least two websites, I chose to use Mux to display different routes by \"filtering\" domains. Whenever I try to access my main route, it just gives me an 404 error. (Also, the fact that the \"www\" part is absent is perfectly normal. I don't type that to access the site).</p>\n\n<p>But if I launch the server as a file server, I can access my files, so the server in itself is working I guess</p>\n\n<pre><code>func redirect(w http.ResponseWriter, req *http.Request) {\n    target := \"https://\" + req.Host + req.URL.Path\n    http.Redirect(w, req, target,\n        http.StatusTemporaryRedirect)\n}\n\nfunc main() {\n    go http.ListenAndServe(\":80\", http.HandlerFunc(redirect)) // Redirection\n\n    // Serveur s\u00e9curis\u00e9\n\n    r := mux.NewRouter()\n    r.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"/root/go/src/web/static/\"))))\n    s := r.Host(\"echecderi.me\").Subrouter()\n    s.HandleFunc(\"/\", indexEchec)\n\n    http.ListenAndServeTLS(\":443\", \"domain-crt.pem\", \"domain-key.pem\", nil)\n}\n\nfunc indexEchec(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"&lt;h1&gt;Echec de rime&lt;/h1&gt; &lt;/br&gt; &lt;img src=\\\"/static/echecderime/echec.gif\\\"&gt;\")\n}\n</code></pre>\n"}, {"tags": ["go", "interface", "type-assertion"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1490901363, "post_id": 43126053, "comment_id": 73331915, "body": "Work yourself through the Tour of Go first, then some other tutorials."}], "answers": [{"tags": [], "owner": {"reputation": 152, "user_id": 1657083, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KD4f8.jpg?s=128&g=1", "display_name": "RadekSohlich", "link": "https://stackoverflow.com/users/1657083/radeksohlich"}, "is_accepted": true, "score": 0, "last_activity_date": 1490900570, "creation_date": 1490900570, "answer_id": 43126353, "question_id": 43126053, "link": "https://stackoverflow.com/questions/43126053/go-type-assertion-with-interface-dont-understand-how-does-it/43126353#43126353", "title": "Go type assertion with interface don&#39;t understand how does it", "body": "<p>Because the fakeString is a different type than string, but it implements Stringer interface. Every type with given function implements the type. The fakeString contains the String() func so it also implements Stringer interface. This is some kind of fundamental stones of Go.</p>\n\n<p>Check the built-in libs for Reader interface, it is usually given as an example for this.</p>\n"}], "owner": {"reputation": 3, "user_id": 7793963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf3cdf6cd737b8c08a3bfb69c64a9386?s=128&d=identicon&r=PG&f=1", "display_name": "Ignacio Galv&#225;n Vitas", "link": "https://stackoverflow.com/users/7793963/ignacio-galv%c3%a1n-vitas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 43126353, "answer_count": 1, "score": -2, "last_activity_date": 1490900570, "creation_date": 1490899593, "question_id": 43126053, "link": "https://stackoverflow.com/questions/43126053/go-type-assertion-with-interface-dont-understand-how-does-it", "title": "Go type assertion with interface don&#39;t understand how does it", "body": "<p>I'm reading \"Go Bootcamp\" and there is an example in the Chapter 3, page 20 I cannot understand. In this example, in the line printString(s), s is a variable of type fakeString, but in the switch, enters in the \"Stringer\" case. I'm trying to understand how is this possible. Any help would be appreciated. </p>\n\n<p>The code is:</p>\n\n<pre><code>package main\nimport \"fmt\"\n\ntype Stringer interface {\n   String() string\n}\ntype fakeString struct {\n   content string\n}\n// function used to implement the Stringer interface\nfunc (s *fakeString) String() string {\n    return s.content\n}\nfunc printString(value interface{}) {\n    switch str := value.(type) {\n        case string:\n            fmt.Println(str)\n        case Stringer:\n            fmt.Println(str.String())\n    }\n}\nfunc main() {\n    s := &amp;fakeString{\"Ceci n'est pas un string\"}\n    printString(s)\n    printString(\"Hello, Gophers\")\n}\n</code></pre>\n"}, {"tags": ["go", "memory-leaks"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1490900247, "post_id": 43125928, "comment_id": 73331344, "body": "Never use a busy loop, it&#39;s always a mistake. The first just happens to break things worse than the second, because the first <i>could</i> be doing something else. Yes, the memory can eventually be freed if you get that far."}, {"owner": {"reputation": 11, "user_id": 1103870, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ed7c27d3b9c544ada0817cdd30873cb?s=128&d=identicon&r=PG", "display_name": "navij", "link": "https://stackoverflow.com/users/1103870/navij"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1490901447, "post_id": 43125928, "comment_id": 73331949, "body": "\u0421ould you please be more specific on dangers that such busy loop can possibly hide? This routine reads from socket and sends recieved data through channel. AFAIK, net.Read() blocks the execution and consumes no excess CPU time, and there is a loop break in case that TCP connection will broke. I can make it one-timed, and re-run it after getting message, but i don&#39;t see yet how it could be dangerous."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1490901558, "post_id": 43125928, "comment_id": 73332002, "body": "&quot;And maybe there are some other similar traps that a go-newbie should know?&quot; These are not traps, neither to newbies nor to veterans. These are  handcrafted pathological code snippets nobody would ever write."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1490901907, "post_id": 43125928, "comment_id": 73332205, "body": "@navij: Then your example isn&#39;t complete enough. If you are doing something besides calling make in the loop then your problem is likely elsewhere. Please show a complete example. If you want to see how memory is being collected, set <code>GODEBUG=gctrace=1</code>"}, {"owner": {"reputation": 11, "user_id": 1103870, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ed7c27d3b9c544ada0817cdd30873cb?s=128&d=identicon&r=PG", "display_name": "navij", "link": "https://stackoverflow.com/users/1103870/navij"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1490902301, "post_id": 43125928, "comment_id": 73332403, "body": "@JimB: I have added the full code, but i&#39;ve cut everything else because it&#39;s quite simple and i did some tests which have showed that declaring <code>buf</code> outside of the loop solved the problem. I was just curious about what is causing such behaviour."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1490902474, "post_id": 43125928, "comment_id": 73332495, "body": "@navij: that&#39;s not causing a leak, and is perfectly fine (though you&#39;re discarding the number of bytes read, so you don&#39;t know how much of each buf is actually valid). You&#39;re keeping the memory around in some other way if it continues to grow."}, {"owner": {"reputation": 11, "user_id": 1103870, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ed7c27d3b9c544ada0817cdd30873cb?s=128&d=identicon&r=PG", "display_name": "navij", "link": "https://stackoverflow.com/users/1103870/navij"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1490902713, "post_id": 43125928, "comment_id": 73332621, "body": "@Volker I have no doubts that you are absolutely right about my code. The sole reason i have asked this question was to write better."}, {"owner": {"reputation": 11, "user_id": 1103870, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ed7c27d3b9c544ada0817cdd30873cb?s=128&d=identicon&r=PG", "display_name": "navij", "link": "https://stackoverflow.com/users/1103870/navij"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1490903390, "post_id": 43125928, "comment_id": 73332996, "body": "@JimB That&#39;s strange. I&#39;ve run a clean test: endless loop within main(), 4 looped routines that are making a new <code>buf</code> each run and outputs first bit of it, nothing else, and got memory usage skyrocketing. And after declaring <code>buf</code> before the loop the problem disappeared completely. I checked it more than once, and always got a growing memory usage. Here are my test sources, if you are interested: <a href=\"https://pastebin.com/aFXwXvQT\" rel=\"nofollow noreferrer\">leaking</a> and <a href=\"https://pastebin.com/gR0ks0Xs\" rel=\"nofollow noreferrer\">non-leaking</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1490904736, "post_id": 43125928, "comment_id": 73333733, "body": "@navij: that first example is exactly what we&#39;re talking about, it&#39;s a useless loop that is spinning as fast as possible, it breaks your program, but no sane program should ever have that. That is not equivalent to a loop like in your question that calls Read on a net.Conn."}, {"owner": {"reputation": 11, "user_id": 1103870, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ed7c27d3b9c544ada0817cdd30873cb?s=128&d=identicon&r=PG", "display_name": "navij", "link": "https://stackoverflow.com/users/1103870/navij"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1490905788, "post_id": 43125928, "comment_id": 73334310, "body": "@JimB Yes, of course i don&#39;t do that in my code, it&#39;s for testing sake&#39;s only. But the leak is there nonetheless, and it works absolutely the same as in my program. These two test code samples are absolutely idnetical except for buffer declaration, and one have leak, and the second doesn&#39;t. I don&#39;t understand how declaring variable before loop and then reassigning it inside differs from declaring it each time. Maybe garbage collector ignores loop variable scope until it ends?"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 1103870, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ed7c27d3b9c544ada0817cdd30873cb?s=128&d=identicon&r=PG", "display_name": "navij", "link": "https://stackoverflow.com/users/1103870/navij"}, "edited": false, "score": 0, "creation_date": 1490909288, "post_id": 43128073, "comment_id": 73336079, "body": "That is really confusing, because here are my outputs of your code:  alloc [78696]    heapAlloc [78696] alloc [80904]    heapAlloc [80904] alloc [82328]    heapAlloc [82328]  and, after 10-20 seconds:  alloc [128504]       heapAlloc [128504]  I was running it on Win7 and CentOS. I am really confused right now."}, {"owner": {"reputation": 11, "user_id": 1103870, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ed7c27d3b9c544ada0817cdd30873cb?s=128&d=identicon&r=PG", "display_name": "navij", "link": "https://stackoverflow.com/users/1103870/navij"}, "edited": false, "score": 0, "creation_date": 1490910546, "post_id": 43128073, "comment_id": 73336615, "body": "And, once again, after putting <code>buf</code> declaration before loop, i got perfectly normal mem usage, swinging around 3-4 MBs. And it doesn&#39;t seem to be platform-specific or golang version-specific bug, since i encounter it on different systems."}, {"owner": {"reputation": 11, "user_id": 1103870, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ed7c27d3b9c544ada0817cdd30873cb?s=128&d=identicon&r=PG", "display_name": "navij", "link": "https://stackoverflow.com/users/1103870/navij"}, "edited": false, "score": 0, "creation_date": 1490911009, "post_id": 43128073, "comment_id": 73336791, "body": "I should add that on Windows i have go 1.8, and on CentOS 1.6.3"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1490912381, "post_id": 43128073, "comment_id": 73337267, "body": "Or one could just use <code>GODEBUG=gctrace=1</code> and see all the details from garbage collection and the memory scavenger."}, {"owner": {"reputation": 11, "user_id": 1103870, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ed7c27d3b9c544ada0817cdd30873cb?s=128&d=identicon&r=PG", "display_name": "navij", "link": "https://stackoverflow.com/users/1103870/navij"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1490918313, "post_id": 43128073, "comment_id": 73338856, "body": "@JimB Thanks, you were absolutely right about that. I got no output from gctrace, so i started digging, and i used ReadGCStats, which showed me, that GC didn&#39;t run even once. Setting GOGC to default value (100) seems to be the answer. In my excuse i can say that i haven&#39;t encountered any info leading to the fact that GOGC variable should be set up by hands after GO installation, so i thought that GC is enabled by default."}], "tags": [], "owner": {"reputation": 401, "user_id": 3841164, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bd18c9b6f5c168eee19575431053ccc?s=128&d=identicon&r=PG", "display_name": "avertocle", "link": "https://stackoverflow.com/users/3841164/avertocle"}, "is_accepted": false, "score": 0, "last_activity_date": 1490907073, "creation_date": 1490907073, "answer_id": 43128073, "question_id": 43125928, "link": "https://stackoverflow.com/questions/43125928/golang-goroutine-endless-loop-memory-leak/43128073#43128073", "title": "Golang goroutine endless loop memory leak", "body": "<pre><code>  for {\n        var mem runtime.MemStats\n        runtime.ReadMemStats(&amp;mem)\n        fmt.Printf(\"alloc [%v] \\t heapAlloc [%v] \\n\", mem.Alloc, mem.HeapAlloc)\n        time.Sleep(2000 * time.Millisecond)\n    }\n</code></pre>\n\n<ul>\n<li>added the above lines in your main function for loop (in the leaking code link given above)</li>\n<li>new code : <a href=\"https://pastebin.com/UQbYuVN7\" rel=\"nofollow noreferrer\">https://pastebin.com/UQbYuVN7</a></li>\n<li>while running this shows that memory is being re-collected at regular intervals by gc</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1490921116, "post_id": 43130499, "comment_id": 73339477, "body": "Something else is going on in your setup. You don&#39;t need to set GOGC to turn on the GC."}, {"owner": {"reputation": 11, "user_id": 1103870, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ed7c27d3b9c544ada0817cdd30873cb?s=128&d=identicon&r=PG", "display_name": "navij", "link": "https://stackoverflow.com/users/1103870/navij"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1490923093, "post_id": 43130499, "comment_id": 73340001, "body": "Well, i have no idea on what it could be - both Win7 and CentOS have fresh installations of GO, they both have different versions, and i haven&#39;t done anything but writing some simple code in educational purposes. I have some modules from github imported, but they all seems to be trusted ones, like go-sql-driver/mysql."}], "tags": [], "owner": {"reputation": 11, "user_id": 1103870, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ed7c27d3b9c544ada0817cdd30873cb?s=128&d=identicon&r=PG", "display_name": "navij", "link": "https://stackoverflow.com/users/1103870/navij"}, "is_accepted": false, "score": -2, "last_activity_date": 1490920167, "creation_date": 1490920167, "answer_id": 43130499, "question_id": 43125928, "link": "https://stackoverflow.com/questions/43125928/golang-goroutine-endless-loop-memory-leak/43130499#43130499", "title": "Golang goroutine endless loop memory leak", "body": "<p>Thanks to <strong>JimB</strong> and his advice to set enviroment var <code>GODEBUG=gctrace=1</code>, i discovered that i had no env var GOGC set in my system, because of which garbage collector wasn't functioning at all. Setting it to <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\">default value</a> was everything that i needed.</p>\n"}], "owner": {"reputation": 11, "user_id": 1103870, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ed7c27d3b9c544ada0817cdd30873cb?s=128&d=identicon&r=PG", "display_name": "navij", "link": "https://stackoverflow.com/users/1103870/navij"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1461, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1490920167, "creation_date": 1490899183, "last_edit_date": 1490902077, "question_id": 43125928, "link": "https://stackoverflow.com/questions/43125928/golang-goroutine-endless-loop-memory-leak", "title": "Golang goroutine endless loop memory leak", "body": "<p>I have encountered strange (as for a man who is new to golang) behaviour of my goroutine:</p>\n\n<pre><code>go func(...) {\n  for {\n    buffer := make([]byte, 1024)\n     ...\n  } \n}\n</code></pre>\n\n<p>It slowly eats RAM. I understand that it is caused by calling <code>make</code> in an endless loop; it just allocates new memory every time. But i don't quite get why this construction:</p>\n\n<pre><code>  var buffer []byte\n  for {\n    buffer = make([]byte, 1024)\n     ...\n    }\n  } \n</code></pre>\n\n<p>..works well, while the first one doesn't. Shouldn't garbage collector detect that memory which old <code>buf</code> was pointing at is unreachable in both cases? And maybe there are some other similar traps that a go-newbie should know?</p>\n\n<p>Also, if i will return this goroutine, will leaked memory be freed?</p>\n\n<p><strong>UPD</strong>: full memory leaking routine code:</p>\n\n<pre><code>go func(dataChannel chan []byte, errorChannel chan error) {\n  for {\n    buf := make([]byte, 1024)\n    _, err := conn.Read(buf) \n    if err != nil {\n      errorChannel&lt;- err\n      break\n    }\n    dataChannel&lt;- buf\n  } \n} (dataChannel, errorChannel)\n</code></pre>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1490895222, "post_id": 43124427, "comment_id": 73328466, "body": "No. You have to use the <code>reflect</code> package."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1490895323, "post_id": 43124427, "comment_id": 73328529, "body": "See also <a href=\"https://stackoverflow.com/questions/23030884/is-there-a-way-to-create-an-instance-of-a-struct-from-a-string\" title=\"is there a way to create an instance of a struct from a string\">stackoverflow.com/questions/23030884/&hellip;</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1490895590, "post_id": 43124427, "comment_id": 73328692, "body": "The duplicate is a much more concise answer than mine. Thanks @JimB"}], "answers": [{"comments": [{"owner": {"reputation": 68, "user_id": 1927347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TER2W.jpg?s=128&g=1", "display_name": "fhpriamo", "link": "https://stackoverflow.com/users/1927347/fhpriamo"}, "edited": false, "score": 0, "creation_date": 1490896101, "post_id": 43124728, "comment_id": 73328980, "body": "Thank you. That&#39;s very useful."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 68, "user_id": 1927347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TER2W.jpg?s=128&g=1", "display_name": "fhpriamo", "link": "https://stackoverflow.com/users/1927347/fhpriamo"}, "edited": false, "score": 0, "creation_date": 1490896414, "post_id": 43124728, "comment_id": 73329126, "body": "The answer in the duplicate better explains what is going on."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 2, "last_activity_date": 1501192736, "last_edit_date": 1501192736, "creation_date": 1490895268, "answer_id": 43124728, "question_id": 43124427, "link": "https://stackoverflow.com/questions/43124427/is-it-possible-to-store-a-type-in-a-map-and-use-it-later-to-instantiate-an-objec/43124728#43124728", "title": "Is it possible to store a Type in a map and use it later to instantiate an object in Go lang?", "body": "<p>You can do this with the <code>reflect</code> package, though it should be noted that eventually you have to know the concrete type to really do much with it.</p>\n\n<p>EDIT: LET IT BE KNOWN. This is a very BAD idea in the first place, and if you are doing this, you should probably rethink things. Go is a statically typed language, and unless you REALLY need to use the reflect package, you should stay away from it if possible. Even then, in most cases, this has already been done for you. Take, for instance, the JSON Marshal/Unmarshaller. At its core, they do some nasty reflection stuff, but it is already taken care of for you, just use it.</p>\n\n<p>It is important to note that the type assertions (the <code>.(*Thing1)</code> lines) will <code>panic</code> if it isn't the right type. See <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/15</a></p>\n\n<p>Test on playground: <a href=\"https://play.golang.org/p/DhiTnCVJi1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DhiTnCVJi1</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Thing1 bool\n\ntype Thing2 int\n\ntype Thing3 struct {\n    Item string\n}\n\nfunc main() {\n    m := map[string]reflect.Type{}\n    var t1 Thing1\n    var t2 Thing2\n    var t3 Thing3\n    m[\"thing1\"] = reflect.TypeOf(t1)\n    m[\"thing2\"] = reflect.TypeOf(t2)\n    m[\"thing3\"] = reflect.TypeOf(t3)\n\n    // later on\n\n    // thing1\n    newT1Value := reflect.New(m[\"thing1\"])\n    // you use * here because a pointer to a boolean type isn't useful\n    newT1 := *newT1Value.Interface().(*Thing1) // cast to concrete type\n\n    fmt.Printf(\"T1: %v\\n\", newT1)\n\n    // thing2\n    newT2Value := reflect.New(m[\"thing2\"])\n    // you use * here because a pointer to an int type isn't useful\n    newT2 := *newT2Value.Interface().(*Thing2)\n\n    fmt.Printf(\"T2: %v\\n\", newT2)\n\n    // thing3\n    newT3Value := reflect.New(m[\"thing3\"])\n    // you can choose to use * or not here. Pointers to structs are actually useful\n    newT3 := newT3Value.Interface().(*Thing3)\n    newT3.Item = \"Hello world\"\n\n    fmt.Printf(\"T3: %#v\\n\", newT3)\n}\n</code></pre>\n"}], "owner": {"reputation": 68, "user_id": 1927347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TER2W.jpg?s=128&g=1", "display_name": "fhpriamo", "link": "https://stackoverflow.com/users/1927347/fhpriamo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "closed_date": 1490895309, "answer_count": 1, "score": 0, "last_activity_date": 1501192736, "creation_date": 1490894281, "question_id": 43124427, "link": "https://stackoverflow.com/questions/43124427/is-it-possible-to-store-a-type-in-a-map-and-use-it-later-to-instantiate-an-objec", "closed_reason": "Duplicate", "title": "Is it possible to store a Type in a map and use it later to instantiate an object in Go lang?", "body": "<p>I am new to Go and I have this problem. I need to make a kind of \"dispatcher\" that will receive a string and return a type to be instantiated based on the string. For example:</p>\n\n<pre><code>AnimalType := mymap[\"animal\"]\nnewAnimal := new(AnimalType)\n</code></pre>\n\n<p>Is there a way to do so?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["logging", "go"], "answers": [{"tags": [], "owner": {"reputation": 39, "user_id": 5196278, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206755781400589/picture?type=large", "display_name": "George Chen", "link": "https://stackoverflow.com/users/5196278/george-chen"}, "is_accepted": false, "score": 3, "last_activity_date": 1493621610, "creation_date": 1493621610, "answer_id": 43715417, "question_id": 43123871, "link": "https://stackoverflow.com/questions/43123871/how-can-i-use-go-uber-org-zap-lib-to-print-different-color-with-different-log-le/43715417#43715417", "title": "How can I use go.uber.org/zap lib to print different color with different log level and append log to different file depend on the log level?", "body": "<p>Just met the same issue, and here are some code snippets for enable colors:</p>\n\n<pre><code>config := zap.NewDevelopmentConfig()\nconfig.EncoderConfig.EncodeLevel = zapcore.CapitalColorLevelEncoder\nlogger, _ := config.Build()\n\nlogger.Info(\"Now logs should be colored\")\n</code></pre>\n\n<p>reference: <a href=\"https://github.com/uber-go/zap/pull/307\" rel=\"nofollow noreferrer\">https://github.com/uber-go/zap/pull/307</a></p>\n"}], "owner": {"reputation": 642, "user_id": 2089343, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/63681b191138560e5d3b203e43927d55?s=128&d=identicon&r=PG", "display_name": "savior", "link": "https://stackoverflow.com/users/2089343/savior"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3262, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1493621610, "creation_date": 1490892552, "question_id": 43123871, "link": "https://stackoverflow.com/questions/43123871/how-can-i-use-go-uber-org-zap-lib-to-print-different-color-with-different-log-le", "title": "How can I use go.uber.org/zap lib to print different color with different log level and append log to different file depend on the log level?", "body": "<p>I start to use the zap log lib for my go project. I want to print the different color to tty console dependent on the log level.</p>\n\n<p>I find the <code>zap/internal/color</code> can display different color for string, But I want to change the log level with different color.</p>\n\n<p>I also want to write the log to some log files with different log level.</p>\n\n<p>How to init and config the zap log? </p>\n"}, {"tags": ["git", "github", "go"], "answers": [{"comments": [{"owner": {"reputation": 750, "user_id": 1748069, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QOMeY.jpg?s=128&g=1", "display_name": "Matthew S", "link": "https://stackoverflow.com/users/1748069/matthew-s"}, "edited": false, "score": 0, "creation_date": 1490906732, "post_id": 43124017, "comment_id": 73334800, "body": "Thanks this worked. Repos show up twice in GitList, but can live with this."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 1, "last_activity_date": 1490892979, "creation_date": 1490892979, "answer_id": 43124017, "question_id": 43123664, "link": "https://stackoverflow.com/questions/43123664/go-get-from-private-git-repository-fails-due-to-git-in-url/43124017#43124017", "title": "Go get from private git repository fails due to .git in url", "body": "<p>On the repo server, use a soft link along side each of the repos. So in this case, just do a </p>\n\n<pre><code>ln -s helloworld.git helloworld\n</code></pre>\n\n<p>and it should work based on the fact that the rename worked.</p>\n\n<p>Um, if it's a Windows server... I'm sure you can google a way to create a soft link, sometimes called a symlink.</p>\n"}], "owner": {"reputation": 750, "user_id": 1748069, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QOMeY.jpg?s=128&g=1", "display_name": "Matthew S", "link": "https://stackoverflow.com/users/1748069/matthew-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 43124017, "answer_count": 1, "score": 1, "last_activity_date": 1490906372, "creation_date": 1490891882, "last_edit_date": 1490906372, "question_id": 43123664, "link": "https://stackoverflow.com/questions/43123664/go-get-from-private-git-repository-fails-due-to-git-in-url", "title": "Go get from private git repository fails due to .git in url", "body": "<p>When using github.com, the url used to browse to a repo does not contain the .git extension:</p>\n\n<ul>\n<li><a href=\"https://github.com/someuser/helloworld\" rel=\"nofollow noreferrer\">https://github.com/someuser/helloworld</a></li>\n</ul>\n\n<p>but the \"clone with https\" url does:</p>\n\n<ul>\n<li><a href=\"https://github.com/someuser/helloworld.git\" rel=\"nofollow noreferrer\">https://github.com/someuser/helloworld.git</a></li>\n</ul>\n\n<p>And you go get it like this:</p>\n\n<p><code>go get github.com/someuser/helloworld</code></p>\n\n<p>In our private git repo, we create bare repos in a directory ending in .git (based on convention):</p>\n\n<ul>\n<li>helloworld.git</li>\n</ul>\n\n<p>But the url (served using <a href=\"https://github.com/klaussilveira/gitlist\" rel=\"nofollow noreferrer\">https://github.com/klaussilveira/gitlist</a>) to browse to the repo also contains .git:</p>\n\n<ul>\n<li><a href=\"https://git.test.net/helloworld.git\" rel=\"nofollow noreferrer\">https://git.test.net/helloworld.git</a></li>\n</ul>\n\n<p>This causes go get to fail because it doesn't expect the .git:</p>\n\n<pre><code>C:\\&gt;go get -u -f -insecure git.test.net/helloworld.git\n# cd .; git clone git.test.net/helloworld   C:\\Temp\\golang\\src\\git.test.net\\helloworld.git\nfatal: repository 'git.test.net/helloworld' does not exist\npackage git.test.net/helloworld.git: exit status 128\n</code></pre>\n\n<p>Leaving off the .git part also fails:</p>\n\n<pre><code>C:\\&gt;go get -u -f -insecure git.test.net/helloworld\n    package git.test.net/helloworld: unrecognized import path \"git.test.net/helloworld\" (parse https://git.test.net/helloworld?go-get=1: no go-impor\n    t meta tags ())\n</code></pre>\n\n<p>Renaming the bare repo to just helloworld solves the problem. But this isn't the convention. </p>\n\n<p>What am I missing? Is there a server setting we are missing so that we can leave off the .git extension when browsing? Should we just just leave off .git when naming the bare repo? Why does github.com have different behavior?</p>\n"}]