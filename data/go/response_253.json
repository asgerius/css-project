[{"tags": ["go", "zip"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 1, "creation_date": 1573683339, "post_id": 58846315, "comment_id": 103966559, "body": "ZIP files don&#39;t have folders as a separate entry, i.e. you cannot create a directory in zip. But they might have files which have a path with new folders which will then create the needed directories when extracting with the right options."}, {"owner": {"reputation": 2015, "user_id": 2343739, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hetYc.jpg?s=128&g=1", "display_name": "Collin M. Barrett", "link": "https://stackoverflow.com/users/2343739/collin-m-barrett"}, "edited": false, "score": 0, "creation_date": 1573683649, "post_id": 58846315, "comment_id": 103966664, "body": "What does the code in your question do so far? Is there an error? Unexpected result?"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 12369431, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAPaY9OoXgW0allGGB083eSFFx2uxrH_OXMrcBFWg=k-s128", "display_name": "Juan Camilo Betancourt Giraldo", "link": "https://stackoverflow.com/users/12369431/juan-camilo-betancourt-giraldo"}, "edited": false, "score": 0, "creation_date": 1573684520, "post_id": 58846437, "comment_id": 103966996, "body": "thank you very much, it worked just the way i wanted it"}], "tags": [], "owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "is_accepted": true, "score": 0, "last_activity_date": 1573683665, "last_edit_date": 1573683665, "creation_date": 1573683286, "answer_id": 58846437, "question_id": 58846315, "link": "https://stackoverflow.com/questions/58846315/i-am-new-to-golang-i-am-trying-to-create-a-zip-that-must-have-a-folder-inside-t/58846437#58846437", "title": "I am new to golang, I am trying to create a zip that must have a folder inside that is: tosend.zip/archivos/file.png", "body": "<p>You are almost there.  A file name can contain directories. \n Use this code:</p>\n\n<pre><code>zipWriter := zip.NewWriter(newZip)\nw, err := zipWriter.Create(\"archivos/file.png\") // &lt;-- use full path here\nif err != nil {\n    return \"\", err\n}\nw.Write(pngData)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/W7AcgBI3Tcl\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n"}], "owner": {"reputation": 3, "user_id": 12369431, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAPaY9OoXgW0allGGB083eSFFx2uxrH_OXMrcBFWg=k-s128", "display_name": "Juan Camilo Betancourt Giraldo", "link": "https://stackoverflow.com/users/12369431/juan-camilo-betancourt-giraldo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 58846437, "answer_count": 1, "score": 0, "last_activity_date": 1573683665, "creation_date": 1573682599, "last_edit_date": 1573682667, "question_id": 58846315, "link": "https://stackoverflow.com/questions/58846315/i-am-new-to-golang-i-am-trying-to-create-a-zip-that-must-have-a-folder-inside-t", "title": "I am new to golang, I am trying to create a zip that must have a folder inside that is: tosend.zip/archivos/file.png", "body": "<pre><code>newZip, err := os.Create(\"./temp/tosend.zip\")\nif err != nil {\n    return \"\", err\n}\ndefer newZip.Close()\n\nzipWriter := zip.NewWriter(newZip)\n_, err = zipWriter.Create(\"archivos/\")\nif err != nil {\n    return \"\", err\n}\ndefer zipWriter.Close()\n</code></pre>\n"}, {"tags": ["go", "google-cloud-firestore", "gcloud"], "comments": [{"owner": {"reputation": 4765, "user_id": 3945408, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0jXTc.jpg?s=128&g=1", "display_name": "Juan Lara", "link": "https://stackoverflow.com/users/3945408/juan-lara"}, "edited": false, "score": 0, "creation_date": 1573765011, "post_id": 58846124, "comment_id": 104002130, "body": "Just to make sure, did you set the <code>FIRESTORE_EMULATOR_HOST=::1:PORT</code> env variable to connect your app to the emulator?"}, {"owner": {"reputation": 105, "user_id": 11843526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f12747264bfd62cf5cb57d00d7728d?s=128&d=identicon&r=PG&f=1", "display_name": "GolangNewb", "link": "https://stackoverflow.com/users/11843526/golangnewb"}, "reply_to_user": {"reputation": 4765, "user_id": 3945408, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0jXTc.jpg?s=128&g=1", "display_name": "Juan Lara", "link": "https://stackoverflow.com/users/3945408/juan-lara"}, "edited": false, "score": 0, "creation_date": 1573772467, "post_id": 58846124, "comment_id": 104004895, "body": "No, I did not do that. I&#39;m just running some tests with &quot;go test&quot;"}, {"owner": {"reputation": 4765, "user_id": 3945408, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0jXTc.jpg?s=128&g=1", "display_name": "Juan Lara", "link": "https://stackoverflow.com/users/3945408/juan-lara"}, "edited": false, "score": 1, "creation_date": 1573773681, "post_id": 58846124, "comment_id": 104005292, "body": "If you didn&#39;t set <code>FIRESTORE_EMULATOR_HOST</code>, then you are probably connecting to your project&#39;s Cloud Firestore database instead of the local emulator. Is your goal to use the emulator for local testing? Note that the emulator is optional. If you are creating trivial apps to learn, you should be fine connecting to your real database and using the <a href=\"https://cloud.google.com/firestore/quotas#free-quota\" rel=\"nofollow noreferrer\">free quota</a>."}], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 11843526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f12747264bfd62cf5cb57d00d7728d?s=128&d=identicon&r=PG&f=1", "display_name": "GolangNewb", "link": "https://stackoverflow.com/users/11843526/golangnewb"}, "edited": false, "score": 0, "creation_date": 1573734843, "post_id": 58846278, "comment_id": 103985183, "body": "How is the data persisting after a reboot of the dev computer? This looks like a Node.js snippet. I&#39;m coding in Golang."}], "tags": [], "owner": {"reputation": 428, "user_id": 11370121, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/V21op.png?s=128&g=1", "display_name": "Pyth0nGh057", "link": "https://stackoverflow.com/users/11370121/pyth0ngh057"}, "is_accepted": false, "score": 1, "last_activity_date": 1573682388, "creation_date": 1573682388, "answer_id": 58846278, "question_id": 58846124, "link": "https://stackoverflow.com/questions/58846124/how-to-delete-all-documents-from-gcloud-beta-emulators-firestore/58846278#58846278", "title": "How to delete all documents from Gcloud beta emulators firestore?", "body": "<p>You can use this:</p>\n\n<pre><code>module.exports.teardown = async () =&gt; {\n  Promise.all(firebase.apps().map(app =&gt; app.delete()));\n};\n</code></pre>\n\n<p>Now, each time you call <code>teardown</code>, you will delete all data from the Firestore emulator.</p>\n"}, {"tags": [], "owner": {"reputation": 4765, "user_id": 3945408, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0jXTc.jpg?s=128&g=1", "display_name": "Juan Lara", "link": "https://stackoverflow.com/users/3945408/juan-lara"}, "is_accepted": false, "score": 4, "last_activity_date": 1573764806, "last_edit_date": 1573764806, "creation_date": 1573764191, "answer_id": 58866194, "question_id": 58846124, "link": "https://stackoverflow.com/questions/58846124/how-to-delete-all-documents-from-gcloud-beta-emulators-firestore/58866194#58866194", "title": "How to delete all documents from Gcloud beta emulators firestore?", "body": "<p>The emulator supports an endpoint to clear the database (<a href=\"https://firebase.google.com/docs/emulator-suite/connect_and_prototype#clear_your_database_between_tests\" rel=\"nofollow noreferrer\">docs</a>):</p>\n\n<pre><code>curl -v -X DELETE \"http://localhost:PORT/emulator/v1/projects/PROJECT_NAME/databases/(default)/documents\"\n</code></pre>\n\n<p>Fill in the <code>PORT</code> and <code>PROJECT_NAME</code>.</p>\n"}], "owner": {"reputation": 105, "user_id": 11843526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f12747264bfd62cf5cb57d00d7728d?s=128&d=identicon&r=PG&f=1", "display_name": "GolangNewb", "link": "https://stackoverflow.com/users/11843526/golangnewb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 691, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1573773057, "creation_date": 1573681630, "last_edit_date": 1573773057, "question_id": 58846124, "link": "https://stackoverflow.com/questions/58846124/how-to-delete-all-documents-from-gcloud-beta-emulators-firestore", "title": "How to delete all documents from Gcloud beta emulators firestore?", "body": "<p>I'm creating some trivial apps to learn Firestore. </p>\n\n<p>I started the local Firestore Emulator with:   </p>\n\n<p>$ gcloud beta emulator firestore start </p>\n\n<p>After starting the emulator, I ran tests with \"go test\" </p>\n\n<p>I populated the Firestore with data and created a function that queried some of the records/documents added. </p>\n\n<p>I deleted some of the Documents from my app but they continue to show up in Queries. </p>\n\n<p>I tried:</p>\n\n<ul>\n<li><p>stoping with ctrl-c and ctrl d  </p></li>\n<li><p>$ gcloud beta emulator firestore stop</p></li>\n<li><p>restarted my Macbook but the Documents persist.</p></li>\n</ul>\n\n<p>I don't understand how the datastore is persisting after restarting the computer, I'm guessing that the data is stored in a JSON file or something like that. </p>\n\n<p>I searched but was not able to find any documentation on the emulator. </p>\n\n<p><strong>Am I supposed to start the emulator and then run tests against the emulated Firestore?</strong>  </p>\n\n<p><strong>How do I flush the Firestore?</strong>  </p>\n"}, {"tags": ["go", "post", "struct", "mux"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573675574, "post_id": 58844656, "comment_id": 103963246, "body": "I would argue you don&#39;t need that, you don&#39;t need to know whether or not the json matches the struct, all you need to know is whether or not the struct instance, into which you decoded that json, represents a valid instance of the &quot;model&quot;. If however you&#39;re certain you need to constrain what comes through the wire to exactly match, <i>in structure</i>, some pre-defined schema, then you can&#39;t do it with the standard encoding/json library. You either have to look for a 3rd party lib, or implement your own json-structure-matching solution."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11217893"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573676408, "post_id": 58844656, "comment_id": 103963612, "body": "thanks for the insight!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573676716, "post_id": 58844656, "comment_id": 103963741, "body": "You can&#39;t check if &quot;JSON matches a struct&quot;. It&#39;s comparing apples to oranges. You can serialize a struct and see if the JSON you get matches the JSON you expect, or you can deserialize JSON into a struct and see if the struct you get matches the struct you expect. But comparing a struct to JSON is like comparing Argentina to apple pie."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11217893"}, "edited": false, "score": 0, "creation_date": 1573676420, "post_id": 58844835, "comment_id": 103963619, "body": "thanks for the detailed response! ill give this a shot"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1573675763, "creation_date": 1573675763, "answer_id": 58844835, "question_id": 58844656, "link": "https://stackoverflow.com/questions/58844656/validating-post-json-body-matches-struct/58844835#58844835", "title": "Validating POST JSON body matches struct", "body": "<p>There are multiple ways you can achieve this, with different levels of strictness:</p>\n\n<ul>\n<li><p>You can check if UserID and UserName are nonempty. This will not validate if the input matches the structure. It only captures the userid and name if those fields appear in the input.</p></li>\n<li><p>If empty values are acceptable, you can use <code>*string</code> instead of <code>string</code>, and check if the pointer is nil. If the pointer is nil, that field does not appear in the JSON, or it appears as nil. If it appears as empty string, the pointer will not be nil, but the string will be empty. This method also accepts if there are additional fields in the submitted JSON.</p></li>\n<li><p>For this specific case, if you want to make sure no additional unrecognized fields are passed, you can unmarshal the body into <code>interface{}</code>, and make sure it contains at most two fields, and that those are the fields you recognize.</p></li>\n</ul>\n\n<p>In general if you need to do strict validation, you can use a json schema, and check if input validates against the schema you expect. This is usually more trouble than it is worth.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11217893"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1573675763, "creation_date": 1573674948, "question_id": 58844656, "link": "https://stackoverflow.com/questions/58844656/validating-post-json-body-matches-struct", "title": "Validating POST JSON body matches struct", "body": "<p>I'm having trouble validating if JSON body passed to my POST endpoints matches the struct created for the acceptable JSON body. Any help would be appreciated</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type NewUser struct {\n    UserID   string `json:\"user_id\"`\n    UserName string `json:\"user_name\"`\n}\n\nfunc AddUser(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json\")\n\n    decoder := json.NewDecoder(r.Body)\n\n    var user NewUser\n    err := decoder.Decode(&amp;user)\n\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusBadRequest)\n    }\n    user.UserID != NewUser.UserID{\n        http.Error(w, \"error\", http.StatusBadRequest),\n    }\n\n}\n</code></pre>\n"}, {"tags": ["go", "jsonb", "cockroachdb"], "comments": [{"owner": {"reputation": 507123, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1573728837, "post_id": 58843121, "comment_id": 103982023, "body": "I assume your actual code doesn&#39;t have a quotes problem (<code>\u2018</code>vs<code>&#39;</code>, <code>\u201c</code>vs<code>&quot;</code>)?"}], "answers": [{"comments": [{"owner": {"reputation": 155, "user_id": 8287030, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d60020766c26e9acb8c0f898921333f9?s=128&d=identicon&r=PG&f=1", "display_name": "cpuNram", "link": "https://stackoverflow.com/users/8287030/cpunram"}, "edited": false, "score": 0, "creation_date": 1573702525, "post_id": 58845263, "comment_id": 103971182, "body": "I like <a href=\"https://www.postgresql.org/docs/12/functions-json.html#FUNCTIONS-JSONB-OP-TABLE\" rel=\"nofollow noreferrer\">the <code>||</code> operator</a> solution. But I ran into different error (edited my post with new code)."}, {"owner": {"reputation": 507123, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 155, "user_id": 8287030, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d60020766c26e9acb8c0f898921333f9?s=128&d=identicon&r=PG&f=1", "display_name": "cpuNram", "link": "https://stackoverflow.com/users/8287030/cpunram"}, "edited": false, "score": 0, "creation_date": 1573729383, "post_id": 58845263, "comment_id": 103982336, "body": "Hm, does it work when you hardcode the values? I&#39;m not sure how parameterised queries work in Go."}, {"owner": {"reputation": 155, "user_id": 8287030, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d60020766c26e9acb8c0f898921333f9?s=128&d=identicon&r=PG&f=1", "display_name": "cpuNram", "link": "https://stackoverflow.com/users/8287030/cpunram"}, "edited": false, "score": 0, "creation_date": 1573735344, "post_id": 58845263, "comment_id": 103985507, "body": "Yes, the hard coded values does work (I tried with fmt.Sprintf()). But parametrised values seems avoid the SQL injections, so I was leaning for it. I also tried passing \u2018\u201cstring\u201d\u2019 kind of parameters, it did not work."}, {"owner": {"reputation": 507123, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 155, "user_id": 8287030, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d60020766c26e9acb8c0f898921333f9?s=128&d=identicon&r=PG&f=1", "display_name": "cpuNram", "link": "https://stackoverflow.com/users/8287030/cpunram"}, "edited": false, "score": 0, "creation_date": 1573739100, "post_id": 58845263, "comment_id": 103987704, "body": "Hm, according to <a href=\"https://www.calhoun.io/inserting-records-into-a-postgresql-database-with-gos-database-sql-package/\" rel=\"nofollow noreferrer\">this article</a>, you&#39;re doing everything right..."}, {"owner": {"reputation": 507123, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 155, "user_id": 8287030, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d60020766c26e9acb8c0f898921333f9?s=128&d=identicon&r=PG&f=1", "display_name": "cpuNram", "link": "https://stackoverflow.com/users/8287030/cpunram"}, "edited": false, "score": 0, "creation_date": 1573739405, "post_id": 58845263, "comment_id": 103987867, "body": "Oh, I guess I was confused by the &quot;placeholder&quot; term in the error message. I guess that Postgres simply cannot infer the type of the expression from the context (because <code>jsonb_build_object</code> takes <code>any</code>) and doesn&#39;t derive it dynamically from the value you are passing as a parameter. So let&#39;s be explicit that these will be strings. If you were going to put a number or boolean or json in the property, specify that instead."}, {"owner": {"reputation": 155, "user_id": 8287030, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d60020766c26e9acb8c0f898921333f9?s=128&d=identicon&r=PG&f=1", "display_name": "cpuNram", "link": "https://stackoverflow.com/users/8287030/cpunram"}, "edited": false, "score": 0, "creation_date": 1573750499, "post_id": 58845263, "comment_id": 103994858, "body": "I specified the types for the updated properties as <code>$1::string and $2::string</code>. This time <code>db.Exec()</code> is successful. But it did not really update the row."}, {"owner": {"reputation": 155, "user_id": 8287030, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d60020766c26e9acb8c0f898921333f9?s=128&d=identicon&r=PG&f=1", "display_name": "cpuNram", "link": "https://stackoverflow.com/users/8287030/cpunram"}, "edited": false, "score": 0, "creation_date": 1573753814, "post_id": 58845263, "comment_id": 103996659, "body": "Yep, <code>WHERE key = $3</code> seems working fine because its not part of <code>jsonb</code>."}, {"owner": {"reputation": 155, "user_id": 8287030, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d60020766c26e9acb8c0f898921333f9?s=128&d=identicon&r=PG&f=1", "display_name": "cpuNram", "link": "https://stackoverflow.com/users/8287030/cpunram"}, "edited": false, "score": 1, "creation_date": 1573760663, "post_id": 58845263, "comment_id": 103999812, "body": "I did enable the cockroachdb sql logging on a node. And I could see the issue quickly. @Bergi, your recommendations were perfect - jsonb properties need to have type specified, in my case it is <code>$1::string and $2::string</code> or <code>$1::text and $2::text</code>."}], "tags": [], "owner": {"reputation": 507123, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "is_accepted": true, "score": 2, "last_activity_date": 1573739250, "last_edit_date": 1573739250, "creation_date": 1573677513, "answer_id": 58845263, "question_id": 58843121, "link": "https://stackoverflow.com/questions/58843121/how-to-update-few-fields-of-jsonb-in-golang-cockroachdb/58845263#58845263", "title": "how to update few fields of jsonb in golang cockroachdb", "body": "<p>To update individual properties of a jsonb object, use <a href=\"https://www.postgresql.org/docs/12/functions-json.html#FUNCTIONS-JSON-PROCESSING-TABLE\" rel=\"nofollow noreferrer\"><code>jsonb_set</code></a>:</p>\n\n<pre><code>UPDATE myTable SET value = jsonb_set(value, '{degree}', $1::text) WHERE key = $2\n</code></pre>\n\n<p>You can nest the calls to do multiple updates:</p>\n\n<pre><code>UPDATE myTable SET value = jsonb_set(jsonb_set(value, '{degree}', $1::text), '{university}', $2::text) WHERE key = $3\n</code></pre>\n\n<p>Alternatively, you can also simply use <a href=\"https://www.postgresql.org/docs/12/functions-json.html#FUNCTIONS-JSONB-OP-TABLE\" rel=\"nofollow noreferrer\">the <code>||</code> operator</a> to merge new values into the object:</p>\n\n<pre><code>UPDATE myTable SET value = value || jsonb_build_object('degree', $1::text, 'university', $2::text) WHERE key = $3\n</code></pre>\n"}], "owner": {"reputation": 155, "user_id": 8287030, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d60020766c26e9acb8c0f898921333f9?s=128&d=identicon&r=PG&f=1", "display_name": "cpuNram", "link": "https://stackoverflow.com/users/8287030/cpunram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "accepted_answer_id": 58845263, "answer_count": 1, "score": 0, "last_activity_date": 1573760809, "creation_date": 1573668543, "last_edit_date": 1573760809, "question_id": 58843121, "link": "https://stackoverflow.com/questions/58843121/how-to-update-few-fields-of-jsonb-in-golang-cockroachdb", "title": "how to update few fields of jsonb in golang cockroachdb", "body": "<p>I have table in cockroachdb  as below:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>         key        |                          value                           \n+-------------------+---------------------------------------------------------+\n  &lt;host_ipa&gt;        | {\u201cstudent_name\": \u201cJohn\", \u201cdegree\": \u201cBachelors\u201d, \u201cuniversity\u201d: \u201cKU\u201d, \u201cCompany\u201d: \u201cABC\"}  \n</code></pre>\n\n<p>Now I want to update only two keys of the <code>jsonb</code> - <code>degree</code> and <code>university</code>. How do I do that?</p>\n\n<p>I have a solution but that requires all the four fields needs to be supplied.</p>\n\n<p>Here is what I have in golang:</p>\n\n<pre><code>sqlCmd := fmt.Sprintf(\" UPDATE %v set value = json_object('{%v, %v, %v, %v}'::string[], '{%v, %v, %v, %v}'::string[]) WHERE key = '%v' \",\n        myTable,\n        strconv.Quote(\"student_name\u201d),\n        strconv.Quote(\"degree\"),\n        strconv.Quote(\u201cuniversity\u201d),\n        strconv.Quote(\"Company\"),\n        strconv.Quote(student),\n        strconv.Quote(newDegree),\n        strconv.Quote(newUniversity),\n        strconv.Quote(company),\n        host)\n    db, err := sql.Open(dbDriver, DBConnStr)\n    _, err = db.Exec(sqlCmd)\n</code></pre>\n\n<p>Working solution based on @Bergi:</p>\n\n<pre><code>    db, err := sql.Open(dbDriver, DBConnStr)    \n    sqlCmd := \"UPDATE \" + myTable + \" SET value = value || jsonb_build_object(\u2018degree', $1::string, \u2018university', $2::string) WHERE key = $3\"\n    _, err = db.Exec(sqlCmd, newDegree, newUniversity, host)\n</code></pre>\n"}, {"tags": ["go", "protocol-buffers", "kafka-producer-api"], "answers": [{"comments": [{"owner": {"reputation": 485, "user_id": 5095986, "user_type": "registered", "profile_image": "https://graph.facebook.com/973132866052084/picture?type=large", "display_name": "Shivangi Singh", "link": "https://stackoverflow.com/users/5095986/shivangi-singh"}, "edited": false, "score": 0, "creation_date": 1573855635, "post_id": 58872951, "comment_id": 104037749, "body": "Thank you appreciate it."}], "tags": [], "owner": {"reputation": 1922, "user_id": 1458740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86967303e8817802edc66095b7fa0492?s=128&d=identicon&r=PG", "display_name": "Ilya", "link": "https://stackoverflow.com/users/1458740/ilya"}, "is_accepted": false, "score": 4, "last_activity_date": 1573817297, "last_edit_date": 1573817297, "creation_date": 1573806308, "answer_id": 58872951, "question_id": 58842792, "link": "https://stackoverflow.com/questions/58842792/how-do-i-send-protobuf-messages-via-a-kafka-producer/58872951#58872951", "title": "How do I send Protobuf Messages via a Kafka Producer", "body": "<p>You need to use <a href=\"https://godoc.org/github.com/golang/protobuf/proto#Marshal\" rel=\"nofollow noreferrer\">proto#Marshal</a> and <a href=\"https://godoc.org/github.com/Shopify/sarama#ByteEncoder\" rel=\"nofollow noreferrer\">sarama#ByteEncoder</a> on producer side and <a href=\"https://godoc.org/github.com/golang/protobuf/proto#Unmarshal\" rel=\"nofollow noreferrer\">proto#Unmarshal</a> on consumer side.</p>\n\n<hr>\n\n<p>Producer:</p>\n\n<pre><code>            pixelToSend := &amp;pixel.Pixel{SessionId: t.String()}\n            pixelToSendBytes, err := proto.Marshal(pixelToSend)\n            if err != nil {\n                log.Fatalln(\"Failed to marshal pixel:\", err)\n            }\n\n            msg := &amp;sarama.ProducerMessage{\n                Topic: topic,\n                Value: sarama.ByteEncoder(pixelToSendBytes),\n            }\n</code></pre>\n\n<p>Consumer:</p>\n\n<pre><code>        receivedPixel := &amp;pixel.Pixel{}\n        err := proto.Unmarshal(msg.Value, receivedPixel)\n        if err != nil {\n            log.Fatalln(\"Failed to unmarshal pixel:\", err)\n        }\n\n        log.Printf(\"Pixel received: %s\", receivedPixel)\n</code></pre>\n\n<hr>\n\n<p>Complete example:</p>\n\n<pre><code>package main\n\nimport (\n    pixel \"example/pixel\"\n    \"log\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n    \"time\"\n\n    \"github.com/Shopify/sarama\"\n    \"github.com/golang/protobuf/proto\"\n)\n\nfunc main() {\n    topic := \"your-topic-name\"\n    brokerList := []string{\"localhost:29092\"}\n\n    producer, err := newSyncProducer(brokerList)\n    if err != nil {\n        log.Fatalln(\"Failed to start Sarama producer:\", err)\n    }\n\n    go func() {\n        ticker := time.NewTicker(time.Second)\n        for {\n            select {\n            case t := &lt;-ticker.C:\n                pixelToSend := &amp;pixel.Pixel{SessionId: t.String()}\n                pixelToSendBytes, err := proto.Marshal(pixelToSend)\n                if err != nil {\n                    log.Fatalln(\"Failed to marshal pixel:\", err)\n                }\n\n                msg := &amp;sarama.ProducerMessage{\n                    Topic: topic,\n                    Value: sarama.ByteEncoder(pixelToSendBytes),\n                }\n\n                producer.SendMessage(msg)\n                log.Printf(\"Pixel sent: %s\", pixelToSend)\n            }\n        }\n\n    }()\n\n    signals := make(chan os.Signal, 1)\n    signal.Notify(signals, syscall.SIGHUP, syscall.SIGINT, syscall.SIGTERM)\n\n    partitionConsumer, err := newPartitionConsumer(brokerList, topic)\n    if err != nil {\n        log.Fatalln(\"Failed to create Sarama partition consumer:\", err)\n    }\n\n    log.Println(\"Waiting for messages...\")\n\n    for {\n        select {\n        case msg := &lt;-partitionConsumer.Messages():\n            receivedPixel := &amp;pixel.Pixel{}\n            err := proto.Unmarshal(msg.Value, receivedPixel)\n            if err != nil {\n                log.Fatalln(\"Failed to unmarshal pixel:\", err)\n            }\n\n            log.Printf(\"Pixel received: %s\", receivedPixel)\n        case &lt;-signals:\n            log.Print(\"Received termination signal. Exiting.\")\n            return\n        }\n    }\n}\n\nfunc newSyncProducer(brokerList []string) (sarama.SyncProducer, error) {\n    config := sarama.NewConfig()\n    config.Producer.Return.Successes = true\n    // TODO configure producer\n\n    producer, err := sarama.NewSyncProducer(brokerList, config)\n    if err != nil {\n        return nil, err\n    }\n\n    return producer, nil\n}\n\nfunc newPartitionConsumer(brokerList []string, topic string) (sarama.PartitionConsumer, error) {\n    conf := sarama.NewConfig()\n    // TODO configure consumer\n    consumer, err := sarama.NewConsumer(brokerList, conf)\n    if err != nil {\n        return nil, err\n    }\n\n    partitionConsumer, err := consumer.ConsumePartition(topic, 0, sarama.OffsetOldest)\n    if err != nil {\n        return nil, err\n    }\n\n    return partitionConsumer, err\n}\n</code></pre>\n"}], "owner": {"reputation": 485, "user_id": 5095986, "user_type": "registered", "profile_image": "https://graph.facebook.com/973132866052084/picture?type=large", "display_name": "Shivangi Singh", "link": "https://stackoverflow.com/users/5095986/shivangi-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2439, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1573817297, "creation_date": 1573667177, "last_edit_date": 1573725155, "question_id": 58842792, "link": "https://stackoverflow.com/questions/58842792/how-do-i-send-protobuf-messages-via-a-kafka-producer", "title": "How do I send Protobuf Messages via a Kafka Producer", "body": "<p>I am using the Sarama Library to send messages through a Producer. \nThis allows me to send strings. My goal is to send Protobuf Messages</p>\n\n<pre><code>msg := &amp;sarama.ProducerMessage{\n            Topic: *topic,\n            Value: sarama.StringEncoder(content),\n        }\n</code></pre>\n\n<p>This is a sample proto class that I have</p>\n\n<pre><code>message Pixel {\n\n    // Session identifier stuff\n    int64 timestamp    = 1; // Milliseconds from the epoch\n    string session_id  = 2; // Unique Identifier... for parent level0top\n    string client_name = 3; // Client-name/I-key\n\n    string ip = 10;\n    repeated string ip_list = 11;\n    string datacenter = 12;\n    string proxy_type = 13;\n\n</code></pre>\n\n<p>Please can you provide me an example of how I can send protobuf messages.</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 462, "user_id": 5501519, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70aaf3fc9e68d91d91af0fb761576dcb?s=128&d=identicon&r=PG&f=1", "display_name": "Vatsal", "link": "https://stackoverflow.com/users/5501519/vatsal"}, "edited": false, "score": 0, "creation_date": 1573671542, "post_id": 58842281, "comment_id": 103961423, "body": "Check if you have set it up properly <a href=\"https://github.com/golang/go/wiki/SettingGOPATH\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/SettingGOPATH</a>"}, {"owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "edited": false, "score": 0, "creation_date": 1573713007, "post_id": 58842281, "comment_id": 103973969, "body": "use Go Jetbrains"}], "owner": {"reputation": 75, "user_id": 11664014, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61718dd62bbaf20379fd3ba65f8df397?s=128&d=identicon&r=PG&f=1", "display_name": "navigante", "link": "https://stackoverflow.com/users/11664014/navigante"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 126, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1573665105, "creation_date": 1573665105, "question_id": 58842281, "link": "https://stackoverflow.com/questions/58842281/vs-code-uses-its-wrong-env-of-goroot", "title": "VS code uses its wrong env of GOROOT", "body": "<p>I am using VS Code as my editor for Golang projects, a couple of days ago it started highlighting package definitions as syntax errors, saying \"Cannot find GOROOT\". Either I cannot run or compile my Golang programs via VS Code terminal, but it works fine in Ubuntu terminal. Exporting GOROOT=\"\" in VS Code terminal allows me to run and compile programs, but incorrect syntax highlighting still remains. I already tried removing VS Code completely and installing it again. Any ideas what might cause the problem?</p>\n"}, {"tags": ["json", "go", "cryptography"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1573662374, "post_id": 58840982, "comment_id": 103956992, "body": "It sounds like you have some code you&#39;re having trouble with. Please edit your question to include the exact error message, and the code you have that&#39;s producing the error - if possible as a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">Minimal, Reproducible Example</a>."}, {"owner": {"reputation": 21, "user_id": 12356687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5faec2e3c2b8287d99103b1a96059e5b?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/12356687/omar"}, "edited": false, "score": 0, "creation_date": 1573674576, "post_id": 58840982, "comment_id": 103962779, "body": "done and thank you"}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1574119665, "post_id": 58840982, "comment_id": 104110363, "body": "It is better to try and <i>binary encode</i> and <i>decode</i> the public key value. There are standards for storing EC public keys and if you store them that way any runtime should be able to read them back (if you specify how they are encoded anyway). If need arises, you can always serialize or marshal / unmarshal the resulting byte array. Unfortunately I&#39;m not all that familiar with the two runtimes."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 12356687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5faec2e3c2b8287d99103b1a96059e5b?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/12356687/omar"}, "is_accepted": true, "score": 1, "last_activity_date": 1574453875, "last_edit_date": 1574453875, "creation_date": 1574453114, "answer_id": 59001033, "question_id": 58840982, "link": "https://stackoverflow.com/questions/58840982/how-to-marshal-an-ecc-public-or-private-key/59001033#59001033", "title": "How to marshal an ECC public or private key", "body": "<p>i found the answer finally and i will post it in case somone need it.\nall we need is just to creat another struct, lets name it \"retrieve\" and declare the value it wil read from the unmarshal.\nnow the ECC public key contain 3 values \"curve\" and will append it as <code>json:\"Curve\"</code>, \"Y\" ans will append it as <code>json:\"Y\"</code> and we will do the same for \"X\"</p>\n\n<p>and it will work like this : </p>\n\n<pre><code>type retrieve struct {\n    CurveParams *elliptic.CurveParams `json:\"Curve\"`\n    MyX         *big.Int              `json:\"X\"`\n    MyY         *big.Int              `json:\"Y\"`\n}\n\n//UnmarshalECCPublicKey extract ECC public key from marshaled objects\nfunc UnmarshalECCPublicKey(object []byte) (pub ecdsa.PublicKey) {\n    var public ecdsa.PublicKey\n    rt := new(retrieve)\n\n    errmarsh := json.Unmarshal(object, &amp;rt)\n    if errmarsh != nil {\n        fmt.Println(\"err at UnmarshalECCPublicKey()\")\n        panic(errmarsh)\n    }\n\n    public.Curve = rt.Key.CurveParams\n    public.X = rt.Key.MyX\n    public.Y = rt.Key.MyY\n    mapstructure.Decode(public, &amp;pub)\n\n    fmt.Println(\"Unmarshalled ECC public key : \", pub)\n    return\n}\n</code></pre>\n\n<p>we will pass the the marshalled public key to UnmarshalECCPublicKey() and it will return the correct unmarshaled obj</p>\n\n<p>so the coorect use will be :</p>\n\n<pre><code>var privateKey *ecdsa.PrivateKey\nvar publicKey ecdsa.PublicKey\nprivateKey, err := ecdsa.GenerateKey(elliptic.P256(), rand.Reader)\nif err != nil {\n    log.Fatalf(\"Failed to generate ECDSA key: %s\\n\", err)\n}\npublicKey = privateKey.PublicKey\n\nmarshalledKey, err := json.Marshal(publicKey)\nif err != nil {\n    panic(err)\n}\n\nvar unmarshalledKey ecdsa.PublicKey\nunmarshalledKey = UnmarshalECCPublicKey(marshalledKey)\n</code></pre>\n\n<p>and that should do it, u will get the ECC public unmarshalled successfully.</p>\n"}], "owner": {"reputation": 21, "user_id": 12356687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5faec2e3c2b8287d99103b1a96059e5b?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/12356687/omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 0, "accepted_answer_id": 59001033, "answer_count": 1, "score": -1, "last_activity_date": 1574453875, "creation_date": 1573660804, "last_edit_date": 1573674532, "question_id": 58840982, "link": "https://stackoverflow.com/questions/58840982/how-to-marshal-an-ecc-public-or-private-key", "title": "How to marshal an ECC public or private key", "body": "<p>Hello i'am trying to unmarshal object that contain ECC public key \nbut i go umarshaling error saying that can't unmarshal object properly.\ni'am tring to do the followeing : </p>\n\n<pre><code>var privateKey *ecdsa.PrivateKey\nvar publicKey ecdsa.PublicKey\nprivateKey, err := ecdsa.GenerateKey(elliptic.P256(), rand.Reader)\nif err != nil {\n    log.Fatalf(\"Failed to generate ECDSA key: %s\\n\", err)\n}\npublicKey = privateKey.PublicKey\n\nmarshalledKey, err := json.Marshal(publicKey)\nif err != nil {\n    panic(err)\n}\n\nvar unmarshalledKey ecdsa.PublicKey\nerr2 := json.Unmarshal(marshalledKey, &amp;unmarshalledKey)\nif err2 != nil {\n    panic(err2)\n}\n</code></pre>\n\n<p>and tthe error returned from (err2) is : </p>\n\n<p>panic: json: cannot unmarshal object into Go struct field PublicKey.Curve of type elliptic.Curve</p>\n\n<p>and there is no way in either eliptoc or 509x function to umarshal and the curve value is alwayes null</p>\n"}, {"tags": ["python", "python-3.x", "go", "hash", "md5"], "comments": [{"owner": {"reputation": 796, "user_id": 1643973, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/198787891419681bb0932f54a502a40c?s=128&d=identicon&r=PG", "display_name": "jjramsey", "link": "https://stackoverflow.com/users/1643973/jjramsey"}, "edited": false, "score": 2, "creation_date": 1573659879, "post_id": 58840574, "comment_id": 103955486, "body": "What do you get if you replace <code>fmt.Printf(&quot;%s&quot;, string(b))</code> with <code>fmt.Printf(&quot;%x&quot;, md5Vin)</code>?"}, {"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 0, "creation_date": 1573661130, "post_id": 58840574, "comment_id": 103956225, "body": "FYI, the Go output the Base64 encoded input, plus some garbage at the end: piping it onto <code>base64 -D</code> prints <code>1GBJC34R1VF063154</code> plus some trailing non-printable bytes."}, {"owner": {"reputation": 165, "user_id": 8325626, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/118ce1d84e77ddf5fca81faa3c8de470?s=128&d=identicon&r=PG&f=1", "display_name": "ThomasJohnson", "link": "https://stackoverflow.com/users/8325626/thomasjohnson"}, "edited": false, "score": 0, "creation_date": 1573664625, "post_id": 58840574, "comment_id": 103958254, "body": "Problem is that if I take the hash and do the base64 encoding I am getting: YTQwZjc3MWVhNDMwYWUzMmRiYzVlODE4Mzg3NTQ5ZDM which does not match MUdCSkMzNFIxVkYwNjMxNTTUHYzZjwCyBOmACZjs+EJ+"}], "answers": [{"comments": [{"owner": {"reputation": 165, "user_id": 8325626, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/118ce1d84e77ddf5fca81faa3c8de470?s=128&d=identicon&r=PG&f=1", "display_name": "ThomasJohnson", "link": "https://stackoverflow.com/users/8325626/thomasjohnson"}, "edited": false, "score": 0, "creation_date": 1573664567, "post_id": 58840898, "comment_id": 103958216, "body": "Hi, thanks for answer but I need to be able to match the output. The base64 encoded version of hash is: YTQwZjc3MWVhNDMwYWUzMmRiYzVlODE4Mzg3NTQ5ZDM which does not match MUdCSkMzNFIxVkYwNjMxNTTUHYzZjwCyBOmACZjs+EJ+"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 165, "user_id": 8325626, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/118ce1d84e77ddf5fca81faa3c8de470?s=128&d=identicon&r=PG&f=1", "display_name": "ThomasJohnson", "link": "https://stackoverflow.com/users/8325626/thomasjohnson"}, "edited": false, "score": 0, "creation_date": 1573664935, "post_id": 58840898, "comment_id": 103958395, "body": "Your go program output is wrong, do not try to match it with python. The base64 output should be YTQw... not MUdC..."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 165, "user_id": 8325626, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/118ce1d84e77ddf5fca81faa3c8de470?s=128&d=identicon&r=PG&f=1", "display_name": "ThomasJohnson", "link": "https://stackoverflow.com/users/8325626/thomasjohnson"}, "edited": false, "score": 0, "creation_date": 1573665826, "post_id": 58840898, "comment_id": 103958832, "body": "You are using <code>md5.Sum</code> incorrectly. Check my code. You&#39;re missing <code>md5.Write</code> in your code. Your program output is not the base64 encoding of the hash, it is the base64 encoding of VIN+binarydata"}, {"owner": {"reputation": 165, "user_id": 8325626, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/118ce1d84e77ddf5fca81faa3c8de470?s=128&d=identicon&r=PG&f=1", "display_name": "ThomasJohnson", "link": "https://stackoverflow.com/users/8325626/thomasjohnson"}, "edited": false, "score": 0, "creation_date": 1573666442, "post_id": 58840898, "comment_id": 103959137, "body": "Problem is that I unfortunately cannot affect that, even thou it&#39;s not correct using of hash as you say, that&#39;s how program I am dependent on works and I can&#39;t affect that, can you please explain VIN+binarydata ? Binary data of hash ? Maybe I can concat that together and encode64 to get desired format ?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 165, "user_id": 8325626, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/118ce1d84e77ddf5fca81faa3c8de470?s=128&d=identicon&r=PG&f=1", "display_name": "ThomasJohnson", "link": "https://stackoverflow.com/users/8325626/thomasjohnson"}, "edited": false, "score": 1, "creation_date": 1573666856, "post_id": 58840898, "comment_id": 103959306, "body": "Read the documentation for <code>hash.Sum()</code>. You are not computing the hash by calling <code>md5.Sum(vin)</code>. You are appending the current hash value in <code>md5</code>  to <code>vin</code>. Since you just created md5, it is initialized with the md5 initialization vector. So the output is VIN+md5 initialization vector. You are simply appending a constant binary value to whatever VIN you have. If you want to emulate the broken hash in python, then get the hash of a 0-length input, concatenate that binary hash to the VIN, and base64 that. But that&#39;s just wrong."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 2, "last_activity_date": 1573660538, "creation_date": 1573660538, "answer_id": 58840898, "question_id": 58840574, "link": "https://stackoverflow.com/questions/58840574/md5-hash-go-to-python/58840898#58840898", "title": "MD5 hash Go to Python", "body": "<p>You are using the hash incorrectly:</p>\n\n<pre><code>    vin := \"1GBJC34R1VF063154\"\n    md5 := md5.New()\n    md5.Write([]byte(vin))\n    md5Vin := md5.Sum(nil)\n    // This should give a40f771ea430ae32dbc5e818387549d3\n    fmt.Printf(\"%x\",md5Vin)\n    payload := &amp;Payload{\n        HVIN: md5Vin,\n    }\n    b, _ := json.Marshal(payload)\n    // This will print the base64-encoded version of the hash\n    fmt.Printf(\"%s\", string(b)) \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "is_accepted": true, "score": 3, "last_activity_date": 1573680721, "last_edit_date": 1573680721, "creation_date": 1573679561, "answer_id": 58845689, "question_id": 58840574, "link": "https://stackoverflow.com/questions/58840574/md5-hash-go-to-python/58845689#58845689", "title": "MD5 hash Go to Python", "body": "<p>The comments in another answer state that the goal is match the Go code, even though the Go code does not compute the hash of the VIN.  </p>\n\n<p>Here's python3 code matches the Go code. This code base64 encodes the concatenation of the VIN and the MD5 initial value.</p>\n\n<pre><code>vin := \"1GBJC34R1VF063154\"\nb0 = vin.encode('utf-8')\nb1 = hashlib.md5(b'').digest()\ns =  base64.b64encode(b0 + b1).decode('ascii') // to match Go's encoding/json\nprint(f'{{\"hvin\":\"{s}\"}}')\n</code></pre>\n\n<p>The author of the Go code probably intended to write this:</p>\n\n<pre><code>vin := \"1GBJC34R1VF063154\"\nmd5Vin := md5.Sum([]byte(vin))\npayload := &amp;Payload{\n    HVIN: md5Vin[:],\n}\nb, _ := json.Marshal(payload)\nfmt.Printf(\"%s\", string(b))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1162, "user_id": 448451, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/70942ebe4f297a2c29e013181122e813?s=128&d=identicon&r=PG", "display_name": "Keenan Gebze", "link": "https://stackoverflow.com/users/448451/keenan-gebze"}, "is_accepted": false, "score": 0, "last_activity_date": 1573717666, "creation_date": 1573717666, "answer_id": 58851751, "question_id": 58840574, "link": "https://stackoverflow.com/questions/58840574/md5-hash-go-to-python/58851751#58851751", "title": "MD5 hash Go to Python", "body": "<p>Hi you just have to follow the examples from <a href=\"https://golang.org/pkg/crypto/md5/#example_New\" rel=\"nofollow noreferrer\">https://golang.org/pkg/crypto/md5/#example_New</a></p>\n\n<p>Golang</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/md5\"\n    \"fmt\"\n    \"io\"\n)\n\nfunc main() {\n    h := md5.New()\n    vin := \"1GBJC34R1VF063154\"\n    io.WriteString(h, vin)\n    fmt.Printf(\"%x\", h.Sum(nil)) // a40f771ea430ae32dbc5e818387549d3\n}\n</code></pre>\n\n<p>Python</p>\n\n<pre><code>Python 3.6.8 (default, Oct  7 2019, 12:59:55) \n[GCC 8.3.0] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; import hashlib \n&gt;&gt;&gt; \n&gt;&gt;&gt; result = hashlib.md5(b'1GBJC34R1VF063154')\n&gt;&gt;&gt; print(result.hexdigest()) \na40f771ea430ae32dbc5e818387549d3\n\n</code></pre>\n\n<p>Golang's <code>%x</code> in <code>fmt</code> prints \"... base 16, with lower-case letters for a-f\". \nMore: <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/fmt/</a></p>\n"}], "owner": {"reputation": 165, "user_id": 8325626, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/118ce1d84e77ddf5fca81faa3c8de470?s=128&d=identicon&r=PG&f=1", "display_name": "ThomasJohnson", "link": "https://stackoverflow.com/users/8325626/thomasjohnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "accepted_answer_id": 58845689, "answer_count": 3, "score": 2, "last_activity_date": 1573717666, "creation_date": 1573659490, "question_id": 58840574, "link": "https://stackoverflow.com/questions/58840574/md5-hash-go-to-python", "title": "MD5 hash Go to Python", "body": "<p>I have following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/md5\"\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Payload struct {\n    HVIN []byte `json:\"hvin\"`\n}\n\nfunc main() {\n    vin := \"1GBJC34R1VF063154\"\n    md5 := md5.New()\n    md5Vin := md5.Sum([]byte(vin))\n    payload := &amp;Payload{\n        HVIN: md5Vin,\n    }\n    b, _ := json.Marshal(payload)\n    fmt.Printf(\"%s\", string(b))\n\n}\n</code></pre>\n\n<p>If I run the code at: <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">https://play.golang.org/</a> I get following output:</p>\n\n<pre><code>{\"hvin\":\"MUdCSkMzNFIxVkYwNjMxNTTUHYzZjwCyBOmACZjs+EJ+\"}\n</code></pre>\n\n<p>How can I replicate this in Python 3 ?</p>\n\n<p>I tried following:</p>\n\n<pre><code>import hashlib \n\nresult = hashlib.md5(b'1GBJC34R1VF063154')\nprint(result.hexdigest()) \n</code></pre>\n\n<p>Getting following output which doesn't match output given by Go:</p>\n\n<pre><code>a40f771ea430ae32dbc5e818387549d3\n</code></pre>\n\n<p>Thank you.</p>\n"}, {"tags": ["email", "go", "smtp", "gmail"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1573731723, "post_id": 58840232, "comment_id": 103983583, "body": "First: SMTP or SMTPS? And port 5<b>8</b>7 is quite distinct to 465. The former provides TLS only, whereas the latter provides SSL only."}, {"owner": {"reputation": 111, "user_id": 6868817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44c5b8c99d2b570c89887d751004ee11?s=128&d=identicon&r=PG&f=1", "display_name": "Programmer", "link": "https://stackoverflow.com/users/6868817/programmer"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1573884864, "post_id": 58840232, "comment_id": 104042446, "body": "Sorry, typo, it should be 587. I think I&#39;m using SMTP, not sure which one gmail supports"}], "owner": {"reputation": 111, "user_id": 6868817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44c5b8c99d2b570c89887d751004ee11?s=128&d=identicon&r=PG&f=1", "display_name": "Programmer", "link": "https://stackoverflow.com/users/6868817/programmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1573884948, "creation_date": 1573658375, "last_edit_date": 1573884948, "question_id": 58840232, "link": "https://stackoverflow.com/questions/58840232/unable-to-send-email-in-go-smtp-library-with-gmail", "title": "Unable to send email in go smtp library with gmail", "body": "<p>I'm trying to send email through golang's smtp library using my gamil account.</p>\n\n<p>It was working fine when I try to send emails a few days ago.</p>\n\n<p>But suddenly today, I am not able to send email and the error shown is:</p>\n\n<p>535 5.7.8 Username and Password not accepted. Learn more at\\n5.7.8  <a href=\"https://support.google.com/mail/?p=BadCredentials\" rel=\"nofollow noreferrer\">https://support.google.com/mail/?p=BadCredentials</a> h3sm2390100pji.16 - gsmtp</p>\n\n<p>I'm sure that it succeed in signing into gmail because, 1. the username and password are correct, 2. When I push my code to the server and try to send the email again, my gmail account receive a \"Critical Security Alert\" email, saying that I have less secure access on, and I have selected that I have recognized the activity.</p>\n\n<p>This shows that I have indeed able to login to gmail through my golang program, yet it was unable to send any email.</p>\n\n<p>I have already turned on allow less secure access and I also have tried this <a href=\"https://accounts.google.com/DisplayUnlockCaptcha\" rel=\"nofollow noreferrer\">https://accounts.google.com/DisplayUnlockCaptcha</a>, and my password for gmail is \"upper case letter + lower case letter + special symbols + numbers\"</p>\n\n<p>I have been stuck in this since I have tried all possible solution on the internet and still could not able to send email again using the golang program.</p>\n\n<p>And the port I was using is 587.\nBy changing it to 465, it gives an error of EOF instead.</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573658023, "post_id": 58839775, "comment_id": 103954350, "body": "The debug log seems to show that the decimal.Decimal was encoded properly into <code>&#39;10.2&#39;</code> but you still got that error back? Also take a look at this issue: <a href=\"https://github.com/jinzhu/gorm/issues/2661\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm/issues/2661</a>"}, {"owner": {"reputation": 72, "user_id": 2681348, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84ca6ee58f2cf4aa2a3fae250c21b5c7?s=128&d=identicon&r=PG&f=1", "display_name": "maximus", "link": "https://stackoverflow.com/users/2681348/maximus"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573662338, "post_id": 58839775, "comment_id": 103956972, "body": "thanks. more info related to this issue <a href=\"https://github.com/golang/go/issues/30870\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/30870</a>, <a href=\"https://github.com/shopspring/decimal/issues/152\" rel=\"nofollow noreferrer\">Decimal decompose interface</a>"}], "owner": {"reputation": 72, "user_id": 2681348, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84ca6ee58f2cf4aa2a3fae250c21b5c7?s=128&d=identicon&r=PG&f=1", "display_name": "maximus", "link": "https://stackoverflow.com/users/2681348/maximus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 518, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1573662033, "creation_date": 1573656869, "last_edit_date": 1573662033, "question_id": 58839775, "link": "https://stackoverflow.com/questions/58839775/using-decimal-decimal-type-in-gorm", "title": "Using decimal.Decimal type in gorm", "body": "<p>I have a gorm struct like the following.</p>\n\n<pre><code>type Book1 struct {\n    ID     uint `gorm:\"primary_key\"`\n    Title  string\n    Price  decimal.Decimal `sql:\"type:decimal(20,8);\"` //github.com/shopspring/decimal\n}\n</code></pre>\n\n<p>Using <code>db.AutoMigrate(&amp;Book1{})</code> i am able to create table in <code>postgres</code> but getting type of price as numeric type. On <code>sqllite</code> it is creating <code>\"price\" decimal(20 , 8)</code>field correctly.</p>\n\n<p>But when I tried to add the following entry </p>\n\n<pre><code>b := Book1{\n        ID:    10,\n        Title: \"hello\",\n        Price: decimal.NewFromFloat(10.2),\n}\ner := db.Debug().Create(&amp;b).Error\n</code></pre>\n\n<p>on postgres it is producing error <code>encode: unknown type for decimal.Decimal</code>\nbut on sqlite it add empty value for price.</p>\n\n<p>Debug log prints <code>INSERT  INTO \"book1\" (\"id\",\"title\",\"price\") VALUES (10,'hello','10.2')</code></p>\n"}, {"tags": ["json", "mongodb", "go", "marshalling", "bson"], "answers": [{"comments": [{"owner": {"reputation": 2737, "user_id": 6503832, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1735153430056221/picture?type=large", "display_name": "Hyerois", "link": "https://stackoverflow.com/users/6503832/hyerois"}, "edited": false, "score": 0, "creation_date": 1573654235, "post_id": 58838902, "comment_id": 103952166, "body": "You saved me hours of struggling. I&#39;m new to Go and didn&#39;t know we could convert a byte array to a string. Thanks a lot!"}], "tags": [], "owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "is_accepted": true, "score": 1, "last_activity_date": 1573653889, "creation_date": 1573653889, "answer_id": 58838902, "question_id": 58838642, "link": "https://stackoverflow.com/questions/58838642/how-to-render-a-json-string-from-bson-document/58838902#58838902", "title": "How to render a json string from bson document", "body": "<p>From Golang <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">documentation</a> for <code>json</code> package</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    type ColorGroup struct {\n        ID     int      `json:\"id\"`\n        Name   string   `json:\"name\"`\n        Colors []string `json:\"colors\"`\n    }\n    group := ColorGroup{\n        ID:     1,\n        Name:   \"Reds\",\n        Colors: []string{\"Crimson\", \"Red\", \"Ruby\", \"Maroon\"},\n    }\n    b, err := json.Marshal(group)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    } else {\n        str := string(b)\n        fmt.Println(\"stringified json is:\", str)\n\n    }\n}\n\n\n</code></pre>\n\n<pre><code>Output\nstringified json is: {\"id\":1,\"name\":\"Reds\",\"colors\":[\"Crimson\",\"Red\",\"Ruby\",\"Maroon\"]}\n</code></pre>\n\n<p>The <code>json.Marshal</code> return two values - a <code>byte array</code> and <code>error</code>\nIf <code>error</code> is <code>nil</code> then you can obtain the string by converting <code>byte array</code> to <code>string</code> using\n<code>str := string(b)</code></p>\n"}], "owner": {"reputation": 2737, "user_id": 6503832, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1735153430056221/picture?type=large", "display_name": "Hyerois", "link": "https://stackoverflow.com/users/6503832/hyerois"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "closed_date": 1573725389, "accepted_answer_id": 58838902, "answer_count": 1, "score": 0, "last_activity_date": 1573725436, "creation_date": 1573653109, "last_edit_date": 1573725296, "question_id": 58838642, "link": "https://stackoverflow.com/questions/58838642/how-to-render-a-json-string-from-bson-document", "closed_reason": "Duplicate", "title": "How to render a json string from bson document", "body": "<p>I am struggling to create a valid JSON string from a BSON document in Go for an API.\nLet's say I have an object like this:</p>\n\n<pre><code>type MyObject struct {\n    Name string\n}\n</code></pre>\n\n<p>I call my database which returns to me a cursor containing many documents as: <code>[{\"Name\": \"object_name\"}, ...]</code></p>\n\n<p>I am able to retrieve all the documents via a loop like </p>\n\n<pre><code>for cur.Next(ctx) {\n    var obj MyObject\n    err := cur.Decode(&amp;obj)\n    //then display error if there's one        \n}\n</code></pre>\n\n<p>And now I would like to end up with a JSON string containing all the documents my database returned in order to send it via HTTP.</p>\n\n<p>Because, if use I <code>fmt.Println(obj)</code>I end up with something like this: <code>[{object1_name} {object2_name} ...]</code> which is, according to me, not a valid format that I can use for an API.</p>\n\n<p>I know <code>json.Marshal(obj)</code> can actually encode to valid JSON and I can decode it with <code>os.Stdout.Write(obj)</code> but I didn't manage to store this valid string in a variable. How can I manage to do this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1573648892, "post_id": 58837200, "comment_id": 103949044, "body": "Hi, please try to provide more details about what you obtain launching the program and why is not ok. If you got an error, please provide the text in your post."}, {"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 2, "creation_date": 1573653534, "post_id": 58837200, "comment_id": 103951739, "body": "One issue I saw in your code is when you use <i>cache.mux.Lock()</i> as you <i>Unlock()</i> only inside the if, so one goroutine that found the url in cache is going to lock everyone else."}, {"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 2, "creation_date": 1573654153, "post_id": 58837200, "comment_id": 103952129, "body": "Another issue is that you should lock the cache when you write to it, now you do only when you read."}, {"owner": {"reputation": 3, "user_id": 12366700, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FEFcnMnMams/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ik_VRd7i9Vm_tQ5peeXEnPwQei2Q/mo/photo.jpg?sz=128", "display_name": "Samson Boroda", "link": "https://stackoverflow.com/users/12366700/samson-boroda"}, "reply_to_user": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 1, "creation_date": 1573654448, "post_id": 58837200, "comment_id": 103952275, "body": "@MarioSantini you right! I added else condition to unlock mutex and result doesn&#39;t change. (Also saw about writing then and fixed). But when i debugging and making pauses between speps it works almost fine and found one more url. There must be another issue... I starting believe that blocking must be little complicated to work fine and avoid deadlocks. So should i use channels to manage locks or there is easier way?"}, {"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1573654802, "post_id": 58837200, "comment_id": 103952542, "body": "I think channels will make no difference as they just aim to synchronize goroutine but not to access resources in concurrency, as it is your cache."}, {"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 2, "creation_date": 1573655124, "post_id": 58837200, "comment_id": 103952737, "body": "to check for race condition you should use the <i>-race</i> option on <i>go build</i>. It should highlight some issues."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1573656151, "post_id": 58837200, "comment_id": 103953304, "body": "You&#39;re also not waiting for any <code>go Crawl</code> calls to return, so you could get any number of results"}, {"owner": {"reputation": 3, "user_id": 12366700, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FEFcnMnMams/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ik_VRd7i9Vm_tQ5peeXEnPwQei2Q/mo/photo.jpg?sz=128", "display_name": "Samson Boroda", "link": "https://stackoverflow.com/users/12366700/samson-boroda"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1573656603, "post_id": 58837200, "comment_id": 103953549, "body": "@JimB if i right understood, the return is happening when counter of depth==0. Or there is some specific procedure in golang concurrency?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1573657064, "post_id": 58837200, "comment_id": 103953820, "body": "You have no synchronization between the main goroutine and the Crawl goroutines, so main will exit before all your goroutines complete. I would just continue with the tutorials before you go off into the weeds."}, {"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1573657216, "post_id": 58837200, "comment_id": 103953903, "body": "You can see what @JimB is telling you just launching the <i>Crawl()</i> in the main as a goroutine. The program will exit immidiately without completing a fetch. Now it is keep running by the for loop."}, {"owner": {"reputation": 3, "user_id": 12366700, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FEFcnMnMams/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ik_VRd7i9Vm_tQ5peeXEnPwQei2Q/mo/photo.jpg?sz=128", "display_name": "Samson Boroda", "link": "https://stackoverflow.com/users/12366700/samson-boroda"}, "reply_to_user": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1573657319, "post_id": 58837200, "comment_id": 103953961, "body": "@MarioSantini i also deleted &quot;go Crawl&quot; so because of it code started works... When i idded -race option it also works with goroutines and sometimes returns two or one &quot;not found: <a href=\"http://golang.org/cmd/\" rel=\"nofollow noreferrer\">golang.org/cmd</a>&quot;. Yep, there is race and i guess i should synchronize threads to avoid it. As marked JimB i can wait for return. Thank everyone, gone to read the docs ^_^"}], "answers": [{"tags": [], "owner": {"reputation": 626, "user_id": 2454720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a13483fe013b55121def2b6bbd68462?s=128&d=identicon&r=PG", "display_name": "Ferdy Pruis", "link": "https://stackoverflow.com/users/2454720/ferdy-pruis"}, "is_accepted": true, "score": 0, "last_activity_date": 1573729475, "last_edit_date": 1573729475, "creation_date": 1573722871, "answer_id": 58853111, "question_id": 58837200, "link": "https://stackoverflow.com/questions/58837200/how-does-crawler-multithreading-work-in-this-example/58853111#58853111", "title": "How does crawler multithreading work in this example?", "body": "<p>Your <code>main()</code> does not block until all <code>go Crawl()</code> invocations are finished, therefor exiting. You could either use a <code>sync.WaitGroup</code> or a channel to synchronize program ending with the completion of all goroutines.</p>\n\n<p>I also see a problem with the variable <code>u</code> used within the goroutine; by the time the goroutine is executed the value of <code>u</code> might or might not have been changed by the range-loop.</p>\n\n<p>The end of <code>Crawl</code> could look like this to resolve both issues;</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nwg := sync.WaitGroup{}\n\nfmt.Printf(\"found: %s %q\\n\", url, body)\nfor _, u := range urls {\n    cache.mux.Lock()\n    if _, ok := cache.cache[u]; !ok { //check if url already in cache\n        cache.mux.Unlock()\n        wg.Add(1)\n        go func(url string) {\n            Crawl(url, depth-1, fetcher)\n            wg.Done()\n        }(u)\n    } else {\n        cache.mux.Unlock()\n    }\n}\n\n// Block until all goroutines are done\nwg.Wait()\n\nreturn\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 12366700, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-FEFcnMnMams/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ik_VRd7i9Vm_tQ5peeXEnPwQei2Q/mo/photo.jpg?sz=128", "display_name": "Samson Boroda", "link": "https://stackoverflow.com/users/12366700/samson-boroda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 58853111, "answer_count": 1, "score": 0, "last_activity_date": 1573729475, "creation_date": 1573648247, "last_edit_date": 1573725223, "question_id": 58837200, "link": "https://stackoverflow.com/questions/58837200/how-does-crawler-multithreading-work-in-this-example", "title": "How does crawler multithreading work in this example?", "body": "<p>I am trying solve task about parallel fetching URLs using cache to avoid duplicates.\nI found correct solution and can understand it. I saw that correct answer contains channels and gorutines pushes URL in cache via chan. But why my simple code doesn't work properly?\nI have no idea where is mistake.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype Fetcher interface {\n    // Fetch returns the body of URL and\n    // a slice of URLs found on that page.\n    Fetch(url string) (body string, urls []string, err error)\n}\n\nvar cache = struct {\n    cache map[string]int\n    mux sync.Mutex\n}{cache: make(map[string]int)}\n\n// Crawl uses fetcher to recursively crawl\n// pages starting with url, to a maximum of depth.\nfunc Crawl(url string, depth int, fetcher Fetcher) {\n    // TODO: Fetch URLs in parallel.\n    // TODO: Don't fetch the same URL twice.\n    // This implementation doesn't do either:\n\n    if depth &lt;= 0 {\n        return\n    }\n    cache.mux.Lock()\n    cache.cache[url] = 1 //put url in cache\n    cache.mux.Unlock()\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    fmt.Printf(\"found: %s %q\\n\", url, body)\n    for _, u := range urls {\n        cache.mux.Lock()\n        if _, ok := cache.cache[u]; !ok { //check if url already in cache\n            cache.mux.Unlock()\n            go Crawl(u, depth-1, fetcher)\n        } else {\n            cache.mux.Unlock()\n        }\n    }\n    return\n}\n\nfunc main() {\n    Crawl(\"http://golang.org/\", 4, fetcher)\n}\n\n// fakeFetcher is Fetcher that returns canned results.\ntype fakeFetcher map[string]*fakeResult\n\ntype fakeResult struct {\n    body string\n    urls []string\n}\n\nfunc (f fakeFetcher) Fetch(url string) (string, []string, error) {\n    if res, ok := f[url]; ok {\n        return res.body, res.urls, nil\n    }\n    return \"\", nil, fmt.Errorf(\"not found: %s\", url)\n}\n\n// fetcher is a populated fakeFetcher.\nvar fetcher = fakeFetcher{\n    \"http://golang.org/\": &amp;fakeResult{\n        \"The Go Programming Language\",\n        []string{\n            \"http://golang.org/pkg/\",\n            \"http://golang.org/cmd/\",\n        },\n    },\n    \"http://golang.org/pkg/\": &amp;fakeResult{\n        \"Packages\",\n        []string{\n            \"http://golang.org/\",\n            \"http://golang.org/cmd/\",\n            \"http://golang.org/pkg/fmt/\",\n            \"http://golang.org/pkg/os/\",\n        },\n    },\n    \"http://golang.org/pkg/fmt/\": &amp;fakeResult{\n        \"Package fmt\",\n        []string{\n            \"http://golang.org/\",\n            \"http://golang.org/pkg/\",\n        },\n    },\n    \"http://golang.org/pkg/os/\": &amp;fakeResult{\n        \"Package os\",\n        []string{\n            \"http://golang.org/\",\n            \"http://golang.org/pkg/\",\n        },\n    },\n}\n\n</code></pre>\n\n<p>UPD:\nResult of execution:</p>\n\n<pre><code>found: http://golang.org/ \"The Go Programming Language\"\n\nProcess finished with exit code 0\n</code></pre>\n\n<p>I feel like no recursion when i launch goroutine. But if make breakpoint on line which checks if URL in cahce, i got this:</p>\n\n<pre><code>found: http://golang.org/ \"The Go Programming Language\"\nfound: http://golang.org/pkg/ \"Packages\"\n\nDebugger finished with exit code 0\n</code></pre>\n\n<p>so that means recursion works, but something gones wrong, some race i guess?\nMore interesting thing happens when add second breakpoint on line which runes routine:</p>\n\n<pre><code>found: http://golang.org/ \"The Go Programming Language\"\nfound: http://golang.org/pkg/ \"Packages\"\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [semacquire]:\nsync.runtime_SemacquireMutex(0x58843c, 0x0, 0x1)\n        /usr/local/go/src/runtime/sema.go:71 +0x47\nsync.(*Mutex).lockSlow(0x588438)\n        /usr/local/go/src/sync/mutex.go:138 +0x295\nsync.(*Mutex).Lock(0x588438)\n        /usr/local/go/src/sync/mutex.go:81 +0x58\nmain.Crawl(0x4e9cf9, 0x12, 0x4, 0x4f7700, 0xc00008c180)\n        /root/go/src/crwaler/main.go:38 +0x46c\nmain.main()\n        /root/go/src/crwaler/main.go:48 +0x57\n\ngoroutine 18 [semacquire]:\nsync.runtime_SemacquireMutex(0x58843c, 0x0, 0x1)\n        /usr/local/go/src/runtime/sema.go:71 +0x47\nsync.(*Mutex).lockSlow(0x588438)\n        /usr/local/go/src/sync/mutex.go:138 +0x295\nsync.(*Mutex).Lock(0x588438)\n        /usr/local/go/src/sync/mutex.go:81 +0x58\nmain.Crawl(0x4ea989, 0x16, 0x3, 0x4f7700, 0xc00008c180)\n        /root/go/src/crwaler/main.go:38 +0x46c\ncreated by main.Crawl\n        /root/go/src/crwaler/main.go:41 +0x563\n\nDebugger finished with exit code 0\n</code></pre>\n"}, {"tags": ["go", "sendgrid"], "comments": [{"owner": {"reputation": 5945, "user_id": 2664985, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/b481e39808c4dd2db7a66c1931a9bb08?s=128&d=identicon&r=PG", "display_name": "Jack Wilsdon", "link": "https://stackoverflow.com/users/2664985/jack-wilsdon"}, "edited": false, "score": 2, "creation_date": 1573649760, "post_id": 58837066, "comment_id": 103949503, "body": "Are you sure that you are setting the <code>SENDGRID_API_KEY</code> environment variable correctly on the server?"}, {"owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "reply_to_user": {"reputation": 5945, "user_id": 2664985, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/b481e39808c4dd2db7a66c1931a9bb08?s=128&d=identicon&r=PG", "display_name": "Jack Wilsdon", "link": "https://stackoverflow.com/users/2664985/jack-wilsdon"}, "edited": false, "score": 0, "creation_date": 1573709052, "post_id": 58837066, "comment_id": 103972745, "body": "of course) Before asking I did everything I could."}], "answers": [{"tags": [], "owner": {"reputation": 84, "user_id": 1481626, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d7385d9e0c45a30c081fbbf53136e2d?s=128&d=identicon&r=PG", "display_name": "Christine", "link": "https://stackoverflow.com/users/1481626/christine"}, "is_accepted": true, "score": 1, "last_activity_date": 1573682276, "creation_date": 1573682276, "answer_id": 58846260, "question_id": 58837066, "link": "https://stackoverflow.com/questions/58837066/why-sendgrid-api-works-in-localhost-but-in-server-need-another-api/58846260#58846260", "title": "Why Sendgrid API works in localhost but in server need another API", "body": "<p><a href=\"https://sendgrid.com/docs/api-reference/\" rel=\"nofollow noreferrer\">SendGrid's API</a> requires an authorization header.  If you are using a <a href=\"https://github.com/sendgrid/sendgrid-java\" rel=\"nofollow noreferrer\">client library</a> a <a href=\"https://app.sendgrid.com/settings/api_keys\" rel=\"nofollow noreferrer\">SENDGRID_API_KEY</a> was probably set up for testing.</p>\n\n<p>In new server, make sure an environment variable is set with a <code>SENDGRID_API_KEY</code>.</p>\n\n<p>For Java, copy the sample environment file to a new file</p>\n\n<pre><code>cp .env_sample .env\n</code></pre>\n\n<p>Edit the new .env to add your API key, then Source the .env file to set rhe variable in the current session</p>\n\n<pre><code>source .env\n</code></pre>\n\n<p>Further information on the API set can be found in the <a href=\"https://github.com/sendgrid/sendgrid-java#setup-environment-variables\" rel=\"nofollow noreferrer\">client library documentation</a>.</p>\n"}], "owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 773, "favorite_count": 0, "accepted_answer_id": 58846260, "answer_count": 1, "score": 1, "last_activity_date": 1573682276, "creation_date": 1573647805, "question_id": 58837066, "link": "https://stackoverflow.com/questions/58837066/why-sendgrid-api-works-in-localhost-but-in-server-need-another-api", "title": "Why Sendgrid API works in localhost but in server need another API", "body": "<p>Today I faced with Sendgrid problem. I get SendGrid API and write message </p>\n\n<pre><code>from := mail.NewEmail(message.Fullname, \"example@gmail.com\")\n    subject := \"\u041d\u043e\u0432\u0430\u044f \u0437\u0430\u044f\u0432\u043a\u0430 \u0432 Litro.kz\"\n    to := mail.NewEmail(message.Fullname, \"example@gmail.com\")\n    plainTextContent := \"\u0424\u0418\u041e: \"+ message.Fullname + \"\\n Email:  \" +message.Email + \"\\n \u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430: \"+ message.Phone +\"\\n \u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435: \"+message.Text\n    htmlContent := \"\u0424\u0418\u041e: \"+ message.Fullname + \"&lt;br&gt; Email:  \" +message.Email + \"&lt;br&gt; \u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430: \"+ message.Phone +\"&lt;br&gt; \u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435: \"+message.Text\n    messages := mail.NewSingleEmail(from, subject, to, plainTextContent, htmlContent)\n\n    client := sendgrid.NewSendClient(os.Getenv(\"SENDGRID_API_KEY\"))\n    response, err := client.Send(messages)\n\n    if err != nil || response.StatusCode!=202 {\n        log.Println(err)\n        fmt.Println(response)\n        return u.Message(false,\"Error\")\n    }else{\n        fmt.Println(response.Body)\n        fmt.Print(response.StatusCode)\n    }\n</code></pre>\n\n<p>It is part of my code. When I run this code in localhost everything is ok, but after i downloaded to server. I have problem like</p>\n\n<pre><code>&amp;{401 {\u201cerrors\u201d:[{\u201cmessage\u201d:\u201cPermission denied, wrong credentials\u201d,\u201cfield\u201d:null,\u201chelp\u201d:null}]} map[Access-Control-Allow-Headers:[Authorization, Content-Type, On-behalf-of, x-sg-elas-acl] Access-Control-Allow-Methods:[POST] Access-Control-Allow-Origin:[https://sendgrid.api-docs.io] Access-Control-Max-Age:[600] Connection:[keep-alive] Content-Length:[88] Content-Type:[application/json] Date:[Mon, 04 Nov 2019 08:33:17 GMT] Server:[nginx] X-No-Cors-Reason:[https://sendgrid.com/docs/Classroom/Basics/API/cors.html]]}\n</code></pre>\n\n<p>Please, help to solve this problem.</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1573655626, "post_id": 58836060, "comment_id": 103953027, "body": "Please see <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a> (particularly the sections on import paths and your first library) and <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">Effective Go</a> (particularly the section on names)."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1573645828, "last_edit_date": 1573645828, "creation_date": 1573644945, "answer_id": 58836223, "question_id": 58836060, "link": "https://stackoverflow.com/questions/58836060/cant-import-a-package-from-a-different-file-in-go/58836223#58836223", "title": "Can&#39;t import a package from a different file in GO", "body": "<p>With your current layout, import path of <code>types</code> is <code>example.com/graphql/src/types</code>.</p>\n\n<p><code>go.mod</code> should be inside <code>src</code> if you have that structure. Or better would be to get rid of <code>src</code>. <code>go.mod</code> must be next to the <code>types</code> and <code>utils</code> folders.</p>\n"}], "owner": {"reputation": 22458, "user_id": 5421539, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/39375cb7a86a17c5b92b79d0fee6d169?s=128&d=identicon&r=PG&f=1", "display_name": "Joey Yi Zhao", "link": "https://stackoverflow.com/users/5421539/joey-yi-zhao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 58836223, "answer_count": 1, "score": -1, "last_activity_date": 1573645876, "creation_date": 1573644302, "last_edit_date": 1573645876, "question_id": 58836060, "link": "https://stackoverflow.com/questions/58836060/cant-import-a-package-from-a-different-file-in-go", "title": "Can&#39;t import a package from a different file in GO", "body": "<p>I am using <code>go1.13.4</code> and below is my project structure:</p>\n\n<pre><code>src/types/type.go\nsrc/utils/util.go\ngo.mod\n</code></pre>\n\n<p>In go.mod:</p>\n\n<pre><code>module example.com/graphql\n\ngo 1.13\n\nrequire github.com/graph-gophers/graphql-go v0.0.0-20191031232829-adde0d0f76a3\n</code></pre>\n\n<p>In src/types/type.go:</p>\n\n<pre><code>package types\n\ntype USER struct {\n   ...\n}\n</code></pre>\n\n<p>In src/utils/util.go,</p>\n\n<pre><code>package utils\nimport (\n    \"example.com/graphql/types\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n)\n\n</code></pre>\n\n<p>I got tan error when build the project:</p>\n\n<pre><code>$ go build ./...\nsrc/utils/utils.go:4:2: cannot find module providing package example.com/graphql/types\n</code></pre>\n\n<p>I wonder why it can't find the package <code>example.com/graphql/types</code>? I am reading <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">https://blog.golang.org/using-go-modules</a> and I already set the module name in <code>go.mod</code> file at the root of my project. </p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 1096, "user_id": 7952953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ig3Iu.jpg?s=128&g=1", "display_name": "logeshpalani98", "link": "https://stackoverflow.com/users/7952953/logeshpalani98"}, "edited": false, "score": 2, "creation_date": 1573643052, "post_id": 58835633, "comment_id": 103946179, "body": "It automatically downloaded and installed, while you starting VS Code or it will show in the VS Code notification with installation guide."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1096, "user_id": 7952953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ig3Iu.jpg?s=128&g=1", "display_name": "logeshpalani98", "link": "https://stackoverflow.com/users/7952953/logeshpalani98"}, "edited": false, "score": 0, "creation_date": 1573655659, "post_id": 58835633, "comment_id": 103953042, "body": "@logeshpalani98 it won&#39;t automatically download anything on an <b>offline</b> computer, as the question states."}, {"owner": {"reputation": 1096, "user_id": 7952953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ig3Iu.jpg?s=128&g=1", "display_name": "logeshpalani98", "link": "https://stackoverflow.com/users/7952953/logeshpalani98"}, "edited": false, "score": 0, "creation_date": 1573656925, "post_id": 58835633, "comment_id": 103953736, "body": "just follow this guide <a href=\"https://github.com/microsoft/vscode-go\" rel=\"nofollow noreferrer\">github.com/microsoft/vscode-go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 12366211, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_FYhKQF8p8E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re4JF5O3GJE3SLRk1AWJdsdakPXjg/photo.jpg?sz=128", "display_name": "eliyahu levi", "link": "https://stackoverflow.com/users/12366211/eliyahu-levi"}, "edited": false, "score": 0, "creation_date": 1573672315, "post_id": 58836423, "comment_id": 103961771, "body": "it doesn&#39;t work because for example the dlv <code>go install</code> require you to have internet connection (it needs to download  more dependencies)"}, {"owner": {"reputation": 1, "user_id": 12366211, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_FYhKQF8p8E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re4JF5O3GJE3SLRk1AWJdsdakPXjg/photo.jpg?sz=128", "display_name": "eliyahu levi", "link": "https://stackoverflow.com/users/12366211/eliyahu-levi"}, "edited": false, "score": 0, "creation_date": 1573673112, "post_id": 58836423, "comment_id": 103962135, "body": "go1.13.4 windows/amd64  on the online computer  on the offline its multiple offline computers with windows 7  and 10."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 1, "user_id": 12366211, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_FYhKQF8p8E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re4JF5O3GJE3SLRk1AWJdsdakPXjg/photo.jpg?sz=128", "display_name": "eliyahu levi", "link": "https://stackoverflow.com/users/12366211/eliyahu-levi"}, "edited": false, "score": 0, "creation_date": 1573673693, "post_id": 58836423, "comment_id": 103962391, "body": "The <code>%GOPATH%\\bin</code> contains all tools the VSCode needs e.g. <code>%GOPATH%\\bin\\dlv.exe</code> and copy that  <code>%GOPATH%\\bin</code> from online to offline PCs. you only need source only if you need to rebuild or go install it otherwise  <code>%GOPATH%\\bin</code> is enough."}, {"owner": {"reputation": 1, "user_id": 12366211, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_FYhKQF8p8E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re4JF5O3GJE3SLRk1AWJdsdakPXjg/photo.jpg?sz=128", "display_name": "eliyahu levi", "link": "https://stackoverflow.com/users/12366211/eliyahu-levi"}, "edited": false, "score": 0, "creation_date": 1573705804, "post_id": 58836423, "comment_id": 103971913, "body": "If i will do that does&#39;nt that means i will need to move my project from the offline computer to the online one every time i need a new update?"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 1, "user_id": 12366211, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_FYhKQF8p8E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re4JF5O3GJE3SLRk1AWJdsdakPXjg/photo.jpg?sz=128", "display_name": "eliyahu levi", "link": "https://stackoverflow.com/users/12366211/eliyahu-levi"}, "edited": false, "score": 0, "creation_date": 1573706666, "post_id": 58836423, "comment_id": 103972122, "body": "When you are working on an offline PC, and for a tools update of course you need to repeat this process again. so it is very easy to work in an online PC. also you may automate the copy task and build a Go program to do the copy task. You may connect online and offline PCs using router via different networks e.g. Virtual private network and automate the task completely."}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 1, "last_activity_date": 1573674016, "last_edit_date": 1573674016, "creation_date": 1573645607, "answer_id": 58836423, "question_id": 58835633, "link": "https://stackoverflow.com/questions/58835633/downloading-and-installing-visual-studio-code-go-dependencies/58836423#58836423", "title": "Downloading and installing Visual Studio Code Go dependencies", "body": "<p><strong>Note</strong>: If both of your online and offline PCs have the same OS and architecture, simply copy the <code>$GOPATH</code> directory and you are good to go.</p>\n\n<p>(Note: Replace all <code>$GOPATH</code> with <code>%GOPATH%</code> for Windows OS)</p>\n\n<hr>\n\n<h2>Online</h2>\n\n<p>Go to the <a href=\"https://github.com/Microsoft/vscode-go/wiki/Go-tools-that-the-Go-extension-depends-on\" rel=\"nofollow noreferrer\">Go tools that the Go extension depends on</a>, and follow instructions for your OS:</p>\n\n<ol>\n<li>An example for <a href=\"https://github.com/go-delve/delve\" rel=\"nofollow noreferrer\">dlv</a>:</li>\n</ol>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go get -u -v github.com/go-delve/delve/cmd/dlv\n</code></pre>\n\n<p>An example for <a href=\"https://langserver.org/\" rel=\"nofollow noreferrer\">The Language Server</a>:   </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go get -u -v golang.org/x/tools/cmd/gopls\n\n</code></pre>\n\n<p>That is all.</p>\n\n<hr>\n\n<h2>Offline</h2>\n\n<ol start=\"2\">\n<li>For the <strong>offline</strong> installation you need first copy these files to the offline computer and just run e.g.:</li>\n</ol>\n\n<pre class=\"lang-sh prettyprint-override\"><code>cd $GOPATH/src/github.com/go-delve/delve/cmd/dlv\ngo install\n</code></pre>\n\n<p>Repeat steps 1 and 2 for all the packages you need, or simply have a clean <code>GOPATH/src</code> on first PC then compress all, then copy the compressed file and uncompress it then run <code>go install</code> for all packages you need to install.</p>\n\n<hr>\n\n<ol start=\"3\">\n<li><a href=\"https://github.com/golang/tools/\" rel=\"nofollow noreferrer\">Go Tools</a>:  </li>\n</ol>\n\n<h3>Online</h3>\n\n<p>The easiest way to install is to run:   </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go get -u golang.org/x/tools/...\n</code></pre>\n\n<h3>Offline copy</h3>\n\n<p>You can also manually git clone the repository to:<br>\n<code>$GOPATH/src/golang.org/x/tools</code></p>\n"}], "owner": {"reputation": 1, "user_id": 12366211, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_FYhKQF8p8E/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re4JF5O3GJE3SLRk1AWJdsdakPXjg/photo.jpg?sz=128", "display_name": "eliyahu levi", "link": "https://stackoverflow.com/users/12366211/eliyahu-levi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 780, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1573674016, "creation_date": 1573642769, "last_edit_date": 1573651111, "question_id": 58835633, "link": "https://stackoverflow.com/questions/58835633/downloading-and-installing-visual-studio-code-go-dependencies", "title": "Downloading and installing Visual Studio Code Go dependencies", "body": "<p>I have installed Visual Studio Code and the Go extension on an <strong>offline</strong> computer and now I need to install the dependencies on that computer.<br>\nHow can I do it please?</p>\n"}, {"tags": ["go", "machine-learning", "gradient-descent"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1573635179, "post_id": 58833048, "comment_id": 103941903, "body": "Well, literally nowhere in your code you anything resembling a linear regression at all. Implementing <a href=\"https://en.wikipedia.org/wiki/Ordinary_least_squares#Simple_linear_regression_model\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/&hellip;</a> should be trivial."}], "answers": [{"comments": [{"owner": {"reputation": 195, "user_id": 8484805, "user_type": "registered", "profile_image": "https://graph.facebook.com/1646240402077569/picture?type=large", "display_name": "Jon Nimrod", "link": "https://stackoverflow.com/users/8484805/jon-nimrod"}, "edited": false, "score": 1, "creation_date": 1573647394, "post_id": 58835263, "comment_id": 103948279, "body": "I apologize, I think I got the name wrong. I think what I&#39;m looking for is a gradient descent, as there should be a notion of learning rate and iterations."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 195, "user_id": 8484805, "user_type": "registered", "profile_image": "https://graph.facebook.com/1646240402077569/picture?type=large", "display_name": "Jon Nimrod", "link": "https://stackoverflow.com/users/8484805/jon-nimrod"}, "edited": false, "score": 0, "creation_date": 1573655415, "post_id": 58835263, "comment_id": 103952904, "body": "See the new edit and try it <a href=\"https://play.golang.org/p/R9bfNwH752X\" rel=\"nofollow noreferrer\">here</a>"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 2, "last_activity_date": 1573658973, "last_edit_date": 1573658973, "creation_date": 1573641555, "answer_id": 58835263, "question_id": 58833048, "link": "https://stackoverflow.com/questions/58833048/implementing-a-gradient-descent/58835263#58835263", "title": "Implementing a gradient descent", "body": "<p><a href=\"https://en.wikipedia.org/wiki/Ordinary_least_squares#Simple_linear_regression_model\" rel=\"nofollow noreferrer\">Linear Regression</a> is really simple:  </p>\n\n<pre><code>// yi = alpha + beta*xi + ei\nfunc linearRegression(x, y []float64) (float64, float64) {\n    EX := expected(x)\n    EY := expected(y)\n    EXY := expectedXY(x, y)\n    EXX := expectedXY(x, x)\n\n    covariance := EXY - EX*EY\n    variance := EXX - EX*EX\n    beta := covariance / variance\n    alpha := EY - beta*EX\n    return alpha, beta\n}\n</code></pre>\n\n<p>Try it <a href=\"https://play.golang.org/p/dJ-EF9j9-v2\" rel=\"nofollow noreferrer\">here</a>, Output:</p>\n\n<pre><code>8499.599649933218 -0.021448963591702314 396270.87871142407\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    x, y := readXY(`data.csv`)\n    alpha, beta := linearRegression(x, y)\n    fmt.Println(alpha, beta, -alpha/beta) // 8499.599649933218 -0.021448963591702314 396270.87871142407\n}\n\n// https://en.wikipedia.org/wiki/Ordinary_least_squares#Simple_linear_regression_model\n// yi = alpha + beta*xi + ei\nfunc linearRegression(x, y []float64) (float64, float64) {\n    EX := expected(x)\n    EY := expected(y)\n    EXY := expectedXY(x, y)\n    EXX := expectedXY(x, x)\n\n    covariance := EXY - EX*EY\n    variance := EXX - EX*EX\n    beta := covariance / variance\n    alpha := EY - beta*EX\n    return alpha, beta\n}\n\n// E[X]\nfunc expected(x []float64) float64 {\n    sum := 0.0\n    for _, v := range x {\n        sum += v\n    }\n    return sum / float64(len(x))\n}\n\n// E[XY]\nfunc expectedXY(x, y []float64) float64 {\n    sum := 0.0\n    for i, v := range x {\n        sum += v * y[i]\n    }\n    return sum / float64(len(x))\n}\n\nfunc readXY(filename string) ([]float64, []float64) {\n    // file, err := os.Open(filename)\n    // if err != nil {\n    //  panic(err)\n    // }\n    // defer file.Close()\n    file := strings.NewReader(data)\n\n    reader := csv.NewReader(file)\n    records, err := reader.ReadAll()\n    if err != nil {\n        panic(err)\n    }\n    records = records[1:]\n    size := len(records)\n    x := make([]float64, size)\n    y := make([]float64, size)\n    for i, v := range records {\n        val, err := strconv.ParseFloat(v[0], 64)\n        if err != nil {\n            panic(err)\n        }\n        x[i] = val\n        val, err = strconv.ParseFloat(v[1], 64)\n        if err != nil {\n            panic(err)\n        }\n        y[i] = val\n    }\n    return x, y\n}\n\nvar data = `km,price\n240000,3650\n139800,3800\n150500,4400\n185530,4450\n176000,5250\n114800,5350\n166800,5800\n89000,5990\n144500,5999\n84000,6200\n82029,6390\n63060,6390\n74000,6600\n97500,6800\n67000,6800\n76025,6900\n48235,6900\n93000,6990\n60949,7490\n65674,7555\n54000,7990\n68500,7990\n22899,7990\n61789,8290`\n</code></pre>\n\n<hr>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Gradient_descent\" rel=\"nofollow noreferrer\">Gradient descent</a> is based on the observation that if the multi-variable function <code>F(x)</code> is defined and differentiable in a neighborhood of a point <code>a</code> , then F(x) decreases fastest if one goes from <code>a</code> in the direction of the negative gradient of <code>F</code> at <code>a</code>,<code>-\u2207F(a)</code>, for example:  </p>\n\n<pre><code>// F(x)\nf := func(x float64) float64 {\n    return alpha + beta*x // write your target function here\n}\n</code></pre>\n\n<p>Derivative function:  </p>\n\n<pre><code>h := 0.000001\n// Derivative function \u2207F(x)\ndf := func(x float64) float64 {\n    return (f(x+h) - f(x-h)) / (2 * h) // write your target function derivative here\n}\n</code></pre>\n\n<p>Search:</p>\n\n<pre><code>minimunAt := 1.0       // We start the search here\ngamma := 0.01          // Step size multiplier\nprecision := 0.0000001 // Desired precision of result\nmax := 100000          // Maximum number of iterations\ncurrentX := 0.0\nstep := 0.0\nfor i := 0; i &lt; max; i++ {\n    currentX = minimunAt\n    minimunAt = currentX - gamma*df(currentX)\n    step = minimunAt - currentX\n    if math.Abs(step) &lt;= precision {\n        break\n    }\n}\n\nfmt.Printf(\"Minimum at %.8f value: %v\\n\", minimunAt, f(minimunAt))\n</code></pre>\n"}], "owner": {"reputation": 195, "user_id": 8484805, "user_type": "registered", "profile_image": "https://graph.facebook.com/1646240402077569/picture?type=large", "display_name": "Jon Nimrod", "link": "https://stackoverflow.com/users/8484805/jon-nimrod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1573658973, "creation_date": 1573633852, "last_edit_date": 1573647323, "question_id": 58833048, "link": "https://stackoverflow.com/questions/58833048/implementing-a-gradient-descent", "title": "Implementing a gradient descent", "body": "<p>I'm trying to implement a gradient descent in Go. My goal is to predict the cost of a car from it's mileage.\nHere is my data set:</p>\n\n<pre><code>km,price\n240000,3650\n139800,3800\n150500,4400\n185530,4450\n176000,5250\n114800,5350\n166800,5800\n89000,5990\n144500,5999\n84000,6200\n82029,6390\n63060,6390\n74000,6600\n97500,6800\n67000,6800\n76025,6900\n48235,6900\n93000,6990\n60949,7490\n65674,7555\n54000,7990\n68500,7990\n22899,7990\n61789,8290\n</code></pre>\n\n<p>I've tried various approaches, like normalizing the data set, not normalizing it, leaving thetas as is, denormalizing thetas... But I cannot get the correct result.\nMy maths must be off somewhere, but I cannot figure out where.\nThe result I'm trying to get should be approximately t0 = 8500, t1 = -0.02\nMy implementation is the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"fmt\"\n    \"log\"\n    \"math\"\n    \"os\"\n    \"strconv\"\n)\n\nconst (\n    dataFile     = \"data.csv\"\n    iterations   = 20000\n    learningRate = 0.1\n)\n\ntype dataSet [][]float64\n\nvar minKm, maxKm, minPrice, maxPrice float64\n\nfunc (d dataSet) getExtremes(column int) (float64, float64) {\n\n    min := math.Inf(1)\n    max := math.Inf(-1)\n    for _, row := range d {\n        item := row[column]\n        if item &gt; max {\n            max = item\n        }\n        if item &lt; min {\n            min = item\n        }\n    }\n\n    return min, max\n}\n\nfunc normalizeItem(item, min, max float64) float64 {\n\n    return (item - min) / (max - min)\n}\n\nfunc (d *dataSet) normalize() {\n\n    minKm, maxKm = d.getExtremes(0)\n    minPrice, maxPrice = d.getExtremes(1)\n    for _, row := range *d {\n        row[0], row[1] = normalizeItem(row[0], minKm, maxKm), normalizeItem(row[1], minPrice, maxPrice)\n    }\n}\n\nfunc processEntry(entry []string) []float64 {\n\n    if len(entry) != 2 {\n        log.Fatalln(\"expected two fields\")\n    }\n    km, err := strconv.ParseFloat(entry[0], 64)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    price, err := strconv.ParseFloat(entry[1], 64)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    return []float64{km, price}\n}\n\nfunc getData() dataSet {\n\n    file, err := os.Open(dataFile)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    reader := csv.NewReader(file)\n    entries, err := reader.ReadAll()\n    if err != nil {\n        log.Fatalln(err)\n    }\n    entries = entries[1:]\n\n    data := make(dataSet, len(entries))\n    for k, entry := range entries {\n        data[k] = processEntry(entry)\n    }\n    return data\n}\n\nfunc outputResult(theta0, theta1 float64) {\n    file, err := os.OpenFile(\"weights.csv\", os.O_WRONLY, 0644)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    defer file.Close()\n    file.Truncate(0)\n    file.Seek(0, 0)\n    file.WriteString(fmt.Sprintf(\"theta0,%.6f\\ntheta1,%.6f\\n\", theta0, theta1))\n}\n\nfunc estimatePrice(theta0, theta1, mileage float64) float64 {\n\n    return theta0 + theta1*mileage\n}\n\nfunc (d dataSet) computeThetas(theta0, theta1 float64) (float64, float64) {\n\n    dataSize := float64(len(d))\n    t0sum, t1sum := 0.0, 0.0\n    for _, it := range d {\n        mileage := it[0]\n        price := it[1]\n        err := estimatePrice(theta0, theta1, mileage) - price\n        t0sum += err\n        t1sum += err * mileage\n    }\n\n    return theta0 - (t0sum / dataSize * learningRate), theta1 - (t1sum / dataSize * learningRate)\n}\n\nfunc denormalize(theta, min, max float64) float64 {\n\n    return theta*(max-min) + min\n}\n\nfunc main() {\n\n    data := getData()\n    data.normalize()\n    theta0, theta1 := 0.0, 0.0\n    for k := 0; k &lt; iterations; k++ {\n        theta0, theta1 = data.computeThetas(theta0, theta1)\n    }\n    theta0 = denormalize(theta0, minKm, maxKm)\n    theta1 = denormalize(theta1, minPrice, maxPrice)\n    outputResult(theta0, theta1)\n}\n</code></pre>\n\n<p>What should I fix in order to properly implement a gradient descent?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 2, "creation_date": 1573625580, "post_id": 58831233, "comment_id": 103937989, "body": "Have you tried  <code>conn.Write([]byte(&quot;I&#39;m OK\\n&quot;))</code>?"}, {"owner": {"reputation": 311, "user_id": 11253551, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yLwPI.jpg?s=128&g=1", "display_name": "Codey", "link": "https://stackoverflow.com/users/11253551/codey"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1573625675, "post_id": 58831233, "comment_id": 103938024, "body": "Wow, I added the <code>\\n</code> and now it works! thanks a lot!!!"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1573625801, "post_id": 58831233, "comment_id": 103938070, "body": "Create a single bufio.Reader outside of the loop to avoid discarding buffered data read from the connection."}, {"owner": {"reputation": 311, "user_id": 11253551, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yLwPI.jpg?s=128&g=1", "display_name": "Codey", "link": "https://stackoverflow.com/users/11253551/codey"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1573626106, "post_id": 58831233, "comment_id": 103938154, "body": "@CeriseLim&#243;n Ok, thank you"}], "owner": {"reputation": 311, "user_id": 11253551, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yLwPI.jpg?s=128&g=1", "display_name": "Codey", "link": "https://stackoverflow.com/users/11253551/codey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1573634523, "creation_date": 1573625374, "last_edit_date": 1573634523, "question_id": 58831233, "link": "https://stackoverflow.com/questions/58831233/client-should-send-a-message-automatically-without-user-interaction", "title": "Client should send a message automatically without user interaction", "body": "<p>I have client-server written in Go. The server sends \"hello\" every 5 seconds and I want the client to respond \"I'm OK\". I can see the \"hello\" output at the client side. I want the client to send the message automatically. At the client side I have:</p>\n\n<pre><code>conn, _ := net.Dial(\"tcp\", \"127.0.0.1:8181\")\nfor {\n    message, _ := bufio.NewReader(conn).ReadString('\\n')\n    fmt.Print(message)\n    conn.Write([]byte(\"I'm OK\"))\n}\n</code></pre>\n\n<p>But the message is sent only after client user presses \"enter\" but I need it to be automatic.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1573634159, "post_id": 58831026, "comment_id": 103941406, "body": "Where does the documentation say that? Can you quote the specific claim? I don&#39;t see that anywhere."}, {"owner": {"reputation": 1624, "user_id": 623105, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/3be63dad1fc4e5a554b6239ca76baf30?s=128&d=identicon&r=PG", "display_name": "Rajat banerjee", "link": "https://stackoverflow.com/users/623105/rajat-banerjee"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1573672908, "post_id": 58831026, "comment_id": 103962045, "body": "I was specifically going of  <a href=\"https://golang.org/src/net/http/server.go?s=88291:88332#L2803\" rel=\"nofollow noreferrer\">golang.org/src/net/http/server.go?s=88291:88332#L2803</a>  and <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http</a> turns out i was wrong in my assumption\\understanding"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1573724617, "post_id": 58831026, "comment_id": 103979401, "body": "The reason I downvoted is because your question doesn&#39;t make sense, as you yourself admitted. You mis-read the documentation."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1573807473, "post_id": 58831026, "comment_id": 104014249, "body": "Argue the semantics all you like. You asked why I down-voted, and I explained. I stand by that reason. Your question says &quot;The documentation says X&quot;, but the documentation doesn&#39;t say X. I call that misreading. Call it what you want."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 2, "last_activity_date": 1573624672, "last_edit_date": 1573624672, "creation_date": 1573624314, "answer_id": 58831052, "question_id": 58831026, "link": "https://stackoverflow.com/questions/58831026/does-the-server-need-to-be-a-pointer/58831052#58831052", "title": "Does the server need to be a pointer", "body": "<p>See \"<a href=\"https://stackoverflow.com/a/9958152/6309\">Go Syntax of calling a function with pointer receiver</a>\", and<br>\nthe spec: \"<a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">Method Set</a>\"</p>\n\n<blockquote>\n  <p>The method set of the corresponding pointer type <code>*T</code> is the set of all methods with receiver <code>*T</code> or <code>T</code> (that is, it also contains the method set of <code>T</code>). </p>\n</blockquote>\n\n<p>So <a href=\"https://golang.org/pkg/net/http/#Server.ListenAndServe\" rel=\"nofollow noreferrer\"><code>func (*Server) ListenAndServe</code></a> works both for <code>Server</code> and <code>*Server</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1573657812, "last_edit_date": 1573657812, "creation_date": 1573624776, "answer_id": 58831121, "question_id": 58831026, "link": "https://stackoverflow.com/questions/58831026/does-the-server-need-to-be-a-pointer/58831121#58831121", "title": "Does the server need to be a pointer", "body": "<p>Both examples use the address of an <code>http.Server</code>.  The first example explicitly takes the address of an <code>http.Server</code>.  </p>\n\n<p>In the second example, the call  <code>server.ListenAndServe()</code> is shorthand for <code>(&amp;server).ListenAndServe()</code>.  </p>\n\n<p>Here's the <a href=\"https://golang.org/ref/spec#Calls\" rel=\"nofollow noreferrer\">relevant text from the specification</a> on the shorthand:</p>\n\n<blockquote>\n  <p>A method call x.m() is valid if the method set of (the type of) x contains m and the argument list can be assigned to the parameter list of m. If x is addressable and &amp;x's method set contains m, x.m() is shorthand for (&amp;x).m()</p>\n</blockquote>\n\n<p>The short handle is applied because  variable <code>server</code> is <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">addressable</a> and <code>&amp;server</code>'s <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">method set</a> contains <code>ListenAndServe()</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1573624787, "creation_date": 1573624787, "answer_id": 58831124, "question_id": 58831026, "link": "https://stackoverflow.com/questions/58831026/does-the-server-need-to-be-a-pointer/58831124#58831124", "title": "Does the server need to be a pointer", "body": "<p>The method is defined with a pointer receiver, meaning it must be called on an addressable receiver. So, for instance:</p>\n\n<pre><code>func f() http.Server {...}\n\nf().ListenAndServe()\n</code></pre>\n\n<p>would not work. </p>\n\n<p>When you call:</p>\n\n<pre><code>server.ListenAndServe()\n</code></pre>\n\n<p>the method receives the address of <code>server</code> instead of a copy of it. </p>\n"}], "owner": {"reputation": 1624, "user_id": 623105, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/3be63dad1fc4e5a554b6239ca76baf30?s=128&d=identicon&r=PG", "display_name": "Rajat banerjee", "link": "https://stackoverflow.com/users/623105/rajat-banerjee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 1, "accepted_answer_id": 58831052, "answer_count": 3, "score": -1, "last_activity_date": 1573851656, "creation_date": 1573624127, "last_edit_date": 1573851656, "question_id": 58831026, "link": "https://stackoverflow.com/questions/58831026/does-the-server-need-to-be-a-pointer", "title": "Does the server need to be a pointer", "body": "<p>According to <a href=\"https://golang.org/pkg/net/http/#Server.ListenAndServe\" rel=\"nofollow noreferrer\">The http#Server.ListenAndServe documentation</a></p>\n\n<pre><code>func (*Server) ListenAndServe \n</code></pre>\n\n<p>takes server as a pointer</p>\n\n<p>And according to [<a href=\"https://golang.org/pkg/net/http/]\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/]</a> it seems that the server should be created as pointer</p>\n\n<pre><code>server := &amp;http.Server{\n    Addr:              \":8080\",\n    Handler:           nil,\n    TLSConfig:         nil,\n    .....\n}\n</code></pre>\n\n<p>But, this works perfectly fine. What am I missing here?</p>\n\n<pre><code>    server := http.Server{\n    Addr:              \":8080\",\n    Handler:           nil,\n    ......\n}\n\nif err := server.ListenAndServe(); err!=nil{\n    log.Fatal(\"oh Dear!\")\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "docker-compose", "rabbitmq", "amqp"], "comments": [{"owner": {"reputation": 1661, "user_id": 3928295, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/dJXv9.jpg?s=128&g=1", "display_name": "Manmohan_singh", "link": "https://stackoverflow.com/users/3928295/manmohan-singh"}, "edited": false, "score": 0, "creation_date": 1573618361, "post_id": 58830108, "comment_id": 103936229, "body": "Are you using docker-on-windows?"}, {"owner": {"reputation": 627, "user_id": 2931316, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tOHqU.jpg?s=128&g=1", "display_name": "M Ashraful A", "link": "https://stackoverflow.com/users/2931316/m-ashraful-a"}, "edited": false, "score": 0, "creation_date": 1573633293, "post_id": 58830108, "comment_id": 103941015, "body": "are closing the rabbitmq channel in defer? you can try strategies like reconnect to rabbitmq if connection not active"}, {"owner": {"reputation": 759, "user_id": 4471199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2624903a10a10e7acb0fcd85b8a0d68?s=128&d=identicon&r=PG&f=1", "display_name": "RoBeaToZ", "link": "https://stackoverflow.com/users/4471199/robeatoz"}, "edited": false, "score": 0, "creation_date": 1573660119, "post_id": 58830108, "comment_id": 103955645, "body": "Maybe some investigation of the running container with <code>docker exec -it container_name &#47;bin&#47;sh</code> helps."}, {"owner": {"reputation": 21, "user_id": 11994228, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCBIYfBEWBYAetsKfGJYuofpZ4g1-fCaZYPCCxrew=k-s128", "display_name": "Aman Patel", "link": "https://stackoverflow.com/users/11994228/aman-patel"}, "reply_to_user": {"reputation": 627, "user_id": 2931316, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tOHqU.jpg?s=128&g=1", "display_name": "M Ashraful A", "link": "https://stackoverflow.com/users/2931316/m-ashraful-a"}, "edited": false, "score": 0, "creation_date": 1573690958, "post_id": 58830108, "comment_id": 103968679, "body": "@MAshrafulA yes i am closing channel in defer , and i am also reconnecting to rabbit mq if the channel connection gets closed unexpectedly / connection not active . Thanks"}, {"owner": {"reputation": 21, "user_id": 11994228, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCBIYfBEWBYAetsKfGJYuofpZ4g1-fCaZYPCCxrew=k-s128", "display_name": "Aman Patel", "link": "https://stackoverflow.com/users/11994228/aman-patel"}, "reply_to_user": {"reputation": 759, "user_id": 4471199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2624903a10a10e7acb0fcd85b8a0d68?s=128&d=identicon&r=PG&f=1", "display_name": "RoBeaToZ", "link": "https://stackoverflow.com/users/4471199/robeatoz"}, "edited": false, "score": 0, "creation_date": 1573691058, "post_id": 58830108, "comment_id": 103968705, "body": "@RoBeaToZ can you please elaborate a bit as i am still a begineer with docker. Thanks"}, {"owner": {"reputation": 21, "user_id": 11994228, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCBIYfBEWBYAetsKfGJYuofpZ4g1-fCaZYPCCxrew=k-s128", "display_name": "Aman Patel", "link": "https://stackoverflow.com/users/11994228/aman-patel"}, "reply_to_user": {"reputation": 1661, "user_id": 3928295, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/dJXv9.jpg?s=128&g=1", "display_name": "Manmohan_singh", "link": "https://stackoverflow.com/users/3928295/manmohan-singh"}, "edited": false, "score": 0, "creation_date": 1573691111, "post_id": 58830108, "comment_id": 103968722, "body": "@Manmohan_singh . using it on linux . Thanks"}, {"owner": {"reputation": 759, "user_id": 4471199, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2624903a10a10e7acb0fcd85b8a0d68?s=128&d=identicon&r=PG&f=1", "display_name": "RoBeaToZ", "link": "https://stackoverflow.com/users/4471199/robeatoz"}, "edited": false, "score": 0, "creation_date": 1573718239, "post_id": 58830108, "comment_id": 103976137, "body": "<code>docker exec</code> allows you to execute arbitrary commands, see <a href=\"https://docs.docker.com/engine/reference/commandline/exec/\" rel=\"nofollow noreferrer\">docs.docker.com/engine/reference/commandline/exec</a>. With the options <code>-it</code> and the command <code>&#47;bin&#47;sh</code> you will get a shell and will be able to investigate your container with commands like <code>ls -l</code>, <code>cat &#47;some&#47;file.txt</code>, etc."}], "owner": {"reputation": 21, "user_id": 11994228, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCBIYfBEWBYAetsKfGJYuofpZ4g1-fCaZYPCCxrew=k-s128", "display_name": "Aman Patel", "link": "https://stackoverflow.com/users/11994228/aman-patel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 359, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1573634227, "creation_date": 1573617295, "last_edit_date": 1573634227, "question_id": 58830108, "link": "https://stackoverflow.com/questions/58830108/docker-service-freezes-with-no-logs", "title": "Docker service freezes with no logs", "body": "<p>I have a consumer written in Go, which consumes messages from rabbitmq then connects two different DBs and does some work.\nI am using docker-compose to run my consumer. Generally it works fine,</p>\n\n<p>But sometimes it so happens that the <em>docker logs </em> command shows nothing and the rabbitmq ui shows that no consumers are running on the queue. All this happens while the docker container is still up. I then just stop and start the container and everything goes normal.</p>\n\n<p>I am not able to debug this. Has anyone encountered this before or has an idea about this issue?</p>\n"}, {"tags": ["go", "channels"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1573625547, "post_id": 58830097, "comment_id": 103937975, "body": "Is there other code that sends to <code>messages</code>?  Is the code reported by the race detector all in the anonymous function defined in <code>MessagesFromSQS</code>?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1573629012, "post_id": 58830097, "comment_id": 103939126, "body": "Perhaps not quite the same situation, but see my answer to <a href=\"https://stackoverflow.com/q/58793428/1256452\">stackoverflow.com/q/58793428/1256452</a>. The code you&#39;ve shown here seems fine."}], "answers": [{"comments": [{"owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "edited": false, "score": 1, "creation_date": 1573618936, "post_id": 58830282, "comment_id": 103936359, "body": "That is a less safe way or what I&#39;ve already got. The problem is the <code>close()</code> happens in a different goroutine as the send."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "edited": false, "score": 0, "creation_date": 1573619437, "post_id": 58830282, "comment_id": 103936460, "body": "It&#39;s not uncommon to close a channel from other go-routine(s) writers. The waitgroup combined with the wait() ensures no one is left to write to the channel. This is perfectly safe coordination."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "edited": false, "score": 0, "creation_date": 1573653546, "post_id": 58830282, "comment_id": 103951747, "body": "Also, one should never get a data-race on a channel - they are designed for concurrent use. (There are caveats to this - but as long as the channel is initialized before use - you should be safe). I suspect (and as @CeriseLimon commented) the data race is with <code>result.Messages</code>. If this is a slice and it&#39;s being written to as workers are reading from it - then that&#39;s a major issue. You may want to think about using an input channel instead - and worker read from that. Then any data-race should disappear."}, {"owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "edited": false, "score": 1, "creation_date": 1573681752, "post_id": 58830282, "comment_id": 103965919, "body": "Thanks for that. It turns out I wasn&#39;t reading the race detector stack trace correctly. I assumed that the code I changed introduced the bug, instead of uncovering a bug in the SQS mock. Once I correctly synchronized the method that returns the messages it was fine."}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 2, "last_activity_date": 1573619214, "last_edit_date": 1573619214, "creation_date": 1573618747, "answer_id": 58830282, "question_id": 58830097, "link": "https://stackoverflow.com/questions/58830097/how-to-close-a-channel-with-multiple-senders/58830282#58830282", "title": "How to close a channel with multiple senders?", "body": "<p>Close the channel when you know there won't be any more writes i.e. when all worker go-routines are complete.</p>\n\n<p>So:</p>\n\n<pre><code>wg.Wait()\nclose(messages)\n</code></pre>\n\n<p>P.S. I'd restructure your polling of context cancelation by combining it in a select with your channel writes e.g.</p>\n\n<pre><code>for _, message := range result.Messages {\n\n    select {\n        case messages &lt;- message:\n        case &lt;-ctx.Done():\n            return\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1573681870, "creation_date": 1573617225, "last_edit_date": 1573681870, "question_id": 58830097, "link": "https://stackoverflow.com/questions/58830097/how-to-close-a-channel-with-multiple-senders", "title": "How to close a channel with multiple senders?", "body": "<p>I have a case where I need to fan out receivers that send to the same channel:</p>\n\n<pre><code>func MessagesFromSQS(ctx context.Context, sqsClient sqsiface.SQSAPI) chan *sqs.Message {\n    messages := make(chan *sqs.Message)\n\n    go func() {\n        defer close(messages)\n        wg := sync.WaitGroup{}\n\n        for i := 0; i &lt; parallelSQSReaders; i++ {\n            wg.Add(1)\n            go func() {\n                defer wg.Done()\n\n                for {\n                    select {\n                    case &lt;-ctx.Done():\n                        return\n\n                    default:\n                        // ...\n\n                        for _, message := range result.Messages {\n                            messages &lt;- message\n                        }\n                    }\n                }\n            }()\n        }\n\n        wg.Wait()\n    }()\n\n    return messages\n}\n</code></pre>\n\n<p>To me this makes sense. However, the race detector complains that different goroutines and sending and closing the channel. I realize that the goroutine thats responsible for sending should be the same one that closes, but what's the correct way to do this?</p>\n\n<p>EDIT/SOLVED: Thanks for your responses. It turns out I wasn't reading the race detector stack trace correctly. I assumed that the code I changed introduced the bug, instead of uncovering a bug in the SQS mock. Once I correctly synchronized <code>ReceiveMessage()</code> it was fine.</p>\n"}, {"tags": ["javascript", "html", "go"], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 3504236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c6e8829834f9aa50ebad86e702fa5a4?s=128&d=identicon&r=PG&f=1", "display_name": "atye", "link": "https://stackoverflow.com/users/3504236/atye"}, "edited": false, "score": 0, "creation_date": 1573612121, "post_id": 58829203, "comment_id": 103935028, "body": "I edited my question with the full websocket handler. I haven&#39;t figured it out yet. @cerise-lim&#243;n"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1573614654, "last_edit_date": 1573614654, "creation_date": 1573609817, "answer_id": 58829203, "question_id": 58828910, "link": "https://stackoverflow.com/questions/58828910/how-to-gracefully-re-connect-websocket/58829203#58829203", "title": "How to gracefully re-connect websocket?", "body": "<p>Websocket server applications must handle errors on the connection by closing the connection and releasing resources associated with the connection.</p>\n\n<p>Browsers close websocket connections when the containing page is refreshed. The server will eventually get a read or write error after the browser closes the connection.</p>\n\n<p>Connection close is one of several possible errors that the server might encounter.  The server application should handle all errors on the connection the same way: close the connection and release resources associated with the connection.</p>\n\n<p>The typical application design is for the client to connect on page load and to reconnect (with backoff) after an error. The server assumes that clients will connect and disconnect over time.</p>\n\n<p>The JS code can be improved by adding an onerror handler that reconnects with backoff.  Depending on the application, you may also want to display UI indicating the connection status.</p>\n\n<p>The Go code does not close the connection in all scenarios. The running command is the resource associated with the connection. The application does not kill this program on connection error.  Here are some fixes:</p>\n\n<p>Add <code>defer ws.Close()</code> after successful upgrade. Remove other direct calls to <code>ws.Close()</code> from <code>SocketHandler.ServeHTTP</code>.  This ensures that <code>ws.Close()</code> is called in all scenarios.</p>\n\n<p>Kill the command on exit from the read and write pumps. Move the read pump to after the command is started. Kill on return.</p>\n\n<pre><code>go func(c *websocket.Conn, cmd *exec.Command) {\n    defer c.Close()\n    defer cmd.Process.Kill()\n    for {\n        if _, _, err := c.NextReader(); err != nil {\n            break\n        }\n    }\n}(ws, cmd)\n</code></pre>\n\n<p>Kill the command on exit from the write pump:</p>\n\n<pre><code>s := bufio.NewScanner(io.MultiReader(stdout, stderr))\nfor s.Scan() {\n    err := ws.WriteMessage(1, s.Bytes())\n    if err != nil {\n        break\n    }\n}\ncmd.Process.Kill()\n</code></pre>\n\n<p>I have not run or tested this code. It's possible that some of the details are wrong, but this outlines the general approach of closing the connection and releasing the resource.</p>\n\n<p>Take a look at the <a href=\"https://github.com/gorilla/websocket/tree/master/examples/command\" rel=\"nofollow noreferrer\">Gorilla command example</a>. The example shows how to pump stdin and stdout to a websocket.  The example also handles more advanced features like checking the health of the connection with PING/PONG.</p>\n"}], "owner": {"reputation": 69, "user_id": 3504236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c6e8829834f9aa50ebad86e702fa5a4?s=128&d=identicon&r=PG&f=1", "display_name": "atye", "link": "https://stackoverflow.com/users/3504236/atye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 58829203, "answer_count": 1, "score": 0, "last_activity_date": 1573614654, "creation_date": 1573607250, "last_edit_date": 1573612018, "question_id": 58828910, "link": "https://stackoverflow.com/questions/58828910/how-to-gracefully-re-connect-websocket", "title": "How to gracefully re-connect websocket?", "body": "<p>I'm building a singe-page application using HTTP and Websockets. The user submits a form and I stream a response to the client. Below is a snippet client.</p>\n\n<pre><code>var html = `&lt;!DOCTYPE html&gt;\n\n&lt;meta charset=\"utf-8\"&gt;\n&lt;head&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n&lt;script&gt;\nvar ws = new WebSocket(\"ws://localhost:8000/ws\")\nws.onmessage = function(e) {\n  document.getElementById(\"output\").innerHTML += e.data + \"&lt;br&gt;\"\n}\n\nfunction submitFunction() {\n  document.getElementById(\"output\").innerHTML += \"\"\n  return false\n}\n&lt;/script&gt;\n\n&lt;form\nenctype=\"multipart/x-www-form-urlencoded\"\naction=\"http://localhost:8000/\"\nmethod=\"post\"\n&gt;`\n</code></pre>\n\n<p>This is the server. If the request is not a POST, I write/render the html (parseAndExecute) which establishes a new websocket connection. If the request is a POST (from the form), then I start processing and eventually write to the websocket.</p>\n\n<pre><code>func (c *Config) ServeHtml(w http.ResponseWriter, r *http.Request) {\n    if r.Method == http.MethodPost {\n        //process\n        channel &lt;- data\n    }\n\n    c.parseAndExecute(w)\n}\n\nfunc (sh *SocketHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    ws, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        w.Write([]byte(fmt.Sprintf(\"\", err)))\n        return\n    }\n    //defer ws.Close()\n\n    // discard received messages\n    go func(c *websocket.Conn) {\n        for {\n            if _, _, err := c.NextReader(); err != nil {\n                c.Close()\n                break\n            }\n        }\n    }(ws)\n\n    data &lt;- channel\n\n</code></pre>\n\n<p>Everything works as I expect only if I do not refresh the page. If I don't refresh, I can keep submitting forms and see the different outputs come in line by line. To clarify, it actually only works if the page is already up so that <code>parseAndExecute</code> is never called. This function parses and executes html/template creating a new websocket client.</p>\n\n<p>Any refresh of the page or initially browsing localhost:8000 would cause <code>websocket: close sent</code> on the server.</p>\n\n<p>I'm not sure how to resolve this. Does the server to need to gracefully handle disconnections and allow re-connects? Or does the client need to do something? It seems like the server should upgrade any connection at <code>/ws</code> so it shouldn't matter how many new websocket clients are made but obviously my understanding is wrong.</p>\n\n<p>I'm not closing the websocket connection on the server because it should be up for as long as the program is running. When the user stops the program, I assume it'll be automatically closed.</p>\n\n<p>Full SocketHandler code:</p>\n\n<pre><code>func (sh *SocketHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    ws, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        w.Write([]byte(fmt.Sprintf(\"\", err)))\n        return\n    }\n\n    // discard received messages\n    go func(c *websocket.Conn) {\n        for {\n            if _, _, err := c.NextReader(); err != nil {\n                c.Close()\n                break\n            }\n        }\n    }(ws)\n\n    cmd := &lt;-sh.cmdCh\n\n    log.Printf(\"Executing\")\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        w.Write([]byte(err.Error()))\n        return\n    }\n    defer stdout.Close()\n\n    stderr, err := cmd.StderrPipe()\n    if err != nil {\n        w.Write([]byte(err.Error()))\n        return\n    }\n    defer stderr.Close()\n\n    if err := cmd.Start(); err != nil {\n        w.Write([]byte(err.Error()))\n        return\n    }\n\n    s := bufio.NewScanner(io.MultiReader(stdout, stderr))\n    for s.Scan() {\n        err := ws.WriteMessage(1, s.Bytes())\n        if err != nil {\n            log.Printf(\"Error writing to client: %v\", err)\n            ws.Close()\n        }\n\n    }\n\n    if err := cmd.Wait(); err != nil {\n        w.Write([]byte(err.Error()))\n        return\n    }\n\n    log.Println(\"Done\")\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4243, "user_id": 2401804, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/chtg9.jpg?s=128&g=1", "display_name": "r3wt", "link": "https://stackoverflow.com/users/2401804/r3wt"}, "edited": false, "score": 1, "creation_date": 1573601113, "post_id": 58828144, "comment_id": 103932607, "body": "<code>\\`</code> did you try backslashes to escape the ticks in the string?"}, {"owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "reply_to_user": {"reputation": 4243, "user_id": 2401804, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/chtg9.jpg?s=128&g=1", "display_name": "r3wt", "link": "https://stackoverflow.com/users/2401804/r3wt"}, "edited": false, "score": 1, "creation_date": 1573601666, "post_id": 58828144, "comment_id": 103932740, "body": "that doesn&#39;t work"}, {"owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "reply_to_user": {"reputation": 4243, "user_id": 2401804, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/chtg9.jpg?s=128&g=1", "display_name": "r3wt", "link": "https://stackoverflow.com/users/2401804/r3wt"}, "edited": false, "score": 2, "creation_date": 1573601775, "post_id": 58828144, "comment_id": 103932776, "body": "the backtick makes everything literal so no character substitutions.  However, if I use double quotes and escape the double qoutes using \\ preceeding the &quot;, then it does work.    cool"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1573601932, "post_id": 58828144, "comment_id": 103932804, "body": "You could say base64 or hex-encode it. But it really is easier to use double quotes and escape them."}], "answers": [{"tags": [], "owner": {"reputation": 147, "user_id": 5469480, "user_type": "registered", "profile_image": "https://graph.facebook.com/989634997760906/picture?type=large", "display_name": "roasty", "link": "https://stackoverflow.com/users/5469480/roasty"}, "is_accepted": true, "score": 2, "last_activity_date": 1573602107, "creation_date": 1573602107, "answer_id": 58828306, "question_id": 58828144, "link": "https://stackoverflow.com/questions/58828144/single-double-qoute-backtick-escape-special-character-rich-string/58828306#58828306", "title": "Single double qoute backtick escape special character rich string", "body": "<p>You can put the string in double-quotes and use a backslash to escape any double-quotes or backslashes within the string.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    licKey := \"sQO*=+=ZG7#UXz!I:C&amp;?sNUfg\\`j.*C!29x,HP|@=wJ;],{N;?rmc}b4~$ma,&gt;p._9(&amp;Xj4PQ3RhzF6#B;}cf0jFx`=qZYl|IB9/_d85P?PeD&gt;,te9~sfPlCeNM$X;VZ/aWR-WEZ//oP&amp;yO^SsGEI:5CyeZsWK{uREUI6tD@TC&amp;?8fHQ^a0wLhmxBkPBZ]U/&amp;8?T$VUAGx#:.XSu%azB{/H,ejiGss.T)D5U]O6JmEIEdEC+q5-C*e&amp;T~]Q&amp;YaYl0&lt;B;tSx0i'_c+ZC2'W]c&amp;b0Aud&amp;b_fnv_&lt;#3x2C4USSXkOL&amp;}MNC=z-6#`Oy)D!fc+=bQ,vZF\"\n</code></pre>\n\n<p>If you are looking to convert control characters and non-printable characters, take a look at <a href=\"https://golang.org/pkg/strconv/#Quote\" rel=\"nofollow noreferrer\">strconv.Quote</a></p>\n"}], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 58828306, "answer_count": 1, "score": -1, "last_activity_date": 1573634354, "creation_date": 1573600980, "last_edit_date": 1573634354, "question_id": 58828144, "link": "https://stackoverflow.com/questions/58828144/single-double-qoute-backtick-escape-special-character-rich-string", "title": "Single double qoute backtick escape special character rich string", "body": "<p>I need to assign an unwieldy special character rich string to a variable in Go.  The string contains single, double quotes as well as backticks.</p>\n\n<p>example:  </p>\n\n<pre><code>licKey := `sQO*=+=ZG7#UXz!I:C&amp;?sNUfg`j.*C!29x,HP|@=wJ;],{N;?rmc}b4~$ma,&gt;p._9(&amp;Xj4PQ3RhzF6#B;}cf0jFx`=qZYl|IB9/_d85P?PeD&gt;,te9~sfPlCeNM$X;VZ/aWR-WEZ//oP&amp;yO^SsGEI:5CyeZsWK{uREUI6tD@TC&amp;?8fHQ^a0wLhmxBkPBZ]U/&amp;8?T$VUAGx#:.XSu%azB{/H,ejiGss.T)D5U]O6JmEIEdEC+q5-C*e&amp;T~]Q&amp;YaYl0&lt;B;tSx0i'_c+ZC2'W]c&amp;b0Aud&amp;b_fnv_&lt;#3x2C4USSXkOL&amp;}MNC=z-6#`Oy)D!fc+=bQ,vZF`\n</code></pre>\n\n<p>I've wrapped the string itself in backticks (`), but as you can see, there are back ticks throughout the string itself.  </p>\n\n<p>One method that comes to mind is externalizing the string into a text file and reading it from there and assigning the variable to contents:</p>\n\n<pre><code>raw, err := ioutil.ReadFile(&lt;filePath&gt;)\nif err != nil {\n    return\n}\nlicKey := string(raw)\n</code></pre>\n\n<p>I just wanted to check if there is maybe some other approach built into the standard libraries that could help that anyone knows of? Maybe escaping?</p>\n"}, {"tags": ["go", "mutex"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 3, "last_activity_date": 1573599672, "creation_date": 1573599672, "answer_id": 58827953, "question_id": 58827925, "link": "https://stackoverflow.com/questions/58827925/how-to-log-a-struct-with-a-mutex/58827953#58827953", "title": "How to log a struct with a mutex", "body": "<p>Simply use pointer</p>\n\n<pre><code>fmt.Println(&amp;foo2)\n</code></pre>\n\n<p>Or extend the formatting</p>\n\n<pre><code>fmt.Printf(\"%+v\\n\", &amp;foo2)\n</code></pre>\n"}], "owner": {"reputation": 369, "user_id": 3576684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2beb681ae0941477036f45967ab2378b?s=128&d=identicon&r=PG&f=1", "display_name": "peaxol", "link": "https://stackoverflow.com/users/3576684/peaxol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 58827953, "answer_count": 1, "score": 2, "last_activity_date": 1573683375, "creation_date": 1573599399, "last_edit_date": 1573683375, "question_id": 58827925, "link": "https://stackoverflow.com/questions/58827925/how-to-log-a-struct-with-a-mutex", "title": "How to log a struct with a mutex", "body": "<p>I have a struct in Go with a mutex:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype foo struct {\n    sync.Mutex\n    lastID       uint64\n    nameToID map[string]uint64\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    foo2 := foo{lastID: 0,nameToID: map[string]uint64{\"name\":0}}\n    fmt.Println(foo2) \n}\n\n\n</code></pre>\n\n<p>Above gives a go vet warning (<a href=\"https://play.golang.org/p/J0NFgBvSGJC\" rel=\"nofollow noreferrer\">https://play.golang.org/p/J0NFgBvSGJC</a>) :</p>\n\n<pre><code>./prog.go:17:14: call of fmt.Println copies lock value: play.foo\n</code></pre>\n\n<p>I saw a related github issue <a href=\"https://github.com/golang/go/issues/13675\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/13675</a> and understand the need of this warning in general to warn about copying locks. \nI can workaround above by creating a custom string method omitting the lock. \nHowever - since structs with mutexes seem widespread, I am wondering if there is a better/idiomatic way to log structs containing mutexes in Go?</p>\n"}, {"tags": ["go", "protocol-buffers"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": -1, "last_activity_date": 1573592169, "creation_date": 1573592169, "answer_id": 58826536, "question_id": 58826458, "link": "https://stackoverflow.com/questions/58826458/how-to-use-time-time-declared-in-struct-of-protocol-buffer/58826536#58826536", "title": "How to use *time.Time declared in struct of protocol buffer", "body": "<p>As you have it</p>\n\n<pre><code>*res.CurentTime = time.Now()\n</code></pre>\n\n<p>Will first dereference <code>res.CurentTime</code> (that's what the <code>*</code> does here), which, if it's <code>nil</code>, will immediately panic. What comes after doesn't matter. Instead you need to assign a pointer, not assign a new value to the existing (<code>nil</code>) pointer:</p>\n\n<pre><code>now := time.Now()\nres.CurentTime = &amp;now\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 0, "last_activity_date": 1573592675, "creation_date": 1573592675, "answer_id": 58826630, "question_id": 58826458, "link": "https://stackoverflow.com/questions/58826458/how-to-use-time-time-declared-in-struct-of-protocol-buffer/58826630#58826630", "title": "How to use *time.Time declared in struct of protocol buffer", "body": "<p>Go's <code>time.Time</code> is a struct with <a href=\"https://golang.org/src/time/time.go?s=6278:7279#L117\" rel=\"nofollow noreferrer\">non-public fields</a> that cannot be sent via protocol-buffers directly.</p>\n\n<p>Instead convert any <code>time.Time</code> values to google's protobuf time types.\n(Under the covers this is a simple unixtime i.e. seconds since 1970 plus nanoseconds with <em>NO</em> timezone information - <a href=\"https://github.com/protocolbuffers/protobuf/blob/master/src/google/protobuf/timestamp.proto#L127\" rel=\"nofollow noreferrer\">see here</a>)</p>\n\n<p>For example, in your <code>.proto</code> file:</p>\n\n<pre><code>syntax = \"proto3\";\n\nimport \"google/protobuf/timestamp.proto\";\n\nmessage MyData {\n    google.protobuf.Timestamp   updated             = 1;\n    google.protobuf.Timestamp   created             = 2;\n}\n</code></pre>\n\n<p>And in your go code:</p>\n\n<pre><code>import (\n    \"time\"\n\n    \"github.com/golang/protobuf/ptypes\"\n)\n\n// ...\n\nupdatedTime := time.Now()\nupdatedProto, err := ptypes.TimestampProto(updatedTime)\n\n// ...\n\nmydate := &amp;pb.MyData{\n    updated: updatedProto,\n}\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 6934859, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/b5271c2c544782fc50b1b96aa600681c?s=128&d=identicon&r=PG&f=1", "display_name": "XnaijaZ", "link": "https://stackoverflow.com/users/6934859/xnaijaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 58826536, "answer_count": 2, "score": -1, "last_activity_date": 1573592675, "creation_date": 1573591813, "question_id": 58826458, "link": "https://stackoverflow.com/questions/58826458/how-to-use-time-time-declared-in-struct-of-protocol-buffer", "title": "How to use *time.Time declared in struct of protocol buffer", "body": "<p>I have the following defined in a struct of my protocol buffer:</p>\n\n<pre><code>CurentTime    *time.Time                     `protobuf:\"bytes,5,opt,name=curent_time,json=curentTime,proto3,stdtime\" json:\"curent_time,omitempty\"\n</code></pre>\n\n<p>In my main.go code, I try to assign it like the following:\n<code>*res.CurentTime = time.Now()</code></p>\n\n<p>I keep getting the following error:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x1642e61]\n</code></pre>\n\n<p>I believe I am doing assignment incorrect, but why and how do I fix this to assign properly and not crash my system ?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 7882718, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nqSu-MGVZk0/AAAAAAAAAAI/AAAAAAAAAG4/dD5_FvmoyyE/photo.jpg?sz=128", "display_name": "Venkatesh Sorapalli", "link": "https://stackoverflow.com/users/7882718/venkatesh-sorapalli"}, "edited": false, "score": 0, "creation_date": 1573584462, "post_id": 58824770, "comment_id": 103926469, "body": "<code>stringArrayInString := &quot;[\\&quot;Hello\\&quot;,\\&quot;{\\&quot;msg\\&quot;:\\&quot;Hai\\&quot;}\\&quot;,123]&quot; var convertedData []interface{} json.Unmarshal([]byte(stringArrayInString),&amp;convertedData) fmt.Println(convertedData)</code> I am getting an empty array as output =&gt;[]"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 41, "user_id": 7882718, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nqSu-MGVZk0/AAAAAAAAAAI/AAAAAAAAAG4/dD5_FvmoyyE/photo.jpg?sz=128", "display_name": "Venkatesh Sorapalli", "link": "https://stackoverflow.com/users/7882718/venkatesh-sorapalli"}, "edited": false, "score": 1, "creation_date": 1573584835, "post_id": 58824770, "comment_id": 103926631, "body": "@VenkateshSorapalli  The string in the question and previous comment are not valid JSON.  Are the strings intended to be JSON, or are they in some other format?"}, {"owner": {"reputation": 41, "user_id": 7882718, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nqSu-MGVZk0/AAAAAAAAAAI/AAAAAAAAAG4/dD5_FvmoyyE/photo.jpg?sz=128", "display_name": "Venkatesh Sorapalli", "link": "https://stackoverflow.com/users/7882718/venkatesh-sorapalli"}, "edited": false, "score": 0, "creation_date": 1573585058, "post_id": 58824770, "comment_id": 103926711, "body": "JSON in the string format., it is intended to be string convertedString[1] = &quot;{\\&quot;msg\\&quot;:\\&quot;Hai\\&quot;}&quot;"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 2, "creation_date": 1573585145, "post_id": 58824770, "comment_id": 103926747, "body": "The second element isn&#39;t valid json. You can use json unmarshal if you escape those quotes: [\\&quot;Hello\\&quot;,\\&quot;{\\\\\\&quot;msg\\\\\\&quot;:\\\\\\&quot;Hai\\\\\\&quot;}\\&quot;,123]&quot;"}, {"owner": {"reputation": 41, "user_id": 7882718, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nqSu-MGVZk0/AAAAAAAAAAI/AAAAAAAAAG4/dD5_FvmoyyE/photo.jpg?sz=128", "display_name": "Venkatesh Sorapalli", "link": "https://stackoverflow.com/users/7882718/venkatesh-sorapalli"}, "edited": false, "score": 0, "creation_date": 1573585963, "post_id": 58824770, "comment_id": 103927088, "body": "Is there any JS conversion method from <code>\\&quot;{\\&quot;msg\\&quot;:\\&quot;Hai\\&quot;}\\&quot;</code> to <code>\\&quot;{\\\\\\&quot;msg\\\\\\&quot;:\\\\\\&quot;Hai\\\\\\&quot;}\\&quot;</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 41, "user_id": 7882718, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nqSu-MGVZk0/AAAAAAAAAAI/AAAAAAAAAG4/dD5_FvmoyyE/photo.jpg?sz=128", "display_name": "Venkatesh Sorapalli", "link": "https://stackoverflow.com/users/7882718/venkatesh-sorapalli"}, "edited": false, "score": 3, "creation_date": 1573586094, "post_id": 58824770, "comment_id": 103927139, "body": "@VenkateshSorapalli do you have control over how the string is constructed? For example why aren&#39;t you using raw strings to make your life easier? Or if you want to use normal string just remove the surrounding quotes around that object."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1573584008, "creation_date": 1573584008, "answer_id": 58824770, "question_id": 58824719, "link": "https://stackoverflow.com/questions/58824719/convert-single-string-which-has-an-array-of-individual-mixed-data-types/58824770#58824770", "title": "Convert single string which has an array of individual mixed data types", "body": "<p>The string array you have is a valid JSON array, so you can do this:</p>\n\n<pre><code>var convertedString []string\njson.Unmarshal([]byte(str),&amp;convertedString)\n</code></pre>\n\n<p>If you have multiple data types in that array, you can do that with a string array, you need an interface{} array:</p>\n\n<pre><code>var convertedData []interface{}\njson.Unmarshal([]byte(str),&amp;convertedData)\n</code></pre>\n\n<p>Then you need to check types of individual elements in that array to find out what they are.</p>\n"}], "owner": {"reputation": 41, "user_id": 7882718, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nqSu-MGVZk0/AAAAAAAAAAI/AAAAAAAAAG4/dD5_FvmoyyE/photo.jpg?sz=128", "display_name": "Venkatesh Sorapalli", "link": "https://stackoverflow.com/users/7882718/venkatesh-sorapalli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 58824770, "answer_count": 1, "score": -2, "last_activity_date": 1573634312, "creation_date": 1573583803, "last_edit_date": 1573634312, "question_id": 58824719, "link": "https://stackoverflow.com/questions/58824719/convert-single-string-which-has-an-array-of-individual-mixed-data-types", "title": "Convert single string which has an array of individual mixed data types", "body": "<p>How to convert the single string which has an array of individual strings in it.</p>\n\n<pre><code>func main() {\n  stringArrayInString := \"[\\\"Hello\\\",\\\"Hai\\\",\\\"How are you!\\\"]\" //Single string which has string array in it\n    fmt.Println(stringArrayInString)\n\n // code to convert to the string array\n // convertedString\n}\n</code></pre>\n\n<p>The output has to be like this</p>\n\n<pre><code>convertedString[0] = \"Hello\"\nconvertedString[1] = \"Hai\"\nconvertedString[2] = \"How are you!\"\n</code></pre>\n\n<p>Is this possible if the above input string has mixed data types such as int, string, JSON type\nFor example</p>\n\n<pre><code>stringArrayInString := \"[\\\"Hello\\\",\\\"{\\\"msg\\\":\\\"Hai\\\"}\\\",123]\"\n\n//after converting\n\nconvertedString[0] = \"Hello\"\nconvertedString[1] = \"{\\\"msg\\\":\\\"Hai\\\"}\"\nconvertedString[2] = 123\n</code></pre>\n"}, {"tags": ["go", "data-structures", "linked-list", "doubly-linked-list"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1573584903, "creation_date": 1573584903, "answer_id": 58824964, "question_id": 58824716, "link": "https://stackoverflow.com/questions/58824716/how-to-implement-doubly-linked-list-without-using-tail-pointer/58824964#58824964", "title": "How to implement doubly linked list without using tail pointer", "body": "<p>If you know the node you're inserting before or after, then complexity is O(1). You only set the pointers in the previous/next nodes to point to the new node, and set the pointers in the new node to the prev/next nodes. You also update the head pointer if insertion is to the beginning of the list.</p>\n\n<p>If you do not have a tail pointer in a doubly-linked list (or singly-linked list) and you do not have a reference to the last element, then appending to the list becomes O(n) because you have to traverse the list to find the last element. </p>\n"}, {"tags": [], "owner": {"reputation": 147, "user_id": 5469480, "user_type": "registered", "profile_image": "https://graph.facebook.com/989634997760906/picture?type=large", "display_name": "roasty", "link": "https://stackoverflow.com/users/5469480/roasty"}, "is_accepted": false, "score": 1, "last_activity_date": 1573600502, "creation_date": 1573600502, "answer_id": 58828078, "question_id": 58824716, "link": "https://stackoverflow.com/questions/58824716/how-to-implement-doubly-linked-list-without-using-tail-pointer/58828078#58828078", "title": "How to implement doubly linked list without using tail pointer", "body": "<p>No, it is not necessary. Below are the time complexities for a doubly-linked list that does not utilize <code>tail</code> pointers.</p>\n\n<p><strong>Prepending to a List:</strong> O(1)</p>\n\n<blockquote>\n  <p>(head &lt;-> newNode &lt;-> x)</p>\n</blockquote>\n\n<p><strong>Inserting between two nodes in the List</strong>: O(n)</p>\n\n<blockquote>\n  <p>(head &lt;-> x &lt;-> newNode &lt;-> y)</p>\n</blockquote>\n\n<p><strong>Appending to a List</strong>: O(n)</p>\n\n<blockquote>\n  <p>(head &lt;-> x &lt;-> y &lt;-> newNode)</p>\n  \n  <p><em>Note</em>: Utilizing the <code>tail</code> of a doubly-linked list would make the complexity O(1)</p>\n</blockquote>\n\n<hr>\n\n<p><strong>TL;DR</strong>: No, it would function almost the same, except for less performant appending cases O(n).</p>\n"}], "owner": {"reputation": 27, "user_id": 8997163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d30dfc969664230710f85a3de6fed1fe?s=128&d=identicon&r=PG&f=1", "display_name": "stacylouis", "link": "https://stackoverflow.com/users/8997163/stacylouis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 367, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1573634290, "creation_date": 1573583790, "last_edit_date": 1573634290, "question_id": 58824716, "link": "https://stackoverflow.com/questions/58824716/how-to-implement-doubly-linked-list-without-using-tail-pointer", "title": "How to implement doubly linked list without using tail pointer", "body": "<p>Is it necessary to have a tail pointer in doubly linked list? How to implement doubly linked list insertion without tail pointer, what would be the time complexity if we do so.</p>\n"}, {"tags": ["go", "cmd", "ffprobe"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573578760, "post_id": 58823394, "comment_id": 103923893, "body": "You&#39;re only looking at <code>stderr</code> when there&#39;s an error and only at <code>stdout</code> when there&#39;s not. You should examine both."}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573579107, "post_id": 58823394, "comment_id": 103924066, "body": "@Adrian I deleted <code>stderr</code> at all and It is still working the same way"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1573579164, "post_id": 58823394, "comment_id": 103924092, "body": "That&#39;s the exact opposite of what I suggested."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1573579196, "post_id": 58823394, "comment_id": 103924104, "body": "There is no need for quotes in <code>csv=&quot;p=0&quot;</code>."}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1573579463, "post_id": 58823394, "comment_id": 103924241, "body": "@Volker do you meen backticks or quotes?"}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573579530, "post_id": 58823394, "comment_id": 103924278, "body": "@Adrian sorry, but I still don&#39;t understand your advice"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1573593986, "post_id": 58823394, "comment_id": 103930363, "body": "Again: There is no need for quotes in <code>csv=&quot;p=0&quot;</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "edited": false, "score": 1, "creation_date": 1573582554, "post_id": 58824414, "comment_id": 103925626, "body": "Thank you for your help!"}], "tags": [], "owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "is_accepted": true, "score": 3, "last_activity_date": 1573582747, "last_edit_date": 1573582747, "creation_date": 1573582411, "answer_id": 58824414, "question_id": 58823394, "link": "https://stackoverflow.com/questions/58823394/cant-execute-ffprobe-command/58824414#58824414", "title": "Can&#39;t execute ffprobe command", "body": "<p>Try formatting the argument like this (use double quotes for the string instead of backticks and remove the inner double quotes):</p>\n\n<pre><code>cmdArgs := []string{..., \"csv=p=0\"}\n</code></pre>\n\n<p>The Go <code>exec</code> package does not invoke the sytem shell to process the arguments, so you do not need to take the same precautions when specifying them. In this case, there's no need to wrap the portion after the first \"=\" in quotes.</p>\n\n<p>From <a href=\"https://golang.org/pkg/os/exec/#pkg-overview\" rel=\"nofollow noreferrer\">the package documentation</a>:</p>\n\n<blockquote>\n  <p>Unlike the \"system\" library call from C and other languages, the\n  os/exec package intentionally does not invoke the system shell and\n  does not expand any glob patterns or handle other expansions,\n  pipelines, or redirections typically done by shells. The package\n  behaves more like C's \"exec\" family of functions. To expand glob\n  patterns, either call the shell directly, taking care to escape any\n  dangerous input, or use the path/filepath package's Glob function. To\n  expand environment variables, use package os's ExpandEnv.</p>\n</blockquote>\n"}], "owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 58824414, "answer_count": 1, "score": 0, "last_activity_date": 1573634257, "creation_date": 1573578164, "last_edit_date": 1573634257, "question_id": 58823394, "link": "https://stackoverflow.com/questions/58823394/cant-execute-ffprobe-command", "title": "Can&#39;t execute ffprobe command", "body": "<p>I try to get video file duration with ffprobe. When I run this code I get error:</p>\n\n<blockquote>\n  <p>exit status 1:</p>\n</blockquote>\n\n<pre><code>var out bytes.Buffer\nvar stderr bytes.Buffer\n\ncmdArgs := []string{\"-i\", \"bunny.mp4\", \"-show_entries\", \"format=duration\", \"-v\", \"quiet\", \"-of\", `csv=\"p=0\"`}\n\ncmd := exec.Command(\"ffprobe\", cmdArguments...)\ncmd.Stdout = &amp;out\ncmd.Stderr = &amp;stderr\nif err := cmd.Run(); err != nil {\n    fmt.Println(fmt.Sprint(err) + \": \" + stderr.String())\n}\nfmt.Printf(\"command output: %q\\n\", out.String())\n</code></pre>\n\n<p>But when I pass argruments without <code>-of csv=\"p=0\"</code> like this:</p>\n\n<pre><code>cmdArgs := []string{\"-i\", \"bunny.mp4\", \"-show_entries\", \"format=duration\", \"-v\", \"quiet\"}\n</code></pre>\n\n<p>It works and returns the result (but in bad format):</p>\n\n<blockquote>\n  <p>command output: \"[FORMAT]\\nduration=3.008000\\n[/FORMAT]\\n\"</p>\n</blockquote>\n\n<p><strong>So what is the problem and how to solve it ?</strong></p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1573573764, "post_id": 58822119, "comment_id": 103921164, "body": "You&#39;d need to define a new type with the appropriate JSON mappings."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573573800, "post_id": 58822119, "comment_id": 103921182, "body": "Can I extend the original struct ?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573573879, "post_id": 58822119, "comment_id": 103921224, "body": "No. You cannot change it outside of the package where it is defined."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573573941, "post_id": 58822119, "comment_id": 103921274, "body": "If you create an equivalent type (same field types in the same order) with different struct tags, you can do a simple type conversion between the two."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573575026, "post_id": 58822119, "comment_id": 103921908, "body": "Yes, but what I want to avoid is having duplicated types all over. Right now, my code has sever issues because everywhere I use differents object."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1573575394, "post_id": 58822119, "comment_id": 103922101, "body": "Well, I meant severe, but it is more about a big mess that real issue. But if each one of my services need to work on a custom object, I need to be very careful about divergence on all those common objects."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1573575653, "post_id": 58822119, "comment_id": 103922236, "body": "If you can distill the general problem into an easily understood question, we can probably help you solve the <i>actual problem</i> you&#39;re facing more effectively, than with trying to force Go to do things it doesn&#39;t do."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "edited": false, "score": 0, "creation_date": 1573633160, "post_id": 58822119, "comment_id": 103940959, "body": "Ok! Can you tell me why is it a bad question ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1573633886, "post_id": 58822119, "comment_id": 103941267, "body": "I don&#39;t know why 4 people voted down, I can only guess as to their reasons. Some possibilities: 1. The question shows little or no research effort, 2. It doesn&#39;t show your current attempt, 3. it appears to be an XY Problem. Maybe someone had another reason."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1573575175, "creation_date": 1573575175, "answer_id": 58822581, "question_id": 58822119, "link": "https://stackoverflow.com/questions/58822119/how-should-i-reuse-a-struct-in-a-common-lib-and-change-the-json-fields-associat/58822581#58822581", "title": "How should I reuse a struct in a common lib, and change the json fields associated", "body": "<blockquote>\n  <p>How should I overload those values?</p>\n</blockquote>\n\n<p>You shouldn't. There is no overloading in Go. You have two options:</p>\n\n<ol>\n<li>Embed the type, and shadow the tags.</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type OtherMeasure struct {\n    pkg.Measure\n    Delta        float64   `json:\"value\"`\n}\n</code></pre>\n\n<ol start=\"2\">\n<li>Duplicate the struct.</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type OtherMeasure struct {\n    Timestamp    time.Time `json:\"timestamp\"`\n    Delta        float64   `json:\"value\"`\n    Redistribute float64   `json:\"redistribute\"`\n}\n</code></pre>\n\n<p>Duplication is probably preferred for a small struct like this, because it is then possible to do a simple type conversion:</p>\n\n<pre><code>var om OtherMeasure = /* set the specific value */\nvar m Measure = Measure(om)\n</code></pre>\n"}], "owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 58822581, "answer_count": 1, "score": -2, "last_activity_date": 1573575175, "creation_date": 1573573724, "last_edit_date": 1573575024, "question_id": 58822119, "link": "https://stackoverflow.com/questions/58822119/how-should-i-reuse-a-struct-in-a-common-lib-and-change-the-json-fields-associat", "title": "How should I reuse a struct in a common lib, and change the json fields associated", "body": "<p>I have a shared lib that has the following struct</p>\n\n<pre><code>//Measure struct\ntype Measure struct {\n    Timestamp    time.Time `json:\"timestamp\"`\n    Delta        float64   `json:\"delta\"`\n    Redistribute float64   `json:\"redistribute\"`\n}\n</code></pre>\n\n<p>Now, In my project, fields are ok, but json information may vary, I mean I could receive the info in my json with <code>json:\"value\"</code> instead of <code>json:\"delta\"</code></p>\n\n<p>How should I overload those values?</p>\n"}, {"tags": ["go", "graphql", "prisma"], "answers": [{"comments": [{"owner": {"reputation": 4398, "user_id": 1143482, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/zBqdL.png?s=128&g=1", "display_name": "jpganz18", "link": "https://stackoverflow.com/users/1143482/jpganz18"}, "edited": false, "score": 0, "creation_date": 1573813305, "post_id": 58869161, "comment_id": 104017523, "body": "could be a possible solution for this?"}], "tags": [], "owner": {"reputation": 56993, "user_id": 6024220, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6s3nUiQ9-fI/AAAAAAAAAAI/AAAAAAAAA0E/3zpg3zXHu4I/photo.jpg?sz=128", "display_name": "Daniel Rearden", "link": "https://stackoverflow.com/users/6024220/daniel-rearden"}, "is_accepted": true, "score": 4, "last_activity_date": 1573782251, "creation_date": 1573782251, "answer_id": 58869161, "question_id": 58822068, "link": "https://stackoverflow.com/questions/58822068/is-it-possible-to-define-an-interface-in-prisma/58869161#58869161", "title": "is it possible to define an interface in prisma?", "body": "<p>Interface and union types are not currently supported in Prisma (see feature requests <a href=\"https://github.com/prisma/prisma/issues/83\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://github.com/prisma/prisma2/issues/253\" rel=\"nofollow noreferrer\">here</a>).</p>\n"}], "owner": {"reputation": 4398, "user_id": 1143482, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/zBqdL.png?s=128&g=1", "display_name": "jpganz18", "link": "https://stackoverflow.com/users/1143482/jpganz18"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 1, "accepted_answer_id": 58869161, "answer_count": 1, "score": 4, "last_activity_date": 1573782251, "creation_date": 1573573555, "last_edit_date": 1573768607, "question_id": 58822068, "link": "https://stackoverflow.com/questions/58822068/is-it-possible-to-define-an-interface-in-prisma", "title": "is it possible to define an interface in prisma?", "body": "<p>I am trying to have a <code>\"generic\"</code> info in my object.</p>\n\n<p>Basically what I want to do is to have 2 different kinds of object, lets say <code>image</code> and <code>document</code></p>\n\n<p>Both have different fields except for the <code>ID</code></p>\n\n<p>I was wondering what would be the best approach to define my <code>datamodel.prisma</code> so when I use my graphql model (in GO) I can use a generic interface like <code>data</code></p>\n\n<p>Is it even possible? If not what solution could be the best?</p>\n\n<p>I know in graphql there are interfaces but Im not sure how to define it in prisma.</p>\n\n<p>Ideas?</p>\n"}, {"tags": ["debugging", "go", "windows-console", "delve"], "answers": [{"tags": [], "owner": {"reputation": 493, "user_id": 8364553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d203cf51ae3926dca4c2c3afcf24948?s=128&d=identicon&r=PG&f=1", "display_name": "p1gd0g", "link": "https://stackoverflow.com/users/8364553/p1gd0g"}, "is_accepted": false, "score": 1, "last_activity_date": 1573610927, "creation_date": 1573610927, "answer_id": 58829325, "question_id": 58820999, "link": "https://stackoverflow.com/questions/58820999/code-display-issue-in-delve-for-go-on-windows-10/58829325#58829325", "title": "Code display issue in Delve for Go on Windows 10", "body": "<p>If you were using PowerShell, maybe you need to change the background color.\n<a href=\"https://i.stack.imgur.com/euYHp.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/euYHp.png\" alt=\"enter image description here\"></a>\n<a href=\"https://i.stack.imgur.com/a2bGs.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/a2bGs.png\" alt=\"enter image description here\"></a></p>\n\n<p>Hope it helps.</p>\n"}], "owner": {"reputation": 3488, "user_id": 477035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cYpss.jpg?s=128&g=1", "display_name": "RedGrittyBrick", "link": "https://stackoverflow.com/users/477035/redgrittybrick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1573610927, "creation_date": 1573569938, "last_edit_date": 1573570704, "question_id": 58820999, "link": "https://stackoverflow.com/questions/58820999/code-display-issue-in-delve-for-go-on-windows-10", "title": "Code display issue in Delve for Go on Windows 10", "body": "<p>I've installed Delve on Windows 10 and it seems to work but the display does not show line numbers and does not point out the current line.</p>\n\n<p>According to the Delve \"<a href=\"https://github.com/go-delve/delve/blob/master/Documentation/cli/getting_started.md\" rel=\"nofollow noreferrer\">Getting Started</a>\" Guide I should see something like</p>\n\n<pre><code>(dlv) continue\n&gt; main.main() ./test.go:5 (hits goroutine(1):1 total:1) (PC: 0x49ecf3)\n     1: package main\n     2: \n     3: import \"fmt\"\n     4: \n=&gt;   5: func main() {\n     6:     fmt.Println(\"delve test\")\n     7: }\n(dlv) \n</code></pre>\n\n<p>But what I see is more like</p>\n\n<pre><code>(dlv) continue\n&gt; main.main() ./test.go:5 (hits goroutine(1):1 total:1) (PC: 0x49ecf3)\n        package main\n\n        import \"fmt\"\n\n        func main() {\n            fmt.Println(\"delve test\")\n        }\n(dlv) \n</code></pre>\n\n<p>I can step through the code and display variable values etc, but the lack of a current line pointer <code>=&gt;</code> makes it hard to use. </p>\n\n<pre><code>C:&gt; dlv version\nDelve Debugger\nVersion: 1.3.2\nBuild: $Id: 569ccbd514fc47c8b4c521b142556867ec5e6917 $\n\nC:&gt; go version\ngo version go1.12.5 windows/amd64\n\nC:&gt;ver\nMicrosoft Windows [Version 10.0.18362.418]\n\nC:&gt;chcp\nActive code page: 850\n</code></pre>\n\n<p>Perhaps there is a problem due to MS Windows Command-Prompt console capabilities? Is there a workaround or other solution for this?</p>\n"}, {"tags": ["go", "namespaces"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1573569689, "post_id": 58820365, "comment_id": 103918838, "body": "From the docs: &quot;Only a privileged process (CAP_SYS_ADMIN) can employ CLONE_NEWUTS&quot;. Does your process have <code>CAP_SYS_ADMIN</code>?"}, {"owner": {"reputation": 1, "user_id": 9971664, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n3vii.jpg?s=128&g=1", "display_name": "salamanderGame", "link": "https://stackoverflow.com/users/9971664/salamandergame"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1573611822, "post_id": 58820365, "comment_id": 103934966, "body": "@JimB no, thks, I know the reason."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 9971664, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n3vii.jpg?s=128&g=1", "display_name": "salamanderGame", "link": "https://stackoverflow.com/users/9971664/salamandergame"}, "is_accepted": false, "score": 0, "last_activity_date": 1573612012, "creation_date": 1573612012, "answer_id": 58829462, "question_id": 58820365, "link": "https://stackoverflow.com/questions/58820365/create-namespace-operation-not-permitted/58829462#58829462", "title": "create namespace operation not permitted?", "body": "<p>From the <a href=\"http://man7.org/linux/man-pages/man2/clone.2.html\" rel=\"nofollow noreferrer\">Linux doc</a>\n<strong>CLONE_NEWUTS (since Linux 2.6.19)</strong><br>\n uname(2); among these, the domain name and the hostname can be<br>\n              modified by setdomainname(2) and sethostname(2), respectively.<br>\n              Changes made to the identifiers in a UTS namespace are visible<br>\n              to all other processes in the same namespace, but are not<br>\n              visible to processes in other UTS namespaces.  </p>\n\n<p><strong>Only a privileged process (CAP_SYS_ADMIN) can employ\n          CLONE_NEWUTS.</strong></p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 9604820, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "balogun tobi", "link": "https://stackoverflow.com/users/9604820/balogun-tobi"}, "is_accepted": false, "score": -1, "last_activity_date": 1608066283, "creation_date": 1608066283, "answer_id": 65313678, "question_id": 58820365, "link": "https://stackoverflow.com/questions/58820365/create-namespace-operation-not-permitted/65313678#65313678", "title": "create namespace operation not permitted?", "body": "<p>Build the program instead and then run the executable file as sudo.</p>\n<p>go build uts.go</p>\n<p>sudo ./uts</p>\n"}], "owner": {"reputation": 1, "user_id": 9971664, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n3vii.jpg?s=128&g=1", "display_name": "salamanderGame", "link": "https://stackoverflow.com/users/9971664/salamandergame"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 371, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1608066283, "creation_date": 1573567771, "question_id": 58820365, "link": "https://stackoverflow.com/questions/58820365/create-namespace-operation-not-permitted", "title": "create namespace operation not permitted?", "body": "<p>I' am learning about Linux Namespace and I tried to create a UTS Namespace via golang. here is my code</p>\n\n<pre><code>func main() {\n    cmd := exec.Command(\"sh\")\n    cmd.SysProcAttr = &amp;syscall.SysProcAttr{\n        Cloneflags: syscall.CLONE_NEWUTS,\n    }\n    cmd.Stdin = os.Stdin\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n\n    if err := cmd.Run(); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>When I executed <code>go run uts.go</code>, I got the error <code>fork/exec /bin/sh: operation not permitted</code>.My OS is <code>Ubuntu 18.04.3</code>, Linux Kerenl version is <code>5.0.0-32-generic</code>.</p>\n"}, {"tags": ["json", "vue.js", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573569086, "post_id": 58820234, "comment_id": 103918521, "body": "When you inspect the browser console do you see the request body empty?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1573569165, "post_id": 58820234, "comment_id": 103918563, "body": "You are assigning that handler for POST and OPTIONS, but you&#39;re not checking what type of request it is. Maybe it  is sending an OPTIONS before the POST?"}, {"owner": {"reputation": 99, "user_id": 5453484, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh6.googleusercontent.com/-UFNp_3jXE-s/AAAAAAAAAAI/AAAAAAAAACM/rZ-On3ncb4k/photo.jpg?sz=128", "display_name": "Wessah", "link": "https://stackoverflow.com/users/5453484/wessah"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573569219, "post_id": 58820234, "comment_id": 103918592, "body": "@mkopriva Viewing the request using the Network tab, there&#39;s only request headers &amp; general information."}, {"owner": {"reputation": 99, "user_id": 5453484, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh6.googleusercontent.com/-UFNp_3jXE-s/AAAAAAAAAAI/AAAAAAAAACM/rZ-On3ncb4k/photo.jpg?sz=128", "display_name": "Wessah", "link": "https://stackoverflow.com/users/5453484/wessah"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1573569394, "post_id": 58820234, "comment_id": 103918666, "body": "@BurakSerdar results are exactly the same when not defining methods. It&#39;ll return 405 method not allowed if I remove only OPTIONS."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1573570215, "post_id": 58820234, "comment_id": 103919160, "body": "@Wessah, I realized you&#39;re calling the panic manually. The body is empty. Register your handler only for POST, there is no body for OPTIONS."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1573571542, "post_id": 58820234, "comment_id": 103919925, "body": "You need to accept OPTIONS (for CORS to work), but it should just return 200/204 and the <code>Access-Control-Allow-Origin</code> header (you can return others but this is the minimum). You can&#39;t just remove OPTIONS; you need to handle it appropriately (i.e. differently from POST)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1573571732, "post_id": 58820234, "comment_id": 103920054, "body": "Here&#39;s a good rundown on how CORS preflight works and why you need to handle OPTIONS: <a href=\"https://developer.mozilla.org/en-US/docs/Glossary/Preflight_request\" rel=\"nofollow noreferrer\">developer.mozilla.org/en-US/docs/Glossary/Preflight_request</a>"}, {"owner": {"reputation": 99, "user_id": 5453484, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh6.googleusercontent.com/-UFNp_3jXE-s/AAAAAAAAAAI/AAAAAAAAACM/rZ-On3ncb4k/photo.jpg?sz=128", "display_name": "Wessah", "link": "https://stackoverflow.com/users/5453484/wessah"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573572322, "post_id": 58820234, "comment_id": 103920400, "body": "@Adrian thank you very much! This made it work for me. I will answer the question with the working fix."}], "answers": [{"tags": [], "owner": {"reputation": 99, "user_id": 5453484, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh6.googleusercontent.com/-UFNp_3jXE-s/AAAAAAAAAAI/AAAAAAAAACM/rZ-On3ncb4k/photo.jpg?sz=128", "display_name": "Wessah", "link": "https://stackoverflow.com/users/5453484/wessah"}, "is_accepted": true, "score": 1, "last_activity_date": 1573572579, "creation_date": 1573572579, "answer_id": 58821805, "question_id": 58820234, "link": "https://stackoverflow.com/questions/58820234/eof-when-posting-json-to-localhost-go-backend-using-vuejs/58821805#58821805", "title": "EOF when posting JSON to localhost Go backend using VueJS", "body": "<p>Thanks to Adrian's comment I've got it working by accepting OPTIONS using the following code additions in my backend.</p>\n\n<p>Routing:</p>\n\n<pre><code>r.HandleFunc(\"/login\", models.LoginCORSHandler()).Methods(\"OPTIONS\")\n</code></pre>\n\n<p>Handler:</p>\n\n<pre><code>// LoginCORSHandler handle OPTIONS request\nfunc LoginCORSHandler() func(w http.ResponseWriter, req *http.Request) {\n    return func(w http.ResponseWriter, req *http.Request) {\n        w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n        w.Header().Set(\"Access-Control-Allow-Methods\", \"POST\")\n        w.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")\n        w.WriteHeader(http.StatusOK)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 99, "user_id": 5453484, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh6.googleusercontent.com/-UFNp_3jXE-s/AAAAAAAAAAI/AAAAAAAAACM/rZ-On3ncb4k/photo.jpg?sz=128", "display_name": "Wessah", "link": "https://stackoverflow.com/users/5453484/wessah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 58821805, "answer_count": 1, "score": 2, "last_activity_date": 1573572579, "creation_date": 1573567314, "question_id": 58820234, "link": "https://stackoverflow.com/questions/58820234/eof-when-posting-json-to-localhost-go-backend-using-vuejs", "title": "EOF when posting JSON to localhost Go backend using VueJS", "body": "<p>I'm setting up a login system using VueJS for frontend and Go for backend. I'm currently stuck at POSTing the username &amp; password to the backend in JSON format.</p>\n\n<p>Currently I am attempting to post using fetch, after having bad luck with Axios earlier.</p>\n\n<p>Post method:</p>\n\n<pre><code>fetch(\"http://localhost:9444/login\", {\n                    method: \"post\",\n                    headers: {\n                        'Accept': 'application/json',\n                        'Content-Type': 'application/json'\n                    },\n\n                    body: JSON.stringify({\n                        \"emailAddress\": \"myName\",\n                        \"password\": \"myPassword\"\n                    })\n                })\n                .then( (response) =&gt; { \n                console.log(response)\n                });\n</code></pre>\n\n<p>Which I then route in my backend like:</p>\n\n<pre><code>r := mux.NewRouter().StrictSlash(true)\nr.HandleFunc(\"/login\", models.LoginHandler(db)).Methods(\"POST\", \"OPTIONS\")\n</code></pre>\n\n<p>LoginHandler:</p>\n\n<pre><code>func LoginHandler(db *sql.DB) func(w http.ResponseWriter, req *http.Request) {\n    return func(w http.ResponseWriter, req *http.Request) {\n        // w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n        // w.Header().Set(\"Access-Control-Allow-Headers\", \"*\")\n        w.Header().Set(\"Content-Type\", \"application/json; charset=utf-8\")\n        w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n\n        // Initialize loginInfo\n        loginInfo := LoginInfo{}\n\n        // Decode request body using JSON\n        err := json.NewDecoder(req.Body).Decode(&amp;loginInfo)\n        if err != nil {\n            panic(err)\n        }\n\n        println(loginInfo.EmailAddress)\n        println(loginInfo.Password)\n\n        w.WriteHeader(http.StatusOK)\n        w.Write([]byte(\"Test message.\"))\n    }\n}\n</code></pre>\n\n<p>Which currently results in crashing on the decoding part like so:</p>\n\n<pre><code>2019/11/12 14:45:53 http: panic serving [::1]:57224: EOF\ngoroutine 35 [running]:\nnet/http.(*conn).serve.func1(0xc000196000)\n        c:/go/src/net/http/server.go:1769 +0x140\npanic(0x8be000, 0xc00005c050)\n        c:/go/src/runtime/panic.go:522 +0x1c3\n_/H_/Development/clientportal/backend/models.LoginHandler.func1(0x9f7360, 0xc0001be000, 0xc0001a8200)\n...\n</code></pre>\n\n<p>What could cause the constant EOF errors? I've tested (and confirmed correct functionality) using postman:</p>\n\n<pre><code>{\n    \"emailAddress\": \"login\",\n    \"password\": \"passw\"\n}\n</code></pre>\n\n<p>Which returns status 200 correctly.</p>\n"}, {"tags": ["windows", "go", "registry", "exe"], "answers": [{"comments": [{"owner": {"reputation": 152, "user_id": 5114477, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/secxy.jpg?s=128&g=1", "display_name": "Kyhle Ohlinger", "link": "https://stackoverflow.com/users/5114477/kyhle-ohlinger"}, "edited": false, "score": 0, "creation_date": 1573640399, "post_id": 58827659, "comment_id": 103944717, "body": "I have tried and used the powershell script before, which is why I mentioned it. I&#39;m looking for a way to do it in golang without having to use powershell if possible"}, {"owner": {"reputation": 650, "user_id": 10556525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ccd7e7dd3b1906fd56323d918c77d3?s=128&d=identicon&r=PG&f=1", "display_name": "Joris", "link": "https://stackoverflow.com/users/10556525/joris"}, "reply_to_user": {"reputation": 152, "user_id": 5114477, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/secxy.jpg?s=128&g=1", "display_name": "Kyhle Ohlinger", "link": "https://stackoverflow.com/users/5114477/kyhle-ohlinger"}, "edited": false, "score": 0, "creation_date": 1573653889, "post_id": 58827659, "comment_id": 103951965, "body": "My bad. Apparently I skipped over that part. Don&#39;t expect it is possible without the script. I will take a look at getting the script to work from Golang later today."}, {"owner": {"reputation": 152, "user_id": 5114477, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/secxy.jpg?s=128&g=1", "display_name": "Kyhle Ohlinger", "link": "https://stackoverflow.com/users/5114477/kyhle-ohlinger"}, "edited": false, "score": 0, "creation_date": 1573654625, "post_id": 58827659, "comment_id": 103952402, "body": "No worries, I just find it strange that I can modify some registry keys and not the one for windows defender"}, {"owner": {"reputation": 650, "user_id": 10556525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ccd7e7dd3b1906fd56323d918c77d3?s=128&d=identicon&r=PG&f=1", "display_name": "Joris", "link": "https://stackoverflow.com/users/10556525/joris"}, "reply_to_user": {"reputation": 152, "user_id": 5114477, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/secxy.jpg?s=128&g=1", "display_name": "Kyhle Ohlinger", "link": "https://stackoverflow.com/users/5114477/kyhle-ohlinger"}, "edited": false, "score": 0, "creation_date": 1573668547, "post_id": 58827659, "comment_id": 103960145, "body": "That&#39;s by design. By letting you go through that script, Windows can put some checks in place before allowing a change to the exclude list. If they let you edit the registry key directly, malware can just add itself to the exclusion list. What I can imagine the script does, is check first whether there is any known malware running, if so, deny the request."}, {"owner": {"reputation": 650, "user_id": 10556525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ccd7e7dd3b1906fd56323d918c77d3?s=128&d=identicon&r=PG&f=1", "display_name": "Joris", "link": "https://stackoverflow.com/users/10556525/joris"}, "reply_to_user": {"reputation": 152, "user_id": 5114477, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/secxy.jpg?s=128&g=1", "display_name": "Kyhle Ohlinger", "link": "https://stackoverflow.com/users/5114477/kyhle-ohlinger"}, "edited": false, "score": 0, "creation_date": 1573672348, "post_id": 58827659, "comment_id": 103961786, "body": "I&#39;ve added a code sample that works for me on Windows when running as Administrator."}, {"owner": {"reputation": 152, "user_id": 5114477, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/secxy.jpg?s=128&g=1", "display_name": "Kyhle Ohlinger", "link": "https://stackoverflow.com/users/5114477/kyhle-ohlinger"}, "edited": false, "score": 0, "creation_date": 1573746007, "post_id": 58827659, "comment_id": 103991992, "body": "Unless I&#39;m missing something, that is just the same powershell command wrapped in go? Maybe there&#39;s some ambiguity in the way I&#39;m asking the question, but I&#39;m looking for a way to do it without powershell"}], "tags": [], "owner": {"reputation": 650, "user_id": 10556525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ccd7e7dd3b1906fd56323d918c77d3?s=128&d=identicon&r=PG&f=1", "display_name": "Joris", "link": "https://stackoverflow.com/users/10556525/joris"}, "is_accepted": false, "score": -1, "last_activity_date": 1573672303, "last_edit_date": 1573672303, "creation_date": 1573597789, "answer_id": 58827659, "question_id": 58819887, "link": "https://stackoverflow.com/questions/58819887/creating-registry-key-with-golang/58827659#58827659", "title": "Creating Registry Key with Golang", "body": "<p>In Windows, the <code>Administrator</code> account does not necessarily <a href=\"https://superuser.com/questions/504136/root-vs-administrator-vs-system/504405\">have access to everything on the system</a>. An example is this registry key.</p>\n\n<p>There is a <a href=\"https://docs.microsoft.com/en-us/powershell/module/defender/add-mppreference\" rel=\"nofollow noreferrer\">Powershell script</a> that does allow you to add an exclusion:</p>\n\n<pre><code>Add-MpPreference -ExclusionPath \"C:\\Windows\\Temp\\file.exe\"\n</code></pre>\n\n<p>To call this from Go, you can execute the script with <code>exec.Command</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n    \"log\"\n)\n\nfunc main() {\n    _,err := exec.Command(\"powershell.exe\", `Add-MpPreference -ExclusionPath \"C:\\Windows\\Temp\\file.exe\"`).Output()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"success\")\n}\n</code></pre>\n\n<p>Make sure you run this script as an Administrator. If you want the executable to request elevated permissions when running, see <a href=\"https://github.com/mozey/run-as-admin\" rel=\"nofollow noreferrer\">this repository</a>. </p>\n"}, {"tags": [], "owner": {"reputation": 1392, "user_id": 908382, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0fe346c854ac0da819e25ce0f43a5dca?s=128&d=identicon&r=PG", "display_name": "Tom Shaw", "link": "https://stackoverflow.com/users/908382/tom-shaw"}, "is_accepted": false, "score": 0, "last_activity_date": 1589488010, "creation_date": 1589488010, "answer_id": 61806815, "question_id": 58819887, "link": "https://stackoverflow.com/questions/58819887/creating-registry-key-with-golang/61806815#61806815", "title": "Creating Registry Key with Golang", "body": "<p>In an Admin run terminal the following worked for me.    </p>\n\n<pre><code>import (\n        \"fmt\"\n        \"io/ioutil\"\n        \"os\"\n        \"path\"\n\n        \"golang.org/x/sys/windows/registry\"\n)   \n\n    k, err := registry.OpenKey(registry.LOCAL_MACHINE, `SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\YourPath`, registry.WRITE)\n        if err != nil {\n            log.Error(err)\n            return err\n        }\n        defer k.Close()\n\n        if err = k.SetStringValue(key, val); err != nil {\n            log.Error(err)\n            return\n        }\n</code></pre>\n"}], "owner": {"reputation": 152, "user_id": 5114477, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/secxy.jpg?s=128&g=1", "display_name": "Kyhle Ohlinger", "link": "https://stackoverflow.com/users/5114477/kyhle-ohlinger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 746, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1589488010, "creation_date": 1573565633, "last_edit_date": 1574230083, "question_id": 58819887, "link": "https://stackoverflow.com/questions/58819887/creating-registry-key-with-golang", "title": "Creating Registry Key with Golang", "body": "<p>I am currently trying to add a Windows registry key using Golang instead of using the following Powershell query: <code>Add-MpPreference -ExclusionPath \u201cC:\\Temp\u201d</code>. The registry key is meant to be added to Windows Defender Exclusions but I am getting one of two errors, either; <code>The system cannot find the file specified.The handle is invalid</code> or <code>Access is Denied</code>. </p>\n\n<p>I've currently tried two different methods, both without success. The registry key location is <code>Computer\\HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows Defender\\Exclusions\\Paths</code>. In order to access the registry, the following library was imported: </p>\n\n<p><code>import \"golang.org/x/sys/windows/registry\"</code></p>\n\n<p>The following query does run and it returns the expected information:</p>\n\n<pre><code>winInfo, err := registry.OpenKey(registry.LOCAL_MACHINE, `SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion`, registry.QUERY_VALUE)\ncheck(err)\ndefer winInfo.Close()\n\nCurrentVersion, _, err := winInfo.GetStringValue(\"CurrentVersion\")\ncheck(err)\n\nfmt.Printf(\"Value: \" + CurrentVersion)\n\n</code></pre>\n\n<p>However, when attempting to add in a registry key to the Windows Defender exclusions, the following code returns the error: <code>The system cannot find the file specified.The handle is invalid</code></p>\n\n<pre><code>regInfo, err := registry.OpenKey(registry.LOCAL_MACHINE, `SOFTWARE\\Microsoft\\Windows Defender\\Exclusions\\Paths`, registry.ALL_ACCESS)\ncheck(err)\ndefer winInfo.Close()\n\nerr = regInfo.SetDWordValue(\"C:\\\\Windows\\\\Temp\\\\file.exe\",0)\ncheck(err)\n</code></pre>\n\n<p>The answer in the <a href=\"https://stackoverflow.com/questions/46542609/create-a-registry-key-string-with-go\">Stackoverflow</a> link here also returned the above error. In order to try find a different workaround, I have tried the following, which returns the error: <code>Access is Denied</code>. </p>\n\n<pre><code>import \"github.com/gen0cide/gscript/x/windows\"\n\nwindows.AddRegKeyString(\"LOCAL_MACHINE\", \"Software\\\\Microsoft\\\\Windows Defender\\\\Exclusions\\\\Paths\", \"file.exe\", \"C:\\\\Windows\\\\Temp\");\n</code></pre>\n\n<p>I have tried running both queries using a low privileged account as well as from an elevated CMD window, i.e. <code>Run as Administrator</code>.</p>\n\n<p>Any advice on how I would be able to achieve this would be greatly appreciated.</p>\n\n<p><strong>UPDATE:</strong>\nFollowing on from this, I went down a rabbit hole with trying to figure out what was wrong and whether I had the required permissions to access this registry key. I viewed the ACLs for the registry, used procmon to figure out if something was wrong, used REG QUERY as low priv, etc. All of which pointed to the fact that I should be able to at least read from this registry key.</p>\n\n<p>I then decided to try implement it in Python to see if it was something to do with 3rd party software not being able to access the Registry. The following code was used, and it did return the required information:</p>\n\n<pre><code>import errno, os, winreg\n\nRawKey = winreg.OpenKey(winreg.HKEY_LOCAL_MACHINE, r\"SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\",0, winreg.KEY_READ)\nprint(winreg.QueryValueEx(RawKey,\"CurrentVersion\"))\n\n\nRawKey = winreg.OpenKey(winreg.HKEY_LOCAL_MACHINE, r\"SOFTWARE\\Microsoft\\Windows Defender\",0, winreg.KEY_READ)\nprint(winreg.QueryValueEx(RawKey,\"BackupLocation\"))\n</code></pre>\n\n<p>I have now raised an issue with the Golang team to figure out if this is an issue with the Golang registry implementation or if it's an issue of my implementation of the registry calls.</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1573566132, "post_id": 58819776, "comment_id": 103917193, "body": "Only package tests are cached: from the test docs: <code>go test caches successful package test results to avoid unnecessary repeated running of test</code>"}], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 0, "last_activity_date": 1573567406, "last_edit_date": 1573567406, "creation_date": 1573565549, "answer_id": 58819865, "question_id": 58819776, "link": "https://stackoverflow.com/questions/58819776/only-running-tests-affected-by-recent-changes/58819865#58819865", "title": "Only running tests affected by recent changes", "body": "<p>No, there is no way to do it in Go. All you can do is to split your code into packages and tests one package at a time</p>\n\n<pre><code>go test some/thing\n</code></pre>\n\n<p>Instead of all of them</p>\n\n<pre><code>go test ./...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "is_accepted": false, "score": -1, "last_activity_date": 1573567304, "creation_date": 1573567304, "answer_id": 58820231, "question_id": 58819776, "link": "https://stackoverflow.com/questions/58819776/only-running-tests-affected-by-recent-changes/58820231#58820231", "title": "Only running tests affected by recent changes", "body": "<p>You cannot rerun tests only for the last edited files. But there are a few ways of optimizing running tests.\nFirstly, you have to split your project into logical-separated packages. This will lead to a situation that one change will require rerunning test only in the package (in most cases).\nSecondly, you can run the test only for the package you're changing by typing</p>\n\n<pre><code>go test mypkg\n</code></pre>\n\n<p>or... you can use <a href=\"https://www.digitalocean.com/community/tutorials/customizing-go-binaries-with-build-tags\" rel=\"nofollow noreferrer\">build tags</a>. The last way of optimizing is to use the <code>short</code> <a href=\"https://golang.org/pkg/testing/#hdr-Skipping\" rel=\"nofollow noreferrer\">test functionality</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1573570597, "creation_date": 1573570597, "answer_id": 58821204, "question_id": 58819776, "link": "https://stackoverflow.com/questions/58819776/only-running-tests-affected-by-recent-changes/58821204#58821204", "title": "Only running tests affected by recent changes", "body": "<p><code>go test</code> in Go 1.10 and newer does this automatically at the package level; any packages with no changes will return cached test results, while packages with changes will be re-tested.</p>\n\n<p>If a single package's tests are still taking too long, that points to a problem with your tests; good tests in Go generally execute extremely quickly, which means you probably need to review the tests themselves, and do some combination of the following:</p>\n\n<ul>\n<li>Isolate integration tests using <a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"nofollow noreferrer\">build tags</a>. Tests that hit external resources tend to be slower, so making them optional will help speed up runs where you just want unit test results.</li>\n<li>Make use of <a href=\"https://stackoverflow.com/a/55238266/7426\">short tests</a> so that you have the option of a quick pass you can do more frequently.</li>\n<li>Review your unit tests - do you have unnecessary tests or test cases? Are your tests unnecessarily complex? Are you reading golden files that could be kept in constants instead? Are you deserializing static JSON into objects when you could create the object programmatically?</li>\n<li>Optimize your unit tests. Tests are still code and poor-performing code can be optimized for performance. There are many cases in unit tests where we're happy to opt for convenience over performance in ways we wouldn't with production code, but if performance is a problem, that choice must be reconsidered.</li>\n<li>Review your test execution - are you using uncacheable parameters to <code>go test</code> that are preventing it from caching results? Are you engaging the race detector, profiler, or code coverage reporting out of habit in cases where it's unnecessary?</li>\n</ul>\n"}], "owner": {"reputation": 21, "user_id": 8596355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cff8893ae1f747fb781d267418f66e42?s=128&d=identicon&r=PG&f=1", "display_name": "Waqas Younas", "link": "https://stackoverflow.com/users/8596355/waqas-younas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1573570597, "creation_date": 1573565288, "last_edit_date": 1573565489, "question_id": 58819776, "link": "https://stackoverflow.com/questions/58819776/only-running-tests-affected-by-recent-changes", "title": "Only running tests affected by recent changes", "body": "<p>Is there a way to executes only those tests which are affected by recent changes in Go? We have a large unit test suite and now it is starting to take a while before it finishes. We are thinking that we only run those tests which are affected by the code changes in the first pass.</p>\n\n<p>Python has something like this: <a href=\"https://github.com/tarpas/pytest-testmon\" rel=\"nofollow noreferrer\">https://github.com/tarpas/pytest-testmon</a></p>\n\n<p>Is there a way to do this in Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573562736, "post_id": 58819027, "comment_id": 103915359, "body": "I think all you need is <code>waitgroup.Done()</code> just below the <code>for</code> loops, no? Have you tried that?"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573562867, "post_id": 58819027, "comment_id": 103915427, "body": "@mkopriva thanks !so the code looks Ok? I need to add both like <code>add(1)</code> for <code>out</code> and <code>add(1)</code> for <code>error</code> ....or there is better way ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573562966, "post_id": 58819027, "comment_id": 103915478, "body": "I think you only need to call <code>Add(2)</code> once, and then have a single <code>Wait()</code> at the end if you want those two goroutines running concurrently, else why have those goroutines if you&#39;re waiting for both of them..."}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573563259, "post_id": 58819027, "comment_id": 103915636, "body": "@mkopriva - can you please check my update, is this what you mean ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1573563348, "post_id": 58819027, "comment_id": 103915684, "body": "you&#39;re missing the <code>Done</code> calls on the waitgroup. But I think you can probably even simplify it by removing the second goroutine, scanerr will run concurrently to scanout if scanout is in its own goroutine, no need to put scanerr in one as well. Something like this: <a href=\"https://play.golang.com/p/KL4U5ceNI3o\" rel=\"nofollow noreferrer\">play.golang.com/p/KL4U5ceNI3o</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573563650, "post_id": 58819027, "comment_id": 103915846, "body": "Have you renamed the variable from <code>waitgroup</code> to <code>wg</code>, like in the example? If not either rename it, or use <code>waitgroup.Done()</code>."}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573563950, "post_id": 58819027, "comment_id": 103915991, "body": "Thanks, you can provide it as answer"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1573564507, "creation_date": 1573564507, "answer_id": 58819559, "question_id": 58819027, "link": "https://stackoverflow.com/questions/58819027/using-wait-group-to-finish-the-goroutine/58819559#58819559", "title": "using wait group to finish the goroutine", "body": "<p>You don't need to pass the <code>WaitGroup</code> instance to the goroutine, since you're using a <a href=\"https://golang.org/ref/spec#Function_literals\" rel=\"nofollow noreferrer\">function literal</a> you can directly refer to a variable that was declared in the surrounding function.</p>\n\n<p>Also you can omit the second goroutine, it's not really needed for your use-case.</p>\n\n<pre><code>func exec(stdout io.Reader, stderr io.Reader) (*bufio.Scanner, *bufio.Scanner) {\n    scanout := bufio.NewScanner(stdout)\n    scanout.Split(bufio.ScanRunes)\n\n    var wg sync.WaitGroup\n    wg.Add(1)\n\n    // exec scanout in its own goroutine\n    go func() {\n        for scanout.Scan() {\n            fmt.Print(scanout.Text())\n        }\n        wg.Done()\n    }()\n\n    // exec scanerr\n    scanerr.Split(bufio.ScanRunes)\n    for scanerr.Scan() {\n        fmt.Print(scanerr.Text())\n    }\n\n    // wait for scanout\n    wg.Wait()\n}\n</code></pre>\n"}], "owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 1, "accepted_answer_id": 58819559, "answer_count": 1, "score": -2, "last_activity_date": 1573564507, "creation_date": 1573562615, "last_edit_date": 1573563233, "question_id": 58819027, "link": "https://stackoverflow.com/questions/58819027/using-wait-group-to-finish-the-goroutine", "title": "using wait group to finish the goroutine", "body": "<p>I' ve added to the following to stdout and stderr goroutine (go func() \u2026)  to wait to get the <code>output</code> and the <code>error</code> is finished.\nNow I want that the <strong>outer function</strong> will wait <strong>until both routine will finished</strong>.</p>\n\n<pre><code>func exec(stdout io.Reader, stderr io.Reader) (*bufio.Scanner, *bufio.Scanner) {\n\nscanout := bufio.NewScanner(stdout)\nscanout.Split(bufio.ScanRunes)\ngo func() {\n    for scanout.Scan() {\n        fmt.Print(scanout.Text())\n     }\n}()\n\ngo func() {\nscanerr.Split(bufio.ScanRunes)\n        for scanerr.Scan() {\n            fmt.Print(scanerr.Text())\n        }\n}()\n\n}\n\n\n</code></pre>\n\n<p>Now I\u2019ve tried to add the wait group but it\u2019s not working as im not sure how to pass the wait group instance, any idea ?</p>\n\n<pre><code>func exec(stdout io.Reader, stderr io.Reader) (*bufio.Scanner, *bufio.Scanner) {\n\nscanout := bufio.NewScanner(stdout)\nscanout.Split(bufio.ScanRunes)\n\nvar waitgroup sync.WaitGroup\nwaitgroup.Add(1)\n\ngo func() {\n    for scanout.Scan() {\n        fmt.Print(scanout.Text())\n     }\n}()\n\nwaitgroup.Wait()\nwaitgroup.Add(1)\n\ngo func() {\nscanerr.Split(bufio.ScanRunes)\n        for scanerr.Scan() {\n            fmt.Print(scanerr.Text())\n        }\n}()\nwaitgroup.Wait()\n\n}\n</code></pre>\n\n<p><strong>update</strong></p>\n\n<p>should it be like this ?</p>\n\n<pre><code>func exec(stdout io.Reader, stderr io.Reader) (*bufio.Scanner, *bufio.Scanner) {\n\nscanout := bufio.NewScanner(stdout)\nscanout.Split(bufio.ScanRunes)\n\nvar waitgroup sync.WaitGroup\nwaitgroup.Add(2)\n\ngo func() {\n    for scanout.Scan() {\n        fmt.Print(scanout.Text())\n     }\n}()\n\ngo func() {\nscanerr.Split(bufio.ScanRunes)\n        for scanerr.Scan() {\n            fmt.Print(scanerr.Text())\n        }\n}()\nwaitgroup.Wait()\n\n}\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "microservices", "prometheus"], "comments": [{"owner": {"reputation": 2274, "user_id": 7567579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab9644beeb1d324d1247b2951d28927?s=128&d=identicon&r=PG", "display_name": "Emin Laletovic", "link": "https://stackoverflow.com/users/7567579/emin-laletovic"}, "edited": false, "score": 0, "creation_date": 1573565449, "post_id": 58817709, "comment_id": 103916793, "body": "could you please also add the error that occurs for your implementation?"}, {"owner": {"reputation": 7937, "user_id": 1866300, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/dab16abeddf6aa51bb13e7fe06d70b2c?s=128&d=identicon&r=PG", "display_name": "Serve Laurijssen", "link": "https://stackoverflow.com/users/1866300/serve-laurijssen"}, "reply_to_user": {"reputation": 2274, "user_id": 7567579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab9644beeb1d324d1247b2951d28927?s=128&d=identicon&r=PG", "display_name": "Emin Laletovic", "link": "https://stackoverflow.com/users/7567579/emin-laletovic"}, "edited": false, "score": 0, "creation_date": 1573628418, "post_id": 58817709, "comment_id": 103938898, "body": "I&#39;ve been told that you cant cache like this, there is no error"}, {"owner": {"reputation": 7937, "user_id": 1866300, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/dab16abeddf6aa51bb13e7fe06d70b2c?s=128&d=identicon&r=PG", "display_name": "Serve Laurijssen", "link": "https://stackoverflow.com/users/1866300/serve-laurijssen"}, "reply_to_user": {"reputation": 2274, "user_id": 7567579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab9644beeb1d324d1247b2951d28927?s=128&d=identicon&r=PG", "display_name": "Emin Laletovic", "link": "https://stackoverflow.com/users/7567579/emin-laletovic"}, "edited": false, "score": 0, "creation_date": 1573645461, "post_id": 58817709, "comment_id": 103947340, "body": "Just looking for a good way how to do it easily"}, {"owner": {"reputation": 2274, "user_id": 7567579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ab9644beeb1d324d1247b2951d28927?s=128&d=identicon&r=PG", "display_name": "Emin Laletovic", "link": "https://stackoverflow.com/users/7567579/emin-laletovic"}, "edited": false, "score": 0, "creation_date": 1573648854, "post_id": 58817709, "comment_id": 103949015, "body": "I&#39;m not sure what you&#39;re caching here as this is the first time I see someone use Prometheus for something other than gathering metrics. General problem of handling cache between multiple instances is data consistency because of the fact that data for the same cache key can be re-written between different instances."}, {"owner": {"reputation": 5081, "user_id": 8657904, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-rMfL3u_MOf8/AAAAAAAAAAI/AAAAAAAAA3o/MAq-a_P33vI/photo.jpg?sz=128", "display_name": "Alin S&#238;np\u0103lean", "link": "https://stackoverflow.com/users/8657904/alin-s%c3%aenp%c4%83lean"}, "edited": false, "score": 2, "creation_date": 1573728596, "post_id": 58817709, "comment_id": 103981856, "body": "By &quot;the next call might come in on another endpoint&quot; do you mean you have separate separate requests for &quot;start service call&quot; and &quot;end service call&quot;? Or simply that you may get different &quot;service calls&quot; (each consisting of &quot;start service call&quot;, useful work, and &quot;end service call&quot;) handled by different replicas?"}, {"owner": {"reputation": 7937, "user_id": 1866300, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/dab16abeddf6aa51bb13e7fe06d70b2c?s=128&d=identicon&r=PG", "display_name": "Serve Laurijssen", "link": "https://stackoverflow.com/users/1866300/serve-laurijssen"}, "edited": false, "score": 0, "creation_date": 1573731767, "post_id": 58817709, "comment_id": 103983606, "body": "The word session triggered a google search on &quot;kubernetes session&quot; and that came up with: <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/\" rel=\"nofollow noreferrer\">kubernetes.io/docs/concepts/services-networking/service</a> You can configure the service to have the same ip address always go to the same pod by setting service.spec.sessionAffinity to \u201cClientIP\u201d!"}, {"owner": {"reputation": 7660, "user_id": 2350684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yuQa5.jpg?s=128&g=1", "display_name": "Oliver", "link": "https://stackoverflow.com/users/2350684/oliver"}, "edited": false, "score": 0, "creation_date": 1573748889, "post_id": 58817709, "comment_id": 103993819, "body": "Your metric collection code has some fundamental issues. You try to collect timings on a per-ID basis but then record only one gauge value with the value in seconds which means last write wins and no meaningful data is collected. You should look into using a histogram or summary when collecting timings."}], "answers": [{"comments": [{"owner": {"reputation": 7660, "user_id": 2350684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yuQa5.jpg?s=128&g=1", "display_name": "Oliver", "link": "https://stackoverflow.com/users/2350684/oliver"}, "edited": false, "score": 0, "creation_date": 1573748678, "post_id": 58856092, "comment_id": 103993704, "body": "Is the requirement to track these timings across multiple API requests? If yes, then sessionAffinity will only help so much. Pods come and go (esp when scaling up and down a lot) and there&#39;s no guarantee the pod that recorded the start time is still around later in the life cycle."}], "tags": [], "owner": {"reputation": 7937, "user_id": 1866300, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/dab16abeddf6aa51bb13e7fe06d70b2c?s=128&d=identicon&r=PG", "display_name": "Serve Laurijssen", "link": "https://stackoverflow.com/users/1866300/serve-laurijssen"}, "is_accepted": true, "score": 0, "last_activity_date": 1573732032, "creation_date": 1573732032, "answer_id": 58856092, "question_id": 58817709, "link": "https://stackoverflow.com/questions/58817709/multiple-replicas-accessing-a-cache-in-kubernetes/58856092#58856092", "title": "Multiple replicas accessing a cache in kubernetes", "body": "<p>Finally found this:</p>\n\n<p><a href=\"https://kubernetes.io/docs/concepts/services-networking/service\" rel=\"nofollow noreferrer\">https://kubernetes.io/docs/concepts/services-networking/service</a> </p>\n\n<blockquote>\n  <p>You can configure the service to have the same ip address always go to\n  the same pod by setting service.spec.sessionAffinity to \u201cClientIP\u201d the\n  default is \u201cNone\u201d</p>\n</blockquote>\n\n<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: my-service\nspec:\n  sessionAffinity: ClientIP\n  selector:\n    app: MyApp\n</code></pre>\n\n<p>This way you can safely cache simple values in memory!</p>\n"}], "owner": {"reputation": 7937, "user_id": 1866300, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/dab16abeddf6aa51bb13e7fe06d70b2c?s=128&d=identicon&r=PG", "display_name": "Serve Laurijssen", "link": "https://stackoverflow.com/users/1866300/serve-laurijssen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 58856092, "answer_count": 1, "score": 1, "last_activity_date": 1573732032, "creation_date": 1573557918, "last_edit_date": 1573731514, "question_id": 58817709, "link": "https://stackoverflow.com/questions/58817709/multiple-replicas-accessing-a-cache-in-kubernetes", "title": "Multiple replicas accessing a cache in kubernetes", "body": "<p>One statistic for Prometheus logging is the duration of service calls but I want to measure the time over multiple calls of the same service.</p>\n\n<p>So I figured to create a map of string to time.Time</p>\n\n<pre><code>type SomeService struct {\n    durations map[string]time.Time\n}\n</code></pre>\n\n<p>On first entry the current time is stored for that account id </p>\n\n<pre><code>durations[GetId()] = time.Now()\n</code></pre>\n\n<p>And then in the end\u2026in another call\u2026the total time is stored.</p>\n\n<pre><code>startTime := c.durations[id]\nduration, _ := c.durationStat.GetMetricWith(prometheus.Labels{\"type\": duration})\nduration.Set(time.Now().Sub(startTime).Seconds())\ndelete(c.durations, id)\n</code></pre>\n\n<p>This works when there is only one replica but it breaks down in a Kubernetes cluster right? The next call might come in on another endpoint? How do you cache values in microservices so that every replica can access them?</p>\n"}, {"tags": ["c++", "go", "compiler-errors", "mingw-w64", "msvcrt"], "comments": [{"owner": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1573559911, "post_id": 58816048, "comment_id": 103913803, "body": "Are you mixing files from two different tool-chains as this does not work?"}, {"owner": {"reputation": 11, "user_id": 12359872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6a5e91620614e51cd07e4ead0fe8394?s=128&d=identicon&r=PG&f=1", "display_name": "rickyW", "link": "https://stackoverflow.com/users/12359872/rickyw"}, "reply_to_user": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1573564189, "post_id": 58816048, "comment_id": 103916125, "body": "@ Richard Critten  Why would I do that?"}, {"owner": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1573565006, "post_id": 58816048, "comment_id": 103916553, "body": "Because mingw-w64 does not use MSVCRT, it&#39;s got it&#39;s own  C runtime support library. So the question title prompted my comment."}, {"owner": {"reputation": 44802, "user_id": 2752075, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/5oQlf.png?s=128&g=1", "display_name": "HolyBlackCat", "link": "https://stackoverflow.com/users/2752075/holyblackcat"}, "reply_to_user": {"reputation": 1636, "user_id": 3370124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f73352b4adb282c092738f34883488dd?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Critten", "link": "https://stackoverflow.com/users/3370124/richard-critten"}, "edited": false, "score": 0, "creation_date": 1573570713, "post_id": 58816048, "comment_id": 103919441, "body": "@RichardCritten I&#39;ve tested it on my machine. Even a simple &#39;hello world&#39; binary appears to load <code>msvcrt.dll</code> at startup."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 12359872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6a5e91620614e51cd07e4ead0fe8394?s=128&d=identicon&r=PG&f=1", "display_name": "rickyW", "link": "https://stackoverflow.com/users/12359872/rickyw"}, "is_accepted": true, "score": 0, "last_activity_date": 1574844957, "last_edit_date": 1574844957, "creation_date": 1574842070, "answer_id": 59065697, "question_id": 58816048, "link": "https://stackoverflow.com/questions/58816048/how-to-solve-mingw-w64-msvcrt-dependency-issues/59065697#59065697", "title": "How to solve mingw-w64 MSVCRT dependency issues", "body": "<p>So I answer my question by myself, the case is closed.</p>\n\n<p>Yes, Mingw64 uses msvcrt.</p>\n\n<p>Here are some tips that could help to solve dependency problems between Mingw64 &amp; msvcrt.\nThe major goal is to let compiler load the correct version of MSVCRT library family.</p>\n\n<p>1.Update Mingw64.</p>\n\n<p>2.Check out <strong>MSVCRT_VERSION</strong> in Mingw64\\include_mingw.h(or x86_64-w64-mingw32\\include), make sure the version number matches your windows version, or modify it.</p>\n\n<p>3.Take a look at linker option like \"#cgo LDFLAGS: -Lxxx\", don't mess the library path. Remove any unnecessary library path setting, let linker finds libraries itself.</p>\n\n<ol start=\"4\">\n<li>Make sure everything is built with same libraries.</li>\n</ol>\n"}], "owner": {"reputation": 11, "user_id": 12359872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6a5e91620614e51cd07e4ead0fe8394?s=128&d=identicon&r=PG&f=1", "display_name": "rickyW", "link": "https://stackoverflow.com/users/12359872/rickyw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1189, "favorite_count": 1, "accepted_answer_id": 59065697, "answer_count": 1, "score": 1, "last_activity_date": 1574844957, "creation_date": 1573552314, "last_edit_date": 1573626333, "question_id": 58816048, "link": "https://stackoverflow.com/questions/58816048/how-to-solve-mingw-w64-msvcrt-dependency-issues", "title": "How to solve mingw-w64 MSVCRT dependency issues", "body": "<p>I'm building a golang project by using Go1.12 + msys2/mingw-w64(9.2.0), it shows errors:</p>\n\n<pre><code>D:\\Go\\pkg\\tool\\windows_amd64\\link.exe: running gcc failed: exit status 1\nD:/msys64/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/9.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: D:/msys64/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/9.2.0/../../../../x86_64-w64-mingw32/lib/../lib/crt2.o: in function `pre_c_init':\nE:/mingwbuild/mingw-w64-crt-git/src/mingw-w64/mingw-w64-crt/crt/crtexe.c:146: undefined reference to `__p__fmode'\nD:/msys64/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/9.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: D:/msys64/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/9.2.0/../../../../x86_64-w64-mingw32/lib/../lib/crt2.o: in function `__tmainCRTStartup':\nE:/mingwbuild/mingw-w64-crt-git/src/mingw-w64/mingw-w64-crt/crt/crtexe.c:290: undefined reference to `_set_invalid_parameter_handler'\nD:/msys64/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/9.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: E:/mingwbuild/mingw-w64-crt-git/src/mingw-w64/mingw-w64-crt/crt/crtexe.c:299: undefined reference to `__p__acmdln'\nD:/msys64/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/9.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: D:/msys64/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/9.2.0/../../../../x86_64-w64-mingw32/lib/../lib/libmingw32.a(lib64_libmingw32_a-merr.o): in function `_matherr':\nE:/mingwbuild/mingw-w64-crt-git/src/mingw-w64/mingw-w64-crt/crt/merr.c:46: undefined reference to `__acrt_iob_func'\nD:/msys64/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/9.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: D:/msys64/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/9.2.0/../../../../x86_64-w64-mingw32/lib/../lib/libmingw32.a(lib64_libmingw32_a-pseudo-reloc.o): in function `__report_error':\nE:/mingwbuild/mingw-w64-crt-git/src/mingw-w64/mingw-w64-crt/crt/pseudo-reloc.c:149: undefined reference to `__acrt_iob_func'\nD:/msys64/mingw64/bin/../lib/gcc/x86_64-w64-mingw32/9.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: E:/mingwbuild/mingw-w64-crt-git/src/mingw-w64/mingw-w64-crt/crt/pseudo-reloc.c:150: undefined reference to `__acrt_iob_func'\ncollect2.exe: error: ld returned 1 exit status\n</code></pre>\n\n<p>After some research I'm sure it's a msvcrt compatibility issue of mingw64.\nI know there are workarounds like this: <a href=\"https://stackoverflow.com/questions/30412951/unresolved-external-symbol-imp-fprintf-and-imp-iob-func-sdl2\">unresolved external symbol __imp__fprintf and __imp____iob_func, SDL2</a>\nBut it doesn't solve all of my issues.</p>\n\n<p>I try to link the library: LDFLAGS: -L%filepath% -llegacy_stdio_definitions, nothing changes.</p>\n\n<p>Is there a patch to fix it, or do I have to build my custom version of mingw64?</p>\n"}, {"tags": ["api", "go", "ffprobe"], "comments": [{"owner": {"reputation": 61761, "user_id": 5726027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a15e6b3536ef969cf3a9828a0542aac2?s=128&d=identicon&r=PG", "display_name": "Gyan", "link": "https://stackoverflow.com/users/5726027/gyan"}, "edited": false, "score": 0, "creation_date": 1573555581, "post_id": 58815832, "comment_id": 103911599, "body": "What&#39;s the command to generate the files?"}, {"owner": {"reputation": 360, "user_id": 5368380, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CwYpY.jpg?s=128&g=1", "display_name": "blixenkrone", "link": "https://stackoverflow.com/users/5368380/blixenkrone"}, "reply_to_user": {"reputation": 61761, "user_id": 5726027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a15e6b3536ef969cf3a9828a0542aac2?s=128&d=identicon&r=PG", "display_name": "Gyan", "link": "https://stackoverflow.com/users/5726027/gyan"}, "edited": false, "score": 0, "creation_date": 1573555671, "post_id": 58815832, "comment_id": 103911650, "body": "Just stdlib: <code>file, err := ioutil.TempFile(os.TempDir(), &quot;prefix-*&quot;)</code> <code>_ := ioutil.WriteFile(file.Name(), data, 0777)</code>."}, {"owner": {"reputation": 61761, "user_id": 5726027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a15e6b3536ef969cf3a9828a0542aac2?s=128&d=identicon&r=PG", "display_name": "Gyan", "link": "https://stackoverflow.com/users/5726027/gyan"}, "edited": false, "score": 0, "creation_date": 1573563997, "post_id": 58815832, "comment_id": 103916009, "body": "Where does the payload come from (the MP4)?"}, {"owner": {"reputation": 360, "user_id": 5368380, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CwYpY.jpg?s=128&g=1", "display_name": "blixenkrone", "link": "https://stackoverflow.com/users/5368380/blixenkrone"}, "reply_to_user": {"reputation": 61761, "user_id": 5726027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a15e6b3536ef969cf3a9828a0542aac2?s=128&d=identicon&r=PG", "display_name": "Gyan", "link": "https://stackoverflow.com/users/5726027/gyan"}, "edited": false, "score": 0, "creation_date": 1573564491, "post_id": 58815832, "comment_id": 103916271, "body": "payload is a r.Body from http.HandlerFunc. Check here: <a href=\"https://github.com/blixenkrone/gopro/blob/video-width-height/internal/server/handlers.go#L199\" rel=\"nofollow noreferrer\">github.com/blixenkrone/gopro/blob/video-width-height/interna&zwnj;&#8203;l/&hellip;</a>"}, {"owner": {"reputation": 360, "user_id": 5368380, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CwYpY.jpg?s=128&g=1", "display_name": "blixenkrone", "link": "https://stackoverflow.com/users/5368380/blixenkrone"}, "reply_to_user": {"reputation": 61761, "user_id": 5726027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a15e6b3536ef969cf3a9828a0542aac2?s=128&d=identicon&r=PG", "display_name": "Gyan", "link": "https://stackoverflow.com/users/5726027/gyan"}, "edited": false, "score": 0, "creation_date": 1573564604, "post_id": 58815832, "comment_id": 103916330, "body": "@Gyan this is the pkg running exec: <a href=\"https://github.com/blixenkrone/gopro/blob/video-width-height/internal/exif/video/video.go#L104\" rel=\"nofollow noreferrer\">github.com/blixenkrone/gopro/blob/video-width-height/interna&zwnj;&#8203;l/&hellip;</a>"}], "owner": {"reputation": 360, "user_id": 5368380, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/CwYpY.jpg?s=128&g=1", "display_name": "blixenkrone", "link": "https://stackoverflow.com/users/5368380/blixenkrone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1573575832, "creation_date": 1573551597, "last_edit_date": 1573575832, "question_id": 58815832, "link": "https://stackoverflow.com/questions/58815832/ffprobe-exec-on-video-files-causes-error-not-caught-in-tests", "title": "ffprobe exec on video files causes error - not caught in tests", "body": "<p>I've created a cmd exec to be run from an input video file (mov+mp4 tried), that's being created as a temporary file:</p>\n\n<pre><code>cmd := exec.Command(ffprobe, \"-v\", \"error\", \"-print_format\", \"json\", \"-show_format\", \"-show_streams\", \"-hide_banner\", fileName)\n</code></pre>\n\n<p>When I run the functions as a test, the ffprobe cmd works fine, but when I create the request from http, the cmd fails with msg:</p>\n\n<blockquote>\n  <p>/var/folders/b1/53jz_b9j1rb0nhhzmv4kwbk80000gn/T/prefix-044409485: Invalid data found when processing input</p>\n</blockquote>\n\n<p>I read the file as an <code>io.Reader</code> both in the http request and the testing func, so the input datatype should be identical.</p>\n\n<p>What should happen: the http request will return the same output as the test func.</p>\n\n<p>What do you think causes it? The temporary file is being created perfectly, but I'm having doubts whether the http request body add's some metadata to the file upon the request.\nOther thought is the \"moov atom\" issue in mp4 files.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 694, "user_id": 8627962, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4f-Yq3BvCaA/AAAAAAAAAAI/AAAAAAAAARM/NeJoNAwQHT0/photo.jpg?sz=128", "display_name": "Siva Guru", "link": "https://stackoverflow.com/users/8627962/siva-guru"}, "edited": false, "score": 0, "creation_date": 1573543178, "post_id": 58813512, "comment_id": 103905669, "body": "you could try looking into go tags."}], "answers": [{"tags": [], "owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "is_accepted": true, "score": 4, "last_activity_date": 1573690412, "last_edit_date": 1573690412, "creation_date": 1573546475, "answer_id": 58814531, "question_id": 58813512, "link": "https://stackoverflow.com/questions/58813512/is-it-possible-to-detect-if-go-binary-was-compiled-with-h-windowsgui-at-runtime/58814531#58814531", "title": "Is it possible to detect if Go binary was compiled with -H=windowsgui at runtime", "body": "<p><a href=\"https://github.com/golang/go/blob/6219b48e11f36329de801f62f18448bb4b1cd1a5/src/cmd/link/internal/ld/pe.go#L852-L858\" rel=\"nofollow noreferrer\">According to the Go source</a>, it seems to set <code>Subsystem</code> of <code>OptionalHeader</code> when linking.</p>\n\n<p>Therefore, you can obtain it by using <a href=\"https://golang.org/pkg/debug/pe/\" rel=\"nofollow noreferrer\">debug/pe</a>.</p>\n\n<p>Following code will print <code>it is windows GUI</code> when compiled with <code>go build -ldflags \"-H windowsgui\"</code>, and print <code>it is windows CUI</code> otherwise.</p>\n\n<p>Note that <code>os.Executable()</code> may return path for symbolic link, so may not be reliable. Refer to: <a href=\"https://tip.golang.org/pkg/os/#Executable\" rel=\"nofollow noreferrer\">the document of os.Executable()</a></p>\n\n<pre><code>package main\n\nimport (\n    \"debug/pe\"\n    \"fmt\"\n    \"os\"\n)\n\n// these constants are copied from https://github.com/golang/go/blob/6219b48e11f36329de801f62f18448bb4b1cd1a5/src/cmd/link/internal/ld/pe.go#L92-L93  \nconst (\n    IMAGE_SUBSYSTEM_WINDOWS_GUI = 2\n    IMAGE_SUBSYSTEM_WINDOWS_CUI = 3\n)\n\nfunc main() {\n    fileName, err := os.Executable()\n    if err != nil {\n        panic(err)\n    }\n    fl, err := pe.Open(fileName)\n    if err != nil {\n        panic(err) // maybe not windows binary, or unreadable for some reasons\n    }\n    defer fl.Close()\n\n    var subsystem uint16\n    if header, ok := fl.OptionalHeader.(*pe.OptionalHeader64); ok {\n        subsystem = header.Subsystem\n    } else if header, ok := fl.OptionalHeader.(*pe.OptionalHeader32); ok {\n        subsystem = header.Subsystem\n    }\n\n    if subsystem == IMAGE_SUBSYSTEM_WINDOWS_GUI {\n        fmt.Println(\"it is windows GUI\")\n    } else if subsystem == IMAGE_SUBSYSTEM_WINDOWS_CUI {\n        fmt.Println(\"it is windows CUI\")\n    } else {\n        fmt.Println(\"binary type unknown\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 890, "user_id": 2934704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KXMul.jpg?s=128&g=1", "display_name": "jerblack", "link": "https://stackoverflow.com/users/2934704/jerblack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 58814531, "answer_count": 1, "score": 1, "last_activity_date": 1573690412, "creation_date": 1573541867, "question_id": 58813512, "link": "https://stackoverflow.com/questions/58813512/is-it-possible-to-detect-if-go-binary-was-compiled-with-h-windowsgui-at-runtime", "title": "Is it possible to detect if Go binary was compiled with -H=windowsgui at runtime", "body": "<p>I built a tool that can be run from the console or run in the system tray if the flag <code>-tray</code> is passed at start. Just running <code>go build &lt;list of go files&gt;</code> with no build flags will create a binary that can be run in the system tray, but it also spawns a console window. If I pass the build flag <code>-H=windowsgui</code> then the console window will be hidden, but I still need to pass <code>-tray</code> to get it to actually run in the system tray. </p>\n\n<p>Is there a way at runtime to detect that the binary was built with the flag <code>-H=windowsgui</code> so I can automatically do the right thing and enable the tray without the need for the <code>-tray</code> flag to have been passed?</p>\n"}, {"tags": ["go", "vscode-settings"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 1, "last_activity_date": 1573538345, "creation_date": 1573538345, "answer_id": 58812867, "question_id": 58811605, "link": "https://stackoverflow.com/questions/58811605/how-to-use-gopls-without-internet-access/58812867#58812867", "title": "How to use gopls without internet access", "body": "<p><a href=\"https://github.com/microsoft/vscode-go/issues/2767#issuecomment-533776135\" rel=\"nofollow noreferrer\"><code>microsoft/vscode-go</code> issue 2767</a> did report that  <code>gopls</code> seems to connect to an internet address to determine something, which could be the reason is is not starting.</p>\n\n<p>Considering <a href=\"https://twitter.com/FiloSottile/status/1194056152285351937\" rel=\"nofollow noreferrer\"><code>gopls</code> has just released a new 0.2.0 version</a>, check first you have the latest (<code>go get http://golang.org/x/tools/gopls @ latest</code>, assuming you can get an internet connection just for the upgrade), and try again.</p>\n"}], "owner": {"reputation": 61, "user_id": 12301035, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-LvjgZr0reT0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reC2oSAQMKSr9RyuFFXr5qZCP1L_A/photo.jpg?sz=128", "display_name": "lotsof one", "link": "https://stackoverflow.com/users/12301035/lotsof-one"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 275, "favorite_count": 1, "accepted_answer_id": 58812867, "answer_count": 1, "score": 1, "last_activity_date": 1573548722, "creation_date": 1573529381, "last_edit_date": 1573548722, "question_id": 58811605, "link": "https://stackoverflow.com/questions/58811605/how-to-use-gopls-without-internet-access", "title": "How to use gopls without internet access", "body": "<p>I am using VSCode to write Go. And I have vscode-go installed. To enable language server, I set <code>useLanguageServer</code> to true. Under internet, everything works well, it can hover, jump and so on. But I need to work without internet connection. In this situation gopls won't work. Is there a solution?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 4, "creation_date": 1573524368, "post_id": 58810906, "comment_id": 103901335, "body": "It is padding to align struct items to 8-byte boundaries to optimize access. It is usually faster to access a single unit of memory aligned properly, based on the memory bus size. For 64-bits, that&#39;s 8 bytes, so compiler chose to align all fields to be accessed as 8-byte units."}, {"owner": {"reputation": 21, "user_id": 10315632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d3fd921124bef566588c8a2303a667a?s=128&d=identicon&r=PG&f=1", "display_name": "peachestao", "link": "https://stackoverflow.com/users/10315632/peachestao"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1573528801, "post_id": 58810906, "comment_id": 103902120, "body": "My operating system is 64 bit, if so&lt;br&gt; &#183;&#183;&#183; type A1 struct { &lt;br&gt;    a bool //1byte   assign 8byte  &lt;br&gt;    b uint32 //4byte &lt;br&gt;    c bool //1byte &lt;br&gt;    d uint32 //4byte remain 2byte, not enough 4byte,again assign 8byte&lt;br&gt;    e uint8 //1byte&lt;br&gt;    f uint32 //4byte remain 3byte, not enough 4byte,again assign 8byte&lt;br&gt;    g uint8 //1byte&lt;br&gt; }&lt;br&gt; &#183;&#183;&#183; size of A1 Should is: 8+8+8=24,but fact is:28&lt;br&gt;  Is there something wrong with my understanding? &lt;br&gt;"}], "answers": [{"tags": [], "owner": {"reputation": 5170, "user_id": 9200529, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LgIT2.jpg?s=128&g=1", "display_name": "Nathan V\u0113rzemnieks", "link": "https://stackoverflow.com/users/9200529/nathan-v%c4%93rzemnieks"}, "is_accepted": false, "score": 4, "last_activity_date": 1573531116, "creation_date": 1573531116, "answer_id": 58811814, "question_id": 58810906, "link": "https://stackoverflow.com/questions/58810906/why-is-the-struct-memory-size-inconsistent-with-my-expectations/58811814#58811814", "title": "Why is the struct memory size inconsistent with my expectations?", "body": "<p>You may find <a href=\"http://golang-sizeof.tips/\" rel=\"nofollow noreferrer\">this sizeof explainer</a> helpful; I certainly have.</p>\n\n<p>For the <a href=\"https://stackoverflow.com/questions/58810906/why-is-the-struct-memory-size-inconsistent-with-my-expectations#comment103902120_58810906\">example in your comment</a>, with fields of type <code>bool</code>, <code>uint32</code>, <code>bool</code>, <code>uint32</code>, <code>uint8</code>, <code>uint32</code>, and <code>uint8</code>, go uses 4-byte alignment, because none of the individual types is larger than that. Every 1-byte field in that example ends up using four bytes, because each of them is only next to 4-byte types. Each field ends up using four bytes, for a total of 28. If you rearrange the fields so that all four 1-byte fields are at the beginning or the end, they can all be packed into a single 4-byte window, so the whole struct only takes 16 bytes.</p>\n\n<p>For the example in your original post, go uses 8-byte alignment, because one of the struct fields requires at least eight bytes, so the fields use 16, 8, and 8 bytes respectively for a total of 32. In this case there's no benefit to rearranging the fields, because only one of them is smaller than the alignment.</p>\n"}, {"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 7, "last_activity_date": 1573542954, "last_edit_date": 1573542954, "creation_date": 1573537789, "answer_id": 58812757, "question_id": 58810906, "link": "https://stackoverflow.com/questions/58810906/why-is-the-struct-memory-size-inconsistent-with-my-expectations/58812757#58812757", "title": "Why is the struct memory size inconsistent with my expectations?", "body": "<p><a href=\"https://golang.org/ref/spec#Size_and_alignment_guarantees\" rel=\"noreferrer\">Size and alignment guarantees</a>: </p>\n\n<blockquote>\n  <p>For the numeric types, the following sizes are guaranteed:</p>\n</blockquote>\n\n<pre><code>type                                 size in bytes\n\nbyte, uint8, int8                     1\nuint16, int16                         2\nuint32, int32, float32                4\nuint64, int64, float64, complex64     8\ncomplex128                           16\n</code></pre>\n\n<blockquote>\n  <p>The following minimal alignment properties are guaranteed:<br>\n  1. For a variable x of any type: unsafe.Alignof(x) is at least 1.<br>\n  2. For a variable x of struct type: unsafe.Alignof(x) is the largest of all the values unsafe.Alignof(x.f) for each field f of x, but at least 1.<br>\n  3. For a variable x of array type: unsafe.Alignof(x) is the same as the alignment of a variable of the array's element type.<br>\n  A struct or array type has size zero if it contains no fields (or elements, respectively) that have a size greater than zero. Two distinct zero-size variables may have the same address in memory.</p>\n</blockquote>\n\n<p>Then, read these:<br>\n<a href=\"https://go101.org/article/memory-layout.html\" rel=\"noreferrer\">Memory Layouts</a><br>\n<a href=\"https://dave.cheney.net/2015/10/09/padding-is-hard\" rel=\"noreferrer\">Padding is hard - Dave Cheney</a>  </p>\n\n<p>Explanation on 64 bit machine:  </p>\n\n<p>Your type is struct and its size depends on how underlying types were defined. Two structs with same fields but different order may have different sizes. Size of struct is counted accordingly with padding and alignment rules.  </p>\n\n<p><a href=\"https://i.stack.imgur.com/xxpib.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/xxpib.png\" alt=\"Struct alignment\"></a></p>\n\n<p>Note: each colored box is one byte.<br>\nTry it <a href=\"http://golang-sizeof.tips/?t=Ly8gU2FtcGxlIGNvZGUKc3RydWN0IHsKICAgIE5hbWUgICAgIHN0cmluZwogICAgTW9uZXkgICAgaW50CiAgICBBZ2UgICAgICBpbnQzMgp9Cg==\" rel=\"noreferrer\">here</a>, and edit the struct then press the <code>Ask</code> button on top of the page.  </p>\n"}], "owner": {"reputation": 21, "user_id": 10315632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d3fd921124bef566588c8a2303a667a?s=128&d=identicon&r=PG&f=1", "display_name": "peachestao", "link": "https://stackoverflow.com/users/10315632/peachestao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 58812757, "answer_count": 2, "score": 0, "last_activity_date": 1573542954, "creation_date": 1573523671, "question_id": 58810906, "link": "https://stackoverflow.com/questions/58810906/why-is-the-struct-memory-size-inconsistent-with-my-expectations", "title": "Why is the struct memory size inconsistent with my expectations?", "body": "<p>I initialized a struct and calculated the memory, which is inconsistent with my expectations.</p>\n\n<p>the code is:</p>\n\n<pre><code>type Man struct {\nName     string\nMoney    int\nAge      int32\n}\n\nfunc main() {\n\nm := Man{Name:\"james\", Money:1000000, Age:30}\n\nfmt.Println(\"man size:\", unsafe.Sizeof(m))\nfmt.Println(\"name size:\", unsafe.Sizeof(m.Name))\nfmt.Println(\"money size:\", unsafe.Sizeof(m.Money))\nfmt.Println(\"age size:\", unsafe.Sizeof(m.Age))\n}\n</code></pre>\n\n<p>the result is:</p>\n\n<pre><code>man size: 32\nname size: 16\nmoney size: 8\nage size: 4\n\n</code></pre>\n\n<p>The result of my expected size of 'man' is 16 + 8 + 4=28,but fact is 32</p>\n\n<p>Looking forward to your help!</p>\n"}, {"tags": ["go", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1573512973, "post_id": 58809296, "comment_id": 103898963, "body": "Not sure if this is documented somewhere but if you take a look at the source of <code>Walk</code>, which is what <code>Inspect</code> delegates to, you&#39;ll find that <code>Ident</code> is considered by it as something like a leaf node, i.e. any children of <code>Ident</code> aren&#39;t walked any further, at least not directly through the <code>Ident</code> node. (the comment in the source says <code>nothing to do</code>). Which means that you&#39;ll have to do a bit more work to get to your desired node. For example you could manually dig yourself through from <code>RangeStmt</code> to <code>AssignStmt</code> and then continue with a second call to <code>Inspect</code> to catch your <code>UnaryExpr</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1573513000, "post_id": 58809296, "comment_id": 103898971, "body": "... example: <a href=\"https://play.golang.com/p/23wbLSik9wK\" rel=\"nofollow noreferrer\">play.golang.com/p/23wbLSik9wK</a>"}, {"owner": {"reputation": 41, "user_id": 5183153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6096b088c943fb8b7ee14efd048484d?s=128&d=identicon&r=PG&f=1", "display_name": "SegFault", "link": "https://stackoverflow.com/users/5183153/segfault"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573515259, "post_id": 58809296, "comment_id": 103899569, "body": "I thought about that, but do you think that would work on all cases? I mean, range over channels?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573541407, "post_id": 58809296, "comment_id": 103905061, "body": "I&#39;m not sure, you&#39;ll have to test it yourself which shouldn&#39;t be too hard, I think, as there aren&#39;t too many variations to the range over channel expression."}], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 5183153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6096b088c943fb8b7ee14efd048484d?s=128&d=identicon&r=PG&f=1", "display_name": "SegFault", "link": "https://stackoverflow.com/users/5183153/segfault"}, "is_accepted": false, "score": 1, "last_activity_date": 1573517264, "creation_date": 1573517264, "answer_id": 58810256, "question_id": 58809296, "link": "https://stackoverflow.com/questions/58809296/ast-inspect-not-walking-ast-unaryexpr/58810256#58810256", "title": "ast.Inspect not walking *ast.UnaryExpr", "body": "<p>As @mkopriva, <code>*ast.Ident</code> nodes are considered as leaf. Thus we need to manually move from <code>RangeStmt</code> to <code>AssignStmt</code> (if there is any) then use inspect again to reach the <code>UnaryExpr</code></p>\n"}], "owner": {"reputation": 41, "user_id": 5183153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6096b088c943fb8b7ee14efd048484d?s=128&d=identicon&r=PG&f=1", "display_name": "SegFault", "link": "https://stackoverflow.com/users/5183153/segfault"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1573517264, "creation_date": 1573509784, "question_id": 58809296, "link": "https://stackoverflow.com/questions/58809296/ast-inspect-not-walking-ast-unaryexpr", "title": "ast.Inspect not walking *ast.UnaryExpr", "body": "<p>I'm trying to inspect Go source code in order to make a tool. For this I'm using the <code>ast.Inspect</code> function.</p>\n\n<p>I need to know how channels are being used inside a function/method. </p>\n\n<p>I have this as an example code to inspect:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nfunc B(ch chan int) {\n    for x := range ch {\n\n    }\n}\n</code></pre>\n\n<p>This is the AST for the function B:</p>\n\n<pre><code> 0  *ast.FuncDecl {\n     1  .  Name: *ast.Ident {\n     2  .  .  NamePos: -:4:6\n     3  .  .  Name: \"B\"\n     4  .  .  Obj: *ast.Object {\n     5  .  .  .  Kind: func\n     6  .  .  .  Name: \"B\"\n     7  .  .  .  Decl: *(obj @ 0)\n     8  .  .  }\n     9  .  }\n    10  .  Type: *ast.FuncType {\n    11  .  .  Func: -:4:1\n    12  .  .  Params: *ast.FieldList {\n    13  .  .  .  Opening: -:4:7\n    14  .  .  .  List: []*ast.Field (len = 1) {\n    15  .  .  .  .  0: *ast.Field {\n    16  .  .  .  .  .  Names: []*ast.Ident (len = 1) {\n    17  .  .  .  .  .  .  0: *ast.Ident {\n    18  .  .  .  .  .  .  .  NamePos: -:4:8\n    19  .  .  .  .  .  .  .  Name: \"ch\"\n    20  .  .  .  .  .  .  .  Obj: *ast.Object {\n    21  .  .  .  .  .  .  .  .  Kind: var\n    22  .  .  .  .  .  .  .  .  Name: \"ch\"\n    23  .  .  .  .  .  .  .  .  Decl: *(obj @ 15)\n    24  .  .  .  .  .  .  .  }\n    25  .  .  .  .  .  .  }\n    26  .  .  .  .  .  }\n    27  .  .  .  .  .  Type: *ast.ChanType {\n    28  .  .  .  .  .  .  Begin: -:4:11\n    29  .  .  .  .  .  .  Arrow: -\n    30  .  .  .  .  .  .  Dir: 3\n    31  .  .  .  .  .  .  Value: *ast.Ident {\n    32  .  .  .  .  .  .  .  NamePos: -:4:16\n    33  .  .  .  .  .  .  .  Name: \"int\"\n    34  .  .  .  .  .  .  }\n    35  .  .  .  .  .  }\n    36  .  .  .  .  }\n    37  .  .  .  }\n    38  .  .  .  Closing: -:4:19\n    39  .  .  }\n    40  .  }\n    41  .  Body: *ast.BlockStmt {\n    42  .  .  Lbrace: -:4:21\n    43  .  .  List: []ast.Stmt (len = 1) {\n    44  .  .  .  0: *ast.RangeStmt {\n    45  .  .  .  .  For: -:5:2\n    46  .  .  .  .  Key: *ast.Ident {\n    47  .  .  .  .  .  NamePos: -:5:6\n    48  .  .  .  .  .  Name: \"x\"\n    49  .  .  .  .  .  Obj: *ast.Object {\n    50  .  .  .  .  .  .  Kind: var\n    51  .  .  .  .  .  .  Name: \"x\"\n    52  .  .  .  .  .  .  Decl: *ast.AssignStmt {\n    53  .  .  .  .  .  .  .  Lhs: []ast.Expr (len = 1) {\n    54  .  .  .  .  .  .  .  .  0: *(obj @ 46)\n    55  .  .  .  .  .  .  .  }\n    56  .  .  .  .  .  .  .  TokPos: -:5:8\n    57  .  .  .  .  .  .  .  Tok: :=\n    58  .  .  .  .  .  .  .  Rhs: []ast.Expr (len = 1) {\n    59  .  .  .  .  .  .  .  .  0: *ast.UnaryExpr {\n    60  .  .  .  .  .  .  .  .  .  OpPos: -:5:11\n    61  .  .  .  .  .  .  .  .  .  Op: range\n    62  .  .  .  .  .  .  .  .  .  X: *ast.Ident {\n    63  .  .  .  .  .  .  .  .  .  .  NamePos: -:5:17\n    64  .  .  .  .  .  .  .  .  .  .  Name: \"ch\"\n    65  .  .  .  .  .  .  .  .  .  .  Obj: *(obj @ 20)\n    66  .  .  .  .  .  .  .  .  .  }\n    67  .  .  .  .  .  .  .  .  }\n    68  .  .  .  .  .  .  .  }\n    69  .  .  .  .  .  .  }\n    70  .  .  .  .  .  }\n    71  .  .  .  .  }\n    72  .  .  .  .  TokPos: -:5:8\n    73  .  .  .  .  Tok: :=\n    74  .  .  .  .  X: *(obj @ 62)\n    75  .  .  .  .  Body: *ast.BlockStmt {\n    76  .  .  .  .  .  Lbrace: -:5:20\n    77  .  .  .  .  .  Rbrace: -:7:2\n    78  .  .  .  .  }\n    79  .  .  .  }\n    80  .  .  }\n    81  .  .  Rbrace: -:8:1\n    82  .\n</code></pre>\n\n<p>As you can see in line <code>59</code> we can see there is an <code>UnaryExpr</code> node with <code>Op</code> set to <code>range</code>. That's the node I want to catch.</p>\n\n<p>I tried using this code to walk the ast and only catch that node.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>exampleFunc := `\npackage main\n\nfunc B(ch chan int) {\n    for x := range ch {\n\n    }\n}\n`\nfset := token.NewFileSet()\nfile, err := parser.ParseFile(fset, \"-\", exampleFunc, parser.ParseComments)\nast.Inspect(file, func(node ast.Node) bool {\n    fn, ok := node.(*ast.UnaryExpr) // try to cast\n    if !ok {\n        return true\n    }\n        ast.Print(fset, fn)\n    return true\n})\n</code></pre>\n\n<p>But it's doesn't seem to work.</p>\n\n<p>Any idea why, printing the AST of the whole FuncDecl, I can see there is an UnaryExpr node, but nothing appear when trying to get that node? </p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 2, "creation_date": 1573520196, "post_id": 58808743, "comment_id": 103900547, "body": "Don&#39;t comment out lines which are part of a continuous multi-line statement. The first trailing back-slash joins the commented line that follows which effectively comments out the entire remaining part of the compound statement."}, {"owner": {"reputation": 139, "user_id": 5683221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e9221629349f8f94d41e2c3c0d89ecd?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/5683221/steve"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1573587842, "post_id": 58808743, "comment_id": 103927899, "body": "@colminator I did it, but nothing has changed. Watch the video, please youtube.com/watch?v=GuQqatSTO7w"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1573591505, "post_id": 58808743, "comment_id": 103929407, "body": "wasn&#39;t suggesting this was your root cause - but just a potential gotcha for your testing. Re your video - you are developing on Windows and using a Linux-based docker-container. I would suspect there is some filesystem notifications that are lost when going from one OS to the other. I&#39;ve expanded on this in the answer section."}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 0, "last_activity_date": 1573589570, "creation_date": 1573589570, "answer_id": 58826004, "question_id": 58808743, "link": "https://stackoverflow.com/questions/58808743/how-to-rebuild-go-golang-application-with-fresh-or-air/58826004#58826004", "title": "How to rebuild go golang application with fresh or air?", "body": "<p>From similar issues: <a href=\"https://github.com/fsnotify/fsnotify/issues/292\" rel=\"nofollow noreferrer\">https://github.com/fsnotify/fsnotify/issues/292</a></p>\n\n<p>FS notify events are not triggered by host Windows file updates:</p>\n\n<blockquote>\n  <p>I'm not sure how Docker for Windows is mounting the shared folder, but\n  generally file shares ... don't support notifications.</p>\n</blockquote>\n\n<p>This issue does not appear to affect MacOS or Linux hosts.</p>\n\n<p>If you must be on Windows, perhaps this package may help:</p>\n\n<ul>\n<li><a href=\"https://github.com/zippoxer/docker-windows-volume-watcher\" rel=\"nofollow noreferrer\">https://github.com/zippoxer/docker-windows-volume-watcher</a></li>\n</ul>\n\n<pre><code>Usage of docker-windows-volume-watcher:\n\n  -container string\n        Name of the container instance that you wish to notify of filesystem changes\n\n  -delay int\n        Delay in milliseconds before notifying about a file that's changed (default 100)\n\n  -ignore string\n        Semicolon-separated list of directories to ignore. Glob expressions are supported. (default \"node_modules;vendor\")\n\n  -path string\n        Root path where to watch for changes\n</code></pre>\n"}], "owner": {"reputation": 139, "user_id": 5683221, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e9221629349f8f94d41e2c3c0d89ecd?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/5683221/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 909, "favorite_count": 0, "accepted_answer_id": 58826004, "answer_count": 1, "score": 0, "last_activity_date": 1573589570, "creation_date": 1573506603, "last_edit_date": 1573573084, "question_id": 58808743, "link": "https://stackoverflow.com/questions/58808743/how-to-rebuild-go-golang-application-with-fresh-or-air", "title": "How to rebuild go golang application with fresh or air?", "body": "<p>gravityblast/fresh and cosmtrek/air are not rebuilding main.go, when i change files from local volume. Where im wrong? <a href=\"https://www.youtube.com/watch?v=GuQqatSTO7w\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=GuQqatSTO7w</a></p>\n\n<p>Dockerfile</p>\n\n<pre><code># create image from the official Go image\nFROM golang:alpine\nRUN apk add --update tzdata \\\n    bash wget curl git nano;\n# Create binary directory, install glide and fresh\nRUN mkdir -p $$GOPATH/bin &amp;&amp; \\\n    # curl https://glide.sh/get | sh &amp;&amp; \\\n    # go get github.com/pilu/fresh &amp;&amp; \\\n    curl -fLo ~/.air https://raw.githubusercontent.com/cosmtrek/air/master/bin/linux/air &amp;&amp; \\\n    chmod +x ~/.air\n\n# define work directory\nADD . /go/src/app\nWORKDIR /go/src/app\n\n\n# serve the app1\nCMD ~/.air -c air.conf\n\nRUN chmod -R 0777 $GOPATH/src\n</code></pre>\n"}, {"tags": ["performance", "go", "epoll"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1573505833, "post_id": 58808491, "comment_id": 103896471, "body": "That comment was referring to a single-thread use case, in which case there is no stack switching because there is only a single goroutine (nothing to switch between)."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 2, "last_activity_date": 1573554699, "last_edit_date": 1573554699, "creation_date": 1573551964, "answer_id": 58815933, "question_id": 58808491, "link": "https://stackoverflow.com/questions/58808491/advantages-of-epoll-integration/58815933#58815933", "title": "Advantages of epoll integration", "body": "<p>That's not the netpoller integration <em>per se</em> which makes Go strong in its field\u2014it's rather the way that integration is done: instead of being bolted-on as a library, in Go, the netpoller is tightly integrated right into the runtime and the scheduler (which decides which goroutine to run, and when).</p>\n\n<p>The coupling of super-light-weight threads of execution\u2014goroutines\u2014with the netpoller allows for <em>callback-free</em> programming. That is, once your service gets another client connected, you just hand this connection to a goroutine which merely reads the data from it (and writes its response stream to it). As soon as there's no data available when the goroutine wants to read it, the scheduler suspends the goroutine and unblocks it once the netpoller reports there's data available; the same happens when the goroutine wants to write data but the sending buffer is full.</p>\n\n<p>To recap, the netpoller in Go is intertwined with the goroutine scheduler which allows goroutines transparently wait for data availability without requiring the programmer to explicitly code the event loop and callbacks or deal with \"futures\" and \"promises\" which are mere callbacks wrapped in pretty objects.</p>\n\n<p>I invite you to read <a href=\"https://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/\" rel=\"nofollow noreferrer\">this classic essay</a> which explains this stuff with much more beautiful words.</p>\n"}], "owner": {"reputation": 185, "user_id": 2048322, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/VB3KL.jpg?s=128&g=1", "display_name": "GFB", "link": "https://stackoverflow.com/users/2048322/gfb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 58815933, "answer_count": 1, "score": 0, "last_activity_date": 1573554699, "creation_date": 1573505293, "last_edit_date": 1573548152, "question_id": 58808491, "link": "https://stackoverflow.com/questions/58808491/advantages-of-epoll-integration", "title": "Advantages of epoll integration", "body": "<p>On one job interview I had to answer this question - which advantages do you have owing to use epoll integration/implementation in Go.</p>\n\n<p>I just know what can do epoll and that complexity for any descriptors count is O(1), but have no idea why Go is better than other languages.</p>\n\n<p>I found this branch <a href=\"https://news.ycombinator.com/item?id=15624586\" rel=\"nofollow noreferrer\">https://news.ycombinator.com/item?id=15624586</a> and guy say that reason, maybe, that Go don't use stack switching. It's hard to understand for me. Which part of program don't use stack switching? Every goroutine has his own stack.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1573502587, "post_id": 58807870, "comment_id": 103895268, "body": "A small suggestion on your implementation: change the switch condition to <code>f.Type().Kind()</code> and use the <a href=\"https://godoc.org/reflect#Kind\" rel=\"nofollow noreferrer\"><code>Kind</code></a> constants in your switch cases."}], "answers": [{"tags": [], "owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "is_accepted": true, "score": 0, "last_activity_date": 1573503094, "last_edit_date": 1573503094, "creation_date": 1573502694, "answer_id": 58807977, "question_id": 58807870, "link": "https://stackoverflow.com/questions/58807870/how-to-unmarshal-float64-records-in-database-to-create-insert/58807977#58807977", "title": "How to Unmarshal float64 records in database to create insert", "body": "<p>Handle floats using the same pattern as integers. Replace <a href=\"https://godoc.org/strconv#ParseInt\" rel=\"nofollow noreferrer\">strconv.ParseInt</a> with <a href=\"https://godoc.org/strconv#ParseFloat\" rel=\"nofollow noreferrer\">strconv.ParseFloat</a>. Replace <a href=\"https://godoc.org/reflect#Value.SetInt\" rel=\"nofollow noreferrer\">f.SetInt(ival)</a> with <a href=\"https://godoc.org/reflect#Value.SetFloat\" rel=\"nofollow noreferrer\">f.SetFloat(fval)</a>. </p>\n\n<p>Bonus fix: Switch on <a href=\"https://godoc.org/reflect#Kind\" rel=\"nofollow noreferrer\">f.Type().Kind()</a> instead of the string.</p>\n\n<pre><code>func UnmarshalCsvRecord(readerTest *csv.Reader, v interface{}) error {\n    recordtest, err := readerTest.Read()\n    if err != nil {\n        return err\n    }\n    s := reflect.ValueOf(v).Elem()\n    if s.NumField() != len(recordtest) {\n        return &amp;CheckField{s.NumField(), len(recordtest)}\n    }\n    for i := 0; i &lt; s.NumField(); i++ {\n        f := s.Field(i)\n        switch f.Type().Kind() {\n        case reflect.String:\n            f.SetString(recordtest[i])\n        case reflect.Int:\n            ival, err := strconv.ParseInt(recordtest[i], 10, f.Type().Bits())\n            if err != nil {\n                return err\n            }\n            f.SetInt(ival)\n        case reflect.Float64:\n            fval, err := strconv.ParseFloat(recordtest[i], f.Type().Bits())\n            if err != nil {\n                return err\n            }\n            f.SetFloat(fval)\n        default:\n            return &amp;UnsupportedCheck{f.Type().String()}\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>By adding more cases, the code above can be extend to handle all integer and float types:</p>\n\n<pre><code>switch f.Type().Kind() {\n...\ncase reflect.Int, reflect.Int8, reflect.Int16, reflect.Int32, reflect.Int64:\n...\ncase reflect.Float64, reflect.Float32:\n...\n}\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 12145367, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/040c01b147377742bc4c0a072827668b?s=128&d=identicon&r=PG&f=1", "display_name": "zquee12", "link": "https://stackoverflow.com/users/12145367/zquee12"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 58807977, "answer_count": 1, "score": 1, "last_activity_date": 1573503347, "creation_date": 1573502138, "last_edit_date": 1573503347, "question_id": 58807870, "link": "https://stackoverflow.com/questions/58807870/how-to-unmarshal-float64-records-in-database-to-create-insert", "title": "How to Unmarshal float64 records in database to create insert", "body": "<p>The project I'm working on is supposed to read a file, then generate inserts based on that file.\nRight now, the script works (Kind of).\nI'm running into an issue when creating the structs for the tables, specifically for fields are float64's.\nThe script I've made accounts for fields that are type <strong>string</strong>, and <strong>int</strong>. I'm able to insert into tables that have those field types, but if there's a field in my database which is a float, the script doesn't insert any of the data.\nHere's how my script is currently set-up to check for types of int and string.</p>\n\n<pre><code>func UnmarshalCsvRecord(readerTest *csv.Reader, v interface{}) error {\n    recordtest, err := readerTest.Read()\n    if err != nil {\n        return err\n    }\n    s := reflect.ValueOf(v).Elem()\n    if s.NumField() != len(recordtest) {\n        return &amp;CheckField{s.NumField(), len(recordtest)}\n    }\n    for i := 0; i &lt; s.NumField(); i++ {\n        f := s.Field(i)\n        switch f.Type().String() {\n        case \"string\":\n            f.SetString(recordtest[i])\n        case \"int\":\n            ival, err := strconv.ParseInt(recordtest[i], 10, 0)\n            if err != nil {\n                return err\n            }\n            f.SetInt(ival)\n        default:\n            return &amp;UnsupportedCheck{f.Type().String()}\n        }\n    }\n    return nil\n}\n\ntype CheckField struct {\n    expected, found int\n}\n\nfunc (e *CheckField) Error() string {\n    return \"CSV line fields mismatch. Expected \" + strconv.Itoa(e.expected) + \" found \" + strconv.Itoa(e.found)\n}\n\ntype UnsupportedCheck struct {\n    TypeCheck string\n}\n\nfunc (e *UnsupportedCheck) Error() string {\n    return \"Unsupported type: \" + e.TypeCheck\n}\n</code></pre>\n\n<p>What can I do to account for float64 fields in my struct?</p>\n\n<pre><code>type ClientSalesTable struct {\n    ID int `csv:\"id\"`\n    Amount float64 `csv:\"amount\"`\n    ClientName string `csv:\"clientName\"`\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1573500859, "post_id": 58807520, "comment_id": 103894629, "body": "What do you mean by &quot;a banner&quot;? What are you actually trying to do here?"}, {"owner": {"reputation": 493, "user_id": 693191, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/31Xmn.jpg?s=128&g=1", "display_name": "anoopb", "link": "https://stackoverflow.com/users/693191/anoopb"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573501006, "post_id": 58807520, "comment_id": 103894683, "body": "@adrian, i&#39;m trying to see what data comes back when i connect to a port. For example: telnet server 22. Usually you&#39;ll get &quot;OpenSSH...&quot; as the banner. I&#39;m trying to capture that banner IF it exists."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 2, "creation_date": 1573501115, "post_id": 58807520, "comment_id": 103894717, "body": "Try reading it via bufio.Reader.ReadString(&#39;\\n&#39;) to read until you see a newline. You don&#39;t know how much you&#39;re going to read, you need some sort of delimiter to stop reading."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1573543790, "post_id": 58807520, "comment_id": 103905911, "body": "Your banner has len 0 so nothing will be read ever."}, {"owner": {"reputation": 493, "user_id": 693191, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/31Xmn.jpg?s=128&g=1", "display_name": "anoopb", "link": "https://stackoverflow.com/users/693191/anoopb"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1573750339, "post_id": 58807520, "comment_id": 103994769, "body": "@Volker you got it! my mistake! thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 493, "user_id": 693191, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/31Xmn.jpg?s=128&g=1", "display_name": "anoopb", "link": "https://stackoverflow.com/users/693191/anoopb"}, "edited": false, "score": 0, "creation_date": 1573749257, "post_id": 58807809, "comment_id": 103994054, "body": "I will try this and get back to you. Sorry about the delays in my reply. I will mark your answer correct shortly after i test."}, {"owner": {"reputation": 493, "user_id": 693191, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/31Xmn.jpg?s=128&g=1", "display_name": "anoopb", "link": "https://stackoverflow.com/users/693191/anoopb"}, "edited": false, "score": 0, "creation_date": 1573750373, "post_id": 58807809, "comment_id": 103994783, "body": "turns out my issue was the byte slice was of len 0. It was a typo on my part."}, {"owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "reply_to_user": {"reputation": 493, "user_id": 693191, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/31Xmn.jpg?s=128&g=1", "display_name": "anoopb", "link": "https://stackoverflow.com/users/693191/anoopb"}, "edited": false, "score": 0, "creation_date": 1574298373, "post_id": 58807809, "comment_id": 104186410, "body": "@anoopb That&#39;s one issue.  The other issue is that the code incorrectly assumes that the banner will banner will be read in a single call to Read."}], "tags": [], "owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "is_accepted": false, "score": 4, "last_activity_date": 1573501908, "creation_date": 1573501908, "answer_id": 58807809, "question_id": 58807520, "link": "https://stackoverflow.com/questions/58807520/how-to-use-conn-read-to-read-a-banner/58807809#58807809", "title": "How to use conn.read() to read a banner", "body": "<p>The answer depends on what a banner is.  </p>\n\n<p>If the banner is delimited by a distinguished byte, then use bufio.Reader to slurp up bytes to that delimiter.  Set a deadline in case the server does not respond.</p>\n\n<pre><code>conn, err := dialer.Dial(\"tcp\", connStr)\nif err != nil {\n    // handle error\n}\ndefer conn.Close()\nconn.SetReadDeadline(time.Now().Add(time.Second))\nbr := bufio.NewReader(conn)\nbanner, err := bf.ReadBytes(delim)\nif err != nil {\n     // handle error\n}\n</code></pre>\n\n<p>If the banner is not delimited in some way, then read until a timeout:</p>\n\n<pre><code>conn, err := dialer.Dial(\"tcp\", connStr)\nif err != nil {\n    // handle error\n}\ndefer conn.Close()\n\n// Read for one second or until 256 bytes are read.\nconn.SetReadDeadline(time.Now().Add(time.Second))\nbanner := make([]byte, 256)\nn, err := io.ReadFull(banner)\nbanner = banner[:n]\n</code></pre>\n"}], "owner": {"reputation": 493, "user_id": 693191, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/31Xmn.jpg?s=128&g=1", "display_name": "anoopb", "link": "https://stackoverflow.com/users/693191/anoopb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1573501908, "creation_date": 1573500696, "last_edit_date": 1573501732, "question_id": 58807520, "link": "https://stackoverflow.com/questions/58807520/how-to-use-conn-read-to-read-a-banner", "title": "How to use conn.read() to read a banner", "body": "<p>I'm using Go to connect to a random port. Let's assume it's 22 because that's a good example. Some ports have a banner, and some don't.</p>\n\n<p>I'm trying to get the banner that shows up immediately after I connect to the port. In this case <code>SSH-2.0-OpenSSH_7.9</code> but the code below doesn't really give me anything and no error. </p>\n\n<p>I'm trying to figure out where I went wrong here.</p>\n\n<pre><code>    banner := make([]byte, 0, 256)\n\n    connStr := net.JoinHostPort(host, port);\n\n    dialer := net.Dialer{Timeout: 3 * time.Second}\n\n    conn, err := dialer.Dial(\"tcp\", connStr)\n            if err != nil {\n                io.WriteString(w,err.Error())\n            } else {\n                n, err := conn.Read(banner);\n                if err != nil {\n                    log.Println(w, \"read error: %v\", err)\n                }   \n                log.Println(string(banner))\n                io.WriteString(w, \"Connected to \" +  connStr + \". \" + string(n) + \" byte output:\" + string(banner))\n                defer conn.Close()\n            } \n</code></pre>\n\n<p>Any ideas on what I'm doing wrong here? Or do I have to send something in order to get the banner?</p>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 3254551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93aa99e50e75a59b701d927d8bc713a4?s=128&d=identicon&r=PG&f=1", "display_name": "phil91", "link": "https://stackoverflow.com/users/3254551/phil91"}, "edited": false, "score": 0, "creation_date": 1573556312, "post_id": 58806289, "comment_id": 103911966, "body": "So the time information gets sent as unix timestamp and then marshalled into a go time object by the datastore client library. It&#39;s the datastore client library setting the location to the local location of the server running that code?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1573495828, "last_edit_date": 1573495828, "creation_date": 1573494613, "answer_id": 58806289, "question_id": 58805917, "link": "https://stackoverflow.com/questions/58805917/dates-locale-in-google-cloud-datastore/58806289#58806289", "title": "Dates locale in Google Cloud Datastore", "body": "<p>The datastore package sets the <a href=\"https://godoc.org/time#Time.Location\" rel=\"nofollow noreferrer\">time's location</a> to the <a href=\"https://godoc.org/time#Local\" rel=\"nofollow noreferrer\">local location</a> of the Go program.</p>\n\n<p>More details:</p>\n\n<p>Times are saved as Unix nanoseconds in the datastore service.  The location is not saved. </p>\n\n<p>The datastore package uses the <a href=\"https://godoc.org/time#Unix\" rel=\"nofollow noreferrer\">time.Unix</a> function to convert Unix nanoseconds to a <code>time.Time</code> value.  The time.Unix function sets the location to the <a href=\"https://godoc.org/time#Local\" rel=\"nofollow noreferrer\">local location</a>.</p>\n"}], "owner": {"reputation": 63, "user_id": 3254551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93aa99e50e75a59b701d927d8bc713a4?s=128&d=identicon&r=PG&f=1", "display_name": "phil91", "link": "https://stackoverflow.com/users/3254551/phil91"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 58806289, "answer_count": 1, "score": 0, "last_activity_date": 1573495828, "creation_date": 1573492757, "question_id": 58805917, "link": "https://stackoverflow.com/questions/58805917/dates-locale-in-google-cloud-datastore", "title": "Dates locale in Google Cloud Datastore", "body": "<p>I'm storing dates in Google Cloud Datastore using the Go client library. The dates are managed in the go code as time.Time type. What is a bit unclear from the documentation is how the dates are retrieved. The docs says they are retrieved as local time and my question is: \"local time of the server or the client?\"</p>\n\n<p>Also, I would expect the date to be retrieved with the same locale as saved.</p>\n"}, {"tags": ["go", "orm", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 5170, "user_id": 9200529, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LgIT2.jpg?s=128&g=1", "display_name": "Nathan V\u0113rzemnieks", "link": "https://stackoverflow.com/users/9200529/nathan-v%c4%93rzemnieks"}, "is_accepted": false, "score": 1, "last_activity_date": 1573541664, "last_edit_date": 1573541664, "creation_date": 1573503913, "answer_id": 58808225, "question_id": 58805260, "link": "https://stackoverflow.com/questions/58805260/simplest-way-to-detect-if-any-model-value-has-changed/58808225#58808225", "title": "Simplest way to detect if any model value has changed", "body": "<p>I don't know if this is the simplest way, and <a href=\"https://go-proverbs.github.io/\" rel=\"nofollow noreferrer\">it is probably not idiomatic</a>, but you can accomplish this with reflection. The following function uses the <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">reflect Package</a> to compare two <code>Person</code> structs to see if their values for each field are the same, skipping the <code>Model</code> struct (whose internals vary independently of the data element the <code>Person</code> represents).</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (this Person) Equals(that Person) bool {\n    vThis := reflect.ValueOf(this)\n    vThat := reflect.ValueOf(that)\n    for i := 0; i &lt; vThis.NumField(); i++ {\n        if vThis.Field(i) != vThis.FieldByName(\"Model\") {\n            if vThis.Field(i).Interface() != vThat.Field(i).Interface() {\n                return false\n            }\n        }       \n    }\n    return true\n}\n</code></pre>\n\n<p>You could use this in your code snippet then as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if !person.Equals(body.Person) {\n  // Trigger API update\n}\n</code></pre>\n\n<p>Note that I'm quite new to go, so I may be leading you astray here in terms of \"proper\" code. But this does work.</p>\n"}], "owner": {"reputation": 2648, "user_id": 1029654, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/11d1ed3a2d884420ff403355cd257814?s=128&d=identicon&r=PG", "display_name": "fonini", "link": "https://stackoverflow.com/users/1029654/fonini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1573541664, "creation_date": 1573490123, "question_id": 58805260, "link": "https://stackoverflow.com/questions/58805260/simplest-way-to-detect-if-any-model-value-has-changed", "title": "Simplest way to detect if any model value has changed", "body": "<p>I'm using <a href=\"http://gorm.io/\" rel=\"nofollow noreferrer\">gorm</a> as a Golang ORM. I need to detect if any model field has changed to trigger a update on a thirdy-party API service.</p>\n\n<p>I have tried to test every field with an If statement, but it gets ugly when the model has many fields.</p>\n\n<pre><code>var person Person\n\ndb.Where(\"id = ?\", id).First(&amp;person)\n\nif person.Name != body.Person.Name || person.Age != body.Person.Age {\n  // Trigger API update\n}\n\ndb.Save(&amp;person)\n</code></pre>\n\n<p>Is there a easy way to achieve this?</p>\n"}, {"tags": ["go", "graphql", "prisma"], "answers": [{"comments": [{"owner": {"reputation": 4398, "user_id": 1143482, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/zBqdL.png?s=128&g=1", "display_name": "jpganz18", "link": "https://stackoverflow.com/users/1143482/jpganz18"}, "edited": false, "score": 0, "creation_date": 1573541506, "post_id": 58805072, "comment_id": 103905092, "body": "what do you mean by uppercase the variable? the allHighlights var??"}, {"owner": {"reputation": 46, "user_id": 4721935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/854b9c775650911ec9a2fdb9508f2a25?s=128&d=identicon&r=PG&f=1", "display_name": "Sefa \u015eahin", "link": "https://stackoverflow.com/users/4721935/sefa-%c5%9eahin"}, "reply_to_user": {"reputation": 4398, "user_id": 1143482, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/zBqdL.png?s=128&g=1", "display_name": "jpganz18", "link": "https://stackoverflow.com/users/1143482/jpganz18"}, "edited": false, "score": 0, "creation_date": 1573560044, "post_id": 58805072, "comment_id": 103913877, "body": "No, I mean models as <code>type HighlightItem {     Id: UUID! @id     CreatedAt: DateTime! @createdAt     UpdatedAt: DateTime! @updatedAt     LastComment: String ....</code>"}], "tags": [], "owner": {"reputation": 46, "user_id": 4721935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/854b9c775650911ec9a2fdb9508f2a25?s=128&d=identicon&r=PG&f=1", "display_name": "Sefa \u015eahin", "link": "https://stackoverflow.com/users/4721935/sefa-%c5%9eahin"}, "is_accepted": false, "score": 0, "last_activity_date": 1573489390, "creation_date": 1573489390, "answer_id": 58805072, "question_id": 58804933, "link": "https://stackoverflow.com/questions/58804933/why-i-cannot-fetch-related-fields-on-my-prisma-query-with-my-go-client/58805072#58805072", "title": "why I cannot fetch related fields on my prisma query with my GO client?", "body": "<p>This problem can be about capitalize variable names. Can you do uppercase first letter of variables?</p>\n"}], "owner": {"reputation": 4398, "user_id": 1143482, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/zBqdL.png?s=128&g=1", "display_name": "jpganz18", "link": "https://stackoverflow.com/users/1143482/jpganz18"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 195, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1573489390, "creation_date": 1573488859, "last_edit_date": 1573489299, "question_id": 58804933, "link": "https://stackoverflow.com/questions/58804933/why-i-cannot-fetch-related-fields-on-my-prisma-query-with-my-go-client", "title": "why I cannot fetch related fields on my prisma query with my GO client?", "body": "<p>I am very very new in Prisma but so far I managed to do queries and map it using graphql, but then I noticed that I was not fetching the whole information.</p>\n\n<p>Here is what I have.</p>\n\n<p>I have a table called Highlight</p>\n\n<p>The table has a relation to HighlightItems  (that is a wrapper to fetch a postId, number of votes , etc, etc)</p>\n\n<p>so I mapped my prisma objects and seem to be working...</p>\n\n<p>I have this in my datamodel.prisma</p>\n\n<pre><code>type Highlight {\n    id: UUID! @id\n    highlightId: String! @unique\n    createdAt: DateTime! @createdAt\n    updatedAt: DateTime! @updatedAt\n    highlightItems: [HighlightItem!]! \n      @relation(\n        link: TABLE\n        name: \"HighlightItemByHighlight\"\n        onDelete: CASCADE\n      )\n</code></pre>\n\n<p>and at my HighlightItem</p>\n\n<pre><code>type HighlightItem {\n    id: UUID! @id\n    createdAt: DateTime! @createdAt\n    updatedAt: DateTime! @updatedAt\n    lastComment: String ....\n</code></pre>\n\n<p>I was able to generate the prisma model and use the generated mutations:</p>\n\n<pre><code>mutation {\n  createHighlight(....\n</code></pre>\n\n<p>and I am able to query directly the prismadb with the queries:</p>\n\n<pre><code>query {\n  highlights{\n    highlightId, highlightItems{id}\n  }\n}\n</code></pre>\n\n<p>Now I have the issue when working with my GO resolver </p>\n\n<p>when I do this:</p>\n\n<pre><code>func (r *queryResolver) Highlights(ctx context.Context, first, last *int, before, after, search *string, input string, input2 string ) (*models.Highlights, error) {\n\n\n    allHighligts, err := prisma.Instance.Highlights(\n        &amp;prisma.HighlightsParams{\n\n        }).Exec(ctx)\n       ....\n</code></pre>\n\n<p>Then I realize that I cannot get the <code>HighlightItems</code> <strong>through</strong> Highlight, checked the document on the prisma client for GO and it should use the <code>\"fluent API\"</code> </p>\n\n<p><a href=\"https://www.prisma.io/docs/prisma-client/basic-data-access/reading-data-GO-go05/#relations\" rel=\"nofollow noreferrer\">https://www.prisma.io/docs/prisma-client/basic-data-access/reading-data-GO-go05/#relations</a></p>\n\n<p>but so far I am not able to fetch them, any idea what Im doing wrong?</p>\n"}, {"tags": ["email", "go", "smtp"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1573492816, "post_id": 58804817, "comment_id": 103891575, "body": "Looks like fully encrypted connections aren&#39;t supported by this server. Try <a href=\"https://golang.org/pkg/net/smtp/#Client.StartTLS\" rel=\"nofollow noreferrer\">StartTLS</a>."}, {"owner": {"reputation": 15416, "user_id": 2441637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z8fpp.jpg?s=128&g=1", "display_name": "Hasan A Yousef", "link": "https://stackoverflow.com/users/2441637/hasan-a-yousef"}, "edited": false, "score": 0, "creation_date": 1603365952, "post_id": 58804817, "comment_id": 114017636, "body": "Did you get it working, none of the below answers worked with me!"}], "answers": [{"comments": [{"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "edited": false, "score": 0, "creation_date": 1573493824, "post_id": 58805958, "comment_id": 103891959, "body": "Thanks, I&#39;m actually seeing the same error with the startTLS method and removing the InscureSkipVerify line from the tlsConfig object:"}, {"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "edited": false, "score": 0, "creation_date": 1573493829, "post_id": 58805958, "comment_id": 103891963, "body": "c, err := smtp.NewClient(conn, host) \tif err != nil { \t\tfmt.Println(&quot;smtp.NewClient Error: %s&quot;, err) \t} \tc.StartTLS(tlsconfig)"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "edited": false, "score": 2, "creation_date": 1573493934, "post_id": 58805958, "comment_id": 103892003, "body": "@SuperSecretAndHiddenFromWork, double check that you replaced tls.Dial with net.Dial."}, {"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "edited": false, "score": 0, "creation_date": 1573494402, "post_id": 58805958, "comment_id": 103892178, "body": "Thanks both for your help so far on this, i&#39;m now on the Auth trouble stage of this mess. I believe that O365 doesn&#39;t support smtp.PlainAuth() so i&#39;m hunting for what I should be setting here"}], "tags": [], "owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "is_accepted": false, "score": 2, "last_activity_date": 1573492956, "creation_date": 1573492956, "answer_id": 58805958, "question_id": 58804817, "link": "https://stackoverflow.com/questions/58804817/setting-up-standard-go-net-smtp-with-office-365-fails-with-error-tls-first-rec/58805958#58805958", "title": "Setting up standard Go net/smtp with Office 365 fails with &quot;Error tls: first record does not look like a TLS handshake&quot;", "body": "<p>The error message <code>Error: tls: first record does not look like a TLS handshake</code> is telling you what the problem is :-). If you try connecting to the server, you will see that (as any SMTP servers) it uses plain text:</p>\n\n<pre><code>telnet smtp.office365.com 587\nTrying 2603:1026:c0b:10::2...\nConnected to zrh-efz.ms-acdc.office.com.\nEscape character is '^]'.\n220 ZRAP278CA0003.outlook.office365.com Microsoft ESMTP MAIL Service ready at Mon, 11 Nov 2019 17:13:50 +0000\n...\n</code></pre>\n\n<p>You need to use the <code>STARTTLS</code> command, see <a href=\"https://en.wikipedia.org/wiki/Opportunistic_TLS\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Opportunistic_TLS</a> (and the RFCs pointed by that wiki page).</p>\n\n<p>In Go, it is <a href=\"https://golang.org/pkg/net/smtp/#Client.StartTLS\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/smtp/#Client.StartTLS</a>.</p>\n\n<p>In your code I noticed</p>\n\n<pre><code>tlsconfig := &amp;tls.Config{\n    InsecureSkipVerify: true,   &lt;== REMOVE THIS\n    ServerName:         host,\n}\n</code></pre>\n\n<p>Please remove the <code>InsecureSkipVerify</code>, it is, as the name implies, insecure and has nothing to do with the error you are facing.</p>\n"}, {"comments": [{"owner": {"reputation": 15416, "user_id": 2441637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z8fpp.jpg?s=128&g=1", "display_name": "Hasan A Yousef", "link": "https://stackoverflow.com/users/2441637/hasan-a-yousef"}, "edited": false, "score": 1, "creation_date": 1603365256, "post_id": 58821282, "comment_id": 114017337, "body": "<code>host</code> is undeclared!!"}], "tags": [], "owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "is_accepted": true, "score": -1, "last_activity_date": 1573570846, "creation_date": 1573570846, "answer_id": 58821282, "question_id": 58804817, "link": "https://stackoverflow.com/questions/58804817/setting-up-standard-go-net-smtp-with-office-365-fails-with-error-tls-first-rec/58821282#58821282", "title": "Setting up standard Go net/smtp with Office 365 fails with &quot;Error tls: first record does not look like a TLS handshake&quot;", "body": "<p>So the issue was all about authorisation. Firstly requiring that I use the StartTLS method on the client, and also that I write a function and methods to support LOGIN, something that the standard Go library doesn't support (for whatever reason)</p>\n\n<p>See the functions and struct above the main()</p>\n\n<p>Here's the full code, with the helper function, that can now successfully send an email through my O365 account:</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n\"net\"\n\"errors\"\nmail \"net/mail\"\nsmtp \"net/smtp\"\n)\n\ntype loginAuth struct {\n    username, password string\n}\n\nfunc LoginAuth(username, password string) smtp.Auth {\n    return &amp;loginAuth{username, password}\n}\n\nfunc (a *loginAuth) Start(server *smtp.ServerInfo) (string, []byte, error) {\n    return \"LOGIN\", []byte{}, nil\n}\n\nfunc (a *loginAuth) Next(fromServer []byte, more bool) ([]byte, error) {\n    if more {\n        switch string(fromServer) {\n        case \"Username:\":\n            return []byte(a.username), nil\n        case \"Password:\":\n            return []byte(a.password), nil\n        default:\n            return nil, errors.New(\"Unknown fromServer\")\n        }\n    }\n    return nil, nil\n}\n\nfunc main() {\n\nfrom := mail.Address{\"\", \"example@example.com\"}\nto := mail.Address{\"\", \"example@example.com\"}\nsubject := \"My test subject\"\nbody := \"Test email body\"\n\nheaders := make(map[string]string)\nheaders[\"From\"] = from.String()\nheaders[\"To\"] = to.String()\nheaders[\"Subject\"] = subject\n\nmessage := \"\"\nfor k, v := range headers {\n    message += fmt.Sprintf(\"%s: %s\\r\\n\", k, v)\n}\nmessage += \"\\r\\n\" + body\n\ntlsconfig := &amp;tls.Config{\n    ServerName:         host,\n}\n\nconn, err := tls.Dial(\"tcp\", \"smtp.office365.com:587\", tlsconfig)\nif err != nil {\n    fmt.Println(\"tls.Dial Error: \", err)\n}\n\nc, err := smtp.NewClient(conn, host)\nif err != nil {\n    fmt.Println(\"smtp.NewClient Error: \", err)\n}\n\n\nif err = c.Auth(LoginAuth(\"example@example.com\", \"password\")); err != nil {\n        fmt.Println(\"c.Auth Error: \", err)\n        return\n}\n\nif err = c.Mail(from.Address); err != nil {\n    fmt.Println(\"c.Mail Error: \", err)\n}\n\nif err = c.Rcpt(to.Address); err != nil {\n    fmt.Println(\"c.Rcpt Error: \", err)\n}\n\nw, err := c.Data()\nif err != nil {\n    fmt.Println(\"c.Data Error: \", err)\n}\n\n_, err = w.Write([]byte(message))\nif err != nil {\n    fmt.Println(\"Error: \", err)\n}\n\nerr = w.Close()\nif err != nil {\n    fmt.Println(\"reader Error: \", err)\n}\n\nc.Quit()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 14132063, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13a94cf6fafefbce499d50e78862f42f?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Chen", "link": "https://stackoverflow.com/users/14132063/joe-chen"}, "is_accepted": false, "score": 1, "last_activity_date": 1597847037, "creation_date": 1597847037, "answer_id": 63489131, "question_id": 58804817, "link": "https://stackoverflow.com/questions/58804817/setting-up-standard-go-net-smtp-with-office-365-fails-with-error-tls-first-rec/63489131#63489131", "title": "Setting up standard Go net/smtp with Office 365 fails with &quot;Error tls: first record does not look like a TLS handshake&quot;", "body": "<ol>\n<li>Outlook.com no longer supports AUTH PLAIN authentication since August 2017.</li>\n</ol>\n<p><a href=\"https://support.microsoft.com/en-us/office/outlook-com-no-longer-supports-auth-plain-authentication-07f7d5e9-1697-465f-84d2-4513d4ff0145?ui=en-us&amp;rs=en-us&amp;ad=us\" rel=\"nofollow noreferrer\">https://support.microsoft.com/en-us/office/outlook-com-no-longer-supports-auth-plain-authentication-07f7d5e9-1697-465f-84d2-4513d4ff0145?ui=en-us&amp;rs=en-us&amp;ad=us</a></p>\n<ol start=\"2\">\n<li>Use AUTH LOGIN</li>\n</ol>\n<p>The following codes implement AUTH LOGIN</p>\n<pre><code>type loginAuth struct {\n    username, password string\n}\n\nfunc LoginAuth(username, password string) smtp.Auth {\n    return &amp;loginAuth{username, password}\n}\n\n\nfunc (a *loginAuth) Start(server *smtp.ServerInfo) (string, []byte, error) {\n    return &quot;LOGIN&quot;, []byte(a.username), nil\n}\n\n\nfunc (a *loginAuth) Next(fromServer []byte, more bool) ([]byte, error) {\n    if more {\n        switch string(fromServer) {\n        case &quot;Username:&quot;:\n            return []byte(a.username), nil\n        case &quot;Password:&quot;:\n            return []byte(a.password), nil\n        default:\n            return nil, errors.New(&quot;Unknown from server&quot;)\n        }\n    }\n    return nil, nil\n}\n</code></pre>\n<ol start=\"3\">\n<li>remove &quot;InsecureSkipVerify: true&quot;</li>\n</ol>\n<pre><code>tlsconfig := &amp;tls.Config {\n    ServerName: host,\n}\n</code></pre>\n<ol start=\"4\">\n<li>don't use tsl.Dial(), use net.Dial()</li>\n</ol>\n<pre><code>conn, err := net.Dial(&quot;tcp&quot;, &quot;smtp.office365.com:587&quot;)\nif err != nil {\n    return err\n}\n</code></pre>\n<ol start=\"5\">\n<li>call StartTLS() after smtp.NewClient()</li>\n</ol>\n<pre><code>c, err := smtp.NewClient(conn, host)\nif err != nil {\n    return err\n}\n\nif err = c.StartTLS(tlsconfig); err != nil {\n    return err\n}\n</code></pre>\n<ol start=\"6\">\n<li>use AUTH LOGIN</li>\n</ol>\n<pre><code>auth := LoginAuth(fromAddress, password) \n\nif err = c.Auth(auth); err != nil {\n    return err\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 15416, "user_id": 2441637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z8fpp.jpg?s=128&g=1", "display_name": "Hasan A Yousef", "link": "https://stackoverflow.com/users/2441637/hasan-a-yousef"}, "is_accepted": false, "score": 1, "last_activity_date": 1603368626, "creation_date": 1603368626, "answer_id": 64481935, "question_id": 58804817, "link": "https://stackoverflow.com/questions/58804817/setting-up-standard-go-net-smtp-with-office-365-fails-with-error-tls-first-rec/64481935#64481935", "title": "Setting up standard Go net/smtp with Office 365 fails with &quot;Error tls: first record does not look like a TLS handshake&quot;", "body": "<p>Below worked fine with me:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;bytes&quot;\n    &quot;crypto/tls&quot;\n    &quot;errors&quot;\n    &quot;fmt&quot;\n    &quot;net&quot;\n    &quot;net/smtp&quot;\n    &quot;text/template&quot;\n)\n\ntype loginAuth struct {\n    username, password string\n}\n\nfunc LoginAuth(username, password string) smtp.Auth {\n    return &amp;loginAuth{username, password}\n}\n\nfunc (a *loginAuth) Start(server *smtp.ServerInfo) (string, []byte, error) {\n    return &quot;LOGIN&quot;, []byte(a.username), nil\n}\n\nfunc (a *loginAuth) Next(fromServer []byte, more bool) ([]byte, error) {\n    if more {\n        switch string(fromServer) {\n        case &quot;Username:&quot;:\n            return []byte(a.username), nil\n        case &quot;Password:&quot;:\n            return []byte(a.password), nil\n        default:\n            return nil, errors.New(&quot;Unknown from server&quot;)\n        }\n    }\n    return nil, nil\n}\n\nfunc main() {\n\n    // Sender data.\n    from := &quot;O365 logging name&quot;\n    password := &quot;O365 logging pasword&quot;\n\n    // Receiver email address.\n    to := []string{\n        &quot;receiver email&quot;,\n    }\n\n    // smtp server configuration.\n    smtpHost := &quot;smtp.office365.com&quot;\n    smtpPort := &quot;587&quot;\n\n    conn, err := net.Dial(&quot;tcp&quot;, &quot;smtp.office365.com:587&quot;)\n    if err != nil {\n        println(err)\n    }\n\n    c, err := smtp.NewClient(conn, smtpHost)\n    if err != nil {\n        println(err)\n    }\n\n    tlsconfig := &amp;tls.Config{\n        ServerName: smtpHost,\n    }\n\n    if err = c.StartTLS(tlsconfig); err != nil {\n        println(err)\n    }\n\n    auth := LoginAuth(from, password)\n\n    if err = c.Auth(auth); err != nil {\n        println(err)\n    }\n\n    t, _ := template.ParseFiles(&quot;template.html&quot;)\n\n    var body bytes.Buffer\n\n    mimeHeaders := &quot;MIME-version: 1.0;\\nContent-Type: text/html; charset=\\&quot;UTF-8\\&quot;;\\n\\n&quot;\n    body.Write([]byte(fmt.Sprintf(&quot;Subject: This is a test subject \\n%s\\n\\n&quot;, mimeHeaders)))\n\n    t.Execute(&amp;body, struct {\n        Name    string\n        Message string\n    }{\n        Name:    &quot;Hasan Yousef&quot;,\n        Message: &quot;This is a test message in a HTML template&quot;,\n    })\n\n    // Sending email.\n    err = smtp.SendMail(smtpHost+&quot;:&quot;+smtpPort, auth, from, to, body.Bytes())\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(&quot;Email Sent!&quot;)\n}\n</code></pre>\n<p>With the below template as bonus :)</p>\n<pre><code>&lt;!-- template.html --&gt;\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;body&gt;\n    &lt;h3&gt;Name:&lt;/h3&gt;&lt;span&gt;{{.Name}}&lt;/span&gt;&lt;br/&gt;&lt;br/&gt;\n    &lt;h3&gt;Email:&lt;/h3&gt;&lt;span&gt;{{.Message}}&lt;/span&gt;&lt;br/&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"}], "owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1297, "favorite_count": 1, "accepted_answer_id": 58821282, "answer_count": 4, "score": 0, "last_activity_date": 1603368626, "creation_date": 1573488383, "question_id": 58804817, "link": "https://stackoverflow.com/questions/58804817/setting-up-standard-go-net-smtp-with-office-365-fails-with-error-tls-first-rec", "title": "Setting up standard Go net/smtp with Office 365 fails with &quot;Error tls: first record does not look like a TLS handshake&quot;", "body": "<p>I'm trying to create a simple Go emailing service using the default Go packages net/smtp - I know there's gomailer, but i'd like to use the standard library</p>\n\n<p>I need help with configuring the tls/server setting to work with <strong>Office365</strong></p>\n\n<p>I believe that I have the correct host:</p>\n\n<pre><code>smtp.office365.com:587\n</code></pre>\n\n<p>From copying the documentation for smtp that Microsoft provide, however, I get the following error in my console when running the below code:</p>\n\n<p><strong>Error: tls: first record does not look like a TLS handshake\npanic: runtime error: invalid memory address or nil pointer dereference</strong></p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n\"net\"\nmail \"net/mail\"\nsmtp \"net/smtp\"\n)\n\nfunc main() {\n\nfrom := mail.Address{\"\", \"example@example.com\"}\nto := mail.Address{\"\", \"example@example.com\"}\nsubject := \"My test subject\"\nbody := \"Test email body\"\n\n// Setup email headers\nheaders := make(map[string]string)\nheaders[\"From\"] = from.String()\nheaders[\"To\"] = to.String()\nheaders[\"Subject\"] = subject\n\nmessage := \"\"\nfor k, v := range headers {\n    message += fmt.Sprintf(\"%s: %s\\r\\n\", k, v)\n}\nmessage += \"\\r\\n\" + body\n\nservername := \"smtp.office365.com:587\"\nhost, _, _ := net.SplitHostPort(servername)\n\nauth := smtp.PlainAuth(\"\", \"example@example.com\", \"password\", host)\n\ntlsconfig := &amp;tls.Config{\n    InsecureSkipVerify: true,\n    ServerName:         host,\n}\n\nconn, err := tls.Dial(\"tcp\", \"smtp.office365.com:587\", tlsconfig)\nif err != nil {\n    fmt.Println(\"tls.Dial Error: %s\", err)\n}\n\nc, err := smtp.NewClient(conn, host)\nif err != nil {\n    fmt.Println(\"smtp.NewClient Error: %s\", err)\n}\n\nif err = c.Auth(auth); err != nil {\n    fmt.Println(\"c.Auth Error: %s\", err)\n}\n\nif err = c.Mail(from.Address); err != nil {\n    fmt.Println(\"c.Mail Error: %s\", err)\n}\n\nif err = c.Rcpt(to.Address); err != nil {\n    fmt.Println(\"c.Rcpt Error: %s\", err)\n}\n\nw, err := c.Data()\nif err != nil {\n    fmt.Println(\"c.Data Error: %s\", err)\n}\n\n_, err = w.Write([]byte(message))\nif err != nil {\n    fmt.Println(\"Error: %s\", err)\n}\n\nerr = w.Close()\nif err != nil {\n    fmt.Println(\"reader Error: %s\", err)\n}\n\nc.Quit()\n}\n</code></pre>\n\n<p>Any examples of an O365 client will be appreciated, or anything that anyone can spot that seems suspect will be great</p>\n\n<p>Thanks</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 1, "last_activity_date": 1573517536, "creation_date": 1573517536, "answer_id": 58810283, "question_id": 58804721, "link": "https://stackoverflow.com/questions/58804721/go-mongodb-driver-ignores-pipeline-in-aggregation/58810283#58810283", "title": "Go mongodb driver ignores pipeline in aggregation", "body": "<blockquote>\n  <p>I don't know what I am missing but shouldn't I get the grouped results?</p>\n</blockquote>\n\n<p>There are few things to point out here. The code example uses <code>github.com/simagix/keyhole/mdb</code> module for <a href=\"https://github.com/simagix/keyhole/blob/v1.3.0/mdb/pipeline.go#L14\" rel=\"nofollow noreferrer\">MongoPipeline</a>. This function is supposed to take your string formatted MongoDB pipeline <code>$group</code> and converts into <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson\" rel=\"nofollow noreferrer\">bson</a>. This is a format that <a href=\"https://godoc.org/go.mongodb.org/mongo-driver\" rel=\"nofollow noreferrer\">mongo-go-driver</a> uses to send to MongoDB server. </p>\n\n<p>Unfortunately the <code>MongoPipeline</code> function does not return any <code>error</code> that your code could catch, but the function is using <code>encoding/json</code> module to convert the pipeline into <code>bson</code>, and there are errors. The JSON parse errors that you're getting are:</p>\n\n<ul>\n<li><code>invalid character '$' looking for beginning of object key string</code> => Because keys need to be wrapped with <code>\"</code></li>\n<li><code>invalid character '}' looking for beginning of object key string</code> => Because there are extra comma(s) after <code>}</code>. </li>\n</ul>\n\n<p>Due to these errors the <code>MongoPipeline</code> returns empty array <code>[]</code>, which means undefined Aggregation Pipeline, and will return all documents in the collection. </p>\n\n<p>The correct pipeline JSON string is (you can use <a href=\"https://jsonlint.com\" rel=\"nofollow noreferrer\">jsonlint.com</a> to validate)</p>\n\n<pre><code>[{\n    \"$group\": {\n        \"_id\": {\n            \"year\": {\n                \"$year\": \"$action_date\"\n            },\n            \"month\": {\n                \"$month\": \"$action_date\"\n            },\n            \"day\": {\n                \"$dayOfMonth\": \"$action_date\"\n            }\n        },\n        \"count\": {\n            \"$sum\": 1\n        }\n    }\n}]\n</code></pre>\n\n<p>Depending on your use case, you can skip the <code>keyhole/mdb</code> and <code>encoding/json</code> modules, and use <code>bson</code> directly. For example: </p>\n\n<pre><code>groupStage := `{\n    \"$group\": {\n        \"_id\": {\n            \"year\": { \"$year\": \"$action_date\" },\n            \"month\": { \"$month\": \"$action_date\" },\n            \"day\": { \"$dayOfMonth\": \"$action_date\" }\n        },\n        \"count\": { \"$sum\": 1 }\n    }\n}`\n\n\nvar group bson.M \nerr = bson.UnmarshalExtJSON([]byte(groupStage), false, &amp;group)\nif err!=nil {\n    fmt.Println(err)\n}\n\nvar doc bson.M \n\n// You can add another stage i.e. bson.A{group, sort, project}\ncursor, err := collection.Aggregate(context.Background(), bson.A{group})\ndefer cursor.Close(context.Background())\nif err!=nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>Alternatively, you can also use <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo#Pipeline\" rel=\"nofollow noreferrer\">mongo.Pipeline</a> with <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson#M\" rel=\"nofollow noreferrer\">bson.M</a> or <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson#D\" rel=\"nofollow noreferrer\">bson.D</a> directly: </p>\n\n<pre><code>pipeline := mongo.Pipeline{\n        {{\"$group\", bson.D{\n                {\"_id\",   bson.D{\n                        {\"year\", bson.D{{\"$year\", \"$action_date\"}}},\n                        {\"month\", bson.D{{\"$month\", \"$action_date\"}}},\n                        {\"day\", bson.D{{\"$dayOfMonth\", \"$action_date\"}}}\n                }},\n                {\"count\", bson.D{{\"$sum\", 1}}},\n        }}},\n}\n</code></pre>\n\n<p>The example above is written with current stable <a href=\"https://godoc.org/go.mongodb.org/mongo-driver\" rel=\"nofollow noreferrer\">MongoDB Go driver</a> v1.1.3.</p>\n"}], "owner": {"reputation": 5214, "user_id": 365266, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/beab2e1ea85bfbfaadfe2b8f5b6dd1c5?s=128&d=identicon&r=PG", "display_name": "&#201;lodie Petit", "link": "https://stackoverflow.com/users/365266/%c3%89lodie-petit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 58810283, "answer_count": 1, "score": 0, "last_activity_date": 1573517536, "creation_date": 1573487943, "question_id": 58804721, "link": "https://stackoverflow.com/questions/58804721/go-mongodb-driver-ignores-pipeline-in-aggregation", "title": "Go mongodb driver ignores pipeline in aggregation", "body": "<p>Based on the example found on <a href=\"https://github.com/simagix/mongo-go-examples/blob/master/examples/aggregate_array_test.go\" rel=\"nofollow noreferrer\">https://github.com/simagix/mongo-go-examples/blob/master/examples/aggregate_array_test.go</a> I created the code below that runs a pipeline on a collection:</p>\n\n<pre><code>pipeline := `[\n    {\n        $group: {\n            _id: {\n                year: { $year: \"$action_date\" },\n                month: { $month: \"$action_date\" },\n                day: { $dayOfMonth: \"$action_date\" },\n            },\n            count: { $sum: 1 }\n        }\n    }\n]`\n\nvar doc bson.M\nvar cur *mongo.Cursor\ncollection := apiContext.MongoClient.Database(apiContext.DatabaseName).Collection(util.ActionCollection)\n\nopts := options.Aggregate()\nif cur, err = collection.Aggregate(ctx, MongoPipeline(pipeline), opts); err != nil {\n}\ndefer cur.Close(ctx)\nfor cur.Next(ctx) {\n    cur.Decode(&amp;doc)\n    fmt.Println(doc[\"count\"])\n}\n</code></pre>\n\n<p>I don't get any errors but the output is not what I expect it to be. Instead of returning count of documents based on dates, I get all of the documents in the collection.</p>\n\n<p>I don't know what I am missing but shouldn't I get the grouped results?</p>\n"}, {"tags": ["go", "process", "command"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1573488769, "post_id": 58804673, "comment_id": 103889611, "body": "There&#39;s a data race on <code>bufIn</code>.  Fix by writing the commands to <code>bufIn</code> before calling <code>cmd.Start()</code>.  What&#39;s the purpose of reading form <code>os.Stdin</code> given that the program attempts to quit before <code>os.Stdin</code> is read?"}, {"owner": {"reputation": 296, "user_id": 4932738, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/16e3461a74f7815ddef4a4a32594e8cc?s=128&d=identicon&r=PG", "display_name": "Gaulthier", "link": "https://stackoverflow.com/users/4932738/gaulthier"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1573489032, "post_id": 58804673, "comment_id": 103889745, "body": "@CeriseLim&#243;n It is just an example showing the issue. It should be possible to read from <code>os.stdin</code> or from <code>bufIn</code> before the <code>.quit</code> command. By the way, I tested to write to <code>bufIn</code> before calling cmd.Start() however I still have the issue"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1573506160, "post_id": 58804673, "comment_id": 103896601, "body": "The posted code reads from os.Stdin after issuing the <code>.quit</code> command. Use the following to execute the <code>.quit</code> command after executing <code>bufIn</code> and/or <code>os.Stdin</code>: <code>cmd.Stdin = io.MultiReader(bufIn, os.Stdin, srings.NewReader(&quot;.quit\\n&quot;))</code>. Because the command exits on EOF, there&#39;s no need to finish up with the <code>.quit</code> command. In any case, you should fix the data race."}], "answers": [{"tags": [], "owner": {"reputation": 5170, "user_id": 9200529, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LgIT2.jpg?s=128&g=1", "display_name": "Nathan V\u0113rzemnieks", "link": "https://stackoverflow.com/users/9200529/nathan-v%c4%93rzemnieks"}, "is_accepted": true, "score": 2, "last_activity_date": 1573670932, "last_edit_date": 1573670932, "creation_date": 1573584876, "answer_id": 58824956, "question_id": 58804673, "link": "https://stackoverflow.com/questions/58804673/command-requires-line-break-to-finish/58824956#58824956", "title": "Command requires line break to finish", "body": "<p>One problem is with your use of MultiReader here:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>cmd.Stdin = io.MultiReader(bufIn, os.Stdin)\n</code></pre>\n\n<p>From the <a href=\"https://golang.org/pkg/io/#MultiReader\" rel=\"nofollow noreferrer\">docs for MultiReader</a> (emphasis added):</p>\n\n<blockquote>\n  <p>MultiReader returns a Reader that's the logical concatenation of the provided input readers. <em>They're read sequentially.</em></p>\n</blockquote>\n\n<p>The other relevant info comes from <a href=\"https://golang.org/pkg/os/exec/#Cmd\" rel=\"nofollow noreferrer\">the documentation for <code>Cmd.Stdin</code></a>. It says that if <code>Stdin</code> is not <code>nil</code> or an <code>*os.File</code>, then</p>\n\n<blockquote>\n  <p>during the execution of the command a separate goroutine reads from Stdin and delivers that data to the command over a pipe. In this case, Wait does not complete until the goroutine stops copying, either because it has reached the end of Stdin (EOF or a read error) or because writing to the pipe returned an error.</p>\n</blockquote>\n\n<p>So what's happening in your program is this: <code>cmd</code>'s <code>Stdin</code>-reading goroutine goes to read from the MultiReader <code>bufIn</code>. First it reads the data you've written to <code>bufIn</code>, but then it tries to read more. The MultiReader sees that <code>bufIn</code> is exhausted and moves to <code>Read</code> its next argument, <code>os.Stdin</code>. When you call <code>cmd.Wait</code>, it blocks waiting for the MultiReader to send EOF, but the MultiReader itself is blocking trying to read from <code>os.Stdin</code>. Nothing happens until you send EOF (eg. hit ctrl-D) or hit enter. (I'm not quite sure why hitting enter works, since that wouldn't normally entail an EOF, but I'll update if I figure out the details.)</p>\n\n<p>The other problem is the race condition, as <a href=\"https://stackoverflow.com/questions/58804673/command-requires-line-break-to-finish#comment103896601_58804673\">Cerise Lim\u00f3n notes</a> - it's entirely possible for the goroutine to read from your <code>bufIn</code> before you've written to it, in which case anything you subsequently write to <code>bufIn</code> will be ignored.</p>\n\n<p>Rather than using buffers to communicate with your process, you'll be better off using <code>cmd.StdoutPipe</code> and <code>cmd.StdinPipe</code>. This doesn't solve the whole problem, though - you can't use blocking IO to communicate with a subprocess in an interactive way, because you'll end up waiting to read from a process that is waiting for you to write a command. Probably your best bet will be to use a goroutine to read from the command and use select with timeouts to read output until it's reasonably certain there's no more coming.</p>\n\n<p>Here's one implementation. It needs some fleshing out, error handling at the very least, but it works. <code>startScanner</code> sets up the goroutine to read lines from the command's output and write them to a channel. <code>readLinesFromChannelWithTimeout</code> reads from the given channel until the given timeout passes with no data. Note that you <em>must</em> call <code>cmdIn.Close()</code> before calling <code>cmd.Wait()</code> or the latter will hang indefinitely.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os/exec\"\n    \"time\"\n)\n\nfunc readLinesFromChannelWithTimeout(ch chan string, timeout time.Duration) []string {\n    var lines []string\n    for {\n        select {\n        case line, ok := &lt;-ch:\n            if !ok {\n                return lines\n            } else {\n                lines = append(lines, line)\n            }\n        case &lt;-time.After(timeout):\n            return lines\n        }\n    }\n}\n\nfunc startScanner(cmdOut io.ReadCloser) chan string {\n    ch := make(chan string)\n    go func(ch chan string) {\n        defer close(ch)\n        scanner := bufio.NewScanner(cmdOut)\n        for scanner.Scan() {\n            ch &lt;- scanner.Text()\n        }\n    }(ch)\n    return ch\n}\n\nfunc main() {\n    cmd := exec.Command(\"/usr/bin/sqlite3\")\n    cmdIn, _ := cmd.StdinPipe()\n    cmdOut, _ := cmd.StdoutPipe()\n    cmd.Start()\n\n    ch := startScanner(cmdOut)\n\n    var lines []string\n\n    io.WriteString(cmdIn, \".help\\n\")\n    lines = readLinesFromChannelWithTimeout(ch, time.Millisecond*100)\n    fmt.Printf(\"Got %d lines from .help\\n\", len(lines))\n\n    io.WriteString(cmdIn, \".show\\n\")\n    lines = readLinesFromChannelWithTimeout(ch, time.Millisecond*100)\n    fmt.Printf(\"Got %d lines from .show\\n\", len(lines))\n\n    cmdIn.Close() // vital! Wait() will hang otherwise\n    if err := cmd.Wait(); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 296, "user_id": 4932738, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/16e3461a74f7815ddef4a4a32594e8cc?s=128&d=identicon&r=PG", "display_name": "Gaulthier", "link": "https://stackoverflow.com/users/4932738/gaulthier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 58824956, "answer_count": 1, "score": 1, "last_activity_date": 1573670932, "creation_date": 1573487762, "last_edit_date": 1573495366, "question_id": 58804673, "link": "https://stackoverflow.com/questions/58804673/command-requires-line-break-to-finish", "title": "Command requires line break to finish", "body": "<p>I'm trying to run <em>sqlite3</em> as a process with Go. I would like to combine <code>cmd.Stdin</code> with <code>bytes.Buffer</code> and <code>os.Stdin</code>. Nevertheless, when I write the <code>.quit</code> command on the stdin bytes buffer, the program does not exit directly but is waiting for a line break from <code>os.stdin</code>. When it receives the line break from <code>os.stdin</code>, it thus exits.</p>\n\n<p>I tried to invoke <code>os.Stdin.Write([]byte(\"\\n\"))</code> but it didn't work. How can I exit directly after the <code>.quit</code> command without any interaction with <code>os.Stdin</code>?</p>\n\n<pre><code>func main() {\n    cmd := exec.Command(\"/usr/bin/sqlite3\")\n\n    bufOut, bufErr, bufIn := &amp;bytes.Buffer{}, &amp;bytes.Buffer{}, &amp;bytes.Buffer{}\n\n    cmd.Stdout = io.MultiWriter(bufOut, os.Stdout)\n    cmd.Stderr = io.MultiWriter(bufErr, os.Stderr)\n    cmd.Stdin = io.MultiReader(bufIn, os.Stdin)\n\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n\n    // Execute .help command on sqlite3\n    if _, err := bufIn.Write([]byte(\".help\\n\")); err != nil {\n        log.Fatal(err)\n    }\n\n    // Execute .quit command on sqlite3 (should exit here)\n    if _, err := bufIn.Write([]byte(\".quit\\n\")); err != nil {\n        log.Fatal(err)\n    }\n    // Nevertheless, it requires a '\\n' from os.Stdin before exiting\n\n    if err := cmd.Wait(); err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"out:\", bufOut.String(), \"err:\", bufErr.String())\n}\n</code></pre>\n"}, {"tags": ["go", "go-gorm", "testify", "go-sqlmock"], "answers": [{"tags": [], "owner": {"reputation": 107, "user_id": 3330421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9726b7bd711f57fb9d5573667f2e5845?s=128&d=identicon&r=PG", "display_name": "carantes", "link": "https://stackoverflow.com/users/3330421/carantes"}, "is_accepted": false, "score": 0, "last_activity_date": 1583604737, "creation_date": 1583604737, "answer_id": 60580748, "question_id": 58804606, "link": "https://stackoverflow.com/questions/58804606/go-unit-tests-call-to-database-transaction-begin-was-not-expected-error/60580748#60580748", "title": "Go unit tests - call to database transaction Begin, was not expected error", "body": "<p>You need to add <code>s.mock.ExpectBegin()</code> and <code>s.mock.ExpectCommit()</code> on <strong>Test_repository_Create</strong>:</p>\n\n<pre><code>s.mock.ExpectBegin()\ns.mock.ExpectQuery(regexp.QuoteMeta(\n        `INSERT INTO \"User\" (\"ID\",\"CountryID\") \n            VALUES ($1,$2) RETURNING \"User\".\"ID\"`)).\n        WithArgs(ID, CountryID).\n        WillReturnRows(\n            sqlmock.NewRows([]string{\"ID\"}).AddRow(strconv.Itoa(ID)))\ns.mock.ExpectCommit()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 8999466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bbb3923990758defc0e5fd10f98ddac?s=128&d=identicon&r=PG&f=1", "display_name": "Rudy Antony", "link": "https://stackoverflow.com/users/8999466/rudy-antony"}, "is_accepted": false, "score": 0, "last_activity_date": 1590059537, "creation_date": 1590059537, "answer_id": 61933191, "question_id": 58804606, "link": "https://stackoverflow.com/questions/58804606/go-unit-tests-call-to-database-transaction-begin-was-not-expected-error/61933191#61933191", "title": "Go unit tests - call to database transaction Begin, was not expected error", "body": "<p>call to database transaction Begin, was not expected error will be solved if  you update your gorm version into <strong>github.com/jinzhu/gorm v1.9.2</strong></p>\n"}], "owner": {"reputation": 1792, "user_id": 3068500, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0cf641fb92b7fd2625f7690aac7f424c?s=128&d=identicon&r=PG&f=1", "display_name": "Gambit2007", "link": "https://stackoverflow.com/users/3068500/gambit2007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1967, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1590059537, "creation_date": 1573487502, "last_edit_date": 1575365382, "question_id": 58804606, "link": "https://stackoverflow.com/questions/58804606/go-unit-tests-call-to-database-transaction-begin-was-not-expected-error", "title": "Go unit tests - call to database transaction Begin, was not expected error", "body": "<p>I'm trying to write model unit tests in Go using Data Dog's <code>go-sqlmock</code> and <code>testify</code>.</p>\n\n<p>I have the following code for that:</p>\n\n<pre><code>type Suite struct {\n    suite.Suite\n    DB *gorm.DB\n    mock sqlmock.Sqlmock\n\n    repository      Repository\n    user *models.User\n}\n\nfunc (s *Suite) SetupSuite() {\n    var (\n        db  *sql.DB\n        err error\n    )\n\n    db, s.mock, err = sqlmock.New()\n    require.NoError(s.T(), err)\n\n    s.DB, err = gorm.Open(\"mysql\", db)\n    require.NoError(s.T(), err)\n\n    s.DB.LogMode(true)\n\n    s.repository = CreateRepository(s.DB)\n}\n\nfunc (s *Suite) AfterTest(_, _ string) {\n    require.NoError(s.T(), s.mock.ExpectationsWereMet())\n}\n\nfunc TestInit(t *testing.T) {\n    suite.Run(t, new(Suite))\n}\n\nfunc (s *Suite) Test_repository_Get() {\n    var (\n        ID        = 1234\n        CountryID = 1\n    )\n\n    s.mock.ExpectQuery(regexp.QuoteMeta(\n        `SELECT * FROM \"User\" WHERE (id = $1)`)).\n        WithArgs(strconv.Itoa(ID)).\n        WillReturnRows(sqlmock.NewRows([]string{\"ID\", \"CountryID\"}).\n            AddRow(strconv.Itoa(ID), strconv.Itoa(CountryID)))\n\n    res, err := s.repository.Get(ID)\n\n    require.NoError(s.T(), err)\n    require.Nil(s.T(), deep.Equal(&amp;models.User{ID: ID, CountryID: CountryID}, res))\n}\n\nfunc (s *Suite) Test_repository_Create() {\n    var (\n        ID        = 1234\n        CountryID = 1\n    )\n\n    s.mock.ExpectQuery(regexp.QuoteMeta(\n        `INSERT INTO \"User\" (\"ID\",\"CountryID\") \n            VALUES ($1,$2) RETURNING \"User\".\"ID\"`)).\n        WithArgs(ID, CountryID).\n        WillReturnRows(\n            sqlmock.NewRows([]string{\"ID\"}).AddRow(strconv.Itoa(ID)))\n\n    err := s.repository.Create(ID, CountryID)\n\n    require.NoError(s.T(), err)\n}\n</code></pre>\n\n<p>But when i run <code>TestInit</code>, i'm getting the following error:</p>\n\n<pre><code>&gt; call to database transaction Begin, was not expected, next expectation\n&gt; is: ExpectedQuery =&gt; expecting Query, QueryContext or QueryRow which:\n&gt;   - matches sql: 'INSERT INTO \"User\" \\(\"ID\",\"CountryID\"\\)             VALUES \\(\\$1,\\$2\\) RETURNING \"User\"\\.\"ID\"'\n&gt;   - is with arguments:\n&gt;     0 - 1234\n&gt;     1 - 1\n&gt;   - should return rows:\n&gt;     row 0 - [1234] [0m\n</code></pre>\n\n<p>I have a few questions: </p>\n\n<ol>\n<li>What is the issue here? </li>\n<li>Is there a way of knowing if the <code>SetupSuite</code> function is being run?</li>\n<li>Why do i get <code>? my-project  [no test files]</code> when i run <code>go test</code>? This is the file path for the code above: <code>my-project/test/models/User_test.go</code></li>\n</ol>\n"}, {"tags": ["go", "ssl", "tls1.2"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1573484868, "post_id": 58803659, "comment_id": 103887690, "body": "If you have a server on the public Internet you have to deal with spam requests. There&#39;s really not much else to say. &quot;I don&#39;t think I need 80 to be open to anything other than Lets Encrypt traffic&quot;. Correct (if you don&#39;t need a redirect to https). Those logs are all results of TLS handshakes, though, so any kind of IP filter won&#39;t help you here. You probably <i>are</i> getting &quot;weird&quot; requests on port 80, you just don&#39;t log them."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1573484962, "post_id": 58803659, "comment_id": 103887742, "body": "The requests from 92.5.192.229 are worth investigating, because they are so regular. Some kind of health check that doesn&#39;t do SNI maybe?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1573485749, "post_id": 58803659, "comment_id": 103888135, "body": "That looks like a TCP healthcheck probe happening every 5 seconds. The healthcheck is a regular TCP connection and does not do TLS handshake, and you get these logs because of that."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1573486751, "post_id": 58803659, "comment_id": 103888623, "body": "@BurakSerdar, if it were a plain connection the error would be something like &quot;first record does not look like a TLS handshake&quot;."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1573486852, "post_id": 58803659, "comment_id": 103888672, "body": "@Peter I am observing this behavior from my servers behind a TCP load balancer on aws. The load balancer health checks are causing this."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1573489458, "post_id": 58803659, "comment_id": 103889947, "body": "@Peter, fyi, according to aws docs, TCP health check for loadbalancer only performs a tcp connection. It does not initiate a tls handshake or send any other data. That probably explains the log msg."}, {"owner": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1573496795, "post_id": 58803659, "comment_id": 103893083, "body": "@BurakSerdar unfortunately this container is not behind a load balancer, there is no health check happening as far as I am aware. The IP address is registered to TalkTalk communications so I don&#39;t think this is coming from amazon"}], "owner": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 676, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1573484428, "creation_date": 1573483826, "last_edit_date": 1573484428, "question_id": 58803659, "link": "https://stackoverflow.com/questions/58803659/acme-autocert-listener-reporting-tls-handshake-errors-from-unrecognized-hosts", "title": "acme/autocert listener reporting TLS handshake errors from unrecognized hosts", "body": "<p>I use <a href=\"https://godoc.org/golang.org/x/crypto/acme/autocert\" rel=\"nofollow noreferrer\">acme/autocert</a> to automatically handle TLS certifications for my server. It seems to have worked (in that my domain now has a valid TLS certificate), but I'm a bit confused on what else I'm seeing. My server log looks like this (note this is not the full log, just a selection):</p>\n\n<pre><code>rpc_1    | 2019/11/11 14:44:49 http: TLS handshake error from 2.51.84.126:53282: acme/autocert: host \"physicaldatebaby.org\" not configured in HostWhitelist\nrpc_1    | 2019/11/11 14:44:50 http: TLS handshake error from 92.5.192.229:47416: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:44:55 http: TLS handshake error from 92.5.192.229:47418: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:45:01 http: TLS handshake error from 92.5.192.229:47420: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:45:06 http: TLS handshake error from 92.5.192.229:47422: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:45:07 http: TLS handshake error from 197.252.5.80:48622: read tcp 192.168.208.2:443-&gt;197.252.5.80:48622: read: connection reset by peer\nrpc_1    | 2019/11/11 14:45:11 http: TLS handshake error from 92.5.192.229:47424: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:45:16 http: TLS handshake error from 197.29.217.90:51215: acme/autocert: host \"cloudfront.net\" not configured in HostWhitelist\nrpc_1    | 2019/11/11 14:45:16 http: TLS handshake error from 92.5.192.229:47426: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:45:20 http: TLS handshake error from 156.172.18.24:21209: acme/autocert: host \"paypal.com\" not configured in HostWhitelist\nrpc_1    | 2019/11/11 14:45:21 http: TLS handshake error from 92.5.192.229:47428: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:45:27 http: TLS handshake error from 92.5.192.229:47430: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:45:32 http: TLS handshake error from 92.5.192.229:47432: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:45:37 http: TLS handshake error from 92.5.192.229:47434: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:45:42 http: TLS handshake error from 92.5.192.229:47436: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:45:47 http: TLS handshake error from 92.5.192.229:47438: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:45:52 http: TLS handshake error from 92.5.192.229:47440: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:45:58 http: TLS handshake error from 92.5.192.229:47442: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:46:03 http: TLS handshake error from 92.5.192.229:47444: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:46:08 http: TLS handshake error from 92.5.192.229:47446: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:46:13 http: TLS handshake error from 92.5.192.229:47448: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:46:14 http: TLS handshake error from 197.29.217.90:51572: acme/autocert: host \"cloudfront.net\" not configured in HostWhitelist\nrpc_1    | 2019/11/11 14:46:18 http: TLS handshake error from 92.5.192.229:47450: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:46:24 http: TLS handshake error from 92.5.192.229:47452: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:46:29 http: TLS handshake error from 92.5.192.229:47454: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:46:34 http: TLS handshake error from 92.5.192.229:47456: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:46:39 http: TLS handshake error from 92.5.192.229:47458: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:46:44 http: TLS handshake error from 92.5.192.229:47460: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:46:49 http: TLS handshake error from 92.5.192.229:47462: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:46:55 http: TLS handshake error from 92.5.192.229:47464: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:47:00 http: TLS handshake error from 92.5.192.229:47466: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:47:05 http: TLS handshake error from 92.5.192.229:47468: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:47:10 http: TLS handshake error from 92.5.192.229:47470: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:47:15 http: TLS handshake error from 92.5.192.229:47472: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:47:21 http: TLS handshake error from 92.5.192.229:47474: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:47:26 http: TLS handshake error from 92.5.192.229:47476: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:47:31 http: TLS handshake error from 92.5.192.229:47478: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:47:36 http: TLS handshake error from 92.5.192.229:47480: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:47:37 http: TLS handshake error from 197.149.220.123:31754: acme/autocert: host \"cloudfront.net\" not configured in HostWhitelist\nrpc_1    | 2019/11/11 14:47:41 http: TLS handshake error from 92.5.192.229:47482: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:47:47 http: TLS handshake error from 92.5.192.229:47484: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:47:52 http: TLS handshake error from 92.5.192.229:47486: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:47:57 http: TLS handshake error from 92.5.192.229:47488: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:48:02 http: TLS handshake error from 92.5.192.229:47490: acme/autocert: missing server name\nrpc_1    | 2019/11/11 14:48:07 http: TLS handshake error from 92.5.192.229:47492: acme/autocert: missing server name\n</code></pre>\n\n<p>What is happening here? I want to leave this listener running so that my certificate renews but I'm worried about that log. I don't understand why those requests are coming through or how I can stop them. I've searched around but haven't been able to find any similar questions. These requests are not spawned from any clients I recognize, and one seems to be simply trying every single port it can from the same IP. I really don't know if this is appropriate for a production server, everything is up to date (it's running in the latest amazon EC2 ami) so I'm not sure if I'm at risk or need to take other measures. I'm a bit confused in general so I hope I can get some feedback to help cleanup this question.</p>\n\n<p>My relevant Go code looks like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nvar endpoint = flag.String(\n    \"endpoint\",\n    os.Getenv(\"SERVER_ENDPOINT\"),\n    \"Overwrite default endpoint defined in environment variables\",\n)\n\ncertManager := autocert.Manager{\n    Prompt:     autocert.AcceptTOS,\n    HostPolicy: autocert.HostWhitelist(*endpoint),\n    Cache:      autocert.DirCache(\"certs\"),\n}\n\n// certManager.Listener() listens on 443\ngo http.Serve(certManager.Listener(), certManager.HTTPHandler(nil))\n</code></pre>\n\n<p>I have both port 80 and port 443 open to all inbound traffic, though I don't think I need 80 to be open to anything other than Lets Encrypt traffic (I think, my understanding of how Lets Encrypt works might be wrong?)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1573482731, "post_id": 58803302, "comment_id": 103886544, "body": "The same: Recover from panic. It also send false on the provided channel. Nothing special to see here."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1573484824, "post_id": 58803302, "comment_id": 103887670, "body": "One more note: If you are new to Go: Keep away from recover. Newcomers tend to think recovering is something common on Go. It s not. It is available for some rare cases. I hope this answers 2: It does not matter how complicated wrapping a function is as you do not do it."}, {"owner": {"reputation": 579, "user_id": 3794343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9J3pf.png?s=128&g=1", "display_name": "ferralucho", "link": "https://stackoverflow.com/users/3794343/ferralucho"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1573496010, "post_id": 58803302, "comment_id": 103892784, "body": "great, thanks for the explanation, I won&#39;t use recover then"}], "answers": [{"tags": [], "owner": {"reputation": 1558, "user_id": 11265949, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x7xqr.png?s=128&g=1", "display_name": "filipe", "link": "https://stackoverflow.com/users/11265949/filipe"}, "is_accepted": true, "score": 1, "last_activity_date": 1573552157, "last_edit_date": 1573552157, "creation_date": 1573544072, "answer_id": 58813967, "question_id": 58803302, "link": "https://stackoverflow.com/questions/58803302/recovering-panic-with-wrapper-in-go/58813967#58813967", "title": "Recovering panic with wrapper in Go", "body": "<p>When implementing long-running processes, it's possible that certain code paths will result in a panic. This is usually common for things such as uninitialized maps and pointers, as well as division by zero problems in the case of poorly validated user input.</p>\n\n<p>Having a program crash completely in these cases is frequently much worse than the panic itself, and so it can be helpful to catch and handle panics.</p>\n\n<p>In most web applications, it's common to catch panics and emit an http.InternalServerError message when a panic occurs.</p>\n\n<p>Within the recover, you can, essentially, do anything you want, although emitting a log is common.</p>\n\n<p><strong>1) Wrap with Signal can be used to recover from panic and send a signal to the given bool channel.</strong></p>\n\n<p>The warp with signal function implements the wrap pattern and can be used to wrap a signal channel and emit an event to the channel even when a panic occurs. In this case, if the recover was not called, you would get a deadlock.</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    signal:= make(chan bool)\n    go WrapWithSignal(play, signal)()\n\n    if &lt;-signal{\n        fmt.Println(\"Congratulations, you win!\")\n        return\n    }\n\n    fmt.Println(\"You died.\")\n}\n\nfunc play(signal chan bool){\n    fmt.Println(\"Playing russian roulette\")\n    rand.Seed(time.Now().UnixNano())\n\n    if rand.Intn(2) == 1{\n        panic(errors.New(\"got a bullet\"))\n    }\n\n    signal &lt;- true\n}\n</code></pre>\n\n<p><strong>2) Is there another way to wrap functions in order to recover that is less verbose?</strong></p>\n\n<p>Short answer: NO, unless you use a package. A package theoretically is always less verbose.</p>\n\n<p>Long answer: Depending the situation, you can for example, create a go routine wrapper and create your own panic group based on a waiting group. It can be useful while validating user input or doing concurrent operations and collect all the errors at the end. Split it into a package and you will get verbosity.</p>\n\n<p>Just a sample: <a href=\"https://play.golang.org/p/on9AwZkvyIZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/on9AwZkvyIZ</a></p>\n"}], "owner": {"reputation": 579, "user_id": 3794343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9J3pf.png?s=128&g=1", "display_name": "ferralucho", "link": "https://stackoverflow.com/users/3794343/ferralucho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 0, "accepted_answer_id": 58813967, "answer_count": 1, "score": 0, "last_activity_date": 1614864635, "creation_date": 1573482520, "last_edit_date": 1614864635, "question_id": 58803302, "link": "https://stackoverflow.com/questions/58803302/recovering-panic-with-wrapper-in-go", "title": "Recovering panic with wrapper in Go", "body": "<p>I have came across the following code that manages recover from panic using a wrapper. I understand that panic don't propagate across goroutines and they have to be managed independently, so it needs to be handled in the goroutine where the panic occurred.</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;time&quot;\n)\n\nfunc main() {\n    go Wrap(test)()\n    time.Sleep(time.Second)\n    fmt.Println(&quot;HELLO&quot;)\n}\n\nfunc test() {\n    panic(&quot;PANIC&quot;)\n}\n\nfunc Wrap(f func()) func() {\n    return func() {\n        defer func() {\n            if r := recover(); r != nil {\n                fmt.Printf(&quot;RECOVERED - %v\\r\\n&quot;, r)\n            }\n        }()\n        f()\n    }\n}\n\nfunc WrapWithSignal(f func(chan bool), signal chan bool) func() {\n    return func() {\n        defer func() {\n            if r := recover(); r != nil {\n                fmt.Printf(&quot;RECOVERED - %v\\r\\n&quot;, r)\n                signal &lt;- false\n            }\n        }()\n        f(signal)\n    }\n}\n</code></pre>\n<ol>\n<li><p>What will be the use of <code>WrapWithSignal</code> function, and how can I use it?</p>\n</li>\n<li><p>Is there another way to wrap functions in order to recover that is less verbose?</p>\n</li>\n</ol>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 4588633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d297f3cc2bf953c8c005d1f7a47faff?s=128&d=identicon&r=PG&f=1", "display_name": "eemr", "link": "https://stackoverflow.com/users/4588633/eemr"}, "edited": false, "score": 0, "creation_date": 1573498802, "post_id": 58803453, "comment_id": 103893845, "body": "Thank you. Can you also answer my second question if possible?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 23, "user_id": 4588633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d297f3cc2bf953c8c005d1f7a47faff?s=128&d=identicon&r=PG&f=1", "display_name": "eemr", "link": "https://stackoverflow.com/users/4588633/eemr"}, "edited": false, "score": 0, "creation_date": 1573499699, "post_id": 58803453, "comment_id": 103894209, "body": "afaik, <code>All</code> expects to see an array, and your <code>results</code> is not, so maybe you can try <code>One</code> instead of <code>All</code>?"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 0, "last_activity_date": 1573483114, "creation_date": 1573483114, "answer_id": 58803453, "question_id": 58802198, "link": "https://stackoverflow.com/questions/58802198/how-to-use-facet-in-golang-with-library-mgo/58803453#58803453", "title": "how to use $facet in golang with library mgo?", "body": "<p>Using mgo, you have to pass an array of documents to <code>Pipe</code>:</p>\n\n<pre><code>p:=collection.Pipe([]bson.M{\n  {\"$match\": bson.M{\"colour\":\"red\"}},\n  {\"$facet\": bson.M{ \"cntOfReds\":[]bson.M{{\"$group\":{\"_id\": \"$product\", \"count\": bson.M{\"$sum\":1}}}}},\n  \"cntOfRedsIn2015\": ...\n</code></pre>\n\n<p>Then, run the pipeline and get results:</p>\n\n<pre><code>p.All(&amp;results)\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 4588633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d297f3cc2bf953c8c005d1f7a47faff?s=128&d=identicon&r=PG&f=1", "display_name": "eemr", "link": "https://stackoverflow.com/users/4588633/eemr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 58803453, "answer_count": 1, "score": 0, "last_activity_date": 1614153660, "creation_date": 1573478422, "question_id": 58802198, "link": "https://stackoverflow.com/questions/58802198/how-to-use-facet-in-golang-with-library-mgo", "title": "how to use $facet in golang with library mgo?", "body": "<p>I started learning performance improvements on mongoDb. And i have a question based aggregation functions.\nI have created a basic test collection with 3 fields product, colour and year:</p>\n\n<pre><code>{\n    \"product\" : \"car\",\n    \"colour\" : \"red\",\n    \"year\" : \"2019\"\n}\n{\n    \"product\" : \"car\",\n    \"colour\" : \"black\",\n    \"year\" : \"2018\"\n}\n{\n    \"product\" : \"bike\",\n    \"colour\" : \"blue\",\n    \"year\" : \"2014\"\n}\n{\n    \"product\" : \"train\",\n    \"colour\" : \"black\",\n    \"year\" : \"2019\"\n}\n{\n    \"product\" : \"ship\",\n    \"colour\" : \"red\",\n    \"year\" : \"2018\"\n}\n{\n    \"product\" : \"car\",\n    \"colour\" : \"red\",\n    \"year\" : \"2016\"\n}\n{\n    \"product\" : \"car\",\n    \"colour\" : \"blue\",\n    \"year\" : \"2015\"\n}\n{\n    \"product\" : \"bike\",\n    \"colour\" : \"white\",\n    \"year\" : \"2014\"\n}\n{\n    \"product\" : \"train\",\n    \"colour\" : \"red\",\n    \"year\" : \"2016\"\n}\n{\n    \"product\" : \"ship\",\n    \"colour\" : \"red\",\n    \"year\" : \"2015\"\n}\n\n</code></pre>\n\n<p>Due to performance issue, i wish  to use facet for single aggregation stage:</p>\n\n<pre><code> db.getCollection('test').aggregate([\n    {\n        \"$match\":{\n            \"colour\":\"red\"\n        }\n    },\n    {\n        \"$facet\": {\n            \"cntOfReds\":[\n                {\"$group\":{\"_id\": \"$product\", \"count\": {\"$sum\": 1}}}\n            ],\n            \"cntOfRedsIn2015\":[\n                {\"$match\" :{\"year\": \"2015\"}},\n                {\"$group\": {\"_id\": \"$year\", \"count\": {\"$sum\": 1}}}\n            ]\n    }   }\n\n    ])\n</code></pre>\n\n<p>How do we implement the same query on golang with mgo.v2 and set the results to a struct?</p>\n"}, {"tags": ["go", "apache-kafka", "confluent-platform", "librdkafka"], "answers": [{"comments": [{"owner": {"reputation": 415, "user_id": 10263695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IClZzCdXtC8/AAAAAAAAAAI/AAAAAAAAGAs/4BH-9diuSwM/photo.jpg?sz=128", "display_name": "Vani Polnedi", "link": "https://stackoverflow.com/users/10263695/vani-polnedi"}, "edited": false, "score": 0, "creation_date": 1573474901, "post_id": 58801141, "comment_id": 103882557, "body": "what to do if i want to add multiple consumers to that group?"}, {"owner": {"reputation": 18208, "user_id": 1765189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673318e1268e43679dc9ab6835a39604?s=128&d=identicon&r=PG", "display_name": "Mickael Maison", "link": "https://stackoverflow.com/users/1765189/mickael-maison"}, "reply_to_user": {"reputation": 415, "user_id": 10263695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IClZzCdXtC8/AAAAAAAAAAI/AAAAAAAAGAs/4BH-9diuSwM/photo.jpg?sz=128", "display_name": "Vani Polnedi", "link": "https://stackoverflow.com/users/10263695/vani-polnedi"}, "edited": false, "score": 1, "creation_date": 1573475819, "post_id": 58801141, "comment_id": 103883002, "body": "Just start multiple consumers, all with the same value for <code>group.id</code>"}, {"owner": {"reputation": 415, "user_id": 10263695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IClZzCdXtC8/AAAAAAAAAAI/AAAAAAAAGAs/4BH-9diuSwM/photo.jpg?sz=128", "display_name": "Vani Polnedi", "link": "https://stackoverflow.com/users/10263695/vani-polnedi"}, "edited": false, "score": 0, "creation_date": 1573476372, "post_id": 58801141, "comment_id": 103883262, "body": "Thank you Mickael Maison. one more doubt ... what to do if i want multiple consumers for multiple groups?"}, {"owner": {"reputation": 18208, "user_id": 1765189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673318e1268e43679dc9ab6835a39604?s=128&d=identicon&r=PG", "display_name": "Mickael Maison", "link": "https://stackoverflow.com/users/1765189/mickael-maison"}, "reply_to_user": {"reputation": 415, "user_id": 10263695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IClZzCdXtC8/AAAAAAAAAAI/AAAAAAAAGAs/4BH-9diuSwM/photo.jpg?sz=128", "display_name": "Vani Polnedi", "link": "https://stackoverflow.com/users/10263695/vani-polnedi"}, "edited": false, "score": 1, "creation_date": 1573478122, "post_id": 58801141, "comment_id": 103884115, "body": "A consumer can only be a member of a single group. So you need to start some consumers with <code>group.id</code> set to <code>group-1</code> and some with <code>group-2</code> for example."}], "tags": [], "owner": {"reputation": 18208, "user_id": 1765189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673318e1268e43679dc9ab6835a39604?s=128&d=identicon&r=PG", "display_name": "Mickael Maison", "link": "https://stackoverflow.com/users/1765189/mickael-maison"}, "is_accepted": true, "score": 2, "last_activity_date": 1573474477, "creation_date": 1573474477, "answer_id": 58801141, "question_id": 58801067, "link": "https://stackoverflow.com/questions/58801067/how-to-create-consumer-group-with-multiple-consumers-in-confluent-kafka-go/58801141#58801141", "title": "how to create consumer group with multiple consumers in confluent-kafka-go?", "body": "<p>With <code>confluent-kafka-go</code>, you just need to set <code>group.id</code> in your consumer configuration to have it join/create a group.</p>\n\n<p>For example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>c, err := kafka.NewConsumer(&amp;kafka.ConfigMap{\n        \"bootstrap.servers\": \"localhost:9092\",\n        \"group.id\":          \"my-group\"})\n</code></pre>\n\n<p>One of the samples demonstrates that: <a href=\"https://github.com/confluentinc/confluent-kafka-go/blob/master/examples/consumer_example/consumer_example.go\" rel=\"nofollow noreferrer\">https://github.com/confluentinc/confluent-kafka-go/blob/master/examples/consumer_example/consumer_example.go</a></p>\n"}], "owner": {"reputation": 415, "user_id": 10263695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IClZzCdXtC8/AAAAAAAAAAI/AAAAAAAAGAs/4BH-9diuSwM/photo.jpg?sz=128", "display_name": "Vani Polnedi", "link": "https://stackoverflow.com/users/10263695/vani-polnedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 543, "favorite_count": 0, "accepted_answer_id": 58801141, "answer_count": 1, "score": 1, "last_activity_date": 1573541030, "creation_date": 1573474125, "last_edit_date": 1573541030, "question_id": 58801067, "link": "https://stackoverflow.com/questions/58801067/how-to-create-consumer-group-with-multiple-consumers-in-confluent-kafka-go", "title": "how to create consumer group with multiple consumers in confluent-kafka-go?", "body": "<p>As i'm new to Go and kafka , i need to implement consumer groups using confluent-kafka-go module. can anyone help me out? </p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 2, "creation_date": 1573474126, "post_id": 58800985, "comment_id": 103882231, "body": "<a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">blog.golang.org/json-and-go</a>"}, {"owner": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 3, "creation_date": 1573474174, "post_id": 58800985, "comment_id": 103882262, "body": "That string <i>is</i> JSON. Do you mean you want to convert it to some Go data structure?"}, {"owner": {"reputation": 188, "user_id": 11337568, "user_type": "registered", "profile_image": "https://graph.facebook.com/10205556418985849/picture?type=large", "display_name": "Arben John Avillanosa", "link": "https://stackoverflow.com/users/11337568/arben-john-avillanosa"}, "reply_to_user": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 0, "creation_date": 1573474218, "post_id": 58800985, "comment_id": 103882291, "body": "yes i want this string to convert to GO data structure"}, {"owner": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 2, "creation_date": 1573474264, "post_id": 58800985, "comment_id": 103882312, "body": "A simple enough task with <i>plenty</i> of examples all over the web. What have you tried and how did it not work?"}, {"owner": {"reputation": 5216, "user_id": 4878850, "user_type": "registered", "accept_rate": 90, "profile_image": "https://lh3.googleusercontent.com/-Km3lO2wPvWM/AAAAAAAAAAI/AAAAAAAAA5c/fO0oHsS1SXA/photo.jpg?sz=128", "display_name": "Jim Wright", "link": "https://stackoverflow.com/users/4878850/jim-wright"}, "edited": false, "score": 0, "creation_date": 1573474303, "post_id": 58800985, "comment_id": 103882327, "body": "<code>json.Unmarshal</code>"}, {"owner": {"reputation": 188, "user_id": 11337568, "user_type": "registered", "profile_image": "https://graph.facebook.com/10205556418985849/picture?type=large", "display_name": "Arben John Avillanosa", "link": "https://stackoverflow.com/users/11337568/arben-john-avillanosa"}, "edited": false, "score": 0, "creation_date": 1573474458, "post_id": 58800985, "comment_id": 103882377, "body": "having a hardtime structuring the <code>&quot;data&quot;</code> part"}, {"owner": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 0, "creation_date": 1573474550, "post_id": 58800985, "comment_id": 103882415, "body": "\ufffc@ArbenJohnAvillanosa Questions seeking debugging help (<b>&quot;why isn&#39;t this code working?&quot;</b>) must include the desired behavior, a specific problem or error and the shortest code necessary to reproduce it <b>in the question itself</b>. Questions without <b>a clear problem statement</b> are not useful to other readers. See: <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">How to create a Minimal, Reproducible Example</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1573475856, "post_id": 58800985, "comment_id": 103883017, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/q/39914425/13860\">stackoverflow.com/q/39914425/13860</a>"}, {"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 2, "creation_date": 1573475865, "post_id": 58800985, "comment_id": 103883022, "body": "For starters: this string is not valid JSON. The trailing <code>,</code> after the address value is not a valid token."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573486736, "post_id": 58800985, "comment_id": 103888611, "body": "There are several trailing  commas that make this invalid JSON."}], "answers": [{"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1573492653, "post_id": 58803689, "comment_id": 103891496, "body": "While this code does the required things, I would like to point out to any reader that using values (<code>&quot;001&quot;</code> and <code>&quot;002&quot;</code> in OP&#39;s sample) as keys is <b><i>VERY</i></b> bad practice.  <code>data</code> should be an array of objects, which could easily hold the required values like <code>&quot;data&quot;:[{&quot;number&quot;:&quot;001&quot;,&quot;name&quot;:&quot;arben&quot;,&quot;fav_color&quot;:&quot;blue&quot;,&quot;a&zwnj;&#8203;ddress&quot;: &quot;PH&quot;},...]</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1573493273, "post_id": 58803689, "comment_id": 103891772, "body": "@MarkusWMahlberg In my defense, I&#39;ve answered the question under the assumption that that is some json OP needs to process but over whose structure they don&#39;t have control. And I agree that in general it would be considered bad practice, however the provider of the json may have their reasons... so whatever, the correct naming of json properties wasn&#39;t part of the question. That said, qualifying it as &quot;very&quot; in all caps, bold, and italic might a bit too dramatic ;), if a project fails it&#39;s probably not because of their json properties."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1573493464, "post_id": 58803689, "comment_id": 103891844, "body": "No attack on your solution at all, Sir, all on the data model at hand. But I somehow disagree on the project failing. It may not be <i>because</i> of the JSON property, but a sloppy data model usually indicates a certain... laziness when it comes to basics."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1573493821, "post_id": 58803689, "comment_id": 103891958, "body": "Agree with you there, not <i>because</i> but as indicator of some larger issue. And btw, even though I did use &quot;In my defense&quot;, I did not take your comment as an attack, Sir ;), I just wanted to add a slightly different take on the matter, that&#39;s all."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1573483933, "creation_date": 1573483933, "answer_id": 58803689, "question_id": 58800985, "link": "https://stackoverflow.com/questions/58800985/how-to-convert-string-to-json-in-go/58803689#58803689", "title": "How to convert string to JSON in Go?", "body": "<p>Whenever you have json property names that aren't known upfront, or they don't lend themselves very well to be represented as fields of a struct then you're left more or less with one option, a map. So first you need to unmarshal the <code>\"data\"</code> property into a map.</p>\n\n<p>However maps in Go are implemented as <strong>unordered</strong> groups of elements indexed by a set of unique keys. So basically there's no way to <em>ensure</em> the order of a map in Go, and therefore you'll have to transfer the data from the map into something that can be ordered, like a slice for example.</p>\n\n<p>After you've got your data in the slice you can use the standard <a href=\"https://golang.org/pkg/sort/\" rel=\"nofollow noreferrer\"><code>sort</code></a> package to sort the slice in the order you want.</p>\n\n<hr>\n\n<p>You can start by declaring the types you need:</p>\n\n<pre><code>type DataItem struct {\n    Key    string     `json:\"-\"`\n    Fields DataFields `json:\"fields\"`\n}\n\ntype DataFields struct {\n    Name     string `json:\"name\"`\n    FavColor string `json:\"fav_color\"`\n    Address  string `json:\"address\"`\n}\n</code></pre>\n\n<p>Then unmarshal the json</p>\n\n<pre><code>var obj struct {\n    TestCode  int                  `json:\"testCode\"`\n    ReplyTest string               `json:\"replyTest\"`\n    Data      map[string]*DataItem `json:\"data\"`\n}\nif err := json.Unmarshal(data, &amp;obj); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Transfer the contents of the map into a slice</p>\n\n<pre><code>items := []*DataItem{}\nfor key, item := range obj.Data {\n    item.Key = key // keep track of the key because it will be used to order the contents of the slice\n    items = append(items, item)\n}\n</code></pre>\n\n<p>Finally sort the slice</p>\n\n<pre><code>sort.Slice(items, func(i, j int) bool {\n    return items[i].Key &lt; items[j].Key\n})\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/D2u46veOQwD\" rel=\"nofollow noreferrer\">https://play.golang.com/p/D2u46veOQwD</a></p>\n"}], "owner": {"reputation": 188, "user_id": 11337568, "user_type": "registered", "profile_image": "https://graph.facebook.com/10205556418985849/picture?type=large", "display_name": "Arben John Avillanosa", "link": "https://stackoverflow.com/users/11337568/arben-john-avillanosa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 58803689, "answer_count": 1, "score": -3, "last_activity_date": 1573483933, "creation_date": 1573473763, "last_edit_date": 1573474211, "question_id": 58800985, "link": "https://stackoverflow.com/questions/58800985/how-to-convert-string-to-json-in-go", "title": "How to convert string to JSON in Go?", "body": "<p>Let\u2019s say I have this string:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>`\n{\n    \"testCode\": 0,\n    \"replyTest\": \"OK\",\n    \"data\": {\n        \"001\": {\n            \"fields\": {\n                \"name\": \"arben\",\n                \"fav_color\": \"blue\",\n                \"address\": \"PH\",\n            }\n        },\n        \"002\": {\n            \"fields\": {\n                \"name\": \"john\",\n                \"fav_color\": \"black\",\n                \"address\": \"PH\",\n            }\n        },\n    }\n}\n`\n</code></pre>\n\n<p>How to convert this string to JSON where <code>data</code> is in form of list in order for me to loop this list in a process?</p>\n"}, {"tags": ["go", "hyperledger-chaincode", "chaincode"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1573472158, "post_id": 58800566, "comment_id": 103881319, "body": "<code>StructData.Data</code> is a field of type <code>[]string</code>. How could you set (assign) a map (<code>results</code>) to it?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1573472255, "post_id": 58800566, "comment_id": 103881363, "body": "<a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user12355116"}, "edited": false, "score": 0, "creation_date": 1573472326, "post_id": 58800566, "comment_id": 103881391, "body": "I want to store individual json string in each index of string array. My approach may be wrong by assigning []map[string]interface {} to [] string! Is there any method to do?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1573472673, "post_id": 58800566, "comment_id": 103881574, "body": "Maybe you want <code>Data []json.RawMessage</code>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user12355116"}, "edited": false, "score": 0, "creation_date": 1573473420, "post_id": 58800566, "comment_id": 103881939, "body": "So, how to convert empArray to that format?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573485244, "post_id": 58800566, "comment_id": 103887888, "body": "@VenkateshS Is this what you looking for <a href=\"https://play.golang.com/p/SSEsADYyqOC\" rel=\"nofollow noreferrer\">play.golang.com/p/SSEsADYyqOC</a>? Or do you want the individual json <i>objects</i> to be turned into json strings?"}], "answers": [{"tags": [], "owner": {"reputation": 33, "user_id": 3262529, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HEc3o.jpg?s=128&g=1", "display_name": "PeterFraedrich", "link": "https://stackoverflow.com/users/3262529/peterfraedrich"}, "is_accepted": false, "score": 1, "last_activity_date": 1573496302, "creation_date": 1573496302, "answer_id": 58806644, "question_id": 58800566, "link": "https://stackoverflow.com/questions/58800566/cannot-use-type-mapstringinterface-as-type-string-in-field-value/58806644#58806644", "title": "Cannot use (type []map[string]interface {}) as type []string in field value", "body": "<p>One of the gotchas of unmarshaling JSON to a map is that it only goes 1 level deep: that is, if you have nested JSON, it will only unmarshal the first level of your data structure. This means you'll need to not only iterate through your map <code>results</code> but you'll also need to build whatever datatype you need for <code>&amp;StructData{}</code>. This would look something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype StructData struct {\n    Data []string `json:\"data\"`\n}\n\nfunc main() {\n    empArray := \"[{\\\"abc\\\":\\\"abc\\\"},{\\\"def\\\":\\\"def\\\"}]\"\n\n    var results []map[string]interface{}\n\n    json.Unmarshal([]byte(empArray), &amp;results)\n\n    // create a new variable that we'll use as the input to StructData{}\n    var unpacked []string\n\n    // iterate through our results map to get the 'next level' of our JSON\n    for _, i := range results {\n        // marshal our next level as []byte\n        stringified, err := json.Marshal(i)\n        if err != nil {\n            fmt.Println(\"error :\", err)\n        }\n        // add item to our unpacked variable as a string\n        unpacked = append(unpacked, string(stringified[:]))\n    }\n    pr := &amp;StructData{unpacked}\n    prAsBytes, err := json.Marshal(pr)\n    if err != nil {\n        fmt.Println(\"error :\", err)\n    }\n    fmt.Println(string(prAsBytes[:]))\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user12355116"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5542, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1586337696, "creation_date": 1573472060, "last_edit_date": 1586337696, "question_id": 58800566, "link": "https://stackoverflow.com/questions/58800566/cannot-use-type-mapstringinterface-as-type-string-in-field-value", "title": "Cannot use (type []map[string]interface {}) as type []string in field value", "body": "<p>How to store Array of JSONs (in string format) in []string (individual JSON string in each index of string array) ?</p>\n\n<pre><code>package main\nimport (\n \"encoding/json\"\n \"fmt\"\n)\ntype StructData struct {\n  Data      []string `json:\"data\"`\n}\n\nfunc main() {\n empArray := \"[{\\\"abc\\\":\\\"abc\\\"},{\\\"def\\\":\\\"def\\\"}]\"\n\n var results []map[string]interface{}\n\n json.Unmarshal([]byte(empArray), &amp;results)\n\n pr := &amp;StructData{results}\n prAsBytes, err := json.Marshal(pr)\n if err != nil {\n    fmt.Println(\"error :\", err)\n }\n}\n</code></pre>\n\n<p>Here I am getting the error </p>\n\n<pre><code>cannot use results (type []map[string]interface {}) as type []string in field value\n</code></pre>\n\n<p>Is there any other method to store the each json string data in each index of string array?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "edited": false, "score": 0, "creation_date": 1573466191, "post_id": 58799055, "comment_id": 103878566, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/27848406/equivalent-for-pythons-list-comprehension\">Equivalent for Python&#39;s list comprehension</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573487113, "post_id": 58799055, "comment_id": 103888799, "body": "I can&#39;t say I&#39;ve found many scenarios where I need a slice of incrementing integers. That seems pretty useless. But mostly your code does the thing; it&#39;s got some unnecessary comments that explain really obvious code, but those four lines are pretty much how I&#39;d make that slice."}], "answers": [{"comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1573511890, "post_id": 58799164, "comment_id": 103898663, "body": "@zerkms: or: &quot;If you want Python, you know where to find it&quot;? :-)"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 4, "last_activity_date": 1573466290, "creation_date": 1573466290, "answer_id": 58799164, "question_id": 58799055, "link": "https://stackoverflow.com/questions/58799055/mimicking-pythons-list-comprehension-in-go-over-a-range-of-numbers/58799164#58799164", "title": "Mimicking Pythons list comprehension in Go over a range of numbers", "body": "<blockquote>\n  <p>[I]s there a simpler way you could achieve this in Go?</p>\n</blockquote>\n\n<p>Basically no.</p>\n\n<p>You can simplify your for loop a bit with range but that is it.\nRule of thumb: there is no magic in Go.</p>\n"}, {"tags": [], "owner": {"reputation": 2042, "user_id": 11424673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ecf0fd0aa656482af8bc20d0d22c88?s=128&d=identicon&r=PG&f=1", "display_name": "Hymns For Disco", "link": "https://stackoverflow.com/users/11424673/hymns-for-disco"}, "is_accepted": true, "score": 1, "last_activity_date": 1573626358, "creation_date": 1573626358, "answer_id": 58831437, "question_id": 58799055, "link": "https://stackoverflow.com/questions/58799055/mimicking-pythons-list-comprehension-in-go-over-a-range-of-numbers/58831437#58831437", "title": "Mimicking Pythons list comprehension in Go over a range of numbers", "body": "<p>I think the natural way to do it in Go is to just consider things on a case-by-case basis. The cases that make Python's list comprehensions look really appealing are when you are trying to something very basic, like populating an array with ascending numbers. If its such an easy concept, we should be able to write it simply. You may disagree here, but I would say that allocating a list of ascending numbers (or even numbers) is really not a typical problem and doesn't seem to have much purpose.</p>\n\n<p>The trap with list comprehensions is that it becomes tempting to use them for more complicated scenarios.  Take this example from <a href=\"https://www.geeksforgeeks.org/nested-list-comprehensions-in-python/\" rel=\"nofollow noreferrer\">Geeks for geeks</a></p>\n\n<hr>\n\n<pre><code># 2-D List of planets \nplanets = [['Mercury', 'Venus', 'Earth'], ['Mars', 'Jupiter', 'Saturn'], ['Uranus', 'Neptune', 'Pluto']] \n\nflatten_planets = [] \n\nfor sublist in planets: \n    for planet in sublist: \n\n        if len(planet) &lt; 6: \n            flatten_planets.append(planet) \n\nprint(flatten_planets)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>['Venus', 'Earth', 'Mars', 'Pluto']\n</code></pre>\n\n<blockquote>\n  <p>This can also be done using nested list comprehensions which has been\n  shown below:</p>\n</blockquote>\n\n<pre><code># 2-D List of planets \nplanets = [['Mercury', 'Venus', 'Earth'], ['Mars', 'Jupiter', 'Saturn'], ['Uranus', 'Neptune', 'Pluto']] \n\n# Nested List comprehension with an if condition \nflatten_planets = [planet for sublist in planets for planet in sublist if len(planet) &lt; 6] \n\nprint(flatten_planets) \n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>['Venus', 'Earth', 'Mars', 'Pluto']\n</code></pre>\n\n<hr>\n\n<p>Though it may be satisfying to reduce 4 lines of code down to 1, using a \"comprehension\" here has arguably made the code less comprehensible to humans.</p>\n\n<p>This expression ...</p>\n\n<pre><code>[planet for sublist in planets for planet in sublist if len(planet) &lt; 6]\n</code></pre>\n\n<p>Just seems off-putting, the same amount of \"nesting\" (the thing list comprehensions make go away), is happening, just now there are no visual clues like indentation to help us understand it. We have to read through this line carefully and reconstruct the nested logic in our head to know how it works.</p>\n\n<p>The article I took this from explains comprehensions like this:</p>\n\n<blockquote>\n  <p>List Comprehensions are one of the most amazing features of Python. It\n  is a smart and concise way of creating lists ...</p>\n</blockquote>\n\n<p>This is a very python kind of attitude where when a feature makes you feel smart for using it in your code, that means that its good, even if it makes it harder for other people (or yourself at a later date) trying to read and understand your code.  This kind of attitude is strongly rejected in Go.</p>\n\n<p>One memorable quote on this topic from one of Go's creators, Rob Pike (I'm paraphrasing here)</p>\n\n<blockquote>\n  <p>People have asked us for these kinds of features, and we say \"no\". One of the reasons is that, if you add these features, people are going to use them, that's why they're there. But they may be more expensive than a simple for loop.  They tend to generate more expensive solutions to problems that have much simpler solutions</p>\n</blockquote>\n"}], "owner": {"reputation": 2429, "user_id": 5091805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e4vgq.png?s=128&g=1", "display_name": "Ari", "link": "https://stackoverflow.com/users/5091805/ari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 0, "accepted_answer_id": 58831437, "answer_count": 2, "score": 0, "last_activity_date": 1573626358, "creation_date": 1573465894, "question_id": 58799055, "link": "https://stackoverflow.com/questions/58799055/mimicking-pythons-list-comprehension-in-go-over-a-range-of-numbers", "title": "Mimicking Pythons list comprehension in Go over a range of numbers", "body": "<p>In Python I can do something like:</p>\n\n<pre><code>numbers = [i for i in range(5)]\n</code></pre>\n\n<p>Which will result in:</p>\n\n<pre><code>&gt;&gt; [0, 1, 2, 3, 4]\n</code></pre>\n\n<p>I'm learning Go so I thought I'd try and replicate that process:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc inRange(num int) []int {\n    // Make a slice to hold the number if int's specified\n    output := make([]int, num)\n\n    // For Loop to insert data\n    for i := 0; i &lt; num; i++ {\n        output[i] = i\n    }\n    return output\n}\n\nfunc main() {\n    x := inRange(10)\n    fmt.Print(x)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&gt;&gt; [0, 1, 2, 3, 4]\n</code></pre>\n\n<p>Seems pretty verbose, is there a simpler way you could achieve this in Go? I also like in python I can make it a bit more complex</p>\n\n<pre><code>evens = [i for i in range(10) if i % 2 == 0]\n&gt;&gt; [0, 2, 4, 5, 8]\n</code></pre>\n\n<p>This question isn't so much how to make Go work like Python, I would like to know how a Go Developer would achieve the same thing native/naturally.</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1573465794, "post_id": 58798984, "comment_id": 103878397, "body": "It looks you are misusing prepared statements. They keep resources allocated on the server side (in the DB server), so you should close them as soon as you don&#39;t need them. See <a href=\"https://stackoverflow.com/questions/58064081/is-it-okay-to-prepare-sql-statement-once-for-multiple-request/58064554#58064554\">Is it okay to prepare SQL statement once for multiple request?</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573487273, "post_id": 58798984, "comment_id": 103888861, "body": "Also, your quoted code would not cause the given error because what&#39;s shown only prepares 2 statements for the lifetime of the application. So there is somewhere else that is repeatedly creating prepared statements and not closing them."}], "owner": {"reputation": 687, "user_id": 6138942, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zEF_d3b2Gck/AAAAAAAAAAI/AAAAAAAAAGw/bABfaZfEngc/photo.jpg?sz=128", "display_name": "Gijs de Jong", "link": "https://stackoverflow.com/users/6138942/gijs-de-jong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1109, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1573549067, "creation_date": 1573465631, "last_edit_date": 1573549067, "question_id": 58798984, "link": "https://stackoverflow.com/questions/58798984/cant-create-more-than-max-prepared-stmt-count-statements", "title": "Can&#39;t create more than max_prepared_stmt_count statements", "body": "<p>I am encountering the following MySQL error from within my long-running Go application:\n<code>Can't create more than max_prepared_stmt_count statements (current value: 16382)</code></p>\n\n<p>In my <code>main.go</code> file I create a struct which has a couple of <code>sql.Stmt</code> fields. By doing so I intend to reuse these prepared statements.</p>\n\n<p>The code looks somewhat like this, in <code>factory.go</code>:</p>\n\n<pre><code>func NewFactory(db *sql.DB) (*Factory, error) {\n    insertStmt, err := db.Prepare(\"INSERT INTO `table` (`a`, `b`, `c`) VALUES   (?,?,?);\")\n\n    // Same for deleteStmt\n\n    if err != nil {\n        return nil, err\n    }\n\n    f := &amp;Factory{\n        insertStmt: insertStmt,\n        deleteStmt: deleteStmt,\n    }\n\n    return f, nil\n}\n</code></pre>\n\n<p>And in my <code>main.go</code>:</p>\n\n<pre><code>    db, err := sql.Open(\"mysql\", \"...\")\n    if err != nil {\n        panic(err)\n    }\n\n    db.SetConnMaxLifetime(time.Minute)\n\n    factory, err := NewFactory(db)\n\n    // start a web server and handle those calls (basically an endless loop until the app is stopped)\n</code></pre>\n\n<p><strong>Note</strong>: I do not call <code>insertStmt.Close()</code> because I want to reuse this prepared statement.</p>\n\n<p>I have read <a href=\"http://go-database-sql.org/prepared.html\" rel=\"nofollow noreferrer\">http://go-database-sql.org/prepared.html</a> which says that a prepared statement is bound to a single database connection. I know that setting <code>db.SetConnMaxLifetime(time.Minute)</code> will close the connection after a minute of idling, but this is done to prevent errors where the server closed the connection (MySQL <code>wait_timeout</code> parameter) but the client still thinks the connection is alive.</p>\n\n<p>Can anyone explain what is happening and how I can prevent a buildup of prepared statements?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573487524, "post_id": 58798458, "comment_id": 103889003, "body": "Get rid of the entire <code>creds</code> section. Just don&#39;t pass credentials when creating the session. It will default to using the machine role."}, {"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1573552922, "post_id": 58798458, "comment_id": 103910262, "body": "@Adrian I removed the creds section, and then got different error. any idea?"}], "answers": [{"comments": [{"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "edited": false, "score": 0, "creation_date": 1573615081, "post_id": 58816525, "comment_id": 103935573, "body": "please see my updated answer. I&#39;m able to perform list, get, and put operations through aws cli, but not able programatically using the sdk"}], "tags": [], "owner": {"reputation": 3418, "user_id": 1158351, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/06288dded18d1b525738107e8d1347a6?s=128&d=identicon&r=PG", "display_name": "pradeep", "link": "https://stackoverflow.com/users/1158351/pradeep"}, "is_accepted": false, "score": 1, "last_activity_date": 1573553936, "creation_date": 1573553936, "answer_id": 58816525, "question_id": 58798458, "link": "https://stackoverflow.com/questions/58798458/s3-on-ec2-with-iam-error-nocredentialproviders-no-valid-providers-in-chain-de/58816525#58816525", "title": "S3 on EC2 with IAM: Error NoCredentialProviders: no valid providers in chain. Deprecated", "body": "<p>You dont need to specify credentials when using IAM role on EC2 instance.</p>\n\n<p>I see you are getting <code>Access Denied</code> which means your Go program is able to pick the EC2 profile creds but probably due to lack of permissions, its getting this error.</p>\n\n<p>Reading your code, it seems you want to write object to S3. Can you make sure you have given <code>s3:Get*</code>, <code>s3:List*</code>, <code>s3:PutObject</code>, <code>s3:PutObjectAcl</code> to your IAM Role and there is no explicit Deny on S3 Bucket policy?</p>\n"}, {"tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": true, "score": 0, "last_activity_date": 1574160158, "creation_date": 1574160158, "answer_id": 58932150, "question_id": 58798458, "link": "https://stackoverflow.com/questions/58798458/s3-on-ec2-with-iam-error-nocredentialproviders-no-valid-providers-in-chain-de/58932150#58932150", "title": "S3 on EC2 with IAM: Error NoCredentialProviders: no valid providers in chain. Deprecated", "body": "<p>I managed to solve this error by doing two things.</p>\n\n<p>The first one is by using <code>stscreds.NewCredentials(session, roleArn)</code> as the credentials during session creation.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>s3Config := aws.NewConfig()\ns3Config.CredentialsChainVerboseErrors = aws.Bool(true)\ns3Config.WithLogLevel(aws.LogDebugWithHTTPBody)\ns3Config.Region = aws.String(region)\ns3Config.WithHTTPClient(&amp;http.Client{\n    Transport: &amp;http.Transport{\n        Proxy: http.ProxyFromEnvironment,\n    },\n    Timeout: 10 * time.Second,\n})\n\nsess, err := session.NewSession(s3Config)\nif err != nil {\n    log.Fatal(\"Error initializing session. \" + err.Error())\n}\n\nsess.Config.Credentials = stscreds.NewCredentials(sess, arn)\n_, err = sess.Config.Credentials.Get()\nif err != nil {\n    log.Fatal(\"Error getting role. \" + err.Error())\n}\n</code></pre>\n\n<p>And the 2nd thing is by defining <code>NO_PROXY</code> environment variable with value is <code>169.254.169.254</code>. The particular IP is AWS global IP used for getting the EC2 metadata.</p>\n\n<p>And since my application uses proxy to communicate with the S3 server, I need to exclude that IP.</p>\n"}], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 435, "favorite_count": 0, "accepted_answer_id": 58932150, "answer_count": 2, "score": 0, "last_activity_date": 1574160158, "creation_date": 1573463645, "last_edit_date": 1573615399, "question_id": 58798458, "link": "https://stackoverflow.com/questions/58798458/s3-on-ec2-with-iam-error-nocredentialproviders-no-valid-providers-in-chain-de", "title": "S3 on EC2 with IAM: Error NoCredentialProviders: no valid providers in chain. Deprecated", "body": "<p>My application use s3 and running on EC2. The IAM is configured on the instance, so the auth happen keyless (without the access key and secret key).</p>\n\n<p>I'm able to upload or download file using aws cli. However when I tried to perform download operation using aws-sdk-go, I get error below:</p>\n\n<blockquote>\n  <p>AccessDenied: Access Denied<br />\n  status code: 403, request id: F945BDB5410E1A00, host id: m74jJ8z/AEzdkaJkWKdIqPEwPIYPZfWnLLfa5UpEwHwaBcXOuXTPY1aw/u/5HGralKg+ewAWEJA=</p>\n</blockquote>\n\n<p>I followed the official guide from <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/aws/credentials/ec2rolecreds/\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/aws/credentials/ec2rolecreds/</a> and from this issue <a href=\"https://github.com/aws/aws-sdk-go/issues/430\" rel=\"nofollow noreferrer\">https://github.com/aws/aws-sdk-go/issues/430</a> but got the error above.</p>\n\n<p>Below is my code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>s3UploadPath = config.GetString(\"upload assets to s3.bucket\")\ns3Config := aws.NewConfig()\ns3Config.CredentialsChainVerboseErrors = aws.Bool(true)\n\nsession, err := session.NewSession(s3Config)\nif err != nil {\n    Logger.Fatal(\"Error initializing s3 uploader. \" + err.Error())\n    os.Exit(0)\n}\n\n// the upload code\nuploader = s3manager.NewUploader(session)\nres, err := uploader.Upload(&amp;s3manager.UploadInput{\n    Bucket: aws.String(s3UploadPath),\n    Key:    aws.String(filename),\n    Body:   f,\n})\nif err != nil {\n    log.Fatal(\"error on upload. \" + err.Error())\n}\n\n// then continue with the download code\n</code></pre>\n\n<p>Attached screenshot showing that the download and upload operations are success  through aws cli</p>\n\n<p><a href=\"https://i.stack.imgur.com/emqpV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/emqpV.png\" alt=\"enter image description here\"></a></p>\n\n<p>Am I doing it wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573455685, "post_id": 58796797, "comment_id": 103874526, "body": "You should try using a concrete struct, it is a much better programming experience then having to deal with maps of empty interfaces... That said, in each iteration you need to create a map and aggregate those maps into a slice, that way you get all the files details. (<a href=\"https://play.golang.com/p/xjDrWwvtDZC\" rel=\"nofollow noreferrer\">play.golang.com/p/xjDrWwvtDZC</a>)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1573456205, "post_id": 58796797, "comment_id": 103874684, "body": "Work through the Tour of Go once more for basic language constructs."}, {"owner": {"reputation": 711, "user_id": 3128553, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/dOroK.jpg?s=128&g=1", "display_name": "Nivin", "link": "https://stackoverflow.com/users/3128553/nivin"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573456394, "post_id": 58796797, "comment_id": 103874745, "body": "@mkopriva. Its working fine for me"}], "answers": [{"comments": [{"owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "edited": false, "score": 1, "creation_date": 1573456084, "post_id": 58796893, "comment_id": 103874650, "body": "I also agree with @mkopriva about using struct, but that&#39;s up to you."}], "tags": [], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "is_accepted": true, "score": 2, "last_activity_date": 1573457562, "last_edit_date": 1573457562, "creation_date": 1573456021, "answer_id": 58796893, "question_id": 58796797, "link": "https://stackoverflow.com/questions/58796797/how-to-create-a-slice-of-objects-using-for-loop/58796893#58796893", "title": "How to create a slice of objects using for loop", "body": "<p>Something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>files, err := ioutil.ReadDir(\".\")\nelements := []map[string]interface{}{}\nfor _, file := range files {\n    elements = append(elements, map[string]interface{}{\n        \"name\":      file.Name(),\n        \"directory\": file.IsDir(),\n        \"size\":      file.Size()})\n}\nctxt.JSON(http.StatusOK, elements)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 669436, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/saVKZ.jpg?s=128&g=1", "display_name": "ksaritek", "link": "https://stackoverflow.com/users/669436/ksaritek"}, "is_accepted": false, "score": 0, "last_activity_date": 1573462039, "creation_date": 1573462039, "answer_id": 58798088, "question_id": 58796797, "link": "https://stackoverflow.com/questions/58796797/how-to-create-a-slice-of-objects-using-for-loop/58798088#58798088", "title": "How to create a slice of objects using for loop", "body": "<p>instead of append, you can create the array with size</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n    files, _ := ioutil.ReadDir(\".\")\n    elements := make([]map[string]interface{}, len(files))\n    for i, file := range files {\n\n        e := map[string]interface{}{\n            \"name\":      file.Name(),\n            \"directory\": file.IsDir(),\n            \"size\":      file.Size(),\n        }\n\n        elements[i] = e\n    }\n\n    for i, e := range elements {\n        fmt.Println(i, e)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 711, "user_id": 3128553, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/dOroK.jpg?s=128&g=1", "display_name": "Nivin", "link": "https://stackoverflow.com/users/3128553/nivin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 58796893, "answer_count": 2, "score": 0, "last_activity_date": 1573463217, "creation_date": 1573455428, "last_edit_date": 1573463217, "question_id": 58796797, "link": "https://stackoverflow.com/questions/58796797/how-to-create-a-slice-of-objects-using-for-loop", "title": "How to create a slice of objects using for loop", "body": "<p>Code:</p>\n\n<pre><code>    files, err := ioutil.ReadDir(\".\")\n    elements := make(map[string]interface{})\n    for _, file := range files {\n        elements[\"name\"] = file.Name()\n        elements[\"directory\"] = file.IsDir()\n        elements[\"size\"] = file.Size()\n    }\n    ctxt.JSON(http.StatusOK, elements)\n</code></pre>\n\n<p>Here I'm getting a response with only last file details.<br>\nHow can I create a slice of objects, that means I want all files details in the response.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": true, "score": 1, "last_activity_date": 1573457114, "creation_date": 1573457114, "answer_id": 58797112, "question_id": 58796736, "link": "https://stackoverflow.com/questions/58796736/difference-between-go-run-path-dir-and-go-run-path-dir/58797112#58797112", "title": "Difference between go run ./path/dir and go run path/dir", "body": "<p>When you run <code>./cmd/web</code>, you refer to the correct directory in your current directory tree.</p>\n\n<p><code>cmd/web</code> however refers to a package living where the stdlib packages are. If you try to run this example </p>\n\n<pre><code>go run net/http\n</code></pre>\n\n<p>It will tell you that it can't run it because its not a <code>main</code> package. It has found the stdlib <code>net/http</code> package with that name; but since <code>cmd/web</code> doesn't exist it doesn't work</p>\n"}], "owner": {"reputation": 6413, "user_id": 129622, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/3ad9727f4d85caf19d8d333db9fa6a58?s=128&d=identicon&r=PG", "display_name": "ybakos", "link": "https://stackoverflow.com/users/129622/ybakos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 58797112, "answer_count": 1, "score": -1, "last_activity_date": 1573457114, "creation_date": 1573455029, "question_id": 58796736, "link": "https://stackoverflow.com/questions/58796736/difference-between-go-run-path-dir-and-go-run-path-dir", "title": "Difference between go run ./path/dir and go run path/dir", "body": "<p>Note: This is not asking <a href=\"https://stackoverflow.com/questions/28571477/why-the-functions-defined-in-other-main-packages-are-not-recognised\">Why the functions defined in other &quot;main&quot; packages are not recognised?</a>.</p>\n\n<p>I've got a project with the following structure:</p>\n\n<p><em>go/src/github.com/me/project/cmd/web/main.go</em></p>\n\n<pre><code># main.go\npackage main\n\nimport(\n  \"github.com/me/myproject/internal/myproject\"\n)\n\nvoid main() {\n  // ...\n}\n</code></pre>\n\n<p><em>go/src/github.com/me/project/cmd/web/handlers.go</em></p>\n\n<pre><code># handlers.go\npackage main\n\nvoid someFunc() {\n  // ...\n}\n</code></pre>\n\n<p>And I compile and run successfully with:</p>\n\n<pre><code>go run ./cmd/web\n</code></pre>\n\n<p>I can also run successfully with <code>go run cmd/web/*.go</code></p>\n\n<p>However, when I try to run with <code>go run cmd/web</code>, why does compilation fail with the output:</p>\n\n<pre><code>package cmd/web: package cmd/web is not in GOROOT (/usr/local/go/src/cmd/web)\n</code></pre>\n\n<p>Why does <code>./cmd/web</code> work, but <code>cmd/web</code> does not?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1573446848, "post_id": 58795386, "comment_id": 103872326, "body": "The <code>QueryParm</code> fields are not set in the playground example because  the JSON field tag names do no match the JSON. Example: The field <code>ColumnName</code> has json tag <code>column_name</code>.  There is no field with that name in the JSON."}, {"owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "edited": false, "score": 4, "creation_date": 1573447109, "post_id": 58795386, "comment_id": 103872376, "body": "Not that this is the problem, but the expression <code>d.QueryParms == *new(string)</code> can be written more simply as <code>d.QueryParms == &quot;&quot;</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1573447369, "post_id": 58795386, "comment_id": 103872428, "body": "The output for the non-playground case is what I would expect when decoding fails.  Does <code>createJobResponse</code> return an error?"}, {"owner": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1573450233, "post_id": 58795386, "comment_id": 103873003, "body": "@CeriseLim&#243;n You are correct, the playground case doesn&#39;t set the fields properly, but it does hold the empty QueryParm Object pointers where the code example doesnt&#39;t the field&#39;s not being set seems to be a protobuff issue that I will need to investigate.  The non-playground case does not return an error, and doesn&#39;t hold pointers to empty QueryParm objects.  Am I to understand that this should be normal?"}], "answers": [{"comments": [{"owner": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "edited": false, "score": 0, "creation_date": 1573450889, "post_id": 58795852, "comment_id": 103873158, "body": "The QueryParm struct is generated by protoc, I have added the protofile message to my question, should I believe that this is an issue/bug with protoc?"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "edited": false, "score": 1, "creation_date": 1573451556, "post_id": 58795852, "comment_id": 103873314, "body": "No, you can use multiple JSON tag with a third party and Custom JSON Marshalling and UnMarshalling, see <a href=\"https://stackoverflow.com/questions/38809137/golang-multiple-json-tag-names-for-one-field\">this</a>"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "edited": false, "score": 1, "creation_date": 1573452176, "post_id": 58795852, "comment_id": 103873451, "body": "See the new edit with <code>var qp []interface{}</code> without changing your input string."}, {"owner": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "edited": false, "score": 1, "creation_date": 1573454519, "post_id": 58795852, "comment_id": 103874154, "body": "I feel pretty stupid now... I was wondering why my JSON was incorrect..  It seems I was using a different struct to encode than to decode... Thanks +1 and I have accepted your answer!"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 1, "last_activity_date": 1573453558, "last_edit_date": 1573453558, "creation_date": 1573449216, "answer_id": 58795852, "question_id": 58795386, "link": "https://stackoverflow.com/questions/58795386/json-unmarshal-does-not-output-in-my-code-works-in-goplayground/58795852#58795852", "title": "JSON unmarshal does not output in my code, works in goplayground", "body": "<p>Two working solutions:  </p>\n\n<ol>\n<li>You may use:</li>\n</ol>\n\n<pre><code>var qp []interface{}\n</code></pre>\n\n<p>Try <a href=\"https://goplay.space/#RXoRzumWBJQ\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype QueryParm struct {\n    ColumnName           string   `protobuf:\"bytes,1,opt,name=column_name,json=columnName,proto3\" json:\"column_name,omitempty\"`\n    ColumnType           string   `protobuf:\"bytes,2,opt,name=column_type,json=columnType,proto3\" json:\"column_type,omitempty\"`\n    WhereValue           string   `protobuf:\"bytes,3,opt,name=where_value,json=whereValue,proto3\" json:\"where_value,omitempty\"`\n    XXX_NoUnkeyedLiteral struct{} `json:\"-\"`\n    XXX_unrecognized     []byte   `json:\"-\"`\n    XXX_sizecache        int32    `json:\"-\"`\n}\n\nfunc main() {\n    jsonstr := `[\n        {\"ColumnName\":\"message_property_assetId\",\"ColumnType\":\"string\"},\n        {\"ColumnName\":\"id\",\"ColumnType\":\"string\"},\n        {\"ColumnName\":\"message_id\",\"ColumnType\":\"string\"},\n        {\"ColumnName\":\"message_security_tenantId\",\"ColumnType\":\"string\"}]`\n    // var qp []QueryParm\n    var qp []interface{}\n    if err := json.Unmarshal([]byte(jsonstr), &amp;qp); err != nil {\n        return\n    }\n    fmt.Println(qp)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[map[ColumnName:message_property_assetId ColumnType:string] map[ColumnName:id ColumnType:string] map[ColumnName:message_id ColumnType:string] map[ColumnName:message_security_tenantId ColumnType:string]]\n</code></pre>\n\n<hr>\n\n<ol start=\"2\">\n<li>You have <code>column_name</code> and <code>column_type</code> not <code>ColumnName</code> and <code>ColumnType</code> in your JSON tag: <code>json:\"column_name,omitempty\"</code> so you may change your input string, e.g.:</li>\n</ol>\n\n<pre><code>    jsonstr := `[\n    {\"column_name\":\"message_property_assetId\",\"column_type\":\"string\"},\n    {\"column_name\":\"id\",\"column_type\":\"string\"},\n    {\"column_name\":\"message_id\",\"column_type\":\"string\"},\n    {\"column_name\":\"message_security_tenantId\",\"column_type\":\"string\"}]`\n</code></pre>\n\n<p>Try <a href=\"https://goplay.space/#gn9nMJsTOxv\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype QueryParm struct {\n    ColumnName           string   `protobuf:\"bytes,1,opt,name=column_name,json=columnName,proto3\" json:\"column_name,omitempty\"`\n    ColumnType           string   `protobuf:\"bytes,2,opt,name=column_type,json=columnType,proto3\" json:\"column_type,omitempty\"`\n    WhereValue           string   `protobuf:\"bytes,3,opt,name=where_value,json=whereValue,proto3\" json:\"where_value,omitempty\"`\n    XXX_NoUnkeyedLiteral struct{} `json:\"-\"`\n    XXX_unrecognized     []byte   `json:\"-\"`\n    XXX_sizecache        int32    `json:\"-\"`\n}\n\nfunc main() {\n    jsonstr := `[\n        {\"column_name\":\"message_property_assetId\",\"column_type\":\"string\"},\n        {\"column_name\":\"id\",\"column_type\":\"string\"},\n        {\"column_name\":\"message_id\",\"column_type\":\"string\"},\n        {\"column_name\":\"message_security_tenantId\",\"column_type\":\"string\"}]`\n    var qp []QueryParm\n    if err := json.Unmarshal([]byte(jsonstr), &amp;qp); err != nil {\n        return\n    }\n    fmt.Printf(\"%+v\\n\", qp)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[{ColumnName:message_property_assetId ColumnType:string WhereValue: XXX_NoUnkeyedLiteral:{} XXX_unrecognized:[] XXX_sizecache:0} {ColumnName:id ColumnType:string WhereValue: XXX_NoUnkeyedLiteral:{} XXX_unrecognized:[] XXX_sizecache:0} {ColumnName:message_id ColumnType: WhereValue: XXX_NoUnkeyedLiteral:{} XXX_unrecognized:[] XXX_sizecache:0} {ColumnName:message_security_tenantId ColumnType:string WhereValue: XXX_NoUnkeyedLiteral:{} XXX_unrecognized:[] XXX_sizecache:0}]\n</code></pre>\n\n<hr>\n\n<ol start=\"3\">\n<li>You may write your Custom JSON Marshalling and Unmarshalling.</li>\n</ol>\n"}], "owner": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 58795852, "answer_count": 1, "score": 0, "last_activity_date": 1573454704, "creation_date": 1573444845, "last_edit_date": 1573454704, "question_id": 58795386, "link": "https://stackoverflow.com/questions/58795386/json-unmarshal-does-not-output-in-my-code-works-in-goplayground", "title": "JSON unmarshal does not output in my code, works in goplayground", "body": "<p>After reviewing several questions, I have decided to ask my question.  A few things I can say...</p>\n\n<ul>\n<li>The struct I am inserting json data into is exported, and so are its fields.</li>\n<li>The struct I am inserting json data into was auto-generated by protoc.</li>\n<li>The struct and code I am using works in goplayground <a href=\"https://goplay.space/#WZWs3dsVcR5\" rel=\"nofollow noreferrer\">https://goplay.space/#WZWs3dsVcR5</a></li>\n</ul>\n\n<p>The code I have is broken into a few parts.</p>\n\n<p>protofile message defining the QueryParm struct.</p>\n\n<pre class=\"lang-proto prettyprint-override\"><code>message QueryParm {\n  string column_name = 1;\n  string column_type = 2;\n}\n</code></pre>\n\n<p>My struct in <code>protobuf.pb.go</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type QueryParm struct {\n    ColumnName           string   `protobuf:\"bytes,1,opt,name=column_name,json=columnName,proto3\" json:\"column_name,omitempty\"`\n    ColumnType           string   `protobuf:\"bytes,2,opt,name=column_type,json=columnType,proto3\" json:\"column_type,omitempty\"`\n    WhereValue           string   `protobuf:\"bytes,3,opt,name=where_value,json=whereValue,proto3\" json:\"where_value,omitempty\"`\n    XXX_NoUnkeyedLiteral struct{} `json:\"-\"`\n    XXX_unrecognized     []byte   `json:\"-\"`\n    XXX_sizecache        int32    `json:\"-\"`\n}\n</code></pre>\n\n<p>My data in <code>pg_client.go</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type PgData struct {\n    ...\n    QueryParms   string    `orm:\"null\"`\n    ...\n}\n</code></pre>\n\n<p>And my function in grpc_client.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func createJobResponse(d *pg.PgData) (*pb.JobResponse, error) {\n    var qp []*pb.QueryParm\n\n    if d.QueryParms == *new(string) {\n        d.QueryParms = \"[{}]\"\n    }\n    fmt.Printf(\"Parms: %v\\nType: %T\\n\", d.QueryParms, d.QueryParms)\n    if err := json.Unmarshal([]byte(d.QueryParms), &amp;qp); err != nil {\n        return nil, err\n    }\n    fmt.Printf(\"Parms: %v\\nType: %T\\n\", qp, qp)\n    return &amp;pb.JobResponse{\n        ...\n        QueryParms:   qp,\n        ...\n    }, nil\n}\n</code></pre>\n\n<p>The output I am receiving post Unmarshal is empty in my code, and contains empty QueryParm struct pointers in the playground.  The JSON string clearly exists beforehand.</p>\n\n<pre><code>Parms: [{\"ColumnName\":\"message_property_assetId\",\"ColumnType\":\"string\"},{\"ColumnName\":\"id\",\"ColumnType\":\"string\"},{\"ColumnName\":\"message_id\",\"ColumnType\":\"string\"},{\"ColumnName\":\"message_security_tenantId\",\"ColumnType\":\"string\"}]\nType: string\nParms: [   ]\nType: []*proto_export.QueryParm\n</code></pre>\n\n<p>Is there some reason why the output from my code and the playground should differ?</p>\n\n<p><strong>CONCLUSION EDIT:</strong> </p>\n\n<p>I wanted to say that for some strange reason, I was using a different struct to encode my JSON than I was to decode it.  This caused the JSON field names to be different and prevented the JSON from being decoded properly.</p>\n\n<p>Make sure you use the same struct to encode as you do to decode!</p>\n"}, {"tags": ["go", "sftp"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1573458693, "post_id": 58795371, "comment_id": 103875490, "body": "Deleting a file is a write operation on the containing directory (in this case newDir). The permissions of the file to be deleted and the root directory are irrelevant."}, {"owner": {"reputation": 95, "user_id": 10137588, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cmyqMiMfro4/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7obF8dRTrUQw2f-ndPrlrYNSu6YJA/mo/photo.jpg?sz=128", "display_name": "hy c", "link": "https://stackoverflow.com/users/10137588/hy-c"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1573537770, "post_id": 58795371, "comment_id": 103903951, "body": "is there any way I can remove the file that has opened before? It seems that once I opened it, I am not able to remove the file."}], "owner": {"reputation": 95, "user_id": 10137588, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cmyqMiMfro4/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7obF8dRTrUQw2f-ndPrlrYNSu6YJA/mo/photo.jpg?sz=128", "display_name": "hy c", "link": "https://stackoverflow.com/users/10137588/hy-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 401, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1578021727, "creation_date": 1573444761, "last_edit_date": 1578021727, "question_id": 58795371, "link": "https://stackoverflow.com/questions/58795371/sftp-permission-denied-error-occured-after-try-to-remove-the-file", "title": "sftp permission denied error occured after try to remove the file", "body": "<p>I am trying to copy files from \"dir\" to a \"oldDir\" and remove the original files in \"dir\" after I upload the files to somewhere else. I can do all the steps except I cannot remove the original file.</p>\n\n<p>I checked both the file and the root directory's permission code are -rwxrwxrwx, which should be fine for me to remove the file. </p>\n\n<pre><code>func UpdateItemAndRemoveOldOne (sConfig sftp.Config) (err error) {\n    var (\n        path    = \"./newDir/\"\n        oldPath = \"./oldDir/\"\n        file    *s.File\n        b       []byte\n        config  db.Config\n    )\n\n    ids, err := db.FindIDs()\n    if err != nil {\n        log.Println(\"Cannot get the list of items\")\n        return\n    }\n\n    dir, err := sConfig.Client.ReadDir(\"./newDir\")\n    if err != nil {\n        log.Println(\"Cannot read directory\")\n        return\n    }\n    oldDir, err := sConfig.Client.ReadDir(\"./oldDir\")\n    if err != nil {\n        log.Println(\"Cannot read old directory\")\n        return\n    }\n\n    for _, f := range dir {\n        name := f.Name()\n        exist := false\n        for _, oldF := range oldDir {\n            if name == oldF.Name() {\n                exist = true\n                break\n            }\n        }\n        if exist {\n            continue\n        }\n\n        if segments := strings.Split(name, \".\"); len(segments) != 3 {\n            log.Println(\"Invalid file name:\", name)\n        } else if config, err = db.FindConfigByDevID(strings.ToLower(segments[1])); err != nil {\n            log.Println(\"Cannot find the item by last 4 char of id, err:\", err)\n\n        } else if file, err = sConfig.Client.Open(path + name); err != nil {\n            log.Println(\"Cannot open \"+path+name+\" , err:\", err)\n        } else if b, err = ioutil.ReadAll(file); err != nil {\n            log.Println(\"Cannot read \"+path+name+\" , err:\", err)\n        } else if err = closeFile(file); err != nil {\n            log.Println(file + \" cannot closed\")\n        } else if err = upload(getUploadPath(1, config.ID)+name, b); err != nil {\n            log.Println(\"Cannot upload file:\", name, \", err:\", err)\n        } else if file, err = sConfig.Client.Create(oldPath + name); err != nil {\n            log.Println(\"Cannot create file after uploaded:\", name, \", err:\", err)\n        } else if _, err = file.Write(b); err != nil {\n            log.Println(\"Cannot write file after uploaded:\", name, \", err:\", err)\n        } else if err = closeFile(file); err != nil {\n            log.Println(file + \" cannot closed\")\n        } else if _, err = sCongif.Client.Remove(path + name); err != nil {\n            log.Println(\"Cannot remove file after uploaded:\", name, \", err:\", err)\n        } else {\n            log.Println(\"uploaded:\", name)\n        }\n    }\n    return\n}\n</code></pre>\n\n<p>I have got error sftp: \"Permission denied\" (SSH_FX_PERMISSION_DENIED)\nI tried to just test the remove function and I could remove some files, but some files I still got this error, but I pretty sure that they have the same file permission code.</p>\n\n<p>Problem solved:\nfound out that I had opened the file without closing it. And somehow the file is still opened by FreeSSHDService. That's why I could not remove the file. </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 10315632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d3fd921124bef566588c8a2303a667a?s=128&d=identicon&r=PG&f=1", "display_name": "peachestao", "link": "https://stackoverflow.com/users/10315632/peachestao"}, "edited": false, "score": 0, "creation_date": 1573475401, "post_id": 58794765, "comment_id": 103882808, "body": "thank you,I mistakenly think that the structure variable stores the entire data."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1573438659, "last_edit_date": 1573438659, "creation_date": 1573438358, "answer_id": 58794765, "question_id": 58794695, "link": "https://stackoverflow.com/questions/58794695/why-does-the-memory-address-change-after-slice-assignment/58794765#58794765", "title": "Why does the memory address change after slice assignment", "body": "<p>A slice value contains a pointer to the backing array, length and capacity.  See <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">Go Slices: usage and internals</a> for the details. </p>\n\n<p>Here's some commentary on the code in the question:</p>\n\n<pre><code>var a = []int{1, 2, 3}\n\n// Print address of variable a\nfmt.Printf(\"%p\\n\", &amp;a)\n\nb := a\n\n// Print address of variable b. The variable a and b\n// have different addresses.\nfmt.Printf(\"%p\\n\", &amp;b)\n\nb = append(b, 0)\n\n// Print address of variable b. Append did not change\n// the address of the variable b.\nfmt.Printf(\"%p\\n\", &amp;b)\n</code></pre>\n\n<p>Print the address of the first slice element to get the results you expect.</p>\n\n<pre><code>var a = []int{1, 2, 3}\n\n// Print address of a's first element\nfmt.Printf(\"%p\\n\", &amp;a[0])\n\nb := a\n\n// Print address of b's first element. This prints\n// same value as previous because a and b share a backing\n// array.\nfmt.Printf(\"%p\\n\", &amp;b[0])\n\nb = append(b, 0)\n\n// Print address of b's first element. This prints a \n// different value from previous because append allocated\n// a new backing array.\nfmt.Printf(\"%p\\n\", &amp;b[0])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 7293977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FC0K6.jpg?s=128&g=1", "display_name": "mbyd916", "link": "https://stackoverflow.com/users/7293977/mbyd916"}, "is_accepted": false, "score": 1, "last_activity_date": 1573439733, "creation_date": 1573439733, "answer_id": 58794893, "question_id": 58794695, "link": "https://stackoverflow.com/questions/58794695/why-does-the-memory-address-change-after-slice-assignment/58794893#58794893", "title": "Why does the memory address change after slice assignment", "body": "<pre><code>// create a new slice struct which contains length, capacity and the underlying array. \n// len(a)=3, cap(a)=3\nvar a = []int{1,2,3}\n\n// `&amp;a` means the pointer to slice struct\nfmt.Printf(\"%p\\n\",&amp;a)\n\n// `b` is another newly created variable of slice struct, so `&amp;b` differs from `&amp;a`, \n// but they share the same underlying array.\n// len(b)=3, cap(b)=3\nb := a\n\n// the underlying array of `b` has been extended, and been newly allocated.\n// but the pointer of `b` remains.\n// len(b)=4, cap(b)=6\nb = append(b, 0)\n</code></pre>\n\n<p>Hope that these comments can help you</p>\n"}], "owner": {"reputation": 21, "user_id": 10315632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d3fd921124bef566588c8a2303a667a?s=128&d=identicon&r=PG&f=1", "display_name": "peachestao", "link": "https://stackoverflow.com/users/10315632/peachestao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 58794765, "answer_count": 2, "score": -1, "last_activity_date": 1573439733, "creation_date": 1573437589, "last_edit_date": 1573437948, "question_id": 58794695, "link": "https://stackoverflow.com/questions/58794695/why-does-the-memory-address-change-after-slice-assignment", "title": "Why does the memory address change after slice assignment", "body": "<p>There are two problems I don't understand. <br>\nThe first one is that one slice variable is assigned to another variable, and it is found that the address of the new variable is inconsistent with that of the variable. My understanding is that slice shares memory, and their addresses are the same according to the principle.</p>\n\n<p>the Second is then when the slice variable is insufficient in capacity, the memory address does not change after the append operation. It should change according to the principle, because the memory address will be newly allocated when the capacity is insufficient.</p>\n\n<p>I would appreciate your comments.</p>\n\n<pre><code>var a = []int{1,2,3}\nfmt.Printf(\"%p\\n\",&amp;a)\nb:=a\nfmt.Printf(\"%p\\n\",&amp;b) 1)\u3001the first question\nb=append(b,0)\nfmt.Printf(\"%p\\n\",&amp;b) 2)\u3001the second question\nfmt.Println(a)\nfmt.Println(b)\n</code></pre>\n\n<p>run result is:</p>\n\n<pre><code>0xc04204c3a0\n0xc04204c3e0\n0xc04204c3e0\n[1 2 3]\n[1 2 3 0]\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2108, "user_id": 1377037, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/b5941b2951d33748024848f82e7bf784?s=128&d=identicon&r=PG", "display_name": "Jonathan Beaudoin", "link": "https://stackoverflow.com/users/1377037/jonathan-beaudoin"}, "edited": false, "score": 0, "creation_date": 1584244683, "post_id": 58793857, "comment_id": 107375639, "body": "Any fix for this?"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12277254, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mD7e__BeHMeymAY5BuPdAn0wQjiAWMZEXMaHSTtJA=k-s128", "display_name": "Bondril13", "link": "https://stackoverflow.com/users/12277254/bondril13"}, "is_accepted": false, "score": 0, "last_activity_date": 1608640969, "creation_date": 1608640969, "answer_id": 65408949, "question_id": 58793857, "link": "https://stackoverflow.com/questions/58793857/robotgo-for-windows-10-fatal-error-zlib-h-no-such-file-or-directory/65408949#65408949", "title": "robotgo for windows 10 - fatal error: zlib.h: No such file or directory", "body": "<p>I try this one below and worked for me <br>\n<a href=\"https://github.com/lowkey42/MagnumOpus/wiki/TDM-GCC-Mingw64-Installation#zlib-x64\" rel=\"nofollow noreferrer\">https://github.com/lowkey42/MagnumOpus/wiki/TDM-GCC-Mingw64-Installation#zlib-x64</a></p>\n<p><strong>download</strong> ZLIB x64 from this <a href=\"https://github.com/lowkey42/MagnumOpus/wiki/TDM-GCC-Mingw64-Installation#zlib-x64\" rel=\"nofollow noreferrer\">link</a> <br></p>\n<blockquote>\n<p>copy _\\zlib\\bin to \\TDM\\bin <br>\ncopy _\\zlib\\bin to \\Git\\bin <br>\ncopy \\zlib\\include to \\TDM\\include <br>\ncopy \\zlib\\lib to \\TDM\\lib <br></p>\n</blockquote>\n"}], "owner": {"reputation": 31, "user_id": 12352788, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-964zl6gG-fY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdSKW3_XKLzgnFuqx8E7IrcI4kKeA/photo.jpg?sz=128", "display_name": "Julia Schwarz", "link": "https://stackoverflow.com/users/12352788/julia-schwarz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 379, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1608640969, "creation_date": 1573428208, "question_id": 58793857, "link": "https://stackoverflow.com/questions/58793857/robotgo-for-windows-10-fatal-error-zlib-h-no-such-file-or-directory", "title": "robotgo for windows 10 - fatal error: zlib.h: No such file or directory", "body": "<p>If I want to run any code with robotgo under windows 10 I get following error:</p>\n\n<pre><code># github.com/go-vgo/robotgo\nIn file included from ./bitmap/../base/str_io_c.h:2:0,\n                 from ./bitmap/goBitmap.h:17,\n                 from ..\\go\\src\\github.com\\go-vgo\\robotgo\\robotgo.go:45:\n./bitmap/../base/zlib_util_c.h:2:18: fatal error: zlib.h: No such file or directory\ncompilation terminated.\n</code></pre>\n\n<p>my PATH variables:</p>\n\n<p><a href=\"https://i.imgur.com/BouDZEV.png\" rel=\"nofollow noreferrer\">https://i.imgur.com/BouDZEV.png</a></p>\n\n<p>Followed the installation and looked through the issues.</p>\n\n<p><a href=\"https://github.com/go-vgo/robotgo#installation\" rel=\"nofollow noreferrer\">https://github.com/go-vgo/robotgo#installation</a></p>\n\n<p>Someone had a similar error here: <a href=\"https://github.com/go-vgo/robotgo/issues/100\" rel=\"nofollow noreferrer\">https://github.com/go-vgo/robotgo/issues/100</a></p>\n\n<p>But their fix \"<em>Solved, should change gcc compiler in the %PATH%</em>\" did not work for me.</p>\n\n<pre><code>import (\n    \"github.com/go-vgo/robotgo\"\n)\n\nfunc main() {\n    robotgo.ScrollMouse(10, \"up\")\n    robotgo.MouseClick(\"left\", true)\n    robotgo.MoveMouseSmooth(100, 200, 1.0, 100.0)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1784, "user_id": 2812237, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/B27re.png?s=128&g=1", "display_name": "Naz", "link": "https://stackoverflow.com/users/2812237/naz"}, "edited": false, "score": 0, "creation_date": 1573424203, "post_id": 58793428, "comment_id": 103868460, "body": "yes, he mentions selects later, but I was wondering what is off in this case"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573424302, "post_id": 58793428, "comment_id": 103868482, "body": "<i>&quot;Which, tbh, makes sense, since the last time, when there is nothing else in the chan, we are trying to pull the value out, and so we get this error.&quot;</i> This sentence suggests that you understand exactly why you&#39;re getting the error... what do you mean by &quot;what is off&quot;?"}, {"owner": {"reputation": 1784, "user_id": 2812237, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/B27re.png?s=128&g=1", "display_name": "Naz", "link": "https://stackoverflow.com/users/2812237/naz"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573424543, "post_id": 58793428, "comment_id": 103868542, "body": "that was a guess. Because according to the video that I linked, this is the pattern one would use to identify when there is nothing else in the channel to break out of the for loop. But this does not happen."}, {"owner": {"reputation": 1784, "user_id": 2812237, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/B27re.png?s=128&g=1", "display_name": "Naz", "link": "https://stackoverflow.com/users/2812237/naz"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573424625, "post_id": 58793428, "comment_id": 103868568, "body": "I think I know the cause! the wg.Done in receive never gets the chance to be called! we break before it, and so then wg.Wait does not know what to do! or not..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573424852, "post_id": 58793428, "comment_id": 103868622, "body": "Breaking is not returning, if the break would be hit then so would be wg.Done, the problem is break is never hit because the if conditional is stuck waiting for the receive. No?"}, {"owner": {"reputation": 1784, "user_id": 2812237, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/B27re.png?s=128&g=1", "display_name": "Naz", "link": "https://stackoverflow.com/users/2812237/naz"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573424988, "post_id": 58793428, "comment_id": 103868648, "body": "correct about the break! and what you say makes sense. But I have seen this ok pattern elsewhere too: <a href=\"https://medium.com/rungo/anatomy-of-channels-in-go-concurrency-in-go-1ec336086adb\" rel=\"nofollow noreferrer\">medium.com/rungo/&hellip;</a> in the for loop section."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573425166, "post_id": 58793428, "comment_id": 103868690, "body": "<i>&quot;The value of ok is true if the value received was delivered by a successful send operation to the channel, or <b>false if it is a zero value generated because the channel is closed and empty</b>.&quot;</i> (<a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Receive_operator</a>) <code>if m, ok := &lt;-msg; ok {</code> will stop blocking once you close the channel, however your close deferred and so is blocked by the bottom wg.Wait"}, {"owner": {"reputation": 1784, "user_id": 2812237, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/B27re.png?s=128&g=1", "display_name": "Naz", "link": "https://stackoverflow.com/users/2812237/naz"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573425339, "post_id": 58793428, "comment_id": 103868730, "body": "good spot! How do I close it in this case without deferring? other goroutines might still be sending"}, {"owner": {"reputation": 1784, "user_id": 2812237, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/B27re.png?s=128&g=1", "display_name": "Naz", "link": "https://stackoverflow.com/users/2812237/naz"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573425624, "post_id": 58793428, "comment_id": 103868790, "body": "one option might be sending an additional param to the produce function that is a flag, that if set to true triggers the close call inside of the producer. Do not know how conventional this is and whether this is golang best practices."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573425651, "post_id": 58793428, "comment_id": 103868801, "body": "To be honest I&#39;m not 100% sure this is correct, and if it is i&#39;m not sure whether it is the preferred approach, but here goes: <a href=\"https://play.golang.com/p/dKnJP7Y9tuq\" rel=\"nofollow noreferrer\">play.golang.com/p/dKnJP7Y9tuq</a>"}, {"owner": {"reputation": 1784, "user_id": 2812237, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/B27re.png?s=128&g=1", "display_name": "Naz", "link": "https://stackoverflow.com/users/2812237/naz"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573426498, "post_id": 58793428, "comment_id": 103868996, "body": "It works :) Nice idea about two wait groups! Feel free to post the answer. Thanks for your help! I will have a look at using selects in this context now."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573455529, "post_id": 58793428, "comment_id": 103874472, "body": "If you want you can go ahead and accept any of the provided answers, I&#39;m a bit too lazy to write out mine ;)."}], "answers": [{"tags": [], "owner": {"reputation": 8387, "user_id": 3756168, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/xqUim.jpg?s=128&g=1", "display_name": "Badis Merabet", "link": "https://stackoverflow.com/users/3756168/badis-merabet"}, "is_accepted": false, "score": 0, "last_activity_date": 1573431229, "last_edit_date": 1573431229, "creation_date": 1573428870, "answer_id": 58793915, "question_id": 58793428, "link": "https://stackoverflow.com/questions/58793428/multiple-producers-single-consumer-all-goroutines-are-asleep-deadlock/58793915#58793915", "title": "Multiple producers, single consumer: all goroutines are asleep - deadlock", "body": "<p>Try this code, I have made few fixes that made it work:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n    \"sync\"\n)\n\ntype message struct {\n    body string\n    code int\n}\n\nvar markets []string = []string{\"BTC\", \"ETH\", \"LTC\"}\n\n// produces messages into the chan\nfunc produce(n int, market string, msg chan&lt;- message, wg *sync.WaitGroup) {\n    // for i := 0; i &lt; n; i++ {\n    var msgToSend = message{\n        body: strings.Join([]string{\"market: \", market, \", #\", strconv.Itoa(1)}, \"\"),\n        code: 1,\n    }\n    fmt.Println(\"Producing:\", msgToSend)\n    msg &lt;- msgToSend\n    // }\n\n}\n\nfunc receive(msg &lt;-chan message, wg *sync.WaitGroup) {\n    for {\n        if m, ok := &lt;-msg; ok {\n            fmt.Println(\"Received:\", m)\n            wg.Done()\n        }\n    }\n}\n\nfunc consume(msg &lt;-chan message) {\n  for {\n    if m, ok := &lt;-msg; ok {\n      fmt.Println(\"More messages:\", m)\n    } else {\n      break\n    }\n  }\n}\n\nfunc main() {\n    wg := sync.WaitGroup{}\n    msgC := make(chan message, 100)\n    defer func() {\n        close(msgC)\n    }()\n    for ix, market := range markets {\n        wg.Add(1)\n        go produce(ix+1, market, msgC, &amp;wg)\n    }\n\n    go receive(msgC, &amp;wg)\n    wg.Wait()\n    fmt.Println(\"Breaking from receiving\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 7293977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FC0K6.jpg?s=128&g=1", "display_name": "mbyd916", "link": "https://stackoverflow.com/users/7293977/mbyd916"}, "is_accepted": false, "score": 0, "last_activity_date": 1573442278, "creation_date": 1573442278, "answer_id": 58795139, "question_id": 58793428, "link": "https://stackoverflow.com/questions/58793428/multiple-producers-single-consumer-all-goroutines-are-asleep-deadlock/58795139#58795139", "title": "Multiple producers, single consumer: all goroutines are asleep - deadlock", "body": "<p>Only when <code>main</code> returns, you can <code>close(msgC)</code>, but meanwhile <code>receive</code> is waiting for <code>close</code> signal, that's why DeadLock occurs. After producing messages, close the channel.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n    \"sync\"\n)\n\ntype message struct {\n    body string\n    code int\n}\n\nvar markets []string = []string{\"BTC\", \"ETH\", \"LTC\"}\n\n// produces messages into the chan\nfunc produce(n int, market string, msg chan&lt;- message, wg *sync.WaitGroup) {\n    // for i := 0; i &lt; n; i++ {\n    var msgToSend = message{\n        body: strings.Join([]string{\"market: \", market, \", #\", strconv.Itoa(1)}, \"\"),\n        code: 1,\n    }\n    fmt.Println(\"Producing:\", msgToSend)\n    msg &lt;- msgToSend\n    // }\n    wg.Done()\n}\n\nfunc receive(msg &lt;-chan message, wg *sync.WaitGroup) {\n    for {\n        if m, ok := &lt;-msg; ok {\n            fmt.Println(\"Received:\", m)\n        } else {\n            fmt.Println(\"Breaking from receiving\")\n            break\n        }\n    }\n    wg.Done()\n}\n\nfunc main() {\n    wg := sync.WaitGroup{}\n    msgC := make(chan message, 100)\n    // defer func() {\n    //  close(msgC)\n    // }()\n    for ix, market := range markets {\n        wg.Add(1)\n        go produce(ix+1, market, msgC, &amp;wg)\n    }\n    wg.Wait() // wait for producer\n    close(msgC)\n    wg.Add(1)\n    go receive(msgC, &amp;wg)\n    wg.Wait()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1784, "user_id": 2812237, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/B27re.png?s=128&g=1", "display_name": "Naz", "link": "https://stackoverflow.com/users/2812237/naz"}, "edited": false, "score": 0, "creation_date": 1573465980, "post_id": 58795744, "comment_id": 103878477, "body": "I love this. This is exactly what I was looking for, explanation for why it doesn&#39;t work, so that I avoid it. Thank you very much torek. I will have a read through this properly today and will accept the answer."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 2, "last_activity_date": 1573448148, "creation_date": 1573448148, "answer_id": 58795744, "question_id": 58793428, "link": "https://stackoverflow.com/questions/58793428/multiple-producers-single-consumer-all-goroutines-are-asleep-deadlock/58795744#58795744", "title": "Multiple producers, single consumer: all goroutines are asleep - deadlock", "body": "<p>Given that you do have multiple writers on a single channel, you have a bit of a challenge, because the easy way to do this in Go in general is to have a single writer on a single channel, and then have that single writer close the channel upon sending the last datum:</p>\n\n<pre><code>func produce(... args including channel) {\n    defer close(ch)\n    for stuff_to_produce {\n        ch &lt;- item\n    }\n}\n</code></pre>\n\n<p>This pattern has the nice property that no matter how you get out of <code>produce</code>, the channel gets closed, signalling the end of production.</p>\n\n<p>You're not using this pattern\u2014you deliver one channel to many goroutines, each of which can send <em>one</em> message\u2014so you need to move the <code>close</code> (or, of course, use yet some other pattern).  The simplest way to express the pattern you need is this:</p>\n\n<pre><code>func overall_produce(... args including channel ...) {\n    var pg sync.WaitGroup\n    defer close(ch)\n    for stuff_to_produce {\n        pg.Add(1)\n        go produceInParallel(ch, &amp;pg) // add more args if appropriate\n    }\n    pg.Wait()\n}\n</code></pre>\n\n<p>The <code>pg</code> counter accumulates active producers.  Each must call <code>pg.Done()</code> to indicate that it is done using <code>ch</code>.  The overall producer now waits for them all to be done, then <em>it</em> closes the channel on its way out.</p>\n\n<p>(If you write the inner <code>produceInParallel</code> function as a closure, you don't need to pass <code>ch</code> and <code>pg</code> to it explicitly.  You may also write <code>overallProducer</code> as a closure.)</p>\n\n<p>Note that your single consumer's loop is probably best expressed using the <code>for ... range</code> construct:</p>\n\n<pre><code>func receive(msg &lt;-chan message, wg *sync.WaitGroup) {\n    for m := range msg {\n        fmt.Println(\"Received:\", m)\n    }\n    wg.Done()\n}\n</code></pre>\n\n<p>(You mention an intent to add a <code>select</code> to the loop so that you can do some other computing if a message is not yet ready.  If that code cannot be spun off into independent goroutines, you will in fact need the fancier <code>m, ok := &lt;-msg</code> construct.)</p>\n\n<p>Note also that the <code>wg</code> for <code>receive</code>\u2014which may turn out to be unnecessary, depending on how you structure other things\u2014is quite independent from the wait-group <code>pg</code> for the producers.  While it's true that, as written, the consumer cannot be done until all the producers are done, we'd like to wait independently for the producers to be done, so that we can close the channel in the overall-producer wrapper.</p>\n"}], "owner": {"reputation": 1784, "user_id": 2812237, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/B27re.png?s=128&g=1", "display_name": "Naz", "link": "https://stackoverflow.com/users/2812237/naz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 1, "accepted_answer_id": 58795744, "answer_count": 3, "score": 2, "last_activity_date": 1573448148, "creation_date": 1573423973, "question_id": 58793428, "link": "https://stackoverflow.com/questions/58793428/multiple-producers-single-consumer-all-goroutines-are-asleep-deadlock", "title": "Multiple producers, single consumer: all goroutines are asleep - deadlock", "body": "<p>I have been following a pattern of checking if there is anything in the channel before proceeding with work:</p>\n\n<pre><code>func consume(msg &lt;-chan message) {\n  for {\n    if m, ok := &lt;-msg; ok {\n      fmt.Println(\"More messages:\", m)\n    } else {\n      break\n    }\n  }\n}\n</code></pre>\n\n<p>that is based on this <a href=\"https://youtu.be/YS4e4q9oBaU?t=23240\" rel=\"nofollow noreferrer\">video</a>. Here is my full code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n    \"sync\"\n)\n\ntype message struct {\n    body string\n    code int\n}\n\nvar markets []string = []string{\"BTC\", \"ETH\", \"LTC\"}\n\n// produces messages into the chan\nfunc produce(n int, market string, msg chan&lt;- message, wg *sync.WaitGroup) {\n    // for i := 0; i &lt; n; i++ {\n    var msgToSend = message{\n        body: strings.Join([]string{\"market: \", market, \", #\", strconv.Itoa(1)}, \"\"),\n        code: 1,\n    }\n    fmt.Println(\"Producing:\", msgToSend)\n    msg &lt;- msgToSend\n    // }\n    wg.Done()\n}\n\nfunc receive(msg &lt;-chan message, wg *sync.WaitGroup) {\n    for {\n        if m, ok := &lt;-msg; ok {\n            fmt.Println(\"Received:\", m)\n        } else {\n            fmt.Println(\"Breaking from receiving\")\n            break\n        }\n    }\n    wg.Done()\n}\n\nfunc main() {\n    wg := sync.WaitGroup{}\n    msgC := make(chan message, 100)\n    defer func() {\n        close(msgC)\n    }()\n    for ix, market := range markets {\n        wg.Add(1)\n        go produce(ix+1, market, msgC, &amp;wg)\n    }\n    wg.Add(1)\n    go receive(msgC, &amp;wg)\n    wg.Wait()\n}\n</code></pre>\n\n<p>If you try to run it, we get the deadlock at the very end before we ever print a message that we are about to break. Which, tbh, makes sense, since the last time, when there is nothing else in the chan, we are trying to pull the value out, and so we get this error. But then this pattern isn't workable <code>if m, ok := &lt;- msg; ok</code>. How do I make this code work &amp; why do I get this deadlock error (presumably this pattern should work?).</p>\n"}, {"tags": ["go", "encryption", "https"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1573456471, "post_id": 58793367, "comment_id": 103874767, "body": "<a href=\"https://golang.org/pkg/crypto/tls/#example_Config_keyLogWriter\" rel=\"nofollow noreferrer\">golang.org/pkg/crypto/tls/#example_Config_keyLogWriter</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1266, "user_id": 8035711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54251e31927388d864e8f2fc49fdce27?s=128&d=identicon&r=PG", "display_name": "keser", "link": "https://stackoverflow.com/users/8035711/keser"}, "edited": false, "score": 0, "creation_date": 1585986934, "post_id": 58794750, "comment_id": 107962682, "body": "hey, didn&#39;t want to open a duplicate. can you elaborate a little bit further?"}], "tags": [], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "is_accepted": false, "score": 1, "last_activity_date": 1573438244, "creation_date": 1573438244, "answer_id": 58794750, "question_id": 58793367, "link": "https://stackoverflow.com/questions/58793367/how-to-decrypt-https-packet/58794750#58794750", "title": "How to decrypt HTTPS packet", "body": "<p>You can look at the TCP packets the same way, there won't be much difference, but obviously the payload (at least) will be encrypted.</p>\n\n<p>To decrypt them, you could wrap them in a type that implements <code>net.Conn</code> and then use <code>crypto/tls</code> to read. It's not a small interface though.</p>\n\n<p>Otherwise you can implement the decrypt function yourself, with the code from <code>crypto/tls</code> as an example: <a href=\"https://golang.org/src/crypto/tls/conn.go?s=38163:38205#L318\" rel=\"nofollow noreferrer\">https://golang.org/src/crypto/tls/conn.go?s=38163:38205#L318</a></p>\n"}], "owner": {"reputation": 9, "user_id": 7153109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a996c9aae9b485d4329766535c1f1f4?s=128&d=identicon&r=PG&f=1", "display_name": "NullByte", "link": "https://stackoverflow.com/users/7153109/nullbyte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 285, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1573463261, "creation_date": 1573423489, "last_edit_date": 1573463261, "question_id": 58793367, "link": "https://stackoverflow.com/questions/58793367/how-to-decrypt-https-packet", "title": "How to decrypt HTTPS packet", "body": "<p>With Go I can get http packets using gopacket, I have a certificate I want to obtain https packets, but I can't decrypt the package?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 322, "user_id": 8399906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4b20fa1357bb11e0ba2eab0d5b358ed?s=128&d=identicon&r=PG", "display_name": "CJW", "link": "https://stackoverflow.com/users/8399906/cjw"}, "edited": false, "score": 0, "creation_date": 1573421444, "post_id": 58793099, "comment_id": 103867885, "body": "/facepalm Thanks very much"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1573421374, "creation_date": 1573421374, "answer_id": 58793099, "question_id": 58793075, "link": "https://stackoverflow.com/questions/58793075/range-over-a-slice-of-a-struct/58793099#58793099", "title": "Range over a slice of a struct", "body": "<p><code>Data.Quotes.Legs</code> is not an array. <code>Data.Quotes</code> is:</p>\n\n<pre><code>var data Data\n...\nfor _, v := range data.Quotes {\n        fmt.Println(v.Legs.ID)\n}\n</code></pre>\n"}], "owner": {"reputation": 322, "user_id": 8399906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4b20fa1357bb11e0ba2eab0d5b358ed?s=128&d=identicon&r=PG", "display_name": "CJW", "link": "https://stackoverflow.com/users/8399906/cjw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 58793099, "answer_count": 1, "score": -3, "last_activity_date": 1573421374, "creation_date": 1573421181, "question_id": 58793075, "link": "https://stackoverflow.com/questions/58793075/range-over-a-slice-of-a-struct", "title": "Range over a slice of a struct", "body": "<p>I have a struct that contains a slice of a struct and I am trying to retrieve the data from the inner struct. Here is an example of the struct:</p>\n\n<pre><code>type Data struct {\n    Quotes []struct {\n        Direct      bool    `json:\"Direct\"`\n        Legs struct {\n            ID int    `json:\"Id\"`\n        } `json:\"Legs\"`\n    }\n}\n</code></pre>\n\n<p>From the above code I would like to retrieve the value in ID. Here is what I have tried already:</p>\n\n<pre><code>    for _, v := range Data.Quotes.Legs {\n        fmt.Println(v.ID)\n    }\n</code></pre>\n\n<p>But I get the following error:</p>\n\n<pre><code> Has no field or method Legs\n</code></pre>\n\n<p>This works if I just want the value in Direct:</p>\n\n<pre><code>    for _, v := range Data.Quotes {\n        fmt.Println(v.Direct)\n    }\n</code></pre>\n\n<p>Does anyone have suggestions on how to do this?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1573421389, "post_id": 58793081, "comment_id": 103867871, "body": "I&#39;ve used combine output in the past and got some issues, than I switch to this option..., can you provide example for the second ?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1573421529, "post_id": 58793081, "comment_id": 103867902, "body": "Added a snippet for one of the streams"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1573421582, "post_id": 58793081, "comment_id": 103867909, "body": "can you explain how it could help ?"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1573421634, "post_id": 58793081, "comment_id": 103867918, "body": "also which one of them I should use first ?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1573421733, "post_id": 58793081, "comment_id": 103867936, "body": "By reading the streams from goroutines, you can read from both of them as the executing program produces output. If you read from stdin first, but the program produces output for stderr, then the program will hang if stderr buffer is full."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1573421777, "post_id": 58793081, "comment_id": 103867946, "body": "If you start two goroutines, it doesn&#39;t matter which you started first. They will read from the input/error streams concurrently."}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1573421865, "post_id": 58793081, "comment_id": 103867965, "body": "ahh, a bit confused, should my function (the first option ) should remain the same and I should only add goroutine as your example or ??? can you please add the full picture ?"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1573422139, "post_id": 58793081, "comment_id": 103868035, "body": "please see my update, should it be like the third option?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1573424578, "post_id": 58793081, "comment_id": 103868553, "body": "That&#39;s what I was describing."}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1573545156, "post_id": 58793081, "comment_id": 103906481, "body": "Thanks, one question, shouldnt the outer-function have the same either ? I mean the function <code>exec</code> ?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1573568806, "post_id": 58793081, "comment_id": 103918372, "body": "You mean, exec should be in a separate goroutine? If that&#39;s what you&#39;re asking, then no."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1573421517, "last_edit_date": 1573421517, "creation_date": 1573421210, "answer_id": 58793081, "question_id": 58793004, "link": "https://stackoverflow.com/questions/58793004/go-scan-buffer-hangs-sometimes/58793081#58793081", "title": "Go scan buffer hangs sometimes", "body": "<p>In the first case, you're reading from stdout of the process until the process ends. Then you read from the stderr. In the second case you read from err first, then out. You should be reading from both of them. Either use Cmd.CombinedOutput which will return both of them, or start two goroutines, one reading from stdin and one reading from stderr until the streams close.</p>\n\n<pre><code>scanout := bufio.NewScanner(stdout)\nscanout.Split(bufio.ScanRunes)\ngo func() {\n    for scanout.Scan() {\n        fmt.Print(scanout.Text())\n     }\n}()\n</code></pre>\n"}], "owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 1, "accepted_answer_id": 58793081, "answer_count": 1, "score": 1, "last_activity_date": 1573422108, "creation_date": 1573420564, "last_edit_date": 1573422108, "question_id": 58793004, "link": "https://stackoverflow.com/questions/58793004/go-scan-buffer-hangs-sometimes", "title": "Go scan buffer hangs sometimes", "body": "<p>I use the following code which works ok, however in some cases the process stuck and I dont see any output. example this code runs <code>npm install</code> or <code>mvn clean install</code> and most of the time it works well but sometimes it hangs and you dont get any output</p>\n\n<pre><code>func exec(stdout io.Reader, stderr io.Reader) (*bufio.Scanner, *bufio.Scanner) {\n    scanout := bufio.NewScanner(stdout)\n    scanerr := bufio.NewScanner(stderr)\n\n    scanout.Split(bufio.ScanRunes)\n    for scanout.Scan() {\n        fmt.Print(scanout.Text())\n    }\n\n    scanerr.Split(bufio.ScanRunes)\n    for scanerr.Scan() {\n        fmt.Print(scanerr.Text())\n    }\n    return scanout, scanerr\n}\n</code></pre>\n\n<p>Now if I change the order like following (err first and stdout second) I got some error output when the command hangs however I don't see the output online , when you run the command you see some output and when the finished you see all the rest . you can wait for the output for 2 min and more and you get long output at once at the end of the process. </p>\n\n<p>How can I fix that I will be able to get the output online and also get some feedback when the process hangs?</p>\n\n<pre><code>func exec(stdout io.Reader, stderr io.Reader) (*bufio.Scanner, *bufio.Scanner) {\n    scanout := bufio.NewScanner(stdout)\n    scanerr := bufio.NewScanner(stderr)\n\n    scanout.Split(bufio.ScanRunes)\n    for scanout.Scan() {\n        fmt.Print(scanout.Text())\n    }\n    scanerr.Split(bufio.ScanRunes)\n    for scanerr.Scan() {\n        fmt.Print(scanerr.Text())\n    }\n\n\n    }\n    return scanout, scanerr\n}\n</code></pre>\n\n<p><strong>update</strong> </p>\n\n<p>Should it be like this ?</p>\n\n<pre><code>func exec(stdout io.Reader, stderr io.Reader) (*bufio.Scanner, *bufio.Scanner) {\n\nscanout := bufio.NewScanner(stdout)\nscanout.Split(bufio.ScanRunes)\ngo func() {\n    for scanout.Scan() {\n        fmt.Print(scanout.Text())\n     }\n}()\n\ngo func() {\nscanerr.Split(bufio.ScanRunes)\n        for scanerr.Scan() {\n            fmt.Print(scanerr.Text())\n        }\n}()\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1573418275, "post_id": 58792524, "comment_id": 103867075, "body": "One problem is that the application discards the bufio.Readers and any data they may have buffered.  Create the readers outside of the loop."}, {"owner": {"reputation": 693, "user_id": 10597010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/821e01d36dc0b3f27eb2b3c9bc2db5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Devy", "link": "https://stackoverflow.com/users/10597010/devy"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1573418990, "post_id": 58792524, "comment_id": 103867283, "body": "@CeriseLim&#243;n I tried to put the reader outside loop and now I see server&#39;s message as expected, thank you"}], "answers": [{"comments": [{"owner": {"reputation": 693, "user_id": 10597010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/821e01d36dc0b3f27eb2b3c9bc2db5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Devy", "link": "https://stackoverflow.com/users/10597010/devy"}, "edited": false, "score": 0, "creation_date": 1573417452, "post_id": 58792599, "comment_id": 103866866, "body": "I tried this already, now the looks like client hangs, without printing nothing at client side"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 693, "user_id": 10597010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/821e01d36dc0b3f27eb2b3c9bc2db5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Devy", "link": "https://stackoverflow.com/users/10597010/devy"}, "edited": false, "score": 0, "creation_date": 1573418357, "post_id": 58792599, "comment_id": 103867105, "body": "The server first sends the message asking name, then waits for input. However, the prompt asking for input does not end with a newline. Maybe you can handle this first exchange as a special case, and wait for &#39;:&#39;?"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": -1, "last_activity_date": 1573417265, "creation_date": 1573417265, "answer_id": 58792599, "question_id": 58792524, "link": "https://stackoverflow.com/questions/58792524/connecting-to-server-with-client-behaves-differently-from-telnet/58792599#58792599", "title": "connecting to server with client behaves differently from telnet", "body": "<p>You are reading from stdin first, and then sending that to the server. If the server sends the \"Please Enter Name\" string, then you have to first read from the server, and then read from stdin, and write what you read to the server.</p>\n\n<pre><code>for {\n        message, _ := bufio.NewReader(conn).ReadString('\\n')\n        fmt.Print(\"Message from server: \" + message)\n        // read in input from stdin\n        reader := bufio.NewReader(os.Stdin)\n        fmt.Print(\"Write to send: \")\n        text, _ := reader.ReadString('\\n')\n        // send to socket\n        fmt.Fprintf(conn, text)\n    }\n</code></pre>\n"}], "owner": {"reputation": 693, "user_id": 10597010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/821e01d36dc0b3f27eb2b3c9bc2db5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Devy", "link": "https://stackoverflow.com/users/10597010/devy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1573421418, "creation_date": 1573416751, "last_edit_date": 1573421418, "question_id": 58792524, "link": "https://stackoverflow.com/questions/58792524/connecting-to-server-with-client-behaves-differently-from-telnet", "title": "connecting to server with client behaves differently from telnet", "body": "<p>I want to write a simple client to <a href=\"https://github.com/dbnegative/go-telnet-chatserver\" rel=\"nofollow noreferrer\">this Go server</a>. when I connect to the server from CMD with telnet it works fine i.e. when the client connects, the server asks for user name, but when I try to connect from the following client:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"net\"\n    \"os\"\n)\n\nfunc main() {\n\n    // connect to this socket\n    conn, _ := net.Dial(\"tcp\", \"127.0.0.1:8181\")\n    for {\n        // read in input from stdin\n        reader := bufio.NewReader(os.Stdin)\n        fmt.Print(\"Write to send: \")\n        text, _ := reader.ReadString('\\n')\n\n        // send to socket\n        fmt.Fprintf(conn, text)\n        // listen for reply\n        message, _ := bufio.NewReader(conn).ReadString('\\n')\n        fmt.Print(\"Message from server: \" + message)\n    }\n}\n\n</code></pre>\n\n<p>The server always stays behind in one message. For example, after I run the server and trying to connect from client:</p>\n\n<p>Server Output:</p>\n\n<pre><code>D:\\&gt;go run server.go\n2019/11/10 22:07:19 listening on:  127.0.0.1:8181\n2019/11/10 22:07:24 createclient: remote connection from: 127.0.0.1:55565\n2019/11/10 22:07:29 new client created: 127.0.0.1:55565 devy\n</code></pre>\n\n<p>Client Output:</p>\n\n<pre><code>D:\\&gt;go run client.go\nWrite to send: devy\nMessage from server: Please Enter Name: ---------------------------\nWrite to send:\n</code></pre>\n\n<p>But I want that the message \"Please Enter Name: ---------------------------\" from server would displayed first when client logged in</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1573415908, "post_id": 58792346, "comment_id": 103866469, "body": "The printPointer method is called with address of <code>numbers</code> as the receiver argument.  The print statement in main and the first print statement in printPointer print the same value."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1573416055, "creation_date": 1573416055, "answer_id": 58792435, "question_id": 58792346, "link": "https://stackoverflow.com/questions/58792346/what-memory-value-of-slice-pointer-means/58792435#58792435", "title": "What memory value of slice pointer means?", "body": "<p><code>numbers</code> in <code>main</code> is a slice, so you can think of it as a struct with three values, ptr to underlying array, length, capacity. When you print <code>&amp;numbers</code>, you're printing the address of this struct.</p>\n\n<p><code>printPointer</code> has a pointer receiver, so in <code>printPointer</code>, <code>m</code> is a pointer to the struct defined in <code>main</code>. That's why when you print <code>m</code>, you get the same value you printed in <code>main</code>. When you print <code>&amp;m</code>, you're printing the value of a pointer to a pointer. <code>&amp;m</code> is a pointer that points to the receiver of the function, which points to <code>m</code> in <code>main</code>.</p>\n\n<p><code>printSlice</code> gets a copy of <code>m</code>. So when you print <code>&amp;m</code>, you print the address of that copy.</p>\n"}], "owner": {"reputation": 23, "user_id": 11521907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af69a33ad20de66598a66b8edab346dc?s=128&d=identicon&r=PG&f=1", "display_name": "sad_jane", "link": "https://stackoverflow.com/users/11521907/sad-jane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 58792435, "answer_count": 1, "score": -1, "last_activity_date": 1573416055, "creation_date": 1573415363, "question_id": 58792346, "link": "https://stackoverflow.com/questions/58792346/what-memory-value-of-slice-pointer-means", "title": "What memory value of slice pointer means?", "body": "<p>I am trying to understand pointers in go, but I am still a little bit confused, how they work.</p>\n\n<p>I already look at other question on SO: <a href=\"https://stackoverflow.com/questions/22811138/print-the-address-of-slice-in-golang\">print the Address of slice in golang</a> , <a href=\"https://stackoverflow.com/questions/4938612/how-do-i-print-the-pointer-value-of-a-go-object-what-does-the-pointer-value-mea\">How do I print the pointer value of a Go object? What does the pointer value mean?</a> , but still couldn't wrap my mind around this concept.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    numbers := myNumbers{42}\n    println(\"Pointer to numbers\", &amp;numbers)\n    numbers.printSlice()\n    numbers.printPointer()\n}\n\ntype myNumbers []int\n\nfunc (m myNumbers) printSlice() {\n    fmt.Printf(\"printSlice - value of m:  %p \\n\", m)\n    fmt.Printf(\"printSlice - value of &amp;m: %p\\n\", &amp;m)\n}\n\nfunc (m *myNumbers) printPointer() {\n    fmt.Printf(\"printPointer - value of m:  %p\\n\", m)\n    fmt.Printf(\"printPointer - value of &amp;m:  %p\\n\", &amp;m)\n}\n\n</code></pre>\n\n<p>And output is:</p>\n\n<pre><code>Pointer to numbers 0xc42000a060\nprintSlice - value of m:  0xc420016100 \nprintSlice - value of &amp;m: 0xc42000a080\nprintPointer - value of m:  0xc42000a060\nprintPointer - value of &amp;m:  0xc42000c030\n</code></pre>\n\n<p>As per go documentation in <code>printSlice</code>, the first line will print the address of the first element of the array, the second line will print the address of copy of slice header </p>\n\n<p>In <code>printPointer</code>, the first line will print the value of the pointer, the second line will print the address of the pointer</p>\n\n<p>In <code>main</code> <code>prinln</code> prints the same address as the first line of <code>printPointer</code>, so does it mean that in <code>printPointer</code> I've got a pointer which points to an original pointer?</p>\n\n<p>Are the above assumptions correct?</p>\n"}, {"tags": ["go", "struct", "append", "slice"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11217893"}, "edited": false, "score": 0, "creation_date": 1573419456, "post_id": 58792461, "comment_id": 103867394, "body": "\u2014 I tried doing the above like the following but keep getting <code>undefined: ProductDescription</code> <code>func ItemsDB() {     Items = append(Items,         types.Item{             ID:                 &quot;1&quot;,             Item:               &quot;fruit&quot;,             ProductDescription: []ProductDescription{                 {ShortDescription: &quot;banana&quot;},             },         } }</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573419938, "post_id": 58792461, "comment_id": 103867529, "body": "You need to qualify it with the package name just like you&#39;re doing with <code>Item</code>."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1573419946, "post_id": 58792461, "comment_id": 103867530, "body": "Looks like ProductDescription is in types package. I fixed the answer to include that."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 2, "last_activity_date": 1573419924, "last_edit_date": 1573419924, "creation_date": 1573416266, "answer_id": 58792461, "question_id": 58792341, "link": "https://stackoverflow.com/questions/58792341/how-to-append-data-to-a-slice-that-is-formatted-by-a-nested-struct/58792461#58792461", "title": "How to append data to a Slice that is formatted by a Nested Struct", "body": "<p><code>ProductDescription</code> is an array, your syntax is initializing a struct. Try this:</p>\n\n<pre><code>ProductDescription: []types.ProductDescription{\n   {  ShortDescription: \"banana\"}\n }\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11217893"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1573419924, "creation_date": 1573415327, "question_id": 58792341, "link": "https://stackoverflow.com/questions/58792341/how-to-append-data-to-a-slice-that-is-formatted-by-a-nested-struct", "title": "How to append data to a Slice that is formatted by a Nested Struct", "body": "<p>I am trying to append some data into a slice based off of my struct. </p>\n\n<p>In attempting to do this, I tried splitting up my struct into two separate ones. This was unsuccessful. Every-time I tried to append the slice, i would get an error: <code>missing type in composite literal</code>. I tried googling this but i can't seem to figure it out.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\n// Separate File in types folder\ntype Item struct {\n    ID                 string `json:\"id\"`\n    Item               string `json:\"item\"`\n    ProductDescription []ProductDescription\n}\n\n// Separate File in types folder\ntype ProductDescription struct {\n    ShortDescription    string `json:\"short_description\"`\n}\n\n\n//Items Slice holds ItemsDB\nvar Items []types.Item\n\nfunc ItemsDB() {\n    Items = append(Items,\n        types.Item{\n            ID:                 \"1\",\n            Item:               \"fruit\",\n            ProductDescription: {\n                ShortDescription: \"banana\",\n            },\n        },\n        types.CoreItem{\n            ID:                 \"1\",\n            Item:               \"dairy\",\n            ProductDescription: {\n                ShortDescription, \"milk\",\n            },\n        },\n    )\n}\n</code></pre>\n\n<p>An expected result would be:</p>\n\n<pre><code>{\n\n{\"id\": \"1\", \"item\": \"fruit\", \"product_descriptions\": {\"short_description\": \"banana\"},\n\n{\"id\": \"1\", \"item\": \"fruit\", \"product_descriptions\": {\"short_description\": \"banana\"}\n\n}\n</code></pre>\n"}, {"tags": ["postgresql", "go", "libpq"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1573418653, "post_id": 58791887, "comment_id": 103867191, "body": "Can you update the code in your question to be a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">Minimal, Reproducible Example</a>? As it is, there&#39;s no obvious error in your code, so no way really to help."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573419810, "post_id": 58791887, "comment_id": 103867492, "body": "You&#39;re missing a comma in the select between <code>user_salt</code> and <code>user_verified</code>, that is the same thing as writing <code>user_salt AS user_verified</code>, i.e. you&#39;re selecting only <code>user_salt</code> and aliasing it as <code>user_verified</code> and skipping the actual <code>user_verified</code> column."}, {"owner": {"reputation": 31, "user_id": 12352048, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSGRr.jpg?s=128&g=1", "display_name": "Violet", "link": "https://stackoverflow.com/users/12352048/violet"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573445582, "post_id": 58791887, "comment_id": 103872120, "body": "@mkopriva Oh my goodness! You&#39;re right. I&#39;m sorry, it&#39;s been such a long night. Didn&#39;t know about that functionality though, thank you!"}], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 12352048, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSGRr.jpg?s=128&g=1", "display_name": "Violet", "link": "https://stackoverflow.com/users/12352048/violet"}, "is_accepted": true, "score": 0, "last_activity_date": 1573445713, "creation_date": 1573445713, "answer_id": 58795478, "question_id": 58791887, "link": "https://stackoverflow.com/questions/58791887/db-queryrow-returning-the-wrong-number-of-arguments/58795478#58795478", "title": "db.QueryRow() returning the wrong number of arguments", "body": "<p>Oops - I missed a commma between <code>user_salt</code> and <code>user_verified</code>. Thanks <a href=\"https://stackoverflow.com/users/965900/mkopriva\">mkopriva</a> for the help.</p>\n"}], "owner": {"reputation": 31, "user_id": 12352048, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSGRr.jpg?s=128&g=1", "display_name": "Violet", "link": "https://stackoverflow.com/users/12352048/violet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 58795478, "answer_count": 1, "score": 0, "last_activity_date": 1573445713, "creation_date": 1573411772, "last_edit_date": 1573418490, "question_id": 58791887, "link": "https://stackoverflow.com/questions/58791887/db-queryrow-returning-the-wrong-number-of-arguments", "title": "db.QueryRow() returning the wrong number of arguments", "body": "<p>I have a file called <code>user.go</code>, the function <code>GetUserByUsernameOrEmail</code> returns the user model and an error. It grabs this user information from the database.</p>\n\n<p>My goal is to get all parameters I <code>SELECT</code> of the user, but it returns one fewer than it should.</p>\n\n<p>This is for a REST API, however the model itself is really the problem. The user has fields <code>user_id</code> uuid, <code>user_username</code> string, <code>user_email</code> string, <code>user_hash</code> string, <code>user_salt</code> string, <code>user_verified</code> bool, <code>user_admin</code> bool, <code>user_email_verified</code> bool.</p>\n\n<p>I haven't tried much as I'm at a loss for steps to continue. To debug, however, I created 8 test variables <code>test, test2...test8</code>. I print all 8 variables (for more on this, see below).</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    var test string\n    var test2 string\n    var test3 string\n    var test4 string\n    var test5 string\n    var test6 string\n    var test7 string\n    var test8 string\n\n    err = db.QueryRow(`\n        SELECT \n            user_id, \n            user_username, \n            user_email, \n            user_hash,\n            user_salt\n            user_verified,\n            user_admin,\n            user_email_verified \n        FROM users\n        WHERE user_`+field+`= $1\n    `, value).Scan(&amp;test, &amp;test2, &amp;test3, &amp;test4, &amp;test5, &amp;test6, &amp;test7, &amp;test8)\n</code></pre>\n\n<p><strong>Expected</strong>: I scan the 8 fields to my 8 variables, and go on with my day.<br>\n<strong>Actual</strong>: <code>2019/11/10 10:36:42 sql: expected 7 destination arguments in Scan, not 8</code></p>\n\n<p><strong>Some other things to note</strong>\nI did scan it to 7 variables to test, and got this when logging the 7 variables:</p>\n\n<pre><code>5e5d2f4a-1f5b-418d-a262-a63c719a3ea4 test test@[domain].com [hash] [salt] false false\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573409251, "post_id": 58791515, "comment_id": 103864651, "body": "Try trimming whitespace. See the <code>strings</code> package for that."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573419562, "post_id": 58791515, "comment_id": 103867416, "body": "Try <code>fmt.Printf(&quot;%q\\n&quot;, text)</code> to find out what the &quot;invisible&quot; characters are. Also note that <code>fmt.Print</code> takes any type of argument, so there is no need to convert the result of <code>len</code> into a string, it&#39;s enough to use <code>fmt.Print(len(text))</code>. <a href=\"https://play.golang.com/p/Y526qFDbmbD\" rel=\"nofollow noreferrer\">play.golang.com/p/Y526qFDbmbD</a>"}], "answers": [{"comments": [{"owner": {"reputation": 693, "user_id": 10597010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/821e01d36dc0b3f27eb2b3c9bc2db5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Devy", "link": "https://stackoverflow.com/users/10597010/devy"}, "edited": false, "score": 0, "creation_date": 1573410297, "post_id": 58791564, "comment_id": 103864960, "body": "For input <code>a</code> it prints <code>2</code> but should print <code>1</code>"}, {"owner": {"reputation": 693, "user_id": 10597010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/821e01d36dc0b3f27eb2b3c9bc2db5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Devy", "link": "https://stackoverflow.com/users/10597010/devy"}, "edited": false, "score": 0, "creation_date": 1573416808, "post_id": 58791564, "comment_id": 103866705, "body": "can you please fix the answer?"}, {"owner": {"reputation": 16219, "user_id": 8011544, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-YtCjSKj6bBY/AAAAAAAAAAI/AAAAAAAAAAs/xLARQPguzJs/photo.jpg?sz=128", "display_name": "Melchia", "link": "https://stackoverflow.com/users/8011544/melchia"}, "reply_to_user": {"reputation": 693, "user_id": 10597010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/821e01d36dc0b3f27eb2b3c9bc2db5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Devy", "link": "https://stackoverflow.com/users/10597010/devy"}, "edited": false, "score": 0, "creation_date": 1573419708, "post_id": 58791564, "comment_id": 103867463, "body": "Trim space should remove all whitespaces"}], "tags": [], "owner": {"reputation": 16219, "user_id": 8011544, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-YtCjSKj6bBY/AAAAAAAAAAI/AAAAAAAAAAs/xLARQPguzJs/photo.jpg?sz=128", "display_name": "Melchia", "link": "https://stackoverflow.com/users/8011544/melchia"}, "is_accepted": true, "score": -1, "last_activity_date": 1573410944, "last_edit_date": 1573410944, "creation_date": 1573409559, "answer_id": 58791564, "question_id": 58791515, "link": "https://stackoverflow.com/questions/58791515/get-string-length-from-user-input/58791564#58791564", "title": "Get string length from user input", "body": "<p>You need to remove whitespaces from your input:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n     reader := bufio.NewReader(os.Stdin)\n     fmt.Print(\"Text to send: \")\n     text, _ := reader.ReadString('\\n')\n     newText := strings.TrimSpace(text)\n     fmt.Print(strconv.Itoa(len(newText)))    \n}\n</code></pre>\n"}], "owner": {"reputation": 693, "user_id": 10597010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/821e01d36dc0b3f27eb2b3c9bc2db5ad?s=128&d=identicon&r=PG&f=1", "display_name": "Devy", "link": "https://stackoverflow.com/users/10597010/devy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "accepted_answer_id": 58791564, "answer_count": 1, "score": 1, "last_activity_date": 1573682980, "creation_date": 1573409129, "last_edit_date": 1573682980, "question_id": 58791515, "link": "https://stackoverflow.com/questions/58791515/get-string-length-from-user-input", "title": "Get string length from user input", "body": "<p>I want to get the string length, here my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"strconv\"\n)\n\nfunc main() {\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Text to send: \")\n    text, _ := reader.ReadString('\\n')\n    fmt.Print(strconv.Itoa(len(text)))\n\n}\n</code></pre>\n\n<p>For input: <code>aaa</code></p>\n\n<p>The output is <code>5</code> but should be <code>3</code>.</p>\n\n<p>I know I can just subtract -2 from the result but I want \"cleaner\" way</p>\n"}, {"tags": ["go", "project"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1573404490, "post_id": 58790819, "comment_id": 103863279, "body": "See <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>."}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1573406440, "post_id": 58790819, "comment_id": 103863833, "body": "Plus, the concept of <i>protected</i> does not exist in Go. Everything is either exported or not by a package. Even if you split your project package into multiple sub-packages, user can still import a given sub-package and use it."}, {"owner": {"reputation": 1, "user_id": 12351675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43ae759e0a934a9b9255407838d131a7?s=128&d=identicon&r=PG&f=1", "display_name": "malformetric", "link": "https://stackoverflow.com/users/12351675/malformetric"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1573414605, "post_id": 58790819, "comment_id": 103866139, "body": "I have looked at &quot;how to write go code&quot;, but I don&#39;t quite understand how I should be solving my issue still, sorry. I have updated my post to be a bit more clear. @CeriseLim&#243;n"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1573415613, "post_id": 58790819, "comment_id": 103866395, "body": "Use GOPATH. Follow the stringutil example in How to Write Go Code where <code>stringutil</code> corresponds to your <code>hello</code> and <code>hello</code> corresponds to your <code>main</code>.  You can also use go.mod as in <a href=\"https://play.golang.org/p/W6Hgsqyuzug\" rel=\"nofollow noreferrer\">play.golang.org/p/W6Hgsqyuzug</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1573417844, "post_id": 58790819, "comment_id": 103866963, "body": "If you&#39;re not making reusable libraries, why are you concerned about people who download your code?"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12351675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43ae759e0a934a9b9255407838d131a7?s=128&d=identicon&r=PG&f=1", "display_name": "malformetric", "link": "https://stackoverflow.com/users/12351675/malformetric"}, "is_accepted": true, "score": -1, "last_activity_date": 1573418373, "creation_date": 1573418373, "answer_id": 58792723, "question_id": 58790819, "link": "https://stackoverflow.com/questions/58790819/multiple-packages-in-one-project/58792723#58792723", "title": "Multiple packages in one project?", "body": "<p>My solution was in the end to use GOPATH as mentioned by Cerise in a comment (thanks):</p>\n\n<blockquote>\n  <p>Use GOPATH. Follow the stringutil example in How to Write Go Code where stringutil corresponds to your hello and hello corresponds to your main. You can also use go.mod as in play.golang.org/p/W6Hgsqyuzug</p>\n</blockquote>\n\n<p>Seems like that is the correct way to be doing things.</p>\n"}], "owner": {"reputation": 1, "user_id": 12351675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43ae759e0a934a9b9255407838d131a7?s=128&d=identicon&r=PG&f=1", "display_name": "malformetric", "link": "https://stackoverflow.com/users/12351675/malformetric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 0, "accepted_answer_id": 58792723, "answer_count": 1, "score": -1, "last_activity_date": 1573418373, "creation_date": 1573404435, "last_edit_date": 1573417794, "question_id": 58790819, "link": "https://stackoverflow.com/questions/58790819/multiple-packages-in-one-project", "title": "Multiple packages in one project?", "body": "<p>I would like to split my go project up into multiple packages, so that certain methods and variables from each package are \"protected\". I would like to keep everything within the same project folder so that anyone who may download my code would find it to be fully self contained.</p>\n\n<p>I envision the project to look something like;</p>\n\n<pre><code>root\n\u2517  main package\n|   \u2517  all corresponding go files\n\u2517  another package\n    \u2517  all corresponding go files\n</code></pre>\n\n<p>and then import the second package into my main package</p>\n\n<p>It seems relative import paths are regarded as bad, and importing based on the gopath dosen't seem like the best way to do this because I an not trying to make reusable libraries, just to organize my project better.</p>\n\n<p>Edits and additions:<br>\nI have read \"how to write go code\" but I didn't see how I would solve my current problem. I realize the information is probably there and I am just being thick however. To better explain my problem, I have created an example project that uses my current fix.</p>\n\n<p><a href=\"https://gitlab.com/snippets/1911903\" rel=\"nofollow noreferrer\">https://gitlab.com/snippets/1911903</a></p>\n\n<p>I have two packages \"hello\" and \"main\".\nInside the \"main\" package is a string \"text\" and a function \"Hello()\".\nI have put this in a separate package because I do not want the string \"text\" to be accessible/defined in my main.go file.\nAt the moment I am importing \"hello\" into \"main\" using a relative import path.\nThis is what I (believe) needs to be changed.</p>\n\n<p>Because these are part of the same package I would like the source code of the two to remain as close as possible (this is why I didn't import via the gopath, but maybe that's what I should be doing).</p>\n"}, {"tags": ["mongodb", "go", "mongodb-query"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1573403976, "post_id": 58790587, "comment_id": 103863128, "body": "Please show how you execute the query and how the documents in your DB look like. Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 1, "user_id": 10968364, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fvjBM9ogWME/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOiV1ztLp-U8cwSb2KrP0_AnAu4pA/mo/photo.jpg?sz=128", "display_name": "lol2e", "link": "https://stackoverflow.com/users/10968364/lol2e"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1573407614, "post_id": 58790587, "comment_id": 103864164, "body": "@icza i edited the question to show the execution of the query as well, but i dont think thats the problem as other queries work with it"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1573413261, "post_id": 58790587, "comment_id": 103865794, "body": "And what is <code>highestExpTime</code> in your Go code?"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 10968364, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fvjBM9ogWME/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOiV1ztLp-U8cwSb2KrP0_AnAu4pA/mo/photo.jpg?sz=128", "display_name": "lol2e", "link": "https://stackoverflow.com/users/10968364/lol2e"}, "is_accepted": false, "score": 0, "last_activity_date": 1573418788, "creation_date": 1573418788, "answer_id": 58792781, "question_id": 58790587, "link": "https://stackoverflow.com/questions/58790587/query-searching-for-value-less-than-x-is-returning-nothing/58792781#58792781", "title": "Query searching for value less than X is returning nothing", "body": "<p>I actually found the problem myself.\nTurns out that my other NodeJS process added the Document only with Strings, which is the reason why <code>$lte</code> returned nothing.</p>\n\n<p>I just had to make sure everything related to this is added as an integer/float.</p>\n"}], "owner": {"reputation": 1, "user_id": 10968364, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fvjBM9ogWME/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOiV1ztLp-U8cwSb2KrP0_AnAu4pA/mo/photo.jpg?sz=128", "display_name": "lol2e", "link": "https://stackoverflow.com/users/10968364/lol2e"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 27, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1573418788, "creation_date": 1573402850, "last_edit_date": 1573407530, "question_id": 58790587, "link": "https://stackoverflow.com/questions/58790587/query-searching-for-value-less-than-x-is-returning-nothing", "title": "Query searching for value less than X is returning nothing", "body": "<p>I have a collection, where I save accessTokens and their expiration time.\nI want to automatically load all the ones that are expiring within the next X days.</p>\n\n<p>I have already confirmed that the Database and collection does contain an entry, that it should return. I have done this by simply setting an empty query to return everything that is in the collection.</p>\n\n<pre><code>// HighestExptime is the timestamp of the latest day that I want to select\nquery := bson.M{\"expiration\": bson.M{\"$lte\": highestExpTime}}\n\n// dbo is just an instance of a *mongo.Database struct\nctx, _ := context.WithTimeout(context.Background(), 30 * time.Second)\ncur, err := dbo.Collection(dbLogin.DBCollection).Find(ctx, query)\n</code></pre>\n\n<p>The Documents look like this:</p>\n\n<pre><code>{\n  userID // string\n  accessToken // string\n  refreshToken // string\n  expiration // int\n}\n</code></pre>\n\n<p>I would expect it to return every entry where the <code>expiration</code> is lower than the <code>highestExpTime</code> and is therefore \"older\" in that sense.</p>\n\n<p>But when I actually execute it, it just returns an empty response and no error.</p>\n"}, {"tags": ["go", "mux"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1573389182, "post_id": 58788664, "comment_id": 103859328, "body": "The error is pretty explicit. What is your question, or what do you specifically need help with?"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11217893"}, "edited": false, "score": 0, "creation_date": 1573390082, "post_id": 58788751, "comment_id": 103859530, "body": "Thx for the response Michal. Can you help elaborate a little more. Where do I actually unpack the array?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573392526, "post_id": 58788751, "comment_id": 103860112, "body": "@DevKiya note that the <a href=\"https://godoc.org/github.com/gorilla/mux#Route.Queries\" rel=\"nofollow noreferrer\"><code>Queries</code></a> method is <i>variadic</i>, which means that it can take <i>any</i> number of arguments of type <code>string</code>, this variadic nature of the method is indicated by the 3 dots (<code>...</code>) in front of the argument type, i.e. <code>...string</code>. So basically <code>...string</code> means any number of strings, just as <code>...int</code> means any number of ints, etc."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573392533, "post_id": 58788751, "comment_id": 103860114, "body": "@DevKiya  To pass arguments to a variadic function you either have to list them explicitly, e.g. <code>router.Queries(&quot;item&quot;, &quot;{useritem}&quot;, &quot;key&quot;, &quot;{userkey}&quot;)</code>, or you can collect them into a slice whose <b>element type</b> matches the <b>variadic type</b>, and then pass that slice to the variadic method <i>and</i> append 3 dots to the end of the slice value&#39;s name. So if the variadic type is <code>...string</code> then the slice type must be <code>[]string</code>, and then you can do something like this <code>args := []string{&quot;item&quot;, &quot;{useritem}&quot;, &quot;key&quot;, &quot;{userkey}&quot;}</code> and <code>router.Queries(args...)</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11217893"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573393617, "post_id": 58788751, "comment_id": 103860389, "body": "@mkopriva when passing them explicitly i get the following error:  <code>cannot call non-function route.Queries (type []Queries)go</code>  I want to explicitly state that arguments of the queries in the struct and pass them in my method of Queries(route.Queries) - im just not understanding how"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573393721, "post_id": 58788751, "comment_id": 103860413, "body": "@DevKiya <code>route.Queries</code> is not a function, that&#39;s your field, the function is <code>router.Queries</code>. route<b>r</b> not route."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573393796, "post_id": 58788751, "comment_id": 103860432, "body": "@DevKiya anyway as i&#39;ve already explained, you cannot pass <code>route.Queries</code> (type <code>[]Queries</code>) to a function that takes <code>...string</code>. Those are two different types, Go is a strongly typed language. It is simply not allowed."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573393935, "post_id": 58788751, "comment_id": 103860483, "body": "@DevKiya as explained by Micha\u0142 Krzysztof Feiler in his answer, you have to convert <code>route.Queries</code> (type <code>[]Queries</code>) into a value of type <code>[]string</code> and then pass that to <code>router.Queries</code> and adding those 3 dots."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11217893"}, "edited": false, "score": 0, "creation_date": 1573396339, "post_id": 58788751, "comment_id": 103861073, "body": "ahh, i kept getting confused over route vs routes. Thanks!!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user11217893"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573400609, "post_id": 58788751, "comment_id": 103862219, "body": "@mkopriva ive played with this for a while and have implemented (i think) the advise given above but am still getting an error. can you view the answer i posted?"}], "tags": [], "owner": {"reputation": 454, "user_id": 4240261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75ff9a37dd735232d0e1ffa2e7af1823?s=128&d=identicon&r=PG", "display_name": "Mika Feiler", "link": "https://stackoverflow.com/users/4240261/mika-feiler"}, "is_accepted": false, "score": 1, "last_activity_date": 1573389520, "creation_date": 1573389520, "answer_id": 58788751, "question_id": 58788664, "link": "https://stackoverflow.com/questions/58788664/how-to-pass-a-nested-struct-into-an-argument/58788751#58788751", "title": "How to pass a nested struct into an argument", "body": "<p>First convert <code>route.Queries</code> into <code>queries []string</code>.</p>\n\n<p>Then you need to unpack array as arguments. Use <code>router.Queries(queries...)</code> instead.</p>\n\n<p>See <a href=\"https://github.com/gorilla/mux/blob/master/mux.go#L341\" rel=\"nofollow noreferrer\">https://github.com/gorilla/mux/blob/master/mux.go#L341</a> for implementation of this method.</p>\n"}, {"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573400758, "post_id": 58790221, "comment_id": 103862263, "body": "Change <code>Queries(router.Queries(...))</code> to <code>Queries(route.Queries...)</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573400820, "post_id": 58790221, "comment_id": 103862275, "body": "note again you&#39;re mixing up <code>router</code> with <code>route</code>, if you find the names confusing then use different variable names."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11217893"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573400981, "post_id": 58790221, "comment_id": 103862320, "body": "thanks so much! that worked. appreciate your time, im v new to go"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user11217893"}, "is_accepted": false, "score": 0, "last_activity_date": 1573400563, "creation_date": 1573400563, "answer_id": 58790221, "question_id": 58788664, "link": "https://stackoverflow.com/questions/58788664/how-to-pass-a-nested-struct-into-an-argument/58790221#58790221", "title": "How to pass a nested struct into an argument", "body": "<p>@mkopriva ive played with this for a while and have implemented (i think) the advise given above but now im getting <code>syntax error: unexpected ..., expecting expressiongo</code></p>\n\n<p>Here is what my code looks like now:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Queries struct {\n    item     string\n    useritem string\n    key      string\n    userkey  string\n}\n\ntype Route struct {\n    Method     string\n    Path       string\n    HandleFunc http.HandlerFunc\n    Queries []string\n}\n\n\n// Routes is\nvar Routes = []Route{\n    {\n        Method:     \"GET\",\n        Path:       \"/items\",\n        HandleFunc: controllers.Getitems,\n        Queries: []string{\n            \"item\", \"{useritem}\", \"key\", \"{userkey}\",\n        },\n    },\n}\n\n// CreateRouter is\nfunc CreateRouter() {\n\n    router := mux.NewRouter()\n\n    for _, route := range Routes {\n        router.\n            Methods(route.Method).\n            Path(route.Path).\n            Handler(route.HandleFunc).\n            Queries(router.Queries(...))\n    }\n    return router\n}```\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11217893"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1573400563, "creation_date": 1573388954, "last_edit_date": 1573389132, "question_id": 58788664, "link": "https://stackoverflow.com/questions/58788664/how-to-pass-a-nested-struct-into-an-argument", "title": "How to pass a nested struct into an argument", "body": "<p>I'm trying to create a struct for my API routes. I have two structs: Queries and Route. Then I have a slice of my routes that is made based of my type Route.</p>\n\n<p>After I create my Routes, I then create a new router and iterate over the range of Routes and pass them Methods, Path, Handler, and Queries. </p>\n\n<p>I keep getting an error when trying to pass queries that says</p>\n\n<blockquote>\n  <p>cannot use route.Queries (type []Queries) as type string in argument...</p>\n</blockquote>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Queries struct {\n    item     string\n    useritem string\n    key      string\n    userkey  string\n}\n\n\ntype Route struct {\n    Method     string\n    Path       string\n    HandleFunc http.HandlerFunc\n    Queries []Queries\n}\n\nvar Routes = []Route{\n    {\n        Method:     \"GET\",\n        Path:       \"/items\",\n        HandleFunc: controllers.Getitems,\n        Queries: []Queries{{\"item\", \"{useritem}\", \"key\", \"{userkey}\",},\n        },\n    },\n}\n\nfunc CreateRouter() *mux.Router {\n    router := mux.NewRouter()\n\n    for _, route := range Routes {\n        router.\n            Methods(route.Method).\n            Path(route.Path).\n            Handler(route.HandleFunc).\n            Queries(route.Queries) //This is where the error occurs\n        } \n        return router\n    }\n</code></pre>\n"}, {"tags": ["go", "fyne"], "answers": [{"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 3, "last_activity_date": 1573385571, "creation_date": 1573385571, "answer_id": 58788223, "question_id": 58788154, "link": "https://stackoverflow.com/questions/58788154/capture-keyboard-press-event-with-fyne-io/58788223#58788223", "title": "capture keyboard press event with fyne.io", "body": "<p>the solution was dead simple..</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    w.Canvas().SetOnTypedKey(func(k *fyne.KeyEvent) {\n        w.Close()\n    })\n</code></pre>\n"}], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1573385571, "creation_date": 1573384913, "last_edit_date": 1573384993, "question_id": 58788154, "link": "https://stackoverflow.com/questions/58788154/capture-keyboard-press-event-with-fyne-io", "title": "capture keyboard press event with fyne.io", "body": "<p>Given below code that creates a new app window to display a picture from the local file system, how can I add support to detect a \"keypress\" event and quit the application?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"flag\"\n    _ \"image/gif\"\n    _ \"image/jpeg\"\n    _ \"image/png\"\n\n    \"fyne.io/fyne\"\n    \"fyne.io/fyne/app\"\n    \"fyne.io/fyne/canvas\"\n    \"fyne.io/fyne/widget\"\n)\n\nfunc main() {\n\n    flag.Parse()\n    a := app.New()\n\n    w := a.NewWindow(\"Image Viewer\")\n\n    img := canvas.NewImageFromFile(\"/home/mh-cbon/Images/7.png\")\n    img.FillMode = canvas.ImageFillContain\n    scroll := widget.NewScrollContainer(img)\n    scroll.Resize(fyne.NewSize(400, 400))\n    w.SetContent(scroll)\n\n    w.Resize(fyne.NewSize(400, 400))\n    w.Show()\n\n    a.Run()\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1573377741, "post_id": 58787230, "comment_id": 103856823, "body": "Yes <a href=\"https://golang.org/ref/spec#For_range\" rel=\"nofollow noreferrer\">golang.org/ref/spec#For_range</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 6, "creation_date": 1573378425, "post_id": 58787230, "comment_id": 103856948, "body": "Note also that the &quot;comma ok&quot; idiom, which is a special form of assignment is supported only by 3 expressions, <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertions</a>, <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow noreferrer\">channel receives</a>, and <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">map indexing</a>. Slice indexing does not support that special form which is why you&#39;ve got that error."}, {"owner": {"reputation": 113, "user_id": 5400197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15bd95a827950f2c0a00b6eb48041613?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi Chandak", "link": "https://stackoverflow.com/users/5400197/ravi-chandak"}, "edited": false, "score": 1, "creation_date": 1573379826, "post_id": 58787230, "comment_id": 103857260, "body": "Yeah, but again this would work if you finding in a map. If in an array this is incorrect"}], "answers": [{"tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": 1, "last_activity_date": 1581519585, "last_edit_date": 1581519585, "creation_date": 1573386841, "answer_id": 58788380, "question_id": 58787230, "link": "https://stackoverflow.com/questions/58787230/multiple-variable-assignment/58788380#58788380", "title": "Multiple variable assignment", "body": "<p>The <code>range</code> form of the for loop iterates over a slice or map.</p>\n\n<p>When ranging over a slice, two values are returned for each iteration:</p>\n\n<ol>\n<li>The first is the index of the slice;</li>\n<li>The second is a copy of the element at that index.</li>\n</ol>\n\n<p>Let's assume that we have a function that verify if a number is a <code>prime number</code>, and we have an array with the candidate numbers, than we can call the function in two different way:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var prime []int = []int{2, 3, 5, 7, 11, 13, 17, 19, 23}\n\nfunc TestIsPrimeByValue(t *testing.T) {\n    for _, item := range prime {\n        if !IsPrime(item) {\n            t.Fail()\n        }\n    }\n}\n\nfunc TestIsPrimeByIndex(t *testing.T) {\n    for i := range prime {\n        if !IsPrime(prime[i]) {\n            t.Fail()\n        }\n    }\n}\n</code></pre>\n\n<p>With the first loop, we are iterating the <code>value</code> of the array.<br>\nWith the second loop, we are iterating the <code>index</code> of the array.</p>\n"}], "owner": {"reputation": 79, "user_id": 3911648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa6057df4b54a419f27841b9a6b1c306?s=128&d=identicon&r=PG&f=1", "display_name": "Electroenthusiast", "link": "https://stackoverflow.com/users/3911648/electroenthusiast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1581519585, "creation_date": 1573377452, "last_edit_date": 1573385409, "question_id": 58787230, "link": "https://stackoverflow.com/questions/58787230/multiple-variable-assignment", "title": "Multiple variable assignment", "body": "<p>The below code snippet confused me:</p>\n\n<p><code>v, ok := a[1] // error: assignment count mismatch: 2 = 1</code></p>\n\n<p>The above code throws an error because of count mismatch, but the below code snippet seems to work fine:</p>\n\n<pre><code>for i, id:= range ids\n{\n   fmt.Printf(\"%d - ID: %d\\n\",i,id)\n}\n</code></pre>\n\n<p>Does this mean that the <code>range</code> returns both the index and the value due to which the code snippet above works fine?</p>\n"}, {"tags": ["c++", "c", "go", "swig", "cgo"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1573379523, "post_id": 58787199, "comment_id": 103857190, "body": "you might check that blog post to get some ideas <a href=\"https://medium.com/mysterium-network/golang-c-interoperability-caf0ba9f7bf3\" rel=\"nofollow noreferrer\">medium.com/mysterium-network/&hellip;</a>"}, {"owner": {"reputation": 23, "user_id": 7060395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/081f2605944c091b77c147746c6c8d3a?s=128&d=identicon&r=PG&f=1", "display_name": "Neirpyc", "link": "https://stackoverflow.com/users/7060395/neirpyc"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1573380798, "post_id": 58787199, "comment_id": 103857494, "body": "I think they had a manual edition step, so I think I cant do it their way."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1573381289, "post_id": 58787199, "comment_id": 103857592, "body": "please consider your question might be too broad and that some reproducible code example of the various methods employed could help to motivate others in helping you. It is hard to talk about code we cannot read."}, {"owner": {"reputation": 11893, "user_id": 12098405, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-C7IUyuZ5qqE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rehqQyGdh463Xz2DY8S4TYPhnDvzA/photo.jpg?sz=128", "display_name": "dash-o", "link": "https://stackoverflow.com/users/12098405/dash-o"}, "edited": false, "score": 1, "creation_date": 1573381676, "post_id": 58787199, "comment_id": 103857687, "body": "Also, consider posting the &quot;.h&quot; file that include prototypes for the functions to be exposes (self contained), so that the scope of questions is more clear. It too generic in the current form"}, {"owner": {"reputation": 23, "user_id": 7060395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/081f2605944c091b77c147746c6c8d3a?s=128&d=identicon&r=PG&f=1", "display_name": "Neirpyc", "link": "https://stackoverflow.com/users/7060395/neirpyc"}, "edited": false, "score": 0, "creation_date": 1573382744, "post_id": 58787199, "comment_id": 103857869, "body": "Well, the function to import or expose can depend on the project (that&#39;s why the conversion has to be automated), but I&#39;ll try to add an example."}, {"owner": {"reputation": 2547, "user_id": 6387370, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/CpJXI.png?s=128&g=1", "display_name": "zakaria amine", "link": "https://stackoverflow.com/users/6387370/zakaria-amine"}, "edited": false, "score": 0, "creation_date": 1573394652, "post_id": 58787199, "comment_id": 103860673, "body": "&quot;cgo which doesn&#39;t work with C++&quot;, how come ? I know several go projects that work with C++, for example <a href=\"https://github.com/hybridgroup/gocv\" rel=\"nofollow noreferrer\">github.com/hybridgroup/gocv</a>, checkout maybe their source code to get some inspiration"}], "owner": {"reputation": 23, "user_id": 7060395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/081f2605944c091b77c147746c6c8d3a?s=128&d=identicon&r=PG&f=1", "display_name": "Neirpyc", "link": "https://stackoverflow.com/users/7060395/neirpyc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 258, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1573383422, "creation_date": 1573377149, "last_edit_date": 1573383422, "question_id": 58787199, "link": "https://stackoverflow.com/questions/58787199/automatically-generate-go-bindings-to-a-c-library", "title": "Automatically generate go bindings to a c++ library", "body": "<p>I am working on <a href=\"https://github.com/prologin/stechec2\" rel=\"nofollow noreferrer\">a program</a> which from a c++ code generates a <code>.so</code> and bindings for multiple languages (C, C++, Haskell, Java, Php, Python...) and I'm trying to add support for golang.<br>\nI think the best way to get that result is to either use the C++ or the C version and create go bindings, but this has to be done automatically. I've tried using <a href=\"https://github.com/swig/swig\" rel=\"nofollow noreferrer\">Swig</a> but I didn't manage to get it working (likely because we're including a <code>.so</code> and not a <code>.cc</code>) and I've only found <a href=\"http://www.swig.org/Doc4.0/Go.html#Go\" rel=\"nofollow noreferrer\">old documentation</a> (this uses <code>go tool 6g</code>).<br>\nI've also tried creating bindings with <code>cgo</code> which doesn't work with C++, and I couldn't get it working with the C bindings (again, most likely because of the <code>.so</code> step).<br>\nAt the end, I must generate another <code>.so</code> with a few exported functions, and which must be standalone which makes compiling the C++ version and talking with it through a pipe (almost?) impossible.<br>\nThe functions to export are often things like:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>void init_game(void);\nvoid play_turn(void);\nvoid end_game(void);\n</code></pre>\n\n<p>You can find a c++ header <a href=\"https://pastebin.com/VLCC4pPQ\" rel=\"nofollow noreferrer\">here</a> and the auto-generated interfaces to C: <a href=\"https://pastebin.com/v1mVaN4h\" rel=\"nofollow noreferrer\">interface.hh</a> and <a href=\"https://pastebin.com/5nUkmnc3\" rel=\"nofollow noreferrer\">interface.cc</a> and <a href=\"https://pastebin.com/yHij3DyP\" rel=\"nofollow noreferrer\">prologin.h</a>.<br>\nAn example source code of <code>lib.so</code> can be found <a href=\"https://github.com/prologin/stechec2/tree/master/games/tictactoe/src\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1573377125, "post_id": 58787187, "comment_id": 103856707, "body": "What have you tried? Show your current attempt. What problems are you having with it?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1573379378, "post_id": 58787187, "comment_id": 103857143, "body": "<a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/json-to-go</a>"}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 12340922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/od61f.jpg?s=128&g=1", "display_name": "Bryan English", "link": "https://stackoverflow.com/users/12340922/bryan-english"}, "is_accepted": false, "score": 0, "last_activity_date": 1573419652, "creation_date": 1573419652, "answer_id": 58792890, "question_id": 58787187, "link": "https://stackoverflow.com/questions/58787187/create-data-structure/58792890#58792890", "title": "Create data structure", "body": "<p>Go provides you many handy ways of dealing with things like these, and by many ways, I mean one way and it's struct and interface types. From the look of your data, a <code>map[string]interface{}</code> is your best bet. </p>\n"}], "owner": {"reputation": 3, "user_id": 12312334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9bac09db2e516429dcda008de34ced7?s=128&d=identicon&r=PG&f=1", "display_name": "Swapnil", "link": "https://stackoverflow.com/users/12312334/swapnil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1573419652, "creation_date": 1573377053, "last_edit_date": 1573377114, "question_id": 58787187, "link": "https://stackoverflow.com/questions/58787187/create-data-structure", "title": "Create data structure", "body": "<p>I have a json structure in database column each row has below mentioned json</p>\n\n<p><code>{\"DeviceId\":\"954b9c1a58fb3879\",\"SmsData\":[{\"sender\":\"XXXXXXXX \",\"sms\":\"YYYY\"},{\"sender\":\"kkkkk\",\"sms\":\"TTT\"}]}</code></p>\n\n<p>I need to create data structue by parsing each row data to calculate count on basis of send, sms and date. i.e if sender, sms and date is same then increase counter by 1 and keep the data structure in such as way to get sender, sms, date and count.</p>\n\n<p>sender sms count\n  xxx->yyy->2\n       zzz->3</p>\n\n<p>ttt -> yyy->6\n         kkk->5</p>\n\n<p>So how to create and managed structure in Go?</p>\n"}, {"tags": ["python", "go", "grpc"], "comments": [{"owner": {"reputation": 641, "user_id": 10598399, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IqvQE52wuJk/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbByYnpnsOz2o5YBmLuo8wZDIKgo1w/mo/photo.jpg?sz=128", "display_name": "Richard Belleville", "link": "https://stackoverflow.com/users/10598399/richard-belleville"}, "edited": false, "score": 0, "creation_date": 1573677679, "post_id": 58786944, "comment_id": 103964142, "body": "Do you have access to the server&#39;s logs? Is it observing the request from the client?"}, {"owner": {"reputation": 4881, "user_id": 2632266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/lRSJ4.jpg?s=128&g=1", "display_name": "2 8", "link": "https://stackoverflow.com/users/2632266/2-8"}, "reply_to_user": {"reputation": 641, "user_id": 10598399, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IqvQE52wuJk/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbByYnpnsOz2o5YBmLuo8wZDIKgo1w/mo/photo.jpg?sz=128", "display_name": "Richard Belleville", "link": "https://stackoverflow.com/users/10598399/richard-belleville"}, "edited": false, "score": 0, "creation_date": 1574147455, "post_id": 58786944, "comment_id": 104117102, "body": "@RichardBelleville there is no error in the server"}], "answers": [{"comments": [{"owner": {"reputation": 4881, "user_id": 2632266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/lRSJ4.jpg?s=128&g=1", "display_name": "2 8", "link": "https://stackoverflow.com/users/2632266/2-8"}, "edited": false, "score": 0, "creation_date": 1573378758, "post_id": 58787256, "comment_id": 103857015, "body": "for a special case, when the server task takes too much time, every time i see this error"}, {"owner": {"reputation": 337, "user_id": 2099074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1491488287/picture?type=large", "display_name": "Martin Kosicky", "link": "https://stackoverflow.com/users/2099074/martin-kosicky"}, "edited": false, "score": 0, "creation_date": 1580991214, "post_id": 58787256, "comment_id": 106284685, "body": "the retry here is to throw away the connection and reconnect? I would expect the python grpc library to do that"}, {"owner": {"reputation": 6019, "user_id": 1149459, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/6ejcM.png?s=128&g=1", "display_name": "Eric H.", "link": "https://stackoverflow.com/users/1149459/eric-h"}, "reply_to_user": {"reputation": 337, "user_id": 2099074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1491488287/picture?type=large", "display_name": "Martin Kosicky", "link": "https://stackoverflow.com/users/2099074/martin-kosicky"}, "edited": false, "score": 0, "creation_date": 1584143827, "post_id": 58787256, "comment_id": 107355826, "body": "@MartinKosicky I believe it does. I&#39;ve seen some status code 14 UNAVAILABLE in my logs, that do not cause calling code to fail. <a href=\"https://github.com/grpc/grpc/pull/11154\" rel=\"nofollow noreferrer\">github.com/grpc/grpc/pull/11154</a>"}], "tags": [], "owner": {"reputation": 1188, "user_id": 300520, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/282efd4afde27a16916568b25c79beb9?s=128&d=identicon&r=PG", "display_name": "maverick", "link": "https://stackoverflow.com/users/300520/maverick"}, "is_accepted": false, "score": 1, "last_activity_date": 1573377614, "creation_date": 1573377614, "answer_id": 58787256, "question_id": 58786944, "link": "https://stackoverflow.com/questions/58786944/grpc-socket-closed-message/58787256#58787256", "title": "gRPC socket closed message", "body": "<p>the grpc status code 14 unavailable is mostly for transient errors and can be corrected with retrial mechanism.</p>\n"}], "owner": {"reputation": 4881, "user_id": 2632266, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/lRSJ4.jpg?s=128&g=1", "display_name": "2 8", "link": "https://stackoverflow.com/users/2632266/2-8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3057, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1573377614, "creation_date": 1573374755, "question_id": 58786944, "link": "https://stackoverflow.com/questions/58786944/grpc-socket-closed-message", "title": "gRPC socket closed message", "body": "<p>I have developed a gRPC server in Go and a client in Python when the server task in the server takes too time, the following error occurred in the client and server runs without any error. </p>\n\n<pre><code> raise _Rendezvous(state, None, None, deadline)\ngrpc._channel._Rendezvous: &lt;_Rendezvous of RPC that terminated with:\n    status = StatusCode.UNAVAILABLE\n    details = \"Socket closed\"\n    debug_error_string = \"{\"created\":\"@1573373169.327520081\",\"description\":\"Error received from peer\",\"file\":\"src/core/lib/surface/call.cc\",\"file_line\":1039,\"grpc_message\":\"Socket closed\",\"grpc_status\":14}\"\n</code></pre>\n\n<p>Increasing timeout like this does not work and before timeout, around 4th sec, i got the error.</p>\n\n<pre><code>res = stub.Fake(\n    fake_pb2.FakeRequest(\n        **fake_request\n    ),\n    timeout=9\n)\n</code></pre>\n"}, {"tags": ["windows", "go", "ansi-colors"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 2, "creation_date": 1573363745, "post_id": 58785943, "comment_id": 103854734, "body": "I don&#39;t know Go, by ANSII escape codes don&#39;t work in every console. Your console probably isn&#39;t compatible if you&#39;re sure you have the code right."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12349822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b50f36f6e4ca44b55ccd985f571f9b7a?s=128&d=identicon&r=PG&f=1", "display_name": "Matt j clay", "link": "https://stackoverflow.com/users/12349822/matt-j-clay"}, "is_accepted": false, "score": -1, "last_activity_date": 1573364914, "creation_date": 1573364914, "answer_id": 58786079, "question_id": 58785943, "link": "https://stackoverflow.com/questions/58785943/how-to-use-escape-sequences/58786079#58786079", "title": "How to use escape sequences", "body": "<p>Turns out you need to enable Virtual Terminal Processing in Windows 10 to use ANSII escape codes</p>\n\n<p><a href=\"https://github.com/konsorten/go-windows-terminal-sequences\" rel=\"nofollow noreferrer\">https://github.com/konsorten/go-windows-terminal-sequences</a></p>\n"}], "owner": {"reputation": 1, "user_id": 12349822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b50f36f6e4ca44b55ccd985f571f9b7a?s=128&d=identicon&r=PG&f=1", "display_name": "Matt j clay", "link": "https://stackoverflow.com/users/12349822/matt-j-clay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 117, "favorite_count": 0, "closed_date": 1573376625, "answer_count": 1, "score": -1, "last_activity_date": 1573376420, "creation_date": 1573363177, "last_edit_date": 1573376420, "question_id": 58785943, "link": "https://stackoverflow.com/questions/58785943/how-to-use-escape-sequences", "closed_reason": "Duplicate", "title": "How to use escape sequences", "body": "<p>I am trying to get escape sequences to work in a Go application. Specifically the code to move the cursor. <code>fmt.Printf(\"\\033[3;5H\")</code>\nWhat should I be printing / writing to in order to make this work? Or am I approaching this the wrong way entirely? Every time I run the code I just get some funky looking characters in the terminal or nothing happens. I am running windows 10.</p>\n\n<p>I have tried using multiple different <code>fmt.Print</code> functions but I get the same results.</p>\n\n<pre><code>// Move the cursor\nfmt.Printf(\"\\033[3;5H\")\n\n// Print at new position\nfmt.Printf(\"Print this text at the new cursor position\")\n</code></pre>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1573356878, "post_id": 58784996, "comment_id": 103854001, "body": "Have you tried $value.filename?"}, {"owner": {"reputation": 2867, "user_id": 478311, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f33a325b11dd39195f5f1249586e791b?s=128&d=identicon&r=PG", "display_name": "tomcam", "link": "https://stackoverflow.com/users/478311/tomcam"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1573358372, "post_id": 58784996, "comment_id": 103854150, "body": "Yes. It returns an &quot;executing &#39;appname&#39; at &lt;$value.Filename&gt;: range can&#39;t iterate over fb.jpg&#39;. The fieldnames aren&#39;t known at compile time."}, {"owner": {"reputation": 2867, "user_id": 478311, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f33a325b11dd39195f5f1249586e791b?s=128&d=identicon&r=PG", "display_name": "tomcam", "link": "https://stackoverflow.com/users/478311/tomcam"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1573361831, "post_id": 58784996, "comment_id": 103854544, "body": "I realized that the key value is available, so I tried this but got a runtime error. I cannot seem to use the eq function with a variable name: for the inner loop (sorry, can&#39;t figure out how to format a comment; the instructions on the formatting page seem to be misleading because my br tag just showed up as a literal): <code>{{range $k, $t := $value}}                                    {{if eq $k &quot;filename&quot; }} Filename: {{$t}} {{end}} {{end}}</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2867, "user_id": 478311, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f33a325b11dd39195f5f1249586e791b?s=128&d=identicon&r=PG", "display_name": "tomcam", "link": "https://stackoverflow.com/users/478311/tomcam"}, "edited": false, "score": 0, "creation_date": 1573369067, "post_id": 58786123, "comment_id": 103855411, "body": "I can&#39;t thank you enough. It&#39;s a compound data structure, as shown here in the Playground: <a href=\"https://play.golang.org/p/BCzVYfPZVHU\" rel=\"nofollow noreferrer\">play.golang.org/p/BCzVYfPZVHU</a> with minimal versions of the real data structures. And they do work, to a degree. For example, the output of <code>{{ .FrontMatter.Custom.Data }}</code> is indeed <code>[map[alt:FB logo filename:fb.jpg url:facebook.com] map[alt:Pinterest logo filename:pi.jpg url:pinterest.com] map[alt:Twitter logo filename:twit.jpg url:twitter.com]]</code>   Likewise <code>{{ .Page }}</code> does show the contents of that data (sub) structure.  The version I created doesn&#39;t segfault, but nor does it show data."}, {"owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "reply_to_user": {"reputation": 2867, "user_id": 478311, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f33a325b11dd39195f5f1249586e791b?s=128&d=identicon&r=PG", "display_name": "tomcam", "link": "https://stackoverflow.com/users/478311/tomcam"}, "edited": false, "score": 0, "creation_date": 1573371505, "post_id": 58786123, "comment_id": 103855782, "body": "OK - when you create the data struct it&#39;s taking a copy of FrontMatterConfigs. Calling toml.Decode is overwriting the original version; not the copy. <a href=\"https://play.golang.org/p/xdgG47yJaAG\" rel=\"nofollow noreferrer\">play.golang.org/p/xdgG47yJaAG</a> works OK."}, {"owner": {"reputation": 2867, "user_id": 478311, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f33a325b11dd39195f5f1249586e791b?s=128&d=identicon&r=PG", "display_name": "tomcam", "link": "https://stackoverflow.com/users/478311/tomcam"}, "edited": false, "score": 0, "creation_date": 1573436903, "post_id": 58786123, "comment_id": 103870685, "body": "Can&#39;t thank you enough. You have led me on the right path after a miserable couple of days. Here is a complete version that works on the playground. The exact same template causes a segfault on my machine in production. So it&#39;s clear that my code is suspect. <a href=\"https://play.golang.org/p/yoSBa89ffAe\" rel=\"nofollow noreferrer\">play.golang.org/p/yoSBa89ffAe</a>"}, {"owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "reply_to_user": {"reputation": 2867, "user_id": 478311, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f33a325b11dd39195f5f1249586e791b?s=128&d=identicon&r=PG", "display_name": "tomcam", "link": "https://stackoverflow.com/users/478311/tomcam"}, "edited": false, "score": 1, "creation_date": 1573443969, "post_id": 58786123, "comment_id": 103871873, "body": "No worries - debugging templates can be difficult and I&#39;ve spent ages looking for a complex solution in the past when the issue was something really simple."}], "tags": [], "owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "is_accepted": true, "score": 1, "last_activity_date": 1573366651, "last_edit_date": 1573366651, "creation_date": 1573365434, "answer_id": 58786123, "question_id": 58784996, "link": "https://stackoverflow.com/questions/58784996/specifying-field-name-in-anonymous-maps/58786123#58786123", "title": "Specifying field name in anonymous maps", "body": "<p>It's difficult to be sure of my answer because you have not provided details of the toml library you are using (I'll assume BurntSushi) or the data structure that this generates (including the output of <code>fmt.Printf(\"%v\", outVar)</code>, where outVar is the interface with your unmarshalled toml, would be useful).</p>\n\n<p>However if my assumptions are correct then the issue seems to be case; in your toml file you have <code>[custom]</code> but in the template it is <code>{{ with .FrontMatter.Custom.Data }}</code> (note the c in custom is a different case). This does not really make sense as you say that iterating works but using your template and the data you provided it all seems OK (I'm guessing some detail is missing).</p>\n\n<p>The following example code works as expected:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"github.com/BurntSushi/toml\"\n    \"html/template\"\n)\n\nfunc main() {\n    dataToml := `\n    [custom]\nData = [                                                                      \n  { filename = \"fb.jpg\", alt = \"FB logo\", url = \"facebook.com\" },              \n  { filename = \"pi.jpg\", alt = \"Pinterest logo\", url = \"pinterest.com\"},      \n  { filename = \"twit.jpg\", alt = \"Twitter logo\", url = \"twitter.com\"},      \n]`\n\n    var data interface{}\n    if _, err := toml.Decode(dataToml, &amp;data); err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"data: %v\\n\", data)\n\n    tmpl := `{{ with .custom.Data }}   \n        {{ range $_, $value := . }}         \n        {{index $value \"filename\" }}                                  \n        {{ end }}\n{{ end }}`\n\n    t := template.Must(template.New(\"tomlStuff\").Parse(tmpl))\n\n    var b bytes.Buffer\n    err := t.ExecuteTemplate(&amp;b, \"tomlStuff\", data)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%v\\n\", b.String())\n}\n</code></pre>\n\n<p>Its quite possible that I've missed something; if so perhaps you could modify my example in the <a href=\"https://play.golang.org/p/h9U5PTs-Ssy\" rel=\"nofollow noreferrer\">go playground</a> such that it duplicates your issue?</p>\n"}], "owner": {"reputation": 2867, "user_id": 478311, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f33a325b11dd39195f5f1249586e791b?s=128&d=identicon&r=PG", "display_name": "tomcam", "link": "https://stackoverflow.com/users/478311/tomcam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 58786123, "answer_count": 1, "score": -1, "last_activity_date": 1573376649, "creation_date": 1573348688, "last_edit_date": 1573376649, "question_id": 58784996, "link": "https://stackoverflow.com/questions/58784996/specifying-field-name-in-anonymous-maps", "title": "Specifying field name in anonymous maps", "body": "<p>My program gets data from a TOML file for an embedded struct named Data:</p>\n\n<pre><code>===\n[custom]\nData = [                                                                      \n  { filename = \"fb.jpg\", alt = \"FB logo\", url = \"facebook.com\" },              \n  { filename = \"pi.jpg\", alt = \"Pinterest logo\", url = \"pinterest.com\"},      \n  { filename = \"twit.jpg\", alt = \"Twitter logo\", url = \"twitter.com\"},      \n]\n===\n</code></pre>\n\n<p>It's declared as interface so I don't know the field names in advance. I want to loop through the rows and build an image in HTML. I can iterate like this successfully. This obviously prints out each column value at a time:</p>\n\n<pre><code>{{ with .FrontMatter.Custom.Data }}   \n        {{ range $_, $value := . }}                                            \n                {{ range $_, $t := $value}} {{$t}}, {{end}}\n        {{ end }}\n{{ end }}\n</code></pre>\n\n<p>But for the life of me I can't get access to the individual fields. I want to do this but it causes a runtime error:</p>\n\n<pre><code>            {{ range $_, $t := $value}} {{index $value \"filename\" }}, {{end}}\n</code></pre>\n\n<p>How can I get hold of $value.filename, $value.alt and so on?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 4, "creation_date": 1573342558, "post_id": 58784496, "comment_id": 103852276, "body": "<code>&lt;-done</code> reads from the channel (and ignores the result)"}, {"owner": {"reputation": 2429, "user_id": 5091805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e4vgq.png?s=128&g=1", "display_name": "Ari", "link": "https://stackoverflow.com/users/5091805/ari"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1573343111, "post_id": 58784496, "comment_id": 103852377, "body": "so it reads from the channel, but what exactly is it doing with that value or before that value is received?"}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 2, "creation_date": 1573343161, "post_id": 58784496, "comment_id": 103852390, "body": "Its doing nothing with that value. Its only purpose is to block until the other goroutine writes to the channel."}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1573345279, "post_id": 58784705, "comment_id": 103852735, "body": "&quot;to wait for a value from another goroutine&quot; --- just to read a value from the channel, it has nothing to do with goroutines."}, {"owner": {"reputation": 8387, "user_id": 3756168, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/xqUim.jpg?s=128&g=1", "display_name": "Badis Merabet", "link": "https://stackoverflow.com/users/3756168/badis-merabet"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1573345547, "post_id": 58784705, "comment_id": 103852783, "body": "well it has, worker is executed on a different goroutine from the main goroutine."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1573348011, "post_id": 58784705, "comment_id": 103853113, "body": "In the OP&#39;s code - yes, but your statement &quot;is syntax used by Golang to wait for a value from another goroutine&quot; is generic. So, I pointed out that <code>&lt;-</code> is not a syntax to wait for a value from another goroutine. Your answer is not wrong, it&#39;s just that statement looks misleading."}, {"owner": {"reputation": 8387, "user_id": 3756168, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/xqUim.jpg?s=128&g=1", "display_name": "Badis Merabet", "link": "https://stackoverflow.com/users/3756168/badis-merabet"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1573355965, "post_id": 58784705, "comment_id": 103853920, "body": "The goroutine that block for reading from a channel is different than the goroutine which involve writing to channel. And i said <code>&lt;-</code> FOLLOWED BY CHANNEL NAME is used to wait for a value written to channel in another goroutine which is correct technically and linguistically"}, {"owner": {"reputation": 8387, "user_id": 3756168, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/xqUim.jpg?s=128&g=1", "display_name": "Badis Merabet", "link": "https://stackoverflow.com/users/3756168/badis-merabet"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1573356791, "post_id": 58784705, "comment_id": 103853994, "body": "&quot; it has nothing to do with goroutines&quot; ... It has to do the WAITING for value to be written. not just reading it."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1573359321, "post_id": 58784705, "comment_id": 103854244, "body": "&quot;which is correct technically&quot; --- it&#39;s not correct technically, nothing in go requires a value to be written by a different goroutine, you can write by the same goroutine and then read from it. OPs example does it, but &quot;is syntax used by Golang to wait for a value from another goroutine&quot; statement is simply wrong."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1573359413, "post_id": 58784705, "comment_id": 103854259, "body": "&quot;It has to do the WAITING for value to be written&quot; --- indeed, again: your answer is not wrong, just some of its statements are misleading."}, {"owner": {"reputation": 8387, "user_id": 3756168, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/xqUim.jpg?s=128&g=1", "display_name": "Badis Merabet", "link": "https://stackoverflow.com/users/3756168/badis-merabet"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1573398739, "post_id": 58784705, "comment_id": 103861712, "body": "OK @zerkms ^ ^. I have edited few words.I hope this makes more sense now."}], "tags": [], "owner": {"reputation": 8387, "user_id": 3756168, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/xqUim.jpg?s=128&g=1", "display_name": "Badis Merabet", "link": "https://stackoverflow.com/users/3756168/badis-merabet"}, "is_accepted": false, "score": 1, "last_activity_date": 1573398620, "last_edit_date": 1573398620, "creation_date": 1573344643, "answer_id": 58784705, "question_id": 58784496, "link": "https://stackoverflow.com/questions/58784496/not-quite-grasping-goroutines-and-channels-please-break-this-code-down/58784705#58784705", "title": "Not quite grasping goroutines and channels, please break this code down", "body": "<p>Receiver operator <code>&lt;-</code> followed by channel name (<code>done</code> in this case) is  used to wait for a value written to channel from worker goroutine. (i.e this read operation will be blocking. If you omit <code>&lt;-done</code>, main goroutine will exit immediately even before worker's goroutine start and you won't be able to see results)</p>\n\n<p>You can do whatever you want with <code>&lt;-done</code> as value: assign it to another variable, pass it as a parameter to another function or just ignore it as in your case... etc.</p>\n"}], "owner": {"reputation": 2429, "user_id": 5091805, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e4vgq.png?s=128&g=1", "display_name": "Ari", "link": "https://stackoverflow.com/users/5091805/ari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1573398620, "creation_date": 1573342474, "question_id": 58784496, "link": "https://stackoverflow.com/questions/58784496/not-quite-grasping-goroutines-and-channels-please-break-this-code-down", "title": "Not quite grasping goroutines and channels, please break this code down", "body": "<p>I'm following a quick intro to Go and one of the examples is:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc worker(done chan bool) {\n    fmt.Print(\"working...\")\n    time.Sleep(time.Second)\n    fmt.Println(\"done\")\n    done &lt;- true\n}\n\nfunc main() {\n    done := make(chan bool, 1)\n    go worker(done)\n    &lt;-done\n}\n</code></pre>\n\n<p>I understand whats occuring but I guess I'm not grasping the sequence of events or the limitations?</p>\n\n<ol>\n<li>A channel is created called <code>done</code> with a buffer size of 1.</li>\n<li>The channel is passed into a function</li>\n<li>After the timer is complete it adds a <code>true</code> boolean to the channel</li>\n<li>I'm not sure what the final <code>&lt;-done</code> is doing though</li>\n</ol>\n\n<p>from: <a href=\"https://gobyexample.com/channel-synchronization\" rel=\"nofollow noreferrer\">https://gobyexample.com/channel-synchronization</a></p>\n"}, {"tags": ["go", "kubernetes", "kubernetes-apiserver", "client-go"], "comments": [{"owner": {"reputation": 1920, "user_id": 12237732, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07e4ec0f017cdcd70c14f7a38a49f9a2?s=128&d=identicon&r=PG&f=1", "display_name": "Mariusz K.", "link": "https://stackoverflow.com/users/12237732/mariusz-k"}, "edited": false, "score": 1, "creation_date": 1573637750, "post_id": 58783939, "comment_id": 103943269, "body": "Instead of writing kube config to container&#39;s disk try using service account <a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/\" rel=\"nofollow noreferrer\">kubernetes.io/docs/tasks/configure-pod-container/&hellip;</a>"}, {"owner": {"reputation": 1036, "user_id": 3378901, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KEhNf.jpg?s=128&g=1", "display_name": "\u8427\u6613\u5ba2", "link": "https://stackoverflow.com/users/3378901/%e8%90%a7%e6%98%93%e5%ae%a2"}, "edited": false, "score": 1, "creation_date": 1577375588, "post_id": 58783939, "comment_id": 105155548, "body": "Why don&#39;t you just read the content of YAML file and split by <code>^---$</code> in your code?"}, {"owner": {"reputation": 675, "user_id": 12259996, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zse95.jpg?s=128&g=1", "display_name": "Simon", "link": "https://stackoverflow.com/users/12259996/simon"}, "reply_to_user": {"reputation": 1036, "user_id": 3378901, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KEhNf.jpg?s=128&g=1", "display_name": "\u8427\u6613\u5ba2", "link": "https://stackoverflow.com/users/3378901/%e8%90%a7%e6%98%93%e5%ae%a2"}, "edited": false, "score": 0, "creation_date": 1577401157, "post_id": 58783939, "comment_id": 105162555, "body": "@Shawyeok Because that still requires me to know what types are in the file. There is no way to get the type dynamically without testing against several expected types (Kubernetes objects), and if the expected type is not present then the object will not be applied to the cluster (which leads to even more problems). This would also result in having to write a lot of code for a single component which does not scale for several components. Beyond decoding is calling the correct API method to apply the object to a cluster."}, {"owner": {"reputation": 164, "user_id": 6712353, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SmJLgOnYJAs/AAAAAAAAAAI/AAAAAAAAAjw/2evNErmZ2JI/photo.jpg?sz=128", "display_name": "Aisuko", "link": "https://stackoverflow.com/users/6712353/aisuko"}, "edited": false, "score": 0, "creation_date": 1596798539, "post_id": 58783939, "comment_id": 111933519, "body": "@Simon Hi, Is there any solution? I&#39;d like to deploy ServiceMesh <code>linkerd2</code> use client-go and the idea like you said mimic <code>kubectl apply -f -</code>. Should we use <a href=\"https://github.com/kubernetes/kubectl/blob/596d7b0ffffd963af1b995fea599ad49d9b2a046/pkg/cmd/apply/apply.go#L161and\" rel=\"nofollow noreferrer\">github.com/kubernetes/kubectl/blob/&hellip;</a> do not need to manually split resource by their Kind?"}], "answers": [{"comments": [{"owner": {"reputation": 675, "user_id": 12259996, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zse95.jpg?s=128&g=1", "display_name": "Simon", "link": "https://stackoverflow.com/users/12259996/simon"}, "edited": false, "score": 0, "creation_date": 1582689602, "post_id": 60256694, "comment_id": 106860252, "body": "Hello Kevin, thank you for your answer! I haven&#39;t had a chance to get around to trying this, but I wasn&#39;t aware of <code>package restmapper</code> and this looks very promising. Accepting the answer for now, but will revisit it soon."}], "tags": [], "owner": {"reputation": 86, "user_id": 12894538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b621058fdc8dfcf857d1988c0963cbe6?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Lin", "link": "https://stackoverflow.com/users/12894538/kevin-lin"}, "is_accepted": true, "score": 5, "last_activity_date": 1581919250, "creation_date": 1581919250, "answer_id": 60256694, "question_id": 58783939, "link": "https://stackoverflow.com/questions/58783939/using-client-go-to-kubectl-apply-against-the-kubernetes-api-directly-with-mult/60256694#60256694", "title": "Using client-go to `kubectl apply` against the Kubernetes API directly with multiple types in a single YAML file", "body": "<p>It sounds like you've figured out how to deserialize YAML files into Kubernetes <code>runtime.Object</code>s, but the problem is dynamically deploying a <code>runtime.Object</code> without writing special code for each Kind.</p>\n\n<p><code>kubectl</code> achieves this by interacting with the <a href=\"https://godoc.org/k8s.io/client-go/rest\" rel=\"noreferrer\">REST API</a> directly. Specifically, via <a href=\"https://godoc.org/k8s.io/cli-runtime/pkg/resource#Helper\" rel=\"noreferrer\">resource.Helper</a>.</p>\n\n<p>In my code, I have something like:</p>\n\n<pre><code>import (\n    meta \"k8s.io/apimachinery/pkg/api/meta\"\n    \"k8s.io/cli-runtime/pkg/resource\"\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/rest\"\n    \"k8s.io/client-go/restmapper\"\n    \"k8s.io/apimachinery/pkg/runtime\"\n)\n\nfunc createObject(kubeClientset kubernetes.Interface, restConfig rest.Config, obj runtime.Object) error {\n    // Create a REST mapper that tracks information about the available resources in the cluster.\n    groupResources, err := restmapper.GetAPIGroupResources(kubeClientset.Discovery())\n    if err != nil {\n        return err\n    }\n    rm := restmapper.NewDiscoveryRESTMapper(groupResources)\n\n    // Get some metadata needed to make the REST request.\n    gvk := obj.GetObjectKind().GroupVersionKind()\n    gk := schema.GroupKind{Group: gvk.Group, Kind: gvk.Kind}\n    mapping, err := rm.RESTMapping(gk, gvk.Version)\n    if err != nil {\n        return err\n    }\n\n    name, err := meta.NewAccessor().Name(obj)\n    if err != nil {\n        return err\n    }\n\n    // Create a client specifically for creating the object.\n    restClient, err := newRestClient(restConfig, mapping.GroupVersionKind.GroupVersion())\n    if err != nil {\n        return err\n    }\n\n    // Use the REST helper to create the object in the \"default\" namespace.\n    restHelper := resource.NewHelper(restClient, mapping)\n    return restHelper.Create(\"default\", false, obj, &amp;metav1.CreateOptions{})\n}\n\nfunc newRestClient(restConfig rest.Config, gv schema.GroupVersion) (rest.Interface, error) {\n    restConfig.ContentConfig = resource.UnstructuredPlusDefaultContentConfig()\n    restConfig.GroupVersion = &amp;gv\n    if len(gv.Group) == 0 {\n        restConfig.APIPath = \"/api\"\n    } else {\n        restConfig.APIPath = \"/apis\"\n    }\n\n    return rest.RESTClientFor(&amp;restConfig)\n}\n\n</code></pre>\n"}], "owner": {"reputation": 675, "user_id": 12259996, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zse95.jpg?s=128&g=1", "display_name": "Simon", "link": "https://stackoverflow.com/users/12259996/simon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2450, "favorite_count": 5, "accepted_answer_id": 60256694, "answer_count": 1, "score": 15, "last_activity_date": 1581919250, "creation_date": 1573337241, "last_edit_date": 1577400885, "question_id": 58783939, "link": "https://stackoverflow.com/questions/58783939/using-client-go-to-kubectl-apply-against-the-kubernetes-api-directly-with-mult", "title": "Using client-go to `kubectl apply` against the Kubernetes API directly with multiple types in a single YAML file", "body": "<p>I'm using <a href=\"https://github.com/kubernetes/client-go\" rel=\"noreferrer\">https://github.com/kubernetes/client-go</a> and all works well.</p>\n\n<p>I have a manifest (YAML) for the official Kubernetes Dashboard: <a href=\"https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta4/aio/deploy/recommended.yaml\" rel=\"noreferrer\">https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta4/aio/deploy/recommended.yaml</a></p>\n\n<p>I want to mimic <code>kubectl apply</code> of this manifest in Go code, using client-go.</p>\n\n<p>I understand that I need to do some (un)marshalling of the YAML bytes into the correct API types defined in package: <a href=\"https://github.com/kubernetes/api\" rel=\"noreferrer\">https://github.com/kubernetes/api</a></p>\n\n<p>I have successfully <code>Create</code>ed single API types to my cluster, <strong>but how do I do this for a manifest that contains a list of types that are not the same</strong>? Is there a resource <code>kind: List*</code> that supports these different types?</p>\n\n<p>My current workaround is to split the YAML file using <code>csplit</code> with --- as the delimiter</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>csplit /path/to/recommended.yaml /---/ '{*}' --prefix='dashboard.' --suffix-format='%03d.yaml'\n</code></pre>\n\n<p>Next, I loop over the new (14) parts that were created, read their bytes, switch on the type of the object returned by the UniversalDeserializer's decoder and call the correct API methods using my k8s clientset.</p>\n\n<p>I would like to do this to programmatically to make updates to any new versions of the dashboard into my cluster. I will also need to do this for the Metrics Server and many other resources. The alternative (maybe simpler) method is to ship my code with kubectl installed to the container image and directly call <code>kubectl apply -f -</code>; but that means I also need to write the kube config to disk or maybe pass it inline so that kubectl can use it.</p>\n\n<p>I found this issue to be helpful: <a href=\"https://github.com/kubernetes/client-go/issues/193\" rel=\"noreferrer\">https://github.com/kubernetes/client-go/issues/193</a>\nThe decoder lives here: <a href=\"https://github.com/kubernetes/apimachinery/tree/master/pkg/runtime/serializer\" rel=\"noreferrer\">https://github.com/kubernetes/apimachinery/tree/master/pkg/runtime/serializer</a></p>\n\n<p>It's exposed in client-go here: <a href=\"https://github.com/kubernetes/client-go/blob/master/kubernetes/scheme/register.go#L69\" rel=\"noreferrer\">https://github.com/kubernetes/client-go/blob/master/kubernetes/scheme/register.go#L69</a></p>\n\n<p>I've also taken a look at the RunConvert method that is used by kubectl: <a href=\"https://github.com/kubernetes/kubernetes/blob/master/pkg/kubectl/cmd/convert/convert.go#L139\" rel=\"noreferrer\">https://github.com/kubernetes/kubernetes/blob/master/pkg/kubectl/cmd/convert/convert.go#L139</a> and assume that I can provide my own <a href=\"https://github.com/kubernetes/cli-runtime/blob/master/pkg/genericclioptions/io_options.go#L27\" rel=\"noreferrer\">genericclioptions.IOStreams</a> to get the output?</p>\n\n<p><a href=\"https://github.com/kubernetes/kubernetes/blob/master/pkg/kubectl/cmd/convert/convert.go#L141-L145\" rel=\"noreferrer\">It looks like RunConvert is on a deprecation path</a></p>\n\n<p>I've also looked at other questions tagged [client-go] but most use old examples or use a YAML file with a single <code>kind</code> defined, and the API has changed since.</p>\n\n<p>Edit: Because I need to do this for more than one cluster and am creating clusters programmatically (AWS EKS API + CloudFormation/<a href=\"https://github.com/weaveworks/eksctl\" rel=\"noreferrer\">eksctl</a>), I would like to minimize the overhead of creating <code>ServiceAccount</code>s across many cluster contexts, across many AWS accounts. Ideally, the only authentication step involved in creating my clientset is using <a href=\"https://github.com/kubernetes-sigs/aws-iam-authenticator\" rel=\"noreferrer\">aws-iam-authenticator</a> to get a token using cluster data (name, region, CA cert, etc). There hasn't been a release of aws-iam-authenticator for a while, but the contents of <code>master</code> allow for the use of a third-party role cross-account role and external ID to be passed. IMO, this is cleaner than using a <code>ServiceAccount</code> (and <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html\" rel=\"noreferrer\">IRSA</a>) because there are other AWS services the application (the backend API which creates and applies add-ons to these clusters) needs to interact with.</p>\n\n<p>Edit: I have recently found <a href=\"https://github.com/ericchiang/k8s\" rel=\"noreferrer\">https://github.com/ericchiang/k8s</a>. It's definitely simpler to use than client-go, at a high-level, but doesn't support this behavior.</p>\n"}, {"tags": ["windows", "go", "winapi"], "comments": [{"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1573323838, "post_id": 58781818, "comment_id": 103848221, "body": "I created <a href=\"https://play.golang.org/p/xynwizTQSOX\" rel=\"nofollow noreferrer\">this example</a> while looking into the problem. It also includes error output but it doesn&#39;t look like a &quot;normal panic&quot;."}, {"owner": {"reputation": 13, "user_id": 12348354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/372bd8f1fa15091aaa7b8af240a07976?s=128&d=identicon&r=PG&f=1", "display_name": "Anna", "link": "https://stackoverflow.com/users/12348354/anna"}, "reply_to_user": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1573323940, "post_id": 58781818, "comment_id": 103848245, "body": "@xarantolus thanks to hear some one care about it, but how we can solve?"}, {"owner": {"reputation": 13, "user_id": 12348354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/372bd8f1fa15091aaa7b8af240a07976?s=128&d=identicon&r=PG&f=1", "display_name": "Anna", "link": "https://stackoverflow.com/users/12348354/anna"}, "reply_to_user": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 1, "creation_date": 1573324094, "post_id": 58781818, "comment_id": 103848289, "body": "@xarantolus maybe args 3 of RmRegisterResources should be string array not string <a href=\"https://docs.microsoft.com/en-us/windows/win32/api/restartmanager/nf-restartmanager-rmstartsession\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/windows/win32/api/restartmanager/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6168, "user_id": 10611792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r727s.jpg?s=128&g=1", "display_name": "Drake Wu", "link": "https://stackoverflow.com/users/10611792/drake-wu"}, "edited": false, "score": 0, "creation_date": 1574748759, "post_id": 58799037, "comment_id": 104331104, "body": "Hi, did this solve your issue?, please remember to mark if this did answer you, or you can also add an answer which is available for you."}, {"owner": {"reputation": 13, "user_id": 12348354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/372bd8f1fa15091aaa7b8af240a07976?s=128&d=identicon&r=PG&f=1", "display_name": "Anna", "link": "https://stackoverflow.com/users/12348354/anna"}, "edited": false, "score": 0, "creation_date": 1575036548, "post_id": 58799037, "comment_id": 104444266, "body": "Thanks sir, solve my problem stage 1. What about next stage? @drake-wu-msft"}], "tags": [], "owner": {"reputation": 6168, "user_id": 10611792, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r727s.jpg?s=128&g=1", "display_name": "Drake Wu", "link": "https://stackoverflow.com/users/10611792/drake-wu"}, "is_accepted": true, "score": 0, "last_activity_date": 1573465830, "creation_date": 1573465830, "answer_id": 58799037, "question_id": 58781818, "link": "https://stackoverflow.com/questions/58781818/find-out-process-active-handle-lock-on-special-file-using-winapi/58799037#58799037", "title": "Find out process active handle (lock) on special file using WINAPI", "body": "<p><code>RmRegisterResources</code> need a rgsFileName<strong>s</strong> which means the pointer of the File Name string(s) you can pass the array of the string(s), or just pass the address of the filename string if you only have to work on one special file.</p>\n\n<pre><code>var rgsFileNames = unsafe.Pointer(syscall.StringToUTF16Ptr(szPath));\nret, _, callErr = syscall.Syscall9(RmRegisterResources,\n    7,\n    uintptr(dwSession),\n    uintptr(1),\n    uintptr(unsafe.Pointer(&amp;rgsFileNames)),\n    uintptr(0),\n    uintptr(unsafe.Pointer(nil)),\n    uintptr(0),\n    uintptr(unsafe.Pointer(nil)),\n    0,\n    0)\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 12348354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/372bd8f1fa15091aaa7b8af240a07976?s=128&d=identicon&r=PG&f=1", "display_name": "Anna", "link": "https://stackoverflow.com/users/12348354/anna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 1, "accepted_answer_id": 58799037, "answer_count": 1, "score": 0, "last_activity_date": 1611048946, "creation_date": 1573320816, "last_edit_date": 1575053934, "question_id": 58781818, "link": "https://stackoverflow.com/questions/58781818/find-out-process-active-handle-lock-on-special-file-using-winapi", "title": "Find out process active handle (lock) on special file using WINAPI", "body": "<p>I want to use this <a href=\"https://raw.githubusercontent.com/pldmgg/misc-powershell/master/MyFunctions/PowerShellCore_Compatible/Get-FileLockProcess.ps1\" rel=\"nofollow noreferrer\">script</a> as resource to write same as in Go for Windows by using Windows API (reset manager)</p>\n\n<p>So far my code is </p>\n\n<pre><code>Rstrtmgr := syscall.NewLazyDLL(\"Rstrtmgr.dll\")\nRmStartSession := Rstrtmgr.NewProc(\"RmStartSession\")\nRmRegisterResources := Rstrtmgr.NewProc(\"RmRegisterResources\")\nRmGetList := Rstrtmgr.NewProc(\"RmGetList\")\n\nvar dwSession uint32 = 0\nvar szSessionKey = Utils.RandString(32)\nret, _, callErr := RmStartSession.Call(\n    uintptr(unsafe.Pointer(&amp;dwSession)),\n    uintptr(0),\n    uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(szSessionKey))))\n\n\nvar rgsFileNames = unsafe.Pointer(syscall.StringToUTF16Ptr(szPath))\nret, _, callErr = RmRegisterResources.Call(\n    uintptr(dwSession),\n    uintptr(1),\n    uintptr(unsafe.Pointer(&amp;rgsFileNames)),\n    uintptr(0),\n    uintptr(unsafe.Pointer(nil)),\n    uintptr(0),\n    uintptr(unsafe.Pointer(nil)))\n\n\nvar nProcInfoNeeded uint32 = 0\nvar nProcInfo  uint32 = 10\nvar lpdwRebootReasons uint32 = 0\n\ntype RM_UNIQUE_PROCESS struct {\n    dwProcessId         uint32\n    ProcessStartTime    windows.Filetime\n}\n\ntype ApplicationType struct {\n    RmUnknownApp   uint32\n    RmMainWindow   uint32\n    RmOtherWindow  uint32\n    RmService      uint32\n    RmExplorer     uint32\n    RmConsole      uint32\n    RmCritical     uint32\n}\n\ntype RM_PROCESS_INFO struct{\n    RM_UNIQUE_PROCESS    RM_UNIQUE_PROCESS\n    strAppName           string\n    strServiceShortName  string\n    RM_APP_TYPE          ApplicationType\n    AppStatus            uint32\n    TSSessionId          uint32\n    bRestartable         bool\n}\n\nvar _RM_PROCESS_INFO [10]RM_PROCESS_INFO\nret, _, callErr = RmGetList.Call(\n    uintptr(dwSession),\n    uintptr(unsafe.Pointer(&amp;nProcInfoNeeded)),\n    uintptr(unsafe.Pointer(&amp;nProcInfo)),\n    uintptr(unsafe.Pointer(&amp;_RM_PROCESS_INFO)),\n    uintptr(unsafe.Pointer(&amp;lpdwRebootReasons)),\n    )\n_ = ret\n_ = callErr\n</code></pre>\n\n<p>but I have error on RmGetList</p>\n\n<p>my Goal is get the PID of that process lock my file by path</p>\n\n<p>I edit my code. Please review it</p>\n\n<ul>\n<li>example in <a href=\"https://devblogs.microsoft.com/oldnewthing/?p=8283\" rel=\"nofollow noreferrer\">c++</a> </li>\n</ul>\n"}, {"tags": ["arrays", "go", "struct", "slice"], "comments": [{"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 1, "creation_date": 1573318999, "post_id": 58781455, "comment_id": 103846928, "body": "Hi, welcome and thanks for the question! Can you update your example with what you&#39;ve tried so far so that we can get an idea of what you&#39;re trying to do?"}, {"owner": {"reputation": 1, "user_id": 12348234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/193e9c45123df555c400aa81ad022271?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Avtara Khrisna", "link": "https://stackoverflow.com/users/12348234/muhammad-avtara-khrisna"}, "reply_to_user": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1573319355, "post_id": 58781455, "comment_id": 103847011, "body": "I&#39;ve tried it this way @SamWhited ` func addStock(){ \tvar new Car \tvar totalArr int \ttotalArr = len(Stock) \tfmt.Scanln(&amp;new.Code,&amp;new.Brand,&amp;new.Type,&amp;new.Price,&amp;new.S&zwnj;&#8203;upply) \tappend(Stock[totalArr].Code,new.Code) }`  but I get an error like this first argument to append must be slice; have string"}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1573319586, "post_id": 58781455, "comment_id": 103847076, "body": "I&#39;ve added an example that explains this; the first argument to append is indeed the slice itself. However, it looks like you might be trying to modify something in the slice, not actually append a new car to it? This was not clear from your original question. Is this what you&#39;re trying to do, or are you trying to append a new car to the slice?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1573376803, "post_id": 58781455, "comment_id": 103856642, "body": "You can&#39;t add anything to an array. Arrays are fixed length. You can only change array elements. To add to a slice use <code>append</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 12348234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/193e9c45123df555c400aa81ad022271?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Avtara Khrisna", "link": "https://stackoverflow.com/users/12348234/muhammad-avtara-khrisna"}, "edited": false, "score": 0, "creation_date": 1573321983, "post_id": 58781616, "comment_id": 103847710, "body": "okay, now I have started to understand the way it works in go, thank you for helping a lot"}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "reply_to_user": {"reputation": 1, "user_id": 12348234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/193e9c45123df555c400aa81ad022271?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Avtara Khrisna", "link": "https://stackoverflow.com/users/12348234/muhammad-avtara-khrisna"}, "edited": false, "score": 0, "creation_date": 1573333406, "post_id": 58781616, "comment_id": 103850465, "body": "I&#39;m glad this was helpful, good luck learning Go, it&#39;s a nice little language and I&#39;m sure you&#39;ll enjoy it! If this answered your question, don&#39;t forget to mark it as the answer with the big green checkbox to help others in the future that might stumble upon this while searching. Thanks!"}], "tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": true, "score": 2, "last_activity_date": 1573319884, "last_edit_date": 1573319884, "creation_date": 1573319351, "answer_id": 58781616, "question_id": 58781455, "link": "https://stackoverflow.com/questions/58781455/how-to-append-a-slice-in-struct/58781616#58781616", "title": "How to append a slice in struct", "body": "<p>Data can be added to slices using the <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"nofollow noreferrer\"><code>append</code></a> builtin method. To append to a slice, pass the slice as an argument and assign the new slice back to the original. The details of why you have to do this aren't important if you're just learning the language, but suffice it to say that it makes things more efficient. For example:</p>\n\n<pre><code>Stock = append(Stock, Car{\n  Code: \"newcar\",\n  // \u2026\n})\n</code></pre>\n\n<p>You may also find <a href=\"https://golang.org/doc/effective_go.html#append\" rel=\"nofollow noreferrer\">this section</a> from <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\"><em>Effective Go</em></a> on appending useful if you'd like a better understanding of <code>append</code>.</p>\n\n<p>Here is a modified version of your example that can be run on the Go playground. I have made a few other minor changes to the code that may or may not be useful for a new developer to learn:</p>\n\n<p><a href=\"https://play.golang.org/p/AqlrL47pImw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AqlrL47pImw</a></p>\n"}], "owner": {"reputation": 1, "user_id": 12348234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/193e9c45123df555c400aa81ad022271?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Avtara Khrisna", "link": "https://stackoverflow.com/users/12348234/muhammad-avtara-khrisna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "closed_date": 1573376827, "accepted_answer_id": 58781616, "answer_count": 1, "score": -3, "last_activity_date": 1573376781, "creation_date": 1573318245, "last_edit_date": 1573376781, "question_id": 58781455, "link": "https://stackoverflow.com/questions/58781455/how-to-append-a-slice-in-struct", "closed_reason": "Duplicate", "title": "How to append a slice in struct", "body": "<p>What is Go's syntax to add item to a slice or an array?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Car struct{\n    Code string\n    Brand string\n    Type string\n    Price int \n    Supply int\n}\n\nvar Stock []Car\n\nfunc init()  {\n    Stock = []Car{\n        Car{\n            Code:\"TOY13EMTAV\",\n            Brand:\"Toyota Avanza\",\n            Type:\"1.3 E M/T\",\n            Price:191100000,\n            Supply:2,\n        },\n        Car{\n            Code:\"TOY15GMTAV\",\n            Brand:\"Toyota Avanza\",\n            Type:\"1.5 G M/T\",\n            Price:221250000,\n            Supply:3,\n        },\n        Car{\n            Code:\"TOY15GCVTYAR\",\n            Brand:\"Toyota Yaris\",\n            Type:\"G CVT\",\n            Price:257650000,\n            Supply:5,\n        },\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 13, "user_id": 12134791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22b21249b9244c28d4ff933cfe00c80e?s=128&d=identicon&r=PG&f=1", "display_name": "tutahunia", "link": "https://stackoverflow.com/users/12134791/tutahunia"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1573323063, "post_id": 58780687, "comment_id": 103848002, "body": "Sorry it was VSCODE bad configuration + some duplicated methods from car_controller.go  All is ok , go mod importas all my packages."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1573323203, "post_id": 58780687, "comment_id": 103848047, "body": "could be more useful to detail the VSCODE confiruration update you applied."}, {"owner": {"reputation": 13, "user_id": 12134791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22b21249b9244c28d4ff933cfe00c80e?s=128&d=identicon&r=PG&f=1", "display_name": "tutahunia", "link": "https://stackoverflow.com/users/12134791/tutahunia"}, "edited": false, "score": 0, "creation_date": 1573324695, "post_id": 58780687, "comment_id": 103848441, "body": "In Visual Code go to Settings, Search for GO and activate: GO: Autocomplete Unimported Packages"}], "owner": {"reputation": 13, "user_id": 12134791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22b21249b9244c28d4ff933cfe00c80e?s=128&d=identicon&r=PG&f=1", "display_name": "tutahunia", "link": "https://stackoverflow.com/users/12134791/tutahunia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 246, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1573376937, "creation_date": 1573313334, "last_edit_date": 1573376937, "question_id": 58780687, "link": "https://stackoverflow.com/questions/58780687/dont-import-my-custom-models-form-models-package", "title": "Don&#39;t import my custom models form models package", "body": "<p>I have no error and I don't know why I can access my model from models packages.\nI use module also, here is my go.mod file:</p>\n\n<hr>\n\n<pre><code>module myapp\n\ngo 1.12\n\nrequire (\n    github.com/badoux/checkmail v0.0.0-20181210160741-9661bd69e9ad\n    github.com/dgrijalva/jwt-go v3.2.0+incompatible\n    github.com/gorilla/mux v1.7.3\n    github.com/jinzhu/gorm v1.9.11\n    github.com/joho/godotenv v1.3.0\n    github.com/rs/cors v1.7.0\n    golang.org/x/crypto v0.0.0-20191108234033-bd318be0434a\n)\n</code></pre>\n\n<hr>\n\n<p><code>user.go</code> and <code>car.go</code> are importing fine but not the rest of the new models that I add are not importing well.</p>\n\n<p>Here is the tree of my app:</p>\n\n<pre><code>\u251c\u2500\u2500 api\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 auth\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 token.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 controllers\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 base.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 car_location_controller.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 cars_controller.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 login_controller.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 routers.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 users_controller.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 middlewares\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 middlewares.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 models\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 Car.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 CarLocation.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 Rental.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 User.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 responses\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 json.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 server.go\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 utils\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 formaterror\n\u2502\u00a0\u00a0         \u2514\u2500\u2500 formaterror.go\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 go.sum\n\u251c\u2500\u2500 info.txt\n\u2514\u2500\u2500 main.go\n</code></pre>\n\n<p>I try to call <code>CarLocation.go</code> into <code>car_location_controller.go</code> but I got </p>\n\n<blockquote>\n  <p>CarLocation not declared by package models</p>\n</blockquote>\n\n<p>Here is my CarLocation.go:</p>\n\n<pre><code>package models\n\nimport (\n    \"errors\"\n    \"html\"\n    \"strings\"\n    \"time\"\n)\n\ntype CarLocation struct {\n    ID        uint32    `gorm:\"primary_key;auto_increment\" json:\"id\"`\n    CarID     uint32    `gorm:\"int\" json:\"user_id\"`\n    Car       Car       `json:\"car\"`\n    Street    string    `json:\"street\"`\n    City      string    `json:\"city\"`\n    State     string    `json:\"state\"`\n    Country   string    `json:\"country\"`\n    CreatedAt time.Time `gorm:\"default:CURRENT_TIMESTAMP\" json:\"created_at\"`\n    UpdatedAt time.Time `gorm:\"default:CURRENT_TIMESTAMP\" json:\"updated_at\"`\n}\n\nfunc (l *CarLocation) Prepare() {\n    l.ID = 0\n    l.Street = html.EscapeString(strings.TrimSpace(l.Street))\n    l.City = html.EscapeString(strings.TrimSpace(l.City))\n    l.State = html.EscapeString(strings.TrimSpace(l.State))\n    l.CreatedAt = time.Now()\n    l.UpdatedAt = time.Now()\n}\n\nfunc (cl *CarLocation) Validate() error {\n    if cl.Street == \"\" {\n        return errors.New(\"Required Street\")\n    }\n    if cl.City == \"\" {\n        return errors.New(\"Required City\")\n    }\n\n    if cl.State == \"\" {\n        return errors.New(\"Required State\")\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>And here is where I want to use CarLocation into <code>car_location_controller.go</code>:</p>\n\n<pre><code>package controllers\n\nimport (\n    \"encoding/json\"\n    \"io/ioutil\"\n    \"net/http\"\n\n    \"myapp/api/responses\"\n    \"myapp/api/models\"\n)\n\nfunc (server *Server) CreateCarLocation(w http.ResponseWriter, r *http.Request) {\n\n    body, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        responses.ERROR(w, http.StatusUnprocessableEntity, err)\n        return\n    }\n    car := models.CarLocation{}\n    err = json.Unmarshal(body, &amp;car)\n    if err != nil {\n        responses.ERROR(w, http.StatusUnprocessableEntity, err)\n        return\n    }\n\n    car.Prepare()\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573306275, "post_id": 58779594, "comment_id": 103843726, "body": "You do understand why <code>setCookie</code> works before calling <code>next.ServeHTTP</code> but not after?"}, {"owner": {"reputation": 12689, "user_id": 711852, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/78e2002b834641bd69454e28f729ce12?s=128&d=identicon&r=PG", "display_name": "Coder1", "link": "https://stackoverflow.com/users/711852/coder1"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573307248, "post_id": 58779594, "comment_id": 103843936, "body": "Yes. I&#39;m just highlighting my conundrum that I can&#39;t set the cookie where I can fetch the header I need, and vice versa."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573308249, "post_id": 58779594, "comment_id": 103844201, "body": "Ok, so you know that once you send a response to the client, which I presume is what <code>next.ServeHTTP(w, r)</code> does, you cannot <i>after</i> that send additional headers (apart from trailers but there Set-Cookie is not allowed I believe). So what you want to do is to write the Set-Cookie header before you write the response. The only way I can think of, that would best match your requirement, <i>is</i> to use a custom response writer, one that <i>postpones</i> the writing of the response until after your done. Something like this: <a href=\"https://play.golang.com/p/bGOJ9He5pcW\" rel=\"nofollow noreferrer\">play.golang.com/p/bGOJ9He5pcW</a> (haven&#39;t tested it but you get the gist)."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573308564, "post_id": 58779594, "comment_id": 103844276, "body": "Basically what you have to do is to write the Header <i>before</i> you write the Body (or StatusCode) of a response, it&#39;s in the name. How you do that is up to you but the customer response writer is certainly one way to get it done."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1573309135, "post_id": 58779594, "comment_id": 103844394, "body": "<i>&quot;my conundrum that I can&#39;t set the cookie where I can fetch the header&quot;</i> Keep in mind that you <i>can</i> set the cookie to the <code>Header</code> value just as you can read from the <code>Header</code> value, it&#39;s just that anything you set to the <code>Header</code> <i>after</i> the response was sent over HTTP will not magically appear to the client in that already-sent response. This is also explicitly mentioned in the <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow noreferrer\">docs</a>: <code>Changing the header map after a call to WriteHeader (or Write) has no effect unless the modified headers are trailers.</code>"}, {"owner": {"reputation": 12689, "user_id": 711852, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/78e2002b834641bd69454e28f729ce12?s=128&d=identicon&r=PG", "display_name": "Coder1", "link": "https://stackoverflow.com/users/711852/coder1"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1573311954, "post_id": 58779594, "comment_id": 103845081, "body": "@mkopriva I understand now. Was up all night trying to sort that out. If you add it as an answer here I&#39;ll accept. I am grateful, thanks."}, {"owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "edited": false, "score": 0, "creation_date": 1573321652, "post_id": 58779594, "comment_id": 103847644, "body": "Given that the question is regarding reverse proxy, consider using <a href=\"https://godoc.org/net/http/httputil#ReverseProxy.ModifyResponse\" rel=\"nofollow noreferrer\">ReverseProxy.ModifyResponse</a> to set the cookie."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1573317636, "creation_date": 1573317636, "answer_id": 58781363, "question_id": 58779594, "link": "https://stackoverflow.com/questions/58779594/using-a-custom-http-responsewriter-to-write-cookies-based-on-the-response-from-a/58781363#58781363", "title": "Using a custom http.ResponseWriter to write cookies based on the response from a proxied request?", "body": "<p>From the documentation on <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow noreferrer\"><code>http.ResponseWriter</code></a> methods:\n<em>(emphasis added)</em></p>\n\n<ul>\n<li><p><code>Header() http.Header</code>:</p>\n\n<blockquote>\n  <p>Changing the header map <strong>after a call to WriteHeader (or Write) has no\n  effect</strong> unless the modified headers are trailers.</p>\n</blockquote></li>\n<li><p><code>WriteHeader(statusCode int)</code>:</p>\n\n<blockquote>\n  <p>WriteHeader <strong>sends an HTTP response header</strong> with the provided status\n  code.</p>\n</blockquote></li>\n<li><p><code>Write([]byte) (int, error)</code>:</p>\n\n<blockquote>\n  <p>If WriteHeader has not yet been called, Write <strong>calls\n  WriteHeader(http.StatusOK)</strong> before writing the data.</p>\n</blockquote></li>\n</ul>\n\n<p>This should highlight the reason why, you can't set a cookie after the <code>next.ServeHTTP(w, r)</code> call, which is that one of the handlers in the middleware chain executed by that call is calling either <code>WriteHeader</code> or <code>Write</code> directly or indirectly.</p>\n\n<p>So to be able set the cookie <em>after</em> the <code>next.ServeHTTP(w, r)</code> call you need to make sure that none of the handlers in the middleware chain calls <code>WriteHeader</code> or <code>Write</code> on the original <code>http.ResponseWriter</code> instance. One way to do this is to wrap the original instance in a custom <code>http.ResponseWriter</code> implementation that will <em>postpone</em> the writing of the response until after you're done with setting the cookie.</p>\n\n<hr>\n\n<p>For example something like this:</p>\n\n<pre><code>type responsewriter struct {\n    w    http.ResponseWriter\n    buf  bytes.Buffer\n    code int\n}\n\nfunc (rw *responsewriter) Header() http.Header {\n    return rw.w.Header()\n}\n\nfunc (rw *responsewriter) WriteHeader(statusCode int) {\n    rw.code = statusCode\n}\n\nfunc (rw *responsewriter) Write(data []byte) (int, error) {\n    return rw.buf.Write(data)\n}\n\nfunc (rw *responsewriter) Done() (int64, error) {\n    if rw.code &gt; 0 {\n        rw.w.WriteHeader(rw.code)\n    }\n    return io.Copy(rw.w, &amp;rw.buf)\n}\n</code></pre>\n\n<p>And you would use it like this in your middleware:</p>\n\n<pre><code>func handler(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        rw := &amp;responsewriter{w: w}\n        next.ServeHTTP(rw, r)\n\n        if r.Method == \"POST\" &amp;&amp; r.URL.String() == \"/login\" {\n            foo := rw.Header().Get(\"X-FOO\")\n            setCookie(rw, \"MYAPPFOO\", foo)\n        }\n\n        if _, err := rw.Done(); err != nil {\n            log.Println(err)\n        }\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 12689, "user_id": 711852, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/78e2002b834641bd69454e28f729ce12?s=128&d=identicon&r=PG", "display_name": "Coder1", "link": "https://stackoverflow.com/users/711852/coder1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "accepted_answer_id": 58781363, "answer_count": 1, "score": 0, "last_activity_date": 1573317636, "creation_date": 1573304859, "question_id": 58779594, "link": "https://stackoverflow.com/questions/58779594/using-a-custom-http-responsewriter-to-write-cookies-based-on-the-response-from-a", "title": "Using a custom http.ResponseWriter to write cookies based on the response from a proxied request?", "body": "<p>My original question <a href=\"https://stackoverflow.com/questions/58776775/how-can-i-set-a-cookie-based-on-response-header-with-reverse-proxy?noredirect=1#comment103840087_58776775\">here</a> was flagged as a duplicate of <a href=\"https://stackoverflow.com/questions/38334072/control-http-headers-from-outer-go-middleware\">this</a> question. I had no luck implementing it and suspect my problem is misunderstood, so with my question closed, I'm starting fresh with a more specific question.</p>\n\n<p>I'm trying to set a cookie based on a response header from within middleware in request that is reverse proxied.</p>\n\n<p>Here's the workflow:</p>\n\n<ul>\n<li>User requests <a href=\"http://example.com/foo/bar\" rel=\"nofollow noreferrer\">http://example.com/foo/bar</a></li>\n<li>Go app uses ReverseProxy to proxy that request to <a href=\"http://baz.com\" rel=\"nofollow noreferrer\">http://baz.com</a></li>\n<li>baz.com sets a response header <code>X-FOO</code></li>\n<li>Go app modifies response by setting a <code>MYAPPFOO</code> cookie with the value of the <code>X-FOO</code> response header</li>\n<li>The cookie is written to the user's browser</li>\n</ul>\n\n<p>It was suggested that a custom <code>http.ResponseWriter</code> will work, but after trying and searching for more information, it is not clear how to approach this.</p>\n\n<p>Since I'm failing to grasp the concept of a custom ResponseWriter for my use case, I'll post code that demonstrates more precisely what I was trying to do at the point I got stuck:</p>\n\n<pre><code>package main\n\nimport (\n\n    \"github.com/gorilla/mux\"\n    \"log\"\n    \"net/http\"\n    \"net/http/httputil\"\n    \"net/url\"\n)\n\nfunc setCookie(w http.ResponseWriter, name string, value string) {\n    ...\n    http.SetCookie(w, &amp;cookie)\n}\n\nfunc handler(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\n        // setCookie() works here\n        // but I cannot access w.Header().Get(\"X-FOO\")\n\n        next.ServeHTTP(w, r)\n\n        // I can access w.Header().Get(\"X-FOO\") here\n        // but setCookie() does not cookie the user's browser\n\n        // If I could do it all in one place, this is what I would do:\n        if r.Method == \"POST\" &amp;&amp; r.URL.String() == \"/login\" {\n            foo := w.Header().Get(\"X-FOO\")\n            setCookie(w, \"MYAPPFOO\", foo)\n\n        }\n    })\n}\n\nfunc main() {\n\n    r := mux.NewRouter()\n    r.Use(handler)\n    proxy := httputil.NewSingleHostReverseProxy(\"https://baz.example.com/\")\n    r.PathPrefix(\"/\").Handler(proxy)\n    log.Fatal(http.ListenAndServe(\":9001\", r))\n}\n</code></pre>\n\n<p>As a side note, I was able to make this work with <code>ReverseProxy.ModifyResponse</code> as recommended in the comments of my last question but I'd really like to achieve this with middleware to keep the code that dynamically creates proxies from config clean. (not in the example code)</p>\n"}, {"tags": ["go", "reflection"], "answers": [{"tags": [], "owner": {"reputation": 3360, "user_id": 329463, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cc84f018e9d2d814cd7c1feffb6d624a?s=128&d=identicon&r=PG", "display_name": "vearutop", "link": "https://stackoverflow.com/users/329463/vearutop"}, "is_accepted": true, "score": 0, "last_activity_date": 1573299196, "creation_date": 1573299196, "answer_id": 58778834, "question_id": 58778683, "link": "https://stackoverflow.com/questions/58778683/lookup-a-tag-by-field-symbol-in-go/58778834#58778834", "title": "Lookup a tag by field symbol in Go", "body": "<p>Pointer to field value does no contain any information about owner structure, that's a different way of indirection, so having only a pointer field value is not enough to solve the problem.</p>\n\n<p>One solution could be to use pointer to owner structure together with pointer to the field in that structure, iterate fields of that structure value with reflection until the address of iterated field matches given field value pointer.</p>\n\n<p><a href=\"https://play.golang.org/p/kaPQ9HF9wAK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/kaPQ9HF9wAK</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    type MyStruct struct {\n        Foo string `tag:\"val\"`\n    }\n    entity := MyStruct{}\n    tagVal := getTag(&amp;entity, &amp;entity.Foo)\n    fmt.Println(tagVal) // val\n}\n\nfunc getTag(structPtr, fieldPtr interface{}) string {\n    sf, ok := structFieldByValPtr(structPtr, fieldPtr)\n    if !ok {\n        return \"\"\n    }\n    return sf.Tag.Get(\"tag\")\n}\n\nfunc structFieldByValPtr(structPtr, fieldPtr interface{}) (reflect.StructField, bool) {\n    v := reflect.Indirect(reflect.ValueOf(structPtr))\n    t := v.Type()\n\n    for i := 0; i &lt; v.NumField(); i++ {\n        fv := v.Field(i)\n        ft := t.Field(i)\n\n        if fv.Addr().Interface() == fieldPtr {\n            return ft, true\n        }\n\n        if ft.Anonymous {\n            sf, ok := structFieldByValPtr(fv.Addr().Interface(), fieldPtr)\n            if ok {\n                return sf, true\n            }\n        }\n    }\n\n    return reflect.StructField{}, false\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 12347178, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ZH-2is9G27A/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfqoLhDs6-oLyC1J_z5kR96nJMWWg/photo.jpg?sz=128", "display_name": "George Washington", "link": "https://stackoverflow.com/users/12347178/george-washington"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 1, "accepted_answer_id": 58778834, "answer_count": 1, "score": 1, "last_activity_date": 1573299196, "creation_date": 1573297967, "question_id": 58778683, "link": "https://stackoverflow.com/questions/58778683/lookup-a-tag-by-field-symbol-in-go", "title": "Lookup a tag by field symbol in Go", "body": "<p>Given a structure with fields I'd like to lookup tag value for particular field symbolically (without providing field name as string).</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type MyStruct struct {\n    Foo string `tag:\"val\"`\n}\nentity := MyStruct{}\ntagVal := getTag(&amp;entity.Foo) // the function would return \"val\" for Foo field\n</code></pre>\n\n<p>I'd like to implement a <code>getTag</code> function that would return tag value for a given field.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 2, "creation_date": 1573279181, "post_id": 58776775, "comment_id": 103838880, "body": "There is a <code>ModifyResponse</code> hook in <code>proxy</code> which should be able to modify the response header before it gets forwarded to the client."}, {"owner": {"reputation": 12689, "user_id": 711852, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/78e2002b834641bd69454e28f729ce12?s=128&d=identicon&r=PG", "display_name": "Coder1", "link": "https://stackoverflow.com/users/711852/coder1"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1573285438, "post_id": 58776775, "comment_id": 103839759, "body": "I&#39;ve tested this successfully. If I can&#39;t achieve it with middleware (cleaner for my purposes), then I&#39;ll be going with <code>ModifyResponse</code>. Thanks!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1573287621, "post_id": 58776775, "comment_id": 103840087, "body": "What you&#39;re attempting will work fine, but you need to use your own <code>http.ResponseWriter</code> implementation, that doesn&#39;t send data to the client until after your modifications."}, {"owner": {"reputation": 12689, "user_id": 711852, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/78e2002b834641bd69454e28f729ce12?s=128&d=identicon&r=PG", "display_name": "Coder1", "link": "https://stackoverflow.com/users/711852/coder1"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1573303343, "post_id": 58776775, "comment_id": 103843092, "body": "@Flimzy thanks for the lead. I gave it a solid try but the question you referenced this as a duplicate of does not demonstrate how to set a cookie based on a response header within the middleware of a reverse proxy. I understand cookie management is just headers and middleware is a common pattern, but I am having no luck applying that question, or the blog post he linked, to my question."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1573376155, "post_id": 58776775, "comment_id": 103856514, "body": "@Coder1: Does <a href=\"https://stackoverflow.com/q/12130582/13860\">this</a> help with that part?"}, {"owner": {"reputation": 12689, "user_id": 711852, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/78e2002b834641bd69454e28f729ce12?s=128&d=identicon&r=PG", "display_name": "Coder1", "link": "https://stackoverflow.com/users/711852/coder1"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1573399206, "post_id": 58776775, "comment_id": 103861844, "body": "@Flimzy your initial response helped move me forward. At my level of experience on this topic, I was not able to figure it out. With my issue closed here, I knew a little more of what I was looking for so <a href=\"https://stackoverflow.com/questions/58779594/using-a-custom-http-responsewriter-to-write-cookies-based-on-the-response-from-a\">this</a> question/answer helped me understand the detail. I was bummed my Q got closed here, but it ended up helping me ask a better question. Thank you here and on other questions."}], "owner": {"reputation": 12689, "user_id": 711852, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/78e2002b834641bd69454e28f729ce12?s=128&d=identicon&r=PG", "display_name": "Coder1", "link": "https://stackoverflow.com/users/711852/coder1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "closed_date": 1573287576, "answer_count": 0, "score": 1, "last_activity_date": 1573278548, "creation_date": 1573278548, "question_id": 58776775, "link": "https://stackoverflow.com/questions/58776775/how-can-i-set-a-cookie-based-on-response-header-with-reverse-proxy", "closed_reason": "Duplicate", "title": "How can I set a cookie based on response header with reverse proxy?", "body": "<p>I'm trying to set a cookie based on a response header from within middleware used in a reverse proxy request.</p>\n\n<p>Problem: I can only get the response header after <code>next.ServerHTTP(w, r)</code> and I can only set a cookie before it. (So it seems)</p>\n\n<p>See the comments in the <code>handler</code> method I'm using as middleware. (I've abbreviated this code for this question)</p>\n\n<pre><code>package main\n\nimport (\n\n    \"github.com/gorilla/mux\"\n    \"log\"\n    \"net/http\"\n    \"net/http/httputil\"\n    \"net/url\"\n)\n\nfunc setCookie(w http.ResponseWriter, name string, value string) {\n    ...\n    http.SetCookie(w, &amp;cookie)\n}\n\nfunc handler(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\n        // setCookie() works here\n        // but I cannot access w.Header().Get(\"X-FOO\")\n\n        next.ServeHTTP(w, r)\n\n        // I can access w.Header().Get(\"X-FOO\") here\n        // but setCookie() does not cookie the user's browser\n\n        // If I could do it all in one place, this is what I would do:\n        if r.Method == \"POST\" &amp;&amp; r.URL.String() == \"/login\" {\n            foo := w.Header().Get(\"X-FOO\")\n            setCookie(w, \"MYAPPFOO\", foo)\n\n        }\n    })\n}\n\nfunc main() {\n\n    r := mux.NewRouter()\n    r.Use(handler)\n        proxy := httputil.NewSingleHostReverseProxy(\"https://baz.example.com/\")\n        r.PathPrefix(\"/\").Handler(proxy)\n        log.Fatal(http.ListenAndServe(\":9001\", r))\n}\n</code></pre>\n\n<p>Is it possible to set a cookie based on a response header from the server?</p>\n\n<p>If it's not clear,  here's the desired workflow:</p>\n\n<ul>\n<li>User requests <a href=\"http://example.com/foo/bar\" rel=\"nofollow noreferrer\">http://example.com/foo/bar</a></li>\n<li>Go app proxies to <a href=\"http://baz.example.com\" rel=\"nofollow noreferrer\">http://baz.example.com</a></li>\n<li>baz.example.com sets a response header <code>X-FOO</code></li>\n<li>Go app modifies response by setting a <code>MYAPPFOO</code> cookie with the value of the <code>X-FOO</code> response header</li>\n<li>The cookie is written to the user's browser</li>\n</ul>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1573276867, "post_id": 58776628, "comment_id": 103838608, "body": "Your test code doesn&#39;t use MySearchCriteria. What is GormStringSearchCriteria? If it is something that  has its own json unmarshal method, and if it expects strings (which is what it looks like from its name), then the last element in the array you&#39;re unmarshaling will fail because it is a number."}, {"owner": {"reputation": 587, "user_id": 1663898, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/HR2fj.jpg?s=128&g=1", "display_name": "Deslyxia", "link": "https://stackoverflow.com/users/1663898/deslyxia"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1573280928, "post_id": 58776628, "comment_id": 103839132, "body": "Updated the code bit in the example to use MySearchCriteria"}], "answers": [{"comments": [{"owner": {"reputation": 587, "user_id": 1663898, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/HR2fj.jpg?s=128&g=1", "display_name": "Deslyxia", "link": "https://stackoverflow.com/users/1663898/deslyxia"}, "edited": false, "score": 0, "creation_date": 1573352380, "post_id": 58777200, "comment_id": 103853575, "body": "Take into account for a moment that the input structure is technically setup to be an array or string arrays like so:      &quot;[\\&quot;IN\\&quot;,\\&quot;id\\&quot;, 342],[\\&quot;IN\\&quot;,\\&quot;foo\\&quot;, \\&quot;bar\\&quot;],[\\&quot;EQ\\&quot;,\\&quot;id2\\&quot;, 342]&quot;   How does that change your response ?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 587, "user_id": 1663898, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/HR2fj.jpg?s=128&g=1", "display_name": "Deslyxia", "link": "https://stackoverflow.com/users/1663898/deslyxia"}, "edited": false, "score": 0, "creation_date": 1573355936, "post_id": 58777200, "comment_id": 103853916, "body": "Your original code already handles that. The for loop with <code>range v</code> will process each element of <code>filter</code>. The code I have in my answer applies to one such element. You can process each string to build a  MySearchCriteria instance, and append it to an array"}, {"owner": {"reputation": 587, "user_id": 1663898, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/HR2fj.jpg?s=128&g=1", "display_name": "Deslyxia", "link": "https://stackoverflow.com/users/1663898/deslyxia"}, "edited": false, "score": 0, "creation_date": 1573458649, "post_id": 58777200, "comment_id": 103875476, "body": "I think this is close .... I updated the code above to reflect what I am trying to do now. I guess eventually I can deal with typing the Values portion of my struct but i really dont care at this stage. I just need to get them into the correct objects."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 587, "user_id": 1663898, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/HR2fj.jpg?s=128&g=1", "display_name": "Deslyxia", "link": "https://stackoverflow.com/users/1663898/deslyxia"}, "edited": false, "score": 0, "creation_date": 1573459065, "post_id": 58777200, "comment_id": 103875603, "body": "You need to escape those quotes in the filter string. Once you do that, it is an array of strings, so [][]interface{} won&#39;t do. Also, in that string you&#39;re expecting an array of strings and numbers, so a nested array won&#39;t do either. It should be [&quot;IN&quot;,&quot;bar&quot;,1,5,9,11]"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 2, "last_activity_date": 1573283421, "creation_date": 1573283421, "answer_id": 58777200, "question_id": 58776628, "link": "https://stackoverflow.com/questions/58776628/unmarshal-json-string-to-array-with-interface/58777200#58777200", "title": "Unmarshal JSON string to array with interface", "body": "<p>It appears like you're trying to unmarshal:</p>\n\n<pre><code>[\"IN\",\"id\", 342]\n</code></pre>\n\n<p>into</p>\n\n<pre><code>type MySearchCriteria struct {\n    Operator string\n    Field    string\n    Values   []interface{} //this could be an array of strings or int64\n}\n</code></pre>\n\n<p>Is your expectation for unmarshal is to populate the fields of the struct in order? If so, that's not going to work.</p>\n\n<p>To unmarshal that JSON array, you have to use an array:</p>\n\n<pre><code>var flt []interface{}\njson.Unmarshal(b, &amp;flt)\n</code></pre>\n\n<p>Then you can do:</p>\n\n<pre><code>operator:=flt[0].(string)\nfield:=flt[1].(string)\ninumbers:=make([]int64,0)\nstrvalues:=make([]string,0)\nfor i:=2;i&lt;len(flt);i++ {\n    if number, ok:=flt[i].(float64); ok {\n         inumbers=append(inumbers,int64(number))\n    } else if str, ok:=flt[i].(string); ok {\n         strvalues=append(strvalues,str)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 587, "user_id": 1663898, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/HR2fj.jpg?s=128&g=1", "display_name": "Deslyxia", "link": "https://stackoverflow.com/users/1663898/deslyxia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1573458581, "creation_date": 1573276333, "last_edit_date": 1573458581, "question_id": 58776628, "link": "https://stackoverflow.com/questions/58776628/unmarshal-json-string-to-array-with-interface", "title": "Unmarshal JSON string to array with interface", "body": "<p>Input:</p>\n\n<pre><code>\"data\": {\n    \"filter\": [\n        \"[\"EQ\",\"foo\",0],[\"LIKE\",\"baz\",\"%.2%\"],[\"IN\",\"bar\",[1,5,9,11]],[\"EQ\",\"myBool\",true]\"\n    ],\n    \"limit\": [\n        \"101\"\n    ],\n    \"offset\": [\n        \"0\"\n    ],\n    \"sort\": [\n        \"id:ASC\"\n    ]\n}\n</code></pre>\n\n<p>Struct:</p>\n\n<pre><code>type MyStruct struct {\n    Operator string\n    Field    string\n    Values   []interface{} //this could be an array of strings or int64\n}\n</code></pre>\n\n<p>Test Code:</p>\n\n<pre><code>var parsed [][]interface{}\nvar parsedValues []MyStruct\n\n    if err := json.Unmarshal([]byte(filters), &amp;parsed); err != nil {\n        fmt.Println(\"FAILED TO UNMARSHALL FILTERS : \" + err.Error())\n    }\n\n    for _, y := range parsed {\n        var myStuff MyStruct\n        var values []interface{}\n        for idx2, col := range y {\n            if idx2 == 0 {\n                myStuff.Operator = col.(string)\n            } else if idx2 == 1 {\n                myStuff.Field = col.(string)\n            } else {\n                values = append(values, col)\n            }\n        }\n        myStuff.Values = values\n        parsedValues = append(parsedValues, criteria)\n    }\n</code></pre>\n\n<p>EDITED:</p>\n\n<p>I am hitting an error in un marshaling.</p>\n\n<pre><code>FAILED TO UNMARSHALL FILTERS : invalid character ',' after top-level value\n</code></pre>\n\n<p>Is it expected that the commas between arrays in this string will mess up the parse? I tried to do a replace to remove commas between each sub array ... but ... now it just yells about the [. </p>\n\n<p>Maybe this is the wrong approach altogether. I thought the answer below was going to work but with my input it didnt. I am not 100% sure where the disconnect is. </p>\n\n<p>Any help with this would be appreciated. </p>\n"}, {"tags": ["go", "binary"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1573263829, "post_id": 58775651, "comment_id": 103837115, "body": "<code>bs = []byte{byte(i), byte(i &gt;&gt; 8), byte(i &gt;&gt; 16), byte(i &gt;&gt; 24)}</code>"}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1573263895, "post_id": 58775651, "comment_id": 103837131, "body": "nice edit, i like it!"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1573294374, "post_id": 58775651, "comment_id": 103841259, "body": "Both are used, so it&#39;s a matter of opinion."}], "answers": [{"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 3, "last_activity_date": 1573281927, "last_edit_date": 1573281927, "creation_date": 1573275577, "answer_id": 58776568, "question_id": 58775651, "link": "https://stackoverflow.com/questions/58775651/which-is-the-go-way-putuint32-or-use-operator-directly/58776568#58776568", "title": "Which is the Go way, PutUint32 or use &gt;&gt; operator directly?", "body": "<p>Let's look inside the Go standard library:   </p>\n\n<pre><code>func (littleEndian) PutUint32(b []byte, v uint32) {\n    _ = b[3] // early bounds check to guarantee safety of writes below\n    b[0] = byte(v)\n    b[1] = byte(v &gt;&gt; 8)\n    b[2] = byte(v &gt;&gt; 16)\n    b[3] = byte(v &gt;&gt; 24)\n}\n</code></pre>\n\n<p>And see the <code>Package binary</code>documentation:  </p>\n\n<blockquote>\n  <p>This package favors <strong>simplicity</strong> over <strong>efficiency</strong>. Clients that require high-performance serialization, especially for large data structures, should look at more advanced solutions such as the encoding/gob package or protocol buffers.</p>\n</blockquote>\n\n<p>Which way we should go, depends on a problem we are trying to solve:<br>\nWhen the <strong>efficiency</strong> is not the main concern (of the problem we are trying to solve with programming), The <strong>simplicity</strong> is the way to go (because <strong>less bug</strong> is the main goal here):  </p>\n\n<ol>\n<li>You may use the Go standard library function <code>binary.LittleEndian.PutUint32</code> with an array (note you may use an array <code>[4]byte{}</code> here, for <strong>efficiency</strong> and <strong>simplicity</strong> over <code>make([]byte, 4)</code>):  </li>\n</ol>\n\n<pre><code>        var v uint32 = 0x4030201\n        ary := [4]byte{}\n        binary.LittleEndian.PutUint32(ary[:], v)\n        fmt.Println(ary) // [1 2 3 4]\n</code></pre>\n\n<ol start=\"2\">\n<li>You may use the Go standard library function <code>binary.LittleEndian.PutUint32</code> with a slice:  </li>\n</ol>\n\n<pre><code>        var v uint32 = 0x4030201\n        b := make([]byte, 4)\n        binary.LittleEndian.PutUint32(b, v)\n        fmt.Println(b) // [1 2 3 4]\n</code></pre>\n\n<ol start=\"3\">\n<li>You may write it directly (<strong>efficiency</strong>, since no library function call): </li>\n</ol>\n\n<pre><code>        var v uint32 = 0x4030201\n        a := [4]byte{\n            byte(v),\n            byte(v &gt;&gt; 8),\n            byte(v &gt;&gt; 16),\n            byte(v &gt;&gt; 24),\n        }\n        fmt.Println(a) // [1 2 3 4]\n</code></pre>\n\n<ol start=\"4\">\n<li>You may use <code>unsafe.Pointer</code> (Just for <strong>efficiency</strong> or compatiblity or ...):  </li>\n</ol>\n\n<pre><code>        var v uint32 = 1\n        a := (*[4]byte)(unsafe.Pointer(&amp;v))\n        a[0] = 100        // same memory (Like `union` in the C language)\n        fmt.Println(a, v) // &amp;[100 0 0 0] 100\n</code></pre>\n\n<ol start=\"5\">\n<li>You may use <code>unsafe.Pointer</code> and make a copy in one-line (so not a <code>union</code>):</li>\n</ol>\n\n<pre><code>        var v uint32 = 0x4030201\n        a := *(*[4]byte)(unsafe.Pointer(&amp;v))\n        fmt.Println(a) // [1 2 3 4]\n</code></pre>\n\n<ol start=\"6\">\n<li>You may use <code>unsafe.Pointer</code> with the <code>copy</code> to a slice:  </li>\n</ol>\n\n<pre><code>    b := make([]byte, 4)\n    copy(b, (*[4]byte)(unsafe.Pointer(&amp;v))[:])\n</code></pre>\n\n<p>Try it all <a href=\"https://play.golang.org/p/mj52QeXwKtj\" rel=\"nofollow noreferrer\">here</a></p>\n\n<hr>\n\n<p>Benchmark:</p>\n\n<pre><code>BenchmarkFn1-8          580469606                1.94 ns/op\nBenchmarkFn2-8          568699358                2.06 ns/op\nBenchmarkFn3-8          604883466                1.86 ns/op\nBenchmarkFn4-8          824232160                1.33 ns/op\nBenchmarkFn5-8          626357875                1.82 ns/op\nBenchmarkFn6-8          622969119                1.82 ns/op\nBenchmarkFn7-8          469203398                2.35 ns/op\nBenchmarkFn8-8          637403140                1.80 ns/op\nBenchmarkFn9-8          647179550                1.80 ns/op\n</code></pre>\n\n<p><code>main.go</code> file:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/binary\"\n    \"unsafe\"\n)\n\n// 1.94 ns/op\nfunc fn1(v uint32) [4]byte {\n    ary := [4]byte{}\n    binary.LittleEndian.PutUint32(ary[:], v)\n    return ary\n}\n\n// 2.06 ns/op\nfunc fn2(v uint32) []byte {\n    b := make([]byte, 4)\n    binary.LittleEndian.PutUint32(b, v)\n    return b\n}\n\n// 1.86 ns/op\nfunc fn3(v uint32) [4]byte {\n    a := [4]byte{\n        byte(v),\n        byte(v &gt;&gt; 8),\n        byte(v &gt;&gt; 16),\n        byte(v &gt;&gt; 24),\n    }\n    return a\n}\n\n// 1.33 ns/op\nfunc fn4(v uint32) *[4]byte {\n    a := (*[4]byte)(unsafe.Pointer(&amp;v))\n    return a\n}\n\n// 1.82 ns/op\nfunc fn5(v uint32) [4]byte {\n    a := *(*[4]byte)(unsafe.Pointer(&amp;v))\n    return a\n}\n\n// 1.82 ns/op\nfunc fn6(v uint32) []byte {\n    b := make([]byte, 4)\n    copy(b, (*[4]byte)(unsafe.Pointer(&amp;v))[:])\n    return b\n}\n\n// 2.35 ns/op\nfunc fn7(v uint32) [4]byte {\n    b := [4]byte{}\n    copy(b[:], (*[4]byte)(unsafe.Pointer(&amp;v))[:])\n    return b\n}\n\n// 1.80 ns/op\nfunc fn8(v uint32) *[4]byte {\n    b := [4]byte{}\n    copy(b[:], (*[4]byte)(unsafe.Pointer(&amp;v))[:])\n    return &amp;b\n}\n\n//1.80 ns/op\nfunc fn9(v uint32) []byte {\n    b := [4]byte{}\n    copy(b[:], (*[4]byte)(unsafe.Pointer(&amp;v))[:])\n    return b[:]\n}\n\nfunc main() {}\n\n</code></pre>\n\n<p><code>main_test.go</code> file:</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nvar result int\n\nfunc BenchmarkFn1(b *testing.B) {\n    sum := 0\n    for i := 0; i &lt; b.N; i++ {\n        r := fn1(uint32(i))\n        sum += int(r[0]) + int(r[1]) + int(r[2]) + int(r[3])\n    }\n    result = sum\n}\n\nfunc BenchmarkFn2(b *testing.B) {\n    sum := 0\n    for i := 0; i &lt; b.N; i++ {\n        r := fn2(uint32(i))\n        sum += int(r[0]) + int(r[1]) + int(r[2]) + int(r[3])\n    }\n    result = sum\n}\n\nfunc BenchmarkFn3(b *testing.B) {\n    sum := 0\n    for i := 0; i &lt; b.N; i++ {\n        r := fn3(uint32(i))\n        sum += int(r[0]) + int(r[1]) + int(r[2]) + int(r[3])\n    }\n    result = sum\n}\n\nfunc BenchmarkFn4(b *testing.B) {\n    sum := 0\n    for i := 0; i &lt; b.N; i++ {\n        r := fn4(uint32(i))\n        sum += int(r[0]) + int(r[1]) + int(r[2]) + int(r[3])\n    }\n    result = sum\n}\n\nfunc BenchmarkFn5(b *testing.B) {\n    sum := 0\n    for i := 0; i &lt; b.N; i++ {\n        r := fn5(uint32(i))\n        sum += int(r[0]) + int(r[1]) + int(r[2]) + int(r[3])\n    }\n    result = sum\n}\n\nfunc BenchmarkFn6(b *testing.B) {\n    sum := 0\n    for i := 0; i &lt; b.N; i++ {\n        r := fn6(uint32(i))\n        sum += int(r[0]) + int(r[1]) + int(r[2]) + int(r[3])\n    }\n    result = sum\n}\n\nfunc BenchmarkFn7(b *testing.B) {\n    sum := 0\n    for i := 0; i &lt; b.N; i++ {\n        r := fn7(uint32(i))\n        sum += int(r[0]) + int(r[1]) + int(r[2]) + int(r[3])\n    }\n    result = sum\n}\n\nfunc BenchmarkFn8(b *testing.B) {\n    sum := 0\n    for i := 0; i &lt; b.N; i++ {\n        r := fn8(uint32(i))\n        sum += int(r[0]) + int(r[1]) + int(r[2]) + int(r[3])\n    }\n    result = sum\n}\n\nfunc BenchmarkFn9(b *testing.B) {\n    sum := 0\n    for i := 0; i &lt; b.N; i++ {\n        r := fn9(uint32(i))\n        sum += int(r[0]) + int(r[1]) + int(r[2]) + int(r[3])\n    }\n    result = sum\n}\n\n</code></pre>\n\n<hr>\n\n<h1>Conclusion</h1>\n\n<p>Ultra fast and unsafe (shared memory e.g. <code>C union</code> and it may differ from little-endian to big-endian system):  </p>\n\n<pre><code>a := (*[4]byte)(unsafe.Pointer(&amp;v))\n</code></pre>\n\n<p>Fast and safe (copy of v as an array): </p>\n\n<pre><code>a := [4]byte{byte(v), byte(v &gt;&gt; 8), byte(v &gt;&gt; 16), byte(v &gt;&gt; 24)}\n</code></pre>\n\n<p>Simple and fast (copy of v as an array using the standard library):  </p>\n\n<pre><code>    ary := [4]byte{}\n    binary.LittleEndian.PutUint32(ary[:], v)\n</code></pre>\n\n<p>Beautiful (copy of v as a slice using the standard library):  </p>\n\n<pre><code>    b := make([]byte, 4)\n    binary.LittleEndian.PutUint32(b, v)\n</code></pre>\n"}], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 0, "accepted_answer_id": 58776568, "answer_count": 1, "score": 1, "last_activity_date": 1573281927, "creation_date": 1573263511, "last_edit_date": 1573276123, "question_id": 58775651, "link": "https://stackoverflow.com/questions/58775651/which-is-the-go-way-putuint32-or-use-operator-directly", "title": "Which is the Go way, PutUint32 or use &gt;&gt; operator directly?", "body": "<p>This is two ways to get the same 4 bytes:</p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/binary\"\n  \"fmt\"\n)\n\nfunc main() {\n  i := binary.LittleEndian.Uint32([]byte{1, 2, 3, 0})\n  bs := make([]byte, 4)\n  binary.LittleEndian.PutUint32(bs, uint32(i))\n  fmt.Println(bs[0] == 1 &amp;&amp; bs[1] == 2 &amp;&amp; bs[2] == 3 &amp;&amp; bs[3] == 0)\n\n  bs = []byte{byte(i &amp; 0x000000ff),\n    byte(i &gt;&gt; 8 &amp; 0x000000ff),\n    byte(i &gt;&gt; 16 &amp; 0x000000ff),\n    byte(i &gt;&gt; 24)}\n  fmt.Println(bs[0] == 1 &amp;&amp; bs[1] == 2 &amp;&amp; bs[2] == 3 &amp;&amp; bs[3] == 0)\n}\n</code></pre>\n\n<p>They both work. But which is the way the Go community would say is best?</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12345712, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f819bac2df67f3eb2fade1253547e21?s=128&d=identicon&r=PG&f=1", "display_name": "EARIE KOIRALA", "link": "https://stackoverflow.com/users/12345712/earie-koirala"}, "is_accepted": true, "score": 0, "last_activity_date": 1577944890, "last_edit_date": 1577944890, "creation_date": 1574185798, "answer_id": 58940048, "question_id": 58775040, "link": "https://stackoverflow.com/questions/58775040/how-to-define-foreign-key-in-gorm-library-model-referencing-to-another-table-id/58940048#58940048", "title": "How to define foreign key in GORM library model referencing to another table id?", "body": "<p>I found the solution to it. Actually I added foreign keys externally like this. So you need to create or migrate the tables first and then add the foreign keys.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Store struct {\n    Id int `gorm: \"type:int;primary_key;AUTO_INCREMENT;NOT NULL;UNIQUE\"`\n    Store_Id string `gorm:\"type:varchar(190)\";\"NOT NULL\";\"UNIQUE\"`\n}\n\ntype File struct {\n    Id int `gorm: \"type:int;primary_key;AUTO_INCREMENT;NOT NULL;UNIQUE\"`\n    Organization_Id string `gorm:\"type:varchar(190)\";\"NOT NULL\"`\n    File_Id string `gorm:\"type:varchar(190)\";\"NOT NULL\";\"UNIQUE\"`\n}\n\ntype File_Store_Linker struct {\n    Id int `gorm: \"type:int;primary_key;AUTO_INCREMENT;NOT NULL\"`\n    File_Id string `gorm:\"type:varchar(190)\";\"NOT NULL\"`\n    Store_Id string `gorm:\"type:varchar(190)\";\"NOT NULL\"`\n    File_Type string `gorm:\"type:varchar(50)\";\"NOT NULL\"`\n}\n\nfunc AddForeignKeys(gormDb *gorm.DB) {\n     gormDb.Model(&amp;File_Store_Linker{}).AddForeignKey(\"file_id\",\"file(file_id)\", \n    \"RESTRICT\",\"RESTRICT\")\n gormDb.Model(&amp;File_Store_Linker{}).AddForeignKey(\"store_id\",\"store(store_id)\",\" \n     RESTRICT\",\"RESTRICT\")\n} \n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 12345712, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f819bac2df67f3eb2fade1253547e21?s=128&d=identicon&r=PG&f=1", "display_name": "EARIE KOIRALA", "link": "https://stackoverflow.com/users/12345712/earie-koirala"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "accepted_answer_id": 58940048, "answer_count": 1, "score": 0, "last_activity_date": 1577944890, "creation_date": 1573256579, "last_edit_date": 1573287945, "question_id": 58775040, "link": "https://stackoverflow.com/questions/58775040/how-to-define-foreign-key-in-gorm-library-model-referencing-to-another-table-id", "title": "How to define foreign key in GORM library model referencing to another table id?", "body": "<p>I have these three models </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Store struct {\n    Id int `gorm: \"type:int;primary_key;AUTO_INCREMENT;NOT NULL;UNIQUE\"`\n    Store_Id string `gorm:\"type:varchar(190)\";\"NOT NULL\";\"UNIQUE\"`\n}\n\ntype File struct {\n    Id int `gorm: \"type:int;primary_key;AUTO_INCREMENT;NOT NULL;UNIQUE\"`\n    Organization_Id string `gorm:\"type:varchar(190)\";\"NOT NULL\"`\n    File_Id string `gorm:\"type:varchar(190)\";\"NOT NULL\";\"UNIQUE\"`\n}\n\ntype File_Store_Linker struct {\n    Id int `gorm: \"type:int;primary_key;AUTO_INCREMENT;NOT NULL\"`\n    File_Id string `gorm:\"type:varchar(190)\";\"NOT NULL\"`\n    Store_Id string `gorm:\"type:varchar(190)\";\"NOT NULL\"`\n    File_Type string `gorm:\"type:varchar(50)\";\"NOT NULL\"`\n}\n</code></pre>\n\n<p>I want to create foreign keys like this in the File_Storage_Linker struct.</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>create table file_store_linker (\nid INT NOT NULL AUTO_INCREMENT,\nfile_id VARCHAR(190) NOT NULL,\nstore_id VARCHAR(190) NOT NULL,\nfile_type VARCHAR(50) NOT NULL,\nPRIMARY KEY (id),\nFOREIGN KEY (file_id)\nREFERENCES file (file_id),\nFOREIGN KEY (store_id)\nREFERENCES storage (store_id)\n);\n</code></pre>\n\n<p>How can it be done?</p>\n"}, {"tags": ["go", "mux"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1573252546, "post_id": 58774539, "comment_id": 103835129, "body": "Your listener can&#39;t be receiving https requests, because it&#39;s not using TLS. The listener that receives the requests should know how it&#39;s configured and can redirect appropriately."}, {"owner": {"reputation": 5237, "user_id": 2325924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XSXrT.jpg?s=128&g=1", "display_name": "7urkm3n", "link": "https://stackoverflow.com/users/2325924/7urkm3n"}, "edited": false, "score": 0, "creation_date": 1573253137, "post_id": 58774539, "comment_id": 103835292, "body": "My suggestion, use nginx for this kind of service."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1573313806, "post_id": 58774539, "comment_id": 103845519, "body": "If this is for web content that&#39;s one thing, but if it&#39;s for REST calls - then don&#39;t bother doing redirects - just fail with an appropriate error. Redirects for REST are a waste of resources. Clients should know to use https."}], "answers": [{"tags": [], "owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "is_accepted": false, "score": 0, "last_activity_date": 1573259159, "last_edit_date": 1573259159, "creation_date": 1573258528, "answer_id": 58775236, "question_id": 58774539, "link": "https://stackoverflow.com/questions/58774539/how-to-check-if-a-request-was-made-over-http-or-https/58775236#58775236", "title": "How to check if a request was made over HTTP or HTTPS", "body": "<p>If the application is directly serving HTTP and HTTPS, then the application is running two listeners.  Configure the handler running on the HTTP listener to redirect to HTTPS.  Configure the HTTPS handler as normal:</p>\n\n<pre><code>// Redirect HTTP to HTTPS\ngo func() {\n        log.Fatal(http.ListenAndServe(httpPort, http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    http.Redirect(w, r, \"https://\"+r.Host+r.RequestURI, http.StatusMovedPermanently)\n    })))\n    }()\n\n\n// Run the application as normal on HTTPS.\nr := mux.NewRouter()\nr.HandleFunc(\"/info\", infoHandler).Methods(\"GET\")\nlog.Fatal(http.ListenAndServeTLS(httpsPport, certFile, keyFile, r))\n</code></pre>\n\n<p>There is no need to wrap existing handlers with a redirector because HTTP and HTTPS requests to go different handlers.  </p>\n\n<p>If the application is running behind a reverse proxy, then configure the proxy to redirect HTTP to HTTPS.</p>\n"}], "owner": {"reputation": 656, "user_id": 9131967, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/70f820efcdbd7369d530a1c8d4d6c8dc?s=128&d=identicon&r=PG&f=1", "display_name": "MANOJ", "link": "https://stackoverflow.com/users/9131967/manoj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2245, "favorite_count": 0, "closed_date": 1573287997, "answer_count": 1, "score": 1, "last_activity_date": 1573287958, "creation_date": 1573252284, "last_edit_date": 1573287958, "question_id": 58774539, "link": "https://stackoverflow.com/questions/58774539/how-to-check-if-a-request-was-made-over-http-or-https", "closed_reason": "Duplicate", "title": "How to check if a request was made over HTTP or HTTPS", "body": "<p>I am trying to redirect the API call to HTTPS if an api call is made to HTTP, But I get an nil in r.URL.Scheme and r.TLS  for both HTTP and HTTPS calls</p>\n\n<pre><code>func main() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/info\", infoHandler).Methods(\"GET\")   \n    portString := fmt.Sprintf(\":%s\", getPorts())\n\n    if cfenv.IsRunningOnCF() == true {\n        r.Use(redirectTLS)\n    }\n\n    if err := http.ListenAndServe(portString, r); err != nil {\n        panic(err)\n    }\n\n}\n\nfunc redirectTLS(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\n        //if r.URL.Scheme != \"https\" {\n        if r.TLS == nil {\n            log.Info(\"Redirecting to HTTPS\")\n            //targetUrl := url.URL{Scheme: \"https\", Host: r.Host, Path: r.URL.Path, RawQuery: r.URL.RawQuery}\n            http.Redirect(w, r, \"https://\"+r.Host+r.RequestURI, http.StatusMovedPermanently)\n            //http.Redirect(w, r, targetUrl, http.StatusMovedPermanently)\n            return\n        }\n\n        log.Info(\"Not Redirecting to HTTPS\")\n        next.ServeHTTP(w, r)\n        return\n    })\n}\n</code></pre>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-functions", "google-cloud-pubsub"], "comments": [{"owner": {"reputation": 2274, "user_id": 6476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1ca185cf4b12910506f46f431d2371?s=128&d=identicon&r=PG&f=1", "display_name": "kingkupps", "link": "https://stackoverflow.com/users/6476496/kingkupps"}, "edited": false, "score": 0, "creation_date": 1573269610, "post_id": 58774377, "comment_id": 103837832, "body": "How are you deploying your cloud function? Not sure why this is happening yet but just want to know more about your setup."}, {"owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "edited": false, "score": 0, "creation_date": 1573305553, "post_id": 58774377, "comment_id": 103843560, "body": "Can you share an example of logs where you see missing events?"}, {"owner": {"reputation": 79, "user_id": 10239862, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VQS2PNKdtUE/AAAAAAAAAAI/AAAAAAAAA1w/ONPj21w4kPg/photo.jpg?sz=128", "display_name": "Ili&#232;s M", "link": "https://stackoverflow.com/users/10239862/ili%c3%a8s-m"}, "reply_to_user": {"reputation": 2274, "user_id": 6476496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd1ca185cf4b12910506f46f431d2371?s=128&d=identicon&r=PG&f=1", "display_name": "kingkupps", "link": "https://stackoverflow.com/users/6476496/kingkupps"}, "edited": false, "score": 0, "creation_date": 1573484365, "post_id": 58774377, "comment_id": 103887418, "body": "@kingkupps Here is how i deploy my function : gcloud functions deploy my_worker --runtime go111 --entry-point Run --trigger-topic workers"}, {"owner": {"reputation": 79, "user_id": 10239862, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VQS2PNKdtUE/AAAAAAAAAAI/AAAAAAAAA1w/ONPj21w4kPg/photo.jpg?sz=128", "display_name": "Ili&#232;s M", "link": "https://stackoverflow.com/users/10239862/ili%c3%a8s-m"}, "reply_to_user": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "edited": false, "score": 0, "creation_date": 1573486128, "post_id": 58774377, "comment_id": 103888318, "body": "@guillaumeblaquiere i&#39;ve edited my question"}, {"owner": {"reputation": 365, "user_id": 42003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73250cde97f8ba5e3c709838a7a2e8a8?s=128&d=identicon&r=PG", "display_name": "Jason Ganetsky", "link": "https://stackoverflow.com/users/42003/jason-ganetsky"}, "edited": false, "score": 0, "creation_date": 1573487488, "post_id": 58774377, "comment_id": 103888983, "body": "I would like to get more information to help you. You said you looked at metrics from Cloud Functions. Have you also looked at Cloud Pub/Sub metrics? You might have messages waiting to be delivered in the subscription\u2019s backlog."}, {"owner": {"reputation": 79, "user_id": 10239862, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VQS2PNKdtUE/AAAAAAAAAAI/AAAAAAAAA1w/ONPj21w4kPg/photo.jpg?sz=128", "display_name": "Ili&#232;s M", "link": "https://stackoverflow.com/users/10239862/ili%c3%a8s-m"}, "reply_to_user": {"reputation": 365, "user_id": 42003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73250cde97f8ba5e3c709838a7a2e8a8?s=128&d=identicon&r=PG", "display_name": "Jason Ganetsky", "link": "https://stackoverflow.com/users/42003/jason-ganetsky"}, "edited": false, "score": 0, "creation_date": 1573493414, "post_id": 58774377, "comment_id": 103891822, "body": "@JasonGanetsky yes i did watch at both, i added a graph related to pub/sub, howerver i looked at the metrics &quot;num_undelivered_messages&quot; which seems to be very high (51,228 unaknowledge messages) so i don&#39;t really know how to interpret that metric"}, {"owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "edited": false, "score": 0, "creation_date": 1573499865, "post_id": 58774377, "comment_id": 103894273, "body": "Did you see some unexpected error code in Function or in PubSub logs?"}, {"owner": {"reputation": 79, "user_id": 10239862, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VQS2PNKdtUE/AAAAAAAAAAI/AAAAAAAAA1w/ONPj21w4kPg/photo.jpg?sz=128", "display_name": "Ili&#232;s M", "link": "https://stackoverflow.com/users/10239862/ili%c3%a8s-m"}, "reply_to_user": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "edited": false, "score": 0, "creation_date": 1573500344, "post_id": 58774377, "comment_id": 103894461, "body": "@guillaumeblaquiere I didn&#39;t see anything wrong on both except if i&#39;m watching at the wrong metric but i dont see that much options to look at"}, {"owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "edited": false, "score": 0, "creation_date": 1573502621, "post_id": 58774377, "comment_id": 103895284, "body": "By looking to your graph, I see that the orange graph is just bellow the 100 line. In addition the execution count is bellow 100 000. But it&#39;s the execution OK. Have you other status code? Anyway, sometime, for extracting better insight from logs, I perform a sink into bigquery and I try to understand thanks to query."}, {"owner": {"reputation": 79, "user_id": 10239862, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VQS2PNKdtUE/AAAAAAAAAAI/AAAAAAAAA1w/ONPj21w4kPg/photo.jpg?sz=128", "display_name": "Ili&#232;s M", "link": "https://stackoverflow.com/users/10239862/ili%c3%a8s-m"}, "reply_to_user": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "edited": false, "score": 0, "creation_date": 1573507185, "post_id": 58774377, "comment_id": 103897026, "body": "@guillaumeblaquiere i don&#39;t have other status name, i tried to use this metric on another project and while using the execution status, code should be broken down by different type on the graph such as &quot;ok&quot;, &quot;connection error&quot; and &quot;crash&quot;, unfortunately on this one i only have the &quot;ok&quot; status. I&#39;ll try to put the logs in a sink as you suggested"}, {"owner": {"reputation": 365, "user_id": 42003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/73250cde97f8ba5e3c709838a7a2e8a8?s=128&d=identicon&r=PG", "display_name": "Jason Ganetsky", "link": "https://stackoverflow.com/users/42003/jason-ganetsky"}, "edited": false, "score": 0, "creation_date": 1573572101, "post_id": 58774377, "comment_id": 103920275, "body": "@Ili&#232;sM Can you include a screenshot of the num_undelivered_messages metric for your subscriber that you mentioned? A non-zero value for that would indicate that there are messages enqueued that have not yet been acknowledged. You might want to read <a href=\"http://cloud/pubsub/docs/monitoring#monitoring_the_backlog\" rel=\"nofollow noreferrer\">monitoring your backlog</a> and <a href=\"https://cloud.google.com/pubsub/docs/monitoring#monitoring_push_subscriptions\" rel=\"nofollow noreferrer\">monitoring your push subscription</a>. You might want to look at your <a href=\"https://cloud.google.com/functions/quotas\" rel=\"nofollow noreferrer\">Cloud Functions quotas</a> and make sure you are not exceeding them."}], "owner": {"reputation": 79, "user_id": 10239862, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VQS2PNKdtUE/AAAAAAAAAAI/AAAAAAAAA1w/ONPj21w4kPg/photo.jpg?sz=128", "display_name": "Ili&#232;s M", "link": "https://stackoverflow.com/users/10239862/ili%c3%a8s-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 287, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1573485379, "creation_date": 1573251040, "last_edit_date": 1573485379, "question_id": 58774377, "link": "https://stackoverflow.com/questions/58774377/issue-with-google-cloud-pub-sub-and-background-functions-invocation", "title": "Issue with Google Cloud Pub/Sub and background functions invocation", "body": "<p>I am using few Google cloud solutions for a project:</p>\n\n<ul>\n<li>Google app engine (Go 1.11)</li>\n<li>Google cloud functions (Go 1.11)</li>\n<li>Google cloud Pub/Sub (Topic name : workers)</li>\n</ul>\n\n<p>My App Engine project is simply about publishing messages to a topic \"workers\".</p>\n\n<p>My Cloud function should be triggered when Pub/Sub receive a message on the \"workers\" topic.</p>\n\n<p>After running some intensive load tests, I can see that not all of my workers are invoked.</p>\n\n<p>The test was about to throw a batch of 200 messages every 15 seconds to reach a total of 100 000 published message (should be the same amount of function invocations) at the end.</p>\n\n<p>No issues to send messages to the topic, but when i looked into the Google Stackdriver Metrics explorer (Metrics based on Execution status of the cloud function) i can see that some workers invocations are missing.</p>\n\n<p>App Engine code that publish messages:</p>\n\n<pre><code>func PublishMessage(task *models.Task) error {\n    if task == nil {\n       return errors.New(\"Empty task\")\n    }\n\n    pubSubTopic := GetPubSubClient().Topic(\"workers\")\n    ctx := context.Background()\n\n    message, err := json.Marshal(task); if err != nil {\n        return err\n    }\n\n    result := pubSubTopic.Publish(ctx, &amp;pubsub.Message{\n        Data: message,\n    })\n\n    id, err := result.Get(ctx)\n    if err != nil {\n        return err\n    }\n\n    log.Printf(\"Published a message; msg ID: %v\\n\", id)\n\n    return nil\n}\n</code></pre>\n\n<p>Here is the code on my Google cloud function :</p>\n\n<pre><code>func Run(ctx context.Context, m PubSubMessage) error {\n\n    task := &amp;models.Task{}\n\n    if err := json.Unmarshal(m.Data, task); err != nil {\n        return err\n    }\n\n    log.Printf(*task.Name)\n\n    return nil\n}\n</code></pre>\n\n<p><strong>EDIT 1:</strong></p>\n\n<p>Here is how i deploy my cloud function :</p>\n\n<p><code>gcloud functions deploy my_worker --runtime go111 --entry-point Run --trigger-topic workers</code></p>\n\n<p>Here is the Metrics explorer for the pub/sub : </p>\n\n<p><a href=\"https://i.stack.imgur.com/T0kbU.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/T0kbU.png\" alt=\"Pub/Sub Metrics\"></a></p>\n\n<p>Here is the Metrics explorer for the cloud function invocation count :\n<a href=\"https://i.stack.imgur.com/cEbK8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/cEbK8.png\" alt=\"Cloud function metrics\"></a></p>\n"}]