[{"tags": ["html", "forms", "parsing", "go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "edited": false, "score": 0, "creation_date": 1527748120, "post_id": 50614346, "comment_id": 88245602, "body": "I forgot to mention that I want to use the low-level API. I updated the answer with an example."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 1, "last_activity_date": 1527720631, "creation_date": 1527720631, "answer_id": 50614346, "question_id": 50613921, "link": "https://stackoverflow.com/questions/50613921/parse-html-input-tags-in-go/50614346#50614346", "title": "Parse HTML input tags in Go", "body": "<blockquote>\n  <p>ignores input tags and interprets them as text content of the form tag</p>\n</blockquote>\n\n<p>Your premise is wrong, it doesn't ignore input tags, as demonstrated below:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"golang.org/x/net/html\"\n    \"strings\"\n)\n\nconst HTML = ` \n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n     &lt;head&gt;\n        &lt;meta charset=\"utf-8\"/&gt;\n        &lt;title&gt;selected attribute&lt;/title&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;form method=\"GET\"&gt;\n            &lt;input type=\"submit\" value=\"submit\"/&gt;\n        &lt;/form&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n`\n\nfunc main() {\n    z, _ := html.Parse(strings.NewReader(HTML))\n    var f func(*html.Node)\n    f = func(n *html.Node) {\n        if n.Type == html.ElementNode &amp;&amp; n.Data == \"input\" {\n            for _, a := range n.Attr {\n                if a.Key == \"value\" {\n                    fmt.Println(a.Val)\n                    break\n                }\n            }\n        }\n        for c := n.FirstChild; c != nil; c = c.NextSibling {\n            f(c)\n        }\n    }\n    f(z)\n}\n</code></pre>\n\n<p>This will print out \"submit\", the value of the input tag.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "is_accepted": false, "score": 0, "last_activity_date": 1527769614, "creation_date": 1527769614, "answer_id": 50624318, "question_id": 50613921, "link": "https://stackoverflow.com/questions/50613921/parse-html-input-tags-in-go/50624318#50624318", "title": "Parse HTML input tags in Go", "body": "<p>One should use <code>html.SelfClosingTagToken</code> instead of <code>html.StartTagToken</code> for parsing <code>input</code> tags.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 847, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1527769614, "creation_date": 1527717569, "last_edit_date": 1527748052, "question_id": 50613921, "link": "https://stackoverflow.com/questions/50613921/parse-html-input-tags-in-go", "title": "Parse HTML input tags in Go", "body": "<p>The Go <a href=\"https://godoc.org/golang.org/x/net/html\" rel=\"nofollow noreferrer\">HTML parsing package</a> ignores input tags and interprets them as text content of the form tag. What is the best option to bypass this limitation? </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n\n    \"golang.org/x/net/html\"\n)\n\nconst HTML = ` \n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n     &lt;head&gt;\n        &lt;meta charset=\"utf-8\"/&gt;\n        &lt;title&gt;selected attribute&lt;/title&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;form method=\"GET\"&gt;\n            &lt;input type=\"submit\" value=\"submit\"/&gt;\n        &lt;/form&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n`\n\nfunc main() {\n    z := html.NewTokenizer(strings.NewReader(HTML))\n    tt := html.TokenType(7)\n    for tt != html.ErrorToken {\n        tt = z.Next()\n        if tt == html.StartTagToken {\n            name, _ := z.TagName()\n            fmt.Println(string(name))\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527714538, "post_id": 50613291, "comment_id": 88236613, "body": "I think you can add the required import statements to the binary-only stub"}, {"owner": {"reputation": 487, "user_id": 1046689, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8b1ae6144171fe41123612c3b1a7f839?s=128&d=identicon&r=PG", "display_name": "kitified", "link": "https://stackoverflow.com/users/1046689/kitified"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527714718, "post_id": 50613291, "comment_id": 88236673, "body": "@JimB: Yes, I have set the required import statements in the stub file. Editing question for clarity."}], "answers": [{"comments": [{"owner": {"reputation": 487, "user_id": 1046689, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8b1ae6144171fe41123612c3b1a7f839?s=128&d=identicon&r=PG", "display_name": "kitified", "link": "https://stackoverflow.com/users/1046689/kitified"}, "edited": false, "score": 0, "creation_date": 1527776382, "post_id": 50613518, "comment_id": 88263036, "body": "Makes sense. Thanks for the explanation!"}, {"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "reply_to_user": {"reputation": 487, "user_id": 1046689, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8b1ae6144171fe41123612c3b1a7f839?s=128&d=identicon&r=PG", "display_name": "kitified", "link": "https://stackoverflow.com/users/1046689/kitified"}, "edited": false, "score": 0, "creation_date": 1527778382, "post_id": 50613518, "comment_id": 88264328, "body": "I would not be surprised if they decided to support your request eventually (not sure how), there needs to be some way of packaging a library, along the lines of the &#39;jar&#39; file for java or the combined single archive for C/C++, so that you can deliver a library easily with no further steps required.  The build-only library feature is new so maybe that might come soon.  You might consider opening an issue with the golang people on github."}], "tags": [], "owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "is_accepted": true, "score": 1, "last_activity_date": 1527715292, "creation_date": 1527715292, "answer_id": 50613518, "question_id": 50613291, "link": "https://stackoverflow.com/questions/50613291/binary-only-library-is-not-including-dependencies/50613518#50613518", "title": "Binary-only library is not including dependencies", "body": "<p>As you know, go compiles packages into individual archive files and creates a binary from those.  Go recently allowed you to supply only the archives without the source code (normally go would recompile from source if the source is newer).</p>\n\n<p>It is possible to combine several archives into one, as described here:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/3821916/how-to-merge-two-ar-static-libraries-into-one\">How to merge two &quot;ar&quot; static libraries into one</a></p>\n\n<p>The problem is that go's compiler will find symbols using the folder and file structure that matches the package names.  So, if you combine archives, the go compiler will no longer be able to locate symbols when building a binary. Only one of the packages will be locatable depending on the location of the archive.  So it is not possible to do what you are requesting, at least with the current go compiler support.</p>\n"}], "owner": {"reputation": 487, "user_id": 1046689, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8b1ae6144171fe41123612c3b1a7f839?s=128&d=identicon&r=PG", "display_name": "kitified", "link": "https://stackoverflow.com/users/1046689/kitified"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 447, "favorite_count": 0, "accepted_answer_id": 50613518, "answer_count": 1, "score": 1, "last_activity_date": 1527715292, "creation_date": 1527714006, "last_edit_date": 1527714948, "question_id": 50613291, "link": "https://stackoverflow.com/questions/50613291/binary-only-library-is-not-including-dependencies", "title": "Binary-only library is not including dependencies", "body": "<p>I'm attempting to build a binary-only library that includes some dependencies. The build of the binary-only library itself goes great, but it doesn't actually include my dependencies: when I try to use the library on a system without the dependencies installed, I am given an error saying they are missing.</p>\n\n<p>For reference, the command I'm using to build the library is:</p>\n\n<p><code>go build -o build/pkg/&lt;os&gt;_&lt;arch&gt;/&lt;path/to/binary&gt;.a</code></p>\n\n<p>I then write my stub <code>&lt;library&gt;.go</code> file to <code>build/src/&lt;path/to/binary&gt;.go</code>. </p>\n\n<p>The stub file contains stubbed implementations of all public methods and an <code>import</code> block for its dependencies, with each dependency included in that import block.</p>\n\n<p>The stub file also has the <code>// go:binary-only-package</code> line above the <code>package</code> directive.</p>\n\n<p>If there is a way to build a binary library that will include its dependencies I'd appreciate it!</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 2, "creation_date": 1527713750, "post_id": 50613159, "comment_id": 88236328, "body": "Why deci-seconds? also, this should work: <code>deciSeconds := int32(time.Now().Unix() &#47; 10)</code>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1527713835, "post_id": 50613159, "comment_id": 88236358, "body": "@Derek I&#39;m following a standard <a href=\"https://github.com/InteractiveAdvertisingBureau/GDPR-Transparency-and-Consent-Framework/blob/master/Consent%20string%20and%20vendor%20list%20formats%20v1.1%20Final.md#vendor-consent-string-format\" rel=\"nofollow noreferrer\">github.com/InteractiveAdvertisingBureau/&hellip;</a>"}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 1, "creation_date": 1527714106, "post_id": 50613159, "comment_id": 88236450, "body": "Ahhhh, I see. I edited my comment to include converting to <code>int32</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1527714905, "post_id": 50613159, "comment_id": 88236746, "body": "What did you try from the linked question?  UnixNano() / 1e8 should work."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1527714921, "post_id": 50613159, "comment_id": 88236755, "body": "@Derek I&#39;ve updated my post with more information. Setting time time with <code>int32(time.Now().Unix() &#47; 10)</code> is yielding the same results.. maybe i&#39;m doing something else wrong"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1527714988, "post_id": 50613159, "comment_id": 88236783, "body": "@ThunderCat amended my post Using UnixNano() / 1e8 returns <code>created 2023-10-20 18:54:04.7 +0000 UTC</code>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1527715340, "post_id": 50613159, "comment_id": 88236909, "body": "So deciseconds := int64(t.UnixNano() / 1e8) works, you have make sure it&#39;s an int64 though. Thanks guys. Someone should post the answer so I mark the correct answer and so pass out points"}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527715575, "post_id": 50613530, "comment_id": 88236993, "body": "One may also divide by <code>int64(100 * time.Millisecond)</code> if they find it more readable"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1527715839, "last_edit_date": 1527715839, "creation_date": 1527715387, "answer_id": 50613530, "question_id": 50613159, "link": "https://stackoverflow.com/questions/50613159/golang-time-in-deciseconds/50613530#50613530", "title": "Golang Time in Deciseconds", "body": "<p>Use these functions to convert a time.Time to and from deciseconds since the epoch.</p>\n\n<pre><code>func toDeci(t time.Time) int64 {\n    return t.UnixNano() / 1e8\n}\n\nfunc fromDeci(t int64) time.Time {\n    return time.Unix(0, t*1e8)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/bRyECYrTiZu\" rel=\"nofollow noreferrer\">playground example</a></p>\n\n<p>You can replace <code>1e8</code> with <code>int64(time.Second/10)</code> for a possible improvement in readability.</p>\n"}], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 1, "accepted_answer_id": 50613530, "answer_count": 1, "score": 1, "last_activity_date": 1527715839, "creation_date": 1527713410, "last_edit_date": 1527714845, "question_id": 50613159, "link": "https://stackoverflow.com/questions/50613159/golang-time-in-deciseconds", "title": "Golang Time in Deciseconds", "body": "<p>I'm having trouble converting time.Time to Deciseconds. I basically have to port the below to Golang</p>\n\n<p><code>\nDeciseconds fits into 36 bits with enough precision to record a user's consent action timing. Javascript: Math.round((new Date()).getTime()/100)\n</code></p>\n\n<p>I've tried using \n<a href=\"https://stackoverflow.com/questions/24122821/go-golang-time-now-unixnano-convert-to-milliseconds\">Go / golang time.Now().UnixNano() convert to milliseconds?</a></p>\n\n<p>to convert to milliseconds then dividing by 100. That produces the wrong time stamp. I bet this is a silly mistake on my part, but I just wanted to get some feed back</p>\n\n<p>This is the method that reads the timestamp i'm trying to submit</p>\n\n<pre><code>// ReadTime reads the next 36 bits representing the epoch time in deciseconds\n// and converts it to a time.Time.\nfunc (r *ConsentReader) ReadTime() time.Time {\n    var ds = int64(r.ReadBits(36))\n    return time.Unix(ds/dsPerS, (ds%dsPerS)*nsPerDs).UTC()\n}\n</code></pre>\n\n<p><a href=\"https://github.com/LiveRamp/iabconsent/blob/328e761006ce2652bc8c0daee614381d7565c05e/parse.go#L34\" rel=\"nofollow noreferrer\">https://github.com/LiveRamp/iabconsent/blob/328e761006ce2652bc8c0daee614381d7565c05e/parse.go#L34</a></p>\n\n<p>I'm setting the date with</p>\n\n<pre><code>func (b bit) setDateToDeciseconds(startInclusive int, size int, t time.Time) {\n    deciseconds := int32(t.Unix() / 1000)\n    b.setNumberInt32(startInclusive, size, deciseconds)\n}\n\n\nfunc (b bit) setNumberInt32(startInclusive int, size int, to int32) {\n    for i := size - 1; i &gt;= 0; i-- {\n        index := startInclusive + i\n        byteIndex := index / 8\n        shift := uint((byteIndex+1)*8 - index - 1)\n        b[byteIndex] |= byte((to % 2) &lt;&lt; shift)\n        to /= 2\n    }\n}\n</code></pre>\n\n<p>I keep getting date times that look like</p>\n\n<p>time.Now() -> <code>1970-01-02 18:26:11.4 +0000 UTC</code></p>\n"}, {"tags": ["go", "dredd"], "comments": [{"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1527713282, "post_id": 50613051, "comment_id": 88236119, "body": "have you tried adding <code>defer server.Listener.Close()</code> to the end of the <code>main</code> func?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527713302, "post_id": 50613051, "comment_id": 88236134, "body": "<code>main.go</code> is a source file, not a process or even an executable. how are you running your process?"}, {"owner": {"reputation": 543, "user_id": 9236477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Fpj0h.png?s=128&g=1", "display_name": "Kaigo", "link": "https://stackoverflow.com/users/9236477/kaigo"}, "edited": false, "score": 0, "creation_date": 1527713373, "post_id": 50613051, "comment_id": 88236167, "body": "I&#39;m just running <code>go run main.go</code> thanks"}, {"owner": {"reputation": 543, "user_id": 9236477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Fpj0h.png?s=128&g=1", "display_name": "Kaigo", "link": "https://stackoverflow.com/users/9236477/kaigo"}, "edited": false, "score": 0, "creation_date": 1527713523, "post_id": 50613051, "comment_id": 88236235, "body": "With adding the <code>defer server.Listener.Close()</code> i get syntax error <code>srv.Listener undefined (type *http.Server has no field or method Listener)</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527713719, "post_id": 50613051, "comment_id": 88236317, "body": "Try compiling the binary and running it directly (not sure what the defer would solve, since the process is being interrupted, plus defers don&#39;t even run after exiting via a signal)."}, {"owner": {"reputation": 543, "user_id": 9236477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Fpj0h.png?s=128&g=1", "display_name": "Kaigo", "link": "https://stackoverflow.com/users/9236477/kaigo"}, "edited": false, "score": 0, "creation_date": 1527715700, "post_id": 50613051, "comment_id": 88237041, "body": "will that work as i need to run the web server?"}, {"owner": {"reputation": 543, "user_id": 9236477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Fpj0h.png?s=128&g=1", "display_name": "Kaigo", "link": "https://stackoverflow.com/users/9236477/kaigo"}, "edited": false, "score": 1, "creation_date": 1527715842, "post_id": 50613051, "comment_id": 88237102, "body": "no your right, &quot;Using Dredd with Go is slightly different to other languages, as a binary needs to be compiled for execution&quot; <a href=\"https://dredd.readthedocs.io/en/latest/hooks-go.html\" rel=\"nofollow noreferrer\">dredd.readthedocs.io/en/latest/hooks-go.html</a>"}, {"owner": {"reputation": 543, "user_id": 9236477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Fpj0h.png?s=128&g=1", "display_name": "Kaigo", "link": "https://stackoverflow.com/users/9236477/kaigo"}, "edited": false, "score": 0, "creation_date": 1527715949, "post_id": 50613051, "comment_id": 88237137, "body": "still not sure how to implement though. ."}], "answers": [{"tags": [], "owner": {"reputation": 543, "user_id": 9236477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Fpj0h.png?s=128&g=1", "display_name": "Kaigo", "link": "https://stackoverflow.com/users/9236477/kaigo"}, "is_accepted": true, "score": 0, "last_activity_date": 1527722173, "last_edit_date": 1527722173, "creation_date": 1527720098, "answer_id": 50614279, "question_id": 50613051, "link": "https://stackoverflow.com/questions/50613051/dredd-not-killing-main-go-fix-needed/50614279#50614279", "title": "Dredd not killing main.go fix needed", "body": "<p>figured it out.</p>\n\n<p>I had to delete the dredd.yml file and run </p>\n\n<p><code>$ go build</code></p>\n\n<p>then</p>\n\n<p><code>$ dredd apiary.apib http://127.0.0.1:5000 --server=./go-project --language=go</code></p>\n\n<p>But circleCI testing is <strong>not working</strong>, it just seems to ignore the circle.yml file and skips straight past it.</p>\n"}], "owner": {"reputation": 543, "user_id": 9236477, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Fpj0h.png?s=128&g=1", "display_name": "Kaigo", "link": "https://stackoverflow.com/users/9236477/kaigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 50614279, "answer_count": 1, "score": -1, "last_activity_date": 1527722173, "creation_date": 1527712895, "last_edit_date": 1527715451, "question_id": 50613051, "link": "https://stackoverflow.com/questions/50613051/dredd-not-killing-main-go-fix-needed", "title": "Dredd not killing main.go fix needed", "body": "<p>I'm new to <a href=\"https://dredd.readthedocs.io/en/latest/#\" rel=\"nofollow noreferrer\">this</a> tool and looking for help with what I'm sure is a common issue.</p>\n\n<p>As I <a href=\"https://github.com/apiaryio/dredd/pull/761\" rel=\"nofollow noreferrer\">understand</a> dredd isn't able to <strong>kill processes</strong> that it started, for me this is <em>main.go</em>.</p>\n\n<p>My test feature is working great but the second time I obviously run into issues at the port is in use.</p>\n\n<p>I've read most of the <a href=\"https://blog.apiary.io/2013/10/17/How-to-test-api-with-api-blueprint-and-dredd\" rel=\"nofollow noreferrer\">articles</a> and <a href=\"https://philsturgeon.uk/api/2015/01/28/dredd-api-testing-documentation/\" rel=\"nofollow noreferrer\">guides</a> out there but I'm not able to understand how to implement the necessary fix.</p>\n\n<p>I tried creating script/test.sh</p>\n\n<pre><code>  #!/bin/sh\n  go run main.go\n  sleep 3\n  PID=$!\n  dredd apiary.apib http://localhost:5000/\n  RESULT=$?\n  kill -9 $PID\n  exit $RESULT\n</code></pre>\n\n<p>and then running ./scripts/test.sh instead of dredd but its not working at all.</p>\n\n<p>What is the best way to implement a fix for this that would also work on <strong>circleCI</strong>?</p>\n"}, {"tags": ["go", "terraform", "abstract-syntax-tree", "hcl"], "comments": [{"owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 0, "creation_date": 1532650262, "post_id": 50612780, "comment_id": 90065757, "body": "I&#39;m not 100% sure what you&#39;re asking, but I have a feeling you&#39;re looking for <a href=\"https://godoc.org/github.com/hashicorp/hcl/hcl/ast#WalkFunc\" rel=\"nofollow noreferrer\">godoc.org/github.com/hashicorp/hcl/hcl/ast#WalkFunc</a>"}], "owner": {"reputation": 5962, "user_id": 3873510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/YpJMi.jpg?s=128&g=1", "display_name": "Paul Razvan Berg", "link": "https://stackoverflow.com/users/3873510/paul-razvan-berg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 369, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1544978117, "creation_date": 1527711566, "last_edit_date": 1544978117, "question_id": 50612780, "link": "https://stackoverflow.com/questions/50612780/how-to-manipulate-hcl-abstract-syntax-tree", "title": "How to manipulate HCL abstract syntax tree?", "body": "<p>I'm writing a compiler using <a href=\"https://github.com/hashicorp/hcl\" rel=\"nofollow noreferrer\">HCL</a> (HashiCorp Configuration Language) and I'm trying to manipulate the AST so that I can add my custom logic.</p>\n\n<pre><code>hclParseTree, err := hcl.Parse(input)\ncheck(err)\nspew.Dump(hclParseTree)\n</code></pre>\n\n<p>I've only managed to print all the tree elements by using <a href=\"https://github.com/davecgh/go-spew\" rel=\"nofollow noreferrer\">go-spew</a>.</p>\n\n<p><a href=\"https://godoc.org/github.com/hashicorp/hcl\" rel=\"nofollow noreferrer\">Documentation</a> is relatively vague and there are few supporting articles on the web. I tried to follow <a href=\"http://jen20.com/2015/09/07/using-hcl-part-1.html\" rel=\"nofollow noreferrer\">this</a> one, but the syntax is deprecated (written in 2015). </p>\n\n<p>How could I achieve something like this?</p>\n\n<pre><code>item := hclParseTree.Get(\"item\")\n</code></pre>\n"}, {"tags": ["go", "protocol-buffers", "arbitrary-precision"], "comments": [{"owner": {"reputation": 921791, "user_id": 23354, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CrVFH.png?s=128&g=1", "display_name": "Marc Gravell", "link": "https://stackoverflow.com/users/23354/marc-gravell"}, "edited": false, "score": 0, "creation_date": 1527708233, "post_id": 50612028, "comment_id": 88234029, "body": "my <code>decimal</code> approach isn&#39;t arbitrary-precision; it was just whatever I&#39;d need for .NET&#39;s <code>System.Decimal</code>. For arbitrary precision with x-plat, I&#39;d probably just go <code>string</code>. And yes: absolutely, avoid <code>float</code>/<code>double</code> for finance apps"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 3, "creation_date": 1527708940, "post_id": 50612028, "comment_id": 88234362, "body": "How about a uint64 as amount of cents/minimal denomination. That&#39;s usually how money is done."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1527767816, "post_id": 50612028, "comment_id": 88257241, "body": "You may want to consider using sint32/64 if your number could be negative (say for debits)."}, {"owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "reply_to_user": {"reputation": 921791, "user_id": 23354, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CrVFH.png?s=128&g=1", "display_name": "Marc Gravell", "link": "https://stackoverflow.com/users/23354/marc-gravell"}, "edited": false, "score": 0, "creation_date": 1527881838, "post_id": 50612028, "comment_id": 88310899, "body": "@MarcGravell Thanks for the thoughts/feedback.  Want to make an Answer?"}, {"owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1527881940, "post_id": 50612028, "comment_id": 88310942, "body": "@thwd I have heard of that method, but it supposes that you are not in the middle of a computation and have already done your rounding.  &quot;Minimal denomination&quot; works great as a concept until you start dividing or multiplying by some fractional percentage or something."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1527883165, "post_id": 50612028, "comment_id": 88311434, "body": "Add as many powers of ten as you need to make rounding errors negligible. uint64 is huge."}, {"owner": {"reputation": 754, "user_id": 9811316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9e8849ebed49c133a3cda4db917e840?s=128&d=identicon&r=PG&f=1", "display_name": "abcalphabet", "link": "https://stackoverflow.com/users/9811316/abcalphabet"}, "edited": false, "score": 0, "creation_date": 1578503928, "post_id": 50612028, "comment_id": 105462975, "body": "We might be getting a standardized decimal type soon after all: <a href=\"https://github.com/protocolbuffers/protobuf/pull/7039\" rel=\"nofollow noreferrer\">github.com/protocolbuffers/protobuf/pull/7039</a>"}], "owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1425, "favorite_count": 2, "answer_count": 0, "score": 6, "last_activity_date": 1527708049, "creation_date": 1527708049, "question_id": 50612028, "link": "https://stackoverflow.com/questions/50612028/go-protobuf-precision-decimals", "title": "Go Protobuf Precision Decimals", "body": "<h3>What is the correct <a href=\"https://developers.google.com/protocol-buffers/docs/proto3#scalar\" rel=\"noreferrer\">scalar type</a> to use in my protobuf definition file, if I want to transmit an arbitrary-precision decimal value?</h3>\n\n<p>I am using <a href=\"https://github.com/shopspring/decimal\" rel=\"noreferrer\">shopspring/decimal</a> instead of a float64 in my Go code to prevent math errors.  When writing my protobuf file with the intention of transmitting these values over gRPC, I could use:</p>\n\n<ul>\n<li><code>double</code> which translates to a float64</li>\n<li><code>string</code> which would certainly be precise in its own way but strikes me as clunky</li>\n<li>Something like <a href=\"https://github.com/mgravell/protobuf-net/blob/59b83356149a6df5027631421e2d6e03c8708725/src/Tools/bcl.proto#L72\" rel=\"noreferrer\">decimal</a> from <a href=\"https://github.com/mgravell/protobuf-net\" rel=\"noreferrer\">mgravell/protobuf-net</a>?</li>\n</ul>\n\n<p>Conventional wisdom has taught me to skirt floats in monetary applications, but I may be over-careful since it's a point of serialization.</p>\n"}, {"tags": ["go", "minikube"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527715188, "post_id": 50611155, "comment_id": 88236849, "body": "What exactly this expression evaluates to <code>&quot;0.0.0.0&quot; + &quot;:&quot; + config.Listen,</code>"}, {"owner": {"reputation": 111, "user_id": 1905164, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/645e68af626a81d213ec8385c7da19e8?s=128&d=identicon&r=PG", "display_name": "user127", "link": "https://stackoverflow.com/users/1905164/user127"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527715955, "post_id": 50611155, "comment_id": 88237142, "body": "The error message is:      <code>listen tcp: address 0.0.0.0:tcp:&#47;&#47;10.101.224.10:8087: too many colons in address</code>  Apparently, the IP dynamically allocated by minikube is being injected to the address, but without properly replacing the &quot;0.0.0.0&quot;, which is a sort of IPv4 wildcard binding.  Changing the declaration of that in the code seems to have no effect, as the extra leading colon is always there.  The address probably should have been transformed to <code>tcp:&#47;&#47;10.101.224.10:8087</code>"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527716028, "post_id": 50611155, "comment_id": 88237158, "body": "<code>0.0.0.0:tcp:&#47;&#47;10.101.224.10:8087</code> --- this is totally wrong syntax though. Where do you get <code>config.Listen</code> from? Regardless of where - it contains an unexpected value."}, {"owner": {"reputation": 111, "user_id": 1905164, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/645e68af626a81d213ec8385c7da19e8?s=128&d=identicon&r=PG", "display_name": "user127", "link": "https://stackoverflow.com/users/1905164/user127"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527716258, "post_id": 50611155, "comment_id": 88237243, "body": "The config object is populated by environment variables.  config.Listen is the port to listen on.  FWIW, this same code runs fine in many other contexts."}, {"owner": {"reputation": 111, "user_id": 1905164, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/645e68af626a81d213ec8385c7da19e8?s=128&d=identicon&r=PG", "display_name": "user127", "link": "https://stackoverflow.com/users/1905164/user127"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527716756, "post_id": 50611155, "comment_id": 88237415, "body": "FWIW, changing the Addr value to <code>&quot;:&quot; + config.Listen</code> produces the same error, just now slightly different flavor:   <code>listen tcp: address :tcp:&#47;&#47;10.101.224.10:8087: too many colons in address</code>"}, {"owner": {"reputation": 111, "user_id": 1905164, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/645e68af626a81d213ec8385c7da19e8?s=128&d=identicon&r=PG", "display_name": "user127", "link": "https://stackoverflow.com/users/1905164/user127"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527717117, "post_id": 50611155, "comment_id": 88237548, "body": "as does <code>Addr = &quot;:8087&quot;</code>, which is the format shown in the docs."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527717325, "post_id": 50611155, "comment_id": 88237612, "body": "I&#39;m lost at the moment - show the very actual version of code you&#39;re running and the exact <code>config.Listen</code> value. <code>:tcp:&#47;&#47;10.101.224.10:8087</code> is wrong syntax. <code>0.0.0.0:tcp:&#47;&#47;10.101.224.10:8087</code> is wrong syntax as well, so both fail <i>as expected</i>."}, {"owner": {"reputation": 111, "user_id": 1905164, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/645e68af626a81d213ec8385c7da19e8?s=128&d=identicon&r=PG", "display_name": "user127", "link": "https://stackoverflow.com/users/1905164/user127"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527717938, "post_id": 50611155, "comment_id": 88237783, "body": "Exactly -- I do not provide either of those strings.  That is indeed the problem.  I just put in the port as shown in the Go docs.  Runs in MacOs, runs in Docker, runs in GKE, doesn&#39;t run in minikube."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527718139, "post_id": 50611155, "comment_id": 88237849, "body": "<code>config.Listen</code> is a variable (technically: a structure&#39;s field) that is provided by something somewhere. Where is it set? Wherever it is set - it is set to the wrong value."}, {"owner": {"reputation": 111, "user_id": 1905164, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/645e68af626a81d213ec8385c7da19e8?s=128&d=identicon&r=PG", "display_name": "user127", "link": "https://stackoverflow.com/users/1905164/user127"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527718664, "post_id": 50611155, "comment_id": 88238002, "body": "It is set using Cobra.  I have also tested just putting in the literal string &quot;:8087&quot; into Server.Addr.  Same results -- too many commas.  The Go docs use &quot;:8080&quot;, but I doubt the port number is the issue."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527719335, "post_id": 50611155, "comment_id": 88238170, "body": "The issue is that <b>you</b> pass <code>tcp:&#47;&#47;10.101.224.10:8087</code> there. You only should pass a single number there. Anyway, we&#39;re going circles, the problem is that you&#39;re passing wrong value. If you pass the correct value (a number) it would be fine."}, {"owner": {"reputation": 111, "user_id": 1905164, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/645e68af626a81d213ec8385c7da19e8?s=128&d=identicon&r=PG", "display_name": "user127", "link": "https://stackoverflow.com/users/1905164/user127"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527719552, "post_id": 50611155, "comment_id": 88238230, "body": "I do NOT pass that value.  I pass &quot;:8087&quot;.  BTW, if I pass &quot;8087&quot;, Go says I&#39;m missing the port.  This is why they require the colon in front of the number in the docs."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527719600, "post_id": 50611155, "comment_id": 88238240, "body": "Sure, if you pass the proper <code>ip:port</code> (or <code>:port</code>) value it would be okay, but you or whatever software you use - passes the wrong value. What kind of help are you seeking for?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 111, "user_id": 1905164, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/645e68af626a81d213ec8385c7da19e8?s=128&d=identicon&r=PG", "display_name": "user127", "link": "https://stackoverflow.com/users/1905164/user127"}, "edited": false, "score": 0, "creation_date": 1527719613, "post_id": 50611155, "comment_id": 88238243, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/172119/discussion-between-zerkms-and-user127\">continue this discussion in chat</a>."}], "owner": {"reputation": 111, "user_id": 1905164, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/645e68af626a81d213ec8385c7da19e8?s=128&d=identicon&r=PG", "display_name": "user127", "link": "https://stackoverflow.com/users/1905164/user127"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 264, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1527719002, "creation_date": 1527704261, "last_edit_date": 1527719002, "question_id": 50611155, "link": "https://stackoverflow.com/questions/50611155/http-server-listenandserve-crash-too-many-commas-on-minikube-only", "title": "http.Server.ListenAndServe Crash &quot;too many commas&quot; On Minikube Only", "body": "<p>I have a server written in Go that presents a REST API.  This service runs fine on MacOS, and also as a cross-compiled Linux executable in a Docker container. And for a few days, it ran fine deployed in minikube as well. Somehow it has quit working on minikube, failing with an \"address has too many commas\" error. I have tried various flavors of Addr specification, all with the same result -- works everywhere but minikube.</p>\n\n<pre><code>// Configure http server\nsrv := &amp;http.Server{\n    Handler: r,\n    Addr:    \":8087\",\n    WriteTimeout: 15 * time.Second,\n    ReadTimeout:  15 * time.Second,\n}\n\n// Listen to configured port and serve\nlog.Fatal(srv.ListenAndServe())\n</code></pre>\n\n<p>My Dockerfile:</p>\n\n<pre><code>FROM alpine:latest\nWORKDIR /home\nCOPY ./bin/afg-linux afg\nEXPOSE 8087\nRUN chmod +x afg\nCMD ./afg\n</code></pre>\n\n<p>And the minikube YAML:</p>\n\n<pre><code># APP DEPLOYMENT\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  labels:\n    run: afg\n  name: afg\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      run: afg-ex\n  template:\n    metadata:\n      labels:\n        run: afg-ex\n    spec:\n      containers:\n      - image: localhost:5000/afg:v1.02\n        name: afg\n        ports:\n        - containerPort: 8087\n          protocol: TCP\n---\n# APP SERVICE\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    run: afg\n  name: afg\nspec:\n  ports:\n  - port: 8087\n    protocol: TCP\n    targetPort: 8087\n  selector:\n    run: afg-ex\n  type: NodePort\n</code></pre>\n"}, {"tags": ["pointers", "go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527732213, "post_id": 50610798, "comment_id": 88241119, "body": "Have you read <a href=\"https://github.com/golang/go/wiki/cgo#function-variables\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/cgo#function-variables</a>? (and please format your code correctly, it&#39;s quite hard to read here)"}, {"owner": {"reputation": 11, "user_id": 2288031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8804e38ce377d66d8d0d4493c3a96a70?s=128&d=identicon&r=PG", "display_name": "user2288031", "link": "https://stackoverflow.com/users/2288031/user2288031"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527746708, "post_id": 50610798, "comment_id": 88245005, "body": "Thanks Jim, this helped."}], "owner": {"reputation": 11, "user_id": 2288031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8804e38ce377d66d8d0d4493c3a96a70?s=128&d=identicon&r=PG", "display_name": "user2288031", "link": "https://stackoverflow.com/users/2288031/user2288031"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 609, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1527826206, "creation_date": 1527702819, "last_edit_date": 1527826206, "question_id": 50610798, "link": "https://stackoverflow.com/questions/50610798/passing-go-pointers-to-c-callback-function", "title": "Passing GO pointers to C callback function", "body": "<p>I have a requirement to pass a function pointer as a parameter (ie, a callback function)  to a C function inside a shared object.  The expectation is to get a callback from the function inside the shared object. I need to implement the function in GO and should be invoked as a callback from C shared object. My solution is throwing a Segmentation fault in the last step.</p>\n\n<pre><code>//////////////in libcshared.so ///////////\ntypedef void (*test_function_ptr)(int a)\nvoid callerfun(test_function_ptr callback)\n\n//////////////in GO program//////C program\nvoid* gofunptr;\nvoid implfun(int x){\nGOSharedfn(gofunptr);\n}\n-------------\nfunc main(){\nC.gofunptr = &amp;gofun\nvar callback = C.test_function_ptr(unsafe.Pointer(C.implfun))\nC.callerfun(callback )\n}\nvar gofun = goimpl\nfunc goimpl(){\n}\n/////////GO shared lib libgoshared.so/////////&lt;br&gt;\nfunc GOSharedfn(unsafe.Pointer pointer){\nf:=(cast to fun ptr)pointer\nf();//Segmentation fault\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/JRoxo.png\" rel=\"nofollow noreferrer\">Function call flow diagram</a></p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1527698297, "post_id": 50609571, "comment_id": 88229026, "body": "Maps with a single entry are pointless if the value is just a sentinel. However, judging from the question you&#39;ll want to turn a slice into a set (i.e. map[string]bool) and <i>then</i> send the map into the channel."}], "answers": [{"comments": [{"owner": {"reputation": 6495, "user_id": 1082327, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/FzJNd.jpg?s=128&g=1", "display_name": "PoweredByOrange", "link": "https://stackoverflow.com/users/1082327/poweredbyorange"}, "edited": false, "score": 0, "creation_date": 1527698357, "post_id": 50609659, "comment_id": 88229057, "body": "Ah. The syntax makes sense. Yep as I mentioned in the question I know this is impractical I was mostly just curious about the syntax. And now that I have seen the syntax I totally see why I was on the wrong track :) Thanks!"}, {"owner": {"reputation": 6495, "user_id": 1082327, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/FzJNd.jpg?s=128&g=1", "display_name": "PoweredByOrange", "link": "https://stackoverflow.com/users/1082327/poweredbyorange"}, "edited": false, "score": 0, "creation_date": 1527698446, "post_id": 50609659, "comment_id": 88229110, "body": "Oooh <code>sync.Map</code>. Interesting."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1527698587, "post_id": 50609659, "comment_id": 88229183, "body": "To add to this, there&#39;s no concept of <code>Map.Entry&lt;K, V&gt;</code> in go. If you want to keep pairs of elements together then you would need to create your own struct type to hold them, and pass that."}, {"owner": {"reputation": 6495, "user_id": 1082327, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/FzJNd.jpg?s=128&g=1", "display_name": "PoweredByOrange", "link": "https://stackoverflow.com/users/1082327/poweredbyorange"}, "reply_to_user": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1527698642, "post_id": 50609659, "comment_id": 88229216, "body": "Thanks @Zak. That makes sense."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 3, "last_activity_date": 1527698553, "last_edit_date": 1527698553, "creation_date": 1527698216, "answer_id": 50609659, "question_id": 50609571, "link": "https://stackoverflow.com/questions/50609571/channel-of-type-set/50609659#50609659", "title": "Channel of type &quot;set&quot;", "body": "<p>To answer the question directly, you would want</p>\n\n<pre><code>resultsChnl &lt;- map[string]bool{result: true}\n</code></pre>\n\n<p>But this doesn't seem useful at all. You may want to <em>collect</em> the results in a map, but there's no reason to pass a map over the channel for each result when you know it will only have one element. Simply use a channel of <code>string</code>, do </p>\n\n<pre><code>resultsChnl &lt;- result\n</code></pre>\n\n<p>for each result in your producer goroutine, and</p>\n\n<pre><code>seenResult[item] = true\n</code></pre>\n\n<p>in your consumer loop to collect the results (where <code>seenResult</code> is a <code>map[string]bool</code>).</p>\n\n<p>Or forget about the channel entirely and have your producer goroutines write directly into a <a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\">sync.Map</a>.</p>\n"}], "owner": {"reputation": 6495, "user_id": 1082327, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/FzJNd.jpg?s=128&g=1", "display_name": "PoweredByOrange", "link": "https://stackoverflow.com/users/1082327/poweredbyorange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 50609659, "answer_count": 1, "score": 0, "last_activity_date": 1527698553, "creation_date": 1527697860, "question_id": 50609571, "link": "https://stackoverflow.com/questions/50609571/channel-of-type-set", "title": "Channel of type &quot;set&quot;", "body": "<p>I recently started writing Go after years of programming in C#, and I'm having a hard time wrapping my head around several concepts of the language. Here's an example of what I'm trying to solve: I'd like to be able to create  a routine that iterates over a list, calls a function, and stores the output in a buffered channel. The issue is I want to return a <strong>distinct</strong> set of these output values, as the function can return similar results for two different elements in the list.</p>\n\n<p>Since Go doesn't have a built-in set type, I'm trying to use a <code>map[string]bool</code> to store distinct values (using <code>map[string]bool</code> or <code>map[string]struct</code> is what others suggested as a replacement for a set); and I'm using a buffered channel to insert into this map, however I'm not certain what the right syntax for inserting 1 element into a map would look like. Here's  what I'm trying to do:</p>\n\n<pre><code>resultsChnl := make(chan map[string]bool, len(myList))\ngo func(myList []string, resultsChnl chan map[string]bool) {\n    for _, item := range myList {\n\n        result, err := getResult(item)\n        /* error checking */\n\n        resultsChnl &lt;- {result: true}\n    }\n\n    close(resultsChnl)\n}(myList, resultsChnl)\n\nfor item := range resultsChnl {\n    ...\n}\n</code></pre>\n\n<p>Obviously this doesn't compile due to invalid syntax of <code>resultsChnl &lt;- {result: true}</code>. I know this sounds impractical since naturally in this particular case I could create a local map inside the for loop and assign one <code>map[string]bool</code> object to a non-buffered channel and return that, but let's assume I was creating a go routine for each item in the list and really wanted to use a buffered channel (as opposed to using a mutex to grab a lock on a shared map). So is there any way to insert one key-value pair in a map channel? Or am I thinking about this completely wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24536, "user_id": 111124, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8215e290861f1c44a457d26c4f24af70?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/111124/andrew"}, "edited": false, "score": 4, "creation_date": 1527695755, "post_id": 50608953, "comment_id": 88227639, "body": "Hint : Research recursion."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9871340, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "sabarinath gnanasekar", "link": "https://stackoverflow.com/users/9871340/sabarinath-gnanasekar"}, "edited": false, "score": 0, "creation_date": 1527849069, "post_id": 50609225, "comment_id": 88292821, "body": "Thanks for your clarification,i understood the laws of recursion."}, {"owner": {"reputation": 11, "user_id": 9871340, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "sabarinath gnanasekar", "link": "https://stackoverflow.com/users/9871340/sabarinath-gnanasekar"}, "edited": false, "score": 0, "creation_date": 1527849111, "post_id": 50609225, "comment_id": 88292847, "body": "But what i didn&#39;t get was the main function has statement  fibN := fib(45) ,and finally returns result  .    how the fib function returning the result,at any cost only numeric return was when it is x &lt;2"}, {"owner": {"reputation": 3623, "user_id": 491557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3c20e970d3e909fa67a7809965c4936?s=128&d=identicon&r=PG", "display_name": "Spangen", "link": "https://stackoverflow.com/users/491557/spangen"}, "reply_to_user": {"reputation": 11, "user_id": 9871340, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "sabarinath gnanasekar", "link": "https://stackoverflow.com/users/9871340/sabarinath-gnanasekar"}, "edited": false, "score": 0, "creation_date": 1527852582, "post_id": 50609225, "comment_id": 88294885, "body": "Because the call to fib(45) will block while the calls to fib(44) and fib(43) are executed, fib(44) will block on fib(43) and fib(42). The call to  fib(43) will block until fib(42) and fib(41)  return  so on.  These build up a stack of calls until fib(1) or fib(0) which will return and the stack unwinds and each call returns a value to its caller."}, {"owner": {"reputation": 11, "user_id": 9871340, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "sabarinath gnanasekar", "link": "https://stackoverflow.com/users/9871340/sabarinath-gnanasekar"}, "edited": false, "score": 0, "creation_date": 1527853002, "post_id": 50609225, "comment_id": 88295135, "body": "You are true,but where i didn&#39;t get was what is the result of fib(44),fib(43)...so on..because there is no single step to calculate that...finally how it accumulate to answer 1134903170............."}, {"owner": {"reputation": 3623, "user_id": 491557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3c20e970d3e909fa67a7809965c4936?s=128&d=identicon&r=PG", "display_name": "Spangen", "link": "https://stackoverflow.com/users/491557/spangen"}, "reply_to_user": {"reputation": 11, "user_id": 9871340, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "sabarinath gnanasekar", "link": "https://stackoverflow.com/users/9871340/sabarinath-gnanasekar"}, "edited": false, "score": 0, "creation_date": 1527853572, "post_id": 50609225, "comment_id": 88295494, "body": "Try it on pen and paper to calculate fib(5)  Write out your stack frames.  I can&#39;t help more than that. This is very very basic recursion"}], "tags": [], "owner": {"reputation": 3623, "user_id": 491557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3c20e970d3e909fa67a7809965c4936?s=128&d=identicon&r=PG", "display_name": "Spangen", "link": "https://stackoverflow.com/users/491557/spangen"}, "is_accepted": true, "score": 0, "last_activity_date": 1527696589, "creation_date": 1527696589, "answer_id": 50609225, "question_id": 50608953, "link": "https://stackoverflow.com/questions/50608953/explainfunction-returns-same-function-in-go/50609225#50609225", "title": "Explain:function returns same function in go", "body": "<p>The key is in this function:</p>\n\n<pre><code>func fib(x int) int {\n    if x &lt; 2 {\n        return x\n    }\n    return fib(x-1) + fib(x-2)\n}\n</code></pre>\n\n<p>If <code>x&lt;2</code> the function returns immediately, if not it retrieves the result from a call to <code>fib</code> with a smaller value of <code>x</code></p>\n\n<p>For recursive calls there are the 3 Laws of Recursion:</p>\n\n<ol>\n<li>A recursive algorithm must have a base case.</li>\n<li>A recursive algorithm\nmust change its state and move toward the base case.</li>\n<li>A recursive\nalgorithm must call itself, recursively.</li>\n</ol>\n\n<p><a href=\"http://interactivepython.org/courselib/static/pythonds/Recursion/TheThreeLawsofRecursion.html\" rel=\"nofollow noreferrer\">http://interactivepython.org/courselib/static/pythonds/Recursion/TheThreeLawsofRecursion.html</a></p>\n\n<p>In your example, the base case is when <code>x &lt; 2</code>. The state change is the reduction by 1 or 2 and your function calls itself recursively so the three laws are met.</p>\n"}], "owner": {"reputation": 11, "user_id": 9871340, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "sabarinath gnanasekar", "link": "https://stackoverflow.com/users/9871340/sabarinath-gnanasekar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 50609225, "answer_count": 1, "score": -5, "last_activity_date": 1527698638, "creation_date": 1527695632, "last_edit_date": 1527698638, "question_id": 50608953, "link": "https://stackoverflow.com/questions/50608953/explainfunction-returns-same-function-in-go", "title": "Explain:function returns same function in go", "body": "<pre><code>func main() {\n    go spinner(100 * time.Millisecond)\n    const n = 45\n    fibN := fib(n) // slow\n    fmt.Printf(\"\\rFibonacci(%d) = %d\\n\", n, fibN)\n}\n\nfunc spinner(delay time.Duration) {\n    for {\n        for _, r := range `-\\|/` {\n            fmt.Printf(\"\\r%c\", r)\n            time.Sleep(delay)\n        }\n    }\n}\n\nfunc fib(x int) int {\n    if x &lt; 2 {\n        return x\n    }\n    return fib(x-1) + fib(x-2)\n}\n</code></pre>\n\n<p>can you explain above fib function ,how the results are obtained.</p>\n\n<p>fib function return a fib calls ,how does the end results come?</p>\n"}, {"tags": ["go", "ibm-cloud-infrastructure"], "answers": [{"tags": [], "owner": {"reputation": 668, "user_id": 9426033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e497a5abd02ca5ab68b84c07a1d084cd?s=128&d=identicon&r=PG&f=1", "display_name": "F.Ojeda", "link": "https://stackoverflow.com/users/9426033/f-ojeda"}, "is_accepted": true, "score": 0, "last_activity_date": 1527698367, "creation_date": 1527698367, "answer_id": 50609702, "question_id": 50608572, "link": "https://stackoverflow.com/questions/50608572/getlocations-fails-with-object-does-not-exist-to-execute-method-on/50609702#50609702", "title": "GetLocations fails with &quot;Object does not exist to execute method on&quot;", "body": "<p>The error that you got is because you need to use an identifier locationGroup ID.</p>\n\n<p>Add this locationGroupId to you go code, like this example:</p>\n\n<pre><code>locationGroupId := 1\n\n// Create a session\nsess := session.New(username, apikey)\n\n// Get SoftLayer_Location_Group\nservice := services.GetLocationGroupService(sess)\n\nresult, err := service.Id(locationGroupId).GetLocations()\n</code></pre>\n\n<p>Reference:</p>\n\n<p><a href=\"https://softlayer.github.io/reference/services/SoftLayer_Location_Group/getLocations/\" rel=\"nofollow noreferrer\">https://softlayer.github.io/reference/services/SoftLayer_Location_Group/getLocations/</a></p>\n\n<p>To get all locationGroupIds available you can use this go code example:</p>\n\n<pre><code>package main\n\n/*\nGetAllObjects\n\nRetrieve all locationGroup objects.\n\nImportant manual pages:\nhttps://softlayer.github.io/reference/services/SoftLayer_Location_Group/\nhttps://softlayer.github.io/reference/services/SoftLayer_Location_Group/getAllObjects/\n\nLicense: http://sldn.softlayer.com/article/License\nAuthor: SoftLayer Technologies, Inc. &lt;sldn@softlayer.com&gt;\n*/\n\nimport (\n    \"fmt\"\n    \"github.com/softlayer/softlayer-go/services\"\n    \"github.com/softlayer/softlayer-go/session\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    // SoftLayer API username and key\n    username := \"set me\"\n    apikey   := \"set me\"\n\n    // Create a session\n    sess := session.New(username, apikey)\n\n    // Get SoftLayer_Account service\n    service := services.GetLocationGroupService(sess)\n\n    result, err := service.GetAllObjects()\n    if err != nil {\n        fmt.Printf(\"\\n Unable to retrieve all locationGroups:\\n - %s\\n\", err)\n        return\n    }\n    // Following helps to print the result in json format.\n    jsonFormat, jsonErr := json.MarshalIndent(result,\"\",\"     \")\n    if jsonErr != nil {\n        fmt.Println(jsonErr)\n        return\n    }\n    fmt.Println(string(jsonFormat))\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 3729938, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10d93eb4a8858bdd81a5ad0286d82b41?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis", "link": "https://stackoverflow.com/users/3729938/dennis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 50609702, "answer_count": 1, "score": 0, "last_activity_date": 1527698367, "creation_date": 1527694474, "question_id": 50608572, "link": "https://stackoverflow.com/questions/50608572/getlocations-fails-with-object-does-not-exist-to-execute-method-on", "title": "GetLocations fails with &quot;Object does not exist to execute method on&quot;", "body": "<p>I am having trouble with the GetLocations call. Every time I try to execute it I receive the error: </p>\n\n<blockquote>\n  <p>SoftLayer_Exception: Object does not exist to execute method on.\n  (SoftLayer_Location_Group::getLocations) (HTTP 200)</p>\n</blockquote>\n\n<p>This makes me think that there is something wrong with the locationService object I created but I don't understand what. Does anyone see the issue?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/softlayer/softlayer-go/session\"\n    \"github.com/softlayer/softlayer-go/services\"\n)\n\nfunc main() {\n    sess := session.New(\"user\", \"password\")\n    locationService := services.GetLocationGroupService(sess)\n    locations, err := locationService.GetLocations()\n    if err != nil {\n        fmt.Printf(\"%s\\n\",err.Error())\n        return\n    }\n    fmt.Printf(\"%+v\", locations)\n}\n</code></pre>\n"}, {"tags": ["go", "filesystems", "temp"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1527691269, "post_id": 50607439, "comment_id": 88224673, "body": "Why are you avoiding <code>ioutil.Tempfile</code>? There is no &quot;correct&quot; mode, but Tempfile uses <code>os.OpenFile(name, os.O_RDWR|os.O_CREATE|os.O_EXCL, 0600)</code>"}, {"owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527691446, "post_id": 50607439, "comment_id": 88224785, "body": "@JimB Edited the question to clarify"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1527692225, "post_id": 50607439, "comment_id": 88225362, "body": "<a href=\"https://en.wikipedia.org/wiki/Plan_9_from_Bell_Labs\" rel=\"nofollow noreferrer\">Plan 9</a> is a Unix-like OS. &quot;Plan 9 only&quot; means it only works on Plan 9, so no, it won&#39;t work on Linux."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527693108, "post_id": 50607439, "comment_id": 88225964, "body": "Even if <code>ModeTemporary</code> was valid on your OS, are you really looking to leave the permission bits <code>0000</code>?"}, {"owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "edited": false, "score": 0, "creation_date": 1527693202, "post_id": 50607439, "comment_id": 88226032, "body": "I don&#39;t intend on writing the file. Just creating it"}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1527694973, "post_id": 50607592, "comment_id": 88227168, "body": "Not <i>quite:</i> <code>extN</code> support &quot;attributes&quot; on files and directories. The <code>d</code> attribute on a file is documented as marking the file to be excluded from the consideration by the <code>dump(8)</code> utility. Looks quite like this flag. Of course, this attribute is purely a &quot;policy thing&quot;\u2014that is, it does not <i>mandate</i> the kernel (or whatever) to do anything (as opponsed, to say, the <code>i</code> attribute which marks the file immutable even for root). More info can be found in the <code>chattr(1)</code> man page, for instance."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1527691537, "creation_date": 1527691537, "answer_id": 50607592, "question_id": 50607439, "link": "https://stackoverflow.com/questions/50607439/what-is-temporary-file-mode-in-plan-9-and-is-it-available-in-linux/50607592#50607592", "title": "What is &quot;Temporary&quot; file mode in Plan 9, and is it available in Linux?", "body": "<p>\"Temporary\" mode on Plan 9 marks the file for exclusion from daily backups. From the <a href=\"https://9fans.github.io/plan9port/man/man9/stat.html\" rel=\"nofollow noreferrer\"><code>stat</code> man page</a>:</p>\n\n<blockquote>\n  <p>Temporary files are not included in nightly archives (see Plan 9\u2019s fossil(4)).</p>\n</blockquote>\n\n<p>And no, this is not available on standard Linux filesystems.</p>\n"}], "owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 50607592, "answer_count": 1, "score": 1, "last_activity_date": 1527691537, "creation_date": 1527691073, "last_edit_date": 1527691414, "question_id": 50607439, "link": "https://stackoverflow.com/questions/50607439/what-is-temporary-file-mode-in-plan-9-and-is-it-available-in-linux", "title": "What is &quot;Temporary&quot; file mode in Plan 9, and is it available in Linux?", "body": "<p>I am manually creating a temporary file using:</p>\n\n<pre><code>tempDir := os.TempDir()\ntempFile := filepath.Join(tempDir, \"my.file\")\nioutil.WriteFile(tempFile, []byte{}, os.ModeTemporary)\n</code></pre>\n\n<p>I am intentionally avoiding <code>ioutil.TempFile()</code> because I don't want a random suffix to be appended to the filename.</p>\n\n<p>When browsing through the different types of permissions in the <code>os</code> package, <code>ModeTemporary</code> seemed the most fitting but is also commented with:</p>\n\n<pre><code>ModeTemporary                                  // T: temporary file; Plan 9 only\n</code></pre>\n\n<p>What's Plan 9 and why does only it support <code>ModeTemporary</code>?</p>\n\n<p>Can I use <code>ModeTemporary</code> on normal Linux distributions as well?</p>\n"}, {"tags": ["go", "udp", "packets"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1527683742, "post_id": 50604803, "comment_id": 88218991, "body": "Why do you think you cannot receive packets? (this code doesn&#39;t attempt to receive at all)"}, {"owner": {"reputation": 107, "user_id": 9805035, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4a78p.jpg?s=128&g=1", "display_name": "DutchBoii", "link": "https://stackoverflow.com/users/9805035/dutchboii"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527774311, "post_id": 50604803, "comment_id": 88261594, "body": "This code doesnt receive indeed. But thats not the problem, please read my question again."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527774487, "post_id": 50604803, "comment_id": 88261729, "body": "Sorry, I have read it again, and still don&#39;t understand. If you want to send a packet then wait for a reply, you need to read from the connection after sending the packet (or concurrently), which you haven&#39;t done. Have you tried using <code>conn.Read</code>, and if so, what did you try and what didn&#39;t work?"}], "owner": {"reputation": 107, "user_id": 9805035, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4a78p.jpg?s=128&g=1", "display_name": "DutchBoii", "link": "https://stackoverflow.com/users/9805035/dutchboii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 797, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1527702565, "creation_date": 1527683625, "question_id": 50604803, "link": "https://stackoverflow.com/questions/50604803/golang-send-and-receive-udp-packets-simultaneously", "title": "Golang send and receive udp packets simultaneously", "body": "<p>I have a little problem. I want to receive and write udp packets with a DialUDP function. The problem is that it only can write and not receive udp packets (i think). How can i send a packet and let the program wait on a respond from the server?</p>\n\n<p>my code:</p>\n\n<pre><code>if programPacketType == \"udp\"{\n    server,err := net.ResolveUDPAddr(\"udp4\", programAddressInput)\n    checkError(err)\n    lServer, err := net.ResolveUDPAddr(\"udp4\", programLocalAddressInput)\n    checkError(err)\n\n\n    conn, err := net.DialUDP(\"udp4\", server, lServer)\n    checkError(err)\n\n    i := 0\n    for {\n        msg := strconv.Itoa(i)\n        i++\n        buf := []byte(msg)\n        _,err := conn.Write(buf)\n        if err != nil {\n            fmt.Println(msg, err)\n        }\n        fmt.Println(\"sended:\", i, \"to connected server\")\n        time.Sleep(time.Second * 1)\n    }\n}\n</code></pre>\n\n<p>thanks.</p>\n\n<p>(Pls ignore grammatical mistakes,)</p>\n"}, {"tags": ["go", "concurrency", "locking", "constants", "mutex"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1527680524, "post_id": 50603742, "comment_id": 88216673, "body": "Can you change a constant? No. If you can&#39;t, may there be a case when it is being written and read at the same time?"}, {"owner": {"reputation": 313, "user_id": 7219283, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ef2fa27a5429cf4bbb4736e20a8c6299?s=128&d=identicon&r=PG&f=1", "display_name": "Ian.V", "link": "https://stackoverflow.com/users/7219283/ian-v"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1527680613, "post_id": 50603742, "comment_id": 88216746, "body": "@icza This is why I was wondering it. Would there be a certain way it has a point of using it with a constant. Thank you for reacting and reading so fast!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1527686174, "post_id": 50603742, "comment_id": 88220809, "body": "&quot;constant variable&quot; is a contradiction in terms."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1527681896, "last_edit_date": 1527681896, "creation_date": 1527680789, "answer_id": 50603868, "question_id": 50603742, "link": "https://stackoverflow.com/questions/50603742/would-you-ever-have-to-lock-const-with-a-mutex-lock/50603868#50603868", "title": "Would you ever have to lock const with a mutex lock?", "body": "<p>The rule is simple: if multiple goroutines access a <a href=\"https://golang.org/ref/spec#Variables\" rel=\"nofollow noreferrer\">variable</a> concurrently, and at least one of the accesses is a write, then synchronization is required.</p>\n\n<p>If we talk about <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">constants</a>, then there is no variable, and you cannot take the address of a constant (for details, see <a href=\"https://stackoverflow.com/questions/35146286/find-address-of-constant-in-go/35146856#35146856\">Find address of constant in go</a>), so it is not possible to modify constant values.</p>\n\n<p>You do not need any synchronization to access constants from multiple goroutines.</p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527692351, "post_id": 50604192, "comment_id": 88225454, "body": "This doesn&#39;t make any sense. A constant is a constant, not a variable, and its value is defined at compile time, not at run time. &quot;if you consider const as variable&quot; then you don&#39;t know what a constant is."}, {"owner": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527692705, "post_id": 50604192, "comment_id": 88225702, "body": "There is a little misunderstanding caused by OPs &quot;constant variable&quot; term. That&#39;s why I added this &quot;if you consider...&quot; part. Meaning, that if you use variable as a constant then you can face some pitfalls."}], "tags": [], "owner": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "is_accepted": false, "score": 0, "last_activity_date": 1527681739, "creation_date": 1527681739, "answer_id": 50604192, "question_id": 50603742, "link": "https://stackoverflow.com/questions/50603742/would-you-ever-have-to-lock-const-with-a-mutex-lock/50604192#50604192", "title": "Would you ever have to lock const with a mutex lock?", "body": "<p>If you talk about constants there is no need to use sync routines to access them (as @icza suggests).</p>\n\n<p>But if you consider const as variable whose value cannot be changed once it has been assigned a value, then you should be careful because of golang memory model and <a href=\"https://golang.org/ref/mem#tmp_2\" rel=\"nofollow noreferrer\">happens before</a> relationship.</p>\n"}], "owner": {"reputation": 313, "user_id": 7219283, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ef2fa27a5429cf4bbb4736e20a8c6299?s=128&d=identicon&r=PG&f=1", "display_name": "Ian.V", "link": "https://stackoverflow.com/users/7219283/ian-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 50603868, "answer_count": 2, "score": 1, "last_activity_date": 1527686136, "creation_date": 1527680413, "last_edit_date": 1527686136, "question_id": 50603742, "link": "https://stackoverflow.com/questions/50603742/would-you-ever-have-to-lock-const-with-a-mutex-lock", "title": "Would you ever have to lock const with a mutex lock?", "body": "<p>I am programming in go and using mutex lock to lock certain variables so they cannot be overwritten while being read.</p>\n\n<p>This got me thinking. Since you can read a variable multiple times. Is there a scenario where you ever have to lock a constant variable?</p>\n"}, {"tags": ["linux", "go", "network-programming", "pcap"], "comments": [{"owner": {"reputation": 6006, "user_id": 2368241, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lKVRg.png?s=128&g=1", "display_name": "Bjoern Rennhak", "link": "https://stackoverflow.com/users/2368241/bjoern-rennhak"}, "edited": false, "score": 0, "creation_date": 1527674963, "post_id": 50601626, "comment_id": 88213000, "body": "Wild guess. Are some local firewall rules dropping the packet due to some rules protecting against spoofing? Does this happen also if your firewall rules are cleared/off ?"}, {"owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "reply_to_user": {"reputation": 6006, "user_id": 2368241, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lKVRg.png?s=128&g=1", "display_name": "Bjoern Rennhak", "link": "https://stackoverflow.com/users/2368241/bjoern-rennhak"}, "edited": false, "score": 0, "creation_date": 1527680035, "post_id": 50601626, "comment_id": 88216365, "body": "nah... it seems that pcap bypasses the ip stack."}, {"owner": {"reputation": 7068, "user_id": 6884590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0b52ad2211a26c4e1cefb472e09cbe?s=128&d=identicon&r=PG", "display_name": "pchaigno", "link": "https://stackoverflow.com/users/6884590/pchaigno"}, "edited": false, "score": 0, "creation_date": 1527686738, "post_id": 50601626, "comment_id": 88221219, "body": "What are the Ethernet addresses on packets in the pcap? How did you capture the pcap? Did you change its content before sending it?"}, {"owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "edited": false, "score": 0, "creation_date": 1527686943, "post_id": 50601626, "comment_id": 88221359, "body": "I captured them on the local machine so the addresses should be fine."}, {"owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "edited": false, "score": 0, "creation_date": 1527687304, "post_id": 50601626, "comment_id": 88221641, "body": "for what it&#39;s worth: the ethernet addresses are all zeroes (probably because its <code>lo</code> and not an <code>eth*</code>). ip src and dst are 127.0.0.1 obviously."}], "answers": [{"tags": [], "owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "is_accepted": false, "score": 0, "last_activity_date": 1528900526, "creation_date": 1528900526, "answer_id": 50839908, "question_id": 50601626, "link": "https://stackoverflow.com/questions/50601626/sending-packets-to-127-0-0-1-through-gopcap/50839908#50839908", "title": "Sending packets to 127.0.0.1 through gopcap", "body": "<p>As far as some more research goes it seems to be the case that sending packets with pcap bypasses IP network stacks in such a way that the packets can't be seen by processes. A workaround is to strip the lower levels of the packets in the trace and open a regular udp/tcp socket and send the payload through that socket. </p>\n"}], "owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 172, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1528900526, "creation_date": 1527673972, "last_edit_date": 1527687518, "question_id": 50601626, "link": "https://stackoverflow.com/questions/50601626/sending-packets-to-127-0-0-1-through-gopcap", "title": "Sending packets to 127.0.0.1 through gopcap", "body": "<p>It seems that packets sent through using gopacket/gopcap are somehow 'sent' as they are visible in a tshark trace:</p>\n\n<pre><code>444 143.613451037    127.0.0.1 \u2192 127.0.0.1    UDP 66 6000 \u2192 8888 Len=22\n</code></pre>\n\n<p>but these packets never arrive on a process on the same machine listening on 127.0.0.1:8888 (for example <code>netcat -ul 8888</code>).</p>\n\n<p>Does anybody have any hints on why this is or things to try? As mentioned, the packets are in fact visible in a tshark trace... they just seem to completely vanish after that.</p>\n\n<pre><code>... irrelevant\nout , err := pcap.OpenLive(*iface, 65535, true, -1 * time.Second)\nout.WritePacketData(buf.Bytes())\n... irrevelant\n</code></pre>\n\n<p>The idea is to construct packets and send them on <code>lo</code> so that a process listening on <code>127.0.0.1:&lt;some port&gt;</code> can actually see those packets. </p>\n\n<p>IP src/dst are both 127.0.0.1 and ethernet src/dst are both 00:00:00:00:00:00. </p>\n\n<p><strong>Edit:</strong></p>\n\n<p>As far as some more research goes it seems to be the case that sending packets with pcap bypasses IP network stacks in such a way that the packets can't be seen by processes. A workaround is to strip the lower levels of the packets in the trace and open a regular udp/tcp socket and send the payload through that socket. </p>\n"}, {"tags": ["go", "struct", "null"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1527662042, "post_id": 50597713, "comment_id": 88204679, "body": "If it&#39;s an object you can unmarshall it to the <code>map[string]interface{}</code> and check if the key is in the map."}, {"owner": {"reputation": 1011, "user_id": 2969402, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a971b3c4d070d8af92b98952b702c9bb?s=128&d=identicon&r=PG&f=1", "display_name": "user2969402", "link": "https://stackoverflow.com/users/2969402/user2969402"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1527663497, "post_id": 50597713, "comment_id": 88205511, "body": "I would like to be able to use the same method to test for empty fields on nested <code>structs</code> within the <code>res</code> <code>struct</code> so unfortunately I don&#39;t think this will work."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1527665134, "post_id": 50597713, "comment_id": 88206465, "body": "Well, you simply <b>cannot</b> do this. Don&#39;t try, you can&#39;t. You have to redesign: Either use e.g. <code>*bool</code> and check for nil or use map[string]interface{} and check for existence of the key. BTW: Duplicate."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527665402, "post_id": 50597713, "comment_id": 88206656, "body": "@user2969402 there is nothing that forbids you to use the reflect package to check if a pointer field is nil or not, so if you use pointers you should be fine."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527665776, "post_id": 50597713, "comment_id": 88206893, "body": "@user2969402 here&#39;s an example: <a href=\"https://play.golang.org/p/mG1AKFp8nSP\" rel=\"nofollow noreferrer\">play.golang.org/p/mG1AKFp8nSP</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1527670273, "post_id": 50597713, "comment_id": 88209661, "body": "What is your end goal? Why do you want to do this? There&#39;s probably a better approach."}], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 4, "last_activity_date": 1527666503, "creation_date": 1527666503, "answer_id": 50599115, "question_id": 50597713, "link": "https://stackoverflow.com/questions/50597713/check-if-struct-field-is-empty/50599115#50599115", "title": "Check if struct field is empty", "body": "<p>As you've mentioned, you could use pointers. </p>\n\n<p>The <code>json</code> package can handle unmarshalling values into pointers for you. You've not included the json payload you are trying to unmarshal, or the struct you are unmarshalling into, so I've made up an example.</p>\n\n<pre><code>// json\n{\n    \"foo\": true,\n    \"number_of_foos\": 14\n}\n\n// go struct\ntype Foo struct {\n    Present bool `json:\"foo\"`\n    Num     int  `json:\"number_of_foos\"`\n}\n</code></pre>\n\n<p>Here if the keys <code>foo</code> or <code>number_of_foos</code> is missing, then as you've correctly observed, the zero value (<code>false</code>/ <code>0</code>) will be used. In general the best advice is <strong>to make use of the zero value</strong>. Create structures so that zero values of <code>false</code> are useful, rather than a pain.\nThis is not always possible, so changing the types of the fields in the <code>Foo</code> struct to be pointers will allow you to check the 3 cases you are after.</p>\n\n<ol>\n<li>Present </li>\n<li>Present and zero</li>\n<li>Missing</li>\n</ol>\n\n<p>here is the same struct with pointers:</p>\n\n<pre><code>// go struct\ntype Foo struct {\n    Present *bool `json:\"foo\"`\n    Num     *int  `json:\"number_of_foos\"`\n}\n</code></pre>\n\n<p>Now you can check for presence of the value with <code>fooStruct.Present != nil</code> and if that condition holds, you can assume that the value in the field is the one you wanted. </p>\n\n<p><em>There is no need to use the reflect package.</em></p>\n"}, {"tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": false, "score": 2, "last_activity_date": 1527691582, "creation_date": 1527691582, "answer_id": 50607611, "question_id": 50597713, "link": "https://stackoverflow.com/questions/50597713/check-if-struct-field-is-empty/50607611#50607611", "title": "Check if struct field is empty", "body": "<p>Another way of doing the same is by implementing <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>json.Unmarshaler</code></a>.</p>\n\n<pre><code>type MaybeInt struct {\n    Present bool\n    Value   int\n}\n\nfunc (i *MaybeInt) UnmarshalJSON(bs []byte) error {\n    if e := json.Unmarshal(bs, &amp;i.Value); e != nil {\n        return e\n    }\n    i.Present = true\n    return nil\n}\n</code></pre>\n\n<p>You can then use <code>MaybeInt</code> in your top-level structure:</p>\n\n<pre><code>type Top struct {\n    N MaybeInt `json:\"n\"`\n    M MaybeInt `json:\"m\"`\n}\n\nfunc main() {\n    t := Top{}\n    if e := json.Unmarshal([]byte(` { \"n\": 4930 } `), &amp;t); e != nil {\n        panic(e)\n    }\n    fmt.Println(t.N, t.M)\n}\n</code></pre>\n\n<p>See it working on the <kbd><a href=\"https://play.golang.org/p/gxtKwJJbA8n\" rel=\"nofollow noreferrer\">playground</a></kbd></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 9846426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c37a64da192d02fcec54b4b67038c96?s=128&d=identicon&r=PG&f=1", "display_name": "Rohit T", "link": "https://stackoverflow.com/users/9846426/rohit-t"}, "is_accepted": false, "score": 0, "last_activity_date": 1557421004, "last_edit_date": 1557421004, "creation_date": 1527693848, "answer_id": 50608377, "question_id": 50597713, "link": "https://stackoverflow.com/questions/50597713/check-if-struct-field-is-empty/50608377#50608377", "title": "Check if struct field is empty", "body": "<p>Try using the golang validator package. The validator package offers a <strong>required</strong> attribute that might do the required job for your need. The <a href=\"https://godoc.org/gopkg.in/go-playground/validator.v9\" rel=\"nofollow noreferrer\">official documentation</a> for required attribute states:</p>\n\n<blockquote>\n  <p>This validates that the value is not the data types default zero value. For numbers ensures value is not zero. For strings ensures value is not <code>\"\"</code>. For slices, maps, pointers, interfaces, channels and functions ensures the value is not nil.</p>\n</blockquote>\n\n<p>The example illustrating the same can be seen at:  <a href=\"https://github.com/go-playground/validator/blob/v9/_examples/struct-level/main.go\" rel=\"nofollow noreferrer\">https://github.com/go-playground/validator/blob/v9/_examples/struct-level/main.go</a>.</p>\n\n<p>Hope this solves your requirement.</p>\n"}], "owner": {"reputation": 1011, "user_id": 2969402, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a971b3c4d070d8af92b98952b702c9bb?s=128&d=identicon&r=PG&f=1", "display_name": "user2969402", "link": "https://stackoverflow.com/users/2969402/user2969402"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12090, "favorite_count": 2, "answer_count": 3, "score": 3, "last_activity_date": 1557421004, "creation_date": 1527661777, "question_id": 50597713, "link": "https://stackoverflow.com/questions/50597713/check-if-struct-field-is-empty", "title": "Check if struct field is empty", "body": "<p>I would like to iterate over the fields of a <code>struct</code> after unmarshalling a JSON object into it and check for the fields whose value was not set (i.e. are empty).</p>\n\n<p>I can get the value of each field and compare that to the <code>reflect.Zero</code> value for the corresponding type</p>\n\n<pre><code>json.Unmarshal([]byte(str), &amp;res)\ns := reflect.ValueOf(&amp;res).Elem()\ntypeOfT := s.Type()\nfor i := 0; i &lt; s.NumField(); i++ {\n    f := s.Field(i)\n    v := reflect.ValueOf(f.Interface())\n    if (reflect.DeepEqual(v.Interface(), reflect.Zero(v.Type()).Interface())) {\n    ....\n</code></pre>\n\n<p>But the problem, of course, is that this will not work well for <code>bool</code> or <code>int</code> values.\nIf a <code>bool</code> field is set to <code>false</code> in the JSON or an <code>int</code> field is set to <code>0</code>, they will be equal to the zero value of their type. The aforementioned check will consider the fields to be uninitialized, even though they actually have a value set.</p>\n\n<p>I know one way around this is to use pointers, but I just don't see how that would be possible in this case as I'm working with <code>reflect.Value</code> types, not the actual <code>struct</code>.</p>\n"}, {"tags": ["go", "coding-style"], "comments": [{"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 7, "creation_date": 1527660536, "post_id": 50597261, "comment_id": 88203908, "body": "The readability of your code is awful.  I don&#39;t think your use of anonymous functions is very clear nor tidy here, but it really is opinion based, so I&#39;m voting to close.  Additionally, what do you <i>think</i> happens when you lock on <code>s</code> in your first anonymous functional?  Are you sure you understand how <code>defer</code> works?"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1527661102, "post_id": 50597261, "comment_id": 88204211, "body": "I don&#39;t see what you are trying to do here even if you had written the code without the func() (which has only s.Lock and a deferred s.Unlock) it would have worked the same way, see <a href=\"https://play.golang.org/p/U18AkCwrAOB\" rel=\"nofollow noreferrer\">play.golang.org/p/U18AkCwrAOB</a>"}, {"owner": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "edited": false, "score": 0, "creation_date": 1527662074, "post_id": 50597261, "comment_id": 88204693, "body": "Sorry, I&#39;ve edited my question. At first it&#39;s don&#39;t explain why I do this"}, {"owner": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "reply_to_user": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 0, "creation_date": 1527662155, "post_id": 50597261, "comment_id": 88204726, "body": "@LukeJoshuaPark, sorry my bad, that first and third anonymous function is not an empty function. What i want to achieve is to lock as short as possible, because defer only completed when the func return"}, {"owner": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1527662197, "post_id": 50597261, "comment_id": 88204745, "body": "@Ravi, sorry my bad, that function is not empty function, I forgot to say that in question"}, {"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 0, "creation_date": 1527662269, "post_id": 50597261, "comment_id": 88204777, "body": "You understand that s does not have a lock on it at the <code>&#47;&#47; do something else</code> line, right?"}, {"owner": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "reply_to_user": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 0, "creation_date": 1527662400, "post_id": 50597261, "comment_id": 88204847, "body": "@LukeJoshuaPark, yes, I know that. Actually, that is what I want."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1527662942, "post_id": 50597261, "comment_id": 88205168, "body": "How does it make a difference if all the code inside your function were outside (minus the defer) - it&#39;ll work the same way. Also you should probably look at making the http calls in different go routines and then stream the results back using a channel, waiting for all the results to be accumulated. You can use the same http.Client (see <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http</a>)"}, {"owner": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1527663317, "post_id": 50597261, "comment_id": 88205413, "body": "thanks @Ravi, see <a href=\"https://stackoverflow.com/questions/50597261/golang-it-is-okay-to-use-many-anonymous-function?noredirect=1#comment88205364_50597501\" title=\"golang it is okay to use many anonymous function\">stackoverflow.com/questions/50597261/&hellip;</a>"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1527674403, "post_id": 50597261, "comment_id": 88212631, "body": "Continuing on what I mentioned earlier, it may be safer to use <code>http.Client</code> than calling <code>http.Get</code>, see <a href=\"https://medium.com/@nate510/don-t-use-go-s-default-http-client-4804cb19f779\" rel=\"nofollow noreferrer\">medium.com/@nate510/&hellip;</a> As such this has nothing to do with what you originally asked, but it&#39;s something one would better know."}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "edited": false, "score": 0, "creation_date": 1527662044, "post_id": 50597501, "comment_id": 88204681, "body": "I&#39;ve edited my question. So what about if I want to do another HTTP GET, that second HTTP GET will create TCP connection because old one is not considered complete yet (body is not closed yet)"}, {"owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "reply_to_user": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "edited": false, "score": 0, "creation_date": 1527662626, "post_id": 50597501, "comment_id": 88204993, "body": "Sounds like a code structure problem that anonymous functions would only muddle up. Each request could/should be in their own named function and you can do a defer and have only one connection. If you really want you could just Close the request without doing a defer, but where&#39;s the fun in that?"}, {"owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "reply_to_user": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "edited": false, "score": 0, "creation_date": 1527662899, "post_id": 50597501, "comment_id": 88205146, "body": "The short answer is for years I&#39;ve used very few anonymous functions in Go. In your situations you abstractly do ThingA in an anonymous function, you do a web request, then you do some other ThingB. I&#39;d make those 3 different functions and think through their accessibility."}, {"owner": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "edited": false, "score": 0, "creation_date": 1527663234, "post_id": 50597501, "comment_id": 88205364, "body": "thanks @corey-ogburn , that is what I think first, decompose it into multiple functions, but sometimes I stumbled with naming that function, haha"}], "tags": [], "owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "is_accepted": false, "score": 0, "last_activity_date": 1527661493, "last_edit_date": 1527661493, "creation_date": 1527660898, "answer_id": 50597501, "question_id": 50597261, "link": "https://stackoverflow.com/questions/50597261/is-it-okay-to-use-many-anonymous-functions/50597501#50597501", "title": "Is it okay to use many anonymous functions?", "body": "<p>Due to your anonymous functions to <code>Lock</code> and <code>Unlock</code> you'll enter the anonymous function, lock, defer an unlock, leave the anonymous function triggering the deferred unlock, and then continue <code>abc()</code>. The beginning and ending anonymous functions are pretty much useless.</p>\n\n<p>Your middle anonymous function is bad style for any language. There's no reason to just not do the code and respond to any returned errors.</p>\n\n<p>I would rewrite this function as follows:</p>\n\n<pre><code>func (s *Something) abc() error {\n    s.Lock()\n    defer s.Unlock()\n\n    resp, err := http.Get(\"https://example.com/api\")\n    if err != nil {\n            return err\n    }\n    defer resp.Body.Close()\n    if resp.StatusCode != 200 {\n            return errors.New(\"Failed to download\")\n    }\n    // This struct should probably be global\n    var tmp struct {\n            Error bool    `json:\"error\"`\n            Result string `json:\"result\"`\n    }\n    err = json.NewDecoder(resp.Body).Decode(&amp;tmp)\n    if err != nil {\n            return err\n    }\n    if tmp.Error {\n            return errors.New(\"API return error\")\n    }\n    s.somedata = tmp.result\n    return nil\n}\n</code></pre>\n\n<p>Anonymous functions have their place. I've used them for closures as well as extremely concise go routines. One place you might use an anonymous function here is to log an error returned by <code>resp.Body.Close()</code> like so:</p>\n\n<pre><code>defer func() {\n    err = resp.Body.Close()\n    log.Printf(\"error closing API response body: %s\", err)\n}()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "edited": false, "score": 0, "creation_date": 1527670417, "post_id": 50599459, "comment_id": 88209756, "body": "Thanks, the last paragraph is what I want to know."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 2, "last_activity_date": 1527667621, "creation_date": 1527667621, "answer_id": 50599459, "question_id": 50597261, "link": "https://stackoverflow.com/questions/50597261/is-it-okay-to-use-many-anonymous-functions/50599459#50599459", "title": "Is it okay to use many anonymous functions?", "body": "<p>You're correct in the observation that <code>defer</code> only works in function scope, I think that the problem you are running into is nothing to do with the behaviour of <code>defer</code>.</p>\n\n<p>In general it's [insert opinion] better to have smaller functions, then you would not need to create anonymous functions to maximise the usage of <code>defer</code>.</p>\n\n<p>Splitting up your example, something like this might be better:</p>\n\n<pre><code>// Public method that does locking orchestration\nfunc (s *Something) PublicDoABC() error {\n    s.doWorkStart()\n    if err := s.populateSomeData(); err != nil {\n        return err\n    }\n    s.doWorkEnd()\n    return nil\n}\n\n// setup function with locking\nfunc (s *Something) doWorkStart() {\n    s.Lock()\n    defer s.Unlock()\n\n    // do setup work here\n}\n\n// teardown function with locking\nfunc (s *Something) doWorkEnd() {\n    s.Lock()\n    defer s.Unlock()\n\n    // do teardown work here\n}\n\n// do the actual request\nfunc (s *Something) populateSomeData() error {\n    resp, err := http.Get(\"https://example.com/api\")\n    if err != nil {\n        return err\n    }\n    defer resp.Body.Close()\n    if resp.StatusCode != 200 {\n        return errors.New(\"Failed to download\")\n    }\n    var tmp struct {\n        Error bool    `json:\"error\"`\n        Result string `json:\"result\"`\n    }\n    if err := json.NewDecoder(resp.Body).Decode(&amp;tmp); err != nil {\n        return err\n    }\n    if tmp.Error {\n        return errors.New(\"API return error\")\n    }\n    s.somedata = tmp.Result\n    return nil\n}\n</code></pre>\n\n<p>I know this changes things, and you might not want to split out the body of the function, you could define a method on <code>Something</code> that allows arbitrary functions to be executed with locking:</p>\n\n<pre><code>func (s *Something) PublicDoABC() error {\n    s.executeLocked(func() {\n        // do setup work\n    })\n    if err := s.populateSomeData(); err != nil {\n        return err\n    }\n\n    s.executeLocked(func() {\n        // do teardown work\n    })\n\n    return nil\n}\n\n// this function allows defer unlocks and unifies locking code\nfunc (s *Something) executeLocked(f func()) {\n    s.Lock()\n    defer s.Unlock()\n    f()\n}\n</code></pre>\n\n<p><strong>To answer the original question</strong>: No, I do not believe this is that common (having multiple inline anon function). If it feels wrong, there's almost certainly a better way of doing it.</p>\n"}], "owner": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "closed_date": 1527693714, "accepted_answer_id": 50599459, "answer_count": 2, "score": 0, "last_activity_date": 1527669371, "creation_date": 1527659795, "last_edit_date": 1527669371, "question_id": 50597261, "link": "https://stackoverflow.com/questions/50597261/is-it-okay-to-use-many-anonymous-functions", "closed_reason": "Opinion-based", "title": "Is it okay to use many anonymous functions?", "body": "<p>One thing I love from golang is <code>defer</code> statement, but <code>defer</code> only work on <code>func</code> scope.</p>\n\n<p>So, I very often to use it like this</p>\n\n<pre><code>func (s *Something) abc() error {\n    func() {\n        s.Lock()\n        defer s.Unlock()\n        // don't lock too long\n    }()\n    // do something else\n    if err := func() error {\n        resp, err := http.Get(\"https://example.com/api\")\n        if err != nil {\n            return err\n        }\n        defer resp.Body.Close()\n        if resp.StatusCode != 200 {\n            return errors.New(\"Failed to download\")\n        }\n        var tmp struct {\n            Error bool    `json:\"error\"`\n            Result string `json:\"result\"`\n        }\n        if err := json.NewDecoder(resp.Body).Decode(&amp;tmp); err != nil {\n            return err\n        }\n        if tmp.Error {\n            return errors.New(\"API return error\")\n        }\n        s.somedata = tmp.result\n        return nil\n    }(); err != nil {\n        return err\n    }\n    func() {\n        s.Lock()\n        defer s.Unlock()\n        // don't lock too long\n    }()\n    // do something else\n}\n</code></pre>\n\n<p>basically, I wrap it into anonymous block <code>func</code>.</p>\n\n<p>Is it common to use something like this? do any other gophers abuse this fact?</p>\n\n<p>EDIT: Clarification</p>\n\n<p>Okay, it looks like I didn't explain it well,\nThere are 2 things I want to achieve</p>\n\n<ol>\n<li><p>What I want to achieve is to lock mutex as short as possible</p>\n\n<pre><code>func() {\n    s.Lock()\n    defer s.Unlock()\n    // don't lock too long\n\n    // there is other code here, this func is not an empty func\n}()\n</code></pre></li>\n<li><p>There more than one http.Get in this function, let's say after calling example.com/api I need to call example.com/api2 . We need to close resp.Body as soon as possible, so only one TCP connection is made to this server. AFAIK, http.Get will create another TCP connection if there is another HTTP connection that not closed yet (resp.Body.Close() is not called on previous response).</p></li>\n</ol>\n\n<p>EDIT 2: more clarification</p>\n\n<p>first and last anonymous function and lock are to sync cache. I implement cache based on map[string]string, so it needs to be sync-ed.</p>\n\n<p>I need to call example.com/api first, and based on the response I need to call example.com/api2 or example.com/api3, and at that time previous http connection must be closed, it can be code like this</p>\n\n<pre><code>resp, err := http.Get(\"https://example.com/api\")\nif err != nil {\n    return err\n}\nif resp.StatusCode != 200 {\n    resp.Body.Close()\n    return errors.New(\"Failed to download\")\n}\n// process the body\nresp.Body.Close()\n</code></pre>\n\n<p>but you need to explicitly write resp.Body.Close() twice</p>\n"}, {"tags": ["go", "mutex", "gob"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1527647987, "post_id": 50595570, "comment_id": 88200352, "body": "There&#39;s an open issue on this problem:  <a href=\"https://github.com/golang/go/issues/5819\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/5819</a>"}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1527650897, "post_id": 50595570, "comment_id": 88201001, "body": "Gotcha. One follow up question: when I read back a Dog object from a gob, it looks like the mutex is unlocked regardless of the state of the mutex when it was saved to a gob. Is this behavior I can count on?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527693873, "post_id": 50595570, "comment_id": 88226487, "body": "You should not count on a deserialized mutex at all. It&#39;s conceptually pointless - whatever process serialized it can&#39;t be assumed to be the same running process that&#39;s deserialized it, so the mutex is meaningless. It should not be included in the serialization."}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527698538, "post_id": 50595570, "comment_id": 88229156, "body": "@Adrian so what is the best practice here? I need to serialize an object than contains a mutex field, but it looks like there&#39;s no way to specify that gob should ignore a field: <a href=\"https://stackoverflow.com/questions/50595570/go-error-gob-type-sync-mutex-has-no-exported-fields\" title=\"go error gob type sync mutex has no exported fields\">stackoverflow.com/questions/50595570/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 11022, "user_id": 317916, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/21dda5ab7f19b2cf21502358eb0410e1?s=128&d=identicon&r=PG", "display_name": "cbednarski", "link": "https://stackoverflow.com/users/317916/cbednarski"}, "is_accepted": false, "score": 1, "last_activity_date": 1558468257, "creation_date": 1558468257, "answer_id": 56245469, "question_id": 50595570, "link": "https://stackoverflow.com/questions/50595570/go-error-gob-type-sync-mutex-has-no-exported-fields/56245469#56245469", "title": "Go error: gob: type sync.Mutex has no exported fields", "body": "<h2>Gob Encoding</h2>\n\n<blockquote>\n  <p>Everything seems to work if I make the mutex unexported (by not capitalizing it). I'm curious to understand why this is.</p>\n</blockquote>\n\n<p>As <a href=\"https://stackoverflow.com/questions/50595570/go-error-gob-type-sync-mutex-has-no-exported-fields#comment88200352_50595570\">Cerise mentioned</a> there is an <a href=\"https://github.com/golang/go/issues/5819\" rel=\"nofollow noreferrer\">open issue</a> for this, but in short it is normally a programming error if you try to encode a struct (such as a mutex) which has no exported fields.</p>\n\n<p>There are some ways to work around this particular problem, though.</p>\n\n<p>You can make the mutex private and wrap the lock/unlock in a public function, rather than reaching into the struct to manipulate the mutex. E.g.</p>\n\n<pre><code>func (d *Dog) SetName(name string) {\n    d.GobMux.Lock()\n    d.Name = name\n    d.GobMux.Unlock()\n}\n</code></pre>\n\n<p>You can also wrap the type and pull the mutex out:</p>\n\n<pre><code>type Dog struct {\n    Name string\n}\n\ntype DogWrapper struct {\n    Dog *Dog\n    GobMux sync.Mutex\n}\n</code></pre>\n\n<p>This is fairly cumbersome if you have many small structs but for a smaller number of more complex structs it might be OK.</p>\n\n<p>Finally, the \"correct\" way to solve this problem is to write your own GobEncode/Decode routines. There are some sparse examples in the stdlib, such as time.GobEncode, but generally this seems like quite a bit of work.</p>\n\n<h2>Mutexes in General</h2>\n\n<blockquote>\n  <p>...and make sure that there's no other issue with gobbing an unexported sync.Mutex.</p>\n</blockquote>\n\n<p>Mutexes are tightly coupled to the Go runtime's in-process memory and scheduler. They help the Go runtime decide which goroutines are allowed to read or write to a particular part of memory, and also decide when those goroutines may be scheduled (i.e. a goroutine waiting on a mutex to unlock will not be scheduled until the mutex is unlocked).</p>\n\n<p>If you use Gob to copy a data structure to another process, the recipient process's runtime has completely different internal state compared to the process that is sending the gob, and as such the mutex cannot be logically transferred. Copying a mutex to another process would be a bit like using Earth GPS coordinates on Mars. They just don't match up.</p>\n\n<blockquote>\n  <p>when I read back a Dog object from a gob, it looks like the mutex is unlocked regardless of the state of the mutex when it was saved to a gob. Is this behavior I can count on? </p>\n</blockquote>\n\n<p>As the <a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"nofollow noreferrer\">documentation for Mutex</a> states, \"The zero value for a Mutex is an unlocked mutex.\" So yes, you can rely on this behavior.</p>\n\n<h2>Other Encoders</h2>\n\n<p>In my opinion, despite gob's presence in the stdlib, it does not receive much attention because there are many other mature encoding options available. If gob doesn't meet your needs there are many other options available -- JSON, Cap'n Proto, net/rpc, etc. with different characteristics that may work better for you.</p>\n"}], "owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1674, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1558468257, "creation_date": 1527647504, "last_edit_date": 1527682306, "question_id": 50595570, "link": "https://stackoverflow.com/questions/50595570/go-error-gob-type-sync-mutex-has-no-exported-fields", "title": "Go error: gob: type sync.Mutex has no exported fields", "body": "<p>I am having an issue where I can't save a struct as a gob if it has an exported <code>sync.Mutex</code>. Everything seems to work if I make the mutex unexported (by not capitalizing it). I'm curious to understand why this is and make sure that there's no other issue with gobbing an unexported <code>sync.Mutex</code>.</p>\n\n<p>I see that there are several hits on Google for a related problem with <code>sync.RWMutex</code>, but none really explain why this happens. </p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    \"encoding/gob\"\n    \"os\"\n    \"fmt\"\n)\n\nfunc writeGob(filePath string, object interface{}) error {\n    file, err := os.Create(filePath)\n    defer file.Close()\n\n    if err != nil {\n        return err\n    }\n\n    encoder := gob.NewEncoder(file)\n    err = encoder.Encode(object)\n    return err\n}\n\ntype Dog struct {\n    Name string\n    GobMux sync.Mutex\n}\n\nfunc main() {\n    d := &amp;Dog{Name: \"Fido\"}\n    err := writeGob(\"./gob\", d)\n    fmt.Printf(\"Error: %v\\n\", err)\n}\n</code></pre>\n\n<p>Output: </p>\n\n<blockquote>\n  <p>Error: gob: type sync.Mutex has no exported fields</p>\n</blockquote>\n"}, {"tags": ["validation", "go", "kubernetes", "kubernetes-go-client"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1527615415, "post_id": 50589703, "comment_id": 88189213, "body": "Why don&#39;t you just <a href=\"https://godoc.org/k8s.io/client-go\" rel=\"nofollow noreferrer\">read the docs</a> yourself, or <a href=\"https://github.com/kubernetes/client-go/blob/2f45bcbf57f0cfde510a33e7d94a4c89955ff17b/tools/clientcmd/validation.go#L103-L130\" rel=\"nofollow noreferrer\">read the source</a>?"}, {"owner": {"reputation": 41, "user_id": 3600364, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a84df1c1b455638d4c1b1165d3ea349c?s=128&d=identicon&r=PG&f=1", "display_name": "CR7", "link": "https://stackoverflow.com/users/3600364/cr7"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527616048, "post_id": 50589703, "comment_id": 88189530, "body": "I have read the docs and haven&#39;t seen anything hence why I&#39;m asking... The validation.go file you linked is for your cluster configuration, not apps."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527617680, "post_id": 50589703, "comment_id": 88190381, "body": "Fine. You can search the rest of the source code as easily as anyone."}], "answers": [{"tags": [], "owner": {"reputation": 2002, "user_id": 9524052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Artem Golenyaev", "link": "https://stackoverflow.com/users/9524052/artem-golenyaev"}, "is_accepted": false, "score": 0, "last_activity_date": 1527672774, "creation_date": 1527672774, "answer_id": 50601203, "question_id": 50589703, "link": "https://stackoverflow.com/questions/50589703/does-the-kubernetes-client-go-library-contain-a-function-for-validating-json-yam/50601203#50601203", "title": "Does the Kubernetes client-go library contain a function for validating json/yaml files?", "body": "<p>Client-go library for Kubernetes contains no validation functions for YAML/JSON configuration files.</p>\n\n<p>But take a look at this <a href=\"https://github.com/garethr/kubeval\" rel=\"nofollow noreferrer\">utiliy</a>, you can use it for validation on a client\u2019s side and also use its code as an example of validation implementation.</p>\n"}], "owner": {"reputation": 41, "user_id": 3600364, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a84df1c1b455638d4c1b1165d3ea349c?s=128&d=identicon&r=PG&f=1", "display_name": "CR7", "link": "https://stackoverflow.com/users/3600364/cr7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 583, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1527672774, "creation_date": 1527614270, "last_edit_date": 1527615771, "question_id": 50589703, "link": "https://stackoverflow.com/questions/50589703/does-the-kubernetes-client-go-library-contain-a-function-for-validating-json-yam", "title": "Does the Kubernetes client-go library contain a function for validating json/yaml files?", "body": "<p>I'd like to know if the client-go library for Kubernetes contains a function that validates if a json/yaml file. Ideally, it would catch errors such as names not being a DNS-1123 compliant or invalid fields specified. It would also be ideal if a list of errors was returned as opposed to the function returning after the first error encountered. </p>\n\n<p>One thought I have tried is doing an exec to call <code>kubectl --validate --dry-run</code> but this does not fully validate a manifest (meaning it's possible to pass here but fail when you actually apply the file). It also stops at the first error. Plus, it would get expensive quickly if you have a list of manifests to go through.</p>\n\n<p>Another option I looked at was here <a href=\"https://github.com/kubernetes/client-go/issues/193\" rel=\"nofollow noreferrer\">Kubernetes GitHub Issue 193</a> but that's not really the appropriate function nor does it do the checks I'm looking for. </p>\n"}, {"tags": ["go", "buffer"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1527613622, "post_id": 50589470, "comment_id": 88188417, "body": "which line is not printing. Because I have tried that code in windows and it is printing upto <code>test-9</code>. Are you getting any error. If so, Please post it here."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1527613709, "post_id": 50589470, "comment_id": 88188456, "body": "@Himanshu: How are you running that on Windows? <code>&#47;dev</code> doesn&#39;t exist on Windows."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527613805, "post_id": 50589470, "comment_id": 88188503, "body": "yes @Flimzy, I have changed the path when creating a file. So basically I have written to a file."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1527614027, "post_id": 50589470, "comment_id": 88188603, "body": "I think that invalidates the test. I believe the OP&#39;s problem has to do with waiting for the attached lp0 device to flush its buffers before the program exits."}, {"owner": {"reputation": 9, "user_id": 5876873, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-sCSuHmsbFps/AAAAAAAAAAI/AAAAAAAAZXo/w3gys92iCjY/photo.jpg?sz=128", "display_name": "Thomas Heute", "link": "https://stackoverflow.com/users/5876873/thomas-heute"}, "edited": false, "score": 0, "creation_date": 1527618506, "post_id": 50589470, "comment_id": 88190792, "body": "It&#39;s on Linux, on 2 machines, my laptop and a Raspberry Pi. The last line test-9 doesn&#39;t show, but on other scenarios it stops at any place &quot;randomly&quot;. Writing to a &quot;real&quot; file works just fine"}, {"owner": {"reputation": 9, "user_id": 5876873, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-sCSuHmsbFps/AAAAAAAAAAI/AAAAAAAAZXo/w3gys92iCjY/photo.jpg?sz=128", "display_name": "Thomas Heute", "link": "https://stackoverflow.com/users/5876873/thomas-heute"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527618611, "post_id": 50589470, "comment_id": 88190851, "body": "@Flimzy yes something like that, but in my original program it doesn&#39;t exit and it works if I add a 5s sleep before the end of the method"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1527618667, "post_id": 50589470, "comment_id": 88190877, "body": "I would say that should not make any difference as the LP device should just block the writer. But in order to prove or disprove this please <i>add error handling</i> first. Any of the method calls on <code>w</code> may legitimately return non-<code>nil</code> error (and <code>f.Sync()</code>, too), and you&#39;re ignoring them all."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1527618939, "post_id": 50589470, "comment_id": 88191014, "body": "Start with something like <a href=\"https://play.golang.org/p/_cEyYCtGZZ3\" rel=\"nofollow noreferrer\">play.golang.org/p/_cEyYCtGZZ3</a> to replace your <code>w.WriteString</code> calls. That&#39;s not something you should use in production but is okay for such PoC/debugging code."}, {"owner": {"reputation": 9, "user_id": 5876873, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-sCSuHmsbFps/AAAAAAAAAAI/AAAAAAAAZXo/w3gys92iCjY/photo.jpg?sz=128", "display_name": "Thomas Heute", "link": "https://stackoverflow.com/users/5876873/thomas-heute"}, "edited": false, "score": 0, "creation_date": 1527619452, "post_id": 50589470, "comment_id": 88191271, "body": "I didn&#39;t put the error handling to keep it shorter but here is the code with it and shows no error"}, {"owner": {"reputation": 9, "user_id": 5876873, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-sCSuHmsbFps/AAAAAAAAAAI/AAAAAAAAZXo/w3gys92iCjY/photo.jpg?sz=128", "display_name": "Thomas Heute", "link": "https://stackoverflow.com/users/5876873/thomas-heute"}, "edited": false, "score": 0, "creation_date": 1527620349, "post_id": 50589470, "comment_id": 88191725, "body": "PS I added a few lines to print and it stops at the same place. If I move the code to a new func and add <code>time.Sleep(5 * time.Second)</code> at the end of the func then I get all the text, but if I call my func and then do the Sleep in the <code>main</code> then it stops printing after the test-8 without any error..."}, {"owner": {"reputation": 9, "user_id": 5876873, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-sCSuHmsbFps/AAAAAAAAAAI/AAAAAAAAZXo/w3gys92iCjY/photo.jpg?sz=128", "display_name": "Thomas Heute", "link": "https://stackoverflow.com/users/5876873/thomas-heute"}, "edited": false, "score": 0, "creation_date": 1527620695, "post_id": 50589470, "comment_id": 88191881, "body": "(No I was right...) When I compile with 1.7.4 it works, when I compile with 1.9.6 it fails... I will try 1.10 and try to figure out when it broke..."}, {"owner": {"reputation": 9, "user_id": 5876873, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-sCSuHmsbFps/AAAAAAAAAAI/AAAAAAAAZXo/w3gys92iCjY/photo.jpg?sz=128", "display_name": "Thomas Heute", "link": "https://stackoverflow.com/users/5876873/thomas-heute"}, "edited": false, "score": 0, "creation_date": 1527621442, "post_id": 50589470, "comment_id": 88192232, "body": "I can confirm, it works until version 1.8.7 and then fails on v1.9 v1.9.6 and v1.10.2 (I tried multiple times those versions)."}, {"owner": {"reputation": 9, "user_id": 5876873, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-sCSuHmsbFps/AAAAAAAAAAI/AAAAAAAAZXo/w3gys92iCjY/photo.jpg?sz=128", "display_name": "Thomas Heute", "link": "https://stackoverflow.com/users/5876873/thomas-heute"}, "edited": false, "score": 2, "creation_date": 1527622783, "post_id": 50589470, "comment_id": 88192841, "body": "I opened a bug report <a href=\"https://github.com/golang/go/issues/25631\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/25631</a>"}], "owner": {"reputation": 9, "user_id": 5876873, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-sCSuHmsbFps/AAAAAAAAAAI/AAAAAAAAZXo/w3gys92iCjY/photo.jpg?sz=128", "display_name": "Thomas Heute", "link": "https://stackoverflow.com/users/5876873/thomas-heute"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 385, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1527619655, "creation_date": 1527613247, "last_edit_date": 1527619655, "question_id": 50589470, "link": "https://stackoverflow.com/questions/50589470/wait-until-io-buffer-is-fully-written-in-golang", "title": "Wait until IO Buffer is fully written in GoLang", "body": "<p>I'm using a printer (ESC POS) that prints text when data is written on /dev/usb/lp0</p>\n\n<p>The simplified code is:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"os\"\n)\n\nfunc main() {\n\n    f, err := os.Create(\"/dev/usb/lp0\")\n\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n\n    w := bufio.NewWriter(f)\n\n    w.Write([]byte(\"\\x1B@\"))\n    w.WriteString(\"test-1\\n\")\n    w.WriteString(\"test-2\\n\")\n    w.WriteString(\"test-3\\n\")\n    w.WriteString(\"test-4\\n\")\n    w.WriteString(\"test-5\\n\")\n    w.WriteString(\"test-6\\n\")\n    w.WriteString(\"test-7\\n\")\n    w.WriteString(\"test-8\\n\")\n    w.WriteString(\"test-9\\n\")\n\n    w.Flush()\n    f.Sync()\n}\n</code></pre>\n\n<p>and most of the time the last line is not printed, unless I add a timer at the very end.</p>\n\n<p>I think I closed everything properly, so not sure what's going on here... If I write to a file, it works fine BTW, luck ?</p>\n\n<p>Thank you in advance, I spend last evening on this and it is driving me crazy :)</p>\n\n<p>EDIT: Code with error handling (f.Sync() actually failed and I removed it)</p>\n\n<pre><code>    package main\n\nimport (\n    \"bufio\"\n    \"os\"\n)\n\nfunc main() {\n\n    f, err := os.Create(\"/dev/usb/lp0\")\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n\n    w := bufio.NewWriter(f)\n\n    _, err = w.Write([]byte(\"\\x1B@\"))\n    if err != nil {\n        panic(err)\n    }\n    _, err = w.WriteString(\"toto-1\\n\")\n    if err != nil {\n        panic(err)\n    }\n    _, err = w.WriteString(\"toto-2\\n\")\n    if err != nil {\n        panic(err)\n    }\n    _, err = w.WriteString(\"toto-3\\n\")\n    if err != nil {\n        panic(err)\n    }\n    _, err = w.WriteString(\"toto-4\\n\")\n    if err != nil {\n        panic(err)\n    }\n    _, err = w.WriteString(\"toto-5\\n\")\n    if err != nil {\n        panic(err)\n    }\n    _, err = w.WriteString(\"toto-6\\n\")\n    if err != nil {\n        panic(err)\n    }\n    _, err = w.WriteString(\"toto-7\\n\")\n    if err != nil {\n        panic(err)\n    }\n    _, err = w.WriteString(\"toto-8\\n\")\n    if err != nil {\n        panic(err)\n    }\n    _, err = w.WriteString(\"toto-9\\n\")\n    if err != nil {\n        panic(err)\n    }\n    err = w.Flush()\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 5, "creation_date": 1527611957, "post_id": 50589143, "comment_id": 88187586, "body": "It&#39;s not <i>needed</i>. It&#39;s just a demonstration of how goroutines work. You would never actually use a goroutine for something so simple in a real application."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1527611983, "post_id": 50589143, "comment_id": 88187600, "body": "They aren&#39;t &quot;needed&quot;, it&#39;s a demonstration of how to use them. The reason it fails without them is the send blocks forever because there&#39;s no other routine sending."}], "answers": [{"tags": [], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "is_accepted": false, "score": 1, "last_activity_date": 1527618097, "creation_date": 1527618097, "answer_id": 50590631, "question_id": 50589143, "link": "https://stackoverflow.com/questions/50589143/explanation-on-why-go-routines-are-needed-in-gotour-concurency-tutorial/50590631#50590631", "title": "Explanation on why go routines are needed in gotour concurency tutorial", "body": "<p>Others have already pointed out in the comments that in terms of being an <em>example</em>, you obviously don't need to write this program with channels. </p>\n\n<p>From your question, though, it sounds like you're curious about why separate goroutines are needed <em>in order for the program to run</em>. </p>\n\n<p>To answer that, it might be helpful to think about how this might work in a world where you were only thinking about threads. You've got your main thread, and that thread invokes <code>sum(s[:len(s)/2], c)</code>. So now the main thread gets to the <code>c &lt;- sum</code> line in <code>sum</code>, and it blocks, because the channel is <em>unbuffered</em> - meaning there must be another listening thread to \"take\" from that channel in order for our main thread to put something into it. In other words, the threads are passing messages directly to each other, but there's no second thread to pass to. Deadlock!</p>\n\n<p>In this context, goroutines and threads are functionally equivalent. So without a second goroutine, you've got your main goroutine calling...but nobody's picking up the telephone on the other end. </p>\n"}], "owner": {"reputation": 93, "user_id": 5960219, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--cKaHbu1SCo/AAAAAAAAAAI/AAAAAAAAAOg/3dOfBK9WDO4/photo.jpg?sz=128", "display_name": "debola Akeredolu", "link": "https://stackoverflow.com/users/5960219/debola-akeredolu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1527626352, "creation_date": 1527611893, "last_edit_date": 1527626352, "question_id": 50589143, "link": "https://stackoverflow.com/questions/50589143/explanation-on-why-go-routines-are-needed-in-gotour-concurency-tutorial", "title": "Explanation on why go routines are needed in gotour concurency tutorial", "body": "<p>I'm having trouble understanding the use of goroutines and channels in the tour of go. Referencing the code below from:</p>\n\n<p>\"<a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/2</a>\"</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc sum(s []int, c chan int) {\n    sum := 0\n    for _, v := range s {\n        sum += v\n    }\n    c &lt;- sum // send sum to c\n}\n\nfunc main() {\n    s := []int{7, 2, 8, -9, 4, 0}\n\n    c := make(chan int)\n    go sum(s[:len(s)/2], c)\n    go sum(s[len(s)/2:], c)\n    x, y := &lt;-c, &lt;-c // receive from c\n\n    fmt.Println(x, y, x+y)\n}\n</code></pre>\n\n<p>It runs the sum functions using goroutines with the 'go' keyword in front of them, but all they do is send in values to a channel. They shouldn't have to be run with go routines. However, when removing the go keyword to run the functions as normal I get this error:</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan send]:\nmain.sum(0xc420059f10, 0x3, 0x6, 0xc420088060)\n    /tmp/compile33.go:10 +0x5a\nmain.main()\n    /tmp/compile33.go:17 +0x99\n</code></pre>\n\n<p>I can't understand why goroutines are needed here. I might be misunderstanding the concept and would appreciate if anyone more familiar with go could shed some light.</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["go", "webserver"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527611105, "post_id": 50588831, "comment_id": 88187156, "body": "<i>Many good questions generate some degree of opinion based on expert experience, but answers to this question will tend to be almost entirely based on opinions, rather than facts, references, or specific expertise.</i>"}, {"owner": {"reputation": 324, "user_id": 5303880, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/ZsOHd.jpg?s=128&g=1", "display_name": "Arpit Agarwal", "link": "https://stackoverflow.com/users/5303880/arpit-agarwal"}, "edited": false, "score": 0, "creation_date": 1527661932, "post_id": 50588831, "comment_id": 88204635, "body": "Your code is wrong at some point wouldn&#39;t this line <code>func (db *DB) CreateUser</code> be <code>func (db *UserStore) CreateUser</code>"}], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 6276257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7dec81a543c7f8e032db33f8a0fcba89?s=128&d=identicon&r=PG&f=1", "display_name": "AlexManning", "link": "https://stackoverflow.com/users/6276257/alexmanning"}, "edited": false, "score": 0, "creation_date": 1527737148, "post_id": 50615213, "comment_id": 88242262, "body": "Thank you, this was extremely helpful."}], "tags": [], "owner": {"reputation": 1912, "user_id": 2734070, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/7434b51d97c06de064b6698e2e97b86f?s=128&d=identicon&r=PG&f=1", "display_name": "Trevor Hutto", "link": "https://stackoverflow.com/users/2734070/trevor-hutto"}, "is_accepted": true, "score": 1, "last_activity_date": 1527768028, "last_edit_date": 1527768028, "creation_date": 1527728121, "answer_id": 50615213, "question_id": 50588831, "link": "https://stackoverflow.com/questions/50588831/handling-model-specific-actions-vs-database-actions/50615213#50615213", "title": "Handling model specific actions vs database actions", "body": "<p>I <em>think</em> your user should be a concrete type, and you should use an interface to mock your store.</p>\n\n<p>For instance, a project structure like this makes sense to me:</p>\n\n<pre><code>cmd/\n   server/\n      user.go\n      user_test.go\n      main.go\n      store.go\nmysql/\n   mysql.go\n   user.go\n   user_test.go\nuser.go\nuser_test.go\n</code></pre>\n\n<p>Your user model is at the root, in <code>user.go</code>. This file will contain your <code>User</code> struct, and the functions that will operate on it, like <code>CreateDigest</code>. These functions should be tested in <code>user_test.go</code>.</p>\n\n<p>It is worth mentioning that at your root, your package should not be <code>main</code>, your package name should be the name of your project, we will call it <code>myapp</code>.</p>\n\n<p>Your <code>mysql</code>, <code>postgres</code>, etc. should also be a concrete implementation. You may have a function in that package like:</p>\n\n<pre><code>func (m *MySQL) InsertUser(u *myapp.User) error\n</code></pre>\n\n<p>This function should be tested in <code>mysql/user_test.go</code>.</p>\n\n<p>And finally, we can put it all together in <code>server</code>. This is the binary you actually deploy or run.</p>\n\n<p>In <code>cmd/server/store.go</code>, you should create an interface that will be implemented by <code>mysql</code>.</p>\n\n<p>In <code>cmd/server/user_test.go</code> it is very easy to mock this so that you do not have to hit the real database. I am a believer in that your interfaces should live in your client. In this case, <code>server</code> is a client of <code>mysql</code>.</p>\n\n<p>In <code>cmd/server/user.go</code> you may have functions that look like this:</p>\n\n<pre><code>func CreateUser(w http.ResponseWriter, r *http.Request) {\n  var u myapp.user\n  err := json.NewDecoder(r.Body).Decode(&amp;u)\n  if err != nil {\n    panic(err) // don't do this for real\n  }\n\n  d := myapp.CreateDigest(u.Password)\n  u.Digest = d\n\n  // s is the interface, defined in `cmd/server/store.go`, but is implemented by mysql\n  err = s.InsertUser(&amp;u)\n  if err != nil {\n    panic(err)\n  }\n\n  // Since we pass a pointer, you can have your store set the ID of the user\n  fmt.Println(u.ID)\n}\n</code></pre>\n\n<p>Now that you have a better separation of concerns, everything should be easy to test, and making changes to existing code is easy.</p>\n"}], "owner": {"reputation": 97, "user_id": 6276257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7dec81a543c7f8e032db33f8a0fcba89?s=128&d=identicon&r=PG&f=1", "display_name": "AlexManning", "link": "https://stackoverflow.com/users/6276257/alexmanning"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 50615213, "answer_count": 1, "score": 0, "last_activity_date": 1527768028, "creation_date": 1527610817, "last_edit_date": 1527662944, "question_id": 50588831, "link": "https://stackoverflow.com/questions/50588831/handling-model-specific-actions-vs-database-actions", "title": "Handling model specific actions vs database actions", "body": "<p>I am having some issues when it comes to model design, specifically handling <strong>Model specific actions</strong> vs <strong>Database actions</strong>. A good example would be my User model.</p>\n\n<p>When creating a user in my DB, I want to:</p>\n\n<ol>\n<li>Verify the password meets criteria (Model action)</li>\n<li>Create the digest (Model action)</li>\n<li>Set timestamps (model action)</li>\n<li>Save the Email, Digest, and Timestamps to the DB (DB Action)</li>\n</ol>\n\n<p>When testing, I obviously want to have a set of unit test for all 4, however #4 has calls to the other 3, something I don\u2019t want to retest, or risk having #4 test fail if any of those 3 do.</p>\n\n<p>I have come up with creating a separate Interface for ModelActions vs StoreActions, and sending the UserAction interface to a store action when needed, however as I write it out, I am already sensing some serious code smell.</p>\n\n<pre><code>type User struct {\n        ID                   int    `json:\"id\"`\n        Email                string `json:\"email\"`\n        Password             string `json:\"password\"`\n        ConfirmationPassword string `json:\"confirmationPassword\"`\n        passwordDigest       string `json:\"-\"`\n        CreatedAt            time.Time `json:\"createdAt,omitempty\"`\n        ModifiedAt           time.Time `json:\"modifiedAt,omitempty\"`\n}\n\n//UserStore is the interface for all User functions that interact with the database\ntype UserStore interface {\n        GetUserByEmailAndPassword(email, password string) (User, error)\n        UpdatePassword(u UserAction, previousPassword, password, confirmationPassword string) error\n        UserExists(email string) (bool, error)\n        CreateUser(u UserAction) error\n}\n\n// I am going against design Principles by having GetID, GetEmail, since JSON unmarshalling needs the struct fields to be capitalized, which is already a warning sign for me\n\ntype UserAction interface {\n        GetID() int\n        GetEmail() string\n        Timestamps() (time.Time, time.Time)\n        SetID(id int)\n        SetTimestamps()\n        SetPassword(password, confirmation string)\n        SetDigest(digest string)\n        CreateDigest() (string, error)\n        VerifyPassword() error\n        ComparePassword(password string) error\n}\n\n// Example of UserActions\nfunc (u *User) CreateDigest() (string, error) {\n        var digest string\n        if err := u.VerifyPassword(); err != nil {\n                return digest, err\n        }\n\n        passwordByte, err := bcrypt.GenerateFromPassword([]byte(u.Password), bcrypt.DefaultCost)\n        if err != nil {\n                return digest, err\n        }\n\n        digest = string(passwordByte)\n        return digest, nil\n}\n\nfunc (u *User) VerifyPassword() error {\n        if len(u.Password) &lt; 6 {\n                return &amp;modelError{\"Password\", \"must be at least 6 characters long\"}\n        }\n\n        if u.Password != u.ConfirmationPassword {\n                return &amp;modelError{\"ConfirmationPassword\", \"does not match Password\"}\n        }\n\n        return nil\n}\n\n// Example of DB Action\nfunc (db *DB) CreateUser(ua UserAction) error {\n        if exists, err := db.UserExists(ua.GetEmail()); err != nil {\n                return err\n        } else if exists {\n                return &amp;modelError{\"Email\", \"already exists in the system\"}\n        }\n\n        // set password\n        digest, err := ua.CreateDigest()\n        if  err != nil {\n                return err\n        }\n\n        ua.SetDigest(digest)\n        ua.SetTimestamps()\n\n        createdAt, modifiedAt := ua.Timestamps()\n\n        rows, err := db.Query(`\n                INSERT INTO users (email, password_digest, created_at, modified_at)\n                        VALUES ($1, $2, $3, $4)\n                        RETURNING id\n                `, ua.GetEmail(), digest, createdAt, modifiedAt)\n\n        if err != nil {\n                return err\n        }\n\n        defer rows.Close()\n\n        var id int\n        for rows.Next() {\n                if err := rows.Scan(&amp;id); err != nil {\n                        return err\n                }\n        }\n\n        ua.SetID(id)\n\n        return nil\n}\n</code></pre>\n\n<p>Is there a better way to model these separate actions so the UserActions can be mocked when testing the DB/Store functions? I tried storing the <code>User</code> struct as part of the interface, something such as:</p>\n\n<pre><code>type UserAction {\n    SetTimestamps()\n    CreateDigest() (string, error)\n    VerifyPassword() error\n    ComparePassword(password string) error\n    User() *User\n}\n</code></pre>\n\n<p>This however causes cyclical imports when creating mocks, and also opens up all fields, which are already arguably available since the model's fields are exportable</p>\n"}, {"tags": ["go", "github", "dependencies"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1527611459, "post_id": 50588735, "comment_id": 88187352, "body": "godoc.org can show a graph for any published package. It also has options to hide some or all standard library packages. Links are at the end of each page. <a href=\"https://godoc.org/github.com/gorilla/mux?import-graph\" rel=\"nofollow noreferrer\">godoc.org/github.com/gorilla/mux?import-graph</a>"}, {"owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1527612208, "post_id": 50588735, "comment_id": 88187696, "body": "Interesting. I checked 3 packages and Sourcegraph shows higher numbers for all 3 packages than GoDoc. I wonder what the difference is."}], "answers": [{"comments": [{"owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "edited": false, "score": 1, "creation_date": 1527612934, "post_id": 50589051, "comment_id": 88188096, "body": "Okay, have good results now, but some processing is needed. I&#39;ll play with this when I have more time. Thanks!"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 5, "last_activity_date": 1527613430, "last_edit_date": 1527613430, "creation_date": 1527611563, "answer_id": 50589051, "question_id": 50588735, "link": "https://stackoverflow.com/questions/50588735/how-to-get-a-list-of-go-dependents/50589051#50589051", "title": "How to get a list of Go dependents", "body": "<p><code>go list</code> can do this for you, with use of the <code>-f</code> flag.</p>\n\n<pre><code>go list -f '{{.Imports}}' ./...\n</code></pre>\n\n<p>Will show a list of all imports for the current and child directories.  You can pipe this through <code>sort -u</code>, for example, to get a list of all dependencies, or do other standard shell-based massaging. Consult the <a href=\"https://golang.org/cmd/go/#hdr-List_packages\" rel=\"nofollow noreferrer\">documentation</a> for all of the formatting options available.</p>\n\n<p>If you need a recursive list, this is also possible with some shell scripting, by then using doing the same thing recursively on the output of the above command.</p>\n"}, {"tags": [], "owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "is_accepted": false, "score": 0, "last_activity_date": 1611705174, "creation_date": 1611705174, "answer_id": 65910996, "question_id": 50588735, "link": "https://stackoverflow.com/questions/50588735/how-to-get-a-list-of-go-dependents/65910996#65910996", "title": "How to get a list of Go dependents", "body": "<p><code>go list</code> has a <code>-deps</code> flag to list dependent packages (replace the dot with the path of your root package if not current directory):</p>\n<pre><code>go list -deps .\n</code></pre>\n"}], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 604, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1611705174, "creation_date": 1527610464, "last_edit_date": 1527639838, "question_id": 50588735, "link": "https://stackoverflow.com/questions/50588735/how-to-get-a-list-of-go-dependents", "title": "How to get a list of Go dependents", "body": "<p>Short of building a dependency graph, is there an existing way to retrieve a list of dependent packages given a target package?</p>\n\n<p>Sourcegraph has a badge (shield) that shows you how many packages use a specific package but when I click their link to go to their UI, I cannot find a count or list of packages. Here's more info:</p>\n\n<ul>\n<li>Sourcegraph article: <a href=\"https://about.sourcegraph.com/blog/see-how-many-people-use-your-library-with-sourcegraph-badges/\" rel=\"nofollow noreferrer\">https://about.sourcegraph.com/blog/see-how-many-people-use-your-library-with-sourcegraph-badges/</a></li>\n</ul>\n\n<p>Example badge:</p>\n\n<p><a href=\"https://sourcegraph.com/github.com/gorilla/mux?badge\" rel=\"nofollow noreferrer\"><img src=\"https://sourcegraph.com/github.com/gorilla/mux/-/badge.svg\" alt=\"Sourcegraph\"></a></p>\n\n<p>GitHub has a dependency graph but it doesn't appear to list packages for Go and its docs only mention JavaScript and Ruby per the following:</p>\n\n<ul>\n<li>GitHub Depends on: \n<a href=\"https://help.github.com/articles/listing-the-packages-that-a-repository-depends-on/\" rel=\"nofollow noreferrer\">https://help.github.com/articles/listing-the-packages-that-a-repository-depends-on/</a></li>\n</ul>\n"}, {"tags": ["go", "import"], "answers": [{"comments": [{"owner": {"reputation": 415, "user_id": 7844239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f4592b2e5235c0a47eb851d1a58d942?s=128&d=identicon&r=PG&f=1", "display_name": "J Aamish", "link": "https://stackoverflow.com/users/7844239/j-aamish"}, "edited": false, "score": 0, "creation_date": 1527668994, "post_id": 50589444, "comment_id": 88208852, "body": "<code>conn</code> uses the standard functions that both packages expose and hence just changing the import would work correctly. Otherwise, we have to duplicate all the code in it (which is what we would like to avoid). So our real goal is to determine at compile time whether it is <code>v3</code> or <code>v4</code>."}], "tags": [], "owner": {"reputation": 1014, "user_id": 61360, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/70602c12ed1c06db5165ff6a88cd38e0?s=128&d=identicon&r=PG", "display_name": "Mat&#237;as Insaurralde", "link": "https://stackoverflow.com/users/61360/mat%c3%adas-insaurralde"}, "is_accepted": false, "score": 1, "last_activity_date": 1527613107, "creation_date": 1527613107, "answer_id": 50589444, "question_id": 50588677, "link": "https://stackoverflow.com/questions/50588677/handling-different-versioned-packages-within-same-file/50589444#50589444", "title": "Handling different versioned packages within same file", "body": "<p>I wouldn't use build tags for this, would you need to call different versions in the same function?</p>\n\n<p>You could still load multiple packages and use different aliases (something that would be possible with <a href=\"https://github.com/olivere/elastic#elastic-60\" rel=\"nofollow noreferrer\">this package</a> for example).</p>\n\n<pre><code>import(\n    pkgVersionA \"gopkg.in/db/pkg.v1\"\n    pkgVersionB \"gopkg.in/db/pkg.v2\"\n)\n\n...\nfunc connect() {\n   y := pkgVersionA.New()\n   x := pkgVersionB.New()\n   ...\n}\n</code></pre>\n"}], "owner": {"reputation": 415, "user_id": 7844239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f4592b2e5235c0a47eb851d1a58d942?s=128&d=identicon&r=PG&f=1", "display_name": "J Aamish", "link": "https://stackoverflow.com/users/7844239/j-aamish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1527668885, "creation_date": 1527610228, "last_edit_date": 1527668885, "question_id": 50588677, "link": "https://stackoverflow.com/questions/50588677/handling-different-versioned-packages-within-same-file", "title": "Handling different versioned packages within same file", "body": "<p>We have two different version packages to our database. Some of our projects still use the old db, while the new ones use the new db</p>\n\n<p>We have a package <code>conn</code></p>\n\n<pre><code>import(\n    \"gopkg.in/db/pkg.v3\"\n)\n\n...\nfunc connect() {\n   y := dbpkg.New()\n   ...\n}\n</code></pre>\n\n<p>Now we have <code>gopkg.in/db/pkg.v4</code> coming in. Both <code>pkg.v3</code> and <code>pkg.v4</code> expose very similar functions except, of course, the changes between the db versions. Our <code>conn</code> package however is using the standard parts which are commonly available between both <code>v3</code> and <code>v4</code>. Therefore, we would like to maintain the package <code>conn</code> as it is and in compile time determine whether we have to include <code>pkg.v3</code> or <code>pkg.v4</code>. Is that possible?</p>\n\n<p>If not, then another thought process is to create a new local package <code>pkg</code> (which <code>conn</code> shall use) and have two files <code>pkg_v3.go</code> and <code>pkg_v4.go</code> in <code>pkg</code> which can be compiled based on build tags. In that as well, how to automatically expose some/all the functions from the <code>pkg.v3 or pkg.v4</code> through <code>pkg</code>.</p>\n\n<p>We would like to avoid duplicating the whole <code>conn</code> package just to change this one line <code>pkg.v3</code> or <code>pkg.v4</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 2, "creation_date": 1527606979, "post_id": 50587700, "comment_id": 88184810, "body": "<a href=\"https://golang.org/pkg/path/#pkg-overview\" rel=\"nofollow noreferrer\">golang.org/pkg/path/#pkg-overview</a>"}, {"owner": {"reputation": 4477, "user_id": 4673475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ff3c47715605701025a89d68849d6c?s=128&d=identicon&r=PG", "display_name": "kucing_terbang", "link": "https://stackoverflow.com/users/4673475/kucing-terbang"}, "edited": false, "score": 0, "creation_date": 1527607004, "post_id": 50587700, "comment_id": 88184823, "body": "I probably going to use <a href=\"https://golang.org/pkg/net/url/#ResolveReference\" rel=\"nofollow noreferrer\">golang.org/pkg/net/url/#ResolveReference</a> instead of path join"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 4, "last_activity_date": 1527609900, "last_edit_date": 1527609900, "creation_date": 1527606882, "answer_id": 50587782, "question_id": 50587700, "link": "https://stackoverflow.com/questions/50587700/portability-of-path-join-for-url-paths/50587782#50587782", "title": "Portability of path.Join for URL paths", "body": "<p>Yes, <code>path.Join</code> is safe because <strong>URLs are not platform-specific</strong>, they <em>always</em> use <code>/</code> as a directory separator. If you need platform-specific file path handling, use <a href=\"https://golang.org/pkg/path/filepath/\" rel=\"nofollow noreferrer\"><code>filepath</code></a> instead of <code>path</code>.</p>\n\n<p>See also: Wikipedia's entry on <a href=\"https://en.wikipedia.org/wiki/Uniform_Resource_Identifier\" rel=\"nofollow noreferrer\">URIs/URLs</a> and <a href=\"https://tools.ietf.org/html/rfc3986\" rel=\"nofollow noreferrer\">RFC 3986</a> which defines them.</p>\n"}], "owner": {"reputation": 1860, "user_id": 77643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8305195de2fc575956ffa9cf7c49e540?s=128&d=identicon&r=PG", "display_name": "Tom Elliott", "link": "https://stackoverflow.com/users/77643/tom-elliott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 795, "favorite_count": 0, "accepted_answer_id": 50587782, "answer_count": 1, "score": -3, "last_activity_date": 1527609900, "creation_date": 1527606655, "question_id": 50587700, "link": "https://stackoverflow.com/questions/50587700/portability-of-path-join-for-url-paths", "title": "Portability of path.Join for URL paths", "body": "<p>We're using <code>path.Join</code> to construct the URL for a set of files:</p>\n\n<pre><code>urlPath := \"/\"\nif isPrimaryLocale {\n    urlPath = path.Join(urlPath, locale)\n}\nurlPath = path.Join(urlPath, itemName)\n</code></pre>\n\n<p>I'm curious as to the portability of this approach, since afaik a different path separator would be used on Windows (not a concern for us since we always deploy to Linux, but wondering for other applications).</p>\n\n<p>Is <code>path.Join</code> safe to be used on paths intended for URLs? Is there an alternative approach that is URL specific?</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-sdk-go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1527605177, "post_id": 50587165, "comment_id": 88183676, "body": "That&#39;s not how the Go SDK works. Why don&#39;t you want to use a session?"}], "answers": [{"tags": [], "owner": {"reputation": 318, "user_id": 1579459, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/pnV0I.jpg?s=128&g=1", "display_name": "Xibz", "link": "https://stackoverflow.com/users/1579459/xibz"}, "is_accepted": false, "score": 2, "last_activity_date": 1527801872, "creation_date": 1527801872, "answer_id": 50633002, "question_id": 50587165, "link": "https://stackoverflow.com/questions/50587165/creating-client-in-go-aws-sdk-without-session/50633002#50633002", "title": "Creating client in Go AWS SDK without session", "body": "<p>The SDK needed to avoid a circular dependency, and to do this it used an abstraction called <code>session.Session</code>. However, <a href=\"https://github.com/aws/aws-sdk-go-v2/blob/master/aws/config.go#L71-L79\" rel=\"nofollow noreferrer\">V2</a> gets rid of this abstraction by flattening some of the packages :)</p>\n"}], "owner": {"reputation": 317, "user_id": 1796652, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/13f1016f37fe413b4b130db100662404?s=128&d=identicon&r=PG", "display_name": "learner123", "link": "https://stackoverflow.com/users/1796652/learner123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 663, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1527801872, "creation_date": 1527604965, "question_id": 50587165, "link": "https://stackoverflow.com/questions/50587165/creating-client-in-go-aws-sdk-without-session", "title": "Creating client in Go AWS SDK without session", "body": "<p>How do we create a AWS service client (e.g. EC2, Autoscaling) without using a session, and instead with directly using the sahred credentials, like in boto3.</p>\n\n<p>Using session like this works:</p>\n\n<pre><code>sess := session.New(&amp;aws.Config{\n        Region:      aws.String(\"us-east-1\"),\n        Credentials: credentials.NewSharedCredentials(\"\", profile),\n    })\nsvc := ec2.New(sess)\n</code></pre>\n\n<p>However, this does not work:</p>\n\n<pre><code>svc := ec2.New(&amp;aws.Config{\n        Region:      aws.String(\"us-east-1\"),\n        Credentials: credentials.NewSharedCredentials(\"\", profile),\n    })\n</code></pre>\n\n<p>Error: </p>\n\n<blockquote>\n  <p>cannot use aws.Config literal (type *aws.Config) as type\n  client.ConfigProvider in argument to ec2.New:     *aws.Config does not\n  implement client.ConfigProvider (missing ClientConfig method)</p>\n</blockquote>\n\n<p>How to directly create a client with Go AWS SDK without session?</p>\n"}, {"tags": ["linux", "go", "ptrace"], "comments": [{"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1527641911, "post_id": 50584725, "comment_id": 88199043, "body": "<code>syscall.PtraceRegs</code> is a sturct in Go, not an actual call. What are you trying to do? usually it&#39;s used like this <code>regs := &amp;syscall.PtraceRegs{}   \terr := syscall.PtraceGetRegs(t.Process.Pid, regs)</code>"}, {"owner": {"reputation": 3576, "user_id": 1484017, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Iwf8A.jpg?s=128&g=1", "display_name": "Yogesh", "link": "https://stackoverflow.com/users/1484017/yogesh"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1527664377, "post_id": 50584725, "comment_id": 88205977, "body": "that is correct! if you see reference code that is what is done"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1527692922, "post_id": 50584725, "comment_id": 88225854, "body": "Then what is your question? It&#39;s unclear."}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1527728490, "post_id": 50584725, "comment_id": 88240392, "body": "sorry, @Yogesh, would you, please, post the actual code instead of this and this?"}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1527785561, "post_id": 50584725, "comment_id": 88268428, "body": "The answer you linked to uses <code>regs.rdi </code> for the first argument of a syscall. In Go, you&#39;d use <code>regs.Rdi</code>, which is a uint64."}, {"owner": {"reputation": 3576, "user_id": 1484017, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Iwf8A.jpg?s=128&g=1", "display_name": "Yogesh", "link": "https://stackoverflow.com/users/1484017/yogesh"}, "reply_to_user": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1527838555, "post_id": 50584725, "comment_id": 88286637, "body": "@MarkPlotnick Yes but how do to get the string value for it!"}, {"owner": {"reputation": 7668, "user_id": 2554472, "user_type": "registered", "profile_image": "https://graph.facebook.com/1119155584/picture?type=large", "display_name": "Mark Plotnick", "link": "https://stackoverflow.com/users/2554472/mark-plotnick"}, "edited": false, "score": 0, "creation_date": 1527844691, "post_id": 50584725, "comment_id": 88290100, "body": "@Yogesh I&#39;d try <a href=\"https://golang.org/pkg/syscall/#PtracePeekData\" rel=\"nofollow noreferrer\">syscall.PtracePeekData</a> giving it a byte array sized appropriately, maybe based on one of the system call args or return value (like the third arg to write or the return value from read)."}], "owner": {"reputation": 3576, "user_id": 1484017, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Iwf8A.jpg?s=128&g=1", "display_name": "Yogesh", "link": "https://stackoverflow.com/users/1484017/yogesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 560, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1527764112, "creation_date": 1527597785, "last_edit_date": 1527764112, "question_id": 50584725, "link": "https://stackoverflow.com/questions/50584725/golang-syscall-get-parameters-of-syscall", "title": "Golang syscall get parameters of syscall", "body": "<p>If you execute <code>./syscallprint ls -l</code> it will print syscall ID's being called by <code>ls -l</code> command.</p>\n\n<p><strong>syscallprint.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n    \"syscall\"\n)\n\nfunc main() {\n    var regs syscall.PtraceRegs\n    cmd := exec.Command(os.Args[1], os.Args[2:]...)\n    cmd.Stderr = os.Stderr\n    cmd.Stdin = os.Stdin\n    cmd.Stdout = os.Stdout\n    cmd.SysProcAttr = &amp;syscall.SysProcAttr{\n        Ptrace: true,\n    }\n    cmd.Start()\n    err := cmd.Wait()\n    if err != nil {\n        fmt.Printf(\"Wait returned: %v\\n\", err)\n    }\n    pid := cmd.Process.Pid\n    exit := true\n    for {\n        if exit {\n            err = syscall.PtraceGetRegs(pid, &amp;regs)\n            if err != nil {\n                break\n            }\n            fmt.Printf(\"SystemId: (%x)\\n\", regs.Orig_rax)\n            // TODO: print syscall parameters\n        }\n        err = syscall.PtraceSyscall(pid, 0)\n        if err != nil {\n            panic(err)\n        }\n        _, err = syscall.Wait4(pid, nil, 0, nil)\n        if err != nil {\n            panic(err)\n        }\n        exit = !exit\n    }\n}\n</code></pre>\n\n<p>Is it possible to get parameters of syscall being made by <code>ls -l</code>?</p>\n\n<p>It seems to be possible with <a href=\"/questions/tagged/c\" class=\"post-tag\" title=\"show questions tagged &#39;c&#39;\" rel=\"tag\">c</a> from <a href=\"https://stackoverflow.com/questions/33431994/extracting-system-call-name-and-arguments-using-ptrace\">this question</a>. Is it possible with go-lang?</p>\n"}, {"tags": ["go", "serialization", "deserialization", "marshalling", "unmarshalling"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 2, "creation_date": 1527587888, "post_id": 50581297, "comment_id": 88171997, "body": "Unmarshal time series json object using interface. Check this answer on <a href=\"https://play.golang.org/p/r2w-iMo1b5Y\" rel=\"nofollow noreferrer\">go playground</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1527591250, "post_id": 50581297, "comment_id": 88174108, "body": "<code>go doc encoding&#47;json.Unmarshal</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1942, "user_id": 1209272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97e49723c518649025bd10ea6bf113b5?s=128&d=identicon&r=PG", "display_name": "Chief", "link": "https://stackoverflow.com/users/1209272/chief"}, "is_accepted": true, "score": 1, "last_activity_date": 1527589639, "creation_date": 1527589639, "answer_id": 50582078, "question_id": 50581297, "link": "https://stackoverflow.com/questions/50581297/saving-data-with-a-rest-client-after-consuming-an-external-api-in-go/50582078#50582078", "title": "Saving data with a REST client after consuming an external API in Go", "body": "<p>Using an interface as suggested is a good idea, but in this case, since you know the structure of the response defining using an explicit type suffices and should be easier to work with:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\ntype values map[string]string\ntype TimeSeries struct {\n    Item map[string]values `json:\"Time Series (1min)\"`\n}\n\nfunc main() {\n    response, err := http.Get(\"https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&amp;symbol=MSFT&amp;interval=1min&amp;apikey=demo\")\n\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer response.Body.Close()\n    contents, err := ioutil.ReadAll(response.Body)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    var ts TimeSeries\n    err = json.Unmarshal(contents, &amp;ts)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"%#v\", ts)\n}\n</code></pre>\n"}], "owner": {"reputation": 4043, "user_id": 8342189, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/f40Rg.jpg?s=128&g=1", "display_name": "Philip Mutua", "link": "https://stackoverflow.com/users/8342189/philip-mutua"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 50582078, "answer_count": 1, "score": -2, "last_activity_date": 1527589639, "creation_date": 1527587364, "question_id": 50581297, "link": "https://stackoverflow.com/questions/50581297/saving-data-with-a-rest-client-after-consuming-an-external-api-in-go", "title": "Saving data with a REST client after consuming an external API in Go", "body": "<p>I am new to <code>Go</code> lang have created a REST client that consumes the <a href=\"https://www.alphavantage.co/documentation/\" rel=\"nofollow noreferrer\">alphavantage</a> API</p>\n\n<p>The <code>JSON</code> structure which comes up after I make a <code>GET</code> request looks as below. I only need the <code>Time Series</code> key data so that I do my own calculations. How do I get the data from the <code>Time Series</code>  and save it so that I do my own manipulations of the data? </p>\n\n<p><h1>JSON</h1></p>\n\n<pre><code>{\n    \"Meta Data\": {\n        \"1. Information\": \"Intraday (1min) prices and volumes\",\n        \"2. Symbol\": \"MSFT\",\n        \"3. Last Refreshed\": \"2018-05-25 16:00:00\",\n        \"4. Interval\": \"1min\",\n        \"5. Output Size\": \"Compact\",\n        \"6. Time Zone\": \"US/Eastern\"\n    },\n    \"Time Series (1min)\": {\n        \"2018-05-25 16:00:00\": {\n            \"1. open\": \"98.2700\",\n            \"2. high\": \"98.4400\",\n            \"3. low\": \"98.2650\",\n            \"4. close\": \"98.3600\",\n            \"5. volume\": \"2466507\"\n        }\n    }\n}\n</code></pre>\n\n<h1> code for REST Client </h1>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"fmt\"\n    \"io/ioutil\"\n    //encode and decode JSON streams\n    \"encoding/json\"\n)\n\n\n\nfunc main() {\n    response, err := http.Get(\"https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&amp;symbol=MSFT&amp;interval=1min&amp;apikey=demo\")\n\n    if err!=nil{\n        fmt.Println(err)\n        return\n    }\n    defer response.Body.Close()\n    contents, err := ioutil.ReadAll(response.Body)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(string(contents))\n}\n</code></pre>\n"}, {"tags": ["string", "testing", "go", "input"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527582805, "post_id": 50579750, "comment_id": 88168712, "body": "I don&#39;t know why Scanf doesn&#39;t work, but your tests should not depend on user input. You should be using Fscanf, or redirect stdin (perhaps <code>testing</code> already closes stdin?)"}, {"owner": {"reputation": 71, "user_id": 8096201, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lTPId.png?s=128&g=1", "display_name": "Nevercare", "link": "https://stackoverflow.com/users/8096201/nevercare"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527583611, "post_id": 50579750, "comment_id": 88169188, "body": "change <code>Scanf</code> to <code>Fscanf</code> turns out the same result, maybe the <code>testing</code> already closes stdin. I&#39;m testing a login method with a captcha input, which download a captcha image for me to read and send a post after waiting for me to type in the captcha string. is there a better way to test this method ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527592004, "post_id": 50579750, "comment_id": 88174663, "body": "I should have been more explicit: You should use Fscanf with a predefined io.Reader containing your input to test as input"}, {"owner": {"reputation": 2041, "user_id": 5824483, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/1045400122183130/picture?type=large", "display_name": "Amulya Kashyap", "link": "https://stackoverflow.com/users/5824483/amulya-kashyap"}, "edited": false, "score": 0, "creation_date": 1527601109, "post_id": 50579750, "comment_id": 88180873, "body": "You can find your solution here : <a href=\"https://stackoverflow.com/questions/46365221/fill-os-stdin-for-function-that-reads-from-it\" title=\"fill os stdin for function that reads from it\">stackoverflow.com/questions/46365221/&hellip;</a>"}], "owner": {"reputation": 71, "user_id": 8096201, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lTPId.png?s=128&g=1", "display_name": "Nevercare", "link": "https://stackoverflow.com/users/8096201/nevercare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 304, "favorite_count": 1, "closed_date": 1527583861, "answer_count": 0, "score": 0, "last_activity_date": 1527585438, "creation_date": 1527582724, "last_edit_date": 1527585438, "question_id": 50579750, "link": "https://stackoverflow.com/questions/50579750/why-fmt-scanf-doesnt-work-in-golang-test", "closed_reason": "Duplicate", "title": "why fmt.Scanf doesn&#39;t work in golang test", "body": "<p>why <code>fmt.Scanf</code> doesn't work properly in a test file?</p>\n\n<p>I have some test code as below, the test itself finishes without waiting for me to type in something.</p>\n\n<p>I'm not simulating user input, the test needs someone to type with a keyboard while the it is running</p>\n\n<pre><code>package sometests\n\nimport (\n    \"fmt\"\n    \"testing\"\n)\n\nfunc TestScanf(t *testing.T) {\n    fmt.Printf(\"type someting:\\n\")\n    var s string\n    fmt.Scanf(\"%s\\n\", &amp;s)\n    // test should wait here for me to type, but it won't\n    fmt.Printf(\"you type: %q\\n\", s)\n}\n</code></pre>\n"}, {"tags": ["go", "gnu-screen"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527582345, "post_id": 50579439, "comment_id": 88168425, "body": "Try <a href=\"https://lists.gnu.org/archive/html/screen-users/2016-12/msg00002.html\" rel=\"nofollow noreferrer\">this post</a> for some clues."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1527600371, "post_id": 50584525, "comment_id": 88180363, "body": "@zekro, <a href=\"https://stackoverflow.com/a/21858818/720999\">there</a> I have tried to present a bit more background to this &quot;terminal/pseudo terminal&quot; thing. Consider also reading <a href=\"http://www.linusakesson.net/programming/tty/\" rel=\"nofollow noreferrer\">this classic essay</a> on what TTY really is."}], "tags": [], "owner": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "is_accepted": false, "score": 0, "last_activity_date": 1527597184, "creation_date": 1527597184, "answer_id": 50584525, "question_id": 50579439, "link": "https://stackoverflow.com/questions/50579439/starting-screen-as-command-in-go/50584525#50584525", "title": "Starting screen as command in Go?", "body": "<p>To start screen you should emulate tty device.</p>\n\n<p>GNU screen code:</p>\n\n<pre><code>attach_tty = ttyname(0);\n    if (!attach_tty) {\n        if (errno == ENODEV) {\n            // ....\n        } else if (fatal) {\n            Panic(0, \"Must be connected to a terminal.\");\n        } else {\n            // ...\n        }\n    }\n</code></pre>\n\n<p>You may take a look at <a href=\"https://github.com/mattn/go-tty\" rel=\"nofollow noreferrer\">https://github.com/mattn/go-tty</a></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12437579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IyGPz.jpg?s=128&g=1", "display_name": "Jonah", "link": "https://stackoverflow.com/users/12437579/jonah"}, "is_accepted": false, "score": 0, "last_activity_date": 1580815853, "creation_date": 1580815853, "answer_id": 60056444, "question_id": 50579439, "link": "https://stackoverflow.com/questions/50579439/starting-screen-as-command-in-go/60056444#60056444", "title": "Starting screen as command in Go?", "body": "<p>Try:</p>\n\n<blockquote>\n  <p>cmd.Run()</p>\n</blockquote>\n\n<p>Instead of:</p>\n\n<blockquote>\n  <p>cmd.Start()</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10976799, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-fNxbKYHE9eA/AAAAAAAAAAI/AAAAAAAAAWg/IHKiybFBJcM/photo.jpg?sz=128", "display_name": "Jeremy Kimmel", "link": "https://stackoverflow.com/users/10976799/jeremy-kimmel"}, "is_accepted": false, "score": 0, "last_activity_date": 1606062467, "creation_date": 1606062467, "answer_id": 64956611, "question_id": 50579439, "link": "https://stackoverflow.com/questions/50579439/starting-screen-as-command-in-go/64956611#64956611", "title": "Starting screen as command in Go?", "body": "<p>A couple of things...</p>\n<p>First, I believe you're missing the <code>-X stuff</code> part that screen needs in order to know what action it should take. <code>-X stuff &lt;text&gt;</code> is used to pass whatever is <code>&lt;text&gt;</code> into the screen. (i.e. <code>screen -S test -X stuff &quot;node /home/servers/test/main.js&quot;</code>)</p>\n<p>There is a catch to this one... The example above will only pass the text to the screen. If you want it to actually execute that text, you'll also need to send the &quot;enter&quot; command (&quot;^M&quot;) with it. (i.e. <code>screen -S test -X stuff &quot;node /home/servers/test/main.js^M&quot;</code>)</p>\n<p>Second, it's not a bad idea to include the window argument <code>-p &lt;#&gt;</code> to specify exactly which window the command should be sent to. I'll admit that it's probably not needed if you're only using one window with screen, but it won't hurt to use it anyway. Screen numbers the windows beginning with <code>0</code>, so <code>-p 0</code> would indicate the first window, <code>-p 1</code> would indicate the second window, etc... (i.e. <code>screen -S test -p 0 -X stuff &quot;node /home/servers/test/main.js^M&quot;</code>)</p>\n<p>Lastly, since your original question is about GOLANG... the secret is that you have to break apart your entire command.</p>\n<pre><code>cmd := exec.Command(&quot;screen&quot;, &quot;-S&quot;, &quot;test&quot;, &quot;-p&quot;, &quot;0&quot;, &quot;-X&quot;, &quot;stuff&quot;, &quot;node /home/servers/test/main.js^M&quot;)\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 6605704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ULlcX.png?s=128&g=1", "display_name": "zekro", "link": "https://stackoverflow.com/users/6605704/zekro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 306, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1606062467, "creation_date": 1527581594, "last_edit_date": 1531736035, "question_id": 50579439, "link": "https://stackoverflow.com/questions/50579439/starting-screen-as-command-in-go", "title": "Starting screen as command in Go?", "body": "<p>I'm creating an app which shall start a script in a seperate <a href=\"https://linux.die.net/man/1/screen\" rel=\"nofollow noreferrer\">screen</a> session.</p>\n\n<p><em>Used compiler:  go1.10.1 linux/amd64</em>.</p>\n\n<p>My current code looks like following:</p>\n\n<pre><code>cmd := exec.Command(\"screen\", \"-S\", \"test\", \"node /home/servers/test/main.js\")\ncmd.Stdout = os.Stdout\ncmd.Start()\n</code></pre>\n\n<p>Executing this returns following in the output:</p>\n\n<pre><code>Must be connected to a terminal.\n</code></pre>\n\n<p>Also I have tested starting it with specified shell:</p>\n\n<pre><code>cmd := exec.Command(\"bash\", \"-c\", \"screen\", \"-S\", \"test\", \"node /home/servers/test/main.js\")\n</code></pre>\n\n<p>Same result.</p>\n\n<p>Is is possible to execute the command connected to the current terminal?</p>\n"}, {"tags": ["windows", "go", "prometheus"], "answers": [{"comments": [{"owner": {"reputation": 667, "user_id": 7095694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh5.googleusercontent.com/-nLg_DXMQ9Rg/AAAAAAAAAAI/AAAAAAAAARI/qZtxSIR-UdU/photo.jpg?sz=128", "display_name": "Ertan Hasani", "link": "https://stackoverflow.com/users/7095694/ertan-hasani"}, "edited": false, "score": 0, "creation_date": 1527579762, "post_id": 50578859, "comment_id": 88166881, "body": "I tried it and after I typed it, it closed my command line. After that tried again that <code>go run mage.go docker</code> command but still the same"}, {"owner": {"reputation": 1014, "user_id": 61360, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/70602c12ed1c06db5165ff6a88cd38e0?s=128&d=identicon&r=PG", "display_name": "Mat&#237;as Insaurralde", "link": "https://stackoverflow.com/users/61360/mat%c3%adas-insaurralde"}, "reply_to_user": {"reputation": 667, "user_id": 7095694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh5.googleusercontent.com/-nLg_DXMQ9Rg/AAAAAAAAAAI/AAAAAAAAARI/qZtxSIR-UdU/photo.jpg?sz=128", "display_name": "Ertan Hasani", "link": "https://stackoverflow.com/users/7095694/ertan-hasani"}, "edited": false, "score": 0, "creation_date": 1527580170, "post_id": 50578859, "comment_id": 88167146, "body": "What&#39;s the output when entering &quot;go-bindata&quot; in your terminal?"}, {"owner": {"reputation": 1014, "user_id": 61360, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/70602c12ed1c06db5165ff6a88cd38e0?s=128&d=identicon&r=PG", "display_name": "Mat&#237;as Insaurralde", "link": "https://stackoverflow.com/users/61360/mat%c3%adas-insaurralde"}, "reply_to_user": {"reputation": 667, "user_id": 7095694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh5.googleusercontent.com/-nLg_DXMQ9Rg/AAAAAAAAAAI/AAAAAAAAARI/qZtxSIR-UdU/photo.jpg?sz=128", "display_name": "Ertan Hasani", "link": "https://stackoverflow.com/users/7095694/ertan-hasani"}, "edited": false, "score": 0, "creation_date": 1527580286, "post_id": 50578859, "comment_id": 88167213, "body": "If &quot;go-bindata&quot; isn&#39;t available, you should adjust your PATH to include the GOPATH binary directory:  <code>export PATH=$GOPATH&#47;bin:$PATH</code>  Then try running &quot;go-bindata&quot; again."}, {"owner": {"reputation": 667, "user_id": 7095694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh5.googleusercontent.com/-nLg_DXMQ9Rg/AAAAAAAAAAI/AAAAAAAAARI/qZtxSIR-UdU/photo.jpg?sz=128", "display_name": "Ertan Hasani", "link": "https://stackoverflow.com/users/7095694/ertan-hasani"}, "edited": false, "score": 0, "creation_date": 1527581323, "post_id": 50578859, "comment_id": 88167856, "body": "just tried <code>set PATH=C:\\Users\\StarTech\\go\\src\\github.com\\jteeuwen\\go-bindata</code> and still the same."}, {"owner": {"reputation": 667, "user_id": 7095694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh5.googleusercontent.com/-nLg_DXMQ9Rg/AAAAAAAAAAI/AAAAAAAAARI/qZtxSIR-UdU/photo.jpg?sz=128", "display_name": "Ertan Hasani", "link": "https://stackoverflow.com/users/7095694/ertan-hasani"}, "edited": false, "score": 0, "creation_date": 1527581781, "post_id": 50578859, "comment_id": 88168106, "body": "I guess i had the wrong version of go-bindata. I just installed the one you provided here. And the error changed to : <code>Error: mkdir C:\\Users\\StarTech\\go\\src\\github.com\\wrouesnel\\postgres_expor&zwnj;&#8203;ter\\bin&#47;C:: The filename, directory name, or volume label syntax is incorrect. exit status 1</code>"}], "tags": [], "owner": {"reputation": 1014, "user_id": 61360, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/70602c12ed1c06db5165ff6a88cd38e0?s=128&d=identicon&r=PG", "display_name": "Mat&#237;as Insaurralde", "link": "https://stackoverflow.com/users/61360/mat%c3%adas-insaurralde"}, "is_accepted": false, "score": 0, "last_activity_date": 1527579464, "creation_date": 1527579464, "answer_id": 50578859, "question_id": 50578796, "link": "https://stackoverflow.com/questions/50578796/error-mkdir-the-filename-directory-name-or-volume-label-syntax-is-incorrec/50578859#50578859", "title": "Error: mkdir ... The filename, directory name or volume label syntax is incorrect", "body": "<p>Try installing <code>go-bindata</code>:</p>\n\n<pre><code>go get -u github.com/tmthrgd/go-bindata/...\n</code></pre>\n"}], "owner": {"reputation": 667, "user_id": 7095694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh5.googleusercontent.com/-nLg_DXMQ9Rg/AAAAAAAAAAI/AAAAAAAAARI/qZtxSIR-UdU/photo.jpg?sz=128", "display_name": "Ertan Hasani", "link": "https://stackoverflow.com/users/7095694/ertan-hasani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 823, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1527586627, "creation_date": 1527579268, "last_edit_date": 1527586627, "question_id": 50578796, "link": "https://stackoverflow.com/questions/50578796/error-mkdir-the-filename-directory-name-or-volume-label-syntax-is-incorrec", "title": "Error: mkdir ... The filename, directory name or volume label syntax is incorrect", "body": "<p>I am using <code>postgres_exporter</code> for <code>prometheus</code>, and when I am trying to run it it shows me an error:</p>\n\n<blockquote>\n  <p>Error: failed to run \"go-bindata -pkg=assets -o assets/bindata.go -ignore=bindata.go -ignore=.*.map$ -prefix=assets/generated assets/generated/...: exec: \"go-bindata\": executable file not found in %PATH%\"\n  exit status 1</p>\n</blockquote>\n\n<p>I realised that I had the wrong library of go-bindata installed. So after I installed the other one, error has changed to :</p>\n\n<blockquote>\n  <p>Error: mkdir C:\\Users\\StarTech\\go\\src\\github.com\\wrouesnel\\postgres_exporter\\bin/C:: The filename, directory name, or volume label syntax is incorrect.\n  exit status 1</p>\n</blockquote>\n\n<p>This is the link of <code>postgres_exporter</code>:\n<a href=\"https://github.com/wrouesnel/postgres_exporter\" rel=\"nofollow noreferrer\">postgres_exporter</a></p>\n\n<p>First i type these commands:</p>\n\n<pre><code>go get github.com/wrouesnel/postgres_exporter\ncd path/src/github.com/wrouesnel/postgres_exporter\ngo run mage.go\nexport DATA_SOURCE_NAME=\"postgresql://login:password@hostname:port/dbname\"\n./postgres_exporter &lt;flags&gt;\n</code></pre>\n\n<p>Also i am using <code>run</code> command instead of <code>export</code> since I'm on Windows.</p>\n\n<p>And error happens when I type command <code>go run mage.go docker</code></p>\n"}, {"tags": ["go", "azure-devops"], "comments": [{"owner": {"reputation": 710, "user_id": 3276241, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X2icQ.jpg?s=128&g=1", "display_name": "Oleksandr Mosur", "link": "https://stackoverflow.com/users/3276241/oleksandr-mosur"}, "edited": false, "score": 1, "creation_date": 1527576621, "post_id": 50576910, "comment_id": 88165059, "body": "That workaround similar to github private repos, found here <a href=\"https://gist.github.com/shurcooL/6927554\" rel=\"nofollow noreferrer\">gist.github.com/shurcooL/6927554</a>. So looks like good solution for using <code>go get ...</code>"}, {"owner": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "edited": false, "score": 0, "creation_date": 1539414521, "post_id": 50576910, "comment_id": 92501687, "body": "There are a couple of issues raised against vsts about this <a href=\"https://visualstudio.uservoice.com/forums/330519-visual-studio-team-services/suggestions/34888885-support-repos-for-golang-by-providing-a-url-alias\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://visualstudio.uservoice.com/forums/330519-visual-studio-team-services/suggestions/20364613-add-golang-support-to-vsts-git\" rel=\"nofollow noreferrer\">here</a>, go vote!"}, {"owner": {"reputation": 3281, "user_id": 4131775, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KDmA5SDbD84/AAAAAAAAAAI/AAAAAAAAAAA/WQxPLtYrNu4/photo.jpg?sz=128", "display_name": "Feiyu Zhou", "link": "https://stackoverflow.com/users/4131775/feiyu-zhou"}, "reply_to_user": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "edited": false, "score": 0, "creation_date": 1539418195, "post_id": 50576910, "comment_id": 92502514, "body": "@ChrisDrew voted it before"}], "answers": [{"comments": [{"owner": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "edited": false, "score": 0, "creation_date": 1539415633, "post_id": 50579877, "comment_id": 92501944, "body": "Useful info but I think the biggest problem is not credentials but the problem of vsts import paths, see <a href=\"https://visualstudio.uservoice.com/forums/330519-visual-studio-team-services/suggestions/34888885-support-repos-for-golang-by-providing-a-url-alias\" rel=\"nofollow noreferrer\">here</a>, <a href=\"https://visualstudio.uservoice.com/forums/330519-visual-studio-team-services/suggestions/20364613-add-golang-support-to-vsts-git\" rel=\"nofollow noreferrer\">here</a> and <a href=\"http://ppanyukov.github.io/2017/02/01/golang-with-vsts-repos.html\" rel=\"nofollow noreferrer\">here</a>"}], "tags": [], "owner": {"reputation": 32525, "user_id": 6936103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/860fa18931fc7f7f6aa5908fce669304?s=128&d=identicon&r=PG&f=1", "display_name": "Marina Liu", "link": "https://stackoverflow.com/users/6936103/marina-liu"}, "is_accepted": true, "score": 5, "last_activity_date": 1527583081, "creation_date": 1527583081, "answer_id": 50579877, "question_id": 50576910, "link": "https://stackoverflow.com/questions/50576910/golang-support-to-vsts-git/50579877#50579877", "title": "Golang support to VSTS Git", "body": "<p>The main question to use <code>go get</code> to get the packages and dependencies from VSTS git repo is the <strong>credential issue</strong>. So solutions should be separate with the ways provider credential to VSTS git repo. Options as below:</p>\n\n<ol>\n<li><p><strong>Authentication with PAT</strong></p>\n\n<p>As the <a href=\"http://ppanyukov.github.io/2017/02/01/golang-with-vsts-repos.html\" rel=\"noreferrer\">link</a> you showed, you can auth with PAT. </p>\n\n<p>First,create a <a href=\"https://docs.microsoft.com/en-us/vsts/accounts/use-personal-access-tokens-to-authenticate?view=vsts\" rel=\"noreferrer\">personal access token</a>, then you can add PAT in the global <code>.gitignore</code> file:</p>\n\n<pre><code>[url \"https://Personal%20Access%20Token:PAT@account.account.com\"]\n</code></pre></li>\n<li><p><strong>Authentication with alternate credential</strong></p>\n\n<p>Enable and set <a href=\"https://docs.microsoft.com/en-us/vsts/git/auth-overview?view=vsts#alternate-credentials\" rel=\"noreferrer\">alternate authentication credentials</a>, then add below line in global <code>.gitignore</code>:</p>\n\n<pre><code>[url \"https://SecondaryUserName:SecondaryPassword@account.visualstudio.com\"]\n</code></pre></li>\n<li><p><strong>Authentication with SSH</strong></p>\n\n<p>As  Oleksandr mentioned, you can use SSH protocol instead.</p>\n\n<p>First, create a <a href=\"https://docs.microsoft.com/en-us/vsts/git/auth-overview?view=vsts#ssh-key-authentication\" rel=\"noreferrer\">SSH</a> key and add it to VSTS, then you can add below line in global <code>.gitignore</code>:</p>\n\n<pre><code>[url \"ssh://account@vs-ssh.visualstudio.com:22\"]\n</code></pre></li>\n</ol>\n\n<p>Then you can use the command <code>go get &lt;VSTS git repo URL&gt;</code> to download and install packages and dependencies.</p>\n"}], "owner": {"reputation": 3281, "user_id": 4131775, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KDmA5SDbD84/AAAAAAAAAAI/AAAAAAAAAAA/WQxPLtYrNu4/photo.jpg?sz=128", "display_name": "Feiyu Zhou", "link": "https://stackoverflow.com/users/4131775/feiyu-zhou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 1, "accepted_answer_id": 50579877, "answer_count": 1, "score": 2, "last_activity_date": 1527583081, "creation_date": 1527571919, "question_id": 50576910, "link": "https://stackoverflow.com/questions/50576910/golang-support-to-vsts-git", "title": "Golang support to VSTS Git", "body": "<p>I want to start a <code>Go</code> project in our team's VSTS. After creating the new repository, how can i use the command <code>go get</code> to get the copy of the repository like using in github? </p>\n\n<p>I find a workaround about <a href=\"http://ppanyukov.github.io/2017/02/01/golang-with-vsts-repos.html\" rel=\"nofollow noreferrer\">golang with visualstudio.com git repos</a>. Is there any other better solution?</p>\n"}, {"tags": ["go", "web-scraping", "evernote"], "comments": [{"owner": {"reputation": 710, "user_id": 3276241, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X2icQ.jpg?s=128&g=1", "display_name": "Oleksandr Mosur", "link": "https://stackoverflow.com/users/3276241/oleksandr-mosur"}, "edited": false, "score": 0, "creation_date": 1527577115, "post_id": 50576248, "comment_id": 88165348, "body": "I think evernote in first request should respond some headers with token or smthing like that, and then use them in next requests. Without that evernote has no idea who you are."}], "answers": [{"tags": [], "owner": {"reputation": 1014, "user_id": 61360, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/70602c12ed1c06db5165ff6a88cd38e0?s=128&d=identicon&r=PG", "display_name": "Mat&#237;as Insaurralde", "link": "https://stackoverflow.com/users/61360/mat%c3%adas-insaurralde"}, "is_accepted": false, "score": 7, "last_activity_date": 1527579359, "creation_date": 1527579359, "answer_id": 50578828, "question_id": 50576248, "link": "https://stackoverflow.com/questions/50576248/using-colly-framework-i-cant-login-to-the-evernote-account/50578828#50578828", "title": "Using Colly framework I can&#39;t login to the Evernote account", "body": "<p>You should try to mimic the browser behavior, take a look at this implementation, I've added comments on each step:</p>\n\n<pre><code>package evernote\n\nimport (\n    \"bytes\"\n    \"errors\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"net/http/cookiejar\"\n    \"net/url\"\n    \"regexp\"\n    \"strings\"\n)\n\nconst (\n    evernoteLoginURL = \"https://www.evernote.com/Login.action\"\n)\n\nvar (\n    evernoteJSParamsExpr = regexp.MustCompile(`document.getElementById\\(\"(.*)\"\\).value = \"(.*)\"`)\n    evernoteRedirectExpr = regexp.MustCompile(`Redirecting to &lt;a href=\"(.*)\"&gt;`)\n\n    errNoMatches   = errors.New(\"No matches\")\n    errRedirectURL = errors.New(\"Redirect URL not found\")\n)\n\n// EvernoteClient wraps all methods required to interact with the website.\ntype EvernoteClient struct {\n    Username   string\n    Password   string\n    httpClient *http.Client\n\n    // These parameters persist during the login process:\n    hpts  string\n    hptsh string\n}\n\n// NewEvernoteClient initializes a new Evernote client.\nfunc NewEvernoteClient(username, password string) *EvernoteClient {\n    // Allocate a new cookie jar to mimic the browser behavior:\n    cookieJar, _ := cookiejar.New(nil)\n\n    // Fill up basic data:\n    c := &amp;EvernoteClient{\n        Username: username,\n        Password: password,\n    }\n\n    // When initializing the http.Client, copy default values from http.DefaultClient\n    // Pass a pointer to the cookie jar that was created earlier:\n    c.httpClient = &amp;http.Client{\n        Transport:     http.DefaultTransport,\n        CheckRedirect: http.DefaultClient.CheckRedirect,\n        Jar:           cookieJar,\n        Timeout:       http.DefaultClient.Timeout,\n    }\n    return c\n}\n\nfunc (e *EvernoteClient) extractJSParams(body []byte) (err error) {\n    matches := evernoteJSParamsExpr.FindAllSubmatch(body, -1)\n    if len(matches) == 0 {\n        return errNoMatches\n    }\n    for _, submatches := range matches {\n        if len(submatches) &lt; 3 {\n            err = errNoMatches\n            break\n        }\n        key := submatches[1]\n        val := submatches[2]\n\n        if bytes.Compare(key, hptsKey) == 0 {\n            e.hpts = string(val)\n        }\n        if bytes.Compare(key, hptshKey) == 0 {\n            e.hptsh = string(val)\n        }\n    }\n    return nil\n}\n\n// Login handles the login action.\nfunc (e *EvernoteClient) Login() error {\n    // First step: fetch the login page as a browser visitor would do:\n    res, err := e.httpClient.Get(evernoteLoginURL)\n    if err != nil {\n        return err\n    }\n    if res.Body == nil {\n        return errors.New(\"No response body\")\n    }\n    body, err := ioutil.ReadAll(res.Body)\n    if err != nil {\n        return err\n    }\n    err = e.extractJSParams(body)\n    if err != nil {\n        return err\n    }\n\n    // Second step: we have extracted the \"hpts\" and \"hptsh\" parameters\n    // We send a request using only the username and setting \"evaluateUsername\":\n    values := &amp;url.Values{}\n    values.Set(\"username\", e.Username)\n    values.Set(\"evaluateUsername\", \"\")\n    values.Set(\"analyticsLoginOrigin\", \"login_action\")\n    values.Set(\"clipperFlow\", \"false\")\n    values.Set(\"showSwitchService\", \"true\")\n    values.Set(\"hpts\", e.hpts)\n    values.Set(\"hptsh\", e.hptsh)\n\n    rawValues := values.Encode()\n    req, err := http.NewRequest(http.MethodPost, evernoteLoginURL, bytes.NewBufferString(rawValues))\n    if err != nil {\n        return err\n    }\n    req.Header.Set(\"Accept\", \"application/json\")\n    req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded; charset=UTF-8\")\n    req.Header.Set(\"x-requested-with\", \"XMLHttpRequest\")\n    req.Header.Set(\"referer\", evernoteLoginURL)\n    res, err = e.httpClient.Do(req)\n    if err != nil {\n        return err\n    }\n    body, err = ioutil.ReadAll(res.Body)\n    if err != nil {\n        return err\n    }\n    bodyStr := string(body)\n    if !strings.Contains(bodyStr, `\"usePasswordAuth\":true`) {\n        return errors.New(\"Password auth not enabled\")\n    }\n\n    // Third step: do the final request, append password to form data:\n    values.Del(\"evaluateUsername\")\n    values.Set(\"password\", e.Password)\n    values.Set(\"login\", \"Sign in\")\n\n    rawValues = values.Encode()\n    req, err = http.NewRequest(http.MethodPost, evernoteLoginURL, bytes.NewBufferString(rawValues))\n    if err != nil {\n        return err\n    }\n    req.Header.Set(\"Accept\", \"text/html\")\n    req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded; charset=UTF-8\")\n    req.Header.Set(\"x-requested-with\", \"XMLHttpRequest\")\n    req.Header.Set(\"referer\", evernoteLoginURL)\n    res, err = e.httpClient.Do(req)\n    if err != nil {\n        return err\n    }\n\n    // Check the body in order to find the redirect URL:\n    body, err = ioutil.ReadAll(res.Body)\n    if err != nil {\n        return err\n    }\n    bodyStr = string(body)\n    matches := evernoteRedirectExpr.FindAllStringSubmatch(bodyStr, -1)\n    if len(matches) == 0 {\n        return errRedirectURL\n    }\n    m := matches[0]\n    if len(m) &lt; 2 {\n        return errRedirectURL\n    }\n    redirectURL := m[1]\n    fmt.Println(\"Login is ok, redirect URL:\", redirectURL)\n    return nil\n}\n</code></pre>\n\n<p>After you successfully get the redirect URL, you should be able to send authenticated requests as long as you keep using the HTTP client that was used for the login process, the cookie jar plays a very important role here.</p>\n\n<p>To call this code use:</p>\n\n<pre><code>func main() {\n    evernoteClient := NewEvernoteClient(\"user@company\", \"password\")\n    err := evernoteClient.Login()\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 281, "user_id": 5803667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ded144b5e001ea398abbb06fc8db0f4?s=128&d=identicon&r=PG&f=1", "display_name": "John Davis", "link": "https://stackoverflow.com/users/5803667/john-davis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1699, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1612865311, "creation_date": 1527567577, "last_edit_date": 1612865311, "question_id": 50576248, "link": "https://stackoverflow.com/questions/50576248/using-colly-framework-i-cant-login-to-the-evernote-account", "title": "Using Colly framework I can&#39;t login to the Evernote account", "body": "<p>I am using colly framework for scraping the website. Am trying to login the Evernote account for scraping some things. But I can't go through it. I used &quot;username&quot; and &quot;password&quot; titles for giving the credentials. Is this the right way ?.</p>\n<p>Thank you in advance.</p>\n<pre><code>package main\n\nimport (\n &quot;log&quot;\n &quot;github.com/gocolly/colly&quot;\n)\n\nfunc main() {\n // create a new collector\n c := colly.NewCollector()\n\n// authenticate\nerr := c.Post(&quot;https://www.evernote.com/Login.action&quot;, \nmap[string]string{&quot;username&quot;: \n  &quot;XXXXXX@XXX.com&quot;, &quot;password&quot;: &quot;*********&quot;})\n\nif err != nil {\n    log.Fatal(&quot;Error : &quot;,err)\n}\n\n    // attach callbacks after login\n   c.OnResponse(func(r *colly.Response) {\n        log.Println(&quot;response received&quot;, r.StatusCode)\n   })\n\n    // start scraping\n   c.Visit(&quot;https://www.evernote.com/&quot;)\n}\n</code></pre>\n"}, {"tags": ["debugging", "go", "emacs", "delve"], "comments": [{"owner": {"reputation": 21, "user_id": 9861595, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Arvind Parthasarathy", "link": "https://stackoverflow.com/users/9861595/arvind-parthasarathy"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527685919, "post_id": 50575786, "comment_id": 88220597, "body": "Thanks @Flimzy for making the edits. Appreciate it."}], "owner": {"reputation": 21, "user_id": 9861595, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Arvind Parthasarathy", "link": "https://stackoverflow.com/users/9861595/arvind-parthasarathy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 284, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1527576851, "creation_date": 1527563336, "last_edit_date": 1527576851, "question_id": 50575786, "link": "https://stackoverflow.com/questions/50575786/prompt-missing-running-delve-using-gud-in-emacs", "title": "prompt missing running delve using gud in emacs?", "body": "<p>Here is the experience running delve from the command line on my Windows 10 desktop using MSYS-2:</p>\n\n<p><a href=\"https://i.stack.imgur.com/1dE5k.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1dE5k.png\" alt=\"enter image description here\"></a></p>\n\n<p>Now here is the experience running delve from GNU emacs (W64) version 25.1.1 -<br>\nShellPrompt> emacs -nw H:/code/Go/book/chap1_lissajous/lissajous.go<br>\nC-x-2<br>\nM-x dlv<br>\nRun dlv (like this): dlv debug H:/code/Go/book/chap1_lissajous/lissajous.go<br>\nNavigate to lissajous.go:34 and hit C-x-C-a-C-b to toggle a breakpoint\nNavigate to dlv buffer\nHit 'c', and the experience looks like this for this entire interaction: </p>\n\n<p><a href=\"https://i.stack.imgur.com/kfJH9.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/kfJH9.png\" alt=\"enter image description here\"></a></p>\n\n<p>Notice the absence of <strong>(dlv)</strong> in front of the c (continue) command when running using emacs. The result is the same using emacs in non-terminal mode as well.</p>\n\n<p>I tried to find any gud customizations that needed to be applied for the prompt to show up. I could not find any, and I was unable to find anyone else facing this issue online. Does anybody know if I am missing something?</p>\n\n<p>NOTE: I have had to post images instead of formatted text because I couldn't figure how to get markdown to render the code in a formatted way with the line numbers from the debugger. I wasn't allowed to post the question with unformatted code. I apologize to those who are only able to view the text of my post and not the images. The images are needed to view the question completely.</p>\n"}, {"tags": ["go", "middleware"], "answers": [{"tags": [], "owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "is_accepted": true, "score": 13, "last_activity_date": 1527561890, "last_edit_date": 1527561890, "creation_date": 1527561064, "answer_id": 50575548, "question_id": 50574796, "link": "https://stackoverflow.com/questions/50574796/gin-gonic-middleware-declaration/50575548#50575548", "title": "Gin-Gonic middleware declaration", "body": "<p>You can certainly just do this if you prefer it:</p>\n\n<pre><code>func MyMiddleware(c *gin.Context) {\n    // middleware\n}\nr := gin.New()\nr.Use(MyMiddleware)\n</code></pre>\n\n<p>The most probably reason why it is suggested that you do this instead:</p>\n\n<pre><code>func MyMiddleware() gin.HandlerFunc {\n    return func (c *gin.Context) {\n        // middleware\n    }\n}\nr := gin.New()\nr.Use(MyMiddleware())\n</code></pre>\n\n<p>is, so you can add parameters, the example used in here: <a href=\"https://github.com/gin-gonic/gin#custom-middleware\" rel=\"noreferrer\">https://github.com/gin-gonic/gin#custom-middleware</a> is a logging middleware.:</p>\n\n<pre><code>func Logger() gin.HandlerFunc {\n    return func(c *gin.Context) {\n        // code goes here\n    }\n}\n</code></pre>\n\n<p>It didn't have any params, but you can use custom logger like <a href=\"https://github.com/sirupsen/logrus\" rel=\"noreferrer\">logrus</a> inside your middleware by adding a param:</p>\n\n<p>You can have a logging middleware like this:</p>\n\n<pre><code>func Logger(log *logrus.Logger) gin.HandlerFunc {\n    return func(c *gin.Context) {\n        // use logrus\n        log.WithFields(log.Fields{\n          \"animal\": \"walrus\",\n        }).Info(\"A walrus appears\")\n\n    }\n}\n</code></pre>\n\n<p>And use it like this:</p>\n\n<pre><code>var log = logrus.New()\nr.Use(Logger(log))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 136, "user_id": 7132093, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hIQVpzG2-Ho/AAAAAAAAAAI/AAAAAAAAAOU/2jreotspAFk/photo.jpg?sz=128", "display_name": "Hunsin", "link": "https://stackoverflow.com/users/7132093/hunsin"}, "is_accepted": false, "score": 2, "last_activity_date": 1527561275, "creation_date": 1527561275, "answer_id": 50575567, "question_id": 50574796, "link": "https://stackoverflow.com/questions/50574796/gin-gonic-middleware-declaration/50575567#50575567", "title": "Gin-Gonic middleware declaration", "body": "<p>Yes, you can.</p>\n\n<p>Sometimes a middleware takes arguments. For example:</p>\n\n<pre><code>MyMiddleware(foo string) gin.HandlerFunc {\n\n    // preprocess with argument foo\n\n    return func(c *gin.Context) {\n        // do something related with foo...\n    }\n}\n</code></pre>\n\n<p>Take <a href=\"https://github.com/gin-gonic/gin/blob/master/auth.go#L42\" rel=\"nofollow noreferrer\">gin.BasicAuthForRealm</a> for example. Before checking the authorization from HTTP requests, you must provide it the auth data.</p>\n\n<pre><code>func BasicAuthForRealm(accounts Accounts, realm string) HandlerFunc {\n    // ...\n}\n</code></pre>\n\n<p>For middlewares taking no argument, I think they just want to keep them in same format.</p>\n"}, {"tags": [], "owner": {"reputation": 4783, "user_id": 2939061, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NoM9S.gif?s=128&g=1", "display_name": "quasoft", "link": "https://stackoverflow.com/users/2939061/quasoft"}, "is_accepted": false, "score": 0, "last_activity_date": 1573062240, "creation_date": 1573062240, "answer_id": 58735816, "question_id": 50574796, "link": "https://stackoverflow.com/questions/50574796/gin-gonic-middleware-declaration/58735816#58735816", "title": "Gin-Gonic middleware declaration", "body": "<p>The variant returning a function, could also allow the middleware to perform some initialization,  if needed:</p>\n\n<pre><code>func MyMiddleware() gin.HandlerFunc {\n    // Perform initialization here...\n    return func (c *gin.Context) {\n        // middleware\n    }\n}\n\nr := gin.New()\nr.Use(MyMiddleware())\n</code></pre>\n\n<p>That initialization would execute only once (when the middleware is attached to the request), and not for every request.</p>\n\n<p>Could be useful, if you are writing a middleware that requires initialization, but you have no control on how others will use it.</p>\n"}], "owner": {"reputation": 83, "user_id": 3022872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfdeb0327e282abc6b912dfdb22717ab?s=128&d=identicon&r=PG&f=1", "display_name": "cHz", "link": "https://stackoverflow.com/users/3022872/chz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7596, "favorite_count": 4, "accepted_answer_id": 50575548, "answer_count": 3, "score": 7, "last_activity_date": 1573062240, "creation_date": 1527553763, "question_id": 50574796, "link": "https://stackoverflow.com/questions/50574796/gin-gonic-middleware-declaration", "title": "Gin-Gonic middleware declaration", "body": "<p>I'm using Gin-Gonic and I'm creating a custom middleware. See: <a href=\"https://github.com/gin-gonic/gin#custom-middleware\" rel=\"noreferrer\">https://github.com/gin-gonic/gin#custom-middleware</a></p>\n\n<p>Is there a reason why the middlewares in the doc are written as such:</p>\n\n<pre><code>func MyMiddleware() gin.HandlerFunc {\n    return func (c *gin.Context) {\n        // middleware\n    }\n}\nr := gin.New()\nr.Use(MyMiddleware())\n</code></pre>\n\n<p>When I could simply write it like this:</p>\n\n<pre><code>func MyMiddleware(c *gin.Context) {\n    // middleware\n}\nr := gin.New()\nr.Use(MyMiddleware)\n</code></pre>\n\n<p>Thanks for your help!</p>\n"}, {"tags": ["multithreading", "go", "serial-port"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527579663, "post_id": 50573709, "comment_id": 88166824, "body": "Note that you&#39;re not actually doing multithreading, per se. You&#39;re doing concurrency. This can happen the same way in a single thread."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527579715, "post_id": 50573709, "comment_id": 88166857, "body": "Note that <code>for true</code> is the same as <code>for</code>.  That is, you can omit the &quot;true&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 347, "user_id": 4206183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/896dd7976b1309d64c083c238d8fb710?s=128&d=identicon&r=PG&f=1", "display_name": "Melissa", "link": "https://stackoverflow.com/users/4206183/melissa"}, "edited": false, "score": 0, "creation_date": 1527619958, "post_id": 50574251, "comment_id": 88191535, "body": "If I were to just use sync.WaitGroup would that be enough? Sorry I&#39;m still fairly new to the language and this is my first time working with both Go and serial ports."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1527569277, "last_edit_date": 1527569277, "creation_date": 1527547910, "answer_id": 50574251, "question_id": 50573709, "link": "https://stackoverflow.com/questions/50573709/reading-from-serial-port-using-arduino-giving-garbage-output/50574251#50574251", "title": "Reading from serial port using Arduino giving garbage output", "body": "<p>You are concurrently reading from and writing to a <code>bufio.Scanner</code> with no synchronization mechanism.</p>\n\n<p>Reference: <a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">Introducing the Go Race Detector</a></p>\n"}], "owner": {"reputation": 347, "user_id": 4206183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/896dd7976b1309d64c083c238d8fb710?s=128&d=identicon&r=PG&f=1", "display_name": "Melissa", "link": "https://stackoverflow.com/users/4206183/melissa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1527579628, "creation_date": 1527543749, "last_edit_date": 1527579628, "question_id": 50573709, "link": "https://stackoverflow.com/questions/50573709/reading-from-serial-port-using-arduino-giving-garbage-output", "title": "Reading from serial port using Arduino giving garbage output", "body": "<p>I'm currently trying to read input from the serial port through an Arduino using multithreading. I have two threads reading from the serial port, and they are both reading the <strong>same thing</strong> (ignore their function names). Here is the code: </p>\n\n<pre><code> func readFirstLine(scanner *bufio.Scanner, port *serial.Port){\n    for scanner.Scan() {\n        log.Printf(\"%q\\n\", scanner.Text())\n    }\n    time.Sleep(time.Duration(1)*time.Second)\n}\n\nfunc readSecondLine(scanner *bufio.Scanner, port *serial.Port){\n    time.Sleep(time.Duration(1)*time.Second)\n    for scanner.Scan() {\n        log.Printf(\"%q\\n\", scanner.Text())\n    }\n}\n\nfunc main() {\n    usbRead := &amp;serial.Config{Name: \"COM5\", Baud: 9600, ReadTimeout: 0}\n    port, err := serial.OpenPort(usbRead)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    scanner := bufio.NewScanner(port)\n\n    for true {\n        go readFirstLine(scanner, port)\n        go readSecondLine(scanner, port)\n        time.Sleep(time.Duration(2)*time.Second)\n    }\n}\n</code></pre>\n\n<p>I am expecting the output to look like this:</p>\n\n<pre><code>{\"temperature\":[26,26],\"humidity\":[54.2,54.2],\"sensor\":\"DHT22\"}\n{\"temperature\":[23.46041,23.46041],\"sensor\":\"LM35DZ\"}\n{\"blink\":[\"true\",\"true\"],\"actuator\":\"arduinoLED\"}\n{\"temperature\":[26,26],\"humidity\":[54.2,54.2],\"sensor\":\"DHT22\"}\n{\"temperature\":[23.46041,23.46041],\"sensor\":\"LM35DZ\"}\n{\"blink\":[\"true\",\"true\"],\"actuator\":\"arduinoLED\"}\n</code></pre>\n\n<p>Yet I am getting garbage output in between the expected output: </p>\n\n<pre><code>\"{\\\"temperature\\\":[23.46041,23.46041,23.46041],\\\"sensor\\\":\\\"LM35DZ\\\"}\"\n\"{\\\"blink\\\":[\\\"true\\\",\\\"true\\\",\\\"true\\\"],\\\"actuator\\\":\\\"arduinoLED\\\"}\"\n\"mpeer\\x00\\x00re\\\"u:\\x00\\x00[]6\\x00midhui\\x00\\x00[54\\\":.\\x00\\x00sen,\\\"s\\x00\\x00:or\\\"\\\"TH\\x00\"\n{\\\"}\\\"\\x00\\x00ptemurrate\\x003.4[26\\x00\\x00,\\\"s1]e\\x00\\x00\\\":\\\"orL\\x00\\x00Z\\\"}5D\\r\\x00\\x00\\x00\"\n</code></pre>\n\n<p>I believe this garbage output appears because I am reading serial port input even when the Arduino hasn't outputted anything. Is there any ideas on how to fix this? Thanks.  </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1219, "user_id": 3864339, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aQ1gO.jpg?s=128&g=1", "display_name": "Juan Cespedes", "link": "https://stackoverflow.com/users/3864339/juan-cespedes"}, "is_accepted": true, "score": 1, "last_activity_date": 1527685260, "creation_date": 1527685260, "answer_id": 50605405, "question_id": 50573657, "link": "https://stackoverflow.com/questions/50573657/finding-test-dependencies-of-a-go-program/50605405#50605405", "title": "Finding test dependencies of a Go program", "body": "<p>I am afraid there is no way to show all the recursive test dependencies using just one \"go list\".</p>\n\n<p>You will need to use at least two:</p>\n\n<pre><code>go list -f '{{join .Deps \"\\n\"}}' `go list -f '{{join .TestImports \" \"}}' ./...`\n</code></pre>\n"}], "owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 50605405, "answer_count": 1, "score": 3, "last_activity_date": 1527685260, "creation_date": 1527543477, "question_id": 50573657, "link": "https://stackoverflow.com/questions/50573657/finding-test-dependencies-of-a-go-program", "title": "Finding test dependencies of a Go program", "body": "<p>I am currently using <code>vendor/</code> directory to locally vendor my dependencies.</p>\n\n<pre><code>go list -f '{{join .Deps \"\\n\"}}' ./...  |grep -Eo 'vendor/.*'\n</code></pre>\n\n<p>This shows me all \"build dependencies\" used in my build, (that are used from <code>vendor/</code>). This feature is documented here: <a href=\"https://golang.org/cmd/go/#hdr-List_packages\" rel=\"nofollow noreferrer\">https://golang.org/cmd/go/#hdr-List_packages</a></p>\n\n<p>But it doesn't include your \"test dependencies\"!</p>\n\n<p>So to find my \"test dependencies\", I run this command:</p>\n\n<pre><code>$ go list -f '{{join .TestImports \"\\n\"}}' ./...  |grep -Eo 'vendor/.*'\nvendor/github.com/stretchr/testify/assert\n...\n</code></pre>\n\n<p>It correctly list the \"test imports\", but it doesn't list the \"dependencies\" of those test imports.</p>\n\n<p>For example, the <code>vendor/github.com/stretchr/testify/assert</code> directory listed above actually depends on <code>vendor/github.com/pmezard/go-difflib/difflib</code> (and a few other packages). This is not shown in the output above!</p>\n\n<p>But if I run this command, it shows the dependencies of <code>testify/assert</code>:</p>\n\n<pre><code>$ go list -f '{{join .Deps \"\\n\"}}' ./vendor/github.com/stretchr/testify/assert | grep -Eo 'vendor/.*'\nvendor/github.com/davecgh/go-spew/spew\nvendor/github.com/pmezard/go-difflib/difflib\n...\n</code></pre>\n\n<p>So it appears like I need to call <code>go list -f '{{join .Deps \"\\n\"}}'</code> on all \"test imports\" to find \"all test dependencies\"?</p>\n\n<p>Is there a more efficient way of doing this, ideally with a single <code>go list</code> call and some templating?</p>\n"}, {"tags": ["go", "full-text-search", "bleve"], "answers": [{"comments": [{"owner": {"reputation": 857, "user_id": 650108, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4021f746c5507082faea024fad98cd44?s=128&d=identicon&r=PG", "display_name": "user650108", "link": "https://stackoverflow.com/users/650108/user650108"}, "edited": false, "score": 0, "creation_date": 1527543924, "post_id": 50573656, "comment_id": 88156977, "body": "Thank you very much Moshe, it works like a charm! Fields are located in Hits, so I had to do a searchResults.Hits[0].Fields[&quot;Bio&quot;] to get it."}, {"owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "reply_to_user": {"reputation": 857, "user_id": 650108, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4021f746c5507082faea024fad98cd44?s=128&d=identicon&r=PG", "display_name": "user650108", "link": "https://stackoverflow.com/users/650108/user650108"}, "edited": false, "score": 0, "creation_date": 1527712975, "post_id": 50573656, "comment_id": 88236024, "body": "@user650108 Good catch ;-)"}, {"owner": {"reputation": 112, "user_id": 2197615, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K1NYq.jpg?s=128&g=1", "display_name": "navono", "link": "https://stackoverflow.com/users/2197615/navono"}, "edited": false, "score": 0, "creation_date": 1601025421, "post_id": 50573656, "comment_id": 113281603, "body": "\u300cAlternatively, you can pass []string{&quot;*&quot;} to return all fields.\u300d, pass to where?"}, {"owner": {"reputation": 112, "user_id": 2197615, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K1NYq.jpg?s=128&g=1", "display_name": "navono", "link": "https://stackoverflow.com/users/2197615/navono"}, "edited": false, "score": 0, "creation_date": 1601165453, "post_id": 50573656, "comment_id": 113320990, "body": "Just for note. Pass the Hits ID to index.Document will get fields, also if setup  the index Internal, use index.GetInternal with Hits ID will get the original struct."}], "tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": true, "score": 6, "last_activity_date": 1602607286, "last_edit_date": 1602607286, "creation_date": 1527543473, "answer_id": 50573656, "question_id": 50572998, "link": "https://stackoverflow.com/questions/50572998/how-to-use-golang-bleve-search-results/50573656#50573656", "title": "How to use golang bleve search results?", "body": "<p>Every hit in the search result is a <a href=\"https://godoc.org/github.com/blevesearch/bleve/search#DocumentMatch\" rel=\"nofollow noreferrer\">DocumentMatch</a>. You can see in the documentation that <code>DocumentMatch</code> has <code>Fields</code> which is a <code>map[string]interface{}</code> and can be accessed as follows:</p>\n<pre><code>searchResults.Hits[0].Fields[&quot;Bio&quot;].(string)\n</code></pre>\n<p>Bleve doesn't include the document's fields in the results by default. You must provide a list of the fields you'd like returned to <code>SearchRequest.Fields</code> (the argument to <code>index.Search</code>). Alternatively, you can set</p>\n<pre><code>searchRequest.Fields = []string{&quot;*&quot;}\n</code></pre>\n<p>to return all fields.</p>\n"}], "owner": {"reputation": 857, "user_id": 650108, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/4021f746c5507082faea024fad98cd44?s=128&d=identicon&r=PG", "display_name": "user650108", "link": "https://stackoverflow.com/users/650108/user650108"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1542, "favorite_count": 2, "accepted_answer_id": 50573656, "answer_count": 1, "score": 2, "last_activity_date": 1602607286, "creation_date": 1527538756, "question_id": 50572998, "link": "https://stackoverflow.com/questions/50572998/how-to-use-golang-bleve-search-results", "title": "How to use golang bleve search results?", "body": "<p>I am new to Go and <a href=\"http://www.blevesearch.com/\" rel=\"nofollow noreferrer\">Bleve</a> (sorry if I'm asking trivial things\u2026). This search engine seems to be really nice, but I am getting stuck when it comes to deal with my search results.</p>\n\n<p>Let's say we have a struct:</p>\n\n<pre><code>type Person struct {\n    Name string `json:\"name\"`\n    Bio  string `json:\"bio\"`\n}\n</code></pre>\n\n<p>Now, we extract data from the database (using sqlx lib):</p>\n\n<pre><code>rows := []Person{}\ndb.Select(&amp;rows, \"SELECT * FROM person\")\n</code></pre>\n\n<p>...and index it:</p>\n\n<pre><code>index.Index, err = bleve.Open(\"index.bleve\")\n\nbatch := index.Index.NewBatch()\n\ni := 0\nfor _, row := range rows {\n    rowId := fmt.Sprintf(\"%T_%d\", row, row.ID)\n    batch.Index(rowId, row)\n\n    i++\n    if i &gt; 100 {\n        index.Index.Batch(batch)\n        i = 0\n    }\n}\n</code></pre>\n\n<p>Now we have our index created. It works great.</p>\n\n<p>Using the <a href=\"http://www.blevesearch.com/docs/bleve_query/\" rel=\"nofollow noreferrer\">bleve command line utility</a>, it returns data correctly:</p>\n\n<pre><code>bleve query index.bleve doe\n\n3 matches, showing 1 through 3, took 27.767838ms\n    1. Person_68402 (0.252219)\n    Name\n        Doe\n    Bio\n        My name is John Doe!\n\n    2. ...\n</code></pre>\n\n<p>Here we see that bleve has stored <code>Name</code> and <code>Bio</code> fields.</p>\n\n<p>Now I want to do it to access it from my code!</p>\n\n<pre><code>query := bleve.NewMatchAllQuery()\nsearchRequest := bleve.NewSearchRequest(query)\nsearchResults, _ := index.Index.Search(searchRequest)\n\nfmt.Println(searchResults[0].ID) // &lt;- This works\n</code></pre>\n\n<p>But I don't only want the ID and then query the database to get the rest of the date. To <a href=\"http://django-haystack.readthedocs.io/en/v2.4.1/best_practices.html#avoid-hitting-the-database\" rel=\"nofollow noreferrer\">avoid hitting database</a>, I would like to be able to do something like:</p>\n\n<pre><code>fmt.Println(searchResults[0].Bio) // &lt;- This doesn't work :(\n</code></pre>\n\n<p>Could you please help?</p>\n"}, {"tags": ["go", "goroutine", "go-iris"], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 12, "last_activity_date": 1527531395, "last_edit_date": 1527531395, "creation_date": 1527530309, "answer_id": 50571492, "question_id": 50570961, "link": "https://stackoverflow.com/questions/50570961/stop-goroutine-execution-on-timeout/50571492#50571492", "title": "Stop goroutine execution on timeout", "body": "<p>There's no good way to \"interrupt\" the execution of a goroutine in the middle of it's execution. </p>\n\n<p>Go uses a fork-join model of concurrency, this means that you \"fork\" creating a new goroutine and then have no control over how that goroutine is scheduled until you get to a \"join point\". A join point is some kind of synchronisation between more than one goroutine. e.g. sending a value on a channel.</p>\n\n<p>Taking your specific example, this line:</p>\n\n<pre><code>ch &lt;- Response{data: \"data\", status: true}\n</code></pre>\n\n<p>... will be able to send the value, no matter what because it's a buffered channel. But the timeout's you've created:</p>\n\n<pre><code>case &lt;-time.After(50 * time.Millisecond):\n  return \"Timed out\", false\n</code></pre>\n\n<p>These timeouts are on the \"receiver\" or \"reader\" of the channel, and <em>not</em> on the \"sender\". As mentioned at the top of this answer, there's no way to interrupt the execution of a goroutine without using some synchronisation techniques.</p>\n\n<p>Because the timeouts are on the goroutine \"reading\" from the channel, there's nothing to stop the execution of the goroutine that send on the channel.</p>\n"}, {"comments": [{"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 1, "creation_date": 1568918276, "post_id": 50579561, "comment_id": 102437916, "body": "This example would not work. You will never be able to read from <code>ch</code> even if you set timeout as <code>case &lt;-time.After(50 * time.Second)</code>"}, {"owner": {"reputation": 710, "user_id": 3276241, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X2icQ.jpg?s=128&g=1", "display_name": "Oleksandr Mosur", "link": "https://stackoverflow.com/users/3276241/oleksandr-mosur"}, "reply_to_user": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 1, "creation_date": 1571938699, "post_id": 50579561, "comment_id": 103414038, "body": "Thanks @MikeKlemin, updated my answer with correct behaviour."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1571939133, "post_id": 50579561, "comment_id": 103414231, "body": "Also while the sleep is just an illustration for &quot;work goes here&quot;, if one ever does have a sleep need (e.g waiting between polling cycles), it&#39;s a good idea to create a Time channel e.g. <code>&lt;-time.After(10*time.Second)</code> and add this to the select statement. This then allows even the sleep to be interrupted."}, {"owner": {"reputation": 119, "user_id": 4833055, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/710532cf8f7ad65bb654e4434c88a84f?s=128&d=identicon&r=PG", "display_name": "Logan W", "link": "https://stackoverflow.com/users/4833055/logan-w"}, "edited": false, "score": 0, "creation_date": 1575327428, "post_id": 50579561, "comment_id": 104521458, "body": "This example is useful only to <code>time.Sleep</code> tho. If there&#39;s a long-running function, it cannot interrupt it (no early termination). <a href=\"https://play.golang.org/p/bv5XLyHyMoo\" rel=\"nofollow noreferrer\">Example</a>. There&#39;s no printing in this example. Please go with the highest voted answer."}, {"owner": {"reputation": 1370, "user_id": 2693017, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e048dcd4f95c384b7ffef14772d55b1e?s=128&d=identicon&r=PG&f=1", "display_name": "user2693017", "link": "https://stackoverflow.com/users/2693017/user2693017"}, "edited": false, "score": 0, "creation_date": 1593103414, "post_id": 50579561, "comment_id": 110669756, "body": "WARNING: this won&#39;t stop the go routine until it gets to the point where it checks ctx.Done()"}], "tags": [], "owner": {"reputation": 710, "user_id": 3276241, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X2icQ.jpg?s=128&g=1", "display_name": "Oleksandr Mosur", "link": "https://stackoverflow.com/users/3276241/oleksandr-mosur"}, "is_accepted": false, "score": 8, "last_activity_date": 1571938654, "last_edit_date": 1571938654, "creation_date": 1527582063, "answer_id": 50579561, "question_id": 50570961, "link": "https://stackoverflow.com/questions/50570961/stop-goroutine-execution-on-timeout/50579561#50579561", "title": "Stop goroutine execution on timeout", "body": "<p>Best way to control your <strong>goroutine processing</strong> is <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">context</a> (std go library).</p>\n\n<p>You can cancel something inside goroutine and stop execution <strong>without possible goroutine leak</strong>.</p>\n\n<p>Here simple <a href=\"https://play.golang.org/p/VYVuVGbZ6Ja\" rel=\"nofollow noreferrer\">example</a> with cancel by timeout for your case.</p>\n\n<pre><code>ctx, cancel := context.WithCancel(context.Background())\ndefer cancel()\n\nch := make(chan Response, 1)\n\ngo func() {\n    time.Sleep(1 * time.Second)\n\n    select {\n    default:\n        ch &lt;- Response{data: \"data\", status: true}\n    case &lt;-ctx.Done():\n        fmt.Println(\"Canceled by timeout\")\n        return\n    }\n}()\n\nselect {\ncase &lt;-ch:\n    fmt.Println(\"Read from ch\")\ncase &lt;-time.After(500 * time.Millisecond):\n    fmt.Println(\"Timed out\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 216, "user_id": 5039386, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y1c-Clsbdkw/AAAAAAAAAAI/AAAAAAAAAKA/WFHwWVc3h_I/photo.jpg?sz=128", "display_name": "Hau Ma", "link": "https://stackoverflow.com/users/5039386/hau-ma"}, "is_accepted": false, "score": 0, "last_activity_date": 1530862591, "last_edit_date": 1530862591, "creation_date": 1530185187, "answer_id": 51081744, "question_id": 50570961, "link": "https://stackoverflow.com/questions/50570961/stop-goroutine-execution-on-timeout/51081744#51081744", "title": "Stop goroutine execution on timeout", "body": "<p>You have a gouroutine leaks, you must handle some done action to return the goroutine before timeout like this:</p>\n\n<pre><code>func (s *CicService) Find() (interface{}, bool) {\n\n    ch := make(chan Response, 1)\n    done := make(chan struct{})\n    go func() {\n        select {\n        case &lt;-time.After(10 * time.Second):\n        case &lt;-done:\n            return\n        }\n        fmt.Println(\"test\")\n        fmt.Println(\"test1\")\n        ch &lt;- Response{data: \"data\", status: true}\n    }()\n    select {\n    case res := &lt;-ch:\n        return res.data, res.status\n    case &lt;-time.After(50 * time.Millisecond):\n        done &lt;- struct{}{}\n        return \"Timed out\", false\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 905, "user_id": 1699730, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tHYaE.jpg?s=128&g=1", "display_name": "Pandurang Waghulde", "link": "https://stackoverflow.com/users/1699730/pandurang-waghulde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8995, "favorite_count": 3, "answer_count": 3, "score": 10, "last_activity_date": 1571938654, "creation_date": 1527527676, "question_id": 50570961, "link": "https://stackoverflow.com/questions/50570961/stop-goroutine-execution-on-timeout", "title": "Stop goroutine execution on timeout", "body": "<p>I want to stop goroutine execution on timeout. But it seems like it is not working for me. I am using <code>iris</code> framework.</p>\n\n<pre><code>  type Response struct {\n    data   interface{}\n    status bool\n  }\n\n  func (s *CicService) Find() (interface{}, bool) {\n\n    ch := make(chan Response, 1)\n\n    go func() {\n      time.Sleep(10 * time.Second)\n\n      fmt.Println(\"test\")\n      fmt.Println(\"test1\")\n\n      ch &lt;- Response{data: \"data\", status: true}\n    }()\n\n    select {\n    case &lt;-ch:\n      fmt.Println(\"Read from ch\")\n      res := &lt;-ch\n      return res.data, res.status\n    case &lt;-time.After(50 * time.Millisecond):\n      return \"Timed out\", false\n    }\n\n  }\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code> Timed out\n test\n test1\n</code></pre>\n\n<p>Expected Output:</p>\n\n<pre><code> Timed out\n</code></pre>\n\n<p>Can somebody point out what is missing here? It does timeout but still runs goroutine to print <code>test</code> and <code>test1</code>. I just want to stop the execution of goroutine as soon as there is timeout.</p>\n"}, {"tags": ["go", "static-libraries", "archive"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1527523649, "post_id": 50569426, "comment_id": 88149936, "body": "Aren&#39;t you distributing a zip file anyway, with both pkg and src directories, with the latter containing your package documentation?"}, {"owner": {"reputation": 10789, "user_id": 471478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/30a04c96b889896beaffeb7c52cdb914?s=128&d=identicon&r=PG", "display_name": "scravy", "link": "https://stackoverflow.com/users/471478/scravy"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1527586307, "post_id": 50569426, "comment_id": 88170982, "body": "@TimCooper We will distribute something like this, but we would prefer if it was one archive so it&#39;s not immediately obvious what the dependencies are."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527596945, "post_id": 50569426, "comment_id": 88178020, "body": "Go packages <i>always</i> require a source file, even if it&#39;s only a <code>go:binary-only-package</code> stub. You can&#39;t package archives together if you want to work with the Go (creating an archive like this is only a minor obfuscation, what does it matter what the dependencies are?)"}, {"owner": {"reputation": 10789, "user_id": 471478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/30a04c96b889896beaffeb7c52cdb914?s=128&d=identicon&r=PG", "display_name": "scravy", "link": "https://stackoverflow.com/users/471478/scravy"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527599105, "post_id": 50569426, "comment_id": 88179456, "body": "@JimB I do understand that, as can be seen from the first paragraph in my question."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527599471, "post_id": 50569426, "comment_id": 88179677, "body": "@scravy: then I&#39;m not sure what you&#39;re asking. As you also said, you can pack the archives together, but it no longer works with the standard Go build tools."}], "owner": {"reputation": 10789, "user_id": 471478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/30a04c96b889896beaffeb7c52cdb914?s=128&d=identicon&r=PG", "display_name": "scravy", "link": "https://stackoverflow.com/users/471478/scravy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1527520764, "creation_date": 1527520764, "question_id": 50569426, "link": "https://stackoverflow.com/questions/50569426/bundling-a-static-library-as-a-single-archive", "title": "Bundling a static library as a single archive", "body": "<p>I am working on a go library which I intend to distribute as a binary artifact. Now I am aware that there are different <code>-buildmode</code> options and <code>archive</code> should pretty much do that for me and go 1.7+'s <code>//go:binary-only-package</code> makes the trick official.</p>\n\n<p>However, when I build my library the resulting archive (<code>*.a</code>) contains my library only, not any dependencies. I am in fact having a dependency which itself is binary only and comes as a statically linked archive itself (it's a C library which I am integrating with).</p>\n\n<p>Using proper native code archives I am actually able to assemble such a fat archive using <code>ar</code> or <code>libtool</code> trickery - but these tools do not really work with my go artifacts.</p>\n\n<p>Is there a way I can distribute a single <code>*.a</code> file or do I have to resort to packaging multiple archives into, say, a zip file which resembles the directory structure in <code>$GOPATH</code> and tell the my client's developers to just unzip that into their <code>$GOPATH</code> and be done with it?</p>\n"}, {"tags": ["go", "apache-kafka", "sarama"], "answers": [{"tags": [], "owner": {"reputation": 325, "user_id": 5345738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Oy3GI.jpg?s=128&g=1", "display_name": "Karmadon", "link": "https://stackoverflow.com/users/5345738/karmadon"}, "is_accepted": true, "score": 0, "last_activity_date": 1529653964, "creation_date": 1529653964, "answer_id": 50983214, "question_id": 50568713, "link": "https://stackoverflow.com/questions/50568713/how-to-get-multiple-subscriptions-in-sarama/50983214#50983214", "title": "How to get multiple subscriptions in sarama", "body": "<p><a href=\"https://github.com/bsm/sarama-cluster\" rel=\"nofollow noreferrer\">Sarama Cluster</a> helped for me</p>\n\n<pre><code>    brokers := []string{\"127.0.0.1:9092\"}\n    topics := []string{\"my_topic\", \"other_topic\"}\n    consumer, err := cluster.NewConsumer(brokers, \"my-consumer-group\", topics, config)\n    if err != nil {\n        panic(err)\n    }\n    defer consumer.Close()\n</code></pre>\n"}], "owner": {"reputation": 325, "user_id": 5345738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Oy3GI.jpg?s=128&g=1", "display_name": "Karmadon", "link": "https://stackoverflow.com/users/5345738/karmadon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 294, "favorite_count": 0, "accepted_answer_id": 50983214, "answer_count": 1, "score": 0, "last_activity_date": 1529653964, "creation_date": 1527518231, "last_edit_date": 1527591678, "question_id": 50568713, "link": "https://stackoverflow.com/questions/50568713/how-to-get-multiple-subscriptions-in-sarama", "title": "How to get multiple subscriptions in sarama", "body": "<p>Someone knows how to make a multi-subscription topics in Apache Kafka using Sarama</p>\n\n<p>I have a simple consumer, and I need to subscribe to three different topics</p>\n\n<pre><code>topic := \"Payments\" // need to be \"Payments\",\"System\",\"Orders\"\n\nconsumer, err := master.ConsumePartition(topic, 0, sarama.OffsetOldest)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 1, "creation_date": 1527517412, "post_id": 50568424, "comment_id": 88146828, "body": "The error is pretty clear, IMHO. What part of it do you not understand?"}, {"owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "reply_to_user": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 0, "creation_date": 1527517487, "post_id": 50568424, "comment_id": 88146874, "body": "@Biffen, I do understand the error. However, I wonder how to convert the byte to a string"}], "answers": [{"comments": [{"owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "edited": false, "score": 2, "creation_date": 1527517547, "post_id": 50568472, "comment_id": 88146899, "body": "Yes, it could be an option. But I do wonder, how one will go about converting byte array to a string array"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 9, "last_activity_date": 1577367537, "last_edit_date": 1577367537, "creation_date": 1527517363, "answer_id": 50568472, "question_id": 50568424, "link": "https://stackoverflow.com/questions/50568424/convert-a-byte-array-to-a-string-array/50568472#50568472", "title": "Convert a byte array to a string array", "body": "<p>Since your type is an array with a small length, so I would recommend just building the string without ranging over the elements:</p>\n\n<pre><code>func (ip IPAddr) String() string {\n    return fmt.Sprintf(\"%d.%d.%d.%d\", ip[0], ip[1], ip[2], ip[3])\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/nOSj-EyXuyf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/nOSj-EyXuyf</a></p>\n\n<p>If you want to implement your solution by joining the string slice, you need to convert the bytes to their decimal representation using the <code>strconv</code> package:</p>\n\n<pre><code>func (ip IPAddr) String() string {\n    s := make([]string, 0, len(ip))\n    for _, i := range ip {\n        s = append(s, strconv.Itoa(int(i)))\n    }\n    return strings.Join(s, \".\")\n}\n</code></pre>\n"}], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4017, "favorite_count": 0, "closed_date": 1527518950, "accepted_answer_id": 50568472, "answer_count": 1, "score": 4, "last_activity_date": 1577367537, "creation_date": 1527517205, "question_id": 50568424, "link": "https://stackoverflow.com/questions/50568424/convert-a-byte-array-to-a-string-array", "closed_reason": "Duplicate", "title": "Convert a byte array to a string array", "body": "<p>In the following method, I attempted to redefine the string method on the IPAddr type by appending bytes to an array of string</p>\n\n<pre><code>type IPAddr [4]byte\n\nfunc (ip IPAddr) String() string {\n    var s []string\n    for _, i := range ip {\n        s = append(s, i)\n    }\n    return fmt.Sprintf(strings.Join(s, \".\"))\n}\n</code></pre>\n\n<blockquote>\n  <p>cannot use i (type byte) as type string in append</p>\n</blockquote>\n\n<p><a href=\"https://play.golang.org/p/MbSac2RvLQ3\" rel=\"nofollow noreferrer\">playground</a></p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "edited": false, "score": 0, "creation_date": 1527520139, "post_id": 50567407, "comment_id": 88148314, "body": "What are you getting instead?"}, {"owner": {"reputation": 36192, "user_id": 7510657, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/jsd77.jpg?s=128&g=1", "display_name": "Ashh", "link": "https://stackoverflow.com/users/7510657/ashh"}, "edited": false, "score": 0, "creation_date": 1527522680, "post_id": 50567407, "comment_id": 88149555, "body": "<code>&quot;path&quot;: &quot;$merchant.merchantList&quot;</code> it should be <code>&quot;path&quot;: &quot;$merchantList&quot;</code>"}], "owner": {"reputation": 27, "user_id": 5169966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/190eba9278475e8fbe70aecd713e4df3?s=128&d=identicon&r=PG", "display_name": "andersonqi", "link": "https://stackoverflow.com/users/5169966/andersonqi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1527625004, "creation_date": 1527513449, "last_edit_date": 1527624201, "question_id": 50567407, "link": "https://stackoverflow.com/questions/50567407/use-lookup-in-an-array-of-objects-with-ids", "title": "Use lookup in an array of objects with ids", "body": "<p>I have a problem using lookup in an array of objects.</p>\n\n<p>My struct is</p>\n\n<pre><code>type MerchantList struct {\n    MerchantID       bson.ObjectId    `json:\"merchantId,omitempty\" bson:\"merchantId,omitempty\"`\n    Merchant         *Merchant        `json:\"merchant,omitempty\" bson:\"merchant,omitempty\"`\n    MerchantRevenue  float64          `json:\"merchantRevenue\" bson:\"merchantRevenue\"`\n    MerchantFee      int              `json:\"merchantFee,omitempty\" bson:\"merchantFee,omitempty\"`\n}\n\ntype Weeks struct {\n    ID               bson.ObjectId    `json:\"id,omitempty\" bson:\"_id,omitempty\" description:\"Object ID\"`\n    MerchantList     []*MerchantList  `json:\"merchantList,omitempty\" bson:\"merchantList,omitempty\"`\n    CreatedAt        int64            `json:\"createdAt\" bson:\"createdAt\" description:\"Created date.\"`\n    UpdatedAt        int64            `json:\"updatedAt\" bson:\"updatedAt\" description:\"Updated date.\"`\n}\n</code></pre>\n\n<p>I have a collection structured as follows:</p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"5af8bdb20b0aa02928514a00\"),\n    \"name\" : \"Week 1\",\n    \"merchantList\" : [ \n        {\n            \"merchantId\" : ObjectId(\"5ad79c500b0aa07ed040fe4b\"),\n            \"merchantRevenue\" : 126500.0,\n            \"merchantFee\" : 25\n        }\n    ]\n}\n</code></pre>\n\n<p>My query is </p>\n\n<pre><code>pipe := []bson.M{\n    {\"$unwind\": bson.M{\n        \"path\": \"$merchant.merchantList\",\n        \"preserveNullAndEmptyArrays\": true}},\n    {\"$lookup\": bson.M{\n        \"from\":         \"merchant\",\n        \"localField\":   \"merchantList.merchantId\",\n        \"foreignField\": \"_id\",\n        \"as\":           \"merchant\",\n    }},\n}\n</code></pre>\n\n<p>I would expect an exit from the program something like that</p>\n\n<pre><code>{\n    \"items\": [\n        {\n            \"id\": \"5af8bdb20b0aa02928514a00\",\n            \"merchantList\": [\n                {\n                    \"merchantId\": \"5ad79c500b0aa07ed040fe4b\",\n                    \"merchant\": {\n                        \"name\": \"Merchant 1\"\n                    }\n                }\n            ],\n        }\n    ]\n}\n</code></pre>\n\n<p>If anyone has any idea how to do it. It would be very helpful :)</p>\n"}, {"tags": ["go", "beego"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1527508298, "post_id": 50565750, "comment_id": 88141632, "body": "I hope you&#39;re not using <code>this</code> as a variable name in Go..."}, {"owner": {"reputation": 1, "user_id": 6323358, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hD5aa.jpg?s=128&g=1", "display_name": "Jun Fu", "link": "https://stackoverflow.com/users/6323358/jun-fu"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527508844, "post_id": 50565750, "comment_id": 88141942, "body": "I doubted this, the context here is for output in the source code ."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1527511248, "post_id": 50565750, "comment_id": 88143362, "body": "&quot;Does not work&quot; is not a problem description. The screenshot clearly show that the cookie does get set."}, {"owner": {"reputation": 1, "user_id": 6323358, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hD5aa.jpg?s=128&g=1", "display_name": "Jun Fu", "link": "https://stackoverflow.com/users/6323358/jun-fu"}, "edited": false, "score": 0, "creation_date": 1527515793, "post_id": 50565750, "comment_id": 88145970, "body": "On the cookies of chrome browser, I can not find the key UNION_TOKEN and it&#39;s value.@Volker"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 6323358, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hD5aa.jpg?s=128&g=1", "display_name": "Jun Fu", "link": "https://stackoverflow.com/users/6323358/jun-fu"}, "is_accepted": false, "score": 0, "last_activity_date": 1527564798, "creation_date": 1527564798, "answer_id": 50575940, "question_id": 50565750, "link": "https://stackoverflow.com/questions/50565750/how-to-share-cookies-between-subdomains-in-beego-frameworks/50575940#50575940", "title": "How to share cookies between subdomains in beego frameworks", "body": "<p>The cause is set-cookie by response does not work. \n1.Since it is an across sites Ajax request, .withCredentials() can active the ability of set cookie by response.</p>\n\n<pre><code>$.ajax( {\n   /* Setup the call */\n   xhrFields: {\n     withCredentials: true\n   }\n });\n</code></pre>\n\n<p>2.On the side of response server, \"<code>Access-Control-Allow-Credentials</code>\" must be \"<code>true</code>\" and \"<code>Access-Control-Allow-Origin</code>\" must not be \"<code>*</code>\" and \"Access-Control-Allow-Origin\" could be \"<code>http://*.domain.com</code>\".</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10044945, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IZAEIqKzW3k/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7ppolpN6nFoQlOAVD06vta45TaE2A/mo/photo.jpg?sz=128", "display_name": "Ping Zhao", "link": "https://stackoverflow.com/users/10044945/ping-zhao"}, "is_accepted": false, "score": 0, "last_activity_date": 1530950156, "creation_date": 1530950156, "answer_id": 51221148, "question_id": 50565750, "link": "https://stackoverflow.com/questions/50565750/how-to-share-cookies-between-subdomains-in-beego-frameworks/51221148#51221148", "title": "How to share cookies between subdomains in beego frameworks", "body": "<p>I find a solution to this question</p>\n\n<pre><code>beego.InsertFilter(\"*\",beego.BeforeRouter,func(ctx *context.Context) {\n        ctx.ResponseWriter.Header().Add(\"Access-Control-Allow-Origin\", \"*\")\n        ctx.ResponseWriter.Header().Add(\"Access-Control-Allow-Credentials\", \"true\")\n    })\n</code></pre>\n\n<p>if you want to send cookie in http,use \"<a href=\"http://XX\" rel=\"nofollow noreferrer\">http://XX</a>\" instead of \"*\",or you can set \"Access-Control-Allow-Origin\" seprately in an API,like that:</p>\n\n<pre><code>beego.InsertFilter(\"*\",beego.BeforeRouter,func(ctx *context.Context) {\n        ctx.ResponseWriter.Header().Add(\"Access-Control-Allow-Origin\", \"*\")\n        ctx.ResponseWriter.Header().Add(\"Access-Control-Allow-Credentials\", \"true\")\n    })\n\nfunc (c *ArticleController)AddArticle(){\n    c.Ctx.ResponseWriter.Header().Set(\"Access-Control-Allow-Origin\", \"http://XX\")\n}\n\n$.ajax( {\n   ...\n   xhrFields: {\n     withCredentials: true\n   }\n });\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6323358, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hD5aa.jpg?s=128&g=1", "display_name": "Jun Fu", "link": "https://stackoverflow.com/users/6323358/jun-fu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 360, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1530950156, "creation_date": 1527508191, "last_edit_date": 1527508280, "question_id": 50565750, "link": "https://stackoverflow.com/questions/50565750/how-to-share-cookies-between-subdomains-in-beego-frameworks", "title": "How to share cookies between subdomains in beego frameworks", "body": "<p>We intend to set cookie for *.1234tv.com in login.1234tv.com. However it does not work.</p>\n\n<p><a href=\"https://i.stack.imgur.com/4OhE1.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4OhE1.png\" alt=\"enter image description here\"></a></p>\n\n<p>I have configure the container as below:</p>\n\n<pre><code>beego.InsertFilter(\"*\", beego.BeforeRouter, cors.Allow(&amp;cors.Options{\n    AllowAllOrigins: true,\n    AllowOrigins:     []string{\"http://*.1234tv.com\"},\n    AllowMethods:    []string{\"GET\", \"POST\", \"PUT\", \"DELETE\",\"PATCH\",\"HEAD\", \"OPTIONS\"},\n    AllowHeaders:    []string{\"Origin\", \"Authorization\", \"Access-Control-Allow-Origin\", \"Content-Type\"},\n    ExposeHeaders:   []string{\"Content-Length\", \"Access-Control-Allow-Origin\"},\n    AllowCredentials: true,\n}))\n</code></pre>\n\n<p>and set cookie in controller like this:</p>\n\n<pre><code>this.Ctx.SetCookie(\"UNION_TOKEN\", utoken, 3600*24*7,\"/\", \".1234tv.com\",false,false)\n</code></pre>\n"}, {"tags": ["pointers", "go", "interface", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1527506100, "post_id": 50564969, "comment_id": 88140283, "body": "I can understand why passing a straight <code>Bar</code> in would leave us with something unmodifiable. However, why does making the pointer to the struct, rather than the interface, make all the difference? We have its address, so we have still pointed to the same data (the <code>Bar</code> itself) in memory, no? If we have its address, why can&#39;t we modify it just as we would a <code>*Bar</code>?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1527506184, "post_id": 50564969, "comment_id": 88140336, "body": "@ollien We don&#39;t have its address, that&#39;s the point. Its address would be of type <code>*Bar</code>. But what we have is an address of type <code>*Foo</code>. You can dereference the <code>*Foo</code> pointer which gives you the wrapped value <code>Bar</code>. But this is not a pointer type, so we still don&#39;t have the address of this <code>Bar</code> value."}, {"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1527506368, "post_id": 50564969, "comment_id": 88140457, "body": "Does the <code>*Foo</code> not contain the <code>Bar</code>? I think that is the source of my confusion. In my mind, they would be at the same location in memory, but I could very well be off-base."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1527506982, "post_id": 50564969, "comment_id": 88140839, "body": "@ollien The <code>*Foo</code> pointer points to an interface value, which is schemantically a (value; type) pair. This address is not the same as the address of the wrapped value. Having a <code>*Foo</code> pointer, you can&#39;t obtain an address to the wrapped <code>Bar</code> value (which would be of type <code>*Bar</code>)."}, {"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1527507298, "post_id": 50564969, "comment_id": 88141048, "body": "Why can you not get that address?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1527507592, "post_id": 50564969, "comment_id": 88141216, "body": "@ollien In short, because the language spec does not allow it. In long, because a copy is stored in interface values, and if it would be allowed to take the copy&#39;s address, you could only modify the copy which would be the source of even more confusion. For details, see this answer: <a href=\"https://stackoverflow.com/questions/36077566/how-can-a-slice-contain-itself/36078970#36078970\">How can a slice contain itself?</a>"}, {"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1527508455, "post_id": 50564969, "comment_id": 88141725, "body": "I guess this all makes sense - it seems like an intentional decision. One last thing though. You say that modifying the copy would be the source of confusion. Could you elaborate on that?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1527508949, "post_id": 50564969, "comment_id": 88142008, "body": "@ollien If you could obtain a pointer to the non-pointer wrapped value, you modify it, and you would expect the interface value to hold the new value, but obviously it wouldn&#39;t. This &quot;modification&quot; could be indirect, e.g. the wrapped value could have a method with pointer receiver which modifies the (pointed) receiver. You call this method, and everyone would think it modified the value (pointed by the receiver), yet, its effect would be lost as that would only be done on a copy."}, {"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1527509579, "post_id": 50564969, "comment_id": 88142392, "body": "I feel bad to keep drawing this out. I apologize. Why would the interface not hold the new value, if we are modifying the memory it points to? There&#39;s something I&#39;m missing here that I can&#39;t put my finger on."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1527509809, "post_id": 50564969, "comment_id": 88142525, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/171914/discussion-between-icza-and-ollien\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1527511591, "last_edit_date": 1527511591, "creation_date": 1527505625, "answer_id": 50564969, "question_id": 50564341, "link": "https://stackoverflow.com/questions/50564341/pointer-to-an-interface-vs-interface-holding-a-pointer-when-unmarshaling-json/50564969#50564969", "title": "Pointer to an interface vs interface holding a pointer when unmarshaling JSON", "body": "<p>The root of the different behavior lies in the fact that if the <code>json</code> package has to create a new value, that value must be a concrete type and cannot be a (non-concrete) interface type.</p>\n\n<p>Let's elaborate this.</p>\n\n<p>First let's examine your 2nd, working example. Your variable <code>x</code> of type <code>Foo</code> wraps a pointer value of type <code>*Bar</code>. When you pass <code>&amp;x</code> to <code>json.Unmarshal()</code>, the <code>json</code> package will get a <code>*Foo</code> pointer value. Pointer to interface! Should not be used, but there it is. The <code>json</code> package will dereference the pointer, and get the wrapped value of type <code>*Bar</code>. Since this is a non-<code>nil</code> pointer, the <code>json</code> package can\u2013and will\u2013go ahead and use it for unmarshaling. All good! The <code>json</code> package will modify the <em>pointed</em> value.</p>\n\n<p>What happens in your first example?</p>\n\n<p>In your first example your <code>x</code> variable of type <code>Foo</code> wraps a non-pointer struct value. <strong>Values wrapped in an interface cannot be modified.</strong></p>\n\n<p>What does this mean? The <code>json</code> package will again receive a value of type <code>*Foo</code>. Then it goes ahead and dereferences it, and gets a <code>Bar</code> value wrapped in an interface. The <code>Bar</code> value inside the <code>Foo</code> interface cannot be modified. The only way for the <code>json</code> package to \"deliver\" the results would be to create a new value that implements <code>Foo</code>, and store this value where the initially passed <code>*Foo</code> points to. But values of <code>Foo</code> cannot be created, it's a non-concrete interface type. So unmarshal returns with an error.</p>\n\n<p>Some addendum. Your 2nd working example:</p>\n\n<pre><code>var x Foo = &amp;Bar{}\nerr := json.Unmarshal([]byte(\"{\\\"a\\\": 5}\"), &amp;x)\nfmt.Printf(\"x: %+v\\nerr: %s\\n\", x, err)\n</code></pre>\n\n<p>This works, because we \"prepare\" a non-<code>nil</code> <code>*Bar</code> value to unmarshal into, so the <code>json</code> package doesn't have to create a value itself. We already prepared and passed a value for the <code>Foo</code> interface type (being a value of concrete type <code>*Bar</code>).</p>\n\n<p>If we would store a \"typed\" <code>nil</code> pointed in <code>x</code> like this:</p>\n\n<pre><code>var x Foo = &amp;Bar{}\nx = (*Bar)(nil)\nerr := json.Unmarshal([]byte(\"{\\\"a\\\": 5}\"), &amp;x)\nfmt.Printf(\"x: %+v\\nerr: %s\\n\", x, err)\n</code></pre>\n\n<p>We will get back the same error (try it on the <a href=\"https://play.golang.org/p/OdGTfCTWZ7q\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>x: &lt;nil&gt;\nerr: json: cannot unmarshal object into Go value of type main.Foo\n</code></pre>\n\n<p>The explanation is the same: the <code>json</code> package cannot use the <code>nil</code> pointer to unmarshal the value into. It would again need to create a value of non-concrete type <code>Foo</code>, but that is not possible. Only values of concrete types can be created.</p>\n"}], "owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 191, "favorite_count": 0, "accepted_answer_id": 50564969, "answer_count": 1, "score": 0, "last_activity_date": 1527511591, "creation_date": 1527503478, "last_edit_date": 1527509016, "question_id": 50564341, "link": "https://stackoverflow.com/questions/50564341/pointer-to-an-interface-vs-interface-holding-a-pointer-when-unmarshaling-json", "title": "Pointer to an interface vs interface holding a pointer when unmarshaling JSON", "body": "<p>Consider the following struct and interface definitions.</p>\n\n<pre><code>type Foo interface {\n    Operate()\n}\n\ntype Bar struct {\n    A int\n}\n\nfunc (b Bar) Operate() {\n    //...\n}\n</code></pre>\n\n<p>Now, if we attempt to perform the following (<a href=\"https://play.golang.org/p/HbqTBRfFLwu\" rel=\"nofollow noreferrer\">playground</a>):</p>\n\n<pre><code>var x Foo = Bar{}\nerr := json.Unmarshal([]byte(\"{\\\"a\\\": 5}\"), &amp;x)\nfmt.Printf(\"x: %+v\\nerr: %s\\n\", x, err) \n</code></pre>\n\n<p>we get the following output:</p>\n\n<pre><code>x: {A:0}\nerr: json: cannot unmarshal object into Go value of type main.Foo\n</code></pre>\n\n<p>However, by replacing the underlying data with the struct type, it goes without a hitch (<a href=\"https://play.golang.org/p/-lbQl6aYeNu\" rel=\"nofollow noreferrer\">playground</a>):</p>\n\n<pre><code>var x Foo = &amp;Bar{}\nerr := json.Unmarshal([]byte(\"{\\\"a\\\": 5}\"), &amp;x)\nfmt.Printf(\"x: %+v\\nerr: %s\\n\", x, err)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>x: &amp;{A:5}    \nerr: %!s(&lt;nil&gt;)\n</code></pre>\n\n<p>However, this is quite confusing to me. In our call to Unmarshall, we're still passing a pointer to x, which to my understanding, should be sufficient enough to allow us to modify the Bar underneath. After all, pointers are simply addresses in memory. If we're passing that address, we should be able to modify it, no? Why does the second example work, but not the first? Why does the struct being a pointer make all the difference?</p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1527508063, "post_id": 50564128, "comment_id": 88141491, "body": "I&#39;d say that your program hangs as the <code>done</code> channel is unbuffered - that means that your program will hang when you try to write into it as there is nothing reading from it."}, {"owner": {"reputation": 6375, "user_id": 84750, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jbFti.jpg?s=128&g=1", "display_name": "silverfighter", "link": "https://stackoverflow.com/users/84750/silverfighter"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1527528011, "post_id": 50564128, "comment_id": 88151684, "body": "isn&#39;t that the 3rd case?"}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1527533108, "post_id": 50564128, "comment_id": 88153598, "body": "You mean fourth (<code>case &lt;-done: break</code>). Program never reaches to it as it will hang on the line <code>done &lt;- true</code> - becaure channel is unbuffered it can&#39;t be written to unless there is reader ready. And there isn&#39;t."}], "answers": [{"tags": [], "owner": {"reputation": 6375, "user_id": 84750, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jbFti.jpg?s=128&g=1", "display_name": "silverfighter", "link": "https://stackoverflow.com/users/84750/silverfighter"}, "is_accepted": true, "score": 0, "last_activity_date": 1527570607, "creation_date": 1527570607, "answer_id": 50576678, "question_id": 50564128, "link": "https://stackoverflow.com/questions/50564128/timely-polling-console-app-with-time-indicator-that-exits-on-ctrlc/50576678#50576678", "title": "Timely polling console app with time indicator that exits on ctrl+c", "body": "<p>Found a solution. While @ain was right wit the buffered done channel, it is not really required in the code now. It worked without it.</p>\n\n<p>The trick did have the <code>timer</code>outside of the for loop and the <code>ticker</code> within it. Reason is the <code>time.After</code>is a <code>func</code>that return a new channel on every iteration. This seams perfectly fine for the ticker, but not for the <code>timer</code>.\nWith the following changes it worked =) ... </p>\n\n<pre><code>   func poller(expDate *time.Time) {\n        exp := timeLeft(*expDate)\n        timer := time.After(exp)\n\n        fmt.Printf(\"Next Token refresh will be in: %v\\n\", exp)\n\n        c := make(chan os.Signal, 1)\n        signal.Notify(c, os.Interrupt)\n        for {\n            select {\n\n            // print time left on the screen\n            case &lt;-time.After(3 * time.Second):\n                go func() {\n                    fmt.Printf(\"\\r     \")\n                    fmt.Printf(\"\\r%v\", timeLeft(*expDate))\n                }()\n            // mark as done when date is due\n            case &lt;-timer:\n                fmt.Println(\"Refresh token now!\")\n                return\n\n            // exit app\n            case &lt;-c:\n                os.Exit(0)\n                break\n\n            }\n        }\n    }\n</code></pre>\n"}], "owner": {"reputation": 6375, "user_id": 84750, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jbFti.jpg?s=128&g=1", "display_name": "silverfighter", "link": "https://stackoverflow.com/users/84750/silverfighter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 50576678, "answer_count": 1, "score": 0, "last_activity_date": 1527570607, "creation_date": 1527502700, "question_id": 50564128, "link": "https://stackoverflow.com/questions/50564128/timely-polling-console-app-with-time-indicator-that-exits-on-ctrlc", "title": "Timely polling console app with time indicator that exits on ctrl+c", "body": "<p>I would like to pool for a token in on a timely base. The Token itself got also information about when it expires.\nThis should run forever until the user enters ctrl+c.</p>\n\n<p>I tried the same with </p>\n\n<pre><code>span := timeLeft(*expDate)\ntimer := time.NewTimer(span).C\nticker := time.NewTicker(time.Second * 5).C\n</code></pre>\n\n<p>which also does not work (the application hangs after count down). So I decided to try it with <code>&lt;- time.After(...)</code> </p>\n\n<p>This is my code that does not work. You will see the count down but it never breaks on expiration.</p>\n\n<p>This is is a small extract with the polling logic for simplicity sake in a main.go: </p>\n\n<pre><code>func refreshToken() (time.Time, error) {\n        //This should simulate a http request and returns the new target date for the next refresh\n        time.Sleep(2 * time.Second)\n        return time.Now().Add(10 * time.Second), nil\n    }\n\nfunc timeLeft(d time.Time) time.Duration {\n    exactLeft := d.Sub(time.Now())\n    floorSeconds := math.Floor(exactLeft.Seconds())\n    return time.Duration(floorSeconds) * time.Second\n}\n\nfunc poller(expDate *time.Time) {\n    exp := timeLeft(*expDate)\n\n    done := make(chan bool)\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, os.Interrupt)\n    for {\n        select {\n\n        // print time left on the screen\n        case &lt;-time.After(3 * time.Second):\n            go func() {\n                fmt.Printf(\"\\rNext Token refresh will be in: %v\", timeLeft(*expDate))\n            }()\n        // mark as done when date is due\n        case &lt;-time.After(exp):\n            fmt.Println(\"Refresh token now!\")\n            done &lt;- true\n\n        // exit app\n        case &lt;-c:\n            os.Exit(0)\n            break\n\n        // exit function when done\n        case &lt;-done:\n            break\n        }\n\n    }\n}\n\nfunc main() {\n\n    var expiration time.Time\n    expiration = time.Now().Add(10 * time.Second)\n    // loop and refresh token as long as the app does not exit\n    for {\n        poller(&amp;expiration)\n\n        ex, err := refreshToken()\n        expiration = ex\n        if err != nil {\n            panic(err)\n        }\n\n        fmt.Println(\"next round poller\")\n    }\n}\n</code></pre>\n\n<p>I am also not sure if I need the done channel at all?\nWhat is required to listen to two timers and call itself until someone hits ctrl+c?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1063, "user_id": 1930504, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a4UQO.jpg?s=128&g=1", "display_name": "Jack Bracken", "link": "https://stackoverflow.com/users/1930504/jack-bracken"}, "edited": false, "score": 0, "creation_date": 1527502144, "post_id": 50563802, "comment_id": 88138055, "body": "What you&#39;re looking for is dependency management. Check out go dep, glide, and govendor."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1527503437, "post_id": 50563802, "comment_id": 88138741, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/30300279/golang-dependency-management-best-practice\">Golang Dependency Management Best Practice</a>"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 9520935, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Hntxyjh6Tig/AAAAAAAAAAI/AAAAAAAAAC8/Nd4Dyo9Onac/photo.jpg?sz=128", "display_name": "sac dh22", "link": "https://stackoverflow.com/users/9520935/sac-dh22"}, "edited": false, "score": 0, "creation_date": 1527512357, "post_id": 50564774, "comment_id": 88144063, "body": "So after cloning from github we simply run a go get -v ./...  and get all the dependencies installed then we create binaries is that the way."}, {"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "reply_to_user": {"reputation": 15, "user_id": 9520935, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Hntxyjh6Tig/AAAAAAAAAAI/AAAAAAAAAC8/Nd4Dyo9Onac/photo.jpg?sz=128", "display_name": "sac dh22", "link": "https://stackoverflow.com/users/9520935/sac-dh22"}, "edited": false, "score": 0, "creation_date": 1527514175, "post_id": 50564774, "comment_id": 88145093, "body": "Should be, yeah."}], "tags": [], "owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "is_accepted": true, "score": 1, "last_activity_date": 1527504935, "creation_date": 1527504935, "answer_id": 50564774, "question_id": 50563802, "link": "https://stackoverflow.com/questions/50563802/pushing-a-whole-golang-package-to-github/50564774#50564774", "title": "Pushing a whole golang package to github", "body": "<p>You would only push the contents of the <code>src/github.com/travel</code> directory. <code>go get</code> handles dependency resolution for you when someone wants to download your package. Take a look at something like <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">logrus</a>. Running <code>go get github.com/sirupsen/logrus</code> will download all dependencies needed to build the package. This includes any of your <code>golang.org/x/</code> packages.</p>\n"}], "owner": {"reputation": 15, "user_id": 9520935, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Hntxyjh6Tig/AAAAAAAAAAI/AAAAAAAAAC8/Nd4Dyo9Onac/photo.jpg?sz=128", "display_name": "sac dh22", "link": "https://stackoverflow.com/users/9520935/sac-dh22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 50564774, "answer_count": 1, "score": 0, "last_activity_date": 1527504935, "creation_date": 1527501770, "last_edit_date": 1527503408, "question_id": 50563802, "link": "https://stackoverflow.com/questions/50563802/pushing-a-whole-golang-package-to-github", "title": "Pushing a whole golang package to github", "body": "<p>I have built a small application locally in golang.\nMy directory structure is as follows.</p>\n\n<pre><code>gocode/\n      src/\n          github.com/\n                    travel/\n                          config/\n                          server/\n                          routes/\n                          main.go\n\n      pkg/\n          linux/\n               github.com/\n                    // projects with .a extension \n               golang.org/\n                         x/net/\n                         x/oauth2\n      bin/\n</code></pre>\n\n<p>I went through a lot of documentations, which states to push only /src folder to github as best practice.</p>\n\n<p>I am confused with what happens with packages like golang.org/x/net which are not inside /src directory.</p>\n\n<p>So we need to run go import \"net/http\" in production server as well and create executable binaries.</p>\n\n<p>I've come from a nodejs background so is it something like we do \"npm install\" in nodejs.But the thing is we have a package.json file in case of node.\nAnyways please help me with this confusion. </p>\n"}, {"tags": ["go", "gonum"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8002239"}, "edited": false, "score": 0, "creation_date": 1527846128, "post_id": 50618288, "comment_id": 88291085, "body": "Main purpose of me is to make matrix multiplication with complex valued matrices. Would you recommend the blas package of gonum to do this as the methods accept complex128 slices or would you recommend another package in gonum which is more easily to handle?"}, {"owner": {"reputation": 715, "user_id": 1502538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qV1HB.png?s=128&g=1", "display_name": "kortschak", "link": "https://stackoverflow.com/users/1502538/kortschak"}, "edited": false, "score": 0, "creation_date": 1527934540, "post_id": 50618288, "comment_id": 88321641, "body": "If you are able to use cgo in your project, the <a href=\"https://godoc.org/gonum.org/v1/netlib/blas/netlib\" rel=\"nofollow noreferrer\">gonum.org/v1/netlib/blas/netlib</a> implementation provides complex BLAS."}], "tags": [], "owner": {"reputation": 715, "user_id": 1502538, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qV1HB.png?s=128&g=1", "display_name": "kortschak", "link": "https://stackoverflow.com/users/1502538/kortschak"}, "is_accepted": false, "score": 1, "last_activity_date": 1527749296, "creation_date": 1527749296, "answer_id": 50618288, "question_id": 50562993, "link": "https://stackoverflow.com/questions/50562993/how-can-i-make-a-matrix-with-complex-number-entries-with-gonum-go/50618288#50618288", "title": "How can I make a matrix with complex number entries with gonum/go?", "body": "<p>The Gonum mat package does not currently support complex128 values. It is something we are working on.</p>\n"}, {"tags": [], "owner": {"reputation": 1218, "user_id": 2680053, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/8U5HP.jpg?s=128&g=1", "display_name": "Marc Bacvanski", "link": "https://stackoverflow.com/users/2680053/marc-bacvanski"}, "is_accepted": false, "score": 0, "last_activity_date": 1587512320, "creation_date": 1587512320, "answer_id": 61354976, "question_id": 50562993, "link": "https://stackoverflow.com/questions/50562993/how-can-i-make-a-matrix-with-complex-number-entries-with-gonum-go/61354976#61354976", "title": "How can I make a matrix with complex number entries with gonum/go?", "body": "<p>Now, Gonum supports complex matrices.</p>\n\n<p>You can make one like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>matrix := mat.NewCDense(2, 2, []complex128{0, 0, 0, 3i})\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8002239"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 221, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1587512320, "creation_date": 1527499276, "last_edit_date": 1527518342, "question_id": 50562993, "link": "https://stackoverflow.com/questions/50562993/how-can-i-make-a-matrix-with-complex-number-entries-with-gonum-go", "title": "How can I make a matrix with complex number entries with gonum/go?", "body": "<p>As it is written in the title, how can I create an instance of a matrix with complex128? What is the complex equivalent of the following?</p>\n\n<pre><code>matrix := mat.NewDense(2, 2, []float64{0, 0, 0, 3})\n</code></pre>\n\n<p>how can I write something like this?</p>\n\n<pre><code>Matrix :=  mat.NewDense(2, 2, []complex128{0, 0, 0, 3i})\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 685, "user_id": 7047363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a4cda8321abd1a553445a95258babb?s=128&d=identicon&r=PG&f=1", "display_name": "muthukumar selvaraj", "link": "https://stackoverflow.com/users/7047363/muthukumar-selvaraj"}, "edited": false, "score": 0, "creation_date": 1528137268, "post_id": 50562372, "comment_id": 88383282, "body": "<a href=\"https://github.com/stretchr/testify\" rel=\"nofollow noreferrer\">github.com/stretchr/testify</a> -&gt; for Testing Use this Package .."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1528051314, "post_id": 50668408, "comment_id": 88349340, "body": "Thanks :) , Im not sure that I fully understand it, how should I do the assertion ? can you please provide example in my context or close ?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1528052518, "post_id": 50668408, "comment_id": 88349670, "body": "@Ninawatcher Yes, that test covered only the execution, not the assertion checking the template output. I have edited the answer to add an example performing such an assertion. Again, this is very similar to hat is described in <a href=\"https://github.com/golang/go/wiki/TableDrivenTests\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/TableDrivenTests</a>: a list of inputs and outputs, with the assertion checking your program delivers the expected output from the list."}, {"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 1, "creation_date": 1528579152, "post_id": 50668408, "comment_id": 88564094, "body": "Neat use of <code>Example</code>. I had totally forgotten that examples run with <code>go test</code> <a href=\"https://blog.golang.org/examples\" rel=\"nofollow noreferrer\">blog.golang.org/examples</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1528622456, "post_id": 50668408, "comment_id": 88571114, "body": "Hi, I didnt have much time to test it and I want to test it now. since we are running out of time ( for bounty) . can you please assist ? lets say the file logic is in file <code>genfile.go</code> and I&#39;ve created file <code>genfile_test.go</code> , which logic from your example should be written in the test file can you give example ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1528622484, "post_id": 50668408, "comment_id": 88571123, "body": "since if I use <code>func TestGenerate(t *testing.T) { \t \t \tresult := tmpl.Root.String() \tif result != test.results[i] { \t\tt.Errorf(&quot;%s=(%q): got\\n\\t%v\\nexpected\\n\\t%v&quot;, test.name, test.input, result, test.results[i]) \t} \t \t \t \t } </code> its not working ..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1528622582, "post_id": 50668408, "comment_id": 88571142, "body": "Can you please provide some working example which I can use as reference to my context ?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1528622709, "post_id": 50668408, "comment_id": 88571170, "body": "@Nin I am on my phone today, so I won&#39;t be able to work on this answer, but you still have 24h after the bounty to decide. My answer was just a starting point for you to adapt."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1528624076, "post_id": 50668408, "comment_id": 88571482, "body": "in addition if we look on your example , how for productive shipped code you will test it . this is what im looking for , thanks a lot! :)"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 3, "last_activity_date": 1528052416, "last_edit_date": 1528052416, "creation_date": 1528042419, "answer_id": 50668408, "question_id": 50562372, "link": "https://stackoverflow.com/questions/50562372/golang-text-template-unit-test-to-cover-all-the-use-cases/50668408#50668408", "title": "Golang - text/template unit test to cover all the use-cases", "body": "<p>You should setup a template_test file dedicated to testing the output of your template file. </p>\n\n<p>For that, looking at the sources of the <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">golang <code>text/template</code> package</a> is always a good idea.</p>\n\n<p>As an example (to be adapted to your case), you have <a href=\"https://golang.org/src/text/template/example_test.go\" rel=\"nofollow noreferrer\"><code>src/text/template/example_test.go</code></a> which uses a classic <a href=\"https://github.com/golang/go/wiki/TableDrivenTests\" rel=\"nofollow noreferrer\">table-driven test</a> approach:</p>\n\n<pre><code>package template_test\n\nimport (\n    \"log\"\n    \"os\"\n    \"strings\"\n    \"text/template\"\n)\n\nfunc ExampleTemplate() {\n    // Define a template.\n    const letter = `\nDear {{.Name}},\n{{if .Attended}}\nIt was a pleasure to see you at the wedding.\n{{- else}}\nIt is a shame you couldn't make it to the wedding.\n{{- end}}\n{{with .Gift -}}\nThank you for the lovely {{.}}.\n{{end}}\nBest wishes,\nJosie\n`\n\n    // Prepare some data to insert into the template.\n    type Recipient struct {\n        Name, Gift string\n        Attended   bool\n    }\n    var recipients = []Recipient{\n        {\"Aunt Mildred\", \"bone china tea set\", true},\n        {\"Uncle John\", \"moleskin pants\", false},\n        {\"Cousin Rodney\", \"\", false},\n    }\n\n    // Create a new template and parse the letter into it.\n    t := template.Must(template.New(\"letter\").Parse(letter))\n\n    // Execute the template for each recipient.\n    for _, r := range recipients {\n        err := t.Execute(os.Stdout, r)\n        if err != nil {\n            log.Println(\"executing template:\", err)\n        }\n    }\n\n    // Output:\n    // Dear Aunt Mildred,\n    //\n    // It was a pleasure to see you at the wedding.\n    // Thank you for the lovely bone china tea set.\n    //\n    // Best wishes,\n    // Josie\n    //\n    // Dear Uncle John,\n    //\n    // It is a shame you couldn't make it to the wedding.\n    // Thank you for the lovely moleskin pants.\n    //\n    // Best wishes,\n    // Josie\n    //\n    // Dear Cousin Rodney,\n    //\n    // It is a shame you couldn't make it to the wedding.\n    //\n    // Best wishes,\n    // Josie\n}\n</code></pre>\n\n<p>For the assertion part, look in <a href=\"https://github.com/golang/go/blob/master/src/text/template/multi_test.go\" rel=\"nofollow noreferrer\"><code>src/text/template/multi_test.go</code></a> which defines <a href=\"https://github.com/golang/go/blob/master/src/text/template/multi_test.go#L21-L29\" rel=\"nofollow noreferrer\"><code>multiParseTest</code></a> as a structure with a template, *and an expected result, which allows to do <a href=\"https://github.com/golang/go/blob/06b326054dc0cad03b7b848d8516a578dd8b559f/src/text/template/multi_test.go#L72-L81\" rel=\"nofollow noreferrer\">assertions like</a>:</p>\n\n<pre><code>result := tmpl.Root.String()\nif result != test.results[i] {\n    t.Errorf(\"%s=(%q): got\\n\\t%v\\nexpected\\n\\t%v\", test.name, test.input, result, test.results[i])\n}\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1528623936, "post_id": 50687227, "comment_id": 88571451, "body": "Thanks for your answer!, Can you please elaborate how should I check the real template , here you are checking the datatype which is OK but not sufficient...I need to check that the template is behave ok if I pass wrong parameters/data . Thanks!"}, {"owner": {"reputation": 685, "user_id": 7047363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a4cda8321abd1a553445a95258babb?s=128&d=identicon&r=PG&f=1", "display_name": "muthukumar selvaraj", "link": "https://stackoverflow.com/users/7047363/muthukumar-selvaraj"}, "edited": false, "score": 0, "creation_date": 1528640491, "post_id": 50687227, "comment_id": 88575772, "body": "you need to fake your <code>inputs</code>"}], "tags": [], "owner": {"reputation": 685, "user_id": 7047363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a4cda8321abd1a553445a95258babb?s=128&d=identicon&r=PG&f=1", "display_name": "muthukumar selvaraj", "link": "https://stackoverflow.com/users/7047363/muthukumar-selvaraj"}, "is_accepted": false, "score": 2, "last_activity_date": 1528139249, "creation_date": 1528139249, "answer_id": 50687227, "question_id": 50562372, "link": "https://stackoverflow.com/questions/50562372/golang-text-template-unit-test-to-cover-all-the-use-cases/50687227#50687227", "title": "Golang - text/template unit test to cover all the use-cases", "body": "<p>yourcodefile.go</p>\n\n<pre><code>    type API map[string]string\n\n    type data struct {\n        File *File\n        API  API\n    }\n    func DynamicdataForTemplate() data {\n                    f := new(File)\n                    f.Dependency = []Dependency{{\n                        Name:    \"ui\",\n                        Type:    \"runner\",\n                        CWD:     \"/ui\",\n                        Install: []Install{{\"name\": \"api\"}},\n                    }, {\n                        Name:    \"ui2\",\n                        Type:    \"runner2\",\n                        CWD:     \"/ui2\",\n                        Install: []Install{{\"name\": \"api2\"}},\n                    }}\n\n                    datav := data{}\n                    datav.File = f\n                    datav.API = API{\"runner3\": \"api3\", \"runner4\": \"api4\"}\n\n                    return datav\n                }\n\n func ParseTemplate() error {\n                    parsedTempl, err := template.New(\"t\").Parse(tmpl)\n                    err = parsedTempl.Execute(os.Stdout, DynamicdataForTemplate())\n                    return err\n}\n\n    func main() {\n        _ = ParseTemplate()\n    }\n</code></pre>\n\n<hr>\n\n<p>use this Assertion Package for writing Test case \n<a href=\"https://github.com/stretchr/testify\" rel=\"nofollow noreferrer\">https://github.com/stretchr/testify</a></p>\n\n<p>yourcodefile_test.go</p>\n\n<pre><code>import (\n    \"testify/assert\"\n    \"testing\"\n)\n\n\nfunc TestDynamicdataForTemplate(t *testing.T) {\n    t.Run(\"should return the Type\", func(t *testing.T) {\n        dataType := data{}\n        assert.IsType(t, dataType, DynamicdataForTemplate())\n    })\n}\n\nfunc TestParseTemplate(t *testing.T) {\n    t.Run(\"should return the nil\", func(t *testing.T) {\n        assert.Nil(t, ParseTemplate())\n    })\n</code></pre>\n\n<p>}</p>\n\n<p>code coverage Report Command</p>\n\n<pre><code>go test -coverprofile=coverage.out\ngo tool cover -html=coverage.out\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2130, "favorite_count": 2, "answer_count": 2, "score": 16, "last_activity_date": 1528654322, "creation_date": 1527497123, "last_edit_date": 1528654322, "question_id": 50562372, "link": "https://stackoverflow.com/questions/50562372/golang-text-template-unit-test-to-cover-all-the-use-cases", "title": "Golang - text/template unit test to cover all the use-cases", "body": "<p>I've the following example (similar of what we have in prod) \"text/template\" code which works OK, now I want to create a unit test for it that checks the function and also the <code>text/template</code> to see that I cover 100% of the code... </p>\n\n<p>The problem here is how to do the <strong>text/template</strong> unit test which covers <strong>all the cases</strong>. I'm currently new to text/template and I want to make sure it's working as expected.</p>\n\n<p>Please visit:\n<a href=\"https://play.golang.org/p/203Al36Zigk\" rel=\"nofollow noreferrer\">https://play.golang.org/p/203Al36Zigk</a></p>\n\n<p>This is the template:</p>\n\n<pre><code>const tmpl = `#!/bin/bash\n{{- range .File.Dependency}}\necho {{.EchoText}}\n{{- range .Install}}\nsubmitting {{.name}}\n{{- end}}\n{{.TypeCommand}}\n{{end}}\n\n{{- range $k, $v := .API}}\necho {{$k}}\nsubmitting {{$v}}\n{{end}}\n`\n</code></pre>\n"}, {"tags": ["database", "go", "amazon-dynamodb"], "comments": [{"owner": {"reputation": 29341, "user_id": 6337748, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/7Si7m.jpg?s=128&g=1", "display_name": "notionquest", "link": "https://stackoverflow.com/users/6337748/notionquest"}, "edited": false, "score": 0, "creation_date": 1527516476, "post_id": 50562326, "comment_id": 88146349, "body": "did you try with an object in contains? something like {Ba : &quot;foo1&quot;}"}, {"owner": {"reputation": 1, "user_id": 9558047, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WGyEUQWk8tk/AAAAAAAAAAI/AAAAAAABF24/tezepXrBgzY/photo.jpg?sz=128", "display_name": "Vladan Ry\u0161av&#253;", "link": "https://stackoverflow.com/users/9558047/vladan-ry%c5%a1av%c3%bd"}, "reply_to_user": {"reputation": 29341, "user_id": 6337748, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/7Si7m.jpg?s=128&g=1", "display_name": "notionquest", "link": "https://stackoverflow.com/users/6337748/notionquest"}, "edited": false, "score": 0, "creation_date": 1527580996, "post_id": 50562326, "comment_id": 88167652, "body": "no, in sdk-v2 is accepting <code>Contains</code> only string"}], "owner": {"reputation": 1, "user_id": 9558047, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WGyEUQWk8tk/AAAAAAAAAAI/AAAAAAABF24/tezepXrBgzY/photo.jpg?sz=128", "display_name": "Vladan Ry\u0161av&#253;", "link": "https://stackoverflow.com/users/9558047/vladan-ry%c5%a1av%c3%bd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1527496912, "creation_date": 1527496912, "question_id": 50562326, "link": "https://stackoverflow.com/questions/50562326/dynamodb-filterexpression-on-own-slice", "title": "dynamoDB FilterExpression on own slice", "body": "<p>I working on easy access to dynamoDB and I can't find out how to get object according to some props in own slice. What I need is a right expression.</p>\n\n<p>I have this model:</p>\n\n<pre><code>type aaa struct {   \n    Aa string         `json:\"aaa\"`\n    Ac []bbb          `json:\"aac\"`\n}\n\ntype bbb struct {   \n    Ba string   `json:\"bba\"`\n}\n</code></pre>\n\n<p>with this data</p>\n\n<pre><code>    a := &amp;aaa{\n    Aa: \"Aa\",\n    Ac: []bbb{\n        {\n            Ba: \"foo1\",\n        },\n    },\n}\n</code></pre>\n\n<p>for me is working expression like this </p>\n\n<pre><code>expression.Name(\"aac[0].bba\").Equal(expression.Value(\"foo1\"))\n</code></pre>\n\n<p>but i dont know index. \nSo I was trying </p>\n\n<pre><code>expression.Name(\"aac.bba\").Equal(expression.Value(\"foo1\"))\n</code></pre>\n\n<p>but <strong>this is not working</strong>.\nI also trying contain</p>\n\n<pre><code>expression.Name(\"aac.bba\").Contains(\"foo1\")\n</code></pre>\n\n<p>but this was working only on scalar types.\nAny Idea how get the object if i don't know index? Thanks</p>\n"}, {"tags": ["go", "ethereum"], "comments": [{"owner": {"reputation": 1, "user_id": 4030128, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u5f20\u5c11\u9e4f", "link": "https://stackoverflow.com/users/4030128/%e5%bc%a0%e5%b0%91%e9%b9%8f"}, "reply_to_user": {"reputation": 17856, "user_id": 1439168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd72ad672b055a7d59cfb1c30d1c724f?s=128&d=identicon&r=PG", "display_name": "Miguel Mota", "link": "https://stackoverflow.com/users/1439168/miguel-mota"}, "edited": false, "score": 0, "creation_date": 1527564441, "post_id": 50560961, "comment_id": 88160899, "body": "<a href=\"https://github.com/ethereum/go-ethereum/issues/16818\" rel=\"nofollow noreferrer\">see this page</a>"}], "answers": [{"tags": [], "owner": {"reputation": 17856, "user_id": 1439168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd72ad672b055a7d59cfb1c30d1c724f?s=128&d=identicon&r=PG", "display_name": "Miguel Mota", "link": "https://stackoverflow.com/users/1439168/miguel-mota"}, "is_accepted": false, "score": 1, "last_activity_date": 1528496815, "last_edit_date": 1528496815, "creation_date": 1528496439, "answer_id": 50769076, "question_id": 50560961, "link": "https://stackoverflow.com/questions/50560961/golang-program-import-github-com-ethereum-go-ethereum-accounts-keystore-build/50769076#50769076", "title": "golang program import &quot;github.com/ethereum/go-ethereum/accounts/keystore&quot; build error", "body": "<p>Run the command with <code>CGO_ENABLED=1</code> to enable the use of cgo when cross compiling.</p>\n\n<pre><code>CGO_ENABLED=1 GOOS=linux GOARCH=amd64 go build\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 4030128, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "\u5f20\u5c11\u9e4f", "link": "https://stackoverflow.com/users/4030128/%e5%bc%a0%e5%b0%91%e9%b9%8f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 413, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1571046841, "creation_date": 1527491583, "last_edit_date": 1571046841, "question_id": 50560961, "link": "https://stackoverflow.com/questions/50560961/golang-program-import-github-com-ethereum-go-ethereum-accounts-keystore-build", "title": "golang program import &quot;github.com/ethereum/go-ethereum/accounts/keystore&quot; build error", "body": "<p>Please find my golang specifications</p>\n\n<ul>\n<li>GOOS=linux </li>\n<li>GOARCH=amd64 </li>\n</ul>\n\n<blockquote>\n  <p>go build github.com/ethereum/go-ethereum/crypto/secp256k1: build\n  constraints exclude allGo files in\n  /Users/mac/Documents/project/src/github.com/ethereum/go-ethereum/crypto/secp256k1</p>\n</blockquote>\n"}, {"tags": ["http", "curl", "go", "http-headers"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1527480703, "creation_date": 1527480703, "answer_id": 50559020, "question_id": 50558422, "link": "https://stackoverflow.com/questions/50558422/how-to-set-different-value-for-host-in-http-header-with-host-in-url-in-golang/50559020#50559020", "title": "how to set different value for host in http header with host in url in golang", "body": "<p>Set <a href=\"https://godoc.org/net/http#Request.Host\" rel=\"noreferrer\">Request.Host</a> to change the host header sent to the server.</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", \"http://bbb.com/\", nil)\nif err != nil {\n    log.Fatal(err)\n}\nreq.Host = \"aaa.com\"\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/f_VAEzdKfW9\" rel=\"noreferrer\">Playground example</a></p>\n"}], "owner": {"reputation": 3069, "user_id": 2693045, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/q4XJz.jpg?s=128&g=1", "display_name": "lutaoact", "link": "https://stackoverflow.com/users/2693045/lutaoact"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 974, "favorite_count": 0, "accepted_answer_id": 50559020, "answer_count": 1, "score": 0, "last_activity_date": 1527512791, "creation_date": 1527475061, "last_edit_date": 1527512791, "question_id": 50558422, "link": "https://stackoverflow.com/questions/50558422/how-to-set-different-value-for-host-in-http-header-with-host-in-url-in-golang", "title": "how to set different value for host in http header with host in url in golang", "body": "<p>I can use <code>curl</code> to send my request successfully, but golang seems impossible to do.</p>\n\n<pre><code>curl -H 'Host: aaa.com' 'http://bbb.com'\n</code></pre>\n\n<p>My question is: how I can send request with host which is different with host in url?</p>\n"}, {"tags": ["go", "intellij-idea"], "answers": [{"tags": [], "owner": {"reputation": 39519, "user_id": 5205022, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DISiu.jpg?s=128&g=1", "display_name": "Mario Galic", "link": "https://stackoverflow.com/users/5205022/mario-galic"}, "is_accepted": false, "score": 1, "last_activity_date": 1527466697, "creation_date": 1527466697, "answer_id": 50557671, "question_id": 50556643, "link": "https://stackoverflow.com/questions/50556643/intellij-how-can-i-set-default-debug-port/50557671#50557671", "title": "Intellij how can I set default debug port", "body": "<p>Have you tried creating a custom debug configuration:</p>\n\n<ol>\n<li><code>Run | Edit configurations</code></li>\n<li>Click <code>+</code> button and select <code>Go Remote</code></li>\n<li>Name it <code>My Debug</code></li>\n<li>In the <code>Port</code> field, enter the desired port number</li>\n<li>Click <code>OK</code></li>\n<li><code>Run | Debug... | 'My Debug'</code></li>\n</ol>\n"}], "owner": {"reputation": 2015, "user_id": 1591668, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cb658beece55f9525bd4cbb682fadc44?s=128&d=identicon&r=PG", "display_name": "user1591668", "link": "https://stackoverflow.com/users/1591668/user1591668"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1527466697, "creation_date": 1527456306, "question_id": 50556643, "link": "https://stackoverflow.com/questions/50556643/intellij-how-can-i-set-default-debug-port", "title": "Intellij how can I set default debug port", "body": "<p>I am using the new Intellij-idea for Golang and was wondering how can I set a default debug port for it ? I know how to do it in Visual Studio code but not IntelliJ . I am using this for a backend app development so every time the port changes I have to also change it in the app and it gets tiring . Every time I debug I get a new random port . In VS Code you have a launch.json but Intellij does not have that .</p>\n"}, {"tags": ["go", "struct", "null", "conventions"], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 0, "last_activity_date": 1527460632, "creation_date": 1527460632, "answer_id": 50557142, "question_id": 50555897, "link": "https://stackoverflow.com/questions/50555897/nil-handling-at-method-or-constructor-level/50557142#50557142", "title": "Nil handling at method or constructor level?", "body": "<p>I don't think there is a \"right\" answer for this.</p>\n\n<p>Having said this, the approach usually seen in the Go base libraries is letting the objects be created without any constructor, with <code>nil</code> or <code>zero</code> values in its fields, and then make the methods have logic to use or return useful defaults.</p>\n\n<p>Take a look at the <code>http.Client</code> implementation for example:</p>\n\n<p><a href=\"https://github.com/golang/go/blob/master/src/net/http/client.go\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/net/http/client.go</a></p>\n\n<p>It will basically let you create a new client by just doing:</p>\n\n<pre><code>client := &amp;http.Client{}\n</code></pre>\n\n<p>You can then populate the fields of the object if you want to override defaults, otherwise it'll check for <code>nil</code> in different methods to provide default behaviour, for example:</p>\n\n<p><a href=\"https://github.com/golang/go/blob/master/src/net/http/client.go#L195\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/net/http/client.go#L195</a></p>\n\n<pre><code>func (c *Client) transport() RoundTripper {\n    if c.Transport != nil {\n        return c.Transport\n    }\n    return DefaultTransport\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 50557142, "answer_count": 1, "score": 0, "last_activity_date": 1527460632, "creation_date": 1527450462, "last_edit_date": 1527450731, "question_id": 50555897, "link": "https://stackoverflow.com/questions/50555897/nil-handling-at-method-or-constructor-level", "title": "Nil handling at method or constructor level?", "body": "<p>Should I check for nil values in the constructor and then set an unexported struct field, or make the default struct value useful by checking for nil at method level?</p>\n\n<pre><code>type Foo struct{}\n\nfunc (f *Foo) Baz() {}\n\nvar DefaultFoo = new(Foo)\n\ntype Bar struct {\n    Foo *Foo\n}\n\nfunc (b *Bar) Baz() {\n    if b.Foo == nil {\n        DefaultFoo.Baz()\n    } else {\n        b.Foo.Baz()\n    }\n}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>type Foo struct{}\n\nfunc (f *Foo) Baz() {}\n\nvar DefaultFoo = new(Foo)\n\ntype Bar struct {\n    foo *Foo\n}\n\nfunc NewBar(foo *Foo) *Bar {\n    if foo == nil {\n        foo = DefaultFoo\n    }\n    return &amp;Bar{foo}\n}\n\nfunc (b *Bar) Baz() {\n    b.foo.Baz()\n}\n</code></pre>\n"}, {"tags": ["sql", "go", "reflection"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1527450211, "last_edit_date": 1527450211, "creation_date": 1527449861, "answer_id": 50555824, "question_id": 50555474, "link": "https://stackoverflow.com/questions/50555474/golang-populate-function-parameters-with-struct-values/50555824#50555824", "title": "Golang populate function parameters with struct values", "body": "<p>This can be done with the <code>reflect</code> package which allows you to loop over a struct's fields and then construct a slice of <code>driver.Value</code>s. You would then pass the resulting slice to <code>AddRow</code> with the trailing <code>...</code> to \"unpack\" the contents.</p>\n\n<pre><code>var result []driver.Value\n\nrv := reflect.ValueOf(account)\nfor i := 0; i &lt; rv.NumField(); i++ {\n    fv := rv.Field(i)\n    dv := driver.Value(fv.Interface())\n    result = append(result, dv)\n}\n\nAddRow(result...)\n</code></pre>\n\n<p>Note that in this case the conversion <code>driver.Value(fv.Interface())</code> works because <code>driver.Value</code> is an empty interface and so is the type returned by <code>fv.Interface()</code>.</p>\n\n<p><a href=\"https://play.golang.org/p/7Oy8_YrmkMa\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7Oy8_YrmkMa</a></p>\n"}], "owner": {"reputation": 448, "user_id": 1287248, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/73a31bec4645ac80b11aff5b8f191438?s=128&d=identicon&r=PG", "display_name": "Seonixx", "link": "https://stackoverflow.com/users/1287248/seonixx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 560, "favorite_count": 0, "accepted_answer_id": 50555824, "answer_count": 1, "score": 1, "last_activity_date": 1527450211, "creation_date": 1527447262, "question_id": 50555474, "link": "https://stackoverflow.com/questions/50555474/golang-populate-function-parameters-with-struct-values", "title": "Golang populate function parameters with struct values", "body": "<p>I'm wondering is there is a way to populate a variadic function parameter in golang with all the values of a struct (which will typically be of varying types).</p>\n\n<p>The specific example I'm thinking of is the following snippet to generate a row for a mocked postgres database query using <a href=\"https://github.com/DATA-DOG/go-sqlmock\" rel=\"nofollow noreferrer\">https://github.com/DATA-DOG/go-sqlmock</a>:</p>\n\n<pre><code>rows := sqlmock.NewRows([]string{\n        \"id\",\n        \"updated_at\",\n        \"created_at\",\n        \"meta\",\n        \"account_id\",\n        \"currency\",\n        \"nickname\",\n        \"scheme_name\",\n        \"identification\",\n        \"name\",\n        \"identification_secondary\",\n        \"servicer_scheme_name\",\n        \"servicer_identification\",\n        \"institution_id\",\n        \"client_id\",\n    }).AddRow(\n        mock.Values.AccountID,\n        time.Now(),\n        time.Now(),\n        \"{}\",\n        \"12345678\",\n        \"GBP\",\n        \"Test\",\n        \"Schema\",\n        \"12345676534263\",\n        \"New account\",\n        \"12345\",\n        \"schema\",\n        \"test id\",\n        mock.Values.InstitutionID,\n        mock.Values.ClientID,\n    )\n</code></pre>\n\n<p>Given the parameters always represent a struct (fields and values), I was attempting to use a struct to populate both the fields and values rather than complete each manually. Fields is fairly simple with reflection, however the values are of multiple types with the AddRow function defined as:</p>\n\n<pre><code>AddRow func(values ...driver.Value) *Rows\n</code></pre>\n\n<p>Is there a way to loop over struct fields and provide typed values to achieve something like?...</p>\n\n<pre><code>account := Account{\n        ID:             \"ABCD12436364\",\n        UpdatedAt:      time.Now(),\n        CreatedAt:      time.Now(),\n        Meta:           \"{}\",\n        AccountID:      \"12345678\",\n        Currency:       \"GBP\",\n        Nickname:       \"Test\",\n        SchemeName:     \"Scheme\",\n        Identification: \"12345676534263\",\n        Name:           \"New account\",\n        IdentificationSecondary: \"12345\",\n        ServicerSchemeName:      \"scheme\",\n        ServicerIdentification:  \"test id\",\n        InstitutionID:           \"ABCD123456\",\n        ClientID:                \"ZXCVB12436\",\n    }\n\nrows := sqlmock.NewRows(account.GetFieldsJSON()).AddRow(account.GetValues())\n</code></pre>\n"}, {"tags": ["go", "installation", "go-build"], "comments": [{"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "edited": false, "score": 0, "creation_date": 1527446513, "post_id": 50554817, "comment_id": 88121461, "body": "My guess would be because it&#39;s not been properly installed to start with! Can you provide a link to the installation guide you&#39;re referring to as well as the complete and exact steps you took?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527453112, "post_id": 50554817, "comment_id": 88123342, "body": "Don&#39;t include screen shots of text! Copy and paste the text directly into the question instead."}], "answers": [{"tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": true, "score": 3, "last_activity_date": 1527447362, "creation_date": 1527447362, "answer_id": 50555485, "question_id": 50554817, "link": "https://stackoverflow.com/questions/50554817/golang-installation/50555485#50555485", "title": "Golang installation", "body": "<p>The location of the binary <code>go</code> is not in your path. Ubuntu does not find it and suggests to install it. Add this line to your file <code>/etc/profile</code>, or better <code>$HOME/.profile</code>:</p>\n\n<pre><code>export PATH=$PATH:/usr/local/go/bin\n</code></pre>\n\n<p>This is documented in the docs: <a href=\"https://golang.org/doc/install#install\" rel=\"nofollow noreferrer\">https://golang.org/doc/install#install</a></p>\n\n<p>If you want to try this solution before editing any files, you can just execute the above command and try to execute the <code>go</code> command in the shell.</p>\n"}, {"tags": [], "owner": {"reputation": 140, "user_id": 5115007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3667e565469ab7020a2a4b6c0aeb4392?s=128&d=identicon&r=PG&f=1", "display_name": "Prabesh P", "link": "https://stackoverflow.com/users/5115007/prabesh-p"}, "is_accepted": false, "score": 0, "last_activity_date": 1543999972, "creation_date": 1543999972, "answer_id": 53628411, "question_id": 50554817, "link": "https://stackoverflow.com/questions/50554817/golang-installation/53628411#53628411", "title": "Golang installation", "body": "<p>You need to put the go executable in your system path. which you can do by </p>\n\n<pre><code>export PATH=$PATH:/etc/usr/go/bin\n</code></pre>\n\n<p>You can put the same in /home/user/.profile </p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 7603291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6566ef0c692850d78afa3124c292aba?s=128&d=identicon&r=PG&f=1", "display_name": "Ruchi", "link": "https://stackoverflow.com/users/7603291/ruchi"}, "is_accepted": false, "score": 1, "last_activity_date": 1564470349, "last_edit_date": 1592644375, "creation_date": 1564470349, "answer_id": 57266074, "question_id": 50554817, "link": "https://stackoverflow.com/questions/50554817/golang-installation/57266074#57266074", "title": "Golang installation", "body": "<p>There are paths which needs to be set correctly for you go installation to work</p>\n<ol>\n<li><p>GOROOT points to directory where go is installed</p>\n<p><code>export GOROOT=/usr/lib/go</code></p>\n</li>\n<li><p>GOPATH points to you workspace directory</p>\n<p><code>export GOPATH=$HOME/go</code></p>\n</li>\n<li><p>These paths need to be added in global path variable.</p>\n<p><code>export PATH=$PATH:$GOROOT/bin</code></p>\n</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 325, "user_id": 4154982, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ylnD1Q83Noo/AAAAAAAAAAI/AAAAAAAACWk/lud3LVIG-oI/photo.jpg?sz=128", "display_name": "Ardi Nusawan", "link": "https://stackoverflow.com/users/4154982/ardi-nusawan"}, "is_accepted": false, "score": 0, "last_activity_date": 1601569526, "creation_date": 1601569526, "answer_id": 64159507, "question_id": 50554817, "link": "https://stackoverflow.com/questions/50554817/golang-installation/64159507#64159507", "title": "Golang installation", "body": "<p>just use asdf for installation. You can have several version also :D</p>\n<p>Docs: <a href=\"https://asdf-vm.com/#/core-manage-asdf\" rel=\"nofollow noreferrer\">https://asdf-vm.com/#/core-manage-asdf</a></p>\n"}, {"tags": [], "owner": {"reputation": 115, "user_id": 820779, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cikDx.png?s=128&g=1", "display_name": "OLS", "link": "https://stackoverflow.com/users/820779/ols"}, "is_accepted": false, "score": -1, "last_activity_date": 1612387508, "creation_date": 1612387508, "answer_id": 66035920, "question_id": 50554817, "link": "https://stackoverflow.com/questions/50554817/golang-installation/66035920#66035920", "title": "Golang installation", "body": "<p>Download latest version from <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">https://golang.org/doc/install</a></p>\n<pre class=\"lang-sh prettyprint-override\"><code>tar -xzf go1.15.7.linux-amd64.tar.gz\n</code></pre>\n<p>move to <code>/usr/lib/</code> to folder with version number</p>\n<pre class=\"lang-sh prettyprint-override\"><code>sudo mv go /usr/lib/go-1.15\n</code></pre>\n<p>create symkink link on <code>/usr/bin/</code></p>\n<pre class=\"lang-sh prettyprint-override\"><code>ln -s /usr/lib/go-1.15/bin/go /usr/bin/go\n</code></pre>\n"}], "owner": {"reputation": 1483, "user_id": 6213883, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-Undmv-4m5tk/AAAAAAAAAAI/AAAAAAAAACA/LsFc3HVNVFE/photo.jpg?sz=128", "display_name": "Florian Castelain", "link": "https://stackoverflow.com/users/6213883/florian-castelain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 683, "favorite_count": 0, "accepted_answer_id": 50555485, "answer_count": 5, "score": -1, "last_activity_date": 1612387508, "creation_date": 1527442785, "last_edit_date": 1527503785, "question_id": 50554817, "link": "https://stackoverflow.com/questions/50554817/golang-installation", "title": "Golang installation", "body": "<p>I just followed the installation guide for golang (ubuntu 16).\nI extracted the archive at /etc/usr\nI added env variable in /home/user/.profile\nI just tested a basic go build on the hello world code.</p>\n\n<p>I get the following error:</p>\n\n<pre><code>The program 'go' is currently not installed. You can install it by typing: sudo apt install golang-go\n</code></pre>\n\n<p>Why does it ask me to install it (again?)?</p>\n"}, {"tags": ["regex", "string", "go"], "comments": [{"owner": {"reputation": 137100, "user_id": 874188, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ZcY77.png?s=128&g=1", "display_name": "tripleee", "link": "https://stackoverflow.com/users/874188/tripleee"}, "edited": false, "score": 0, "creation_date": 1527443301, "post_id": 50554700, "comment_id": 88120551, "body": "Many regular expressions match an infinite amount of strings. Do you want to generate them all? In any particular order? Your problem isn&#39;t really well-defined."}, {"owner": {"reputation": 16007, "user_id": 8291949, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/a7pBo.gif?s=128&g=1", "display_name": "wp78de", "link": "https://stackoverflow.com/users/8291949/wp78de"}, "edited": false, "score": 0, "creation_date": 1527569441, "post_id": 50554700, "comment_id": 88162123, "body": "Was any of the answers helpful to you?"}], "answers": [{"tags": [], "owner": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "is_accepted": false, "score": 0, "last_activity_date": 1527442935, "creation_date": 1527442935, "answer_id": 50554842, "question_id": 50554700, "link": "https://stackoverflow.com/questions/50554700/construct-string-from-regexp/50554842#50554842", "title": "Construct String from Regexp", "body": "<p>While technically not impossible this is a <strong>huge</strong> amount of work.</p>\n\n<p>Go regexp package compiles regular expressions into bytecode programs that are then executed to search strings. De-compiling this bytecode back into a regular expression is not impossible but quite difficult and moreover you cannot be sure that the regexp expression you get is the exact same that was used originally... for example</p>\n\n<pre><code>/(?:a+)+/\n</code></pre>\n\n<p>and</p>\n\n<pre><code>/a+/\n</code></pre>\n\n<p>will be compiled to the same code for matching (expressions are \"simplified\" before being passed to the code generator).</p>\n\n<p>Most probably you want to find another solution, like saving the original strings before compiling them into regular expression objects.</p>\n"}, {"tags": [], "owner": {"reputation": 16007, "user_id": 8291949, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/a7pBo.gif?s=128&g=1", "display_name": "wp78de", "link": "https://stackoverflow.com/users/8291949/wp78de"}, "is_accepted": false, "score": 1, "last_activity_date": 1527484386, "creation_date": 1527484386, "answer_id": 50559492, "question_id": 50554700, "link": "https://stackoverflow.com/questions/50554700/construct-string-from-regexp/50559492#50559492", "title": "Construct String from Regexp", "body": "<p>Such a library, often called <a href=\"https://github.com/bluezio/xeger\" rel=\"nofollow noreferrer\">Xeger</a>, exists for many languages, including go. However, this one is called <a href=\"https://github.com/nilium/regen\" rel=\"nofollow noreferrer\">regen</a>: It's a tool to generate random strings from Go/RE2 regular expressions.</p>\n\n<p>Here's an example:</p>\n\n<pre><code>$ regen -n 3 '[a-z]{6,12}(\\+[a-z]{6,12})?@[a-z]{6,16}(\\.[a-z]{2,3}){1,2}'\niprbph+gqastu@regegzqa.msp\nabxfcomj@uyzxrgj.kld.pp\nvzqdrmiz@ewdhsdzshvvxjk.pi\n</code></pre>\n\n<blockquote>\n  <p>Essentially, all regen does is parse the regular expressions it's\n  given and iterate over the tree produced by regexp/syntax and attempt\n  to generate strings based on the ops described by its results. This\n  could probably be optimized further by compiling the resulting Regexp\n  into a Prog, but I didn't feel like this was worthwhile when it's a\n  very small tool.   </p>\n</blockquote>\n\n<p>Some additional information can be\n found at <a href=\"https://godoc.org/go.spiff.io/regen\" rel=\"nofollow noreferrer\">https://godoc.org/go.spiff.io/regen</a>.</p>\n"}], "owner": {"reputation": 71, "user_id": 3260736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b026e244ddd20374482f99aad9b0f6d?s=128&d=identicon&r=PG", "display_name": "Asif Mahmud Shimon", "link": "https://stackoverflow.com/users/3260736/asif-mahmud-shimon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1527484386, "creation_date": 1527442035, "last_edit_date": 1527472783, "question_id": 50554700, "link": "https://stackoverflow.com/questions/50554700/construct-string-from-regexp", "title": "Construct String from Regexp", "body": "<p>I've trying to find out a way to construct <code>string</code> data from a compiled <code>*regexp.Regexp</code> with given <code>interface{}</code> array. For example:</p>\n\n<pre><code>re := regexp.MustCompile(`(?P&lt;word&gt;\\w+)\\s*(?P&lt;num&gt;\\d+)`)\n</code></pre>\n\n<p>I want to construct a <code>string</code> from the structure found in <code>re</code> by a <code>string</code> and a <code>int</code> data which may be received as <code>interface{}</code>.</p>\n\n<p>Can't figure out how I can do that in Go. Please help me out.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1527450393, "post_id": 50554021, "comment_id": 88122546, "body": "You should not code code to your expectations but to the sepcification of the function as documented.-"}, {"owner": {"reputation": 747, "user_id": 5539547, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/z3y7F.jpg?s=128&g=1", "display_name": "Tahseen", "link": "https://stackoverflow.com/users/5539547/tahseen"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1527518136, "post_id": 50554021, "comment_id": 88147224, "body": "I did see the documentation. In fact the piece of code I picked up from documentation. If you go and check TrimRight, you would see that. The sentence of doc confused me and for that I should be given some consideration"}], "answers": [{"comments": [{"owner": {"reputation": 747, "user_id": 5539547, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/z3y7F.jpg?s=128&g=1", "display_name": "Tahseen", "link": "https://stackoverflow.com/users/5539547/tahseen"}, "edited": false, "score": 0, "creation_date": 1527437554, "post_id": 50554056, "comment_id": 88118842, "body": "But if you remove the space before Gophers in the cutset, then the result is Hello. Even then character o is present in cutset"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 747, "user_id": 5539547, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/z3y7F.jpg?s=128&g=1", "display_name": "Tahseen", "link": "https://stackoverflow.com/users/5539547/tahseen"}, "edited": false, "score": 0, "creation_date": 1527437598, "post_id": 50554056, "comment_id": 88118855, "body": "Yes, because then <code>o</code> is no longer in the set of right-most matching characters."}, {"owner": {"reputation": 747, "user_id": 5539547, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/z3y7F.jpg?s=128&g=1", "display_name": "Tahseen", "link": "https://stackoverflow.com/users/5539547/tahseen"}, "edited": false, "score": 0, "creation_date": 1527437673, "post_id": 50554056, "comment_id": 88118877, "body": "Couldn&#39;t get what you said"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 747, "user_id": 5539547, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/z3y7F.jpg?s=128&g=1", "display_name": "Tahseen", "link": "https://stackoverflow.com/users/5539547/tahseen"}, "edited": false, "score": 0, "creation_date": 1527437765, "post_id": 50554056, "comment_id": 88118904, "body": "<code>TrimRight</code> trims all trailing characters in the cutset. If space is not in your cutset, then the <code>o</code> in <code>Hello</code> is no longer trailing, because it is succeeded by a non-cutset character (the space)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 747, "user_id": 5539547, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/z3y7F.jpg?s=128&g=1", "display_name": "Tahseen", "link": "https://stackoverflow.com/users/5539547/tahseen"}, "edited": false, "score": 0, "creation_date": 1527437804, "post_id": 50554056, "comment_id": 88118912, "body": "If your input is &quot;Gophers, Hello Gophers&quot;, and you <code>TrimRight()</code> with a cutset of &quot;Gophers&quot;, you wouldn&#39;t expect the first word &quot;Gophers&quot; to be trimmed, would you?"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1527437397, "creation_date": 1527437397, "answer_id": 50554056, "question_id": 50554021, "link": "https://stackoverflow.com/questions/50554021/trimright-not-working-as-i-expected/50554056#50554056", "title": "TrimRight not working as I expected", "body": "<p>As documented, <a href=\"https://golang.org/pkg/strings/#TrimRight\" rel=\"nofollow noreferrer\"><code>TrimRight</code></a> removes all matching characters from the right. Because <code>o</code> is included in your list (<code>\" Gophers\"</code>), it is also trimmed. If you want to trim that exact substring use <a href=\"https://golang.org/pkg/strings/#TrimSuffix\" rel=\"nofollow noreferrer\"><code>TrimSuffix</code></a> instead.</p>\n"}], "owner": {"reputation": 747, "user_id": 5539547, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/z3y7F.jpg?s=128&g=1", "display_name": "Tahseen", "link": "https://stackoverflow.com/users/5539547/tahseen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 50554056, "answer_count": 1, "score": -1, "last_activity_date": 1527437397, "creation_date": 1527437143, "last_edit_date": 1527437255, "question_id": 50554021, "link": "https://stackoverflow.com/questions/50554021/trimright-not-working-as-i-expected", "title": "TrimRight not working as I expected", "body": "<p>Below is the code of TrimRight, on latest Go version</p>\n\n<p>I am observing a behavior, which maybe I am misunderstanding but as my understanding, the below code should throw output as</p>\n\n<pre><code>Hello\n</code></pre>\n\n<p>But the output is coming as</p>\n\n<pre><code>Hell\n</code></pre>\n\n<p>Why is that so ? Note, I have kept a space before the Gophers in cutset, so fundamentally it should remove the \" Gophers\" from the primary string, leaving behind just Hello</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    result := strings.TrimRight(\"Hello Gophers\", \" Gophers\")\n\n    fmt.Println(result, len(result))\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 181, "user_id": 3312417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25b70924e4286adc821d46cadddf23dd?s=128&d=identicon&r=PG&f=1", "display_name": "Sveargith", "link": "https://stackoverflow.com/users/3312417/sveargith"}, "edited": false, "score": 0, "creation_date": 1527519129, "post_id": 50553967, "comment_id": 88147770, "body": "Maybe that two sending operations are running in a different thread when we put them in a goroutine?  So we can&#39;t guarantee to read them in order?"}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": false, "score": 1, "last_activity_date": 1527436729, "creation_date": 1527436729, "answer_id": 50553967, "question_id": 50553796, "link": "https://stackoverflow.com/questions/50553796/sending-data-to-two-channels-the-second-channel-might-receive-data-first-someti/50553967#50553967", "title": "Sending data to two channels, the second channel might receive data first sometime", "body": "<p><a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\">The order of message receiving in the select statement is pseudo-random.</a></p>\n"}], "owner": {"reputation": 181, "user_id": 3312417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25b70924e4286adc821d46cadddf23dd?s=128&d=identicon&r=PG&f=1", "display_name": "Sveargith", "link": "https://stackoverflow.com/users/3312417/sveargith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1527437299, "creation_date": 1527435636, "last_edit_date": 1527437032, "question_id": 50553796, "link": "https://stackoverflow.com/questions/50553796/sending-data-to-two-channels-the-second-channel-might-receive-data-first-someti", "title": "Sending data to two channels, the second channel might receive data first sometime", "body": "<pre><code>package main\n\nfunc m() {\n    c1 := make(chan int, 1)\n    c2 := make(chan int, 1)\n    go func() {\n        c1 &lt;- 1\n        c2 &lt;- 1\n    }()\n    select {\n    case &lt;-c1:\n    case &lt;-c2:\n        println(\"no way\")\n    }\n}\n\nfunc main() {\n    for i := 0; i &lt; 1000000; i++ {\n        m()\n    }\n}\n</code></pre>\n\n<p>There are two channels <code>c1</code>, <code>c2</code>.</p>\n\n<p>We are sending data to <code>c1</code> and <code>c2</code> in a goroutine. And we have a <code>select</code> to receive the data from these two channels and return.</p>\n\n<p>The question is: we are send data to <code>c1</code> first and receive from <code>c1</code> first in most cases. But sometimes we receive from <code>c2</code> first when sending to <code>c1</code> first. Why\uff1f</p>\n"}, {"tags": ["python", "node.js", "google-app-engine", "go", "apprtc"], "comments": [{"owner": {"reputation": 1453, "user_id": 8831875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7b9bb7786f4f3ac167a75ed2911b2d3?s=128&d=identicon&r=PG&f=1", "display_name": "A.Queue", "link": "https://stackoverflow.com/users/8831875/a-queue"}, "edited": false, "score": 0, "creation_date": 1528898273, "post_id": 50551364, "comment_id": 88681931, "body": "It&#39;s not clear from the description if you are running if you are running TURN server locally or in Google App Engine. Could you clarify that?"}, {"owner": {"reputation": 1453, "user_id": 8831875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7b9bb7786f4f3ac167a75ed2911b2d3?s=128&d=identicon&r=PG&f=1", "display_name": "A.Queue", "link": "https://stackoverflow.com/users/8831875/a-queue"}, "edited": false, "score": 0, "creation_date": 1528901967, "post_id": 50551364, "comment_id": 88684523, "body": "Also for cors please review this section about headers in <a href=\"https://cloud.google.com/appengine/docs/standard/go/config/appref#handlers_http_headers\" rel=\"nofollow noreferrer\">app.yaml</a>"}], "owner": {"reputation": 1, "user_id": 2312961, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efb31a6f3ca4f4daa117920b5188a77f?s=128&d=identicon&r=PG", "display_name": "Md. Mahfuz Hossain", "link": "https://stackoverflow.com/users/2312961/md-mahfuz-hossain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 137, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1527423940, "creation_date": 1527418210, "last_edit_date": 1527423940, "question_id": 50551364, "link": "https://stackoverflow.com/questions/50551364/how-to-enable-cors-in-apprtc", "title": "How to enable CORS in AppRTC?", "body": "<p>I have deployed my own apprtc server with collider &amp; turn server configured in Google App engine locally with virtualbox. Everything is working properly but I want to use this apprtc server in my another project that is in anoter IP. So, Apprtc IP and my project IP is different. Now, when I included <code>apprtc.debug.js</code> &amp; <code>appwindow.js</code> files to my project it cannot initialize loadingParams and says this error message \"Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at <code>http://&lt;IP OF APPRTC&gt;:8080/params</code>. (Reason: CORS header \u2018Access-Control-Allow-Origin\u2019 missing)\".</p>\n\n<p>However, entering <code>http://&lt;IP OF APPRTC&gt;:8080/params</code> in the browser gives me correct response but not in the project called in appwindow.js .After a bit of googling I added below lines in sendUrlRequest function :</p>\n\n<pre><code>xhr.setRequestHeader('Access-Control-Allow-Origin', '*');\nxhr.setRequestHeader('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');\n</code></pre>\n\n<p>Now it says \"CORS request did not succeed\". \nHow can I make it work? Do I have to enable cors in server side also, if so where and how to do that? Please help me, I'm totally lost here...</p>\n"}, {"tags": ["go", "networking", "tcp", "udp", "gopacket"], "answers": [{"tags": [], "owner": {"reputation": 349, "user_id": 4188769, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8f3afb7939f5281251ccf59f5935f0a5?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas Felber", "link": "https://stackoverflow.com/users/4188769/jonas-felber"}, "is_accepted": false, "score": 0, "last_activity_date": 1527497966, "creation_date": 1527497966, "answer_id": 50562611, "question_id": 50550693, "link": "https://stackoverflow.com/questions/50550693/how-to-pick-up-ip-packets-and-inject-on-different-vm-and-interface/50562611#50562611", "title": "How to pick up IP packets and inject on different VM and interface", "body": "<p>According to the <a href=\"https://godoc.org/github.com/google/gopacket/pcap\" rel=\"nofollow noreferrer\">Documentation</a></p>\n\n<blockquote>\n  <p>Package pcap allows users of gopacket to read packets off the wire or\n  from pcap files.</p>\n</blockquote>\n\n<p>To discard packages, you will need to be able to intercept them. Depending on how generic you want to solve this problem, you probably need to hook into the kernel. I recommend looking into iptables and netfilters.</p>\n\n<p>I found some VPN that are written in go, maybe look into how they are built, as you want to do something similar (tunnelling of packets).</p>\n"}], "owner": {"reputation": 1, "user_id": 4823338, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454308f9606edd823ebdc62138ef7761?s=128&d=identicon&r=PG&f=1", "display_name": "Aleksandaarrr", "link": "https://stackoverflow.com/users/4823338/aleksandaarrr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 216, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1527497966, "creation_date": 1527412621, "last_edit_date": 1527436475, "question_id": 50550693, "link": "https://stackoverflow.com/questions/50550693/how-to-pick-up-ip-packets-and-inject-on-different-vm-and-interface", "title": "How to pick up IP packets and inject on different VM and interface", "body": "<p>I have been trying to solve these 2 problems, but without success. </p>\n\n<ol>\n<li><p>I wonder if it's possible to remove specific packets from an interface with Gopacket or is it just for listening on the wire? For example when I send a UDP packet to a wrong port and then with Gopacket I correct it, it will send 2 packets, 1 to the wrong port and 1 to the correct one. Is there a way to discard/drop the wrong packet with Gopacket?</p></li>\n<li><p>What I am trying to do, is to pick up all packets that are sent by a client over IP and then encapsulate each packet as a payload in another protocol X and send to the remote host which will receive on protocol X, get the payload and send it on its interface to reach the server over IP again. (IP (Client) -> Protocol X (Sniffer 1) -> Protocol X (Sniffer 2) -> IP (Server))</p></li>\n</ol>\n\n<p>I have verified that the packet which Sniffer 1 picks up from the Client's interface is the same which arrives at Sniffer 2, but the problem is when Sniffer 2 injects it on the Server's interface. I can't see that packet with tcpdump or any other tool. The packet is injected with this command: </p>\n\n<pre><code>if handle, err := pcap.OpenLive(\"enp0s8\", 1600, true, 100); err != nil {\n    panic(err)\n} else {\n   err = handle.WritePacketData(packet.Data())\n}\n</code></pre>\n\n<p>If the Protocol X part is avoided, then the server will receive messages from client, but with Protocol X it is not possible.</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["go", "protocol-buffers", "glide-golang"], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 3812628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec8be6240e8bddc3f6e4ca1d647fe081?s=128&d=identicon&r=PG", "display_name": "Beno&#238;t Vernier", "link": "https://stackoverflow.com/users/3812628/beno%c3%aet-vernier"}, "edited": false, "score": 0, "creation_date": 1527776799, "post_id": 50550381, "comment_id": 88263279, "body": "Thank you for your answer, I have switched to dep for this project and didn&#39;t have the problem anymore."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 1, "last_activity_date": 1527409980, "creation_date": 1527409980, "answer_id": 50550381, "question_id": 50550127, "link": "https://stackoverflow.com/questions/50550127/error-scanning-github-com-golang-protobuf-proto-testdata-cannot-find-package/50550381#50550381", "title": "Error scanning github.com/golang/protobuf/proto/testdata: cannot find package &quot;.&quot;", "body": "<p>Before your own <a href=\"https://github.com/Masterminds/glide/issues/995\" rel=\"nofollow noreferrer\">PR (995)</a>, there was <a href=\"https://github.com/Masterminds/glide/issues/968\" rel=\"nofollow noreferrer\">glide issue 968</a></p>\n\n<blockquote>\n  <p>It looks like it's caused by a repository's structure changing, i.e. a sub-package being moved, or removed entirely.</p>\n</blockquote>\n\n<p>Workarounds proposed by <a href=\"https://github.com/seeruk\" rel=\"nofollow noreferrer\">Elliot Wright (<code>seeruk</code>)</a>:</p>\n\n<blockquote>\n  <p>If the package that has been updated is under your own control, then I've since found it easier to use some of the newer Go features like type aliases to ease the pain from refactoring.<br>\n  So, instead of just moving a package, move it and then make aliases to the new location in the old one so that your older code still works.<br>\n  Then, gradually move things over. Basically just mark things as deprecated but make sure they're still usable for a little while until you've ported new code over.</p>\n  \n  <p>If the package is <em>not</em> in your control, then you can always clone the version you want manually to your vendor folder and make your updates in your code.<br>\n  Once you're done, Glide should let you update again.<br>\n  If it's much more complex, sometimes it's even easier to revert to using <code>go get</code> until you're done updating packages, and rely on your <code>$GOPATH</code> contents.</p>\n  \n  <p>It's far from ideal, but there are ways you can work around it at least.<br>\n  In the mean time, I've also made an issue about this on dep.<br>\n  I think they're looking into a way of disabling this kind of check if you just want the tool to trust you as the developer.</p>\n</blockquote>\n\n<p>So you can check if you have the same issue using <a href=\"https://github.com/tools/godep\" rel=\"nofollow noreferrer\">godep</a>, or even the bleeding-edge <a href=\"https://github.com/golang/vgo\" rel=\"nofollow noreferrer\">vgo</a>.</p>\n"}], "owner": {"reputation": 125, "user_id": 3812628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec8be6240e8bddc3f6e4ca1d647fe081?s=128&d=identicon&r=PG", "display_name": "Beno&#238;t Vernier", "link": "https://stackoverflow.com/users/3812628/beno%c3%aet-vernier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 635, "favorite_count": 1, "accepted_answer_id": 50550381, "answer_count": 1, "score": 1, "last_activity_date": 1553441069, "creation_date": 1527407611, "last_edit_date": 1553441069, "question_id": 50550127, "link": "https://stackoverflow.com/questions/50550127/error-scanning-github-com-golang-protobuf-proto-testdata-cannot-find-package", "title": "Error scanning github.com/golang/protobuf/proto/testdata: cannot find package &quot;.&quot;", "body": "<p>When running <code>glide install</code> on my project, I get the following error:</p>\n\n<pre><code>[ERROR] Error scanning github.com/golang/protobuf/proto/testdata: cannot find package \".\" in:\n    /Users/bevernie/.glide/cache/src/https-github.com-golang-protobuf/proto/testdata\n[ERROR] Failed to retrieve a list of dependencies: Error resolving imports\n</code></pre>\n\n<p>When checking protobuf's source code, I can in fact see that there is no such package. I however don't directly use protobuf, so the error must come from one of the dependencies I use.</p>\n\n<p>When running <code>glide tree</code> on my project, there is only one instance of <code>github.com/golang/protobuf/proto/testdata</code>:</p>\n\n<pre><code>|-- github.com/golang/protobuf/proto   (/Users/bevernie/Programmation/work/src/github.com/golang/protobuf/proto)\n|   |-- github.com/golang/protobuf/proto/test_proto   (/Users/bevernie/Programmation/work/src/github.com/golang/protobuf/proto/test_proto)\n|   |   |-- (Recursion) github.com/golang/protobuf/proto   (/Users/bevernie/Programmation/work/src/github.com/golang/protobuf/proto)\n|   |-- github.com/golang/protobuf/ptypes/any   (/Users/bevernie/Programmation/work/src/github.com/golang/protobuf/ptypes/any)\n|   |   |-- (Recursion) github.com/golang/protobuf/proto   (/Users/bevernie/Programmation/work/src/github.com/golang/protobuf/proto)\n    github.com/golang/protobuf/proto/testdata   (glide get github.com/golang/protobuf/proto/testdata)\n|-- github.com/golang/protobuf/ptypes/any   (/Users/bevernie/Programmation/work/src/github.com/golang/protobuf/ptypes/any)\n|   |-- github.com/golang/protobuf/proto   (/Users/bevernie/Programmation/work/src/github.com/golang/protobuf/proto)\n|   |   |-- github.com/golang/protobuf/proto/test_proto   (/Users/bevernie/Programmation/work/src/github.com/golang/protobuf/proto/test_proto)\n|   |   |   |-- (Recursion) github.com/golang/protobuf/proto   (/Users/bevernie/Programmation/work/src/github.com/golang/protobuf/proto)\n|   |   |-- (Recursion) github.com/golang/protobuf/ptypes/any   (/Users/bevernie/Programmation/work/src/github.com/golang/protobuf/ptypes/any)\n</code></pre>\n\n<p>which doesn't really help me pinpoint the source of the problem.</p>\n\n<p>Do you have any suggestions as of how to fix the issues?</p>\n\n<p>My project was compiling just fine until a week or two ago (I use Docker to deploy in production, so the <code>glide install</code> was run every time and never failed before that, and I haven't added any new dependency recently). </p>\n"}, {"tags": ["json", "go", "types", "casting"], "comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1527404526, "post_id": 50549535, "comment_id": 88110414, "body": "Typically, best way to define your struct per JSON structure and unmarshal it. As you mentioned you&#39;re not interested in doing that instead doing manually by yourself. Anyway you could give it try on this package <code>https:&#47;&#47;github.com&#47;jeevatkm&#47;go-model</code>. Evaluate it, whether it would fulfill your requirement."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1527406389, "post_id": 50549535, "comment_id": 88110850, "body": "Please post the json that you want to unmarshal."}], "answers": [{"comments": [{"owner": {"reputation": 1011, "user_id": 2969402, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a971b3c4d070d8af92b98952b702c9bb?s=128&d=identicon&r=PG&f=1", "display_name": "user2969402", "link": "https://stackoverflow.com/users/2969402/user2969402"}, "edited": false, "score": 0, "creation_date": 1527453696, "post_id": 50554142, "comment_id": 88123514, "body": "Thank you for the detailed answer. I&#39;m aware of Marshall&#39;s support of struct tags. I think such an approach would work if I transformed each field back into a json string and then unmarshalling that to the struct but that seems unnecessarily complex."}], "tags": [], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "is_accepted": false, "score": 0, "last_activity_date": 1527437991, "creation_date": 1527437991, "answer_id": 50554142, "question_id": 50549535, "link": "https://stackoverflow.com/questions/50549535/assign-proper-types-to-data-read-from-json/50554142#50554142", "title": "Assign proper types to data read from JSON", "body": "<p>I'd advise against your current approach. You haven't provided enough context to tell us <em>why</em> you're choosing to unmarshall things one by one, but Go's support for JSON is good enough that I'd guess it is capable of doing what you want.</p>\n\n<p>Are you aware of Marshall's support for <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">struct tags</a>? Those might serve the purpose you're looking for. Your struct would then look something more like:</p>\n\n<pre><code>type Data struct {\n    Id         string       `json:\"id\"`\n    Value      string       `json:\"value\"`\n    Custom     customtype1  `json:\"custom_type\"`\n    Special    customtype2  `json:\"special_type\"`\n    TimeStamp  Time         `json:\"timestamp\"`\n}\n</code></pre>\n\n<p>If your problem is that the custom types don't know how to be unmarshalled, you can define custom unmarshalling functions for them. </p>\n\n<p>This would then enable you to unmarshall an object like the following:</p>\n\n<pre><code>{\n  \"id\": \"foo\",\n  \"value\": \"bar\",\n  \"custom_type\": \"2342-5234-4b24-b23a\",\n  \"special_type\": \"af23-af2f-rb32-ba23\",\n  \"timestamp\": \"2018-05-01 12:03:41\"\n}\n</code></pre>\n"}], "owner": {"reputation": 1011, "user_id": 2969402, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a971b3c4d070d8af92b98952b702c9bb?s=128&d=identicon&r=PG&f=1", "display_name": "user2969402", "link": "https://stackoverflow.com/users/2969402/user2969402"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1527475589, "creation_date": 1527401699, "last_edit_date": 1527475589, "question_id": 50549535, "link": "https://stackoverflow.com/questions/50549535/assign-proper-types-to-data-read-from-json", "title": "Assign proper types to data read from JSON", "body": "<p>I have a struct such as this one:</p>\n\n<pre><code>type Data struct {\n    Id         string\n    Value      string\n    Custom     customtype1\n    Special    customtype2\n    TimeStamp  Time        \n}\n\nvar model Data\n</code></pre>\n\n<p>I am reading data from a JSON object. Because the JSON is structured very differently, I can't just directly unmarshall the JSON into the struct. So I am trying to \"match\" the fields from the JSON objects to those of the struct one by one. I don't actually need to properly unmarshall the JSON data into the struct, all I really need is to be able to assign, for each field, the proper type to its value.</p>\n\n<p>So I unmarshall the JSON to a generic interface, then convert it to a <code>map[string]interface{}</code> and iterate over that. For each field, I try to find a match among the field names in the <code>model</code> variable which I get using <code>reflect</code>. </p>\n\n<p>Now this all works fine, but the problem arises when I try to get the right type for the values. </p>\n\n<p>I can get the <code>Type</code> for a certain field from the <code>model</code> using <code>reflect</code>, but then  I can't use that to cast the type of the value I get from the JSON because that is not a <code>type</code>. I can't use a <code>switch</code> statement either, because this is a simplified version of the situation and in reality I'm dealing with 1000+ different possible types. How can I convert the values I have for each field into their proper <code>type</code> ?</p>\n\n<p>The only I can think of solving this would be to recreate a json string that matches the format of the struct and then unmarshall that into its proper struct, but that seems way to convoluted. Surely there must be a simpler way?</p>\n\n<p>Here's a sample JSON (I can not change this structure, unless I rework it within my Go program):</p>\n\n<pre><code>{\n    \"requestId\": 101901,\n    \"userName\": \"test\",\n    \"options\": [1, 4],\n    \"request\": {\n        \"timeStamp\": {\n            \"Value1\": \"11/02/2018\",\n            \"Value2\": \"11/03/2018\"\n        },\n        \"id\": {\n            \"Value1\": \"123abcd\",\n            \"Value2\": \"0987acd\",\n            \"Value3\": \"a9c003\"\n        },\n        \"custom\": {\n            \"Value1\": \"customtype1_value\",\n            \"Value2\": \"customtype1_value\"\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527369130, "post_id": 50546947, "comment_id": 88104752, "body": "Is that the actual signature of your cleanup function or are you passing some arguments to it?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527369403, "post_id": 50546947, "comment_id": 88104810, "body": "Or is it a method defined on a non pointer value?"}, {"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527371143, "post_id": 50546947, "comment_id": 88105195, "body": "@mkopriva that is not the actual signature. The actual signature takes a *testing.T and an aetest.Instance. I&#39;ve updated the code example to more accurately reflect the actual code."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527371342, "post_id": 50546947, "comment_id": 88105237, "body": "What @mkopriva is hinting at is that function arguments are determined at the point of <code>defer</code> instead of when executed. Everything is pass-by-value, so a copy is made at the point of <code>defer</code> for when it finally executes. (Don&#39;t confuse a pointer though, the pointer value is copied, but it still points to the same thing which would reflect changes) See example for some gotchas. <a href=\"https://play.golang.org/p/2LoG_90OiSM\" rel=\"nofollow noreferrer\">play.golang.org/p/2LoG_90OiSM</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1527371391, "post_id": 50546947, "comment_id": 88105252, "body": "... yeah, what @RayfenWindspear said."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1527371527, "post_id": 50546947, "comment_id": 88105279, "body": "@Venantius a simple fix for this would be to wrap the call to the cleanup function into a closure, that way the args get evaluated at the time the deferred function is executed. <code>defer func() { cleanup(arg1, arg2) }()</code>"}, {"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "edited": false, "score": 0, "creation_date": 1527371749, "post_id": 50546947, "comment_id": 88105331, "body": "I tried wrapping it in a closure and that didn&#39;t seem to fix it. <code>defer func() { cleanupGoogleDatastore(t, testInstance) }()</code> - am I missing something?"}, {"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "edited": false, "score": 0, "creation_date": 1527371830, "post_id": 50546947, "comment_id": 88105347, "body": "Also, t is a pointer not a value, and as far as I know aetest.Instance is <i>also</i> a pointer."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527372518, "post_id": 50546947, "comment_id": 88105469, "body": "Hmm, then I&#39;m unsure what&#39;s up."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1527379675, "post_id": 50546947, "comment_id": 88106652, "body": "The only explanation I can think of is that the values of the arguments to the function are different at the two different places at which you&#39;ve tried calling it. Did you try printing out the values?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1527384924, "post_id": 50546947, "comment_id": 88107406, "body": "Not sure if this helps, but here&#39;s the internal <code>instance</code> type that implements <code>aetest.Instance</code>. <a href=\"https://github.com/golang/appengine/blob/master/aetest/instance_vm.go#L55\" rel=\"nofollow noreferrer\">github.com/golang/appengine/blob/master/aetest/&hellip;</a>"}, {"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1527411969, "post_id": 50546947, "comment_id": 88112110, "body": "@AndySchweig tried printing out the values; they&#39;re identical."}], "answers": [{"tags": [], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "is_accepted": false, "score": 2, "last_activity_date": 1527417150, "creation_date": 1527417150, "answer_id": 50551252, "question_id": 50546947, "link": "https://stackoverflow.com/questions/50546947/deferred-test-cleanup-behaves-differently-based-on-where-i-invoke-it/50551252#50551252", "title": "Deferred test cleanup behaves differently based on where I invoke it", "body": "<p>This turned out to be a deliberate property of the local App Engine Datastore stub, which returns weakly consistent queries by default. I was able to resolve this by changing the code for <code>cleanupGoogleDatastore</code> to rely on an ancestor query, which successfully found and then deleted all of the entities. An alternative approach would have been to set aetest.Instance to be strongly consistent, but I didn't want to force strongly consistent behavior on all of my tests - just this one. </p>\n"}], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1527417234, "creation_date": 1527368325, "last_edit_date": 1527417234, "question_id": 50546947, "link": "https://stackoverflow.com/questions/50546947/deferred-test-cleanup-behaves-differently-based-on-where-i-invoke-it", "title": "Deferred test cleanup behaves differently based on where I invoke it", "body": "<p>I've got a test that follows the following structure:</p>\n\n<pre><code>var testInstance aetest.Instance // initialized by a TestMain\n\nTestThing(t *testing.T) {\n    defer cleanupGoogleDatastore(t, testInstance)\n\n    // insert basic test fixtures\n\n    // insert some new records here\n\n    // test assertions, etc.\n}\n</code></pre>\n\n<p>The <code>cleanupGoogleDatastore</code> method just runs a datastore Query for all entities of a specific entity kind, and then deletes them one by one. Source here:</p>\n\n<pre><code>func cleanupGoogleDatastore(t *testing.T, testInstance aetest.Instance) {\n    q := datastore.NewQuery(\"Order\")\n    ctx := GetContext(t, testInstance)\n    scanner := q.Run(ctx)\n    for {\n        var o model.Order\n        key, err := scanner.Next(&amp;o)\n        if err == datastore.Done {\n            return\n        }\n        if err != nil {\n            t.Fatal(err.Error())\n        }\n        err = datastore.Delete(ctx, key)\n        if err != nil {\n            t.Fatal(err.Error())\n        }\n    }\n}\n</code></pre>\n\n<p>The problem I'm having is that records inserted after the \"basic test fixtures\" aren't deleted by this deferred cleanup statement. </p>\n\n<p>If I change this test function to instead look like the following: </p>\n\n<pre><code>var testInstance aetest.Instance // initialized by a TestMain  \n\nTestThing(t *testing.T) {\n    defer cleanupGoogleDatastore(t, testInstance)\n\n    // insert basic test fixtures\n\n    // insert some new records here\n\n    defer cleanupGoogleDatastore(t, testInstance)\n    // note that I have to call it TWICE - just moving it here is not enough.\n\n    // test assertions, etc.\n}\n</code></pre>\n\n<p><em>then</em> the newly created records are also deleted at the end of the test. My understanding was that <code>deferred</code> functions are just called at the end of the original function scope, which would imply that the query wouldn't be constructed and run until the end of the test, but that doesn't seem to be the case here. It seems like the query is being constructed <em>when the defer statement is called</em> and then executed at the end of the test. </p>\n\n<p>I've tried moving <code>cleanupGoogleDatastore</code> into a closure (e.g. <code>defer func() { cleanupGoogleDatastore(t, testInstance }()</code> and that didn't change anything. </p>\n\n<p>I suspect that somehow this is a case of the function arguments being evaluated at the point where I call defer instead of when the function is invoked, but since both <code>t</code> and <code>testInstance</code> are pointers rather than direct values I'm not sure how that could be happening. There's no other evidence that the two values have changed. Printing out the fields of both structs at the different logical evaluation points doesn't reveal anything new. </p>\n\n<p>What's going on here?</p>\n"}, {"tags": ["go", "struct", "types", "scope"], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 6356255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15649784fbf412e4cba7042fcdc46bb4?s=128&d=identicon&r=PG&f=1", "display_name": "phmrz", "link": "https://stackoverflow.com/users/6356255/phmrz"}, "edited": false, "score": 0, "creation_date": 1527366266, "post_id": 50546313, "comment_id": 88104082, "body": "Thanks for the answer, the only thing I didn&#39;t understand is why something calling my function would not know the exact type (human or alien), but only that it&#39;d be a creature after <i>returning a human</i> (last part of the first paragraph)."}, {"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "reply_to_user": {"reputation": 25, "user_id": 6356255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15649784fbf412e4cba7042fcdc46bb4?s=128&d=identicon&r=PG&f=1", "display_name": "phmrz", "link": "https://stackoverflow.com/users/6356255/phmrz"}, "edited": false, "score": 0, "creation_date": 1527367580, "post_id": 50546313, "comment_id": 88104374, "body": "@phmrz Feel free to toss me an upvote if the answer was good :D"}, {"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "reply_to_user": {"reputation": 25, "user_id": 6356255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15649784fbf412e4cba7042fcdc46bb4?s=128&d=identicon&r=PG&f=1", "display_name": "phmrz", "link": "https://stackoverflow.com/users/6356255/phmrz"}, "edited": false, "score": 0, "creation_date": 1527412906, "post_id": 50546313, "comment_id": 88112366, "body": "Haha tragic. Oh well! Happy hunting."}], "tags": [], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "is_accepted": false, "score": 1, "last_activity_date": 1527362585, "creation_date": 1527362585, "answer_id": 50546313, "question_id": 50546218, "link": "https://stackoverflow.com/questions/50546218/initialize-struct-with-global-scope-where-type-depends-on-boolean/50546313#50546313", "title": "Initialize struct with global scope where type depends on boolean", "body": "<p>So, I'm going to go out on a limb and say you're probably thinking about this the wrong way. </p>\n\n<p>The first question that occurs to me looking at your example is: what's the return type of this function? In other words, what signature do you <em>need</em> <code>h</code> to be? If <code>alien</code> has an embedded struct <code>creature</code> (which seems to be the inheritance pattern you're trying to follow), and you return a <code>human</code> from your function after declaring <code>h</code> to be a <code>creature</code>, anything that consumes your function will only know that it's dealing with a <code>creature</code>, so there's no point in declaring it a <code>human</code> or an <code>alien</code> in the first place. </p>\n\n<p>I <em>suspect</em> that what you really want to be doing is moving away from concrete structs here and instead using interfaces. In that world, you'd have a <code>creature</code> interface, and both <code>human</code> and <code>alien</code> would satisfy the <code>creature</code> interface. You wouldn't necessarily know which one you were dealing with downstream, but you'd be able to reliably call <code>creature</code> methods and the appropriate <code>human</code> or <code>alien</code> implementation would be invoked. </p>\n"}, {"comments": [{"owner": {"reputation": 25, "user_id": 6356255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15649784fbf412e4cba7042fcdc46bb4?s=128&d=identicon&r=PG&f=1", "display_name": "phmrz", "link": "https://stackoverflow.com/users/6356255/phmrz"}, "edited": false, "score": 0, "creation_date": 1527364343, "post_id": 50546334, "comment_id": 88103664, "body": "Alright, thank you very much. I think I&#39;ll just have to learn a bit more about interfaces and structs..."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 25, "user_id": 6356255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15649784fbf412e4cba7042fcdc46bb4?s=128&d=identicon&r=PG&f=1", "display_name": "phmrz", "link": "https://stackoverflow.com/users/6356255/phmrz"}, "edited": false, "score": 0, "creation_date": 1527369204, "post_id": 50546334, "comment_id": 88104772, "body": "@phmrz Here is an example of this with some type assertions and a type switch. Admittedly, <code>type CreatureType</code> is a little redundant here, but could (and should) be used in places where you don&#39;t need the concrete type, but just need to know what it is. <a href=\"https://play.golang.org/p/xhKU8GYX2SX\" rel=\"nofollow noreferrer\">play.golang.org/p/xhKU8GYX2SX</a>"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 1, "last_activity_date": 1527362766, "creation_date": 1527362766, "answer_id": 50546334, "question_id": 50546218, "link": "https://stackoverflow.com/questions/50546218/initialize-struct-with-global-scope-where-type-depends-on-boolean/50546334#50546334", "title": "Initialize struct with global scope where type depends on boolean", "body": "<p>As you noted, the problem is clearly represented by this statement:</p>\n\n<pre><code>var h human //use human or alien here?\n</code></pre>\n\n<p>If you plan to use that <code>h</code> variable there after creating the objects, then the type of <code>h</code> must be one that can accept either a <code>human</code> or <code>alien</code> as a value.</p>\n\n<p>The way to do this in Go is by using an <code>\u00ecnterface</code> that both <code>alien</code> and <code>human</code> can fulfil.</p>\n\n<p>So you should declare an interface like:</p>\n\n<pre><code>type subject interface {\n    // you should list all functions that you plan to use on \"h\" afterwards\n    // both \"human\" and \"alien\" must implement those functions \n}\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>var h subject\n</code></pre>\n\n<p>Will do the trick.</p>\n"}], "owner": {"reputation": 25, "user_id": 6356255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15649784fbf412e4cba7042fcdc46bb4?s=128&d=identicon&r=PG&f=1", "display_name": "phmrz", "link": "https://stackoverflow.com/users/6356255/phmrz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 538, "favorite_count": 0, "accepted_answer_id": 50546334, "answer_count": 2, "score": 2, "last_activity_date": 1527362766, "creation_date": 1527361870, "question_id": 50546218, "link": "https://stackoverflow.com/questions/50546218/initialize-struct-with-global-scope-where-type-depends-on-boolean", "title": "Initialize struct with global scope where type depends on boolean", "body": "<p>I started using Golang recently and stumbled across a problem:</p>\n\n<p>I have two structs, <code>human</code> and <code>alien</code>, which are both based on the <code>creature</code> struct. I want to initialize one of them based on the value of the <code>isAlien</code> boolean inside of an if-statement.</p>\n\n<p>Using the <code>human := human{}</code> notation or the alien equivalent inside the if blocks to initialize, the instances aren't accessible from outside of the if-statement.</p>\n\n<p>On the other hand, the usual solution of declaring the type and the name of the variable before the if-statement and initializing the variable inside the if-statement doesn't work, because there two are different types:</p>\n\n<pre><code>var h human //use human or alien here?\nif isAlien {\n  h = alien{} //Error: incompatible types\n} else {\n h = human{}\n}\n//same when swapping human with alien at the declaration\n</code></pre>\n\n<p>I know that I could just declare both types before the if-statement but that solution doesn't seem elegant to me.</p>\n\n<p>Is there some obvious solution that I'm missing here?</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527367634, "post_id": 50546169, "comment_id": 88104383, "body": "As the error says <code>mqtt.Client</code> is not <code>*mqtt.Client</code> and you cannot use them interchangeably. Your init takes a <code>*mqtt.Client</code> but <a href=\"https://godoc.org/github.com/eclipse/paho.mqtt.golang#NewClient\" rel=\"nofollow noreferrer\"><code>mqtt.NewClient</code></a> returns <code>mqtt.Client</code>, therefore this line <code>client = MQTT.NewClient(opts)</code> is illegal."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527367883, "post_id": 50546169, "comment_id": 88104438, "body": "Secondly <a href=\"https://godoc.org/github.com/eclipse/paho.mqtt.golang#Client\" rel=\"nofollow noreferrer\"><code>mqtt.Client</code></a> is an <code>interface</code> type and in Go it almost never a good idea to use pointers to interface types. So to practice pointers in Go you will better off doing it with normal types, like structs, strings, ints, etc. Not interfaces, also maps aren&#39;t good candidates.."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527368267, "post_id": 50546169, "comment_id": 88104521, "body": "If you decide to stick with interface pointers anyways, please understand that a pointer value to an interface type cannot be used directly to call the methods of the interface (<a href=\"https://play.golang.org/p/AjEi65n4sef\" rel=\"nofollow noreferrer\">play.golang.org/p/AjEi65n4sef</a>) but that you already know since you are attempting to dereference the pointer on this line <code>*client.Connect()</code>. This however is not how it&#39;s done due to evaluation precedence rules which are ambiguous in your expression, to make them clear for the compiler you can use parentheses like so <a href=\"https://play.golang.org/p/TERzSqwk0NB\" rel=\"nofollow noreferrer\"><code>(*client).Connect()</code></a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1527368530, "post_id": 50546169, "comment_id": 88104589, "body": "And, I forgot, to fix the initialization line you need to dereference the pointer of the client argument and assign the result of NewClient to that. <code>*client = MQTT.NewClient(opts)</code>... So really you have two lines that need fixing to make the program compile: <a href=\"https://play.golang.org/p/1sY7bHNBw22\" rel=\"nofollow noreferrer\">play.golang.org/p/1sY7bHNBw22</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1527430732, "post_id": 50546169, "comment_id": 88116889, "body": "You must forget about &quot;reference&quot; now and forever. There is absolutely no such thing in Go and passing a pointer value is not pass by reference. Get over that and treat pointers as what they are: A memory address."}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1527368845, "post_id": 50546343, "comment_id": 88104669, "body": "<i>&quot;The fact that you&#39;ve passed its memory address does not enable you to modify it.&quot;</i> That&#39;s not correct, see here: <a href=\"https://play.golang.org/p/l5-o5a3-QZf\" rel=\"nofollow noreferrer\">play.golang.org/p/l5-o5a3-QZf</a>"}], "tags": [], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "is_accepted": true, "score": 0, "last_activity_date": 1527362879, "creation_date": 1527362879, "answer_id": 50546343, "question_id": 50546169, "link": "https://stackoverflow.com/questions/50546169/pointer-to-interface-not-interface/50546343#50546343", "title": "&quot;pointer to interface, not interface&quot;", "body": "<p>This is a common misunderstanding. Because you've defined <code>c</code> as a value rather than a pointer type, you can't modify it without re-defining it. </p>\n\n<p>The fact that you've passed its memory address does not enable you to modify it. This is different from a number of other languages.</p>\n"}], "owner": {"reputation": 18898, "user_id": 903011, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6a8f2f5f292c75c5e81a6607530a0ab6?s=128&d=identicon&r=PG", "display_name": "WoJ", "link": "https://stackoverflow.com/users/903011/woj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2680, "favorite_count": 0, "accepted_answer_id": 50546343, "answer_count": 1, "score": 0, "last_activity_date": 1527362879, "creation_date": 1527361485, "question_id": 50546169, "link": "https://stackoverflow.com/questions/50546169/pointer-to-interface-not-interface", "title": "&quot;pointer to interface, not interface&quot;", "body": "<p>I am learning Go and decided to rewrite a MQTT orchestrator which I originally wrote in Python. The very basic part works fine:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"os\"\n\n    MQTT \"github.com/eclipse/paho.mqtt.golang\"\n    log \"github.com/sirupsen/logrus\"\n)\n\n// definitions for a switch\n\ntype Switch struct {\n    topic string\n    state int\n}\n\nfunc allEvents(client MQTT.Client, msg MQTT.Message) {\n    log.WithFields(log.Fields{\"topic\": msg.Topic(), \"payload\": fmt.Sprintf(\"%s\", msg.Payload())}).Info()\n}\n\n\nfunc initMQTT() MQTT.Client {\n    opts := MQTT.NewClientOptions()\n    opts.AddBroker(\"tcp://mqtt.example.com:1883\")\n    opts.SetClientID(\"go-dispatcher\")\n    opts.SetCleanSession(true)\n    client := MQTT.NewClient(opts)\n    if token := client.Connect(); token.Wait() &amp;&amp; token.Error() != nil {\n        panic(token.Error())\n    }\n    log.Info(\"connected to MQTT broker\")\n    return client\n}\n\nfunc main() {\n    // this is that part I want to modify later in the question\n    c := initMQTT()\n    if token := c.Subscribe(\"#\", 0, allEvents); token.Wait() &amp;&amp; token.Error() != nil {\n        fmt.Println(token.Error())\n        os.Exit(1)\n    }\n\n    time.Sleep(100000 * time.Hour)\n}\n</code></pre>\n\n<p>Having used pointers in a distant past with C, I wanted to modify the program to pass, in the initialization part, the client by reference (more as a learning experience, the first code looks better to me)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"os\"\n\n    MQTT \"github.com/eclipse/paho.mqtt.golang\"\n    log \"github.com/sirupsen/logrus\"\n)\n\n// definitions for a switch\n\ntype Switch struct {\n    topic string\n    state int\n}\n\nfunc allEvents(client MQTT.Client, msg MQTT.Message) {\n    log.WithFields(log.Fields{\"topic\": msg.Topic(), \"payload\": fmt.Sprintf(\"%s\", msg.Payload())}).Info()\n}\n\n// this time we get a pointer and do not return anything\nfunc initMQTT(client *MQTT.Client) {\n    opts := MQTT.NewClientOptions()\n    opts.AddBroker(\"tcp://mqtt.example.com:1883\")\n    opts.SetClientID(\"go-dispatcher\")\n    opts.SetCleanSession(true)\n    client = MQTT.NewClient(opts)\n    if token := *client.Connect(); token.Wait() &amp;&amp; token.Error() != nil {\n        panic(token.Error())\n    }\n    log.Info(\"connected to MQTT broker\")\n}\n\nfunc main() {\n    // the client is defined in main()\n    var c MQTT.Client\n    // and passed by reference so that the function modifies it\n    initMQTT(&amp;c)\n    if token := c.Subscribe(\"#\", 0, allEvents); token.Wait() &amp;&amp; token.Error() != nil {\n        fmt.Println(token.Error())\n        os.Exit(1)\n    }\n\n    time.Sleep(100000 * time.Hour)\n}\n</code></pre>\n\n<p>It fails to compile with</p>\n\n<pre><code># command-line-arguments\n.\\main.go:29:9: cannot use mqtt.NewClient(opts) (type mqtt.Client) as type *mqtt.Client in assignment:\n    *mqtt.Client is pointer to interface, not interface\n.\\main.go:30:21: client.Connect undefined (type *mqtt.Client is pointer to interface, not interface)\n</code></pre>\n\n<p>Following advice form <a href=\"https://stackoverflow.com/questions/41687665/pass-struct-for-function-that-accepts-a-interface\">another question</a>, I tried to remove <code>&amp;</code> and <code>*</code> (blindly to start with, to tell the truth), and get a runtime error</p>\n\n<pre><code>time=\"2018-05-26T21:02:20+02:00\" level=info msg=\"connected to MQTT broker\"\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xc0000005 code=0x0 addr=0x0 pc=0x604486]\n\ngoroutine 1 [running]:\nmain.main()\n    D:/Seafile/dev/Go/src/perso/domotique.dispatcher/main.go:39 +0x36\n</code></pre>\n\n<p><strong>I though that since I defined <code>c</code>, I could just pass it as a reference but apparently the C-way is not the right one here?</strong> (it is usually in the examples I read)</p>\n"}, {"tags": ["unit-testing", "oop", "testing", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1527353928, "post_id": 50544943, "comment_id": 88101177, "body": "Don&#39;t mock your method--mock the functions called by your method. So in this case, mock <code>c.Request()</code>--or mock the server it talks to (it&#39;s trivial in Go to start a test server that can send actual HTTP responses for your tests to consume)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1527430862, "post_id": 50544943, "comment_id": 88116930, "body": "A Java-esque attempt to unit testing is damned to fail in Go. Don&#39;t Do this. Either call an actual HTTP server (trivial) or separate this piece of functionality. Never even try traditional OOP techniques in Go, they all will fail."}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 8, "last_activity_date": 1527362334, "creation_date": 1527362334, "answer_id": 50546279, "question_id": 50544943, "link": "https://stackoverflow.com/questions/50544943/override-go-method-in-tests/50546279#50546279", "title": "Override Go Method in Tests", "body": "<p>To accomplish what you need, you can re-structure your code just a little bit.</p>\n\n<p>You can find a full working example here: <a href=\"https://play.golang.org/p/VoO4M4U0YcA\" rel=\"noreferrer\">https://play.golang.org/p/VoO4M4U0YcA</a></p>\n\n<p>And below is the explanation.</p>\n\n<p>First, declare a variable function in your package to encapsulate the actual making of the HTTP request:</p>\n\n<pre><code>var MakeRequest = func(opts Request) (resp []byte, err error) {\n    // make the request, return response and error, etc\n}\n</code></pre>\n\n<p>Then, in your <code>Client</code> use that function to make the request:</p>\n\n<pre><code>func (c Client) Request(opts Request) (resp []byte, err error) {\n    return MakeRequest(opts)\n}\n</code></pre>\n\n<p>In that way, when you actually use the client, it will make the HTTP request as expected.</p>\n\n<p>But then when you need to test, you can assign a mock function to that <code>MakeRequest</code> function so that you can control its behaviour:</p>\n\n<pre><code>// define a mock requester for your test\n\ntype mockRequester struct {\n    fakeUser  User\n    fakeError error\n}\n\nfunc (mc mockRequester) Request(opts Request) (resp []byte, err error) {\n    resp, err = json.Marshal(mc.fakeUser)\n    err = mc.fakeError\n    return\n}\n\n// to use it, you can just point `MakeRequest` to the mock object function\n\nmockRequester := mockRequester{\n    fakeUser:  User{ ID: \"fake\" },\n    fakeError: nil,\n}\nMakeRequest = mockRequester.Request\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 2, "last_activity_date": 1527412829, "last_edit_date": 1592644375, "creation_date": 1527368086, "answer_id": 50546917, "question_id": 50544943, "link": "https://stackoverflow.com/questions/50544943/override-go-method-in-tests/50546917#50546917", "title": "Override Go Method in Tests", "body": "<blockquote>\n<p><strong>I then assume that my approach is not right then.</strong></p>\n</blockquote>\n<p>Your description covers it Exactly!  Even though you're <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">embedding</a> the <code>Client</code> in <code>mockClient</code> when you call <code>client.UserByID(c.id)</code> go looks at the <code>mockClient</code> and sees the method pulled up from <code>Client</code> . it ends up so that the <code>Client</code>!!! is the receiver to <code>UserByID</code> call NOT the <code>mockClient</code>. You can see this here:</p>\n<p><code>func (c Client) UserByID(id string) (u User, err error)</code></p>\n<p>Once the <code>Client</code> is the receiver <code> resp, err := c.Request(opts)</code> is called with the <code>Client</code> receiver above and NOT your <code>mockClient</code> as you're observing.</p>\n<hr />\n<p>One way to introduce a <a href=\"http://www.informit.com/articles/article.aspx?p=359417&amp;seqNum=2\" rel=\"nofollow noreferrer\">seam</a> for <code>c.Request</code> that you can provide a custom implementation for use in unit testing is to make <code>Request</code> a callout method on your <code>Client</code> struct.</p>\n<pre><code>type Client struct {\n    Request func(opts Request) (resp []byte, err error) \n}\n</code></pre>\n<p>The above should help to decouple Client from <code>Request</code> implementation.  All it says is that <code>Request</code> will be a function that takes some args with some return value, allowing you to substitute different functions depending if you're in production or testing.  Now during your public initialization of <code>Client</code> you can provide your real implementation of <code>Request</code>, while in unit tests you can provide your fake implementation.</p>\n<pre><code>type mockRequester struct {\n  fakeUser  User\n  fakeError error\n}\n\nfunc (mc mockRequester) Request(opts Request) (resp []byte, err error) {\n  resp, err = json.Marshal(mc.fakeUser)\n  err = mc.fakeError\n  return\n}\n\nmr := mockRequester{...}\nc := Client{  \n  Request: mr.Request,\n}\n</code></pre>\n<p>This comes with its own tradeoffs though as you potentially lose the client as a pointer receiver in your <code>Request</code> callout function.</p>\n<p>Another cool part of the Callout is that it gives you another option of encapsulation.  Suppose in the future you'd like to provide some sort of exponential backoff or retry.  It would allow you to provide a more intelligent <code>Request</code> method to <code>Client</code> without <code>Client</code> having to change.</p>\n"}], "owner": {"reputation": 3703, "user_id": 5796559, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/Qd90G.jpg?s=128&g=1", "display_name": "KA01", "link": "https://stackoverflow.com/users/5796559/ka01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4132, "favorite_count": 0, "answer_count": 2, "score": 8, "last_activity_date": 1527412829, "creation_date": 1527352866, "last_edit_date": 1527368441, "question_id": 50544943, "link": "https://stackoverflow.com/questions/50544943/override-go-method-in-tests", "title": "Override Go Method in Tests", "body": "<p>So I have this <code>Client</code> struct that has a method <code>UserByID</code> that makes a HTTP request to an endpoint for a <code>User</code>. I want to unit test this function but also not make an actual HTTP request in the function <code>c.Request</code>. I want to stub that function with a response and error I can control.</p>\n\n<pre><code>func (c Client) UserByID(id string) (u User, err error) {\n  v := url.Values{}\n  v.Set(\"id\", id)\n  opts := Request{\n    HTTP: http.Request{\n        Method: http.MethodGet,\n        Form:   v,\n    },\n    URL: 'some/endpoint/users',\n  }\n  resp, err := c.Request(opts)\n  err = json.Unmarshal(resp, &amp;u)\n  return\n}\n</code></pre>\n\n<p>Here's what the stub looks like:</p>\n\n<pre><code>type mockClient struct {\n  Client\n  fakeUser  User\n  fakeError error\n}\n\nfunc (mc mockClient) Request(opts Request) (resp []byte, err error) {\n  resp, err = json.Marshal(mc.fakeUser)\n  err = mc.fakeError\n  return\n}\n</code></pre>\n\n<p>In a single test I have something like:</p>\n\n<pre><code>client := mockClient{\n  fakeUser: User{},\n  fakeError: nil,\n}\nuser, err := client.UserByID(c.id)\n</code></pre>\n\n<p>Then I can assert the return values from <code>client.UserByID</code>. In this example I'm trying to override the <code>client.Request</code> function but I understand Go is not an inheritance-type of language. In my tests, my <code>mockClient.Request</code> function is not being called. The original <code>client.Request</code> is still being called.</p>\n\n<p>I then assume that my approach is not right then. How can I test <code>client.UserByID</code> without actually calling the real <code>client.Request</code> function within it? Should the design of my methods be different?</p>\n"}, {"tags": ["go", "hash", "checksum", "gob"], "comments": [{"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "edited": false, "score": 0, "creation_date": 1527348316, "post_id": 50544091, "comment_id": 88099594, "body": "WAL-log is redundant :)"}, {"owner": {"reputation": 11, "user_id": 753819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aab03db68991a7fc9be213e0354f8212?s=128&d=identicon&r=PG", "display_name": "Chaak", "link": "https://stackoverflow.com/users/753819/chaak"}, "reply_to_user": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "edited": false, "score": 0, "creation_date": 1527457257, "post_id": 50544091, "comment_id": 88124364, "body": "why? gob provides safety or what?"}, {"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "edited": false, "score": 0, "creation_date": 1527461988, "post_id": 50544091, "comment_id": 88125319, "body": "WAL = \u201cwrite-ahead log\u201d. So you\u2019re saying \u201cwrite-ahread log log\u201d"}, {"owner": {"reputation": 11, "user_id": 753819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aab03db68991a7fc9be213e0354f8212?s=128&d=identicon&r=PG", "display_name": "Chaak", "link": "https://stackoverflow.com/users/753819/chaak"}, "reply_to_user": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "edited": false, "score": 0, "creation_date": 1527528145, "post_id": 50544091, "comment_id": 88151747, "body": "ah ok ty for remark"}], "owner": {"reputation": 11, "user_id": 753819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aab03db68991a7fc9be213e0354f8212?s=128&d=identicon&r=PG", "display_name": "Chaak", "link": "https://stackoverflow.com/users/753819/chaak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1527347154, "creation_date": 1527347154, "question_id": 50544091, "link": "https://stackoverflow.com/questions/50544091/how-to-calculate-hash-for-every-record-being-written-via-gob-encode", "title": "How to calculate hash for every record being written via gob.Encode", "body": "<p>My target is to create something like WAL-log and to ensure that data consistent I use some hashing.</p>\n\n<p>I have the following code computing hash for every encoded record:</p>\n\n<pre><code>package dumper_test\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"encoding/gob\"\n    \"hash/crc32\"\n    \"io\"\n    \"testing\"\n)\n\ntype Entry struct {\n    A string\n    B bool\n}\n\nfunc TestX(t *testing.T) {\n    gob.Register(Entry{})\n\n    // encoder part part\n    encHasher := crc32.New(crc32.MakeTable(crc32.Castagnoli))\n    w := &amp;bytes.Buffer{}\n    enc := gob.NewEncoder(io.MultiWriter(w, encHasher))\n\n    entry := Entry{}\n    if err := enc.Encode(&amp;entry); err != nil {\n        t.Fatal(err)\n    }\n    t.Logf(\"encHash: %d\", encHasher.Sum32())\n    if err := enc.Encode(&amp;entry); err != nil {\n        t.Fatal(err)\n    }\n    t.Logf(\"encHash: %d\", encHasher.Sum32())\n\n    // decoder part\n    decHasher := crc32.New(crc32.MakeTable(crc32.Castagnoli))\n    r := bufio.NewReader(w)\n    dec := gob.NewDecoder(io.TeeReader(r, decHasher))\n    var decEntry Entry\n    if err := dec.Decode(&amp;decEntry); err != nil {\n        t.Fatal(err)\n    }\n    t.Logf(\"decHash: %d\", decHasher.Sum32())\n    if err := dec.Decode(&amp;decEntry); err != nil {\n        t.Fatal(err)\n    }\n    t.Logf(\"decHash: %d\", decHasher.Sum32())\n\n    if encHasher.Sum32() != decHasher.Sum32() {\n        t.Fail()\n    }\n}\n</code></pre>\n\n<p>It produces following output:</p>\n\n<pre><code>=== RUN   TestX\n--- PASS: TestX (0.00s)\n    gob_test.go:29: encHash: 3843220763\n    gob_test.go:33: encHash: 1109147424\n    gob_test.go:43: decHash: 1109147424\n    gob_test.go:47: decHash: 1109147424\nPASS\n</code></pre>\n\n<p>So why hashes are the same when I decode entries sequentially? How to achieve this output:</p>\n\n<pre><code>=== RUN   TestX\n--- PASS: TestX (0.00s)\n    gob_test.go:29: encHash: 3843220763\n    gob_test.go:33: encHash: 1109147424\n    gob_test.go:43: decHash: 3843220763\n    gob_test.go:47: decHash: 1109147424\nPASS\n</code></pre>\n"}, {"tags": ["go", "mutex", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 677, "user_id": 5258884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/aac9d147863b2fb6548ac05e1d8355d1?s=128&d=identicon&r=PG&f=1", "display_name": "Yriuns", "link": "https://stackoverflow.com/users/5258884/yriuns"}, "edited": false, "score": 0, "creation_date": 1527340282, "post_id": 50543065, "comment_id": 88097365, "body": "The variable <code>s</code> is locked by <code>send()</code> function. And <code>receive()</code> try to read the variable from <code>s.ch</code>, so it has to wait the lock be unlocked. Do I misunderstand the <code>Mutex</code>?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1527340703, "last_edit_date": 1527340703, "creation_date": 1527339692, "answer_id": 50543065, "question_id": 50543002, "link": "https://stackoverflow.com/questions/50543002/why-dont-these-goroutines-block/50543065#50543065", "title": "Why don&#39;t these goroutines block?", "body": "<p>Your <code>receive()</code> method doesn't use the lock, so <code>send()</code> holding the lock has no effect on <code>receive()</code>.</p>\n\n<p>And since both <code>send()</code> and <code>receive()</code> run in their own goroutine, <code>send()</code> will make it to the point where it sends the value <code>5</code> on the channel, and so the receive in <code>receive()</code> can proceed, and it will, and will print it in the next line.</p>\n\n<p>Also note that to use channels from multiple goroutines, you do not need \"external\" synchronization. Channels are safe for concurrent use, data races cannot occur by design. For details, see <a href=\"https://stackoverflow.com/questions/34039229/if-i-am-using-channels-properly-should-i-need-to-use-mutexes/34039377#34039377\">If I am using channels properly should I need to use mutexes?</a></p>\n\n<p>If the <code>receive()</code> method would also use the lock like this:</p>\n\n<pre><code>func (s *S) receive() {\n    s.mu.Lock()\n    num := &lt;-s.ch\n    s.mu.Unlock()\n    fmt.Printf(\"%d\\n\", num)\n}\n</code></pre>\n\n<p>Then yes, nothing would be printed, because the receive cannot happen until <code>send()</code> releases the lock, but that can't happen until someone receives from the channel.</p>\n\n<p>And in this case the program would terminate after 1 second without printing anything, because when the sleep is over the main goroutine ends, so does your whole app with it. It does not wait for other non-main goroutines to complete. For details, see <a href=\"https://stackoverflow.com/questions/28958192/no-output-from-goroutine-in-go/28958240#28958240\">No output from goroutine in Go</a>.</p>\n\n<p>Edit:</p>\n\n<p>Yes, you misunderstand the lock. Locking a <code>sync.Mutex</code> only locks the mutex value itself, it does not lock the whole struct value (it can't). And \"locks the value itself\" means if another goroutine also calls its <code>Mutex.Lock()</code> method, that call will block until the lock is released by calling its <code>Mutex.Unlock()</code> method. When it's unlocked, the goroutine that is blocked at the <code>Mutex.Lock()</code> call will proceed to lock the mutex and return.</p>\n"}], "owner": {"reputation": 677, "user_id": 5258884, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/aac9d147863b2fb6548ac05e1d8355d1?s=128&d=identicon&r=PG&f=1", "display_name": "Yriuns", "link": "https://stackoverflow.com/users/5258884/yriuns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 50543065, "answer_count": 1, "score": 1, "last_activity_date": 1527341269, "creation_date": 1527339245, "last_edit_date": 1527341269, "question_id": 50543002, "link": "https://stackoverflow.com/questions/50543002/why-dont-these-goroutines-block", "title": "Why don&#39;t these goroutines block?", "body": "<p>I expect these two goroutines to block forever for the reasons as below but it doesn't. Why?</p>\n\n<ol>\n<li><p>The channel has no buffer and will be waiting for <code>receive()</code> to receive.</p></li>\n<li><p><code>send()</code> hold the lock so <code>num := &lt;-s.ch</code> in <code>receive()</code> has no chance to execute.</p></li>\n<li><p>Block forever</p></li>\n</ol>\n\n<p>What's wrong?</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    \"fmt\"\n)\n\ntype S struct {\n    mu sync.Mutex\n    ch chan int\n    wg sync.WaitGroup\n}\n\nfunc (s *S) send() {\n    s.mu.Lock()\n    s.ch &lt;- 5\n    s.mu.Unlock()\n    s.wg.Done()\n}\nfunc (s *S) receive() {\n    num := &lt;-s.ch\n    fmt.Printf(\"%d\\n\", num)\n    s.wg.Done()\n}\n\nfunc main() {\n    s := new(S)\n    s.ch = make(chan int)\n    s.wg.Add(2)\n    go s.send()\n    go s.receive()\n    s.wg.Wait()\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 3138, "user_id": 4772647, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/nmwnL.jpg?s=128&g=1", "display_name": "TheoK", "link": "https://stackoverflow.com/users/4772647/theok"}, "edited": false, "score": 2, "creation_date": 1527494126, "post_id": 50561535, "comment_id": 88133571, "body": "Thanks for the answer. After some research (on Java mongo driver questions) I found out that they say the same. Maybe the inline option would suit me best, since it will keep the go struct more organized, and I will have the document flattened to perform partial updates. It&#39;s weird though that this cannot be done."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3138, "user_id": 4772647, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/nmwnL.jpg?s=128&g=1", "display_name": "TheoK", "link": "https://stackoverflow.com/users/4772647/theok"}, "edited": false, "score": 3, "creation_date": 1527495309, "post_id": 50561535, "comment_id": 88134164, "body": "@TheoK Note that a utility function could be created which would provide this functionality to you. I&#39;d estimate this could be done with like 50 lines of code, which isn&#39;t that much if you think of it. Maybe it would be worth to you to implement this."}, {"owner": {"reputation": 142, "user_id": 9830227, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-yAdstXPgqRQ/AAAAAAAAAAI/AAAAAAAAAdQ/COp_BAnd7AE/photo.jpg?sz=128", "display_name": "Chidi Williams", "link": "https://stackoverflow.com/users/9830227/chidi-williams"}, "edited": false, "score": 1, "creation_date": 1589917411, "post_id": 50561535, "comment_id": 109482493, "body": "Thanks, @icza. I ran into this same issue as well and wrote a small package for generating the update document just as you said: <a href=\"https://github.com/chidiwilliams/flatbson\" rel=\"nofollow noreferrer\">github.com/chidiwilliams/flatbson</a>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1527493792, "creation_date": 1527493792, "answer_id": 50561535, "question_id": 50542717, "link": "https://stackoverflow.com/questions/50542717/partial-update-of-embedded-document-in-mongodb-using-mgo/50561535#50561535", "title": "Partial update of embedded document in mongoDB using mgo", "body": "<p>First let's quickly explain your <code>createdAt</code> field. This is the value you save: <code>2018-05-26T15:08:56.764453386+03:00</code>. Know that MongoDB stores dates with millisecond precision, and in UTC timezone. So this date when saved and retrieved from MongoDB becomes <code>2018-05-26T12:08:56.764Z</code>, this is the \"same\" time instant, just in UTC zone and precision truncated to milliseconds.</p>\n\n<p>Now on to updating embedded documents:</p>\n\n<p>The short and unfortunate answer is that we can't do this directly with the <code>mgo</code> library and Go models.</p>\n\n<h2>Why?</h2>\n\n<p>When we use the <code>,omitempty</code> option, and we leave some pointer fields at their zero value (that is, being <code>nil</code>), it's like if we were using a value whose type didn't even have those fields.</p>\n\n<p>So in your example, if you only change the <code>BasicInfo.FirstName</code> field, and you use this value to update, it is equivalent to using these structures:</p>\n\n<pre><code>type UserModel struct {\n    Id        string              `bson:\"_id,omitempty\"`\n    BasicInfo *UserBasicInfoModel `bson:\"basicInfo,omitempty\"`\n}\n\ntype UserBasicInfoModel struct {\n    FirstName    *string `bson:\"firstName,omitempty\"`\n}\n</code></pre>\n\n<p>So the effect of your issued <code>update</code> command will be the following:</p>\n\n<pre><code>db.users.update({_id: \"aba19b45-5e84-55e0-84f8-90fad41712f6\"},\n    {$set:{\n        \"_id\": \"aba19b45-5e84-55e0-84f8-90fad41712f6\",\n        \"basicInfo\": {\n            \"firstName\": \"New Value\"\n        }\n    }}\n)\n</code></pre>\n\n<p>What does this mean? To set the <code>_id</code> to the same value (it won't change), and to set the <code>basicInfo</code> field to an embedded document which only has a single <code>firstName</code> property. <strong>This will erase the <code>lastName</code> field of the embedded <code>basicInfo</code> document.</strong> So when you unmarshal the document after the update into a value of your <code>UserModel</code> type, the <code>LastName</code> field will remain <code>nil</code> (because it is not present in MongoDB anymore).</p>\n\n<p>What can we do?</p>\n\n<h2>Flatten the embedded document</h2>\n\n<p>One trivial solution is to not use an embedded document, but add fields of <code>UserBasicInfoModel</code> to <code>UserModel</code>:</p>\n\n<pre><code>type UserModel struct {\n    Id        string     `bson:\"_id,omitempty\"`\n    CreatedAt *time.Time `bson:\"createdAt,omitempty\"`\n    FirstName *string    `bson:\"firstName,omitempty\"`\n    LastName  *string    `bson:\"lastName,omitempty\"`\n}\n</code></pre>\n\n<h2>Hybrid with <code>,inline</code> option</h2>\n\n<p>This solution keeps the separate Go struct, but in MongoDB it will not be an embedded document (<code>BasicInfo</code> will be flattened just like in the previous example):</p>\n\n<pre><code>type UserModel struct {\n    Id        string             `bson:\"_id,omitempty\"`\n    CreatedAt *time.Time         `bson:\"createdAt,omitempty\"`\n    BasicInfo UserBasicInfoModel `bson:\"basicInfo,omitempty,inline\"`\n}\n</code></pre>\n\n<p>Note that <code>BasicInfo</code> needs to be a non-pointer if <code>,inline</code> is used. This is not a problem, as we can leave it being an empty struct if its fields are not to be changed, since its fields are pointers, so leaving them <code>nil</code> will not change them.</p>\n\n<h2>Doing \"manual\" update</h2>\n\n<p>If you do need to use embedded document, the <code>mgo</code> library allows you to update specific fields of embedded documents, but then you have to \"manually\" construct the update document, like in this example:</p>\n\n<pre><code>c.UpdateId(Id, bson.M{\"$set\": bson.M{\n    \"basicInfo.firstName\": newFirstName,\n}})\n</code></pre>\n\n<p>Yes, this isn't convenient at all. If you do need this many times with different types, you may create a utility function that uses reflection, iterates over the fields recursively, and assemble the update document from fields which are not <code>nil</code>. Then you could pass that dynamically generated update doc to <code>UpdateId()</code> for example.</p>\n"}], "owner": {"reputation": 3138, "user_id": 4772647, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/nmwnL.jpg?s=128&g=1", "display_name": "TheoK", "link": "https://stackoverflow.com/users/4772647/theok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1300, "favorite_count": 1, "accepted_answer_id": 50561535, "answer_count": 1, "score": 4, "last_activity_date": 1527493792, "creation_date": 1527337372, "last_edit_date": 1527338337, "question_id": 50542717, "link": "https://stackoverflow.com/questions/50542717/partial-update-of-embedded-document-in-mongodb-using-mgo", "title": "Partial update of embedded document in mongoDB using mgo", "body": "<p>I have the following model:</p>\n\n<pre><code>type UserModel struct {\n    Id        string              `bson:\"_id,omitempty\"`\n    CreatedAt *time.Time          `bson:\"createdAt,omitempty\"`\n    BasicInfo *UserBasicInfoModel `bson:\"basicInfo,omitempty\"`\n}\n\n// *Embedded document*\ntype UserBasicInfoModel struct {\n    FirstName    *string `bson:\"firstName,omitempty\"`\n    LastName     *string `bson:\"lastName,omitempty\"`\n}\n</code></pre>\n\n<p>I am using pointers, in order to be able to distinguish between a missing value (<code>nil</code>) and default value (eg <em>empty</em> strings, <em>false</em> values etc). I also use <code>omitempty</code> to be able to do partial updates.</p>\n\n<p>When I <strong>create</strong> a user I get the following (correct) response back:</p>\n\n<pre><code>\"id\": \"aba19b45-5e84-55e0-84f8-90fad41712f6\",\n\"createdAt\": \"2018-05-26T15:08:56.764453386+03:00\",\n\"basicInfo\": {\n    \"firstName\": \"Initial first name\",\n    \"lastName\": \"Initial last name\"\n}\n</code></pre>\n\n<p>When I try to <strong>update</strong> the document though I have an issue.\nI send the changes as a new <code>UserModel</code>, to only change the <code>FirstName</code> field in the embedded document like this:</p>\n\n<pre><code>newFirstName := \"New Value\"\nUserModel{\n  BasicInfo: &amp;UserBasicInfoModel{\n    FirstName: &amp;newFirstName,\n  },\n}\n</code></pre>\n\n<p>The code I use to do the <strong>update</strong> is the following:</p>\n\n<pre><code>UpdateId(id, bson.M{\"$set\": changes})\n</code></pre>\n\n<p>The response I get back is the following:</p>\n\n<pre><code>\"id\": \"aba19b45-5e84-55e0-84f8-90fad41712f6\",\n\"createdAt\": \"2018-05-26T12:08:56.764Z\",\n\"basicInfo\": {\n    \"firstName\": \"New Value\",\n    \"lastName\": null\n}\n</code></pre>\n\n<p>The <code>createdAt</code> value <strong>is not <code>null</code></strong> (as I expected) however the <code>lastName</code> value <strong>is <code>null</code></strong> (which is not what I expected)</p>\n\n<p>I would have expected to get back the following:</p>\n\n<pre><code>\"id\": \"aba19b45-5e84-55e0-84f8-90fad41712f6\",\n\"createdAt\": \"2018-05-26T12:08:56.764Z\",\n\"basicInfo\": {\n    \"firstName\": \"New Value\",\n    \"lastName\": \"Initial last name\"\n}\n</code></pre>\n\n<p><em>What can I do to achieve a partial update in a subdocument using mgo?</em></p>\n"}, {"tags": ["windows", "go", "64-bit"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527337080, "post_id": 50542656, "comment_id": 88096525, "body": "Please elaborate on the problem you feel you are facing. I don&#39;t see any error messages or claims of actual problems in your description. &quot;Miscellaneous issues&quot; is not specific enough to help."}, {"owner": {"reputation": 7447, "user_id": 744588, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2538a493e7b4485d41a1c51fa9fa70d1?s=128&d=identicon&r=PG", "display_name": "menjaraz", "link": "https://stackoverflow.com/users/744588/menjaraz"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527338619, "post_id": 50542656, "comment_id": 88096950, "body": "@Flimzy There is a step <b>Build for x86</b> mentionned in the readme with the instruction $ go build -o vehicle-tracker which mislead me. It doesn&#39;t state a Windows support indeed. I&#39;ll elaborate."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527338710, "post_id": 50542656, "comment_id": 88096976, "body": "That &quot;Build for x86&quot; just means for Intel x86 CPU architecture. &quot;x86&quot; can refer to Windows, Linux, OSX, FreeBSD, and countless others. It is vague, but the final linking step indicates a Linux-like environment was intended."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527339589, "post_id": 50542656, "comment_id": 88097210, "body": "Thanks for the update. But please don&#39;t include screen shots of text. It&#39;s always better to copy-and-paste the text into the question directly."}, {"owner": {"reputation": 7447, "user_id": 744588, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2538a493e7b4485d41a1c51fa9fa70d1?s=128&d=identicon&r=PG", "display_name": "menjaraz", "link": "https://stackoverflow.com/users/744588/menjaraz"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527339594, "post_id": 50542656, "comment_id": 88097211, "body": "@Flimzy My assuption is that there is way to install the missing command as I managed with swagger.exe in C:\\Users\\USER\\go\\bin."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527339636, "post_id": 50542656, "comment_id": 88097222, "body": "But to answer your question, it appears the program expects a Unix-like environment. It&#39;s trying to execute <code>rm</code>, which doesn&#39;t exist by default on Windows (Windows uses <code>del</code> instead). So to get this to work on Windows, you will need to (at least) port all of the Unix-specific bits to work on Windows, too. It may be easy, or it may be incredibly complex."}], "owner": {"reputation": 7447, "user_id": 744588, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/2538a493e7b4485d41a1c51fa9fa70d1?s=128&d=identicon&r=PG", "display_name": "menjaraz", "link": "https://stackoverflow.com/users/744588/menjaraz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1527341180, "creation_date": 1527336872, "last_edit_date": 1527341180, "question_id": 50542656, "link": "https://stackoverflow.com/questions/50542656/how-to-get-the-github-app-vehicle-tracker-api-up-and-running-in-windows", "title": "How to get the Github App &quot;vehicle-tracker-api&quot; up and running in Windows", "body": "<p>I strived to get up and running the Github repository <a href=\"https://github.com/cad/vehicle-tracker-api\" rel=\"nofollow noreferrer\">vehicle-tracker-api</a> on my box (Windows 8 professional 64 bits) but can't get it right till now...</p>\n\n<p>I followed all the steps as stated in the <a href=\"https://github.com/cad/vehicle-tracker-api/blob/master/README.md\" rel=\"nofollow noreferrer\">readme.md</a> but stumbled.</p>\n\n<p>To fix miscalleanous issues that occured despite sticking properly to the instructions, I managed to install lacking dependencies I identified:</p>\n\n<ol>\n<li>Mingw-W64 (explicit)</li>\n<li><a href=\"https://goswagger.io/\" rel=\"nofollow noreferrer\">Swagger 2.0</a> (not very sure of it, there might be another better option I doubt but it did the business).</li>\n</ol>\n\n<p>It seems that my troubles lie in the 2 remaining directives in <a href=\"https://github.com/cad/vehicle-tracker-api/blob/master/main.go\" rel=\"nofollow noreferrer\">main.go</a> knowing the first one is fixed so far</p>\n\n<pre><code>//go:generate swagger generate spec -o data/swagger.json\n//go:generate rm -rf statik/statik.go\n//go:generate statik -src data/\npackage main\n</code></pre>\n\n<hr>\n\n<p>Launching</p>\n\n<pre><code>go generate\n</code></pre>\n\n<p>yieds the following error message</p>\n\n<pre><code>main.go:2: running \"rm\": exec: \"rm\" : executable not found in %PATH%\n</code></pre>\n\n<p><strong>Question</strong>:</p>\n\n<p>What should I do to get it up and running in Windows?</p>\n\n<p><a href=\"https://stackoverflow.com/users/13860/flimzy\">Flimzy</a> pointed out in the comment thread below that the build process try to execute the unix-like<code>rm</code> command, so</p>\n\n<p>Is there a way to rewrite the platform dependent directive <code>//go:generate rm -rf statik/statik.go</code> into the Windows manner.</p>\n"}, {"tags": ["list", "go", "slice"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1527334027, "post_id": 50542228, "comment_id": 88095680, "body": "You talk about <code>append</code> creating new arrays--<code>append</code> only works with slices, not arrays. I&#39;m not really sure what you&#39;re asking here."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1527334346, "post_id": 50542228, "comment_id": 88095771, "body": "<code>container&#47;list</code> provides doubly-linked lists. If you need a doubly-linked list, use this. If you don&#39;t need a doubly-linked list, don&#39;t use it. Performance should not enter into consideration."}, {"owner": {"reputation": 121, "user_id": 9849454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab5d12f3f16b7d000a588241c8ab68c1?s=128&d=identicon&r=PG", "display_name": "moewb", "link": "https://stackoverflow.com/users/9849454/moewb"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527390008, "post_id": 50542228, "comment_id": 88108103, "body": "@Flimzy Thank you your messages.  As far as I know, there can&#39;t be slice without an array under the hood. Therefore, if I understand correctly, <code>append</code> will create an array and a slice and return the latter. Is this correct? I didn&#39;t go this deep into the details because I believed it was not a relevant information to the question I&#39;m actually asking. Thank you for pointing out this detail however, it&#39;s true the way I worded it could be misleading to some people."}, {"owner": {"reputation": 121, "user_id": 9849454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab5d12f3f16b7d000a588241c8ab68c1?s=128&d=identicon&r=PG", "display_name": "moewb", "link": "https://stackoverflow.com/users/9849454/moewb"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527390628, "post_id": 50542228, "comment_id": 88108172, "body": "@Flimzy That was my stance at first too. However, by going through some code and articles, I got the feeling people tend to use slices if they can solve a problem with it, even when lists would be a better fit. It got me a little confused, which is why I started to wonder if performance was one of the reasons why people tend to go for slices as much as possible. Do you think I should go with lists if it makes sense in terms of data structure and leave out slices, despite them being (apparently?) idiomatic?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527411977, "post_id": 50542228, "comment_id": 88112112, "body": "I use slices instead of doubly linked lists because I almost never need a doubly linked list. Despite the inordinate amount of time discussing linked lists and doubly linked lists during my university days, I&#39;ve only ever needed a doubly linked list during my programming career maybe once."}, {"owner": {"reputation": 121, "user_id": 9849454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab5d12f3f16b7d000a588241c8ab68c1?s=128&d=identicon&r=PG", "display_name": "moewb", "link": "https://stackoverflow.com/users/9849454/moewb"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527419829, "post_id": 50542228, "comment_id": 88113958, "body": "I see. Thank you very much for the feedback, I appreciate :)"}], "answers": [{"comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1527335550, "post_id": 50542326, "comment_id": 88096056, "body": "Good answer and upvoted, but I think in your benchmarks you shouldn&#39;t set <code>N</code> to 1. If <code>N</code> is larger, it&#39;ll force some reallocations in the slice case, which should make the comparison closer. Which is relevant, because the question specifically mentions that being of interest."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 1, "creation_date": 1527335666, "post_id": 50542326, "comment_id": 88096079, "body": "Oh, I misread your code, the benchmark cases blur into each other. I don&#39;t think that&#39;s sound at all -- why not re-initialize the list/slice each time, and append N (N large) times in each benchmark run?"}, {"owner": {"reputation": 4481, "user_id": 1264974, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6558cf06df3ccf1c49329f38fd843b7d?s=128&d=identicon&r=PG", "display_name": "justinas", "link": "https://stackoverflow.com/users/1264974/justinas"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1527337381, "post_id": 50542326, "comment_id": 88096592, "body": "You have to be consistent in your benchmark for ns/op to make sense. If you <i>want</i> to benchmark the time of &quot;allocation + N appends&quot;, then you can absolutely do it. But then your numbers will mean &quot;nanoseconds per allocation + N appends&quot;."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 1, "creation_date": 1527343543, "post_id": 50542326, "comment_id": 88098244, "body": "If you want to know how fast someone runs, you don&#39;t measure how far they run in 10s, and then see how long they take to run 100 times that and compute their average speed from that. The further they run, the slower they get, so if they happen to run fast in the first 10s then they&#39;ll have a longer distance to run and get a slower average speed. This is exactly what your benchmark (and the testing stdlib) is doing here."}, {"owner": {"reputation": 121, "user_id": 9849454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab5d12f3f16b7d000a588241c8ab68c1?s=128&d=identicon&r=PG", "display_name": "moewb", "link": "https://stackoverflow.com/users/9849454/moewb"}, "edited": false, "score": 0, "creation_date": 1527391477, "post_id": 50542326, "comment_id": 88108287, "body": "@justinas Thank you very much for your reply and for fixing the benchmark code :) The need for creating a <code>Element</code> is part of what I was referring to in &quot;allocating memory for a single element each time an insertion happens&quot;. Just to confirm: are you saying that creating a <code>Element</code> is so heavy that it is slower than creating a new slice and copying all the data over when a slice maxes out? Or maybe it is not deterministic and one should just not worry about it?"}], "tags": [], "owner": {"reputation": 4481, "user_id": 1264974, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6558cf06df3ccf1c49329f38fd843b7d?s=128&d=identicon&r=PG", "display_name": "justinas", "link": "https://stackoverflow.com/users/1264974/justinas"}, "is_accepted": false, "score": 4, "last_activity_date": 1527334909, "last_edit_date": 1527334909, "creation_date": 1527334564, "answer_id": 50542326, "question_id": 50542228, "link": "https://stackoverflow.com/questions/50542228/differences-between-slice-and-container-list/50542326#50542326", "title": "Differences between slice and container/list", "body": "<p>You are running the benchmarks wrong. You should first set up the initial data structure and then run the operation being benchmarked as many times as the <code>testing.B</code> instance indicates.</p>\n\n<p>I replaced your code with:</p>\n\n<pre><code>var N = 1\n\nfunc BenchmarkSlices(B *testing.B) {\n    s := make([]int, 1)\n    for n := 0; n &lt; B.N; n++ {\n        for i := 0; i &lt; N; i++ {\n            s = append(s, i)\n        }\n    }\n}\n\nfunc BenchmarkLists(B *testing.B) {\n    l := list.New()\n    for n := 0; n &lt; B.N; n++ {\n        for i := 0; i &lt; N; i++ {\n            l.PushBack(i)\n        }\n    }\n}\n</code></pre>\n\n<p>And got this result:</p>\n\n<pre><code>BenchmarkSlices-4       100000000               14.3 ns/op\nBenchmarkLists-4         5000000               275 ns/op\n</code></pre>\n\n<p>At least this time the difference seems reasonable and not like a trillion times.</p>\n\n<p>Note that I also replaced the value of <code>N</code> to 1 so that <code>ns/op</code> actually means <code>nanoseconds per operation</code> and not <code>nanoseconds per N operations</code>. However, this might also impact the results.</p>\n\n<p>Now onto your question: linked lists, as implemented in Go, suffer from additional costs when compared to simply adding another int to a pre-allocated slice: the list method needs to create a new <a href=\"https://golang.org/pkg/container/list/#Element\" rel=\"nofollow noreferrer\">Element</a>, wrap your value in an <code>interface{}</code> and reassign some pointers.</p>\n\n<p>Meanwhile appending to a slice which has not maxed out its capacity will result in just a few instructions at the CPU level: move an int to a memory location, increment the length of the slice, and you're done.</p>\n\n<p>There is also the fact that the underlying allocator might reallocate the slice in place thus avoiding the need to copy the existing underlying array elements at all.</p>\n"}], "owner": {"reputation": 121, "user_id": 9849454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab5d12f3f16b7d000a588241c8ab68c1?s=128&d=identicon&r=PG", "display_name": "moewb", "link": "https://stackoverflow.com/users/9849454/moewb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 814, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1527390985, "creation_date": 1527333814, "last_edit_date": 1527390985, "question_id": 50542228, "link": "https://stackoverflow.com/questions/50542228/differences-between-slice-and-container-list", "title": "Differences between slice and container/list", "body": "<p>I'm just getting starting with Go and I have a situation where I need to make a set of entities whose size/length is only known at runtime. I first thought using a list would be a good fit but soon realized slices are the idiomatic data structure in Go.\nCurious, I wrote the following benchmarks</p>\n\n<pre><code>package main\n\nimport (\n    \"container/list\"\n    \"testing\"\n)\n\nvar N = 10000000\n\nfunc BenchmarkSlices(B *testing.B) {\n    s := make([]int, 1)\n    for i := 0; i &lt; N; i += 1 {\n        s = append(s, i)\n    }\n}\n\nfunc BenchmarkLists(B *testing.B) {\n    l := list.New()\n    for i := 0; i &lt; N; i += 1 {\n        l.PushBack(i)\n    }\n}\n</code></pre>\n\n<p>which gave me</p>\n\n<pre><code>BenchmarkSlices-4       2000000000               0.03 ns/op\nBenchmarkLists-4               1        1665489308 ns/op\n</code></pre>\n\n<p>Given that <code>append</code> would create a new array and copy all the data over from the old to the new array when the old array gets full, I was expected lists to perform better than slices in the example above. However, my expectations are obviously wrong and I'm trying to understand why.</p>\n\n<p>I wrote the following in order to understand a little better how <code>append</code> creates new arrays when it needs to:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc describe(s []int) {\n    fmt.Printf(\"len = %d, cap = %d\\n\", len(s), cap(s))\n}\n\nfunc main() {\n    s := make([]int, 2)\n    for i := 0; i &lt; 15; i += 1 {\n        fmt.Println(i)\n        describe(s)\n        s = append(s, i)\n    }\n}\n</code></pre>\n\n<p>which gave me</p>\n\n<pre><code>0\nlen = 2, cap = 2\n1\nlen = 3, cap = 4\n2\nlen = 4, cap = 4\n3\nlen = 5, cap = 8\n4\nlen = 6, cap = 8\n5\nlen = 7, cap = 8\n6\nlen = 8, cap = 8\n7\nlen = 9, cap = 16\n8\nlen = 10, cap = 16\n9\nlen = 11, cap = 16\n10\nlen = 12, cap = 16\n11\nlen = 13, cap = 16\n12\nlen = 14, cap = 16\n13\nlen = 15, cap = 16\n14\nlen = 16, cap = 16\n</code></pre>\n\n<p>My only guess at the moment as for why slices perform better than lists is that allocating  memory for a new array whose size is double and copying all the data over is faster than allocating memory for a single element each time an insertion happens.\nIs my guess correct? Am I missing something?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1527328257, "post_id": 50541422, "comment_id": 88094109, "body": "<code>required,len=24&quot;</code> It&#39;s not a &quot;string&quot;. You&#39;re invalidating it and it&#39;s being removed. Just leave the field alone as all drivers must do a mandatory assignment of <code>_id</code> with an <code>ObjectId</code> by convention. In the event if it gets to the server with no <code>_id</code> field in the document at all ( as opposed to <code>null</code> ) then the &quot;server&quot; will assign the <code>ObjectId</code>. Always been the way it works, but your intervention is explicitly breaking this."}, {"owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1527328547, "post_id": 50541422, "comment_id": 88094186, "body": "I&#39;ve done manual assignment of the <code>_id</code> many times before, I was told it was the accepted way to do it if you need the ID returned to the client. I didn&#39;t think of the <code>validate</code> stuff though, I&#39;ll try removing that completely, it&#39;s from another library that isn&#39;t being used in this particular scenario but maybe mgo uses the same field name. - Edit: Nope, same issue still."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1527329480, "post_id": 50541422, "comment_id": 88094459, "body": "Show the type declaration, the way you create values of it and how you insert it. Aim for an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. As it is, this question is off-topic."}, {"owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1527330975, "post_id": 50541422, "comment_id": 88094862, "body": "Sure thing @icza I&#39;ve updated the main post with links to the source code and more explanation of what&#39;s going on."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1527331360, "post_id": 50541422, "comment_id": 88094953, "body": "Show us the code that returns the error, not the one that works."}, {"owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "edited": false, "score": 0, "creation_date": 1527331804, "post_id": 50541422, "comment_id": 88095056, "body": "I have, refresh and see the first post again."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1527336476, "post_id": 50541422, "comment_id": 88096334, "body": "Are you sure you run the same code? You claim the output log is <code>CREATING {ObjectIdHex(&quot;5b092f4aff3055468e3ce00b&quot;) playerID2 (...)</code>, but the code should log a different text: <code>fmt.Println(&quot;Creating types.Player with ID&quot;, player.ID)</code>..."}], "owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 287, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1527330960, "creation_date": 1527328005, "last_edit_date": 1527330960, "question_id": 50541422, "link": "https://stackoverflow.com/questions/50541422/e11000-duplicate-key-error-with-explicit-id-assignment-claiming-its-null-but-i", "title": "E11000 duplicate key error with explicit _id assignment claiming it&#39;s null but it&#39;s actually not", "body": "<p>It's the old E11000 error but with a twist (and yes I searched and found many of the same question but without the exact details that apply here - mainly the explicit <code>_id</code> assignment).</p>\n\n<p>I'm manually assigning the <code>_id</code> field with <code>bson.NewObjectId()</code> because I need to return the ID back to the client - this was based on discussions from SO and GitHub, for example: <a href=\"https://github.com/go-mgo/mgo/issues/453\" rel=\"nofollow noreferrer\">https://github.com/go-mgo/mgo/issues/453</a></p>\n\n<p><a href=\"https://github.com/Southclaws/ScavengeSurviveCore/blob/master/storage/player.go#L28-L32\" rel=\"nofollow noreferrer\">https://github.com/Southclaws/ScavengeSurviveCore/blob/master/storage/player.go#L28-L32</a></p>\n\n<p>The ID field is set up in the struct as:</p>\n\n<pre><code>ID bson.ObjectId `json:\"_id\" bson:\"_id\"`\n</code></pre>\n\n<p><a href=\"https://github.com/Southclaws/ScavengeSurviveCore/blob/master/types/player.go#L9-L23\" rel=\"nofollow noreferrer\">https://github.com/Southclaws/ScavengeSurviveCore/blob/master/types/player.go#L9-L23</a></p>\n\n<p>So far I don't think I've missed anything. Unit tests create 3 instances of this object one after the other:</p>\n\n<p><a href=\"https://github.com/Southclaws/ScavengeSurviveCore/blob/master/server/handler_admin_test.go#L21-L56\" rel=\"nofollow noreferrer\">https://github.com/Southclaws/ScavengeSurviveCore/blob/master/server/handler_admin_test.go#L21-L56</a></p>\n\n<p>First one gets created fine, it has an <code>_id</code> assigned to it (checked via mongo-express) and I even printed out the ID right before <code>.Insert</code> was called, same ID, everything is fine:</p>\n\n<p><img src=\"https://i.imgur.com/o3DlSY2.png\" alt=\"https://i.imgur.com/o3DlSY2.png\"></p>\n\n<pre><code>CREATING {ObjectIdHex(\"5b092f4aff3055468e3ce00a\") playerID1 (...)\n</code></pre>\n\n<p>Problem arises when the next of the three test records gets inserted - exact same code, and the log is printed:</p>\n\n<pre><code>CREATING {ObjectIdHex(\"5b092f4aff3055468e3ce00b\") playerID2 (...)\n</code></pre>\n\n<p>but it returns an E11000:</p>\n\n<pre><code>E11000 duplicate key error collection: &lt;db&gt;.&lt;collection&gt; index: &lt;collection&gt;_id_1 dup key: { : null }\n</code></pre>\n\n<p>From what I can gather, it thinks <code>_id</code> is null but given all the evidence I can see, it's not null at all because <code>bson.NewObjectId()</code> is assigned to the <code>_id</code> field right before <code>.Insert</code> is called - <em>and</em> the object is printed out right before insertion and the ID is there.</p>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 4, "last_activity_date": 1527310889, "last_edit_date": 1527310889, "creation_date": 1527308766, "answer_id": 50539311, "question_id": 50539159, "link": "https://stackoverflow.com/questions/50539159/get-the-value-from-a-pointer-to-a-float32-from-inside-a-struct/50539311#50539311", "title": "get the value from a pointer to a float32 from inside a struct?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">Address operators</a></p>\n  \n  <p>For an operand x of pointer type *T, the pointer indirection *x\n  denotes the variable of type T pointed to by x. If x is nil, an\n  attempt to evaluate *x will cause a run-time panic.</p>\n</blockquote>\n\n<hr>\n\n<p>Use the <code>*</code> operator. For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype MyAwesomeType struct {\n    Value *float32\n}\n\nfunc main() {\n    pi := float32(3.14159)\n    myAwesomeType := MyAwesomeType{Value: &amp;pi}\n\n    if myAwesomeType.Value == nil {\n        // Handle the error\n    } else {\n        value := *myAwesomeType.Value\n        fmt.Println(value)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/8URumKoVl_t\" rel=\"nofollow noreferrer\">https://play.golang.org/p/8URumKoVl_t</a></p>\n\n<p>Output:</p>\n\n<pre><code>3.14159\n</code></pre>\n\n<hr>\n\n<p>Since you are new to Go, take <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">A Tour of Go</a>. The tour explains many things, including pointers.</p>\n\n<blockquote>\n  <p>Pointers</p>\n  \n  <p>Go has pointers. A pointer holds the memory address of a value.</p>\n  \n  <p>The type <code>*T</code> is a pointer to a <code>T</code> value. Its zero value is <code>nil</code>.</p>\n\n<pre><code>var p *int\n</code></pre>\n  \n  <p>The <code>&amp;</code> operator generates a pointer to its operand.</p>\n\n<pre><code>i := 42\np = &amp;i\n</code></pre>\n  \n  <p>The <code>*</code> operator denotes the pointer's underlying value.</p>\n\n<pre><code>fmt.Println(*p) // read i through the pointer p\n*p = 21         // set i through the pointer p\n</code></pre>\n  \n  <p>This is known as \"dereferencing\" or \"indirecting\". </p>\n  \n  <p>Unlike C, Go has no pointer arithmetic.</p>\n</blockquote>\n"}], "owner": {"reputation": 780, "user_id": 5261088, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8256e8a248d8bcde285d3b97f77e36b0?s=128&d=identicon&r=PG&f=1", "display_name": "MickeyThreeSheds", "link": "https://stackoverflow.com/users/5261088/mickeythreesheds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1527310889, "creation_date": 1527306543, "last_edit_date": 1527309407, "question_id": 50539159, "link": "https://stackoverflow.com/questions/50539159/get-the-value-from-a-pointer-to-a-float32-from-inside-a-struct", "title": "get the value from a pointer to a float32 from inside a struct?", "body": "<p>I am pulling in some data from a db - and I have a pointer to a float32 - because if I use a pointer - then I am able to check if it is nil (which it quite often might be).</p>\n\n<p>When it is not nil, I want to get the value - how do I dereference it so I can get the actual float32? I can't actually find a link for that anywhere! I know exactly what I want to do, and I just can't find the syntax in Go, which I am still very new to - all help appreciated.</p>\n\n<p>I know how to dereference the pointer if it is a straight float32...</p>\n\n<p>but if I have the following struct...</p>\n\n<pre><code>type MyAwesomeType struct{\n    Value *float32\n}\n</code></pre>\n\n<p>Then after I do : </p>\n\n<pre><code>if myAwesomeType.Value == nil{\n    // Handle the error later, I don't care about this yet...\n} else{\n    /* What do I do here? Normally if it were a straight float32\n     * pointer, you might just do &amp;ptr or whatever, but I am so\n     * confused about how to get this out of my struct...\n    */\n}\n</code></pre>\n"}, {"tags": ["go", "zip", "archive"], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 9577564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bef59c06bc854ca66ad39e85e08bf5f?s=128&d=identicon&r=PG&f=1", "display_name": "Minusy", "link": "https://stackoverflow.com/users/9577564/minusy"}, "edited": false, "score": 0, "creation_date": 1527311641, "post_id": 50539327, "comment_id": 88090794, "body": "Thanks for your answer. I know how to handle gzip. But I don&#39;t know handle .zip file. It may need archive/zip, but I don&#39;t know how to use archive/zip unzip .zip Response.Body. Is gzip the same as zip?"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 127, "user_id": 9577564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bef59c06bc854ca66ad39e85e08bf5f?s=128&d=identicon&r=PG&f=1", "display_name": "Minusy", "link": "https://stackoverflow.com/users/9577564/minusy"}, "edited": false, "score": 0, "creation_date": 1527312665, "post_id": 50539327, "comment_id": 88090945, "body": "No gzip != zip. It seems you asked for <code>.zip</code> file, my bad. I will update the code snippet in a while."}], "tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 19, "last_activity_date": 1527313723, "last_edit_date": 1527313723, "creation_date": 1527309016, "answer_id": 50539327, "question_id": 50539118, "link": "https://stackoverflow.com/questions/50539118/golang-unzip-response-body/50539327#50539327", "title": "golang unzip Response.Body", "body": "<p>Updating answer for handling Zip file response body in-memory.</p>\n\n<p><strong>Note:</strong> Ensure you have sufficient memory for handling zip file.</p>\n\n<pre><code>package main\n\nimport (\n    \"archive/zip\"\n    \"bytes\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    resp, err := http.Get(\"zip file url\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer resp.Body.Close()\n\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    zipReader, err := zip.NewReader(bytes.NewReader(body), int64(len(body)))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Read all the files from zip archive\n    for _, zipFile := range zipReader.File {\n        fmt.Println(\"Reading file:\", zipFile.Name)\n        unzippedFileBytes, err := readZipFile(zipFile)\n        if err != nil {\n            log.Println(err)\n            continue\n        }\n\n        _ = unzippedFileBytes // this is unzipped file bytes\n    }\n}\n\nfunc readZipFile(zf *zip.File) ([]byte, error) {\n    f, err := zf.Open()\n    if err != nil {\n        return nil, err\n    }\n    defer f.Close()\n    return ioutil.ReadAll(f)\n}\n</code></pre>\n\n<hr>\n\n<p>By default Go HTTP client handles Gzip response automatically. So do typical read and close of response body.</p>\n\n<p>However there is a catch in it.</p>\n\n<pre><code>// Reference https://github.com/golang/go/blob/master/src/net/http/transport.go\n//\n// DisableCompression, if true, prevents the Transport from\n// requesting compression with an \"Accept-Encoding: gzip\"\n// request header when the Request contains no existing\n// Accept-Encoding value. If the Transport requests gzip on\n// its own and gets a gzipped response, it's transparently\n// decoded in the Response.Body. However, if the user\n// explicitly requested gzip it is not automatically\n// uncompressed.\nDisableCompression bool\n</code></pre>\n\n<p>What it means is; If you add a header <code>Accept-Encoding: gzip</code> manually in the request then you have to handle Gzip response body by yourself. </p>\n\n<p>For Example -</p>\n\n<pre><code>reader, err := gzip.NewReader(resp.Body)\nif err != nil {\n    log.Fatal(err)\n}\ndefer reader.Close()\n\nbody, err := ioutil.ReadAll(reader)\nif err != nil {\n    log.Fatal(err)\n}\n\nfmt.Println(string(body))\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 9577564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bef59c06bc854ca66ad39e85e08bf5f?s=128&d=identicon&r=PG&f=1", "display_name": "Minusy", "link": "https://stackoverflow.com/users/9577564/minusy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6406, "favorite_count": 2, "accepted_answer_id": 50539327, "answer_count": 1, "score": 5, "last_activity_date": 1527313723, "creation_date": 1527305917, "question_id": 50539118, "link": "https://stackoverflow.com/questions/50539118/golang-unzip-response-body", "title": "golang unzip Response.Body", "body": "<p>I wrote a little web crawler and had known that the Response is a zip file.<br>\nIn my limited experience with golang programing, I only know how to unzip a existing file.<br>\nCan I unzip the Response.Body in memory without saving it in hard disk in advance?</p>\n"}, {"tags": ["go", "asn.1", "der"], "comments": [{"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1527316910, "post_id": 50538867, "comment_id": 88091622, "body": "are you sure that {42, 134, 72, 134}  is valid? I&#39;ve tried {0, 6 ,2} and it&#39;s OK, here <a href=\"https://www.obj-sys.com/asn1tutorial/node10.html\" rel=\"nofollow noreferrer\">obj-sys.com/asn1tutorial/node10.html</a>"}, {"owner": {"reputation": 670, "user_id": 2526272, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7b985bcaf7276d85432c92bc28726b9c?s=128&d=identicon&r=PG", "display_name": "Sap", "link": "https://stackoverflow.com/users/2526272/sap"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1527343110, "post_id": 50538867, "comment_id": 88098138, "body": "I did trim the value a little for sake of the question. The original TLV is an  AlgorithmIdentifier from an X.509 cert. The encoded TLV in hex that I&#39;m trying to replicate is: &quot;06 09 2A864886F70D010101&quot;. 06h of course is the Object Identifier tag, 09h the length, and 2A864886F70D010101 the value of the object. Byte for byte, the value converts to {42, 134, 72, 134, 247, 13, 1, 1, 1} in base10 and fails. Based on the answer from @YaFred below, am I converting wrong?"}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1527345566, "post_id": 50538867, "comment_id": 88098798, "body": "then it&#39;s valid <a href=\"https://play.golang.org/p/5euH7x1tByM\" rel=\"nofollow noreferrer\">play.golang.org/p/5euH7x1tByM</a>"}, {"owner": {"reputation": 8230, "user_id": 2876830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/23e4baefc1b032e53e723ce13f34f9c3?s=128&d=identicon&r=PG&f=1", "display_name": "YaFred", "link": "https://stackoverflow.com/users/2876830/yafred"}, "edited": false, "score": 0, "creation_date": 1527347953, "post_id": 50538867, "comment_id": 88099487, "body": "To get the encoded value &#39;06092A864886F70D010101&#39;H you must use this OID:  { 1 2 840 113549 1 1 1 }"}, {"owner": {"reputation": 670, "user_id": 2526272, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7b985bcaf7276d85432c92bc28726b9c?s=128&d=identicon&r=PG", "display_name": "Sap", "link": "https://stackoverflow.com/users/2526272/sap"}, "reply_to_user": {"reputation": 8230, "user_id": 2876830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/23e4baefc1b032e53e723ce13f34f9c3?s=128&d=identicon&r=PG&f=1", "display_name": "YaFred", "link": "https://stackoverflow.com/users/2876830/yafred"}, "edited": false, "score": 0, "creation_date": 1527392767, "post_id": 50538867, "comment_id": 88108461, "body": "@YaFred, can you explain why this works? Does this have to do with the &#39;ANY&#39; type?"}, {"owner": {"reputation": 8230, "user_id": 2876830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/23e4baefc1b032e53e723ce13f34f9c3?s=128&d=identicon&r=PG&f=1", "display_name": "YaFred", "link": "https://stackoverflow.com/users/2876830/yafred"}, "edited": false, "score": 0, "creation_date": 1527400651, "post_id": 50538867, "comment_id": 88109713, "body": "@Sap, take a look at <a href=\"https://stackoverflow.com/questions/5929050/how-does-asn-1-encode-an-object-identifier\" title=\"how does asn 1 encode an object identifier\">stackoverflow.com/questions/5929050/&hellip;</a>  (you can also go back to the source of ASN.1 encoding rules ITU-T X.690) ."}, {"owner": {"reputation": 670, "user_id": 2526272, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7b985bcaf7276d85432c92bc28726b9c?s=128&d=identicon&r=PG", "display_name": "Sap", "link": "https://stackoverflow.com/users/2526272/sap"}, "edited": false, "score": 0, "creation_date": 1527447126, "post_id": 50538867, "comment_id": 88121647, "body": "Perfect, thank you."}], "answers": [{"tags": [], "owner": {"reputation": 8230, "user_id": 2876830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/23e4baefc1b032e53e723ce13f34f9c3?s=128&d=identicon&r=PG&f=1", "display_name": "YaFred", "link": "https://stackoverflow.com/users/2876830/yafred"}, "is_accepted": true, "score": 3, "last_activity_date": 1527316703, "creation_date": 1527316703, "answer_id": 50540065, "question_id": 50538867, "link": "https://stackoverflow.com/questions/50538867/go-invalid-asn-1-object-identifier-encoding-error/50540065#50540065", "title": "Go invalid ASN.1 Object Identifier encoding error", "body": "<p>Object identifiers are not straight forward.</p>\n\n<p>There are only 3 top level arcs (the integers that form the object identifier).\nIn other words, first arc (42 in your example) can only be 0, 1 or 2</p>\n\n<p>If your first arc is 0 or 1, then the second arc must be less than 40</p>\n\n<p>Note: This restriction is used by the encoding rules of the object identifier value to pack the 2 first arcs</p>\n"}], "owner": {"reputation": 670, "user_id": 2526272, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7b985bcaf7276d85432c92bc28726b9c?s=128&d=identicon&r=PG", "display_name": "Sap", "link": "https://stackoverflow.com/users/2526272/sap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 715, "favorite_count": 0, "accepted_answer_id": 50540065, "answer_count": 1, "score": 0, "last_activity_date": 1527316703, "creation_date": 1527302859, "question_id": 50538867, "link": "https://stackoverflow.com/questions/50538867/go-invalid-asn-1-object-identifier-encoding-error", "title": "Go invalid ASN.1 Object Identifier encoding error", "body": "<p>I am trying to create a DER file using encoding/asn1, and I keep getting an invalid Object Identifier runtime error. <code>asn1.ObjectIdentifier</code> is just an []int, so I'm not sure what's invalid.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/asn1\"\n    \"fmt\"\n    \"log\"\n)\n\ntype algorithm struct {\n    Algo asn1.ObjectIdentifier\n    Null asn1.RawValue\n}\n\nfunc main() {\n    var myCert algorithm\n    myCert.Algo = asn1.ObjectIdentifier{42, 134, 72, 134}\n    myCert.Null = asn1.NullRawValue\n\n    mdata, err := asn1.Marshal(myCert)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    fmt.Println(mdata)\n}\n</code></pre>\n\n<p>The program exits with the following error:\n<em>\"asn1: structure error: invalid object identifier\"</em></p>\n\n<p>Playground example <a href=\"https://play.golang.org/p/2nMwbJAyPxf\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"tags": ["go", "gomock"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1527296641, "post_id": 50538340, "comment_id": 88088776, "body": "you can&#39;t be sure a goroutine runs or returns at all without synchronization. You need to add a channel or WaitGroup to ensure that."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1527318848, "post_id": 50538340, "comment_id": 88092041, "body": "Don&#39;t test that a goroutine was started. Test that a goroutine did what it was supposed to. Assert its effects, not its existence."}, {"owner": {"reputation": 2688, "user_id": 4181434, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100004207338569/picture?type=large", "display_name": "Kostya Vyrodov", "link": "https://stackoverflow.com/users/4181434/kostya-vyrodov"}, "edited": false, "score": 0, "creation_date": 1538405966, "post_id": 50538340, "comment_id": 92122496, "body": "Have the same problem. time.Sleep(time.Millisecond) - works but I think it&#39;s not our way :)"}], "answers": [{"comments": [{"owner": {"reputation": 13897, "user_id": 1713660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5aa62fae5a22b542d2a188b95384aee?s=128&d=identicon&r=PG", "display_name": "vladkras", "link": "https://stackoverflow.com/users/1713660/vladkras"}, "edited": false, "score": 0, "creation_date": 1535087747, "post_id": 50539437, "comment_id": 90944865, "body": "Why do you think <code>MyMockFunc</code> returns anything? You just completely rewrited OP code"}], "tags": [], "owner": {"reputation": 1014, "user_id": 61360, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/70602c12ed1c06db5165ff6a88cd38e0?s=128&d=identicon&r=PG", "display_name": "Mat&#237;as Insaurralde", "link": "https://stackoverflow.com/users/61360/mat%c3%adas-insaurralde"}, "is_accepted": false, "score": 0, "last_activity_date": 1527310355, "creation_date": 1527310355, "answer_id": 50539437, "question_id": 50538340, "link": "https://stackoverflow.com/questions/50538340/how-to-test-that-a-function-was-called-in-a-goroutine/50539437#50539437", "title": "How to test that a function was called in a goroutine?", "body": "<p>Using a channel and assuming you can fire the goroutine from the test:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"testing\"\n    \"time\"\n)\n\nfunc MyMockFunc(n int) int {\n    fmt.Println(\"MyMockFunc is called\")\n    time.Sleep(5 * time.Second)\n    return n + 1\n}\n\nfunc TestMyMockFunc(t *testing.T) {\n    result := make(chan int)\n    go func() {\n        result &lt;- MyMockFunc(1)\n    }()\n    if &lt;-result != 2 {\n        t.Fatalf(\"Expecting 2\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 4649, "user_id": 1658458, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dc5d638443908cf7ae97690a4e2a045b?s=128&d=identicon&r=PG", "display_name": "yndolok", "link": "https://stackoverflow.com/users/1658458/yndolok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 827, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1527310355, "creation_date": 1527295101, "last_edit_date": 1527295402, "question_id": 50538340, "link": "https://stackoverflow.com/questions/50538340/how-to-test-that-a-function-was-called-in-a-goroutine", "title": "How to test that a function was called in a goroutine?", "body": "<p>I'd like to make sure that we're starting a goroutine by calling a function with the right arguments.</p>\n\n<p>For example:</p>\n\n<pre><code>func MyTest(t *testing.T) {\n    service.EXPECT().MyMockFunc(1)\n    service.MyFunc()\n}\n\nfunc MyFunc() {\n    go MyMockFunc(1)\n}\n</code></pre>\n\n<p>When I run this test, it fails because (I believe) <code>MyMockFunc</code> only gets called after the test has already finished running.</p>\n\n<p>Is there a way to test that I started a goroutine by calling a function with the right arguments?</p>\n\n<p>Note: Ideally, I'd like to keep the arguments I pass to <code>MyMockFunc</code> as is (not add a channel arg for instance).</p>\n"}, {"tags": ["go", "tabs", "formatting", "visual-studio-code", "nano"], "comments": [{"owner": {"reputation": 3004, "user_id": 4619543, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/9NGJ9.jpg?s=128&g=1", "display_name": "brijmcq", "link": "https://stackoverflow.com/users/4619543/brijmcq"}, "edited": false, "score": 0, "creation_date": 1527385855, "post_id": 50538195, "comment_id": 88107546, "body": "why the downvote?"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9849217, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IQxc3GQYv2E/AAAAAAAAAAI/AAAAAAAAADU/AADWNla5BVs/photo.jpg?sz=128", "display_name": "Karen Irene Cano", "link": "https://stackoverflow.com/users/9849217/karen-irene-cano"}, "edited": false, "score": 0, "creation_date": 1527294399, "post_id": 50538210, "comment_id": 88088453, "body": "Thanks a bunch!! Trying and looking into it now."}, {"owner": {"reputation": 21, "user_id": 9849217, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IQxc3GQYv2E/AAAAAAAAAAI/AAAAAAAAADU/AADWNla5BVs/photo.jpg?sz=128", "display_name": "Karen Irene Cano", "link": "https://stackoverflow.com/users/9849217/karen-irene-cano"}, "edited": false, "score": 0, "creation_date": 1527305155, "post_id": 50538210, "comment_id": 88089937, "body": "I have installed the <a href=\"https://marketplace.visualstudio.com/items?itemName=ms-vscode.Go\" rel=\"nofollow noreferrer\">vscode-go-extension</a> you recommended. The indentations are well formatted now. I checked thru <code>nano</code>. Also to add, whenever I hit save on vscode, it behaves as if I invoke <code>go build</code> and checks if I was using the import if not, it automatically removes it. Awesome. Marking this as solved."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 5, "last_activity_date": 1527293902, "last_edit_date": 1527293902, "creation_date": 1527293484, "answer_id": 50538210, "question_id": 50538195, "link": "https://stackoverflow.com/questions/50538195/golang-formatting-on-nano-is-messed-up-while-on-vscode-it-is-okay-nano-format-i/50538210#50538210", "title": "golang formatting on nano is messed up while on vscode it is okay. nano format is pushed to git", "body": "<blockquote>\n  <p>do I really have to invoke go fmt every time I have to git? </p>\n</blockquote>\n\n<p>You should rather invoke go fmt every time you are saving your file locally with your IDE.<br>\nThat way, and add, commit and push will be done with a consistent format.</p>\n\n<p>For VSCode, see <a href=\"https://github.com/Microsoft/vscode-go/issues/14\" rel=\"noreferrer\">Format on save</a>, the <a href=\"https://stackoverflow.comhttps://stackoverflow.com/a/35571145/6309\" rel=\"noreferrer\">the vscode-go extension</a>.</p>\n"}], "owner": {"reputation": 21, "user_id": 9849217, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IQxc3GQYv2E/AAAAAAAAAAI/AAAAAAAAADU/AADWNla5BVs/photo.jpg?sz=128", "display_name": "Karen Irene Cano", "link": "https://stackoverflow.com/users/9849217/karen-irene-cano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 1, "accepted_answer_id": 50538210, "answer_count": 1, "score": 0, "last_activity_date": 1527293948, "creation_date": 1527293305, "last_edit_date": 1527293948, "question_id": 50538195, "link": "https://stackoverflow.com/questions/50538195/golang-formatting-on-nano-is-messed-up-while-on-vscode-it-is-okay-nano-format-i", "title": "golang formatting on nano is messed up while on vscode it is okay. nano format is pushed to git", "body": "<p>I am new with golang and we just had our first git commit of it and to our surprise the indentations were different. </p>\n\n<p>On <strong>vscode</strong> my code looks like this : The indentations/tabs are well formatted.</p>\n\n<p><a href=\"https://i.stack.imgur.com/nIx4d.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nIx4d.png\" alt=\"vscode-golang-formatting\"></a></p>\n\n<p>and on <strong>nano</strong> and <strong>github</strong> it got broken.</p>\n\n<p><a href=\"https://i.stack.imgur.com/ENXYo.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ENXYo.png\" alt=\"nano-golang-formatting\"></a></p>\n\n<p>I found an answer related, a <a href=\"https://stackoverflow.com/questions/19094704/indentation-in-go-tabs-or-spaces#answer-19094725\">tool here that formats the tabs and spaces</a> but do I really have to invoke <code>go fmt</code> every time I have to <code>git</code>? </p>\n"}, {"tags": ["python", "go"], "answers": [{"tags": [], "owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "is_accepted": false, "score": 0, "last_activity_date": 1527360070, "last_edit_date": 1527360070, "creation_date": 1527309119, "answer_id": 50539332, "question_id": 50537792, "link": "https://stackoverflow.com/questions/50537792/calling-a-python-callback-pointer-from-go/50539332#50539332", "title": "calling a python callback pointer from go", "body": "<p>This will not work without using C as an intermediary from go back into python. </p>\n\n<p>A go function pointer will not look the same as a python function pointer. The go code crashes when it expects to see fn as a go function. But that is a python function pointer.  The boldface debacle message is funny - they have clearly anticipated this error and use 0xb01dfacedebac1e as the pointer value. </p>\n\n<p>You might try simply using a return value of callme in python. When a message comes in, return it from callme, and then from python call callme again for the next message. The return value in python needs to be something python can understand. </p>\n\n<p>Otherwise, if it is possible to call from c into python, then you might choose to use a c function as an intermediary, and supply that c function as the callback. </p>\n"}, {"comments": [{"owner": {"reputation": 14369, "user_id": 362938, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e7f052f4c507b448e4763868d73e0b1b?s=128&d=identicon&r=PG", "display_name": "detunized", "link": "https://stackoverflow.com/users/362938/detunized"}, "edited": false, "score": 0, "creation_date": 1611399411, "post_id": 56303002, "comment_id": 116441933, "body": "Thanks, a great solution to my problem!"}], "tags": [], "owner": {"reputation": 256, "user_id": 11368381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28c4851d78c9ce48c8140fcf1b9aaf10?s=128&d=identicon&r=PG&f=1", "display_name": "jubukka", "link": "https://stackoverflow.com/users/11368381/jubukka"}, "is_accepted": false, "score": 2, "last_activity_date": 1558771640, "creation_date": 1558771640, "answer_id": 56303002, "question_id": 50537792, "link": "https://stackoverflow.com/questions/50537792/calling-a-python-callback-pointer-from-go/56303002#56303002", "title": "calling a python callback pointer from go", "body": "<p>The problem here is the type of the argument to \"callme\". The python code uses ctypes to give it a C style function pointer. Your Go code receives it as a Go function, which it is not.</p>\n\n<p>First, \"callme\" needs to be defined like this:</p>\n\n<pre><code>func callme(fn C.convert)\n</code></pre>\n\n<p>Then C.convert needs to be defined. Go documentation <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">https://golang.org/cmd/cgo/</a> describes how you can add a piece of C code to a Go source file.</p>\n\n<pre><code>/*\ntypedef void (*convert) ();\n*/\nimport \"C\"\n</code></pre>\n\n<p>Since it is not possible to call a function pointer directly, you need to create a C function that takes the pointer as a parameter, and calls it. </p>\n\n<pre><code>/*\ntypedef void (*convert) ();\n\nstatic inline void call_c_func(convert ptr) {\n    (ptr)();\n}\n*/\nimport \"C\"\n</code></pre>\n\n<p>Now C.call_c_func can be used to call the callback function received from python, replacing a direct call to fn().</p>\n\n<pre><code>//fn()\nC.call_c_func(fn)\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 2949228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/817da41af6a24bcedb34dc548449e2e2?s=128&d=identicon&r=PG&f=1", "display_name": "user2949228", "link": "https://stackoverflow.com/users/2949228/user2949228"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 756, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1558771640, "creation_date": 1527289125, "question_id": 50537792, "link": "https://stackoverflow.com/questions/50537792/calling-a-python-callback-pointer-from-go", "title": "calling a python callback pointer from go", "body": "<p>I get this error:</p>\n\n<pre><code>Ticker ticked\nunexpected fault address 0xb01dfacedebac1e\nfatal error: fault\n[signal SIGSEGV: segmentation violation code=0x1 addr=0xb01dfacedebac1e pc=0x105c4152e]\n\ngoroutine 17 [running, locked to thread]:\nruntime.throw(0x105c74358, 0x5)\n/usr/local/go/src/runtime/panic.go:616 +0x81 fp=0xc420050d48 sp=0xc420050d28 pc=0x105bd6951\nruntime.sigpanic()\n/usr/local/go/src/runtime/signal_unix.go:395 +0x211 fp=0xc420050d98 sp=0xc420050d48 pc=0x105beabf1\nmain.callme(0x105baefc0)\n/Users/xxx/go/src/test2/test2.go:29 +0xce fp=0xc420050e90 sp=0xc420050d98 pc=0x105c4152e\nmain._cgoexpwrap_f53316e445a2_callme(0x105baefc0)\n_cgo_gotypes.go:45 +0x2b fp=0xc420050ea8 sp=0xc420050e90 pc=0x105c4144b\nruntime.call32(0x0, 0x7ffeea2482b0, 0x7ffeea248348, 0x8)\n/usr/local/go/src/runtime/asm_amd64.s:573 +0x3b fp=0xc420050ed8 sp=0xc420050ea8 pc=0x105bfe7eb\nruntime.cgocallbackg1(0x0)\n/usr/local/go/src/runtime/cgocall.go:316 +0x19c fp=0xc420050f58 sp=0xc420050ed8 pc=0x105bb284c\nruntime.cgocallbackg(0x0)\n/usr/local/go/src/runtime/cgocall.go:194 +0xda fp=0xc420050fc0 sp=0xc420050f58 pc=0x105bb261a\n runtime.cgocallback_gofunc(0x0, 0x0, 0x0, 0x0)\n/usr/local/go/src/runtime/asm_amd64.s:826 +0x9b fp=0xc420050fe0 sp=0xc420050fc0 pc=0x105bffdbb\n runtime.goexit()\n/usr/local/go/src/runtime/asm_amd64.s:2361 +0x1 fp=0xc420050fe8 sp=0xc420050fe0 pc=0x105c00a31\n</code></pre>\n\n<p>The go code is :</p>\n\n<pre><code>    package main\n    import \"time\"\n    import \"fmt\"\n    import \"C\"\n\n    type convert func()\n\n    //export callme\n    func callme(fn convert) {\n        doneChan := make(chan bool)\ngo func() {\n    time.Sleep(time.Second * 5)\n    doneChan &lt;- true\n}()\nticker := time.NewTicker(time.Millisecond * 500)\nfor {\n    select {\n    case &lt;- ticker.C:\n        fmt.Println(\"Ticker ticked\")\n        fn()\n    case &lt;- doneChan:\n        fmt.Println(\"Done\")\n        return\n  }\n}\n}\nfunc main() {\nticker := time.NewTicker(time.Millisecond * 1000)\ntime.Sleep(time.Millisecond * 1500)\nticker.Stop()\nfmt.Println(\"Ticker stopped\")\n}\n</code></pre>\n\n<p>The python code is:</p>\n\n<pre><code>from ctypes import *\ndef print_tick():\n   print(\"hey\")\n   return 0\nlib = cdll.LoadLibrary(\"./test2.so\")\n\n\nCMPFUNC = CFUNCTYPE(c_int)\ncmp_func = CMPFUNC(print_tick)\n\ncallme = lib.callme\ncallme(cmp_func)\n</code></pre>\n\n<p>This was just a test code to see how can I use callback between python and go and if that is possible.\nIdeally, The python side would start the go code to run in the background. go engine is receiving a stream of messages and upon receiving a message, the go engine would call the callback function from python and pass those messages to python.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 111, "user_id": 1542778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3fc3444375d06a3f970671917ffdb42?s=128&d=identicon&r=PG", "display_name": "jesusnoseq", "link": "https://stackoverflow.com/users/1542778/jesusnoseq"}, "is_accepted": true, "score": 2, "last_activity_date": 1527315054, "creation_date": 1527315054, "answer_id": 50539875, "question_id": 50537472, "link": "https://stackoverflow.com/questions/50537472/gometalinter-save-output-into-xml/50539875#50539875", "title": "gometalinter save output into xml", "body": "<p>There is no flag to save the output but you can do this</p>\n\n<pre><code>gometalinter --checkstyle &gt; linterReport.xml\n</code></pre>\n"}], "owner": {"reputation": 1412, "user_id": 2752065, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/0ce2fdf5a902f6b23843d59e02c06c4a?s=128&d=identicon&r=PG&f=1", "display_name": "elcharrua", "link": "https://stackoverflow.com/users/2752065/elcharrua"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 50539875, "answer_count": 1, "score": -1, "last_activity_date": 1527317082, "creation_date": 1527286377, "last_edit_date": 1527317082, "question_id": 50537472, "link": "https://stackoverflow.com/questions/50537472/gometalinter-save-output-into-xml", "title": "gometalinter save output into xml", "body": "<p>I started using gometalinter on my project and when I run it I want to save the output into an XML file. I run the command <code>gometalinter --checkstyle</code> but it's only printing it on the console. Is there a flag or something to save the output? </p>\n"}, {"tags": ["go"], "owner": {"reputation": 1412, "user_id": 2752065, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/0ce2fdf5a902f6b23843d59e02c06c4a?s=128&d=identicon&r=PG&f=1", "display_name": "elcharrua", "link": "https://stackoverflow.com/users/2752065/elcharrua"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1497, "favorite_count": 0, "closed_date": 1527286130, "answer_count": 0, "score": 2, "last_activity_date": 1527284443, "creation_date": 1527284443, "question_id": 50537194, "link": "https://stackoverflow.com/questions/50537194/go-lint-installation", "closed_reason": "Duplicate", "title": "Go Lint Installation", "body": "<p>I'm new into go and im trying to implement <a href=\"https://github.com/golang/lint\" rel=\"nofollow noreferrer\">golint</a> for code static analysis code.  Followed the instructions on the installation and when I try to run through the console <code>golint ./...</code> it says <code>zsh: command not found: golint</code>. Could anyone point me out what i'm doing wrong.</p>\n"}, {"tags": ["json", "go", "serialization", "json-deserialization"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1527282282, "post_id": 50536797, "comment_id": 88085714, "body": "you can use an editor to find a json tag error by saving the file as .json"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1527282928, "post_id": 50536797, "comment_id": 88085949, "body": "You&#39;ll have to do that yourself. But with the JSON input, and the offset provided by the error, it should be an easy exercise to determine which line the error was on."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1527283669, "post_id": 50536797, "comment_id": 88086185, "body": "To add to Flimzy comment, you can get offset like this: <code>var offset int64; if synErr, ok := err.(*json.SyntaxError); ok { offset = synErr.Offset }</code>.  From there, it&#39;s up to you to convert to line, column or whatever else you want."}, {"owner": {"reputation": 25, "user_id": 5776513, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1da61362690427089e2dfd10e7658818?s=128&d=identicon&r=PG&f=1", "display_name": "exp2logy", "link": "https://stackoverflow.com/users/5776513/exp2logy"}, "edited": false, "score": 0, "creation_date": 1527725457, "post_id": 50536797, "comment_id": 88239706, "body": "Thanks guys, that worked perfectly!"}], "owner": {"reputation": 25, "user_id": 5776513, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1da61362690427089e2dfd10e7658818?s=128&d=identicon&r=PG&f=1", "display_name": "exp2logy", "link": "https://stackoverflow.com/users/5776513/exp2logy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1527282163, "creation_date": 1527282163, "question_id": 50536797, "link": "https://stackoverflow.com/questions/50536797/how-can-i-get-more-informative-errors-with-go-json-unmarshal", "title": "How can I get more informative errors with Go json.Unmarshal?", "body": "<p>All the error from json.Unmarshal says is \"cant Unmarshal {\" or whatever character it's failing at. With a large enough JSON file, it can be very difficult to figure out where the malformation is. </p>\n\n<p>I'd like to find a way to get a more specific location, using a combination of functions supported by the json library or others. One possibility can be the line and character number of the failure. I'd also be happy to get the tree path to the malformation. </p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527279913, "post_id": 50536368, "comment_id": 88084859, "body": "Update: The <code>gorilla&#47;schema</code> library mentions the <code>json</code> tag in <a href=\"https://github.com/gorilla/schema/search?q=json&amp;unscoped_q=json\" rel=\"nofollow noreferrer\">three places</a>, all in tests."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1527280027, "post_id": 50536368, "comment_id": 88084902, "body": "The <code>schema</code> tag is not required, as inferred by their documentation (and indeed their initial example omits them). &quot;To define custom names for fields, use a struct tag &quot;schema&quot;.&quot; <a href=\"http://www.gorillatoolkit.org/pkg/schema\" rel=\"nofollow noreferrer\">gorillatoolkit.org/pkg/schema</a> . Without specifying the tag, the field name is taken directly from the struct."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1527282153, "post_id": 50536588, "comment_id": 88085671, "body": "That&#39;s actually a cool feature. As far as performance impact, there shouldn&#39;t be anything really. Here is the function you are looking for. <a href=\"https://github.com/gorilla/schema/blob/master/cache.go#L243\" rel=\"nofollow noreferrer\">github.com/gorilla/schema/blob/master/cache.go#L243</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1527282667, "post_id": 50536588, "comment_id": 88085853, "body": "Actually, if you wanted to get right down to over-optimization (which is generally a bad thing), I&#39;d say using the field name saves a minuscule number of operations. If the tag exists, it has to parse the string to get it and the options set, which does a <code>strings.Split</code>. Don&#39;t over-optimize because of this though... it&#39;s just a few cycles. Benefits of using a tag+options far outweigh any losses."}], "tags": [], "owner": {"reputation": 558, "user_id": 679458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2245db23b37d33d674a2e31e25472b45?s=128&d=identicon&r=PG", "display_name": "TopherGopher", "link": "https://stackoverflow.com/users/679458/tophergopher"}, "is_accepted": true, "score": 2, "last_activity_date": 1527280881, "creation_date": 1527280881, "answer_id": 50536588, "question_id": 50536368, "link": "https://stackoverflow.com/questions/50536368/does-gorilla-schema-support-the-json-reflection-tag-natively/50536588#50536588", "title": "Does Gorilla/schema support the `json` reflection tag natively?", "body": "<p>For others searching for this answer - </p>\n\n<p>This package has the ability to use any tag. The default is <code>schema</code> (<a href=\"https://github.com/gorilla/schema/blob/master/cache.go#L22\" rel=\"nofollow noreferrer\">which is initialized here</a>). To change the tag it's searching for, use <code>decoder.SetAliasTag(\"json\")</code>. While I think the fallback logic is <a href=\"https://github.com/gorilla/schema/blob/master/cache.go#L155\" rel=\"nofollow noreferrer\">around this function</a>, I'm not totally certain what the performance hit really is from not explicitly setting a different tag.</p>\n"}], "owner": {"reputation": 558, "user_id": 679458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2245db23b37d33d674a2e31e25472b45?s=128&d=identicon&r=PG", "display_name": "TopherGopher", "link": "https://stackoverflow.com/users/679458/tophergopher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 644, "favorite_count": 0, "accepted_answer_id": 50536588, "answer_count": 1, "score": 0, "last_activity_date": 1527280881, "creation_date": 1527279760, "last_edit_date": 1527279951, "question_id": 50536368, "link": "https://stackoverflow.com/questions/50536368/does-gorilla-schema-support-the-json-reflection-tag-natively", "title": "Does Gorilla/schema support the `json` reflection tag natively?", "body": "<p>In the documentation, <a href=\"https://github.com/gorilla/schema\" rel=\"nofollow noreferrer\">Gorilla/schema</a> says that you must specify the <code>schema</code> reflection tag to unpack the struct. I've seen it unpack when I don't have the schema tag, for example when I just am using the <code>json</code> tag.</p>\n\n<p>When the <code>schema</code> tag isn't specified what does Gorilla do under the covers? Does it look at other tags or does it do a case-insensitive match? Is there a huge performance hit as a result of not specifying the <code>schema</code> tag?</p>\n\n<p>EDIT: Specified/linked package</p>\n"}, {"tags": ["image", "numpy", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527269948, "post_id": 50534367, "comment_id": 88080711, "body": "&quot;Better&quot; in what way?"}, {"owner": {"reputation": 92118, "user_id": 1217358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2aafb97833979e3668c61d36e697bfc?s=128&d=identicon&r=PG", "display_name": "Warren Weckesser", "link": "https://stackoverflow.com/users/1217358/warren-weckesser"}, "edited": false, "score": 0, "creation_date": 1527272598, "post_id": 50534367, "comment_id": 88081786, "body": "The question has the <code>numpy</code> tag.  Does that mean you are also interested in a solution that uses Python+NumPy instead of go?"}, {"owner": {"reputation": 411, "user_id": 5458950, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fb2b553cce267f4db596aef25327f61c?s=128&d=identicon&r=PG", "display_name": "Chaos", "link": "https://stackoverflow.com/users/5458950/chaos"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527273262, "post_id": 50534367, "comment_id": 88082080, "body": "@Adrian perhaps using Golangs image/draw library if possible. This seems not the best on performance. Or maybe leverage multiprocesisng somehow?"}, {"owner": {"reputation": 411, "user_id": 5458950, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fb2b553cce267f4db596aef25327f61c?s=128&d=identicon&r=PG", "display_name": "Chaos", "link": "https://stackoverflow.com/users/5458950/chaos"}, "reply_to_user": {"reputation": 92118, "user_id": 1217358, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2aafb97833979e3668c61d36e697bfc?s=128&d=identicon&r=PG", "display_name": "Warren Weckesser", "link": "https://stackoverflow.com/users/1217358/warren-weckesser"}, "edited": false, "score": 0, "creation_date": 1527273265, "post_id": 50534367, "comment_id": 88082081, "body": "@WarrenWeckesser it&#39;s tagged like that because the input array is from a python numpy array. Wasnt sure if it mattered"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527273612, "post_id": 50534367, "comment_id": 88082224, "body": "@Chaos: you&#39;re basically writing directly to the underlying slice with <code>SetRGBA</code>, are you actually having a performance problem? You can just iterate over the image slice yourself if you want to avoid the function overhead (the offset calculation might be adding up)."}, {"owner": {"reputation": 411, "user_id": 5458950, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fb2b553cce267f4db596aef25327f61c?s=128&d=identicon&r=PG", "display_name": "Chaos", "link": "https://stackoverflow.com/users/5458950/chaos"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527276294, "post_id": 50534367, "comment_id": 88083352, "body": "@JimB It takes about 150ms to do this currently. For something like 60k images that would add up. So if there is a way to make it better that would be appreciated"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527277272, "post_id": 50534367, "comment_id": 88083738, "body": "@Chaos: as I mentioned, try iterating over the pixel data slice itself and see how much faster it is."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527278136, "post_id": 50534367, "comment_id": 88084117, "body": "@JimB doing so doesn&#39;t make the calculation just go away, iterating the slice would require <code>ix</code> and <code>iy</code> to be calculated instead. There&#39;s probably nothing to be gained that way."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1527278340, "post_id": 50534367, "comment_id": 88084206, "body": "@RayfenWindspear: you&#39;re probably right, and the calls should be getting inlined anyway since there&#39;s no interfaces involved at this level."}, {"owner": {"reputation": 384, "user_id": 9209921, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea892ea96e7d59143a1133592584c3ee?s=128&d=identicon&r=PG&f=1", "display_name": "tobeypeters", "link": "https://stackoverflow.com/users/9209921/tobeypeters"}, "edited": false, "score": 0, "creation_date": 1527366257, "post_id": 50534367, "comment_id": 88104078, "body": "Just asking out of curiosity.  Does it matter, if you add the alpha?  Especially, if you just want it to be 255.  Won&#39;t most applications just default the alpha to 255?"}, {"owner": {"reputation": 411, "user_id": 5458950, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fb2b553cce267f4db596aef25327f61c?s=128&d=identicon&r=PG", "display_name": "Chaos", "link": "https://stackoverflow.com/users/5458950/chaos"}, "reply_to_user": {"reputation": 384, "user_id": 9209921, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea892ea96e7d59143a1133592584c3ee?s=128&d=identicon&r=PG&f=1", "display_name": "tobeypeters", "link": "https://stackoverflow.com/users/9209921/tobeypeters"}, "edited": false, "score": 0, "creation_date": 1527453257, "post_id": 50534367, "comment_id": 88123381, "body": "@tobeypeters I don\u2019t believe there is a way to save as a PNG without having an alpha channel because you can\u2019t create an RGBA image in Golang."}], "owner": {"reputation": 411, "user_id": 5458950, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fb2b553cce267f4db596aef25327f61c?s=128&d=identicon&r=PG", "display_name": "Chaos", "link": "https://stackoverflow.com/users/5458950/chaos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1527279502, "creation_date": 1527269874, "last_edit_date": 1527279502, "question_id": 50534367, "link": "https://stackoverflow.com/questions/50534367/adding-an-alpha-channel-performance", "title": "Adding an alpha channel performance", "body": "<p>I'm looking to convert my array to a PNG image. It is currently an RGB8 encoded image. I can do so using the following code:</p>\n\n<pre><code>s2 := make([]uint8, 2048*2448*3)\nerr = dset.Read(&amp;s2)\nif err != nil {\n    panic(err)\n}\n\nvar (\n    width  = 2048\n    height = 2448\n    rgb    = 3\n)\n\nto1D := func(x, y int) int {\n    return (x * height * rgb) + (rgb * y)\n}\n\nimg := image.NewRGBA(image.Rect(0, 0, width, height))\nfor ix := 0; ix &lt; width; ix++ {\n    for iy := 0; iy &lt; height; iy++ {\n        cords := to1D(ix, iy)\n        img.SetRGBA(ix, iy, color.RGBA{R: s2[cords], G: s2[cords+1], B: s2[cords+2], A: 255})\n    }\n}\n</code></pre>\n\n<p>Is there a better way to add an alpha channel that doesn't involve looping through each pixel and setting it individually? </p>\n\n<p>Thank you!</p>\n"}, {"tags": ["go", "protocol-buffers"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527271456, "post_id": 50532446, "comment_id": 88081342, "body": "What do you mean by &quot;well known types&quot;?"}, {"owner": {"reputation": 483, "user_id": 7452238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b5339f527b561933b4e1eceaf7e42d9?s=128&d=identicon&r=PG&f=1", "display_name": "bobra", "link": "https://stackoverflow.com/users/7452238/bobra"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527333758, "post_id": 50532446, "comment_id": 88095597, "body": "@Adrian maybe i uset incorrerct note, it may be called already-known type. So a message that is declared in other proto file and is imported in the current."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527343178, "post_id": 50532446, "comment_id": 88098157, "body": "They only need to be imported if they&#39;re in different packages. Are they in different packages? Does the generated code not compile? What problem are you actually having?"}, {"owner": {"reputation": 483, "user_id": 7452238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b5339f527b561933b4e1eceaf7e42d9?s=128&d=identicon&r=PG&f=1", "display_name": "bobra", "link": "https://stackoverflow.com/users/7452238/bobra"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527368056, "post_id": 50532446, "comment_id": 88104477, "body": "@Adrian before protoc-gen-go update import of messages from different packages worked quite good, but after update , import fails , and generated code doesen&#39;t compile. so in &quot;b.bp.go&quot; before update fields of a struct were *a.AMsg, and after update  they look like *AMsg . Thats the problem"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527520480, "post_id": 50532446, "comment_id": 88148492, "body": "If the generated code doesn&#39;t compile, that&#39;s a bug in protoc - try updating to the latest version or open an issue on their GitHub."}], "answers": [{"tags": [], "owner": {"reputation": 483, "user_id": 7452238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b5339f527b561933b4e1eceaf7e42d9?s=128&d=identicon&r=PG&f=1", "display_name": "bobra", "link": "https://stackoverflow.com/users/7452238/bobra"}, "is_accepted": true, "score": 0, "last_activity_date": 1535626346, "creation_date": 1535626346, "answer_id": 52095239, "question_id": 50532446, "link": "https://stackoverflow.com/questions/50532446/new-version-of-protoc-gen-go-drops-already-known-types/52095239#52095239", "title": "new version of protoc-gen-go drops already known types", "body": "<p><code>go_package</code> option solved this, you should explicitly specify the package in <code>a.proto</code></p>\n\n<p>like this:</p>\n\n<pre><code>syntax = \"proto3\";\n\npackage a;\noption go_package= \"some_path/A\";\n\nmessage AMsg{\n    fixed64 smth1 = 1;\n    fixed64 smth2 = 2;\n}\n</code></pre>\n\n<p>so you will get right generated types from <code>a.proto</code> in other proto files</p>\n"}], "owner": {"reputation": 483, "user_id": 7452238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b5339f527b561933b4e1eceaf7e42d9?s=128&d=identicon&r=PG&f=1", "display_name": "bobra", "link": "https://stackoverflow.com/users/7452238/bobra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 0, "accepted_answer_id": 52095239, "answer_count": 1, "score": 1, "last_activity_date": 1535626346, "creation_date": 1527261737, "last_edit_date": 1527333624, "question_id": 50532446, "link": "https://stackoverflow.com/questions/50532446/new-version-of-protoc-gen-go-drops-already-known-types", "title": "new version of protoc-gen-go drops already known types", "body": "<p>There are two .proto files</p>\n\n<p><strong>1st file | name \"a.proto\"</strong></p>\n\n<pre><code>syntax = \"proto3\";\n\npackage a;\n\nmessage AMsg{\n    fixed64 smth1 = 1;\n    fixed64 smth2 = 2;\n}\n</code></pre>\n\n<p><strong>2nd file | name \"b.proto\"</strong></p>\n\n<pre><code>syntax = \"proto3\";\n\npackage b;\n\nimport \"a.proto\";\n\nmessage BMsg {\n    a.AMsg msg1 = 1;\n    a.AMsg msg2 = 2;\n}\n</code></pre>\n\n<p>previous versions of protoc-gen-go generated the following code:</p>\n\n<p><strong>file \"a.pb.go\"</strong></p>\n\n<pre><code>package b\n\nimport proto \"github.com/golang/protobuf/proto\"\nimport fmt \"fmt\"\nimport math \"math\"    \n\n. . .  \n\ntype AMsg struct {\n    smth1 uint64 \n    smth2 uint64 \n}\n\n. . . \n</code></pre>\n\n<p><strong>file \"b.pb.go\"</strong></p>\n\n<pre><code>package b\n\nimport proto \"github.com/golang/protobuf/proto\"\nimport fmt \"fmt\"\nimport math \"math\"   \nimport \"a\"\n\n. . .  \n\ntype BMsg struct {\n    msg1 *a.AMsg\n    msg2 *a.AMsg\n}\n\n. . . \n</code></pre>\n\n<p>and everything was alright,</p>\n\n<p><strong>but</strong></p>\n\n<p>one day a new version of protoc-gen-go had come </p>\n\n<p>and <strong>file \"b.pb.go\"</strong> now looks like this:</p>\n\n<pre><code>package b\n\nimport proto \"github.com/golang/protobuf/proto\"\nimport fmt \"fmt\"\nimport math \"math\"   \n\n. . .  \n\ntype BMsg struct {\n    msg1 *AMsg\n    msg2 *AMsg\n}\n\n. . . \n</code></pre>\n\n<p>you can notice that already known types are dropped here, but i can't find out the reason. (i. e. prefix \"a.\" i missing)</p>\n\n<p>this <a href=\"https://developers.google.com/protocol-buffers/docs/reference/go-generated\" rel=\"nofollow noreferrer\">link https://developers.google.com/protocol-buffers/docs/reference/go-generated</a> says nothing about the new approach</p>\n\n<p><strong>What should I do to make protoc-gen-go to generate \"b.pb.go\" without these drops?</strong></p>\n"}, {"tags": ["go", "project"], "answers": [{"tags": [], "owner": {"reputation": 143, "user_id": 2855831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29dec7ccaaff52ec670d33a5861bec15?s=128&d=identicon&r=PG&f=1", "display_name": "thisischuck", "link": "https://stackoverflow.com/users/2855831/thisischuck"}, "is_accepted": false, "score": 0, "last_activity_date": 1527268397, "creation_date": 1527268397, "answer_id": 50534042, "question_id": 50532445, "link": "https://stackoverflow.com/questions/50532445/do-all-go-projects-need-to-live-below-gopath/50534042#50534042", "title": "Do all Go projects need to live below GOPATH?", "body": "<p>When using the GOPATH you can make subdirectories in the <code>/src</code> folder, for example, adding both home and work directories.  In fact, the Go project has an <a href=\"https://golang.org/doc/code.html#Workspaces\" rel=\"nofollow noreferrer\">example</a> of how to organize code.  While packages need to be in their own folders, a folder itself in the GOPATH is not automatically a package. </p>\n\n<p>If you'd rather not work within the confines of the GOPATH, you can change it to the path you do want to work in, or set it to your home directory.</p>\n"}, {"tags": [], "owner": {"reputation": 56, "user_id": 5311970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e46e0c62436ace5b6ce3689790546b33?s=128&d=identicon&r=PG&f=1", "display_name": "fische", "link": "https://stackoverflow.com/users/5311970/fische"}, "is_accepted": false, "score": 4, "last_activity_date": 1527270817, "creation_date": 1527270817, "answer_id": 50534555, "question_id": 50532445, "link": "https://stackoverflow.com/questions/50532445/do-all-go-projects-need-to-live-below-gopath/50534555#50534555", "title": "Do all Go projects need to live below GOPATH?", "body": "<p>You can actually have Go projects outside of GOPATH. However, some tools do not work well or do not work at all in this kind of situation. For example, <code>goimports</code>, which formats your code and add missing imports, will not be able to find packages that are outside of GOPATH. You'll have to write the imports manually using a relative path: <code>./path/to/your/package</code>.</p>\n\n<blockquote>\n  <p>how can I split, say, personal and professional projects when the personal must stay at d:\\home and professional at x:\\work ?</p>\n</blockquote>\n\n<p>You actually can have multiple Go workspaces (<a href=\"https://github.com/golang/go/wiki/GOPATH\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/GOPATH</a>). You just need to set GOPATH to the list of their location joined with the list separator of your OS. e.g. on Linux it would look like this:</p>\n\n<pre><code>GOPATH=\"/home/nobody/perso:/home/nobody/work\"\n</code></pre>\n\n<p>Though, I'm not sure how <code>go</code> and other tools such as dependency managers handle multiple workspaces.</p>\n"}], "owner": {"reputation": 18898, "user_id": 903011, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6a8f2f5f292c75c5e81a6607530a0ab6?s=128&d=identicon&r=PG", "display_name": "WoJ", "link": "https://stackoverflow.com/users/903011/woj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5931, "favorite_count": 1, "closed_date": 1527493451, "answer_count": 2, "score": 11, "last_activity_date": 1527270817, "creation_date": 1527261726, "question_id": 50532445, "link": "https://stackoverflow.com/questions/50532445/do-all-go-projects-need-to-live-below-gopath", "closed_reason": "Duplicate", "title": "Do all Go projects need to live below GOPATH?", "body": "<p>I am starting with Go and trying to get my head around <code>GOPATH</code> (and probably <code>GOBIN</code>).</p>\n\n<p>When trying to fetch external libraries via <code>go get</code> I get the error </p>\n\n<pre><code>go get: no install location for directory D:\\Seafile\\dev-perso\\domotiqueNG\\services\\dispatcher-go\\src\\dispatcher-go outside GOPATH\n</code></pre>\n\n<p>This error is apparently solved by having a project structure below <code>$GOPATH/src</code>. </p>\n\n<p>Does this mean that all my Go programs must live there? If <code>GOPATH</code> is <code>d:\\hello</code> then the projects <code>bonjour</code> and <code>aurvoir</code> really need to be in </p>\n\n<pre><code>d:\\hello\\src\\bonjour\nd:\\hello\\src\\aurevoir\n</code></pre>\n\n<p>only ?</p>\n\n<p>In this is the case how can I</p>\n\n<ul>\n<li>split, say, personal and professional projects when the personal must stay at <code>d:\\home</code> and professional at <code>x:\\work</code> ?</li>\n<li>have multilanguage projects where <code>d:\\home\\domotique\\dispatch</code> is in Go, <code>d:\\home\\domotique\\whatever</code> is in Python, and I have several such combos in <code>d:\\home</code>?</li>\n</ul>\n"}, {"tags": ["json", "parsing", "go"], "comments": [{"owner": {"reputation": 830, "user_id": 7735711, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/phq5j.jpg?s=128&g=1", "display_name": "Tu\u011fberk Kaan Duman", "link": "https://stackoverflow.com/users/7735711/tu%c4%9fberk-kaan-duman"}, "edited": false, "score": 4, "creation_date": 1527260045, "post_id": 50531922, "comment_id": 88075790, "body": "I was just passing by, but your apikey is visible in the code. You may want to hide it."}, {"owner": {"reputation": 1059, "user_id": 8368990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e3e253063cfcfeff6159f83a5c2404d?s=128&d=identicon&r=PG&f=1", "display_name": "fanduin", "link": "https://stackoverflow.com/users/8368990/fanduin"}, "edited": false, "score": 0, "creation_date": 1527260449, "post_id": 50531922, "comment_id": 88076076, "body": "If we&#39;re being super careful, we may want to delete these comments as the earlier version of the question can be seen"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1527260483, "post_id": 50531922, "comment_id": 88076092, "body": "The safest way now is to delete this question (then only users with &gt; 10k rep can see it), and flag it for a moderator to completely delete it. Then re-post your question without your API key."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1527260501, "post_id": 50531922, "comment_id": 88076105, "body": "Or, just change your API key. You should do that anyway. Consider your existing API key compromised."}, {"owner": {"reputation": 31, "user_id": 6108644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a374f7ade1f62a450a5c9525a3d7eb5?s=128&d=identicon&r=PG&f=1", "display_name": "MWA", "link": "https://stackoverflow.com/users/6108644/mwa"}, "edited": false, "score": 0, "creation_date": 1527260582, "post_id": 50531922, "comment_id": 88076163, "body": "I have modified the api key, no need to do that ..."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1527260640, "post_id": 50531922, "comment_id": 88076186, "body": "The API key is <a href=\"https://stackoverflow.com/revisions/50531922/1\">still visible in the edit history</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527260676, "post_id": 50531922, "comment_id": 88076202, "body": "But to your question: What have you tried? We get questions like this all the time. What searching have you done on Google or SO?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1527260863, "post_id": 50531922, "comment_id": 88076299, "body": "I understand what you want to do. I&#39;m asking what you have tried, and what problems you had with your approach."}, {"owner": {"reputation": 31, "user_id": 6108644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a374f7ade1f62a450a5c9525a3d7eb5?s=128&d=identicon&r=PG&f=1", "display_name": "MWA", "link": "https://stackoverflow.com/users/6108644/mwa"}, "edited": false, "score": 0, "creation_date": 1527261041, "post_id": 50531922, "comment_id": 88076389, "body": "Well, i have got the Json and iterate it to lose the \u2018Meta Data\u2019 and got left with the remaining one, but after that, just got lost and don\u2019t know what to do."}], "answers": [{"comments": [{"owner": {"reputation": 160456, "user_id": 89391, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bb5230985aa2c9ea7d022d1a16890f16?s=128&d=identicon&r=PG", "display_name": "miku", "link": "https://stackoverflow.com/users/89391/miku"}, "reply_to_user": {"reputation": 31, "user_id": 6108644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a374f7ade1f62a450a5c9525a3d7eb5?s=128&d=identicon&r=PG&f=1", "display_name": "MWA", "link": "https://stackoverflow.com/users/6108644/mwa"}, "edited": false, "score": 3, "creation_date": 1527261580, "post_id": 50532330, "comment_id": 88076659, "body": "@MeronWA, just remember, the internet knows your API key now."}], "tags": [], "owner": {"reputation": 160456, "user_id": 89391, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bb5230985aa2c9ea7d022d1a16890f16?s=128&d=identicon&r=PG", "display_name": "miku", "link": "https://stackoverflow.com/users/89391/miku"}, "is_accepted": true, "score": 0, "last_activity_date": 1527261625, "last_edit_date": 1527261625, "creation_date": 1527261349, "answer_id": 50532330, "question_id": 50531922, "link": "https://stackoverflow.com/questions/50531922/how-to-parse-json-from-url/50532330#50532330", "title": "How to parse JSON from URL", "body": "<p>The actual JSON object is quite, unusual - and it does not lend itself to a simple way of turning it into a struct.</p>\n\n<p>For demonstration, I will use <a href=\"https://github.com/bemasher/JSONGen\" rel=\"nofollow noreferrer\">JSONGen</a>, a great utility for turning JSON into Go structs.</p>\n\n<p>For the problem at hand, I would probably use a two step approach.</p>\n\n<p>First, parse the whole document (assuming msft.json contains an API response):</p>\n\n<pre><code>$ cat msft.json | JSONGen\ntype _ struct {\n    MetaData struct {\n        Information   string `json:\"1. Information\"`\n        Interval      string `json:\"4. Interval\"`\n        LastRefreshed string `json:\"3. Last Refreshed\"`\n        OutputSize    string `json:\"5. Output Size\"`\n        Symbol        string `json:\"2. Symbol\"`\n        TimeZone      string `json:\"6. Time Zone\"`\n    } `json:\"Meta Data\"`\n    TimeSeries1min struct {\n        _ struct {\n            Close  string `json:\"4. close\"`\n            High   string `json:\"2. high\"`\n            ...\n</code></pre>\n\n<p>The problem is  the repeated elements, keyed by datetime, which would probably be better modelled as a list. Anyway, with <a href=\"https://stedolan.github.io/jq/\" rel=\"nofollow noreferrer\">jq</a> we can parse out a relevant piece and generate another struct:</p>\n\n<pre><code>$ cat msft.json | jq '.[\"Time Series (1min)\"][\"2018-05-24 15:47:00\"]' | JSONGen\ntype _ struct {\n    Close  string `json:\"4. close\"`\n    High   string `json:\"2. high\"`\n    Low    string `json:\"3. low\"`\n    Open   string `json:\"1. open\"`\n    Volume string `json:\"5. volume\"`\n}\n</code></pre>\n\n<p>Now we can combine the two structs into one. Here is a complete program to parse the JSON\ninput.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n)\n\ntype Item struct {\n    Close  string `json:\"4. close\"`\n    High   string `json:\"2. high\"`\n    Low    string `json:\"3. low\"`\n    Open   string `json:\"1. open\"`\n    Volume string `json:\"5. volume\"`\n}\n\ntype Response struct {\n    MetaData struct {\n        Information   string `json:\"1. Information\"`\n        Interval      string `json:\"4. Interval\"`\n        LastRefreshed string `json:\"3. Last Refreshed\"`\n        OutputSize    string `json:\"5. Output Size\"`\n        Symbol        string `json:\"2. Symbol\"`\n        TimeZone      string `json:\"6. Time Zone\"`\n    } `json:\"Meta Data\"`\n    TimeSeries1min map[string]Item `json:\"Time Series (1min)\"`\n}\n</code></pre>\n\n<p>We can model the time series as a map of OHLC items. The parsing now gets really simple:</p>\n\n<pre><code>func main() {\n    resp := Response{}\n    if err := json.NewDecoder(os.Stdin).Decode(&amp;resp); err != nil {\n        log.Fatal(err)\n    }\n    for k, v := range resp.TimeSeries1min {\n        fmt.Printf(\"%s\\t%s\\t%s\\t%s\\t%s\\t%s\\t%s\\n\",\n            resp.MetaData.Symbol, resp.MetaData.LastRefreshed, k,\n            v.Open, v.High, v.Low, v.Close)\n    }\n}\n</code></pre>\n\n<p>While will output something like:</p>\n\n<pre><code>$ go run main.go &lt; msft.json\nMSFT    2018-05-25 10:53:00 2018-05-25 10:49:00 98.6292 98.6292 98.5700 98.5750\nMSFT    2018-05-25 10:53:00 2018-05-25 10:40:00 98.8700 98.8701 98.7900 98.8300\nMSFT    2018-05-25 10:53:00 2018-05-25 10:22:00 98.6460 98.6500 98.6000 98.6300\n</code></pre>\n\n<p>...</p>\n"}], "owner": {"reputation": 31, "user_id": 6108644, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a374f7ade1f62a450a5c9525a3d7eb5?s=128&d=identicon&r=PG&f=1", "display_name": "MWA", "link": "https://stackoverflow.com/users/6108644/mwa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1020, "favorite_count": 0, "accepted_answer_id": 50532330, "answer_count": 1, "score": -4, "last_activity_date": 1611907213, "creation_date": 1527259870, "last_edit_date": 1611907213, "question_id": 50531922, "link": "https://stackoverflow.com/questions/50531922/how-to-parse-json-from-url", "title": "How to parse JSON from URL", "body": "<p>I requested to a server with a GET and received a JSON format. I'm using Go, and implemented it in Go in beego web framework.</p>\n<p>So I have implemented it like this one,</p>\n<pre><code>func (d *Tom) Get() {\n    //passengersFile, err := http.Get(&quot;https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&amp;symbol=MSFT&amp;interval=1min&amp;apikey=KLMH2VFJ0LCFNOX5&quot;)\n    resp, err := http.Get(&quot;https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&amp;symbol=MSFT&amp;interval=1min&amp;apikey=KLMH2VF0LCFNOX5&quot;)\n    if err != nil {\n        panic(err)\n    }\n    defer resp.Body.Close()\n\n    //fmt.Printf(&quot;%#v\\n&quot;, resp)\n\n    dec := json.NewDecoder(resp.Body)\n    if dec == nil {\n        panic(&quot;Failed to start decoding JSON data&quot;)\n    }\n\n    json_map := make(map[string]interface{})\n\n    err = dec.Decode(&amp;json_map)\n        for k, v := range json_map {\n            if k == &quot;Meta Data&quot;{\n                    continue\n            }\n            fmt.Printf(&quot;key[%s] value[%s]\\n&quot;, k, v)\n        }\n    if err != nil {\n        panic(err)\n    }\n\n        d.Data[&quot;json&quot;] = &amp;json_map\n    d.ServeJSON()\n}\n</code></pre>\n<p>the format of the incoming json is like that ....</p>\n<pre><code>{\n  &quot;Meta Data&quot;: {\n    &quot;1. Information&quot;: &quot;Intraday (1min) prices and volumes&quot;,\n    &quot;2. Symbol&quot;: &quot;MSFT&quot;,\n    &quot;3. Last Refreshed&quot;: &quot;2018-05-25 09:31:00&quot;,\n    &quot;4. Interval&quot;: &quot;1min&quot;,\n    &quot;5. Output Size&quot;: &quot;Compact&quot;,\n    &quot;6. Time Zone&quot;: &quot;US/Eastern&quot;\n  },\n  &quot;Time Series (1min)&quot;: {\n    &quot;2018-05-24 14:23:00&quot;: {\n      &quot;1. open&quot;: &quot;98.1432&quot;,\n      &quot;2. high&quot;: &quot;98.1661&quot;,\n      &quot;3. low&quot;: &quot;98.1238&quot;,\n      &quot;4. close&quot;: &quot;98.1500&quot;,\n      &quot;5. volume&quot;: &quot;19106&quot;\n    },\n    &quot;2018-05-24 14:24:00&quot;: {\n      &quot;1. open&quot;: &quot;98.1500&quot;,\n      &quot;2. high&quot;: &quot;98.1700&quot;,\n      &quot;3. low&quot;: &quot;98.1400&quot;,\n      &quot;4. close&quot;: &quot;98.1650&quot;,\n      &quot;5. volume&quot;: &quot;18279&quot;\n    },\n    &quot;2018-05-24 14:25:00&quot;: {\n      &quot;1. open&quot;: &quot;98.1650&quot;,\n      &quot;2. high&quot;: &quot;98.2000&quot;,\n      &quot;3. low&quot;: &quot;98.1600&quot;,\n      &quot;4. close&quot;: &quot;98.1900&quot;,\n      &quot;5. volume&quot;: &quot;32085&quot;\n    }\n  }\n}\n</code></pre>\n<p>Now I want to get the &quot;Time Series (1min)&quot; values and iterate on them to get each value of the &quot;Date Time&quot; values, like &quot;1. open&quot;, etc. And of course save them on a single json and return it for those who requested it.</p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527258690, "post_id": 50531370, "comment_id": 88074935, "body": "Is <code>START</code> a program? Is it in your path? is it missing the <code>.exe</code> extension? What are the exact arguments used by the working <code>ForkExec</code>, (though the Linux implementation should also be using the <code>os&#47;exec</code> package, and not <code>syscall</code> directly)"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1527258910, "post_id": 50531370, "comment_id": 88075077, "body": "You should probably look at <code>StartProcess</code> <a href=\"https://golang.org/pkg/os/#StartProcess\" rel=\"nofollow noreferrer\">golang.org/pkg/os/#StartProcess</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1527259152, "post_id": 50531370, "comment_id": 88075242, "body": "@Ravi: <code>os&#47;exec</code> should be preferred, From the docs: <i>It wraps os.StartProcess to make it easier to remap stdin and stdout, connect I/O with pipes, and do other adjustments.</i>"}, {"owner": {"reputation": 1193, "user_id": 2182996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57a529bc8861d5f54c464466a2aacb27?s=128&d=identicon&r=PG", "display_name": "Baptiste Donaux", "link": "https://stackoverflow.com/users/2182996/baptiste-donaux"}, "edited": false, "score": 0, "creation_date": 1527260230, "post_id": 50531370, "comment_id": 88075923, "body": "<code>START</code> is a program available in command line but I can&#39;t found it into <code>C:\\Windows\\System32</code>.  For Linux I uses <code>syscall</code> which detach the child process instead of <code>os&#47;exec</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1527261381, "post_id": 50531370, "comment_id": 88076560, "body": "@JimB <code>start</code> is an (internal) command of the Windows command line interpreter (<code>cmd.exe</code>). <a href=\"https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-xp/bb491005(v=technet.10)\" rel=\"nofollow noreferrer\">Details</a>."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527261525, "post_id": 50531370, "comment_id": 88076627, "body": "Agreed @JimB. Here he mentions that he wanted to start a detached process, so I got an impression that he doesn&#39;t need any control."}], "answers": [{"comments": [{"owner": {"reputation": 1193, "user_id": 2182996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57a529bc8861d5f54c464466a2aacb27?s=128&d=identicon&r=PG", "display_name": "Baptiste Donaux", "link": "https://stackoverflow.com/users/2182996/baptiste-donaux"}, "edited": false, "score": 0, "creation_date": 1527261213, "post_id": 50532038, "comment_id": 88076468, "body": "Thanks ! Exactly the solution for my problem."}, {"owner": {"reputation": 6175, "user_id": 2275818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PlSe7.png?s=128&g=1", "display_name": "Anthony Raymond", "link": "https://stackoverflow.com/users/2275818/anthony-raymond"}, "edited": false, "score": 1, "creation_date": 1558341983, "post_id": 50532038, "comment_id": 99055116, "body": "As a clarification, and because it&#39;s not mentioned in the answer; the child process remains even if the parent program exit with a non-zero code. (which os.exec does not provides under windows)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1527261318, "last_edit_date": 1527261318, "creation_date": 1527260276, "answer_id": 50532038, "question_id": 50531370, "link": "https://stackoverflow.com/questions/50531370/start-a-detached-process-on-windows-using-golang/50532038#50532038", "title": "Start a detached process on Windows using Golang", "body": "<p><code>start</code> is not a standalone application, it's an (internal) command of the Windows command line interpreter (<code>cmd.exe</code>) (details: <a href=\"https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-xp/bb491005(v=technet.10)\" rel=\"noreferrer\">Command line reference / Start</a>), so you need a \"shell\" to run the <code>start</code> command.</p>\n\n<p>Use <code>cmd.exe</code> with the <code>/C</code> parameter, and pass <code>start</code> and your application to run.</p>\n\n<p>Like in this example:</p>\n\n<pre><code>s := []string{\"cmd.exe\", \"/C\", \"start\", `c:\\path\\to\\your\\app\\myapp.exe`}\n\ncmd := exec.Command(s[0], s[1:]...)\nif err := cmd.Run(); err != nil {\n    log.Println(\"Error:\", err)\n}\n</code></pre>\n\n<p>Or without the command slice:</p>\n\n<pre><code>cmd := exec.Command(\"cmd.exe\", \"/C\", \"start\", `c:\\path\\to\\your\\app\\myapp.exe`)\nif err := cmd.Run(); err != nil {\n    log.Println(\"Error:\", err)\n}\n</code></pre>\n\n<p>You may also pass the <code>/b</code> param to <code>start</code> like this if you don't want a terminal window for the launched application:</p>\n\n<pre><code>cmd := exec.Command(\"cmd.exe\", \"/C\", \"start\", \"/b\", `c:\\path\\to\\your\\app\\myapp.exe`)\nif err := cmd.Run(); err != nil {\n    log.Println(\"Error:\", err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1609875358, "creation_date": 1609875358, "answer_id": 65585444, "question_id": 50531370, "link": "https://stackoverflow.com/questions/50531370/start-a-detached-process-on-windows-using-golang/65585444#65585444", "title": "Start a detached process on Windows using Golang", "body": "<p>Its not clear to me what you mean by detached. If you mean in the sense, &quot;dont\nwait for program to finish&quot;, you dont need a shell for that:</p>\n<pre><code>package main\nimport &quot;os/exec&quot;\n\nfunc main() {\n   o := exec.Command(&quot;firefox&quot;, &quot;google.com/search?q=golang&quot;)\n   o.Start()\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/os/exec#Cmd.Start\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/exec#Cmd.Start</a></p>\n"}], "owner": {"reputation": 1193, "user_id": 2182996, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57a529bc8861d5f54c464466a2aacb27?s=128&d=identicon&r=PG", "display_name": "Baptiste Donaux", "link": "https://stackoverflow.com/users/2182996/baptiste-donaux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4590, "favorite_count": 5, "accepted_answer_id": 50532038, "answer_count": 2, "score": 8, "last_activity_date": 1609875358, "creation_date": 1527258149, "question_id": 50531370, "link": "https://stackoverflow.com/questions/50531370/start-a-detached-process-on-windows-using-golang", "title": "Start a detached process on Windows using Golang", "body": "<p>I have a Golang code which must run a detached child process.</p>\n\n<p>The Linux version of my implementation using <code>syscall.ForkExec</code> like this.</p>\n\n<pre><code>syscall.ForkExec(my_program, []string{}, nil)\n</code></pre>\n\n<p>But I can't found Windows implementation. I have found a proposition using <code>START /B</code>.</p>\n\n<pre><code>cmd := exec.Command(\"START\", \"/B\", my_program)\ncmd.Start()\n</code></pre>\n\n<p>Unfortunately, <code>START</code> can't be found and I have no other solution using Golang.</p>\n"}, {"tags": ["http", "go", "memory-leaks"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1527254773, "post_id": 50530245, "comment_id": 88072357, "body": "You&#39;re creating and discarding a new transport every time. That is going to leak connections."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1527257746, "post_id": 50530245, "comment_id": 88074339, "body": "Please refer <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http</a> : <code>Clients and Transports are safe for concurrent use by multiple goroutines and for efficiency should only be created once and re-used.</code>"}, {"owner": {"reputation": 137, "user_id": 9570173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce78d21ab2fa81fc9092db58c25b9af3?s=128&d=identicon&r=PG&f=1", "display_name": "ChunkCoder", "link": "https://stackoverflow.com/users/9570173/chunkcoder"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1527261028, "post_id": 50530245, "comment_id": 88076379, "body": "@Ravi but i&#39;m need to insert new dialer to Transport all time"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527262205, "post_id": 50530245, "comment_id": 88077024, "body": "@ChunkCoder: I don&#39;t see why, but if you did need a dialer that makes a new proxy dialer every time, make yourself a type that does just that."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1527265725, "post_id": 50530245, "comment_id": 88078794, "body": "Not sure if this is the right way though, a counting semaphore for a pool of <code>http.Client</code> connections, would it help?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1527322022, "post_id": 50530245, "comment_id": 88092728, "body": "@JimB, keep-alive is disabled; this doesn&#39;t leak connections. ChunkCoder, use <a href=\"https://golang.org/pkg/net/http/pprof/\" rel=\"nofollow noreferrer\">pprof</a> to figure out why the goroutines are blocking (probably on c &lt;-)."}, {"owner": {"reputation": 137, "user_id": 9570173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce78d21ab2fa81fc9092db58c25b9af3?s=128&d=identicon&r=PG&f=1", "display_name": "ChunkCoder", "link": "https://stackoverflow.com/users/9570173/chunkcoder"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1527339547, "post_id": 50530245, "comment_id": 88097199, "body": "@Peter, I&#39;m check it, you are right (c &lt;-) is problem, how to fix it? and why it happen?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527340162, "post_id": 50530245, "comment_id": 88097333, "body": "Peter: sorry, that&#39;s correct in this case. @ChunkCoder, sending on a channel will block if there&#39;s no receiver. If you want this to be reliable you should probably also create a Dialer that can accept a cancellation context so the Dialer isn&#39;t able to block the goroutine as well."}, {"owner": {"reputation": 137, "user_id": 9570173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce78d21ab2fa81fc9092db58c25b9af3?s=128&d=identicon&r=PG&f=1", "display_name": "ChunkCoder", "link": "https://stackoverflow.com/users/9570173/chunkcoder"}, "edited": false, "score": 0, "creation_date": 1527343722, "post_id": 50530245, "comment_id": 88098291, "body": "I&#39;m updated code and still have small leak"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527345121, "post_id": 50530245, "comment_id": 88098676, "body": "@ChunkCoder: if SOCKS5 returns an error you&#39;re not sending a corresponding value over respChan. There&#39;s no reason to use the <code>wg</code> in the second for loop. If there&#39;s still a leak, look at a stack trace and see what&#39;s blocking -- there&#39;s no timeout for the proxy dialer so that can still block."}, {"owner": {"reputation": 137, "user_id": 9570173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce78d21ab2fa81fc9092db58c25b9af3?s=128&d=identicon&r=PG&f=1", "display_name": "ChunkCoder", "link": "https://stackoverflow.com/users/9570173/chunkcoder"}, "edited": false, "score": 0, "creation_date": 1527357209, "post_id": 50530245, "comment_id": 88102087, "body": "Transport dies too slowly. I&#39;v creating Transports for checking proxy every 2 minute, so new Transports creates faster that old dies."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527370925, "post_id": 50530245, "comment_id": 88105144, "body": "@ChunkCoder, yes, you should be reusing the transport."}, {"owner": {"reputation": 137, "user_id": 9570173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce78d21ab2fa81fc9092db58c25b9af3?s=128&d=identicon&r=PG&f=1", "display_name": "ChunkCoder", "link": "https://stackoverflow.com/users/9570173/chunkcoder"}, "edited": false, "score": 0, "creation_date": 1527422511, "post_id": 50530245, "comment_id": 88114666, "body": "<code>Dial:              dialer.Dial,</code> is blocking transport, how to set timeout for it?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527428666, "post_id": 50530245, "comment_id": 88116298, "body": "Use <code>DialContext</code> instead of the deprecated <code>Dial</code> field."}, {"owner": {"reputation": 137, "user_id": 9570173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce78d21ab2fa81fc9092db58c25b9af3?s=128&d=identicon&r=PG&f=1", "display_name": "ChunkCoder", "link": "https://stackoverflow.com/users/9570173/chunkcoder"}, "edited": false, "score": 0, "creation_date": 1527442962, "post_id": 50530245, "comment_id": 88120454, "body": "proxy package not support it, also I found this <a href=\"https://go-review.googlesource.com/c/net/+/37641\" rel=\"nofollow noreferrer\">go-review.googlesource.com/c/net/+/37641</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527444850, "post_id": 50530245, "comment_id": 88120999, "body": "@ChunkCoder: I see. You could still use a Dialer in the Proxy with a default timeout, so it won&#39;t block indefinitely."}, {"owner": {"reputation": 137, "user_id": 9570173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce78d21ab2fa81fc9092db58c25b9af3?s=128&d=identicon&r=PG&f=1", "display_name": "ChunkCoder", "link": "https://stackoverflow.com/users/9570173/chunkcoder"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527445822, "post_id": 50530245, "comment_id": 88121281, "body": "@JimB can you show example? cause I cant find how to add timeout to  Dialer"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1527447248, "post_id": 50530245, "comment_id": 88121688, "body": "@ChunkCoder, rather than <code>proxy.Direct</code> (which just wraps the <code>net.Dial</code> function in a <code>Dialer</code> type), Use a <code>net.Dialer</code> with the <code>Timeout</code> field set."}], "answers": [{"tags": [], "owner": {"reputation": 569, "user_id": 7336226, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/QJ84k.jpg?s=128&g=1", "display_name": "trigun117", "link": "https://stackoverflow.com/users/7336226/trigun117"}, "is_accepted": true, "score": 0, "last_activity_date": 1527452276, "creation_date": 1527452276, "answer_id": 50556130, "question_id": 50530245, "link": "https://stackoverflow.com/questions/50530245/go-httpclient-memory-leaks/50556130#50556130", "title": "Go httpClient memory leaks", "body": "<p>I'm read comments, so this should solve your problem</p>\n\n<pre><code>const (\n    timeout = time.Duration(1000 * time.Millisecond)\n    tt      = time.Duration(100 * time.Millisecond)\n)\n\nfunc checkProxySOCKS(prox string, c chan QR, wg *sync.WaitGroup) (err error) {\n\n    defer wg.Done()\n\n    d := net.Dialer{\n        Timeout:   tt,\n        KeepAlive: tt,\n    }\n\n    dialer, _ := proxy.SOCKS5(\"tcp\", prox, nil, &amp;d)\n\n    httpClient := &amp;http.Client{\n        Timeout: timeout,\n        Transport: &amp;http.Transport{\n            DisableKeepAlives: true,\n            Dial:              dialer.Dial,\n        },\n    }\n\n    res, err := httpClient.Get(\"https://telegram.org/\")\n    if err != nil {\n\n        c &lt;- QR{Addr: prox, Res: false}\n        return\n    }\n\n    defer res.Body.Close()\n    io.Copy(ioutil.Discard, res.Body)\n\n    c &lt;- QR{Addr: prox, Res: true}\n\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 9570173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce78d21ab2fa81fc9092db58c25b9af3?s=128&d=identicon&r=PG&f=1", "display_name": "ChunkCoder", "link": "https://stackoverflow.com/users/9570173/chunkcoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1756, "favorite_count": 1, "accepted_answer_id": 50556130, "answer_count": 1, "score": 0, "last_activity_date": 1527452276, "creation_date": 1527254612, "last_edit_date": 1527422438, "question_id": 50530245, "link": "https://stackoverflow.com/questions/50530245/go-httpclient-memory-leaks", "title": "Go httpClient memory leaks", "body": "<p><strong>UPDATED CODE</strong></p>\n\n<p>Hi I have memory leaks in httpClient, i've added sync.WaitGroup and now I see that goroutine with httpClient don't closed. How to fix it?</p>\n\n<pre><code>func checkProxySOCKS(prox string, c chan QR, wg *sync.WaitGroup) (err error) {\n\ndefer wg.Done()\ndialer, _ := proxy.SOCKS5(\"tcp\", prox, nil, proxy.Direct)\n\ntimeout := time.Duration(2 * time.Second)\n\nhttpClient := &amp;http.Client{\n    Timeout: timeout,\n    Transport: &amp;http.Transport{\n        DisableKeepAlives: true,\n        Dial:              dialer.Dial,\n    },\n}\n\nres, err := httpClient.Get(\"https://telegram.org/\")\nif err != nil {\n\n    c &lt;- QR{Addr: prox, Res: false}\n    return\n}\n\ndefer res.Body.Close()\nio.Copy(ioutil.Discard, res.Body)\n\nc &lt;- QR{Addr: prox, Res: true}\n\nreturn nil\n</code></pre>\n\n<p>}\nHere i create goroutines</p>\n\n<pre><code>for _, proxy := range splitedProxies {\n    wg.Add(1)\n    go checkProxySOCKS(proxy, respChan, &amp;wg)\n}\n\nfor range splitedProxies {\n    wg.Add(1)\n    r := &lt;-respChan\n    if r.Res {\n        checkedProxiesArray = append(checkedProxiesArray, r.Addr)\n    }\n    wg.Done()\n}\n\nwg.Wait()\n</code></pre>\n"}, {"tags": ["arrays", "go", "go-ethereum", "geth"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1527252133, "post_id": 50529494, "comment_id": 88070624, "body": "<a href=\"https://golang.org/pkg/math/big/#Int.Bytes\" rel=\"nofollow noreferrer\"><code>Int.Bytes()</code></a> method?"}, {"owner": {"reputation": 1977, "user_id": 3461985, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/7117984bdaa3bbb4167960100304734e?s=128&d=identicon&r=PG&f=1", "display_name": "Kravitz", "link": "https://stackoverflow.com/users/3461985/kravitz"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1527252886, "post_id": 50529494, "comment_id": 88071101, "body": "so im using this now <code>phrase := sum.Bytes()</code> which does seem to convert the number to bytes, but im having issues reversing the process to get the original number back.. the original numbers type on return is not important, any idea how i can retrieve it"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1527252952, "post_id": 50529494, "comment_id": 88071148, "body": "<a href=\"https://golang.org/pkg/math/big/#Int.SetBytes\" rel=\"nofollow noreferrer\"><code>Int.SetBytes()</code></a> method. You really should start reading the docs."}, {"owner": {"reputation": 1977, "user_id": 3461985, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/7117984bdaa3bbb4167960100304734e?s=128&d=identicon&r=PG&f=1", "display_name": "Kravitz", "link": "https://stackoverflow.com/users/3461985/kravitz"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1527253581, "post_id": 50529494, "comment_id": 88071553, "body": "Tried to read them thats why im here. still no luck with that but thanks anyway"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1527253824, "post_id": 50529494, "comment_id": 88071708, "body": "@Kravitz: then please show what you&#39;ve tried using the correct methods  as shown in the documentation. <code>Bytes</code> and <code>SetBytes</code> do what you&#39;ve described."}, {"owner": {"reputation": 1977, "user_id": 3461985, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/7117984bdaa3bbb4167960100304734e?s=128&d=identicon&r=PG&f=1", "display_name": "Kravitz", "link": "https://stackoverflow.com/users/3461985/kravitz"}, "edited": false, "score": 0, "creation_date": 1527256085, "post_id": 50529494, "comment_id": 88073224, "body": "got it sorted with sum.String()"}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 6, "last_activity_date": 1527257780, "last_edit_date": 1527257780, "creation_date": 1527256577, "answer_id": 50530849, "question_id": 50529494, "link": "https://stackoverflow.com/questions/50529494/how-can-i-convert-a-big-int-into-a-byte-array-in-golang/50530849#50530849", "title": "How can I convert a *big.Int into a byte array in golang", "body": "<p>Try using <a href=\"https://golang.org/pkg/math/big/#Int.Bytes\" rel=\"noreferrer\"><code>Int.Bytes()</code></a> to get the byte array representation and <a href=\"https://golang.org/pkg/math/big/#Int.SetBytes\" rel=\"noreferrer\"><code>Int.SetBytes([]byte)</code></a> to set the value from a byte array. For example:</p>\n\n<pre><code>x := new(big.Int).SetInt64(123456)\nfmt.Printf(\"OK: x=%s (bytes=%#v)\\n\", x, x.Bytes())\n// OK: x=123456 (bytes=[]byte{0x1, 0xe2, 0x40})\n\ny := new(big.Int).SetBytes(x.Bytes())\nfmt.Printf(\"OK: y=%s (bytes=%#v)\\n\", y, y.Bytes())\n// OK: y=123456 (bytes=[]byte{0x1, 0xe2, 0x40})\n</code></pre>\n\n<p>Note that the byte array value of big numbers is a compact machine representation and should not be mistaken for the string value, which can be retrieved by the usual <code>String()</code> method (or <a href=\"https://golang.org/pkg/math/big/#Int.Text\" rel=\"noreferrer\"><code>Text(int)</code></a> for different bases) and set from a string value by the <a href=\"https://golang.org/pkg/math/big/#Int.SetString\" rel=\"noreferrer\"><code>SetString(...)</code></a> method:</p>\n\n<pre><code>a := new(big.Int).SetInt64(42)\na.String() // =&gt; \"42\"\n\nb, _ := new(big.Int).SetString(\"cafebabe\", 16)\nb.String() // =&gt; \"3405691582\"\nb.Text(16) // =&gt; \"cafebabe\"\nb.Bytes()  // =&gt; []byte{0xca, 0xfe, 0xba, 0xbe}\n</code></pre>\n"}], "owner": {"reputation": 1977, "user_id": 3461985, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/7117984bdaa3bbb4167960100304734e?s=128&d=identicon&r=PG&f=1", "display_name": "Kravitz", "link": "https://stackoverflow.com/users/3461985/kravitz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3983, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1527257780, "creation_date": 1527252077, "question_id": 50529494, "link": "https://stackoverflow.com/questions/50529494/how-can-i-convert-a-big-int-into-a-byte-array-in-golang", "title": "How can I convert a *big.Int into a byte array in golang", "body": "<p>Im trying to do calculations on a big int number and then convert the result to a byte array, but I cannot figure out how to do so this is where Im at so far. anyone got any ideas</p>\n\n<pre><code>sum := big.NewInt(0)\n\nfor _, num := range balances {\n    sum = sum.Add(sum, num)\n}\n\nfmt.Println(\"total: \", sum)\n\nphrase := []byte(sum)\nphraseLen := len(phrase)\npadNumber := 65 - phraseLen\n</code></pre>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1527248999, "post_id": 50528201, "comment_id": 88068617, "body": "What in <code>go doc net&#47;http.ServeMux</code> makes you think that this is doable? (It is not). Use ServMux as designed or use some other router."}, {"owner": {"reputation": 181, "user_id": 7247550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12fcb3987c868e139c010ba323adb80d?s=128&d=identicon&r=PG&f=1", "display_name": "ray", "link": "https://stackoverflow.com/users/7247550/ray"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1527251113, "post_id": 50528201, "comment_id": 88069918, "body": "The http.NewServeMux is a type of Handler, so I think it can."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1527250882, "creation_date": 1527250882, "answer_id": 50529127, "question_id": 50528201, "link": "https://stackoverflow.com/questions/50528201/put-http-newservemux-into-http-newservemux/50529127#50529127", "title": "Put http.NewServeMux into http.NewServeMux", "body": "<p>Your example doesn't work, because you used the <code>/index</code> path to register the \"outer\" handler, which is a single path (because it does not end with a slash <code>/</code>) and not a rooted subtree (that is, all paths starting with <code>/index/</code>). This is documented at <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"noreferrer\"><code>http.ServeMux</code></a>:</p>\n\n<blockquote>\n  <p>Patterns name fixed, rooted paths, like \"/favicon.ico\", or rooted subtrees, like \"/images/\" (note the trailing slash). Longer patterns take precedence over shorter ones, so that if there are handlers registered for both \"/images/\" and \"/images/thumbnails/\", the latter handler will be called for paths beginning \"/images/thumbnails/\" and the former will receive requests for any other paths in the \"/images/\" subtree.</p>\n</blockquote>\n\n<p>And also because the \"subrouter\" will not see a path like <code>\"/\"</code> or <code>\"/sub1\"</code> which you used to register handlers, but the <strong>full</strong> path, that is: <code>\"/index/\"</code> and <code>\"/index/sub1\"</code>.</p>\n\n<p>So what the main router should do is \"strip\" the <code>\"/index\"</code> prefix which is the path it was registered to (without the trailing slash). Fortunately, the standard lib has a ready-solution for this: <a href=\"https://golang.org/pkg/net/http/#StripPrefix\" rel=\"noreferrer\"><code>http.StripPrefix()</code></a>.</p>\n\n<p>So the working solution:</p>\n\n<pre><code>mux1 := http.NewServeMux()\nmux1.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    io.WriteString(w, \"sub index\")\n})\nmux1.HandleFunc(\"/sub1\", func(w http.ResponseWriter, r *http.Request) {\n    io.WriteString(w, \"sub 1\")\n})\n\nmux := http.NewServeMux()\nmux.Handle(\"/index/\", http.StripPrefix(\"/index\", mux1))\n\nhttp.ListenAndServe(\":8000\", mux)\n</code></pre>\n\n<p>Testing it:</p>\n\n<ul>\n<li><p>URL: <code>http://localhost:8000/index/</code><br>\nResponse: <code>sub index</code></p></li>\n<li><p>URL: <code>http://localhost:8000/index/sub1</code><br>\nResponse: <code>sub 1</code></p></li>\n</ul>\n"}], "owner": {"reputation": 181, "user_id": 7247550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12fcb3987c868e139c010ba323adb80d?s=128&d=identicon&r=PG&f=1", "display_name": "ray", "link": "https://stackoverflow.com/users/7247550/ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 600, "favorite_count": 0, "accepted_answer_id": 50529127, "answer_count": 1, "score": 0, "last_activity_date": 1527250882, "creation_date": 1527247820, "last_edit_date": 1527249068, "question_id": 50528201, "link": "https://stackoverflow.com/questions/50528201/put-http-newservemux-into-http-newservemux", "title": "Put http.NewServeMux into http.NewServeMux", "body": "<p>This is my code. I want to put mux1 as sub router into mux.Handle. Next, I run the code. I can visit path /index but I cannot visit path /index/sub1.\nI don't know why I can visit /index but I cannot visit /index/sub1?</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"net/http\"\n)\n\nfunc main() {\n    mux1 := http.NewServeMux()\n    mux1.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        io.WriteString(w, \"sub index\")\n    })\n    mux1.HandleFunc(\"/sub1\", func(w http.ResponseWriter, r *http.Request) {\n        io.WriteString(w, \"sub 1\")\n    })\n\n    mux := http.NewServeMux()\n    mux.Handle(\"/index\", mux1)\n\n    http.ListenAndServe(\":8000\", mux)\n}\n</code></pre>\n"}, {"tags": ["go", "sftp", "private-key"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1527248229, "post_id": 50527998, "comment_id": 88068133, "body": "The <a href=\"https://godoc.org/golang.org/x/crypto/ssh#ClientConfig\" rel=\"nofollow noreferrer\"><code>ClientConfig</code></a> (used by an SSH client instance) has the <code>Auth</code> field, which might contain 1 or more instances types representing different authentication methods. One of them is &quot;pubkey&quot; (which is what you need), and preparing an appropriate instance for it is covered by <a href=\"https://godoc.org/golang.org/x/crypto/ssh#AuthMethod\" rel=\"nofollow noreferrer\">this example</a>."}, {"owner": {"reputation": 1, "user_id": 9846426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c37a64da192d02fcec54b4b67038c96?s=128&d=identicon&r=PG&f=1", "display_name": "Rohit T", "link": "https://stackoverflow.com/users/9846426/rohit-t"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1527690735, "post_id": 50527998, "comment_id": 88224291, "body": "Thank you Kostix for your answer. That example link actually helped (referring to the example stated under func PublicKeys at the link you shared) and I was able to successfully connect to sftp server using keys with a little glitch. But it worked finally !  :)"}], "owner": {"reputation": 1, "user_id": 9846426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c37a64da192d02fcec54b4b67038c96?s=128&d=identicon&r=PG&f=1", "display_name": "Rohit T", "link": "https://stackoverflow.com/users/9846426/rohit-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 685, "favorite_count": 0, "closed_date": 1527250648, "answer_count": 0, "score": 0, "last_activity_date": 1527247423, "creation_date": 1527247062, "last_edit_date": 1527247423, "question_id": 50527998, "link": "https://stackoverflow.com/questions/50527998/connect-to-sftp-server-using-openssh-private-key", "closed_reason": "Duplicate", "title": "Connect to SFTP server using OpenSSH Private Key", "body": "<p>I am trying to connect to an SFTP server setup using <a href=\"https://hostedftp.com/\" rel=\"nofollow noreferrer\">https://hostedftp.com/</a>. Through the OS X terminal, I can connect to it using the command : <code>sftp -oHostKeyAlgorithms=+ssh-dss -i &lt;path_to_identity_file_or_private_key&gt; sftp_username@hostname</code></p>\n\n<p>When I try to achieve the same above operation using golang packages <strong>crypto/ssh</strong> and <strong>sftp</strong>, I cannot find a suitable example anywhere to connect using a private key. At all places, a relevant example has been given to connect to sftp server using a password.</p>\n\n<p>For reference, I have been trying to use almost the same code as on <a href=\"https://github.com/pkg/sftp/blob/master/examples/buffered-read-benchmark/main.go\" rel=\"nofollow noreferrer\">https://github.com/pkg/sftp/blob/master/examples/buffered-read-benchmark/main.go</a>, but no luck so far. I am unable to figure out on how to add private key to <strong>ssh.ClientConfig</strong> auth method.</p>\n\n<p>Looking for some help with a code sample that connect to sftp server using openssh private key (perhaps its byte array) using golang sftp or crypto/ssh package.</p>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1527245904, "post_id": 50527606, "comment_id": 88066700, "body": "Take a look at the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>encoding&#47;json</code></a> package."}], "answers": [{"comments": [{"owner": {"reputation": 4043, "user_id": 8342189, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/f40Rg.jpg?s=128&g=1", "display_name": "Philip Mutua", "link": "https://stackoverflow.com/users/8342189/philip-mutua"}, "edited": false, "score": 0, "creation_date": 1527343613, "post_id": 50532473, "comment_id": 88098264, "body": "Thanks, would it be appropriate if I took the JSON and converted it into Go struct by using this site <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/json-to-go</a>"}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 2, "last_activity_date": 1527261861, "creation_date": 1527261861, "answer_id": 50532473, "question_id": 50527606, "link": "https://stackoverflow.com/questions/50527606/how-to-convert-json-into-a-go-type-definition-when-consuming-an-api-in-go-lang/50532473#50532473", "title": "How to convert JSON into a Go type definition when consuming an API in GO lang", "body": "<p>Unfortunately, this data is poorly structured for easy unmarshaling via the golang JSON infrastructure.</p>\n\n<p>The general approach for unmarshaling data such as this example is to define a type (or set of types) which contain the structure you desire and implement the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>json.Unmarshaler</code> interface</a> with logic to inspect the incoming structure and populate the desired structs manually.</p>\n\n<p>For example:</p>\n\n<pre><code>type Quote struct {\n  Time                   string\n  Open, High, Low, Close float32\n  Volume                 int\n}\n\ntype Quotes []Quote\n\nfunc main() {\n  qs := Quotes{}\n  err := json.Unmarshal([]byte(jsonstr), &amp;qs)\n  if err != nil {\n    panic(err)\n  }\n  fmt.Printf(\"%#v\\n\", qs)\n}\n\nconst targetName = \"Time Series (1min)\"\n\nfunc (qs *Quotes) UnmarshalJSON(bs []byte) error {\n  // Unmarshal into a generic map\n  obj := make(map[string]interface{})\n  err := json.Unmarshal(bs, &amp;obj)\n  if err != nil {\n    return err\n  }\n\n  // Find the target time series\n  entries, ok := obj[targetName].(map[string]interface{})\n  if !ok {\n    return fmt.Errorf(\"cannot find entry with name %q\", targetName)\n  }\n\n  // Parse a Quote object from each entry in the target object\n  quotes := []Quote{}\n  for timestamp, values := range entries {\n    values, ok := values.(map[string]interface{})\n    if !ok {\n      return fmt.Errorf(\"value for %q is not an object\", timestamp)\n    }\n    quote := Quote{}\n    quote.Time = timestamp\n    v, err := strconv.ParseFloat(values[\"1. open\"].(string), 32)\n    if err != nil {\n      return err\n    }\n    quote.Open = float32(v)\n    // Repeat for each of Close,High,Low,Volume...\n    quotes = append(quotes, quote)\n  }\n\n  *qs = Quotes(quotes)\n  return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 4043, "user_id": 8342189, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/f40Rg.jpg?s=128&g=1", "display_name": "Philip Mutua", "link": "https://stackoverflow.com/users/8342189/philip-mutua"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 546, "favorite_count": 0, "accepted_answer_id": 50532473, "answer_count": 1, "score": -1, "last_activity_date": 1527343738, "creation_date": 1527245765, "last_edit_date": 1527343738, "question_id": 50527606, "link": "https://stackoverflow.com/questions/50527606/how-to-convert-json-into-a-go-type-definition-when-consuming-an-api-in-go-lang", "title": "How to convert JSON into a Go type definition when consuming an API in GO lang", "body": "<p>I am building a an application that consumes an API then also saves the json data to go lang structs then later I will make end points that will provide results for certain calculations. I have implemented consuming the API the challenging part is how to save the data in a way that go understands. Which is a proper approach?</p>\n\n<p>The following is the JSON format when I make a request. \nThe <code>key</code> I am interested in is only <strong><code>Time Series (1min)</code></strong></p>\n\n<h1>JSON</h1>\n\n<pre><code>{\n    \"Meta Data\": {\n        \"1. Information\": \"Intraday (1min) prices and volumes\",\n        \"2. Symbol\": \"MSFT\",\n        \"3. Last Refreshed\": \"2018-05-24 16:00:00\",\n        \"4. Interval\": \"1min\",\n        \"5. Output Size\": \"Compact\",\n        \"6. Time Zone\": \"US/Eastern\"\n    },\n    \"Time Series (1min)\": {\n        \"2018-05-24 16:00:00\": {\n            \"1. open\": \"98.3050\",\n            \"2. high\": \"98.3600\",\n            \"3. low\": \"98.2500\",\n            \"4. close\": \"98.3100\",\n            \"5. volume\": \"2377114\"\n        },\n        \"2018-05-24 15:59:00\": {\n            \"1. open\": \"98.2900\",\n            \"2. high\": \"98.3300\",\n            \"3. low\": \"98.2900\",\n            \"4. close\": \"98.3000\",\n            \"5. volume\": \"137133\"\n        },\n        \"2018-05-24 15:58:00\": {\n            \"1. open\": \"98.2900\",\n            \"2. high\": \"98.3000\",\n            \"3. low\": \"98.2600\",\n            \"4. close\": \"98.2900\",\n            \"5. volume\": \"135875\"\n        },\n        \"2018-05-24 15:53:00\": {\n            \"1. open\": \"98.2750\",\n            \"2. high\": \"98.2950\",\n            \"3. low\": \"98.2600\",\n            \"4. close\": \"98.2700\",\n            \"5. volume\": \"77959\"\n        }\n    }\n}\n</code></pre>\n\n<h1>code</h1>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"github.com/jmoiron/jsonq\"\n)\n\nfunc main() {\n    response, err := http.Get(\"https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&amp;symbol=MSFT&amp;interval=1min&amp;apikey=demo\")\n    if err != nil {\n        fmt.Printf(\"The HTTP request failed with error %s\\n\", err)\n    } else {\n        data, _ := ioutil.ReadAll(response.Body)\n        // fmt.Println(string(data))\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "vim", "settings", "neovim"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527244539, "post_id": 50527039, "comment_id": 88065903, "body": "Did you install <code>guru</code> and <code>gogetdoc</code>?"}, {"owner": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1527244616, "post_id": 50527039, "comment_id": 88065953, "body": "Yes. vim-go after start command :GoInstallBinaries - install all binaries to GOPATH/bin and i see <a href=\"https://github.com/fatih/vim-go/blob/32ae8640716530bd55062379177da51efb37dfd2/autoload/go/util.vim#L140\" rel=\"nofollow noreferrer\">github.com/fatih/vim-go/blob/&hellip;</a> library how i understand use /bin/sh by default"}], "answers": [{"comments": [{"owner": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "edited": false, "score": 0, "creation_date": 1527260886, "post_id": 50531542, "comment_id": 88076311, "body": "i know, and i use zsh. But problem, why vim-go write: vim-go: /bin/sh: 1: guru: not found - why /bin/sh?????"}, {"owner": {"reputation": 394, "user_id": 4794989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kl1aC.jpg?s=128&g=1", "display_name": "Alireza Bashiri", "link": "https://stackoverflow.com/users/4794989/alireza-bashiri"}, "reply_to_user": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "edited": false, "score": 0, "creation_date": 1528528907, "post_id": 50531542, "comment_id": 88551218, "body": "maybe the underlying script uses #!/bin/sh shebang."}], "tags": [], "owner": {"reputation": 394, "user_id": 4794989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kl1aC.jpg?s=128&g=1", "display_name": "Alireza Bashiri", "link": "https://stackoverflow.com/users/4794989/alireza-bashiri"}, "is_accepted": false, "score": 0, "last_activity_date": 1527258646, "creation_date": 1527258646, "answer_id": 50531542, "question_id": 50527039, "link": "https://stackoverflow.com/questions/50527039/vim-go-doesnt-find-need-libraries/50531542#50531542", "title": "vim-go doesn&#39;t find need libraries", "body": "<blockquote>\n  <p>i set correct path in .bashrc to my GOPATH.</p>\n</blockquote>\n\n<p><code>zsh</code> doesn't use .bashrc use <code>.zshrc</code> instead.</p>\n"}, {"tags": [], "owner": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "is_accepted": false, "score": 0, "last_activity_date": 1527366814, "creation_date": 1527366814, "answer_id": 50546776, "question_id": 50527039, "link": "https://stackoverflow.com/questions/50527039/vim-go-doesnt-find-need-libraries/50546776#50546776", "title": "vim-go doesn&#39;t find need libraries", "body": "<p>Be a long time to laugh, but I had to restart the computer ......frenzy....</p>\n"}], "owner": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 419, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1527366814, "creation_date": 1527243893, "last_edit_date": 1527244511, "question_id": 50527039, "link": "https://stackoverflow.com/questions/50527039/vim-go-doesnt-find-need-libraries", "title": "vim-go doesn&#39;t find need libraries", "body": "<p>I install neovim and bigin to setup. I install vim-go and after execute :GoInstallBinaries, and all need libraries installed to my GOPATH, all good. But result command in vim <code>:GoDef, :GoDoc:</code> - give me msg:</p>\n\n<pre><code>vim-go: /bin/sh: 1: guru: not found\nvim-go: /bin/sh: 1: gogetdoc: not found\n</code></pre>\n\n<p>I use zsh, not standart shell(zsh default shell), i try write <code>set shell=$SHELL</code> and <code>set shell=/bin/zsh</code> in my vimrc and init.vim file - no \neffect and i set correct path in .bashrc to my GOPATH.\nI think problem with vim-go which use /bin/sh, may by. Any ideas? And very strange vim-go install libraries to GOPATH, but does\u044dt find them there\nThank you!</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527253184, "post_id": 50525530, "comment_id": 88071286, "body": "<i>Questions asking us to recommend or find a book, tool, software library, tutorial or other off-site resource are off-topic for Stack Overflow as they tend to attract opinionated answers and spam.</i>"}], "answers": [{"tags": [], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "is_accepted": true, "score": 1, "last_activity_date": 1527242021, "creation_date": 1527242021, "answer_id": 50526393, "question_id": 50525530, "link": "https://stackoverflow.com/questions/50525530/go-library-to-map-json-keys-to-clean-up-output/50526393#50526393", "title": "Go library to map json keys to clean up output", "body": "<p>The short answer is not really, due to the way Go handles JSON marshalling and un-marshalling. The common pattern for dealing with your use case is just to define a Response struct. </p>\n\n<p>A classic example would be something like the following:</p>\n\n<pre><code>type User struct {\n   // fields\n}\n\n// Response type used when the user is asking about their own fields\ntype PrivateUserResponse struct {\n   // fields with struct tags\n}\n\nfunc (u *User) ToPrivateUserResponse() *PrivateUserResponse { ... } \n\n// Response type used when the user is being listed in a public directory\ntype PublicUserResponse struct {\n    // fields with struct tags\n}\n\nfunc (u *User) ToPublicUserResponse() *PublicUserResponse { ... } \n</code></pre>\n\n<p>Because JSON key configuration is handled by struct tags, a library would be ill-suited to handle the unique business logic cases that arise in dealing with this problem. You might be able to find a code generator that solves this in a more generic way, but I'd recommend just writing the structs yourself - Go favors explicit and clear behavior. </p>\n"}], "owner": {"reputation": 457, "user_id": 4489733, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/10714df646d369c5a41225156d051cac?s=128&d=identicon&r=PG&f=1", "display_name": "mbudge", "link": "https://stackoverflow.com/users/4489733/mbudge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 50526393, "answer_count": 1, "score": -2, "last_activity_date": 1527242021, "creation_date": 1527239370, "question_id": 50525530, "link": "https://stackoverflow.com/questions/50525530/go-library-to-map-json-keys-to-clean-up-output", "title": "Go library to map json keys to clean up output", "body": "<p>Are there any Go libraries which can tidy up Json output before it is sent to users?</p>\n\n<p>We could unmarshall into a struct and do this manually, but we would like to know if there are any libraries which can make it easier to extract keys into the struct, which we could Marshall and send to the user?  </p>\n"}, {"tags": ["google-app-engine", "go", "image-processing", "image-uploading"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1527239441, "post_id": 50525368, "comment_id": 88062854, "body": "What is your question?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1527242295, "post_id": 50525368, "comment_id": 88064598, "body": "&#171;I need to use this method to read the request into a io.Pipe and then stream it on the fly to my image processing service&#187;\u2014so please go on and implement exactly this, as stated. What is your problem? Unfortunately, this really sounds like what is covered by <a href=\"https://whathaveyoutried.com\" rel=\"nofollow noreferrer\">this classic essay</a>."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 5157307, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0W8WvVRrvqA/AAAAAAAAAAI/AAAAAAAAAN8/KzUvZv09aFs/photo.jpg?sz=128", "display_name": "Steven Lee", "link": "https://stackoverflow.com/users/5157307/steven-lee"}, "is_accepted": false, "score": 0, "last_activity_date": 1529216923, "creation_date": 1529216923, "answer_id": 50894257, "question_id": 50525368, "link": "https://stackoverflow.com/questions/50525368/handling-a-large-file-upload-with-io-pipe-on-the-server-side/50894257#50894257", "title": "Handling a large file upload with &quot;io.Pipe&quot; on the server side", "body": "<p>Somewhat reluctant to answer this as i'm not sure what the exact problem is or what you have tried.</p>\n\n<p>But this is just a streaming http read.</p>\n\n<p>A http.Request actually holds the request body in a io.ReadCloser. This means that standard io.Reader implementations can stream this.</p>\n\n<p>What you need to do is create a function that processes your data.</p>\n\n<pre><code>func process(r io.Reader) {\n    // do something\n}\n</code></pre>\n\n<p>then you can read it from the http handler</p>\n\n<pre><code>func(w http.ResponseWriter, r *http.Request) {\n    process(r.Body)\n}\n</code></pre>\n\n<p>Without knowing your exact question or what you need help with I cannot elaborate further.</p>\n"}], "owner": {"reputation": 1, "user_id": 6076779, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6NNJ8.jpg?s=128&g=1", "display_name": "Valentin", "link": "https://stackoverflow.com/users/6076779/valentin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 203, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1530009744, "creation_date": 1527238929, "last_edit_date": 1530009744, "question_id": 50525368, "link": "https://stackoverflow.com/questions/50525368/handling-a-large-file-upload-with-io-pipe-on-the-server-side", "title": "Handling a large file upload with &quot;io.Pipe&quot; on the server side", "body": "<p>As part of my learning process I recently started a new challenge to create a photomosaics  web app with golang. Since I am planning on hosting it on App Engine I divided it into 2 services: 1 to handle image uploads and the other to handle image processing. What I want to accomplish here is to start processing the image as soon as the first bytes are received. While doing my research I came across this gist <a href=\"https://gist.github.com/cryptix/9dd094008b6236f4fc57\" rel=\"nofollow noreferrer\">cryptix/client.go</a>. I need to use this method to read the request into a io.Pipe and then stream it on the fly to my image processing service and none of my googling helped: all there is to see is a GO client sending files while I want a Go server receiving files.</p>\n\n<p><strong>NOTE</strong>:</p>\n\n<ul>\n<li>The two services are communicating via HTTP.</li>\n<li>I am using the REST pattern(No html form: Testing with POSTMAN).</li>\n<li>Concrete examples are most welcome.</li>\n<li>Please don't frown this is my first stackoverflow question.</li>\n</ul>\n"}, {"tags": ["go", "connection", "buffer", "slice"], "answers": [{"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 0, "last_activity_date": 1527240255, "creation_date": 1527240255, "answer_id": 50525797, "question_id": 50525268, "link": "https://stackoverflow.com/questions/50525268/incorrect-data-re-transmisson/50525797#50525797", "title": "Incorrect data re-transmisson", "body": "<p>In <code>handleConnection</code>, you always write 1024 bytes, no matter what <code>conn1.Read</code> returns.</p>\n\n<p>You want to write the data like this:</p>\n\n<pre><code>conn2.Write(input[:n])\n</code></pre>\n\n<p>You should also check your top-level <code>for</code> loop. Are you sure you're not accepting multiple connections and smushing them all together? I'd sprinkle in some log statements so you can see when connections are made and closed.</p>\n\n<p>Another (probably inconsequential) mistake, is that you treat <code>n==0</code> as a termination condition. <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\">In the documentation of <code>io.Reader</code></a> it's recommended that you ignore <code>n==0, err==nil</code>. Without checking the code I can't be sure, but I expect that <code>conn.Read</code> never returns <code>n==0, err==nil</code>, so it's unlikely that this is causing you trouble.</p>\n\n<p>Although it doesn't affect correctness, you could also lift the definition of <code>input</code> out of the loop so that it's reused on each iteration; it's likely to reduce the amount of work the garbage collector has to do.</p>\n"}], "owner": {"reputation": 3, "user_id": 8330411, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-d6TWr3S0H68/AAAAAAAAAAI/AAAAAAAAAE0/IYqRPql2JN0/photo.jpg?sz=128", "display_name": "Nikita Plinsky", "link": "https://stackoverflow.com/users/8330411/nikita-plinsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25, "favorite_count": 0, "accepted_answer_id": 50525797, "answer_count": 1, "score": 0, "last_activity_date": 1527240255, "creation_date": 1527238554, "last_edit_date": 1527240218, "question_id": 50525268, "link": "https://stackoverflow.com/questions/50525268/incorrect-data-re-transmisson", "title": "Incorrect data re-transmisson", "body": "<p>I need my program to be in the middle of the connection and transfer data correctly in both directions. I wrote this code, but it does not work properly</p>\n\n<pre><code>package main\n\n    import (\n        \"fmt\"\n        \"net\"\n)\n\nfunc main() {\n    listener, err := net.Listen(\"tcp\", \":8120\")\n\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer listener.Close()\n    fmt.Println(\"Server is listening...\")\n    for {\n        var conn1, conn2 net.Conn\n        var err error\n        conn1, err = listener.Accept()\n        if err != nil {\n            fmt.Println(err)\n            conn1.Close()\n            continue\n        }\n        conn2, err = net.Dial(\"tcp\", \"185.151.245.51:80\")\n        if err != nil {\n            fmt.Println(err)\n            conn2.Close()\n            continue\n        }\n        go handleConnection(conn1, conn2)\n        go handleConnection(conn2, conn1)\n    }\n}\n\nfunc handleConnection(conn1, conn2 net.Conn) {\n    defer conn1.Close()\n    for {\n        input := make([]byte, 1024)\n        n, err := conn1.Read(input)\n        if n == 0 || err != nil {\n            break\n        }\n        conn2.Write([]byte(input))\n    }\n}\n</code></pre>\n\n<p>The problem is that the data is corrupted, \nfor example. \n<a href=\"https://i.stack.imgur.com/1COmg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1COmg.png\" alt=\"enter image description here\"></a>\nLeft one is original, right one is what i got.\nEnd of the final gotten file is unreadable.\n<a href=\"https://i.stack.imgur.com/PI49K.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PI49K.png\" alt=\"enter image description here\"></a>\nBut at the beginnig everything is ok.\nI tried to change input slice size. If size > 0 and &lt; 8, everything is fine, but slow. If i set input size very large, corruption of data become more awful.\nWhat I'm doing wrong?</p>\n"}, {"tags": ["go", "synchronization", "channel", "goroutine"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1527237595, "post_id": 50524859, "comment_id": 88061790, "body": "You&#39;ve included a ton of code. Please simplify to an <a href=\"https://stackoverflow.com/help/mcve\">MVCE</a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527253355, "post_id": 50524859, "comment_id": 88071412, "body": "This is <i>two hundred forty lines</i> of source. That&#39;s an order of magnitude more than should be in an SO question. Perhaps you were looking for <a href=\"https://codereview.stackexchange.com/\">codereview.SE</a>?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527253392, "post_id": 50524859, "comment_id": 88071432, "body": "<i>Questions seeking debugging help (&quot;why isn&#39;t this code working?&quot;) must include the desired behavior, a specific problem or error and the <b>shortest code necessary to reproduce it</b> in the question itself.</i>"}, {"owner": {"reputation": 1, "user_id": 9841470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd7f4a82fd2df6f8d808134a6295c9ad?s=128&d=identicon&r=PG&f=1", "display_name": "jerryL", "link": "https://stackoverflow.com/users/9841470/jerryl"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1527263105, "post_id": 50524859, "comment_id": 88077486, "body": "Hello @Adrian, I am new to stackoverflow and sorry for violating some rules related with asking question, I just streamlined the code and rewrite question, can you take a look at it again? :-)"}], "answers": [{"tags": [], "owner": {"reputation": 23, "user_id": 9441365, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/750020eca140eb8c3f2b6c266f507be6?s=128&d=identicon&r=PG&f=1", "display_name": "offvw", "link": "https://stackoverflow.com/users/9441365/offvw"}, "is_accepted": false, "score": 0, "last_activity_date": 1527605379, "last_edit_date": 1527605379, "creation_date": 1527421606, "answer_id": 50551802, "question_id": 50524859, "link": "https://stackoverflow.com/questions/50524859/goroutine-started-but-not-executed-or-partially-executed-even-if-using-waitgroup/50551802#50551802", "title": "Goroutine started but not executed or partially executed even if using WaitGroup to synchronize", "body": "<p>I think your problem is just assigning a value to Nil. Don't assign a Nil pointer in every place.</p>\n\n<p><a href=\"https://play.golang.org/p/VkG6JCYEC7j\" rel=\"nofollow noreferrer\">Code Here</a></p>\n"}], "owner": {"reputation": 1, "user_id": 9841470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd7f4a82fd2df6f8d808134a6295c9ad?s=128&d=identicon&r=PG&f=1", "display_name": "jerryL", "link": "https://stackoverflow.com/users/9841470/jerryl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1527661523, "creation_date": 1527237127, "last_edit_date": 1527661523, "question_id": 50524859, "link": "https://stackoverflow.com/questions/50524859/goroutine-started-but-not-executed-or-partially-executed-even-if-using-waitgroup", "title": "Goroutine started but not executed or partially executed even if using WaitGroup to synchronize", "body": "<p>I ran into a weird problem when using data received through channel from another goroutine to start multiple goroutines to reverse linked list simultaneously, which has troubled me for many days, I just want to split list into a couple of sublist without break link and then respectively start goroutine to reverse it, but I always get runtime error as below output shows when running code, I really don't know how to fix it after I tried many changes but still got the same error, can someone point out the problem or give me advice? any help you can give is welcome and appreciated, It would be nice if you can provide improved code, thanks in advance!</p>\n\n<p><strong>UPDATE: the problem was caused by memory corruption due to data race, it has been solved by using read-write lock!</strong></p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport \"sync\"\n\ntype node struct {\n    data int\n    next *node\n}\n\ntype LinkedList struct {\n    head *node\n    size int\n}\n\ntype splitResult struct {\n    beforeHead, head, tail *node\n}\n\nfunc splitList(head *node, sizoflst, sizofsublst int) &lt;-chan *splitResult {\n    nGoroutines := sizoflst / sizofsublst\n    if sizoflst &lt; sizofsublst {\n        nGoroutines++\n    } else {\n        if (sizoflst % sizofsublst) &gt;= 6 {\n            nGoroutines++\n        }\n    }\n    ch := make(chan *splitResult, nGoroutines)\n    go func() {\n        defer close(ch)\n        var beforeHead *node\n        tail := head\n        ct := 0\n        for i := 0; i &lt; nGoroutines; i++ {\n            for ct &lt; sizofsublst-1 &amp;&amp; tail.next != nil {\n                tail = tail.next\n                ct++\n            }\n            if i == nGoroutines-1 {\n                testTail := tail\n                for testTail.next != nil {\n                    testTail = testTail.next\n                }\n                ch &lt;- &amp;splitResult{beforeHead, head, testTail}\n                break\n            }\n            ch &lt;- &amp;splitResult{beforeHead, head, tail}\n            beforeHead = tail\n            head = tail.next\n            tail = head\n            ct = 0\n        }\n    }()\n    return ch\n}\n\nfunc reverse(split *splitResult, ln **node, wg *sync.WaitGroup) {\n    defer wg.Done()\n    move := split.head\n    prev := split.beforeHead\n    if split.tail.next == nil {\n        *ln = split.tail\n    }\n    for move != split.tail.next {\n        temp := move.next\n        move.next = prev\n        prev = move\n        move = temp\n    }\n}\n\nfunc (ll *LinkedList) Reverse(sizofsublst int) {\n    var lastNode *node\n    var wg sync.WaitGroup\n    if ll.head == nil || ll.head.next == nil {\n        return\n    }\n    splitCh := splitList(ll.head, ll.size, sizofsublst)\n    for split := range splitCh {\n        wg.Add(1)\n        go reverse(split, &amp;lastNode, &amp;wg)\n    }\n    wg.Wait()\n    ll.head = lastNode\n}\n\nfunc (ll *LinkedList) Insert(data int) {\n    newNode := new(node)\n    newNode.data = data\n    newNode.next = ll.head\n    ll.head = newNode\n    ll.size++\n}\n\nfunc main() {\n    ll := &amp;LinkedList{}\n    sli := []int{19, 30, 7, 23, 24, 0, 12, 28, 3, 11, 18, 1, 31, 14, 21, 2, 9, 16, 4, 26, 10, 25}\n    for _, v := range sli {\n        ll.Insert(v)\n    }\n    ll.Reverse(8)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x8 pc=0x458db5]\n\ngoroutine 21 [running]:\nmain.reverse(0xc4200820a0, 0xc420096000, 0xc420098000)\n        /home/user/go/src/local/stackoverflow/tmp.go:69 +0x75\ncreated by main.(*LinkedList).Reverse\n        /home/user/go/src/local/stackoverflow/tmp.go:85 +0x104\n</code></pre>\n"}, {"tags": ["go", "abstract-syntax-tree"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1527240172, "last_edit_date": 1527240172, "creation_date": 1527239089, "answer_id": 50525439, "question_id": 50524607, "link": "https://stackoverflow.com/questions/50524607/go-lang-func-parameter-type/50525439#50525439", "title": "Go lang func parameter type", "body": "<p>You're on the right track, <code>FuncType.Params</code> is the (incoming) parameter list of the function. Its <code>List</code> field holds all the parameters, which are of type <a href=\"https://golang.org/pkg/go/ast/#Field\" rel=\"nofollow noreferrer\"><code>ast.Field</code></a>:</p>\n\n<pre><code>type Field struct {\n        Doc     *CommentGroup // associated documentation; or nil\n        Names   []*Ident      // field/method/parameter names; or nil if anonymous field\n        Type    Expr          // field/method/parameter type\n        Tag     *BasicLit     // field tag; or nil\n        Comment *CommentGroup // line comments; or nil\n}\n</code></pre>\n\n<p>The <code>Field.Type</code> holds the type of the parameter which is an interface type <a href=\"https://golang.org/pkg/go/ast/#Expr\" rel=\"nofollow noreferrer\"><code>ast.Expr</code></a> with simply embeds the <a href=\"https://golang.org/pkg/go/ast/#Node\" rel=\"nofollow noreferrer\"><code>ast.Node</code></a> which only provides you the start and end position of the type in the source. Basically this should be enough to get the text representation of the type.</p>\n\n<p>Let's see a simple example. We will analyze this function:</p>\n\n<pre><code>func myfunc(i int, s string, err error, pt image.Point, x []float64) {}\n</code></pre>\n\n<p>And the code to print its parameters, including type names:</p>\n\n<pre><code>src := `package xx\nfunc myfunc(i int, s string, err error, pt image.Point, x []float64) {}`\n\nfset := token.NewFileSet()\nf, err := parser.ParseFile(fset, \"src.go\", src, 0)\nif err != nil {\n    panic(err)\n}\noffset := f.Pos()\n\nast.Inspect(f, func(n ast.Node) bool {\n    if fd, ok := n.(*ast.FuncDecl); ok {\n        fmt.Printf(\"Function: %s, parameters:\\n\", fd.Name)\n        for _, param := range fd.Type.Params.List {\n            fmt.Printf(\"  Name: %s\\n\", param.Names[0])\n            fmt.Printf(\"    ast type          : %T\\n\", param.Type)\n            fmt.Printf(\"    type desc         : %+v\\n\", param.Type)\n            fmt.Printf(\"    type name from src: %s\\n\",\n                src[param.Type.Pos()-offset:param.Type.End()-offset])\n        }\n    }\n    return true\n})\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/IgUkPRJwb5l\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Function: myfunc, parameters:\n  Name: i\n    ast type          : *ast.Ident\n    type desc         : int\n    type name from src: int\n  Name: s\n    ast type          : *ast.Ident\n    type desc         : string\n    type name from src: string\n  Name: err\n    ast type          : *ast.Ident\n    type desc         : error\n    type name from src: error\n  Name: pt\n    ast type          : *ast.SelectorExpr\n    type desc         : &amp;{X:image Sel:Point}\n    type name from src: image.Point\n  Name: x\n    ast type          : *ast.ArrayType\n    type desc         : &amp;{Lbrack:71 Len:&lt;nil&gt; Elt:float64}\n    type name from src: []float64\n</code></pre>\n"}], "owner": {"reputation": 371, "user_id": 4051774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b982c02454a9d3e76fa62730f6239681?s=128&d=identicon&r=PG&f=1", "display_name": "Pavel", "link": "https://stackoverflow.com/users/4051774/pavel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1571, "favorite_count": 0, "accepted_answer_id": 50525439, "answer_count": 1, "score": 4, "last_activity_date": 1527240172, "creation_date": 1527236288, "last_edit_date": 1527237271, "question_id": 50524607, "link": "https://stackoverflow.com/questions/50524607/go-lang-func-parameter-type", "title": "Go lang func parameter type", "body": "<p>I am trying to find func parameter type and its name to generate some code. \nI am using <code>ast</code> package for it.\nI've found parameter name, but I can't find parameter type name.</p>\n\n<pre><code>for _, fun := range findFunc(node) { //ast.FuncDecl\n\n    if  fun.Recv != nil {\n        for _, field := range fun.Type.Params.List {\n            for _, name := range field.Names {\n                println(name.Name)  //Func field name\n                //How to find field type name here?\n            }\n\n        }\n    }\n\n}\n</code></pre>\n"}, {"tags": ["go", "synchronization"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1527235474, "post_id": 50524165, "comment_id": 88060604, "body": "It does not happen always. Your statement has no proof. I tried it, and was able to &quot;squeeze&quot; a run where it printed <code>&quot;works&quot;</code>. This question as-is doesn&#39;t seem very thoughtful. P.S. The Go Playground caches the output and does not run the code again. I tested it locally."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 4413696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47bc28df6fcff2d2e4fb4c428573a9f2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Litvinov", "link": "https://stackoverflow.com/users/4413696/anton-litvinov"}, "edited": false, "score": 0, "creation_date": 1527257458, "post_id": 50527626, "comment_id": 88074153, "body": "So this is a write-preferring RW lock. Am I right ?"}, {"owner": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "reply_to_user": {"reputation": 73, "user_id": 4413696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47bc28df6fcff2d2e4fb4c428573a9f2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Litvinov", "link": "https://stackoverflow.com/users/4413696/anton-litvinov"}, "edited": false, "score": 0, "creation_date": 1527337862, "post_id": 50527626, "comment_id": 88096753, "body": "I guess, you are."}], "tags": [], "owner": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "is_accepted": true, "score": 1, "last_activity_date": 1527246429, "last_edit_date": 1527246429, "creation_date": 1527245855, "answer_id": 50527626, "question_id": 50524165, "link": "https://stackoverflow.com/questions/50524165/unobvious-deadlock-situation/50527626#50527626", "title": "Unobvious deadlock situation", "body": "<p>From the RWMutex doc:</p>\n\n<blockquote>\n  <p>If a goroutine holds a RWMutex for reading and another goroutine might\n  call Lock, <strong>no goroutine should expect to be able to acquire a read\n  lock until the initial read lock is released</strong>. In particular, this\n  prohibits recursive read locking. This is to ensure that the lock\n  eventually becomes available; a blocked Lock call excludes new readers\n  from acquiring the lock.</p>\n</blockquote>\n\n<p>So what's going on in your code when deadlock occurs:</p>\n\n<ol>\n<li>first RLock()</li>\n<li>Lock() // this call waits until first Rlock()  released and blocks calls to future Rlocks()</li>\n<li>Rlock() // this call waits until Lock() is released</li>\n</ol>\n"}], "owner": {"reputation": 73, "user_id": 4413696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47bc28df6fcff2d2e4fb4c428573a9f2?s=128&d=identicon&r=PG&f=1", "display_name": "Anton Litvinov", "link": "https://stackoverflow.com/users/4413696/anton-litvinov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 50527626, "answer_count": 1, "score": -3, "last_activity_date": 1527258260, "creation_date": 1527234778, "last_edit_date": 1527258260, "question_id": 50524165, "link": "https://stackoverflow.com/questions/50524165/unobvious-deadlock-situation", "title": "Unobvious deadlock situation", "body": "<p>Could you please explain why this deadlock happens ?</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    \"fmt\"\n    \"runtime\"\n)\n\nfunc main() {\n    m := sync.RWMutex{}\n    go func(){\n        m.RLock()\n        runtime.Gosched()\n        m.RLock()\n        m.RUnlock()\n        m.RUnlock()\n    }()\n\n    runtime.Gosched()\n    m.Lock()\n    m.Unlock()\n\n    fmt.Println(\"works\")\n}\n</code></pre>\n\n<p>It's non obvious to me why this deadlock <del>always</del> mostly happen. <del>Could this be a quirk of the scheduler ?</del></p>\n"}]