[{"tags": ["inheritance", "rust", "multiple-inheritance"], "comments": [{"owner": {"reputation": 7882, "user_id": 2722968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d0a9ce812892f03b8342c5a60be24632?s=128&d=identicon&r=PG&f=1", "display_name": "user2722968", "link": "https://stackoverflow.com/users/2722968/user2722968"}, "edited": false, "score": 1, "creation_date": 1559169878, "post_id": 56368890, "comment_id": 99341447, "body": "This is not possible in Rust. Either a type impls a trait (and then there is no ambiguity regarding which trait a method comes from) or it doesn&#39;t. You could have a trait <code>Authentication</code> with methods <code>authenticate_oath</code>, <code>authenticate_pam</code> etc., have their default implementation return <code>Err(AuthenticationError::NotImplemented)</code>, and have the <code>Authenticator</code> try each method in sequence."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559170180, "post_id": 56368890, "comment_id": 99341527, "body": "<i>I&#39;d call <code>super</code> to check the <code>super</code> method</i> \u2014 I guarantee you that there&#39;s a better way of writing this in Python that doesn&#39;t use inheritance. Once you figure that out, you can probably write that in Rust."}, {"owner": {"reputation": 11934, "user_id": 54606, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e7de961282b156410426c657342ef466?s=128&d=identicon&r=PG", "display_name": "Lo&#239;c Faure-Lacroix", "link": "https://stackoverflow.com/users/54606/lo%c3%afc-faure-lacroix"}, "reply_to_user": {"reputation": 7882, "user_id": 2722968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d0a9ce812892f03b8342c5a60be24632?s=128&d=identicon&r=PG&f=1", "display_name": "user2722968", "link": "https://stackoverflow.com/users/2722968/user2722968"}, "edited": false, "score": 0, "creation_date": 1559173080, "post_id": 56368890, "comment_id": 99342143, "body": "@user2722968 yes but how do you call each method in sequence if you don&#39;t know how they&#39;re called? Also that could work for auth but in other cases, I need to compose the result of the super call."}, {"owner": {"reputation": 11934, "user_id": 54606, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e7de961282b156410426c657342ef466?s=128&d=identicon&r=PG", "display_name": "Lo&#239;c Faure-Lacroix", "link": "https://stackoverflow.com/users/54606/lo%c3%afc-faure-lacroix"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559173258, "post_id": 56368890, "comment_id": 99342177, "body": "@Shepmaster care to elaborate? This was an example but there are cases I need to compose the result of the super call. For example a method that create some default data. One module add certain default while an other module add other default. The method would be called like <code>prepare_data</code> and each module combine its own data with the result of the super call."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559173641, "post_id": 56368890, "comment_id": 99342258, "body": "@Lo&#239;cFaure-Lacroix that doesn&#39;t require inheritance, just a vector of things that are called in sequence. I cannot elaborate because your question is overly broad. You are likely suffering from the <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY problem</a> and you&#39;ve described how you think you should solve it as opposed to focusing on what your end goal is. There&#39;s not enough crumbs of context for me to even begin to speculate."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559173714, "post_id": 56368890, "comment_id": 99342277, "body": "For example, if you ask &quot;how do I have a superclass in Rust?&quot; the answer will be &quot;you can&#39;t&quot;. If you ask about solving the problem and clearly describe that problem, then we might be able to point towards solutions."}, {"owner": {"reputation": 11934, "user_id": 54606, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e7de961282b156410426c657342ef466?s=128&d=identicon&r=PG", "display_name": "Lo&#239;c Faure-Lacroix", "link": "https://stackoverflow.com/users/54606/lo%c3%afc-faure-lacroix"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559178259, "post_id": 56368890, "comment_id": 99343163, "body": "@Shepmaster concrete enough now?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559221808, "post_id": 56368890, "comment_id": 99358122, "body": "You mean <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f935570a48015cb09da2bb50f7e8f410\" rel=\"nofollow noreferrer\">like this</a>?"}], "owner": {"reputation": 11934, "user_id": 54606, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e7de961282b156410426c657342ef466?s=128&d=identicon&r=PG", "display_name": "Lo&#239;c Faure-Lacroix", "link": "https://stackoverflow.com/users/54606/lo%c3%afc-faure-lacroix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 114, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1559221022, "creation_date": 1559165994, "last_edit_date": 1559221022, "question_id": 56368890, "link": "https://stackoverflow.com/questions/56368890/how-do-i-implement-multiple-traits-for-one-type-and-choose-between-the-traits", "title": "How do I implement multiple traits for one type and choose between the traits?", "body": "<p>How would you typically handle something like this in Rust?</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>class Base(Model):\n    def do_something(self, x):\n        return {\"base\": x * 2}\n\nclass A(Model):\n    extend = Base\n    def do_something(self, x):\n        res = super(A, self).do_something()\n        res['test'] = x\n        return res\n\nclass B(Model):\n    extend = Base\n    def do_something(self, x):\n        if x &gt; 5:\n            res = super(B, self).do_something()\n        else:\n            res = {}\n        return res\n\nobj = Base()\nobj.do_something(1)\n&gt;&gt; {}\nobj.do_something(6)\n&gt;&gt; {'test': 6, 'base': 12}\n</code></pre>\n\n<p>In Python, I'd have something like that where the <code>Base</code> class is continuously extended using a metaclass. You always use the <code>Base</code> class and the other ones are just syntactic sugar to extend the <code>Base</code> class.</p>\n\n<p>As you can see, in the body of <code>B.do_something</code> the order in which the methods are called is controlled by the body of the function and not in sequence so it's not possible to simply store a list of functions and then call them in sequence. </p>\n\n<p>In Python, most of the logic is hidden behind a metaclass but the idea is to offer a single place for an extension developer adding methods to a model to not have to know how some other module also appended itself to the same model.</p>\n\n<p>For example, the <code>Base</code> behaves a bit like a proxy. Whenever another class subclasses it, it will create a new type based on the top type. When you call a method it's doing something like <code>return getattr(self._inner, name)(args)</code> and uses normal inheritance in Python to get the <code>super</code>. When it extends it, all it does is <code>self.top = type(self.name, (self.top,), args...)</code> but since Rust doesn't have inheritance, I'm not sure how it can be done.</p>\n\n<p>Is there a way to achieve something close this this in Rust without making the code completely unreadable?</p>\n\n<p>As I understand one way to achieve that would be to create functor objects</p>\n\n<p>like </p>\n\n<pre><code>struct Command {\n   name: String,\n   super: &amp;command: Command,\n   func: Fn (&amp;Object, &amp;Command\n, ArgumentMap) -&gt; Any\n}\n\nstruct Object {\n   name: String,\n   commands: Map&lt;Command&gt;,\n}\n\nimpl Object {\n  fn insert_command(&amp;self, command: Command) {\n    let super_command = self.commands.get(command.name)\n    if (super_command) {\n      command.super = super_command\n    }\n    self.commands.remove(super_command.name)\n    self.commands.set(command.name, command)\n  }\n\n  fn call(&amp;self, name:String, args: ArgumentMap) -&gt; Any {\n    let command = self.commands.get(command.name)\n    (command.func)(self, command.super, args)\n  }\n\n  fn extend(extension: Map&lt;String, ?closure?&gt;) {\n     // for each key add a command\n  }\n}\n\nuser = Object {\n    name: \"user\",\n    commands: Map&lt;Command&gt; {}\n}\n\nuser.extend({\n  \"do_something\": |self, super, args| {\n     // change args\n     let new_args = self.call(\"change_args\", args)\n     let ret = (super.func)(self, super.super, new_args)\n     // do something with ret\n  },\n})\n\nuser.extend({\n    \"do_something\": |self, super, args| {\n       // will call method previously defined above\n       let ret = (super.func)(self, super.super, args)\n       ret\n    }\n})\n</code></pre>\n\n<p>That's pretty much how I'd do that. <code>Object</code> is just a plain object that is there to store the functions as necessary. It can be made better by making <code>super</code> as a callable that only take <code>args</code> as argument by encapsulating the (self, next super method).</p>\n\n<p>This is how I'd do it as I don't know if this kind of thing could be done without implementing an object-like structure. This is all going to be executed at runtime but I guess it's not possible to do much otherwise because there is a need for reflection if something is supposed to call it externally using a JSON request. Let's imagine one of the entrypoint is a webserver that receive the method to be called on a model. As I understand, Rust doesn't offer reflection so it only make sense to do it like that.</p>\n"}, {"tags": ["rust", "rust-rocket"], "answers": [{"comments": [{"owner": {"reputation": 63855, "user_id": 124486, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/605442f85418d858e2ce1e1aea2092bb?s=128&d=identicon&r=PG", "display_name": "Evan Carroll", "link": "https://stackoverflow.com/users/124486/evan-carroll"}, "edited": false, "score": 0, "creation_date": 1559156783, "post_id": 56366993, "comment_id": 99337108, "body": "So it&#39;s just a constructor for a type that takes in input, checks for <code>..&#47;</code> (or a parent-notation), and fails to create the type in runtime if one is detected?"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1559157223, "last_edit_date": 1559157223, "creation_date": 1559156726, "answer_id": 56366993, "question_id": 56366947, "link": "https://stackoverflow.com/questions/56366947/how-does-a-rust-pathbuf-prevent-directory-traversal-attacks/56366993#56366993", "title": "How does a Rust PathBuf prevent directory traversal attacks?", "body": "<p><code>PathBuf</code> provides no such guarantees. It <em>cannot</em> because there's no concept of \"directory traversal attacks\" in all domains where a <code>PathBuf</code> is used. </p>\n\n<p>What the author means is that the implementation of <a href=\"https://api.rocket.rs/v0.4/rocket/request/trait.FromSegments.html\" rel=\"nofollow noreferrer\"><code>FromSegments</code></a> for <code>PathBuf</code> performs the traversal attack check and never calls the handler if it fails.</p>\n\n<p><code>FromSegments</code> allows for failure cases by returning a <a href=\"https://doc.rust-lang.org/std/result/enum.Result.html\" rel=\"nofollow noreferrer\"><code>Result</code></a>:</p>\n\n<pre><code>pub trait FromSegments&lt;'a&gt;: Sized {\n    type Error: Debug;\n    fn from_segments(segments: Segments&lt;'a&gt;) -&gt; Result&lt;Self, Self::Error&gt;;\n}\n</code></pre>\n"}], "owner": {"reputation": 63855, "user_id": 124486, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/605442f85418d858e2ce1e1aea2092bb?s=128&d=identicon&r=PG", "display_name": "Evan Carroll", "link": "https://stackoverflow.com/users/124486/evan-carroll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 0, "accepted_answer_id": 56366993, "answer_count": 1, "score": 1, "last_activity_date": 1559157223, "creation_date": 1559156416, "last_edit_date": 1559156785, "question_id": 56366947, "link": "https://stackoverflow.com/questions/56366947/how-does-a-rust-pathbuf-prevent-directory-traversal-attacks", "title": "How does a Rust PathBuf prevent directory traversal attacks?", "body": "<p>From <a href=\"https://youtu.be/cDFSrVhnZKo?t=2063\" rel=\"nofollow noreferrer\"><em>\"A Case for Oxidation: The Rust Programming Language\"</em></a> Sergio Benitez says,</p>\n\n<blockquote>\n  <p>Here is a static file server written in Rocket. It is exactly four lines and it guaranteed to <strong>not</strong> be vulnerable to directory traversal attacks.</p>\n</blockquote>\n\n<p>Those four lines are:</p>\n\n<pre><code>#[get(\"/&lt;path..&gt;\")]\nfn files(path: PathBuf) -&gt; Option&lt;NamedFile&gt; {\n    NamedFile::open(Path::new(\"static/\").join(path)).ok()\n}\n</code></pre>\n\n<p>The bottom of this slide says,</p>\n\n<ul>\n<li><code>FromParam*</code> implementation for <code>PathBuf</code> verifies path safety</li>\n</ul>\n\n<p>I get how a type can guarantee safety by validating input (in the same sense that any object can in a constructor or how the input to a function can be wrapped with a validating function.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>dangerousThing(validateSafety(input))\n</code></pre>\n\n<p>Many languages provide this. I also understand how you can make this simpler by putting it into a constructor for a type or class,</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>class Path {\n  constructor(path) { this._path = validateSafety(path) }\n}\n</code></pre>\n\n<p>But I'm confused at what (if anything) Rust is doing differently here. Is there anything more to this?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1559149603, "post_id": 56365378, "comment_id": 99334093, "body": "Can you just call <a href=\"https://doc.rust-lang.org/std/vec/struct.Vec.html#method.reserve_exact\" rel=\"nofollow noreferrer\"><code>reserve_exact</code></a>?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 3, "creation_date": 1559150092, "post_id": 56365378, "comment_id": 99334313, "body": "&quot;I need this feature because I may have a large number of elements in the vector, and every reallocation by some small amount of extra capacity is going to cause considerable delays in the processes I am running.&quot; ??? look like you over thinking just benchmark it after the program is finish and see if you have a bench problem. Don&#39;t over commit in prod"}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 3, "creation_date": 1559150396, "post_id": 56365378, "comment_id": 99334465, "body": "The actual allocation strategy used by <code>Vec</code> is to double the capacity each time, so the behaviour you described doesn&#39;t sound quire right. Did you actually measure a performance issue with repeated allocation or are you just guessing?"}, {"owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "reply_to_user": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1559150932, "post_id": 56365378, "comment_id": 99334722, "body": "@PeterHall , I am trying to figure out how does it increment the capacity , and make it work like I need it. Didn&#39;t run any tests yet."}], "answers": [{"comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1559207503, "post_id": 56366040, "comment_id": 99351563, "body": "The problem with the newtype is that you have to delegate every single method, in order for it to be ergonomic - and do this check and re-allocation for quite a few more methods that just <code>push</code>. Just implementing <code>Deref&lt;Target = Vec&lt;T&gt;&gt;</code> will get you some of those methods &quot;for free&quot; but it has limitations too."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 3, "last_activity_date": 1559152834, "last_edit_date": 1559152834, "creation_date": 1559152079, "answer_id": 56366040, "question_id": 56365378, "link": "https://stackoverflow.com/questions/56365378/is-it-possible-to-define-the-increment-factor-for-reallocations-to-stdvecvec/56366040#56366040", "title": "Is it possible to define the increment factor for reallocations to std::vec::Vec?", "body": "<p>No, <code>Vec</code> (as of Rust 1.35) does not provide any mechanism to control the reallocation strategy.</p>\n\n<p>When you call methods like <code>Vec::push</code>, the <a href=\"https://github.com/rust-lang/rust/blob/1.35.0/src/liballoc/raw_vec.rs#L418-L430\" rel=\"nofollow noreferrer\">current implementation of <code>Vec</code></a> will double the capacity when the vector is full. When you call methods like <code>reserve_exact</code>, the <a href=\"https://github.com/rust-lang/rust/blob/1.35.0/src/liballoc/raw_vec.rs#L655-L658\" rel=\"nofollow noreferrer\">current implementation of <code>Vec</code></a> directly uses your capacity.</p>\n\n<blockquote>\n  <p>the docs say that the <code>Vec</code> is going to be a <code>(pointer, capacity, length)</code> triplet <strong>no more and no less</strong>.</p>\n</blockquote>\n\n<p>This doesn't preclude the possibility of <code>Vec</code> being extended in a very cautious manner. For example, <code>Vec</code> is built from a <code>RawVec</code>, which is <a href=\"https://github.com/rust-lang/rust/blob/1.35.0/src/liballoc/raw_vec.rs#L42-L46\" rel=\"nofollow noreferrer\">parameterized by an allocator</a>. So long as you use a zero-sized allocator (such as <a href=\"https://doc.rust-lang.org/std/alloc/struct.Global.html\" rel=\"nofollow noreferrer\"><code>Global</code></a>), the size will still be true.</p>\n\n<p>It would be <em>conceptually</em> straight-forward to have another type parameter to control the resizing behavior. That being said, it seems unlikely to occur anytime soon.</p>\n\n<h1>Workarounds</h1>\n\n<p>If you really needed something like this, you can create a newtype around a <code>Vec</code> and call <code>reserve_exact</code> at all the appropriate points.</p>\n\n<pre><code>struct MyVec&lt;T&gt; {\n    v: Vec&lt;T&gt;,\n    increment: usize,\n}\n\nimpl&lt;T&gt; MyVec&lt;T&gt; {\n    fn new(capacity: usize, increment: usize) -&gt; MyVec&lt;T&gt; {\n        MyVec {\n            v: Vec::with_capacity(capacity),\n            increment,\n        }\n    }\n\n    fn push(&amp;mut self, val: T) {\n        if self.v.len() == self.v.capacity() {\n            self.v.reserve_exact(self.increment);\n        }\n        self.v.push(val);\n    }\n}\n</code></pre>\n\n<h1>Free advice</h1>\n\n<p>Don't try to optimize this until you have benchmarks that:</p>\n\n<ol>\n<li>Show that this is a bottleneck</li>\n<li>Can be used to prove that your \"optimizations\" actually make things faster</li>\n</ol>\n\n<blockquote>\n  <p>I may have a large number of elements in the vector, and every reallocation by some small amount of extra capacity is going to cause considerable delays in the processes I am running.</p>\n</blockquote>\n\n<p>I agree with this as a gut feeling, which is why your idea is so confusing to me:</p>\n\n<blockquote>\n  <p>I want it to be reallocated with 32 elements more </p>\n</blockquote>\n\n<p>32 elements <em>is</em> a small amount of extra capacity; by doing this it seems as if you'd be decreasing performance.</p>\n"}], "owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 56366040, "answer_count": 1, "score": 0, "last_activity_date": 1559152834, "creation_date": 1559149121, "last_edit_date": 1559150833, "question_id": 56365378, "link": "https://stackoverflow.com/questions/56365378/is-it-possible-to-define-the-increment-factor-for-reallocations-to-stdvecvec", "title": "Is it possible to define the increment factor for reallocations to std::vec::Vec?", "body": "<p>I have a slowly growing <code>std::vec::Vec</code>. For every reallocation of the vector when it exceeds its capacity, I want the reallocation to be done by a static number of elements.</p>\n\n<p>For example, I initially allocate a vector with 1024 elements. When it reaches its capacity, I want it to be reallocated with 32 elements more and I want this parameter to be configurable. </p>\n\n<p>I'm looking for a function like this:</p>\n\n<pre><code>Vec::new(initial_capacity, capacity_increment);\n</code></pre>\n\n<p>Where:</p>\n\n<pre><code>initial_capacity = 1024;\ncapacity_increment = 32;\n</code></pre>\n\n<p>Is this functionality available in Rust (nightly or stable)?</p>\n\n<p>The docs say that you can only specify initial capacity, but it is not clear how the size is increased on every reallocation or if this parameter can ever be changed. In fact the docs say that the <code>Vec</code> is going to be a <code>(pointer, capacity, length)</code> triplet <strong>no more and no less</strong>.</p>\n\n<p>Is there any way to have capacity increment configuration?</p>\n\n<p>I need this feature because I may have a large number of elements in the vector, and every reallocation by some small amount of extra capacity is going to cause considerable delays in the processes I am running.</p>\n"}, {"tags": ["arrays", "rust", "initialization"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559138718, "post_id": 56362364, "comment_id": 99328272, "body": "<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=273435376ac8a605b528eb3a7a29a778\" rel=\"nofollow noreferrer\">The duplicates applied to your question</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559138771, "post_id": 56362364, "comment_id": 99328312, "body": "<i>I might be caught halfway through the initialization of the array</i> \u2014 yes; don&#39;t write that code yourself because it&#39;s <b>very</b> difficult to get correct."}], "owner": {"reputation": 6932, "user_id": 774236, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/7e46879a230ff1e28cd975e3b0a0873b?s=128&d=identicon&r=PG", "display_name": "Matteo Monti", "link": "https://stackoverflow.com/users/774236/matteo-monti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "closed_date": 1559138683, "answer_count": 0, "score": 1, "last_activity_date": 1559139239, "creation_date": 1559138397, "last_edit_date": 1559139239, "question_id": 56362364, "link": "https://stackoverflow.com/questions/56362364/how-can-i-fill-an-array-with-the-ok-value-of-a-result-from-a-function-call-or-re", "closed_reason": "Duplicate", "title": "How can I fill an array with the Ok value of a Result from a function call or return the Err?", "body": "<p>Consider the case where a function returns a <code>Result</code>:</p>\n\n<pre><code>fn might_explode() -&gt; Result&lt;AllFine, Kaboom&gt; {\n    // Awesome, potentially explosive things.\n}\n</code></pre>\n\n<p>Let us assume that I have no control, and I cannot make assumptions, over <code>AllFine</code> (e.g., it comes from another crate). What I would like to do is to fill, if possible, an array of <code>AllFine</code> with values obtained by iteratively invoking <code>might_explode()</code>. If any of the invocations to <code>might_explode()</code> returns an <code>Err</code>, I would like to return that <code>Err</code>.</p>\n\n<p>For example, if I wanted to build an array of four elements, I would do:</p>\n\n<pre><code>let my_array = [might_explode()?, might_explode()?, might_explode()?, might_explode()?]\n</code></pre>\n\n<p>The above indeed works nicely, but for large arrays (I will be working, e.g., with arrays as big as 256 elements) it becomes extremely cumbersome and (I guess?) it makes the resulting binary very bloated.</p>\n\n<p>Looking around for possible solutions, I stumbled upon <a href=\"https://www.joshmcguigan.com/blog/array-initialization-rust/\" rel=\"nofollow noreferrer\">this beautiful post</a> that seems to do exactly what I need. Using a bit of <code>unsafe</code>, the post above presents this example:</p>\n\n<pre><code>let _: [Option&lt;String&gt;; 33] = unsafe {\n    let mut arr: [Option&lt;String&gt;; 33] = std::mem::uninitialized();\n    for item in &amp;mut arr[..] {\n        std::ptr::write(item, None);\n    }\n    arr\n};\n</code></pre>\n\n<p>Now, this would be just perfect for me if only <code>might_explode()</code> always returned <code>AllFine</code>. But sometimes it might return <code>Kaboom</code>! As a result, I might be caught halfway through the initialization of the array, and in returning I'd call a potentially deadly <code>drop</code> on every non-initialized element of the array.</p>\n\n<p>So, is there a way to reasonably use <code>unsafe</code> to achieve what I want to do?</p>\n"}, {"tags": ["rust", "collect"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 6, "creation_date": 1559138209, "post_id": 56362084, "comment_id": 99327951, "body": "because <code>push()</code> doesn&#39;t return the vector"}], "answers": [{"comments": [{"owner": {"reputation": 355, "user_id": 5405669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TZH6x.jpg?s=128&g=1", "display_name": "Edmund&#39;s Echo", "link": "https://stackoverflow.com/users/5405669/edmunds-echo"}, "edited": false, "score": 0, "creation_date": 1559146353, "post_id": 56363741, "comment_id": 99332570, "body": "Thank you.  If <code>result.push(...)</code> works, what is preventing me from substituting <code>result</code> with the product of the expression that builds the <code>Vec&lt;String&gt;</code>?   The answer is exactly as @stargateur and your answer addresses.  However, is it perhaps less about <code>push</code> not returning a <code>Vec</code>, but rather, that <code>push</code> requires a mutable reference to the <code>Vec</code>?  All this to say, perhaps there is a shift that I need to pay attention to when composing functions: functions that take <code>Iterable</code> as a parameter, and those aren&#39;t traits, but struct-specific methods like <code>push</code>.  Is that right?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 355, "user_id": 5405669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TZH6x.jpg?s=128&g=1", "display_name": "Edmund&#39;s Echo", "link": "https://stackoverflow.com/users/5405669/edmunds-echo"}, "edited": false, "score": 1, "creation_date": 1559147735, "post_id": 56363741, "comment_id": 99333262, "body": "@Edmund&#39;sEcho well you <i>could</i> do <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=6f60c94f78e1bda716b3c748dbea0412\" rel=\"nofollow noreferrer\">that</a>"}, {"owner": {"reputation": 355, "user_id": 5405669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TZH6x.jpg?s=128&g=1", "display_name": "Edmund&#39;s Echo", "link": "https://stackoverflow.com/users/5405669/edmunds-echo"}, "edited": false, "score": 0, "creation_date": 1559148982, "post_id": 56363741, "comment_id": 99333819, "body": "Fantastic. Thank you! I have more work to do on how I think about this."}, {"owner": {"reputation": 355, "user_id": 5405669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TZH6x.jpg?s=128&g=1", "display_name": "Edmund&#39;s Echo", "link": "https://stackoverflow.com/users/5405669/edmunds-echo"}, "edited": false, "score": 0, "creation_date": 1559225169, "post_id": 56363741, "comment_id": 99360032, "body": "How my FP went wrong:  To compose functions as I was, they need to be &quot;pure&quot;; &quot;pure&quot; allows for mutations, we just need referential transparency.  I went astray by relating the <code>result</code> in <code>result.push(...)</code> as &quot;one in the same&quot; with the <code>result</code> in  <code>let mut result =...</code>.  The flaw: in <code>result.push(...)</code>, <code>push</code> looks &quot;pure&quot; from the input perspective (<code>(self, newValue)</code>) but is in fact &quot;impure&quot; <i>only</i> because it returns the same output no matter the input.  So, I can&#39;t compose with <code>push</code>.  Confounding my confusion, building a mutable reference with the intent of having it point to &quot;not ()&quot;."}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "reply_to_user": {"reputation": 355, "user_id": 5405669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TZH6x.jpg?s=128&g=1", "display_name": "Edmund&#39;s Echo", "link": "https://stackoverflow.com/users/5405669/edmunds-echo"}, "edited": false, "score": 0, "creation_date": 1559225330, "post_id": 56363741, "comment_id": 99360111, "body": "@Edmund&#39;sEcho <i>&quot;<code>push</code> looks &quot;pure&quot; from the input perspective <code>((self, newValue))</code>&quot;</i> The effective input perspective here is <code>(&amp;mut self, newValue)</code>, which clearly shows that it can modify <code>self</code>, and so is very likely not to be pure."}, {"owner": {"reputation": 355, "user_id": 5405669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TZH6x.jpg?s=128&g=1", "display_name": "Edmund&#39;s Echo", "link": "https://stackoverflow.com/users/5405669/edmunds-echo"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1559226590, "post_id": 56363741, "comment_id": 99360758, "body": "@E_net4 I think that is one of the misunderstandings about &quot;pure&quot;.  A state machine can be pure.  All that pure requires is that the output be the same for the same input.  All <code>push</code> had to do to become pure, is return <code>self</code>. I was stuck on  &quot;it was surely pure&quot; because the it had the right inputs. I kept denying the reality of it&#39;s return value.  Do you know what I mean?"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1559227120, "post_id": 56363741, "comment_id": 99361061, "body": "Sure. And one can provide <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=6bfa45d4cfb4e3e230d36fbe426610cd\" rel=\"nofollow noreferrer\">an implementation of such a method</a>. What we generally don&#39;t seem to understand is why you overlooked the method&#39;s return type."}, {"owner": {"reputation": 355, "user_id": 5405669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TZH6x.jpg?s=128&g=1", "display_name": "Edmund&#39;s Echo", "link": "https://stackoverflow.com/users/5405669/edmunds-echo"}, "edited": false, "score": 0, "creation_date": 1559243418, "post_id": 56363741, "comment_id": 99368687, "body": "@E-net4 &quot;why you overlooked the method&#39;s return type&quot;:  My brain refused to see because I was stuck: why can&#39;t I substitute the <code>result</code> in <code>result.push(..)</code> with the code I was using to produce the <code>result</code> used on the right hand side of <code>let mut result =...</code>.  I could not rationalize how they were different. <i>I now see</i> how <code>push</code> is a <i>method</i> in a way that is different than a <i>trait</i> can also be considered a method (they both have access to <code>self</code>).  I kept thinking that <code>push</code> was a <i>trait</i>; that matters because traits don&#39;t normally (ever?) return <code>()</code>; instead, output depends on input."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 5, "last_activity_date": 1559142804, "creation_date": 1559142804, "answer_id": 56363741, "question_id": 56362084, "link": "https://stackoverflow.com/questions/56362084/why-does-the-compiler-prevent-me-from-using-push-on-a-vec-created-using-collect/56363741#56363741", "title": "Why does the compiler prevent me from using push on a Vec created using collect()?", "body": "<p>If you read the <a href=\"https://doc.rust-lang.org/std/vec/struct.Vec.html#method.push\" rel=\"noreferrer\">documentation for <code>Vec::push</code></a> and look at the signature of the method, you will learn that it does not return the <code>Vec</code>:</p>\n\n<pre><code>pub fn push(&amp;mut self, value: T)\n</code></pre>\n\n<p>Since there is no explicit return type, the return type is the <em>unit type</em> <code>()</code>. There is no method called <code>join</code> on <code>()</code>. You will need to write your code in multiple lines.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/24842271/155423\">What is the purpose of the unit type in Rust?</a></li>\n</ul>\n\n<hr>\n\n<p>I'd write this more functionally:</p>\n\n<pre><code>use itertools::Itertools; // 0.8.0\n\npub fn build_proverb(list: &amp;[&amp;str]) -&gt; String {\n    let last = list\n        .get(0)\n        .map(|d| format!(\"And all for the want of a {}.\", d));\n\n    list.windows(2)\n        .map(|d| format!(\"For want of a {} the {} was lost.\", d[0], d[1]))\n        .chain(last)\n        .join(\"\\n\")\n}\n\nfn main() {\n    println!(\"{}\", build_proverb(&amp;[\"nail\", \"shoe\"]));\n}\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/36941851/155423\">What&#39;s an idiomatic way to print an iterator separated by spaces in Rust?</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 355, "user_id": 5405669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TZH6x.jpg?s=128&g=1", "display_name": "Edmund&#39;s Echo", "link": "https://stackoverflow.com/users/5405669/edmunds-echo"}, "is_accepted": false, "score": 0, "last_activity_date": 1559328705, "creation_date": 1559328705, "answer_id": 56400371, "question_id": 56362084, "link": "https://stackoverflow.com/questions/56362084/why-does-the-compiler-prevent-me-from-using-push-on-a-vec-created-using-collect/56400371#56400371", "title": "Why does the compiler prevent me from using push on a Vec created using collect()?", "body": "<p>Thank you to everyone for the useful interactions. Everything stated in the previous response is precisely correct. And, there is a bigger picture as I'm learning Rust.</p>\n\n<p>Coming from Haskell (with C training years ago), I bumped into the OO method chaining approach that uses a pointer to chain between method calls; no need for pure functions (i.e., what I was doing with <code>let mut result = ...</code>, which was then used/required to change the value of the <code>Vec</code> using <code>push</code> in <code>result.push(...)</code>). What I believe is a more general observation is that, in OO, it is \"aok\" to return <code>unit</code> because method chaining does not require a return value. </p>\n\n<p>The custom code below defines <code>push</code> as a trait; it uses the same inputs as the \"OO\" <code>push</code>, but returns the updated <code>self</code>.  Perhaps only as a side comment, this makes the function pure (output depends on input) but in practice, means the <code>push</code> defined as a trait enables the FP composition of functions I had come to expect was a norm (fair enough I thought at first given how much Rust borrows from Haskell).</p>\n\n<p>What I was trying to accomplish, and at the heart of the question, is captured by the code solution that @Stargateur, @E_net4 and @Shepmaster put forward.  With only the smallest edits is as follows:\n(see <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=05b6c9c538d1ef1e63055aed4a052407\" rel=\"nofollow noreferrer\">playground</a>)</p>\n\n<pre><code>pub fn build_proverb(list: &amp;[&amp;str]) -&gt; String {\n    if list.is_empty() {\n        return String::new();\n    }\n    list.windows(2)\n        .map(|d| format!(\"For want of a {} the {} was lost.\", d[0], d[1]))\n        .collect::&lt;Vec&lt;_&gt;&gt;()\n        .push(format!(\"And all for the want of a {}.\", list[0]))\n        .join(\"\\n\")\n}\n</code></pre>\n\n<p>The solution requires that I define <code>push</code> as a trait that return the <code>self</code>, \ntype <code>Vec</code> in this instance. </p>\n\n<pre><code>trait MyPush&lt;T&gt; {\n    fn push(self, x: T) -&gt; Vec&lt;T&gt;;\n}\n\nimpl&lt;T&gt; MyPush&lt;T&gt; for Vec&lt;T&gt; {\n    fn push(mut self, x: T) -&gt; Vec&lt;T&gt; {\n        Vec::push(&amp;mut self, x);\n        self\n    }\n}\n</code></pre>\n\n<p>Final observation, in surveying many of the Rust traits, I could not find a trait function that returns <code>()</code> (modulo e.g., <code>Write</code> that returns <code>Result ()</code>).  </p>\n\n<p>This contrasts with what I learned here to expect with <code>struct</code> and <code>enum</code> <code>methods</code>.  Both traits and the OO methods have access to <code>self</code> and thus have each been described as \"methods\", but there seems to be an inherent difference worth noting: OO methods use a reference to enable sequentially changing <code>self</code>, FP traits (if you will) uses function composition that relies on the use of \"pure\", state-changing functions to accomplish the same (<code>:: (self, newValue) -&gt; self</code>). </p>\n\n<p>Perhaps as an aside, where Haskell achieves referential transparency in this situation by creating a new copy (modulo behind the scenes optimizations), Rust seems to accomplish something similar in the custom trait code by managing ownership (transferred to the trait function, and handed back by returning <code>self</code>).</p>\n\n<p>A final piece to the \"composing functions\" puzzle: For composition to work, the output of one function needs to have the type required for the input of the next function.  <code>join</code> worked both when I was passing it a value, and when I was passing it a reference (true with types that implement <code>IntoIterator</code>).  So <code>join</code> seems to have the capacity to work in both the method chaining and function composition styles of programming.</p>\n\n<p>Is this distinction between OO methods that don't rely on a return value and traits generally true in Rust? It seems to be the case \"here and there\". Case in point, in contrast to <code>push</code> where the line is clear, <code>join</code> seems to be on its way to being part of the standard library defined as both a method for <code>SliceConcatExt</code> and a trait function for <code>SliceConcatExt</code> (<a href=\"https://doc.rust-lang.org/src/alloc/slice.rs.html#543-576\" rel=\"nofollow noreferrer\">see rust src</a> and <a href=\"https://github.com/rust-lang/rust/issues/27747\" rel=\"nofollow noreferrer\">the rust-lang issue discussion</a>). The next question, would unifying the approaches in the standard library be consistent with the Rust design philosophy? (pay only for what you use, safe, performant, expressive and a joy to use)</p>\n"}], "owner": {"reputation": 355, "user_id": 5405669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TZH6x.jpg?s=128&g=1", "display_name": "Edmund&#39;s Echo", "link": "https://stackoverflow.com/users/5405669/edmunds-echo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1559328705, "creation_date": 1559137491, "last_edit_date": 1559142461, "question_id": 56362084, "link": "https://stackoverflow.com/questions/56362084/why-does-the-compiler-prevent-me-from-using-push-on-a-vec-created-using-collect", "title": "Why does the compiler prevent me from using push on a Vec created using collect()?", "body": "<p>The following compiles:</p>\n\n<pre><code>pub fn build_proverb(list: &amp;[&amp;str]) -&gt; String {\n    if list.is_empty() {\n        return String::new();\n    }\n    let mut result = (0..list.len() - 1)\n        .map(|i| format!(\"For want of a {} the {} was lost.\", list[i], list[i + 1]))\n        .collect::&lt;Vec&lt;String&gt;&gt;();\n    result.push(format!(\"And all for the want of a {}.\", list[0]));\n    result.join(\"\\n\")\n}\n</code></pre>\n\n<p>The following does not (<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=38238dfd7f24f1547739d581eae69c5f\" rel=\"nofollow noreferrer\">see Playground</a>):</p>\n\n<pre><code>pub fn build_proverb(list: &amp;[&amp;str]) -&gt; String {\n    if list.is_empty() {\n        return String::new();\n    }\n    let mut result = (0..list.len() - 1)\n        .map(|i| format!(\"For want of a {} the {} was lost.\", list[i], list[i + 1]))\n        .collect::&lt;Vec&lt;String&gt;&gt;()\n        .push(format!(\"And all for the want of a {}.\", list[0]))\n        .join(\"\\n\");\n    result\n}\n</code></pre>\n\n<p>The compiler tells me </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0599]: no method named `join` found for type `()` in the current scope\n --&gt; src/lib.rs:9:10\n  |\n9 |         .join(\"\\n\");\n  |          ^^^^\n</code></pre>\n\n<p>I get the same type of error if I try to compose just with <code>push</code>.</p>\n\n<p>What I would expect is that <code>collect</code> returns <code>B</code>, aka <code>Vec&lt;String&gt;</code>.  <code>Vec</code> is not <code>()</code>, and <code>Vec</code> of course has the methods I want to include in the list of composed functions.</p>\n\n<p>Why can't I compose these functions? The explanation might include describing the \"magic\" of terminating the expression after <code>collect()</code> to get the compiler to instantiate the <code>Vec</code> in a way that does not happen when I compose with <code>push</code> etc.</p>\n"}, {"tags": ["rust", "move"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1559107160, "post_id": 56352918, "comment_id": 99311313, "body": "<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=b666c7bb80b88fbc5640a8c58ccb9e7e\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a> pick your favorite"}], "answers": [{"tags": [], "owner": {"reputation": 162, "user_id": 2325160, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cwY4L.jpg?s=128&g=1", "display_name": "kdrakon", "link": "https://stackoverflow.com/users/2325160/kdrakon"}, "is_accepted": true, "score": 1, "last_activity_date": 1559133204, "last_edit_date": 1559133204, "creation_date": 1559105203, "answer_id": 56353261, "question_id": 56352918, "link": "https://stackoverflow.com/questions/56352918/how-to-resolve-cannot-move-out-of-borrowed-content-due-to-filtering-read-dir-o/56353261#56353261", "title": "How to resolve &quot;cannot move out of borrowed content&quot; due to filtering read_dir output?", "body": "<p>The predicate in <code>filter</code> only allows you to borrow <code>r_entry</code>. When you call <code>and_then</code>, this attempts a move. Instead, you can use the reference in a <code>match</code> like this:</p>\n\n<pre><code>fn main() -&gt; Result&lt;()&gt; {\n    let xs = std::fs::read_dir(\".\")?\n        .filter(|r_entry| match r_entry {\n            Ok(entry) =&gt; entry.metadata().map(|m| m.is_file()).unwrap_or(false),\n            Err(_) =&gt; false,\n        })\n        .collect::&lt;Result&lt;Vec&lt;_&gt;&gt;&gt;();\n\n    println!(\"{:?}\", xs);\n    Ok(())\n}\n</code></pre>\n"}], "owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 56353261, "answer_count": 1, "score": 0, "last_activity_date": 1559133204, "creation_date": 1559102432, "last_edit_date": 1559132975, "question_id": 56352918, "link": "https://stackoverflow.com/questions/56352918/how-to-resolve-cannot-move-out-of-borrowed-content-due-to-filtering-read-dir-o", "title": "How to resolve &quot;cannot move out of borrowed content&quot; due to filtering read_dir output?", "body": "<p>I'm trying to use <code>read_dir</code> to read the contents of a directory and then filter for just the files:</p>\n\n<pre><code>let xs = std::fs::read_dir(\".\")?\n    .filter(|r_entry| {\n        r_entry.and_then(|entry| {\n            let m = entry.metadata()?;\n            Ok(m.is_file())\n        })\n        .unwrap_or(false)\n    })\n    .collect::&lt;Result&lt;Vec&lt;_&gt;&gt;&gt;();\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=c74b90188a1d04ce5646dcf8587da383\" rel=\"nofollow noreferrer\">playground</a>)</p>\n\n<p>The error message is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0507]: cannot move out of borrowed content\n --&gt; src/main.rs:6:13\n  |\n6 |             r_entry\n  |             ^^^^^^^ cannot move out of borrowed content\n</code></pre>\n\n<p>I've tried various combinations of <code>&amp;</code> and <code>*</code> around <code>r_entry</code> to no avail. What is happening?</p>\n"}, {"tags": ["struct", "rust"], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1559098109, "post_id": 56351568, "comment_id": 99309504, "body": "Note: <code>(obj.ops)(Vec::new())</code> require rust 1.35 stable"}], "tags": [], "owner": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "is_accepted": false, "score": 3, "last_activity_date": 1559131050, "last_edit_date": 1559131050, "creation_date": 1559089086, "answer_id": 56351568, "question_id": 56351454, "link": "https://stackoverflow.com/questions/56351454/how-to-have-a-function-as-a-member-in-a-struct/56351568#56351568", "title": "How to have a function as a member in a struct", "body": "<p>You can use <code><a href=\"https://doc.rust-lang.org/nightly/std/boxed/struct.Box.html\" rel=\"nofollow noreferrer\">Box</a>&lt;dyn <a href=\"https://doc.rust-lang.org/nightly/std/ops/trait.Fn.html\" rel=\"nofollow noreferrer\">Fn</a>(ArgType) -> RetType&gt;</code> to store an arbitrary function:</p>\n\n<pre><code>struct Operation {\n    params: Vec&lt;String&gt;,\n    ops: Box&lt;dyn Fn(Vec&lt;String&gt;) -&gt; Vec&lt;String&gt;&gt;,\n}\n</code></pre>\n\n<p>In general, the <a href=\"https://doc.rust-lang.org/nightly/std/ops/trait.Fn.html\" rel=\"nofollow noreferrer\"><code>Fn</code></a> trait (along with <a href=\"https://doc.rust-lang.org/nightly/std/ops/trait.FnOnce.html\" rel=\"nofollow noreferrer\"><code>FnOnce</code></a> and <a href=\"https://doc.rust-lang.org/nightly/std/ops/trait.FnMut.html\" rel=\"nofollow noreferrer\"><code>FnMut</code></a>) can be used for any callable value, such as a function or a closure, that has the given function signature.</p>\n\n<p>To create a <code>Box&lt;dyn Fn...&gt;</code> value, wrap any callable value with <code>Box::new</code>:</p>\n\n<pre><code>let obj = Operation {\n    params: Vec::new(),\n    // wrap a closure\n    ops: Box::new(|strings| {\n        /* do something... */\n        strings\n    }),\n};\n\n// call the function or closure inside the Box\n(obj.ops)(Vec::new())\n</code></pre>\n"}], "owner": {"reputation": 1791, "user_id": 3527983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HfU8x.jpg?s=128&g=1", "display_name": "asosnovsky", "link": "https://stackoverflow.com/users/3527983/asosnovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 566, "favorite_count": 0, "closed_date": 1559130949, "answer_count": 1, "score": 1, "last_activity_date": 1559131050, "creation_date": 1559088059, "last_edit_date": 1559130991, "question_id": 56351454, "link": "https://stackoverflow.com/questions/56351454/how-to-have-a-function-as-a-member-in-a-struct", "closed_reason": "Duplicate", "title": "How to have a function as a member in a struct", "body": "<p>How can I specify a function in a struct definition? Something like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Operation {\n    params: Vec&lt;String&gt;,\n    ops: Function&lt;Vec&lt;String&gt;&gt; -&gt; Vec&lt;String&gt;,\n}\n</code></pre>\n\n<p>I know that the syntax <code>Function&lt;Vec&lt;String&gt;&gt; -&gt; Vec&lt;String&gt;</code> is incorrect, but I am trying to specify that \"Operation\" has a field called <code>ops</code> that is a closure that takes a <code>Vec&lt;String&gt;</code> and returns a <code>Vec&lt;String&gt;</code>.</p>\n"}, {"tags": ["rust", "traits", "rust-tokio"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559074259, "post_id": 56349398, "comment_id": 99303726, "body": "What do you mean by &quot;how&quot;? Almost all traits are implemented for a type in the same way: <code>impl Trait for Type { ... }</code>. Sometimes that code is generated by a macro or whatever, but it&#39;s ultimately the same."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559074359, "post_id": 56349398, "comment_id": 99303763, "body": "<a href=\"https://docs.rs/tokio/0.1.20/tokio/net/struct.TcpStream.html#impl-AsyncRead\" rel=\"nofollow noreferrer\">The documentation shows</a> what traits are implemented for a type and what methods they provide."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559074528, "post_id": 56349398, "comment_id": 99303829, "body": "You can test if a type implements a trait: <a href=\"https://stackoverflow.com/q/32764797/155423\">How to enforce that a type implements a trait at compile time?</a>"}, {"owner": {"reputation": 1315, "user_id": 2619501, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5a2e73ec1d18119524fc602c747b0dfe?s=128&d=identicon&r=PG", "display_name": "benjumanji", "link": "https://stackoverflow.com/users/2619501/benjumanji"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559079816, "post_id": 56349398, "comment_id": 99305804, "body": "Perhaps my edits will help you understand what I am asking. I know how traits are defined. My question is that given that there isn&#39;t an obvious like between the two how do I establish that link? Is it some chain of blanket implementations? I have no idea."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559130727, "post_id": 56349398, "comment_id": 99323252, "body": "When I linked to <a href=\"https://docs.rs/tokio/0.1.20/tokio/net/struct.TcpStream.html#impl-AsyncRead\" rel=\"nofollow noreferrer\">the documentation for <code>TcpStream</code></a>, did you search on the page for the method <code>split</code>?"}, {"owner": {"reputation": 1315, "user_id": 2619501, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5a2e73ec1d18119524fc602c747b0dfe?s=128&d=identicon&r=PG", "display_name": "benjumanji", "link": "https://stackoverflow.com/users/2619501/benjumanji"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559131835, "post_id": 56349398, "comment_id": 99323924, "body": "Well color me embarrassed. I swear I spent an age reading that + ctrl-f split. Shame!"}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559130668, "post_id": 56351092, "comment_id": 99323228, "body": "It would probably be good if you explicitly laid out the exact steps you took to figure this so OP can apply the logic for other tasks."}], "tags": [], "owner": {"reputation": 12494, "user_id": 1402929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/IORgE.jpg?s=128&g=1", "display_name": "Matt Harrison", "link": "https://stackoverflow.com/users/1402929/matt-harrison"}, "is_accepted": true, "score": 3, "last_activity_date": 1559084675, "creation_date": 1559084675, "answer_id": 56351092, "question_id": 56349398, "link": "https://stackoverflow.com/questions/56349398/how-does-tokionettcpstream-implement-tokiopreludestream/56351092#56351092", "title": "How does tokio::net::TcpStream implement tokio::prelude::Stream?", "body": "<p><a href=\"https://docs.rs/tokio/0.1.20/tokio/net/struct.TcpStream.html\" rel=\"nofollow noreferrer\"><code>tokio::net::TcpStream</code></a> implements <a href=\"https://docs.rs/tokio/0.1.20/tokio/net/struct.TcpStream.html#impl-AsyncRead\" rel=\"nofollow noreferrer\"><code>AsyncRead</code></a>. </p>\n\n<p>One of the provided methods from <code>AsyncRead</code> is <a href=\"https://docs.rs/tokio/0.1.20/tokio/prelude/trait.AsyncRead.html#method.split\" rel=\"nofollow noreferrer\"><code>split()</code></a>:</p>\n\n<pre><code>fn split(self) -&gt; (ReadHalf&lt;Self&gt;, WriteHalf&lt;Self&gt;)\nwhere\n    Self: AsyncWrite, \n</code></pre>\n\n<p>So in this case it isn't <code>Stream::split</code> as your question suggested because as per your observation <code>tokio::net::TcpStream</code> isn't an implementor of <code>Stream</code>.</p>\n"}], "owner": {"reputation": 1315, "user_id": 2619501, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5a2e73ec1d18119524fc602c747b0dfe?s=128&d=identicon&r=PG", "display_name": "benjumanji", "link": "https://stackoverflow.com/users/2619501/benjumanji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 56351092, "answer_count": 1, "score": 3, "last_activity_date": 1559130535, "creation_date": 1559074046, "last_edit_date": 1559130535, "question_id": 56349398, "link": "https://stackoverflow.com/questions/56349398/how-does-tokionettcpstream-implement-tokiopreludestream", "title": "How does tokio::net::TcpStream implement tokio::prelude::Stream?", "body": "<p>In the <a href=\"https://tokio.rs/docs/getting-started/echo/\" rel=\"nofollow noreferrer\">tokio.rs</a> docs we see the following snippet</p>\n\n<pre><code>// split the socket stream into readable and writable parts\nlet (reader, writer) = socket.split();\n// copy bytes from the reader into the writer\nlet amount = io::copy(reader, writer);\n</code></pre>\n\n<p>I am assuming that <code>split</code> is indeed <a href=\"https://docs.rs/tokio/0.1.20/tokio/prelude/stream/trait.Stream.html\" rel=\"nofollow noreferrer\"><code>Stream::split</code></a>, but I can't figure out how this trait applies to <a href=\"https://docs.rs/tokio/0.1.20/tokio/net/struct.TcpStream.html\" rel=\"nofollow noreferrer\"><code>TcpStream</code></a> given that the stream page doesn't mention <code>TcpStream</code> and vice versa.</p>\n"}, {"tags": ["rust", "floating-point"], "answers": [{"tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 4, "last_activity_date": 1559130849, "last_edit_date": 1559130849, "creation_date": 1559097449, "answer_id": 56352356, "question_id": 56348835, "link": "https://stackoverflow.com/questions/56348835/how-can-i-convert-a-f64-to-f32-and-get-the-closest-approximation-and-the-next-gr/56352356#56352356", "title": "How can I convert a f64 to f32 and get the closest approximation and the next greater or smaller value?", "body": "<p>This function was <a href=\"https://github.com/rust-lang/rust/issues/27752\" rel=\"nofollow noreferrer\">removed from the standard library</a>. A solution could be to use <a href=\"https://docs.rs/float_extras/0.1.6/float_extras/\" rel=\"nofollow noreferrer\">the float_extras crate</a>, but I don't really like the way of this crate so here my solution:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>mod float {\n    use libc::{c_double, c_float};\n    use std::{f32, f64};\n\n    #[link_name = \"m\"]\n    extern \"C\" {\n        pub fn nextafter(x: c_double, y: c_double) -&gt; c_double;\n        pub fn nextafterf(x: c_float, y: c_float) -&gt; c_float;\n    // long double nextafterl(long double x, long double y);\n\n    // double nexttoward(double x, long double y);\n    // float nexttowardf(float x, long double y);\n    // long double nexttowardl(long double x, long double y);\n    }\n\n    pub trait NextAfter {\n        fn next_after(self, y: Self) -&gt; Self;\n    }\n\n    impl NextAfter for f32 {\n        fn next_after(self, y: Self) -&gt; Self {\n            unsafe { nextafterf(self, y) }\n        }\n    }\n\n    impl NextAfter for f64 {\n        fn next_after(self, y: Self) -&gt; Self {\n            unsafe { nextafter(self, y) }\n        }\n    }\n\n    pub trait Succ {\n        fn succ(self) -&gt; Self;\n    }\n\n    impl Succ for f32 {\n        fn succ(self) -&gt; Self {\n            self.next_after(f32::INFINITY)\n        }\n    }\n\n    impl Succ for f64 {\n        fn succ(self) -&gt; Self {\n            self.next_after(f64::INFINITY)\n        }\n    }\n\n    pub trait Pred {\n        fn pred(self) -&gt; Self;\n    }\n    impl Pred for f32 {\n        fn pred(self) -&gt; Self {\n            self.next_after(f32::NEG_INFINITY)\n        }\n    }\n\n    impl Pred for f64 {\n        fn pred(self) -&gt; Self {\n            self.next_after(f64::NEG_INFINITY)\n        }\n    }\n\n}\n\nuse crate::float::{Pred, Succ};\nuse num_traits::cast::{FromPrimitive, ToPrimitive};\n\nfn f32_greater&lt;T&gt;(x: T) -&gt; Option&lt;f32&gt;\nwhere\n    T: ToPrimitive + FromPrimitive + std::cmp::PartialOrd,\n{\n    let mut y = x.to_f32()?;\n    while T::from_f32(y)? &lt; x {\n        y = y.succ();\n    }\n    Some(y)\n}\n\nfn f32_smaller&lt;T&gt;(x: T) -&gt; Option&lt;f32&gt;\nwhere\n    T: ToPrimitive + FromPrimitive + std::cmp::PartialOrd,\n{\n    let mut y = x.to_f32()?;\n    while T::from_f32(y)? &gt; x {\n        y = y.pred();\n    }\n    Some(y)\n}\n\nfn main() {\n    let a = 42.4242424242424242;\n    println!(\n        \"{:.16?} &lt; {:.16} &lt; {:.16?}\",\n        f32_smaller(a),\n        a,\n        f32_greater(a)\n    );\n}\n</code></pre>\n\n<p>I don't understand why they <a href=\"https://github.com/rust-num/num/issues/118#issuecomment-496760667\" rel=\"nofollow noreferrer\">don't include it in the num crate</a>.</p>\n"}], "owner": {"reputation": 5913, "user_id": 1244932, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d2c608e688b798896e8b516855fc1ab1?s=128&d=identicon&r=PG", "display_name": "user1244932", "link": "https://stackoverflow.com/users/1244932/user1244932"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1143, "favorite_count": 1, "accepted_answer_id": 56352356, "answer_count": 1, "score": 8, "last_activity_date": 1559130849, "creation_date": 1559071398, "last_edit_date": 1559074984, "question_id": 56348835, "link": "https://stackoverflow.com/questions/56348835/how-can-i-convert-a-f64-to-f32-and-get-the-closest-approximation-and-the-next-gr", "title": "How can I convert a f64 to f32 and get the closest approximation and the next greater or smaller value?", "body": "<p>Possible pseudocode for the operation could be:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn f32_greater(x: f64) -&gt; f32 {\n    let mut y = x as f32; //I get closest\n    while f64::from(y) &lt; x {\n        y = nextafter(y, f32::INFINITY);\n    }\n    y\n}\n\nfn f32_smaller(x: f64) -&gt; f32 {\n    let mut y = x as f32; //I get closest\n    while f64::from(y) &gt; x {\n        y = nextafter(y, f32::NEG_INFINITY);\n    }\n    y\n}\n</code></pre>\n\n<p>I can not find an equivalent to C11's <a href=\"https://en.cppreference.com/w/c/numeric/math/nextafter\" rel=\"noreferrer\"><code>nextafter</code></a> function in the libc crate or in <a href=\"https://doc.rust-lang.org/std/primitive.f64.html\" rel=\"noreferrer\">the methods on <code>f64</code></a></p>\n\n<p>For context, I have an R-tree index using <code>f32</code>. I want to search the region with coordinates provided as a <code>f64</code>, so I need the smallest possible region in <code>f32</code> that includes the <code>f64</code> value.</p>\n"}, {"tags": ["data-structures", "struct", "rust"], "comments": [{"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1559062220, "post_id": 56346738, "comment_id": 99298611, "body": "Does your <code>RoomExit</code> have room <code>field</code> or not ? And what is the question ?"}, {"owner": {"reputation": 553, "user_id": 5483488, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/4ZHg7.jpg?s=128&g=1", "display_name": "Jake Lacey", "link": "https://stackoverflow.com/users/5483488/jake-lacey"}, "reply_to_user": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1559062664, "post_id": 56346738, "comment_id": 99298823, "body": "&gt; Does your RoomExit have room field or not ? No sorry it does not, when I&#39;ve implemented it with a linked list. Thanks for spotting that I will fix that.  My question is, how can I structure my data in such a way so that I can iterate through and compare adjacent rooms. so that I can figure out how these two adjacent rooms will be joined."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559063338, "post_id": 56346738, "comment_id": 99299127, "body": "How do you determine adjacency? Is it literally just two nodes back-to-back? Is your &quot;map&quot; a straight line? A linked list can only be a straight line..."}, {"owner": {"reputation": 553, "user_id": 5483488, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/4ZHg7.jpg?s=128&g=1", "display_name": "Jake Lacey", "link": "https://stackoverflow.com/users/5483488/jake-lacey"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559069877, "post_id": 56346738, "comment_id": 99301985, "body": "@Shepmaster the adjacency is determined by the order in which the rooms are created. The map is technically a straight line yes, with the first room connecting to the next until we get to the last room."}, {"owner": {"reputation": 553, "user_id": 5483488, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/4ZHg7.jpg?s=128&g=1", "display_name": "Jake Lacey", "link": "https://stackoverflow.com/users/5483488/jake-lacey"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559071783, "post_id": 56346738, "comment_id": 99302728, "body": "I&#39;ve been having a play around and come up with a hacky solution, hopefully this will better illustrate what I&#39;m trying to do @Shepmaster. Appreciate the edits also."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1559071898, "post_id": 56346738, "comment_id": 99302788, "body": "It looks like your question might be answered by the answers of <a href=\"https://stackoverflow.com/q/42134874/155423\">Are there equivalents to slice::chunks/windows for iterators to loop over pairs, triplets etc?</a>. If not, please <b><a href=\"https://stackoverflow.com/posts/56346738/edit\">edit</a></b> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1559076104, "post_id": 56346738, "comment_id": 99304447, "body": "You don&#39;t <i>have</i> to switch off a <code>LinkedList</code> (although I would). You can use <code>Itertools::tuple_chunks</code> with <code>LinkedList::iter</code>."}, {"owner": {"reputation": 553, "user_id": 5483488, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/4ZHg7.jpg?s=128&g=1", "display_name": "Jake Lacey", "link": "https://stackoverflow.com/users/5483488/jake-lacey"}, "edited": false, "score": 0, "creation_date": 1559131967, "post_id": 56346738, "comment_id": 99324001, "body": "I&#39;ll have a look into doing so cheers :)"}], "owner": {"reputation": 553, "user_id": 5483488, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/4ZHg7.jpg?s=128&g=1", "display_name": "Jake Lacey", "link": "https://stackoverflow.com/users/5483488/jake-lacey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 778, "favorite_count": 0, "closed_date": 1559135700, "answer_count": 0, "score": 1, "last_activity_date": 1559135708, "creation_date": 1559061716, "last_edit_date": 1559076063, "question_id": 56346738, "link": "https://stackoverflow.com/questions/56346738/how-can-i-get-access-to-the-current-and-previous-item-in-a-linked-list", "closed_reason": "Duplicate", "title": "How can I get access to the current and previous item in a linked list?", "body": "<p>I'm writing a map generator in Rust which will split the world into sections and then within those sections create rooms in order to connect these rooms. What I would normally do is have a list and then as I iterate through the list get the parent (if there is one) and then run some code to connect these rooms.</p>\n\n<p>I'm struggling with the traversing through a list and getting the parent.</p>\n\n<p>Here are the data structures I currently have:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct MapSectionPosition {\n    x: f32,\n    y: f32,\n}\n\nstruct MapSectionRect {\n    top_left: MapSectionPosition,\n    top_right: MapSectionPosition,\n    bottom_right: MapSectionPosition,\n    bottom_left: MapSectionPosition,\n}\n\nstruct MapSection {\n    width: f32,\n    height: f32,\n    points: MapSectionRect,\n}\n\nstruct RoomExit {\n    position: MapSectionPosition,\n}\n\nstruct Room {\n    width: f32,\n    height: f32,\n    exit: RoomExit,\n}\n</code></pre>\n\n<p>At the moment I'm using a linked list:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let mut rooms: LinkedList&lt;Room&gt; = LinkedList::new();\n\nlet room = Room {\n    width: section.width / 4.0,\n    height: section.height / 4.0,\n    exit: RoomExit {\n        position: MapSectionPosition { x: 20.0, y: 20.0 },\n    },\n};\n\nrooms.push_back(room);\n</code></pre>\n\n<p>I'm struggling to both iterate and get the parent, so I'm thinking this might not be the right data structure.</p>\n\n<p>With some playing around I've found a hacky solution. Hopefully this will better illustrate what I'm trying to do and if there is something more elegant.</p>\n\n<pre><code>let mut previous_room: Option&lt;&amp;Room&gt; = None;\nfor room in rooms.iter() {\n    match previous_room {\n        Some(p_room) =&gt; {\n            println!(\"previous {}\", p_room.width);\n            println!(\"current {}\", room.width);\n            println!(\"connected\");\n        },\n        None =&gt; {\n            println!(\"no previous room\");\n        }\n    }\n\n    previous_room = Some(room);\n}\n</code></pre>\n\n<p><strong>Something a little more elegant</strong></p>\n\n<p>If rooms are a slice, then we can use the <code>windows</code> method to create an iterator to access the data in question.</p>\n\n<pre><code>let mut iter = rooms[..].windows(2);\nwhile let Some([prev, next]) = iter.next() {\n    println!(\"prev - {}\", prev.width);\n    println!(\"next - {}\", next.width);\n    println!(\"done...\")\n}\n</code></pre>\n\n<p>This has been answered before in <a href=\"https://stackoverflow.com/q/42134874/155423\">Are there equivalents to slice::chunks/windows for iterators to loop over pairs, triplets etc?</a></p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1559060770, "post_id": 56346380, "comment_id": 99297947, "body": "What exactly is your question?"}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1559061202, "post_id": 56346380, "comment_id": 99298158, "body": "<a href=\"https://doc.rust-lang.org/reference/expressions/loop-expr.html#iterator-loops\" rel=\"nofollow noreferrer\">doc.rust-lang.org/reference/expressions/&hellip;</a>, please check the <code>is equivalent to</code> part"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1559061224, "post_id": 56346380, "comment_id": 99298173, "body": "Think of the operation <code>a[index]</code> for an arbitrary slice <code>a</code>. What must the program do to ensure that reading the element at position <code>index</code> is safe? Now read that paragraph again."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 11568498, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-27yHeJjgsIE/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jJxFv6JErhivdMAOU9G87U60dR6Q/mo/photo.jpg?sz=128", "display_name": "Chubo Chan", "link": "https://stackoverflow.com/users/11568498/chubo-chan"}, "edited": false, "score": 0, "creation_date": 1559108205, "post_id": 56347326, "comment_id": 99311631, "body": "This hit the nail! Thank you very much."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 2, "creation_date": 1559134810, "post_id": 56347326, "comment_id": 99325737, "body": "It should be noted that the optimizer may (or may not) be able to remove the bounds check in the <code>while</code> case. If it succeeds, then performance is equivalent; if it fails, suddenly your code is slower. In microbenchmarks, with simple code, changes are it will succeed... but this may not carry to your production code, or it may carry now, and the next change in the loop body will prevent the optimization, etc... In short, a <code>while</code> loop can be a performance ticking bomb."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 5, "last_activity_date": 1559135349, "last_edit_date": 1559135349, "creation_date": 1559064324, "answer_id": 56347326, "question_id": 56346380, "link": "https://stackoverflow.com/questions/56346380/why-does-the-rust-documentation-say-that-a-while-loop-over-an-array-is-slower-th/56347326#56347326", "title": "Why does the Rust documentation say that a while loop over an array is slower than a for loop?", "body": "<p>The two parts are complementary:</p>\n\n<blockquote>\n  <p>we could cause the program to panic if the index length is incorrect.</p>\n</blockquote>\n\n<p>Every time you write <code>some_slice[some_index]</code>, the standard library does the equivalent of:</p>\n\n<pre><code>if some_index &lt; some_slice.len() {\n    some_slice.get_the_value_without_checks(some_index)\n} else {\n    panic!(\"Hey, stop that\");\n}\n</code></pre>\n\n<blockquote>\n  <p>the compiler adds runtime code to perform the conditional check on every element</p>\n</blockquote>\n\n<p>In a loop, this works out to be something like:</p>\n\n<pre><code>while some_index &lt; limit {\n    if some_index &lt; some_slice.len() {\n        some_slice.get_the_value_without_checks(some_index)\n    } else {\n        panic!(\"Hey, stop that\");\n    }\n    some_index += 1;\n}\n</code></pre>\n\n<p>Those repeated conditionals aren't the most efficient code.</p>\n\n<p>The implementations of <code>Iterator</code> for slices utilize <code>unsafe</code> code to be more efficient at the expense of more complicated code. The iterators contain raw pointers to the data but ensure that you can never misuse them to cause memory unsafety. Without needing to perform that conditional at each step, the iterator solution is <em>often</em> faster<sup>1</sup>. It's more-or-less equivalent to:</p>\n\n<pre><code>while some_index &lt; limit {\n    some_slice.get_the_value_without_checks(some_index)\n    some_index += 1;\n}\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/47542438/155423\">Does Rust&#39;s array bounds checking affect performance?</a></li>\n<li><a href=\"https://stackoverflow.com/q/33109882/155423\">Does Rust optimize for loops over calculated ranges?</a></li>\n</ul>\n\n<hr>\n\n<p><strong>1</strong> \u2014 as <a href=\"https://stackoverflow.com/questions/56346380/why-does-the-rust-documentation-say-that-a-while-loop-over-an-array-is-slower-th/56347326?noredirect=1#comment99325737_56347326\">Matthieu M. points out</a>:</p>\n\n<blockquote>\n  <p>It should be noted that the optimizer may (or may not) be able to remove the bounds check in the <code>while</code> case. If it succeeds, then performance is equivalent; if it fails, suddenly your code is slower. In microbenchmarks, with simple code, changes are it will succeed... but this may not carry to your production code, or it may carry now, and the next change in the loop body will prevent the optimization, etc... In short, a <code>while</code> loop can be a performance ticking bomb.</p>\n</blockquote>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/37514909/155423\">Why does my code run slower when I remove bounds checks?</a></li>\n</ul>\n"}], "owner": {"reputation": 23, "user_id": 11568498, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-27yHeJjgsIE/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jJxFv6JErhivdMAOU9G87U60dR6Q/mo/photo.jpg?sz=128", "display_name": "Chubo Chan", "link": "https://stackoverflow.com/users/11568498/chubo-chan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 339, "favorite_count": 0, "accepted_answer_id": 56347326, "answer_count": 1, "score": 2, "last_activity_date": 1559135349, "creation_date": 1559060263, "last_edit_date": 1559062916, "question_id": 56346380, "link": "https://stackoverflow.com/questions/56346380/why-does-the-rust-documentation-say-that-a-while-loop-over-an-array-is-slower-th", "title": "Why does the Rust documentation say that a while loop over an array is slower than a for loop?", "body": "<p>As I was reading the rust documentation, I stumbled upon <a href=\"https://doc.rust-lang.org/book/ch03-05-control-flow.html#looping-through-a-collection-with-for\" rel=\"nofollow noreferrer\">this code</a> that iterates the array <code>a</code> using a while loop (with an index):</p>\n\n<pre><code>fn main() {\n    let a = [10, 20, 30, 40, 50];\n    let mut index = 0;\n\n    while index &lt; 5 {\n        println!(\"the value is: {}\", a[index]);\n\n        index += 1;\n    }\n}\n</code></pre>\n\n<p>The documentation says:</p>\n\n<blockquote>\n  <p>... this approach is error prone; we could cause the program to panic if the index length is incorrect. It\u2019s also slow, because the compiler adds runtime code to perform the conditional check on every element on every iteration through the loop.</p>\n</blockquote>\n\n<p>The first reason was self-explanatory. The second reason was where I got confused.</p>\n\n<p>Furthermore, they suggested to use a for-loop for this.</p>\n\n<pre><code>fn main() {\n    let a = [10, 20, 30, 40, 50];\n\n    for element in a.iter() {\n        println!(\"the value is: {}\", element);\n    }\n}\n</code></pre>\n\n<p>I just can't seem to wrap my head around this. Is there some kind of behavior that the Rust compiler does?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 8772, "user_id": 41713, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/ksuyd.jpg?s=128&g=1", "display_name": "jle", "link": "https://stackoverflow.com/users/41713/jle"}, "edited": false, "score": 0, "creation_date": 1605557896, "post_id": 56347061, "comment_id": 114681776, "body": "This does not work for me--the output all gets written to a file called &quot;logfile&quot; as the path is one of the parameters for RollingFileAppender::builder().build("}, {"owner": {"reputation": 8772, "user_id": 41713, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/ksuyd.jpg?s=128&g=1", "display_name": "jle", "link": "https://stackoverflow.com/users/41713/jle"}, "edited": false, "score": 0, "creation_date": 1605559221, "post_id": 56347061, "comment_id": 114682326, "body": "Unless the roller is used in addition to the primary log file?"}, {"owner": {"reputation": 8772, "user_id": 41713, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/ksuyd.jpg?s=128&g=1", "display_name": "jle", "link": "https://stackoverflow.com/users/41713/jle"}, "edited": false, "score": 0, "creation_date": 1605559860, "post_id": 56347061, "comment_id": 114682596, "body": "Ok it appears that there are two paths. Primary log file path &quot;logfile&quot; and then the rolling file path, which is the &#39;archive&#39; path. It will fill up primary and then send to archive when that is full."}, {"owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "reply_to_user": {"reputation": 8772, "user_id": 41713, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/ksuyd.jpg?s=128&g=1", "display_name": "jle", "link": "https://stackoverflow.com/users/41713/jle"}, "edited": false, "score": 0, "creation_date": 1605614332, "post_id": 56347061, "comment_id": 114698669, "body": "@jle yes this is the main idea behind file rolling. You are handling these via 2 parameters as <code>window size</code> and <code>roll size</code> as I mention on the answer"}], "tags": [], "owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "is_accepted": true, "score": 6, "last_activity_date": 1559106948, "last_edit_date": 1559106948, "creation_date": 1559063111, "answer_id": 56347061, "question_id": 56345288, "link": "https://stackoverflow.com/questions/56345288/how-do-i-use-log4rs-rollingfileappender-to-incorporate-rolling-logging/56347061#56347061", "title": "How do I use log4rs&#39; RollingFileAppender to incorporate rolling logging?", "body": "<p>You can implement it via using <a href=\"https://docs.rs/log4rs/0.8.3/log4rs/append/rolling_file/policy/compound/struct.CompoundPolicy.html\" rel=\"noreferrer\"><code>RollingFileAppender</code></a> <a href=\"https://docs.rs/log4rs/0.8.3/log4rs/append/rolling_file/policy/compound/struct.CompoundPolicy.html\" rel=\"noreferrer\"><code>CompoundPolicy</code></a> , <a href=\"https://docs.rs/log4rs/0.8.3/log4rs/append/rolling_file/policy/compound/roll/fixed_window/struct.FixedWindowRoller.html\" rel=\"noreferrer\"><code>FixedWindowRoller</code></a> and <a href=\"https://docs.rs/log4rs/0.8.3/log4rs/append/rolling_file/policy/compound/trigger/size/struct.SizeTrigger.html\" rel=\"noreferrer\"><code>SizeTrigger</code></a> from <code>log4rs</code> crate.</p>\n\n<p>You need to implement the followings in order to create your rolling file logic:</p>\n\n<ol>\n<li><code>FixedWindowRoller</code></li>\n</ol>\n\n<p>Specify <code>FixedWindowRoller</code> to roll your log file in a fixed <code>window_size</code> like following:</p>\n\n<pre><code>let window_size = 3; // log0, log1, log2\nlet fixed_window_roller = \nFixedWindowRoller::builder().build(\"log{}\",window_size).unwrap();\n</code></pre>\n\n<ol start=\"2\">\n<li><code>SizeTrigger</code></li>\n</ol>\n\n<p>Specify <code>SizeTrigger</code> to declare the size limit of the file to trigger the <code>Roller</code> like following:</p>\n\n<pre><code>let size_limit = 5 * 1024; // 5KB as max log file size to roll\nlet size_trigger = SizeTrigger::new(size_limit);\n</code></pre>\n\n<ol start=\"3\">\n<li><code>CompoundPolicy</code></li>\n</ol>\n\n<p>Declare <code>CompoundPolicy</code> to use it in <code>RollingFileAppender</code> like following:</p>\n\n<pre><code>let compound_policy = CompoundPolicy::new(Box::new(size_trigger),Box::new(fixed_window_roller));\n</code></pre>\n\n<p>Then in your <code>Config</code>, you need to use <code>RollingFileAppender</code> in order to get desired behavior.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let config = Config::builder()\n    .appender(\n        Appender::builder()\n            .filter(Box::new(ThresholdFilter::new(LevelFilter::Debug)))\n            .build(\n                \"logfile\",\n                Box::new(\n                    RollingFileAppender::builder()\n                        .encoder(Box::new(PatternEncoder::new(\"{d} {l}::{m}{n}\")))\n                        .build(\"logfile\", Box::new(compound_policy))?,\n                ),\n            ),\n    )\n    .build(\n        Root::builder()\n            .appender(\"logfile\")\n            .build(LevelFilter::Debug),\n    )?;\n</code></pre>\n\n<p>With this implementation, you get a rolling file for the <code>window size 3</code> and the <code>roll size 5KB</code></p>\n\n<hr>\n\n<p><strong>Note:</strong> <em>If you want to have a <code>custom roller</code> and <code>custom trigger</code> for your own purpose, you can implement your own <a href=\"https://docs.rs/log4rs/0.8.3/log4rs/append/rolling_file/policy/compound/trigger/trait.Trigger.html\" rel=\"noreferrer\"><code>Trigger</code></a> and <a href=\"https://docs.rs/log4rs/0.8.3/log4rs/append/rolling_file/policy/compound/roll/trait.Roll.html\" rel=\"noreferrer\"><code>Roller</code></a> from the respective traits</em></p>\n"}], "owner": {"reputation": 10424, "user_id": 4047092, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/n5HM6.jpg?s=128&g=1", "display_name": "ravi", "link": "https://stackoverflow.com/users/4047092/ravi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 672, "favorite_count": 0, "accepted_answer_id": 56347061, "answer_count": 1, "score": 1, "last_activity_date": 1559106948, "creation_date": 1559056449, "last_edit_date": 1559065051, "question_id": 56345288, "link": "https://stackoverflow.com/questions/56345288/how-do-i-use-log4rs-rollingfileappender-to-incorporate-rolling-logging", "title": "How do I use log4rs&#39; RollingFileAppender to incorporate rolling logging?", "body": "<p>I am trying to build a logger based on a rolling policy. Below is the closest I was able to implement:</p>\n\n<pre><code>let logfile = FileAppender::builder()\n    .encoder(Box::new(PatternEncoder::new(\"{d} {l}::{m}{n}\")))\n    .build(\"log/output.log\")?;\n\nlet config = Config::builder()\n    .appender(Appender::builder().build(\"logfile\", Box::new(logfile)))\n    .build(Root::builder()\n                .appender(\"logfile\")\n                .build(LevelFilter::Debug))?;\n\nlog4rs::init_config(config)?;\n</code></pre>\n\n<p>This helped me log messages at all levels. However, logging to a file for a long time can be a dangerous proposition. Consequently, I am looking for something which can limit the amount of log data that's preserved. I came across <a href=\"https://docs.rs/log4rs/0.8.3/log4rs/append/rolling_file/struct.RollingFileAppender.html\" rel=\"nofollow noreferrer\"><code>RollingFileAppender</code></a>, but I am not able to find the proper usage of <a href=\"https://docs.rs/log4rs/0.8.3/log4rs/append/rolling_file/policy/trait.Policy.html\" rel=\"nofollow noreferrer\"><code>Policy</code></a>.</p>\n\n<p>Please guide me through this. I am mostly looking for programmatic configuration.</p>\n"}, {"tags": ["rust", "traits"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1559049875, "post_id": 56343245, "comment_id": 99291546, "body": "<code>T</code> is a bad name for a trait, because if I see <code>Box&lt;T&gt;</code> I expect <code>T</code> to be a generic type parameter that has been provided via the struct, e.g. <code>struct S2&lt;T&gt; {}</code>. should be something longer"}], "answers": [{"tags": [], "owner": {"reputation": 35470, "user_id": 6348498, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/0zu4m.jpg?s=128&g=1", "display_name": "Gurwinder Singh", "link": "https://stackoverflow.com/users/6348498/gurwinder-singh"}, "is_accepted": false, "score": 0, "last_activity_date": 1559052192, "last_edit_date": 1559052192, "creation_date": 1559051577, "answer_id": 56343799, "question_id": 56343245, "link": "https://stackoverflow.com/questions/56343245/how-to-implement-the-debug-trait-for-struct-that-has-a-trait-object-member/56343799#56343799", "title": "How to implement the Debug trait for struct that has a trait object member?", "body": "<p>You can make <code>S2</code> generic but you don't need to specify that the type should also implement <code>Debug</code> right there. Instead, you can specify it in the <code>impl</code>:</p>\n\n<pre><code>struct S2&lt;A: Tr&gt; {\n    member: Box&lt;A&gt;,\n}\n\nimpl&lt;A: Tr + std::fmt::Debug&gt; std::fmt::Debug for S2&lt;A&gt; {\n    fn fmt(&amp;self, fmt: &amp;mut std::fmt::Formatter&lt;'_&gt;) -&gt; Result&lt;(), std::fmt::Error&gt; {\n        write!(fmt, \"S2 {{ member: {:?} }}\", self.member)?;\n        Ok(())\n    }\n}\n</code></pre>\n\n<p>This way, <code>S2</code> will implement <code>Debug</code> if the actual type does.</p>\n"}, {"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1559052415, "post_id": 56343914, "comment_id": 99293094, "body": "<i><code>Result&lt;(), std::fmt::Error&gt;</code></i> \u2014 it&#39;s customary to just use <code>std::fmt::Result</code>."}, {"owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559052816, "post_id": 56343914, "comment_id": 99293333, "body": "@Shepmaster, revised the answer regarding your comments"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559053179, "post_id": 56343914, "comment_id": 99293566, "body": "It&#39;s customary to provide a blanket impl of <code>MyTraitWritable</code>; something like <code>impl&lt;T: MyTrait + Debug&gt; MyTraitWritable for T {}</code> (as shown in the linked duplicates)."}], "tags": [], "owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "is_accepted": true, "score": 2, "last_activity_date": 1559052725, "last_edit_date": 1559052725, "creation_date": 1559051975, "answer_id": 56343914, "question_id": 56343245, "link": "https://stackoverflow.com/questions/56343245/how-to-implement-the-debug-trait-for-struct-that-has-a-trait-object-member/56343914#56343914", "title": "How to implement the Debug trait for struct that has a trait object member?", "body": "<blockquote>\n  <p>Is it possible to implement <code>Debug</code> for a struct like <code>S2</code>?</p>\n</blockquote>\n\n<p>Yes you can, and this is clearly pointed out in the <a href=\"https://doc.rust-lang.org/std/fmt/trait.Debug.html\" rel=\"nofollow noreferrer\">Book</a></p>\n\n<p>You need to implement the <code>Debug</code> trait for your <code>S2</code> like following:</p>\n\n<pre><code>trait MyTrait {}\nimpl MyTrait for usize {}\nimpl MyTrait for String {}\n\ntrait MyTraitWritable: MyTrait + Debug {}\nimpl MyTraitWritable for usize {}\nimpl MyTraitWritable for String {}\n\nimpl std::fmt::Debug for S2 {\n    fn fmt(&amp;self, fmt: &amp;mut std::fmt::Formatter&lt;'_&gt;) -&gt; Result&lt;(), std::fmt::Error&gt; {\n        write!(fmt, \"S2 {{ member: {:?} }}\", self.member)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=0129104923b5110927e2eb0722e2db68\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 429, "user_id": 5546006, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/62f45b4ae19e76aea4911e9cb5d7d92e?s=128&d=identicon&r=PG&f=1", "display_name": "letrec", "link": "https://stackoverflow.com/users/5546006/letrec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2117, "favorite_count": 0, "closed_date": 1559052571, "accepted_answer_id": 56343914, "answer_count": 2, "score": 2, "last_activity_date": 1559052725, "creation_date": 1559049676, "last_edit_date": 1559052150, "question_id": 56343245, "link": "https://stackoverflow.com/questions/56343245/how-to-implement-the-debug-trait-for-struct-that-has-a-trait-object-member", "closed_reason": "Duplicate", "title": "How to implement the Debug trait for struct that has a trait object member?", "body": "<p>My goal is printing the contents of struct that has trait object member but I can't find how to tell Rust compiler that the member also implements other traits like <code>Display</code> or <code>Debug</code>.</p>\n\n<p>For example, in the following program, I want to print the structure of <code>S2</code> (and <code>S1</code> for comparison) but I get stuck in the implementation of <code>fmt</code>.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait Tr {}\n\nimpl Tr for usize {}\n\nimpl Tr for String {}\n\n#[derive(Debug)]\nstruct S1&lt;A: Tr + std::fmt::Debug&gt; {\n    member: Box&lt;A&gt;,\n}\n\nstruct S2 {\n    member: Box&lt;Tr&gt;,\n}\n\nimpl std::fmt::Debug for S2 {\n    fn fmt(&amp;self, fmt: &amp;mut std::fmt::Formatter&lt;'_&gt;) -&gt; Result&lt;(), std::fmt::Error&gt; {\n        // ??\n        Ok(())\n    }\n}\n\nfn main() {\n    let s1 = S1 {\n        member: Box::new(String::from(\"abc\")),\n    };\n\n    println!(\"{:?}\", s1);\n\n    let s2 = S2 {\n        member: Box::new(String::from(\"abc\")),\n    };\n\n    println!(\"{:?}\", s2);\n}\n</code></pre>\n\n<p>My desired output of this program is</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>S1 { member: \"abc\" }\nS2 { member: \"abc\" }\n</code></pre>\n\n<p>Is it possible to implement <code>Debug</code> for a struct like <code>S2</code>?</p>\n\n<p>(Rust version: 1.35)</p>\n"}, {"tags": ["rust", "substrate"], "answers": [{"tags": [], "owner": {"reputation": 9375, "user_id": 1396977, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PylBh.jpg?s=128&g=1", "display_name": "Shawn Tabrizi", "link": "https://stackoverflow.com/users/1396977/shawn-tabrizi"}, "is_accepted": true, "score": 1, "last_activity_date": 1559044811, "creation_date": 1559044811, "answer_id": 56341801, "question_id": 56341343, "link": "https://stackoverflow.com/questions/56341343/is-handling-the-imbalance-type-mandatory-after-withdraw-or-deposit/56341801#56341801", "title": "Is handling the `Imbalance` type mandatory after withdraw or deposit?", "body": "<p>You get back an <code>Imbalance</code> whenever you perform some <a href=\"https://github.com/paritytech/substrate/pull/2048\" rel=\"nofollow noreferrer\">\"one-sided operation\" within the Balances module</a> (<code>deposit</code>, <code>slash</code>, <code>withdraw</code>, etc...).</p>\n\n<p>The both <code>PositiveImbalance</code> and <code>NegativeImbalance</code> implement the <a href=\"https://doc.rust-lang.org/std/ops/trait.Drop.html\" rel=\"nofollow noreferrer\"><code>Drop</code></a> trait, which defines a destructor function that gets called when a variable goes out of scope. </p>\n\n<p>In the case of an <code>Imbalance</code>, the <code>drop</code> function simply updates the total issuance of the balances module to ensure that the sum of all current account balances is equal to the total issuance.</p>\n\n<p>So by default, <strong>no, you do not need to do anything with the imbalance returned to you.</strong> You can just place the result of a \"one-sided operation\" into an unused variable like so:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let _ = &lt;balances::Module&lt;T&gt; as Currency&lt;_&gt;&gt;::withdraw(...)?;\n</code></pre>\n\n<p>However, if you want to, you are also given a set of tools to manage imbalances returned to you:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl&lt;T: Trait&lt;I&gt;, I: Instance&gt; Imbalance&lt;T::Balance&gt; for NegativeImbalance&lt;T, I&gt; {\n    type Opposite = PositiveImbalance&lt;T, I&gt;;\n\n    fn zero() -&gt; Self {...}\n\n    fn drop_zero(self) -&gt; result::Result&lt;(), Self&gt; {...}\n\n    fn split(self, amount: T::Balance) -&gt; (Self, Self) {...}\n\n    fn merge(mut self, other: Self) -&gt; Self {...}\n\n    fn subsume(&amp;mut self, other: Self) {...}\n\n    fn offset(self, other: Self::Opposite) -&gt; result::Result&lt;Self, Self::Opposite&gt; {...}\n\n    fn peek(&amp;self) -&gt; T::Balance {...}\n}\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 4145786, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VbHaAFfgQak/AAAAAAAAAAI/AAAAAAAAAMM/-rLZqpjprAA/photo.jpg?sz=128", "display_name": "Stanis\u0142aw Drozd", "link": "https://stackoverflow.com/users/4145786/stanis%c5%82aw-drozd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 56341801, "answer_count": 1, "score": 1, "last_activity_date": 1559050500, "creation_date": 1559043326, "last_edit_date": 1559050500, "question_id": 56341343, "link": "https://stackoverflow.com/questions/56341343/is-handling-the-imbalance-type-mandatory-after-withdraw-or-deposit", "title": "Is handling the `Imbalance` type mandatory after withdraw or deposit?", "body": "<p>When using any of the functions which mint/burn the base currency (e.g. <code>Currency::withdraw()</code>), you're given an <code>Imbalance</code> return value. Does Substrate expect me to do something with it?</p>\n"}, {"tags": ["rust", "substrate"], "answers": [{"tags": [], "owner": {"reputation": 9375, "user_id": 1396977, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PylBh.jpg?s=128&g=1", "display_name": "Shawn Tabrizi", "link": "https://stackoverflow.com/users/1396977/shawn-tabrizi"}, "is_accepted": false, "score": 1, "last_activity_date": 1559042777, "creation_date": 1559042777, "answer_id": 56341172, "question_id": 56341171, "link": "https://stackoverflow.com/questions/56341171/what-are-the-supported-hashing-algorithms-in-a-substrate-runtime-module/56341172#56341172", "title": "What are the supported hashing algorithms in a Substrate runtime module?", "body": "<p>As of writing this post, Substrate provides a <code>HashingApi</code> trait in the <a href=\"https://github.com/paritytech/substrate/tree/master/core/sr-io\" rel=\"nofollow noreferrer\"><code>core/sr-io</code></a> crate which provides the following hash functions:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>export_api! {\n    pub(crate) trait HashingApi {\n        /// Conduct a 256-bit Keccak hash.\n        fn keccak_256(data: &amp;[u8]) -&gt; [u8; 32] ;\n\n        /// Conduct a 128-bit Blake2 hash.\n        fn blake2_128(data: &amp;[u8]) -&gt; [u8; 16];\n\n        /// Conduct a 256-bit Blake2 hash.\n        fn blake2_256(data: &amp;[u8]) -&gt; [u8; 32];\n\n        /// Conduct four XX hashes to give a 256-bit result.\n        fn twox_256(data: &amp;[u8]) -&gt; [u8; 32];\n\n        /// Conduct two XX hashes to give a 128-bit result.\n        fn twox_128(data: &amp;[u8]) -&gt; [u8; 16];\n\n        /// Conduct two XX hashes to give a 64-bit result.\n        fn twox_64(data: &amp;[u8]) -&gt; [u8; 8];\n    }\n}\n</code></pre>\n\n<p>Because these functions are written for the Runtime, which must build to Wasm, they must compile without the use of the standard Rust library (<code>std</code>).</p>\n\n<p>If you want to introduce new hashing algorithms or any new library to your Substrate runtime, you must make sure that it too can be built without <code>std</code>, but other than that, I believe the sky is the limit.</p>\n"}], "owner": {"reputation": 9375, "user_id": 1396977, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PylBh.jpg?s=128&g=1", "display_name": "Shawn Tabrizi", "link": "https://stackoverflow.com/users/1396977/shawn-tabrizi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1559050494, "creation_date": 1559042777, "last_edit_date": 1559050494, "question_id": 56341171, "link": "https://stackoverflow.com/questions/56341171/what-are-the-supported-hashing-algorithms-in-a-substrate-runtime-module", "title": "What are the supported hashing algorithms in a Substrate runtime module?", "body": "<p>What hashing algorithms do I have access to when building a Substrate runtime module?</p>\n\n<p>Can I import other hashing algorithms to be used within a Substrate runtime module?</p>\n"}, {"tags": ["rust", "rust-diesel"], "comments": [{"owner": {"reputation": 34162, "user_id": 84478, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/f4cdb7db0efa2c5a63fb0a0796be2bb3?s=128&d=identicon&r=PG", "display_name": "Carson Myers", "link": "https://stackoverflow.com/users/84478/carson-myers"}, "edited": false, "score": 0, "creation_date": 1559048693, "post_id": 56341062, "comment_id": 99290845, "body": "Does it work if you use <code>T::Output: LimitDsl</code> instead of <code>&lt;T as OffsetDsl&gt;::Output: LimitDsl</code>? I tried to <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2fb3f14df86a48bdd309a196a72c390a\" rel=\"nofollow noreferrer\">reproduce the issue in rust playground</a> but it seems to work fine - diesel doesn&#39;t seem to be supported in the playground so I haven&#39;t tried testing it with the real library yet"}, {"owner": {"reputation": 34162, "user_id": 84478, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/f4cdb7db0efa2c5a63fb0a0796be2bb3?s=128&d=identicon&r=PG", "display_name": "Carson Myers", "link": "https://stackoverflow.com/users/84478/carson-myers"}, "edited": false, "score": 0, "creation_date": 1559048831, "post_id": 56341062, "comment_id": 99290915, "body": "what version/edition of rust are you using and which channel? Also which version of diesel?"}, {"owner": {"reputation": 75, "user_id": 11563579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7f8bc6e72238f85fdc6d03c6c1e7f2a?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/11563579/max"}, "reply_to_user": {"reputation": 34162, "user_id": 84478, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/f4cdb7db0efa2c5a63fb0a0796be2bb3?s=128&d=identicon&r=PG", "display_name": "Carson Myers", "link": "https://stackoverflow.com/users/84478/carson-myers"}, "edited": false, "score": 0, "creation_date": 1559048865, "post_id": 56341062, "comment_id": 99290930, "body": "Nope. :(  I guess it might have something to do with the way how Diesel define these traits, but I cannot figure out how."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1559048924, "post_id": 56341062, "comment_id": 99290966, "body": "The constraint solver in the Rust compiler can sometimes be a bit fragile \u2013 see also <a href=\"https://users.rust-lang.org/t/weird-compiler-issue-overflow-evaluating-the-requirement/27051\" rel=\"nofollow noreferrer\">this question on URLO</a> for another example."}, {"owner": {"reputation": 34162, "user_id": 84478, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/f4cdb7db0efa2c5a63fb0a0796be2bb3?s=128&d=identicon&r=PG", "display_name": "Carson Myers", "link": "https://stackoverflow.com/users/84478/carson-myers"}, "edited": false, "score": 0, "creation_date": 1559049688, "post_id": 56341062, "comment_id": 99291442, "body": "You could try restricting your implementation to certain types instead of all <code>OffsetDsl</code>s? <a href=\"https://docs.diesel.rs/src/diesel/query_dsl/limit_dsl.rs.html#18-28\" rel=\"nofollow noreferrer\">Have a look at how <code>LimitDsl</code> is implemented for <code>Table</code> for example</a> - it&#39;s similar to your <code>Paginator</code> but defines Output in the body and relative to the input type"}, {"owner": {"reputation": 75, "user_id": 11563579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7f8bc6e72238f85fdc6d03c6c1e7f2a?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/11563579/max"}, "edited": false, "score": 0, "creation_date": 1559050256, "post_id": 56341062, "comment_id": 99291793, "body": "&gt; You could try restricting your implementation to certain types instead of all OffsetDsl   I think the problem is with a bound on <code>T::Output: </code>.   If I remove this line (and a cal of .limit function) it works fine."}, {"owner": {"reputation": 75, "user_id": 11563579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7f8bc6e72238f85fdc6d03c6c1e7f2a?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/11563579/max"}, "edited": false, "score": 0, "creation_date": 1559050556, "post_id": 56341062, "comment_id": 99291995, "body": "I am sorry about multiple comments.  Cannot get used to the fact that SO sends comment on Enter."}, {"owner": {"reputation": 75, "user_id": 11563579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7f8bc6e72238f85fdc6d03c6c1e7f2a?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/11563579/max"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1559050664, "post_id": 56341062, "comment_id": 99292062, "body": "@SvenMarnach Thanks for the link. Yes, I&#39;ve read a lot of threads about this error.  I just don&#39;t understand why the solver behaves differently for a generic function and trait."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1559052949, "post_id": 56341062, "comment_id": 99293413, "body": "@Max Did you see the bit that adding and removing and unrelated, unused import changes whether the error occurs in the other question? This is why I posted it \u2013 it shows that the behaviour appears to be completely random, and can&#39;t be reasoned about without understand the implementation details of the compiler."}, {"owner": {"reputation": 75, "user_id": 11563579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7f8bc6e72238f85fdc6d03c6c1e7f2a?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/11563579/max"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1559053710, "post_id": 56341062, "comment_id": 99293868, "body": "@SvenMarnach Yes I did.  I thought about filling a bug in rust itself. They say that if rustc error message is not clear enough it should be considered as a bug, and I would say that this message is definitely not clear enough.    Problem is that I cannot come up with a minimal example. I tried to reproduce it with my traits instead of ones from Diesel, but with main it works perfectly."}, {"owner": {"reputation": 34162, "user_id": 84478, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/f4cdb7db0efa2c5a63fb0a0796be2bb3?s=128&d=identicon&r=PG", "display_name": "Carson Myers", "link": "https://stackoverflow.com/users/84478/carson-myers"}, "edited": false, "score": 0, "creation_date": 1559055124, "post_id": 56341062, "comment_id": 99294710, "body": "@Max I have the same problem, if I build with Diesel&#39;s traits, it fails, but with my own it&#39;s fine. It might be related to <a href=\"https://github.com/rust-lang/rust/issues/34260\" rel=\"nofollow noreferrer\">this rustc bug</a> which I found from <a href=\"https://github.com/rust-lang/rust/issues/47032\" rel=\"nofollow noreferrer\">this other filed bug</a> - it seems to be unresolved"}, {"owner": {"reputation": 75, "user_id": 11563579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7f8bc6e72238f85fdc6d03c6c1e7f2a?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/11563579/max"}, "edited": false, "score": 0, "creation_date": 1559063111, "post_id": 56341062, "comment_id": 99299016, "body": "I still don&#39;t understand why but the solution suggested by Shepmaster works.  Thanks for your answers, guys!"}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 11563579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7f8bc6e72238f85fdc6d03c6c1e7f2a?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/11563579/max"}, "edited": false, "score": 0, "creation_date": 1559063014, "post_id": 56345105, "comment_id": 99298976, "body": "It works! Thank you! Should have try it myself. It&#39;s a bit strange though, because in this case I can implement this method inside trait definition and I don&#39;t need an implementation at all.  Thanks for the link! I&#39;ve read it, but it seems a bit overcomplicated for a simple task I want it to do."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 1, "last_activity_date": 1559055815, "creation_date": 1559055815, "answer_id": 56345105, "question_id": 56341062, "link": "https://stackoverflow.com/questions/56341062/why-do-i-get-overflow-evaluating-the-requirement-when-rewriting-a-function-usi/56345105#56345105", "title": "Why do I get &quot;overflow evaluating the requirement&quot; when rewriting a function using Diesel&#39;s traits into a trait method?", "body": "<p>I cannot answer <em>why</em> they differ. I can say that repeating the bounds on the trait definition compiles:</p>\n\n<pre><code>use diesel::query_dsl::methods::{LimitDsl, OffsetDsl};\n\ntrait Paginator\nwhere\n    Self: OffsetDsl,\n    Self::Output: LimitDsl,\n{\n    fn for_page(self);\n}\n\nimpl&lt;T&gt; Paginator for T\nwhere\n    T: OffsetDsl,\n    T::Output: LimitDsl,\n{\n    fn for_page(self) {\n        self.offset(10).limit(10);\n    }\n}\n</code></pre>\n\n<p>You may also be interested in the <a href=\"http://diesel.rs/guides/extending-diesel/\" rel=\"nofollow noreferrer\">extending Diesel guide</a>, which discusses how best to add a <code>paginate</code> method.</p>\n"}], "owner": {"reputation": 75, "user_id": 11563579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7f8bc6e72238f85fdc6d03c6c1e7f2a?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/11563579/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 1, "accepted_answer_id": 56345105, "answer_count": 1, "score": 2, "last_activity_date": 1559055815, "creation_date": 1559042429, "last_edit_date": 1559055493, "question_id": 56341062, "link": "https://stackoverflow.com/questions/56341062/why-do-i-get-overflow-evaluating-the-requirement-when-rewriting-a-function-usi", "title": "Why do I get &quot;overflow evaluating the requirement&quot; when rewriting a function using Diesel&#39;s traits into a trait method?", "body": "<p>I am trying to add pagination using Diesel. The compiler is able to check bounds on a generic type if I use a function but isn't if I try to do the same as an implementation of a trait. </p>\n\n<p>This is a simple working example:</p>\n\n<pre><code>use diesel::query_dsl::methods::{LimitDsl, OffsetDsl};\n\npub fn for_page&lt;T&gt;(query: T)\nwhere\n    T: OffsetDsl,\n    T::Output: LimitDsl,\n{\n    query.offset(10).limit(10);\n}\n</code></pre>\n\n<p><a href=\"https://docs.diesel.rs/diesel/query_dsl/methods/trait.OffsetDsl.html\" rel=\"nofollow noreferrer\"><code>OffsetDsl</code></a> and \n<a href=\"https://docs.diesel.rs/diesel/query_dsl/methods/trait.LimitDsl.html\" rel=\"nofollow noreferrer\"><code>LimitDsl</code></a> are Diesel's traits which provides the methods <code>offset</code> and <code>limit</code>. </p>\n\n<p>When I try to extract this method as a trait and implement it like this</p>\n\n<pre><code>use diesel::query_dsl::methods::{LimitDsl, OffsetDsl};\n\ntrait Paginator {\n    fn for_page(self);\n}\n\nimpl&lt;T&gt; Paginator for T\nwhere\n    T: OffsetDsl,\n    &lt;T as OffsetDsl&gt;::Output: LimitDsl,\n{\n    fn for_page(self) {\n        self.offset(10).limit(10);\n    }\n}\n</code></pre>\n\n<p>I get a not very clear error message. </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0275]: overflow evaluating the requirement `&lt;Self as diesel::query_dsl::offset_dsl::OffsetDsl&gt;::Output`\n --&gt; src/main.rs:3:1\n  |\n3 | / trait Paginator {\n4 | |     fn for_page(self);\n5 | | }\n  | |_^\n  |\n  = note: required because of the requirements on the impl of `Paginator` for `Self`\nnote: required by `Paginator`\n --&gt; src/main.rs:3:1\n  |\n3 | trait Paginator {\n  | ^^^^^^^^^^^^^^^\n\nerror[E0275]: overflow evaluating the requirement `&lt;Self as diesel::query_dsl::offset_dsl::OffsetDsl&gt;::Output`\n --&gt; src/main.rs:4:5\n  |\n4 |     fn for_page(self);\n  |     ^^^^^^^^^^^^^^^^^^\n  |\n  = note: required because of the requirements on the impl of `Paginator` for `Self`\nnote: required by `Paginator`\n --&gt; src/main.rs:3:1\n  |\n3 | trait Paginator {\n  | ^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I understand that this means that the compiler cannot check the condition on <code>T::Output</code>, but it's not clear what is the difference with a simple function with the same condition.</p>\n\n<p>I'm using Rust 1.35.0 and Diesel 1.4.</p>\n"}, {"tags": ["multidimensional-array", "rust"], "answers": [{"tags": [], "owner": {"reputation": 162, "user_id": 2325160, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cwY4L.jpg?s=128&g=1", "display_name": "kdrakon", "link": "https://stackoverflow.com/users/2325160/kdrakon"}, "is_accepted": true, "score": 3, "last_activity_date": 1559133291, "last_edit_date": 1559133291, "creation_date": 1559094740, "answer_id": 56352077, "question_id": 56340541, "link": "https://stackoverflow.com/questions/56340541/how-can-i-filter-out-specific-columns-in-a-ndarray/56352077#56352077", "title": "How can I filter out specific columns in a ndarray?", "body": "<p>According to <a href=\"https://docs.rs/ndarray/0.12.1/ndarray/struct.ArrayBase.html#method.reshape\" rel=\"nofollow noreferrer\">the ndarray docs</a>, <code>reshape</code> can only be used on an <code>ArcArray</code>. For any other array, use <code>into_shape</code>:</p>\n\n<pre><code>let b = b.into_shape((2, 2));\n</code></pre>\n"}], "owner": {"reputation": 1069, "user_id": 5417164, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/9cb24e9b54605c9f72cf40cf425fc814?s=128&d=identicon&r=PG&f=1", "display_name": "joydeep bhattacharjee", "link": "https://stackoverflow.com/users/5417164/joydeep-bhattacharjee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 56352077, "answer_count": 1, "score": 0, "last_activity_date": 1559133426, "creation_date": 1559040524, "last_edit_date": 1559133426, "question_id": 56340541, "link": "https://stackoverflow.com/questions/56340541/how-can-i-filter-out-specific-columns-in-a-ndarray", "title": "How can I filter out specific columns in a ndarray?", "body": "<p>If you want specific columns in NumPy, you can do <code>data[:, columnslist]</code>. For example, if you want columns 1 and 9</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>data[:, [1, 9]]\n</code></pre>\n\n<p>How can I do this using Rust's ndarray? I have gone through <a href=\"https://docs.rs/ndarray/0.12.1/ndarray/doc/ndarray_for_numpy_users/index.html\" rel=\"nofollow noreferrer\"><code>ndarray</code> for NumPy users</a>, but they don't have any similar example. Below is what I tried.</p>\n\n<pre><code>let a = arr2(&amp;[[1., 2., 3.], [4., 5., 6.]]);\nlet b = stack(Axis(0), &amp;[a.column(1).view(), a.column(2).view()]).unwrap();\nlet b = Array::from_iter(b.iter());\nlet b = b.reshape((2, 2));\n</code></pre>\n\n<p>which gives the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `ndarray::OwnedRepr&lt;&amp;{float}&gt;: ndarray::data_traits::DataShared` is not satisfied\n   --&gt; src/main.rs:143:15\n    |\n143 |     let b = b.reshape((2,2));\n    |               ^^^^^^^ the trait `ndarray::data_traits::DataShared` is not implemented for `ndarray::OwnedRepr&lt;&amp;{float}&gt;`\n</code></pre>\n"}, {"tags": ["rust", "ownership"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 3, "creation_date": 1559040347, "post_id": 56339849, "comment_id": 99286149, "body": "Why don&#39;t you use <code>fn get_structB(&amp;self, idx: usize) -&gt; Option&lt;&amp;StructB&gt; { self.array.get(idx) }</code>?"}, {"owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1559040610, "post_id": 56339849, "comment_id": 99286281, "body": "@hellow, He may want to send that variable into some thread which wants to own the data itself maybe. Rc can be useful in such scenario"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1559040676, "post_id": 56339849, "comment_id": 99286312, "body": "Doesn&#39;t matter. As long as you only want read only access you can pass around <code>&amp;StructB</code>. <code>RC</code> is not needed here IMHO."}, {"owner": {"reputation": 667, "user_id": 981403, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/PrBma.png?s=128&g=1", "display_name": "Mazeryt", "link": "https://stackoverflow.com/users/981403/mazeryt"}, "edited": false, "score": 0, "creation_date": 1559041806, "post_id": 56339849, "comment_id": 99286946, "body": "Yes I think Option to reference should be ok here. Just number of different Rust Wrappers makes me think many times what should be used where. And option gave me some associations with things Enum like? So That is why I started thinking with something like smart pointers."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1559042274, "post_id": 56339849, "comment_id": 99287187, "body": "@Mazeryt Use <code>Rc</code>/<code>Arc</code> when there isn&#39;t a definitive &quot;owner&quot; of the object. It will feel more OO because it&#39;s essentially adding a simple GC."}, {"owner": {"reputation": 667, "user_id": 981403, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/PrBma.png?s=128&g=1", "display_name": "Mazeryt", "link": "https://stackoverflow.com/users/981403/mazeryt"}, "reply_to_user": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1559042986, "post_id": 56339849, "comment_id": 99287559, "body": "@PeterHall  There may be multiple owners of this method and potentially catch the same object by more than one consumers. Will Option be still OK here?"}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1559053004, "post_id": 56342751, "comment_id": 99293452, "body": "By the way, it is not idiomatic Rust to use an explicit <code>return</code> at the end of a block."}], "tags": [], "owner": {"reputation": 1, "user_id": 5708140, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b5037e50463398d9c78841ba6bad374?s=128&d=identicon&r=PG&f=1", "display_name": "woodyyo", "link": "https://stackoverflow.com/users/5708140/woodyyo"}, "is_accepted": false, "score": 0, "last_activity_date": 1559052980, "last_edit_date": 1559052980, "creation_date": 1559048010, "answer_id": 56342751, "question_id": 56339849, "link": "https://stackoverflow.com/questions/56339849/how-can-i-return-a-reference-to-a-sub-element-of-a-nested-entry-in-a-structure/56342751#56342751", "title": "How can I return a reference to a sub-element of a nested entry in a structure?", "body": "<pre class=\"lang-rust prettyprint-override\"><code>impl StructA {\n    fn get_structB(&amp;self, i: usize) -&gt; &amp;StructB {\n        return &amp;self.array[i];\n    }\n}\n</code></pre>\n\n<p>This does the trick. However, you may encounter some problem if you write the following:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// `a` is a StructA instance\nlet bb = a.get_struct_b(0);\nprintln!(\"{:?}\", bb);\ndrop(a);              // move out of `a` occurs here\nprintln!(\"{:?}\", bb); // borrow of `a` is used here\n</code></pre>\n\n<p>You will have to modify your struct definition and use <code>Rc</code> to write the function. <code>Rc</code> introduces a little performance impact and makes the code more complex, so you may want to use it only when you know that the data will be used after moving <code>StructA</code>.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct StructA {\n    array: Vec&lt;Rc&lt;StructB&gt;&gt;,\n}\n\nimpl StructA {\n    fn get_structB(&amp;self, i: usize) -&gt; Rc&lt;StructB&gt; {\n        return Rc::clone(self.array[i]);\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 667, "user_id": 981403, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/PrBma.png?s=128&g=1", "display_name": "Mazeryt", "link": "https://stackoverflow.com/users/981403/mazeryt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1559052980, "creation_date": 1559038284, "last_edit_date": 1559052906, "question_id": 56339849, "link": "https://stackoverflow.com/questions/56339849/how-can-i-return-a-reference-to-a-sub-element-of-a-nested-entry-in-a-structure", "title": "How can I return a reference to a sub-element of a nested entry in a structure?", "body": "<p>I have structure with a vector of other structures:</p>\n\n<pre><code>pub struct StructB {\n    value1: u64,\n    value2: String,\n}\n\npub struct StructA {\n    array: Vec&lt;StructB&gt;,\n}\n</code></pre>\n\n<p><code>StructB</code> is constant; during the creation of <code>StructA</code>, an <code>array</code> is filled with the objects that are read from a file and is unlikely to be modified.</p>\n\n<p>I would like to have a function to get element <code>StructB</code> corresponding to an input parameter: <code>get_structB(input: u64) -&gt; &amp;StructB</code>. For the sake of simplicity, let's say that we will just return element with the given index, assuming that someone else is checking boundaries.</p>\n\n<p>I struggle with how to implement that in Rust. I would like to return a kind of \"read only\" reference or a reference to an object that is immutable but not doing a copy. I cannot figure out the proper way to do that.</p>\n\n<pre><code>impl StructA {\n    fn get_structB(&amp;self, idx: u64) -&gt; Box&lt;StructB&gt; {   // Or should I use here Rc?\n        // Here I don't want to consume self just return reference wrapped to the idx element\n        // Should I implement something like as_ref() for the StructA?\n        self.array[idx]     // That of course won't compile\n    }\n}\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1559027486, "post_id": 56336526, "comment_id": 99279299, "body": "<a href=\"https://doc.rust-lang.org/std/thread/fn.spawn.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/std/thread/fn.spawn.html</a> that&#39;s why"}, {"owner": {"reputation": 474, "user_id": 5905325, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t4Uf-a54iNo/AAAAAAAAAAI/AAAAAAAAAdA/jc13jE20tww/photo.jpg?sz=128", "display_name": "murphy", "link": "https://stackoverflow.com/users/5905325/murphy"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1559028585, "post_id": 56336526, "comment_id": 99279836, "body": "@hellow so what&#39;s the difference between the trait ref parameter and the Test ref parameter? Is the Test ref impliciltly &#39;static?"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1559029193, "post_id": 56336526, "comment_id": 99280158, "body": "You&#39;re cheating ;) You use <code>tester.clone()</code> and that&#39;s why it works without the <code>&#39;static</code>. If you remove that and move <code>tester</code> directly into the closure you will get the same error. <a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=3e51d8464bf0f6fdd04c4ba54518953a\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 474, "user_id": 5905325, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t4Uf-a54iNo/AAAAAAAAAAI/AAAAAAAAAdA/jc13jE20tww/photo.jpg?sz=128", "display_name": "murphy", "link": "https://stackoverflow.com/users/5905325/murphy"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1559029616, "post_id": 56336526, "comment_id": 99280383, "body": "@hellow sort of... :) Currently my effort goes mainly in the effort to get the code running and to understand how things work. I just tried to get the concrete implementation to a more general one. just hoped that I could move from <code>run_concrete_test</code> to <code>run_trait_test</code> without changes to the function body."}], "answers": [{"tags": [], "owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "is_accepted": true, "score": 3, "last_activity_date": 1584523127, "last_edit_date": 1584523127, "creation_date": 1559033863, "answer_id": 56338468, "question_id": 56336526, "link": "https://stackoverflow.com/questions/56336526/why-static-lifetime-needed-for-owned-variable-by-cloning/56338468#56338468", "title": "Why &#39;static lifetime needed for owned variable by cloning", "body": "<p><a href=\"https://doc.rust-lang.org/std/primitive.reference.html#trait-implementations\" rel=\"nofollow noreferrer\">From reference</a> :</p>\n\n<blockquote>\n  <p>The following traits are implemented for all &amp;T, regardless of the\n  type of its referent:</p>\n  \n  <ul>\n  <li>...</li>\n  <li>Clone (Note that this will not defer to T's Clone implementation if it exists!)</li>\n  <li>...</li>\n  </ul>\n</blockquote>\n\n<p>Since <code>F</code> has <code>'static</code> lifetime boundary, <code>&amp;F</code> is a type of shared variable: </p>\n\n<ul>\n<li>Without <code>Clone</code> boundary compiler will use <code>clone</code> from borrowed\nversion of <code>F</code> (Simply it would just clone the reference)</li>\n<li>With  <code>Clone</code> boundary, compiler will use the implementation of <code>F</code>'s <code>Clone</code></li>\n</ul>\n\n<p>With all of these the code below will work as same with <code>run_concrete_test</code> :</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait Example {\n    fn test(&amp;self);\n}\n\nfn _run_trait_test&lt;F&gt;(tester: &amp;F)\nwhere\n    F: Example + Sync + Send + Clone + 'static,\n{\n    let t = tester.clone();\n\n    ::std::thread::spawn(move || {\n        t.test();\n    });\n}\n</code></pre>\n\n<p><strong>Note</strong>: Without <code>'static</code> lifetime boundary it is possible that <code>F</code> could be considered as some <code>T</code>'s borrowed type like <code>F = &amp;T</code></p>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=9c0bd7754aa136baac9e1af650c7f310\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 474, "user_id": 5905325, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t4Uf-a54iNo/AAAAAAAAAAI/AAAAAAAAAdA/jc13jE20tww/photo.jpg?sz=128", "display_name": "murphy", "link": "https://stackoverflow.com/users/5905325/murphy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "accepted_answer_id": 56338468, "answer_count": 1, "score": 2, "last_activity_date": 1584523274, "creation_date": 1559026386, "last_edit_date": 1584523274, "question_id": 56336526, "link": "https://stackoverflow.com/questions/56336526/why-static-lifetime-needed-for-owned-variable-by-cloning", "title": "Why &#39;static lifetime needed for owned variable by cloning", "body": "<p>I struggle a little with rust lifetimes:\nwhy is <code>'static</code> lifetime needed for <code>run_trait_test</code>?.</p>\n\n<p>I want it to behave like <code>run_concrete_test</code></p>\n\n<p>I read the documentation, searched stackoverflow and the rust-book but I'm obviously missing something.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::thread;\n\n#[derive(Debug, Clone)]\nstruct Test {\n    test_string: String,\n}\n\ntrait Example {\n    fn tst(&amp;self) -&gt; ();\n}\n\nimpl Example for Test {\n    fn tst(&amp;self) {\n        println!(\"{:?}\", self);\n    }\n}\n\n// compiles, no 'static here\nfn run_concrete_test(tester: &amp;Test) {\n    let t = tester.clone();\n    thread::spawn(move || {\n        t.tst();\n    });\n}\n\n// compiles with 'static\n// but F shouldn't be only static\nfn run_trait_test&lt;F&gt;(tester: &amp;'static F)\nwhere\n    F: Example + Sync + Send + 'static,\n{\n    let t = tester.clone();\n    let store_t = thread::spawn(move || {\n        t.tst();\n    });\n}\n\nfn main() {\n    //does run, no static\n    let x = Test {\n        test_string: \"test string\".to_string(),\n    };\n    run_concrete_test(&amp;x);\n\n    // doe sn't compile because of static\n    // run_trait_test(&amp;x);\n    println!(\"{:?}\", x);\n}\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 0, "creation_date": 1559019118, "post_id": 56334972, "comment_id": 99276391, "body": "Traits are like interfaces in other languages. They specify some contract and not the impl details. Basically a trait does not and must not care how you implement it."}, {"owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 0, "creation_date": 1559029487, "post_id": 56334972, "comment_id": 99280314, "body": "The type in the trait or in a struct won&#39;t help you much, I think. You probably want an access function <code>fn artifacts(&amp;self) -&gt; Vec&lt;Self&gt;;</code> or similar."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 11565232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c3253d4bd27c7ad71502f47ba92fd94?s=128&d=identicon&r=PG&f=1", "display_name": "ramza500", "link": "https://stackoverflow.com/users/11565232/ramza500"}, "edited": false, "score": 0, "creation_date": 1559047154, "post_id": 56337202, "comment_id": 99289935, "body": "thanks a lot for your answer! This is exactly what I wanted to know :)"}], "tags": [], "owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "is_accepted": true, "score": 1, "last_activity_date": 1559037599, "last_edit_date": 1559037599, "creation_date": 1559029037, "answer_id": 56337202, "question_id": 56334972, "link": "https://stackoverflow.com/questions/56334972/is-there-a-way-to-make-a-trait-that-contain-an-vector-of-itself/56337202#56337202", "title": "Is there a way to make a trait that contain an vector of itself?", "body": "<p>If you define type definition in the trait as <code>dyn trait</code>, then it is an associated type and you need to specify that type on the implementation of that trait.</p>\n\n<blockquote>\n  <p>Is there a way in rust to make this kind of design?</p>\n</blockquote>\n\n<p>In the current stable release channel <strong>default associated types</strong> are not supported. But you can achieve what you need with <strong>nightly</strong> release channel like following:</p>\n\n<pre><code>#![feature(associated_type_defaults)]\ntrait Artifact {\n    type artifacts = Vec&lt;Box&lt;dyn Artifact&lt;artifacts = Self&gt;&gt;&gt;;\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<hr>\n\n<p>In <strong>stable</strong> release channel you can implement the closest idea like following:</p>\n\n<pre><code>trait Artifact {\n    fn artifact_call(&amp;self);\n}\n\nstruct Artifact1 {\n    inners: Vec&lt;Box&lt;dyn Artifact&gt;&gt;,\n}\n\nstruct Artifact2;\nstruct Artifact3;\n\nimpl Artifact for Artifact1 {\n    fn artifact_call(&amp;self) {\n        self.inners\n            .iter()\n            .for_each(|artifact| artifact.artifact_call());\n    }\n}\n\nimpl Artifact for Artifact2 {\n    fn artifact_call(&amp;self) {\n        println!(\"Artifact 2 Call\");\n    }\n}\n\nimpl Artifact for Artifact3 {\n    fn artifact_call(&amp;self) {\n        println!(\"Artifact 3 Call\");\n    }\n}\n\nfn main() {\n    let container_artifact = Artifact1 {\n        inners: vec![Box::new(Artifact2), Box::new(Artifact3)],\n    };\n    container_artifact.artifact_call();\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=ef4f67079516e2f3ffc51f5596ba00ae\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 13, "user_id": 11565232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c3253d4bd27c7ad71502f47ba92fd94?s=128&d=identicon&r=PG&f=1", "display_name": "ramza500", "link": "https://stackoverflow.com/users/11565232/ramza500"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 56337202, "answer_count": 1, "score": 1, "last_activity_date": 1559037599, "creation_date": 1559017393, "last_edit_date": 1559018753, "question_id": 56334972, "link": "https://stackoverflow.com/questions/56334972/is-there-a-way-to-make-a-trait-that-contain-an-vector-of-itself", "title": "Is there a way to make a trait that contain an vector of itself?", "body": "<p>I'm quite new to rust and I have the following problems: I want to have trait that I call <code>Artifact</code> and the definition of an <code>Artifact</code> is that it can contains multiples <code>Artifact</code>.</p>\n\n<p>My first idea was to make an <code>Artifact</code> trait that contains a vector of the <code>Artifact</code> trait:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait Artifact\n{\n    type artifacts = Vec&lt;Box&lt;dyn Artifact&gt;&gt;;\n}\n</code></pre>\n\n<p>I got the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0191]: the value of the associated type `artifacts` (from the trait `Artifact::Artifact`) must be specified\n --&gt; src/Artifact.rs:4:30\n  |\n4 |     type artifacts = Vec&lt;Box&lt;dyn Artifact&gt;&gt;;\n  |     -------------------------^^^^^^^^^^^^---\n  |     |                        |\n  |     |                        associated type `artifacts` must be specified\n  |     `artifacts` defined here\n</code></pre>\n\n<p>Is there a way in rust to make this kind of design?</p>\n"}, {"tags": ["rust", "webassembly"], "comments": [{"owner": {"reputation": 1289, "user_id": 8333554, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MvQ83.jpg?s=128&g=1", "display_name": "DCCoder", "link": "https://stackoverflow.com/users/8333554/dccoder"}, "edited": false, "score": 0, "creation_date": 1559016545, "post_id": 56334609, "comment_id": 99275916, "body": "Check the ../pkg directory and double check to ensure that &#39;wasm-game-of-life&#39; exists there.  If it doesn&#39;t change the path in package.json to point to it.  Another issue could be you forgot to run npm install in the wasm-game-of-life/www subdirectory"}, {"owner": {"reputation": 79, "user_id": 9201617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/INMBz.png?s=128&g=1", "display_name": "AntiInsect", "link": "https://stackoverflow.com/users/9201617/antiinsect"}, "reply_to_user": {"reputation": 1289, "user_id": 8333554, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MvQ83.jpg?s=128&g=1", "display_name": "DCCoder", "link": "https://stackoverflow.com/users/8333554/dccoder"}, "edited": false, "score": 1, "creation_date": 1559023076, "post_id": 56334609, "comment_id": 99277485, "body": "Thanks for that. It turns out that I have to <b>npm install</b> twice, first before changing the files as the step told in the tutorial and then after changing them. It is kind of strange since it has been explicitly stated that <b>This command only needs to be run once</b> on the web."}, {"owner": {"reputation": 1289, "user_id": 8333554, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MvQ83.jpg?s=128&g=1", "display_name": "DCCoder", "link": "https://stackoverflow.com/users/8333554/dccoder"}, "edited": false, "score": 0, "creation_date": 1559072493, "post_id": 56334609, "comment_id": 99303019, "body": "That is odd but glad you got it figured out!"}, {"owner": {"reputation": 93, "user_id": 3342134, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8c042e019a4452186c5668c5d55138a?s=128&d=identicon&r=PG&f=1", "display_name": "felix", "link": "https://stackoverflow.com/users/3342134/felix"}, "edited": false, "score": 0, "creation_date": 1571632317, "post_id": 56334609, "comment_id": 103291613, "body": "Had same issue (windows), didn&#39;t manage to solve it by just running install twice before run. Just like OP I attempted both with the entry in devDependencies and dependencies, but neither worked. <i>I did however solve it by having the entry in <b>both</b> at same time</i>. I ran install twice as well just to be sure, but from the output I have a feeling only once was needed. Will paste output below (out of characters)."}, {"owner": {"reputation": 93, "user_id": 3342134, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8c042e019a4452186c5668c5d55138a?s=128&d=identicon&r=PG&f=1", "display_name": "felix", "link": "https://stackoverflow.com/users/3342134/felix"}, "edited": false, "score": 0, "creation_date": 1571632444, "post_id": 56334609, "comment_id": 103291643, "body": "<code>npm install   npm WARN The package wasm-game-of-life is included as both a dev and  production dependency.   npm WARN optional SKIPPING OPTIONAL DEPENDENCY:  fsevents@1.2.9 (node_modules\\fsevents):   npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.2.9: wanted {&quot;os&quot;:&quot;darwin&quot;,&quot;arch&quot;:&quot;any&quot;} (current: {&quot;os&quot;:&quot;win32&quot;,&quot;arch&quot;:&quot;x64&quot;})    added 1 package, removed 1 package and audited 9101 packages in 2.879s   found 0 vulnerabilities     npm install   [same warnings]    audited 9101 packages in 2.799s   found 0 vulnerabilities</code>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12643302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d8a4c8b96211066f7a0921db7b71753?s=128&d=identicon&r=PG&f=1", "display_name": "xinnosuke", "link": "https://stackoverflow.com/users/12643302/xinnosuke"}, "is_accepted": false, "score": -1, "last_activity_date": 1578094147, "last_edit_date": 1578094147, "creation_date": 1577997380, "answer_id": 59569683, "question_id": 56334609, "link": "https://stackoverflow.com/questions/56334609/confused-about-the-tutorial-on-the-rust-and-webassembly-website/59569683#59569683", "title": "Confused about the tutorial on the &quot;Rust &#129408; and WebAssembly &#128376;&quot; website", "body": "<ol>\n<li>Change \"devDependencies\" to \"dependencies\"<br/></li>\n<li>Replace \"hello-wasm-pack\": \"^0.1.0\" with \"wasm-game-of-life\": \"file:../pkg\"<br/></li>\n</ol>\n\n<p>It will look like this:</p>\n\n<pre><code>\"dependencies\": {\n  \"wasm-game-of-life\": \"file:../pkg\",\n  \"copy-webpack-plugin\": \"^5.0.0\",\n  \"webpack\": \"^4.16.3\",\n  \"webpack-cli\": \"^3.1.0\",\n  \"webpack-dev-server\": \"^3.1.5\"\n}\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 9201617, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/INMBz.png?s=128&g=1", "display_name": "AntiInsect", "link": "https://stackoverflow.com/users/9201617/antiinsect"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 410, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1578094147, "creation_date": 1559014058, "last_edit_date": 1559020114, "question_id": 56334609, "link": "https://stackoverflow.com/questions/56334609/confused-about-the-tutorial-on-the-rust-and-webassembly-website", "title": "Confused about the tutorial on the &quot;Rust &#129408; and WebAssembly &#128376;&quot; website", "body": "<p>I tried the <a href=\"https://rustwasm.github.io/docs/book/game-of-life/hello-world.html\" rel=\"nofollow noreferrer\">Hello World Example</a> about rust and webassembly here (on macbookpro 2018)</p>\n\n<p>But got stuck at the last test step.</p>\n\n<p>I changed <strong>index.js</strong> and <strong>package.json</strong> according to the tutorial</p>\n\n<p><strong>index.js</strong></p>\n\n<pre><code>import * as wasm from \"wasm-game-of-life\";\nwasm.greet();\n</code></pre>\n\n<p><strong>package.json</strong></p>\n\n<pre><code>\"devDependencies\": {\n  \"wasm-game-of-life\": \"file:../pkg\",\n  \"hello-wasm-pack\": \"^0.1.0\",\n  \"webpack\": \"^4.29.3\",\n  \"webpack-cli\": \"^3.1.0\",\n  \"webpack-dev-server\": \"^3.1.5\",\n  \"copy-webpack-plugin\": \"^5.0.0\"\n}\n</code></pre>\n\n<p>I also tried to add a seperate part in <strong>package.json</strong> like below</p>\n\n<pre><code>\"dependencies\": {\n  \"wasm-game-of-life\": \"file:../pkg\"\n}\n</code></pre>\n\n<p>Sadly, they both didn't work.</p>\n\n<p>The toolchains I used while going through the example</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>rustup 1.18.3\nrustc 1.35.0\ncargo 1.35.0\nnpm 6.9.0\nnode v10.15.3\n</code></pre>\n\n<p>The exact error message below:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>(base) \u279c  www git:(master) npm run start\n\n&gt; create-wasm-app@0.1.0 start /Users/updrew/workspace/rust playground/wasm-game-of-life/www\n&gt; webpack-dev-server\n\n\u2139 \uff62wds\uff63: Project is running at http://localhost:8080/\n\u2139 \uff62wds\uff63: webpack output is served from /\n\u2139 \uff62wds\uff63: Content not from webpack is served from /Users/updrew/workspace/rust playground/wasm-game-of-life/www\n\u2716 \uff62wdm\uff63: Hash: 2c7b176d8a66be382dd2\nVersion: webpack 4.32.2\nTime: 332ms\nBuilt at: 05/28/2019 11:13:57 AM\n         Asset       Size  Chunks             Chunk Names\n0.bootstrap.js  672 bytes       0  [emitted]\n  bootstrap.js    354 KiB    main  [emitted]  main\n    index.html  175 bytes          [emitted]\nEntrypoint main = bootstrap.js\n[0] multi (webpack)-dev-server/client?http://localhost ./bootstrap.js 40 bytes {main} [built]\n[./bootstrap.js] 279 bytes {main} [built]\n[./index.js] 57 bytes {0} [built]\n[./node_modules/ansi-html/index.js] 4.16 KiB {main} [built]\n[./node_modules/events/events.js] 13.3 KiB {main} [built]\n[./node_modules/html-entities/index.js] 231 bytes {main} [built]\n[./node_modules/loglevel/lib/loglevel.js] 7.68 KiB {main} [built]\n[./node_modules/querystring-es3/index.js] 127 bytes {main} [built]\n[./node_modules/url/url.js] 22.8 KiB {main} [built]\n[./node_modules/webpack-dev-server/client/index.js?http://localhost] (webpack)-dev-server/client?http://localhost 9.26 KiB {main} [built]\n[./node_modules/webpack-dev-server/client/overlay.js] (webpack)-dev-server/client/overlay.js 3.59 KiB {main} [built]\n[./node_modules/webpack-dev-server/client/socket.js] (webpack)-dev-server/client/socket.js 1.05 KiB {main} [built]\n[./node_modules/webpack-dev-server/node_modules/strip-ansi/index.js] (webpack)-dev-server/node_modules/strip-ansi/index.js 161 bytes {main} [built]\n[./node_modules/webpack/hot sync ^\\.\\/log$] (webpack)/hot sync nonrecursive ^\\.\\/log$ 170 bytes {main} [built]\n[./node_modules/webpack/hot/emitter.js] (webpack)/hot/emitter.js 75 bytes {main} [built]\n    + 12 hidden modules\n\nERROR in ./index.js\nModule not found: Error: Can't resolve 'wasm-game-of-life' in '/Users/updrew/workspace/rust playground/wasm-game-of-life/www'\n @ ./index.js 1:0-42 2:0-10\n @ ./bootstrap.js\n\u2139 \uff62wdm\uff63: Failed to compile.\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1559033261, "post_id": 56333721, "comment_id": 99282123, "body": "prefer <code>for val in &amp;values</code> in this case"}, {"owner": {"reputation": 35504, "user_id": 14971, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/07e656eae2d6a9d86e8adb6bb6fe111d?s=128&d=identicon&r=PG", "display_name": "Toby Hede", "link": "https://stackoverflow.com/users/14971/toby-hede"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1559087346, "post_id": 56333721, "comment_id": 99307649, "body": "@Stargateur fails with &quot;not an iterator&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 35504, "user_id": 14971, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/07e656eae2d6a9d86e8adb6bb6fe111d?s=128&d=identicon&r=PG", "display_name": "Toby Hede", "link": "https://stackoverflow.com/users/14971/toby-hede"}, "edited": false, "score": 1, "creation_date": 1559015381, "post_id": 56334234, "comment_id": 99275700, "body": "Amazing. You just learned me a ton on how Rust works. I&#39;ve read the docs (multiple times), but facing your own problem and understanding is really different."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1559033144, "post_id": 56334234, "comment_id": 99282060, "body": "for loop already do the job so call <code>into_iter()</code> is not needed"}], "tags": [], "owner": {"reputation": 2659, "user_id": 8050514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6CRdl.jpg?s=128&g=1", "display_name": "Optimistic Peach", "link": "https://stackoverflow.com/users/8050514/optimistic-peach"}, "is_accepted": true, "score": 5, "last_activity_date": 1559009644, "creation_date": 1559009644, "answer_id": 56334234, "question_id": 56333721, "link": "https://stackoverflow.com/questions/56333721/iterating-through-a-vector-and-cast-enum-to-integer/56334234#56334234", "title": "Iterating through a vector and cast enum to integer", "body": "<p>When you call <a href=\"https://doc.rust-lang.org/std/primitive.slice.html#method.iter\" rel=\"noreferrer\"><code>values.iter()</code></a>, you take a reference to the <code>Vec</code>tor as a slice because it <a href=\"https://doc.rust-lang.org/std/vec/struct.Vec.html#deref-methods\" rel=\"noreferrer\"><code>impl</code>s <code>Deref&lt;Target=[T]&gt;</code></a>. It returns an <code>Iterator</code> over <code>&amp;T</code>, which is borrowed. Then, you try the following line:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let i = *val as i32;\n</code></pre>\n\n<p>There is a problem with this: <code>val</code> is of type <code>&amp;SomeEnum</code>, and therefore you cannot move the value out of the reference, <em>or</em> copy it, because <code>SomeEnum</code> doesn't impl <code>Copy</code> or <code>Clone</code>. To solve this issue, you can choose from the following, depending on the scenario:</p>\n\n<ul>\n<li><code>Copy</code> the value, by making the <code>enum</code> <a href=\"https://doc.rust-lang.org/std/marker/trait.Copy.html\" rel=\"noreferrer\"><code>Copy</code></a>. Making it do this results in allowing rust to implicitly copy the value, bitwise. </li>\n</ul>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Copy)]\nenum SomeEnum {\n    A,\n    B,\n    C,\n}\n</code></pre>\n\n<ul>\n<li>Use <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.copied\" rel=\"noreferrer\"><code>Iterator::copied</code></a> extension on the iterator. This copies each value, making it so that the iterator yields <code>T</code> instead of <code>&amp;T</code>. Note too that this is a nightly api currently, so you will have to wait a little longer for it to become stable. </li>\n</ul>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Copy)]\nenum SomeEnum {\n    A,\n    B,\n    C,\n}\nlet values = vec![SomeEnum::A, SomeEnum::B];\n\nfor val in values.iter().copied() {\n    let i = val as i32;\n}\n</code></pre>\n\n<ul>\n<li>Make it clone. <a href=\"https://doc.rust-lang.org/std/clone/trait.Clone.html\" rel=\"noreferrer\"><code>Clone</code></a> is a trait that allows the implementor to <code>impl</code> a way to copy the data, but also perform another operation with it, in the case that simply <code>Copy</code>ing bitwise is unsafe. </li>\n</ul>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Clone)]\nenum SomeEnum {\n    A,\n    B,\n    C,\n}\n</code></pre>\n\n<ul>\n<li>Use <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.cloned\" rel=\"noreferrer\"><code>Iterator::cloned</code></a>. This is, once again, a similar idea to <code>Iterator::copied</code>, except it <code>Clone</code>s the objects and is stable. </li>\n</ul>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Clone)]\nenum SomeEnum {\n    A,\n    B,\n    C,\n}\nlet values = vec![SomeEnum::A, SomeEnum::B];\n\nfor val in values.iter().cloned() {\n    let i = val as i32;\n}\n</code></pre>\n\n<ul>\n<li>Consume the <code>Vec</code>. This makes it so that you can no longer use the <code>Vec</code>, and instead each of the values is consumed in the <code>Vec</code>. This is the least flexible of the approaches, leading to you losing access to <code>values</code> because it is moved into <a href=\"https://doc.rust-lang.org/std/vec/struct.Vec.html#into_iter.v\" rel=\"noreferrer\"><code>into_iter(self)</code></a>.</li>\n</ul>\n\n<pre><code>enum SomeEnum {\n    A,\n    B,\n    C,\n}\nlet values = vec![SomeEnum::A, SomeEnum::B];\n\nfor val in values.into_iter() {\n    let i = val as i32;\n}\n</code></pre>\n\n<p>There are a few other ways to tackle this, but these are the simplest. </p>\n\n<p>Other ways of going about this are:</p>\n\n<ul>\n<li>Custom <code>impl</code> of mathematical operations</li>\n<li>Implement a <code>From</code> trait, to make it more obvious you're converting. </li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 162, "user_id": 2325160, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cwY4L.jpg?s=128&g=1", "display_name": "kdrakon", "link": "https://stackoverflow.com/users/2325160/kdrakon"}, "is_accepted": false, "score": 2, "last_activity_date": 1559011176, "creation_date": 1559011176, "answer_id": 56334349, "question_id": 56333721, "link": "https://stackoverflow.com/questions/56333721/iterating-through-a-vector-and-cast-enum-to-integer/56334349#56334349", "title": "Iterating through a vector and cast enum to integer", "body": "<p><code>iter</code> iterates through a collection using the references to the elements. <code>into_iter</code>, which causes a move, will give you access to the actual elements. If you're okay with the move, then this can help ease the cast of enums ordinal values:</p>\n\n<pre><code>for val in values.into_iter() {\n    let i = val as i32;\n    // if i &lt; X do something\n}\n</code></pre>\n\n<p>Alternatively, if you want to be able to iterate the vector again, you can use clone:</p>\n\n<pre><code>#[derive(Clone)]\nenum SomeEnum {\n    A,\n    B,\n    C,\n}\n</code></pre>\n\n<p>Which allows to cast after allocating a new instance of the enum value:</p>\n\n<pre><code>let values = vec![SomeEnum::A, SomeEnum::B];\nfor val in values.iter() {\n    let i = (val.clone()) as i32;\n    // if i &lt; X do something\n}\n</code></pre>\n"}], "owner": {"reputation": 35504, "user_id": 14971, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/07e656eae2d6a9d86e8adb6bb6fe111d?s=128&d=identicon&r=PG", "display_name": "Toby Hede", "link": "https://stackoverflow.com/users/14971/toby-hede"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 56334234, "answer_count": 2, "score": 1, "last_activity_date": 1559011176, "creation_date": 1559003180, "question_id": 56333721, "link": "https://stackoverflow.com/questions/56333721/iterating-through-a-vector-and-cast-enum-to-integer", "title": "Iterating through a vector and cast enum to integer", "body": "<p>I have a vector of enums that I want to cast to an integer value so I can do a numerical comparison. </p>\n\n<p>I keep running into borrowing warnings \"cannot move out of borrowed context\"</p>\n\n<p>I have tried various permutations of the following:</p>\n\n<pre><code>enum SomeEnum {\n    A,\n    B,\n    C,\n}\n\nlet values = vec![SomeEnum::A, SomeEnum::B];\n\nfor val in values.iter() {\n  let i = *val as i32;\n  // if i &lt; X do something\n}\n</code></pre>\n"}, {"tags": ["generics", "rust", "closures", "borrow-checker"], "comments": [{"owner": {"reputation": 34459, "user_id": 3320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82b1a2cb56adfa86634e7310ff639064?s=128&d=identicon&r=PG", "display_name": "Mendelt", "link": "https://stackoverflow.com/users/3320/mendelt"}, "edited": false, "score": 0, "creation_date": 1559023653, "post_id": 56331710, "comment_id": 99277687, "body": "After reading Peter Halls excellent answer and researching a bit more I realized my question might be a duplicate of this one <a href=\"https://stackoverflow.com/questions/40053550/the-compiler-suggests-i-add-a-static-lifetime-because-the-parameter-type-may-no\" title=\"the compiler suggests i add a static lifetime because the parameter type may no\">stackoverflow.com/questions/40053550/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 34459, "user_id": 3320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82b1a2cb56adfa86634e7310ff639064?s=128&d=identicon&r=PG", "display_name": "Mendelt", "link": "https://stackoverflow.com/users/3320/mendelt"}, "edited": false, "score": 0, "creation_date": 1559021534, "post_id": 56331940, "comment_id": 99277018, "body": "Thank you. It seems bounding S with &#39;static like the compiler suggests means something different here than I was expecting. This is going to be part of the public interface of my cmdr crate and I was hoping to avoid forcing users to specify lifetimes, as Scope will be implemented by them but I don&#39;t think I can avoid it here."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "reply_to_user": {"reputation": 34459, "user_id": 3320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82b1a2cb56adfa86634e7310ff639064?s=128&d=identicon&r=PG", "display_name": "Mendelt", "link": "https://stackoverflow.com/users/3320/mendelt"}, "edited": false, "score": 0, "creation_date": 1559039275, "post_id": 56331940, "comment_id": 99285540, "body": "@Mendelt Users of your API still shouldn&#39;t need to write explicit lifetimes most of the time."}], "tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": true, "score": 3, "last_activity_date": 1558988114, "last_edit_date": 1558988114, "creation_date": 1558987743, "answer_id": 56331940, "question_id": 56331710, "link": "https://stackoverflow.com/questions/56331710/why-will-a-move-closure-not-capture-a-value-with-a-generic-type/56331940#56331940", "title": "Why will a move closure not capture a value with a generic type?", "body": "<p>The problem is that <code>S</code> could be any type with a <code>Scope</code> impl, which includes all kinds of not-yet-existing types that carry references to other types. For example you could have an implementation like this:</p>\n\n<pre><code>struct AnotherScope&lt;'a&gt; {\n    reference: &amp;'str,\n}\n\nimpl Scope for ScopeImpl {\n    fn run(&amp;self) -&gt; String {\n        self.reference.to_string()\n    }\n}\n</code></pre>\n\n<p>Rust is cautious and wants to make sure that this will work for <em>any</em> qualifying <code>S</code>, including if it contains references.</p>\n\n<p>The easiest fix is to do as the error note suggests and just disallow <code>S</code> from having any non-static references:</p>\n\n<pre><code>fn new&lt;S: Scope + 'static&gt;(scope: S) -&gt; Self {\n    ScopeRunner {\n        runner: Box::new(move || scope.run())\n    }\n}\n</code></pre>\n\n<p>Bounding <code>S</code> with <code>'static</code> effectively means that <code>S</code> can contain either references to values with a <code>'static</code> lifetime or no references at all.</p>\n\n<p>If you want to be a bit more flexible, you can broaden that to references that outlive the <code>ScopeRunner</code> itself:</p>\n\n<pre><code>struct ScopeRunner&lt;'s&gt; {\n    runner: Box&lt;dyn Fn() -&gt; String + 's&gt;,\n}\n\nimpl&lt;'s&gt; ScopeRunner&lt;'s&gt; {\n    fn new&lt;S: Scope + 's&gt;(scope: S) -&gt; Self {\n        ScopeRunner { \n            runner: Box::new(move || scope.run())\n        }\n    }\n\n    pub fn run(self) -&gt; String {\n        (self.runner)()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 34459, "user_id": 3320, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82b1a2cb56adfa86634e7310ff639064?s=128&d=identicon&r=PG", "display_name": "Mendelt", "link": "https://stackoverflow.com/users/3320/mendelt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 56331940, "answer_count": 1, "score": 0, "last_activity_date": 1558988310, "creation_date": 1558986422, "last_edit_date": 1558988310, "question_id": 56331710, "link": "https://stackoverflow.com/questions/56331710/why-will-a-move-closure-not-capture-a-value-with-a-generic-type", "title": "Why will a move closure not capture a value with a generic type?", "body": "<p>I'm trying to create a ScopeRunner type that can store method calls to a method of types implementing the Scope trait like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait Scope {\n    fn run(&amp;self) -&gt; String;\n}\n\nstruct ScopeImpl;\n\nimpl Scope for ScopeImpl {\n    fn run(&amp;self) -&gt; String {\n        \"Some string\".to_string()\n    }\n}\n\n\nstruct ScopeRunner {\n    runner: Box&lt;dyn Fn() -&gt; String&gt;,\n}\n\nimpl ScopeRunner {\n    fn new&lt;S: Scope&gt;(scope: S) -&gt; Self {\n        ScopeRunner {\n            runner: Box::new(move || scope.run())\n        }\n    }\n\n    pub fn run(self) -&gt; String {\n        (self.runner)()\n    }\n\n}\n\n\nfn main() {\n    let scope = ScopeImpl {};\n    let scope_runner = ScopeRunner::new(scope);\n\n    dbg!(scope_runner.run());\n}\n</code></pre>\n\n<p>I would expect that since <code>ScopeRunner::new</code> creates a move closure this would cause scope to be moved into the closure. But instead the borrow checker gives me this error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0310]: the parameter type `S` may not live long enough\n  --&gt; src/main.rs:21:30\n   |\n20 |     fn new&lt;S: Scope&gt;(scope: S) -&gt; Self {\n   |            -- help: consider adding an explicit lifetime bound `S: 'static`...\n21 |         ScopeRunner {runner: Box::new(move || scope.run())}\n   |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n   |\nnote: ...so that the type `[closure@src/main.rs:21:39: 21:58 scope:S]` will meet its required lifetime bounds\n  --&gt; src/main.rs:21:30\n   |\n21 |         ScopeRunner {runner: Box::new(move || scope.run())}\n   | \n</code></pre>\n\n<p>When I replace <code>ScopeRunner::new</code> with a non generic version that just takes a <code>ScopeImpl</code> this code does work.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn new(scope: ScopeImpl) -&gt; Self {\n    ScopeRunner {\n        runner: Box::new(move || scope.run())\n    }\n}\n</code></pre>\n\n<p>I don't understand why this is different. To me it seems the lifetime of the generic <code>Scope</code> would be the same as the concrete version.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 3846, "user_id": 1034080, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6382fe69b5d18e9f65825d129ff922cf?s=128&d=identicon&r=PG", "display_name": "Felix Rabe", "link": "https://stackoverflow.com/users/1034080/felix-rabe"}, "edited": false, "score": 0, "creation_date": 1558980735, "post_id": 56330705, "comment_id": 99268470, "body": "On my trip through Google results, I came across the following issue: <a href=\"https://github.com/rust-lang/rust/issues/45716\" rel=\"nofollow noreferrer\">Send/Sync additional trait requirements cannot be automatically relaxed</a>. It basically says that <code>Box&lt;dyn Error + ...&gt; =&gt; Box&lt;dyn Error&gt;</code> coercion was removed, but I&#39;m still not sure what to do about it as a user."}], "answers": [{"tags": [], "owner": {"reputation": 3846, "user_id": 1034080, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6382fe69b5d18e9f65825d129ff922cf?s=128&d=identicon&r=PG", "display_name": "Felix Rabe", "link": "https://stackoverflow.com/users/1034080/felix-rabe"}, "is_accepted": false, "score": 0, "last_activity_date": 1558982672, "creation_date": 1558982672, "answer_id": 56331061, "question_id": 56330705, "link": "https://stackoverflow.com/questions/56330705/how-to-accept-boxdyn-error-send-in-places-that-accept-boxdyn-error/56331061#56331061", "title": "How to accept `Box&lt;dyn Error + Send&gt;` in places that accept `Box&lt;dyn Error&gt;`?", "body": "<p>This is based on an answer I got <a href=\"https://www.reddit.com/r/rust/comments/btj5ik/hey_rustaceans_got_an_easy_question_ask_here/ep0v6c4?utm_source=share&amp;utm_medium=web2x\" rel=\"nofollow noreferrer\">on Reddit</a> by Llaurence_:</p>\n\n<p>I can change <code>register_callback</code> to accept both <code>Box&lt;dyn Error&gt;</code> and <code>Box&lt;dyn Error + Send&gt;</code> errors by making the error type generic:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn register_callback&lt;CB, E&gt;(cb: CB)\nwhere\n    CB: FnOnce() -&gt; StdResult&lt;(), Box&lt;E&gt;&gt;,\n    E: StdError + ?Sized,\n{ /* ... */ }\n</code></pre>\n\n<p>Now I can pass a callback that returns either kind of error / result:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>register_callback(fn_returning_result);\nregister_callback(fn_returning_sndresult);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3846, "user_id": 1034080, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6382fe69b5d18e9f65825d129ff922cf?s=128&d=identicon&r=PG", "display_name": "Felix Rabe", "link": "https://stackoverflow.com/users/1034080/felix-rabe"}, "is_accepted": false, "score": 0, "last_activity_date": 1559083475, "last_edit_date": 1559083475, "creation_date": 1559082972, "answer_id": 56350903, "question_id": 56330705, "link": "https://stackoverflow.com/questions/56330705/how-to-accept-boxdyn-error-send-in-places-that-accept-boxdyn-error/56350903#56350903", "title": "How to accept `Box&lt;dyn Error + Send&gt;` in places that accept `Box&lt;dyn Error&gt;`?", "body": "<p>Q: Can I accept a <code>Box&lt;dyn Error + Send&gt;</code> in places that accept <code>Box&lt;dyn Error&gt;</code>?</p>\n\n<p>A: Yes, with some newtype wrapping. The solution I finally ended up with was this: (<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=4f46077d20dcd2184ca2ac23d4b47c0c\" rel=\"nofollow noreferrer\">Playground</a>)</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::error::Error as StdError;\nuse std::result::Result as StdResult;\nuse std::fmt;\n\ntype    Result = StdResult&lt;(), Box&lt; dyn StdError &gt;&gt;;\ntype SndResult = StdResult&lt;(), Box&lt; dyn StdError + Send &gt;&gt;;\n\nfn fn_returning_result()    -&gt;    Result { dbg!(Err(\"oops\".into())) }\nfn fn_returning_sndresult() -&gt; SndResult { dbg!(Ok(())) }\n\n/// Result type using `Er` defined below.\ntype Rt&lt;T = ()&gt; = StdResult&lt;T, Er&gt;;\n\n\n// Error wrapper\n\n#[derive(Debug)]\nstruct Er(Box&lt;dyn StdError&gt;);\n\nimpl fmt::Display for Er {\n    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {\n        fmt::Debug::fmt(self, f)\n    }\n}\n\nimpl StdError for Er {}\n\n\n// Allow `?` operator\n\nimpl From&lt;Box&lt;dyn StdError&gt;&gt; for Er {\n    fn from(err: Box&lt;dyn StdError&gt;) -&gt; Self {\n        Er(err)\n    }\n}\n\nimpl From&lt;Box&lt;dyn StdError + Send&gt;&gt; for Er {\n    fn from(err: Box&lt;dyn StdError + Send&gt;) -&gt; Self {\n        Er(err)\n    }\n}\n\n\n// List of callbacks\n\nstruct Callbacks&lt;'a&gt;(Vec&lt;Box&lt;dyn FnOnce() -&gt; Rt + 'a&gt;&gt;);\n\nimpl&lt;'a&gt; Callbacks&lt;'a&gt; {\n    fn new() -&gt; Self {\n        Callbacks(Vec::new())\n    }\n\n    fn add(&amp;mut self, cb: impl FnOnce() -&gt; Rt + 'a) {\n        self.0.push(Box::new(cb));\n    }\n\n    fn pop_and_call(&amp;mut self) -&gt; Rt {\n        self.0.pop().unwrap()()\n    }\n}\n\n\n// Example\n\nfn main() -&gt; Result {\n    let mut callbacks = Callbacks::new();\n\n    callbacks.add(|| { Ok(fn_returning_result()?) });\n    callbacks.add(|| { Ok(fn_returning_sndresult()?) });\n\n    callbacks.pop_and_call()?;\n    callbacks.pop_and_call()?;\n\n    Ok(())\n}\n</code></pre>\n\n<p>Note that the callbacks can use <code>?</code> on either <code>Result</code> or <code>SndResult</code> values (thanks to the <code>From</code> trait impls), and that their return values are valid <code>Result</code>s as well, allowing <code>main</code> to also use <code>?</code> on their calls (thanks to the <code>StdError</code> trait impl).</p>\n"}], "owner": {"reputation": 3846, "user_id": 1034080, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6382fe69b5d18e9f65825d129ff922cf?s=128&d=identicon&r=PG", "display_name": "Felix Rabe", "link": "https://stackoverflow.com/users/1034080/felix-rabe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 524, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1559083475, "creation_date": 1558980728, "last_edit_date": 1559082254, "question_id": 56330705, "link": "https://stackoverflow.com/questions/56330705/how-to-accept-boxdyn-error-send-in-places-that-accept-boxdyn-error", "title": "How to accept `Box&lt;dyn Error + Send&gt;` in places that accept `Box&lt;dyn Error&gt;`?", "body": "<p>Can I accept a <code>Box&lt;dyn Error + Send&gt;</code> in places that accept <code>Box&lt;dyn Error&gt;</code>? If yes, how? If no, why, and is there a more elegant way to do it than in the following example?</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#![allow(unused)]\n\nuse std::error::Error as StdError;\nuse std::result::Result as StdResult;\n\ntype    Result = StdResult&lt;(), Box&lt; dyn StdError &gt;&gt;;\ntype SndResult = StdResult&lt;(), Box&lt; dyn StdError + Send &gt;&gt;;\n\nfn fn_returning_result()    -&gt;    Result { Ok(()) }\nfn fn_returning_sndresult() -&gt; SndResult { Ok(()) }\n\n/// Accept a callback that returns a non-Send `Result`.\nfn register_callback&lt;CB: FnOnce() -&gt; Result&gt;(cb: CB) { /* ... */ }\n\nfn main() -&gt; Result {\n    // Is there a way to get rid of ... vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv ... this part?\n    let cb = || fn_returning_sndresult().map_err(|e| -&gt; Box&lt;dyn StdError&gt; { e });\n    register_callback(cb);\n\n    Ok(())\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=eab225b1358ebdc40867dcb15d0a4642\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>Edit: What I would like to do here is just <code>let cb = || fn_returning_sndresult();</code>, but that won't compile.</p>\n\n<p>Also, I'd like to call either <code>fn_returning_result()?</code> or <code>fn_returning_sndresult()?</code> inside the callback with a single return type and without doing a <code>map_err</code>.</p>\n"}, {"tags": ["io", "rust"], "answers": [{"tags": [], "owner": {"reputation": 162, "user_id": 2325160, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cwY4L.jpg?s=128&g=1", "display_name": "kdrakon", "link": "https://stackoverflow.com/users/2325160/kdrakon"}, "is_accepted": true, "score": 1, "last_activity_date": 1558998221, "creation_date": 1558998221, "answer_id": 56333268, "question_id": 56330660, "link": "https://stackoverflow.com/questions/56330660/how-to-manage-the-ownership-of-a-file-held-within-a-struct-in-rust/56333268#56333268", "title": "How to manage the ownership of a file held within a struct in Rust?", "body": "<p>I think you're on track with using the <code>Option</code> within the <code>Foo</code> struct. Assuming the struct becomes:</p>\n\n<pre><code>struct Foo {                \n    file : Option&lt;BufReader &lt;File&gt;&gt;,\n    data : Vec &lt;f64&gt;,   \n}\n</code></pre>\n\n<p>The following code is a possible solution:</p>\n\n<pre><code>// Reads the file and strips the header    \nfn init_foo(fname : &amp;str) -&gt; Foo {   \n\n    // Open the file                                      \n    let mut file = BufReader::new(File::open(fname).unwrap());\n\n    // Dump the header     \n    let mut header = String::new();\n    let _ = file.read_line(&amp;mut header);\n\n    // Return our foo\n    Foo { file : Some(file), data : Vec::new() }          \n}   \n\n// Read the remaining foo data and process it\nfn read_foo(foo : Foo) -&gt; Option&lt;Foo&gt; {\n\n    let mut file = foo.file?;\n\n    // Strip one more line\n    let mut header_alt = String::new();\n    let _ = file.read_line(&amp;mut header_alt);\n\n    // Read in the rest of the file line by line\n    let mut data = Vec::new();         \n    for (lineno,line) in file.lines().enumerate() {\n\n        // Strip the error\n        let line = line.unwrap();\n\n        // Print some diagnostic information    \n        println!(\"Line {}: val {}\",lineno,line);\n\n        // Save the element\n        data.push(line.parse::&lt;f64&gt;().unwrap());\n    }   \n\n    // Export foo\n    Some(Foo { data : data, file: None})\n} \n</code></pre>\n\n<p>Note in this case that <code>read_foo</code> returns an optional <code>Foo</code> due to the fact that the <code>file</code> could be <code>None</code>.</p>\n\n<p>On a side note, IMO, unless you absolutely need the <code>BufReader</code> to be <em>travelling</em> along with the <code>Foo</code>, I would discard it. As you've already found, calling <code>lines</code> causes a move, which makes it difficult to retain within another struct. As a suggestion, you could make the <code>file</code> field simply a <code>String</code> so that you could always derive the <code>BufReader</code> and read the file when needed.</p>\n\n<p>For example, here's a solution where a file name (i.e. a &amp;str) can be turned into a <code>Foo</code> with all the line processing done just before the construction of the struct. </p>\n\n<pre><code>// Buffered file IO\nuse std::io::{BufReader,BufRead};\nuse std::fs::File;            \n\n// Structure that contains a file\n#[derive(Debug)]\nstruct Foo {                \n    file : String,\n    data : Vec &lt;f64&gt;,   \n}   \n\ntrait IntoFoo {\n    fn into_foo(self) -&gt; Foo;\n}\n\nimpl IntoFoo for &amp;str {\n    fn into_foo(self) -&gt; Foo {\n        // Open the file                                      \n        let mut file = BufReader::new(File::open(self).unwrap());\n\n        // Dump the header     \n        let mut header = String::new();\n        let _ = file.read_line(&amp;mut header);\n\n        // Strip one more line\n        let mut header_alt = String::new();\n        let _ = file.read_line(&amp;mut header_alt);\n\n        // Read in the rest of the file line by line\n        let mut data = Vec::new();         \n        for (lineno,line) in file.lines().enumerate() {\n\n            // Strip the error\n            let line = line.unwrap();\n\n            // Print some diagnostic information    \n            println!(\"Line {}: val {}\",lineno,line);\n\n            // Save the element\n            data.push(line.parse::&lt;f64&gt;().unwrap());\n        }   \n\n        Foo { file: self.to_string(), data }\n    }\n}\n\nfn main() {\n\n    // Read in our data from the file\n    let foo = \"foo.txt\".into_foo(); \n\n    // Print out some debugging info\n    println!(\"{:?}\",foo); \n} \n</code></pre>\n\n<p>In this case, there's no need to worry about the ownership of the <code>BufReader</code> because it's created, used, and discarded in the same function. Of course, I don't fully know your use case, so this may not be suitable for your implementation.</p>\n"}], "owner": {"reputation": 5358, "user_id": 1932452, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/7dfca62a1e4eb69f39ce00152862c70e?s=128&d=identicon&r=PG", "display_name": "wyer33", "link": "https://stackoverflow.com/users/1932452/wyer33"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 1, "accepted_answer_id": 56333268, "answer_count": 1, "score": 0, "last_activity_date": 1558998221, "creation_date": 1558980472, "question_id": 56330660, "link": "https://stackoverflow.com/questions/56330660/how-to-manage-the-ownership-of-a-file-held-within-a-struct-in-rust", "title": "How to manage the ownership of a file held within a struct in Rust?", "body": "<p>Is there a good way to handle the ownership of a file held within a struct using Rust?  As a stripped down example, consider:</p>\n\n<pre><code>// Buffered file IO\nuse std::io::{BufReader,BufRead};\nuse std::fs::File;            \n\n// Structure that contains a file\n#[derive(Debug)]\nstruct Foo {                \n    file : BufReader &lt;File&gt;,\n    data : Vec &lt;f64&gt;,   \n}   \n\n// Reads the file and strips the header    \nfn init_foo(fname : &amp;str) -&gt; Foo {   \n\n    // Open the file                                      \n    let mut file = BufReader::new(File::open(fname).unwrap());\n\n    // Dump the header     \n    let mut header = String::new();\n    let _ = file.read_line(&amp;mut header);\n\n    // Return our foo\n    Foo { file : file, data : Vec::new() }          \n}   \n\n// Read the remaining foo data and process it\nfn read_foo(mut foo : Foo) -&gt; Foo {\n\n    // Strip one more line\n    let mut header_alt = String::new();\n    let _ = foo.file.read_line(&amp;mut header_alt);\n\n    // Read in the rest of the file line by line\n    let mut data = Vec::new();         \n    for (lineno,line) in foo.file.lines().enumerate() {\n\n        // Strip the error\n        let line = line.unwrap();\n\n        // Print some diagnostic information    \n        println!(\"Line {}: val {}\",lineno,line);\n\n        // Save the element\n        data.push(line.parse::&lt;f64&gt;().unwrap());\n    }   \n\n    // Export foo\n    Foo { data : data, ..foo}\n}   \n\nfn main() {\n\n    // Initialize our foo\n    let foo = init_foo(\"foo.txt\");\n\n    // Read in our data\n    let foo = read_foo(foo); \n\n    // Print out some debugging info\n    println!(\"{:?}\",foo); \n} \n</code></pre>\n\n<p>This currently gives the compilation error:</p>\n\n<pre><code>error[E0382]: use of moved value: `foo.file`\n  --&gt; src/main.rs:48:5\n   |\n35 |     for (lineno,line) in foo.file.lines().enumerate() {\n   |                          -------- value moved here\n...\n48 |     Foo { data : data, ..foo}\n   |     ^^^^^^^^^^^^^^^^^^^^^^^^^ value used here after move\n   |\n   = note: move occurs because `foo.file` has type `std::io::BufReader&lt;std::fs::File&gt;`, which does not implement the `Copy` trait\n\nerror: aborting due to previous error\n\nFor more information about this error, try `rustc --explain E0382`.\nerror: Could not compile `rust_file_struct`.\n\nTo learn more, run the command again with --verbose.\n</code></pre>\n\n<p>And, to be sure, this makes sense.  Here, <code>lines()</code> takes ownership of the buffered file, so we can't use the value in the return.  What's confusing me is a better way to handle this situation.  Certainly, after the for loop, the file is consumed, so it really can't be used.  To better denote this, we could represent file as <code>Option &lt;BufReader &lt;File&gt;&gt;</code>.  However, this causes some grief because the second <code>read_line</code> call, inside of <code>read_foo</code>, needs a mutable reference to <code>file</code> and I'm not sure how to obtain one it it's wrapped inside of an <code>Option</code>.  Is there a good way of handling the ownership?</p>\n\n<p>To be clear, this is a stripped down example.  In the actual use case, there are several files as well as other data.  I've things structured in this way because it represents a configuration that comes from the command line options.  Some of the options are files, some are flags.  In either case, I'd like to do some processing, but not all, of the files early in order to throw the appropriate errors.</p>\n"}, {"tags": ["types", "rust", "higher-kinded-types"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1558976708, "post_id": 56329170, "comment_id": 99267158, "body": "You might want to provide a more concrete use case."}], "answers": [{"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": true, "score": 4, "last_activity_date": 1558983610, "creation_date": 1558983610, "answer_id": 56331234, "question_id": 56329170, "link": "https://stackoverflow.com/questions/56329170/can-a-trait-have-a-supertrait-that-is-parameterized-by-a-generic/56331234#56331234", "title": "Can a trait have a supertrait that is parameterized by a generic?", "body": "<p>No. Rust's type system doesn't currently support any features involving higher kinded types. It does, however, support a similar construction to what you described, but limited to lifetime parameters. For example:</p>\n\n<pre><code>trait B&lt;'a&gt; {}\n\ntrait A: for&lt;'a&gt; B&lt;'a&gt; {}\n\nstruct D;\n\nimpl A for D { }\n</code></pre>\n\n<p>This is an error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `for&lt;'a&gt; D: B&lt;'a&gt;` is not satisfied\n --&gt; src/lib.rs:7:6\n  |\n7 | impl A for D { }\n  |      ^ the trait `for&lt;'a&gt; B&lt;'a&gt;` is not implemented for `D`\n</code></pre>\n\n<p>Until you add the blanket implementation:</p>\n\n<pre><code>impl&lt;'a&gt; B&lt;'a&gt; for D { }\n</code></pre>\n\n<hr>\n\n<p>It's not impossible that Rust will eventually add similar functionality for types too, but I wouldn't expect it any time soon.</p>\n"}, {"tags": [], "owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "is_accepted": false, "score": 1, "last_activity_date": 1561986738, "last_edit_date": 1561986738, "creation_date": 1559228459, "answer_id": 56380799, "question_id": 56329170, "link": "https://stackoverflow.com/questions/56329170/can-a-trait-have-a-supertrait-that-is-parameterized-by-a-generic/56380799#56380799", "title": "Can a trait have a supertrait that is parameterized by a generic?", "body": "<p>While the language is unable to specify such a higher kinded constraint, it is often possible to rethink the trait <code>B</code> so that its implementation is universal over this parameter type <code>T</code>.</p>\n\n<p>Considering this example of <code>B</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait B&lt;T&gt; {\n    fn foo(bar: T) -&gt; u32;\n}\n</code></pre>\n\n<p>A type that implements <code>B</code> for any <code>T</code> would be practically equivalent to the type implementing the trait below:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait UniversalB {\n    fn foo&lt;T&gt;(bar: T) -&gt; u32;\n}\n</code></pre>\n\n<p>This one declares the type parameters at method call level. While this trait is no longer object safe, it can still be used as a supertrait:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait A: UniversalB {}\n</code></pre>\n\n<p>The implementations may need to be adjusted accordingly.</p>\n\n<p>See also:</p>\n\n<ul>\n<li>The Rust Programming Language, <a href=\"https://doc.rust-lang.org/stable/book/ch10-01-syntax.html#in-method-definitions\" rel=\"nofollow noreferrer\">Chapter 10, Section 1 on <em>Generic Data Types In Method Definitions</em></a></li>\n</ul>\n"}], "owner": {"reputation": 20310, "user_id": 525980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/8dafe66793ee2f32192e9fcefb389a12?s=128&d=identicon&r=PG", "display_name": "Clinton", "link": "https://stackoverflow.com/users/525980/clinton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 56331234, "answer_count": 2, "score": 2, "last_activity_date": 1561986738, "creation_date": 1558972221, "last_edit_date": 1559228998, "question_id": 56329170, "link": "https://stackoverflow.com/questions/56329170/can-a-trait-have-a-supertrait-that-is-parameterized-by-a-generic", "title": "Can a trait have a supertrait that is parameterized by a generic?", "body": "<p>Can you do something like this in Rust?</p>\n\n<pre><code>trait A : forall&lt;T&gt; B&lt;T&gt; { ... }\n</code></pre>\n\n<p>That is, if we want:</p>\n\n<pre><code>impl A for D { ... }\n</code></pre>\n\n<p>We must first implement:</p>\n\n<pre><code>impl&lt;T&gt; B&lt;T&gt; for D { ... }\n</code></pre>\n"}, {"tags": ["rust", "package", "installation", "rust-cargo"], "answers": [{"tags": [], "owner": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "is_accepted": true, "score": 3, "last_activity_date": 1558980496, "creation_date": 1558980496, "answer_id": 56330663, "question_id": 56329161, "link": "https://stackoverflow.com/questions/56329161/how-do-i-get-cargo-to-save-the-name-version-of-a-package-to-the-dependencies/56330663#56330663", "title": "How do I get Cargo to save the name/version of a package to the &quot;[dependencies]&quot; section of my &quot;Cargo.toml&quot; file?", "body": "<p>There's a crate called <a href=\"https://github.com/killercup/cargo-edit\" rel=\"nofollow noreferrer\"><code>cargo-edit</code></a> which expands <code>cargo</code> with subcommands <code>add</code>, <code>rm</code> and <code>upgrade</code> to act similarly to how <code>npm install</code> (and other package managers) do:</p>\n\n<pre><code># install cargo-edit\ncargo install cargo-edit\n\n# add crate \"glob\"\ncargo add glob\n</code></pre>\n\n<p>The resulting <code>Cargo.toml</code> file would look like this:</p>\n\n<pre><code>[dependencies]\nglob = \"0.3.0\"\n</code></pre>\n\n<p>The crate will be downloaded and built the next time you run a regular Cargo command (e.g. <code>cargo build</code>, <code>cargo run</code>, <code>cargo test</code>).</p>\n"}], "owner": {"reputation": 3548, "user_id": 10415695, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ex5vb.jpg?s=128&g=1", "display_name": "LogicalBranch", "link": "https://stackoverflow.com/users/10415695/logicalbranch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 391, "favorite_count": 0, "accepted_answer_id": 56330663, "answer_count": 1, "score": 2, "last_activity_date": 1558980496, "creation_date": 1558972173, "question_id": 56329161, "link": "https://stackoverflow.com/questions/56329161/how-do-i-get-cargo-to-save-the-name-version-of-a-package-to-the-dependencies", "title": "How do I get Cargo to save the name/version of a package to the &quot;[dependencies]&quot; section of my &quot;Cargo.toml&quot; file?", "body": "<p>Today I spent more time than I should have trying to figure out why my project wasn't building, only to find out that I forgot to include the following crate:</p>\n\n<pre><code>[dependencies]\nglob = \"~0.3.0\"\n</code></pre>\n\n<p>I'd like to avoid making this mistake again by having Cargo add the name/version of a package to the <code>[dependencies]</code> section of my <code>Cargo.toml</code> file <strong>when I install the package</strong>.</p>\n\n<p>To give you a better example of what I mean, in <code>NPM</code> if you run:</p>\n\n<pre><code>npm install --save-dev glob\n</code></pre>\n\n<p>It'd save the name/version of the <code>glob</code> package to <code>dependencies</code> section of the <code>package.json</code> file.</p>\n\n<p>How do I do this in Cargo?</p>\n"}, {"tags": ["rust", "kuchiki"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1558978028, "post_id": 56329121, "comment_id": 99267566, "body": "What is kuchiki? Can you please expand your question a little bit? E.g. some code example?"}], "answers": [{"comments": [{"owner": {"reputation": 11878, "user_id": 588759, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/216ea4da5cae7be4030b6242ab90631c?s=128&d=identicon&r=PG", "display_name": "rofrol", "link": "https://stackoverflow.com/users/588759/rofrol"}, "edited": false, "score": 0, "creation_date": 1578294066, "post_id": 59471273, "comment_id": 105379372, "body": "I have found this comment how to navigate documentation: <a href=\"https://www.reddit.com/r/rust/comments/af4ns6/how_to_work_with_refcell/\" rel=\"nofollow noreferrer\">reddit.com/r/rust/comments/af4ns6/how_to_work_with_refcell</a>"}], "tags": [], "owner": {"reputation": 11388, "user_id": 220485, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bTrsL.jpg?s=128&g=1", "display_name": "Daniel Fath", "link": "https://stackoverflow.com/users/220485/daniel-fath"}, "is_accepted": true, "score": 1, "last_activity_date": 1578394882, "last_edit_date": 1578394882, "creation_date": 1577204137, "answer_id": 59471273, "question_id": 56329121, "link": "https://stackoverflow.com/questions/56329121/how-to-get-only-text-node-with-kuchiki/59471273#59471273", "title": "How to get only TEXT_NODE with kuchiki", "body": "<p>First, let's start with how a parser will parse:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>    &lt;a href=\"https://example.com\"&gt;&lt;em&gt;@&lt;/em&gt;Bananowy&lt;/a&gt;\n</code></pre>\n\n<p>Into a tree. See image below:</p>\n\n<p><a href=\"https://i.stack.imgur.com/ej22j.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ej22j.png\" alt=\"enter image description here\"></a></p>\n\n<p>Now if you try to do the obvious thing and call <code>anchor.text_contents()</code> you're going to get all text contents of all the text nodes descendants of the anchor tag (<code>&lt;a&gt;</code>). This is how text_contents behave according to CSS definition. </p>\n\n<p>However, you want to just get the <code>\"Bananowy\"</code> you have few ways to do it:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate kuchiki;\n\nuse kuchiki::traits::*;\n\nfn main() {\n    let html = r\"&lt;a href='https://example.com'&gt;&lt;em&gt;@&lt;/em&gt;Bananowy&lt;/a&gt;\";\n\n    let document = kuchiki::parse_html().one(html);\n\n    let selector = \"a\";\n    let anchor = document.select_first(selector).unwrap();\n    // Quick and dirty hack\n    let last_child = anchor.as_node().last_child().unwrap();\n    println!(\"{:?}\", last_child.into_text_ref().unwrap());\n\n    // Iterating solution\n    for children in anchor.as_node().children() {\n        if let Some(a) = children.as_text() {\n            println!(\"{:?}\", a);\n        }\n    }\n\n    // Iterating solution - Using `text_nodes()` iterators\n    anchor.as_node().children().text_nodes().for_each(|e| {\n        println!(\"{:?}\", e);\n    });\n\n    // text1 and text2 are examples how to get `String`\n    let text1 = match anchor.as_node().children().text_nodes().last() {\n        Some(x) =&gt; x.as_node().text_contents(),\n        None =&gt; String::from(\"\"),\n    };\n\n    let text2 = match anchor.as_node().children().text_nodes().last() {\n        Some(x) =&gt; x.borrow().clone(),\n        None =&gt; String::from(\"\"),\n    };\n}\n</code></pre>\n\n<p>First way is the brittle, hackish way. All you need to realize is that <code>\"Bananowy\"</code> is the <a href=\"https://docs.rs/kuchiki/0.7.3/kuchiki/struct.Node.html#method.last_child\" rel=\"nofollow noreferrer\">last_child</a> of your anchor tag, and fetch it accordingly <code>anchor.as_node().last_child().unwrap().into_text_ref().unwrap()</code>. </p>\n\n<p>The second solution is to iterate over anchor tag's children (i.e. <code>[Tag(em), TextNode(\"Bananowy\")]</code>) and select only text nodes using (<a href=\"https://docs.rs/kuchiki/0.7.3/kuchiki/struct.Node.html#method.as_text\" rel=\"nofollow noreferrer\"><code>as_text()</code></a> method). We do this with method <code>as_text()</code> that returns <code>None</code> for all <code>Nodes</code> that aren't <code>TextNode</code>. This is way less fragile than the first solution which won't work if e.g. you had <code>&lt;a&gt;&lt;em&gt;@&lt;/em&gt;Banan&lt;i&gt;!&lt;/i&gt;owy&lt;/a&gt;</code>.</p>\n\n<p>EDIT:</p>\n\n<h1>PREFERED Solution</h1>\n\n<p>After looking around for a bit I found a much better solution to your problem. It's called <a href=\"https://docs.rs/kuchiki/0.7.3/kuchiki/iter/struct.TextNodes.html\" rel=\"nofollow noreferrer\">TextNodes iterator</a>. </p>\n\n<p>With that in mind just write <code>anchor.as_node().children().text_nodes().&lt;&lt;ITERATOR CODE GOES HERE&gt;&gt;;</code> and then map or manipulate the entries as you see fit.</p>\n\n<p>Why is this solution better? It's more succinct, it uses the good old fashioned <code>Iterator</code> so it's very similar to the answer in JS you gave above.</p>\n"}], "owner": {"reputation": 11878, "user_id": 588759, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/216ea4da5cae7be4030b6242ab90631c?s=128&d=identicon&r=PG", "display_name": "rofrol", "link": "https://stackoverflow.com/users/588759/rofrol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 59471273, "answer_count": 1, "score": 1, "last_activity_date": 1578394882, "creation_date": 1558972028, "last_edit_date": 1559071730, "question_id": 56329121, "link": "https://stackoverflow.com/questions/56329121/how-to-get-only-text-node-with-kuchiki", "title": "How to get only TEXT_NODE with kuchiki", "body": "<p>I have this example HTML which I want to parse with <a href=\"https://crates.io/crates/kuchiki\" rel=\"nofollow noreferrer\">kuchiki</a>:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>&lt;a href=\"https://example.com\"&gt;&lt;em&gt;@&lt;/em&gt;Bananowy&lt;/a&gt;\n</code></pre>\n\n<p>I want only <code>Bananowy</code> without <code>@</code>.</p>\n\n<p>A similar question for JavaScript: <a href=\"https://stackoverflow.com/questions/6520192/how-to-get-the-text-node-of-an-element/6520267#6520267\">How to get the text node of an element?</a></p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 1550, "user_id": 1945844, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0abab320b8888891fa3c00256fca89d2?s=128&d=identicon&r=PG", "display_name": "FremyCompany", "link": "https://stackoverflow.com/users/1945844/fremycompany"}, "edited": false, "score": 0, "creation_date": 1558963586, "post_id": 56326981, "comment_id": 99261599, "body": "I should mention that I use rust version <code>cargo 1.34.0 (6789d8a0a 2019-04-01)</code>"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1558963679, "post_id": 56326981, "comment_id": 99261643, "body": "Does it work with 1.35.0 (latest stable)?"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1558963870, "post_id": 56326981, "comment_id": 99261739, "body": "Because your examples does not have a <code>main</code>, I cannot reproduce your problem. Please show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 1550, "user_id": 1945844, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0abab320b8888891fa3c00256fca89d2?s=128&d=identicon&r=PG", "display_name": "FremyCompany", "link": "https://stackoverflow.com/users/1945844/fremycompany"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1558963954, "post_id": 56326981, "comment_id": 99261788, "body": "@hellow Just tried, this reproduces as well in <code>cargo 1.35.0 (6f3e9c367 2019-04-04)</code>. Technically, you can rename the <code>into</code> function into <code>main</code> and init the Trie, that would have the same result, but let me try to make a standalone. I can&#39;t set the data itself, so I need to process things a bit."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 1, "creation_date": 1558964748, "post_id": 56326981, "comment_id": 99262185, "body": "Do you have a single function consisting of 150,000 statements each creating a temporary <code>vec![]</code>?"}, {"owner": {"reputation": 1550, "user_id": 1945844, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0abab320b8888891fa3c00256fca89d2?s=128&d=identicon&r=PG", "display_name": "FremyCompany", "link": "https://stackoverflow.com/users/1945844/fremycompany"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1558964806, "post_id": 56326981, "comment_id": 99262213, "body": "@MatthieuM. Yes."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1558964852, "post_id": 56326981, "comment_id": 99262244, "body": "Do you compile in Debug or Release?"}, {"owner": {"reputation": 1550, "user_id": 1945844, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0abab320b8888891fa3c00256fca89d2?s=128&d=identicon&r=PG", "display_name": "FremyCompany", "link": "https://stackoverflow.com/users/1945844/fremycompany"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1558965011, "post_id": 56326981, "comment_id": 99262319, "body": "@MatthieuM. doesn&#39;t seem to matter. I&#39;m going to attach a minimum repro, just trying to build it now to make sure the issue is still there with the dummy data."}, {"owner": {"reputation": 1550, "user_id": 1945844, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0abab320b8888891fa3c00256fca89d2?s=128&d=identicon&r=PG", "display_name": "FremyCompany", "link": "https://stackoverflow.com/users/1945844/fremycompany"}, "edited": false, "score": 0, "creation_date": 1558965309, "post_id": 56326981, "comment_id": 99262449, "body": "@MattieuM. Repro link added."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1558967007, "post_id": 56326981, "comment_id": 99263249, "body": "@FremyCompany please use <a href=\"https://play.rust-lang.org/\" rel=\"nofollow noreferrer\">the playground</a> if possible and <b>not</b> a url shortener and <b>not</b> onedrive to share sourcecode. Use <a href=\"https://gist.github.com\" rel=\"nofollow noreferrer\">gist.github.com</a> or as said the playground."}, {"owner": {"reputation": 1550, "user_id": 1945844, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0abab320b8888891fa3c00256fca89d2?s=128&d=identicon&r=PG", "display_name": "FremyCompany", "link": "https://stackoverflow.com/users/1945844/fremycompany"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1558967747, "post_id": 56326981, "comment_id": 99263615, "body": "@hellow Ok, I made a gist. It&#39;s a big gist though, it loads slowly. <a href=\"https://gist.github.com/FremyCompany/1f6132441338f8b219d961c7254bd8ac#file-main-rs\" rel=\"nofollow noreferrer\">gist.github.com/FremyCompany/&hellip;</a>"}], "owner": {"reputation": 1550, "user_id": 1945844, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0abab320b8888891fa3c00256fca89d2?s=128&d=identicon&r=PG", "display_name": "FremyCompany", "link": "https://stackoverflow.com/users/1945844/fremycompany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1558967831, "creation_date": 1558963433, "last_edit_date": 1558967831, "question_id": 56326981, "link": "https://stackoverflow.com/questions/56326981/rust-crate-including-a-large-source-file-to-initialize-a-trie-structure-cannot-c", "title": "Rust crate including a large source file to initialize a Trie structure cannot compile (OOM)", "body": "<p>I have a <code>Trie</code> structure implemented in <code>Rust</code> which I took from somebody else and seems to work just fine:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct Trie&lt;K, V&gt;\nwhere\n    K: std::fmt::Debug + Eq + Hash + Clone,\n    V: std::fmt::Debug + Clone,\n{\n    value: Option&lt;V&gt;,\n    children: HashMap&lt;K, Trie&lt;K, V&gt;&gt;,\n}\n\nimpl&lt;K, V&gt; Trie&lt;K, V&gt;\nwhere\n    K: std::fmt::Debug + Eq + Hash + Clone,\n    V: std::fmt::Debug + Clone,\n{\n    pub fn new() -&gt; Trie&lt;K, V&gt; {\n        Trie {\n            value: None,\n            children: HashMap::new(),\n        }\n    }\n\n    pub fn insert(&amp;mut self, path: Vec&lt;K&gt;, v: V) {\n        if path.is_empty() {\n            match self.value {\n                Some(_) =&gt; panic!(\"key exists\"),\n                None =&gt; {\n                    self.value = Some(v);\n                }\n            }\n            return;\n        }\n\n        self.children\n            .entry(path[0].clone())\n            .or_insert(Trie::new())\n            .insert(path[1..].to_vec(), v)\n    }\n\n    pub fn fetch_or_default(&amp;self, path: Vec&lt;K&gt;, default: V) -&gt; V {\n        let value = self.value.clone().unwrap_or(default);\n        match path.len() {\n            0 =&gt; value,\n            _ =&gt; match self.children.get(&amp;path[0]) {\n                Some(child) =&gt; child.fetch_or_default(path[1..].to_vec(), value),\n                None =&gt; value,\n            },\n        }\n    }\n}\n</code></pre>\n\n<p>I have a special file where I initialize an instance of a Trie based on a dictionary containing 150k words, to which I each assign a number between 0 and 150. </p>\n\n<p>The data was generated via JavaScript so it's not like it's impossibly huge, yet for some reason the Rust compile cannot handle it, and crashes out of memory despite my computer having 16Gb of memory + 2Gb swap (that it entirely uses before crashing).</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use crate::data::*;\n\n/*\na.reduce((str,ai,i) =&gt; { return str + ai.map((w,i) =&gt; `    //${w}\\n    words_trie.insert(vec![' ',${w.split('').reverse().map(c =&gt; `'${c==`'`?`\\\\`:''}${c}'`).join(',')}], ${i});`).join('\\n') + '\\n' }, '');\n*/\n\npub fn into(words_trie: &amp;mut Trie&lt;char, usize&gt;) {\n    // SPECIAL LINE, DO NO REPLACE BY ABOVE FORMULA\n    words_trie.insert(vec![], 150);\n    // ================================================\n    //'n\n    words_trie.insert(vec![' ', 'n', '\\''], 0);\n    ...\n    //(150 000 times a comment followed by an insertion line)\n    ...\n}\n</code></pre>\n\n<p>The error message I get is the following one, but that's just the OOM killer at work:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>process didn't exit successfully: `rustc --edition=2018 --crate-name postag_nl_v1 src/main.rs --color always --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=f33cf4c96979227f -C extra-filename=-f33cf4c96979227f --out-dir /home/fremy/Documents/postag_nl_v1/target/debug/deps -C incremental=/home/fremy/Documents/postag_nl_v1/target/debug/incremental -L dependency=/home/fremy/Documents/postag_nl_v1/target/debug/deps` (signal: 9, SIGKILL: kill)\n</code></pre>\n\n<p>How can I get my Trie initialized based on the dictionary without making the compiler crash?</p>\n\n<blockquote>\n  <p><strong>[EDIT] Here is a minimal repro, with dummy data:</strong></p>\n  \n  <p><a href=\"https://gist.github.com/FremyCompany/1f6132441338f8b219d961c7254bd8ac#file-main-rs\" rel=\"nofollow noreferrer\">https://gist.github.com/FremyCompany/1f6132441338f8b219d961c7254bd8ac#file-main-rs</a></p>\n  \n  <p><a href=\"https://1drv.ms/u/s!AhVrPgyThAkTgQ8v2U99Ffzug7rJ\" rel=\"nofollow noreferrer\">https://1drv.ms/u/s!AhVrPgyThAkTgQ8v2U99Ffzug7rJ</a> [1Mb zip]</p>\n</blockquote>\n"}, {"tags": ["rust", "rust-cargo"], "answers": [{"tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": true, "score": 4, "last_activity_date": 1558947688, "creation_date": 1558947688, "answer_id": 56322836, "question_id": 56322727, "link": "https://stackoverflow.com/questions/56322727/is-there-any-way-to-specify-that-multiple-versions-of-a-dependency-are-valid-for/56322836#56322836", "title": "Is there any way to specify that multiple versions of a dependency are valid for my library?", "body": "<p>As specified in the Cargo book, you can use <a href=\"https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html#inequality-requirements\" rel=\"nofollow noreferrer\">inequality requirements</a> and multiple requirements combined to form a range of valid versions.</p>\n\n<pre><code>MyLibraryDep = {version = \"&gt;=0.1.0, &lt;=0.2.0\"}\n</code></pre>\n\n<p>Such a requirement will also allow Cargo to choose the appropriate version and should be allowed by crates.io.</p>\n"}], "owner": {"reputation": 336, "user_id": 2115405, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fe3e511f82696b9306e063bffaa0e913?s=128&d=identicon&r=PG", "display_name": "Kristoffer", "link": "https://stackoverflow.com/users/2115405/kristoffer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 56322836, "answer_count": 1, "score": 1, "last_activity_date": 1573076909, "creation_date": 1558947329, "last_edit_date": 1573076909, "question_id": 56322727, "link": "https://stackoverflow.com/questions/56322727/is-there-any-way-to-specify-that-multiple-versions-of-a-dependency-are-valid-for", "title": "Is there any way to specify that multiple versions of a dependency are valid for my library?", "body": "<p>I am using a library that breaks depending on which other crates  I am using. The way around is to downgrade a few dependencies and keep a local version of the library. </p>\n\n<p>It works if I put <code>MyLibraryDep = {version = \"*\"}</code> in my <code>Cargo.toml</code>. Since Cargo will then fix dependencies automatically, but crates.io doesn't allow for that.</p>\n\n<p><strong>Example:</strong> </p>\n\n<ul>\n<li><p>If using <code>MyLibrary</code>, and <code>LibraryA</code> I have to use <code>MyLibraryDep v0.1.0</code> in <code>MyLibrary</code></p></li>\n<li><p>If using <code>MyLibrary</code>, and <code>LibraryB</code> I have to use <code>MyLibraryDep v0.2.0</code> in <code>MyLibrary</code></p></li>\n</ul>\n"}, {"tags": ["cassandra", "rust", "connection-pooling"], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 8328954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cce310968f5d62c38c8f845423bde059?s=128&d=identicon&r=PG&f=1", "display_name": "Chi Wei Shen", "link": "https://stackoverflow.com/users/8328954/chi-wei-shen"}, "edited": false, "score": 0, "creation_date": 1559010811, "post_id": 56325997, "comment_id": 99274901, "body": "The way I can think of is to build a function on actix_web to replace Diesel, but this is a bit high for me, so I have to find relevant examples..."}], "tags": [], "owner": {"reputation": 10895, "user_id": 158226, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/1b171ce1f20ce82a31999e843a7fe9b6?s=128&d=identicon&r=PG", "display_name": "djc", "link": "https://stackoverflow.com/users/158226/djc"}, "is_accepted": false, "score": 0, "last_activity_date": 1558959742, "creation_date": 1558959742, "answer_id": 56325997, "question_id": 56320411, "link": "https://stackoverflow.com/questions/56320411/how-to-use-actix-web-with-a-cassandra-sys-rs-connection-pool/56325997#56325997", "title": "How to use actix_web with a cassandra-sys-rs connection pool?", "body": "<p>You should probably take a look at <a href=\"https://crates.io/crates/r2d2\" rel=\"nofollow noreferrer\">r2d2</a> -- I think this is what most Diesel projects use. From the README, it does not seem to support Cassandra yet, but maybe you can add support?</p>\n"}], "owner": {"reputation": 107, "user_id": 8328954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cce310968f5d62c38c8f845423bde059?s=128&d=identicon&r=PG&f=1", "display_name": "Chi Wei Shen", "link": "https://stackoverflow.com/users/8328954/chi-wei-shen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1558959742, "creation_date": 1558936899, "last_edit_date": 1558937221, "question_id": 56320411, "link": "https://stackoverflow.com/questions/56320411/how-to-use-actix-web-with-a-cassandra-sys-rs-connection-pool", "title": "How to use actix_web with a cassandra-sys-rs connection pool?", "body": "<p>How in the program execution, cassandra established connection, waiting to be processed?\nBecause of my architecture, combined with actix_web and cassandra-sys-rs processing, but such a method, the input of a url to establish a connection.\nIf I want to connect with cassandra always, instead of re-establishing the request every time send it. The actix_web document explains the use of Diesel, but it does not support cassandra applications, so how do I use this?</p>\n\n<p><a href=\"https://github.com/pili2026/cassandra-rs-driver/blob/master/src/main.rs\" rel=\"nofollow noreferrer\">code</a></p>\n"}, {"tags": ["shell", "rust"], "comments": [{"owner": {"reputation": 2661, "user_id": 1554844, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/cc080ac4f9f095c8dfbb1d79cd1eab63?s=128&d=identicon&r=PG", "display_name": "Vaughan Hilts", "link": "https://stackoverflow.com/users/1554844/vaughan-hilts"}, "edited": false, "score": 5, "creation_date": 1558927907, "post_id": 56319342, "comment_id": 99247143, "body": "Your shell is converting the star. It&#39;s not the program. You can wrap it in quotes, such as &quot;*&quot; and it should work (when passing it into the application)"}], "answers": [{"comments": [{"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1558946080, "post_id": 56319375, "comment_id": 99252812, "body": "While this does answer the question, I&#39;d rather quote the entire expression and use <code>.&#47;program &#39;1 * 1&#39;</code> to avoid further surprises."}], "tags": [], "owner": {"reputation": 2661, "user_id": 1554844, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/cc080ac4f9f095c8dfbb1d79cd1eab63?s=128&d=identicon&r=PG", "display_name": "Vaughan Hilts", "link": "https://stackoverflow.com/users/1554844/vaughan-hilts"}, "is_accepted": true, "score": 7, "last_activity_date": 1558928107, "creation_date": 1558928107, "answer_id": 56319375, "question_id": 56319342, "link": "https://stackoverflow.com/questions/56319342/how-do-i-accept-a-literal-as-a-command-line-argument/56319375#56319375", "title": "How do I accept a literal &quot;*&quot; as a command-line argument?", "body": "<p>The wildcard (*) is expanding out. The shell is going to send this out to the program before it even sees what you <em>actually typed</em></p>\n\n<p><a href=\"https://stackoverflow.com/a/18325066/1554844\">You can read more about here.</a></p>\n\n<p>To avoid this, you can just wrap it in quotes, like so:</p>\n\n<pre><code>./program 1 \"*\" 1\n</code></pre>\n"}], "owner": {"reputation": 8933, "user_id": 546822, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/N4O1Z.jpg?s=128&g=1", "display_name": "Serjik", "link": "https://stackoverflow.com/users/546822/serjik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 56319375, "answer_count": 1, "score": 1, "last_activity_date": 1558942958, "creation_date": 1558927722, "last_edit_date": 1558942958, "question_id": 56319342, "link": "https://stackoverflow.com/questions/56319342/how-do-i-accept-a-literal-as-a-command-line-argument", "title": "How do I accept a literal &quot;*&quot; as a command-line argument?", "body": "<p>I am writing a very simple command line calculator in rust, getting a number ,an operator, then another number and do the calculation and print the result. To show what I am getting from command args, I have printed them in a loop before the main code. I works fine for plus, minus and division, but for multiplication I get unexpected result, as I print it, instead of a star (*) for multiplication, I get the files list on my current directory.\nHere is my rust code, I will appreciate an explanation and if there is any workaround.</p>\n\n<pre><code>use std::env;\n\nfn main(){\n    let args: Vec&lt;String&gt; = env::args().collect();\n\n    for arg in args.iter(){\n        println!(\"{}\", arg);\n    }\n\n    let mut result = 0;\n    let opt = args[2].to_string();\n    let oper1 = args[1].parse::&lt;i32&gt;().unwrap();\n    let oper2 = args[3].parse::&lt;i32&gt;().unwrap();\n    match opt.as_ref(){\n        \"+\" =&gt; result = oper1 + oper2,\n        \"-\" =&gt; result = oper1 - oper2,\n        \"*\" =&gt; result = oper1 * oper2,\n        \"/\" =&gt; result = oper1 / oper2,\n        _ =&gt; println!(\"Error\")\n    }\n\n    println!(\"{} {} {} = {}\", oper1, opt, oper2, result);\n\n}\n</code></pre>\n"}, {"tags": ["input", "printing", "rust"], "comments": [{"owner": {"reputation": 2661, "user_id": 1554844, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/cc080ac4f9f095c8dfbb1d79cd1eab63?s=128&d=identicon&r=PG", "display_name": "Vaughan Hilts", "link": "https://stackoverflow.com/users/1554844/vaughan-hilts"}, "edited": false, "score": 0, "creation_date": 1558925656, "post_id": 56319133, "comment_id": 99246781, "body": "Is <code>print</code> buffered in Rust? What if you add a new line to the <code>print</code> statement?"}], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1558938446, "post_id": 56319148, "comment_id": 99249705, "body": "answer obvious duplicate doesn&#39;t help the site see <a href=\"https://hackmd.io/mAwiUnSEQauZ9YB-eAdV7g\" rel=\"nofollow noreferrer\">hackmd.io/mAwiUnSEQauZ9YB-eAdV7g</a>"}], "tags": [], "owner": {"reputation": 2661, "user_id": 1554844, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/cc080ac4f9f095c8dfbb1d79cd1eab63?s=128&d=identicon&r=PG", "display_name": "Vaughan Hilts", "link": "https://stackoverflow.com/users/1554844/vaughan-hilts"}, "is_accepted": true, "score": 0, "last_activity_date": 1558925736, "creation_date": 1558925736, "answer_id": 56319148, "question_id": 56319133, "link": "https://stackoverflow.com/questions/56319133/print-executes-after-the-input-is-entered/56319148#56319148", "title": "print!() executes after the input is entered", "body": "<p>You can read the Rust documentation here: <a href=\"https://doc.rust-lang.org/std/macro.print.html\" rel=\"nofollow noreferrer\">https://doc.rust-lang.org/std/macro.print.html</a></p>\n\n<p>Specifically, this line:</p>\n\n<blockquote>\n  <p>\"Note that stdout is frequently line-buffered by default so it may be necessary to use io::stdout().flush() to ensure the output is emitted immediately.</p>\n</blockquote>\n\n<p>This is pretty common when working with the terminal in most languages. <code>stdout</code> is buffered on almost all terminals. You can turn it off on some AFAIK but you're better of just either calling flush as they suggest or I believe most terminals will flush their output if you write a new line to it. </p>\n"}, {"tags": [], "owner": {"reputation": 346, "user_id": 11493135, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-I08b-WqLhaA/AAAAAAAAAAI/AAAAAAAABXw/C6tFBaoc6Yg/photo.jpg?sz=128", "display_name": "Rohit Krishnan", "link": "https://stackoverflow.com/users/11493135/rohit-krishnan"}, "is_accepted": false, "score": 0, "last_activity_date": 1558938668, "creation_date": 1558938668, "answer_id": 56320746, "question_id": 56319133, "link": "https://stackoverflow.com/questions/56319133/print-executes-after-the-input-is-entered/56320746#56320746", "title": "print!() executes after the input is entered", "body": "<p>This is how I solved the problem(thanks to <a href=\"https://stackoverflow.com/users/1554844/vaughan-hilts\">Vaughan Hills</a>) :</p>\n\n<pre><code>// Returns the input for a given message - msg\nfn input(msg : &amp;str) -&gt; String {\n    let mut input = String::new();\n    print!(\"{}\", msg);\n    io::stdout().flush().unwrap();\n    io::stdin().read_line(&amp;mut input).unwrap();\n    input.trim().to_string()\n}\n</code></pre>\n"}], "owner": {"reputation": 346, "user_id": 11493135, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-I08b-WqLhaA/AAAAAAAAAAI/AAAAAAAABXw/C6tFBaoc6Yg/photo.jpg?sz=128", "display_name": "Rohit Krishnan", "link": "https://stackoverflow.com/users/11493135/rohit-krishnan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "closed_date": 1558938831, "accepted_answer_id": 56319148, "answer_count": 2, "score": 0, "last_activity_date": 1558938668, "creation_date": 1558925570, "question_id": 56319133, "link": "https://stackoverflow.com/questions/56319133/print-executes-after-the-input-is-entered", "closed_reason": "Duplicate", "title": "print!() executes after the input is entered", "body": "<p>i want to know why the <strong>print!()</strong> macro here executes after the <strong>read_line</strong></p>\n\n<pre><code>// ./src/main.rs\nuse std::io;\n\nfn main() {\n    print!(\"Input : \");\n    let stdin = io::stdin();\n    let mut input = String::new();\n    stdin.read_line(&amp;mut input).expect(\"Couldn't read_line\");\n}\n</code></pre>\n\n<p>This code prints out :</p>\n\n<pre><code>   heyy\n   Input : \n</code></pre>\n\n<p>But i expect :</p>\n\n<pre><code>Input : heyy\n</code></pre>\n"}, {"tags": ["error-handling", "rust"], "comments": [{"owner": {"reputation": 3472, "user_id": 4072509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/16VK8.jpg?s=128&g=1", "display_name": "apetranzilla", "link": "https://stackoverflow.com/users/4072509/apetranzilla"}, "edited": false, "score": 0, "creation_date": 1558896753, "post_id": 56316382, "comment_id": 99241989, "body": "I don&#39;t think this is possible without making <code>MyError</code> generic. <code>FromStr::Err</code> isn&#39;t a concrete type, it&#39;s a type specified by implementations of <code>FromStr</code>, which means you can&#39;t refer to it as if it were a concrete type."}], "answers": [{"tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": false, "score": 2, "last_activity_date": 1558906792, "creation_date": 1558906792, "answer_id": 56317554, "question_id": 56316382, "link": "https://stackoverflow.com/questions/56316382/implement-a-trait-for-another-trait-item-type/56317554#56317554", "title": "Implement a trait for another trait Item type", "body": "<p>The type <code>FromStr::Err</code> is an <em>associated type</em> of the <code>FromStr</code> trait. Every implementation of <code>FromStr</code> has its own associated type, and this type is completely unconstrained \u2013 it could be any type at all. This means you would need a conversion from any type to <code>MyError</code> to achieve what you want:</p>\n\n<pre><code>impl&lt;T&gt; From&lt;T&gt; for MyError {\n    fn from(e: T) -&gt; MyError {\n        MyError::Parse\n    }\n}\n</code></pre>\n\n<p>However, this implementation is disallowed by the coherence rules \u2013 it conflicts with the implementation of <code>From&lt;T&gt;</code> for any type <code>T</code> in the standard library. And even if this implementation was allowed, it wouldn't really do what you want \u2013 <em>any</em> error type would be converted to <code>MyError::Parse</code>, not just parse errors.</p>\n\n<p>One possible workaround is to introduce a marker trait for parse error types:</p>\n\n<pre><code>trait ParseError {}\n\nimpl&lt;T: ParseError&gt; From&lt;T&gt; for MyError {\n    fn from(e: T) -&gt; MyError {\n        MyError::Parse\n    }\n}\n</code></pre>\n\n<p>You can then implement this marker trait for all parse error types:</p>\n\n<pre><code>impl ParseError for std::str::ParseBoolError {}\nimpl ParseError for std::num::ParseFloatError {}\nimpl ParseError for std::num::ParseIntError {}\nimpl ParseError for std::net::AddrParseError {}\nimpl ParseError for std::char::ParseCharError {}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 46065, "user_id": 234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/463c0219a51a5d1fd08e1fa280811b57?s=128&d=identicon&r=PG", "display_name": "Francis Gagn&#233;", "link": "https://stackoverflow.com/users/234590/francis-gagn%c3%a9"}, "is_accepted": true, "score": 1, "last_activity_date": 1558909438, "creation_date": 1558909438, "answer_id": 56317814, "question_id": 56316382, "link": "https://stackoverflow.com/questions/56316382/implement-a-trait-for-another-trait-item-type/56317814#56317814", "title": "Implement a trait for another trait Item type", "body": "<p>If you're discarding the parse error anyway, use <a href=\"https://doc.rust-lang.org/stable/std/result/enum.Result.html#method.map_err\" rel=\"nofollow noreferrer\"><code>map_err</code></a> to change the error locally:</p>\n\n<pre><code>fn process&lt;R: FromStr&gt;(s: &amp;str) -&gt; Result&lt;(), MyError&gt; {\n    let _ = s.parse::&lt;R&gt;().map_err(|_| MyError::Parse)?;\n    Ok(())\n}\n</code></pre>\n"}], "owner": {"reputation": 739, "user_id": 1063413, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c3abcf58e707bf7c626e7f6baa210e4b?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/1063413/alexander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 56317814, "answer_count": 2, "score": 0, "last_activity_date": 1558909438, "creation_date": 1558896067, "question_id": 56316382, "link": "https://stackoverflow.com/questions/56316382/implement-a-trait-for-another-trait-item-type", "title": "Implement a trait for another trait Item type", "body": "<p>I need to convert a parse error to my own Error type while returning Result. Simplified, it looks like the following:</p>\n\n<pre><code>enum MyError {\n    Parse,\n    ...,\n}\n\nfn process&lt;R: FromStr&gt;(s: &amp;str) -&gt; Result&lt;(), MyError&gt; {\n    Ok(s.parse::&lt;R&gt;()?)\n}\n</code></pre>\n\n<p>For above to work From trait should be implemented. This doesn't work:</p>\n\n<pre><code>impl From&lt;std::str::FromStr::Err&gt; for MyError {\n    fn from(e: std::str::FromStr::Err) -&gt; MyError {\n        MyError::Parse\n    }\n}\n</code></pre>\n\n<p>The compiler diagnostics: </p>\n\n<pre><code>help: use fully-qualified syntax: `&lt;Type as std::str::FromStr&gt;::Err`\n</code></pre>\n\n<p>But I don't know the exact <code>Type</code> here. The whole point is to allow conversion from all possible errors.</p>\n"}, {"tags": ["parsing", "types", "rust"], "comments": [{"owner": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "edited": false, "score": 0, "creation_date": 1558896320, "post_id": 56316087, "comment_id": 99241875, "body": "What input are you giving when you run the program? What output do you expect for that input?"}, {"owner": {"reputation": 1384, "user_id": 10240085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HBxgL.jpg?s=128&g=1", "display_name": "Muhammad Naufil", "link": "https://stackoverflow.com/users/10240085/muhammad-naufil"}, "reply_to_user": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "edited": false, "score": 0, "creation_date": 1558896481, "post_id": 56316087, "comment_id": 99241921, "body": "@User I have input 100 and I expect to get 4 at output."}, {"owner": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "edited": false, "score": 0, "creation_date": 1558896723, "post_id": 56316087, "comment_id": 99241976, "body": "With that input, I don&#39;t get the panic. Instead I get 0 (and I can see where that comes from). Can you confirm that entering 100 makes your program panic?"}], "answers": [{"tags": [], "owner": {"reputation": 2154, "user_id": 3763264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f43c767b10ee2ee9aa75680bf7377779?s=128&d=identicon&r=PG&f=1", "display_name": "Finomnis", "link": "https://stackoverflow.com/users/3763264/finomnis"}, "is_accepted": false, "score": 0, "last_activity_date": 1558897840, "creation_date": 1558897840, "answer_id": 56316610, "question_id": 56316087, "link": "https://stackoverflow.com/questions/56316087/why-unable-to-parse-a-string-rust/56316610#56316610", "title": "Why unable to parse a string | Rust", "body": "<p>I would usually try to fix the code, but this one just seems way to convoluted.</p>\n\n<p>Here is a simpler solution:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::io;\n\nfn main() {\n    let mut binary = String::new();\n    println!(\"Enter a decimal: \");\n\n    io::stdin().read_line(&amp;mut binary)\n        .expect(\"Couldn't read line\");\n\n    match to_decimal(binary) {\n        Some(num) =&gt; println!(\"{}\", num),\n        None =&gt; println!(\"Not a binary!\")\n    }\n}\n\nfn to_decimal(binary_str:String) -&gt; Option&lt;i64&gt; {\n    let binary_str = binary_str.trim();\n\n    let mut out_num = 0;\n    for c in binary_str.chars() {\n        match c {\n            '0' =&gt; out_num = out_num * 2,\n            '1' =&gt; out_num = out_num * 2 + 1,\n            _ =&gt; return None\n        }\n    }\n\n    Some(out_num)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2154, "user_id": 3763264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f43c767b10ee2ee9aa75680bf7377779?s=128&d=identicon&r=PG&f=1", "display_name": "Finomnis", "link": "https://stackoverflow.com/users/3763264/finomnis"}, "edited": false, "score": 0, "creation_date": 1558905892, "post_id": 56316816, "comment_id": 99243932, "body": "Holy. You&#39;ve done what I was too lazy for :D and you&#39;ve done a really good job. Get my upvote!"}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1558949241, "post_id": 56316816, "comment_id": 99254427, "body": "That&#39;s an incredible answer, teaching the OP to fish and introducing them to further tools (clippy, <code>dbg!</code>) along the way."}], "tags": [], "owner": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "is_accepted": true, "score": 10, "last_activity_date": 1558907619, "last_edit_date": 1558907619, "creation_date": 1558899792, "answer_id": 56316816, "question_id": 56316087, "link": "https://stackoverflow.com/questions/56316087/why-unable-to-parse-a-string-rust/56316816#56316816", "title": "Why unable to parse a string | Rust", "body": "<p>There are a lot of problems with the code as written. The good news is that you can fix most of the problems by listening to the compiler warnings!</p>\n\n<pre><code>  --&gt; src/main.rs:19:17\n   |\n19 |         let mut bits = String::new();\n   |                 ^^^^ help: consider prefixing with an underscore: `_bits`\n   |\n   = note: #[warn(unused_variables)] on by default\n</code></pre>\n\n<p>This tells you that the variable <code>bits</code> isn't used after this declaration. If you intend to use it later, you can just comment it out for now.</p>\n\n<pre><code>warning: unused variable: `result`\n  --&gt; src/main.rs:24:21\n   |\n24 |             let mut result = result + (binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap() * 2^(i as u32));\n   |                     ^^^^^^ help: consider prefixing with an underscore: `_result`\n   |\n   = note: #[warn(unused_variables)] on by default\n</code></pre>\n\n<p>This is the big one. This tells us that the variable <code>result</code> is unused. But wait! we're using it right here! Nope! Actually, by using <code>let mut</code> here, we're making a new variable and shadowing the old one. What you want is to instead overwrite the old value. Simply change <code>let mut result = ...</code> to <code>result = ...</code>.</p>\n\n<p>Now if we run the program again and input <code>100</code>, we'll get an output of <code>5</code>. This still doesn't seem right, but we still have a few warnings to fix, so let's come back to this.</p>\n\n<pre><code>warning: variable does not need to be mutable\n  --&gt; src/main.rs:13:15\n   |\n13 | fn to_decimal(mut binary_str:String) -&gt; String {\n   |               ----^^^^^^^^^^\n   |               |\n   |               help: remove this `mut`\n   |\n   = note: #[warn(unused_mut)] on by default\n</code></pre>\n\n<p>If we aren't going to mutate the input string, we shouldn't make it mutable. Just remove the <code>mut</code>. Same for the other two warnings (lines 14 and 20).</p>\n\n<p>Alright! Now we can run the program without any warnings. However, there are some more advanced lints we can run using <code>cargo clippy</code>. If you don't have clippy installed yet, you can install it with <code>rustup install component clippy</code>.</p>\n\n<p>Now we have a few more warnings to take care of.</p>\n\n<pre><code>warning: operator precedence can trip the unwary\n  --&gt; src/main.rs:24:32\n   |\n24 |             result = result + (binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap() * 2^(i as u32));\n   |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: consider parenthesizing your expression: `(binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap() * 2) ^ (i as u32)`\n   |\n   = note: #[warn(clippy::precedence)] on by default\n   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#precedence\n</code></pre>\n\n<p>Uh oh. Clippy is telling us that the precedence rules indicate that <code>*</code> is evaluated before <code>^</code>. That's not what we'd expect from multiplication and exponents. It turns out that <code>^</code> is <em>not</em> the exponent operator. Instead, it's the bitwise xor. If we want powers of a number, we can use the <code>pow</code> method, so replace <code>2 ^ (i as u32)</code> with <code>2.pow(i as u32)</code>. This will cause a compiler error with the message <code>error[E0689]: can't call method `pow` on ambiguous numeric type `{integer}`</code>. Ok. We can make the numeric type unambiguous using a suffix. Change it to <code>2_u32.pow(i as u32)</code>.</p>\n\n<p>We can fix the other three warnings that Clippy gives us just by using the suggestion. After that, Clippy gives one more warning, which also is fixed with just the suggestion.</p>\n\n<p>Before we continue, let's make our code a bit prettier by running <code>cargo fmt</code>. Finally, the code looks like this:</p>\n\n<pre><code>use std::io;\n\nfn main() {\n    let mut binary = String::new();\n    println!(\"Enter a decimal: \");\n    io::stdin()\n        .read_line(&amp;mut binary)\n        .expect(\"Couldn't read line\");\n    println!(\"{}\", to_decimal(binary));\n}\n\nfn to_decimal(binary_str: String) -&gt; String {\n    let binary_no: u32 = binary_str.trim().parse().expect(\"invalid input\");\n    if binary_no == 0 {\n        format!(\"{}\", binary_no)\n    } else {\n        //let mut bits = String::new();\n        let binary_vec: Vec&lt;char&gt; = binary_str.chars().collect();\n        let mut result = 0;\n        let mut i = 0;\n        while i &lt;= binary_str.len() - 2 {\n            result += binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap() * 2_u32.pow(i as u32);\n            i += 1;\n        }\n        format!(\"{}\", result)\n    }\n}\n</code></pre>\n\n<p>We fixed two bugs and cleaned up the code only using compiler warnings and basic tools! Pretty good, eh? But now if we input <code>100</code>, our output is <code>1</code>. That isn't right. Let's add some debug statements to see if we can see what's going on.</p>\n\n<pre><code>result += dbg!(binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap()) * dbg!(2_u32.pow(i as u32));\n</code></pre>\n\n<p>If we run it now, here's what we get.</p>\n\n<pre><code>Enter a decimal: \n100\n[src/main.rs:22] binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap() = 1\n[src/main.rs:22] 2u32.pow(i as u32) = 1\n[src/main.rs:22] binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap() = 0\n[src/main.rs:22] 2u32.pow(i as u32) = 2\n[src/main.rs:22] binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap() = 0\n[src/main.rs:22] 2u32.pow(i as u32) = 4\n1\n</code></pre>\n\n<p>We can see that it's parsing the digits correctly: <code>binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap()</code> is <code>1</code>, then <code>0</code>, then <code>0</code>. The powers of 2 look fine too. The problem here is that it's backwards! We want the left digit to be multiplied with the <em>highest</em> power of 2. Let me note that this is the part of the code where you're the least idiomatic. It's much better to use, at the very least, a <code>for</code> loop for this kind of thing. Iterators would be even better if you can manage it.</p>\n\n<p>In any case, we can reverse the order by making our powers go from <code>binary_str.len() - 2</code> down to <code>0</code> instead of the other way around. Thus, we can change the code to</p>\n\n<pre><code>while i &lt;= binary_str.len() - 2 {\n    result += dbg!(binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap()) * dbg!(2_u32.pow((binary_str.len() - 2 - i) as u32));\n    i += 1;\n}\n</code></pre>\n\n<p>We get</p>\n\n<pre><code>Enter a decimal: \n100\n[src/main.rs:22] binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap() = 1\n[src/main.rs:22] 2u32.pow((binary_str.len() - 2 - i) as u32) = 4\n[src/main.rs:22] binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap() = 0\n[src/main.rs:22] 2u32.pow((binary_str.len() - 2 - i) as u32) = 2\n[src/main.rs:22] binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap() = 0\n[src/main.rs:22] 2u32.pow((binary_str.len() - 2 - i) as u32) = 1\n4\n</code></pre>\n\n<p>so we see that the powers are correctly reversed from 4 down to 1. And our answer is finally correct! Test it on a few more inputs and try to find some edge cases. There are still some more bugs to find. Once you're happy with your code, take out the debug statements.</p>\n"}], "owner": {"reputation": 1384, "user_id": 10240085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HBxgL.jpg?s=128&g=1", "display_name": "Muhammad Naufil", "link": "https://stackoverflow.com/users/10240085/muhammad-naufil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 472, "favorite_count": 0, "accepted_answer_id": 56316816, "answer_count": 2, "score": 0, "last_activity_date": 1558907619, "creation_date": 1558893539, "last_edit_date": 1558896458, "question_id": 56316087, "link": "https://stackoverflow.com/questions/56316087/why-unable-to-parse-a-string-rust", "title": "Why unable to parse a string | Rust", "body": "<p>I am making decimal to binary conversion program. Why am i unable to parse a string into a number? <code>binary_vec[i]</code> is a <code>character</code>. I applied <code>to_string()</code> method to convert it into a string because <code>parse()</code> doesn't apply to a character, but it still giving me an error.</p>\n\n<pre><code>use std::io;\n\nfn main() {\n    let mut binary = String::new();\n    println!(\"Enter a decimal: \");\n    io::stdin().read_line(&amp;mut binary)\n        .ok()\n        .expect(\"Couldn't read line\");\n    println!(\"{}\",to_decimal(binary));\n\n}\n\nfn to_decimal(mut binary_str:String) -&gt; String {\n    let mut binary_no: u32 = binary_str.trim().parse().expect(\"invalid input\");\n    if binary_no == 0 {\n        format!(\"{}\",binary_no)\n                } \n    else {\n        let mut bits = String::new();\n        let mut binary_vec: Vec&lt;char&gt; = binary_str.chars().collect();\n        let mut result = 0;\n        let mut i = 0;\n        while i &lt;=binary_str.len()-2{\n            let mut result = result + (binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap() * 2^(i as u32));\n            i = i +1;\n        }\n        format!(\"{}\",result)\n        }\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code> Compiling sixteen v0.1.0 (C:\\Users\\Muhammad.3992348\\Desktop\\rust\\hackathon\\sixteen)\nwarning: unused variable: `bits`\n  --&gt; src\\main.rs:19:17\n   |\n19 |         let mut bits = String::new();\n   |                 ^^^^ help: consider prefixing with an underscore: `_bits`\n   |\n   = note: #[warn(unused_variables)] on by default\n\nwarning: unused variable: `result`\n  --&gt; src\\main.rs:24:21\n   |\n24 |             let mut result = result + (binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap() * 2^(i as u32));\n   |                     ^^^^^^ help: consider prefixing with an underscore: `_result`\n\nwarning: variable does not need to be mutable\n  --&gt; src\\main.rs:13:15\n   |\n13 | fn to_decimal(mut binary_str:String) -&gt; String {\n   |               ----^^^^^^^^^^\n   |               |\n   |               help: remove this `mut`\n   |\n   = note: #[warn(unused_mut)] on by default\n\nwarning: variable does not need to be mutable\n  --&gt; src\\main.rs:14:9\n   |\n14 |     let mut binary_no: u32 = binary_str.trim().parse().expect(\"invalid input\");\n   |         ----^^^^^^^^^\n   |         |\n   |         help: remove this `mut`\n\nwarning: variable does not need to be mutable\n  --&gt; src\\main.rs:19:13\n   |\n19 |         let mut bits = String::new();\n   |             ----^^^^\n   |             |\n   |             help: remove this `mut`\n\nwarning: variable does not need to be mutable\n  --&gt; src\\main.rs:20:13\n   |\n20 |         let mut binary_vec: Vec&lt;char&gt; = binary_str.chars().collect();\n   |             ----^^^^^^^^^^\n   |             |\n   |             help: remove this `mut`\n\nwarning: variable does not need to be mutable\n  --&gt; src\\main.rs:21:13\n   |\n21 |         let mut result = 0;\n   |             ----^^^^^^\n   |             |\n   |             help: remove this `mut`\n\nwarning: variable does not need to be mutable\n  --&gt; src\\main.rs:24:17\n   |\n24 |             let mut result = result + (binary_vec[i].to_string().parse::&lt;u32&gt;().unwrap() * 2^(i as u32));\n   |                 ----^^^^^^\n   |                 |\n   |                 help: remove this `mut`\n\n    Finished dev [unoptimized + debuginfo] target(s) in 1.04s\n     Running `target\\debug\\sixteen.exe`\nEnter a decimal:\n100\nthread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: ParseIntError { kind: InvalidDigit }', src\\libcore\\result.rs:997:5\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\nerror: process didn't exit successfully: `target\\debug\\sixteen.exe` (exit code: 101)\n</code></pre>\n\n<p>Edit:\nI have input 100 and I expect to get 4 at output.</p>\n"}, {"tags": ["php", "c", "rust", "ffi"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1558883488, "post_id": 56314294, "comment_id": 99238591, "body": "<code>(const char*)(unsigned long int)(1)</code> this don&#39;t make any sense in C"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1558883534, "post_id": 56314294, "comment_id": 99238597, "body": "<code>ZendFunctionArgument</code> please include your Rust definition of this structure."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1558883592, "post_id": 56314294, "comment_id": 99238613, "body": "maybe you just want this <code>let x = 1 as *const i8;</code> but this still don&#39;t make sense"}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1558885163, "post_id": 56314294, "comment_id": 99238997, "body": "Should <code>name</code> really have type <code>union ( const char* str; unsigned long integer; }</code>?"}, {"owner": {"reputation": 2503, "user_id": 4737924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06ff2f73692374431f3ddba82498dd9b?s=128&d=identicon&r=PG", "display_name": "Aleksander Wons", "link": "https://stackoverflow.com/users/4737924/aleksander-wons"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1558891490, "post_id": 56314294, "comment_id": 99240721, "body": "@Stargateur I added some more details, hope that helps."}], "answers": [{"tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": true, "score": 2, "last_activity_date": 1558909949, "creation_date": 1558909949, "answer_id": 56317858, "question_id": 56314294, "link": "https://stackoverflow.com/questions/56314294/how-do-you-cast-integer-in-rust-to-char-in-c/56317858#56317858", "title": "How do you cast integer in Rust to char* in C", "body": "<p>Your code is <strong>not</strong> converting an integer to a pointer - as Stargateur says in the comments, the correct way to do that is more simply <code>required_args as *const ::std::os::raw::c_char</code>. </p>\n\n<p>Instead, you are allocating <code>required_args</code> on the heap with <code>Box::new</code>, and then taking it out of the hands of the memory manager with <code>into_raw</code> - giving a pointer to the value of <code>required_args</code>, which, until you manually clean it up, will live forever.</p>\n\n<blockquote>\n  <p>This seem to work with the following test</p>\n</blockquote>\n\n<p>Because you are dereferencing the pointer into the heap by doing <code>*arguments[0].name</code>, and the value at that pointer is indeed <code>5</code>.</p>\n\n<blockquote>\n  <p>Unfortunatelly on PHP end (when the code is executed) the value is totally random on every execution.</p>\n</blockquote>\n\n<p>This is unsurprising. Since the end result of your code is that the value of the field is just some pointer into the heap, it will change every time you run the code. </p>\n"}], "owner": {"reputation": 2503, "user_id": 4737924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06ff2f73692374431f3ddba82498dd9b?s=128&d=identicon&r=PG", "display_name": "Aleksander Wons", "link": "https://stackoverflow.com/users/4737924/aleksander-wons"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 275, "favorite_count": 0, "accepted_answer_id": 56317858, "answer_count": 1, "score": 0, "last_activity_date": 1558909949, "creation_date": 1558880100, "last_edit_date": 1558891312, "question_id": 56314294, "link": "https://stackoverflow.com/questions/56314294/how-do-you-cast-integer-in-rust-to-char-in-c", "title": "How do you cast integer in Rust to char* in C", "body": "<p>I have the following use case. A struct in C looks like this:</p>\n\n<pre><code>typedef struct _zend_internal_arg_info {\n    const char *name;\n    zend_type type;\n    zend_uchar pass_by_reference;\n    zend_bool is_variadic;\n} zend_internal_arg_info;\n</code></pre>\n\n<p>Normally the <code>name</code> field contains a function name. But due to internal implementation this field can also carry an integer. On C end there is a macro doing the casting like this:</p>\n\n<pre><code>(const char*)(unsigned long int)(1)\n</code></pre>\n\n<p>What I want to do is to do the same cast on Rust end. I ended up with the following code:</p>\n\n<pre><code>fn create_null_argument(required_args: u8, return_reference: bool) -&gt; ZendFunctionArgument {\n    let required_args_ref = Box::into_raw(Box::new(required_args as i8)) as *const i8;\n    ZendFunctionArgument {\n        arg: php_bindings::_zend_internal_arg_info {\n            name: required_args_ref,\n            type_: 0,\n            pass_by_reference: if return_reference { 1 } else { 0 },\n            is_variadic: 0,\n        },\n    }\n}\n</code></pre>\n\n<p>This seem to work with the following test:</p>\n\n<pre><code>let arguments_ptr = ZendFunctionArguments::new(5, true).into_raw();\nunsafe {\n    let arguments: Vec&lt;php_bindings::_zend_internal_arg_info&gt; = Vec::from_raw_parts(arguments_ptr as *mut _, 1, 1);\n    let required_args = *arguments[0].name;\n    assert_eq!(5, required_args);\n}\n</code></pre>\n\n<p>Unfortunatelly on PHP end (when the code is executed) the value is totally random on every execution.\nWhat I want to ask here is whether the way I am casting the i8 is correct comparing to the casting on C end (<code>(const char*)(unsigned long int)(1)</code>)?</p>\n\n<p>---- EDIT -----</p>\n\n<p>Some more details. Generated PHP binding:</p>\n\n<pre><code>#[repr(C)]\n#[derive(Debug, Copy, Clone)]\npub struct _zend_internal_arg_info {\n    pub name: *const ::std::os::raw::c_char,\n    pub type_: zend_type,\n    pub pass_by_reference: zend_uchar,\n    pub is_variadic: zend_bool,\n}\n</code></pre>\n\n<p>Here an unused struct with some description of this twisted logic:</p>\n\n<pre><code>/* the following structure repeats the layout of zend_internal_arg_info,\n * but its fields have different meaning. It's used as the first element of\n * arg_info array to define properties of internal functions.\n * It's also used for the return type.\n */\ntypedef struct _zend_internal_function_info {\n    zend_uintptr_t required_num_args;\n    zend_type type;\n    zend_bool return_reference;\n    zend_bool _is_variadic;\n} zend_internal_function_info;\n</code></pre>\n\n<p>Here is the whole macro beig used mormally in c:</p>\n\n<pre><code>#define ZEND_BEGIN_ARG_INFO_EX(name, _unused, return_reference, required_num_args)  \\\n    static const zend_internal_arg_info name[] = { \\\n        { (const char*)(zend_uintptr_t)(required_num_args), 0, return_reference, 0 },\n</code></pre>\n\n<p>And <code>zend_uintptr_t</code> is:</p>\n\n<pre><code>typedef uintptr_t zend_uintptr_t;\n</code></pre>\n\n<p>and then:</p>\n\n<pre><code>typedef unsigned long int   uintptr_t;\n</code></pre>\n\n<p>and the struct:</p>\n\n<pre><code>pub struct ZendFunctionArgument {\n    arg: php_bindings::_zend_internal_arg_info,\n}\n</code></pre>\n"}, {"tags": ["random", "rust"], "comments": [{"owner": {"reputation": 4190, "user_id": 2110623, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a5f1b5f95d5b3bb75901fb546cd1c52d?s=128&d=identicon&r=PG", "display_name": "aochagavia", "link": "https://stackoverflow.com/users/2110623/aochagavia"}, "edited": false, "score": 0, "creation_date": 1558877703, "post_id": 56313926, "comment_id": 99237185, "body": "What do you mean with &quot;between given range of arrays&quot;? Do the arrays represent a number? For the <code>rand</code> crate, each array is just a sequence of bytes. There is no such concept as the range of values between two arrays"}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1558878565, "post_id": 56313926, "comment_id": 99237373, "body": "If you can use a <code>Vec</code> instead of an array, I would just do: <code>let value: Vec&lt;u8&gt; = iter::repeat_with(|| rand::thread_rng().gen_range(low, high)).take(20).collect();</code>"}, {"owner": {"reputation": 35470, "user_id": 6348498, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/0zu4m.jpg?s=128&g=1", "display_name": "Gurwinder Singh", "link": "https://stackoverflow.com/users/6348498/gurwinder-singh"}, "reply_to_user": {"reputation": 4190, "user_id": 2110623, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a5f1b5f95d5b3bb75901fb546cd1c52d?s=128&d=identicon&r=PG", "display_name": "aochagavia", "link": "https://stackoverflow.com/users/2110623/aochagavia"}, "edited": false, "score": 0, "creation_date": 1558879097, "post_id": 56313926, "comment_id": 99237508, "body": "@aochagavia - The bounds are just two 160 bit number (big endian). I want to get a random value between these bounds. For example <code>[1u8;20]</code> would be a valid result between <code>[0u8;20]</code> and <code>[2u8;20]</code>."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1558881029, "post_id": 56313926, "comment_id": 99237970, "body": "I think you need to implement the various <code>rand</code> traits. However, you won&#39;t be able to do that for <code>[u8; 20]</code> because that is not defined in your own crate and neither are the traits. Instead you&#39;d have to create a newtype. e.g. <code>struct U8x20([u8; 20])</code> and implement for that."}], "answers": [{"comments": [{"owner": {"reputation": 35470, "user_id": 6348498, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/0zu4m.jpg?s=128&g=1", "display_name": "Gurwinder Singh", "link": "https://stackoverflow.com/users/6348498/gurwinder-singh"}, "edited": false, "score": 0, "creation_date": 1558969046, "post_id": 56321996, "comment_id": 99264267, "body": "I tried it but getting <code>no method named ``gen_biguint_range`` found for type ``rand::rngs::thread::ThreadRng`` in the current scope</code>"}, {"owner": {"reputation": 168, "user_id": 593887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eafa2b71948957b4a1acff879967b846?s=128&d=identicon&r=PG", "display_name": "Peter Kolloch", "link": "https://stackoverflow.com/users/593887/peter-kolloch"}, "reply_to_user": {"reputation": 35470, "user_id": 6348498, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/0zu4m.jpg?s=128&g=1", "display_name": "Gurwinder Singh", "link": "https://stackoverflow.com/users/6348498/gurwinder-singh"}, "edited": false, "score": 0, "creation_date": 1558980659, "post_id": 56321996, "comment_id": 99268453, "body": "does it recommend using a certain trait after the message?"}, {"owner": {"reputation": 168, "user_id": 593887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eafa2b71948957b4a1acff879967b846?s=128&d=identicon&r=PG", "display_name": "Peter Kolloch", "link": "https://stackoverflow.com/users/593887/peter-kolloch"}, "reply_to_user": {"reputation": 35470, "user_id": 6348498, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/0zu4m.jpg?s=128&g=1", "display_name": "Gurwinder Singh", "link": "https://stackoverflow.com/users/6348498/gurwinder-singh"}, "edited": false, "score": 0, "creation_date": 1558980684, "post_id": 56321996, "comment_id": 99268457, "body": "<code>use bigint::{ToBigInt, RandBigInt}; </code>"}, {"owner": {"reputation": 35470, "user_id": 6348498, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/0zu4m.jpg?s=128&g=1", "display_name": "Gurwinder Singh", "link": "https://stackoverflow.com/users/6348498/gurwinder-singh"}, "edited": false, "score": 0, "creation_date": 1559019377, "post_id": 56321996, "comment_id": 99276448, "body": "Tried that.. it doesn&#39;t work. Also, doesn&#39;t recommend any traits. It keeps saying <code>RandBigInt</code> is not in the root. I am using rand 0.6."}, {"owner": {"reputation": 168, "user_id": 593887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eafa2b71948957b4a1acff879967b846?s=128&d=identicon&r=PG", "display_name": "Peter Kolloch", "link": "https://stackoverflow.com/users/593887/peter-kolloch"}, "reply_to_user": {"reputation": 35470, "user_id": 6348498, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/0zu4m.jpg?s=128&g=1", "display_name": "Gurwinder Singh", "link": "https://stackoverflow.com/users/6348498/gurwinder-singh"}, "edited": false, "score": 0, "creation_date": 1559121679, "post_id": 56321996, "comment_id": 99318247, "body": "You also need to enable the &quot;rand&quot; feature"}], "tags": [], "owner": {"reputation": 168, "user_id": 593887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eafa2b71948957b4a1acff879967b846?s=128&d=identicon&r=PG", "display_name": "Peter Kolloch", "link": "https://stackoverflow.com/users/593887/peter-kolloch"}, "is_accepted": true, "score": 1, "last_activity_date": 1559132792, "last_edit_date": 1559132792, "creation_date": 1558944187, "answer_id": 56321996, "question_id": 56313926, "link": "https://stackoverflow.com/questions/56313926/how-can-i-create-a-random-array-between-a-range-of-two-other-arrays/56321996#56321996", "title": "How can I create a random array between a range of two other arrays?", "body": "<p>If you want to treat the byte arrays as big integers, use the\n<a href=\"https://docs.rs/num-bigint/0.2.2/num_bigint/\" rel=\"nofollow noreferrer\">num-bigint</a> crate with the <code>rand</code> feature enabled:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use bigint::{ToBigInt, RandBigInt};\n\nlet low = -10000.to_bigint().unwrap();\nlet high = 10000.to_bigint().unwrap();\nlet b = rng.gen_bigint_range(&amp;low, &amp;high);\n</code></pre>\n\n<p>You could also use unsigned integers instead of signed. There are methods to convert to and from big endian byte arrays:</p>\n\n<ul>\n<li><a href=\"https://docs.rs/num-bigint/0.2.2/num_bigint/struct.BigUint.html#method.from_bytes_be\" rel=\"nofollow noreferrer\"><code>from_bytes_be</code></a></li>\n<li><a href=\"https://docs.rs/num-bigint/0.2.2/num_bigint/struct.BigUint.html#method.to_bytes_be\" rel=\"nofollow noreferrer\"><code>to_bytes_be</code></a></li>\n</ul>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/51640381/155423\">How do I generate a random num::BigUint?</a></li>\n</ul>\n"}], "owner": {"reputation": 35470, "user_id": 6348498, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/0zu4m.jpg?s=128&g=1", "display_name": "Gurwinder Singh", "link": "https://stackoverflow.com/users/6348498/gurwinder-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 442, "favorite_count": 0, "accepted_answer_id": 56321996, "answer_count": 1, "score": 0, "last_activity_date": 1559132792, "creation_date": 1558877281, "last_edit_date": 1559132614, "question_id": 56313926, "link": "https://stackoverflow.com/questions/56313926/how-can-i-create-a-random-array-between-a-range-of-two-other-arrays", "title": "How can I create a random array between a range of two other arrays?", "body": "<p>I need to generate an array of random 20 bytes between a given range of arrays. Since arrays are comparable in Rust, this works:</p>\n\n<pre><code>let low = [0u8; 20];\nlet high = [2u8; 20];\nassert_eq!(true, low &lt; high);\nassert_eq!(false, low &gt; high);\nassert_eq!(true, low == [0u8; 20]);\n</code></pre>\n\n<p>For these bounds:</p>\n\n<pre><code>let low: [u8; 20] = [98, 0, 1, 0, 2, 6, 99, 3, 0, 5, 23, 3, 5, 6, 11, 8, 0, 2, 0, 17];\nlet high: [u8; 20] = [99, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1];\n</code></pre>\n\n<p>These would be a valid result:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[98, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n[99, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n</code></pre>\n\n<p>These are not:</p>\n\n<pre><code>[98, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n[99, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2]\n</code></pre>\n\n<p>I want to do something like:</p>\n\n<pre><code>use rand::prelude::*;\n\nfn main() {\n    let low = [0u8; 20];\n    let high = [2u8; 20];\n    let value = rand::thread_rng().gen_range(low, high);\n    println!(\"{:?}\", value);\n}\n</code></pre>\n\n<p>but I get following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `[u8; 20]: rand::distributions::uniform::SampleUniform` is not satisfied\n --&gt; src\\main.rs:6:36\n  |\n6 |     let value = rand::thread_rng().gen_range(low, high);\n  |                                    ^^^^^^^^^ the trait `rand::distributions::uniform::SampleUniform` is not implemented for `[u8; 20]`\n</code></pre>\n\n<p>I tried implementing <code>SampleUniform</code> and <code>UniformSampler</code> without much success. Is there a simple way to implement this?</p>\n"}, {"tags": ["string", "rust"], "answers": [{"tags": [], "owner": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "is_accepted": true, "score": 3, "last_activity_date": 1558867359, "creation_date": 1558867359, "answer_id": 56312784, "question_id": 56312704, "link": "https://stackoverflow.com/questions/56312704/expected-struct-stdstringstring-found-struct-stdstrsplit/56312784#56312784", "title": "expected struct `std::string::String`, found struct `std::str::Split`", "body": "<p>The problem is this:</p>\n\n<pre><code>let mut date_1 = String::new(); /* type: std::string::String */\n// ...\ndate_1 = date_1.split(\"/\"); /* type: std::str::Split&lt;'_, &amp;str&gt; */\n</code></pre>\n\n<p>You've declared a variable with one type (<code>String</code>) but you're trying to assign it with a different type (<code>std::str::Split</code>).</p>\n\n<hr>\n\n<p>One \"Rust-y\" way of solving this is typically to redeclare a variable with the same name:</p>\n\n<pre><code>let date_1 = String::new(); /* type: std::string::String */\n// ...\nlet date_1 = date_1.split(\"/\"); /* type: std::str::Split&lt;'_, &amp;str&gt; */\n</code></pre>\n\n<p>The second <code>date_1</code> is a different variable (hence it can have a different type), but it has the same name as the former variable, so it \"shadows\" the former variable (meaning you cannot refer to it by name anymore).</p>\n"}], "owner": {"reputation": 1384, "user_id": 10240085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HBxgL.jpg?s=128&g=1", "display_name": "Muhammad Naufil", "link": "https://stackoverflow.com/users/10240085/muhammad-naufil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3452, "favorite_count": 0, "accepted_answer_id": 56312784, "answer_count": 1, "score": 1, "last_activity_date": 1558869151, "creation_date": 1558866617, "last_edit_date": 1558869151, "question_id": 56312704, "link": "https://stackoverflow.com/questions/56312704/expected-struct-stdstringstring-found-struct-stdstrsplit", "title": "expected struct `std::string::String`, found struct `std::str::Split`", "body": "<p>I am making a program which calculates the difference between number of days in date, input by the user. So far I am able to make the program work with string literal but not with the string object.</p>\n\n<pre><code>use std::io;\n\nfn main() {\n    let mut date_1 = \"22/8/2019\".split(\"/\");\n    let mut date_2 = \"30/8/2019\".split(\"/\");\n    let vec_1: Vec&lt;&amp;str&gt; = date_1.collect();\n    let vec_2: Vec&lt;&amp;str&gt; = date_2.collect();\n    println!(\"{:#?}\", vec_1);\n    println!(\"{:#?}\", vec_2);\n    let my_int_2 = vec_2[0].parse::&lt;i32&gt;().unwrap();\n    let my_int_1 = vec_1[0].parse::&lt;i32&gt;().unwrap();\n    let result = my_int_2 - my_int_1;\n    println!(\"The difference between two dates is: {}\", result);\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[\n    \"22\",\n    \"8\",\n    \"2019\",\n]\n[\n    \"30\",\n    \"8\",\n    \"2019\",\n]\nThe difference between two dates is: 8\n</code></pre>\n\n<p>I want ask the date from user:</p>\n\n<pre><code>use std::io;\n\nfn main() {\n    let mut date_1 = String::new();\n    println!(\"Enter a date in (dd/mm/yy) format: \");\n    io::stdin()\n        .read_line(&amp;mut date_1)\n        .ok()\n        .expect(\"Couldn't read line\");\n\n    let mut date_2 = String::new();\n    println!(\"Enter a date in (dd/mm/yy) format: \");\n    io::stdin()\n        .read_line(&amp;mut date_2)\n        .ok()\n        .expect(\"Couldn't read line\");\n    date_1 = date_1.split(\"/\");\n    date_2 = date_2.split(\"/\");\n    let vec_1: Vec&lt;&amp;str&gt; = date_1.collect();\n    let vec_2: Vec&lt;&amp;str&gt; = date_2.collect();\n    println!(\"{:#?}\", vec_1);\n    println!(\"{:#?}\", vec_2);\n    let my_int_2 = vec_2[0].parse::&lt;i32&gt;().unwrap();\n    let my_int_1 = vec_1[0].parse::&lt;i32&gt;().unwrap();\n    let result = my_int_2 - my_int_1;\n    println!(\"The difference between two dates is: {}\", result);\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>   Compiling twentythree v0.1.0 (C:\\Users\\Muhammad.3992348\\Desktop\\rust\\hackathon\\twentythree)\nerror[E0308]: mismatched types\n  --&gt; src\\main.rs:15:14\n   |\n15 |     date_1 = date_1.split(\"/\");\n   |              ^^^^^^^^^^^^^^^^^ expected struct `std::string::String`, found struct `std::str::Split`\n   |\n   = note: expected type `std::string::String`\n              found type `std::str::Split&lt;'_, &amp;str&gt;`\n\nerror[E0308]: mismatched types\n  --&gt; src\\main.rs:16:14\n   |\n16 |     date_2 = date_2.split(\"/\");\n   |              ^^^^^^^^^^^^^^^^^ expected struct `std::string::String`, found struct `std::str::Split`\n   |\n   = note: expected type `std::string::String`\n              found type `std::str::Split&lt;'_, &amp;str&gt;`\n\nerror[E0599]: no method named `collect` found for type `std::string::String` in the current scope\n  --&gt; src\\main.rs:19:35\n   |\n19 |     let vec_1: Vec&lt;&amp;str&gt; = date_1.collect();\n   |                                   ^^^^^^^\n   |\n   = note: the method `collect` exists but the following trait bounds were not satisfied:\n           `&amp;mut std::string::String : std::iter::Iterator`\n           `&amp;mut str : std::iter::Iterator`\n\nerror[E0599]: no method named `collect` found for type `std::string::String` in the current scope\n  --&gt; src\\main.rs:20:35\n   |\n20 |     let vec_2: Vec&lt;&amp;str&gt; = date_2.collect();\n   |                                   ^^^^^^^\n   |\n   = note: the method `collect` exists but the following trait bounds were not satisfied:\n           `&amp;mut std::string::String : std::iter::Iterator`\n           `&amp;mut str : std::iter::Iterator`\n\nerror: aborting due to 4 previous errors\n\nSome errors occurred: E0308, E0599.\nFor more information about an error, try `rustc --explain E0308`.\nerror: Could not compile `twentythree`.\n\nTo learn more, run the command again with --verbose.\n</code></pre>\n\n<p>How to convert string object into string literal or any other war around, which runs the program.</p>\n"}, {"tags": ["rust", "move-semantics"], "comments": [{"owner": {"reputation": 1862, "user_id": 4658000, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/0Sw3Y.jpg?s=128&g=1", "display_name": "Le\u015bny Rumcajs", "link": "https://stackoverflow.com/users/4658000/le%c5%9bny-rumcajs"}, "edited": false, "score": 0, "creation_date": 1558863579, "post_id": 56312330, "comment_id": 99234280, "body": "Either pass them by borrow e.g. <code>is_dir(&amp;dir_name)</code> if your function allows this or use <code>clone</code> method of String."}, {"owner": {"reputation": 2438, "user_id": 4665627, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh3.googleusercontent.com/-g7ObDdxHQeA/AAAAAAAAAAI/AAAAAAAAAhE/2dHVEnnZMco/photo.jpg?sz=128", "display_name": "shashanka n", "link": "https://stackoverflow.com/users/4665627/shashanka-n"}, "reply_to_user": {"reputation": 1862, "user_id": 4658000, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/0Sw3Y.jpg?s=128&g=1", "display_name": "Le\u015bny Rumcajs", "link": "https://stackoverflow.com/users/4658000/le%c5%9bny-rumcajs"}, "edited": false, "score": 0, "creation_date": 1558863975, "post_id": 56312330, "comment_id": 99234360, "body": "passing them in to <code>is_dir</code> by borrowing is not the problem. I want to declare one variable and use it in three places like in the second block of code. Whats the right way to do this in rust?"}, {"owner": {"reputation": 1862, "user_id": 4658000, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/0Sw3Y.jpg?s=128&g=1", "display_name": "Le\u015bny Rumcajs", "link": "https://stackoverflow.com/users/4658000/le%c5%9bny-rumcajs"}, "edited": false, "score": 0, "creation_date": 1558864516, "post_id": 56312330, "comment_id": 99234456, "body": "These three places must not take ownership of the data you&#39;re passing so if <code>path</code> field is declared as <code>String</code> you can pass your single variable there but you have to clone it / use <code>to_owned</code>. There and everywhere it would take ownership."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1558871644, "post_id": 56312330, "comment_id": 99235910, "body": "@shashankan If you want to use it in 3 places, then you need to either (a) clone the value twice, or (b) borrow the value twice."}], "answers": [{"comments": [{"owner": {"reputation": 2438, "user_id": 4665627, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh3.googleusercontent.com/-g7ObDdxHQeA/AAAAAAAAAAI/AAAAAAAAAhE/2dHVEnnZMco/photo.jpg?sz=128", "display_name": "shashanka n", "link": "https://stackoverflow.com/users/4665627/shashanka-n"}, "edited": false, "score": 0, "creation_date": 1558874800, "post_id": 56313255, "comment_id": 99236546, "body": "Thank you! This was what I was looking for. As a note to any JS dev looking at this, this seems to be really similar to an anonymous fat arrow function."}], "tags": [], "owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "is_accepted": true, "score": -1, "last_activity_date": 1558871717, "creation_date": 1558871717, "answer_id": 56313255, "question_id": 56312330, "link": "https://stackoverflow.com/questions/56312330/reusing-variables-in-rust/56313255#56313255", "title": "Reusing variables in Rust", "body": "<blockquote>\n  <p>I want to declare one variable and use it multiple times in the second block of code. How do I do this?</p>\n</blockquote>\n\n<p>You don't, because \"in Rust values are moved around when assigning\". The compiler doesn't automatically copy most kinds of values, because it's not clear when that's possible, and it would introduce an overhead that the programmer might want to avoid.</p>\n\n<p>If you want to use the value of a <code>Clone</code> variable multiple times - just clone it.</p>\n\n<p>If you want to avoid repeating yourself, you can give the computation a name by using a closure.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let display_value = entry.path().display();\nlet dir_name = || display_value.to_string();\nfiles_and_dirs.push(DiskEntry {\n    path: dir_name(),\n    is_dir: is_dir(dir_name()),\n    name: dir_name()\n});\n</code></pre>\n\n<p>This does not let you use the value multiple times - it produces a new value with each call.</p>\n"}, {"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 6, "last_activity_date": 1570566056, "last_edit_date": 1570566056, "creation_date": 1558872615, "answer_id": 56313370, "question_id": 56312330, "link": "https://stackoverflow.com/questions/56312330/reusing-variables-in-rust/56313370#56313370", "title": "Reusing variables in Rust", "body": "<p>Your <code>DiskEntry</code> and <code>is_dir</code> are presumably defined like this:</p>\n\n<pre><code>struct DiskEntry {\n    path: String,\n    is_dir: bool,\n    name: String,\n}\n\nfn is_dir(path: String) -&gt; bool {\n    // ...\n}\n</code></pre>\n\n<p>Each time there is a variable of type <code>String</code>, the variable needs to have its own copy of the string in memory. </p>\n\n<p>As the error suggests, you <em>could</em> fix it by cloning:</p>\n\n<pre><code>let display_value = entry.path().display();\nlet dir_name = display_value.to_string();\nfiles_and_dirs.push(DiskEntry {\n    path: dir_name.clone(),\n    is_dir: is_dir(dir_name.clone()),\n    name: dir_name\n});\n</code></pre>\n\n<p>But you should avoid cloning data unnecessarily because it's inefficient. The clone that is very easy to remove is in <code>is_dir</code> - it should be pretty obvious that this method doesn't need to permanently take ownership of its input. It can very easily borrow it instead:</p>\n\n<pre><code>fn is_dir(path: &amp;str) -&gt; bool {\n    // ...\n}\n</code></pre>\n\n<p>And you would call it like this, so that the <code>String</code> is borrowed as a <code>&amp;str</code>:</p>\n\n<pre><code>is_dir(&amp;dir_name),\n</code></pre>\n\n<p>The other case is probably trickier. In order to avoid cloning, you will need to make the <code>DiskEntry</code> struct borrow the strings. It would look like this:</p>\n\n<pre><code>struct DiskEntry&lt;'a&gt; {\n    path: &amp;'a str,\n    is_dir: bool,\n    name: &amp;'a str,\n}\n\nlet display_value = entry.path().display();\nlet dir_name = display_value.to_string();\nfiles_and_dirs.push(DiskEntry {\n    path: &amp;dir_name,\n    is_dir: is_dir(&amp;dir_name),\n    name: &amp;dir_name\n});\n</code></pre>\n\n<p>However, this will limit what you can do with the <code>DiskEntry</code>; in particular, it cannot outlive the <code>dir_name</code> variable.  It's hard to know what other problems this could cause you, without knowing the wider context of your code, but it is likely to have broader impact on other data structures.</p>\n\n<p>Given that you appear to be just learning Rust, if you are not yet comfortable with borrowing and lifetimes it might be easiest just to accept this one extra clone, until you have a better understanding and can make that judgement for yourself.</p>\n\n<hr>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/24158114/what-are-the-differences-between-rusts-string-and-str\">What are the differences between Rust's <code>String</code> and <code>str</code>?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/40006219/why-is-it-discouraged-to-accept-a-reference-to-a-string-string-vec-vec-o\">Why is it discouraged to accept a reference to a String (&amp;String), Vec (&amp;Vec), or Box (&amp;Box) as a function argument?</a></li>\n</ul>\n"}], "owner": {"reputation": 2438, "user_id": 4665627, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh3.googleusercontent.com/-g7ObDdxHQeA/AAAAAAAAAAI/AAAAAAAAAhE/2dHVEnnZMco/photo.jpg?sz=128", "display_name": "shashanka n", "link": "https://stackoverflow.com/users/4665627/shashanka-n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1008, "favorite_count": 0, "accepted_answer_id": 56313255, "answer_count": 2, "score": 2, "last_activity_date": 1570566056, "creation_date": 1558863378, "last_edit_date": 1558871720, "question_id": 56312330, "link": "https://stackoverflow.com/questions/56312330/reusing-variables-in-rust", "title": "Reusing variables in Rust", "body": "<p>I have the following code:</p>\n\n<pre><code>let display_value = entry.path().display();\nfiles_and_dirs.push(DiskEntry {\n    path: display_value.to_string(),\n    is_dir: is_dir(display_value.to_string()),\n    name: display_value.to_string()\n});\n</code></pre>\n\n<p>If I write it thus:</p>\n\n<pre><code>let display_value = entry.path().display();\nlet dir_name = display_value.to_string();\nfiles_and_dirs.push(DiskEntry {\n    path: dir_name,\n    is_dir: is_dir(dir_name),\n    name: dir_name\n});\n</code></pre>\n\n<p>I get the following error:</p>\n\n<blockquote>\n  <p>move occurs because <code>dir_name</code> has type <code>std::string::String</code>, which\n  does not implement the <code>Copy</code> trait</p>\n</blockquote>\n\n<p>I understand in Rust values are moved around when assigning. I want to declare one variable and use it multiple times in the second block of code. How do I do this?</p>\n"}, {"tags": ["visual-studio-code", "rust"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1558863273, "post_id": 56312082, "comment_id": 99234211, "body": "You could just put a break point inside the method?"}, {"owner": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "reply_to_user": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1558873169, "post_id": 56312082, "comment_id": 99236212, "body": "I know next to nothing about vscode, but I still would be very surprised if a breakpoint set in one workspace/crate would somehow be respected by an import command in another workspace/crate."}, {"owner": {"reputation": 17673, "user_id": 139802, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/33c5692f72d9da5663651d034c4588b6?s=128&d=identicon&r=PG", "display_name": "Andrew Wagner", "link": "https://stackoverflow.com/users/139802/andrew-wagner"}, "reply_to_user": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1612784411, "post_id": 56312082, "comment_id": 116865702, "body": "@PeterHall, that requires you to know which assert will crash in advance. Ideally the debugger would activate on panic by default; that&#39;s almost certainly what the user wants when they run a crashy program in a debugger."}], "owner": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1558861075, "creation_date": 1558861075, "question_id": 56312082, "link": "https://stackoverflow.com/questions/56312082/in-rust-when-assertion-fails-hop-into-debugger", "title": "In Rust, when assertion fails hop into debugger", "body": "<p>A simple library that has been very convenient, indispensable even, in C# is </p>\n\n<pre><code>namespace SharedLibraries.Verification { public static class Verify {\n\n    // conditions that must be satisfied in order to use a module go here\n    public static void Require(bool B) {\n        if (B) return;\n        System.Diagnostics.Debugger.Break();\n    }\n\n    // things that should be provably true if the Require(s) of a module are met\n    public static void Assert(bool B) {\n        if (B) return;\n        System.Diagnostics.Debugger.Break();\n    }\n\n    public static void AssertFail() {\n        System.Diagnostics.Debugger.Break();\n    }\n\n}}\n\nnamespace SharedLibraries.VerificationOff { public static class Verify {\n\n    [System.Diagnostics.Conditional(\"DoNotEverTurnThisOn\")]\n    public static void Require(bool B) {}\n\n    [System.Diagnostics.Conditional(\"DoNotEverTurnThisOn\")]\n    public static void Assert(bool B) {}\n\n    [System.Diagnostics.Conditional(\"DoNotEverTurnThisOn\")]\n    public static void AssertFail() {}\n}}\n</code></pre>\n\n<p>If a requirement or assertion fails, it pops me into the debugger.  When I want to turn it off, I just change the include command from Verification to VerificationOff.  It won't even compute \"B\" when it is turned off so there is no overhead.</p>\n\n<p>I have been trying all kinds of different things to try to make a Rust/VSCode library to do the same thing.  Here is what I have so far:</p>\n\n<pre><code>pub mod on {\n    pub fn require&lt;Predicate: FnOnce() -&gt; bool&gt;(check : Predicate) {\n        if cfg!(debug_assertions) {\n            if !check() {\n                unsafe {\n                    println!(\"before debug break\");\n                    winapi::um::debugapi::DebugBreak();\n                    println!(\"after debug break\");\n                }\n            }\n        }\n    }\n    pub fn assert&lt;Predicate: FnOnce() -&gt; bool&gt;(check : Predicate) {\n        if cfg!(debug_assertions) {\n            if !check() {\n                unsafe {\n                    winapi::um::debugapi::DebugBreak();\n                }\n            }\n        }\n    }\n}\n\npub mod off {\n    pub fn require&lt;Predicate: FnOnce() -&gt; bool&gt;(_check : Predicate) {}\n    pub fn assert &lt;Predicate: FnOnce() -&gt; bool&gt;(_check : Predicate) {}\n}\n</code></pre>\n\n<p>This works at least when the above code is in the same crate as the program that is executed.  But when it is included from a standalone crate using \"extern crate verifier\" (or whatever name) then whenever an assertion fails the program just crashes and the debugger closes down.  And it crashes exactly on the winapi call.  The debugger vscode is using is cppvsdbg for windows.  </p>\n\n<p>I'm looking for help to make this work.  Maybe converting to macros or using a different command to get the debuggers attention.  I'm very fresh with rust so please be explicit.</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 959, "user_id": 3526980, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/hZFEP.jpg?s=128&g=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/3526980/richard"}, "is_accepted": true, "score": 4, "last_activity_date": 1558857758, "creation_date": 1558857758, "answer_id": 56311748, "question_id": 56311595, "link": "https://stackoverflow.com/questions/56311595/how-parse-string-contains-negative-number-in-rust/56311748#56311748", "title": "How parse String contains negative number in Rust?", "body": "<p>When you replace <code>u32</code> by <code>i32</code> in the last line your program is able to handle negative numbers.</p>\n\n<p><code>u32</code> means <strong>unsigned</strong> integer with 32bit width so <code>parse()</code> panics when it encounters a negative number. <code>i32</code> is a <strong>signed</strong> integer so it works.</p>\n"}], "owner": {"reputation": 15, "user_id": 8785191, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/487ac62bc514f24b4019ee6efa2aced3?s=128&d=identicon&r=PG", "display_name": "Arfa Ahmed", "link": "https://stackoverflow.com/users/8785191/arfa-ahmed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 616, "favorite_count": 0, "accepted_answer_id": 56311748, "answer_count": 1, "score": 0, "last_activity_date": 1558857758, "creation_date": 1558856350, "question_id": 56311595, "link": "https://stackoverflow.com/questions/56311595/how-parse-string-contains-negative-number-in-rust", "title": "How parse String contains negative number in Rust?", "body": "<p>I am taking input number from user and then check if the number is positive, negative or zero. Positive number and zero checking performed but having problem in Negative number checking. </p>\n\n<pre><code>use std::io::Write;\n\nfn main(){\n    print!(\"Enter Number: \");\n    let mut number = String::new();\n    std::io::stdout().flush();\n    std::io::stdin().read_line(&amp;mut number);\n    let num: u32 = number.trim().parse().unwrap();\n}\n</code></pre>\n\n<p>when input is negative number, program becomes panic didn't parsing negative number.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 1594, "user_id": 8968982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/989aff3283ccc8807e254f3b44574806?s=128&d=identicon&r=PG&f=1", "display_name": "GMc", "link": "https://stackoverflow.com/users/8968982/gmc"}, "edited": false, "score": 2, "creation_date": 1558853646, "post_id": 56311328, "comment_id": 99232341, "body": "I&#39;m neither an expert on rust nor numerology, however, it may help others to help you if you can explain the rules that would determine whether the letter &quot;y&quot; is a vowel or not."}, {"owner": {"reputation": 59, "user_id": 5897147, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10208181435714302/picture?type=large", "display_name": "Philip Stephens", "link": "https://stackoverflow.com/users/5897147/philip-stephens"}, "reply_to_user": {"reputation": 1594, "user_id": 8968982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/989aff3283ccc8807e254f3b44574806?s=128&d=identicon&r=PG&f=1", "display_name": "GMc", "link": "https://stackoverflow.com/users/8968982/gmc"}, "edited": false, "score": 0, "creation_date": 1558854289, "post_id": 56311328, "comment_id": 99232468, "body": "<a href=\"https://www.merriam-webster.com/words-at-play/why-y-is-sometimes-a-vowel-usage\" rel=\"nofollow noreferrer\">merriam-webster.com/words-at-play/&hellip;</a>"}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1558875310, "post_id": 56311328, "comment_id": 99236667, "body": "The Eudex crate is not intended for this kind of thing. It can only tell you when words are phonetically &quot;similar&quot;, but can&#39;t tell you why."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1558875337, "post_id": 56311328, "comment_id": 99236672, "body": "Why not just turn the rules from the Merriam Webster link into a method that applies them?"}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1558876650, "post_id": 56311328, "comment_id": 99236957, "body": "Something like this? <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=baf01eb3b1bd9e874fa91e89158d19c1\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 59, "user_id": 5897147, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10208181435714302/picture?type=large", "display_name": "Philip Stephens", "link": "https://stackoverflow.com/users/5897147/philip-stephens"}, "edited": false, "score": 0, "creation_date": 1558890391, "post_id": 56311328, "comment_id": 99240439, "body": "That is along the lines of what I am looking for.  However, this fails: assert_eq!(vec![true,  false, true, false, false, true], vowels(&quot;Yvonne&quot;));  Just need to divide the word into syllables."}, {"owner": {"reputation": 59, "user_id": 5897147, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10208181435714302/picture?type=large", "display_name": "Philip Stephens", "link": "https://stackoverflow.com/users/5897147/philip-stephens"}, "edited": false, "score": 0, "creation_date": 1558893609, "post_id": 56311328, "comment_id": 99241212, "body": "<a href=\"http://www.delphiforfun.org/programs/Syllables.htm\" rel=\"nofollow noreferrer\">delphiforfun.org/programs/Syllables.htm</a> has a dictionary of syllables."}], "owner": {"reputation": 59, "user_id": 5897147, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/10208181435714302/picture?type=large", "display_name": "Philip Stephens", "link": "https://stackoverflow.com/users/5897147/philip-stephens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 163, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1558853972, "creation_date": 1558853353, "last_edit_date": 1558853972, "question_id": 56311328, "link": "https://stackoverflow.com/questions/56311328/detecting-when-y-is-a-vowel", "title": "Detecting when Y is a vowel", "body": "<p>While learning the programming language Rust, I want to make a numerology calculator based on a person's full name.  This numerology calculator would, later on, provide computations on other pieces of texts as well as other numbers.</p>\n\n<p>The numerology calculator would take a name such as John Edward Smith and calculate his life path like this, for example:</p>\n\n<pre><code>    1 + 6 + 8 + 4 + 5 + 4 + 5 + 1 + 9  + 4  +  1  + 4 + 9 + 2 + 8\n    J   O   H   N   E   D   W   A   R    D     S    M   I   T   H\n</code></pre>\n\n<p>Adding up all the letters yields 71 and 7+1 = 8</p>\n\n<p>Another calculation uses the vowels in the name, and here is the problem: most algorithms detect whether a letter in question is AEIO or U and declares it to be a vowel. Otherwise, it's a consonant.  However, Y could be either a vowel or a consonant.  W is also sometimes a vowel but for the purposes of numerology, it is always a consonant.</p>\n\n<p>I came across a cargo package called Eudex (supposedly better than Soundex) but I don't know how to use it to detect whether Y is a vowel or consonant.  Could someone point me in the right direction?  Thanks.</p>\n\n<pre><code>fn main() {\n    assert!((Hash::new(\"jumpo\") - Hash::new(\"jumbo\")).similar());\n    assert!(!(Hash::new(\"Horse\") - Hash::new(\"Norse\")).similar());\n    println!(\"{:?}\", Hash::new(\"hello\"));\n    println!(Hash::new(\"Sydney\")).listVowels());\n} \n\nHash { hash: 144115188075855872 }\n</code></pre>\n\n<p>Fantasy result of the last print line:\nye</p>\n"}, {"tags": ["rust", "lifetime"], "answers": [{"tags": [], "owner": {"reputation": 959, "user_id": 3526980, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/hZFEP.jpg?s=128&g=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/3526980/richard"}, "is_accepted": true, "score": 2, "last_activity_date": 1558858972, "creation_date": 1558858972, "answer_id": 56311871, "question_id": 56309924, "link": "https://stackoverflow.com/questions/56309924/specifying-lifetimes-in-macro-derives/56311871#56311871", "title": "Specifying lifetimes in macro derives", "body": "<p>In your piece of code you simply can not fix this issue. It's a bug in the crate providing <code>#[derive(ElasticType)]</code>.</p>\n\n<p>File a bug with the author of <code>ElasticType</code>! If it's not possible for some reason to add support for lifetimed struct it should at least emit a useful error message stating so.</p>\n"}], "owner": {"reputation": 2932, "user_id": 7212809, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VlOyJEUeeSc/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jExBae7iJ2ALFtcMj_6BCoHGTMgw/mo/photo.jpg?sz=128", "display_name": "nz_21", "link": "https://stackoverflow.com/users/7212809/nz-21"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 56311871, "answer_count": 1, "score": 0, "last_activity_date": 1558873908, "creation_date": 1558833120, "last_edit_date": 1558873908, "question_id": 56309924, "link": "https://stackoverflow.com/questions/56309924/specifying-lifetimes-in-macro-derives", "title": "Specifying lifetimes in macro derives", "body": "<p>How does one specify lifetimes on macro derives? </p>\n\n<pre><code>#[derive(ElasticType, Serialize, Deserialize)]\npub struct Xkcd&lt;'a&gt; {\n       link: &amp;'a str\n}\n</code></pre>\n\n<p>Error example:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>#[derive(ElasticType, Serialize, Deserialize)]\n |       ^^^^^^^^^^^ expected lifetime parameter\n</code></pre>\n"}, {"tags": ["rust", "traits"], "answers": [{"comments": [{"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 1, "creation_date": 1558865281, "post_id": 56312110, "comment_id": 99234647, "body": "Is there any part in RFC that states about strict subset bounds for specialization ? Could you please link that ?"}], "tags": [], "owner": {"reputation": 959, "user_id": 3526980, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/hZFEP.jpg?s=128&g=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/3526980/richard"}, "is_accepted": true, "score": 6, "last_activity_date": 1558867003, "last_edit_date": 1558867003, "creation_date": 1558861278, "answer_id": 56312110, "question_id": 56309912, "link": "https://stackoverflow.com/questions/56309912/implementing-from-trait-and-specialization/56312110#56312110", "title": "Implementing from trait and specialization", "body": "<p>Your second implementation is not a specialization of the first. It's an alternative implementation that conflicts with the first.</p>\n\n<p>Specialization requires that all types matching your second <code>impl</code> also match your first <code>impl</code>. In other words the bounds of your specialization need to be a strict subset of the bounds of the default implementation. From the RFC:</p>\n\n<blockquote>\n  <p>This RFC proposes a design for specialization, which permits multiple impl blocks to apply to the same type/trait, so long as one of the blocks is clearly \"more specific\" than the other.</p>\n</blockquote>\n\n<p>Changing your trait definition to</p>\n\n<pre><code>trait Dummy: Into&lt;u32&gt; {}\n</code></pre>\n\n<p>makes your code compile.</p>\n\n<p>Check out <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/1210-impl-specialization.md\" rel=\"noreferrer\">https://github.com/rust-lang/rfcs/blob/master/text/1210-impl-specialization.md</a> for more details.</p>\n"}], "owner": {"reputation": 149, "user_id": 7211821, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70da16160d5416fda75ce9f5b88ada0d?s=128&d=identicon&r=PG&f=1", "display_name": "StevenDoesStuffs", "link": "https://stackoverflow.com/users/7211821/stevendoesstuffs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 699, "favorite_count": 0, "accepted_answer_id": 56312110, "answer_count": 1, "score": 6, "last_activity_date": 1603807189, "creation_date": 1558833003, "last_edit_date": 1603807189, "question_id": 56309912, "link": "https://stackoverflow.com/questions/56309912/implementing-from-trait-and-specialization", "title": "Implementing from trait and specialization", "body": "<p>According to the <a href=\"https://github.com/nox/rust-rfcs/blob/master/text/1210-impl-specialization.md\" rel=\"nofollow noreferrer\">specialization RFC</a>, I should be able to have multiple <code>impl</code>s of the same <code>trait</code> on a <code>struct</code> by specifying one as default.</p>\n<p>I have the code:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>#![feature(specialization)]\nstruct A(u32);\n\ntrait Dummy {}\n\nimpl&lt;T&gt; From&lt;T&gt; for A\nwhere\n    T: Into&lt;u32&gt;,\n{\n    default fn from(item: T) -&gt; Self {\n        A(item.into())\n    }\n}\n\nimpl&lt;T&gt; From&lt;T&gt; for A\nwhere\n    T: Dummy,\n{\n    fn from(item: T) -&gt; Self {\n        A(2)\n    }\n}\n</code></pre>\n<p>Even though one of the implementations is default, the compiler still tells me that the two are conflicting implementations.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 2659, "user_id": 8050514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6CRdl.jpg?s=128&g=1", "display_name": "Optimistic Peach", "link": "https://stackoverflow.com/users/8050514/optimistic-peach"}, "edited": false, "score": 0, "creation_date": 1558821262, "post_id": 56308961, "comment_id": 99228256, "body": "<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=654b4078914788ea7c98d69c4ff4743d\" rel=\"nofollow noreferrer\">Yes</a>."}], "answers": [{"tags": [], "owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "is_accepted": true, "score": 3, "last_activity_date": 1558821394, "creation_date": 1558821394, "answer_id": 56309040, "question_id": 56308961, "link": "https://stackoverflow.com/questions/56308961/is-destructor-called-on-reassignment-of-a-mutable-variable/56309040#56309040", "title": "Is destructor called on reassignment of a mutable variable?", "body": "<blockquote>\n  <p>My interpretation is <code>x</code> gains ownership on <code>new_complex_struct</code>, its previously owned value becomes unowned, so its destructor would be called right after reassignment. Is my interpretation correct?</p>\n</blockquote>\n\n<p>Yes. <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f1c00cc757c99397ba11d339a1a830a5\" rel=\"nofollow noreferrer\">This can easily be checked:</a></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Foo;\n\nimpl Drop for Foo {\n    fn drop(&amp;mut self) {\n        println!(\"Foo::drop\");\n    }\n}\n\nfn main() {\n    let mut f = Foo;\n\n    for i in 0..5 {\n        println!(\"Before {}\", i);\n        f = Foo;\n        println!(\"After {}\", i);\n    }\n}\n</code></pre>\n\n<p>Will as expected print:</p>\n\n<pre><code>Before 0\nFoo::drop\nAfter 0\nBefore 1\nFoo::drop\nAfter 1\nBefore 2\nFoo::drop\nAfter 2\nBefore 3\nFoo::drop\nAfter 3\nBefore 4\nFoo::drop\nAfter 4\nFoo::drop\n</code></pre>\n\n<p>Destructors in Rust are deterministic, so this behaviour is set in stone.</p>\n"}], "owner": {"reputation": 743, "user_id": 7058336, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ab015fdc364a6f1fc3c17e888495568?s=128&d=identicon&r=PG&f=1", "display_name": "jam", "link": "https://stackoverflow.com/users/7058336/jam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 56309040, "answer_count": 1, "score": 1, "last_activity_date": 1593112405, "creation_date": 1558820624, "last_edit_date": 1593112405, "question_id": 56308961, "link": "https://stackoverflow.com/questions/56308961/is-destructor-called-on-reassignment-of-a-mutable-variable", "title": "Is destructor called on reassignment of a mutable variable?", "body": "<p>Suppose I have defined a mutable variable that may be some complex structure containing vectors or other dynamically allocated data with the <code>Drop</code> trait. On reassigning that variable, is the destructor called immediately after reassignment?</p>\n<pre class=\"lang-rust prettyprint-override\"><code>let mut x = some_complex_struct;\nwhile some_condition {\n    // ...\n    x = new_complex_struct;\n    // ...\n}\n</code></pre>\n<p>My interpretation is <code>x</code> gains ownership on <code>new_complex_struct</code>, its previously owned value becomes unowned, so its destructor would be called right after reassignment. Is my interpretation correct?</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "is_accepted": true, "score": 2, "last_activity_date": 1558808060, "creation_date": 1558808060, "answer_id": 56307537, "question_id": 56306834, "link": "https://stackoverflow.com/questions/56306834/can-one-alias-higher-rank-trait-bound-in-rust/56307537#56307537", "title": "Can one alias higher rank trait bound in rust?", "body": "<p>No it's not possible to use a new trait for this.</p>\n\n<p>While it's possible to include the second requirement into the trait definition...</p>\n\n<pre><code>trait GInteger: Integer + Clone + FromPrimitive + ToPrimitive\nwhere\n    for&lt;'b&gt; &amp;'b Self: Mul&lt;Output = Self&gt; + Add&lt;Output = Self&gt; + Ord,\n{\n}\n</code></pre>\n\n<p>rustc will not elaborate the <code>where</code> clause for you, so in the declaration of <code>function()</code> you still need to write the <code>where for&lt;'b&gt; &amp;'b I: ...</code> bound. It is a <a href=\"https://github.com/rust-lang/rust/issues/20671\" rel=\"nofollow noreferrer\">known bug</a>.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn function&lt;I: GInteger&gt;(n: &amp;I) -&gt; I\nwhere\n    for&lt;'b&gt; &amp;'b I: Mul&lt;Output = I&gt; + Add&lt;Output = I&gt; + Ord,  // meh\n{\n    n * n\n}\n</code></pre>\n\n<hr>\n\n<p>If you're using nightly Rust, you could use <a href=\"https://stackoverflow.com/a/49263923\"><strong>trait alias (RFC 1733)</strong></a> instead, which exactly solves this problem.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#![feature(trait_alias)]\n\nuse num::{FromPrimitive, Integer, ToPrimitive};\nuse std::cmp::Ord;\nuse std::ops::{Add, Mul};\n\n// Define a trait alias\ntrait GInteger = Integer + Clone + FromPrimitive + ToPrimitive\nwhere\n    for&lt;'b&gt; &amp;'b Self: Mul&lt;Output = Self&gt; + Add&lt;Output = Self&gt; + Ord;\n\n// Just use it\nfn function&lt;I: GInteger&gt;(n: &amp;I) -&gt; I {\n    n * n\n}\n</code></pre>\n"}], "owner": {"reputation": 743, "user_id": 7058336, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ab015fdc364a6f1fc3c17e888495568?s=128&d=identicon&r=PG&f=1", "display_name": "jam", "link": "https://stackoverflow.com/users/7058336/jam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 56307537, "answer_count": 1, "score": 2, "last_activity_date": 1558808060, "creation_date": 1558802686, "last_edit_date": 1558804760, "question_id": 56306834, "link": "https://stackoverflow.com/questions/56306834/can-one-alias-higher-rank-trait-bound-in-rust", "title": "Can one alias higher rank trait bound in rust?", "body": "<p>My program has a bunch of functions that operate on generic integer. They are usually of the following form:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use num::{FromPrimitive, Integer, ToPrimitive};\nuse std::cmp::Ord;\nuse std::ops::{Add, Mul};\n\nfn function&lt;'a, I&gt;(n: &amp;'a I) -&gt; I\nwhere\n    I: Integer + Clone + FromPrimitive + ToPrimitive,\n    for&lt;'b&gt; &amp;'b I: Mul&lt;Output = I&gt; + Add&lt;Output = I&gt; + Ord,\n{\n\n}\n</code></pre>\n\n<p>I want to alias the generic type requirements:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>I: Integer + Clone + FromPrimitive + ToPrimitive,\nfor&lt;'b&gt; &amp;'b I: Mul&lt;Output = I&gt; + Add&lt;Output = I&gt; + Ord,\n</code></pre>\n\n<p>so that I won't need to rewrite them every time. Initially, I thought macros would help but it looks like they don't work like in C so I looked for another way.</p>\n\n<p>I found a way to do it for the first requirement. One has to apply the default implementation on the defined trait over any type T.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait GInteger: Integer + Clone + FromPrimitive + ToPrimitive {}\nimpl&lt;T: Integer + Clone + FromPrimitive + ToPrimitive&gt; GInteger for T {}\n</code></pre>\n\n<p>Then I can simply write:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>I: GInteger\n</code></pre>\n\n<p>instead of</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>I: Integer + Clone + FromPrimitive + ToPrimitive,\n</code></pre>\n\n<p>How can I alias the second requirement? Is it possible?</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>for&lt;'b&gt; &amp;'b I: Mul&lt;Output = I&gt; + Add&lt;Output = I&gt; + Ord,\n</code></pre>\n"}, {"tags": ["rust", "lifetime", "ownership"], "answers": [{"tags": [], "owner": {"reputation": 471, "user_id": 10477323, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KfYmJ.png?s=128&g=1", "display_name": "TheCoolDrop", "link": "https://stackoverflow.com/users/10477323/thecooldrop"}, "is_accepted": false, "score": 1, "last_activity_date": 1558802811, "last_edit_date": 1558802811, "creation_date": 1558801680, "answer_id": 56306706, "question_id": 56306074, "link": "https://stackoverflow.com/questions/56306074/issues-with-rust-timelines-and-ownerships/56306706#56306706", "title": "Issues with Rust timelines and ownerships", "body": "<p>The problem lies within the guarantees the Rust makes on your behalf. The root of the problem can be seen as following. You are reading a file and manipulating it's content into a <code>HashMap</code>, and you are trying to return reference to the the data you read. But by returning a reference you would need to guarantee, that the strings in the file wont be changed later on, which you naturally can not do.</p>\n\n<p>In Rust terms you keep trying to return references to local variables, which get dropped at the end of the function, which would efficiently leave you with dangling pointers. Here is the changes I made, even though they may not be most efficient, they do compile.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn myfunction(filename: &amp;Path) -&gt; io::Result&lt;HashMap&lt;String, String&gt;&gt; {\n    let mut SIF = HashMap::new();\n    let file = File::open(filename).unwrap();\n    let mut subset_description = \"\";\n    for line in BufReader::new(file).lines() {\n        let thisline = line?;\n        let line_split: Vec&lt;String&gt; = thisline.split(\"=\").map(|s| s.to_string()).collect();\n        subset_description = if thisline.starts_with(\"a\") {\n            let subset_description = line_split[1].trim();\n            subset_description\n        } else {\n            \"\"\n        };\n        let subset_ids = if thisline.starts_with(\"b\") {\n            let subset_ids = line_split[1].split(\",\");\n            let subset_ids = subset_ids.map(|s| s.trim());\n            subset_ids.map(|s| s.to_string()).collect()\n        } else {\n            Vec::new()\n        };\n        for k in subset_ids {\n            SIF.insert(k, subset_description.to_string());\n            println!(\"\");\n        }\n        if thisline.starts_with(\"!dataset_table_begin\") {\n            break;\n        }\n    }\n    Ok(SIF)\n}\n</code></pre>\n\n<p>As you can see, now you give away the ownership of strings in return value. This is achieved by modifying the return type and using <code>to_string()</code> function, to give away the ownership of local strings to <code>HashMap</code>.</p>\n\n<p>There is an argument that <code>to_string()</code> is slow, so you can explore the use of into or <code>to_owned()</code>, but as I am not proficient with those constructs I can not assist you in optimization.</p>\n"}], "owner": {"reputation": 1069, "user_id": 5417164, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/9cb24e9b54605c9f72cf40cf425fc814?s=128&d=identicon&r=PG&f=1", "display_name": "joydeep bhattacharjee", "link": "https://stackoverflow.com/users/5417164/joydeep-bhattacharjee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1558802811, "creation_date": 1558797157, "last_edit_date": 1558802621, "question_id": 56306074, "link": "https://stackoverflow.com/questions/56306074/issues-with-rust-timelines-and-ownerships", "title": "Issues with Rust timelines and ownerships", "body": "<p>I am trying to create a hashmap by reading a file. Below is the code that I have written. The twist is that I need to persist <code>subset_description</code> till the next iteration so that I can store it in the hasmap and then finally return the hashmap.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn myfunction(filename: &amp;Path) -&gt; io::Result&lt;HashMap&lt;&amp;str, &amp;str&gt;&gt; {\n    let mut SIF = HashMap::new();\n    let file = File::open(filename).unwrap();\n    let mut subset_description = \"\";\n    for line in BufReader::new(file).lines() {\n        let thisline = line?;\n        let line_split: Vec&lt;&amp;str&gt; = thisline.split(\"=\").collect();\n        subset_description = if thisline.starts_with(\"a\") {\n            let subset_description = line_split[1].trim();\n            subset_description\n        } else {\n            \"\"\n        };\n        let subset_ids = if thisline.starts_with(\"b\") {\n            let subset_ids = line_split[1].split(\",\");\n            let subset_ids = subset_ids.map(|s| s.trim());\n            subset_ids.collect()\n        } else {\n            Vec::new()\n        };\n        for k in subset_ids {\n            SIF.insert(k, subset_description);\n            println!(\"\");\n        }\n        if thisline.starts_with(\"!dataset_table_begin\") {\n            break;\n        }\n    }\n    Ok(SIF)\n}\n</code></pre>\n\n<p>I am getting the below error and not able to resolve this</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0515]: cannot return value referencing local variable `thisline`\n  --&gt; src/main.rs:73:5\n   |\n51 |         let line_split: Vec&lt;&amp;str&gt; = thisline.split(\"=\").collect();\n   |                                     -------- `thisline` is borrowed here\n...\n73 |     Ok(SIF)\n   |     ^^^^^^^ returns a value referencing data owned by the current function\n</code></pre>\n"}, {"tags": ["visual-studio-code", "rust"], "comments": [{"owner": {"reputation": 11277, "user_id": 3657941, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/304d8d4cceca5f9ce2383ff97b53e36b?s=128&d=identicon&r=PG&f=1", "display_name": "David Cullen", "link": "https://stackoverflow.com/users/3657941/david-cullen"}, "edited": false, "score": 1, "creation_date": 1558812375, "post_id": 56305662, "comment_id": 99226500, "body": "Try <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/debugapi/nf-debugapi-debugbreak\" rel=\"nofollow noreferrer\">DebugBreak</a> or <a href=\"https://docs.microsoft.com/en-us/cpp/intrinsics/debugbreak?view=vs-2019\" rel=\"nofollow noreferrer\">__debugbreak</a>"}, {"owner": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "reply_to_user": {"reputation": 11277, "user_id": 3657941, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/304d8d4cceca5f9ce2383ff97b53e36b?s=128&d=identicon&r=PG&f=1", "display_name": "David Cullen", "link": "https://stackoverflow.com/users/3657941/david-cullen"}, "edited": false, "score": 0, "creation_date": 1558835832, "post_id": 56305662, "comment_id": 99230123, "body": "I&#39;m gonna try to find a way to make that work in rust."}], "answers": [{"tags": [], "owner": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "is_accepted": false, "score": 0, "last_activity_date": 1558858914, "last_edit_date": 1558858914, "creation_date": 1558852555, "answer_id": 56311244, "question_id": 56305662, "link": "https://stackoverflow.com/questions/56305662/debugger-break-command-in-vs-code/56311244#56311244", "title": "Debugger break command in VS Code?", "body": "<p>Looking through what David Cullen suggested in the comments leads to a few options:</p>\n\n<ul>\n<li><a href=\"https://doc.rust-lang.org/std/intrinsics/fn.breakpoint.html\" rel=\"nofollow noreferrer\">std::intrinsics::breakpoint</a> This needs nightly rust.</li>\n<li><a href=\"https://fitzgen.github.io/breakpoint-rs/breakpoint/index.html\" rel=\"nofollow noreferrer\">The breakpoint crate</a> This doesn't even compile but it would have been nice.</li>\n<li><p><a href=\"https://docs.rs/winapi/0.3.6/i686-pc-windows-msvc/winapi/um/debugapi/fn.DebugBreak.html\" rel=\"nofollow noreferrer\">The WinApi</a> this is rather OS specific but it works for my case.  The OS dependency can at least probably be mitigated <a href=\"https://doc.rust-lang.org/book/conditional-compilation.html\" rel=\"nofollow noreferrer\">using conditional compilation</a>.  To use the library, add:</p>\n\n<pre>\n[dependencies.winapi]\nversion = \"0.3.7\"\nfeatures = [\"debugapi\"]\n</pre></li>\n</ul>\n\n<p>to Cargo.toml and call it using</p>\n\n<pre><code>unsafe {\n    winapi::um::debugapi::DebugBreak();\n}\n</code></pre>\n\n<p>However it turns out that even this approach doesn't work across crates, it just crashes.</p>\n"}], "owner": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1558858914, "creation_date": 1558794084, "last_edit_date": 1558843140, "question_id": 56305662, "link": "https://stackoverflow.com/questions/56305662/debugger-break-command-in-vs-code", "title": "Debugger break command in VS Code?", "body": "<p>In Visual Studio (C#) there is a command</p>\n\n<pre><code>System.Diagnostics.Debugger.Break();\n</code></pre>\n\n<p>that lets you automatically hop into the debugger even without setting a breakpoint.  Is there such a thing for VS Code?  I'd especially like it for rust.  I tried just writing \"let x = 1/0\" but that just crashes the program.</p>\n\n<p>I'm using the cppvsdbg debugger for windows.</p>\n"}, {"tags": ["c++", "performance", "compilation", "rust", "compiler-construction"], "comments": [{"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 5, "creation_date": 1558786598, "post_id": 56304733, "comment_id": 99220125, "body": "It is not like final executable was running on top of Ocaml. You can write C compiler in Java for example but it won&#39;t effect output."}, {"owner": {"reputation": 188064, "user_id": 635608, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oIJia.png?s=128&g=1", "display_name": "Mat", "link": "https://stackoverflow.com/users/635608/mat"}, "edited": false, "score": 2, "creation_date": 1558786713, "post_id": 56304733, "comment_id": 99220140, "body": "Having a compiler in Ocaml (or anything else) for Rust does not mean Rust is derived from Ocaml. You could write a C++ compiler in Visual Basic if you felt like it."}, {"owner": {"reputation": 15754, "user_id": 9835872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PN0Lq.jpg?s=128&g=1", "display_name": "ruohola", "link": "https://stackoverflow.com/users/9835872/ruohola"}, "edited": false, "score": 1, "creation_date": 1558786723, "post_id": 56304733, "comment_id": 99220142, "body": "I suggest you read up on compiler bootstrapping, it&#39;s a fascinating topic: <a href=\"https://en.wikipedia.org/wiki/Bootstrapping_(compilers)\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Bootstrapping_(compilers)</a> <a href=\"https://stackoverflow.com/questions/193560/writing-a-compiler-in-its-own-language\" title=\"writing a compiler in its own language\">stackoverflow.com/questions/193560/&hellip;</a>"}, {"owner": {"reputation": 1769, "user_id": 3474961, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/c4ea365044616511546cd6fd15ddcd77?s=128&d=identicon&r=PG&f=1", "display_name": "kanudo", "link": "https://stackoverflow.com/users/3474961/kanudo"}, "reply_to_user": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1558787005, "post_id": 56304733, "comment_id": 99220201, "body": "@VTT means even if the C compiler gets written in Java, the executable compiled from this C compiler can be way faster than executable compiled from Java itself? or the executable compiled from this java based C compiler can be equal in performance with an executable compiled from compiler like Clang or GCC"}, {"owner": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 2, "creation_date": 1558787274, "post_id": 56304733, "comment_id": 99220253, "body": "I mean there is no direct dependency between language compiler is written in and the performance of the compiled code. It is not even clear why would you assume that such a dependency exists. You know, some people can draw colored pictures in text editor even tough it is not the fastest way."}, {"owner": {"reputation": 15754, "user_id": 9835872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PN0Lq.jpg?s=128&g=1", "display_name": "ruohola", "link": "https://stackoverflow.com/users/9835872/ruohola"}, "edited": false, "score": 0, "creation_date": 1558787729, "post_id": 56304733, "comment_id": 99220365, "body": "@kanudo, Yeah the language the compiler is written on just affects the compilers speed and thus the compile time. It has no effect on the speed of the compiled program."}, {"owner": {"reputation": 46978, "user_id": 856199, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/CPtki.png?s=128&g=1", "display_name": "Nikos C.", "link": "https://stackoverflow.com/users/856199/nikos-c"}, "edited": false, "score": 6, "creation_date": 1558787847, "post_id": 56304733, "comment_id": 99220388, "body": "When I use a truck to transport the parts of a Ferrari, and then have humans assemble those parts, that doesn&#39;t mean the Ferrari isn&#39;t going to be faster than a truck or a human :-)"}, {"owner": {"reputation": 1769, "user_id": 3474961, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/c4ea365044616511546cd6fd15ddcd77?s=128&d=identicon&r=PG&f=1", "display_name": "kanudo", "link": "https://stackoverflow.com/users/3474961/kanudo"}, "reply_to_user": {"reputation": 32072, "user_id": 7860670, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/LH36y.png?s=128&g=1", "display_name": "user7860670", "link": "https://stackoverflow.com/users/7860670/user7860670"}, "edited": false, "score": 0, "creation_date": 1558788366, "post_id": 56304733, "comment_id": 99220520, "body": "@VTT then am i getting it right that, machine code is completely independent of the compiler or the programming language used."}, {"owner": {"reputation": 16694, "user_id": 10147399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a6d433902192f8bb03857ae1b849d4f?s=128&d=identicon&r=PG&f=1", "display_name": "Ayxan Haqverdili", "link": "https://stackoverflow.com/users/10147399/ayxan-haqverdili"}, "reply_to_user": {"reputation": 46978, "user_id": 856199, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/CPtki.png?s=128&g=1", "display_name": "Nikos C.", "link": "https://stackoverflow.com/users/856199/nikos-c"}, "edited": false, "score": 1, "creation_date": 1558789193, "post_id": 56304733, "comment_id": 99220716, "body": "@NikosC. it&#39;s like saying &quot;If humans make computers, how can computers be faster than people?&quot; :-)"}], "answers": [{"comments": [{"owner": {"reputation": 1769, "user_id": 3474961, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/c4ea365044616511546cd6fd15ddcd77?s=128&d=identicon&r=PG&f=1", "display_name": "kanudo", "link": "https://stackoverflow.com/users/3474961/kanudo"}, "edited": false, "score": 0, "creation_date": 1558788182, "post_id": 56304869, "comment_id": 99220478, "body": "Means machine code is independent of compiler or the programming language used?"}, {"owner": {"reputation": 16694, "user_id": 10147399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a6d433902192f8bb03857ae1b849d4f?s=128&d=identicon&r=PG&f=1", "display_name": "Ayxan Haqverdili", "link": "https://stackoverflow.com/users/10147399/ayxan-haqverdili"}, "reply_to_user": {"reputation": 1769, "user_id": 3474961, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/c4ea365044616511546cd6fd15ddcd77?s=128&d=identicon&r=PG&f=1", "display_name": "kanudo", "link": "https://stackoverflow.com/users/3474961/kanudo"}, "edited": false, "score": 1, "creation_date": 1558788266, "post_id": 56304869, "comment_id": 99220497, "body": "@kanudo Yes it is. It is the language your CPU understands and can directly execute"}, {"owner": {"reputation": 704, "user_id": 8801881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1053cd1123d3bf1c159b18b97cf9c45b?s=128&d=identicon&r=PG&f=1", "display_name": "Hemil", "link": "https://stackoverflow.com/users/8801881/hemil"}, "reply_to_user": {"reputation": 1769, "user_id": 3474961, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/c4ea365044616511546cd6fd15ddcd77?s=128&d=identicon&r=PG&f=1", "display_name": "kanudo", "link": "https://stackoverflow.com/users/3474961/kanudo"}, "edited": false, "score": 0, "creation_date": 1558788312, "post_id": 56304869, "comment_id": 99220504, "body": "Yes. But a c++ compiler may emit different instructions than the rust compiler and both may still do the same thing @kanudo"}, {"owner": {"reputation": 1769, "user_id": 3474961, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/c4ea365044616511546cd6fd15ddcd77?s=128&d=identicon&r=PG&f=1", "display_name": "kanudo", "link": "https://stackoverflow.com/users/3474961/kanudo"}, "edited": false, "score": 0, "creation_date": 1558788645, "post_id": 56304869, "comment_id": 99220580, "body": "So the answer is that machine instructions generated by Ocaml compiler are slower then the machine instructions generated by Rust compiler and hence executable from Rust does same thing with speed in which executable from Ocaml takes more time. Did i get it right?  And so that is the outcome of a lanugage design and not in which the language was implemented."}, {"owner": {"reputation": 16694, "user_id": 10147399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a6d433902192f8bb03857ae1b849d4f?s=128&d=identicon&r=PG&f=1", "display_name": "Ayxan Haqverdili", "link": "https://stackoverflow.com/users/10147399/ayxan-haqverdili"}, "reply_to_user": {"reputation": 1769, "user_id": 3474961, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/c4ea365044616511546cd6fd15ddcd77?s=128&d=identicon&r=PG&f=1", "display_name": "kanudo", "link": "https://stackoverflow.com/users/3474961/kanudo"}, "edited": false, "score": 0, "creation_date": 1558788854, "post_id": 56304869, "comment_id": 99220636, "body": "@kanudo not exactly. The machine code runs at the same speed. Ocaml may be doing more things like checks and stuff or may be using less efficient algorithms or something like that."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 1, "creation_date": 1558807532, "post_id": 56304869, "comment_id": 99225371, "body": "@Ayxan: Specifically, isn&#39;t OCaml garbage collected?"}, {"owner": {"reputation": 16694, "user_id": 10147399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a6d433902192f8bb03857ae1b849d4f?s=128&d=identicon&r=PG&f=1", "display_name": "Ayxan Haqverdili", "link": "https://stackoverflow.com/users/10147399/ayxan-haqverdili"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 2, "creation_date": 1558808839, "post_id": 56304869, "comment_id": 99225704, "body": "@MatthieuM. According to their <a href=\"https://ocaml.org/learn/tutorials/garbage_collection.html\" rel=\"nofollow noreferrer\">website</a> &quot;... OCaml provides a garbage collector so that you don&#39;t need to explicitly allocate and free memory as in C/C++.&quot; That too probably contributes the reason why its performance falls behind Rust and C++"}], "tags": [], "owner": {"reputation": 16694, "user_id": 10147399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a6d433902192f8bb03857ae1b849d4f?s=128&d=identicon&r=PG&f=1", "display_name": "Ayxan Haqverdili", "link": "https://stackoverflow.com/users/10147399/ayxan-haqverdili"}, "is_accepted": true, "score": 11, "last_activity_date": 1558787782, "creation_date": 1558787782, "answer_id": 56304869, "question_id": 56304733, "link": "https://stackoverflow.com/questions/56304733/why-rust-is-faster-than-ocaml-in-performance-even-though-first-rust-compiler-wa/56304869#56304869", "title": "Why Rust is faster than Ocaml in Performance, Even though first Rust compiler was implemented in Ocaml", "body": "<p>The compiler simply generates the (machine) code that is going to be run. The resulting program doesn't run on top of the language its compiler was written in. Hence, there is no correlation between performance of a particular implementation and the language it was implemented in.</p>\n"}, {"tags": [], "owner": {"reputation": 15754, "user_id": 9835872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PN0Lq.jpg?s=128&g=1", "display_name": "ruohola", "link": "https://stackoverflow.com/users/9835872/ruohola"}, "is_accepted": false, "score": 2, "last_activity_date": 1558790372, "last_edit_date": 1558790372, "creation_date": 1558789637, "answer_id": 56305094, "question_id": 56304733, "link": "https://stackoverflow.com/questions/56304733/why-rust-is-faster-than-ocaml-in-performance-even-though-first-rust-compiler-wa/56305094#56305094", "title": "Why Rust is faster than Ocaml in Performance, Even though first Rust compiler was implemented in Ocaml", "body": "<p>The language the compiler is written on just affects the  speed of the compiler and thus the compile time. It has no effect on the speed of the compiled program, since that depends only on the generated machine code.</p>\n\n<p>In principle you can write a C++ compiler with <a href=\"https://en.wikipedia.org/wiki/Brainfuck\" rel=\"nofollow noreferrer\">brainfuck</a>, run the compiler in some really slow brainfuck interpreter and have the output be the most sophisticated and efficient machine code ever. And thus your final program will be lightning fast.</p>\n\n<p>I suggest you read up on compiler bootstrapping, it's a fascinating topic:</p>\n\n<p><a href=\"http://en.wikipedia.org/wiki/Bootstrapping_(compilers)\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Bootstrapping_(compilers)</a><br>\n<a href=\"https://stackoverflow.com/questions/193560/writing-a-compiler-in-its-own-language\">https://stackoverflow.com/questions/193560/writing-a-compiler-in-its-own-language\n</a></p>\n"}], "owner": {"reputation": 1769, "user_id": 3474961, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/c4ea365044616511546cd6fd15ddcd77?s=128&d=identicon&r=PG&f=1", "display_name": "kanudo", "link": "https://stackoverflow.com/users/3474961/kanudo"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1086, "favorite_count": 0, "closed_date": 1558822196, "accepted_answer_id": 56304869, "answer_count": 2, "score": -2, "last_activity_date": 1558790654, "creation_date": 1558786525, "last_edit_date": 1558790654, "question_id": 56304733, "link": "https://stackoverflow.com/questions/56304733/why-rust-is-faster-than-ocaml-in-performance-even-though-first-rust-compiler-wa", "closed_reason": "Needs more focus", "title": "Why Rust is faster than Ocaml in Performance, Even though first Rust compiler was implemented in Ocaml", "body": "<p>I found that the initial compiler for Rust language was written in Ocaml. So what i thought was that Rust would be similar to Ocaml performance wise. But when I look at benchmarks <a href=\"https://benchmarksgame-team.pages.debian.net/benchmarksgame/faster/ocaml-gpp.html\" rel=\"nofollow noreferrer\">Ocaml vs C++</a> and <a href=\"https://benchmarksgame-team.pages.debian.net/benchmarksgame/faster/rust-gpp.html\" rel=\"nofollow noreferrer\">Rust vs C++</a> and compare Ocaml with Rust. It gives me what...?, but how...?</p>\n\n<p>How can Rust be more faster in performance compared to Ocaml even though it derived from Ocaml?</p>\n\n<p>and then it gives rise to an another question ???</p>\n\n<p>Can a compiler based language derived from C be faster than C itself performance wise?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 0, "creation_date": 1558785692, "post_id": 56304503, "comment_id": 99219926, "body": "The C# thingy looks a bit like a configuration switch. In Rust <a href=\"https://doc.rust-lang.org/reference/conditional-compilation.html\" rel=\"nofollow noreferrer\">conditional compilation</a> can be done with an attribute <code>#[cfg(feature = &quot;feature_name&quot;)]</code>, which compiles the item it is attached to only if the feature is set."}, {"owner": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "reply_to_user": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 0, "creation_date": 1558786065, "post_id": 56304503, "comment_id": 99220013, "body": "@starblue I&#39;ll look into that, but it looks like Rust conditional compilation removes the definition entirely so that it can&#39;t even be called."}, {"owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 0, "creation_date": 1558858271, "post_id": 56304503, "comment_id": 99233227, "body": "You can use a feature and its negation to have two different versions, the drawback is that it is a bit verbose."}, {"owner": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "reply_to_user": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 0, "creation_date": 1558858802, "post_id": 56304503, "comment_id": 99233330, "body": "@starblue The distinction is that C# leaves the definition, but deletes every instance of a call to the function, which has the side effect of not evaluating parameters.  If I write 2 different versions using cfg, then I&#39;m just back where I started with having to figure out how to not evaluate the parameters of one of the versions.  If macros could be inherited by traits this would also be no problem since I could just define 2 different macros."}], "answers": [{"comments": [{"owner": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "edited": false, "score": 0, "creation_date": 1558785512, "post_id": 56304556, "comment_id": 99219880, "body": "While this would technically work, I&#39;m going to be writing out the check call a tremendous number of times , writing out CheckStruct::check(|| -&gt; { expression }); would be a nearly unbearable amount of extra boilerplate code than just writing CheckStruct::check(expression) like other languages allow.  I&#39;m hoping there is a better solution."}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "reply_to_user": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "edited": false, "score": 1, "creation_date": 1558785731, "post_id": 56304556, "comment_id": 99219936, "body": "@DanielV If boilerplate is the only problem, you can add a <code>check_eager</code> method that uses <code>check</code> internally, or wrap that construct into a macro."}, {"owner": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1558785954, "post_id": 56304556, "comment_id": 99219984, "body": "@E_net4 I&#39;m afraid I can&#39;t follow your suggestion."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "edited": false, "score": 0, "creation_date": 1558786013, "post_id": 56304556, "comment_id": 99219999, "body": "@DanielV: This is the best solution I know of for your requirements, which says more about me than about the language or your requirements. If it doesn&#39;t suit you, do not accept the answer (click on the &quot;tick&quot; sign under the score) and wait for someone else to propose an alternative."}, {"owner": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "edited": false, "score": 0, "creation_date": 1558786199, "post_id": 56304556, "comment_id": 99220038, "body": "@MatthieuM.Your answer is useful as it is a possibility I hadn&#39;t considered, but it just won&#39;t work in my case.  It might work for someone else."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "edited": false, "score": 0, "creation_date": 1558786679, "post_id": 56304556, "comment_id": 99220136, "body": "@DanielV: Sure, no worries ;) By the way, you do realize that the actual syntax of the call can be simplified to <code>CheckStruct::check(|| expression);</code>? That is, it&#39;s only 3 extraneous characters: <code>|| </code>. Annotating the return type <code>-&gt; bool</code> and surrounding the expression by a block <code>{}</code> are both optional."}, {"owner": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "edited": false, "score": 0, "creation_date": 1558786849, "post_id": 56304556, "comment_id": 99220171, "body": "@MatthieuM. No I did not know that.  Also, in the example code check is defined 3 times (trait and twice in structs).  Could you be more precise how you would modify the trait and structs to implement your non memory allocating solution?  And where is FnOnce defined?"}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "edited": false, "score": 0, "creation_date": 1558788328, "post_id": 56304556, "comment_id": 99220508, "body": "@DanielV: I&#39;ve added a link to <code>FnOnce</code> (it&#39;s part of the Rust language) and rewrote your example entirely with the modified solution. I also added a link to the Rust playground, where you can compile and execute this code online to see that it prints the desired result."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "reply_to_user": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "edited": false, "score": 2, "creation_date": 1558788546, "post_id": 56304556, "comment_id": 99220552, "body": "@DanielV In your example, you could even simplify the calls to <code>T::check(show_stuff_a);</code> and <code>T::check(show_stuff_b);</code>"}, {"owner": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "edited": false, "score": 0, "creation_date": 1558788757, "post_id": 56304556, "comment_id": 99220606, "body": "I think this will work.  Let me apply it to my larger project and make sure (I&#39;m still new at this) then I think I can accept this answer."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "edited": false, "score": 0, "creation_date": 1558791636, "post_id": 56304556, "comment_id": 99221317, "body": "@DanielV: Take your time to accept any answer; I personally prefer to wait 24h/48h before accepting as it can discourage competing answers which may have better solutions."}], "tags": [], "owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "is_accepted": true, "score": 6, "last_activity_date": 1558788250, "last_edit_date": 1558788250, "creation_date": 1558784937, "answer_id": 56304556, "question_id": 56304503, "link": "https://stackoverflow.com/questions/56304503/how-do-i-tell-the-compiler-not-to-evaluate-an-argument/56304556#56304556", "title": "How do I tell the compiler not to evaluate an argument?", "body": "<p>Only evaluating arguments as necessary is called Lazy Evaluation.</p>\n\n<p>In languages like Haskell, for which Lazy Evaluation is the default, an argument or variable of type <code>bool</code> is not actually represented as a <code>bool</code> immediately, instead it is represented as a \"thunk\" which contains the function to call and its own arguments (potentially thunks).</p>\n\n<p>In Rust, since Eager Evaluation is the default, you need to explicitly represent laziness in the type of the argument or valuable. This is generally done by asking not for <code>T</code> but for <a href=\"https://doc.rust-lang.org/std/ops/trait.FnOnce.html\" rel=\"nofollow noreferrer\"><code>FnOnce() -&gt; T</code></a> instead.</p>\n\n<p>Therefore, you would rewrite <code>check</code> as:</p>\n\n<pre><code>fn check&lt;F: FnOnce() -&gt; bool&gt;(condition: F);\n</code></pre>\n\n<p>Then, it's up to the implementation to either evaluate <code>F</code> or not, and if not evaluated nothing is executed.</p>\n\n<p><em>Note: if you do not want a generic <code>check</code>, you can take <code>Box&lt;FnOnce() -&gt; bool&gt;</code> as an argument; it will however require a heap allocation... just like in Haskell.</em></p>\n\n<hr>\n\n<p>Let's see some code! <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=d086e6a000bba5d42598224463a14c2a\" rel=\"nofollow noreferrer\">Playground link</a></p>\n\n<pre><code>trait CheckTrait {\n    fn check&lt;F: FnOnce() -&gt; bool&gt;(b: F);\n}\n\nstruct CheckStructA {}\n\nstruct CheckStructB {}\n\nimpl CheckTrait for CheckStructA {\n    fn check&lt;F: FnOnce() -&gt; bool&gt;(b: F) {\n        b();\n        println!(\"CheckStructA\");\n    }\n}\n\nimpl CheckTrait for CheckStructB {\n    fn check&lt;F: FnOnce() -&gt; bool&gt;(_b: F) {\n        println!(\"CheckStructB\");\n    }\n}\n\nfn show_stuff_a() -&gt; bool {\n    println!(\"Show stuff A\");\n    true\n}\n\nfn show_stuff_b() -&gt; bool {\n    println!(\"Show stuff B\");\n    true\n}\n\nfn test_a&lt;T : CheckTrait&gt;(_ : T) {\n    T::check(|| show_stuff_a());\n}\n\nfn test_b&lt;T : CheckTrait&gt;(_ : T) {\n    T::check(|| show_stuff_b());\n}\n\nfn main() {\n    test_a(CheckStructA{});\n    test_b(CheckStructB{});\n}\n</code></pre>\n"}], "owner": {"reputation": 570, "user_id": 2780630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57f6fdc404f5a270e608f3df85f40dfb?s=128&d=identicon&r=PG&f=1", "display_name": "DanielV", "link": "https://stackoverflow.com/users/2780630/danielv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 56304556, "answer_count": 1, "score": 3, "last_activity_date": 1558788250, "creation_date": 1558784521, "last_edit_date": 1558785256, "question_id": 56304503, "link": "https://stackoverflow.com/questions/56304503/how-do-i-tell-the-compiler-not-to-evaluate-an-argument", "title": "How do I tell the compiler not to evaluate an argument?", "body": "<p>I'd like to instruct the Rust compiler to not evaluate an argument under any circumstance.  Here is an example:</p>\n\n<pre><code>#![allow(dead_code)]\n\ntrait CheckTrait {\n    fn check(b : bool);\n}\n\nstruct CheckStructA {}\n\nstruct CheckStructB {}\n\nimpl CheckTrait for CheckStructA {\n    fn check(_b : bool) {\n        println!(\"CheckStructA\");\n    }\n}\n\nimpl CheckTrait for CheckStructB {\n    // compiler: do not evaluate the argument _b\n    fn check(_b : bool) {\n    }\n}\n\nfn show_stuff_a() -&gt; bool {\n    println!(\"Show stuff A\");\n    true\n}\n\nfn show_stuff_b() -&gt; bool {\n    println!(\"Show stuff B\");\n    true\n}\n\nfn test_a&lt;T : CheckTrait&gt;(_ : T) {\n    T::check(show_stuff_a());\n}\n\nfn test_b&lt;T : CheckTrait&gt;(_ : T) {\n    T::check(show_stuff_b());\n}\n\nfn main() {\n    test_a(CheckStructA{});\n    test_b(CheckStructB{});\n }\n</code></pre>\n\n<p>Here <code>CheckStructB</code> is effectively a disabled version of <code>CheckStructA</code>.  Where the comment is, I would like to be able to instruct the compiler not to evaluate whatever expression computes <code>_b</code> for <code>CheckStructB::check</code>, but still evaluate whatever expression would compute <code>_b</code> for <code>CheckStructA::check</code>.  The consequence on this code is that it would still output \"Show Stuff A\" to the console, but not output \"Show Stuff B\" to the console.</p>\n\n<p>In C# this can be done by replacing the comment with [System.Diagnostics.Conditional(\"DoNotEverTurnThisOn\")] . I do not want to define the types inside a macro because that breaks intellisense. </p>\n\n<p>How do I do it in Rust?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 875, "user_id": 1313057, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5f3e5fe7d6a4062ad188336e06f1cb78?s=128&d=identicon&r=PG", "display_name": "Philip Daniels", "link": "https://stackoverflow.com/users/1313057/philip-daniels"}, "edited": false, "score": 0, "creation_date": 1558792973, "post_id": 56304571, "comment_id": 99221621, "body": "Thanks, this worked. It did not work when I applied it to my actual code rather than this minimum-repro code, however I was able to get it to work by applying the &#39;inline the call&#39; technique again. I will edit the question to show the actual solution as others mmay find it useful, especially if they are beginners."}], "tags": [], "owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "is_accepted": true, "score": 2, "last_activity_date": 1558785084, "creation_date": 1558785084, "answer_id": 56304571, "question_id": 56304313, "link": "https://stackoverflow.com/questions/56304313/cannot-use-format-args-due-to-temporary-value-is-freed-at-the-end-of-this-state/56304571#56304571", "title": "Cannot use format_args! due to temporary value is freed at the end of this statement", "body": "<p><code>format_args!</code> is expected to be invoked exactly where the returned value will be used.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let mut builder = RecordBuilder::new();\nlet _log_rec = builder\n    .args(format_args!(\"Completed: {}, Elapsed={:?}\", \"blah\", 20))\n    .build();\n</code></pre>\n\n<p>This is because, as how it's implemented, the macro expands into (among other constructs) a sequence of narrowly scoped values for each of the given parameters, and the <a href=\"https://doc.rust-lang.org/std/fmt/struct.Arguments.html\" rel=\"nofollow noreferrer\"><code>Arguments</code></a> value is created with only a large enough lifetime to capture them.</p>\n"}], "owner": {"reputation": 875, "user_id": 1313057, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5f3e5fe7d6a4062ad188336e06f1cb78?s=128&d=identicon&r=PG", "display_name": "Philip Daniels", "link": "https://stackoverflow.com/users/1313057/philip-daniels"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "accepted_answer_id": 56304571, "answer_count": 1, "score": 2, "last_activity_date": 1593114371, "creation_date": 1558783123, "last_edit_date": 1593114371, "question_id": 56304313, "link": "https://stackoverflow.com/questions/56304313/cannot-use-format-args-due-to-temporary-value-is-freed-at-the-end-of-this-state", "title": "Cannot use format_args! due to temporary value is freed at the end of this statement", "body": "<p>I'm trying to construct my own custom <a href=\"https://docs.rs/log/0.4.6/log/struct.Record.html\" rel=\"nofollow noreferrer\">LogRecord</a> and pass it into the <a href=\"https://docs.rs/log/0.4.6/log/\" rel=\"nofollow noreferrer\">log</a> crate.</p>\n<pre class=\"lang-rust prettyprint-override\"><code>use log::RecordBuilder;\n\nfn main() {\n    let msg = format_args!(&quot;Completed: {}, Elapsed={:?}&quot;, &quot;blah&quot;, 20);\n    //let msg = format_args!(&quot;This is OK&quot;);\n    let mut builder = RecordBuilder::new();\n    let _log_rec = builder\n        .args(msg)\n        .build();\n}\n</code></pre>\n<p>I'm running into a temporary lifetime problem with the call to the <a href=\"https://docs.rs/log/0.4.6/log/struct.RecordBuilder.html#method.args\" rel=\"nofollow noreferrer\">args</a> method. The error is</p>\n<pre><code> --&gt; src/main.rs:4:28\n  |\n4 |     let msg = format_args!(&quot;Completed: {}, Elapsed={:?}&quot;, &quot;blah&quot;, 20);\n  |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^             - temporary value is freed at the end of this statement\n  |                            |\n  |                            creates a temporary which is freed while still in use\n...\n8 |         .args(msg)\n  |               --- borrow later used here\n  |\n  = note: consider using a `let` binding to create a longer lived value\n\n</code></pre>\n<p>Normally this would be an easy fix - just put the temporary into a local variable. In this case though, I don't understand how to fix it, since I've got everything I can think of into local variables already (and is why I don't think this question is a duplicate of the others). It seems to be something particular to the <code>format_args!</code> macro.</p>\n<p>Interestingly, the problem goes away if you don't use any <code>{}</code> placeholders in the call to <code>format_args!()</code>.</p>\n<h1>Actual Solution</h1>\n<p><a href=\"https://stackoverflow.com/a/56304571/2766908\">The solution from E_net4 is correct</a>. It did not work immediately in my actual code, which was:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>impl Drop for ExecutionTimer2 {\n    fn drop(&amp;mut self) {\n        let elapsed = self.start_time.elapsed();\n\n        let mut builder = RecordBuilder::new();\n        let log_rec = builder\n            .level(Level::Debug)\n            .target(&quot;ExecutionTimer&quot;)\n            .file(Some(self.file))\n            .module_path(Some(self.module_path))\n            .line(Some(self.line))\n            .args(format_args!(&quot;Completed: {}, Elapsed={:?}&quot;, self.name, elapsed))\n            .build();\n\n        let logger = log::logger();\n        logger.log(&amp;log_rec);\n    }\n}\n</code></pre>\n<p>but I applied the 'inlining' technique again to come up with this code, which does compile:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>impl Drop for ExecutionTimer2 {\n    fn drop(&amp;mut self) {\n        let elapsed = self.start_time.elapsed();\n        let mut builder = RecordBuilder::new();\n        let logger = log::logger();\n\n        logger.log(&amp;\n            builder\n                .level(Level::Debug)\n                .target(&quot;ExecutionTimer&quot;)\n                .file(Some(self.file))\n                .module_path(Some(self.module_path))\n                .line(Some(self.line))\n                .args(format_args!(&quot;Completed: {}, Elapsed={:?}&quot;, self.name, elapsed))\n                .build()\n        );\n    }\n}\n</code></pre>\n"}, {"tags": ["file-io", "rust"], "comments": [{"owner": {"reputation": 3472, "user_id": 4072509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/16VK8.jpg?s=128&g=1", "display_name": "apetranzilla", "link": "https://stackoverflow.com/users/4072509/apetranzilla"}, "edited": false, "score": 0, "creation_date": 1558746349, "post_id": 56300862, "comment_id": 99213791, "body": "Is there a reason you&#39;re using an iterator over a range, rather than the iterator provided by <code>read_dir()?</code>?"}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "edited": false, "score": 0, "creation_date": 1558872512, "post_id": 56300862, "comment_id": 99236082, "body": "Is there a reason you are not using an absolute path as the error message says?"}, {"owner": {"reputation": 9, "user_id": 11553022, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cyCxc4CWXLI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd40LcgcbsJGMCvC0lBSCkArHMWBQ/mo/photo.jpg?sz=128", "display_name": "David Martin", "link": "https://stackoverflow.com/users/11553022/david-martin"}, "edited": false, "score": 0, "creation_date": 1558923834, "post_id": 56300862, "comment_id": 99246496, "body": "Sorry, was busy over the weekend, I did try to use <code>read_dir()?</code>, but that led to the same error message. Using the absolute path (from C:/ to resources/images) didn&#39;t work either, same error message."}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "edited": false, "score": 0, "creation_date": 1558952393, "post_id": 56300862, "comment_id": 99255889, "body": "@DavidMartin Can you include the code you used for an absolute path? My understanding of the ggez filesystem is that the code wants an absolute path from the virtual root, like <code>&#47;images</code>."}, {"owner": {"reputation": 9, "user_id": 11553022, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cyCxc4CWXLI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd40LcgcbsJGMCvC0lBSCkArHMWBQ/mo/photo.jpg?sz=128", "display_name": "David Martin", "link": "https://stackoverflow.com/users/11553022/david-martin"}, "edited": false, "score": 0, "creation_date": 1558999994, "post_id": 56300862, "comment_id": 99273197, "body": "I assumed that by absolute path I would just replace <code>resources&#47;images</code> with <code>C:&#47;Users&#47;MyUser&#47;Documents&#47;MyRustFolder&#47;project_name&#47;resource&zwnj;&#8203;s&#47;images</code>"}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "edited": false, "score": 0, "creation_date": 1559404643, "post_id": 56300862, "comment_id": 99413609, "body": "Do <code>&#47;resources&#47;images</code> or <code>&#47;images</code> work for you as absolute paths? <code>ggez</code> abstracts away the filesystem, so you shouldn&#39;t have to use an absolute path with any details about your local system."}, {"owner": {"reputation": 9, "user_id": 11553022, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cyCxc4CWXLI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd40LcgcbsJGMCvC0lBSCkArHMWBQ/mo/photo.jpg?sz=128", "display_name": "David Martin", "link": "https://stackoverflow.com/users/11553022/david-martin"}, "edited": false, "score": 0, "creation_date": 1559597756, "post_id": 56300862, "comment_id": 99463905, "body": "I&#39;ve tried <code>&#47;resources&#47;images</code>. Not <code>&#47;images</code>. If I remember correctly it says it cannot find the directory."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560384831, "post_id": 56300862, "comment_id": 99722300, "body": "It&#39;s hard to answer your question because it doesn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. We can&#39;t tell what crates (and their versions), types, traits, fields, etc. are present in the code. It would make it easier for us to help you if you try to reproduce your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> if possible, otherwise in a brand new Cargo project, then <a href=\"https://stackoverflow.com/posts/56300862/edit\">edit</a> your question to include the additional info. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MCVE tips</a> you can use to reduce your original code for posting here. Thanks!"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560384867, "post_id": 56300862, "comment_id": 99722307, "body": "While links are great as <i>additional</i> context, they are no substitute for the MCVE being present directly <i>in the question</i>"}], "owner": {"reputation": 9, "user_id": 11553022, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cyCxc4CWXLI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd40LcgcbsJGMCvC0lBSCkArHMWBQ/mo/photo.jpg?sz=128", "display_name": "David Martin", "link": "https://stackoverflow.com/users/11553022/david-martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 188, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1560384816, "creation_date": 1558745456, "last_edit_date": 1560384816, "question_id": 56300862, "link": "https://stackoverflow.com/questions/56300862/resource-not-valid-must-be-an-absolute-path-with-no-references-to-parent-direc", "title": "&quot;Resource not valid: must be an absolute path with no references to parent directories&quot; error when iterating through a folder", "body": "<p>I'm new to Rust and the ggez game engine, and I am trying to load in a bunch of images from one folder. I keep getting the same error.</p>\n\n<p>I've tried using the <code>Path</code> type, <code>String</code>s, full directory to the file, and string literals and nothing seems to work. I've spent about 6 hours of coding on this issue.</p>\n\n<p>This is the code that seems to be the problem:</p>\n\n<pre><code>for number in 0..read_dir(\"resources/images\")?.count() - 1 {\n    let image_path = format!(\"{0}/{1}.png\", \"resources/images\", number);\n    images.push(graphics::Image::new(ctx, image_path)?);\n}\n</code></pre>\n\n<p>I expect all the files to load in. It's that simple.\n<a href=\"https://github.com/15024/opening_files/tree/9a74c6155be8a0783d23a29c71aa8a4e9b2541d8\" rel=\"nofollow noreferrer\">Here's a git repository of a MCVE</a>.</p>\n\n<p>I've also tried using the <code>DirEntry</code> type:</p>\n\n<pre><code>for (number, item) in fs::read_dir(&amp;images_path)?.enumerate() {\n    images.push(graphics::Image::new(ctx, item?.path())?);\n}\n</code></pre>\n\n<p>It yields the same error.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1558776579, "post_id": 56296864, "comment_id": 99218100, "body": "You can map to a char to achieve what you want, for example: <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=120f51cf16015dfdd244175b07c6ec22\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 7, "last_activity_date": 1558717971, "creation_date": 1558717971, "answer_id": 56296975, "question_id": 56296864, "link": "https://stackoverflow.com/questions/56296864/what-does-it-mean-when-method-exists-but-trait-bounds-not-satisfied/56296975#56296975", "title": "What does it mean when &quot;method exists but trait bounds not satisfied&quot;?", "body": "<p>The method <code>all()</code> is a method of the <code>Iterator</code> trait, so you can only call it on types that implement that trait. The type <code>Range&lt;char&gt;</code> does not implement the <code>Iterator</code> trait, since a range of Unicode characters is not well-defined in the general case. The set of valid Unicode code points has gaps, and building a range of code points is not in general considered useful. The type <code>Range&lt;u8&gt;</code> on the other does implement <code>Iterator</code>, since iterating over a range of bytes has a well-defined meaning.</p>\n\n<p>More generally, the error message tells you that Rust has found a method with the correct name, but that method does not apply to the type you call it for.</p>\n"}, {"tags": [], "owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "is_accepted": false, "score": 3, "last_activity_date": 1558718174, "creation_date": 1558718174, "answer_id": 56297021, "question_id": 56296864, "link": "https://stackoverflow.com/questions/56296864/what-does-it-mean-when-method-exists-but-trait-bounds-not-satisfied/56297021#56297021", "title": "What does it mean when &quot;method exists but trait bounds not satisfied&quot;?", "body": "<p>What this means is that there is a trait in scope that has a function with that name, but that the object you are using does not implement such a trait.</p>\n\n<p>In your particular case, the trait that contains the <code>all</code> method is <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.all\" rel=\"nofollow noreferrer\"><code>std::iter::Iterator</code></a>, but your object <code>('a'..'z')</code> if of type <code>Range&lt;char&gt;</code> that does not implement it.</p>\n\n<p>Curiously enough, your second example compiles because <code>(b'a'..b'z')</code> is of type <code>Range&lt;u8&gt;</code> that does implement <code>Iterator</code>.</p>\n\n<p>You are probably wondering why <code>Range&lt;char&gt;</code> does not implement iterator. That is because there are invalid <code>char</code> values between valid ones, so these ranges just cannot be iterated. In particular, the only valid chars are those in the ranges <code>[0x0, 0xD7FF]</code> and <code>[0xE000, 0x10FFFF]</code>, IIRC.</p>\n"}], "owner": {"reputation": 83, "user_id": 1592539, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/5e7381b060c7dcdef079189d09fe2f6d?s=128&d=identicon&r=PG", "display_name": "dmkathayat", "link": "https://stackoverflow.com/users/1592539/dmkathayat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1047, "favorite_count": 0, "accepted_answer_id": 56296975, "answer_count": 2, "score": 2, "last_activity_date": 1558725139, "creation_date": 1558717484, "last_edit_date": 1558725139, "question_id": 56296864, "link": "https://stackoverflow.com/questions/56296864/what-does-it-mean-when-method-exists-but-trait-bounds-not-satisfied", "title": "What does it mean when &quot;method exists but trait bounds not satisfied&quot;?", "body": "<p>I'm new to Rust and observed something that I couldn't reason against.</p>\n\n<p>When I write </p>\n\n<pre><code>fn main() {\n    ('a'..'z').all(|_| true);\n}\n</code></pre>\n\n<p>The compiler reports an error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0599]: no method named `all` found for type `std::ops::Range&lt;char&gt;` in the current scope\n --&gt; src/main.rs:2:16\n  |\n2 |     ('a'..'z').all(|_| true)\n  |                ^^^\n  |\n  = note: the method `all` exists but the following trait bounds were not satisfied:\n          `std::ops::Range&lt;char&gt; : std::iter::Iterator`\n</code></pre>\n\n<p>When I change it to </p>\n\n<pre><code>fn main() {\n    (b'a'..b'z').all(|_| true);\n}\n</code></pre>\n\n<p>it compiles.</p>\n\n<p>What's happening here? What does Rust mean when it says <code>the method ... exists but the following trait bounds were not satisfied</code>?</p>\n"}, {"tags": ["rust", "closures", "reference-counting", "interior-mutability"], "comments": [{"owner": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "edited": false, "score": 1, "creation_date": 1558717184, "post_id": 56296665, "comment_id": 99205956, "body": "You don&#39;t <i>need</i> <code>FnMut</code> here (and hence don&#39;t need to borrow mutably or even use <code>RefCell</code> at all), since there are no variables moved into the closure so it doesn&#39;t have its own state. You only have a mutable parameter, but the closure itself doesn&#39;t mutate."}, {"owner": {"reputation": 8378, "user_id": 124538, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/82159aeb57c52bc0c7bfe6e9c832c3ea?s=128&d=identicon&r=PG", "display_name": "Wesley Wiser", "link": "https://stackoverflow.com/users/124538/wesley-wiser"}, "edited": false, "score": 2, "creation_date": 1558717303, "post_id": 56296665, "comment_id": 99206005, "body": "To apply the answer in the duplicate I linked, you just need to change the second to last line to <code>let cc = &amp;mut *closure.borrow_mut();</code>"}, {"owner": {"reputation": 935, "user_id": 6759854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kFnni.jpg?s=128&g=1", "display_name": "Xiwen Li", "link": "https://stackoverflow.com/users/6759854/xiwen-li"}, "edited": false, "score": 2, "creation_date": 1558718375, "post_id": 56296665, "comment_id": 99206402, "body": "You are right. That solves my problem. Thank you Wesley."}], "owner": {"reputation": 935, "user_id": 6759854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kFnni.jpg?s=128&g=1", "display_name": "Xiwen Li", "link": "https://stackoverflow.com/users/6759854/xiwen-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "closed_date": 1558718254, "answer_count": 0, "score": 0, "last_activity_date": 1558718934, "creation_date": 1558716512, "last_edit_date": 1558718934, "question_id": 56296665, "link": "https://stackoverflow.com/questions/56296665/why-dynamic-closureclosure-as-trait-object-becomes-unusable-after-putting-behi", "closed_reason": "Duplicate", "title": "Why dynamic closure(closure as trait object) becomes unusable after putting behind Rc&lt;RefCell&lt;T&gt;&gt;?", "body": "<p>I need to put closures behind <code>&lt;Rc&lt;RefCell&lt;T&gt;&gt;</code> for some reason:</p>\n\n<ol>\n<li>multiple references to closure;</li>\n<li>closure can modify environment(interior mutability);</li>\n<li>closure is better stored as trait object because eventually I want to put references inside a vector.</li>\n</ol>\n\n<p>However, closures become unusable when stored as trait object.</p>\n\n<p>Here is an example. To simply, variable <code>closure</code> doesn't mutate environment. In my own use case, I do need mutate environment.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>type Handler = FnMut(&amp;mut u32);\n\nlet closure: rc::Rc&lt;cell::RefCell&lt;Handler&gt;&gt; = rc::Rc::new(cell::RefCell::new(|x: &amp;mut u32|{\n// would work if above line is:\n// let closure: = rc::Rc::new(cell::RefCell::new(|x: &amp;mut u32|{\n    *x = 3;\n}));\n\nlet mut y = 0u32;\n\nlet cc = closure.borrow_mut();\n\ncc(&amp;mut y);\n</code></pre>\n\n<p>I know that it would work if I remove the type contraint on variable <code>closure</code>. But that way I lost the ability to put similar closures inside vec.</p>\n\n<p>Is there a way to use closure behind <code>&lt;Rc&lt;RefCell&lt;T&gt;&gt;</code>? Or is there other alternative in rust to meet the 3 requirements I listed?</p>\n"}, {"tags": ["rust", "timeout", "rust-tokio"], "answers": [{"tags": [], "owner": {"reputation": 340, "user_id": 1087576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc0840f7fd22073389276d85120e0884?s=128&d=identicon&r=PG", "display_name": "Tom K", "link": "https://stackoverflow.com/users/1087576/tom-k"}, "is_accepted": false, "score": 0, "last_activity_date": 1559361638, "creation_date": 1559361638, "answer_id": 56403751, "question_id": 56295845, "link": "https://stackoverflow.com/questions/56295845/delay-future-returns-errorshutdown-when-polled/56403751#56403751", "title": "Delay future returns Error(shutdown) when polled", "body": "<p>A <a href=\"https://docs.rs/tokio/0.1.21/tokio/timer/struct.Delay.html\" rel=\"nofollow noreferrer\"><code>Delay</code></a> works together with a <a href=\"https://docs.rs/tokio-timer/0.2.11/tokio_timer/timer/struct.Timer.html\" rel=\"nofollow noreferrer\"><code>Timer</code></a> and the error here indicates that it was unable to register with one. While the docs sometimes assume that you're working within a tokio context, <a href=\"https://docs.rs/tokio/0.1.21/tokio/timer/\" rel=\"nofollow noreferrer\">they do mention this requirement</a>:</p>\n\n<blockquote>\n  <p>These types must be used from within the context of the <a href=\"https://docs.rs/tokio/0.1.21/tokio/runtime/struct.Runtime.html\" rel=\"nofollow noreferrer\"><code>Runtime</code></a> or a timer context must be setup explicitly. See the <a href=\"https://docs.rs/tokio-timer\" rel=\"nofollow noreferrer\"><code>tokio-timer</code></a> crate for more details on how to setup a timer context.</p>\n</blockquote>\n\n<p>If you wanted to avoid the error, it would be enough to run it inside a task:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    tokio::run(futures::future::lazy(|| {\n        let mut delay = Delay::new(Instant::now() + Duration::from_millis(3000));\n\n        sleep(Duration::from_millis(1000));\n\n        // \"Not ready\"\n        match delay.poll() {\n            Ok(Async::NotReady) =&gt; println!(\"Not ready\"),\n            Ok(Async::Ready(v)) =&gt; println!(\"Ready: {:?}\", v),\n            Err(e) =&gt; println!(\"{:?}\", e),\n        }\n\n        Ok(())\n    }))\n}\n</code></pre>\n\n<p>However this will not transition to ready even if you wait more than 3000 milliseconds. If you want to use the Runtime's Timer you'll have to spawn it as a task:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    // \"Ready: ()\"\n    tokio::run(\n        Delay::new(Instant::now() + Duration::from_millis(3000))\n            .map(|v| println!(\"Ready: {:?}\", v))\n            .map_err(|e| println!(\"{:?}\", e)),\n    )\n}\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 4106669, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Te0gf.jpg?s=128&g=1", "display_name": "bertof", "link": "https://stackoverflow.com/users/4106669/bertof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 192, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559361638, "creation_date": 1558712803, "last_edit_date": 1558775094, "question_id": 56295845, "link": "https://stackoverflow.com/questions/56295845/delay-future-returns-errorshutdown-when-polled", "title": "Delay future returns Error(shutdown) when polled", "body": "<p>I'm rewriting the <a href=\"https://docs.rs/tokio/0.1.20/tokio/prelude/stream/struct.Forward.html\" rel=\"nofollow noreferrer\"><code>Forward</code></a> future from a <code>Stream</code> to a <code>Sink</code> adding a timeout on the reception of new items.\nI'm using a <a href=\"https://docs.rs/tokio/0.1.20/tokio/timer/struct.Delay.html\" rel=\"nofollow noreferrer\"><code>Delay</code></a> future inside the <code>Forward</code> struct to keep track of the timeout, but the result is always an <code>Error(Shutdown)</code>.</p>\n\n<p>From the <a href=\"https://docs.rs/tokio/0.1.20/tokio/timer/struct.Error.html\" rel=\"nofollow noreferrer\"><code>timer::Error</code></a> documentation I see that this should return only if the future is dropped but it should not be the case since it's still contained in the main struct.</p>\n\n<p>This is a minimal test example from which I get the same result.</p>\n\n<pre><code>extern crate tokio; // 0.1.20\n\nuse std::thread::sleep;\nuse std::time::{Duration, Instant};\nuse tokio::prelude::*;\nuse tokio::timer::Delay;\n\nfn main() {\n    let mut delay = Delay::new(Instant::now() + Duration::from_millis(3000));\n\n    sleep(Duration::from_millis(1000));\n\n    match delay.poll() {\n        Ok(Async::NotReady) =&gt; println!(\"Not ready\"),\n        Ok(Async::Ready(v)) =&gt; println!(\"Ready: {:?}\", v),\n        Err(e) =&gt; println!(\"{:?}\", e),\n    }\n}\n</code></pre>\n\n<p>You can see a running example <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=dcb5b50d676e179c480ee8cba1432922\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>I'm expecting to either receive an <code>Async:Ready(v)</code> where <code>v</code> is <code>()</code>.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 1540, "user_id": 2606171, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4ncy.png?s=128&g=1", "display_name": "belst", "link": "https://stackoverflow.com/users/2606171/belst"}, "edited": false, "score": 0, "creation_date": 1558712792, "post_id": 56295794, "comment_id": 99204123, "body": "Your trait has to implement <code>Debug</code>: <code>pub trait SaySomething : std::fmt::Debug { ... }</code>"}, {"owner": {"reputation": 486, "user_id": 7390103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd6f9336ce4ea417426a99450ea8777c?s=128&d=identicon&r=PG&f=1", "display_name": "Spaceship222", "link": "https://stackoverflow.com/users/7390103/spaceship222"}, "reply_to_user": {"reputation": 1540, "user_id": 2606171, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4ncy.png?s=128&g=1", "display_name": "belst", "link": "https://stackoverflow.com/users/2606171/belst"}, "edited": false, "score": 0, "creation_date": 1558713060, "post_id": 56295794, "comment_id": 99204246, "body": "@belst Thanks! It works."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 1540, "user_id": 2606171, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4ncy.png?s=128&g=1", "display_name": "belst", "link": "https://stackoverflow.com/users/2606171/belst"}, "edited": false, "score": 0, "creation_date": 1558713615, "post_id": 56295794, "comment_id": 99204529, "body": "@belst make that an answer, please?"}], "answers": [{"tags": [], "owner": {"reputation": 1540, "user_id": 2606171, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4ncy.png?s=128&g=1", "display_name": "belst", "link": "https://stackoverflow.com/users/2606171/belst"}, "is_accepted": true, "score": 0, "last_activity_date": 1558724815, "last_edit_date": 1558724815, "creation_date": 1558716918, "answer_id": 56296749, "question_id": 56295794, "link": "https://stackoverflow.com/questions/56295794/how-can-i-print-self-using-the-debug-formatter-in-a-traits-default-method/56296749#56296749", "title": "How can I print `self` using the Debug formatter in a trait&#39;s default method?", "body": "<p>You need to constrict your trait to types that implement <code>Debug</code>.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub trait SaySomething: std::fmt::Debug {\n    fn say(&amp;self) {\n        println!(\"{:?} can't speak\", self);\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 486, "user_id": 7390103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd6f9336ce4ea417426a99450ea8777c?s=128&d=identicon&r=PG&f=1", "display_name": "Spaceship222", "link": "https://stackoverflow.com/users/7390103/spaceship222"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 56296749, "answer_count": 1, "score": 0, "last_activity_date": 1558724815, "creation_date": 1558712574, "last_edit_date": 1558713374, "question_id": 56295794, "link": "https://stackoverflow.com/questions/56295794/how-can-i-print-self-using-the-debug-formatter-in-a-traits-default-method", "title": "How can I print `self` using the Debug formatter in a trait&#39;s default method?", "body": "<p>I defined a trait:</p>\n\n<pre><code>pub trait SaySomething {\n    fn say(&amp;self) {\n        println!(\"{:?} can't speak\", self);\n    }\n}\n</code></pre>\n\n<p>I get the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: `Self` doesn't implement `std::fmt::Debug`\n --&gt; src/lib.rs:3:38\n  |\n3 |         println!(\"{:?} can't speak\", self);\n  |                                      ^^^^ `Self` cannot be formatted using `{:?}` because it doesn't implement `std::fmt::Debug`\n  |\n  = help: the trait `std::fmt::Debug` is not implemented for `Self`\n  = help: consider adding a `where Self: std::fmt::Debug` bound\n  = note: required because of the requirements on the impl of `std::fmt::Debug` for `&amp;Self`\n  = note: required by `std::fmt::Debug::fmt`\n</code></pre>\n\n<p>So I tried:  </p>\n\n<pre><code>use std::fmt::Debug;\n\npub trait SaySomething {\n    fn say&lt;Self: Debug&gt;(self: &amp;Self) {\n        println!(\"{:?} can't speak\", self);\n    }\n}\n</code></pre>\n\n<p>I get the error:   </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: expected identifier, found keyword `Self`\n --&gt; src/lib.rs:4:12\n  |\n4 |     fn say&lt;Self: Debug&gt;(self: &amp;Self) {\n  |            ^^^^ expected identifier, found keyword\n\nerror[E0194]: type parameter `Self` shadows another type parameter of the same name\n --&gt; src/lib.rs:4:12\n  |\n3 | / pub trait SaySomething {\n4 | |     fn say&lt;Self: Debug&gt;(self: &amp;Self) {\n  | |            ^^^^ shadows another type parameter\n5 | |         println!(\"{:?} can't speak\", self);\n6 | |     }\n7 | | }\n  | |_- first `Self` declared here\n\nerror[E0307]: invalid method receiver type: &amp;Self\n --&gt; src/lib.rs:4:31\n  |\n4 |     fn say&lt;Self: Debug&gt;(self: &amp;Self) {\n  |                               ^^^^^\n  |\n  = note: type must be `Self` or a type that dereferences to it\n  = help: consider changing to `self`, `&amp;self`, `&amp;mut self`, or `self: Box&lt;Self&gt;`\n</code></pre>\n"}, {"tags": ["file-io", "rust", "borrow-checker"], "comments": [{"owner": {"reputation": 667, "user_id": 981403, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/PrBma.png?s=128&g=1", "display_name": "Mazeryt", "link": "https://stackoverflow.com/users/981403/mazeryt"}, "edited": false, "score": 0, "creation_date": 1558712921, "post_id": 56295687, "comment_id": 99204172, "body": "I saw that post, but I cannot figure out base on how to fix my code. I was trying to use some match expression but is still the same issue :( Should I introduce Box here to wrap the line?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1558713045, "post_id": 56295687, "comment_id": 99204240, "body": "<code>Option::unwrap</code> consumes the <code>Option</code>. Use <code>Option::as_ref</code>: <code>line.as_ref().unwrap().starts_with(&quot;#&quot;)</code>. <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2bd7fa8bd8a55a9efb076b7cdad86b17\" rel=\"nofollow noreferrer\">The duplicate applied to your question</a>."}, {"owner": {"reputation": 667, "user_id": 981403, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/PrBma.png?s=128&g=1", "display_name": "Mazeryt", "link": "https://stackoverflow.com/users/981403/mazeryt"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1558713457, "post_id": 56295687, "comment_id": 99204437, "body": "You right, I used stupidly it on the BufReader instead of the line. Need to get a better understanding of this interface."}], "owner": {"reputation": 667, "user_id": 981403, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/PrBma.png?s=128&g=1", "display_name": "Mazeryt", "link": "https://stackoverflow.com/users/981403/mazeryt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "closed_date": 1558713820, "answer_count": 0, "score": 1, "last_activity_date": 1558713522, "creation_date": 1558712077, "last_edit_date": 1558713071, "question_id": 56295687, "link": "https://stackoverflow.com/questions/56295687/how-do-i-read-lines-from-a-file-while-skipping-those-matching-a-certain-pattern", "closed_reason": "Duplicate", "title": "How do I read lines from a file while skipping those matching a certain pattern?", "body": "<p>I want to read a file line by line: </p>\n\n<ul>\n<li>Skip lines that start with <code>'#'</code>    </li>\n<li>Print (or otherwise use them a.k.a. borrow) if they don't start with '#'    </li>\n</ul>\n\n<p>I tried two different ways and I don't think I understand Rust enough to write it properly.</p>\n\n<h2>Approach 1</h2>\n\n<p>I got the file to the <code>BufReader</code>, and also get <code>BufReader</code> via reference using <code>by_ref</code>.</p>\n\n<p>My problem is that I don't know how to say \"I don't want to modify the line just read the first byte\". I also tried a byte representation of the string, but it looks ugly for the code example</p>\n\n<pre><code>use std::{\n    fs::File,\n    io::{self, BufRead, BufReader, Read},\n};\n\nfn main() -&gt; io::Result&lt;()&gt; {\n    let fname = \"/etc/hosts\";\n\n    let file = File::open(fname)?;\n    let mut br = BufReader::new(file);\n    for line in br.by_ref().lines() {\n        if line.unwrap().starts_with(\"#\") {\n            continue;\n        }\n        println!(\"{}\", line?);\n    }\n\n    Ok(())\n}\n</code></pre>\n\n<p>The compiler response is every time: \"I cannot give you the line as it is already moved for check...\".</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0382]: use of moved value: `line`\n  --&gt; src/main.rs:15:24\n   |\n11 |     for line in br.by_ref().lines() {\n   |         ---- move occurs because `line` has type `std::result::Result&lt;std::string::String, std::io::Error&gt;`, which does not implement the `Copy` trait\n12 |         if line.unwrap().starts_with(\"#\") {\n   |            ---- value moved here\n...\n15 |         println!(\"{}\", line?);\n   |                        ^^^^ value used here after move\n</code></pre>\n\n<h2>Approach 2</h2>\n\n<p>I thought I can use a filter. I didn't want to go this way, as most the people with more sequential programming habits do not like to use functional patterns for such operations like file operations. We prefer to control buffer sizes, and when what happen, and functional approaches usually make it much more difficult.</p>\n\n<p>I thought I should post that I know that this can be done in a functional way, but after I wrote and run it runs out that is the same problem...</p>\n\n<pre><code>use std::{\n    fs::File,\n    io::{self, BufRead, BufReader},\n};\n\nfn main() -&gt; io::Result&lt;()&gt; {\n    let fname = \"/etc/hosts\";\n\n    let file = File::open(fname)?;\n    let lines: io::Result&lt;std::string::String&gt; = BufReader::new(file)\n        .lines()\n        .filter(|x| x.unwrap().starts_with('#'))\n        .collect();\n\n    for line in lines {\n        println!(\"{}\", line);\n    }\n\n    Ok(())\n}\n</code></pre>\n\n<p>I got an error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0507]: cannot move out of borrowed content\n  --&gt; src/main.rs:12:21\n   |\n12 |         .filter(|x| x.unwrap().starts_with('#'))\n   |                     ^ cannot move out of borrowed content\n</code></pre>\n\n<p>Changing the lambda argument <code>x</code> to a reference will cause borrowing which will cause another response from the compiler: <code>cannot move out of borrowed content</code>.</p>\n\n<p>Is there any easy way to write such patterns without copying value every time? </p>\n"}, {"tags": ["rust", "substrate"], "comments": [{"owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "edited": false, "score": 1, "creation_date": 1558706884, "post_id": 56294285, "comment_id": 99201082, "body": "@turbulencetoo ,nope, I already checked on it: <a href=\"https://doc.rust-lang.org/std/prelude/index.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/std/prelude/index.html</a> , there is no <code>Log</code> there"}, {"owner": {"reputation": 2966, "user_id": 3022310, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7f10ec2b45320ee843e539d705c31d08?s=128&d=identicon&r=PG", "display_name": "turbulencetoo", "link": "https://stackoverflow.com/users/3022310/turbulencetoo"}, "edited": false, "score": 0, "creation_date": 1558707026, "post_id": 56294285, "comment_id": 99201166, "body": "well that&#39;s <code>std::prelude</code>, which is not <code>rstd:prelude</code>... I cant find a log in either one though"}, {"owner": {"reputation": 2966, "user_id": 3022310, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7f10ec2b45320ee843e539d705c31d08?s=128&d=identicon&r=PG", "display_name": "turbulencetoo", "link": "https://stackoverflow.com/users/3022310/turbulencetoo"}, "edited": false, "score": 0, "creation_date": 1558707127, "post_id": 56294285, "comment_id": 99201233, "body": "<a href=\"https://github.com/paritytech/substrate/blob/master/core/sr-std/src/lib.rs\" rel=\"nofollow noreferrer\">github.com/paritytech/substrate/blob/master/core/sr-std/src/&zwnj;&#8203;&hellip;</a>"}, {"owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "reply_to_user": {"reputation": 2966, "user_id": 3022310, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7f10ec2b45320ee843e539d705c31d08?s=128&d=identicon&r=PG", "display_name": "turbulencetoo", "link": "https://stackoverflow.com/users/3022310/turbulencetoo"}, "edited": false, "score": 0, "creation_date": 1558707170, "post_id": 56294285, "comment_id": 99201258, "body": "@turbulencetoo , do you know how to <code>--pretty</code> expand to all levels ? not just first level? maybe thats the problem"}, {"owner": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "edited": false, "score": 0, "creation_date": 1558872686, "post_id": 56294285, "comment_id": 99236115, "body": "It appears to be defined by <code>construct_runtime!</code> - if you go to the macro declaration, the output has <code>enum Log</code> in it. I don&#39;t know how to get the compiler to expand the code out to that point, however."}, {"owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "reply_to_user": {"reputation": 1602, "user_id": 5947247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5212b96ae435bb73b9980f34b2913e8?s=128&d=identicon&r=PG&f=1", "display_name": "Isaac van Bakel", "link": "https://stackoverflow.com/users/5947247/isaac-van-bakel"}, "edited": false, "score": 0, "creation_date": 1558880050, "post_id": 56294285, "comment_id": 99237732, "body": "@IsaacvanBakel , it is actually seen when doing <code>cargo expand</code> , I don&#39;t know how did I miss it the first time, it is defined as <code>pub struct Log(InternalLog);</code>"}, {"owner": {"reputation": 9375, "user_id": 1396977, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PylBh.jpg?s=128&g=1", "display_name": "Shawn Tabrizi", "link": "https://stackoverflow.com/users/1396977/shawn-tabrizi"}, "edited": false, "score": 0, "creation_date": 1558963992, "post_id": 56294285, "comment_id": 99261815, "body": "@Nulik maybe you want to answer your own question then?"}], "answers": [{"tags": [], "owner": {"reputation": 42460, "user_id": 642626, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/fedc5e6b7fef29a8b539e20da8c85971?s=128&d=identicon&r=PG", "display_name": "Bryan Chen", "link": "https://stackoverflow.com/users/642626/bryan-chen"}, "is_accepted": true, "score": 2, "last_activity_date": 1559006647, "creation_date": 1559006647, "answer_id": 56333985, "question_id": 56294285, "link": "https://stackoverflow.com/questions/56294285/where-is-the-type-log-defined-inside-of-the-substrate-runtime-crate/56333985#56333985", "title": "Where is the type Log defined inside of the Substrate runtime crate?", "body": "<p><code>Log</code> is defined by <code>construct_runtime</code> macro.\nHere are some relevant code:</p>\n\n<p><code>construct_runtime</code> macro:</p>\n\n<p><a href=\"https://github.com/paritytech/substrate/blob/950e90e75dc7d16dcf99972fcc733945a832dc3e/srml/support/src/runtime.rs#L79\" rel=\"nofollow noreferrer\">https://github.com/paritytech/substrate/blob/950e90e75dc7d16dcf99972fcc733945a832dc3e/srml/support/src/runtime.rs#L79</a></p>\n\n<pre><code>macro_rules! construct_runtime {\n    (\n        pub enum $runtime:ident with Log ($log_internal:ident: DigestItem&lt;$( $log_genarg:ty ),+&gt;)\n            where\n                Block = $block:ident,\n                NodeBlock = $node_block:ty,\n                UncheckedExtrinsic = $uncheckedextrinsic:ident\n        {\n            $( $rest:tt )*\n        }\n    )\n</code></pre>\n\n<p>calling <code>__decl_outer_log</code></p>\n\n<p><a href=\"https://github.com/paritytech/substrate/blob/950e90e75dc7d16dcf99972fcc733945a832dc3e/srml/support/src/runtime.rs#L267\" rel=\"nofollow noreferrer\">https://github.com/paritytech/substrate/blob/950e90e75dc7d16dcf99972fcc733945a832dc3e/srml/support/src/runtime.rs#L267</a></p>\n\n<pre><code>    $crate::__decl_outer_log!(\n        $runtime;\n        $log_internal &lt; $( $log_genarg ),* &gt;;\n        {};\n        $(\n            $name: $module:: $( &lt; $module_instance &gt;:: )? { $( $modules $( ( $( $modules_args )* ) )* )* }\n        )*\n    );\n</code></pre>\n\n<p><code>__decl_outer_log</code> macro</p>\n\n<p><a href=\"https://github.com/paritytech/substrate/blob/950e90e75dc7d16dcf99972fcc733945a832dc3e/srml/support/src/runtime.rs#L706\" rel=\"nofollow noreferrer\">https://github.com/paritytech/substrate/blob/950e90e75dc7d16dcf99972fcc733945a832dc3e/srml/support/src/runtime.rs#L706</a></p>\n\n<pre><code>macro_rules! __decl_outer_log {\n    (\n        $runtime:ident;\n        $log_internal:ident &lt;$( $log_genarg:ty ),+&gt;;\n        { $( $parsed:tt )* };\n        $name:ident: $module:ident:: $(&lt;$module_instance:ident&gt;::)? {\n            Log ( $( $args:ident )* ) $( $modules:ident $( ( $( $modules_args:ident )* ) )* )*\n        }\n        $( $rest:tt )*\n    ) =&gt; {\n</code></pre>\n\n<p>calling <code>impl_outer_log</code></p>\n\n<p><a href=\"https://github.com/paritytech/substrate/blob/950e90e75dc7d16dcf99972fcc733945a832dc3e/srml/support/src/runtime.rs#L763\" rel=\"nofollow noreferrer\">https://github.com/paritytech/substrate/blob/950e90e75dc7d16dcf99972fcc733945a832dc3e/srml/support/src/runtime.rs#L763</a></p>\n\n<pre><code>(\n    $runtime:ident;\n    $log_internal:ident &lt;$( $log_genarg:ty ),+&gt;;\n    { $(\n        $parsed_modules:ident $(&lt; $parsed_instance:ident &gt;)? ( $( $parsed_args:ident )* )\n    )* };\n) =&gt; {\n    $crate::paste::item! {\n        $crate::runtime_primitives::impl_outer_log!(\n            pub enum Log($log_internal: DigestItem&lt;$( $log_genarg ),*&gt;) for $runtime {\n                $( [&lt; $parsed_modules $(_ $parsed_instance)? &gt;] $(&lt; $parsed_modules::$parsed_instance &gt;)? ( $( $parsed_args ),* ) ),*\n            }\n        );\n    }\n};\n</code></pre>\n\n<p><code>impl_outer_log</code> macro:\n<a href=\"https://github.com/paritytech/substrate/blob/950e90e75dc7d16dcf99972fcc733945a832dc3e/core/sr-primitives/src/lib.rs#L630\" rel=\"nofollow noreferrer\">https://github.com/paritytech/substrate/blob/950e90e75dc7d16dcf99972fcc733945a832dc3e/core/sr-primitives/src/lib.rs#L630</a></p>\n\n<pre><code>macro_rules! impl_outer_log {\n    (\n        $(#[$attr:meta])*\n        pub enum $name:ident ($internal:ident: DigestItem&lt;$( $genarg:ty ),*&gt;) for $trait:ident {\n            $( $module:ident $(&lt;$instance:path&gt;)? ( $( $sitem:ident ),* ) ),*\n        }\n    )\n</code></pre>\n\n<p>which actually declare and implement the <code>Log</code> struct</p>\n\n<p>You should be able to see the result when <code>cargo expand</code> the runtime crate.</p>\n"}], "owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 56333985, "answer_count": 1, "score": 1, "last_activity_date": 1559006647, "creation_date": 1558706674, "last_edit_date": 1558707297, "question_id": 56294285, "link": "https://stackoverflow.com/questions/56294285/where-is-the-type-log-defined-inside-of-the-substrate-runtime-crate", "title": "Where is the type Log defined inside of the Substrate runtime crate?", "body": "<p>Take a look at <a href=\"https://github.com/paritytech/substrate/blob/79dd9c83027495107509b700057d04577a2ea242/node/runtime/src/lib.rs#L124-L131\" rel=\"nofollow noreferrer\">this implementation</a>:</p>\n\n<pre><code>impl consensus::Trait for Runtime {\n    type Log = Log;\n    type SessionKey = AuthorityId;\n\n    // The Aura module handles offline-reports internally\n    // rather than using an explicit report system.\n    type InherentOfflineReport = ();\n}\n</code></pre>\n\n<p>How is <code>Log</code> defined? There is no <code>use</code> clause for importing this symbol.  </p>\n\n<p>Running</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cargo rustc -- -Z unstable-options --pretty=expanded\n</code></pre>\n\n<p>does not show any <code>Log</code> entry with <code>type</code> clause. It does show other macro declarations after expanding macros at level 0, but I am not sure if this relevant.</p>\n\n<p>I tried using the Atom IDE because it automatically parses the files and lets you find the definition of the symbols, but it did not help.</p>\n\n<p>How can I find how <code>Log</code> is defined?</p>\n"}, {"tags": ["rust", "traits"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1558684264, "post_id": 56288073, "comment_id": 99188872, "body": "Probably dupe of <a href=\"https://stackoverflow.com/questions/45898130/trait-specialization\" title=\"trait specialization\">stackoverflow.com/questions/45898130/trait-specialization</a>"}, {"owner": {"reputation": 6932, "user_id": 774236, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/7e46879a230ff1e28cd975e3b0a0873b?s=128&d=identicon&r=PG", "display_name": "Matteo Monti", "link": "https://stackoverflow.com/users/774236/matteo-monti"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1558685651, "post_id": 56288073, "comment_id": 99189529, "body": "That question seems to address the question &quot;why doesn&#39;t it work?&quot;, but not the question &quot;is it possible to do such a thing?&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 6932, "user_id": 774236, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/7e46879a230ff1e28cd975e3b0a0873b?s=128&d=identicon&r=PG", "display_name": "Matteo Monti", "link": "https://stackoverflow.com/users/774236/matteo-monti"}, "edited": false, "score": 0, "creation_date": 1558687564, "post_id": 56288642, "comment_id": 99190576, "body": "I see. Interesting! Is there an estimate on how long it could take for <code>specialization</code> to make it into stable Rust? Does your answer imply that it is impossible to do the same thing in stable Rust?"}, {"owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "reply_to_user": {"reputation": 6932, "user_id": 774236, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/7e46879a230ff1e28cd975e3b0a0873b?s=128&d=identicon&r=PG", "display_name": "Matteo Monti", "link": "https://stackoverflow.com/users/774236/matteo-monti"}, "edited": false, "score": 0, "creation_date": 1558696054, "post_id": 56288642, "comment_id": 99195099, "body": "As for the timeline, that is what the tracking issue is for. It&#39;s more than three years old and the remaining issues don&#39;t look easy, so I wouldn&#39;t hold my breath."}], "tags": [], "owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "is_accepted": false, "score": 2, "last_activity_date": 1558687825, "last_edit_date": 1558687825, "creation_date": 1558686439, "answer_id": 56288642, "question_id": 56288073, "link": "https://stackoverflow.com/questions/56288073/is-it-theoretically-possible-to-specialise-trait-behaviour/56288642#56288642", "title": "Is it theoretically possible to specialise trait behaviour?", "body": "<p>It is possible on <code>nightly</code> with the still unstable <code>specialization</code> feature and a <code>default</code> implementation (see also <a href=\"https://github.com/rust-lang/rust/issues/31844\" rel=\"nofollow noreferrer\">the tracking issue for specialization</a>):</p>\n\n<pre><code>#![feature(specialization)]\n\ntrait DoIt {\n    fn do_it(&amp;self);\n}\n\nimpl&lt;T&gt; DoIt for T\nwhere\n    T: CanDo,\n{\n    default fn do_it(&amp;self) {\n        self.do_impl()\n    }\n}\n\nimpl&lt;T&gt; DoIt for T\nwhere\n    T: CanDoQuickly,\n{\n    fn do_it(&amp;self) {\n        self.do_quickly_impl()\n    }\n}\n\ntrait CanDo {\n    fn do_impl(&amp;self) {\n        println!(\"slowly\");\n    }\n}\n\ntrait CanDoQuickly: CanDo {\n    fn do_quickly_impl(&amp;self) {\n        println!(\"quickly\");\n    }\n}\n\nstruct S1;\nimpl CanDo for S1 {}\nimpl CanDoQuickly for S1 {}\n\nstruct S2;\nimpl CanDo for S2 {}\n\nfn main() {\n    S1.do_it();\n    S2.do_it();\n}\n</code></pre>\n"}], "owner": {"reputation": 6932, "user_id": 774236, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/7e46879a230ff1e28cd975e3b0a0873b?s=128&d=identicon&r=PG", "display_name": "Matteo Monti", "link": "https://stackoverflow.com/users/774236/matteo-monti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1558687825, "creation_date": 1558684128, "question_id": 56288073, "link": "https://stackoverflow.com/questions/56288073/is-it-theoretically-possible-to-specialise-trait-behaviour", "title": "Is it theoretically possible to specialise trait behaviour?", "body": "<p>Consider the following scenario:</p>\n\n<ul>\n<li>I want to implement a trait <code>Do</code> on all the types that implement a trait <code>CanDo</code>. </li>\n<li>Out of the types that <code>CanDo</code>, some implement a trait <code>CanDoQuickly</code>.</li>\n<li>I would like <code>Do</code> to be implemented in one way for those types that <code>CanDo</code>, but not <code>CanDoQuickly</code>, and in another way for those types that <code>CanDoQuickly</code>.</li>\n</ul>\n\n<p>I know that, in Rust, we have no negative trait bounds. My intuition is that we should probably be able to use opt-in built-in to achieve this (although, I did try unsuccessfully).</p>\n\n<p>I am wondering if it is at all possible, no matter the complexity of the code, to achieve what I would like to do on stable Rust. If not, is it a design choice? Is it inherently bad to want to do something like this? It sounds like such a common problem to me that I'd be very surprised to find out it's a deprecated practice.</p>\n"}, {"tags": ["rust", "borrow-checker", "borrowing", "borrow"], "comments": [{"owner": {"reputation": 183, "user_id": 5019531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21b6a4e99e6e1b47d32090ad238de5de?s=128&d=identicon&r=PG&f=1", "display_name": "Pavel Arnold", "link": "https://stackoverflow.com/users/5019531/pavel-arnold"}, "edited": false, "score": 3, "creation_date": 1558649741, "post_id": 56282982, "comment_id": 99181103, "body": "Writing <code>self.homotopy_problem</code> in closure causes whole self being borrowed. By creating temporary value <code>let problem = &amp;self.homotopy_problem;</code> and using it instead should solve the problem"}, {"owner": {"reputation": 1837, "user_id": 613016, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/o3Ywp.jpg?s=128&g=1", "display_name": "Pantelis Sopasakis", "link": "https://stackoverflow.com/users/613016/pantelis-sopasakis"}, "reply_to_user": {"reputation": 183, "user_id": 5019531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21b6a4e99e6e1b47d32090ad238de5de?s=128&d=identicon&r=PG&f=1", "display_name": "Pavel Arnold", "link": "https://stackoverflow.com/users/5019531/pavel-arnold"}, "edited": false, "score": 0, "creation_date": 1558650055, "post_id": 56282982, "comment_id": 99181179, "body": "@PavelArnold Thank you very much for your answer! Indeed, this solved the problem, but I don&#39;t quite understand why. So you&#39;re saying that using <code>self.homotopy_problem</code> lends <code>self</code> to the closure? Shouldn&#39;t it just lend <code>homotopy_problem</code>? If you would like to write an answer, I will be able to upvote and accept it."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1558697783, "post_id": 56282982, "comment_id": 99196062, "body": "It&#39;s a bit hard to answer your question because it doesn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. <b>Minimize</b> your problem. It would make it much easier for us to help if you try to reproduce your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> if possible, otherwise in a brand new Cargo project, then <a href=\"https://stackoverflow.com/posts/56282982/edit\">edit</a> your question to include the additional info. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MCVE tips</a> you can use to reduce your original code for posting here. Thanks!"}, {"owner": {"reputation": 1837, "user_id": 613016, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/o3Ywp.jpg?s=128&g=1", "display_name": "Pantelis Sopasakis", "link": "https://stackoverflow.com/users/613016/pantelis-sopasakis"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1558699472, "post_id": 56282982, "comment_id": 99196909, "body": "@Shepmaster Thank you, but it has already been answered by Pavel Arnold above."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1558699767, "post_id": 56282982, "comment_id": 99197088, "body": "My point is that if you had produced the minimal example to start with, you would have been <i>much</i> more likely to find one of the duplicates of this question, solving your own problem."}, {"owner": {"reputation": 1837, "user_id": 613016, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/o3Ywp.jpg?s=128&g=1", "display_name": "Pantelis Sopasakis", "link": "https://stackoverflow.com/users/613016/pantelis-sopasakis"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1558700035, "post_id": 56282982, "comment_id": 99197248, "body": "@Shepmaster you&#39;re right; since this is a duplicate, should I delete it?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1558700165, "post_id": 56282982, "comment_id": 99197303, "body": "Duplicate questions are not bad; they serve as signposts to canonical answers. If someone else searches for the same terms that you used in your post, they will be redirected to the appropriate answer."}], "owner": {"reputation": 1837, "user_id": 613016, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/o3Ywp.jpg?s=128&g=1", "display_name": "Pantelis Sopasakis", "link": "https://stackoverflow.com/users/613016/pantelis-sopasakis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 0, "closed_date": 1558697903, "answer_count": 0, "score": 0, "last_activity_date": 1558697951, "creation_date": 1558645851, "last_edit_date": 1558697825, "question_id": 56282982, "link": "https://stackoverflow.com/questions/56282982/borrowing-move-field-seems-to-move-the-whole-structure", "closed_reason": "Duplicate", "title": "Borrowing/move field seems to move the whole structure", "body": "<p>I'm facing a problem where I have a structure (called <code>HomotopyOptimizer</code>) which has a number of fields (some are borrowed). In <code>HomotopyOptimizer</code> there is a method with argument <code>&amp;self mut</code>. </p>\n\n<p>What I do is that I take some of the fields of my structure and either borrow them to other functions or move their ownership because I will not be needing them further. </p>\n\n<p>Let me describe the situation with a graphic (I'll provide the code at the end): </p>\n\n<p><a href=\"https://i.stack.imgur.com/xNmQ2.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xNmQ2.png\" alt=\"Borrow checker issue\"></a></p>\n\n<p>My <code>HomotopyOptimizer</code> has two fields: (i) one of type <code>HomotopyProblem</code> and (ii) one of type <code>&amp;Cache</code>.</p>\n\n<p>These, in turn are structures with certain fields. In particular, the <code>HomotopyProblem</code> field has three fields.</p>\n\n<p>I need to construct a structure of type <code>Problem</code> using the fields of <code>HomotopyProblem</code> and by <strong>borrowing</strong> the field of type <code>Cache</code> from <code>self</code>, however, Rust complains that I cannot borrow it because <strong>self</strong> itself has been borrowed previously (or at least it seems so).</p>\n\n<p>My main question is whether I can move the ownership of fields of a structure without moving or lending the structure itself. </p>\n\n<hr/>\n\n<p>Let me present my code in reverse order. First the function in which I get the compilation error:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl&lt;'cache_lifetime, \n     ParametricPenaltyFunctionType, \n     ParametricGradientType, \n     ConstraintType, ParametricCostType&gt;\n    HomotopyOptimizer&lt;...same_as_above...&gt;\nwhere\n    ParametricPenaltyFunctionType: Fn(&amp;[f64], &amp;[f64], &amp;mut [f64]) -&gt; Result&lt;(), Error&gt;,\n    ParametricGradientType: Fn(&amp;[f64], &amp;[f64], &amp;mut [f64]) -&gt; Result&lt;(), Error&gt;,\n    ParametricCostType: Fn(&amp;[f64], &amp;[f64], &amp;mut f64) -&gt; Result&lt;(), Error&gt;,\n    ConstraintType: constraints::Constraint,\n{\n\n    pub fn solve(&amp;'cache_lifetime mut self, u: &amp;mut [f64]) {\n        let p_ = [1., 2., 3.];\n\n        let f_ = |u: &amp;[f64], cost: &amp;mut f64| -&gt; Result&lt;(), Error&gt; {\n            (self.homotopy_problem.parametric_cost)(u, &amp;p_, cost)\n        };\n        let df_ = |u: &amp;[f64], grad: &amp;mut [f64]| -&gt; Result&lt;(), Error&gt; {\n            (self.homotopy_problem.parametric_gradient)(u, &amp;p_, grad)\n        };\n        let problem_ = Problem::new(&amp;self.homotopy_problem.constraints, df_, f_);\n\n        let mut panoc_ = panoc::Optimizer::new(problem_, &amp;mut self.panoc_cache);\n        panoc_.solve(u);\n        println!(\"u = {:#?}\", u);\n    }\n}\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Compiling optimization_engine v0.3.1 (/home/chung/NetBeansProjects/RUST/optimization-engine)\nerror[E0502]: cannot borrow `self.panoc_cache` as mutable because it is also borrowed as immutable\n  --&gt; src/continuation/homotopy_optimizer.rs:83:63\n   |\n75 |         let f_ = |u: &amp;[f64], cost: &amp;mut f64| -&gt; Result&lt;(), Error&gt; {\n   |                  ------------------------------------------------ immutable borrow occurs here\n76 |             (self.homotopy_problem.parametric_cost)(u, &amp;p_, cost)\n   |              ---- first borrow occurs due to use of `self` in closure\n...\n83 |         let mut panoc_ = panoc::Optimizer::new(problem_, &amp;mut self.panoc_cache);\n   |                          --------------------------           ^^^^^^^^^^^^^^^^^^^^^ mutable borrow occurs here\n   |                          |\n   |                          immutable borrow later used by call\n\nerror: aborting due to previous error\n\nFor more information about this error, try `rustc --explain E0502`.\nerror: Could not compile `optimization_engine`.\nwarning: build failed, waiting for other jobs to finish...\nerror[E0502]: cannot borrow `self.panoc_cache` as mutable because it is also borrowed as immutable\n  --&gt; src/continuation/homotopy_optimizer.rs:83:63\n   |\n75 |         let f_ = |u: &amp;[f64], cost: &amp;mut f64| -&gt; Result&lt;(), Error&gt; {\n   |                  ------------------------------------------------ immutable borrow occurs here\n76 |             (self.homotopy_problem.parametric_cost)(u, &amp;p_, cost)\n   |              ---- first borrow occurs due to use of `self` in closure\n...\n83 |         let mut panoc_ = panoc::Optimizer::new(problem_, &amp;mut self.panoc_cache);\n   |                          --------------------------           ^^^^^^^^^^^^^^^^^^^^^ mutable borrow occurs here\n   |                          |\n   |                          immutable borrow later used by call\n\nerror: aborting due to previous error\n\nFor more information about this error, try `rustc --explain E0502`.\nerror: Could not compile `optimization_engine`.\n</code></pre>\n\n<hr/>\n\n<p>For completeness: The definition of <strong>HomotopyOptimizer</strong> is </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct HomotopyOptimizer&lt;\n    'cache_lifetime,\n    ParametricPenaltyFunctionType,\n    ParametricGradientType,\n    ConstraintType,\n    ParametricCostType,\n&gt; where\n    ParametricPenaltyFunctionType: Fn(&amp;[f64], &amp;[f64], &amp;mut [f64]) -&gt; Result&lt;(), Error&gt;,\n    ParametricGradientType: Fn(&amp;[f64], &amp;[f64], &amp;mut [f64]) -&gt; Result&lt;(), Error&gt;,\n    ParametricCostType: Fn(&amp;[f64], &amp;[f64], &amp;mut f64) -&gt; Result&lt;(), Error&gt;,\n    ConstraintType: constraints::Constraint,\n{\n    homotopy_problem: HomotopyProblem&lt;\n        ParametricPenaltyFunctionType,\n        ParametricGradientType,\n        ConstraintType,\n        ParametricCostType,\n    &gt;,\n    panoc_cache: &amp;'cache_lifetime mut panoc::Cache,\n}\n</code></pre>\n\n<p>and its constructor is </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn new(\n        homotopy_problem: HomotopyProblem&lt;\n            ParametricPenaltyFunctionType,\n            ParametricGradientType,\n            ConstraintType,\n            ParametricCostType,\n        &gt;,\n        panoc_cache: &amp;'cache_lifetime mut panoc::PANOCCache,\n    ) -&gt; HomotopyOptimizer&lt;\n        ParametricPenaltyFunctionType,\n        ParametricGradientType,\n        ConstraintType,\n        ParametricCostType,\n    &gt; {\n        HomotopyOptimizer {\n            homotopy_problem: homotopy_problem,\n            panoc_cache: panoc_cache,\n        }\n    }\n</code></pre>\n\n<p>The definition of <strong>HomotopyProblem</strong> is </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct HomotopyProblem&lt;\n    ParametricPenaltyFunctionType,\n    ParametricGradientType,\n    ConstraintType,\n    ParametricCostType,\n&gt; where\n    ParametricPenaltyFunctionType: Fn(&amp;[f64], &amp;[f64], &amp;mut [f64]) -&gt; Result&lt;(), Error&gt;,\n    ParametricGradientType: Fn(&amp;[f64], &amp;[f64], &amp;mut [f64]) -&gt; Result&lt;(), Error&gt;,\n    ParametricCostType: Fn(&amp;[f64], &amp;[f64], &amp;mut f64) -&gt; Result&lt;(), Error&gt;,\n    ConstraintType: constraints::Constraint,\n{\n    pub(crate) constraints: ConstraintType,\n    pub(crate) parametric_gradient: ParametricGradientType,\n    pub(crate) parametric_cost: ParametricCostType,\n    pub(crate) penalty_function: ParametricPenaltyFunctionType,\n    idx: Vec&lt;usize&gt;,\n    from: Vec&lt;f64&gt;,\n    to: Vec&lt;f64&gt;,\n    transition_mode: Vec&lt;i32&gt;,\n    num_parameters: usize,\n}\n</code></pre>\n\n<p>and its constructor is </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn new(\n        constraints: ConstraintType,\n        parametric_gradient: ParametricGradientType,\n        parametric_cost: ParametricCostType,\n        penalty_function: ParametricPenaltyFunctionType,\n        num_parameters: usize,\n    ) -&gt; HomotopyProblem&lt;\n        ParametricPenaltyFunctionType,\n        ParametricGradientType,\n        ConstraintType,\n        ParametricCostType,\n    &gt; {\n        HomotopyProblem {\n            constraints: constraints,\n            parametric_gradient: parametric_gradient,\n            parametric_cost: parametric_cost,\n            penalty_function: penalty_function,\n            idx: Vec::new(),\n            from: Vec::new(),\n            to: Vec::new(),\n            transition_mode: Vec::new(),\n            num_parameters: num_parameters,\n        }\n    }\n</code></pre>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 2, "creation_date": 1558635785, "post_id": 56280851, "comment_id": 99175820, "body": "How about <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=release&amp;edition=2018&amp;gist=3f571eba4117238a923039489c8b9964\" rel=\"nofollow noreferrer\">even bigger <code>x</code></a>?"}], "tags": [], "owner": {"reputation": 5926, "user_id": 1994377, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/TegVp.jpg?s=128&g=1", "display_name": "Sarien", "link": "https://stackoverflow.com/users/1994377/sarien"}, "is_accepted": false, "score": 0, "last_activity_date": 1558635244, "creation_date": 1558635244, "answer_id": 56280851, "question_id": 56280747, "link": "https://stackoverflow.com/questions/56280747/how-do-i-convert-a-rust-numeric-type-but-only-if-it-fits/56280851#56280851", "title": "How do I convert a Rust numeric type but only if it fits?", "body": "<p>Okay, found the answer, there is <a href=\"https://doc.rust-lang.org/std/convert/trait.TryFrom.html\" rel=\"nofollow noreferrer\">TryFrom</a>.</p>\n\n<pre><code>use std::convert::TryFrom;\n\nu64::try_from(2u128.pow(x)).expect(\"Number too big for cast.\")\n</code></pre>\n\n<p>from <a href=\"https://stackoverflow.com/questions/28273169/how-do-i-convert-between-numeric-types-safely-and-idiomatically\">here</a> which I somehow missed with my first search.</p>\n"}, {"comments": [{"owner": {"reputation": 5926, "user_id": 1994377, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/TegVp.jpg?s=128&g=1", "display_name": "Sarien", "link": "https://stackoverflow.com/users/1994377/sarien"}, "edited": false, "score": 0, "creation_date": 1558637716, "post_id": 56281187, "comment_id": 99176661, "body": "tbh I am kind of disappointed that pow() isn&#39;t checked. Where are the safe defaults, damnit? Thank, you! Good catch!"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 5926, "user_id": 1994377, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/TegVp.jpg?s=128&g=1", "display_name": "Sarien", "link": "https://stackoverflow.com/users/1994377/sarien"}, "edited": false, "score": 1, "creation_date": 1558639543, "post_id": 56281187, "comment_id": 99177447, "body": "@Sarien Rust aims to be a performant language, and tries not to force overhead on you if you don&#39;t want it. When running in debug mode, <code>pow()</code> will panic on overflow, but in release mode it is unchecked. This isn&#39;t considered &quot;unsafe&quot; in the Rust sense of the word, since it can&#39;t trigger undefined behaviour. If you want the check in release mode, you can still use <code>checked_pow()</code>."}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 1, "creation_date": 1558643449, "post_id": 56281187, "comment_id": 99178969, "body": "Also, all the arithmetic operations can fail for the right pair of values. If they all returned a <code>Result</code>/<code>Option</code> rather than the behavior they have now, it would be sooooo painful to use. Consider that a simple <code>a + b*c</code> would become at least <code>(a + (b*c)?)?</code>."}, {"owner": {"reputation": 5926, "user_id": 1994377, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/TegVp.jpg?s=128&g=1", "display_name": "Sarien", "link": "https://stackoverflow.com/users/1994377/sarien"}, "edited": false, "score": 0, "creation_date": 1558677990, "post_id": 56281187, "comment_id": 99186303, "body": "On the other hand, Rust also aims to be a safe language, so maybe it should either make me think about that case or just promote to BigInt if necessary. I understand the trade-off, though."}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 1, "creation_date": 1558678465, "post_id": 56281187, "comment_id": 99186470, "body": "Or you could use directly <code>2u64.checked_pow</code>, no need to go through a 128\u202fbits value."}], "tags": [], "owner": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "is_accepted": true, "score": 4, "last_activity_date": 1558636774, "creation_date": 1558636774, "answer_id": 56281187, "question_id": 56280747, "link": "https://stackoverflow.com/questions/56280747/how-do-i-convert-a-rust-numeric-type-but-only-if-it-fits/56281187#56281187", "title": "How do I convert a Rust numeric type but only if it fits?", "body": "<p>As you correctly pointed out yourself, you should use <code>TryFrom</code>, but you should also make sure the exponentiation itself doesn't overflow, by using <a href=\"https://doc.rust-lang.org/std/primitive.u128.html#method.checked_pow\" rel=\"nofollow noreferrer\"><code>u128::checked_pow</code></a> instead of <a href=\"https://doc.rust-lang.org/std/primitive.u128.html#method.pow\" rel=\"nofollow noreferrer\"><code>u128::pow</code></a>:</p>\n\n<pre><code>use std::convert::TryFrom;\n\nlet x = 129;\nlet y = 2u128.checked_pow(x).expect(\"Number too big for exponentiation\");\nlet z = u64::try_from(y).expect(\"Number too big for cast\");\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=release&amp;edition=2018&amp;gist=b8cb051690fb937aef13118392899561\" rel=\"nofollow noreferrer\">playground link</a>)</p>\n"}], "owner": {"reputation": 5926, "user_id": 1994377, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/TegVp.jpg?s=128&g=1", "display_name": "Sarien", "link": "https://stackoverflow.com/users/1994377/sarien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "closed_date": 1558699988, "accepted_answer_id": 56281187, "answer_count": 2, "score": 3, "last_activity_date": 1558700001, "creation_date": 1558634770, "last_edit_date": 1558700001, "question_id": 56280747, "link": "https://stackoverflow.com/questions/56280747/how-do-i-convert-a-rust-numeric-type-but-only-if-it-fits", "closed_reason": "Duplicate", "title": "How do I convert a Rust numeric type but only if it fits?", "body": "<p>I want the following</p>\n\n<pre><code>(2u128.pow(x)) as u64\n</code></pre>\n\n<p>but such that it succeeds for <code>x &lt; 64</code> and fails for <code>x &gt;= 64</code>.</p>\n"}, {"tags": ["json", "rust", "bson"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1558701338, "post_id": 56280105, "comment_id": 99197927, "body": "Would it be possible for you to reduce your JSON string to a single object with a single field that demonstrates the problem? Right now, it&#39;s difficult to see exactly what it is you are asking about."}, {"owner": {"reputation": 39, "user_id": 9796851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-qHynvrlykdk/AAAAAAAAAAI/AAAAAAAAASQ/PxjlEsYj0bU/photo.jpg?sz=128", "display_name": "Matthias De Jesus Oliveira", "link": "https://stackoverflow.com/users/9796851/matthias-de-jesus-oliveira"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1558703245, "post_id": 56280105, "comment_id": 99198999, "body": "You can replace it by r#&quot;{ &quot;length&quot;:1 }&quot;# but i would keep the big one for demonstrate that the issue can&#39;t be resolved with a struct with serialize/deserialize"}], "owner": {"reputation": 39, "user_id": 9796851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-qHynvrlykdk/AAAAAAAAAAI/AAAAAAAAASQ/PxjlEsYj0bU/photo.jpg?sz=128", "display_name": "Matthias De Jesus Oliveira", "link": "https://stackoverflow.com/users/9796851/matthias-de-jesus-oliveira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 316, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1558713551, "creation_date": 1558631689, "last_edit_date": 1558713551, "question_id": 56280105, "link": "https://stackoverflow.com/questions/56280105/can-the-bson-or-json-crate-automatically-transform-an-unsigned-number-in-a-strin", "title": "Can the BSON or JSON crate automatically transform an unsigned number in a string to a floating number when it finds one?", "body": "<p>I have a string that I would like to transform to BSON. It works except when my body contains an attribute with a number in it. I get the error:</p>\n\n<blockquote>\n  <p>parsing was unsuccessful BSON does not support unsigned type</p>\n</blockquote>\n\n<p>I've found that I should be able to create a struct that implements <code>Serialize</code> and <code>Deserialize</code> to resolve my issue, but I don't know what is in the body of my struct (and it can change with lot of possibility).</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let bson_string = r#\"{ \"user-agent\": \"blablabla\", \"userid\": \"XXXXXXXX.XXXXXXXX\", \"session\": { \"XXXXXXX\": [{ \"body\": {\"type\":\"input\",\"payload\":{\"id\":\"email\",\"length\":1},\"url\":\"https://blablabla.com/paiement/offres/pack-simple/Y8s2cdZ1vU/auth\"}, \"origin\": \"https://blablabla.com\" }] } }\"#;\n\nlet json: Value = match serde_json::from_str(&amp;bson_string){\n    Ok(val) =&gt; val,\n    Err(err) =&gt; {\n        println!(\"from_str err: {:?}\", err);\n        serde_json::Value::Null\n    }\n};\nlet v = match mongodb::to_bson(&amp;json) {\n    Ok(val) =&gt; val,\n    Err(err) =&gt; {\n        println!(\"to_bson err: {:?}\", err);\n        mongodb::Bson::Null\n    }\n};\nv\n</code></pre>\n"}, {"tags": ["rust", "serde"], "comments": [{"owner": {"reputation": 555, "user_id": 5572146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c799e0c44a11d16cc175a717d5dca855?s=128&d=identicon&r=PG&f=1", "display_name": "chpio", "link": "https://stackoverflow.com/users/5572146/chpio"}, "edited": false, "score": 0, "creation_date": 1558630289, "post_id": 56279350, "comment_id": 99173574, "body": "That link is for ppl that want to implement a format deserializer/parser. <a href=\"https://serde.rs/deserialize-map.html\" rel=\"nofollow noreferrer\">This</a> should be what you need."}, {"owner": {"reputation": 2966, "user_id": 3022310, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7f10ec2b45320ee843e539d705c31d08?s=128&d=identicon&r=PG", "display_name": "turbulencetoo", "link": "https://stackoverflow.com/users/3022310/turbulencetoo"}, "edited": false, "score": 0, "creation_date": 1558633153, "post_id": 56279350, "comment_id": 99174811, "body": "<a href=\"https://github.com/serde-rs/json#operating-on-untyped-json-values\" rel=\"nofollow noreferrer\">github.com/serde-rs/json#operating-on-untyped-json-values</a>"}], "answers": [{"tags": [], "owner": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "is_accepted": true, "score": 2, "last_activity_date": 1558637232, "creation_date": 1558637232, "answer_id": 56281271, "question_id": 56279350, "link": "https://stackoverflow.com/questions/56279350/how-to-get-at-one-particular-item-in-json-file-using-serde-json-without-deriving/56281271#56281271", "title": "How to get at one particular item in JSON file using serde_json without deriving structs?", "body": "<p><code>serde_json</code> provides types for generic JSON values with <a href=\"https://docs.serde.rs/serde_json/value/enum.Value.htmlb\" rel=\"nofollow noreferrer\"><code>serde_json::Value</code></a>:</p>\n\n<pre><code>use serde_json::Value;\n\n// input variable\nlet input: &amp;str = \"{...}\";\n\n// parse into generic JSON value\nlet root: Value = serde_json::from_str(input)?;\n\n// access element using .get()\nlet hostname: Option&lt;&amp;str&gt; = root.get(\"data\")\n    .and_then(|value| value.get(0))\n    .and_then(|value| value.get(\"hostname\"))\n    .and_then(|value| value.as_str());\n\n// hostname is Some(string_value) if .data[0].hostname is a string,\n// and None if it was not found\nprintln!(\"hostname = {:?}\", hostname); // = Some(\"a hostname\")\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=release&amp;edition=2018&amp;gist=1649e0325277ba399693b2ee27045122\" rel=\"nofollow noreferrer\">full playground example</a>)</p>\n"}, {"tags": [], "owner": {"reputation": 2163, "user_id": 535308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/445b419f67257b25a5ad47f9040b9d5c?s=128&d=identicon&r=PG", "display_name": "gustavodiazjaimes", "link": "https://stackoverflow.com/users/535308/gustavodiazjaimes"}, "is_accepted": false, "score": 1, "last_activity_date": 1558789393, "last_edit_date": 1558789393, "creation_date": 1558678311, "answer_id": 56286779, "question_id": 56279350, "link": "https://stackoverflow.com/questions/56279350/how-to-get-at-one-particular-item-in-json-file-using-serde-json-without-deriving/56286779#56286779", "title": "How to get at one particular item in JSON file using serde_json without deriving structs?", "body": "<p>I would chain <a href=\"https://serde.rs/attr-flatten.html#capture-additional-fields\" rel=\"nofollow noreferrer\">flattened structures</a></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use serde::{Serialize, Deserialize};\nuse serde_json::Value;\n\n#[derive(Serialize, Deserialize)]\nstruct Payload {\n    data: Vec&lt;Data&gt;,\n\n    #[serde(flatten)]\n    _: HashMap&lt;String, Value&gt;,\n}\n\n#[derive(Serialize, Deserialize)]\nstruct Data {\n    hostname: String,\n\n    #[serde(flatten)]\n    _: HashMap&lt;String, Value&gt;,\n}\n\nlet payload: Payload = serde_json::from_str(your_string)?;\nassert_eq!(payload.data.0.hostname, \"a hostname\");\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 5, "last_activity_date": 1613577560, "last_edit_date": 1613577560, "creation_date": 1558699010, "answer_id": 56292204, "question_id": 56279350, "link": "https://stackoverflow.com/questions/56279350/how-to-get-at-one-particular-item-in-json-file-using-serde-json-without-deriving/56292204#56292204", "title": "How to get at one particular item in JSON file using serde_json without deriving structs?", "body": "<p>If you want to panic if the value is missing or malformed, I'd use <a href=\"https://docs.rs/serde_json/1.0.62/serde_json/enum.Value.html#impl-Index%3CI%3E\" rel=\"nofollow noreferrer\">the <code>Index</code> syntax</a> (<code>[...]</code>). If you want to handle the missing / malformed case, use the <a href=\"https://docs.rs/serde_json/1.0.62/serde_json/enum.Value.html#method.get\" rel=\"nofollow noreferrer\"><code>get</code></a> method:</p>\n<pre><code>fn main() {\n    let json_value = serde_json::json!({\n      &quot;data&quot;: [\n        {\n          &quot;hostname&quot;: &quot;a hostname&quot;\n        }\n      ]\n    });\n\n    let host = &amp;json_value[&quot;data&quot;][0][&quot;hostname&quot;];\n    println!(&quot;Host: {:?}&quot;, host);\n}\n</code></pre>\n<p>You can also use a <a href=\"https://tools.ietf.org/html/rfc6901\" rel=\"nofollow noreferrer\">JSON Pointer</a> via <a href=\"https://docs.rs/serde_json/1.0.39/serde_json/value/enum.Value.html#method.pointer\" rel=\"nofollow noreferrer\"><code>pointer</code></a>:</p>\n<pre><code>let host = json_value.pointer(&quot;/data/0/hostname&quot;);\nprintln!(&quot;Host: {:?}&quot;, host);\n</code></pre>\n"}], "owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2198, "favorite_count": 0, "accepted_answer_id": 56281271, "answer_count": 3, "score": 7, "last_activity_date": 1613577560, "creation_date": 1558628371, "last_edit_date": 1558698520, "question_id": 56279350, "link": "https://stackoverflow.com/questions/56279350/how-to-get-at-one-particular-item-in-json-file-using-serde-json-without-deriving", "title": "How to get at one particular item in JSON file using serde_json without deriving structs?", "body": "<p>I have a complex JSON file and I'd like to extract only a single value out of it. I could define all of the <code>struct</code>s and derive <code>Deserialize</code> on all of them, but I'd like to just write a little manual code to pull that one value out. The <a href=\"https://serde.rs/impl-deserializer.html\" rel=\"noreferrer\">Serde documentation</a>, quite frankly, just confused me.</p>\n\n<p>My JSON content has the following layout:</p>\n\n<pre><code>{\n  \"data\": [\n    {\n      \"hostname\": \"a hostname\"\n    }\n  ]\n}\n</code></pre>\n\n<p>I'm looking for the value navigated to by going into <code>data</code>, then taking the first element of the array, and taking the value of <code>hostname</code>.</p>\n\n<p>In Haskell, I'd do it like this:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>newtype Host = Host Text\n\ninstance FromJSON Host where\n    parseJSON (Object o) = (return . Host) &lt;=&lt; (.: \"hostname\") &lt;=&lt; (fmap (!! 0) . parseJSON) &lt;=&lt; (.: \"data\") $ o\n    parseJSON _ = mzero\n</code></pre>\n\n<p>What's the equivalent for Serde?</p>\n"}, {"tags": ["rust", "rust-tokio"], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1558618328, "post_id": 56275678, "comment_id": 99167134, "body": "Even for demonstration, you should <a href=\"https://stackoverflow.com/q/48735952/155423\">not use <code>thread:sleep</code> in futures</a>. There are better alternatives"}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1558618389, "post_id": 56275678, "comment_id": 99167182, "body": "@Shepmaster it was in the question, i copied it directly.  And it was marked as mock delay so i haven&#39;t mentioned it in the answer."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1558618555, "post_id": 56275678, "comment_id": 99167281, "body": "The original question also had other problems that you <i>didn&#39;t</i> copy directly (rather the <i>point</i> of Stack Overflow). Realize that most people are going to copy-paste your code with little to no thought applied to the answer. It&#39;s better to encourage good practices everywhere."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1558621238, "post_id": 56275678, "comment_id": 99168917, "body": "@&#214;merErden thanks, but how to spawn concurrently all the functions, from your example they run one after the other, so if each function is delayed 5 seconds, the next batch will be run <code>N functions *  5 seconds</code> instead of only 5 seconds the whole."}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1558628815, "post_id": 56275678, "comment_id": 99172974, "body": "@nbari Yes it wasn&#39;t executing in parallel because of the usage of <code>thread::sleep</code>, if you read the <a href=\"https://stackoverflow.com/a/48736148/1601571\">post in comments</a> you can see the reason. I updated the code with proper mock delaying and delayed for Duration::from_millis(100 - i) to see the tasks completed in arbitrary order."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1558633386, "post_id": 56275678, "comment_id": 99174898, "body": "If I mock the delay with something like <code>Command::new(&quot;sleep&quot;).arg(&quot;3&quot;).output().expect(&quot;failed to execute process&quot;);</code> still not concurrent therefore wondering how to call &quot;anything&quot; concurrent ?"}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1558637103, "post_id": 56275678, "comment_id": 99176393, "body": "@nbari maybe i am missing something but looks like tokio is running our futures in same thread, i guess  thread sleep prevents running other futures, please check this <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=8b41ef4090a572ed80e7a96308658243\" rel=\"nofollow noreferrer\">code</a>."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1558763648, "post_id": 56275678, "comment_id": 99215731, "body": "@&#214;merErden Could you give me a hint about how to use <code>tokio_threadpool</code> within your last example, probably that could do the trick, thanks in advance"}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1558796769, "post_id": 56275678, "comment_id": 99222631, "body": "@nbari with sleep or with tokio-timer ?"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1558807946, "post_id": 56275678, "comment_id": 99225487, "body": "@&#214;merErden based on Shepmaster answer  there seems to be a way of doing it with <code>tokio_threadpool</code> keeping the  <code>Interval</code> to be running every X seconds but spawning processes without blocking with the <code>threadpool</code>"}], "tags": [], "owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "is_accepted": false, "score": 1, "last_activity_date": 1558629035, "last_edit_date": 1558629035, "creation_date": 1558615952, "answer_id": 56275678, "question_id": 56273037, "link": "https://stackoverflow.com/questions/56273037/how-can-i-run-a-set-of-functions-concurrently-on-a-recurring-interval-without-ru/56275678#56275678", "title": "How can I run a set of functions concurrently on a recurring interval without running the same function at the same time using Tokio?", "body": "<blockquote>\n  <p>From my understanding (I am probably getting the idea wrong), I am\n  returning a <code>Future</code> within another future</p>\n</blockquote>\n\n<p>You are not wrong, but in the code that you provided the only returned future is <code>Ok(())</code> which implements <code>IntoFuture</code>. <code>tokio::spawn</code> just spawns the new task into the <code>DefaultExecutor</code> of Tokio.</p>\n\n<p>If I understand from your question, you want to spawn the <strong>next batch</strong> when the <strong>previous</strong> one is done, but if the previous is done before 1 second you want to finish that 1 second before spawning the next batch. </p>\n\n<p>Implementing your own future and handling the poll by yourself would be a better solution but this can be done roughly:</p>\n\n<ul>\n<li>By using <code>join_all</code> to collect batch tasks. This is a new future which waits for the collected futures to complete.</li>\n<li>For the <strong>1 second</strong> wait you can use atomic state. If it is locked for the tick, it waits until the state released.</li>\n</ul>\n\n<p>Here is the code (<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=539422106cd8ecfc78bc633597078246\" rel=\"nofollow noreferrer\">Playground</a>): </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate futures;\nextern crate tokio;\n\nuse futures::future::lazy;\nuse std::time::{self, Duration, Instant};\n\nuse tokio::prelude::*;\nuse tokio::timer::{Delay, Interval};\n\nuse futures::future::join_all;\nuse std::sync::atomic::{AtomicBool, Ordering};\nuse std::sync::Arc;\n\nfn main() {\n    let locker = Arc::new(AtomicBool::new(false));\n\n    let task = Interval::new(time::Instant::now(), time::Duration::new(1, 0))\n        .map_err(|e| panic!(\"interval errored; err={:?}\", e))\n        .for_each(move |interval| {\n            let is_locked = locker.load(Ordering::SeqCst);\n            println!(\"Interval: {:?} --- {:?}\", interval, is_locked);\n\n            if !is_locked {\n                locker.store(true, Ordering::SeqCst);\n                println!(\"locked\");\n\n                let futures: Vec&lt;_&gt; = (0..5)\n                    .map(|i| {\n                        lazy(move || {\n                            println!(\"Running Task-{}\", i);\n                            // mock delay\n                            Delay::new(Instant::now() + Duration::from_millis(100 - i))\n                                .then(|_| Ok(()))\n                        })\n                        .and_then(move |_| {\n                            println!(\"Task-{} is done\", i);\n                            Ok(())\n                        })\n                    })\n                    .collect();\n\n                let unlocker = locker.clone();\n                tokio::spawn(join_all(futures).and_then(move |_| {\n                    unlocker.store(false, Ordering::SeqCst);\n                    println!(\"unlocked\");\n\n                    Ok(())\n                }));\n            }\n\n            Ok(())\n        });\n\n    tokio::run(task.then(|_| Ok(())));\n}\n</code></pre>\n\n<p><strong>Output :</strong> </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Interval: Instant { tv_sec: 4036783, tv_nsec: 211837425 } --- false\nlocked\nRunning Task-0\nRunning Task-1\nRunning Task-2\nRunning Task-3\nRunning Task-4\nTask-4 is done\nTask-3 is done\nTask-2 is done\nTask-1 is done\nTask-0 is done\nunlocked\nInterval: Instant { tv_sec: 4036784, tv_nsec: 211837425 } --- false\nlocked\nRunning Task-0\nRunning Task-1\nRunning Task-2\nRunning Task-3\nRunning Task-4\nTask-3 is done\nTask-4 is done\nTask-0 is done\nTask-1 is done\nTask-2 is done\nunlocked\n</code></pre>\n\n<p><strong>Warning ! :</strong>  Please check <a href=\"https://stackoverflow.com/questions/56273037/how-can-i-run-a-set-of-functions-on-a-recurring-interval-without-running-the-sam/56275678#comment99167134_56275678\">Shepmaster's comment</a>  </p>\n\n<blockquote>\n  <p>Even for demonstration, <a href=\"https://stackoverflow.com/q/48735952/155423\">you should not use thread:sleep</a> in futures.\n  There are better alternatives</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1558631985, "post_id": 56278069, "comment_id": 99174303, "body": "Thanks but I still trying to get my head around the use of <code>tokio::spawn()</code>  your answer helped me to get the idea about how to &quot;delay&quot; instead of using <code>thread::sleep</code> . But   in the case I would like to call the system command <code>sleep N</code> , is there a way  to &quot;group &amp; wait&quot; for all  the returns of multiple <code>tokio::spawn()</code>  and once finished just proceed with another batch or wait until the defined interval time passed and then call again all the functions?"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1558633454, "post_id": 56278069, "comment_id": 99174930, "body": "For example how to mock with something like <code>Command::new(&quot;sleep&quot;).arg(&quot;3&quot;).output().expect(&quot;failed to execute process&quot;);</code>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1558634503, "post_id": 56278069, "comment_id": 99175331, "body": "@nbari such a question doesn&#39;t make sense because the <a href=\"https://docs.rs/tokio/0.1.20/tokio/executor/struct.Spawn.html\" rel=\"nofollow noreferrer\">returned value from <code>tokio::spawn</code> &quot;doesn&#39;t actually provide any functionality&quot;</a>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1558634693, "post_id": 56278069, "comment_id": 99175401, "body": "@nbari I&#39;ve added links to existing Q&amp;A about how to run generic blocking code (tl;dr: use a threadpool) as well as <code>Command</code> (tl;dr: use tokio-process)."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1558637660, "post_id": 56278069, "comment_id": 99176641, "body": "Thanks, however still not very clear how I could use Tokio to run something forever at a defined interval (scheduler) and concurrently spawn X blocking functions and wait for them to finish before calling them again, in the end, I just want to do something like this <a href=\"https://play.golang.org/p/ZLw6ESioqfu\" rel=\"nofollow noreferrer\">play.golang.org/p/ZLw6ESioqfu</a> in Rust, I know is unfair to compare languages but It help to clarify exactly what I want to achieve."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1558638093, "post_id": 56278069, "comment_id": 99176837, "body": "@nbari Replace the calls to <code>page</code> with a call to tokio-threadpool, as described in the linked Q&amp;A."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 2, "last_activity_date": 1617066729, "last_edit_date": 1617066729, "creation_date": 1558623654, "answer_id": 56278069, "question_id": 56273037, "link": "https://stackoverflow.com/questions/56273037/how-can-i-run-a-set-of-functions-concurrently-on-a-recurring-interval-without-ru/56278069#56278069", "title": "How can I run a set of functions concurrently on a recurring interval without running the same function at the same time using Tokio?", "body": "<p>You can achieve this by joining your worker futures such that they all run in parallel, but must all finish together. You can then join that with a delay of 1 second for the same rationale. Wrap that into a loop to run it forever (or 5 iterations, for the demo).</p>\n<h1>Tokio 1.3</h1>\n<pre class=\"lang-rust prettyprint-override\"><code>use futures::{future, future::BoxFuture, stream, FutureExt, StreamExt}; // 0.3.13\nuse std::time::{Duration, Instant};\nuse tokio::time; // 1.3.0\n\n#[tokio::main]\nasync fn main() {\n    let now = Instant::now();\n    let forever = stream::unfold((), |()| async {\n        eprintln!(&quot;Loop starting at {:?}&quot;, Instant::now());\n\n        // Resolves when all pages are done\n        let batch_of_pages = future::join_all(all_pages());\n\n        // Resolves when both all pages and a delay of 1 second is done\n        future::join(batch_of_pages, time::sleep(Duration::from_secs(1))).await;\n        \n        Some(((), ()))\n    });\n\n    forever.take(5).for_each(|_| async {}).await;\n    eprintln!(&quot;Took {:?}&quot;, now.elapsed());\n}\n\nfn all_pages() -&gt; Vec&lt;BoxFuture&lt;'static, ()&gt;&gt; {\n    vec![page(&quot;a&quot;, 100).boxed(), page(&quot;b&quot;, 200).boxed()]\n}\n\nasync fn page(name: &amp;'static str, time_ms: u64) {\n    eprintln!(&quot;page {} starting&quot;, name);\n    time::sleep(Duration::from_millis(time_ms)).await;\n    eprintln!(&quot;page {} done&quot;, name);\n}\n</code></pre>\n<pre class=\"lang-none prettyprint-override\"><code>Loop starting at Instant { t: 1022680437923626 }\npage a starting\npage b starting\npage a done\npage b done\nLoop starting at Instant { t: 1022681444390534 }\npage a starting\npage b starting\npage a done\npage b done\nLoop starting at Instant { t: 1022682453240399 }\npage a starting\npage b starting\npage a done\npage b done\nLoop starting at Instant { t: 1022683469924126 }\npage a starting\npage b starting\npage a done\npage b done\nLoop starting at Instant { t: 1022684493522592 }\npage a starting\npage b starting\npage a done\npage b done\nTook 5.057315596s\n</code></pre>\n<h1>Tokio 0.1</h1>\n<pre><code>use futures::future::{self, Loop}; // 0.1.26\nuse std::time::{Duration, Instant};\nuse tokio::{prelude::*, timer::Delay};  // 0.1.18\n\nfn main() {\n    let repeat_count = Some(5);\n\n    let forever = future::loop_fn(repeat_count, |repeat_count| {\n        eprintln!(&quot;Loop starting at {:?}&quot;, Instant::now());\n\n        // Resolves when all pages are done\n        let batch_of_pages = future::join_all(all_pages());\n\n        // Resolves when both all pages and a delay of 1 second is done\n        let wait = Future::join(batch_of_pages, ez_delay_ms(1000));\n\n        // Run all this again\n        wait.map(move |_| {\n            if let Some(0) = repeat_count {\n                Loop::Break(())\n            } else {\n                Loop::Continue(repeat_count.map(|c| c - 1))\n            }\n        })\n    });\n\n    tokio::run(forever.map_err(drop));\n}\n\nfn all_pages() -&gt; Vec&lt;Box&lt;dyn Future&lt;Item = (), Error = ()&gt; + Send + 'static&gt;&gt; {\n    vec![Box::new(page(&quot;a&quot;, 100)), Box::new(page(&quot;b&quot;, 200))]\n}\n\nfn page(name: &amp;'static str, time_ms: u64) -&gt; impl Future&lt;Item = (), Error = ()&gt; + Send + 'static {\n    future::ok(())\n        .inspect(move |_| eprintln!(&quot;page {} starting&quot;, name))\n        .and_then(move |_| ez_delay_ms(time_ms))\n        .inspect(move |_| eprintln!(&quot;page {} done&quot;, name))\n}\n\nfn ez_delay_ms(ms: u64) -&gt; impl Future&lt;Item = (), Error = ()&gt; + Send + 'static {\n    Delay::new(Instant::now() + Duration::from_millis(ms)).map_err(drop)\n}\n</code></pre>\n<pre class=\"lang-none prettyprint-override\"><code>Loop starting at Instant { tv_sec: 4031391, tv_nsec: 806352322 }\npage a starting\npage b starting\npage a done\npage b done\nLoop starting at Instant { tv_sec: 4031392, tv_nsec: 807792559 }\npage a starting\npage b starting\npage a done\npage b done\nLoop starting at Instant { tv_sec: 4031393, tv_nsec: 809117958 }\npage a starting\npage b starting\npage a done\npage b done\nLoop starting at Instant { tv_sec: 4031394, tv_nsec: 813142458 }\npage a starting\npage b starting\npage a done\npage b done\nLoop starting at Instant { tv_sec: 4031395, tv_nsec: 814407116 }\npage a starting\npage b starting\npage a done\npage b done\nLoop starting at Instant { tv_sec: 4031396, tv_nsec: 815342642 }\npage a starting\npage b starting\npage a done\npage b done\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/q/48735952/155423\">Why does Future::select choose the future with a longer sleep period first?</a></li>\n<li><a href=\"https://stackoverflow.com/q/41932137/155423\">What is the best approach to encapsulate blocking I/O in future-rs?</a></li>\n<li><a href=\"https://stackoverflow.com/q/34611742/155423\">How do I read the output of a child process without blocking in Rust?</a></li>\n</ul>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1410, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1617066729, "creation_date": 1558606560, "last_edit_date": 1558636791, "question_id": 56273037, "link": "https://stackoverflow.com/questions/56273037/how-can-i-run-a-set-of-functions-concurrently-on-a-recurring-interval-without-ru", "title": "How can I run a set of functions concurrently on a recurring interval without running the same function at the same time using Tokio?", "body": "<p>My goal is to run N functions concurrently but don't want to spawn more until all of them have finished. This is <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=fc1456e695b18c0225c23fa048a5d106\" rel=\"nofollow noreferrer\">what I have so far</a>:</p>\n\n<pre><code>extern crate tokio;\nextern crate futures;\n\nuse futures::future::lazy;\nuse std::{thread, time};\nuse tokio::prelude::*;\nuse tokio::timer::Interval;\n\nfn main() {\n    let task = Interval::new(time::Instant::now(), time::Duration::new(1, 0))\n        .for_each(|interval| {\n            println!(\"Interval: {:?}\", interval);\n            for i in 0..5 {\n                tokio::spawn(lazy(move || {\n                    println!(\"Hello from task {}\", i);\n                    // mock delay (something blocking)\n                    // thread::sleep(time::Duration::from_secs(3));\n                    Command::new(\"sleep\").arg(\"3\").output().expect(\"failed to execute process\");\n\n                    Ok(())\n                }));\n            }\n            Ok(())\n        })\n    .map_err(|e| panic!(\"interval errored; err={:?}\", e));\n\n    tokio::run(task);\n}\n</code></pre>\n\n<p>Every second I spawning 5 functions, but I now would like to wait until all of the functions have finished before spawning more.</p>\n\n<p>From my understanding (I am probably getting the idea wrong), I am returning a <a href=\"https://tokio.rs/docs/futures/overview/\" rel=\"nofollow noreferrer\"><code>Future</code></a>  within another future</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>task (Interval ----------------------+ (outer future)\n    for i in 0..5 {                  |\n        tokio::spawn(  ----+         | \n            // my function | (inner) |\n            Ok(())         |         |\n        )              ----+         |\n    }                                |\n    Ok(()) --------------------------+\n</code></pre>\n\n<p>I am stuck trying to wait for the inner future to finish. </p>\n"}, {"tags": ["rust", "rust-diesel"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 4, "creation_date": 1558591315, "post_id": 56268877, "comment_id": 99153006, "body": "Trust me, you don&#39;t want <code>*const str</code>. You rather want a <code>String</code>."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 2, "creation_date": 1558600571, "post_id": 56268877, "comment_id": 99157226, "body": "The <code>from_sql()</code> method takes an <code>Option&lt;&amp;DB::RawValue&gt;</code> as argument. The lifetime of the argument of <code>from_sql()</code> is the lifetime of that reference. (I know I&#39;m basically just restating what the documentation already says, but it&#39;s unclear to me what exactly the point is you don&#39;t understand.)"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1558619115, "post_id": 56268877, "comment_id": 99167636, "body": "@SvenMarnach I agree that that&#39;s <i>probably</i> what the documentation means, but pedantically (and pedantry matters for raw pointers), the lifetime of the <i>argument</i> would be the lifetime of <code>bytes</code>, which goes out of scope at the end of the call to <code>from_sql</code>. The documentation probably means &quot;the generic lifetime parameter of the argument&quot;."}, {"owner": {"reputation": 111, "user_id": 7679205, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1785230388414883/picture?type=large", "display_name": "Atsuki Takahashi", "link": "https://stackoverflow.com/users/7679205/atsuki-takahashi"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1558792438, "post_id": 56268877, "comment_id": 99221496, "body": "@hellow Right. I&#39;m using <code>String</code>."}], "answers": [{"tags": [], "owner": {"reputation": 34162, "user_id": 84478, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/f4cdb7db0efa2c5a63fb0a0796be2bb3?s=128&d=identicon&r=PG", "display_name": "Carson Myers", "link": "https://stackoverflow.com/users/84478/carson-myers"}, "is_accepted": false, "score": 1, "last_activity_date": 1558697657, "last_edit_date": 1558697657, "creation_date": 1558622066, "answer_id": 56277563, "question_id": 56268877, "link": "https://stackoverflow.com/questions/56268877/what-is-the-lifetime-of-the-arguments-of-fromsqlfrom-sql/56277563#56277563", "title": "What is the lifetime of the arguments of FromSql::from_sql?", "body": "<p><code>from_sql</code> will take an <code>Option&lt;&amp;'a DB::RawValue&gt;</code> and return a <code>Result&lt;*const str&gt;</code>.</p>\n\n<p>Without raw pointers (and with explicit lifetimes), the function definition would be something like:</p>\n\n<pre><code>fn from_sql&lt;'a&gt;(bytes: Option&lt;&amp;'a DB::RawValue&gt;) -&gt; Result&lt;&amp;'a str&gt;\n</code></pre>\n\n<p>that the output's lifetime to the input is obvious here and statically checked - but with raw pointers, it's not:</p>\n\n<pre><code>fn from_sql&lt;'a&gt;(bytes: Option&lt;&amp;'a DB::RawValue&gt;) -&gt; Result&lt;*const str&gt;\n</code></pre>\n\n<p>the warning is just pointing out that the pointer you get is only guaranteed to be valid for the lifetime of the <code>&amp;'a DB::RawValue</code> that you pass into the function. The warning would be unnecessary without raw pointers because the compiler would guarantee that a <code>&amp;str</code> only lives as long as whatever it is referencing.</p>\n\n<p>This is <code>from_sql</code>'s implementation:</p>\n\n<pre><code>fn from_sql(bytes: Option&lt;&amp;DB::RawValue&gt;) -&gt; deserialize::Result&lt;Self&gt; {\n    use std::str;\n    let string = str::from_utf8(not_none!(bytes))?;\n    Ok(string as *const _)\n}\n</code></pre>\n\n<p>The reason the ouput's lifetime is dependent on the <code>bytes</code> argument is that <code>str::from_utf8</code> just performs a UTF-8 validation and does an unsafe cast on <code>bytes</code> to an <code>&amp;str</code> - you're essentially just returning the input back as a different type. The result of <code>from_sql</code> is just a pointer to the same data you passed into it, so that pointer is only valid as long as that input data is valid.</p>\n"}], "owner": {"reputation": 111, "user_id": 7679205, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1785230388414883/picture?type=large", "display_name": "Atsuki Takahashi", "link": "https://stackoverflow.com/users/7679205/atsuki-takahashi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1558697657, "creation_date": 1558591167, "last_edit_date": 1558618995, "question_id": 56268877, "link": "https://stackoverflow.com/questions/56268877/what-is-the-lifetime-of-the-arguments-of-fromsqlfrom-sql", "title": "What is the lifetime of the arguments of FromSql::from_sql?", "body": "<p>I'm using Diesel with Postgres and want to query a <code>text</code> field as <code>*const str</code>. Diesel has the implementation <a href=\"https://docs.diesel.rs/diesel/deserialize/trait.FromSql.html#impl-FromSql%3CText%2C%20DB%3E\" rel=\"nofollow noreferrer\"><code>FromSql</code> for <code>*const str</code></a>.</p>\n\n<p>The documentation describes:</p>\n\n<blockquote>\n  <p>The returned pointer is <em>only</em> valid for the lifetime to the argument of <code>from_sql</code>.</p>\n</blockquote>\n\n<p>What is the lifetime to the argument of <code>from_sql</code>? Is it the same as the lifetime of the connection?</p>\n"}]