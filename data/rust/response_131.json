[{"tags": ["rust", "algebraic-data-types"], "comments": [{"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 3, "creation_date": 1499887490, "post_id": 45065518, "comment_id": 77105278, "body": "<code>!</code> is not actually a type in stable Rust, but you can use an empty <code>enum</code> for a &quot;zero&quot; type. Though I don&#39;t think a zero type is a necessity for a language to have algebraic data types. That said, what exactly is your question?"}, {"owner": {"reputation": 12866, "user_id": 110488, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/21369d30fe2c6c976ffe735f2fd0ee91?s=128&d=identicon&r=PG", "display_name": "Chen Levy", "link": "https://stackoverflow.com/users/110488/chen-levy"}, "edited": false, "score": 0, "creation_date": 1499888212, "post_id": 45065518, "comment_id": 77105637, "body": "My actual question was removed in one of the edits. It is back now."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1499889326, "post_id": 45065518, "comment_id": 77106204, "body": "Your actual question was not <i>removed</i>, it was <i>moved</i> \u2014 to the title of the post, which is where questions belong on a Question and Answer site. A bundle of nouns like &quot;Algebraic Data Types in Rust&quot; is not a suitable question. You have since modified the title (while keeping it a question, so that&#39;s good)."}], "answers": [{"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 1, "last_activity_date": 1499952185, "creation_date": 1499952185, "answer_id": 45081933, "question_id": 45065518, "link": "https://stackoverflow.com/questions/45065518/how-to-show-that-the-rust-type-system-supports-algebraic-data-types-adts/45081933#45081933", "title": "How to show that the Rust type system supports algebraic data types (ADTs)?", "body": "<blockquote>\n  <p>Is my description above for why Rust's type system supports ADTs true, or am I missing or misunderstanding something about it?</p>\n</blockquote>\n\n<p>Yes, this is about right. One change I would make is to express <code>Void</code> as an <code>enum</code>. As interjay said in the comments, <code>!</code> is not part of stable Rust (<a href=\"https://github.com/rust-lang/rfcs/blob/master/text/1216-bang-type.md\" rel=\"nofollow noreferrer\">yet</a>):</p>\n\n<pre><code>enum Void {} // uninhabited\n</code></pre>\n\n<p>The rest follows easily, and I'm not sure that an answer could express it better than you have done yourself in your question.</p>\n"}], "owner": {"reputation": 12866, "user_id": 110488, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/21369d30fe2c6c976ffe735f2fd0ee91?s=128&d=identicon&r=PG", "display_name": "Chen Levy", "link": "https://stackoverflow.com/users/110488/chen-levy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1060, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1499952185, "creation_date": 1499885678, "last_edit_date": 1499889207, "question_id": 45065518, "link": "https://stackoverflow.com/questions/45065518/how-to-show-that-the-rust-type-system-supports-algebraic-data-types-adts", "title": "How to show that the Rust type system supports algebraic data types (ADTs)?", "body": "<p><a href=\"https://en.wikipedia.org/wiki/Algebraic_data_type#Programming_languages_with_algebraic_data_types\" rel=\"nofollow noreferrer\">Wikipedia's list of programming languages with algebraic data types (ADTs)</a> suggests that Rust indeed has ADTs, but I am not sure if my interpretation for why this is true for Rust is correct. As I understand it, to say that one has ADTs one needs to have:</p>\n\n<p><em>Values</em>:</p>\n\n<ul>\n<li>Zero (or Void) - <code>!</code> in Rust) - a type that gets no value.</li>\n<li>One (or Unit) - <code>()</code> in Rust) - a type that gets one value: <code>()</code> itself.</li>\n</ul>\n\n<p><em>Operations</em>:</p>\n\n<ul>\n<li>Addition - <code>enum { A, B }</code> in Rust - operation that can return the values of <code>A</code> or the values of <code>B</code>.</li>\n<li>Multiplication - Tuple <code>(A, B)</code> in Rust - operation that can return all the combinations of <code>A</code> and <code>B</code>.</li>\n</ul>\n\n<p><em>Rules</em>:</p>\n\n<ul>\n<li><code>a + b = b + a</code>: <code>enum { A, B } =~ enum { B, A }</code></li>\n<li><code>a * b = b * a</code>: <code>(A, B) =~ (B, A)</code></li>\n<li><code>0 + x = x</code>: <code>enum { !, A } =~ enum { A }</code></li>\n<li><code>0 * x = 0</code>: <code>(!, A) =~ !</code></li>\n<li><code>1 * x = x</code>: <code>((), A) =~ A</code></li>\n</ul>\n\n<p>Here <code>A =~ B</code> means that there is a <code>fn(A) -&gt; B</code> and <code>fn(B) -&gt; A</code></p>\n\n<p>Is my description above for why Rust's type system supports ADTs true, or am I missing or misunderstanding something about it?</p>\n"}, {"tags": ["rust", "ffi"], "comments": [{"owner": {"reputation": 3495, "user_id": 36585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0ccd55542e51b1b98f5a72b30c815dc?s=128&d=identicon&r=PG", "display_name": "pnkfelix", "link": "https://stackoverflow.com/users/36585/pnkfelix"}, "edited": false, "score": 0, "creation_date": 1499873852, "post_id": 45061755, "comment_id": 77097538, "body": "How is the C implementation of <code>get_list</code> declared? (I am curious about why you have it returning <code>*const c_void</code> instead of <code>*const elem</code>.)"}, {"owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "edited": false, "score": 0, "creation_date": 1499873855, "post_id": 45061755, "comment_id": 77097540, "body": "<a href=\"https://play.rust-lang.org/?gist=5f56804e93f608e811727af85d376f52&amp;version=stable\" rel=\"nofollow noreferrer\">It should be working</a>"}, {"owner": {"reputation": 3495, "user_id": 36585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0ccd55542e51b1b98f5a72b30c815dc?s=128&d=identicon&r=PG", "display_name": "pnkfelix", "link": "https://stackoverflow.com/users/36585/pnkfelix"}, "edited": false, "score": 0, "creation_date": 1499874042, "post_id": 45061755, "comment_id": 77097694, "body": "also, at what point in the iteration are you seeing misaligned data being read out? Is the initial <code>head = get_list()</code> misaligned? Or is it only sometime after the first iteration?"}, {"owner": {"reputation": 97030, "user_id": 189205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c60305494593d556e57a3cf8e4a8c163?s=128&d=identicon&r=PG", "display_name": "interjay", "link": "https://stackoverflow.com/users/189205/interjay"}, "edited": false, "score": 1, "creation_date": 1499874637, "post_id": 45061755, "comment_id": 77098084, "body": "Your problem is not in the code you&#39;ve shown. We need to see a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499882308, "post_id": 45061755, "comment_id": 77102460, "body": "Why (and how) are you calling a <i>function</i> next, when it&#39;s declared as a pointer?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1499887677, "post_id": 45061755, "comment_id": 77105385, "body": "Adding to the previous MCVE comment, if you could provide a (small!) version of the C code you are linking against, that would allow us to compile and link against it ourselves. Something that defines <code>get_list</code> would be a good start. Is that struct a global, is it being allocated, etc. That way, we can use tools like a debugger as well as rapidly iterate to a solution."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499950971, "post_id": 45076815, "comment_id": 77135449, "body": "And <i>that&#39;s</i> why we want people to provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}], "tags": [], "owner": {"reputation": 235, "user_id": 2912280, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/1085475776/picture?type=large", "display_name": "Ivan Bratoev", "link": "https://stackoverflow.com/users/2912280/ivan-bratoev"}, "is_accepted": true, "score": 1, "last_activity_date": 1499950913, "last_edit_date": 1499950913, "creation_date": 1499938580, "answer_id": 45076815, "question_id": 45061755, "link": "https://stackoverflow.com/questions/45061755/why-is-a-c-structure-returning-misaligned-junk-data-when-read-from-rust/45076815#45076815", "title": "Why is a C structure returning misaligned junk data when read from Rust?", "body": "<p>After I wrote an example library just for this case, I found out it wasn't an extern problem, rather a <code>CStr</code> one. As it is fixed in the example, where I slice the buffer to the position of the first NUL terminator, I provide the example I wrote for proper externing.</p>\n\n<p><strong>list.c</strong></p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nstruct elem {\n    char data[5];\n    struct elem* next;\n};\n\nstruct elem* get_list() {\n    struct elem* head = malloc(sizeof(struct elem));\n    strcpy(head-&gt;data, \"1\");\n\n    struct elem* el = malloc(sizeof(struct elem));\n    head-&gt;next = el;\n\n    strcpy(el-&gt;data, \"2\");\n\n    el-&gt;next = malloc(sizeof(struct elem));\n    el = el-&gt;next;\n    strcpy(el-&gt;data, \"3\");\n    el-&gt;next = NULL;\n\n    return head;\n}\n</code></pre>\n\n<p><strong>main.rs</strong></p>\n\n<pre><code>use std::ffi::CStr;\n\n#[repr(C)]\npub struct elem {\n    pub data: [u8; 5],\n    pub next: *const elem\n}\n\n#[link(name = \"list\", kind = \"static\")]\nextern {\n    pub fn get_list() -&gt; *const elem;\n}\n\nfn main() {\n    unsafe {\n        let mut list = get_list();\n        // Note, that, if we call from_bytes_with_nul it will throw  \n        // an NulInternal error, therefore,\n        // we have to slice the buffer to the first NUL-terminator\n        while !list.is_null() {\n            let mut null_pos = (*list).data.len() - 1;\n            {\n                for i in 0..(*list).data.len() {\n                    if (*list).data[i] == 0 {\n                        null_pos = i + 1;\n                        break\n                    }\n                }\n            }\n            let str = CStr::from_bytes_with_nul(\n                          (*list).data[..null_pos]\n                      ).unwrap();\n            println!(\"{:?}\", str);\n            list = (*list).next;\n        }\n    }\n}\n</code></pre>\n\n<p>output</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\"1\"\n\"2\"\n\"3\"\n</code></pre>\n\n<p>Key aspects of the implementation:</p>\n\n<ul>\n<li><p>Define the same structure, annotated with <code>#[repr(C)]</code>, so it would be\naligned in the same way as the C one.</p></li>\n<li><p>Define the extern function to return a const pointer to the structure.</p></li>\n<li><p>Use pointers instead of <code>std::mem::transmute</code></p></li>\n<li><p>Be careful with null pointers and terminators</p></li>\n</ul>\n"}], "owner": {"reputation": 235, "user_id": 2912280, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/1085475776/picture?type=large", "display_name": "Ivan Bratoev", "link": "https://stackoverflow.com/users/2912280/ivan-bratoev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 0, "accepted_answer_id": 45076815, "answer_count": 1, "score": 1, "last_activity_date": 1499950913, "creation_date": 1499872836, "last_edit_date": 1499887554, "question_id": 45061755, "link": "https://stackoverflow.com/questions/45061755/why-is-a-c-structure-returning-misaligned-junk-data-when-read-from-rust", "title": "Why is a C structure returning misaligned junk data when read from Rust?", "body": "<p>I am trying to wrap a C function in Rust. The C function <code>struct elem* get_list()</code> returns the following struct:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>struct elem {\n    char data[5],\n    struct elem* next\n};\n</code></pre>\n\n<p>In Rust, I have declared the function the following way. The declaration of the C function returns <code>*const c_void</code> as described in an old version of the Rust documentation, which I could not find at the time of writing. I tried returning <code>*const elem</code> and working with pointers, achieving the same result:</p>\n\n<pre><code>extern \"C\" {\n    pub fn get_list() -&gt; *const c_void;\n}\n</code></pre>\n\n<p>The struct represents a linked list, with <code>next</code> being a pointer to the next element of the list. Inside Rust, I declared the struct in the following way:</p>\n\n<pre><code>#[repr(C)]\npub struct elem {\n    pub data: [u8; 5],\n    pub next: *const c_void,\n}\n</code></pre>\n\n<p>The function returns a <code>*const c_void</code> pointer to the first element of the linked list (of type <code>elem</code>). I'm trying to read the elements of the linked list with the following code:</p>\n\n<pre><code>let head = get_list();\nwhile !head.is_null() {\n    let el: &amp;elem = mem::transmute(head);\n    let str = el.data;\n    let str = CStr::from_bytes_with_nul(&amp;str).unwrap();\n    //do something\n    head = el.next();\n}\n</code></pre>\n\n<p>This reads junk data - the pointers are not properly aligned, both the string is bad and non-null-terminated, and the next pointer leads to random data (the list had different size when the function is called from C directly).</p>\n\n<p>I tried with the function returning a pointer to <code>elem</code> and only working with pointers, I tried with transmuting <code>str</code> from the address of <code>el</code> - it always reads the same junk data. How do I make it align properly?</p>\n\n<p>I know how to do it with a pointer instead of an array and that's the way it is demonstrated in the Rust documentation, but I cannot change the C code.</p>\n"}, {"tags": ["struct", "enums", "rust", "deserialization", "serde"], "answers": [{"comments": [{"owner": {"reputation": 22118, "user_id": 57171, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8b7f3a1367b24335691b1af5397f1a67?s=128&d=identicon&r=PG", "display_name": "Steve Powell", "link": "https://stackoverflow.com/users/57171/steve-powell"}, "edited": false, "score": 0, "creation_date": 1499869227, "post_id": 45060136, "comment_id": 77093921, "body": "Yes, I know how to do it with custom deserialization. When I have several variants this code gets tedious, and it happens at least twice in my current task.  What I would like is some sort of annotation on the <code>an_enum</code> field to say there will be no tag (or omit it on serialization)."}, {"owner": {"reputation": 22118, "user_id": 57171, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8b7f3a1367b24335691b1af5397f1a67?s=128&d=identicon&r=PG", "display_name": "Steve Powell", "link": "https://stackoverflow.com/users/57171/steve-powell"}, "edited": false, "score": 0, "creation_date": 1499869283, "post_id": 45060136, "comment_id": 77093969, "body": "I&#39;m not familiar with the <code>r#...#</code> notation. Can you explain it, please?"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1499869399, "post_id": 45060136, "comment_id": 77094066, "body": "It&#39;s hard to imagine a derived <code>Deserialize</code> implementation to get this right. Basically, this requires the deserializer to discover an enum variant by looking at the various fields and capturing variant names as well as field names. Nevertheless, it might be possible to turn a few parts of this into a macro. Other than that, using multiple options is the least tedious approach, with the down-side of not checking for exclusivity off the bat."}, {"owner": {"reputation": 22118, "user_id": 57171, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8b7f3a1367b24335691b1af5397f1a67?s=128&d=identicon&r=PG", "display_name": "Steve Powell", "link": "https://stackoverflow.com/users/57171/steve-powell"}, "edited": false, "score": 0, "creation_date": 1536846206, "post_id": 45060136, "comment_id": 91577290, "body": "<code>#[serde(flatten)]</code> is exactly what I wanted, thank you."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 10, "last_activity_date": 1585578975, "last_edit_date": 1585578975, "creation_date": 1499868785, "answer_id": 45060136, "question_id": 45059538, "link": "https://stackoverflow.com/questions/45059538/how-to-deserialize-into-a-enum-variant-based-on-a-key-name/45060136#45060136", "title": "How to deserialize into a enum variant based on a key name?", "body": "<p>You are looking for <a href=\"https://serde.rs/field-attrs.html#flatten\" rel=\"nofollow noreferrer\"><code>#[serde(flatten)]</code></a>:</p>\n\n<pre><code>use serde::Deserialize; // 1.0.104\nuse serde_json; // 1.0.48\n\n#[derive(Debug, Deserialize)]\nstruct Example {\n    field: i32,\n    #[serde(flatten)]\n    an_enum: AnEnum,\n}\n\n#[derive(Debug, Deserialize)]\nenum AnEnum {\n    A(i32),\n    B(i32),\n}\n\nfn main() {\n    let a = r#\"{ \"field\": 42, \"A\": 76 }\"#;\n    let b = r#\"{ \"field\": 42, \"B\": 110 }\"#;\n\n    let a = serde_json::from_str::&lt;Example&gt;(a);\n    let b = serde_json::from_str::&lt;Example&gt;(b);\n\n    println!(\"{:?}\", a);\n    println!(\"{:?}\", b);\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>Ok(Example { field: 42, an_enum: A(76) })\nOk(Example { field: 42, an_enum: B(110) })\n</code></pre>\n\n<hr>\n\n<p>Before this was available, I'd use custom deserialization:</p>\n\n<pre><code>extern crate serde;\nextern crate serde_json;\n#[macro_use]\nextern crate serde_derive;\n\nuse serde::{Deserialize, Deserializer};\nuse serde::de::Error;\n\n#[derive(Debug)]\nstruct Example {\n    field: i32,\n    an_enum: AnEnum,\n}\n\n#[derive(Debug)]\nenum AnEnum {\n    A(i32),\n    B(i32),\n}\n\nimpl&lt;'de&gt; Deserialize&lt;'de&gt; for Example {\n    fn deserialize&lt;D&gt;(deserializer: D) -&gt; Result&lt;Self, D::Error&gt;\n    where\n        D: Deserializer&lt;'de&gt;,\n    {\n        #[derive(Debug, Deserialize)]\n        struct Mapping {\n            field: i32,\n            #[serde(rename = \"A\")]\n            a: Option&lt;i32&gt;,\n            #[serde(rename = \"B\")]\n            b: Option&lt;i32&gt;,\n        }\n\n        let Mapping { field, a, b } = Mapping::deserialize(deserializer)?;\n\n        match (a, b) {\n            (Some(_), Some(_)) =&gt; \n                Err(D::Error::custom(\"multiple variants specified\")),\n            (Some(a), None) =&gt;\n                Ok(Example { field, an_enum: AnEnum::A(a) }),\n            (None, Some(b)) =&gt; \n                Ok(Example { field, an_enum: AnEnum::B(b) }),\n            (None, None) =&gt;\n                Err(D::Error::custom(\"no variants specified\")),\n        }\n    }\n}\n\nfn main() {\n    let a = r#\"{ \"field\": 42, \"A\": 76 }\"#;\n    let b = r#\"{ \"field\": 42, \"B\": 110 }\"#;\n\n    let a: Result&lt;Example, _&gt; = serde_json::from_str(a);\n    let b: Result&lt;Example, _&gt; = serde_json::from_str(b);\n\n    println!(\"{:?}\", a);\n    println!(\"{:?}\", b);\n}\n</code></pre>\n"}], "owner": {"reputation": 22118, "user_id": 57171, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8b7f3a1367b24335691b1af5397f1a67?s=128&d=identicon&r=PG", "display_name": "Steve Powell", "link": "https://stackoverflow.com/users/57171/steve-powell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2375, "favorite_count": 2, "accepted_answer_id": 45060136, "answer_count": 1, "score": 7, "last_activity_date": 1585578975, "creation_date": 1499867269, "last_edit_date": 1499868302, "question_id": 45059538, "link": "https://stackoverflow.com/questions/45059538/how-to-deserialize-into-a-enum-variant-based-on-a-key-name", "title": "How to deserialize into a enum variant based on a key name?", "body": "<p>I have JSON which takes two forms:</p>\n\n<pre><code>\"Example:\" { \"field\": 42, \"A\": 76 }\n\"Example:\" { \"field\": 42, \"B\": 110 }\n</code></pre>\n\n<p>I want to deserialize it into a struct like this:</p>\n\n<pre><code>struct Example {\n    field: i32,\n    an_enum: AnEnum,\n}\n</code></pre>\n\n<p>where</p>\n\n<pre><code>enum AnEnum {\n    A(i32),\n    B(i32),\n}\n</code></pre>\n\n<p>I don't know how to do it without writing a custom deserializer for <code>Example</code>.</p>\n\n<p>This works:</p>\n\n<pre><code>\"Example:\" { \"field\": 42, \"an_enum\": {\"A\": 76} }\n</code></pre>\n\n<p>or, in YAML:</p>\n\n<pre><code>Example:\n    field: 42\n    an_enum:\n        A: 76\n</code></pre>\n\n<p>The <code>an_enum</code> is superfluous and annoying to write.  How can I deserialize the first form into the struct? Or, alternatively, how can I declare a struct that will successfully deserialize the syntax I want?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 17099, "user_id": 2890168, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/nDjdp.jpg?s=128&g=1", "display_name": "Matteo Pacini", "link": "https://stackoverflow.com/users/2890168/matteo-pacini"}, "edited": false, "score": 0, "creation_date": 1499863531, "post_id": 45055379, "comment_id": 77089406, "body": "Hey man, thanks for the reply. I really appreciate your answer. I&#39;m currently on Rust-stable and the arena requires nightly. Is there any way I can fix my code without it? Thanks"}], "tags": [], "owner": {"reputation": 3495, "user_id": 36585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0ccd55542e51b1b98f5a72b30c815dc?s=128&d=identicon&r=PG", "display_name": "pnkfelix", "link": "https://stackoverflow.com/users/36585/pnkfelix"}, "is_accepted": true, "score": 3, "last_activity_date": 1499857210, "last_edit_date": 1499857210, "creation_date": 1499855978, "answer_id": 45055379, "question_id": 45055117, "link": "https://stackoverflow.com/questions/45055117/variable-in-loop-does-not-live-long-enough/45055379#45055379", "title": "Variable in loop does not live long enough", "body": "<p>The immediate problem I can see with your design is that your loop is going to modify the <code>hierarchy.keywords</code> vector (in the <code>first_if</code> block), but it also borrows elements from the <code>hierarchy.keywords</code> vector (in the <code>second_if</code> block).</p>\n\n<p>This is problematic, because modifying a vector may cause its backing buffer to be reallocated, which, if it were allowed, would invalidate all existing borrows to the vector. (And thus it is not allowed.)</p>\n\n<p>Have you considered using an <a href=\"https://docs.rs/typed-arena/1.3.0/typed_arena/struct.Arena.html\" rel=\"nofollow noreferrer\">arena</a> to hold your keywords instead of a <code>Vec</code>? Arenas are designed so that you can allocate new things within them while still having outstanding borrows to elements previously allocated within the arena.</p>\n\n<hr>\n\n<p>Update: Here is a revised version of your code that illustrates using an arena (in this case a <code>rustc_arena::TypedArena</code>, but that's just so I can get this running on the play.rust-lang.org service) alongside a <code>Vec&lt;&amp;Keyword&gt;</code> to handle the lookups.</p>\n\n<p><a href=\"https://play.rust-lang.org/?gist=fc6d81cb7efa7e4f32c481ab6482e587&amp;version=nightly&amp;backtrace=0\" rel=\"nofollow noreferrer\">https://play.rust-lang.org/?gist=fc6d81cb7efa7e4f32c481ab6482e587&amp;version=nightly&amp;backtrace=0</a></p>\n\n<p>The crucial bits of code are this:</p>\n\n<p>First: the <code>KeywordHierarchy</code> now holds a arena alongside a vec:</p>\n\n<pre><code>pub struct KeywordHierarchy&lt;'a&gt; {\n    keywords: Vec&lt;&amp;'a Keyword&lt;'a&gt;&gt;,\n    kw_arena: &amp;'a TypedArena&lt;Keyword&lt;'a&gt;&gt;,\n}\n</code></pre>\n\n<p>Second: Adding a keyword now allocates the spot in the arena, and stashes a reference to that spot in the vec:</p>\n\n<pre><code>fn add_keyword(&amp;mut self, keyword: Keyword&lt;'a&gt;) {\n    let kw = self.kw_arena.alloc(keyword);\n    self.keywords.push(kw);\n}\n</code></pre>\n\n<p>Third: the <code>fn parse</code> function now takes an arena (reference) as input, because we need the arena to outlive the stack frame of <code>fn parse</code>:</p>\n\n<pre><code>fn parse&lt;'a&gt;(arena: &amp;'a TypedArena&lt;Keyword&lt;'a&gt;&gt;) -&gt; Result&lt;KeywordHierarchy&lt;'a&gt;, String&gt; {\n    ...\n</code></pre>\n\n<p>Fourth: To avoid borrow-checker issues with borrowing <code>hierarchy</code> as mutable while also iterating over it, I moved the <code>hierarchy</code> modification outside of your Find parent <code>match</code>:</p>\n\n<pre><code>        // Find parent\n        let parent = match hierarchy.keywords.iter().find(|p| p.code == 0) {\n            None =&gt; return Err(String::from(\"No such parent\")),\n            Some(parent) =&gt; *parent, // (this deref is important)\n        };\n        // If parent is found, create a child\n        let child = Keyword {\n            name: String::from(\"CHILD\"),\n            code: 1,\n            parent: Some(parent),\n        };\n        hierarchy.add_keyword(child);\n        second_if = false;\n</code></pre>\n"}], "owner": {"reputation": 17099, "user_id": 2890168, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/nDjdp.jpg?s=128&g=1", "display_name": "Matteo Pacini", "link": "https://stackoverflow.com/users/2890168/matteo-pacini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 499, "favorite_count": 0, "accepted_answer_id": 45055379, "answer_count": 1, "score": 2, "last_activity_date": 1499857210, "creation_date": 1499855248, "question_id": 45055117, "link": "https://stackoverflow.com/questions/45055117/variable-in-loop-does-not-live-long-enough", "title": "Variable in loop does not live long enough", "body": "<p>I've been playing with Rust for the past few days, \nand I'm still struggling with the memory management (figures).</p>\n\n<p>I wrote a <a href=\"https://play.rust-lang.org/?gist=dae5dec2334fbac5fdccb8579dff9a75&amp;version=stable&amp;backtrace=0\" rel=\"nofollow noreferrer\">simple project</a> that creates a hierarchy of structs (\"keywords\") from lexing/parsing a text file.</p>\n\n<p>A <strong>keyword</strong> is defined like this:</p>\n\n<pre><code>pub struct Keyword&lt;'a&gt; {\n    name: String,\n    code: u32,\n    parent: Option&lt;&amp;'a Keyword&lt;'a&gt;&gt;,\n}\n</code></pre>\n\n<p>which is my equivalent for this C struct:</p>\n\n<pre><code>typedef struct Keyword Keyword;\n\nstruct Keyword {\n    char* name;\n    unsigned int code;\n    Keyword* parent;\n};\n</code></pre>\n\n<p>A <strong>hierarchy</strong> is just a container for keywords, defined like this:</p>\n\n<pre><code>pub struct KeywordHierarchy&lt;'a&gt; {\n    keywords: Vec&lt;Box&lt;Keyword&lt;'a&gt;&gt;&gt;,\n}\n\nimpl&lt;'a&gt; KeywordHierarchy&lt;'a&gt; {\n    fn add_keyword(&amp;mut self, keyword: Box&lt;Keyword&lt;'a&gt;&gt;) {\n        self.keywords.push(keyword);\n    }\n}\n</code></pre>\n\n<p>In the <code>parse</code> function (<strong>which is a stub of the complete parser</strong>), I recreated the condition that spawns the lifetime error in my code.</p>\n\n<pre><code>fn parse&lt;'a&gt;() -&gt; Result&lt;KeywordHierarchy&lt;'a&gt;, String&gt; {\n\n    let mut hierarchy = KeywordHierarchy { keywords: Vec::new() };\n\n    let mut first_if = true;\n    let mut second_if = false;\n\n    while true {\n\n        if first_if {\n\n            // All good here.\n\n            let root_keyword = Keyword {\n                name: String::from(\"ROOT\"),\n                code: 0,\n                parent: None,\n            };\n            hierarchy.add_keyword(Box::new(root_keyword));\n\n            first_if = false;\n            second_if = true;\n        }\n\n        if second_if {\n\n            // Hierarchy might have expired here?\n\n            // Find parent\n            match hierarchy.keywords.iter().find(|p| p.code == 0) {\n                None =&gt; return Err(String::from(\"No such parent\")),\n                Some(parent) =&gt; {\n\n                    // If parent is found, create a child\n                    let child = Keyword {\n                        name: String::from(\"CHILD\"),\n                        code: 1,\n                        parent: Some(&amp;parent),\n                    };\n                    hierarchy.add_keyword(Box::new(child));\n                }\n            }\n\n            second_if = false;\n        }\n\n        if !first_if &amp;&amp; !second_if {\n            break;\n        }\n    }\n\n    Ok(hierarchy)\n\n}\n</code></pre>\n\n<p>There's a <code>while</code> loop that goes through the lexer tokens.</p>\n\n<p>In the first <code>if</code>, I add the <strong>ROOT</strong> keyword to the hierarchy, which is the only one that doesn't have a parent, and everything goes smoothly as expected.</p>\n\n<p>In the second <code>if</code>, I parse the children keywords and I get a lifetime error when invoking <code>KeywordHierarchy.add_keyword()</code>.</p>\n\n<pre><code>hierarchy.keywords` does not live long enough\n</code></pre>\n\n<p>Could you guys recommend an idiomatic way to fix this?</p>\n\n<p>Cheers.</p>\n\n<p>P.S. Click <a href=\"https://play.rust-lang.org/?gist=dae5dec2334fbac5fdccb8579dff9a75&amp;version=stable&amp;backtrace=0\" rel=\"nofollow noreferrer\">here</a> for the playground</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1499864098, "post_id": 45054071, "comment_id": 77089861, "body": "I prefer using <code>if let Some(s2) = rc.borrow_mut().as_mut() {</code>, but to each their own."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499864191, "post_id": 45054071, "comment_id": 77089932, "body": "@Shepmaster Please feel free to edit my answer and add your own syntax."}], "tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 6, "last_activity_date": 1499860426, "last_edit_date": 1499860426, "creation_date": 1499852531, "answer_id": 45054071, "question_id": 45053810, "link": "https://stackoverflow.com/questions/45053810/how-do-i-modify-the-content-of-a-refcelloptiont/45054071#45054071", "title": "How do I modify the content of a `RefCell&lt;Option&lt;T&gt;&gt;`?", "body": "<p>When you <a href=\"https://doc.rust-lang.org/std/cell/struct.RefCell.html#method.borrow_mut\" rel=\"nofollow noreferrer\"><code>borrow_mut</code></a> the <code>RefCell</code>, you get a <a href=\"https://doc.rust-lang.org/std/cell/struct.RefMut.html\" rel=\"nofollow noreferrer\"><code>RefMut</code></a>, as the compiler says. To get the value inside it, just use the operator <a href=\"https://doc.rust-lang.org/std/cell/struct.RefMut.html#method.deref_mut\" rel=\"nofollow noreferrer\"><code>deref_mut</code></a>:</p>\n\n<pre><code>use std::cell::RefCell;\n\n#[derive(Debug)]\nstruct S {\n    val: i32\n}\n\nfn main() {\n    let rc: RefCell&lt;Option&lt;S&gt;&gt; = RefCell::new(Some(S{val: 0}));\n\n    if let Some(ref mut s2) = *rc.borrow_mut() { // deref_mut\n        s2.val += 1;\n    }\n    println!(\"{:?}\", rc);\n}\n</code></pre>\n"}], "owner": {"reputation": 9718, "user_id": 87584, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f6dfb6c18bce2c8487312b77c32dbc3?s=128&d=identicon&r=PG", "display_name": "Fabien", "link": "https://stackoverflow.com/users/87584/fabien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1565, "favorite_count": 0, "accepted_answer_id": 45054071, "answer_count": 1, "score": 1, "last_activity_date": 1499864064, "creation_date": 1499851858, "last_edit_date": 1499864064, "question_id": 45053810, "link": "https://stackoverflow.com/questions/45053810/how-do-i-modify-the-content-of-a-refcelloptiont", "title": "How do I modify the content of a `RefCell&lt;Option&lt;T&gt;&gt;`?", "body": "<p>I have an <code>Option&lt;T&gt;</code> that is shared by several structures and that must be mutable. I'm using a <code>RefCell</code> since, as I understand, it is the tool for that job. How do I access (and alter) the content of that <code>Option&lt;T&gt;</code> ?</p>\n\n<p>I tried the following:</p>\n\n<pre><code>use std::cell::RefCell;\n\n#[derive(Debug)]\nstruct S {\n    val: i32\n}\n\nfn main() {\n    let rc: RefCell&lt;Option&lt;S&gt;&gt; = RefCell::new(Some(S{val: 0}));\n    if let Some(ref mut s2) = rc.borrow_mut() {\n        s2.val += 1;\n    }\n    println!(\"{:?}\", rc);\n}\n</code></pre>\n\n<p>But the compiler won't let me do it:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n  --&gt; &lt;anon&gt;:10:12\n   |\n10 |     if let Some(ref mut s2) = rc.borrow_mut() {\n   |            ^^^^^^^^^^^^^^^^ expected struct `std::cell::RefMut`, found enum `std::option::Option`\n   |\n   = note: expected type `std::cell::RefMut&lt;'_, std::option::Option&lt;S&gt;, &gt;`\n              found type `std::option::Option&lt;_&gt;`\n</code></pre>\n"}, {"tags": ["unit-testing", "rust"], "comments": [{"owner": {"reputation": 2959, "user_id": 5903309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/665cdb14fb46d20c11a176c92e6ed663?s=128&d=identicon&r=PG", "display_name": "Jan Nils Ferner", "link": "https://stackoverflow.com/users/5903309/jan-nils-ferner"}, "edited": false, "score": 0, "creation_date": 1499860009, "post_id": 45053381, "comment_id": 77086629, "body": "I think if you change <code>assert_that</code> into a macro, it might show the correct line. Not sure tho."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1499864282, "last_edit_date": 1499864282, "creation_date": 1499863648, "answer_id": 45058135, "question_id": 45053381, "link": "https://stackoverflow.com/questions/45053381/is-it-possible-to-change-the-whole-panic-message/45058135#45058135", "title": "Is it possible to change the whole panic message?", "body": "<p>There's no direct way to adjust the line number that <code>panic!</code> prints.</p>\n\n<p>There is <a href=\"https://github.com/rust-lang/rfcs/issues/1744\" rel=\"nofollow noreferrer\">a proto-RFC</a> to add an attribute that would allow certain methods to be \"hidden\" from backtraces. It's possible that such an attribute would also affect the line number, but it's unclear.</p>\n\n<p><a href=\"https://stackoverflow.com/q/43254340/155423\">How to write a panic! like macro in Rust?</a> describes how you could write your own <code>panic!</code> macro, but it chooses to tear down the entire process, not just the current thread.</p>\n\n<hr>\n\n<p>The important thing is that you just want to control the message, which is possible via <a href=\"https://doc.rust-lang.org/std/panic/fn.set_hook.html\" rel=\"nofollow noreferrer\"><code>panic::set_hook</code></a>. You can pass side-channel information from the test to the panic handler via thread locals.</p>\n\n<pre><code>use std::cell::Cell;\n\nthread_local! {\n    static ASSERT_LOCATION: Cell&lt;Option&lt;(&amp;'static str, u32)&gt;&gt; = Cell::new(None)\n}\n\nfn report_my_error(info: &amp;std::panic::PanicInfo) {\n    match info.location() {\n        Some(location) =&gt; {\n            let file = location.file();\n            let line = location.line();\n            println!(\"The panic actually happened at: {}, {}\", file, line);\n        }\n        None =&gt; println!(\"I don't know where the panic actually happened\"),\n    }\n\n    ASSERT_LOCATION.with(|location| if let Some((file, line)) = location.get() {\n        println!(\n            \"But I'm going to tell you it happened at {}, {}\",\n            file,\n            line\n        );\n    });\n\n    if let Some(msg) = info.payload().downcast_ref::&lt;&amp;str&gt;() {\n        println!(\"The error message was: {}\", msg);\n    }\n}\n\n#[test]\nfn alpha() {\n    std::panic::set_hook(Box::new(report_my_error));\n\n    ASSERT_LOCATION.with(|location| {\n        location.set(Some((file!(), line!())));\n    });\n\n    panic!(\"This was only a test\")\n}\n</code></pre>\n\n<p>You need to ensure your panic handler is set in each test and then set the location information. You may also want to update the panic handler to set the location information back to <code>None</code> to avoid location information leaking between threads.</p>\n\n<p>You will likely want to write your own macro that the user can use in the test to set the line number implicitly. Syntax similar to this could give a place for this setup code to live:</p>\n\n<pre><code>assert_that!(42, is.equal_to(0));\n</code></pre>\n\n<p>Could expand to:</p>\n\n<pre><code>assert_that(file!(), line!(), 42, is.equal_to(0));\n</code></pre>\n\n<p>And I'd probably set that panic handler inside of <code>assert_that</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1500465755, "post_id": 45188721, "comment_id": 77346927, "body": "This does not <i>change</i> the location of the panic message \u2014 it only adds another location, potentially complicating understanding: <code>location: src&#47;utils.rs:344</code>; <code>&#47;src&#47;lib.rs:343</code>."}], "tags": [], "owner": {"reputation": 433, "user_id": 4958456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f57a7388ee6a853860e40a850c88edcc?s=128&d=identicon&r=PG&f=1", "display_name": "Viktor Chv&#225;tal", "link": "https://stackoverflow.com/users/4958456/viktor-chv%c3%a1tal"}, "is_accepted": false, "score": 0, "last_activity_date": 1500465595, "last_edit_date": 1500465595, "creation_date": 1500462391, "answer_id": 45188721, "question_id": 45053381, "link": "https://stackoverflow.com/questions/45053381/is-it-possible-to-change-the-whole-panic-message/45188721#45188721", "title": "Is it possible to change the whole panic message?", "body": "<p>You may interested in using the <a href=\"https://github.com/cfrancia/spectral\" rel=\"nofollow noreferrer\">spectral</a>, a library that provides fluent test assertions for Rust. If you look at their <a href=\"https://github.com/cfrancia/spectral/blob/master/src/lib.rs#L197\" rel=\"nofollow noreferrer\">implementation</a>, as others suggest, they use a macro instead of a function, so <code>line!()</code> and <code>file!()</code> macros are expanded in place where you put the <code>assert_that!</code> macro defined in the library.</p>\n\n<p>Usage is as follows:</p>\n\n<pre><code>#[test]\nfn example() {\n    assert_that!(2).is_equal_to(4);\n}\n</code></pre>\n\n<p>And output, as expected, points to the right line in my library:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>failures:\n\n---- utils::tests::example stdout ----\n        thread 'utils::tests::example' panicked at '\n        expected: &lt;4&gt;\n        but was: &lt;2&gt;\n\n        at location: src/utils.rs:344\n', /home/example/.cargo/registry/src/github.com-1ecc6299db9ec823/spectral-0.6.0/src/lib.rs:343\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\n\n\nfailures:\n    utils::tests::example\n\ntest result: FAILED. 61 passed; 1 failed; 0 ignored; 0 measured\n</code></pre>\n"}], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 235, "favorite_count": 0, "accepted_answer_id": 45058135, "answer_count": 2, "score": 4, "last_activity_date": 1532025570, "creation_date": 1499850760, "last_edit_date": 1532025570, "question_id": 45053381, "link": "https://stackoverflow.com/questions/45053381/is-it-possible-to-change-the-whole-panic-message", "title": "Is it possible to change the whole panic message?", "body": "<p>NUnit is a C# unit-test framework that permits you to write code like this:</p>\n\n<pre><code>Assert.That(someInt, Is.EqualTo(42));\nAssert.That(someList, Has.Member(someMember));\n</code></pre>\n\n<p>I like this kind of code because it is easily readable by looking like English.</p>\n\n<hr>\n\n<p>I am playing with Rust to see if I can create a library that gives the same feelings:</p>\n\n<pre><code>use std::fmt::Debug;\n\nstruct Is;\n\nenum Verb&lt;T&gt; {\n    EqualTo(T),\n}\n\nimpl Is {\n    fn equal_to&lt;T&gt;(&amp;self, obj: T) -&gt; Verb&lt;T&gt; {\n        Verb::EqualTo(obj)\n    }\n}\n\n#[allow(non_upper_case_globals)]\nconst is: Is = Is{};\n\nfn assert_that&lt;T: Eq + Debug&gt;(obj: T, verb: Verb&lt;T&gt;) {\n    match verb {\n        Verb::EqualTo(rhs)    =&gt; assert_eq!(obj, rhs),\n    }\n}\n\nfn main() {\n    assert_that(42, is.equal_to(42));\n    assert_that(42, is.equal_to(0));\n}\n</code></pre>\n\n<p>This is good, but for one thing: when the code panics at <code>assert_that(42, is.equal_to(0))</code>, the line given by the panic is the line of <code>assert_eq!(obj, rhs)</code> (<em>i.e.</em> in the library instead of user's code). I know this behavior is normal, but I would have a more useful message.</p>\n\n<p>How to indicate the right line number in the panic?</p>\n"}, {"tags": ["methods", "properties", "rust", "traits"], "comments": [{"owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "edited": false, "score": 1, "creation_date": 1499839668, "post_id": 45049287, "comment_id": 77072905, "body": "These are compile-time errors; why would you need any other way of checking for them?"}, {"owner": {"reputation": 347, "user_id": 5552801, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YPYG6.jpg?s=128&g=1", "display_name": "HTDE", "link": "https://stackoverflow.com/users/5552801/htde"}, "reply_to_user": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "edited": false, "score": 0, "creation_date": 1499841122, "post_id": 45049287, "comment_id": 77073644, "body": "I was posting the errors for the description. I just may need to check for these at run-time because my elements are heterogeneous and there is some dynamic logic, for example, handling events. Does rust support checking for existing fields or methods?"}, {"owner": {"reputation": 22583, "user_id": 1103681, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/rMUo3.png?s=128&g=1", "display_name": "oli_obk", "link": "https://stackoverflow.com/users/1103681/oli-obk"}, "edited": false, "score": 1, "creation_date": 1499841239, "post_id": 45049287, "comment_id": 77073700, "body": "How are your elements heterogenous? Do you have <code>Vec&lt;Box&lt;Trait&gt;&gt;</code>?"}, {"owner": {"reputation": 347, "user_id": 5552801, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YPYG6.jpg?s=128&g=1", "display_name": "HTDE", "link": "https://stackoverflow.com/users/5552801/htde"}, "edited": false, "score": 0, "creation_date": 1499841328, "post_id": 45049287, "comment_id": 77073751, "body": "yes that&#39;s what i&#39;m using -- and it delegates from that traits method into others, like self.Controller.Method1. I am still in the desigining phase and new to Rust."}], "answers": [{"comments": [{"owner": {"reputation": 347, "user_id": 5552801, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YPYG6.jpg?s=128&g=1", "display_name": "HTDE", "link": "https://stackoverflow.com/users/5552801/htde"}, "edited": false, "score": 0, "creation_date": 1499841677, "post_id": 45050169, "comment_id": 77073944, "body": "OK. Thanks for the answer. I have seen this before, but it would not work for a fully modular design. Hopefully I just do not need to check at run-time anyway."}, {"owner": {"reputation": 347, "user_id": 5552801, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YPYG6.jpg?s=128&g=1", "display_name": "HTDE", "link": "https://stackoverflow.com/users/5552801/htde"}, "edited": false, "score": 0, "creation_date": 1499841779, "post_id": 45050169, "comment_id": 77073991, "body": "(For example, if new Traits are created for a particular element, then all elements would then need essentially this &quot;empty&quot; trait to compensate)"}, {"owner": {"reputation": 22583, "user_id": 1103681, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/rMUo3.png?s=128&g=1", "display_name": "oli_obk", "link": "https://stackoverflow.com/users/1103681/oli-obk"}, "reply_to_user": {"reputation": 347, "user_id": 5552801, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YPYG6.jpg?s=128&g=1", "display_name": "HTDE", "link": "https://stackoverflow.com/users/5552801/htde"}, "edited": false, "score": 1, "creation_date": 1499842135, "post_id": 45050169, "comment_id": 77074167, "body": "@HTDE are you sure you don&#39;t want to use an enum? Another alternative is to offer a <code>fn has_my_xyztrait(&amp;self) -&gt; Option&lt;&amp;XYZTrait&gt;</code> which downcasts to a specific trait that only some elements might implement. This way you only have to do this per trait, instead of per method or field."}, {"owner": {"reputation": 22583, "user_id": 1103681, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/rMUo3.png?s=128&g=1", "display_name": "oli_obk", "link": "https://stackoverflow.com/users/1103681/oli-obk"}, "reply_to_user": {"reputation": 347, "user_id": 5552801, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YPYG6.jpg?s=128&g=1", "display_name": "HTDE", "link": "https://stackoverflow.com/users/5552801/htde"}, "edited": false, "score": 0, "creation_date": 1499842172, "post_id": 45050169, "comment_id": 77074191, "body": "Note: you should definitely use an enum if users of your library don&#39;t ever need to create new element types."}, {"owner": {"reputation": 347, "user_id": 5552801, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YPYG6.jpg?s=128&g=1", "display_name": "HTDE", "link": "https://stackoverflow.com/users/5552801/htde"}, "edited": false, "score": 0, "creation_date": 1499842404, "post_id": 45050169, "comment_id": 77074354, "body": "I agree! I am trying to understand the first comment about downcasting to a specific trait. Is there an example or documentation I can view? Thanks!"}, {"owner": {"reputation": 22583, "user_id": 1103681, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/rMUo3.png?s=128&g=1", "display_name": "oli_obk", "link": "https://stackoverflow.com/users/1103681/oli-obk"}, "reply_to_user": {"reputation": 347, "user_id": 5552801, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YPYG6.jpg?s=128&g=1", "display_name": "HTDE", "link": "https://stackoverflow.com/users/5552801/htde"}, "edited": false, "score": 0, "creation_date": 1499846190, "post_id": 45050169, "comment_id": 77076789, "body": "You just found the limitation: downcasting is only possible to types, not traits. The docs are the docs of the <code>Any</code> trait."}], "tags": [], "owner": {"reputation": 22583, "user_id": 1103681, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/rMUo3.png?s=128&g=1", "display_name": "oli_obk", "link": "https://stackoverflow.com/users/1103681/oli-obk"}, "is_accepted": true, "score": 2, "last_activity_date": 1499841445, "creation_date": 1499841445, "answer_id": 45050169, "question_id": 45049287, "link": "https://stackoverflow.com/questions/45049287/check-if-property-or-method-exists-at-runtime-check-if-trait-exists-at-runtime/45050169#45050169", "title": "Check if property or method exists at runtime? Check if Trait exists at runtime?", "body": "<p>This concept doesn't exist in Rust. While there is some limited downcast capability through <code>Any</code>, this should be used as a last resort. What you should do is create a new trait that exposes all of these decisions for you.</p>\n\n<p>Reusing your example of a <code>my_method</code> method:</p>\n\n<pre><code>trait YourTrait {\n    fn try_my_method(&amp;self, arg: SomeArg) -&gt; Option&lt;MyMethodResult&gt; {\n        None\n    }\n}\n\nimpl YourTrait for SomeType {\n    fn try_my_method(&amp;self, arg: SomeArg) -&gt; Option&lt;MyMethodResult&gt; {\n        Some(self.my_method(arg))\n    }\n}\n</code></pre>\n\n<p>In your code you can then call</p>\n\n<pre><code>if let Some(result) = self.try_my_method() {\n    /* ... */\n}\n</code></pre>\n"}], "owner": {"reputation": 347, "user_id": 5552801, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YPYG6.jpg?s=128&g=1", "display_name": "HTDE", "link": "https://stackoverflow.com/users/5552801/htde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1003, "favorite_count": 0, "accepted_answer_id": 45050169, "answer_count": 1, "score": 0, "last_activity_date": 1499841546, "creation_date": 1499838189, "last_edit_date": 1499841546, "question_id": 45049287, "link": "https://stackoverflow.com/questions/45049287/check-if-property-or-method-exists-at-runtime-check-if-trait-exists-at-runtime", "title": "Check if property or method exists at runtime? Check if Trait exists at runtime?", "body": "<p>Looking for the proper way to do</p>\n\n<pre><code>if(self.MyProperty) { /* ... */ }\n</code></pre>\n\n<blockquote>\n  <p>error: attempted access of field <code>MyProperty</code> on type <code>MyType</code>, but no field with that name was found     </p>\n</blockquote>\n\n<p>or</p>\n\n<pre><code>if(self.MyMethod){ /* ... */ }\n</code></pre>\n\n<blockquote>\n  <p>error: attempted to take value of method <code>MyMethod</code> on type <code>MyType</code>  </p>\n</blockquote>\n\n<p>As a last resort, at least how does one check if a Trait is Implemented?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499821568, "post_id": 45046648, "comment_id": 77067520, "body": "Please review how to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. You should be able to provide, in the question, example code that produces the errors you are receiving. Without that, we can&#39;t understand what your problem is. Right now, your sample code isn&#39;t even <i>syntactically valid</i>, but I&#39;m sure you don&#39;t want answers on how to properly close your parenthesis! ^_^ Attempting to compile it in one of the <a href=\"https://play.integer32.com/\" rel=\"nofollow noreferrer\">playgrounds</a> should help you create a MCVE."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 3727440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/484f2bac401a1671faa7e9557490421a?s=128&d=identicon&r=PG&f=1", "display_name": "Noxivs", "link": "https://stackoverflow.com/users/3727440/noxivs"}, "edited": false, "score": 0, "creation_date": 1499823415, "post_id": 45046830, "comment_id": 77067975, "body": "Thank you a lot for your tips and help ;). I would have loved to provide a Minimal/Complete/Verifiable example but my &quot;example&quot; was pure sci-fi in my head."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 4, "last_activity_date": 1499822759, "creation_date": 1499822759, "answer_id": 45046830, "question_id": 45046648, "link": "https://stackoverflow.com/questions/45046648/is-it-possible-to-use-the-any-trait-through-channels/45046830#45046830", "title": "Is it possible to use the Any trait through channels?", "body": "<p>Yes, it is possible to send a <em>boxed trait object</em> of the <code>Any</code> trait through a channel:</p>\n\n<pre><code>use std::sync::mpsc::{channel, Sender};\nuse std::any::Any;\n\nfn main() {\n    let (chan, port) = channel();\n\n    load(chan);\n\n    let r = port.recv().expect(\"Unable to receive\");\n    println!(\"{}\", r.downcast_ref::&lt;String&gt;().expect(\"Not a string\"));\n}\n\npub fn load(sender: Sender&lt;Box&lt;Any&gt;&gt;) {\n    let s = String::from(\"test\");\n    let s = Box::new(s) as Box&lt;Any&gt;;\n    sender.send(s).expect(\"Unable to send\");\n}\n</code></pre>\n\n<hr>\n\n<p>Your original attempt doesn't make sense:</p>\n\n<pre><code>pub fn load&lt;T:Send + Any&gt;(sender: Sender&lt;Option&lt;T&gt;&gt;)\n</code></pre>\n\n<p>A generic type is determined at compile time, which means that <code>T</code> is a fixed type, such as <code>String</code>. If you know the type that is going through the channel, you don't need to use <code>Any</code></p>\n\n<pre><code>String::new(\"test\") as Any\n</code></pre>\n\n<p>This doesn't make sense because <code>String::new</code> takes no arguments. Additionally, you cannot cast a value to a trait - traits have no known size. They always need to be behind a pointer of some kind.</p>\n"}], "owner": {"reputation": 21, "user_id": 3727440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/484f2bac401a1671faa7e9557490421a?s=128&d=identicon&r=PG&f=1", "display_name": "Noxivs", "link": "https://stackoverflow.com/users/3727440/noxivs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 45046830, "answer_count": 1, "score": 0, "last_activity_date": 1499822759, "creation_date": 1499821207, "last_edit_date": 1499821614, "question_id": 45046648, "link": "https://stackoverflow.com/questions/45046648/is-it-possible-to-use-the-any-trait-through-channels", "title": "Is it possible to use the Any trait through channels?", "body": "<p>This example is not right but it gives an idea of what I expect:</p>\n\n<pre><code>fn main() {\n    let (chan, port) = channel();\n\n    load(chan);\n\n    let r = port.recv().unwrap().unwrap();\n    println!(\"{}\", r.downcast_ref::&lt;String&gt;().unwrap());\n}\n\npub fn load&lt;T:Send + Any&gt;(sender: Sender&lt;Option&lt;T&gt;&gt;) {\n    // do some works\n\n    sender.send(Some(String::new(\"test\") as Any);\n}\n</code></pre>\n\n<p>I can't go further than this, due to these kinds of errors:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: non-scalar cast:\nerror: cast to unsized type:\n</code></pre>\n\n<p>I am not sure, but Servo has something similar using the <code>Deserialize</code>/<code>Serialize</code> traits from Serde.</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499813833, "post_id": 45045539, "comment_id": 77065708, "body": "Or <code>|c| char::is_whitespace(c) || c == &#39;,&#39;</code> \u2014 for whatever reason I dislike specifying types in closure argument lists."}, {"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499814098, "post_id": 45045539, "comment_id": 77065768, "body": "Fair. Are there any community guidelines for stuff like this?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499814183, "post_id": 45045539, "comment_id": 77065797, "body": "I don&#39;t think there is anything for this particular case; this is just my pure preference. Rustfmt is my normal go-to for the official style."}], "tags": [], "owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "is_accepted": true, "score": 3, "last_activity_date": 1499813960, "last_edit_date": 1499813960, "creation_date": 1499812622, "answer_id": 45045539, "question_id": 45045397, "link": "https://stackoverflow.com/questions/45045397/cannot-infer-value-type-even-when-explict/45045539#45045539", "title": "Cannot infer value type even when explict", "body": "<p>The <a href=\"https://doc.rust-lang.org/std/string/struct.String.html#method.split\" rel=\"nofollow noreferrer\"><code>.split</code></a> method accepts anything satisfying the <code>Pattern&lt;'a&gt;</code> trait bound. In this case, Rust cannot know what type of function this is because it does not know what the type of the function parameter is.</p>\n\n<p>Looking at <a href=\"https://doc.rust-lang.org/std/str/pattern/trait.Pattern.html\" rel=\"nofollow noreferrer\"><code>Pattern</code></a> there is an implementation for <code>FnMut</code>:</p>\n\n<pre><code>impl&lt;'a, F&gt; Pattern&lt;'a&gt; for F \nwhere\n    F: FnMut(char) -&gt; bool,\n</code></pre>\n\n<p>To tell the compiler that this is the pattern you want, you need to give enough information for it to know that your closure matches this. </p>\n\n<p>In this case, this means you can add <code>: char</code>. You must also remove <code>::&lt;char&gt;</code>, because it is an <code>unneeded type parameter</code>. e.g.</p>\n\n<pre><code>text.split(|c| c.is_whitespace::&lt;char&gt;() || c == ',' )\n</code></pre>\n\n<p>to</p>\n\n<pre><code>text.split(|c: char| c.is_whitespace() || c == ',' )\n</code></pre>\n"}], "owner": {"reputation": 1498, "user_id": 6844327, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9fWJl.jpg?s=128&g=1", "display_name": "HiDefender", "link": "https://stackoverflow.com/users/6844327/hidefender"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 45045539, "answer_count": 1, "score": 2, "last_activity_date": 1499813960, "creation_date": 1499811821, "last_edit_date": 1499813556, "question_id": 45045397, "link": "https://stackoverflow.com/questions/45045397/cannot-infer-value-type-even-when-explict", "title": "Cannot infer value type even when explict", "body": "<p>I need to split a string on whitespace and several other chars.</p>\n\n<pre><code>let mut text = String::from(\"foo,bar baz\");\nfor word in text.split(|c| c.is_whitespace::&lt;char&gt;() || c == ',' ).filter(|&amp;s| !s.is_empty()) {\n    println!(\"{}\", word);\n}\n</code></pre>\n\n<p>However the compiler says:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: the type of this value must be known in this context\n --&gt; src/main.rs:4:32\n  |\n4 |     for word in text.split(|c| c.is_whitespace::&lt;char&gt;() || c == ',').filter(|&amp;s| !s.is_empty()) {\n  |                                ^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>What am I doing wrong? Why can it not infer the type?</p>\n"}, {"tags": ["rust", "libtcod"], "comments": [{"owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499804448, "post_id": 45043728, "comment_id": 77061989, "body": "Understood. That might actually solve my problem. I&#39;ll remove the C++ tag."}], "answers": [{"comments": [{"owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "edited": false, "score": 0, "creation_date": 1499806726, "post_id": 45043944, "comment_id": 77063076, "body": "Awesome. Your comment above did indeed answer my question. TCOD_putwchar came from me searching <code>tcod_sys</code> for anything that &quot;put chars&quot;. <code>ffi::TCOD_console_put_char_ex</code> didn&#39;t come up that I know of. Good to know!"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1499805907, "last_edit_date": 1499805907, "creation_date": 1499804990, "answer_id": 45043944, "question_id": 45043728, "link": "https://stackoverflow.com/questions/45043728/how-do-i-use-libtcod-graphical-tiles-if-char-cannot-fit-a-number-256/45043944#45043944", "title": "How do I use libTCOD graphical tiles if `char` cannot fit a number &gt;=256?", "body": "<p>The <a href=\"https://github.com/tomassedovic/tcod-rs/blob/63b6341e7489b9c319f33e80a677393dedbfb71a/src/console.rs#L762-L772\" rel=\"nofollow noreferrer\"><code>Console::put_char_ex</code> method</a> indeed takes <code>char</code>. However, <a href=\"https://doc.rust-lang.org/std/primitive.char.html\" rel=\"nofollow noreferrer\">Rust's <code>char</code></a> is not the same as C's:</p>\n\n<blockquote>\n  <p><code>char</code> is always four bytes in size.</p>\n</blockquote>\n\n<p>You should be able to fit whatever numeric value you need.</p>\n\n<hr>\n\n<blockquote>\n  <p>(or the C version, <code>TCOD_putwchar</code>) </p>\n</blockquote>\n\n<p>Note that <code>put_char_ex</code> actually calls <code>ffi::TCOD_console_put_char_ex</code>; I'm not sure where <code>TCOD_putwchar</code> came from.</p>\n"}], "owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "accepted_answer_id": 45043944, "answer_count": 1, "score": 1, "last_activity_date": 1499805907, "creation_date": 1499804069, "last_edit_date": 1499805141, "question_id": 45043728, "link": "https://stackoverflow.com/questions/45043728/how-do-i-use-libtcod-graphical-tiles-if-char-cannot-fit-a-number-256", "title": "How do I use libTCOD graphical tiles if `char` cannot fit a number &gt;=256?", "body": "<p>I am trying to add graphical tiles to my roguelike using the <a href=\"https://github.com/tomassedovic/tcod-rs\" rel=\"nofollow noreferrer\">tcod-rs</a> library. </p>\n\n<p>The root console's <code>put_char_ex</code> function (or the C version, <code>TCOD_putwchar</code>) both take only <code>char</code>s. To use tiles, as per the <a href=\"http://www.roguebasin.com/index.php?title=Complete_Roguelike_Tutorial,_using_Python%2Blibtcod,_extras#Using_Graphical_Tiles\" rel=\"nofollow noreferrer\">Python tutorial</a>, you must use tile numbers higher than 256 because the default bitmap font has 256 characters. <code>char</code> cannot represent these high numbers, so I'm stuck. How should I do this?</p>\n"}, {"tags": ["java", "floating-point", "rust", "microbenchmark", "jmh"], "comments": [{"owner": {"reputation": 851, "user_id": 2764866, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/cUip8.png?s=128&g=1", "display_name": "Wietlol", "link": "https://stackoverflow.com/users/2764866/wietlol"}, "edited": false, "score": 1, "creation_date": 1499784323, "post_id": 45037547, "comment_id": 77049529, "body": "Isnt java bad to use as benchmark basis? I mean java is nice but in some cases, it is too nice"}, {"owner": {"reputation": 7214, "user_id": 392585, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5ac7b1da0f2e9107b5020f88023a15e5?s=128&d=identicon&r=PG", "display_name": "Simon Byrne", "link": "https://stackoverflow.com/users/392585/simon-byrne"}, "edited": false, "score": 3, "creation_date": 1499793292, "post_id": 45037547, "comment_id": 77055773, "body": "You&#39;re probably benchmarking the random number generator more than the log function. Also, I believe that Rust just uses the system math library, so a pure call to <code>log</code> should be the same as what it is in C (no idea about Java)."}, {"owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 3, "creation_date": 1499793713, "post_id": 45037547, "comment_id": 77055999, "body": "Could you rerun the test using <code>RUSTFLAGS=&#39;-Ctarget-cpu=native&#39; cargo bench</code>?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 7214, "user_id": 392585, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5ac7b1da0f2e9107b5020f88023a15e5?s=128&d=identicon&r=PG", "display_name": "Simon Byrne", "link": "https://stackoverflow.com/users/392585/simon-byrne"}, "edited": false, "score": 1, "creation_date": 1499798222, "post_id": 45037547, "comment_id": 77058626, "body": "@SimonByrne if OP were accidentally benchmarking the RNG, wouldn&#39;t that be offset by the <code>bench_rnd</code> function which <i>only</i> tests the RNG? That&#39;s why OP subtracts the two Rust benchmark timings \u2014 to make a pure benchmark of the <code>ln</code> function. I&#39;d agree that it should just be calling the system math library though."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1499819108, "post_id": 45037547, "comment_id": 77066962, "body": "I know nothing in java but are you sure that x is update ?"}], "answers": [{"tags": [], "owner": {"reputation": 487, "user_id": 5388450, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-qLG4_TrbSJg/AAAAAAAAAAI/AAAAAAAAAj4/SKl5L6G8Z38/photo.jpg?sz=128", "display_name": "\u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440 \u041c\u0435\u043d\u044c\u0448\u0438\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/5388450/%d0%90%d0%bb%d0%b5%d0%ba%d1%81%d0%b0%d0%bd%d0%b4%d1%80-%d0%9c%d0%b5%d0%bd%d1%8c%d1%88%d0%b8%d0%ba%d0%be%d0%b2"}, "is_accepted": true, "score": 11, "last_activity_date": 1499864389, "last_edit_date": 1499864389, "creation_date": 1499864337, "answer_id": 45058366, "question_id": 45037547, "link": "https://stackoverflow.com/questions/45037547/why-is-logarithm-slower-in-rust-than-in-java/45058366#45058366", "title": "Why is logarithm slower in Rust than in Java?", "body": "<p>The answer was <a href=\"https://stackoverflow.com/questions/45037547/why-is-logarithm-slower-in-rust-than-in-java#comment77055999_45037547\">given by @kennytm</a>:</p>\n\n<pre><code>export RUSTFLAGS='-Ctarget-cpu=native'\n</code></pre>\n\n<p>Fixes the problem. After that, the results are:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>test tests::bench_ln              ... bench:          43 ns/iter (+/- 3)\ntest tests::bench_rnd             ... bench:           5 ns/iter (+/- 0)\n</code></pre>\n\n<p>I think 38 (\u00b1 3) is close enough to 31.555 (\u00b1 0.234).</p>\n"}, {"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 11, "creation_date": 1499874378, "post_id": 45060029, "comment_id": 77097889, "body": "Since Rust is statically (or AOT, if you&#39;d like) compiled, it has to know a single platform to compile to. By default, it will be kind of conservative (32-bit x86 code might target the 686 processor, for example). The <code>-Ctarget-cpu=native</code> flag tells the compiler to target the machine that the compiler is running on; this allows the compiler to use the full set of available instructions (like your <code>popcnt</code> example)."}], "tags": [], "owner": {"reputation": 101145, "user_id": 1059372, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/W6OMC.png?s=128&g=1", "display_name": "Eugene", "link": "https://stackoverflow.com/users/1059372/eugene"}, "is_accepted": false, "score": 9, "last_activity_date": 1499874210, "last_edit_date": 1499874210, "creation_date": 1499868499, "answer_id": 45060029, "question_id": 45037547, "link": "https://stackoverflow.com/questions/45037547/why-is-logarithm-slower-in-rust-than-in-java/45060029#45060029", "title": "Why is logarithm slower in Rust than in Java?", "body": "<p>I'm going to provide the other half of the explanation since I don't know Rust. <code>Math.log</code> is annotated with <code>@HotSpotIntrinsicCandidate</code> meaning that it will be replaced by a native CPU instruction for such an operation: think <code>Integer.bitCount</code> that would either do a lot of shifting or use a direct CPU instruction that does that much faster.</p>\n\n<p>Having an extremely simple program like this:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>public static void main(String[] args) {\n    System.out.println(mathLn(20_000));\n}\n\nprivate static long mathLn(int x) {\n    long result = 0L;\n    for (int i = 0; i &lt; x; ++i) {\n        result = result + ln(i);\n    }\n    return result;\n}\n\nprivate static final long ln(int x) {\n    return (long) Math.log(x);\n}\n</code></pre>\n\n<p>And running it with:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code> java -XX:+UnlockDiagnosticVMOptions  \n      -XX:+PrintInlining \n      -XX:+PrintIntrinsics \n      -XX:CICompilerCount=2 \n      -XX:+PrintCompilation  \n      package/Classname \n</code></pre>\n\n<p>It will generate a lot of lines, but one of them is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code> @ 2   java.lang.Math::log (5 bytes)   intrinsic\n</code></pre>\n\n<p>making this code extremely fast. </p>\n\n<p>I don't really know when and how that happens in Rust though... </p>\n"}], "owner": {"reputation": 487, "user_id": 5388450, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-qLG4_TrbSJg/AAAAAAAAAAI/AAAAAAAAAj4/SKl5L6G8Z38/photo.jpg?sz=128", "display_name": "\u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440 \u041c\u0435\u043d\u044c\u0448\u0438\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/5388450/%d0%90%d0%bb%d0%b5%d0%ba%d1%81%d0%b0%d0%bd%d0%b4%d1%80-%d0%9c%d0%b5%d0%bd%d1%8c%d1%88%d0%b8%d0%ba%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2407, "favorite_count": 4, "accepted_answer_id": 45058366, "answer_count": 2, "score": 19, "last_activity_date": 1499874210, "creation_date": 1499783582, "last_edit_date": 1499786494, "question_id": 45037547, "link": "https://stackoverflow.com/questions/45037547/why-is-logarithm-slower-in-rust-than-in-java", "title": "Why is logarithm slower in Rust than in Java?", "body": "<p>If I run these benchmarks in Rust:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[bench]\nfn bench_rnd(b: &amp;mut Bencher) {\n    let mut rng = rand::weak_rng();\n    b.iter(|| rng.gen_range::&lt;f64&gt;(2.0, 100.0));\n}\n\n#[bench]\nfn bench_ln(b: &amp;mut Bencher) {\n    let mut rng = rand::weak_rng();\n    b.iter(|| rng.gen_range::&lt;f64&gt;(2.0, 100.0).ln());\n}\n</code></pre>\n\n<p>The result is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>test tests::bench_ln             ... bench:        121 ns/iter (+/- 2)\ntest tests::bench_rnd            ... bench:          6 ns/iter (+/- 0)\n</code></pre>\n\n<p>121-6 = 115 ns per <code>ln</code> call.</p>\n\n<p>But the same benchmark in Java:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>@State(Scope.Benchmark)\npublic static class Rnd {\n    final double x = ThreadLocalRandom.current().nextDouble(2, 100);\n}\n\n@Benchmark\npublic double testLog(Rnd rnd) {\n    return Math.log(rnd.x);\n}\n</code></pre>\n\n<p>Gives me:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Benchmark    Mode Cnt  Score  Error Units\nMain.testLog avgt  20 31,555 \u00b1 0,234 ns/op\n</code></pre>\n\n<p>The log is ~3.7 times slower (115/31) in Rust than in Java.</p>\n\n<p>When I test the hypotenuse implementation (<code>hypot</code>), the implementation in Rust is 15.8 times faster than in Java.</p>\n\n<p>Have I written bad benchmarks or it is a performance issue?</p>\n\n<p>Responses to questions asked in comments:</p>\n\n<ol>\n<li><p>\",\" is a decimal separator in my country.</p></li>\n<li><p>I run Rust's benchmark using <code>cargo bench</code> which always runs in release mode.</p></li>\n<li><p>The Java benchmark framework (JMH) creates a new object for every call, even though it's a <code>static</code> class and a <code>final</code> variable. If I add a random creation in the tested method, I get 43 ns/op.</p></li>\n</ol>\n"}, {"tags": ["rust", "mutable"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1499782203, "post_id": 45036679, "comment_id": 77047792, "body": "FYI, <code>!(j == i)</code> would normally be written as <code>j != i</code>."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499847672, "post_id": 45036679, "comment_id": 77077830, "body": "Maybe you want this ? <a href=\"https://play.rust-lang.org/?gist=2f7b96cfd423fbf8586608388c68ba0e&amp;version=stable&amp;backtrace=0\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 325758, "user_id": 415784, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2WX9Z.jpg?s=128&g=1", "display_name": "Nawaz", "link": "https://stackoverflow.com/users/415784/nawaz"}, "edited": false, "score": 0, "creation_date": 1538283238, "post_id": 45036797, "comment_id": 92085302, "body": "I didn&#39;t get it. What exactly is wrong with <code>&amp;mut sum</code>? That seems to make more sense to me. Even I wrote that ending up with the same error. Now when you write just <code>sum</code>, that makes it immutable and copied, right? I want the reference to the object so that I can modify it, so I wrote <code>&amp;mut sum</code>. Please explain why is that wrong?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 325758, "user_id": 415784, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2WX9Z.jpg?s=128&g=1", "display_name": "Nawaz", "link": "https://stackoverflow.com/users/415784/nawaz"}, "edited": false, "score": 1, "creation_date": 1538927697, "post_id": 45036797, "comment_id": 92307369, "body": "@Nawaz In a pattern, the structure that is matched is removed. For example, in <code>Some(foo)</code> the <code>Some</code> wrapper is removed, leaving <code>foo</code> bound to the value inside. The same happens with <code>&amp;</code> or <code>&amp;mut</code> in a pattern."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 4, "last_activity_date": 1499824551, "last_edit_date": 1499824551, "creation_date": 1499781867, "answer_id": 45036797, "question_id": 45036679, "link": "https://stackoverflow.com/questions/45036679/re-assignment-of-immutable-variable-that-should-be-a-mutable-borrow-in-a-loop/45036797#45036797", "title": "Re-assignment of immutable variable that should be a mutable borrow in a loop", "body": "<p>I don't know why you decided to add <code>&amp;mut</code> to the pattern for the loop variable, but that's the problem. You need to take the mutable reference directly and then dereference it when you increment it:</p>\n\n<pre><code>fn main() {\n    let mut sums = vec![1, 2, 3];\n    let i = 0;\n    let n = 0;\n\n    for (j, sum) in sums.iter_mut().enumerate() {\n        if j != i {\n            *sum += n;\n        }\n    }\n}\n</code></pre>\n\n<p>With <code>&amp;mut</code> in the pattern, you are actually destructuring the variable and removing the mutable reference. If you <a href=\"https://stackoverflow.com/q/21747136/155423\">print the type of your <code>sum</code> variable</a>, you'll see that it's an <code>i64</code>.</p>\n"}], "owner": {"reputation": 3, "user_id": 6187172, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61c68815802bd158b04fb98792ad5bec?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Land", "link": "https://stackoverflow.com/users/6187172/mike-land"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 942, "favorite_count": 0, "accepted_answer_id": 45036797, "answer_count": 1, "score": 0, "last_activity_date": 1499824551, "creation_date": 1499781558, "last_edit_date": 1499782071, "question_id": 45036679, "link": "https://stackoverflow.com/questions/45036679/re-assignment-of-immutable-variable-that-should-be-a-mutable-borrow-in-a-loop", "title": "Re-assignment of immutable variable that should be a mutable borrow in a loop", "body": "<p>I am trying to modify a mutable <code>sums: Vec&lt;i64&gt;</code> while iterating over it. The loop code is as follows:</p>\n\n<pre><code>for (j, &amp;mut sum) in sums.iter_mut().enumerate() {\n    if !(j == i) {\n        sum += n;\n    }\n}\n</code></pre>\n\n<p>And here is the error I get:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0384]: re-assignment of immutable variable `sum`\n  --&gt; mini_max_sum.rs:27:17\n   |\n25 |         for (j, &amp;mut sum) in sums.iter_mut().enumerate() {\n   |                      --- first assignment to `sum`\n26 |             if !(j == i) {\n27 |                 sum += n;\n   |                 ^^^^^^^^ re-assignment of immutable variable\n</code></pre>\n\n<p>This seems totally arcane to me. Rust lets me mutably borrow <code>sum</code> from <code>sums</code>, but the compiler prevents me from actually modifying it. Omitting <code>.enumerate()</code> does not even alter the resulting error code.</p>\n\n<p>I would like to know how to fix the loop.</p>\n"}, {"tags": ["rust", "terminology", "type-theory"], "comments": [{"owner": {"reputation": 22050, "user_id": 497364, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8fd4eb2ae966a16e698b3e61217a7e1?s=128&d=identicon&r=PG", "display_name": "Paolo Falabella", "link": "https://stackoverflow.com/users/497364/paolo-falabella"}, "reply_to_user": {"reputation": 13883, "user_id": 2883245, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/NPpPG.jpg?s=128&g=1", "display_name": "erip", "link": "https://stackoverflow.com/users/2883245/erip"}, "edited": false, "score": 0, "creation_date": 1499779755, "post_id": 45033804, "comment_id": 77045800, "body": "@erip in Rust this is not an existential type. It&#39;s just asking the compiler to infer the actual type looking at the local scope, but it&#39;s generally equivalent to fully typing the one specific type that can go in that _ (which is why they sometimes call it a &quot;placeholder&quot;)."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "reply_to_user": {"reputation": 13883, "user_id": 2883245, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/NPpPG.jpg?s=128&g=1", "display_name": "erip", "link": "https://stackoverflow.com/users/2883245/erip"}, "edited": false, "score": 0, "creation_date": 1499780056, "post_id": 45033804, "comment_id": 77046046, "body": "@erip Existential quantification means that some of a type&#39;s constructors  depend on type parameters which are not parameters of the type itself. In Rust, this is more akin to a trait object, which has a hidden type parameter - the concrete implementation of the trait. The <code>_</code> here does not mean an existential type, it just means that you have omitted the type parameter because the compiler can infer it. I am not very familiar with Scala, but if the Scala &quot;existential type&quot; has the same semantics then it is incorrectly named."}], "answers": [{"comments": [{"owner": {"reputation": 4257, "user_id": 3347227, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/160c472b1c6c43b47cc98cc01d3ce317?s=128&d=identicon&r=PG", "display_name": "Erik Vesteraas", "link": "https://stackoverflow.com/users/3347227/erik-vesteraas"}, "edited": false, "score": 3, "creation_date": 1499776327, "post_id": 45034492, "comment_id": 77042898, "body": "Note that the underscore used in pattern matching, the ignored pattern, is a different underscore. Remember that you can only match on variants of a single type. This underscore is on the type level, which is why it would be useful with terminology that disambiguates the two. Not sure if there is any terminology to find though."}], "tags": [], "owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "is_accepted": false, "score": 8, "last_activity_date": 1499777124, "last_edit_date": 1499777124, "creation_date": 1499775682, "answer_id": 45034492, "question_id": 45033804, "link": "https://stackoverflow.com/questions/45033804/what-is-the-correct-term-for-in-a-type-hint/45034492#45034492", "title": "What is the correct term for _ in a type hint?", "body": "<p>I was able to find a <a href=\"https://doc.rust-lang.org/reference/expressions.html#match-expressions\" rel=\"noreferrer\">piece of official documentation</a> where the underscore is named in the context of patterns, but I doubt it's a \"strict\" name:</p>\n\n<blockquote>\n  <p>Patterns consist of some combination of literals, destructured arrays or enum constructors, structs and tuples, variable binding specifications, wildcards (..), and <strong>placeholders (_)</strong>.</p>\n</blockquote>\n\n<p><a href=\"https://doc.rust-lang.org/beta/book/first-edition/syntax-index.html#operators-and-symbols\" rel=\"noreferrer\">The Book</a> provides the following description in the glossary:</p>\n\n<blockquote>\n  <p><strong>_: \"ignored\" pattern binding</strong> (see <a href=\"https://doc.rust-lang.org/beta/book/first-edition/patterns.html#ignoring-bindings\" rel=\"noreferrer\">Patterns (Ignoring bindings)</a>). Also used to make integer-literals readable (see <a href=\"https://doc.rust-lang.org/beta/reference/tokens.html#integer-literals\" rel=\"noreferrer\">Reference (Integer literals)</a>).</p>\n</blockquote>\n\n<p>I was not able to find a definition pointing <em>specifically</em> to partial type annotations, but I think \"placeholder\" (or \"type placeholder\", depending on the context) would not be ambiguous.</p>\n"}, {"tags": [], "owner": {"reputation": 2645, "user_id": 5254193, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PTHapBqhSQM/AAAAAAAAAAI/AAAAAAAABA4/r5mrExVuDgU/photo.jpg?sz=128", "display_name": "Masaki Hara", "link": "https://stackoverflow.com/users/5254193/masaki-hara"}, "is_accepted": false, "score": 2, "last_activity_date": 1499779494, "creation_date": 1499779494, "answer_id": 45035878, "question_id": 45033804, "link": "https://stackoverflow.com/questions/45033804/what-is-the-correct-term-for-in-a-type-hint/45035878#45035878", "title": "What is the correct term for _ in a type hint?", "body": "<p>In the compiler, it seems to be called <strong><code>Infer</code></strong> (in <a href=\"https://github.com/rust-lang/rust/blob/1.18.0/src/libsyntax/ast.rs#L1359\" rel=\"nofollow noreferrer\"><code>syntax::ast</code></a>, <a href=\"https://github.com/rust-lang/rust/blob/1.18.0/src/librustc/hir/mod.rs#L1353\" rel=\"nofollow noreferrer\"><code>rustc::hir</code></a>, and <a href=\"https://github.com/rust-lang/rust/blob/1.18.0/src/librustc/ty/sty.rs#L169\" rel=\"nofollow noreferrer\"><code>rustc::ty</code></a>)</p>\n\n<p>I think this naming is somewhat reasonable, because these <code>_</code>s are replaced with fresh <strong>(type) inference variables</strong> before doing Hindley-Milner-like type inference.</p>\n"}, {"tags": [], "owner": {"reputation": 4257, "user_id": 3347227, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/160c472b1c6c43b47cc98cc01d3ce317?s=128&d=identicon&r=PG", "display_name": "Erik Vesteraas", "link": "https://stackoverflow.com/users/3347227/erik-vesteraas"}, "is_accepted": true, "score": 3, "last_activity_date": 1499791081, "last_edit_date": 1499791081, "creation_date": 1499780743, "answer_id": 45036336, "question_id": 45033804, "link": "https://stackoverflow.com/questions/45033804/what-is-the-correct-term-for-in-a-type-hint/45036336#45036336", "title": "What is the correct term for _ in a type hint?", "body": "<p>After some digging it seems that <code>Vec&lt;_&gt;</code> is consistently called a partial type (so in <code>let x: Vec&lt;_&gt;</code> we have a partial type annotation, while <code>Fn(String) -&gt; _</code> would be a partial type signature) but the <code>_</code> in this context is varyingly called either a type wildcard or a type placeholder, and <code>_</code> in the type grammar can be read as the token for \"infer this type\" (at the time of the PR mentioned below, <code>TyInfer</code> internally in the compiler).</p>\n\n<p>Some interesting reading:</p>\n\n<ul>\n<li><a href=\"https://ghc.haskell.org/trac/ghc/wiki/PartialTypeSignatures\" rel=\"nofollow noreferrer\">Partial type signatures in Haskell</a></li>\n<li><a href=\"https://github.com/rust-lang/rust/pull/12764\" rel=\"nofollow noreferrer\">The pull request which added <code>_</code> to the Rust type grammar</a></li>\n<li><a href=\"http://smallcultfollowing.com/babysteps/blog/2013/10/29/intermingled-parameter-lists/\" rel=\"nofollow noreferrer\">Intermingled parameter lists - Niko Matsakis' blog post</a> in which he proposes to \"Introduce <code>_</code> as a notation for an unspecified lifetime or type\"</li>\n</ul>\n\n<p>Interesting detail from the PR:</p>\n\n<pre><code>let x: _ = 5;\nlet x    = 5;\n</code></pre>\n\n<p>The two lines above are equivalent, and both parsed as variable <code>x</code> with type <code>TyInfer</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 2572, "user_id": 2630028, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ddafbe2a8b6f8403f3d24482c9174f90?s=128&d=identicon&r=PG", "display_name": "solstice333", "link": "https://stackoverflow.com/users/2630028/solstice333"}, "is_accepted": false, "score": 1, "last_activity_date": 1608060289, "last_edit_date": 1608060289, "creation_date": 1608000977, "answer_id": 65299398, "question_id": 45033804, "link": "https://stackoverflow.com/questions/45033804/what-is-the-correct-term-for-in-a-type-hint/65299398#65299398", "title": "What is the correct term for _ in a type hint?", "body": "<p>Seems like the grammar refers to it as an &quot;inferred type&quot;. Per <a href=\"https://doc.rust-lang.org/reference/types/inferred.html\" rel=\"nofollow noreferrer\">the documentation</a>:</p>\n<blockquote>\n<p><strong>Inferred type</strong></p>\n<p>Syntax:</p>\n<pre><code>InferredType : _\n</code></pre>\n<p>The inferred type asks the compiler to infer the type if possible based on the surrounding information available. It cannot be used in item signatures. It is often used in generic arguments:</p>\n<pre><code>let x: Vec&lt;_&gt; = (0..10).collect();\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 4257, "user_id": 3347227, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/160c472b1c6c43b47cc98cc01d3ce317?s=128&d=identicon&r=PG", "display_name": "Erik Vesteraas", "link": "https://stackoverflow.com/users/3347227/erik-vesteraas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1133, "favorite_count": 1, "accepted_answer_id": 45036336, "answer_count": 4, "score": 10, "last_activity_date": 1608060289, "creation_date": 1499773894, "question_id": 45033804, "link": "https://stackoverflow.com/questions/45033804/what-is-the-correct-term-for-in-a-type-hint", "title": "What is the correct term for _ in a type hint?", "body": "<p>In type hints in Rust it is possible to use partial types in annotations like this:</p>\n\n<pre><code>let myvec: Vec&lt;_&gt; = vec![1, 2, 3];\n</code></pre>\n\n<p>What is the correct terminology for the underscore in the partial type annotation? I'm interested in both the Rust terminology as well as more academic type theory terminology.</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 44438, "user_id": 42353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f05e802879a805c03a55645dfcc0d4ea?s=128&d=identicon&r=PG", "display_name": "DK.", "link": "https://stackoverflow.com/users/42353/dk"}, "edited": false, "score": 0, "creation_date": 1499774455, "post_id": 45033782, "comment_id": 77041389, "body": "You say <code>!doc</code>, but macros are written as <code>doc!</code>.  If that&#39;s not the issue, you have not provided anywhere <i>near</i> enough information.  We need to see the code that&#39;s failing to compile, and the output of the compiler."}, {"owner": {"reputation": 165, "user_id": 8237525, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5Z568aEI5jM/AAAAAAAAAAI/AAAAAAAAABQ/aDP2diK8FNA/photo.jpg?sz=128", "display_name": "Daniel O", "link": "https://stackoverflow.com/users/8237525/daniel-o"}, "reply_to_user": {"reputation": 44438, "user_id": 42353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f05e802879a805c03a55645dfcc0d4ea?s=128&d=identicon&r=PG", "display_name": "DK.", "link": "https://stackoverflow.com/users/42353/dk"}, "edited": false, "score": 0, "creation_date": 1499774575, "post_id": 45033782, "comment_id": 77041478, "body": "@DK Sorry about that. But I wrote doc! in my code"}], "answers": [{"comments": [{"owner": {"reputation": 165, "user_id": 8237525, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5Z568aEI5jM/AAAAAAAAAAI/AAAAAAAAABQ/aDP2diK8FNA/photo.jpg?sz=128", "display_name": "Daniel O", "link": "https://stackoverflow.com/users/8237525/daniel-o"}, "edited": false, "score": 0, "creation_date": 1499778144, "post_id": 45035249, "comment_id": 77044508, "body": "Thanks a lot. Never thought about that."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 1, "last_activity_date": 1499777745, "creation_date": 1499777745, "answer_id": 45035249, "question_id": 45033782, "link": "https://stackoverflow.com/questions/45033782/cannot-use-the-doc-macro-from-the-mongodb-crate-in-the-scope-of-a-sub-sub-mod/45035249#45035249", "title": "Cannot use the `doc!` macro from the mongodb crate in the scope of a sub sub module", "body": "<p>The mongodb crate (version 0.3.1) <a href=\"https://docs.rs/mongodb/0.3.1/mongodb/?search=doc\" rel=\"nofollow noreferrer\"><em>has no such macro</em></a>. The <a href=\"https://docs.rs/bson/0.9.0/bson/macro.doc.html\" rel=\"nofollow noreferrer\">bson crate (version 0.9.0)</a>, a dependency of mongodb, does. You need to declare that and import from there:</p>\n\n<pre><code>#[macro_use]\nextern crate bson;\nextern crate mongodb;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 14967149, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AOh14GhzMlcYqN7wRf2Qo02aEQzMH1zPSwVozKj-NhvM9w=k-s128", "display_name": "KATTICOT", "link": "https://stackoverflow.com/users/14967149/katticot"}, "is_accepted": false, "score": -1, "last_activity_date": 1610121115, "creation_date": 1610121115, "answer_id": 65632229, "question_id": 45033782, "link": "https://stackoverflow.com/questions/45033782/cannot-use-the-doc-macro-from-the-mongodb-crate-in-the-scope-of-a-sub-sub-mod/65632229#65632229", "title": "Cannot use the `doc!` macro from the mongodb crate in the scope of a sub sub module", "body": "<p>The mongodb crate (version 1.1.1) re-exports bson.\nIn Rust 2018 you can write</p>\n<pre class=\"lang-rust prettyprint-override\"><code>use mongodb::bson::doc\n</code></pre>\n"}], "owner": {"reputation": 165, "user_id": 8237525, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-5Z568aEI5jM/AAAAAAAAAAI/AAAAAAAAABQ/aDP2diK8FNA/photo.jpg?sz=128", "display_name": "Daniel O", "link": "https://stackoverflow.com/users/8237525/daniel-o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 1, "accepted_answer_id": 45035249, "answer_count": 2, "score": 1, "last_activity_date": 1610121115, "creation_date": 1499773845, "last_edit_date": 1499777759, "question_id": 45033782, "link": "https://stackoverflow.com/questions/45033782/cannot-use-the-doc-macro-from-the-mongodb-crate-in-the-scope-of-a-sub-sub-mod", "title": "Cannot use the `doc!` macro from the mongodb crate in the scope of a sub sub module", "body": "<p>I use following file structure:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\u251c\u2500\u2500 src\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 main.rs     // Macros from here\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 models\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 mod.rs  // Loads the user.rs file\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 user.rs // Should be visible here\n\u251c\u2500\u2500 Cargo.toml\n</code></pre>\n\n<p>My <code>main.rs</code> file imports the stuff like:</p>\n\n<pre><code>#[macro_use]\nextern crate mongodb;\n\nmod models;\n</code></pre>\n\n<p>My <code>user.rs</code> file looks like:</p>\n\n<pre><code>pub struct User {\n    username: String,\n    password: String,\n}\n\nimpl User {\n    fn create_doc() {\n        // Some code, but doc! from crate mongodb is not in this scope.\n    }\n}\n</code></pre>\n\n<p>How can I use my <code>doc!</code> macro in the <code>user.rs</code> file? I also tried to add <code>#[macro_use]</code> to the stuff like <code>mod models;</code>, but nothing worked.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 671, "user_id": 7551820, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-qFYkSwbZduE/AAAAAAAAAAI/AAAAAAAAAdQ/MmHqIWG-_xQ/photo.jpg?sz=128", "display_name": "Laurence", "link": "https://stackoverflow.com/users/7551820/laurence"}, "reply_to_user": {"reputation": 13883, "user_id": 2883245, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/NPpPG.jpg?s=128&g=1", "display_name": "erip", "link": "https://stackoverflow.com/users/2883245/erip"}, "edited": false, "score": 2, "creation_date": 1499774055, "post_id": 45033704, "comment_id": 77041116, "body": "@erip  It seems <a href=\"https://doc.rust-lang.org/stable/std/primitive.f32.html\" rel=\"nofollow noreferrer\"><code>f32</code></a> only implements <code>PartialOrd</code>"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1499774207, "post_id": 45033704, "comment_id": 77041218, "body": "Wow, this seems like a bug. With only the generic implementation, the compiler clearly says that f32 does not implement Ord, but in the OP&#39;s example, it considers that f32 implements the generic one."}, {"owner": {"reputation": 13883, "user_id": 2883245, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/NPpPG.jpg?s=128&g=1", "display_name": "erip", "link": "https://stackoverflow.com/users/2883245/erip"}, "edited": false, "score": 0, "creation_date": 1499774248, "post_id": 45033704, "comment_id": 77041256, "body": "@Laurence Woops. :) Thanks for keeping me honest."}], "answers": [{"comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1499774734, "post_id": 45034077, "comment_id": 77041608, "body": "How to get around it?"}, {"owner": {"reputation": 44438, "user_id": 42353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f05e802879a805c03a55645dfcc0d4ea?s=128&d=identicon&r=PG", "display_name": "DK.", "link": "https://stackoverflow.com/users/42353/dk"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1499775108, "post_id": 45034077, "comment_id": 77041897, "body": "@Boiethios: You don&#39;t; I added some more to my answer."}, {"owner": {"reputation": 44438, "user_id": 42353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f05e802879a805c03a55645dfcc0d4ea?s=128&d=identicon&r=PG", "display_name": "DK.", "link": "https://stackoverflow.com/users/42353/dk"}, "reply_to_user": {"reputation": 671, "user_id": 7551820, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-qFYkSwbZduE/AAAAAAAAAAI/AAAAAAAAAdQ/MmHqIWG-_xQ/photo.jpg?sz=128", "display_name": "Laurence", "link": "https://stackoverflow.com/users/7551820/laurence"}, "edited": false, "score": 1, "creation_date": 1499776948, "post_id": 45034077, "comment_id": 77043436, "body": "@Laurence: The closest I&#39;m aware of is <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/1023-rebalancing-coherence.md\" rel=\"nofollow noreferrer\">RFC 1023</a>, but if that proves too inscrutable, then I&#39;m not aware of anything that explains it more... <i>coherently</i>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 671, "user_id": 7551820, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-qFYkSwbZduE/AAAAAAAAAAI/AAAAAAAAAdQ/MmHqIWG-_xQ/photo.jpg?sz=128", "display_name": "Laurence", "link": "https://stackoverflow.com/users/7551820/laurence"}, "edited": false, "score": 1, "creation_date": 1499777012, "post_id": 45034077, "comment_id": 77043497, "body": "@Laurence these are called the <i>orphan rules</i>, IIRC. Refer to <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/1023-rebalancing-coherence.md\" rel=\"nofollow noreferrer\">RFC 1023</a> and <a href=\"https://doc.rust-lang.org/error-index.html#E0210\" rel=\"nofollow noreferrer\">error 0210</a>."}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1536688049, "post_id": 45034077, "comment_id": 91511013, "body": "Can this be side-stepped by implementing <code>Ord</code> for <code>f32</code>?"}, {"owner": {"reputation": 44438, "user_id": 42353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f05e802879a805c03a55645dfcc0d4ea?s=128&d=identicon&r=PG", "display_name": "DK.", "link": "https://stackoverflow.com/users/42353/dk"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 1, "creation_date": 1536720072, "post_id": 45034077, "comment_id": 91521437, "body": "@9000: You <i>can&#39;t</i> implement <code>Ord</code> for <code>f32</code>, because it doesn&#39;t satisfy the requirements: it&#39;s not totally ordered.  Even if it did, you can&#39;t, because you can&#39;t implement a trait you didn&#39;t write on a type you didn&#39;t define."}, {"owner": {"reputation": 169, "user_id": 1608911, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff1aa3e25c7ec0eedaacce54a3198d82?s=128&d=identicon&r=PG", "display_name": "seamlik", "link": "https://stackoverflow.com/users/1608911/seamlik"}, "edited": false, "score": 0, "creation_date": 1569700714, "post_id": 45034077, "comment_id": 102683716, "body": "With <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/1210-impl-specialization.md\" rel=\"nofollow noreferrer\">specialization</a> in mind, do you think this can be worked around somehow?"}], "tags": [], "owner": {"reputation": 44438, "user_id": 42353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f05e802879a805c03a55645dfcc0d4ea?s=128&d=identicon&r=PG", "display_name": "DK.", "link": "https://stackoverflow.com/users/42353/dk"}, "is_accepted": true, "score": 6, "last_activity_date": 1499775099, "last_edit_date": 1499775099, "creation_date": 1499774583, "answer_id": 45034077, "question_id": 45033704, "link": "https://stackoverflow.com/questions/45033704/why-do-i-get-conflicting-implementations-of-trait-for-f32-which-does-not-imple/45034077#45034077", "title": "Why do I get &quot;conflicting implementations of trait&quot; for f32 which does not implement Ord?", "body": "<p>I believe this is because the compiler can't rule out the possibility that someday, someone <em>will</em> implement <code>Ord</code> for <code>f32</code>.  To put it another way: if the compiler <em>didn't</em> act conservatively, it would be a breaking change to ever implement <em>any</em> new trait on existing types.  That would severely limit every library's ability to grow without breaking all downstream users.</p>\n\n<p>There is no direct way around this, as it is an intentional design choice for the language.  The closest would be to implement a wrapper type <em>around</em> <code>f32</code> (<em>i.e.</em> <code>struct OrdF32(f32);</code>) and implement <code>Ord</code> or <code>Min</code> on <em>that</em>, or to use a crate that defines such a wrapper (such as <a href=\"https://crates.io/crates/ordered-float\" rel=\"noreferrer\"><code>ordered-float</code></a>).</p>\n"}], "owner": {"reputation": 671, "user_id": 7551820, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-qFYkSwbZduE/AAAAAAAAAAI/AAAAAAAAAdQ/MmHqIWG-_xQ/photo.jpg?sz=128", "display_name": "Laurence", "link": "https://stackoverflow.com/users/7551820/laurence"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 798, "favorite_count": 0, "accepted_answer_id": 45034077, "answer_count": 1, "score": 5, "last_activity_date": 1499776876, "creation_date": 1499773648, "last_edit_date": 1499776876, "question_id": 45033704, "link": "https://stackoverflow.com/questions/45033704/why-do-i-get-conflicting-implementations-of-trait-for-f32-which-does-not-imple", "title": "Why do I get &quot;conflicting implementations of trait&quot; for f32 which does not implement Ord?", "body": "<p>I want a <code>min()</code> method for <code>f32</code>, <code>u32</code> and <code>i32</code>, so I created a trait <code>Min</code>:</p>\n\n<pre><code>trait Min {\n    fn min(v1: Self, v2: Self) -&gt; Self;\n}\n\nimpl&lt;T&gt; Min for T where T: Ord {\n    fn min(v1: Self, v2: Self) -&gt; Self {\n        ::std::cmp::min(v1, v2)\n    }\n}\n\nimpl Min for f32 {\n    fn min(v1: Self, v2: Self) -&gt; Self {\n        v1.min(v2)\n    }\n}\n</code></pre>\n\n<p>I get an error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0119]: conflicting implementations of trait `Min` for type `f32`:\n  --&gt; src/main.rs:11:1\n   |\n5  | / impl&lt;T&gt; Min for T where T: Ord {\n6  | |     fn min(v1: Self, v2: Self) -&gt; Self {\n7  | |         ::std::cmp::min(v1, v2)\n8  | |     }\n9  | | }\n   | |_- first implementation here\n10 | \n11 | / impl Min for f32 {\n12 | |     fn min(v1: Self, v2: Self) -&gt; Self {\n13 | |         v1.min(v2)\n14 | |     }\n15 | | }\n   | |_^ conflicting implementation for `f32`\n</code></pre>\n\n<p>According to the Rust standard library documentation, <code>f32</code> does not implement <code>Ord</code>. Why there are conflicting implementations?</p>\n"}, {"tags": ["rust", "hlua"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1500041237, "post_id": 45032489, "comment_id": 77181122, "body": "You have provided a good MCVE, but I think it lost some meaning along the way. Your code could boil down to just <code>lua.execute::&lt;()&gt;(&quot;x = 1&quot;)</code>. I&#39;d encourage you to add some prose explaining why you need to call back into the Lua interpreter after just being inside it."}], "owner": {"reputation": 19, "user_id": 8288983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41e9010dfe07505531dc9b26c61c6c11?s=128&d=identicon&r=PG&f=1", "display_name": "acidnik", "link": "https://stackoverflow.com/users/8288983/acidnik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1499778485, "creation_date": 1499770356, "last_edit_date": 1499778485, "question_id": 45032489, "link": "https://stackoverflow.com/questions/45032489/how-do-i-change-the-hlualua-context-variable-from-inside-a-function", "title": "How do I change the hlua::Lua context variable from inside a function?", "body": "<p>Here's a small example:</p>\n\n<pre><code>extern crate hlua;\nuse hlua::*;\nuse std::rc::Rc;\nuse std::cell::{Cell, RefCell};\n\nfn main() {\n    let lua = Rc::new(RefCell::new(Lua::new()));\n    lua.borrow_mut().set(\"x\", 42);\n    {\n        let lua2 = lua.clone();\n        lua.borrow_mut().set(\"foo\", function0(move ||{\n            lua2.borrow_mut().set(\"x\", 1); // XXX thread 'main' panicked at 'already borrowed: BorrowMutError'\n        }));\n    }\n    let _ = lua.borrow_mut().execute::&lt;()&gt;(\"foo()\");\n    println!(\"{}\", lua.borrow_mut().get::&lt;i32, _&gt;(\"x\").unwrap());\n}\n</code></pre>\n\n<p>This code panics at runtime at the line marked <code>XXX</code>. I get that <code>lua</code> is borrowed when I call <code>foo()</code>, but I don't see other way to do it. How can I use <code>lua</code> from inside an exported function?</p>\n"}, {"tags": ["windows", "rust", "bignum"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499761369, "post_id": 45028954, "comment_id": 77032049, "body": "<a href=\"https://gitlab.com/tspiteri/gmp-mpfr-sys#building-on-windows\" rel=\"nofollow noreferrer\">gitlab.com/tspiteri/gmp-mpfr-sys#building-on-windows</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1569030"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499761528, "post_id": 45028954, "comment_id": 77032151, "body": "I was hoping to avoid &quot;install MSYS&quot; if at all possible."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1499763220, "post_id": 45028954, "comment_id": 77033261, "body": "@Bristol I think that if you want to use some tools for system languages under windows, it is always good to have the GNU tools."}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 2, "creation_date": 1499767335, "post_id": 45028954, "comment_id": 77036360, "body": "What kind of big numbers are you looking for? Does the <code>num</code> crate fulfill your needs? Note that we should not be asking recommendation questions."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1569030"}, "edited": false, "score": 0, "creation_date": 1499786478, "post_id": 45028954, "comment_id": 77051195, "body": "I&#39;ll try with num."}], "owner": {"user_type": "does_not_exist", "display_name": "user1569030"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 223, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1499760799, "creation_date": 1499760799, "question_id": 45028954, "link": "https://stackoverflow.com/questions/45028954/rust-bignums-and-windows", "title": "rust, bignums and windows", "body": "<p>I've got rust 1.18.0 on windows 10 and I'd like to write something that uses bignums. The <a href=\"https://crates.io/crates/rug\" rel=\"nofollow noreferrer\">rug</a> library looks like a good choice, but a <code>cargo build</code> on a project using it fails because building gmp calls <code>ln -s</code> somewhere down the line.</p>\n\n<ul>\n<li>Is there a rust bignum library that can be compiled on windows out of the box? </li>\n<li>If not, are there instructions somewhere for using rug with a prebuilt libgmp?</li>\n</ul>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 53905, "user_id": 2864740, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e7a05a144f218bde07b659bc98e1ca7d?s=128&d=identicon&r=PG&f=1", "display_name": "user2864740", "link": "https://stackoverflow.com/users/2864740/user2864740"}, "edited": false, "score": 3, "creation_date": 1499712461, "post_id": 45019559, "comment_id": 77013014, "body": "Questions about &quot;motivation behind an API&quot; are generally not a good fit for SO because, while there may be many conjectures there is often little objective information that can be supplied with such. The most basic answer is: &quot;because that&#39;s how the API was written&quot;; and this answer applies to many API methods across many languages."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499713194, "post_id": 45019559, "comment_id": 77013453, "body": "<a href=\"https://github.com/rust-lang/rust/commit/d8f8f7a58c7c8b3352c1c577347865f5a823fee3/\" rel=\"nofollow noreferrer\">github.com/rust-lang/rust/commit/&hellip;</a>"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1499718197, "post_id": 45019559, "comment_id": 77016184, "body": "This is just a short cut, I don&#39;t see the problem. By the way, <a href=\"https://doc.rust-lang.org/src/std/thread/mod.rs.html#412-416\" rel=\"nofollow noreferrer\">doc.rust-lang.org/src/std/thread/mod.rs.html#412-416</a>. Look this is a trivial function."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1499721405, "post_id": 45019559, "comment_id": 77017759, "body": "@Stargateur I don&#39;t think OP is confused about the implementation details. They want to know why does <i>this</i> function need a shortcut that panics? Why doesn&#39;t a function like <code>File::open</code> have such a shortcut? I agree with @user2864740 though; very rarely can you discover the &quot;why&quot; behind such decisions."}], "answers": [{"tags": [], "owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "is_accepted": true, "score": 4, "last_activity_date": 1499755516, "creation_date": 1499755516, "answer_id": 45027211, "question_id": 45019559, "link": "https://stackoverflow.com/questions/45019559/why-does-stdthreadspawn-panic-on-error-instead-of-returning-a-result/45027211#45027211", "title": "Why does std::thread::spawn() panic on error instead of returning a Result?", "body": "<p><em>Disclaimer: as mentioned, the exact reasoning can be hard to fathom; we can however look at the facts.</em></p>\n\n<blockquote>\n  <p>From my point of view, this would be safer.</p>\n</blockquote>\n\n<p>It would not.</p>\n\n<p>Panicking does not introduce memory or thread unsafety and is not an error-signalling method that can be ignored.</p>\n\n<p>It's perfectly safe.</p>\n\n<blockquote>\n  <p>Also, it would unify the return type of both functions.</p>\n</blockquote>\n\n<p>It would. Which would be a mixed blessing.</p>\n\n<p>To cite Emerson:</p>\n\n<blockquote>\n  <p>A foolish consistency is the hobgoblin of little minds</p>\n</blockquote>\n\n<p>Remember that in Rust a <code>Result</code> cannot be ignored, it <em>has</em> to be acknowledged and dealt with. This somewhat diminishes the value of a short-cut. Compare:</p>\n\n<pre><code>let h = Builder::new().spawn(f).unwrap();\n\nlet h = spawn(f).unwrap();\n\nlet h = spawn(f);\n</code></pre>\n\n<p>The latter is much more of a short-cut!</p>\n\n<blockquote>\n  <p>What is the motivation behind \"panicking by default\" in this particular case?</p>\n</blockquote>\n\n<p><strong>Convenience</strong>.</p>\n\n<p>The thread API is built around two complementary APIs:</p>\n\n<ul>\n<li>the <code>Builder</code> API offers fine-grained control over every single aspect, at the cost of verbosity,</li>\n<li>the free function API offers a terse way of quickly spawning a thread, at the cost of control.</li>\n</ul>\n\n<p>This way, whether you want control or terseness, there's a standard API for you.</p>\n\n<p>The <em>cost</em> of not doing so is that many people would introduce an <code>unwrap</code> by default function. Each their own. And it would be harder to hop projects.</p>\n"}, {"tags": [], "owner": {"reputation": 22583, "user_id": 1103681, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/rMUo3.png?s=128&g=1", "display_name": "oli_obk", "link": "https://stackoverflow.com/users/1103681/oli-obk"}, "is_accepted": false, "score": 2, "last_activity_date": 1499759704, "creation_date": 1499759704, "answer_id": 45028589, "question_id": 45019559, "link": "https://stackoverflow.com/questions/45019559/why-does-stdthreadspawn-panic-on-error-instead-of-returning-a-result/45028589#45028589", "title": "Why does std::thread::spawn() panic on error instead of returning a Result?", "body": "<p>Rust panics on \"out of resources\" like OOM. In this case the \"can't create thread\" error must mean out of hard or soft limited resource (see <a href=\"http://man7.org/linux/man-pages/man3/pthread_create.3.html\" rel=\"nofollow noreferrer\">pthread_create errors</a>). Technically there are other errors, but looking at the exposed API I'd say you can't reach them from safe Rust code and I assume the windows errors are pretty similar. But Rust wouldn't be a systems programming language if there weren't an escape hatch allowing you to cleanly try some action and check whether it succeeded. For heap allocations this currently means you need to use <a href=\"https://doc.rust-lang.org/alloc/heap/fn.allocate.html\" rel=\"nofollow noreferrer\">unstable APIs</a>, but these are being improved (as of 11. July 2017 already in the nightly) and most likely stabilized in the future.</p>\n"}], "owner": {"reputation": 6933, "user_id": 2580955, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/WZR9N.jpg?s=128&g=1", "display_name": "s3rvac", "link": "https://stackoverflow.com/users/2580955/s3rvac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 806, "favorite_count": 0, "accepted_answer_id": 45027211, "answer_count": 2, "score": 1, "last_activity_date": 1499759704, "creation_date": 1499712369, "question_id": 45019559, "link": "https://stackoverflow.com/questions/45019559/why-does-stdthreadspawn-panic-on-error-instead-of-returning-a-result", "title": "Why does std::thread::spawn() panic on error instead of returning a Result?", "body": "<p>In the Rust's standard library, there are two ways of spawning a thread:</p>\n\n<ul>\n<li><a href=\"https://doc.rust-lang.org/std/thread/fn.spawn.html\" rel=\"nofollow noreferrer\"><code>std::thread::spawn()</code></a></li>\n<li><a href=\"https://doc.rust-lang.org/std/thread/struct.Builder.html#method.spawn\" rel=\"nofollow noreferrer\"><code>std::thread::Builder::spawn()</code></a></li>\n</ul>\n\n<p>The difference between them is that when the OS fails to create the thread, the former panics while the latter returns a <a href=\"https://doc.rust-lang.org/std/io/type.Result.html\" rel=\"nofollow noreferrer\"><code>Result</code></a>.</p>\n\n<p>Why doesn't <code>std::thread::spawn()</code> simply return a <code>Result</code> instead of panicking? From my point of view, this would be safer. Also, it would unify the return type of both functions. What is the motivation behind \"panicking by default\" in this particular case?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 645, "user_id": 6562635, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/0DyLm.jpg?s=128&g=1", "display_name": "Jonathan Wilbur", "link": "https://stackoverflow.com/users/6562635/jonathan-wilbur"}, "edited": false, "score": 0, "creation_date": 1499704488, "post_id": 45017286, "comment_id": 77008488, "body": "Ah! Excellent. Thank you, sir!"}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 1619, "user_id": 3342206, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/92d5672ff3c806eb71d84d7298d5be43?s=128&d=identicon&r=PG&f=1", "display_name": "8bittree", "link": "https://stackoverflow.com/users/3342206/8bittree"}, "edited": false, "score": 0, "creation_date": 1499754593, "post_id": 45017286, "comment_id": 77027853, "body": "@8bittree: No, it&#39;s an unless. Let me qualify it a bit more."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 1619, "user_id": 3342206, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/92d5672ff3c806eb71d84d7298d5be43?s=128&d=identicon&r=PG&f=1", "display_name": "8bittree", "link": "https://stackoverflow.com/users/3342206/8bittree"}, "edited": false, "score": 0, "creation_date": 1499792274, "post_id": 45017286, "comment_id": 77055124, "body": "@8bittree: Great! Thanks for your feedback!"}, {"owner": {"reputation": 3483, "user_id": 2668666, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/3QEDd.jpg?s=128&g=1", "display_name": "jmrah", "link": "https://stackoverflow.com/users/2668666/jmrah"}, "edited": false, "score": 0, "creation_date": 1608733460, "post_id": 45017286, "comment_id": 115669826, "body": "So, assuming the Date struct was public, how would I make sure user&#39;s were only able to make a <code>Date</code> using <code>Date::new</code>, but still be able to access the properties of <code>Date</code>?  Would I have to make a &#39;throw away&#39; private field in <code>Date</code>,  i.e. <code>struct Date { private_field_just_so_i_cant_be_instantiated: bool, ... }</code>?  (go easy on me, I&#39;m just learning Rust :)"}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 3483, "user_id": 2668666, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/3QEDd.jpg?s=128&g=1", "display_name": "jmrah", "link": "https://stackoverflow.com/users/2668666/jmrah"}, "edited": false, "score": 1, "creation_date": 1608806984, "post_id": 45017286, "comment_id": 115690015, "body": "@jrahhali: You have a choice between &quot;getters&quot; to expose the properties, or a private field which in Rust you&#39;d start with an underscore <code>_</code> to avoid warnings of being unused. I personally would recommend getters, as private fields are better encapsulated, allowing to change the internal representation without breaking the interface."}], "tags": [], "owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "is_accepted": false, "score": 22, "last_activity_date": 1499754639, "last_edit_date": 1499754639, "creation_date": 1499704184, "answer_id": 45017286, "question_id": 45017183, "link": "https://stackoverflow.com/questions/45017183/can-you-disable-constructor-syntax-for-a-type/45017286#45017286", "title": "Can you disable constructor syntax for a type?", "body": "<p><strong>TL;DR: The \"default constructor\" is disabled by default already.</strong> </p>\n\n<p>The <code>struct</code> syntax is only available to those who have access to <em>all</em> the fields of the <code>struct</code>.</p>\n\n<p>As a result, it is only accessible in the same module, as per privacy rules, unless all fields are marked <code>pub</code> in which case it is accessible wherever the <code>struct</code> is.</p>\n\n<p>Note that the same is true of <em>functions</em>, since <code>new</code> is not marked <code>pub</code> here, it's inaccessible to any module other than the current one.</p>\n"}], "owner": {"reputation": 645, "user_id": 6562635, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/0DyLm.jpg?s=128&g=1", "display_name": "Jonathan Wilbur", "link": "https://stackoverflow.com/users/6562635/jonathan-wilbur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1834, "favorite_count": 1, "answer_count": 1, "score": 21, "last_activity_date": 1612467114, "creation_date": 1499703905, "last_edit_date": 1612467114, "question_id": 45017183, "link": "https://stackoverflow.com/questions/45017183/can-you-disable-constructor-syntax-for-a-type", "title": "Can you disable constructor syntax for a type?", "body": "<p>Say I define my own type in a Rust library, like so:</p>\n<pre><code>struct Date {\n    year: u16,\n    month: u8,\n    day: u8\n}\n\nimpl Date {\n    fn new(y: u16, m: u8, d: u8) -&gt; Date {\n        // Do some validation here first\n        Date { year: y, month: m, day: d }\n    }\n}\n</code></pre>\n<p>Is there a way to <strong>require</strong> users to use the <code>Date::new</code> constructor? In other words, can I somehow prohibit users from creating their own <code>Date</code> struct using the following constructor:</p>\n<pre><code>let d = Date { 2017, 7, 10 };\n</code></pre>\n<p>I ask because it seems to be a detrimental flaw if you cannot force developers to run their arguments through a battery of validation before setting the members of a struct. (Although, maybe there is some other pattern that I should use in Rust, like validating data when they are used rather than when they are created; feel free to comment on that.)</p>\n"}, {"tags": ["rust", "hyper"], "answers": [{"tags": [], "owner": {"reputation": 444, "user_id": 3422156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/29af89a0e8be5cf63546304d02c8e2fb?s=128&d=identicon&r=PG&f=1", "display_name": "spease", "link": "https://stackoverflow.com/users/3422156/spease"}, "is_accepted": true, "score": 2, "last_activity_date": 1500037817, "last_edit_date": 1500037817, "creation_date": 1500003298, "answer_id": 45094155, "question_id": 45012233, "link": "https://stackoverflow.com/questions/45012233/how-to-bind-a-request-to-a-specific-network-interface-with-rust-hyper-http-clien/45094155#45094155", "title": "How to bind a request to a specific network interface with Rust Hyper HTTP client?", "body": "<p>You'd need to build your own <code>HttpConnector</code> probably starting from <a href=\"https://github.com/hyperium/hyper/blob/master/src/client/connect.rs\" rel=\"nofollow noreferrer\">the vanilla connector</a>, perhaps using <a href=\"https://doc.rust-lang.org/net2-rs/net2/struct.TcpBuilder.html\" rel=\"nofollow noreferrer\"><code>net2::TcpBuilder</code></a>.</p>\n\n<p>This is definitely something that seems like it should be easier, perhaps specified in the config. You might want to open an issue for hyper or submit a pull request if you implement it yourself.</p>\n"}], "owner": {"reputation": 163, "user_id": 5464357, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f152256b924c1abe714c23b42cdc3f5?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Applegame", "link": "https://stackoverflow.com/users/5464357/jack-applegame"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 646, "favorite_count": 1, "accepted_answer_id": 45094155, "answer_count": 1, "score": 4, "last_activity_date": 1500037817, "creation_date": 1499690091, "question_id": 45012233, "link": "https://stackoverflow.com/questions/45012233/how-to-bind-a-request-to-a-specific-network-interface-with-rust-hyper-http-clien", "title": "How to bind a request to a specific network interface with Rust Hyper HTTP client?", "body": "<p>I have a Linux server with multiple network interfaces. Each interface has its own IP address.\nHow to force HTTP requests to use a specific interface by specifying its IP address? Just like <a href=\"https://curl.haxx.se/docs/manpage.html\" rel=\"nofollow noreferrer\">curl --interface</a> command line option.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499675272, "post_id": 45007151, "comment_id": 76987734, "body": "Only if the type implement <code>Copy</code> trait."}, {"owner": {"reputation": 695, "user_id": 1407530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/34d7caadb1601d6fec8f7065300a56ff?s=128&d=identicon&r=PG", "display_name": "Lars R&#246;nnb&#228;ck", "link": "https://stackoverflow.com/users/1407530/lars-r%c3%b6nnb%c3%a4ck"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499676465, "post_id": 45007151, "comment_id": 76988489, "body": "Assuming that A is a very large struct, is there any way to prevent copying and just move the pointer?"}, {"owner": {"reputation": 22583, "user_id": 1103681, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/rMUo3.png?s=128&g=1", "display_name": "oli_obk", "link": "https://stackoverflow.com/users/1103681/oli-obk"}, "edited": false, "score": 0, "creation_date": 1499683264, "post_id": 45007151, "comment_id": 76993089, "body": "@LarsR&#246;nnb&#228;ck There&#39;s the idea of an <code>&amp;move</code> reference, which allows just that, but it&#39;s not even in the rfc stage afaik. Until then you can use <code>&amp;mut Option&lt;T&gt;</code> and use <code>.take()</code> when you want to do your copy. <code>mem::drop(opt.take())</code> should get optimized out with aggressive optimizations."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1499693949, "post_id": 45007151, "comment_id": 77000875, "body": "Observe that you see very similar results with <code>struct A&lt;&#39;a&gt; { v: &amp;&#39;a [u32] }</code>. It&#39;s not because <code>v[0]</code> is on the heap that its address is unchanged; it&#39;s because moves are shallow."}], "owner": {"reputation": 695, "user_id": 1407530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/34d7caadb1601d6fec8f7065300a56ff?s=128&d=identicon&r=PG", "display_name": "Lars R&#246;nnb&#228;ck", "link": "https://stackoverflow.com/users/1407530/lars-r%c3%b6nnb%c3%a4ck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "closed_date": 1499675694, "answer_count": 0, "score": 0, "last_activity_date": 1499676221, "creation_date": 1499675165, "last_edit_date": 1499676221, "question_id": 45007151, "link": "https://stackoverflow.com/questions/45007151/does-a-move-involve-a-copy", "closed_reason": "Duplicate", "title": "Does a move involve a copy?", "body": "<p>Does a move result in a copy of the involved data on the stack, while all references to the heap are retained? The following example seems to indicate that this is the case:</p>\n\n<pre><code>use std::sync::{Arc};\n\nstruct A { v: Vec&lt;u32&gt; }\n\nfn main() {\n    let a = A { v: vec![42] };\n    println!(\"{:p} {:p}\", &amp;a.v, &amp;a.v[0]);\n    let a_moved = a;\n    println!(\"{:p} {:p}\", &amp;a_moved.v, &amp;a_moved.v[0]);\n    let arc_a_moved = Arc::new(a_moved);\n    println!(\"{:p} {:p}\", &amp;arc_a_moved.clone().v, &amp;arc_a_moved.clone().v[0]);\n}\n</code></pre>\n"}, {"tags": ["iterator", "rust", "lifetime"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 8064494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cd9f057e367fd620a7b8edb0e9aa998?s=128&d=identicon&r=PG&f=1", "display_name": "vamsikal", "link": "https://stackoverflow.com/users/8064494/vamsikal"}, "edited": false, "score": 0, "creation_date": 1499668179, "post_id": 45003796, "comment_id": 76983804, "body": "Thank you for answering my question. I will learn about lifetime elision. It seems a little bit complicated at a first glance though. I made a small change to my code where I initialized the iters in main iteself without calling the function init_iters and it worked, so I guess in Rust we have to write code in such a way that we do not need to specify lifetime bounds."}, {"owner": {"reputation": 41, "user_id": 8064494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cd9f057e367fd620a7b8edb0e9aa998?s=128&d=identicon&r=PG&f=1", "display_name": "vamsikal", "link": "https://stackoverflow.com/users/8064494/vamsikal"}, "edited": false, "score": 0, "creation_date": 1499671511, "post_id": 45003796, "comment_id": 76985582, "body": "A nice comment from here: <a href=\"https://doc.rust-lang.org/nomicon/lifetimes.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/nomicon/lifetimes.html</a>. &quot;However it does mean that several programs that are totally correct with respect to Rust&#39;s true semantics are rejected because lifetimes are too dumb.&quot;"}, {"owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "reply_to_user": {"reputation": 41, "user_id": 8064494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cd9f057e367fd620a7b8edb0e9aa998?s=128&d=identicon&r=PG&f=1", "display_name": "vamsikal", "link": "https://stackoverflow.com/users/8064494/vamsikal"}, "edited": false, "score": 1, "creation_date": 1499677518, "post_id": 45003796, "comment_id": 76989165, "body": "@vamsikal, it is not a case of &quot;dumb lifetimes&quot;, it is a consequence of language design decision: &quot;type inference doesn&#39;t cross function boundaries&quot;. When your code resides in <code>main</code>, compiler infers appropriate lifetimes and types of variables. When you move code into separate function, you will need to write the types of parameters and sometimes lifetimes&#39; bounds."}], "tags": [], "owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "is_accepted": true, "score": 2, "last_activity_date": 1499689952, "last_edit_date": 1499689952, "creation_date": 1499661033, "answer_id": 45003796, "question_id": 45003170, "link": "https://stackoverflow.com/questions/45003170/cannot-infer-an-appropriate-lifetime-when-storing-peekable-iterators-in-a-vector/45003796#45003796", "title": "Cannot infer an appropriate lifetime when storing Peekable iterators in a vector", "body": "<p>By the rules of <a href=\"https://doc.rust-lang.org/stable/book/second-edition/ch10-03-lifetime-syntax.html#lifetime-elision\" rel=\"nofollow noreferrer\">lifetime elision</a> your function <code>init_iters</code> expands to</p>\n\n<pre><code>fn init_iters&lt;'a, 'b, 'c&gt;(v : &amp;'a Vec&lt;Vec&lt;usize&gt;&gt;,\n                          iters : &amp;'b mut Vec&lt;Peekable&lt;Iter&lt;'c, usize&gt;&gt;&gt;) {\n    for i in v.iter() {\n        iters.push(i.iter().peekable());\n    }\n}\n</code></pre>\n\n<p>The vector's lifetime <code>'a</code> and <code>Iter</code>'s lifetime <code>'c</code> are declared as independent. The compiler doesn't try to infer lifetime bounds which are not explicitly specified. The error tells you that compiler cannot prove that <code>'c</code> will not outlive <code>'a</code> because they are declared as independent.</p>\n\n<p>To fix it, you need to tell the compiler that <code>Iter</code> doesn't outlive the vector it refers to. Using the lifetime bound <code>'a: 'c</code> does it.</p>\n\n<pre><code>fn init_iters&lt;'a: 'c, 'b, 'c&gt;( ...\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?gist=fd80a2650c72f99b339b0905c93ecfdd&amp;version=stable&amp;backtrace=0\" rel=\"nofollow noreferrer\">Playground link</a></p>\n"}], "owner": {"reputation": 41, "user_id": 8064494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cd9f057e367fd620a7b8edb0e9aa998?s=128&d=identicon&r=PG&f=1", "display_name": "vamsikal", "link": "https://stackoverflow.com/users/8064494/vamsikal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 407, "favorite_count": 0, "accepted_answer_id": 45003796, "answer_count": 1, "score": 0, "last_activity_date": 1499689952, "creation_date": 1499655380, "last_edit_date": 1499689852, "question_id": 45003170, "link": "https://stackoverflow.com/questions/45003170/cannot-infer-an-appropriate-lifetime-when-storing-peekable-iterators-in-a-vector", "title": "Cannot infer an appropriate lifetime when storing Peekable iterators in a vector", "body": "<p>The following code works perfectly:</p>\n\n<pre><code>use std::iter::Peekable;\nuse std::slice::Iter;\n\nfn has_next(iter: &amp;mut Peekable&lt;Iter&lt;usize&gt;&gt;) -&gt; bool {\n    match iter.peek() {\n        Some(_) =&gt; true,\n        None =&gt; false,\n    }\n}\n\nfn print_iters(iters: &amp;mut Vec&lt;Peekable&lt;Iter&lt;usize&gt;&gt;&gt;) {\n    for iter in iters.iter_mut() {\n        if has_next(iter) {\n            match iter.next() {\n                Some(x) =&gt; println!(\"{}\", x),\n                None =&gt; {}\n            }\n        }\n    }\n}\n\nfn main() {\n    let v1 = vec![2, 4, 6, 8];\n    let v2 = vec![1, 3, 5, 7];\n    let mut iters = Vec::new();\n    iters.push((v1.iter().peekable()));\n    iters.push((v2.iter().peekable()));\n    print_iters(&amp;mut iters);\n}\n</code></pre>\n\n<p>In some code I wrote, I need to store the <code>Peekable</code>s in a vector and iterate using them at a later time. I tried modifying the code to this:</p>\n\n<pre><code>use std::iter::Peekable;\nuse std::slice::Iter;\n\nfn has_next(iter: &amp;mut Peekable&lt;Iter&lt;usize&gt;&gt;) -&gt; bool {\n    match iter.peek() {\n        Some(_) =&gt; true,\n        None =&gt; false,\n    }\n}\n\nfn print_iters(iters: &amp;mut Vec&lt;Peekable&lt;Iter&lt;usize&gt;&gt;&gt;) {\n    for iter in iters.iter_mut() {\n        if has_next(iter) {\n            match iter.next() {\n                Some(x) =&gt; println!(\"{}\", x),\n                None =&gt; {}\n            }\n        }\n    }\n}\n\nfn init_iters(v: &amp;Vec&lt;Vec&lt;usize&gt;&gt;, iters: &amp;mut Vec&lt;Peekable&lt;Iter&lt;usize&gt;&gt;&gt;) {\n    for i in v.iter() {\n        iters.push(i.iter().peekable());\n    }\n}\n\nfn main() {\n    let v1 = vec![2, 4, 6, 8];\n    let v2 = vec![1, 3, 5, 7];\n    let v = vec![v1, v2];\n    let mut iters = Vec::new();\n    init_iters(v, &amp;mut iters);\n    print_iters(&amp;mut iters);\n}\n</code></pre>\n\n<p>When I do this, I get the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0495]: cannot infer an appropriate lifetime for lifetime parameter in function call due to conflicting requirements\n  --&gt; src/main.rs:23:20\n   |\n23 |         for i in v.iter() {\n   |                    ^^^^\n   |\nnote: first, the lifetime cannot outlive the anonymous lifetime #1 defined on the body at 22:79...\n  --&gt; src/main.rs:22:80\n   |\n22 |       fn init_iters(v: &amp;Vec&lt;Vec&lt;usize&gt;&gt;, iters: &amp;mut Vec&lt;Peekable&lt;Iter&lt;usize&gt;&gt;&gt;) {\n   |  ________________________________________________________________________________^\n23 | |         for i in v.iter() {\n24 | |             iters.push(i.iter().peekable());\n25 | |         }\n26 | |     }\n   | |_____^\nnote: ...so that reference does not outlive borrowed content\n  --&gt; src/main.rs:23:18\n   |\n23 |         for i in v.iter() {\n   |                  ^\nnote: but, the lifetime must be valid for the anonymous lifetime #3 defined on the body at 22:79...\n  --&gt; src/main.rs:22:80\n   |\n22 |       fn init_iters(v: &amp;Vec&lt;Vec&lt;usize&gt;&gt;, iters: &amp;mut Vec&lt;Peekable&lt;Iter&lt;usize&gt;&gt;&gt;) {\n   |  ________________________________________________________________________________^\n23 | |         for i in v.iter() {\n24 | |             iters.push(i.iter().peekable());\n25 | |         }\n26 | |     }\n   | |_____^\nnote: ...so that expression is assignable (expected std::iter::Peekable&lt;std::slice::Iter&lt;'_, _&gt;&gt;, found std::iter::Peekable&lt;std::slice::Iter&lt;'_, _&gt;&gt;)\n  --&gt; src/main.rs:24:24\n   |\n24 |             iters.push(i.iter().peekable());\n   |                        ^^^^^^^^^^^^^^^^^^^\n\nerror[E0308]: mismatched types\n  --&gt; src/main.rs:33:20\n   |\n33 |         init_iters(v, &amp;mut iters);\n   |                    ^ expected reference, found struct `std::vec::Vec`\n   |\n   = note: expected type `&amp;std::vec::Vec&lt;std::vec::Vec&lt;usize&gt;&gt;`\n              found type `std::vec::Vec&lt;std::vec::Vec&lt;{integer}&gt;&gt;`\n   = help: try with `&amp;v`\n</code></pre>\n\n<p>Why do I get this error? How do I fix it?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 1393858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ccb10f4226a60fcfc2360d6452a8ae4?s=128&d=identicon&r=PG", "display_name": "CT075", "link": "https://stackoverflow.com/users/1393858/ct075"}, "edited": false, "score": 1, "creation_date": 1499719291, "post_id": 45019661, "comment_id": 77016744, "body": "Aha, thanks! There is an alias &quot;RgbImage&quot; that I usually use, but I figured it&#39;d be useful to state it explicitly. However, I&#39;m not sure how to alias ImageBuffer&lt;P,C&gt; because I&#39;d still need the <code>where</code> clause in my functions (I keep getting <code>trait constraints in type definitions not enforced</code>)"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 87, "user_id": 1393858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ccb10f4226a60fcfc2360d6452a8ae4?s=128&d=identicon&r=PG", "display_name": "CT075", "link": "https://stackoverflow.com/users/1393858/ct075"}, "edited": false, "score": 0, "creation_date": 1499720615, "post_id": 45019661, "comment_id": 77017384, "body": "Yeah, including the full example in the question is definitely the right thing to do. There&#39;s not much you can do for the <code>image::ImageBuffer&lt;P, C&gt;</code>; really I meant you might want to just import it fully to avoid writing &quot;image&quot; twice `."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 1, "last_activity_date": 1499715621, "last_edit_date": 1499715621, "creation_date": 1499712779, "answer_id": 45019661, "question_id": 45002722, "link": "https://stackoverflow.com/questions/45002722/how-to-change-image-color-type-using-pistons-image-lib/45019661#45019661", "title": "How to change Image color type using Piston&#39;s image lib?", "body": "<p>You can use the trait bound provided by <code>image::ConvertBuffer</code> directly:</p>\n\n<pre><code>extern crate image;\n\nuse image::ConvertBuffer;\n\npub fn process_generic&lt;P, C&gt;(im: image::ImageBuffer&lt;P, C&gt;)\nwhere\n    image::ImageBuffer&lt;P, C&gt;: image::ConvertBuffer&lt;image::ImageBuffer&lt;image::Rgb&lt;u8&gt;, Vec&lt;u8&gt;&gt;&gt;,\n    P: image::Pixel + 'static,\n{\n    let _result = im.convert();\n}\n\nfn main() {}\n</code></pre>\n\n<p>Although I'd recommend introducing a type alias for <code>image::ImageBuffer&lt;image::Rgb&lt;u8&gt;, Vec&lt;u8&gt;&gt;</code> and/or <code>image::ImageBuffer&lt;P, C&gt;</code>.</p>\n"}], "owner": {"reputation": 87, "user_id": 1393858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ccb10f4226a60fcfc2360d6452a8ae4?s=128&d=identicon&r=PG", "display_name": "CT075", "link": "https://stackoverflow.com/users/1393858/ct075"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 0, "accepted_answer_id": 45019661, "answer_count": 1, "score": 2, "last_activity_date": 1499715621, "creation_date": 1499651090, "last_edit_date": 1499711971, "question_id": 45002722, "link": "https://stackoverflow.com/questions/45002722/how-to-change-image-color-type-using-pistons-image-lib", "title": "How to change Image color type using Piston&#39;s image lib?", "body": "<p>I have an application intended to work with image data using RGB pixel formats. I need to allow it to take images of all encodings. My first idea was to convert the image to RGB format before processing:</p>\n\n<pre><code>extern crate image;\n\nuse std::ops;\nuse image::ConvertBuffer;\n\npub fn process_generic&lt;P,C&gt;(im: image::ImageBuffer&lt;P,C&gt;)\n   where P: image::Pixel + 'static,\n         P::Subpixel: 'static,\n         C: ops::Deref&lt;Target = [P::Subpixel]&gt;\n{\n    let result: image::ImageBuffer&lt;image::Rgb&lt;u8&gt;, Vec&lt;u8&gt;&gt; = im.convert();\n}\n\nfn main() {}\n</code></pre>\n\n<p>Compiling this gives me an error </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `image::Rgb&lt;u8&gt;: image::color::FromColor&lt;P&gt;` is not satisfied\n  --&gt; src/main.rs:12:66\n   |\n12 |     let result: image::ImageBuffer&lt;image::Rgb&lt;u8&gt;, Vec&lt;u8&gt;&gt; = im.convert();\n   |                                                                  ^^^^^^^ the trait `image::color::FromColor&lt;P&gt;` is not implemented for `image::Rgb&lt;u8&gt;`\n   |\n   = help: consider adding a `where image::Rgb&lt;u8&gt;: image::color::FromColor&lt;P&gt;` bound\n   = note: required because of the requirements on the impl of `image::ConvertBuffer&lt;image::ImageBuffer&lt;image::Rgb&lt;u8&gt;, std::vec::Vec&lt;u8&gt;&gt;&gt;` for `image::ImageBuffer&lt;P, C&gt;`\n</code></pre>\n\n<p>I can't add the bound because the module <code>image::color</code> is private. Am I missing something? I was also attempting to go through and convert each pixel manually, but that seems like a worse way to do it.</p>\n"}, {"tags": ["rust", "iron"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499632952, "post_id": 45000679, "comment_id": 76975681, "body": "From <a href=\"https://docs.rs/mount/0.3.0/mount/struct.Mount.html#method.mount\" rel=\"nofollow noreferrer\"><code>Mount</code>&#39;s documentation</a>: <i>Existing handlers on the same route will be overwritten.</i>"}, {"owner": {"reputation": 22795, "user_id": 486057, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a9fd749502d6cb012df9425b028cea32?s=128&d=identicon&r=PG", "display_name": "Rogach", "link": "https://stackoverflow.com/users/486057/rogach"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499633612, "post_id": 45000679, "comment_id": 76975906, "body": "@Shepmaster - Yes, that&#39;s true. Maybe there is a way to achieve this without Mount?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499642832, "post_id": 45000679, "comment_id": 76977996, "body": "<i><code>let mut router = Router:new();</code></i> this isn&#39;t valid Rust code for the stable version of Rust (1.18.0). I don&#39;t know how you could have lost a <code>:</code> in the middle of the code that you copied from your <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. Please go ahead and paste the <i>entire</i> MCVE to make it easier for other people to answer."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 1, "last_activity_date": 1499643567, "creation_date": 1499643567, "answer_id": 45002059, "question_id": 45000679, "link": "https://stackoverflow.com/questions/45000679/how-do-i-create-a-server-that-serves-api-and-falls-back-to-disk-using-iron/45002059#45002059", "title": "How do I create a server that serves API and falls back to disk using Iron?", "body": "<p>There's no need to use a <code>Router</code> at all; just pass the handler directly to <code>mount</code>:</p>\n\n<pre><code>extern crate iron;\nextern crate mount;\nextern crate staticfile;\n\nuse iron::prelude::*;\nuse iron::status;\nuse mount::Mount;\nuse staticfile::Static;\n\nuse std::path::Path;\n\nfn main() {\n    let hello = |_: &amp;mut Request| {\n        Ok(Response::with((status::Ok, \"hello\")))\n    };\n\n    let mut mount = Mount::new();\n    mount.mount(\"/hello\", hello)\n        .mount(\"/\", Static::new(Path::new(\"src/public/\")));\n\n    let _server = Iron::new(mount).http(\"localhost:3000\").unwrap();\n    println!(\"On 3000\");\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ curl localhost:3000/animal\ncow\n$ curl localhost:3000/hello\nhello\n</code></pre>\n"}], "owner": {"reputation": 22795, "user_id": 486057, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a9fd749502d6cb012df9425b028cea32?s=128&d=identicon&r=PG", "display_name": "Rogach", "link": "https://stackoverflow.com/users/486057/rogach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1499643567, "creation_date": 1499631756, "last_edit_date": 1499632860, "question_id": 45000679, "link": "https://stackoverflow.com/questions/45000679/how-do-i-create-a-server-that-serves-api-and-falls-back-to-disk-using-iron", "title": "How do I create a server that serves API and falls back to disk using Iron?", "body": "<p>I tried the following:</p>\n\n<pre><code>let mut router = Router:new();\nrouter.get(\"/hello\",  |_: &amp;mut Request| {\n  Ok(Response::with((status::Ok, \"hello\")))\n}, \"/hello\");\n\nlet mut mount = Mount::new();\nmount.mount(\"/\", router)\n     .mount(\"/\", Static::new(Path::new(\"src/public/\")));\n</code></pre>\n\n<p>But it results in \"no such file or directory\" errors when I try to access <code>/hello</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Request {\n    url: Url { generic_url: \"http://localhost:10800/hello\" }\n    method: Get\n    remote_addr: V4(127.0.0.1:57260)\n    local_addr: V4(127.0.0.1:10800)\n}\nError was: Error { repr: Os { code: 2, message: \"No such file or directory\" } }\n</code></pre>\n"}, {"tags": ["rust", "visual-studio-code"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1499614558, "post_id": 44998078, "comment_id": 76970069, "body": "Please include how the extension is configured right now. It should be in your user settings JSON file. Also note that there are several <a href=\"https://github.com/editor-rs/vscode-rust/issues?page=2&amp;q=is%3Aissue+is%3Aopen\" rel=\"nofollow noreferrer\">known issues</a> around that extension, and one of them might be relevant."}, {"owner": {"reputation": 376, "user_id": 7268884, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pYfwn.png?s=128&g=1", "display_name": "twistezo", "link": "https://stackoverflow.com/users/7268884/twistezo"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1499614893, "post_id": 44998078, "comment_id": 76970172, "body": "<code>&quot;toolchain&quot;: &quot;stable-x86_64-pc-windows-msvc&quot; &quot;rust.mode&quot;: &quot;legacy&quot;</code> @E_net4 but on nightly and rsl the same problem."}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1499615831, "post_id": 44998078, "comment_id": 76970448, "body": "Please put the <i>entire</i> portion of your configurations that are used by the extension, and <i>edit your question</i> to include that. Also, note that the <a href=\"https://github.com/editor-rs/vscode-rust/blob/master/doc/main.md\" rel=\"nofollow noreferrer\">documentation</a> describes how the extension should be configured."}, {"owner": {"reputation": 376, "user_id": 7268884, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pYfwn.png?s=128&g=1", "display_name": "twistezo", "link": "https://stackoverflow.com/users/7268884/twistezo"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1499622584, "post_id": 44998078, "comment_id": 76972567, "body": "see @E_net4 update 1"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1499628672, "post_id": 44998078, "comment_id": 76974358, "body": "Consider also including which versions of RLS and the compiler are currently installed. Furthermore, check the output tab for the output of the RLS task."}, {"owner": {"reputation": 376, "user_id": 7268884, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pYfwn.png?s=128&g=1", "display_name": "twistezo", "link": "https://stackoverflow.com/users/7268884/twistezo"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1499629788, "post_id": 44998078, "comment_id": 76974720, "body": "i updated @E_net4 what you ask. Do you have any advice to solve this problem ?"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1499630222, "post_id": 44998078, "comment_id": 76974838, "body": "This could be a bug in the extension, so the more informative we have, the better. :) While I check for related things, have a look at <a href=\"https://stackoverflow.com/a/43901712/1233251\">this answer</a>."}, {"owner": {"reputation": 376, "user_id": 7268884, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pYfwn.png?s=128&g=1", "display_name": "twistezo", "link": "https://stackoverflow.com/users/7268884/twistezo"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1499630912, "post_id": 44998078, "comment_id": 76975062, "body": "I saw this post @E_net4 . Looks like bug, but why this also not working in legacy mode.. Do you use for Rust VS Code ?"}], "owner": {"reputation": 376, "user_id": 7268884, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pYfwn.png?s=128&g=1", "display_name": "twistezo", "link": "https://stackoverflow.com/users/7268884/twistezo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 367, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1499629740, "creation_date": 1499614379, "last_edit_date": 1499629740, "question_id": 44998078, "link": "https://stackoverflow.com/questions/44998078/visual-studio-code-rust-kalitaalexey-extension-message-gotodef-failed-to", "title": "Visual Studio Code + Rust + kalitaalexey extension -&gt; Message: GotoDef failed to complete successfully", "body": "<p>I'm on Windows 10 x64, I have installed Rust from official docs and everything that's needed. I'm using Visual Studio Code 1.13.1, Rust 1.18, kalitaalexey extension 0.4.2, rustc 1.20.0-nightly and rls 0.1.0-nightly.</p>\n\n<p>Everything works fine except for 'Go to definition'. For example, when I press <kbd>ctrl</kbd> + left mouse button on <code>println!</code>, I have in the output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[Error - 12:16:10] Request textDocument/definition failed.\nMessage: GotoDef failed to complete successfully\nCode: -32601\n</code></pre>\n\n<p>When I installed kalitaalexey extension for VS Code, I have some options to choose like stable, nightly, legacy or RLS things. Maybe this is the problem? How can I change those options now? Reinstalling the extensions does not help.</p>\n\n<p>The only thing I need is:</p>\n\n<ul>\n<li>when I'm typing <code>prin</code>.... I see a menu with options like <code>print</code>, <code>println</code> and info about those functions from the docs. </li>\n<li>when I press <kbd>ctrl</kbd> + LMB on <code>println!</code> I jump to the source code of this function.</li>\n</ul>\n\n<hr>\n\n<p><strong>Update 1</strong></p>\n\n<p>extensions settings: </p>\n\n<pre><code>\"rust.rustup\": {\n        \"toolchain\": \"nightly-x86_64-pc-windows-msvc\",\n        \"nightlyToolchain\": \"nightly-x86_64-pc-windows-msvc\"\n    },\n    \"rust.mode\": \"rls\",\n    \"rust.rls\": {\n        \"useRustfmt\": true\n    },\n</code></pre>\n\n<p>What i tried:</p>\n\n<ol>\n<li>Reinstall all rust things.</li>\n<li>Three toolchains with legacy and rls mode: </li>\n</ol>\n\n<p>-<code>stable-x86_64-pc-windows-gnu</code></p>\n\n<p>-<code>stable-x86_64-pc-windows-msvc</code></p>\n\n<p>-<code>nightly-x86_64-pc-windows-msvc</code></p>\n"}, {"tags": ["unicode", "rust", "newline", "carriage-return", "linefeed"], "answers": [{"comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 3, "creation_date": 1499609208, "post_id": 44996251, "comment_id": 76968435, "body": "That&#39;s a very nice survey you have here, I expected some degree of variation but honestly not THAT much. Since you mention how Unicode sees it, it would be great if you could link to or mention where it is defined in Unicode to back up your answer."}], "tags": [], "owner": {"reputation": 7882, "user_id": 2722968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d0a9ce812892f03b8342c5a60be24632?s=128&d=identicon&r=PG&f=1", "display_name": "user2722968", "link": "https://stackoverflow.com/users/2722968/user2722968"}, "is_accepted": true, "score": 18, "last_activity_date": 1499624576, "last_edit_date": 1499624576, "creation_date": 1499602222, "answer_id": 44996251, "question_id": 44995851, "link": "https://stackoverflow.com/questions/44995851/how-do-i-check-if-a-character-is-a-unicode-new-line-character-not-only-ascii-i/44996251#44996251", "title": "How do I check if a character is a Unicode new-line character (not only ASCII) in Rust?", "body": "<p>There is considerable practical disagreement between languages like Java, Python, Go and JavaScript as to what constitutes a newline-character and how that translates to \"new lines\". The disagreement is demonstrated by how the batteries-included regex engines treat patterns like <code>$</code> against a string like <code>\\r\\r\\n\\n</code> in multi-line-mode: Are there two lines (<code>\\r\\r\\n</code>, <code>\\n</code>), three lines (<code>\\r</code>, <code>\\r\\n</code>, <code>\\n</code>, like Unicode says) or four (<code>\\r</code>, <code>\\r</code>, <code>\\n</code>, <code>\\n</code>, like JS sees it)? Go and Python do not treat <code>\\r\\n</code> as a single <code>$</code> and neither does Rust's regex crate; Java's does however. I don't know of any language whose batteries extend newline-handling to any more Unicode characters.</p>\n\n<p>So the takeaway here is</p>\n\n<ul>\n<li>It is agreed upon that <code>\\n</code> is a newline</li>\n<li><code>\\r\\n</code> may be a single newline</li>\n<li>unless <code>\\r\\n</code> is treated as two newlines</li>\n<li>unless <code>\\r\\n</code> is \"some character followed by a newline\"</li>\n<li>You shall not have any more newlines beside that.</li>\n</ul>\n\n<p>If you really need more Unicode characters to be treated as newlines, you'll have to define a function that does that for you. Don't expect real-world input that expects that. After all, we had the ASCII Record separator for a gazillion years and everybody uses <code>\\t</code> instead as well.</p>\n\n<p>Update: See <a href=\"http://www.unicode.org/reports/tr14/tr14-32.html#BreakingRules\" rel=\"noreferrer\">http://www.unicode.org/reports/tr14/tr14-32.html#BreakingRules</a>  section <code>LB5</code> for why <code>\\r\\r\\n</code> should be treated as two line breaks. You could read the whole page to get a grip on how your original question would have to be implemented. My guess is by the point you reach \"<em>South East Asian: line breaks require morphological analysis</em>\" you'll close the tab :-)</p>\n"}], "owner": {"reputation": 4048, "user_id": 2173516, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/P3SKn.png?s=128&g=1", "display_name": "Noel Widmer", "link": "https://stackoverflow.com/users/2173516/noel-widmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4545, "favorite_count": 0, "accepted_answer_id": 44996251, "answer_count": 1, "score": 12, "last_activity_date": 1499624576, "creation_date": 1499599402, "last_edit_date": 1499609871, "question_id": 44995851, "link": "https://stackoverflow.com/questions/44995851/how-do-i-check-if-a-character-is-a-unicode-new-line-character-not-only-ascii-i", "title": "How do I check if a character is a Unicode new-line character (not only ASCII) in Rust?", "body": "<p>Every programming language has their own interpretation of <code>\\n</code> and <code>\\r</code>. \nUnicode supports multiple characters that <em>can</em> represent a new line.</p>\n\n<p>From <a href=\"https://doc.rust-lang.org/stable/reference/tokens.html#character-escapes\" rel=\"noreferrer\">the Rust reference</a>:</p>\n\n<blockquote>\n  <p>A whitespace escape is one of the characters U+006E (n), U+0072 (r),\n  or U+0074 (t), denoting the Unicode values U+000A (LF), U+000D (CR) or\n  U+0009 (HT) respectively.</p>\n</blockquote>\n\n<p>Based on that statement, I'd say a Rust character is a new-line character if it is either <code>\\n</code> or <code>\\r</code>. On Windows it might be the combination of <code>\\r</code> and <code>\\n</code>. I'm not sure though.</p>\n\n<p>What about the following?</p>\n\n<ul>\n<li>Next line character (U+0085)</li>\n<li>Line separator character (U+2028)</li>\n<li>Paragraph separator character (U+2029)</li>\n</ul>\n\n<p>In my opinion, we are missing something like a <code>char.is_new_line()</code>. \nI looked through the <a href=\"http://www.fileformat.info/info/unicode/category/index.htm\" rel=\"noreferrer\">Unicode Character Categories</a> but couldn't find a definition for new-lines.</p>\n\n<p>Do I have to come up with my own definition of what a Unicode new-line character is?</p>\n"}, {"tags": ["vector", "rust", "move"], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1499610114, "post_id": 44993343, "comment_id": 76968700, "body": "<code>nth(0)</code> is usually written <code>next()</code>. Also note that your answer has nothing to do with the collection being &quot;indexable&quot;."}, {"owner": {"reputation": 11441, "user_id": 24817, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/233c279c012ebac792aaa805f966cbc7?s=128&d=identicon&r=PG", "display_name": "Steve Klabnik", "link": "https://stackoverflow.com/users/24817/steve-klabnik"}, "edited": false, "score": 0, "creation_date": 1499619980, "post_id": 44993343, "comment_id": 76971735, "body": "No need for the <code>collect</code> above, and then the <code>into_iter</code> call; you should be able to pass <code>env::args()</code> directly to this function, no?"}], "tags": [], "owner": {"reputation": 828, "user_id": 2736686, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3e64d071a0d538d0b88040e4bfa22d2d?s=128&d=identicon&r=PG", "display_name": "Erik Uggeldahl", "link": "https://stackoverflow.com/users/2736686/erik-uggeldahl"}, "is_accepted": false, "score": 3, "last_activity_date": 1499578718, "creation_date": 1499578718, "answer_id": 44993343, "question_id": 44993342, "link": "https://stackoverflow.com/questions/44993342/how-to-generically-move-data-out-of-an-indexable-collection/44993343#44993343", "title": "How to generically move data out of an indexable collection?", "body": "<p>The answer is to use a consuming iterator:</p>\n\n<pre><code>    ...\n    let config = parse_config(args.into_iter());\n    ...\n\nfn parse_config&lt;T: Iterator&lt;Item=String&gt;&gt;(mut args: T) -&gt; Config {\n    let query = args.nth(1).expect(\"First arg none\");\n    let filename = args.nth(0).expect(\"Second arg none\");\n    ...\n}\n</code></pre>\n\n<p>Note that the <code>nth</code> function is advancing and consuming the iterator, so that instead of the second argument indexing at <code>2</code>, it is now one iteration later, i.e. <code>0</code>.</p>\n"}], "owner": {"reputation": 828, "user_id": 2736686, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3e64d071a0d538d0b88040e4bfa22d2d?s=128&d=identicon&r=PG", "display_name": "Erik Uggeldahl", "link": "https://stackoverflow.com/users/2736686/erik-uggeldahl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1499610041, "creation_date": 1499578718, "last_edit_date": 1499610041, "question_id": 44993342, "link": "https://stackoverflow.com/questions/44993342/how-to-generically-move-data-out-of-an-indexable-collection", "title": "How to generically move data out of an indexable collection?", "body": "<p>The <a href=\"https://doc.rust-lang.org/beta/book/second-edition/ch12-03-improving-error-handling-and-modularity.html#grouping-configuration-values\" rel=\"nofollow noreferrer\">I/O project example</a> in the Rust book suggests cloning the command line args:</p>\n\n<pre><code>fn main() {\n    let args: Vec&lt;String&gt; = env::args().collect();\n    let config = parse_config(&amp;args);\n    // ...\n}\n\nstruct Config {\n    query: String,\n    filename: String,\n}\n\nfn parse_config(args: &amp;[String]) -&gt; Config {\n    let query = args[1].clone();\n    let filename = args[2].clone();\n\n    Config {\n        query, filename\n    }\n}\n</code></pre>\n\n<p>I would like to move the values into the <code>Config</code> struct to avoid the copy.</p>\n\n<p>I tried moving the slice:</p>\n\n<pre><code>fn parse_config(args: [String]) -&gt; Config\n</code></pre>\n\n<p>But got the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>the trait `std::marker::Sized` is not implemented for `[std::string::String]`\n</code></pre>\n\n<p>Which makes sense because it's now reading as an unsized array. Next I tried generics:</p>\n\n<pre><code>fn parse_config&lt;T: std::ops::Index&lt;usize, Output=String&gt; + Sized&gt;(args: T) -&gt; Config\n</code></pre>\n\n<p>Which gives the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cannot move out of indexed content\n</code></pre>\n\n<p>This also makes sense, as it would leave the vector in an <a href=\"https://stackoverflow.com/a/27905403/2736686\">invalid state</a>. I could move the vector:</p>\n\n<pre><code>fn parse_config(mut args: Vec&lt;String&gt;) -&gt; Config {\n    let query = args.remove(1);\n    // ...\n</code></pre>\n\n<p>But now the function is tied to the particular container <code>Vector</code>.</p>\n\n<p>How would I write a function that consumes the vector and allows me to move out its contents, while still preserving the generic nature of the function?</p>\n"}, {"tags": ["rust", "rust-tokio"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 7, "creation_date": 1499806891, "post_id": 44990227, "comment_id": 77063167, "body": "Can you put the relevant code parts of your problem into the question, as a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>? Having to check code from links is not very readable and makes it harder to answer."}, {"owner": {"reputation": 3589, "user_id": 711380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645d55fac31440e2cd1bc6432690199f?s=128&d=identicon&r=PG", "display_name": "remram", "link": "https://stackoverflow.com/users/711380/remram"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1499812179, "post_id": 44990227, "comment_id": 77065255, "body": "Not easily since you do need client code along with it, to make the websocket connection. I&#39;ll see if I can minimalize it a bit..."}, {"owner": {"reputation": 2959, "user_id": 5903309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/665cdb14fb46d20c11a176c92e6ed663?s=128&d=identicon&r=PG", "display_name": "Jan Nils Ferner", "link": "https://stackoverflow.com/users/5903309/jan-nils-ferner"}, "edited": false, "score": 2, "creation_date": 1499860511, "post_id": 44990227, "comment_id": 77087024, "body": "You might find some answers in <a href=\"https://github.com/cyderize/rust-websocket/blob/master/examples/parallel-server.rs\" rel=\"nofollow noreferrer\">this example</a> that I wrote myself, as I had similar troubles. The indentation is jumbled up because the project uses an old version of rustfmt, I recommend copy-pasting it into your own editor and running the latest rustfmt on it."}, {"owner": {"reputation": 608, "user_id": 1907543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7597ff99ee5f0704208709c3d17d9f33?s=128&d=identicon&r=PG", "display_name": "daboross", "link": "https://stackoverflow.com/users/1907543/daboross"}, "edited": false, "score": 0, "creation_date": 1516650364, "post_id": 44990227, "comment_id": 83765925, "body": "Are you sure the &quot;flush&quot; isn&#39;t the difference here? <code>.forward()</code> is definitely equivalent to <code>.fold(sink, |out, b| { out.send(b) })</code>, but it doesn&#39;t call <code>flush</code> like your fold example. Could it just be that for your application, you need to flush the stream, and thus <code>forward</code> is not appropriate?"}], "owner": {"reputation": 3589, "user_id": 711380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/645d55fac31440e2cd1bc6432690199f?s=128&d=identicon&r=PG", "display_name": "remram", "link": "https://stackoverflow.com/users/711380/remram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 934, "favorite_count": 0, "answer_count": 0, "score": 14, "last_activity_date": 1499725992, "creation_date": 1499543761, "question_id": 44990227, "link": "https://stackoverflow.com/questions/44990227/forwarding-from-a-futuresstream-to-a-futuressink", "title": "Forwarding from a futures::Stream to a futures::Sink", "body": "<p>I am currently trying to wrap my head around the tokio &amp; futures primitives and ecosystem.</p>\n\n<p>I started doing some work from the <a href=\"https://github.com/swindon-rs/tk-http/blob/abfdb50a00ab90b4f01b23ff8dbefe6e83331d9c/examples/websockets.rs\" rel=\"noreferrer\">tk-http websockets example</a>, and wanted to do more processing on the received data rather than echoing it back. A first step seemed to be to replace the .forward() call with some kind of loop.</p>\n\n<p>It seemed to me that <code>stream.forward(sink)</code> is equivalent to <code>stream.fold(sink, |out_, item| { out.send(item).and_then(Sink::flush) })</code>, however doing this (<a href=\"https://gitlab.com/remram44/rs-web/commit/b1edd5a68ddb676b6a912576bdf08600cbeab96e\" rel=\"noreferrer\">commit</a>) the stream is not polled at all. However the same change from the Tokio example works fine (<a href=\"https://gitlab.com/remram44/rs-web/commit/5345a3e7f5f4e4ec81791d5e7e0474154329bd0e\" rel=\"noreferrer\">example</a>).</p>\n\n<p>Furthermore, it seems that outputting something on the sink first makes the forwarding work fine (<a href=\"https://gitlab.com/remram44/rs-web/commit/d690039fde5d4d6ab35f0f0a13be3ef46c84807b\" rel=\"noreferrer\">commit</a>), so maybe the sink doesn't get registered with the event loop for some reason until a send happen? Did I miss something? Is it possible it is a bug in tk-http?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "edited": false, "score": 8, "creation_date": 1499542701, "post_id": 44990058, "comment_id": 76954925, "body": "Rust doesn&#39;t allow <code>struct {...} variableName;</code> the way that C does, so there&#39;s no reason to require a semicolon there. And I don&#39;t think there&#39;s any language that requires a semicolon after function definitions."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 8, "creation_date": 1499542707, "post_id": 44990058, "comment_id": 76954928, "body": "What kind of answer are you looking for? In the end, it boils down to &quot;because the grammar and the Rust parser allow it&quot;, which in turn boils down to &quot;because that&#39;s the way it was defined&quot; which in turn boils down to &quot;because someone wanted it that way&quot;."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 3, "creation_date": 1499543308, "post_id": 44990058, "comment_id": 76955109, "body": "With grammar/syntax question, it&#39;s better to ask &quot;why we should/must add it&quot;, and currently there is no reason to add it."}, {"owner": {"reputation": 1982, "user_id": 2872479, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ez7og.jpg?s=128&g=1", "display_name": "metame", "link": "https://stackoverflow.com/users/2872479/metame"}, "edited": false, "score": 1, "creation_date": 1499561957, "post_id": 44990058, "comment_id": 76959032, "body": "Surmising, but lexically a semicolon provides an end to a statement, e.g. <code>let a = 5;</code>. When there is a block <code>{}</code> we already have a lexical scope, an apparent end, hence a struct definition, function definition, or if expression doesn&#39;t need a semi-colon."}], "answers": [{"comments": [{"owner": {"reputation": 706, "user_id": 2640937, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2bdde9ada4ed0bf5df04bad03a51642d?s=128&d=identicon&r=PG", "display_name": "Vaelus", "link": "https://stackoverflow.com/users/2640937/vaelus"}, "edited": false, "score": 0, "creation_date": 1563211509, "post_id": 44992260, "comment_id": 100616828, "body": "So block expressions don&#39;t need <code>;</code> iff their value is <code>()</code>?"}, {"owner": {"reputation": 2645, "user_id": 5254193, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PTHapBqhSQM/AAAAAAAAAAI/AAAAAAAABA4/r5mrExVuDgU/photo.jpg?sz=128", "display_name": "Masaki Hara", "link": "https://stackoverflow.com/users/5254193/masaki-hara"}, "reply_to_user": {"reputation": 706, "user_id": 2640937, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2bdde9ada4ed0bf5df04bad03a51642d?s=128&d=identicon&r=PG", "display_name": "Vaelus", "link": "https://stackoverflow.com/users/2640937/vaelus"}, "edited": false, "score": 1, "creation_date": 1563252341, "post_id": 44992260, "comment_id": 100627146, "body": "Block expressions don&#39;t need <code>;</code> iff their value doesn&#39;t need to be explicitly changed to <code>()</code>. That means their value is already <code>()</code> or their value is actually used. Latter examples include those part of <code>let x =</code> and those which are the last sentence in another block."}], "tags": [], "owner": {"reputation": 2645, "user_id": 5254193, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PTHapBqhSQM/AAAAAAAAAAI/AAAAAAAABA4/r5mrExVuDgU/photo.jpg?sz=128", "display_name": "Masaki Hara", "link": "https://stackoverflow.com/users/5254193/masaki-hara"}, "is_accepted": true, "score": 7, "last_activity_date": 1499564919, "creation_date": 1499564919, "answer_id": 44992260, "question_id": 44990058, "link": "https://stackoverflow.com/questions/44990058/why-can-a-rust-struct-be-defined-without-a-semicolon/44992260#44992260", "title": "Why can a Rust struct be defined without a semicolon?", "body": "<p>As Shepmaster said in the comment, the \"reason\" is that Rust defines so. Here I will explain the rules behind it.</p>\n\n<p>Basically <strong>you can omit <code>;</code> when it ends with <code>}</code></strong>. This will answer your question.</p>\n\n<p>However, there are a number of exceptions to the rule:</p>\n\n<h2>When <code>{}</code> appears indirectly</h2>\n\n<p>The rule above doesn't apply when <code>{}</code> appears indirectly, like</p>\n\n<pre><code>use std::io::{self, Read, Write}; // Here }; appears\n</code></pre>\n\n<p>or</p>\n\n<pre><code>let x = if cond {\n    1\n} else {\n    2\n}; // Here }; appears\n</code></pre>\n\n<p>In this case, <code>{}</code> isn't a direct part of <code>use</code>/<code>let</code>. So in this case you need <code>;</code>.</p>\n\n<h2>Items</h2>\n\n<p>Items are things which you can also place outside of functions. That is, one of <code>extern crate</code>, <code>use</code>, <code>mod</code>, <code>struct</code>, <code>enum</code>, <code>union</code>, <code>type</code>, <code>trait</code>, <code>impl</code>, <code>fn</code>, <code>static</code>, <code>const</code>, <code>extern</code>, and macros.</p>\n\n<p>You can place items either outside of functions or in a function. However, There is a difference between them:</p>\n\n<ul>\n<li>If it appears outside of functions, you <strong>have to</strong> omit <code>;</code> when unnecessary.</li>\n<li>If it appears in a function, you can also place <code>;</code> there. This is basically because the <code>;</code> itself is an <strong>empty statement</strong>.</li>\n</ul>\n\n<p>Example:</p>\n\n<pre><code>struct A {} // You can't place ; here\nfn main() {\n    struct B {} // You can omit ; here\n    struct C {}; // You can also place ; here\n}\n</code></pre>\n\n<h2>The last expression</h2>\n\n<p>You have to omit <code>;</code> if</p>\n\n<ul>\n<li>It is the last statement in the block,</li>\n<li>it is an expression (items and <code>let</code> aren't expressions), and</li>\n<li>you want to return the value from the expression.</li>\n</ul>\n\n<p>Example:</p>\n\n<pre><code>fn f() -&gt; i32 {\n    let x = 1;\n    x + x // You want to return x + x, so you can't place `;` here\n}\n</code></pre>\n\n<h2>Block expressions</h2>\n\n<p><code>if</code>, <code>if let</code>, <code>match</code>, <code>loop</code>, <code>while</code>, <code>while let</code>, <code>for</code>, <code>unsafe</code>, and bare <code>{}</code> ends with <code>}</code>, so you can omit <code>;</code> after them. However, there is a slight effect if you place <code>;</code> here.</p>\n\n<p>Example:</p>\n\n<pre><code>fn f(x: i32) -&gt; i32 {\n    if x &lt; 10 {\n        10\n    } else {\n        20\n    }; // If you remove ; here, then you will see a compile error.\n    42\n}\n</code></pre>\n\n<p>In most cases, you don't have to place <code>;</code> here; instead you may have to place <code>;</code> in the blocks.</p>\n\n<pre><code>fn f(x: i32) -&gt; i32 {\n    if x &lt; 10 {\n        10;\n    } else {\n        20;\n    }\n    42\n}\n</code></pre>\n\n<h2>Statement macros</h2>\n\n<p>In statement positions, you can write three different kinds of macros:</p>\n\n<ul>\n<li><code>some_macro!()</code>/<code>some_macro![]</code>: this isn't in fact a statement macro; instead, this is a mere expression macro. It can't expand to items or <code>let</code>.</li>\n<li><code>some_macro!{}</code>: this expands to zero or more statements.</li>\n<li><code>some_macro!();</code>/<code>some_macro![];</code>/<code>some_macro!{};</code>: this also expands to zero or more statements; however, there is a very minor difference: <code>;</code> is added to the last expanded statement.</li>\n</ul>\n"}], "owner": {"reputation": 4710, "user_id": 2281274, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/sHobc.gif?s=128&g=1", "display_name": "George Shuklin", "link": "https://stackoverflow.com/users/2281274/george-shuklin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 603, "favorite_count": 0, "accepted_answer_id": 44992260, "answer_count": 1, "score": 4, "last_activity_date": 1499564919, "creation_date": 1499542360, "last_edit_date": 1499542624, "question_id": 44990058, "link": "https://stackoverflow.com/questions/44990058/why-can-a-rust-struct-be-defined-without-a-semicolon", "title": "Why can a Rust struct be defined without a semicolon?", "body": "<p>I'm learning Rust and the chapter for structs gives an example of a struct without a <code>;</code> at the end. It compiles but I have no idea why this is allowed.</p>\n\n<pre><code>fn main() {\n    struct User {\n        username: String,\n        email: String,\n        sign_in_count: u64,\n        active: bool,\n    }\n}\n</code></pre>\n\n<p>... same question goes for functions, actually.</p>\n"}, {"tags": ["arrays", "memory", "vector", "rust"], "comments": [{"owner": {"reputation": 741, "user_id": 238800, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3d591995f3c98346a8be0037fccd6c47?s=128&d=identicon&r=PG", "display_name": "itarato", "link": "https://stackoverflow.com/users/238800/itarato"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499532789, "post_id": 44988548, "comment_id": 76951922, "body": "@Stargateur - Unfortunately that would exceed the memory limit. (That&#39;s why I was also considering linked lists.)"}, {"owner": {"reputation": 741, "user_id": 238800, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3d591995f3c98346a8be0037fccd6c47?s=128&d=identicon&r=PG", "display_name": "itarato", "link": "https://stackoverflow.com/users/238800/itarato"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499533094, "post_id": 44988548, "comment_id": 76952017, "body": "Same: <code>fatal runtime error: out of memory</code>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1499533106, "post_id": 44988548, "comment_id": 76952024, "body": "<i>performs under a second</i> \u2014 how much under a second? Instantly? I wonder if C++ is deferring some work until later when the vector is actually used, while Rust is being more proactive. If so, then the time difference might be moot as the C++ would take longer later."}, {"owner": {"reputation": 741, "user_id": 238800, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3d591995f3c98346a8be0037fccd6c47?s=128&d=identicon&r=PG", "display_name": "itarato", "link": "https://stackoverflow.com/users/238800/itarato"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499533204, "post_id": 44988548, "comment_id": 76952069, "body": "@Shepmaster - yes, I was aware of that effect, so in my example I filled up the whole array and executed the algorithm for my problem - the timing was the partial timing for the allocation - the whole algorithm as well finished in less  than 3s in C++."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1499533372, "post_id": 44988548, "comment_id": 76952131, "body": "@Stargateur note that a <code>Vec&lt;i32&gt;</code> with 2*10^12 entries is 8 TB (7.2TiB). Most people do not have a chunk of RAM that big."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1499533551, "post_id": 44988548, "comment_id": 76952185, "body": "The dumb question that has to be asked because you didn&#39;t state it explicitly: are you compiling and running the Rust code with <code>--release</code>?"}, {"owner": {"reputation": 741, "user_id": 238800, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3d591995f3c98346a8be0037fccd6c47?s=128&d=identicon&r=PG", "display_name": "itarato", "link": "https://stackoverflow.com/users/238800/itarato"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499534495, "post_id": 44988548, "comment_id": 76952475, "body": "@Shepmaster - no, this needs to run on Hackerrank so I tried to keep everything &quot;basic&quot;."}, {"owner": {"reputation": 741, "user_id": 238800, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3d591995f3c98346a8be0037fccd6c47?s=128&d=identicon&r=PG", "display_name": "itarato", "link": "https://stackoverflow.com/users/238800/itarato"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499534661, "post_id": 44988548, "comment_id": 76952525, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/148691/discussion-between-itarato-and-shepmaster\">continue this discussion in chat</a>."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 2, "creation_date": 1499535188, "post_id": 44988548, "comment_id": 76952686, "body": "Checking the assembly, there is no reason for Rust to be slower than C++. Actually, if anything, it seems to me Rust should be faster (at least with Clang, C++ seems to be calling <code>new</code> for each inner vector). In release mode of course, because there&#39;s little point using C++ or Rust in Debug mode."}, {"owner": {"reputation": 7882, "user_id": 2722968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d0a9ce812892f03b8342c5a60be24632?s=128&d=identicon&r=PG&f=1", "display_name": "user2722968", "link": "https://stackoverflow.com/users/2722968/user2722968"}, "edited": false, "score": 1, "creation_date": 1499543042, "post_id": 44988548, "comment_id": 76955031, "body": "I assume your matrix will be extremely sparse since the full allocation of 10<b>7*2*10</b>5*4 bytes is probably not within your budget constraint. If adjacent element placement is not required, you may get away with simply using HashMaps of HashMaps and the array position as keys. You&#39;ll pay more in terms of actual memory consumed and slower lookups for individual elements, but if you matrix is truly sparse it may not matter."}], "owner": {"reputation": 741, "user_id": 238800, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3d591995f3c98346a8be0037fccd6c47?s=128&d=identicon&r=PG", "display_name": "itarato", "link": "https://stackoverflow.com/users/238800/itarato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "closed_date": 1499574390, "answer_count": 0, "score": 1, "last_activity_date": 1499568032, "creation_date": 1499532535, "last_edit_date": 1499568032, "question_id": 44988548, "link": "https://stackoverflow.com/questions/44988548/fast-fixed-array-of-dynamically-growing-vector-in-rust", "closed_reason": "Duplicate", "title": "Fast fixed array of dynamically growing vector in Rust", "body": "<p>I need to create a known number of dynamically growing vectors of integers. The number of the vectors are known (N = 10^7) as well as the maximum size of any of those vectors (M = 2*10^5).</p>\n\n<p>My naive idea was:</p>\n\n<pre><code>let list: Vec&lt;Vec&lt;i32&gt;&gt; = vec![Vec::new(); N];\n</code></pre>\n\n<p>This works but takes ~3s on an i7 2.8 GHz. I've looked into arrays, which generally have 2x performance over vectors:</p>\n\n<pre><code>// Does not compile!\nlet list: [Vec&lt;i32&gt;; N] = [Vec::new(); N];\n</code></pre>\n\n<p>This does not compile as <code>Vec</code> is not copyable. I wasn't able to wrap <code>Vec</code> with a struct and implement <code>Copy</code> on it.</p>\n\n<p>I could use an array of arrays (<code>[[i32; M]; N]</code>) but this would allocate way too much memory.</p>\n\n<p>How can I create a list of dynamically sized arrays that performs well?</p>\n\n<p>For comparison, the same in C++ performs under a second:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>std::vector&lt;std::vector&lt;int32_t&gt;&gt; list(N, std::vector&lt;int32_t&gt;());\n</code></pre>\n\n<p>I was thinking of using a linked list instead of vectors, but I feel there is an elegant solution for this problem.</p>\n\n<p>Update: as @Shepmaster pointed out correctly, compiling with <code>--release</code> should be the base of comparison. This way <code>cargo build --release</code> provides ~45x speed increase, being twice as fast as clang with <code>-O3</code>.</p>\n"}, {"tags": ["rust", "borrow-checker"], "answers": [{"comments": [{"owner": {"reputation": 1913, "user_id": 275196, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2c20425d4619585036e00049e4f325d6?s=128&d=identicon&r=PG", "display_name": "moatPylon", "link": "https://stackoverflow.com/users/275196/moatpylon"}, "edited": false, "score": 1, "creation_date": 1499528013, "post_id": 44987645, "comment_id": 76950515, "body": "Basically, computing values and pushing them are dependant on the same condition for the same value, but different values have different conditions, so your first case means duplicating <code>if</code> statements. The values can&#39;t be moved into the vector because the vector must contain references to trait objects. But your last case is exactly what I&#39;m after."}, {"owner": {"reputation": 2816, "user_id": 5402030, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/pT1Sp.png?s=128&g=1", "display_name": "MutantOctopus", "link": "https://stackoverflow.com/users/5402030/mutantoctopus"}, "edited": false, "score": 1, "creation_date": 1524542690, "post_id": 44987645, "comment_id": 87002800, "body": "I always did wonder if there was any practical purpose to the <code>let a;</code> syntax."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 2816, "user_id": 5402030, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/pT1Sp.png?s=128&g=1", "display_name": "MutantOctopus", "link": "https://stackoverflow.com/users/5402030/mutantoctopus"}, "edited": false, "score": 0, "creation_date": 1524580880, "post_id": 44987645, "comment_id": 87025315, "body": "@BHustus see <a href=\"https://stackoverflow.com/a/28220053/155423\">another example that&#39;s probably even more useful</a>."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 13, "last_activity_date": 1536771001, "last_edit_date": 1536771001, "creation_date": 1499526917, "answer_id": 44987645, "question_id": 44987555, "link": "https://stackoverflow.com/questions/44987555/how-do-i-add-references-to-a-container-when-the-borrowed-values-are-created-afte/44987645#44987645", "title": "How do I add references to a container when the borrowed values are created after the container?", "body": "<blockquote>\n  <p>Is it even possible to compile this in safe Rust?</p>\n</blockquote>\n\n<p>No. What you are trying to do is <strong>inherently unsafe</strong> in the general case.</p>\n\n<p>The collection contains a reference to a variable that will be dropped before the collection itself is dropped. This means that the destructor of the collection has access to references that are <em>no longer valid</em>. The destructor could choose to dereference one of those values, breaking Rust's memory safety guarantees.</p>\n\n<blockquote>\n  <p>note: values in a scope are dropped in the opposite order they are created</p>\n</blockquote>\n\n<p>As the compiler tells you, you need to reorder your code. <em>You didn't actually say what the limitations are</em> for \"reasons related to code organization\", but the straight fix is:</p>\n\n<pre><code>fn f() {\n    let a = 0;\n    let b = 0;\n    let mut vec = Vec::new();\n    vec.push(&amp;a);\n    vec.push(&amp;b);\n}\n</code></pre>\n\n<p>A less obvious one is:</p>\n\n<pre><code>fn f() {\n    let a;\n    let b;\n\n    let mut vec = Vec::new();\n    a = 0;\n    vec.push(&amp;a);\n    b = 0;\n    vec.push(&amp;b);\n}\n</code></pre>\n\n<hr>\n\n<p>That all being said, once <a href=\"https://stackoverflow.com/q/50251487/155423\">non-lexical lifetimes</a> are enabled, your original code will work! The borrow checker becomes more granular about how long a value needs to live.</p>\n\n<p>But <em>wait</em>; I just said that the collection might access invalid memory if a value inside it is dropped before the collection, and now the compiler is allowing that to happen? What gives?</p>\n\n<p>This is because the standard library pulls a sneaky trick on us. Collections like <code>Vec</code> or <code>HashSet</code> guarantee that they do not access their generic parameters in the destructor. They communicate this to the compiler using the <a href=\"https://github.com/rust-lang/rust/issues/34761\" rel=\"nofollow noreferrer\">unstable <code>#[may_dangle]</code></a> feature. </p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/43428894/155423\">Moved variable still borrowing after calling `drop`?</a></li>\n<li><a href=\"https://stackoverflow.com/q/34007692/155423\">&quot;cannot move out of variable because it is borrowed&quot; when rotating variables</a></li>\n</ul>\n"}], "owner": {"reputation": 1913, "user_id": 275196, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/2c20425d4619585036e00049e4f325d6?s=128&d=identicon&r=PG", "display_name": "moatPylon", "link": "https://stackoverflow.com/users/275196/moatpylon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 0, "accepted_answer_id": 44987645, "answer_count": 1, "score": 10, "last_activity_date": 1537118303, "creation_date": 1499526319, "last_edit_date": 1537118303, "question_id": 44987555, "link": "https://stackoverflow.com/questions/44987555/how-do-i-add-references-to-a-container-when-the-borrowed-values-are-created-afte", "title": "How do I add references to a container when the borrowed values are created after the container?", "body": "<p>For reasons related to code organization, I need the compiler to accept the following (simplified) code:</p>\n\n<pre><code>fn f() {\n    let mut vec = Vec::new();\n    let a = 0;\n    vec.push(&amp;a);\n    let b = 0;\n    vec.push(&amp;b);\n    // Use `vec`\n}\n</code></pre>\n\n<p>The compiler complains </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: `a` does not live long enough\n --&gt; src/main.rs:8:1\n  |\n4 |     vec.push(&amp;a);\n  |               - borrow occurs here\n...\n8 | }\n  | ^ `a` dropped here while still borrowed\n  |\n  = note: values in a scope are dropped in the opposite order they are created\n\nerror: `b` does not live long enough\n --&gt; src/main.rs:8:1\n  |\n6 |     vec.push(&amp;b);\n  |               - borrow occurs here\n7 |     // Use `vec`\n8 | }\n  | ^ `b` dropped here while still borrowed\n  |\n  = note: values in a scope are dropped in the opposite order they are created\n</code></pre>\n\n<p>However, I'm having a hard time convincing the compiler to drop the vector before the variables it references. <code>vec.clear()</code> doesn't work, and neither does <code>drop(vec)</code>. <code>mem::transmute()</code> doesn't work either (to force <code>vec</code> to be <code>'static</code>).</p>\n\n<p>The only solution I found was to transmute the reference into <code>&amp;'static _</code>. Is there any other way? Is it even possible to compile this in safe Rust?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 5207, "user_id": 3277393, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/a2967a01798ad7d675a6b39f41232a5b?s=128&d=identicon&r=PG&f=1", "display_name": "user12341234", "link": "https://stackoverflow.com/users/3277393/user12341234"}, "edited": false, "score": 0, "creation_date": 1499523699, "post_id": 44987155, "comment_id": 76948510, "body": "Does it make sense for Iterator::any to take self by mutable reference?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 5207, "user_id": 3277393, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/a2967a01798ad7d675a6b39f41232a5b?s=128&d=identicon&r=PG&f=1", "display_name": "user12341234", "link": "https://stackoverflow.com/users/3277393/user12341234"}, "edited": false, "score": 2, "creation_date": 1499523977, "post_id": 44987155, "comment_id": 76948594, "body": "@user12341234 yes, it does. You have to me able to mutate the iterator in order to call <code>next</code>, which updates the internal state of the iterator so it can return something different with each call."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 6, "last_activity_date": 1499540856, "last_edit_date": 1499540856, "creation_date": 1499523058, "answer_id": 44987155, "question_id": 44987079, "link": "https://stackoverflow.com/questions/44987079/why-does-iter-borrow-mutably-when-used-in-a-pattern-guard/44987155#44987155", "title": "Why does iter borrow mutably when used in a pattern guard?", "body": "<p>The error message is a bit more nuanced \u2014 <code>iter</code> doesn't borrow mutably, but the <em>result of <code>iter</code> is being borrowed mutably</em>. This is because <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.any\" rel=\"nofollow noreferrer\"><code>Iterator::any</code></a> takes <code>self</code> by mutable reference:</p>\n\n<pre><code>fn any&lt;F&gt;(&amp;mut self, f: F) -&gt; bool \nwhere\n    F: FnMut(Self::Item) -&gt; bool, \n</code></pre>\n\n<p>Here's a reproduction:</p>\n\n<pre><code>struct X;\n\nimpl X {\n    fn new() -&gt; X { X } \n    fn predicate(&amp;mut self) -&gt; bool { true }\n}\n\nfn main() {\n    match () {\n        _ if X::new().predicate() =&gt; {}\n        _ =&gt; {}\n    }\n}\n</code></pre>\n\n<p>I'd just check if the slice <a href=\"https://doc.rust-lang.org/std/primitive.slice.html#method.contains\" rel=\"nofollow noreferrer\"><code>contains</code></a> the value:</p>\n\n<pre><code>fn t(r: &amp;[u8]) {\n    match r {\n        _ if r.contains(&amp;b';') =&gt; {}\n        _ =&gt; {}\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>Realistically, this is an example of the borrow checker being overly aggressive. Mutably borrowing something from \"outside\" the match guard is a bad idea, but mutably borrowing something created in the match guard should be safe.</p>\n\n<p>It's likely that this particular case would work when the borrow checker is rewritten to use Rust's MIR layer.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://github.com/rust-lang/rust/issues/24535\" rel=\"nofollow noreferrer\">Rust issue #24535</a></li>\n</ul>\n"}], "owner": {"reputation": 5913, "user_id": 1244932, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d2c608e688b798896e8b516855fc1ab1?s=128&d=identicon&r=PG", "display_name": "user1244932", "link": "https://stackoverflow.com/users/1244932/user1244932"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 1, "accepted_answer_id": 44987155, "answer_count": 1, "score": 5, "last_activity_date": 1499540856, "creation_date": 1499522455, "last_edit_date": 1499523995, "question_id": 44987079, "link": "https://stackoverflow.com/questions/44987079/why-does-iter-borrow-mutably-when-used-in-a-pattern-guard", "title": "Why does iter borrow mutably when used in a pattern guard?", "body": "<p>This code:</p>\n\n<pre><code>fn t(r: &amp;[u8]) {\n    match r {\n        _ if r.iter().any(|&amp;x| x == b';') =&gt; {}\n        _ =&gt; {}\n    }\n}\n</code></pre>\n\n<p>gives me the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0301]: cannot mutably borrow in a pattern guard\n   |\n10 |         _ if r.iter().any(|&amp;x| x == b';') =&gt; {}\n   |              ^^^^^^^^ borrowed mutably in pattern guard\n</code></pre>\n\n<p>I understand that I can not borrow mutably in match patterns, but why does the compiler think that <code>r.iter()</code> borrows mutably? There is a separate method <code>iter_mut</code> for borrowing mutably.</p>\n\n<p>And how can I check that <code>&amp;[u8]</code> contains <code>b';'</code> without introducing separate functions?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499527415, "post_id": 44985651, "comment_id": 76950345, "body": "<a href=\"https://stackoverflow.com/q/39946430/155423\">Borrow checker doesn&#39;t realize that <code>clear</code> drops reference to local variable</a>"}], "answers": [{"tags": [], "owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "is_accepted": true, "score": 2, "last_activity_date": 1499521861, "creation_date": 1499521861, "answer_id": 44986973, "question_id": 44985651, "link": "https://stackoverflow.com/questions/44985651/what-is-the-preferred-way-of-working-with-run-time-created-instances/44986973#44986973", "title": "What is the preferred way of working with run-time created instances?", "body": "<blockquote>\n  <p>Also, I was expecting <code>clear()</code> to release the borrows, but even if it actually does so, perhaps the compiler cannot figure that out?</p>\n</blockquote>\n\n<p>At the moment, borrowing is purely scope based. Only a method which <em>consumes</em> the borrower can revoke the borrow, which is not always ideal.</p>\n\n<blockquote>\n  <p>What is the preferred way of working with <strong>shared</strong> run-time created instances?</p>\n</blockquote>\n\n<p>The simplest way to expressed shared ownership is to use shared ownership. It does come with some syntactic overhead, however it would greatly simplify reasoning.</p>\n\n<p>In Rust, there are two simple standard ways of expressing shared ownership:</p>\n\n<ul>\n<li><code>Rc&lt;RefCell&lt;T&gt;&gt;</code>, for sharing within a thread,</li>\n<li><code>Arc&lt;Mutex&lt;T&gt;&gt;</code>, for sharing across threads.</li>\n</ul>\n\n<p>There are some variations (using <code>Cell</code> instead of <code>RefCell</code> or <code>RWLock</code> instead of <code>Mutex</code>), however those are the basics.</p>\n\n<p>Beyond syntactic overhead, there's also some amount of run-time overhead going into (a) increasing/decreasing the reference count whenever you make a clone and (b) checking/marking/clearing the usage flag when accessing the wrapped instance of <code>T</code>.</p>\n\n<p>There is one non-negligible downside to this approach, though. The borrowing rules are now checked at runtime instead of compile time, and therefore violations lead to <code>panic</code> instead of compile time errors.</p>\n"}], "owner": {"reputation": 695, "user_id": 1407530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/34d7caadb1601d6fec8f7065300a56ff?s=128&d=identicon&r=PG", "display_name": "Lars R&#246;nnb&#228;ck", "link": "https://stackoverflow.com/users/1407530/lars-r%c3%b6nnb%c3%a4ck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 44986973, "answer_count": 1, "score": 0, "last_activity_date": 1499525590, "creation_date": 1499512907, "last_edit_date": 1499525590, "question_id": 44985651, "link": "https://stackoverflow.com/questions/44985651/what-is-the-preferred-way-of-working-with-run-time-created-instances", "title": "What is the preferred way of working with run-time created instances?", "body": "<p>I am writing a service that will collect a great number of values and build large structures around them. For some of these, lookup tables are needed, and due to memory constraints I do not want to copy the key or value passed to the <code>HashMap</code>. However, using references gets me into trouble with the borrow checker (see example below). What is the preferred way of working with run-time created instances?</p>\n\n<pre><code>use std::collections::HashMap;\n\n#[derive(PartialEq, Eq, PartialOrd, Ord, Hash)]\nstruct LargeKey;\nstruct LargeValue;\n\nfn main() {\n    let mut lots_of_lookups: HashMap&lt;&amp;LargeKey, &amp;LargeValue&gt; = HashMap::new();\n    let run_time_created_key = LargeKey;\n    let run_time_created_value = LargeValue;\n    lots_of_lookups.insert(&amp;run_time_created_key, &amp;run_time_created_value);\n    lots_of_lookups.clear();\n}\n</code></pre>\n\n<p>I was expecting <code>clear()</code> to release the borrows, but even if it actually does so, perhaps the compiler cannot figure that out?</p>\n"}, {"tags": ["rust", "lifetime", "borrow-checker"], "answers": [{"comments": [{"owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "edited": false, "score": 0, "creation_date": 1499552847, "post_id": 44990851, "comment_id": 76957544, "body": "Awesome! I had tried doing this before, but since I didn&#39;t understand the difference between <code>Copy</code> and <code>Clone</code>. This meant I tried to do <code>#[derive(Copy, Clone)]</code> on Unit, which didn&#39;t work. I assumed it couldn&#39;t be done and moved on. Thanks for the help, I never would have figured this out on my own!"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 1, "last_activity_date": 1499548837, "creation_date": 1499548837, "answer_id": 44990851, "question_id": 44980895, "link": "https://stackoverflow.com/questions/44980895/unable-to-borrow-a-vec-inside-of-a-closure/44990851#44990851", "title": "Unable to borrow a Vec inside of a closure", "body": "<p>Here's a smaller example of your problem:</p>\n\n<pre><code>fn main() {\n    let mut line = vec![1];\n    let something_to_iterate_over = vec![true, false, true];\n\n    for _ in 0..2 {\n        let _dummy: Vec&lt;_&gt; = something_to_iterate_over\n            .iter()\n            .map(|&amp;value| {\n                let maybe_moved_line = if value { vec![] } else { line };\n                () // Don't care about the return value\n            })\n            .collect();\n\n        line.push(2);\n    }\n}\n</code></pre>\n\n<p>The first part of the error message is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0382]: capture of moved value: `line`\n --&gt; src/main.rs:9:67\n  |\n8 |             .map(|&amp;value| {\n  |                  -------- value moved (into closure) here\n9 |                 let maybe_moved_line = if value { vec![] } else { line };\n  |                                                                   ^^^^ value captured here after move\n  |\n  = note: move occurs because `line` has type `std::vec::Vec&lt;i32&gt;`, which does not implement the `Copy` trait\n\nerror[E0382]: use of moved value: `line`\n  --&gt; src/main.rs:14:9\n   |\n8  |             .map(|&amp;value| {\n   |                  -------- value moved (into closure) here\n...\n14 |         line.push(2);\n   |         ^^^^ value used here after move\n   |\n   = note: move occurs because `line` has type `std::vec::Vec&lt;i32&gt;`, which does not implement the `Copy` trait\n</code></pre>\n\n<p>As the error message is attempting to convey, the code no longer has ownership of the variable <code>line</code> after the <code>map</code> call because the ownership has been transferred to the closure.</p>\n\n<p>The code is attempting to give a single <code>Vec</code> to someone else while keeping it for itself, and that's simply not how ownership works. I can't give you my car and then continue to drive it everyday \u2014 it's not mine to drive!</p>\n\n<p>The smallest amount of change to get your code to compile is to stop trying to give away the one and only <code>line</code>, but instead to clone it as needed:</p>\n\n<ol>\n<li>Add <code>#[derive(Clone)]</code> to <code>Unit</code></li>\n<li>Clone <code>line</code> and <code>world[y]</code> inside the closure: <code>line.clone()</code>, <code>world[y].clone()</code></li>\n</ol>\n\n<p>After doing this, the code never gives up ownership of <code>line</code> so it can be cloned whenever needed.</p>\n"}], "owner": {"reputation": 1220, "user_id": 2124732, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cf9d2998c0d9cb26334028f72185fe38?s=128&d=identicon&r=PG", "display_name": "Christopher Dumas", "link": "https://stackoverflow.com/users/2124732/christopher-dumas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 566, "favorite_count": 0, "accepted_answer_id": 44990851, "answer_count": 1, "score": 1, "last_activity_date": 1499548991, "creation_date": 1499469177, "last_edit_date": 1499548991, "question_id": 44980895, "link": "https://stackoverflow.com/questions/44980895/unable-to-borrow-a-vec-inside-of-a-closure", "title": "Unable to borrow a Vec inside of a closure", "body": "<p>I have a vector of <code>Unit</code>s. I'm trying to construct a <code>Vec&lt;Vec&lt;Unit&gt;&gt;</code> variable, called <code>world</code>. In the process of creating tiles, I need to know what tiles are adjacent that it knows of. </p>\n\n<p>I have a function that returns a vector of points (<code>(usize, usize)</code>) that are adjacent to another point, and I'm converting that to an iterator, mapping over it, and getting the actual unit associated with that position in <code>world</code> if it's there, or the current line which has not yet been committed to <code>world</code>. </p>\n\n<p>I need to access that line inside the closure that <code>map</code> takes, but I also need to access it later.</p>\n\n<pre><code>fn adjacent((x, y): (usize, usize)) -&gt; Vec&lt;(usize, usize)&gt; {\n    vec![\n        (x+1, y),\n        (x-1, y),\n        (x, y+1),\n        (x, y-1),\n    ]\n}\n\nstruct Unit {\n    pub tiles: Vec&lt;Tile&gt;,\n}\n\n#[derive(Copy, Clone)]\nenum Tile {\n    Floor, Wall, Empty\n}\n\nfn main() {\n    let heightmap = vec![\n        vec![3, 3, 3, 3, 3, 3],\n        vec![3, 1, 1, 1, 1, 3],\n        vec![3, 1, 1, 1, 1, 3],\n        vec![3, 1, 1, 1, 1, 3],\n        vec![3, 1, 1, 1, 1, 3],\n        vec![3, 1, 1, 1, 1, 3],\n        vec![3, 3, 3, 3, 3, 3],\n    ];\n    let (sx, sy) = (5, 5);\n    let mut world: Vec&lt;Vec&lt;Unit&gt;&gt; = vec![];\n    for y in 0..sy {\n        let mut line: Vec&lt;Unit&gt; = vec![];\n        for x in 0..sx {\n            let mut tiles: Vec&lt;Tile&gt; = vec![];\n            let height = heightmap[y][x];\n            let adj = adjacent((x, y))\n                .iter()\n                .map(|&amp;(x, y)| {\n                    let list = if y &gt; world.len() {\n                        vec![]\n                    } else if y == world.len() {\n                        line\n                    } else {\n                        world[y]\n                    };\n\n                    if x &gt;= list.len() {\n                        Tile::Empty\n                    } else {\n                        if height as usize &gt;= list[x].tiles.len() {\n                            Tile::Empty\n                        } else {\n                            list[x].tiles[height as usize]\n                        }\n                    }\n                })\n                .collect::&lt;Vec&lt;_&gt;&gt;();\n\n            for z in 0..(height as isize - 1) {\n                tiles.push(Tile::Wall);\n            }\n            line.push(Unit {\n                tiles: tiles,\n            });\n        }\n        world.push(line);\n    }\n}\n</code></pre>\n\n<p>Here is the <a href=\"https://play.rust-lang.org/?gist=d21caf26558e5f9f57a7344f1e77e6ce&amp;version=stable&amp;backtrace=0\" rel=\"nofollow noreferrer\">Rust Playground</a>.</p>\n\n<p>I would have rather used <code>unwrap_or</code> in combination with <code>get</code> and so on but that leads to other errors with temporary values, and that would be more complicated anyway, so the above code, while probably not optimal, is as simple as I can get it while still duplicating the error. I've found out that a lot of the errors I get with Rust is because what I'm doing isn't the best way to go about it, so if there is a more idiomatic way, I would certainly like to know.</p>\n\n<p>I've tried to make <code>Unit</code> cloneable (deriving <code>Clone</code> and <code>Copy</code>) but Rust won't let me for some reason, even though all it is made up of is vectors which are cloneable if their members are.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499440677, "post_id": 44974215, "comment_id": 76923768, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/26643688/how-to-split-a-string-in-rust\">How to split a string in Rust?</a>"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499440696, "post_id": 44974215, "comment_id": 76923784, "body": "What is the problem ? <a href=\"https://play.rust-lang.org/?gist=ee9fee6ce0c6a68472f918732fb14e8e&amp;version=stable&amp;backtrace=0\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499440948, "post_id": 44974215, "comment_id": 76923972, "body": "No... <a href=\"https://play.rust-lang.org/?gist=e1d53c52c2615979c59c1910c0cadd29&amp;version=nightly&amp;backtrace=0\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 8608, "user_id": 1091116, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/15098b2b940cacd8b4d07026e01e3102?s=128&d=identicon&r=PG", "display_name": "d33tah", "link": "https://stackoverflow.com/users/1091116/d33tah"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499441038, "post_id": 44974215, "comment_id": 76924023, "body": "Yup, passing a reference to String instead of the String itself does solve the error message - you could post that as a separate answer. In order to reproduce the error, remove <code>&amp;</code> from your code."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1499441133, "post_id": 44974215, "comment_id": 76924087, "body": "I don&#39;t think this is an exact duplicate, but in other side, a glance at the documentation would have solve the issue."}, {"owner": {"reputation": 8608, "user_id": 1091116, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/15098b2b940cacd8b4d07026e01e3102?s=128&d=identicon&r=PG", "display_name": "d33tah", "link": "https://stackoverflow.com/users/1091116/d33tah"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1499441183, "post_id": 44974215, "comment_id": 76924111, "body": "@Boiethios: only if you know that in this particular case String won&#39;t get derefed."}], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1499440852, "post_id": 44974358, "comment_id": 76923910, "body": "please don&#39;t answer to duplicate."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499440924, "post_id": 44974358, "comment_id": 76923956, "body": "@Stargateur Sorry, I answered before."}, {"owner": {"reputation": 8608, "user_id": 1091116, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/15098b2b940cacd8b4d07026e01e3102?s=128&d=identicon&r=PG", "display_name": "d33tah", "link": "https://stackoverflow.com/users/1091116/d33tah"}, "edited": false, "score": 1, "creation_date": 1499440925, "post_id": 44974358, "comment_id": 76923959, "body": "It&#39;s not a duplicate - the assumption here is that I don&#39;t have an &amp;str, but a String. I explained this in an edit."}], "tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": false, "score": 6, "last_activity_date": 1499441417, "last_edit_date": 1499441417, "creation_date": 1499440709, "answer_id": 44974358, "question_id": 44974215, "link": "https://stackoverflow.com/questions/44974215/the-trait-fnmutchar-is-not-implemented-for-string-when-trying-to-split/44974358#44974358", "title": "The trait `FnMut&lt;(char,)&gt;` is not implemented for `String` when trying to split a string", "body": "<p>All is in the <a href=\"https://doc.rust-lang.org/std/primitive.str.html#method.split\" rel=\"nofollow noreferrer\">documentation</a>. You can provide one of:</p>\n\n<ul>\n<li>A <code>&amp;str</code>,</li>\n<li>A <code>char</code>,</li>\n<li>A closure,</li>\n</ul>\n\n<p>Those three types implement the <a href=\"https://doc.rust-lang.org/std/str/pattern/trait.Pattern.html\" rel=\"nofollow noreferrer\"><code>Pattern</code></a> trait. You are giving  a <code>String</code> to <code>split</code> instead of a <code>&amp;str</code>.</p>\n\n<p>Example:</p>\n\n<pre><code>fn main() {\n    let x = \"\".to_string();\n    let split = x.split(\"\");\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1499441768, "post_id": 44974566, "comment_id": 76924486, "body": "I clearly agree that the error is misleading. Should definitively be improved."}], "tags": [], "owner": {"reputation": 8608, "user_id": 1091116, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/15098b2b940cacd8b4d07026e01e3102?s=128&d=identicon&r=PG", "display_name": "d33tah", "link": "https://stackoverflow.com/users/1091116/d33tah"}, "is_accepted": false, "score": 4, "last_activity_date": 1499441551, "last_edit_date": 1499441551, "creation_date": 1499441338, "answer_id": 44974566, "question_id": 44974215, "link": "https://stackoverflow.com/questions/44974215/the-trait-fnmutchar-is-not-implemented-for-string-when-trying-to-split/44974566#44974566", "title": "The trait `FnMut&lt;(char,)&gt;` is not implemented for `String` when trying to split a string", "body": "<p>I talked about this with #rust-beginners IRC channel and heard the following:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>15:12:15           achird | d33tah: split accepts a Pattern, where Pattern can be &amp;str or char, but you're passing a String (no idea why deref is not working)\n15:13:01           d33tah | achird: thanks! how can I convert string to str?\n15:13:03           achird | i think a simple split(&amp;delimiter2) should fix the problem\n15:16:26           calops | why isn't deref working though?\n15:21:33        @mbrubeck | calops, d33tah: Deref coercions only work if one exact \"expected\" type is known.  For a generic type like &lt;P: Pattern&gt;, coercion doesn't kick in.\n15:24:11        @mbrubeck | d33tah: The error should definitely be improved...  It should complain that `String` doesn't impl `Pattern`, instead of jumping straight to `FnMut(char)`\n</code></pre>\n\n<p>So basically, the solution is to add &amp; before the delimiter string, like this:</p>\n\n<pre><code>fn main() {\n    let s1 = \"\".to_string();\n    let s2 = \"\".to_string();\n    let x = s1.split(&amp;s2);\n}\n</code></pre>\n"}], "owner": {"reputation": 8608, "user_id": 1091116, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/15098b2b940cacd8b4d07026e01e3102?s=128&d=identicon&r=PG", "display_name": "d33tah", "link": "https://stackoverflow.com/users/1091116/d33tah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1257, "favorite_count": 1, "answer_count": 2, "score": 6, "last_activity_date": 1499441551, "creation_date": 1499440339, "last_edit_date": 1499441248, "question_id": 44974215, "link": "https://stackoverflow.com/questions/44974215/the-trait-fnmutchar-is-not-implemented-for-string-when-trying-to-split", "title": "The trait `FnMut&lt;(char,)&gt;` is not implemented for `String` when trying to split a string", "body": "<p>I need to split a <code>String</code> (not <code>&amp;str</code>) by another <code>String</code>:</p>\n\n<pre><code>use std::str::Split;\n\nfn main() {\n    let x = \"\".to_string().split(\"\".to_string());\n}\n</code></pre>\n\n<p>Why do I get this error and how to avoid it if I already have to operate on strings?</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `std::string::String: std::ops::FnMut&lt;(char,)&gt;` is not satisfied\n --&gt; src/main.rs:4:32\n  |\n4 |         let x = \"\".to_string().split(\"\".to_string());\n  |                                ^^^^^ the trait `std::ops::FnMut&lt;(char,)&gt;` is not implemented for `std::string::String`\n  |\n  = note: required because of the requirements on the impl of `std::str::pattern::Pattern&lt;'_&gt;` for `std::string::String`\n</code></pre>\n\n<p>According to the #rust-beginners IRC channel, this might be an example of <code>Deref</code> failing in 1.20.0-nightly. <a href=\"https://stackoverflow.com/questions/26643688/how-to-split-a-string-in-rust\">How to split a string in Rust?</a> doesn't address the problem of splitting by <code>String</code>, not <code>&amp;str</code>.</p>\n"}, {"tags": ["asynchronous", "error-handling", "websocket", "rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499440323, "post_id": 44974034, "comment_id": 76923517, "body": "But what is your question ?"}, {"owner": {"reputation": 163, "user_id": 2233364, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e7f01ac6cc619b0e20639a85fc41029?s=128&d=identicon&r=PG", "display_name": "Hahihula", "link": "https://stackoverflow.com/users/2233364/hahihula"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499440625, "post_id": 44974034, "comment_id": 76923732, "body": "How to handle the Io Error so my program does not die and drops all other connections..."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1499441698, "post_id": 44974034, "comment_id": 76924437, "body": "@Hahihula Please edit your question to clearly ask it. A question without highlighted and clear interrogation is not good in Stackoverflow."}], "answers": [{"tags": [], "owner": {"reputation": 163, "user_id": 2233364, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e7f01ac6cc619b0e20639a85fc41029?s=128&d=identicon&r=PG", "display_name": "Hahihula", "link": "https://stackoverflow.com/users/2233364/hahihula"}, "is_accepted": false, "score": 0, "last_activity_date": 1499855247, "creation_date": 1499855247, "answer_id": 45055116, "question_id": 44974034, "link": "https://stackoverflow.com/questions/44974034/how-do-i-handle-an-error-when-using-rust-websocket-so-that-only-that-connection/45055116#45055116", "title": "How do I handle an error when using rust-websocket so that only that connection fails and not the entire program?", "body": "<p>Ok, with some help from rust IRC channel i found the solution. I've just replaced the error with None and filtered it out.</p>\n\n<pre><code>.map(Some).or_else(|_| -&gt; Result&lt;_, ()&gt; { Ok(None) }).filter_map(|x| x) \n</code></pre>\n\n<p>Maybe this info will help someone with similar problem.</p>\n"}], "owner": {"reputation": 163, "user_id": 2233364, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e7f01ac6cc619b0e20639a85fc41029?s=128&d=identicon&r=PG", "display_name": "Hahihula", "link": "https://stackoverflow.com/users/2233364/hahihula"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 191, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1499855247, "creation_date": 1499439793, "last_edit_date": 1499443049, "question_id": 44974034, "link": "https://stackoverflow.com/questions/44974034/how-do-i-handle-an-error-when-using-rust-websocket-so-that-only-that-connection", "title": "How do I handle an error when using rust-websocket so that only that connection fails and not the entire program?", "body": "<p>I am trying to get a Rust WebSocket server up and running. I started with the <a href=\"https://github.com/cyderize/rust-websocket/blob/7bd2defaf98c3dec8a9b5e7dc93cbbc887e97d5a/examples/async-server.rs\" rel=\"nofollow noreferrer\">example code for an async websocker server</a>.</p>\n\n<p>Every time I get an <code>Io</code> error, like when the connection is interrupted, the entire program ends without any error. I modified the code on line 26 of the example to:</p>\n\n<pre><code>.map_err(|InvalidConnection {error, ..}| {\n    println!(\"Error:{:?}\",error);\n    return error;\n})\n</code></pre>\n\n<p>This prints the error, but does not prevent the program from stopping only the single connection and not crashing itself.</p>\n\n<p>The most common error I get is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Io(Error { repr: Custom(Custom { kind: Other, error: Stream(Error { repr: Custom(Custom { kind: ConnectionAborted, error: StringError(\"unexpected EOF observed\") }) }) }) })\n</code></pre>\n"}, {"tags": ["testing", "rust"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 5, "last_activity_date": 1499434406, "creation_date": 1499434406, "answer_id": 44972130, "question_id": 44971963, "link": "https://stackoverflow.com/questions/44971963/how-to-limit-floats-generated-by-quickcheck-to-a-range/44972130#44972130", "title": "How to limit floats generated by Quickcheck to a range?", "body": "<p>Create a new type that represents your desired range, then implement <a href=\"https://docs.rs/quickcheck/0.4.2/quickcheck/trait.Arbitrary.html\" rel=\"noreferrer\"><code>quickcheck::Arbitrary</code></a> for it:</p>\n\n<pre><code>#[macro_use]\nextern crate quickcheck;\n\n#[derive(Debug, Copy, Clone)]\nstruct Probability(f64);\n\nimpl quickcheck::Arbitrary for Probability {\n    fn arbitrary&lt;G: quickcheck::Gen&gt;(g: &amp;mut G) -&gt; Self {\n        Probability(g.gen_range(0.0, 1.0))\n    }\n}\n\nquickcheck! {\n    fn prop(x: Probability, y: Probability) -&gt; bool {\n        let x = x.0;\n        let y = y.0;\n\n        assert!(x &lt;= 1.0);\n        assert!(y &lt;= 1.0);\n\n        (x * y &lt; x) &amp;&amp; (x * y &lt; y)\n    }\n}\n</code></pre>\n\n<p><code>Arbitrary</code> is passed a type that implements <a href=\"https://docs.rs/quickcheck/0.4.2/quickcheck/trait.Gen.html\" rel=\"noreferrer\"><code>quickcheck::Gen</code></a>, which is a light wrapper on top of <a href=\"https://docs.rs/rand/0.3.15/rand/trait.Rng.html\" rel=\"noreferrer\"><code>rand::Rng</code></a>. </p>\n\n<p>Note that <code>Rng::gen_range</code> has an <strong>exclusive upper bound</strong>, so this example isn't exactly what you want, but it shows the process.</p>\n"}], "owner": {"reputation": 2072, "user_id": 295615, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/c45d42c18f8ad23051712d837788f8c2?s=128&d=identicon&r=PG", "display_name": "Alexander Battisti", "link": "https://stackoverflow.com/users/295615/alexander-battisti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 44972130, "answer_count": 1, "score": 1, "last_activity_date": 1499434406, "creation_date": 1499433911, "last_edit_date": 1499434360, "question_id": 44971963, "link": "https://stackoverflow.com/questions/44971963/how-to-limit-floats-generated-by-quickcheck-to-a-range", "title": "How to limit floats generated by Quickcheck to a range?", "body": "<p>I would like to generate random floats for <a href=\"https://github.com/BurntSushi/quickcheck\" rel=\"nofollow noreferrer\">Quickcheck</a> that are limited to a certain range such as 0.0 to 1.0 for testing functions working on probabilities. I would like to be able to do something where this would be successful:</p>\n\n<pre><code>quickcheck! {        \n    fn prop(x: f64, y: f64) -&gt; bool {\n        assert!(x &lt;= 1.0);\n        assert!(y &lt;= 1.0);\n\n        (x * y &lt; x) &amp;&amp; (x * y &lt; y)\n    }\n}\n</code></pre>\n"}, {"tags": ["node.js", "rust", "llvm"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499434911, "post_id": 44969319, "comment_id": 76919334, "body": "I&#39;m not sure what the missing piece is here. Can you further elaborate why simply doing <code>export LLVM_SYS_40_PREFIX=&#47;path&#47;to&#47;llvm&#47;...</code> before your build is not an appropriate solution?"}, {"owner": {"reputation": 117, "user_id": 6482586, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-ko_HakixCcU/AAAAAAAAAAI/AAAAAAAAAFU/MCt5ZXTsLrk/photo.jpg?sz=128", "display_name": "Abhinav Sharma", "link": "https://stackoverflow.com/users/6482586/abhinav-sharma"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499440311, "post_id": 44969319, "comment_id": 76923509, "body": "Well, I can do something similar to what you suggested but then how do I automate this Path-Export  everytime I run the <code>npm install</code> script. It shells out a <code>neon build</code> command and that&#39;s it. Though, it&#39;s quite possible I&#39;m unable to frame the right question here. New to system&#39;s programming and ffi stuff."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499441578, "post_id": 44969319, "comment_id": 76924366, "body": "There&#39;s nothing special about &quot;system programming&quot; here. You have a piece of code that requires to be told where LLVM is via an environment variable. How do you suggest that that be automated? Said another way, how can you, for <b>any</b> arbitrary computer that your code might be installed on, detect where LLVM is installed? What if LLVM <i>isn&#39;t</i> installed?"}, {"owner": {"reputation": 117, "user_id": 6482586, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-ko_HakixCcU/AAAAAAAAAAI/AAAAAAAAAFU/MCt5ZXTsLrk/photo.jpg?sz=128", "display_name": "Abhinav Sharma", "link": "https://stackoverflow.com/users/6482586/abhinav-sharma"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499445320, "post_id": 44969319, "comment_id": 76926651, "body": "It&#39;s installed, I&#39;ve merely copied it from the <code>brew Cellar</code> to the current location ( I&#39;d like to freeze things for further experiment). What you&#39;re saying is, perhaps I should just export the path variables every time and then run the <code>npm install</code> command?"}], "owner": {"reputation": 117, "user_id": 6482586, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-ko_HakixCcU/AAAAAAAAAAI/AAAAAAAAAFU/MCt5ZXTsLrk/photo.jpg?sz=128", "display_name": "Abhinav Sharma", "link": "https://stackoverflow.com/users/6482586/abhinav-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 389, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1499447317, "creation_date": 1499425828, "last_edit_date": 1499447317, "question_id": 44969319, "link": "https://stackoverflow.com/questions/44969319/how-to-set-llvm-path-variables-for-a-rust-project", "title": "How to set LLVM path variables for a Rust project?", "body": "<p>I saw <a href=\"https://www.youtube.com/watch?v=jINMIAicaS0&amp;feature=youtu.be\" rel=\"nofollow noreferrer\">this talk on YouTube</a> about native NodeJS modules in Rust and I was inspired to try it out. The process until the Neon-based \"Hello, World!\" is really smooth - no issues there.</p>\n\n<p>I want to try out the llvm-sys crate to have access to LLVM codegen but the build fails.</p>\n\n<p>I notice that the reason is path variables, but I'd like to source them from the local pre-compiled LLVM files copied over from the homebrew Cellar.</p>\n\n<p>Here's my directory structure </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>lumos_vm git/master*\n\u276f tree -L 1\n\n.\n\u251c\u2500\u2500 ProgressLog.md\n\u251c\u2500\u2500 ReadMe.md\n\u251c\u2500\u2500 llvm_4.0.0\n\u2514\u2500\u2500 lumos_1\n\n2 directories, 2 files\n</code></pre>\n\n<p>And here's the stacktrace after running <code>npm install</code></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>lumos_vm/lumos_1 git/master*\n\u276f npm install\n\n&gt; lumos_1@0.1.0 install /Users/eklavya/Projects/bitworld/ClojureScript/lumos_vm/lumos_1\n&gt; neon build\n\nneon info running cargo\n   Compiling lazy_static v0.2.8\n   Compiling utf8-ranges v1.0.0\n   Compiling libc v0.2.24\n   Compiling semver-parser v0.7.0\n   Compiling regex-syntax v0.4.1\n   Compiling void v1.0.2\n   Compiling unreachable v1.0.0\n   Compiling thread_local v0.3.4\n   Compiling memchr v1.0.1\n   Compiling semver v0.6.0\n   Compiling aho-corasick v0.6.3\n   Compiling regex v0.2.2\n   Compiling llvm-sys v40.0.2\nerror: failed to run custom build command for `llvm-sys v40.0.2`\nprocess didn't exit successfully: `/Users/eklavya/Projects/bitworld/ClojureScript/lumos_vm/lumos_1/native/target/release/build/llvm-sys-632d8c2c2d97ae93/build-script-build` (exit code: 101)\n--- stdout\nDidn't find usable system-wide LLVM.\nLLVM_SYS_40_PREFIX not set, not using precompiled binaries\nLLVM_SYS_40_AUTOBUILD not set, will not automatically compile LLVM\n\n--- stderr\nthread 'main' panicked at 'Could not find a compatible version of LLVM', /Users/eklavya/.cargo/registry/src/github.com-1ecc6299db9ec823/llvm-sys-40.0.2/build.rs:14\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\n\nneon ERR! cargo build failed\n\nError: cargo build failed\n    at Target.&lt;anonymous&gt; (/Users/eklavya/Projects/bitworld/ClojureScript/lumos_vm/lumos_1/node_modules/neon-cli/dist/neon-cli/target.js:124:35)\n    at step (/Users/eklavya/Projects/bitworld/ClojureScript/lumos_vm/lumos_1/node_modules/neon-cli/dist/neon-cli/target.js:32:23)\n    at Object.next (/Users/eklavya/Projects/bitworld/ClojureScript/lumos_vm/lumos_1/node_modules/neon-cli/dist/neon-cli/target.js:13:53)\n    at fulfilled (/Users/eklavya/Projects/bitworld/ClojureScript/lumos_vm/lumos_1/node_modules/neon-cli/dist/neon-cli/target.js:4:58)\n    at &lt;anonymous&gt;\n    at process._tickCallback (internal/process/next_tick.js:169:7)\nnpm WARN lumos_1@0.1.0 No repository field.\n\nup to date in 26.123s\n\nlumos_vm/lumos_1 git/master*  27s\n\u276f\n</code></pre>\n"}, {"tags": ["rust", "rust-tokio"], "comments": [{"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1499380349, "post_id": 44959853, "comment_id": 76895164, "body": "It is a closure function. Is the confusion just that it&#39;s not obvious it is a function with no arguments, or are you unfamiliar with those?"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1499380350, "post_id": 44959853, "comment_id": 76895165, "body": "That is actually a closure statement with an empty parameter list."}], "owner": {"reputation": 1015, "user_id": 1773216, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/cvbyd.jpg?s=128&g=1", "display_name": "nmurthy", "link": "https://stackoverflow.com/users/1773216/nmurthy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "closed_date": 1499383684, "answer_count": 0, "score": 0, "last_activity_date": 1499383730, "creation_date": 1499380150, "last_edit_date": 1499383715, "question_id": 44959853, "link": "https://stackoverflow.com/questions/44959853/what-is-the-operator-used-for-when-creating-a-new-tokio-tcpserver", "closed_reason": "Duplicate", "title": "What is the `||` operator used for when creating a new Tokio TcpServer?", "body": "<p>I've been experimenting with the <a href=\"https://tokio.rs/\" rel=\"nofollow noreferrer\">Tokio libraries</a> for playing with TCP servers and clients. A server is almost always constructed like so:</p>\n\n<pre><code>TcpServer::new(Http, addr)\n    .serve(|| Ok(HelloWorld));\n</code></pre>\n\n<p>I'm curious to know what the <code>||</code> operator does and how it's used in this expression?</p>\n\n<p>Here are some <a href=\"https://github.com/natemurthy/misc/blob/master/rust/tokio-minihttp/examples\" rel=\"nofollow noreferrer\">complete server examples based on Tokio MiniHTTP</a>.</p>\n"}, {"tags": ["rust", "byte", "stdin"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1499377220, "post_id": 44959216, "comment_id": 76894011, "body": "Isn&#39;t waiting for keyboard input and echoing the character something that already happens in <code>getche</code>? Are you sure that you want an equivalent to this function?"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1499377435, "post_id": 44959216, "comment_id": 76894085, "body": "You also seem to have some misconceptions: 12 is the character code for new page, not new line (10). And you are likely in a windows system, which produces the CR+LF combination on enter. In another side note, you can call <code>unwrap</code> on a <code>Result</code>, you don&#39;t have to call <code>ok</code> beforehand."}, {"owner": {"reputation": 2836, "user_id": 3529197, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ceed214a6e603c456a8ebaacc036b407?s=128&d=identicon&r=PG&f=1", "display_name": "Neo", "link": "https://stackoverflow.com/users/3529197/neo"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1499377497, "post_id": 44959216, "comment_id": 76894105, "body": "@E_net4 Oops I meant <code>getch()</code>. I do want to wait for keyboard input but I don&#39;t want to print it."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499377516, "post_id": 44959216, "comment_id": 76894115, "body": "<code>getch()</code> is not standard in C, but it&#39;s come from ncurses lib. You want a crate that handle terminal I/O. <a href=\"https://github.com/jeaye/ncurses-rs\" rel=\"nofollow noreferrer\">github.com/jeaye/ncurses-rs</a>, <a href=\"https://github.com/ihalila/pancurses\" rel=\"nofollow noreferrer\">github.com/ihalila/pancurses</a>, <a href=\"https://github.com/gyscos/Cursive\" rel=\"nofollow noreferrer\">github.com/gyscos/Cursive</a>, etc..."}, {"owner": {"reputation": 2836, "user_id": 3529197, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ceed214a6e603c456a8ebaacc036b407?s=128&d=identicon&r=PG&f=1", "display_name": "Neo", "link": "https://stackoverflow.com/users/3529197/neo"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499378024, "post_id": 44959216, "comment_id": 76894321, "body": "@Stargateur I see how I can use ncurses but isn&#39;t there a simpler solution?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499378142, "post_id": 44959216, "comment_id": 76894372, "body": "@Neo When I look, what you ask: &quot;it waits for an enter which I don&#39;t want&quot;, <a href=\"https://stackoverflow.com/a/30013230/7076153\">stackoverflow.com/a/30013230/7076153</a>, &quot;It also prints the inputted char, which is also unwanted&quot;, clearly std will not handle that, this is about terminal configuration. By the way, ASCII code 13 is just a <code>&#39;\\r&#39;</code>, read about line break in windows."}, {"owner": {"reputation": 2836, "user_id": 3529197, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ceed214a6e603c456a8ebaacc036b407?s=128&d=identicon&r=PG&f=1", "display_name": "Neo", "link": "https://stackoverflow.com/users/3529197/neo"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499378581, "post_id": 44959216, "comment_id": 76894549, "body": "@Stargateur This exact answer is the reason I do it in a different thread. I don&#39;t mind blocking (until any char is typed), but I don&#39;t want it to wait for an <b>enter</b>. Isn&#39;t that possible? Also about printing, I prefer it not to print but if it&#39;s inevitable I can live with it. (However I&#39;m 100% sure it&#39;s technically possible as <code>getch()</code> does it.)"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499378871, "post_id": 44959216, "comment_id": 76894664, "body": "@Neo the answer to without press enter is again ncurses, <a href=\"https://stackoverflow.com/questions/26321592/how-can-i-read-one-character-from-stdin-without-having-to-hit-enter\" title=\"how can i read one character from stdin without having to hit enter\">stackoverflow.com/questions/26321592/&hellip;</a>, please learn to search a little !"}], "owner": {"reputation": 2836, "user_id": 3529197, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ceed214a6e603c456a8ebaacc036b407?s=128&d=identicon&r=PG&f=1", "display_name": "Neo", "link": "https://stackoverflow.com/users/3529197/neo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1094, "favorite_count": 0, "closed_date": 1499383848, "answer_count": 0, "score": 0, "last_activity_date": 1499435946, "creation_date": 1499376741, "last_edit_date": 1499435946, "question_id": 44959216, "link": "https://stackoverflow.com/questions/44959216/how-can-i-get-a-single-byte-from-stdin-in-rust-without-waiting-for-enter", "closed_reason": "Duplicate", "title": "How can I get a single byte from stdin in Rust without waiting for Enter?", "body": "<p>I have a background thread that reads bytes in an infinite loop and sends them to main through a <code>channel</code>. I'm looking for the equivalent of C's <code>getch()</code>. </p>\n\n<p>I found this:</p>\n\n<pre><code>let byte = io::stdin().bytes().next().expect(\"no byte read\").ok().unwrap();\n</code></pre>\n\n<p>This waits for an <kbd>Enter</kbd> which I don't want. It also prints the inputted character, which is also unwanted.</p>\n\n<p>After I press <kbd>Enter</kbd>, I get all the characters I pressed one by one and finally instead of just a 10 (new line), I get 10 followed by 13. Why?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8267319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4407266f063752d1c6110ec75c62ff3d?s=128&d=identicon&r=PG&f=1", "display_name": "Legom", "link": "https://stackoverflow.com/users/8267319/legom"}, "edited": false, "score": 0, "creation_date": 1499374445, "post_id": 44958498, "comment_id": 76892710, "body": "Okay, thank you for answer, but how can I manage this problem? When I have many shared function/modules across project. For example I put every enum to separated file, which is the problem I have. Maybe this is not the best practice how to do that."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 21, "user_id": 8267319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4407266f063752d1c6110ec75c62ff3d?s=128&d=identicon&r=PG&f=1", "display_name": "Legom", "link": "https://stackoverflow.com/users/8267319/legom"}, "edited": false, "score": 1, "creation_date": 1499374686, "post_id": 44958498, "comment_id": 76892822, "body": "@Legom <i>I put every enum to separated file</i> \u2014 I don&#39;t do that, so it hasn&#39;t been a problem. Most of my crates have had a small number of files; I doubt any have had more than 10, and I have one project where a single file is 200K. If you really find yourself unable to embrace such structure, you could use <a href=\"https://doc.rust-lang.org/std/macro.include.html\" rel=\"nofollow noreferrer\"><code>include!</code></a> as a terrible hack."}, {"owner": {"reputation": 21, "user_id": 8267319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4407266f063752d1c6110ec75c62ff3d?s=128&d=identicon&r=PG&f=1", "display_name": "Legom", "link": "https://stackoverflow.com/users/8267319/legom"}, "edited": false, "score": 0, "creation_date": 1499374770, "post_id": 44958498, "comment_id": 76892863, "body": "Yes, I have read about include but as you said, it doesn&#39;t feel right."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 2, "last_activity_date": 1499373708, "creation_date": 1499373708, "answer_id": 44958498, "question_id": 44958432, "link": "https://stackoverflow.com/questions/44958432/how-can-i-access-items-in-a-top-level-module-from-another-top-level-module-witho/44958498#44958498", "title": "How can I access items in a top level module from another top level module without changing main.rs?", "body": "<blockquote>\n  <p>Is there any way I can reference the output module in module_a/mod.rs without messing with main.rs?</p>\n</blockquote>\n\n<p>No. Each module (including the crate entry point of <strong>main.rs</strong> or <strong>lib.rs</strong>) has to explicitly define what modules are its children.</p>\n\n<hr>\n\n<p>You could move the <code>output</code> module to be a child of <code>module_a</code>, however.</p>\n"}], "owner": {"reputation": 21, "user_id": 8267319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4407266f063752d1c6110ec75c62ff3d?s=128&d=identicon&r=PG&f=1", "display_name": "Legom", "link": "https://stackoverflow.com/users/8267319/legom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1499373715, "creation_date": 1499373450, "last_edit_date": 1499373715, "question_id": 44958432, "link": "https://stackoverflow.com/questions/44958432/how-can-i-access-items-in-a-top-level-module-from-another-top-level-module-witho", "title": "How can I access items in a top level module from another top level module without changing main.rs?", "body": "<p>I have following file structure:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>main.rs\n-- module_a\n  -- mod.rs\noutput.rs\n</code></pre>\n\n<p>In <strong>output.rs</strong>, I have a function called <code>log_info()</code> and I'd like to call it from <code>module_a/mod.rs</code>.</p>\n\n<p>I can place <code>mod output;</code> in <strong>main.rs</strong> and after that I can reference it from <strong>module_a/mod.rs</strong>, but I don't like having to place all my dependencies in <strong>main.rs</strong> in order to use them in my application.</p>\n\n<p>Is there any way I can reference the <strong>output</strong> module in <strong>module_a/mod.rs</strong> without messing with <strong>main.rs</strong>?</p>\n"}, {"tags": ["if-statement", "rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1499363242, "post_id": 44955300, "comment_id": 76886942, "body": "<i>Highly</i> related, if not a dupe: <a href=\"https://stackoverflow.com/q/37048629/155423\">Is an if-let or a normal if condition better?</a>"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1499406772, "post_id": 44955300, "comment_id": 76901752, "body": "Why not <code>if v.is_empty() == false {}</code>? It is explicit and has no useless <code>let</code>."}], "answers": [{"comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1499406863, "post_id": 44955982, "comment_id": 76901774, "body": "I understand OP. <code>!</code> is not really readable: when you scan quickly the code with the eyes, you can skip this easily. I would have prefered a <code>not</code> keyword."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1499418818, "post_id": 44955982, "comment_id": 76908802, "body": "@Boiethios: I agree, I&#39;ve always found <code>!</code> rather iffy in this position because it&#39;s so easy to miss. I mean, the difference between <code>!v</code> and <code>lv</code>/<code>iv</code> isn&#39;t exactly striking."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1499419185, "post_id": 44955982, "comment_id": 76909067, "body": "@MatthieuM. Unfortunately, because of backward compatibility, the team will likely never consider such a breaking change."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 4, "last_activity_date": 1499364069, "creation_date": 1499364069, "answer_id": 44955982, "question_id": 44955300, "link": "https://stackoverflow.com/questions/44955300/is-there-any-performance-difference-between-if-let-and-if-for-a-boolean/44955982#44955982", "title": "Is there any performance difference between `if let` and `if` for a boolean?", "body": "<p>For any performance question, you <strong>need to profile</strong> to be sure. Anything but that is essentially guessing.</p>\n\n<p>As a first-level guess however, you can look at the generated assembly:</p>\n\n<pre><code>#![crate_type=\"lib\"]\n\npub fn one() {\n    let mut v = vec![2, 3, 4];\n    if let false = v.is_empty() {\n        v.push(5);\n    }\n}\n\npub fn two() {\n    let mut v = vec![2, 3, 4];\n    if !v.is_empty() {\n        v.push(5);\n    }\n}\n</code></pre>\n\n<p>Compiling the above code to assembly using Rust 1.18 and diffing the two functions shows minimal differences, mostly around constant and label names:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>--- a.asm   2017-07-06 13:53:29.000000000 -0400\n+++ b.asm   2017-07-06 13:53:48.000000000 -0400\n@@ -1,2 +1,2 @@\n-_ZN10playground3one17hbd49bc1da7229962E:\n-.Lfunc_begin0:\n+_ZN10playground3two17h3228f5d5d04f0491E:\n+.Lfunc_begin1:\n@@ -5 +5 @@\n-   .cfi_lsda 27, .Lexception0\n+   .cfi_lsda 27, .Lexception1\n@@ -7 +7 @@\n-.Ltmp8:\n+.Ltmp14:\n@@ -10 +10 @@\n-.Ltmp9:\n+.Ltmp15:\n@@ -12 +12 @@\n-.Ltmp10:\n+.Ltmp16:\n@@ -18 +18 @@\n-   je  .LBB1_8\n+   je  .LBB2_8\n@@ -23 +23 @@\n-   movaps  .LCPI1_0(%rip), %xmm0\n+   movaps  .LCPI2_0(%rip), %xmm0\n@@ -25 +25 @@\n-.Ltmp5:\n+.Ltmp11:\n@@ -28 +28 @@\n-.Ltmp6:\n+.Ltmp12:\n@@ -36 +36 @@\n-   je  .LBB1_4\n+   je  .LBB2_4\n@@ -40 +40 @@\n-.LBB1_4:\n+.LBB2_4:\n@@ -44 +44 @@\n-.LBB1_8:\n+.LBB2_8:\n@@ -46,2 +46,2 @@\n-.LBB1_5:\n-.Ltmp7:\n+.LBB2_5:\n+.Ltmp13:\n@@ -51 +51 @@\n-   je  .LBB1_7\n+   je  .LBB2_7\n@@ -56 +56 @@\n-.LBB1_7:\n+.LBB2_7:\n</code></pre>\n\n<p>To me, that's proof enough that they are the same. I'd still prefer the boolean form because it's easier to understand:</p>\n\n<pre><code>let mut v = vec![2, 3, 4];\nif !v.is_empty() {\n    v.push(5);\n}\n</code></pre>\n"}], "owner": {"reputation": 435, "user_id": 4314528, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c6fc8b2a85f97a147671e98dc1bac0ad?s=128&d=identicon&r=PG&f=1", "display_name": "erp", "link": "https://stackoverflow.com/users/4314528/erp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 44955982, "answer_count": 1, "score": 2, "last_activity_date": 1499364069, "creation_date": 1499361477, "last_edit_date": 1499361647, "question_id": 44955300, "link": "https://stackoverflow.com/questions/44955300/is-there-any-performance-difference-between-if-let-and-if-for-a-boolean", "title": "Is there any performance difference between `if let` and `if` for a boolean?", "body": "<p>For example:</p>\n\n<pre><code>let mut v = vec![2, 3, 4];\nif let false = v.is_empty() {\n    v.push(5);\n}\n</code></pre>\n\n<p>vs:</p>\n\n<pre><code>let mut v = vec![2, 3, 4];\nif !v.is_empty() {\n    v.push(5);\n}\n</code></pre>\n\n<p>My gut feeling is that it's trivial and doesn't matter.</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 17, "last_activity_date": 1499355348, "creation_date": 1499355348, "answer_id": 44953351, "question_id": 44953197, "link": "https://stackoverflow.com/questions/44953197/how-do-i-disambiguate-traits-in-rust/44953351#44953351", "title": "How do I disambiguate traits in Rust?", "body": "<p>You can call the trait method directly:</p>\n\n<pre><code>fn main() {\n    let mut a = String::new();\n    let mut b = std::fs::File::create(\"test\").unwrap();\n\n    std::fmt::Write::write_fmt(&amp;mut a, format_args!(\"hello\"));\n    std::io::Write::write_fmt(&amp;mut b, format_args!(\"hello\"));\n}\n</code></pre>\n\n<p>You can also choose to only import the trait in a smaller scope:</p>\n\n<pre><code>fn main() {\n    let mut a = String::new();\n    let mut b = std::fs::File::create(\"test\").unwrap();\n\n    {\n        use std::fmt::Write;\n        a.write_fmt(format_args!(\"hello\"));\n    }\n\n    {\n        use std::io::Write;\n        b.write_fmt(format_args!(\"hello\"));\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>Note that if you choose to use a smaller scope, you can also use the <code>write!</code> macro directly:</p>\n\n<pre><code>fn main() {\n    let mut a = String::new();\n    let mut b = std::fs::File::create(\"test\").unwrap();\n\n    {\n        use std::fmt::Write;\n        write!(a, \"hello\");\n    }\n\n    {\n        use std::io::Write;\n        write!(b, \"hello\");\n    }\n}\n</code></pre>\n\n<p>In either case, you should handle the <code>Result</code> return value.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/44445730/155423\">How to call a method when a trait and struct use the same name?</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": false, "score": 10, "last_activity_date": 1584976984, "last_edit_date": 1584976984, "creation_date": 1499357061, "answer_id": 44953931, "question_id": 44953197, "link": "https://stackoverflow.com/questions/44953197/how-do-i-disambiguate-traits-in-rust/44953931#44953931", "title": "How do I disambiguate traits in Rust?", "body": "<p>You can specify an alias for <code>use</code>:</p>\n\n<pre><code>use std::fmt::Write as FmtWrite;\nuse std::io::Write;\n\nfn main() {\n    let mut a = String::new();\n    let mut b = std::fs::File::create(\"test\").unwrap();\n\n    a.write_fmt(format_args!(\"hello\"));\n    b.write_fmt(format_args!(\"hello\"));\n}\n</code></pre>\n\n<p>If you just want to call the traits method, you can even just bring them in scope:</p>\n\n<pre><code>use std::fmt::Write as _;\nuse std::io::Write as _;\n\nfn main() {\n    let mut a = String::new();\n    let mut b = std::fs::File::create(\"test\").unwrap();\n\n    a.write_fmt(format_args!(\"hello\"));\n    b.write_fmt(format_args!(\"hello\"));\n}\n</code></pre>\n\n<p>Be careful, this solution works when <strong>different</strong> types implement different traits with the same name. If the same type implements different traits with the same name, you must use <a href=\"https://stackoverflow.com/a/44953351/4498831\">Shepmaster's answer</a>:</p>\n\n<pre><code>mod foo {\n    pub trait Trait {\n        fn do_something(&amp;self) {}\n    }\n}\n\nmod bar {\n    pub trait Trait {\n        fn do_something(&amp;self) {}\n    }\n}\n\npub struct Concrete {}\nimpl foo::Trait for Concrete {}\nimpl bar::Trait for Concrete {}\n\nfn main() {\n    let x = Concrete {};\n\n    {\n        use foo::Trait; // use limited to scope\n\n        x.do_something(); // call foo::Trait::do_something\n    }\n    {    \n        foo::Trait::do_something(&amp;x); // complete path to disambiguate\n        bar::Trait::do_something(&amp;x); // complete path to disambiguate\n    }\n    {\n        use foo::Trait as FooTrait;\n        use bar::Trait;\n\n        x.do_something(&amp;x); // ERROR: multiple applicable items in scope\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1537, "user_id": 274249, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0717e91d392d7e0fc3aeca3eb79271ec?s=128&d=identicon&r=PG&f=1", "display_name": "ashleysmithgpu", "link": "https://stackoverflow.com/users/274249/ashleysmithgpu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2095, "favorite_count": 2, "accepted_answer_id": 44953351, "answer_count": 2, "score": 12, "last_activity_date": 1584976984, "creation_date": 1499354925, "last_edit_date": 1499357179, "question_id": 44953197, "link": "https://stackoverflow.com/questions/44953197/how-do-i-disambiguate-traits-in-rust", "title": "How do I disambiguate traits in Rust?", "body": "<p>I want to use the <code>write_fmt</code> method on two different types of object:</p>\n\n<pre><code>use std::fmt::Write;\nuse std::io::Write;\n\nfn main() {\n    let mut a = String::new();\n    let mut b = std::fs::File::create(\"test\").unwrap();\n\n    a.write_fmt(format_args!(\"hello\"));\n    b.write_fmt(format_args!(\"hello\"));\n}\n</code></pre>\n\n<p>I get an error when using <code>Write</code> because they are both named the same:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0252]: a trait named `Write` has already been imported in this module\n --&gt; src/main.rs:8:5\n  |\n7 | use std::fmt::Write;\n  |     --------------- previous import of `Write` here\n8 | use std::io::Write;\n  |     ^^^^^^^^^^^^^^ `Write` already imported\n      a.write_fmt(format_args!(\"hello\"));\n      b.write_fmt(format_args!(\"hello\"));\n</code></pre>\n\n<p>Or I get an error saying the trait is not available:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0599]: no method named `write_fmt` found for type `std::fs::File` in the current scope\n  --&gt; src/main.rs:76:4\n   |\n76 |    b.write_fmt(format_args!(\"hello\"));\n   |      ^^^^^^^^^\n   |\n   = help: items from traits can only be used if the trait is in scope; the following trait is implemented but not in scope, perhaps add a `use` for it:\n   = help: candidate #1: `use std::io::Write;`\n</code></pre>\n"}, {"tags": ["macros", "rust"], "comments": [{"owner": {"reputation": 6357, "user_id": 6086311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb99289473f6393b89474785f2d294d1?s=128&d=identicon&r=PG", "display_name": "dtolnay", "link": "https://stackoverflow.com/users/6086311/dtolnay"}, "edited": false, "score": 1, "creation_date": 1499752190, "post_id": 44950574, "comment_id": 77026666, "body": "1. Is your procedural macro really generating a struct and not an impl block? For dumb reasons, the most reliable approach is way more complicated for macros that generate a struct compared to macros that generate an impl."}, {"owner": {"reputation": 6357, "user_id": 6086311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb99289473f6393b89474785f2d294d1?s=128&d=identicon&r=PG", "display_name": "dtolnay", "link": "https://stackoverflow.com/users/6086311/dtolnay"}, "edited": false, "score": 0, "creation_date": 1499752253, "post_id": 44950574, "comment_id": 77026689, "body": "2. Is this for a proc_macro_derive macro, or a different type of procedural macro?"}, {"owner": {"reputation": 6357, "user_id": 6086311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb99289473f6393b89474785f2d294d1?s=128&d=identicon&r=PG", "display_name": "dtolnay", "link": "https://stackoverflow.com/users/6086311/dtolnay"}, "edited": false, "score": 0, "creation_date": 1499752345, "post_id": 44950574, "comment_id": 77026725, "body": "3. <code>[SomeTrait; #len]</code> is not a thing you can do, because <code>[T; n]</code> requires <code>T: Sized</code>. See <a href=\"https://play.rust-lang.org/?gist=bb33e5ba42a7e64af998b014483329f0\" rel=\"nofollow noreferrer\">play.rust-lang.org/?gist=bb33e5ba42a7e64af998b014483329f0</a>. Can you clarify the intended result?"}, {"owner": {"reputation": 11388, "user_id": 220485, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bTrsL.jpg?s=128&g=1", "display_name": "Daniel Fath", "link": "https://stackoverflow.com/users/220485/daniel-fath"}, "reply_to_user": {"reputation": 6357, "user_id": 6086311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb99289473f6393b89474785f2d294d1?s=128&d=identicon&r=PG", "display_name": "dtolnay", "link": "https://stackoverflow.com/users/6086311/dtolnay"}, "edited": false, "score": 0, "creation_date": 1499778832, "post_id": 44950574, "comment_id": 77045047, "body": "@dtolnay: 1. It&#39;s generating a struct and an impl block. 2. This is for Nightly Macros 2.0 ; 3. Something like <a href=\"https://play.rust-lang.org/?gist=415163c29391484ada4c876553ebf23f&amp;version=stable&amp;backtrace=0\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a> (I need procedural macros, since I want to parse first parameter in specific way)"}, {"owner": {"reputation": 11388, "user_id": 220485, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bTrsL.jpg?s=128&g=1", "display_name": "Daniel Fath", "link": "https://stackoverflow.com/users/220485/daniel-fath"}, "reply_to_user": {"reputation": 6357, "user_id": 6086311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb99289473f6393b89474785f2d294d1?s=128&d=identicon&r=PG", "display_name": "dtolnay", "link": "https://stackoverflow.com/users/6086311/dtolnay"}, "edited": false, "score": 0, "creation_date": 1499953270, "post_id": 44950574, "comment_id": 77137373, "body": "@dtolnay Updated questions with clarification."}, {"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "edited": false, "score": 0, "creation_date": 1537377069, "post_id": 44950574, "comment_id": 91765705, "body": "<a href=\"https://github.com/rust-lang/rust/issues/54363\" rel=\"nofollow noreferrer\">Issue on the Rust repository on this topic</a>"}], "answers": [{"tags": [], "owner": {"reputation": 973, "user_id": 4777513, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/inkg3.jpg?s=128&g=1", "display_name": "Ekleog", "link": "https://stackoverflow.com/users/4777513/ekleog"}, "is_accepted": false, "score": 4, "last_activity_date": 1534688675, "creation_date": 1534688675, "answer_id": 51918597, "question_id": 44950574, "link": "https://stackoverflow.com/questions/44950574/using-crate-in-rusts-procedural-macros/51918597#51918597", "title": "Using $crate in Rust&#39;s procedural macros?", "body": "<p>Based on replies from <a href=\"https://github.com/rust-lang/rust/issues/38356#issuecomment-412920528\" rel=\"nofollow noreferrer\">https://github.com/rust-lang/rust/issues/38356#issuecomment-412920528</a>, it looks like there is no way to do this (as of 2018-08), neither to refer to the proc-macro crate nor to refer to any other crate unambiguously.</p>\n"}, {"tags": [], "owner": {"reputation": 8176, "user_id": 314345, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d2c8b7c25f4cd87a65001a2f952c0008?s=128&d=identicon&r=PG", "display_name": "dhardy", "link": "https://stackoverflow.com/users/314345/dhardy"}, "is_accepted": false, "score": 1, "last_activity_date": 1540635841, "last_edit_date": 1540635841, "creation_date": 1540635403, "answer_id": 53020866, "question_id": 44950574, "link": "https://stackoverflow.com/questions/44950574/using-crate-in-rusts-procedural-macros/53020866#53020866", "title": "Using $crate in Rust&#39;s procedural macros?", "body": "<p>In Edition 2015 (classic Rust), you can do this (but it's hacky):</p>\n\n<ul>\n<li>use <code>::defining_crate::SomeTrait</code> in the macro</li>\n<li>within third-party crates depending on <code>defining_crate</code>, the above works fine</li>\n<li><p>within <code>defining_crate</code> itself, add a module in the root:</p>\n\n<p><code>mod defining_crate { pub use super::*; }</code></p></li>\n</ul>\n\n<p>In Edition 2018 even more hacky solutions are required (see <a href=\"https://github.com/rust-lang/rust/issues/54647\" rel=\"nofollow noreferrer\">this issue</a>), though <a href=\"https://github.com/rust-lang/rust/pull/55275\" rel=\"nofollow noreferrer\">#55275</a> may give us a simple workaround.</p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 10210553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4537f124307446254626b408a1e5f873?s=128&d=identicon&r=PG&f=1", "display_name": "Gary Howe", "link": "https://stackoverflow.com/users/10210553/gary-howe"}, "is_accepted": false, "score": 1, "last_activity_date": 1563248445, "creation_date": 1563248445, "answer_id": 57049687, "question_id": 44950574, "link": "https://stackoverflow.com/questions/44950574/using-crate-in-rusts-procedural-macros/57049687#57049687", "title": "Using $crate in Rust&#39;s procedural macros?", "body": "<p>Since Rust 1.34, you can use <code>extern my_crate as self</code>, and use <code>my_crate::Foo</code> instead of <code>$crate::Foo</code>.</p>\n\n<p><a href=\"https://github.com/rust-lang/rust/issues/54647\" rel=\"nofollow noreferrer\">https://github.com/rust-lang/rust/issues/54647</a></p>\n\n<p><a href=\"https://github.com/rust-lang/rust/pull/57407\" rel=\"nofollow noreferrer\">https://github.com/rust-lang/rust/pull/57407</a></p>\n\n<p>(Credit: Neptunepink ##rust irc.freenode.net)</p>\n"}], "owner": {"reputation": 11388, "user_id": 220485, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bTrsL.jpg?s=128&g=1", "display_name": "Daniel Fath", "link": "https://stackoverflow.com/users/220485/daniel-fath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1745, "favorite_count": 5, "answer_count": 3, "score": 20, "last_activity_date": 1563248445, "creation_date": 1499348262, "last_edit_date": 1499953917, "question_id": 44950574, "link": "https://stackoverflow.com/questions/44950574/using-crate-in-rusts-procedural-macros", "title": "Using $crate in Rust&#39;s procedural macros?", "body": "<p>I know what the <a href=\"https://doc.rust-lang.org/1.5.0/book/macros.html#the-variable-crate\" rel=\"noreferrer\"><code>$crate</code></a> variable is, but as far as I can tell, it can't be used inside procedural macros. Is there another way to achieve a similar effect? </p>\n\n<p>I have an example that roughly requires me to write something like this using <a href=\"https://github.com/dtolnay/quote\" rel=\"noreferrer\">quote</a> and nightly Rust</p>\n\n<pre><code>quote!(\n     struct Foo {\n        bar: [SomeTrait;#len]\n     }\n)\n</code></pre>\n\n<p>I need to make sure <code>SomeTrait</code> is in scope (<code>#len</code> is referencing an integer outside the scope of the snippet).</p>\n\n<p>I am using procedural macros 2.0 on nightly using quote and syn because <code>proc-macro-hack</code> didn't work for me. <a href=\"https://play.rust-lang.org/?gist=c3739bef9d9d64400d9653b245582892&amp;version=nightly\" rel=\"noreferrer\">This is the example</a> I'm trying to generalize.</p>\n"}, {"tags": ["rust", "match"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 5, "creation_date": 1499341699, "post_id": 44947920, "comment_id": 76870978, "body": "You should read the <a href=\"https://doc.rust-lang.org/book/second-edition/\" rel=\"nofollow noreferrer\">book</a>"}, {"owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499341830, "post_id": 44947920, "comment_id": 76871073, "body": "@Stargateur I have actually read the book and particularly the page about <code>match</code>. This page however, does not describe how to extract the value from <code>Ok</code> which is part of the <code>Result</code> struct."}, {"owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "edited": false, "score": 0, "creation_date": 1499342649, "post_id": 44947920, "comment_id": 76871666, "body": "@duck you can always consult the Rust std docs to find details applicable to specific cases (in this case <a href=\"https://doc.rust-lang.org/std/result/enum.Result.html\" rel=\"nofollow noreferrer\">Result docs</a>)."}], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1499342226, "post_id": 44948054, "comment_id": 76871371, "body": "I don&#39;t think that the OP want this behavior: &quot;What i am trying to achieve with this piece of code is that if the environment variable SOMEVALUE is found, it is bound to k.&quot;"}, {"owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "edited": false, "score": 1, "creation_date": 1499342276, "post_id": 44948054, "comment_id": 76871402, "body": "Would it then not be better to move away from the match statement as a whole here to prevent having to do a string comparison to check if there was an error  ?"}], "tags": [], "owner": {"reputation": 12555, "user_id": 1750757, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Zmc7D.jpg?s=128&g=1", "display_name": "Victor Polevoy", "link": "https://stackoverflow.com/users/1750757/victor-polevoy"}, "is_accepted": false, "score": 3, "last_activity_date": 1499348066, "last_edit_date": 1499348066, "creation_date": 1499341774, "answer_id": 44948054, "question_id": 44947920, "link": "https://stackoverflow.com/questions/44947920/how-can-i-return-the-matched-value-from-envvar/44948054#44948054", "title": "How can I return the matched value from env::var?", "body": "<p>In Rust, everything is an expression, there are only a few statements. Each expression returns a value and if the expression does not return anything explicitly, it returns a <code>()</code> (unit) value implicitly.</p>\n\n<p>Your <code>match</code> expression returns different types from 2 branches - a <code>std::String</code> from <code>Ok</code> branch and <code>()</code> from <code>Err</code> branch.</p>\n\n<p>To fix this, you must return something from the second branch too:</p>\n\n<pre><code>let k = match env::var(SOMEVALUE) {\n    Ok(val) =&gt; {return val},\n    Err(e) =&gt; {\n        println!(\"could not find {}: {}\", SOMEVALUE, e);\n\n        String::default()\n    },\n};\n</code></pre>\n\n<p>This returns a value of the same type - <code>std::String</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 91, "user_id": 8350825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nmRlF.jpg?s=128&g=1", "display_name": "Andrew Gremlich", "link": "https://stackoverflow.com/users/8350825/andrew-gremlich"}, "edited": false, "score": 0, "creation_date": 1550780418, "post_id": 44948221, "comment_id": 96407510, "body": "Once you mentioned the <code>unwrap_or_else</code> I remembered that there was also a <code>unwrap</code> without the error handling.  So I went with the <code>unwrap</code>."}], "tags": [], "owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "is_accepted": true, "score": 8, "last_activity_date": 1535575864, "last_edit_date": 1535575864, "creation_date": 1499342242, "answer_id": 44948221, "question_id": 44947920, "link": "https://stackoverflow.com/questions/44947920/how-can-i-return-the-matched-value-from-envvar/44948221#44948221", "title": "How can I return the matched value from env::var?", "body": "<p>What Victor wrote is correct, but you probably want to actually bind a value to <code>k</code>; in that case you should change your code to:</p>\n\n<pre><code>let k = match env::var(SOMEVALUE) {\n    Ok(val) =&gt; val,\n    Err(e) =&gt; panic!(\"could not find {}: {}\", SOMEVALUE, e),\n};\n</code></pre>\n\n<p>Equivalently, you can use <a href=\"https://doc.rust-lang.org/std/result/enum.Result.html#method.unwrap_or_else\" rel=\"nofollow noreferrer\"><code>Result::unwrap_or_else</code></a>:</p>\n\n<pre><code>let k = env::var(SOMEVALUE).unwrap_or_else(|e| {\n    panic!(\"could not find {}: {}\", SOMEVALUE, e)\n});\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1733, "user_id": 1460102, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e70df89ccf5e5509e4aae9ef4ed5b865?s=128&d=identicon&r=PG", "display_name": "xxks-kkk", "link": "https://stackoverflow.com/users/1460102/xxks-kkk"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1535575927, "post_id": 52085587, "comment_id": 91122093, "body": "@Shepmaster Thanks for the comment. Adapted."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1535576030, "post_id": 52085587, "comment_id": 91122141, "body": "I apologize that I wasn&#39;t clear. The top-voted answer already uses a <code>match</code> and a <code>panic</code>. I was trying to ask what the difference is between this answer and that one."}, {"owner": {"reputation": 1733, "user_id": 1460102, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e70df89ccf5e5509e4aae9ef4ed5b865?s=128&d=identicon&r=PG", "display_name": "xxks-kkk", "link": "https://stackoverflow.com/users/1460102/xxks-kkk"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1535576128, "post_id": 52085587, "comment_id": 91122186, "body": "@Shepmaster different flavor I assume. Instead of <code>env::var</code>, I use <code>env::var_os</code>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1535578242, "post_id": 52085587, "comment_id": 91123002, "body": "Perhaps you can <a href=\"https://stackoverflow.com/posts/52085587/edit\">edit</a> your answer to explain to future visitors <i>why</i> they should favor this answer as opposed to one of the others? What tradeoffs are different with this answer? While you use <code>var_os</code>, you convert it to a <code>String</code> and then panic if that fails (via <code>unwrap</code>), so I&#39;m not yet clear on the benefit."}], "tags": [], "owner": {"reputation": 1733, "user_id": 1460102, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/e70df89ccf5e5509e4aae9ef4ed5b865?s=128&d=identicon&r=PG", "display_name": "xxks-kkk", "link": "https://stackoverflow.com/users/1460102/xxks-kkk"}, "is_accepted": false, "score": 0, "last_activity_date": 1535591190, "last_edit_date": 1535591190, "creation_date": 1535574406, "answer_id": 52085587, "question_id": 44947920, "link": "https://stackoverflow.com/questions/44947920/how-can-i-return-the-matched-value-from-envvar/52085587#52085587", "title": "How can I return the matched value from env::var?", "body": "<p>Another option you can do is following (This just shows how we can use <code>env::var_os</code> to achieve same purpose)</p>\n\n<pre><code>let spdk_dir = match env::var_os(\"SPDK_DIR\") {\n    Some(val) =&gt; val.into_string().unwrap(),\n    None =&gt; panic!(\"SPDK_DIR is not defined in the environment\")\n};\n</code></pre>\n\n<p>Here, we try to read the environment variable <code>SPDK_DIR</code> and if it is not defined, we exit the program.</p>\n"}], "owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1432, "favorite_count": 0, "accepted_answer_id": 44948221, "answer_count": 3, "score": 2, "last_activity_date": 1535591190, "creation_date": 1499341405, "last_edit_date": 1499348001, "question_id": 44947920, "link": "https://stackoverflow.com/questions/44947920/how-can-i-return-the-matched-value-from-envvar", "title": "How can I return the matched value from env::var?", "body": "<p>If the environment variable <code>SOMEVALUE</code> is found, it should be bound to <code>k</code>:</p>\n\n<pre><code>let k = match env::var(SOMEVALUE) {\n    Ok(val) =&gt; {return val},\n    Err(e) =&gt; println!(\"could not find {}: {}\", SOMEVALUE, e),\n};\n</code></pre>\n\n<p>Compiling this code gives the following error</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>   |\n11 |         Ok(val) =&gt; {return val},\n   |                            ^^^ expected (), found struct `std::string::String`\n   |\n   = note: expected type `()`\n              found type `std::string::String`\n</code></pre>\n"}, {"tags": ["testing", "rust", "rust-cargo"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1499348559, "post_id": 44947914, "comment_id": 76876327, "body": "As much as I love duplicates, this doesn&#39;t seem to be a duplicate of &quot;Is there any way to tell Cargo to run its tests on the main thread?&quot;. This question specifically is asking if there&#39;s a way to set the number of threads somewhere in the filesystem so that neither the environment variable or command line option need to be passed. For that question, even setting the number of threads to 1 doesn&#39;t work because it&#39;s still a separate thread from main."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1499348717, "post_id": 44947914, "comment_id": 76876462, "body": "There&#39;s an <a href=\"https://github.com/rust-lang/rust/pull/42684\" rel=\"nofollow noreferrer\">open PR</a> that proposes to add an attribute like <code>#[serial]</code> to the test runner which would cause the marked tests to not run in parallel, but it&#39;s anyones guess if this will be accepted."}], "answers": [{"tags": [], "owner": {"reputation": 2959, "user_id": 5903309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/665cdb14fb46d20c11a176c92e6ed663?s=128&d=identicon&r=PG", "display_name": "Jan Nils Ferner", "link": "https://stackoverflow.com/users/5903309/jan-nils-ferner"}, "is_accepted": false, "score": 10, "last_activity_date": 1499355485, "last_edit_date": 1499355485, "creation_date": 1499354998, "answer_id": 44953220, "question_id": 44947914, "link": "https://stackoverflow.com/questions/44947914/how-to-limit-the-number-of-test-threads-in-cargo-toml/44953220#44953220", "title": "How to limit the number of test threads in Cargo.toml?", "body": "<p>As of Rust 1.18, there is no such thing. In fact, there is not even a simpler option to disable parallel testing.<br>\n<a href=\"https://github.com/rust-lang/rust/issues/33519\" rel=\"noreferrer\">Source</a></p>\n\n<p>However, what might help you is <code>cargo test -- --test-threads=1</code>, which is the recommended way of doing what you are doing over the <code>RUST_TEST_THREADS</code> envvar.  Keep in mind that this only sets the number of threads used for testing <strong>in addition</strong> to the main thread.</p>\n"}], "owner": {"reputation": 1845, "user_id": 716390, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/03291df3e8db07ec188e120f66624272?s=128&d=identicon&r=PG", "display_name": "kriomant", "link": "https://stackoverflow.com/users/716390/kriomant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3913, "favorite_count": 0, "answer_count": 1, "score": 9, "last_activity_date": 1499355485, "creation_date": 1499341388, "last_edit_date": 1499348746, "question_id": 44947914, "link": "https://stackoverflow.com/questions/44947914/how-to-limit-the-number-of-test-threads-in-cargo-toml", "title": "How to limit the number of test threads in Cargo.toml?", "body": "<p>I have tests which share a common resource and can't be executed concurrently. These tests fail with <code>cargo test</code>, but work with <code>RUST_TEST_THREADS=1 cargo test</code>.</p>\n\n<p>I can modify the tests to wait on a global mutex, but I don't want to clutter them if there is any simpler way to force <code>cargo</code> set this environment variable for me.</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499341335, "post_id": 44947640, "comment_id": 76870714, "body": "So you want specifies the target of rustc ?"}, {"owner": {"reputation": 7560, "user_id": 1034749, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2022f0caae119ed6232cf370bb9d9d3a?s=128&d=identicon&r=PG", "display_name": "fghj", "link": "https://stackoverflow.com/users/1034749/fghj"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1499341400, "post_id": 44947640, "comment_id": 76870764, "body": "@Stargateur No, I want to run tests without <code>cargo</code> and <code>rustc</code> on machine."}], "answers": [{"comments": [{"owner": {"reputation": 7560, "user_id": 1034749, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2022f0caae119ed6232cf370bb9d9d3a?s=128&d=identicon&r=PG", "display_name": "fghj", "link": "https://stackoverflow.com/users/1034749/fghj"}, "edited": false, "score": 0, "creation_date": 1499355771, "post_id": 44953448, "comment_id": 76882107, "body": "Great, that is exactly how I want it to be implemented."}], "tags": [], "owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "is_accepted": true, "score": 5, "last_activity_date": 1538937310, "last_edit_date": 1538937310, "creation_date": 1499355635, "answer_id": 44953448, "question_id": 44947640, "link": "https://stackoverflow.com/questions/44947640/how-can-i-run-cargo-tests-on-another-machine-without-the-rust-compiler/44953448#44953448", "title": "How can I run cargo tests on another machine without the Rust compiler?", "body": "<p>There are two kinds of tests supported by <code>cargo test</code>, one is the normal tests (<code>#[test] fn</code>s and files inside <code>tests/</code>), the other is the doc tests. </p>\n\n<p>The normal tests <em>are</em> as simple as running all binaries. The test is considered successful if it exits with error code 0.</p>\n\n<p>Doc tests <em>cannot</em> be cross-tested. Doc tests are compiled and executed directly by <code>rustdoc</code> using the compiler libraries, so the compiler must be installed on the ARM machine to run the doc tests. In fact, running <code>cargo test --doc</code> when HOST \u2260 TARGET will do nothing.</p>\n\n<p>So, the answer to your last question is <strong>yes</strong> as long as you don't rely on doc-tests for coverage.</p>\n\n<hr>\n\n<p>Starting from Rust 1.19, <code>cargo</code> supports <a href=\"https://github.com/rust-lang/cargo/pull/3954\" rel=\"nofollow noreferrer\">target specific runners</a>, which allows you to  specify a script to upload and execute the test program on the ARM machine.</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>#!/bin/sh\nset -e\nadb push \"$1\" \"/sdcard/somewhere/$1\"\nadb shell \"chmod 755 /sdcard/somewhere/$1 &amp;&amp; /sdcard/somewhere/$1\" \n# ^ note: may need to change this line, see https://stackoverflow.com/q/9379400\n</code></pre>\n\n<p>Put this to your <a href=\"http://doc.crates.io/config.html\" rel=\"nofollow noreferrer\"><code>.cargo/config</code></a>:</p>\n\n<pre class=\"lang-ini prettyprint-override\"><code>[target.arm-linux-androideabi]\nrunner = [\"/path/to/your/run/script.sh\"]\n</code></pre>\n\n<p>then <code>cargo test --target=arm-linux-androideabi</code> should Just Work\u2122.</p>\n\n<hr>\n\n<p>If your project is hosted on GitHub and uses Travis CI, you may also want to check out <a href=\"https://github.com/japaric/trust\" rel=\"nofollow noreferrer\"><code>trust</code></a>. It provides a pre-packaged solution for testing on many architectures including ARMv7 Linux on the CI (no Android unfortunately).</p>\n"}, {"tags": [], "owner": {"reputation": 3617, "user_id": 69326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30fa9f928422bef2f98dd5f564def686?s=128&d=identicon&r=PG", "display_name": "Ted Mielczarek", "link": "https://stackoverflow.com/users/69326/ted-mielczarek"}, "is_accepted": false, "score": 1, "last_activity_date": 1580247686, "last_edit_date": 1580247686, "creation_date": 1580247513, "answer_id": 59957416, "question_id": 44947640, "link": "https://stackoverflow.com/questions/44947640/how-can-i-run-cargo-tests-on-another-machine-without-the-rust-compiler/59957416#59957416", "title": "How can I run cargo tests on another machine without the Rust compiler?", "body": "<p>My recommendation for testing on Android would be to use <a href=\"https://github.com/snipsco/dinghy\" rel=\"nofollow noreferrer\"><code>dinghy</code></a> which provides nice wrapper commands for building and testing on Android/iOS devices/emulator/simulators.</p>\n"}, {"tags": [], "owner": {"reputation": 711, "user_id": 710667, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/42f919148729a0b17b747a9d2d0d1b65?s=128&d=identicon&r=PG", "display_name": "Alec Matusis", "link": "https://stackoverflow.com/users/710667/alec-matusis"}, "is_accepted": false, "score": 0, "last_activity_date": 1600409126, "creation_date": 1600409126, "answer_id": 63950162, "question_id": 44947640, "link": "https://stackoverflow.com/questions/44947640/how-can-i-run-cargo-tests-on-another-machine-without-the-rust-compiler/63950162#63950162", "title": "How can I run cargo tests on another machine without the Rust compiler?", "body": "<p>For whoever might still be interested in this:\nrun <code>cargo -v test</code> with <code>-v</code></p>\n<p>Then look for this output</p>\n<pre><code> Finished release [optimized] target(s) in 21.31s\n     Running `/my-dir/target/release/deps/my-binary-29b03924d05690f1`  \n</code></pre>\n<p>Then just copy the test binary <code>/my-dir/target/release/deps/my-binary-29b03924d05690f1</code> to the machine without rustc</p>\n"}], "owner": {"reputation": 7560, "user_id": 1034749, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2022f0caae119ed6232cf370bb9d9d3a?s=128&d=identicon&r=PG", "display_name": "fghj", "link": "https://stackoverflow.com/users/1034749/fghj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 853, "favorite_count": 1, "accepted_answer_id": 44953448, "answer_count": 3, "score": 5, "last_activity_date": 1600409126, "creation_date": 1499340558, "last_edit_date": 1499347872, "question_id": 44947640, "link": "https://stackoverflow.com/questions/44947640/how-can-i-run-cargo-tests-on-another-machine-without-the-rust-compiler", "title": "How can I run cargo tests on another machine without the Rust compiler?", "body": "<p>I know that the compiler can run directly on <code>arm-linux-androideabi</code>, but the Android emulator (I mean emulation of ARM on x86/amd64) is slow,\nso I don't want to use <code>cargo</code> and <code>rustc</code> on the emulator, I only want to run tests on it.</p>\n\n<p>I want to cross-compile tests on my PC (<code>cargo test --target=arm-linux-androideabi --no-run</code>?), and then upload and run them on emulator,\nhoping to catch bugs like <a href=\"https://github.com/rust-lang/rust/issues/42918\" rel=\"noreferrer\">this</a>.</p>\n\n<p>How can I run <code>cargo test</code> without running <code>cargo test</code>? Is it as simple as running all binaries that were built with <code>cargo test --no-run</code>?</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "is_accepted": false, "score": 1, "last_activity_date": 1557572718, "last_edit_date": 1557572718, "creation_date": 1499337586, "answer_id": 44946642, "question_id": 44946535, "link": "https://stackoverflow.com/questions/44946535/why-is-a-trait-needed-in-order-to-constrain-the-type-parameter/44946642#44946642", "title": "Why is a trait needed in order to constrain the type parameter?", "body": "<p>It's because you have the type parameter defined on the trait definition, not the struct definition. To get rid of the trait, you'll need to move <code>T</code> onto the struct itself:</p>\n\n<pre><code>#[derive(PartialEq, Eq, PartialOrd, Ord, Debug)]\nstruct Reliability&lt;T&gt; {\n    alpha: i8,\n}\n\nimpl&lt;T&gt; Reliability&lt;T&gt;\nwhere\n    f64: std::convert::From&lt;T&gt;,\n{\n    fn new(a: T) -&gt; Reliability&lt;T&gt; {\n        let mut a_f64 = f64::from(a);\n        a_f64 = if a_f64 &lt; -1f64 {\n            -1f64\n        } else if a_f64 &gt; 1f64 {\n            1f64\n        } else {\n            a_f64\n        };\n        Reliability {\n            alpha: (100f64 * a_f64) as i8,\n        }\n    }\n}\n\nfn main() {\n    println!(\"{:?}\", Reliability::new(-1));\n}\n</code></pre>\n\n<p>That said, this raises a different issue - <code>Reliability</code> doesn't actually use <code>T</code> anywhere in the definition or implementation, so it'll fall over with this error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0392]: parameter `T` is never used\n --&gt; src/main.rs:2:20\n  |\n2 | struct Reliability&lt;T&gt; {\n  |                    ^ unused type parameter\n  |\n  = help: consider removing `T` or using a marker such as `std::marker::PhantomData`\n</code></pre>\n\n<p>Your issue is that you're not trying to constrain the struct, you're just trying to constrain the method. In which case, it's much easier!</p>\n\n<pre><code>#[derive(PartialEq, Eq, PartialOrd, Ord, Debug)]\nstruct Reliability {\n    alpha: i8,\n}\n\nimpl Reliability {\n    fn new&lt;T&gt;(a: T) -&gt; Reliability\n    where\n        f64: std::convert::From&lt;T&gt;,\n    {\n        let mut a_f64 = f64::from(a);\n        a_f64 = if a_f64 &lt; -1f64 {\n            -1f64\n        } else if a_f64 &gt; 1f64 {\n            1f64\n        } else {\n            a_f64\n        };\n        Reliability {\n            alpha: (100f64 * a_f64) as i8,\n        }\n    }\n}\n\nfn main() {\n    println!(\"{:?}\", Reliability::new(-1));\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 695, "user_id": 1407530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/34d7caadb1601d6fec8f7065300a56ff?s=128&d=identicon&r=PG", "display_name": "Lars R&#246;nnb&#228;ck", "link": "https://stackoverflow.com/users/1407530/lars-r%c3%b6nnb%c3%a4ck"}, "edited": false, "score": 0, "creation_date": 1499338754, "post_id": 44946814, "comment_id": 76868951, "body": "Thanks, that certainly becomes more readable and gets rid of the trait. I suppose that also means Reliability to implement Into, which is a nice touch :)"}], "tags": [], "owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "is_accepted": true, "score": 3, "last_activity_date": 1499338040, "creation_date": 1499338040, "answer_id": 44946814, "question_id": 44946535, "link": "https://stackoverflow.com/questions/44946535/why-is-a-trait-needed-in-order-to-constrain-the-type-parameter/44946814#44946814", "title": "Why is a trait needed in order to constrain the type parameter?", "body": "<p>Just change the trait from <code>From</code> to <a href=\"https://doc.rust-lang.org/std/convert/trait.Into.html\" rel=\"nofollow noreferrer\"><code>Into</code></a> (because <code>From&lt;T&gt; for U</code> implies <code>Into&lt;U&gt; for T</code>) - the intention is much more clear:</p>\n\n<pre><code>#[derive(PartialEq, Eq, PartialOrd, Ord, Debug)]\nstruct Reliability {\n    alpha: i8,\n}\n\nimpl Reliability {\n    fn new&lt;T: Into&lt;f64&gt;&gt;(a: T) -&gt; Reliability { // &lt;T&gt; is only here\n        let mut a_f64: f64 = a.into(); // into() is used here\n        a_f64 = if a_f64 &lt; -1f64 {\n            -1f64\n        } else if a_f64 &gt; 1f64 {\n            1f64\n        } else {\n            a_f64\n        };\n        Reliability { alpha: (100f64 * a_f64) as i8 }\n    }\n}\n\nfn main() {\n    println!(\"{:?}\", Reliability::new(-1));\n}\n</code></pre>\n"}], "owner": {"reputation": 695, "user_id": 1407530, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/34d7caadb1601d6fec8f7065300a56ff?s=128&d=identicon&r=PG", "display_name": "Lars R&#246;nnb&#228;ck", "link": "https://stackoverflow.com/users/1407530/lars-r%c3%b6nnb%c3%a4ck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 44946814, "answer_count": 2, "score": 0, "last_activity_date": 1557572718, "creation_date": 1499337316, "last_edit_date": 1557572624, "question_id": 44946535, "link": "https://stackoverflow.com/questions/44946535/why-is-a-trait-needed-in-order-to-constrain-the-type-parameter", "title": "Why is a trait needed in order to constrain the type parameter?", "body": "<p>Why is the trait needed in the following code? The commented variant without a trait does not compile, even if it looks as if it has the same information available.</p>\n\n<pre><code>trait ReliabilityConstructor&lt;T&gt; {\n    fn new(a: T) -&gt; Reliability;\n}\n\n#[derive(PartialEq, Eq, PartialOrd, Ord, Debug)]\nstruct Reliability {\n    alpha: i8,\n}\n\n//impl&lt;T&gt; Reliability\nimpl&lt;T&gt; ReliabilityConstructor&lt;T&gt; for Reliability\nwhere\n    f64: std::convert::From&lt;T&gt;,\n{\n    fn new(a: T) -&gt; Reliability {\n        let mut a_f64 = f64::from(a);\n        a_f64 = if a_f64 &lt; -1f64 {\n            -1f64\n        } else if a_f64 &gt; 1f64 {\n            1f64\n        } else {\n            a_f64\n        };\n        Reliability {\n            alpha: (100f64 * a_f64) as i8,\n        }\n    }\n}\n\nfn main() {\n    println!(\"{:?}\", Reliability::new(-1));\n}\n</code></pre>\n\n<p>When the commented line is uncommented:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0207]: the type parameter `T` is not constrained by the impl trait, self type, or predicates\n  --&gt; src/main.rs:10:6\n   |\n10 | impl&lt;T&gt; Reliability\n   |      ^ unconstrained type parameter\n</code></pre>\n"}, {"tags": ["functional-programming", "rust", "closures"], "comments": [{"owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "edited": false, "score": 2, "creation_date": 1499327527, "post_id": 44942644, "comment_id": 76861323, "body": "&quot;warning: unused result which must be used: iterator adaptors are lazy and do nothing unless consumed&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "edited": false, "score": 0, "creation_date": 1499327268, "post_id": 44942769, "comment_id": 76861158, "body": "I did discover this by looking at the example the page has, and changed my question accordingly. but doing this does not print anything ?"}, {"owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "edited": false, "score": 0, "creation_date": 1499327464, "post_id": 44942769, "comment_id": 76861288, "body": "I see, thank you. I will mark this answer as correct and change the title to reflect the question more accurately"}], "tags": [], "owner": {"reputation": 1417, "user_id": 2977291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66afbccc6043392125ac0f0de57ccfa7?s=128&d=identicon&r=PG&f=1", "display_name": "paholg", "link": "https://stackoverflow.com/users/2977291/paholg"}, "is_accepted": true, "score": 2, "last_activity_date": 1499347504, "last_edit_date": 1499347504, "creation_date": 1499327217, "answer_id": 44942769, "question_id": 44942644, "link": "https://stackoverflow.com/questions/44942644/how-do-i-take-multiple-arguments-in-a-closure-and-print-them/44942769#44942769", "title": "How do I take multiple arguments in a closure and print them?", "body": "<p>Looking at the <a href=\"https://doc.rust-lang.org/std/env/fn.vars_os.html\" rel=\"nofollow noreferrer\">documentation for <code>vars_os()</code></a>, we see that it is an iterator over tuples, which have the syntax <code>(a, b)</code>. So, changing your code to</p>\n\n<pre><code>env::vars_os()\n    .map(|(k, v)| println!(\"k : {:?}, v : {:?} \\n\", k, v));\n</code></pre>\n\n<p>should do the trick.</p>\n\n<p>The syntax you are using would destructure into a struct, only you left out the struct's name, which would precede the curly braces.</p>\n\n<hr>\n\n<p>Iterators in Rust are lazily evaluated, which means none of the code in the <code>map</code> is executed until the iterator is consumed. You can do this by calling <code>collect()</code>. However, the idiomatic way to do it would be to put code that has side-effects (such as printing) in a <code>for</code> loop instead of a <code>map</code>:</p>\n\n<pre><code>for (k, v) in env::vars_os() {\n    println!(\"k : {:?}, v : {:?} \\n\", k, v);\n}\n</code></pre>\n"}], "owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 44942769, "answer_count": 1, "score": 1, "last_activity_date": 1499347504, "creation_date": 1499326895, "last_edit_date": 1499347414, "question_id": 44942644, "link": "https://stackoverflow.com/questions/44942644/how-do-i-take-multiple-arguments-in-a-closure-and-print-them", "title": "How do I take multiple arguments in a closure and print them?", "body": "<p>I have a call to <code>env::vars_os</code> and would like to print all of them in a functional manner:</p>\n\n<pre><code>env::vars_os()\n    .map(|(k, v)| println!(\"k : {:?}, v : {:?} \\n\", k, v));\n</code></pre>\n\n<p>This prints nothing, but the article <a href=\"http://pzol.github.io/getting_rusty/posts/20140417_destructuring_in_rust/\" rel=\"nofollow noreferrer\">Destructuring and Pattern Matching</a> indicates this should be possible.</p>\n"}, {"tags": ["optimization", "iterator", "copy", "rust", "slice"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1499330729, "post_id": 44939578, "comment_id": 76863360, "body": "Maybe you can just use plain, old <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.map\" rel=\"nofollow noreferrer\">map</a>?"}], "answers": [{"tags": [], "owner": {"reputation": 90851, "user_id": 27009, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f0a29af415477aa8c498a4f41ffe6640?s=128&d=identicon&r=PG", "display_name": "Kornel", "link": "https://stackoverflow.com/users/27009/kornel"}, "is_accepted": true, "score": 1, "last_activity_date": 1513907198, "creation_date": 1513907198, "answer_id": 47934926, "question_id": 44939578, "link": "https://stackoverflow.com/questions/44939578/what-is-the-best-way-to-fill-a-slice-from-an-iterator-in-rust/47934926#47934926", "title": "What is the best way to fill a slice from an iterator in Rust?", "body": "<p>Loops are OK and they generally optimize very well.</p>\n\n<p>Another solution may be to <code>collect()</code> into an <a href=\"https://crates.io/crates/arrayvec\" rel=\"nofollow noreferrer\"><code>ArrayVec</code></a>. It avoids having to fill the array with a default value first.</p>\n"}], "owner": {"reputation": 115, "user_id": 4236926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ae2265aeb462a8eda771aae131ace75?s=128&d=identicon&r=PG&f=1", "display_name": "Inityx", "link": "https://stackoverflow.com/users/4236926/inityx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2172, "favorite_count": 0, "closed_date": 1513911951, "accepted_answer_id": 47934926, "answer_count": 1, "score": 6, "last_activity_date": 1513907198, "creation_date": 1499313578, "last_edit_date": 1499750362, "question_id": 44939578, "link": "https://stackoverflow.com/questions/44939578/what-is-the-best-way-to-fill-a-slice-from-an-iterator-in-rust", "closed_reason": "Duplicate", "title": "What is the best way to fill a slice from an iterator in Rust?", "body": "<p>I'm implementing <code>FromIterator</code> for <code>[MyStruct;4]</code> where <code>MyStruct</code> is a small Copy struct. My current implementation is</p>\n\n<pre><code>fn from_iter&lt;I: IntoIterator&lt;Item=MyStruct&gt;&gt;(iter: I) -&gt; Self {\n    let mut retval = [Default::default();4];\n\n    for (ret, src) in retval.iter_mut().zip(iter) {\n        *ret = src;\n    }\n\n    retval\n}\n</code></pre>\n\n<p>This works just fine, however I'm not sure that the <code>for</code> loop is as idiomatic as it could be. Is there perhaps a method like <code>Slice::fill(iter)</code> that could accomplish this more cleanly (and perhaps more efficiently)?</p>\n"}]