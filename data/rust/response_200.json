[{"tags": ["rust", "gtk", "rsvg"], "answers": [{"tags": [], "owner": {"reputation": 4580, "user_id": 662618, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/485a36e2fb0e89238446e0789d7094a9?s=128&d=identicon&r=PG", "display_name": "loloof64", "link": "https://stackoverflow.com/users/662618/loloof64"}, "is_accepted": true, "score": 2, "last_activity_date": 1541624294, "creation_date": 1541624294, "answer_id": 53197709, "question_id": 53196677, "link": "https://stackoverflow.com/questions/53196677/how-do-i-set-up-an-icon-inside-relms-view-macro/53197709#53197709", "title": "How do I set up an icon inside Relm&#39;s view! macro?", "body": "<p>Finally I've managed :</p>\n\n<ul>\n<li>Making an handle from the svg file</li>\n<li>pass a reference to the result into the icon property.</li>\n</ul>\n\n<p>Which gives me :</p>\n\n<pre><code>extern crate gtk;\nextern crate chessground;\n#[macro_use]\nextern crate relm;\nextern crate relm_attributes;\n#[macro_use]\nextern crate relm_derive;\nextern crate shakmaty;\nextern crate rsvg;\n\nuse gtk::prelude::*;\nuse gtk::GtkWindowExt;\nuse relm::Widget;\nuse relm_attributes::widget;\n\nuse shakmaty::{Square, Board};\nuse chessground::{Ground, UserMove, SetBoard};\n\nuse rsvg::{Handle};\nuse rsvg::HandleExt;  \n\nuse self::Msg::*;\n\n#[derive(Msg)]\npub enum Msg {\n    Quit,\n    PieceMoved(Square, Square),\n}\n\n#[widget]\nimpl Widget for Win {\n    fn model() -&gt; Board {\n        Board::default()\n    }\n\n    fn update(&amp;mut self, event: Msg) {\n        match event {\n            Quit =&gt; gtk::main_quit(),\n            PieceMoved(orig, dest) =&gt; {\n                if let Some(piece) = self.model.remove_piece_at(orig) {\n                    self.model.set_piece_at(dest, piece, false);\n                    self.ground.emit(SetBoard(self.model.clone()));\n                }\n            }\n        }\n    }\n\n    view! {\n        gtk::Window {\n            title: \"Chessground\",\n            property_default_width: 600,\n            property_default_height: 600,\n            // HERE\n            icon: &amp;Handle::new_from_str(include_str!(\"wQ.svg\"))\n                .expect(\"Could not find icon !\")\n                .get_pixbuf()\n                .expect(\"No pixbuf for the icon !\"),\n            #[name=\"ground\"]\n            Ground {\n                UserMove(orig, dest, _) =&gt; PieceMoved(orig, dest),\n            },\n            delete_event(_, _) =&gt; (Quit, Inhibit(false)),\n        }\n    }\n}\n\nfn main() {\n    Win::run(()).expect(\"initialized gtk\");\n}\n</code></pre>\n"}], "owner": {"reputation": 4580, "user_id": 662618, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/485a36e2fb0e89238446e0789d7094a9?s=128&d=identicon&r=PG", "display_name": "loloof64", "link": "https://stackoverflow.com/users/662618/loloof64"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 53197709, "answer_count": 1, "score": 2, "last_activity_date": 1541624294, "creation_date": 1541619809, "last_edit_date": 1541622547, "question_id": 53196677, "link": "https://stackoverflow.com/questions/53196677/how-do-i-set-up-an-icon-inside-relms-view-macro", "title": "How do I set up an icon inside Relm&#39;s view! macro?", "body": "<p>I am using Rust stable 1.30 and Relm. I figured out how to set up the default window size, but don't know how to set up the icon, at least inside the view! macro.</p>\n\n<p>This is my main.rs</p>\n\n<pre><code>extern crate gtk;\nextern crate chessground;\n#[macro_use]\nextern crate relm;\nextern crate relm_attributes;\n#[macro_use]\nextern crate relm_derive;\nextern crate shakmaty;\nextern crate rsvg;\n\nuse gtk::prelude::*;\nuse gtk::GtkWindowExt;\nuse relm::Widget;\nuse relm_attributes::widget;\n\nuse shakmaty::{Square, Board};\nuse chessground::{Ground, UserMove, SetBoard};\n\nuse rsvg::{Handle};\n\nuse self::Msg::*;\n\n#[derive(Msg)]\npub enum Msg {\n    Quit,\n    PieceMoved(Square, Square),\n}\n\n#[widget]\nimpl Widget for Win {\n    fn model() -&gt; Board {\n        Board::default()\n    }\n\n    fn update(&amp;mut self, event: Msg) {\n        match event {\n            Quit =&gt; gtk::main_quit(),\n            PieceMoved(orig, dest) =&gt; {\n                if let Some(piece) = self.model.remove_piece_at(orig)     {\n                    self.model.set_piece_at(dest, piece, false);\n                    self.ground.emit(SetBoard(self.model.clone()));\n                }\n            }\n        }\n    }\n\n    view! {\n        gtk::Window {\n            title: \"Chessground\",\n            property_default_width: 600,\n            property_default_height: 600,\n            #[name=\"ground\"]\n            Ground {\n                UserMove(orig, dest, _) =&gt; PieceMoved(orig, dest),\n            },\n            delete_event(_, _) =&gt; (Quit, Inhibit(false)),\n        }\n    }\n}\n\nfn main() {\n    let icon = Handle::new_from_str(include_str!(\"wQ.svg\")).expect(\"Could not find icon !\");\n    // how to set up the given icon ?\n    Win::run(()).expect(\"initialized gtk\");\n}\n</code></pre>\n\n<p>I mean, how to set up the icon defined in main to the window as its icon ?\nNotice that the icon has been instantiated with rsvg crate.</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 6137, "user_id": 847382, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b73e2fff665c33621c8a4347cf8074be?s=128&d=identicon&r=PG", "display_name": "PitaJ", "link": "https://stackoverflow.com/users/847382/pitaj"}, "edited": false, "score": 1, "creation_date": 1541614010, "post_id": 53194386, "comment_id": 93279200, "body": "When you implement <code>From</code>, I&#39;m pretty sure you get <code>Into</code> for free, btw. So you can do <code>let tuple: (i32, String) = example.into();</code>. This is often nice because you can take advantage of type hinting."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 11, "last_activity_date": 1541614479, "last_edit_date": 1541614479, "creation_date": 1541610468, "answer_id": 53194386, "question_id": 53194323, "link": "https://stackoverflow.com/questions/53194323/is-there-any-way-of-converting-a-struct-to-a-tuple/53194386#53194386", "title": "Is there any way of converting a struct to a tuple?", "body": "<blockquote>\n  <p>Is there any way of converting a struct to a tuple</p>\n</blockquote>\n\n<p>Yes.</p>\n\n<blockquote>\n  <p>any built-in method or any trait I can implement</p>\n</blockquote>\n\n<p>Not really.</p>\n\n<hr>\n\n<p>I'd implement <a href=\"https://doc.rust-lang.org/std/convert/trait.From.html\" rel=\"noreferrer\"><code>From</code></a>, which is very generic:</p>\n\n<pre><code>impl From&lt;Example&gt; for (i32, String) {\n    fn from(e: Example) -&gt; (i32, String) {\n        let Example { a, b } = e;\n        (a, b)\n    }\n}\n</code></pre>\n\n<p>You'd use it like this:</p>\n\n<pre><code>let tuple = &lt;(i32, String)&gt;::from(example);\n</code></pre>\n\n\n\n<pre><code>let tuple: (i32, String) = example.into();\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/29812530/155423\">When should I implement std::convert::From vs std::convert::Into?</a></li>\n</ul>\n"}], "owner": {"reputation": 331, "user_id": 607523, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c5db78fbfddbb2ddf9a429338e9c0580?s=128&d=identicon&r=PG", "display_name": "edrevo", "link": "https://stackoverflow.com/users/607523/edrevo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 714, "favorite_count": 1, "accepted_answer_id": 53194386, "answer_count": 1, "score": 2, "last_activity_date": 1541614479, "creation_date": 1541610213, "last_edit_date": 1541610446, "question_id": 53194323, "link": "https://stackoverflow.com/questions/53194323/is-there-any-way-of-converting-a-struct-to-a-tuple", "title": "Is there any way of converting a struct to a tuple?", "body": "<p>Given something like this:</p>\n\n<pre><code>struct Example {\n    a: i32,\n    b: String,\n}\n</code></pre>\n\n<p>Is there any built-in method or any trait I can implement that will allow me to obtain a tuple of <code>(i32, String)</code>?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 4, "creation_date": 1541605237, "post_id": 53192693, "comment_id": 93274508, "body": "<code>let flatten = vv.iter().flatten().cloned().collect::&lt;Vec&lt;_&gt;&gt;();</code> or <code>let flatten = vv.into_iter().flatten().collect::&lt;Vec&lt;_&gt;&gt;();</code>."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1541605396, "post_id": 53192693, "comment_id": 93274610, "body": "You&#39;re not using vectors but arrays that cannot be consumed by value."}, {"owner": {"reputation": 1782, "user_id": 364228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84e813a638643c9916fdfa703f80c624?s=128&d=identicon&r=PG", "display_name": "avdyushin", "link": "https://stackoverflow.com/users/364228/avdyushin"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1541666396, "post_id": 53192693, "comment_id": 93296221, "body": "@Boiethios even is I use <code>let vv = vec![vec![v1], vec![v2]]</code> I have the same errors."}, {"owner": {"reputation": 1782, "user_id": 364228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84e813a638643c9916fdfa703f80c624?s=128&d=identicon&r=PG", "display_name": "avdyushin", "link": "https://stackoverflow.com/users/364228/avdyushin"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541666481, "post_id": 53192693, "comment_id": 93296268, "body": "@Stargateur thanks! You solution is works, but it&#39;s not clear to my, why for example <code>let flatten = vv.into_iter().flatten().collect::&lt;Vec&lt;Vesrse&gt;&gt;();</code> doesn&#39;t work, but <code>Vec&lt;_&gt;</code> works..."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1541666495, "post_id": 53192693, "comment_id": 93296280, "body": "@avdyushin Yes because you didn&#39;t read the answer of the question marked as duplicate"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1541666907, "post_id": 53192693, "comment_id": 93296491, "body": "@avdyushin Rust is complex language, myself I still haven&#39;t learn all, you can&#39;t expect that I can explain you all in a comment. You can&#39;t because compiler will not transform reference <code>&amp;Verse</code> to <code>Verse</code> for you in this case. So you again need to use <code>cloned()</code> like <code>let flatten = vv.into_iter().flatten().cloned().collect::&lt;Vec&lt;Verse&gt;&gt;();</code> (that if you <b>want</b> <code>Verse</code> value and not just reference). But generally avoid copy/clone when it&#39;s not necessary. Sorry, my first comment was confusing. The first line produce <code>Verse</code> type the second produce <code>&amp;Verse</code> type."}, {"owner": {"reputation": 1782, "user_id": 364228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84e813a638643c9916fdfa703f80c624?s=128&d=identicon&r=PG", "display_name": "avdyushin", "link": "https://stackoverflow.com/users/364228/avdyushin"}, "edited": false, "score": 0, "creation_date": 1541667322, "post_id": 53192693, "comment_id": 93296683, "body": "Thanks you guys, I was confused with value/reference types. Now it&#39;s clear to me"}], "owner": {"reputation": 1782, "user_id": 364228, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84e813a638643c9916fdfa703f80c624?s=128&d=identicon&r=PG", "display_name": "avdyushin", "link": "https://stackoverflow.com/users/364228/avdyushin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 662, "favorite_count": 1, "closed_date": 1541666331, "answer_count": 0, "score": 2, "last_activity_date": 1541605167, "creation_date": 1541604949, "last_edit_date": 1541605167, "question_id": 53192693, "link": "https://stackoverflow.com/questions/53192693/flatten-vec-of-vecs-of-custom-structs-in-rust", "closed_reason": "Duplicate", "title": "Flatten vec of vecs of custom structs in Rust", "body": "<p>I have a custom struct and after some processing I have a vector contains vectors of this structs. But I'm stuck in getting flat vector of structs only.</p>\n\n<pre><code>#[derive(Debug, Clone, Hash, Eq, PartialEq)]\npub struct Verse {\n    pub book_id: i16,\n    pub chapter: i16,\n    pub verse: i16,\n    pub text: String,\n}\n\nfn main() {\n    let v1 = Verse {\n        book_id: 1,\n        chapter: 1,\n        verse: 1,\n        text: String::from(\"a\"),\n    };\n    let v2 = Verse {\n        book_id: 2,\n        chapter: 1,\n        verse: 1,\n        text: String::from(\"b\"),\n    };\n    let vv = [[v1], [v2]];\n    let flatten = vv.iter().flatten().collect::&lt;Vec&lt;Verse&gt;&gt;();\n}\n</code></pre>\n\n<p>And error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: a collection of type `std::vec::Vec&lt;Verse&gt;` cannot be built from an iterator over elements of type `&amp;Verse`\n  --&gt; src/main.rs:23:39\n   |\n23 |     let flatten = vv.iter().flatten().collect::&lt;Vec&lt;Verse&gt;&gt;();\n   |                                       ^^^^^^^ a collection of type `std::vec::Vec&lt;Verse&gt;` cannot be built from `std::iter::Iterator&lt;Item=&amp;Verse&gt;`\n   |\n   = help: the trait `std::iter::FromIterator&lt;&amp;Verse&gt;` is not implemented for `std::vec::Vec&lt;Verse&gt;``std::vec::Vec&lt;Verse&gt;`\n</code></pre>\n\n<p>But I can't find any examples how to come up with solution.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 2, "creation_date": 1541574290, "post_id": 53183198, "comment_id": 93259110, "body": "See also <a href=\"https://github.com/rust-lang/rust/issues/55584\" rel=\"nofollow noreferrer\">github.com/rust-lang/rust/issues/55584</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3218, "user_id": 3440266, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/9d37ddb4e007bfd22023d6d5b95f0a45?s=128&d=identicon&r=PG&f=1", "display_name": "macabeus", "link": "https://stackoverflow.com/users/3440266/macabeus"}, "edited": false, "score": 0, "creation_date": 1541589807, "post_id": 53184150, "comment_id": 93266016, "body": "In my case, is bad implementing <code>Debug</code> myself, because I have many cases at enum, I&#39;ll looking for another solution. Thank you for the answer."}, {"owner": {"reputation": 3218, "user_id": 3440266, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/9d37ddb4e007bfd22023d6d5b95f0a45?s=128&d=identicon&r=PG&f=1", "display_name": "macabeus", "link": "https://stackoverflow.com/users/3440266/macabeus"}, "edited": false, "score": 2, "creation_date": 1541589825, "post_id": 53184150, "comment_id": 93266026, "body": "I just opened an issue at rust-lang: <a href=\"https://github.com/rust-lang/rust/issues/55749\" rel=\"nofollow noreferrer\">github.com/rust-lang/rust/issues/55749</a>"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 3218, "user_id": 3440266, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/9d37ddb4e007bfd22023d6d5b95f0a45?s=128&d=identicon&r=PG&f=1", "display_name": "macabeus", "link": "https://stackoverflow.com/users/3440266/macabeus"}, "edited": false, "score": 1, "creation_date": 1541598309, "post_id": 53184150, "comment_id": 93270142, "body": "@Macabeus The easiest work-around is to use <code>println!(&quot;[{:&lt;3}]&quot;, format!(&quot;{:?}&quot;, value))</code>."}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 6, "last_activity_date": 1541569543, "creation_date": 1541569543, "answer_id": 53184150, "question_id": 53183198, "link": "https://stackoverflow.com/questions/53183198/why-debug-print-does-not-formatted-an-enum-as-expected/53184150#53184150", "title": "Why debug print does not formatted an enum as expected?", "body": "<p>This is not the behavior implemented when deriving <code>Debug</code> for an <code>enum</code> as you can see with:</p>\n\n<pre><code>#[derive(Debug)]\nenum MyEnum {\n    AB(i32),\n}\n\nfn main() {\n    let value = MyEnum::AB(42);\n    println!(\"[{:&lt;3?}]\", value);\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[AB(42 )]\n</code></pre>\n\n<p>I think you need to implement <code>Debug</code> yourself:</p>\n\n<pre><code>enum MyEnum {\n    AB,\n}\n\nuse std::fmt;\n\nimpl fmt::Debug for MyEnum {\n    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {\n        match self {\n            MyEnum::AB =&gt; f.pad(\"AB\"),\n        }\n    }\n}\n\nfn main() {\n    let value = MyEnum::AB;\n    println!(\"[{:&lt;3?}]\", value);\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[AB ]\n</code></pre>\n"}], "owner": {"reputation": 3218, "user_id": 3440266, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/9d37ddb4e007bfd22023d6d5b95f0a45?s=128&d=identicon&r=PG&f=1", "display_name": "macabeus", "link": "https://stackoverflow.com/users/3440266/macabeus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 53184150, "answer_count": 1, "score": 3, "last_activity_date": 1541569543, "creation_date": 1541561239, "question_id": 53183198, "link": "https://stackoverflow.com/questions/53183198/why-debug-print-does-not-formatted-an-enum-as-expected", "title": "Why debug print does not formatted an enum as expected?", "body": "<p>I need to print as debug a value from enum and format it. Then, I wrote this code like this:</p>\n\n<pre><code>#[derive(Debug)]\nenum MyEnum {\n    AB,\n}\n\nfn main() {\n    let value = MyEnum::AB;\n    println!(\"[{: &lt;3?}]\", value);\n}\n</code></pre>\n\n<p>But, the result is <code>[AB]</code> while I expected that the result is <code>[AB ]</code>. Why? How to add paddings in a debug print?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1541561007, "post_id": 53183070, "comment_id": 93256333, "body": "Are you looking for an array or <code>Vec</code> of <code>u8</code> values, or are there operations you&#39;re looking for on a byte sequence that you&#39;d want a byte-specific type to support?"}, {"owner": {"reputation": 5800, "user_id": 6163736, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/TKHBG.jpg?s=128&g=1", "display_name": "stacksonstacks", "link": "https://stackoverflow.com/users/6163736/stacksonstacks"}, "reply_to_user": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1541561116, "post_id": 53183070, "comment_id": 93256356, "body": "<code>Vec&lt;u8&gt;</code> maybe what I&#39;m after, looking to do some simple send/receive of data over a network connection"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541569961, "post_id": 53183070, "comment_id": 93257957, "body": "A byte in rust is by definition an <code>u8</code>"}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 0, "creation_date": 1541578589, "post_id": 53183070, "comment_id": 93260710, "body": "Also take a look at the <a href=\"https://crates.io/crates/bytes\" rel=\"nofollow noreferrer\">bytes crate</a>."}], "answers": [{"tags": [], "owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "is_accepted": true, "score": 6, "last_activity_date": 1541562960, "last_edit_date": 1541562960, "creation_date": 1541562204, "answer_id": 53183294, "question_id": 53183070, "link": "https://stackoverflow.com/questions/53183070/what-is-the-defacto-bytes-type-in-rust/53183294#53183294", "title": "What is the defacto bytes type in rust?", "body": "<p>Often the best place to start is related Rust documentation. You mention reading data from a network connection, so let's look at <a href=\"https://doc.rust-lang.org/std/net/struct.TcpStream.html\" rel=\"noreferrer\"><code>TcpStream</code></a>. It implements the <a href=\"https://doc.rust-lang.org/std/io/trait.Read.html\" rel=\"noreferrer\"><code>Read</code></a> trait's <a href=\"https://doc.rust-lang.org/std/io/trait.Read.html#tymethod.read\" rel=\"noreferrer\"><code>read</code> method</a>, which has the type</p>\n\n<blockquote>\n<pre><code>fn read(&amp;mut self, buf: &amp;mut [u8]) -&gt; Result&lt;usize&gt;\n</code></pre>\n</blockquote>\n\n<p>which should make it relatively clear what you might expect. <code>&amp;mut [u8]</code> is a mutable reference for a Rust <a href=\"https://doc.rust-lang.org/std/primitive.slice.html\" rel=\"noreferrer\">slice</a> where the underlying data is of type <a href=\"https://doc.rust-lang.org/std/primitive.u8.html\" rel=\"noreferrer\"><code>u8</code></a>. Where specifically that <code>u8</code> slice comes from is up to you as the caller. It could be from an <a href=\"https://doc.rust-lang.org/std/primitive.array.html\" rel=\"noreferrer\">array</a> or <a href=\"https://doc.rust-lang.org/std/vec/struct.Vec.html\" rel=\"noreferrer\"><code>Vec</code></a> depending on your requirements for dynamic sizing, or any other type that supports it.</p>\n"}], "owner": {"reputation": 5800, "user_id": 6163736, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/TKHBG.jpg?s=128&g=1", "display_name": "stacksonstacks", "link": "https://stackoverflow.com/users/6163736/stacksonstacks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 0, "accepted_answer_id": 53183294, "answer_count": 1, "score": 0, "last_activity_date": 1541562960, "creation_date": 1541559991, "question_id": 53183070, "link": "https://stackoverflow.com/questions/53183070/what-is-the-defacto-bytes-type-in-rust", "title": "What is the defacto bytes type in rust?", "body": "<p>What is the defacto \"bytes\" type in rust? Say I have serialized some object what would be the expected type</p>\n\n<p>In python there's <code>bytes</code> and in golang there's <code>[]byte</code>. What is rust's equivalent?</p>\n\n<p>Seems really simple but I guess I'm expressing this concept wrong, as I haven't found anything in searches</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 6200447, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/oPlvp.gif?s=128&g=1", "display_name": "PP Laru", "link": "https://stackoverflow.com/users/6200447/pp-laru"}, "edited": false, "score": 0, "creation_date": 1541562143, "post_id": 53183236, "comment_id": 93256539, "body": "Oh thanks! The textbook has yet to teach me about clear. I guess that&#39;s what I get for experimentation. Why would moving the declaration like that be better though?"}, {"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "reply_to_user": {"reputation": 81, "user_id": 6200447, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/oPlvp.gif?s=128&g=1", "display_name": "PP Laru", "link": "https://stackoverflow.com/users/6200447/pp-laru"}, "edited": false, "score": 0, "creation_date": 1541562285, "post_id": 53183236, "comment_id": 93256564, "body": "@awallace04 Moving the <code>String::new();</code> inside the loop means that you create a new string every time the <code>&#39;play_again</code> loop restarts. Your current code never creates a new string, so <code>read_line</code> will just keep adding on to the end of the <code>String</code>."}, {"owner": {"reputation": 81, "user_id": 6200447, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/oPlvp.gif?s=128&g=1", "display_name": "PP Laru", "link": "https://stackoverflow.com/users/6200447/pp-laru"}, "edited": false, "score": 0, "creation_date": 1541563733, "post_id": 53183236, "comment_id": 93256826, "body": "oh I understand that, I mean what makes moving <code>String::new();</code> into the loop better than just calling <code>clear()</code>?"}, {"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "reply_to_user": {"reputation": 81, "user_id": 6200447, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/oPlvp.gif?s=128&g=1", "display_name": "PP Laru", "link": "https://stackoverflow.com/users/6200447/pp-laru"}, "edited": false, "score": 2, "creation_date": 1541564408, "post_id": 53183236, "comment_id": 93256948, "body": "It&#39;s different tradeoffs. Code is generally easier to read when all the pieces for a particular operation are localized to a small area, which is why I&#39;d favor moving the declaration. <code>.clear</code> would be beneficial if performance were a concern and you wanted to avoid reallocating the string on every iteration, but that is absolutely unimportant here."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541570223, "post_id": 53183236, "comment_id": 93258012, "body": "&quot; better would be to move the declaration to&quot; in this context better is very opinion oriented, unless you move the string somewhere <code>clear</code> is much more idiomatic when you just want to discard and reuse the buffer. So &quot;better&quot; is a bit wrong here."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541601600, "post_id": 53183236, "comment_id": 93272025, "body": "@Stargateur On the other hand, it&#39;s also idiomatic (and just a good idea in general) to minimize the scope of all variables, precisely to avoid accidental reuse (of which this is an example)."}, {"owner": {"reputation": 81, "user_id": 6200447, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/oPlvp.gif?s=128&g=1", "display_name": "PP Laru", "link": "https://stackoverflow.com/users/6200447/pp-laru"}, "edited": false, "score": 0, "creation_date": 1541625532, "post_id": 53183236, "comment_id": 93284529, "body": "Thanks both of you!"}, {"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "reply_to_user": {"reputation": 81, "user_id": 6200447, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/oPlvp.gif?s=128&g=1", "display_name": "PP Laru", "link": "https://stackoverflow.com/users/6200447/pp-laru"}, "edited": false, "score": 1, "creation_date": 1541637755, "post_id": 53183236, "comment_id": 93288485, "body": "@awallace04 Please mark the question as answered if you&#39;re satisfied."}], "tags": [], "owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "is_accepted": true, "score": 2, "last_activity_date": 1541605905, "last_edit_date": 1541605905, "creation_date": 1541561627, "answer_id": 53183236, "question_id": 53182656, "link": "https://stackoverflow.com/questions/53182656/extension-on-the-rust-textbooks-guessing-game-is-showing-odd-behavior/53183236#53183236", "title": "Extension on the rust textbook&#39;s guessing game is showing odd behavior", "body": "<p>The issue is that you never clear <code>yae_or_nay</code>, and <a href=\"https://doc.rust-lang.org/std/io/struct.Stdin.html#method.read_line\" rel=\"nofollow noreferrer\"><code>io::stdin().read_line(&amp;mut yae_or_nay)</code></a> will <a href=\"https://doc.rust-lang.org/std/io/trait.BufRead.html#method.read_line\" rel=\"nofollow noreferrer\"><em>append</em></a> to the string, not replace its content.</p>\n\n<blockquote>\n  <p>Read all bytes until a newline (the 0xA byte) is reached, and append them to the provided buffer.</p>\n</blockquote>\n\n<p>Either you should do</p>\n\n<pre><code>yae_or_nay.clear();\n</code></pre>\n\n<p>before you read into it, or likely better would be to move the declaration to</p>\n\n<pre><code>'play_again: loop {\n    let mut yae_or_nay = String::new();\n    io::stdin().read_line(&amp;mut yae_or_nay)\n        .expect(\"Failed to read line.\");\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 6200447, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/oPlvp.gif?s=128&g=1", "display_name": "PP Laru", "link": "https://stackoverflow.com/users/6200447/pp-laru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 53183236, "answer_count": 1, "score": 0, "last_activity_date": 1541605905, "creation_date": 1541555671, "question_id": 53182656, "link": "https://stackoverflow.com/questions/53182656/extension-on-the-rust-textbooks-guessing-game-is-showing-odd-behavior", "title": "Extension on the rust textbook&#39;s guessing game is showing odd behavior", "body": "<p>So I'm extending the guessing game to basically ask the user if they want to play again. If they type <code>y</code>, the program will return to the main game loop and if they type <code>n</code>, it just breaks out of the current loop and the program ends. If they type anything else, in theory it should just jump to the top of the <code>play_again</code> loop and reassign the <code>yae_or_nay</code> variable as whatever the player inputs next. But it doesn't do that, or at least it looks like it overwrites it incorrectly. Am I reassigning the variable incorrectly? Heres the code (note that the first half of the program is almost the same as in the textbook, but since the program is so short I just decided to include the whole thing): </p>\n\n<pre><code>extern crate rand;\n\nuse std::io;\nuse std::cmp::Ordering;\nuse rand::Rng; // random number generation library from rand \n\nfn main() {\nprintln!(\"Guessing game!\\n\");\n\nlet mut answer = rand::thread_rng().gen_range(1,101); \n'gameloop: loop {\n    println!(\"Please print your guess:\");\n\n    let mut yae_or_nay = String::new();\n    let mut guess = String::new();\n\n    io::stdin().read_line(&amp;mut guess)\n        .expect(\"Failed to read line\");\n\n    let guess : u32 = match guess.trim().parse() {\n        Ok(num) =&gt; num,\n        Err(_) =&gt; {\n            println!(\"Not a number!\");\n            continue;\n        }\n    };\n\n    match guess.cmp(&amp;answer) {\n        Ordering::Less =&gt; println!(\"Higher!\"),\n        Ordering::Greater =&gt; println!(\"Lower!\"),\n        Ordering::Equal =&gt; {\n            println!(\"Correct! Would you like to play again? (y/n)\");\n            'play_again: loop {\n                io::stdin().read_line(&amp;mut yae_or_nay)\n                    .expect(\"Failed to read line.\");\n\n                match yae_or_nay.trim() { // match against a string\n                    \"y\" =&gt; {\n                        answer = rand::thread_rng().gen_range(1,101);\n                        println!(\"Playing again...\");\n                        continue 'gameloop;\n                    },\n                    \"n\" =&gt; {\n                        println!(\"Thanks for playing! Exiting now.\");\n                        break\n                    },\n                    _ =&gt; {\n                        println!(\"what? You entered {}\", &amp;yae_or_nay);\n                        continue 'play_again\n                    }\n                };\n            }\n        }\n    }\n}\n}\n</code></pre>\n\n<p>And here's a snippet of the console output: </p>\n\n<pre><code>46\nCorrect! Would you like to play again? (y/n)\ni\nwhat? You entered i\n\ny\nwhat? You entered i\ny\n\nn\nwhat? You entered i\ny\nn\n\n . // period here for formatting sake, not actually in console\n</code></pre>\n\n<p>As you can see, the way my program is reassigning <code>yae_or_nay</code> seems pretty strange. Anyone know what's going on? Thanks in advance for any help.</p>\n"}, {"tags": ["rust", "rust-actix"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 6, "last_activity_date": 1541553663, "creation_date": 1541553663, "answer_id": 53182455, "question_id": 53182250, "link": "https://stackoverflow.com/questions/53182250/whats-the-easiest-way-to-get-the-html-output-of-an-actix-web-endpoint-handler-t/53182455#53182455", "title": "What&#39;s the easiest way to get the HTML output of an actix-web endpoint handler to be rendered properly?", "body": "<p>From the <a href=\"https://github.com/actix/examples/blob/e30915d98d8b9e44b0f27ad361c5f2af14bb02b2/basics/src/main.rs\" rel=\"noreferrer\">actix-web examples</a>, use <a href=\"https://docs.rs/actix-web/0.7.13/actix_web/struct.HttpResponse.html\" rel=\"noreferrer\"><code>HttpResponse</code></a>:</p>\n\n<pre><code>fn welcome(req: &amp;HttpRequest) -&gt; Result&lt;HttpResponse&gt; {\n    println!(\"{:?}\", req);\n\n    // session\n    let mut counter = 1;\n    if let Some(count) = req.session().get::&lt;i32&gt;(\"counter\")? {\n        println!(\"SESSION value: {}\", count);\n        counter = count + 1;\n    }\n\n    // set counter to session\n    req.session().set(\"counter\", counter)?;\n\n    // response\n    Ok(HttpResponse::build(StatusCode::OK)\n        .content_type(\"text/html; charset=utf-8\")\n        .body(include_str!(\"../static/welcome.html\")))\n}\n</code></pre>\n"}], "owner": {"reputation": 444, "user_id": 3422156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/29af89a0e8be5cf63546304d02c8e2fb?s=128&d=identicon&r=PG&f=1", "display_name": "spease", "link": "https://stackoverflow.com/users/3422156/spease"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1311, "favorite_count": 1, "accepted_answer_id": 53182455, "answer_count": 1, "score": 5, "last_activity_date": 1541553663, "creation_date": 1541551862, "last_edit_date": 1541553470, "question_id": 53182250, "link": "https://stackoverflow.com/questions/53182250/whats-the-easiest-way-to-get-the-html-output-of-an-actix-web-endpoint-handler-t", "title": "What&#39;s the easiest way to get the HTML output of an actix-web endpoint handler to be rendered properly?", "body": "<p>I've defined an endpoint with actix-web like so:</p>\n\n<pre><code>#[derive(Deserialize)]\nstruct RenderInfo {\n    filename: String,\n}\n\nfn render(info: actix_web::Path&lt;RenderInfo&gt;) -&gt; Result&lt;String&gt; {\n    // ...\n}\n</code></pre>\n\n\n\n<pre><code>App::new()\n    .middleware(middleware::Logger::Default())\n    .resource(\"/{filename}\", |r| r.get().with(render))\n</code></pre>\n\n<p>The problem I've run into is that the raw HTML gets displayed in the browser rather than being rendered. I assume the content-type is not being set properly.</p>\n\n<p>Most of the actix-web examples I saw used <code>impl Responder</code> for the return type, but I wasn't able to figure out how to fix the type inference issues that created. The reason seems to have something to do with file operations returning a standard <code>failure::Error</code>-based type. It looks like actix_web requires implementation of a special <code>WebError</code> to block unintended propagation of errors. For this particular instance, I don't really care, because it's more of an internal tool.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541544719, "post_id": 53181276, "comment_id": 93252723, "body": "The code you have posted is not syntactically valid Rust code."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541544909, "post_id": 53181276, "comment_id": 93252806, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/41794800/155423\">Why is the bound <code>T: &#39;a</code> required in order to store a reference <code>&amp;&#39;a T</code>?</a>; <a href=\"https://stackoverflow.com/q/40053550/155423\">The compiler suggests I add a &#39;static lifetime because the parameter type may not live long enough, but I don&#39;t think that&#39;s what I want</a>. If you disagree, please <a href=\"https://stackoverflow.com/posts/53181276/edit\">edit</a> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541544970, "post_id": 53181276, "comment_id": 93252826, "body": "See also <a href=\"https://stackoverflow.com/q/32625583/155423\">Parameter type may not live long enough</a>; <a href=\"https://stackoverflow.com/q/29740488/155423\">Parameter type may not live long enough?</a>; <a href=\"https://stackoverflow.com/q/25959075/155423\">Why \u201cexplicit lifetime bound required\u201d for Box&lt;T&gt; in struct?</a>; and basically any other question that mentions your error message."}, {"owner": {"reputation": 1896, "user_id": 791025, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/66a1d3b208aad4b7381b384fe2fa0756?s=128&d=identicon&r=PG", "display_name": "AdmiralJonB", "link": "https://stackoverflow.com/users/791025/admiraljonb"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541571178, "post_id": 53181276, "comment_id": 93258262, "body": "Yes, I know it&#39;s not syntactically valid, otherwise I wouldn&#39;t have posted the error message when trying to compile. Your edited question title is exactly what I was asking for; however, I&#39;ve put in additional details."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1541574441, "post_id": 53181276, "comment_id": 93259167, "body": "<i>&#39;-- help: consider adding an explicit lifetime bound T: &#39;a...&#39;</i>"}, {"owner": {"reputation": 1896, "user_id": 791025, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/66a1d3b208aad4b7381b384fe2fa0756?s=128&d=identicon&r=PG", "display_name": "AdmiralJonB", "link": "https://stackoverflow.com/users/791025/admiraljonb"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1541574554, "post_id": 53181276, "comment_id": 93259209, "body": "@hellow yes, the question is how to do that and keep the trait as well."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1541574755, "post_id": 53181276, "comment_id": 93259278, "body": "Ah, I see! <a href=\"https://stackoverflow.com/questions/29740488/parameter-type-may-not-live-long-enough\" title=\"parameter type may not live long enough\">stackoverflow.com/questions/29740488/&hellip;</a> Should give you the information"}], "answers": [{"tags": [], "owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "is_accepted": true, "score": 3, "last_activity_date": 1541577286, "creation_date": 1541577286, "answer_id": 53185398, "question_id": 53181276, "link": "https://stackoverflow.com/questions/53181276/is-it-possible-to-have-a-struct-definition-with-a-generic-where-a-type-is-both-a/53185398#53185398", "title": "Is it possible to have a struct definition with a generic where a type is both a type of trait and with a lifetime?", "body": "<blockquote>\n  <p>Ultimately, how can I specify that a generic type both follow a trait and have a lifetime?</p>\n</blockquote>\n\n<p>The same way you'd specify multiple traits: add them with <code>+</code>. I.e. <code>T : MyTrait + 'a</code></p>\n"}], "owner": {"reputation": 1896, "user_id": 791025, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/66a1d3b208aad4b7381b384fe2fa0756?s=128&d=identicon&r=PG", "display_name": "AdmiralJonB", "link": "https://stackoverflow.com/users/791025/admiraljonb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 53185398, "answer_count": 1, "score": -3, "last_activity_date": 1541577286, "creation_date": 1541544542, "last_edit_date": 1592644375, "question_id": 53181276, "link": "https://stackoverflow.com/questions/53181276/is-it-possible-to-have-a-struct-definition-with-a-generic-where-a-type-is-both-a", "title": "Is it possible to have a struct definition with a generic where a type is both a type of trait and with a lifetime?", "body": "<p>Edit: Question as the title modified by Shepmaster. Added more details to the situation.</p>\n<p>I'm wanting to have access to an object following a trait in different threads, stored overall in a struct. As I'm porting my code from another language to try to learn rust, I'm still a bit of a newbie to the language.</p>\n<p>Originally I thought to have a struct similar to the following, which compiled fine:</p>\n<pre><code>struct MyStruct&lt;T : MyTrait&gt; {\n    my_object : Arc&lt;Mutex&lt;T&gt;&gt;\n}\n</code></pre>\n<p>However, ultimately I need to store a reference to to it as it will be stored in multiple threads. I understand I need to use lifetimes as well to get this to work, so I ended up with the following:</p>\n<pre><code>struct MyStruct&lt;'a, T : MyTrait&gt; {\n    my_object : &amp;' Arc&lt;Mutex&lt;T&gt;&gt;\n}\n</code></pre>\n<p>The error I get is:</p>\n<blockquote>\n<p>error[E0309]: the parameter type <code>T</code> may not live long enough</p>\n<p>-- help: consider adding an explicit lifetime bound <code>T: 'a</code>...</p>\n<p>...so that the reference type <code>&amp;'a std::sync::Arc&lt;std::sync::Mutex&lt;T&gt;&gt;</code> does not outlive the data it points at</p>\n<p>my_object : &amp;' Arc&lt; Mutex &lt; T &gt; &gt;</p>\n</blockquote>\n<p>The error implies that I have to specify the lifetime to my generic, however, I already have a trait for my type. So Ultimately, how can I specify that a generic type both follow a trait and have a lifetime?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 2, "creation_date": 1541544079, "post_id": 53181050, "comment_id": 93252457, "body": "It&#39;s rather difficult to accidentally leak memory in safe Rust code.  This particular case is definitely fine."}, {"owner": {"reputation": 49, "user_id": 5565608, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-keJwr-Iftxc/AAAAAAAAAAI/AAAAAAAAAHA/SLStMUClK7E/photo.jpg?sz=128", "display_name": "Augusto Timm", "link": "https://stackoverflow.com/users/5565608/augusto-timm"}, "edited": false, "score": 0, "creation_date": 1541544214, "post_id": 53181050, "comment_id": 93252516, "body": "I thought so but was not sure as I just recently started searching about memory leak in Rust, do you have anything about it besides the rust book? I have read its section about the drop trait, but I still am not quite sure if I understood it very well."}], "owner": {"reputation": 49, "user_id": 5565608, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-keJwr-Iftxc/AAAAAAAAAAI/AAAAAAAAAHA/SLStMUClK7E/photo.jpg?sz=128", "display_name": "Augusto Timm", "link": "https://stackoverflow.com/users/5565608/augusto-timm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "closed_date": 1541544554, "answer_count": 0, "score": 0, "last_activity_date": 1541544602, "creation_date": 1541543355, "last_edit_date": 1541544602, "question_id": 53181050, "link": "https://stackoverflow.com/questions/53181050/if-i-overwrite-a-vec-with-a-new-one-is-the-old-ones-memory-deallocated", "closed_reason": "Duplicate", "title": "If I overwrite a Vec with a new one, is the old one&#39;s memory deallocated?", "body": "<p>I am using Rust to recreate the game Space Invaders and I am using a <code>Vec&lt;Vec&lt;char&gt;&gt;</code> to represent the screen, to determine the end game I just wanted to do something like</p>\n\n<pre><code>game_screen = Vec::new();\nself.screen.push(String::from(\"GAME OVER\").chars().collect());\n</code></pre>\n\n<p>I am not sure if the old values of <code>game_screen</code> will be deallocated and what should be done if they are not, since this will probably occupy a significant amount of memory.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541530565, "post_id": 53177980, "comment_id": 93246505, "body": "maybe you want use <a href=\"https://doc.rust-lang.org/std/result/enum.Result.html#method.or_else\" rel=\"nofollow noreferrer\">doc.rust-lang.org/std/result/enum.Result.html#method.or_else</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541532519, "post_id": 53177980, "comment_id": 93247449, "body": "Related: <a href=\"https://stackoverflow.com/questions/37048629/is-an-if-let-or-a-normal-if-condition-better\">Is an if-let or a normal if condition better?</a>"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1541574977, "post_id": 53177980, "comment_id": 93259365, "body": "If one of the answers below fixes your issue, you should accept it (click the check mark next to the appropriate answer). That does two things. It lets everyone know your issue has been resolved to your satisfaction, and it gives the person that helps you credit for the assist. <a href=\"http://meta.stackexchange.com/a/5235\">See here</a> for a full explanation"}], "answers": [{"tags": [], "owner": {"reputation": 7882, "user_id": 2722968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d0a9ce812892f03b8342c5a60be24632?s=128&d=identicon&r=PG&f=1", "display_name": "user2722968", "link": "https://stackoverflow.com/users/2722968/user2722968"}, "is_accepted": true, "score": 19, "last_activity_date": 1607886748, "last_edit_date": 1607886748, "creation_date": 1541529689, "answer_id": 53178034, "question_id": 53177980, "link": "https://stackoverflow.com/questions/53177980/how-do-i-conditionally-execute-code-only-when-an-option-is-none/53178034#53178034", "title": "How do I conditionally execute code only when an Option is None?", "body": "<p>If you are not interested in the value, just use</p>\n<pre><code>if v.is_none() { ... }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 4, "creation_date": 1541532420, "post_id": 53178490, "comment_id": 93247405, "body": "or <code>if x == None</code>."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1541574866, "post_id": 53178490, "comment_id": 93259312, "body": "@Shepmaster Only iff <code>T</code> in <code>Option&lt;T&gt;</code> implements <code>PartialEq</code>."}], "tags": [], "owner": {"reputation": 1540, "user_id": 2606171, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4ncy.png?s=128&g=1", "display_name": "belst", "link": "https://stackoverflow.com/users/2606171/belst"}, "is_accepted": false, "score": 27, "last_activity_date": 1541532469, "last_edit_date": 1541532469, "creation_date": 1541531557, "answer_id": 53178490, "question_id": 53177980, "link": "https://stackoverflow.com/questions/53177980/how-do-i-conditionally-execute-code-only-when-an-option-is-none/53178490#53178490", "title": "How do I conditionally execute code only when an Option is None?", "body": "<p>To check if an <code>Option</code> is <code>None</code> you can either use <code>Option::is_none</code> or use the <code>if let</code> syntax.</p>\n\n<p>For example:</p>\n\n<pre><code>let x = ffunc();\n\nif let None = x {\n    println!(\"x is None\")\n}\n</code></pre>\n\n<p>Or using the <code>Option::is_none</code> function:</p>\n\n<pre><code>let x = ffunc();\n\nif x.is_none() {\n    println!(\"x is None\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 113, "user_id": 8359632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cbc269eaf1b2696ad5fa39f4d3548cc?s=128&d=identicon&r=PG&f=1", "display_name": "yihuaf", "link": "https://stackoverflow.com/users/8359632/yihuaf"}, "is_accepted": false, "score": 6, "last_activity_date": 1592332783, "creation_date": 1592332783, "answer_id": 62415430, "question_id": 53177980, "link": "https://stackoverflow.com/questions/53177980/how-do-i-conditionally-execute-code-only-when-an-option-is-none/62415430#62415430", "title": "How do I conditionally execute code only when an Option is None?", "body": "<p>To complete the answer above, if the option is <code>Some(x)</code>:</p>\n\n<pre><code>let v = ffunc()\nif let Some(x) = v {\n    func_to_use_x(x);\n} else {\n    callproc();\n}\n</code></pre>\n\n<p>If you don't care about the value in the option, then:</p>\n\n<pre><code>if v.is_none() {...}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>if v.is_some() {...}\n</code></pre>\n"}], "owner": {"reputation": 529, "user_id": 9188311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac9d5d6a8907c0aa066b871e4c4d8f12?s=128&d=identicon&r=PG&f=1", "display_name": "Mens Rifles", "link": "https://stackoverflow.com/users/9188311/mens-rifles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9183, "favorite_count": 5, "accepted_answer_id": 53178034, "answer_count": 3, "score": 26, "last_activity_date": 1607886748, "creation_date": 1541529468, "last_edit_date": 1541530162, "question_id": 53177980, "link": "https://stackoverflow.com/questions/53177980/how-do-i-conditionally-execute-code-only-when-an-option-is-none", "title": "How do I conditionally execute code only when an Option is None?", "body": "<p>I don't want to take action if the function returns a value in the optional; how do I test the <code>None</code> case only?  This code works, but it looks horrible.        </p>\n\n<pre><code>let v = ffunc();\nmatch v {\n  None =&gt; { callproc() }, \n  Some(x) =&gt; {  }\n}\n</code></pre>\n\n<p>In C, I can write:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>int x = ffunc();\nif ( !x ) { callproc() } \n</code></pre>\n"}, {"tags": ["rust", "valgrind"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1541530422, "post_id": 53177922, "comment_id": 93246422, "body": "Please see if <a href=\"https://stackoverflow.com/q/51509314/155423\">Why does Valgrind not detect a memory leak in a Rust program using nightly 1.29.0?</a> solves your issue. Not using the system allocator usually leads to failures with Valgrind."}, {"owner": {"reputation": 6149, "user_id": 2343743, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/51e765c5c3938fecd79ead6c8439d1b6?s=128&d=identicon&r=PG", "display_name": "David Michael Gang", "link": "https://stackoverflow.com/users/2343743/david-michael-gang"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541531587, "post_id": 53177922, "comment_id": 93246994, "body": "i cannot use this. it gives a compilation error: error[E0554]: #![feature] may not be used on the stable release channel. When removing the feature line i get an error error[E0658]: use of unstable library feature &#39;alloc_system&#39;: this library is unlikely to be stabilized in its current form or name (see issue #32838)"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541531730, "post_id": 53177922, "comment_id": 93247065, "body": "@DavidMichaelGang we expected you to have read the book, <a href=\"https://doc.rust-lang.org/stable/book/second-edition/appendix-07-nightly-rust.html#unstable-features\" rel=\"nofollow noreferrer\">doc.rust-lang.org/stable/book/second-edition/&hellip;</a>"}, {"owner": {"reputation": 6149, "user_id": 2343743, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/51e765c5c3938fecd79ead6c8439d1b6?s=128&d=identicon&r=PG", "display_name": "David Michael Gang", "link": "https://stackoverflow.com/users/2343743/david-michael-gang"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541532299, "post_id": 53177922, "comment_id": 93247341, "body": "@Stargateur you are 100 % right. I did not get to this chapter yet but had to read the whole book."}, {"owner": {"reputation": 6149, "user_id": 2343743, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/51e765c5c3938fecd79ead6c8439d1b6?s=128&d=identicon&r=PG", "display_name": "David Michael Gang", "link": "https://stackoverflow.com/users/2343743/david-michael-gang"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541532305, "post_id": 53177922, "comment_id": 93247346, "body": "@shepmaster it worked perfectly"}], "owner": {"reputation": 6149, "user_id": 2343743, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/51e765c5c3938fecd79ead6c8439d1b6?s=128&d=identicon&r=PG", "display_name": "David Michael Gang", "link": "https://stackoverflow.com/users/2343743/david-michael-gang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "closed_date": 1541532354, "answer_count": 0, "score": 0, "last_activity_date": 1541530352, "creation_date": 1541529147, "last_edit_date": 1541530352, "question_id": 53177922, "link": "https://stackoverflow.com/questions/53177922/measuring-rust-memory-usage-with-valgrind-causes-a-sigsev", "closed_reason": "Duplicate", "title": "Measuring Rust memory usage with Valgrind causes a SIGSEV", "body": "<p>I have a Rust program compiled with Rust 1.30.0:</p>\n\n<pre><code>use std::collections::HashMap;\nuse std::fs::File;\nuse std::io::{BufRead, BufReader, Result};\n\nfn main() -&gt; Result&lt;()&gt; {\n    let file = File::open(\"file.txt\")?;\n    let mut scores = HashMap::new();\n    let mut i = 0;\n    for line in BufReader::new(file).lines() {\n        let line = line.expect(\"Unable to read line\");\n        scores.insert(line, i);\n        i = i + 1;\n    }\n    Ok(())\n}\n</code></pre>\n\n<p>First I build it:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cargo build --release\ncd target/release\n</code></pre>\n\n<p>Running it alone works:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>./hello_cargo\n</code></pre>\n\n<p>But when running Valgrind:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>valgrind --tool=massif --main-stacksize=1900000000 ./hello_cargo\n==11619== Massif, a heap profiler\n==11619== Copyright (C) 2003-2017, and GNU GPL'd, by Nicholas Nethercote\n==11619== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info\n==11619== Command: ./hello_cargo\n==11619==\n==11619==\n==11619== Process terminating with default action of signal 11 (SIGSEGV)\n==11619==  Access not within mapped region at address 0x8193A990\n==11619==    at 0x4863B9E: __dlerror_main_freeres (dlerror.c:189)\n==11619==    by 0x4A3EA41: __libc_freeres (in /lib/x86_64-linux-gnu/libc-2.28.so)\n==11619==    by 0x482D19E: _vgnU_freeres (in /usr/lib/valgrind/vgpreload_core-amd64-linux.so)\n==11619==    by 0x48F1529: __run_exit_handlers (exit.c:132)\n==11619==    by 0x48F1559: exit (exit.c:139)\n==11619==    by 0x48D10A1: (below main) (libc-start.c:342)\n==11619==  If you believe this happened as a result of a stack\n==11619==  overflow in your program's main thread (unlikely but\n==11619==  possible), you can try to increase the size of the\n==11619==  main thread stack using the --main-stacksize= flag.\n==11619==  The main thread stack size used in this run was 1900003328.\n</code></pre>\n\n<p>I tried with different parameters of main-stacksize but it did not help.</p>\n\n<p>How can I solve the issue?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 1979, "user_id": 231238, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/79eacf8ee1b8da82f5baffd6ba94054e?s=128&d=identicon&r=PG", "display_name": "LOST", "link": "https://stackoverflow.com/users/231238/lost"}, "edited": false, "score": 0, "creation_date": 1541524528, "post_id": 53176418, "comment_id": 93243524, "body": "BTW, any suggestions on how to best make an iterator of iterators for a number of constants? Going through <code>Vec</code> seems excessive."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 1979, "user_id": 231238, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/79eacf8ee1b8da82f5baffd6ba94054e?s=128&d=identicon&r=PG", "display_name": "LOST", "link": "https://stackoverflow.com/users/231238/lost"}, "edited": false, "score": 0, "creation_date": 1541524761, "post_id": 53176418, "comment_id": 93243638, "body": "@LOST You can write a macro, but there are no easier ways to do this AFAIK"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 2, "creation_date": 1541538400, "post_id": 53176418, "comment_id": 93250179, "body": "If you change <code>merge_sorted</code> to accept <code>IntoIterator</code> rather than <code>Iterator</code>, this becomes: <code>let vectors = vec![&amp;v1]; merge_sorted(vectors)</code>. (Or <code>v1</code> in place of <code>&amp;v1</code> to iterate over values.) It&#39;s almost always better to use <code>IntoIterator</code> as a bound for arguments because all things that implement <code>Iterator</code> also implement <code>IntoIterator</code>."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "reply_to_user": {"reputation": 1979, "user_id": 231238, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/79eacf8ee1b8da82f5baffd6ba94054e?s=128&d=identicon&r=PG", "display_name": "LOST", "link": "https://stackoverflow.com/users/231238/lost"}, "edited": false, "score": 0, "creation_date": 1541539144, "post_id": 53176418, "comment_id": 93250461, "body": "@LOST There is a <code>merge</code> function in the <code>itertools</code> crate which you may find interesting, although it only merges two iterators, not an arbitrary number."}, {"owner": {"reputation": 1979, "user_id": 231238, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/79eacf8ee1b8da82f5baffd6ba94054e?s=128&d=identicon&r=PG", "display_name": "LOST", "link": "https://stackoverflow.com/users/231238/lost"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1541571472, "post_id": 53176418, "comment_id": 93258362, "body": "@trentcl I am really just practicing writing short snippets."}], "tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 2, "last_activity_date": 1541579570, "last_edit_date": 1541579570, "creation_date": 1541523078, "answer_id": 53176418, "question_id": 53176209, "link": "https://stackoverflow.com/questions/53176209/how-can-i-construct-and-pass-an-iterator-of-iterators/53176418#53176418", "title": "How can I construct and pass an iterator of iterators?", "body": "<p><code>Vec::iter</code> <em>borrows</em> the items it contains, so you are iterating over borrowed iterators (<code>&amp;std::slice::Iter</code>) that do not implement <code>Iterator</code>. To consume a vector in order to have the ownership of the items, you must call <code>Vec::into_iter</code>:</p>\n\n<pre><code>fn main() {\n    let v1 = vec![1, 2];\n    let vectors = vec![v1.iter()]; // You can use `into_iter` there to iterate over ints.\n    merge_sorted(vectors.into_iter());\n}\n</code></pre>\n\n<p>You can also require <code>IntoIterators</code> that can make easier the usage of your API:</p>\n\n<pre><code>fn merge_sorted&lt;IterT, IterIterT, T: Ord&gt;(mut arrays: IterIterT) -&gt; Vec&lt;T&gt;\nwhere\n    IterT: IntoIterator&lt;Item = T&gt;,\n    IterIterT: IntoIterator&lt;Item = IterT&gt;,\n{\n    panic!();\n}\n\nfn main() {\n    let v1 = vec![1, 2];\n    let vectors = vec![v1];\n    merge_sorted(vectors);\n}\n</code></pre>\n"}], "owner": {"reputation": 1979, "user_id": 231238, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/79eacf8ee1b8da82f5baffd6ba94054e?s=128&d=identicon&r=PG", "display_name": "LOST", "link": "https://stackoverflow.com/users/231238/lost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 755, "favorite_count": 1, "accepted_answer_id": 53176418, "answer_count": 1, "score": 0, "last_activity_date": 1541579570, "creation_date": 1541522394, "last_edit_date": 1541530471, "question_id": 53176209, "link": "https://stackoverflow.com/questions/53176209/how-can-i-construct-and-pass-an-iterator-of-iterators", "title": "How can I construct and pass an iterator of iterators?", "body": "<p>I am trying to grok Rust by implementing simple algorithms in it. I managed to make a generic <code>merge_sorted</code>, which ended up having the following signature:</p>\n\n<pre><code>fn merge_sorted&lt;IL, ILL, I: Ord&gt;(mut arrays: ILL) -&gt; Vec&lt;I&gt;\nwhere\n    IL: Iterator&lt;Item = I&gt;,\n    ILL: Iterator&lt;Item = IL&gt;,\n{\n    // ...\n}\n</code></pre>\n\n<p>This seems to be compiling on its own. The signature makes sense to me, as the function consumes the top-level iterator, and all the iterators it returns too. However, I am unable to construct a valid value to pass to this function:</p>\n\n<pre><code>fn main() {\n    let v1 = vec![1, 2];\n    let vectors = vec![v1.iter()];\n    merge_sorted(vectors.iter());\n}\n</code></pre>\n\n<p>As expected, <code>vectors</code> in this sample has the type:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>std::vec::Vec&lt;std::slice::Iter&lt;'_, i32&gt;&gt;\n</code></pre>\n\n<p>This is the error message I get:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `&amp;std::slice::Iter&lt;'_, {integer}&gt;: std::iter::Iterator` is not satisfied\n  --&gt; src\\main.rs:58:5\n   |\n58 |     merge_sorted(vectors.iter());\n   |     ^^^^^^^^^^^^ `&amp;std::slice::Iter&lt;'_, {integer}&gt;` is not an iterator; maybe try calling `.iter()` or a similar method\n   |\n   = help: the trait `std::iter::Iterator` is not implemented for `&amp;std::slice::Iter&lt;'_, {integer}&gt;`\nnote: required by `merge_sorted`\n</code></pre>\n\n<p>Where does the <code>&amp;</code> come from?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 3, "creation_date": 1541507799, "post_id": 53171992, "comment_id": 93233669, "body": "That&#39;s not how you write generic functions in Rust: please read again the <a href=\"https://doc.rust-lang.org/book/second-edition/ch10-00-generics.html\" rel=\"nofollow noreferrer\">chapter about generics</a>. You must write: <code>fn add&lt;T: Add&gt;(a: T, b: T) -&gt; T::Output </code>."}, {"owner": {"reputation": 1183, "user_id": 1816631, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/29ced07f3e8c91fca396d867bda0b7da?s=128&d=identicon&r=PG", "display_name": "Gorm Casper", "link": "https://stackoverflow.com/users/1816631/gorm-casper"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1541508579, "post_id": 53171992, "comment_id": 93234077, "body": "Oh wow. Rust is hard. I thought I know this. Thanks a lot. I know it&#39;s a different question (should have included it), but can I &quot;cast&quot; something to <code>T</code> inside the function then? Say I wanted to double it, so <code>(a + b) * 2</code> -- I need the <code>Mul</code> also, it quickly gets very complicated."}, {"owner": {"reputation": 19105, "user_id": 3005167, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/t0bMQ.png?s=128&g=1", "display_name": "kazemakase", "link": "https://stackoverflow.com/users/3005167/kazemakase"}, "edited": false, "score": 2, "creation_date": 1541508901, "post_id": 53171992, "comment_id": 93234270, "body": "@GormCasper complicated maybe, <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=8e4f321f78a04776c0ecf9cddd26371c\" rel=\"nofollow noreferrer\">but not impossible</a>. The worst part is the return type :)"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1541508932, "post_id": 53171992, "comment_id": 93234282, "body": "@GormCasper Yup, this will get complicated quickly.  I suggest you ask a separate question for the conversion.  Short answer, you will need some trait implementing the conversion, like <code>Into&lt;T&gt;</code>, or maybe <code>num::cast::FromPrimitive&lt;T&gt;</code>."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 19105, "user_id": 3005167, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/t0bMQ.png?s=128&g=1", "display_name": "kazemakase", "link": "https://stackoverflow.com/users/3005167/kazemakase"}, "edited": false, "score": 0, "creation_date": 1541509013, "post_id": 53171992, "comment_id": 93234323, "body": "@kazemakase The problem with that approach is that there is basically only a single type that is <code>Mul&lt;i32&gt;</code>, which is <code>i32</code> itself."}, {"owner": {"reputation": 1183, "user_id": 1816631, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/29ced07f3e8c91fca396d867bda0b7da?s=128&d=identicon&r=PG", "display_name": "Gorm Casper", "link": "https://stackoverflow.com/users/1816631/gorm-casper"}, "edited": false, "score": 1, "creation_date": 1541509113, "post_id": 53171992, "comment_id": 93234376, "body": "So maybe I am attacking it from the wrong angle. Maybe it is better to just say &quot;I expect you to give me <code>i32</code>, always.&quot; And just go with that"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1541509248, "post_id": 53171992, "comment_id": 93234453, "body": "@GormCasper If this covers your use case, that&#39;s certainly the easier way.  Otherwise I suggest looking into the <code>num</code> crate and the traits defined there \u2013 they make it a lot easier to implement generic functions operating on nubmers."}, {"owner": {"reputation": 19105, "user_id": 3005167, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/t0bMQ.png?s=128&g=1", "display_name": "kazemakase", "link": "https://stackoverflow.com/users/3005167/kazemakase"}, "edited": false, "score": 0, "creation_date": 1541509255, "post_id": 53171992, "comment_id": 93234457, "body": "@GormCasper that&#39;s the easy way :) have a look at the <a href=\"https://crates.io/crates/num\" rel=\"nofollow noreferrer\">num</a> crate for more powerful generic capabilities."}, {"owner": {"reputation": 1183, "user_id": 1816631, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/29ced07f3e8c91fca396d867bda0b7da?s=128&d=identicon&r=PG", "display_name": "Gorm Casper", "link": "https://stackoverflow.com/users/1816631/gorm-casper"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541509667, "post_id": 53171992, "comment_id": 93234702, "body": "@SvenMarnach and @kazemakase thanks a lot. I think I&#39;ll go with basic <code>ints</code> and <code>floats</code> for now, and then it can later be converted once all this is easier for me (just reading the docs of the num crate is difficult for me)"}], "answers": [{"tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 2, "last_activity_date": 1541508672, "creation_date": 1541508672, "answer_id": 53172281, "question_id": 53171992, "link": "https://stackoverflow.com/questions/53171992/function-signature-for-generic-numbers/53172281#53172281", "title": "Function signature for generic numbers", "body": "<p>You are conflating <em>traits</em> and <em>types</em>.</p>\n\n<p><code>Add</code> is a <em>trait</em>.  A trait can be implemented for a type or a class of types, but it is not a type itself.</p>\n\n<p>Function arguments need to be declared with a <em>type</em>, not a trait.  This is the main problem with your prototype \u2013 <code>Add</code> is not a type, so you can't use it as the type of a variable or a function argument.</p>\n\n<p>Rust allows you to declare <em>generic types</em>, essentially type variables.  You can then place <em>trait bounds</em> on the generic types, which require that whatever type is substituted for the generic type must implement some trait. Your example using a generic type parameter <code>T</code> looks like this:</p>\n\n<pre><code>fn add&lt;T: Add&gt;(a: T, b: T) -&gt; T::Output\n</code></pre>\n\n<p>This prototype requires that <code>a</code> and <code>b</code> both have the same type <code>T</code>, and that <code>T</code> implements the <code>Add</code> trait.</p>\n"}], "owner": {"reputation": 1183, "user_id": 1816631, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/29ced07f3e8c91fca396d867bda0b7da?s=128&d=identicon&r=PG", "display_name": "Gorm Casper", "link": "https://stackoverflow.com/users/1816631/gorm-casper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 0, "accepted_answer_id": 53172281, "answer_count": 1, "score": 0, "last_activity_date": 1541508672, "creation_date": 1541507544, "question_id": 53171992, "link": "https://stackoverflow.com/questions/53171992/function-signature-for-generic-numbers", "title": "Function signature for generic numbers", "body": "<p>I am trying to make a few generic functions that work on numbers, but I'm struggling with the function signatures.</p>\n\n<p>Perhaps I am attacking the problem from the wrong angle, but here is where I got on my own so far. I am not hellbent on making this work this way; so if I am attacking the problem (of creating a small lib of generally useful math functions) from the wrong angle, then by all means educate me.</p>\n\n<p>Let's say I want a function, <code>add</code> that adds up two numbers:</p>\n\n<pre><code>use std::ops::Add;\n\nfn add(a: Add, b: Add) -&gt; Add::Output {\n    a + b\n}\n</code></pre>\n\n<p>This won't compile. Here is a playground though: <a href=\"https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=4589325b5c8d1f1b19440424878caa98\" rel=\"nofollow noreferrer\">https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=4589325b5c8d1f1b19440424878caa98</a></p>\n\n<p>I get essentially two errors. The first:</p>\n\n<pre><code>error[E0393]: the type parameter `RHS` must be explicitly specified\n --&gt; src/main.rs:8:11\n  |\n8 | fn add(a: Add, b: Add) -&gt; Add::Output {\n  |           ^^^ missing reference to `RHS`\n  |\n  = note: because of the default `Self` reference, type parameters must be specified on object types\n</code></pre>\n\n<p>I have read <a href=\"https://doc.rust-lang.org/book/second-edition/ch19-03-advanced-traits.html\" rel=\"nofollow noreferrer\">the chapter on advanced traits</a> in the Rust book, so i \"sort-of/kind-of\" understand the <code>RHS</code> message, but they attack the problem of adding the <code>Add</code> trait to your particular data structure (a <code>Point</code> in the example); but never show a function signature of a function that takes anything that can be added up. So I am a little lost.</p>\n\n<p>The second error:</p>\n\n<pre><code>error[E0223]: ambiguous associated type\n --&gt; src/main.rs:8:27\n  |\n8 | fn add(a: Add, b: Add) -&gt; Add::Output {\n  |                           ^^^^^^^^^^^ ambiguous associated type\n  |\n  = note: specify the type using the syntax `&lt;Type as std::ops::Add&gt;::Output`\n</code></pre>\n\n<p>This goes away if I write <code>&lt;i32 as Add&gt;::Output</code>, but that is not what I want. I specifically want the function to work on anything that can be added up (assuming both <code>a</code> and <code>b</code> to be the same type).</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 111, "user_id": 3775132, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/451a29d6be258b8c07306b49e8ba713b?s=128&d=identicon&r=PG&f=1", "display_name": "DanSnow", "link": "https://stackoverflow.com/users/3775132/dansnow"}, "edited": false, "score": 2, "creation_date": 1541504904, "post_id": 53171108, "comment_id": 93232210, "body": "I don&#39;t understand why but I changed it to <code>default_values as fn() -&gt; &amp;&#39;static _</code> then it&#39;ll work."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 2, "creation_date": 1541505743, "post_id": 53171108, "comment_id": 93232589, "body": "Nightly + <code>feature(nll)</code> gives an additional information: <i>&#39;borrowed value does not live long enough, cast requires that <code>values</code> is borrowed for <code>&#39;static</code>&#39;</i>"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541508638, "post_id": 53171108, "comment_id": 93234119, "body": "Look like the compile infer <code>_v</code> based on the return type of the function instead of infer <code>_v</code> based on the type of <code>optional_value</code>, and actually only <code>as fn() -&gt; _</code> is enough. That simply a case of &quot;you need to help the compiler&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1541511430, "post_id": 53172271, "comment_id": 93235791, "body": "This still feels like a bug. Probably this is an unpolished edge of HRTB."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "reply_to_user": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1541536972, "post_id": 53172271, "comment_id": 93249517, "body": "I agree, it does feel like a bug."}], "tags": [], "owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "is_accepted": true, "score": 5, "last_activity_date": 1541508637, "creation_date": 1541508637, "answer_id": 53172271, "question_id": 53171108, "link": "https://stackoverflow.com/questions/53171108/why-do-lifetimes-differ-when-a-function-is-called-in-a-closure-vs-being-called/53172271#53172271", "title": "Why do lifetimes differ when a function is called in a closure vs. being called directly in Rust?", "body": "<p>This happens because <code>default_values</code> implements <code>Fn() -&gt; &amp;'static [u32]</code>, but not <code>for&lt;'a&gt; Fn() -&gt; &amp;'a [u32]</code>. Traits are <a href=\"https://doc.rust-lang.org/nomicon/subtyping.html\" rel=\"noreferrer\">invariant</a>, so you can't coerce \"something that implements <code>Fn() -&gt; &amp;'static [u32]</code>\" to \"something that implements <code>Fn() -&gt; &amp;'a [u32]</code>\" (for some <code>'a</code> smaller than <code>'static</code>), even though, logically speaking, <code>default_values</code> could satisfy both.</p>\n\n<p>When it's called in a closure, <code>default_values()</code> returns a <code>&amp;'static [u32]</code>, but it can be coerced immediately to a <code>&amp;'a u32</code>, making the closure itself able to implement <code>Fn() -&gt; &amp;'a [u32]</code> (where the <code>&amp;'a</code> is determined by the compiler).</p>\n\n<p>As for why adding <code>as fn() -&gt; &amp;'static [u32]</code> works, I assume the compiler can recognize that the function pointer type <code>fn() -&gt; &amp;'static [u32]</code> is capable of implementing <code>Fn() -&gt; &amp;'a [u32]</code> for any <code>'a</code>. I'm not sure why it doesn't also do this for ordinary functions and closures; perhaps a future compiler version could be smart enough to allow the original code.</p>\n\n<p>Another solution is to make the type of <code>default_values</code> one that can implement the <code>Fn</code> trait you need:</p>\n\n<pre><code>fn default_values&lt;'a&gt;() -&gt; &amp;'a [u32] {\n    static VALUES: [u32; 3] = [1, 2, 3];\n    &amp;VALUES\n}\n</code></pre>\n\n<p>Instead of saying \"this is a function that returns a <code>'static</code> reference\", the signature here says \"this is a function that can return a reference of any lifetime\". We know that \"a reference of any lifetime\" has to be a <code>'static</code> reference, but the compiler sees the signatures as different because this one has an additional degree of freedom. <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=96102b33624e739194569248cc7f12a3\" rel=\"noreferrer\">This change is sufficient to make your original example compile.</a></p>\n"}, {"tags": [], "owner": {"reputation": 11723, "user_id": 3356777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1c7bee1f2c7ba7f81ddb902b83626558?s=128&d=identicon&r=PG&f=1", "display_name": "attdona", "link": "https://stackoverflow.com/users/3356777/attdona"}, "is_accepted": false, "score": 2, "last_activity_date": 1541630669, "creation_date": 1541630669, "answer_id": 53199039, "question_id": 53171108, "link": "https://stackoverflow.com/questions/53171108/why-do-lifetimes-differ-when-a-function-is-called-in-a-closure-vs-being-called/53199039#53199039", "title": "Why do lifetimes differ when a function is called in a closure vs. being called directly in Rust?", "body": "<p>There is no difference between a closure and a direct function call: It is just a matter of type inference.</p>\n\n<p>closure that compiles:</p>\n\n<pre><code>let _v = optional_values.unwrap_or_else(|| default_values());\nlet _v = optional_values.unwrap_or_else(|| -&gt; &amp; [u32] {default_values()});\n</code></pre>\n\n<p>closure that not compiles:</p>\n\n<pre><code>let _v = unwrap_or_else(optional_values, || -&gt; &amp;'static [u32] {default_values()});\n</code></pre>\n\n<p>function that compiles:</p>\n\n<pre><code>let _v = unwrap_or_else(optional_values, default_values as fn() -&gt; &amp;'static _);\n</code></pre>\n\n<p>function that not compiles:</p>\n\n<pre><code>let _v = unwrap_or_else(optional_values, default_values);\n</code></pre>\n\n<h2>A litte bit of explanation</h2>\n\n<p>Consider this equivalent code:</p>\n\n<pre><code>fn default_values() -&gt; &amp;'static [u32] {\n    static VALUES: [u32; 3] = [1, 2, 3];\n    &amp;VALUES\n}\n\nfn unwrap_or_else&lt;T, F&gt;(slf: Option&lt;T&gt;, f: F) -&gt; T where\n    F: FnOnce() -&gt; T, {\n        match slf {\n            Some(t) =&gt; t,\n            None =&gt; f()\n        }\n    }\n</code></pre>\n\n<p>the following snippet:</p>\n\n<pre><code>fn main() {\n    let values: [u32; 3] = [4, 5, 6];\n    let optional_values: Option&lt;&amp;[u32]&gt; = Some(&amp;values);\n\n    let _v = unwrap_or_else(optional_values, || -&gt; &amp;'static [u32] {default_values});\n\n    // the above throws the same error of:\n    //let _v = unwrap_or_else(optional_values, default_values);\n}\n</code></pre>\n\n<p>fails:</p>\n\n<pre><code>error[E0597]: `values` does not live long enough\n  --&gt; src/main.rs:18:48\n   |\n18 |     let optional_values: Option&lt;&amp;[u32]&gt; = Some(&amp;values);\n   |                                                ^^^^^^^\n   |                                                |\n   |                                                borrowed value does not live long enough\n   |                                                cast requires that `values` is borrowed for `'static`\n...\n27 | }\n   | - `values` dropped here while still borrowed\n</code></pre>\n\n<p>Look from the monomorphization side: assuming that\nthe compiler infers that <code>T</code> resolves to the concrete type <code>&amp;'static [u32]</code>,\nand supposing that the produced code is something like:</p>\n\n<pre><code>fn unwrap_or_else_u32_sl_fn_u32_sl(slf: Option&lt;&amp;'static [u32]&gt;,\n                                   f: fn() -&gt; &amp;'static [u32]) -&gt; &amp;'static [u32] {\n    ...\n}\n</code></pre>\n\n<p>then the above monomorphization explains the error:</p>\n\n<p><code>slf</code> value is <code>optional_values</code>: an <code>Option&lt;&amp;'a [u32]&gt;</code> that does not live enough and clearly cannot be cast because it does not satisfies the <code>'static</code> lifetime requirement.</p>\n\n<p>If you write:</p>\n\n<pre><code>let _v = unwrap_or_else(optional_values, || default_values());\n\n// the same, expliciting the return type:\nlet _v = unwrap_or_else(optional_values, || -&gt; &amp; [u32] {default_values()});\n</code></pre>\n\n<p>It compiles: now the lifetime of the return type is compatible with the <code>optional_values</code> lifetime.</p>\n\n<p>Finally, I'm not able to explain why, but the evidence shows that the cast <code>as fn() -&gt; &amp;'static _</code> helps the compiler to be sure that decoupling lifetimes bound to <code>optional_values</code> and <code>default_values</code> is safe.</p>\n"}], "owner": {"reputation": 2865, "user_id": 171520, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3da837d1227e7df8153c68d502f64994?s=128&d=identicon&r=PG", "display_name": "Dave Challis", "link": "https://stackoverflow.com/users/171520/dave-challis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 2, "accepted_answer_id": 53172271, "answer_count": 2, "score": 11, "last_activity_date": 1541630669, "creation_date": 1541504166, "question_id": 53171108, "link": "https://stackoverflow.com/questions/53171108/why-do-lifetimes-differ-when-a-function-is-called-in-a-closure-vs-being-called", "title": "Why do lifetimes differ when a function is called in a closure vs. being called directly in Rust?", "body": "<p>In the following code example:</p>\n\n<pre><code>fn default_values() -&gt; &amp;'static [u32] {\n    static VALUES: [u32; 3] = [1, 2, 3];\n    &amp;VALUES\n}\n\nfn main() {\n    let values: [u32; 3] = [4, 5, 6];\n    let optional_values: Option&lt;&amp;[u32]&gt; = Some(&amp;values);\n\n    // this compiles and runs fine \n    let _v = optional_values.unwrap_or_else(|| default_values());\n\n    // this fails to compile\n    let _v = optional_values.unwrap_or_else(default_values);\n}\n</code></pre>\n\n<p>the last statement fails to compile with:</p>\n\n<pre><code>error[E0597]: `values` does not live long enough\n  --&gt; src/main.rs:8:49\n   |\n8  |     let optional_values: Option&lt;&amp;[u32]&gt; = Some(&amp;values);\n   |                                                 ^^^^^^ borrowed value does not live long enough\n...\n12 | }\n   | - borrowed value only lives until here\n   |\n   = note: borrowed value must be valid for the static lifetime...\n</code></pre>\n\n<p>I'm wondering:</p>\n\n<ol>\n<li>what's happening that causes the difference in behaviour between the last two statements</li>\n<li>whether the first <code>unwrap_or_else(|| default_values())</code> is the correct way of handling this, or whether there's a better pattern</li>\n</ol>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1541492242, "post_id": 53167969, "comment_id": 93225931, "body": "Please edit your question and make it readable, e.g. use punctuation. Also reduce your title to a short description instead of a sentence"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1541492456, "post_id": 53167969, "comment_id": 93226021, "body": "Also when using tags, please ensure that you use the right tags. <a href=\"https://stackoverflow.com/questions/tagged/cargo\">cargo</a> is a java library, you want to use <a href=\"https://stackoverflow.com/questions/tagged/rust-cargo\">rust-cargo</a>. By the way, please take <a href=\"https://stackoverflow.com/tour\">the tour</a> to learn how stackoverflow works. This seems to be your first question here and you should learn what SO is and how to use it. Also please read <a href=\"https://stackoverflow.com/help/how-to-ask\">how to ask</a> for a guide on how to ask good questions and avoid downvotes."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1541492943, "post_id": 53167969, "comment_id": 93226265, "body": "Btw. <i>&#39;VCS that isn&#39;t github?</i>&#39;: github isn&#39;t a vcs, but <a href=\"https://stackoverflow.com/questions/tagged/git\">git</a> is. You should learn <a href=\"https://stackoverflow.com/questions/13321556/difference-between-git-and-github\">the different between github and git</a>. As I said, please edit your question asap. People will remove their downvotes and vote your question up if it contains a readable, good question and this is one, but not readable at the moment."}], "answers": [{"tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": false, "score": 1, "last_activity_date": 1541492353, "creation_date": 1541492353, "answer_id": 53168123, "question_id": 53167969, "link": "https://stackoverflow.com/questions/53167969/rust-pkg-mgr-cargo-how-can-i-set-a-default-vcs-so-each-cargo-new-projname-is/53168123#53168123", "title": "Rust pkg mgr Cargo -how can I set a default VCS so each &quot;cargo new projname&quot; is set for that VCS", "body": "<p>The cargo config is described in <a href=\"https://doc.rust-lang.org/cargo/index.html\" rel=\"nofollow noreferrer\">the cargo book</a> chapter <a href=\"https://doc.rust-lang.org/cargo/reference/config.html\" rel=\"nofollow noreferrer\">3.3</a>.</p>\n\n<blockquote>\n  <p>By default <code>cargo new</code> will initialize a new Git repository. This key can be set to <code>hg</code> to create a Mercurial repository, or <code>none</code> to disable this behavior.</p>\n  \n  <p><code>vcs = \"none\"</code></p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 182, "user_id": 9057530, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e3a56474c76a954f849caa0b46e55bd?s=128&d=identicon&r=PG", "display_name": "yyFred", "link": "https://stackoverflow.com/users/9057530/yyfred"}, "is_accepted": false, "score": 0, "last_activity_date": 1585258409, "creation_date": 1585258409, "answer_id": 60876475, "question_id": 53167969, "link": "https://stackoverflow.com/questions/53167969/rust-pkg-mgr-cargo-how-can-i-set-a-default-vcs-so-each-cargo-new-projname-is/60876475#60876475", "title": "Rust pkg mgr Cargo -how can I set a default VCS so each &quot;cargo new projname&quot; is set for that VCS", "body": "<p>Adding details to hellow's answer, the file is <code>~/.cargo/config</code> and you should create it if it doesn't exist already. Then add the following:</p>\n\n<pre><code>[cargo-new]\nvcs = \"none\"              # VCS to use ('git', 'hg', 'pijul', 'fossil', 'none')\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 7597180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/455428b74c37484ecc1e9cb054375db1?s=128&d=identicon&r=PG", "display_name": "bern", "link": "https://stackoverflow.com/users/7597180/bern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1585258409, "creation_date": 1541491640, "last_edit_date": 1541492414, "question_id": 53167969, "link": "https://stackoverflow.com/questions/53167969/rust-pkg-mgr-cargo-how-can-i-set-a-default-vcs-so-each-cargo-new-projname-is", "title": "Rust pkg mgr Cargo -how can I set a default VCS so each &quot;cargo new projname&quot; is set for that VCS", "body": "<p>where in cargo's set of base configurations can I tell cargo to create new projects with a VCS that isn't github?</p>\n\n<p>want to do this 1 time, not on every \"cargo new\" and not via editing ea project config</p>\n"}, {"tags": ["rust", "pattern-matching"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541496118, "post_id": 53166245, "comment_id": 93227584, "body": "While in this simple case the compiler theoretically <i>could</i> figure out what cases are covered by the guard, this is not possible in general.  The guard can contain arbitrary expressions, function calls and references to external state, so in the general case the compiler can&#39;t know whether the guard condition holds.  For this reason, Rust always assumes that it might <i>not</i> hold, even if the guard is <code>if true</code>, which makes the semantics simple and predictable."}, {"owner": {"reputation": 1445, "user_id": 594173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c93a9ca8d6e7ed662f3925a053a77b?s=128&d=identicon&r=PG", "display_name": "Michael Leonard", "link": "https://stackoverflow.com/users/594173/michael-leonard"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541514625, "post_id": 53166245, "comment_id": 93237651, "body": "@Stargateur, no I didn\u2019t say it myself, and yes I did clearly explain what I\u2019m trying to do. I want to catch every case where the start_state and end_state are equal."}, {"owner": {"reputation": 1445, "user_id": 594173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c93a9ca8d6e7ed662f3925a053a77b?s=128&d=identicon&r=PG", "display_name": "Michael Leonard", "link": "https://stackoverflow.com/users/594173/michael-leonard"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541514670, "post_id": 53166245, "comment_id": 93237679, "body": "@Sven thanks that makes sense, I guess I hoped it could exhaust this simple case."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541515918, "post_id": 53166245, "comment_id": 93238395, "body": "@MichaelLeonard So what the problem with <code>(State::Initial, State::Initial) | (State::One, State::One) | (State::Two, State::Two) =&gt; {}</code> ? That what I will do. The solution is already at the end of your question. Use a macro or write it at the hand."}, {"owner": {"reputation": 1445, "user_id": 594173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c93a9ca8d6e7ed662f3925a053a77b?s=128&d=identicon&r=PG", "display_name": "Michael Leonard", "link": "https://stackoverflow.com/users/594173/michael-leonard"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541516830, "post_id": 53166245, "comment_id": 93238960, "body": "@Stargateur, it works but it is tedious (and I was just curious why this didn&#39;t work). I expect this state machine to grow to contain 100&#39;s of states. With that said I have, for other reasons, decided that the second macro I suggested is actually the better solution anyways."}], "answers": [{"comments": [{"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 5, "creation_date": 1541492758, "post_id": 53166375, "comment_id": 93226171, "body": "Or add a <code>_ =&gt; unreachable!()</code> if you are confident that you are doing it right."}, {"owner": {"reputation": 1445, "user_id": 594173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c93a9ca8d6e7ed662f3925a053a77b?s=128&d=identicon&r=PG", "display_name": "Michael Leonard", "link": "https://stackoverflow.com/users/594173/michael-leonard"}, "reply_to_user": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 1, "creation_date": 1541514916, "post_id": 53166375, "comment_id": 93237823, "body": "@rodrigo, no I want to avoid the catch-all pattern in order to force the match statement to be updated if new states are added later. I\u2019m confident I\u2019m doing it correctly now, but trying to protect against future changes. And furthermore, the pattern isn\u2019t &#39;unreachable!()&#39;, it\u2019s valid to call this function with the two states equal, I just don\u2019t want it to do anything."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 1445, "user_id": 594173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c93a9ca8d6e7ed662f3925a053a77b?s=128&d=identicon&r=PG", "display_name": "Michael Leonard", "link": "https://stackoverflow.com/users/594173/michael-leonard"}, "edited": false, "score": 0, "creation_date": 1541515407, "post_id": 53166375, "comment_id": 93238094, "body": "@MichaelLeonard As a general remark, of course it&#39;s best if the compiler can check your invariants statically.  If it can&#39;t, your next best option is a unit test. You&#39;d need to use the <code>EnumIter</code> derive macro from the <code>strum</code> crate to be able to iterate over all variants of the enum, but you would also need <code>_ =&gt; unreachable!()</code> to panic if the catch-all branch is entered."}, {"owner": {"reputation": 1445, "user_id": 594173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c93a9ca8d6e7ed662f3925a053a77b?s=128&d=identicon&r=PG", "display_name": "Michael Leonard", "link": "https://stackoverflow.com/users/594173/michael-leonard"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541516903, "post_id": 53166375, "comment_id": 93239006, "body": "@SvenMarnach, that&#39;s a good suggestion. That would clearly work in this example case, but the actual use case is a rust-embedded project which requires no_std crates, and I&#39;m not sure if <code>cargo test</code> even works in that situation (haven&#39;t tried it yet)."}, {"owner": {"reputation": 1445, "user_id": 594173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c93a9ca8d6e7ed662f3925a053a77b?s=128&d=identicon&r=PG", "display_name": "Michael Leonard", "link": "https://stackoverflow.com/users/594173/michael-leonard"}, "edited": false, "score": 0, "creation_date": 1541516991, "post_id": 53166375, "comment_id": 93239071, "body": "@DK. please update your answer to refer to refutable vs. irrefutable patterns and I will accept it. <a href=\"https://doc.rust-lang.org/book/second-edition/ch18-02-refutability.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/book/second-edition/ch18-02-refutability.h&zwnj;&#8203;tml</a>"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 1445, "user_id": 594173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c93a9ca8d6e7ed662f3925a053a77b?s=128&d=identicon&r=PG", "display_name": "Michael Leonard", "link": "https://stackoverflow.com/users/594173/michael-leonard"}, "edited": false, "score": 0, "creation_date": 1541517454, "post_id": 53166375, "comment_id": 93239356, "body": "@MichaelLeonard The tests would still be allowed to depend on <code>std</code>, right?  I mean, the tests are run on the development machine, not on the embedded device."}, {"owner": {"reputation": 1445, "user_id": 594173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c93a9ca8d6e7ed662f3925a053a77b?s=128&d=identicon&r=PG", "display_name": "Michael Leonard", "link": "https://stackoverflow.com/users/594173/michael-leonard"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541517894, "post_id": 53166375, "comment_id": 93239622, "body": "@SvenMarnach, yes the test harness can still depend on std, but testing the state machine would in general be a pretty hopeless endeavor since it is so closely tied to the hardware (I would need another engineer to write a hardware mock). However, I could probably just test for this condition, and do plan to add test cases for other things that don&#39;t depend on the hardware. I&#39;ll play with the idea today."}, {"owner": {"reputation": 1445, "user_id": 594173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c93a9ca8d6e7ed662f3925a053a77b?s=128&d=identicon&r=PG", "display_name": "Michael Leonard", "link": "https://stackoverflow.com/users/594173/michael-leonard"}, "edited": false, "score": 0, "creation_date": 1541526707, "post_id": 53166375, "comment_id": 93244627, "body": "@DK. wait, I guess I&#39;m still confused then. The core problem <i>is</i> refutability isn&#39;t it? The match guard is not part of the pattern but it does <b>make the pattern refutable</b>, therefore this arm can&#39;t be used by rust to reliably declare the pattern as exhaustive."}, {"owner": {"reputation": 44438, "user_id": 42353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f05e802879a805c03a55645dfcc0d4ea?s=128&d=identicon&r=PG", "display_name": "DK.", "link": "https://stackoverflow.com/users/42353/dk"}, "reply_to_user": {"reputation": 1445, "user_id": 594173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c93a9ca8d6e7ed662f3925a053a77b?s=128&d=identicon&r=PG", "display_name": "Michael Leonard", "link": "https://stackoverflow.com/users/594173/michael-leonard"}, "edited": false, "score": 0, "creation_date": 1541530056, "post_id": 53166375, "comment_id": 93246238, "body": "@MichaelLeonard: The pattern was <i>already</i> refutable.  The issue is that the <i>guard</i> can fail, even if the pattern matches."}], "tags": [], "owner": {"reputation": 44438, "user_id": 42353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f05e802879a805c03a55645dfcc0d4ea?s=128&d=identicon&r=PG", "display_name": "DK.", "link": "https://stackoverflow.com/users/42353/dk"}, "is_accepted": true, "score": 3, "last_activity_date": 1541517481, "last_edit_date": 1541517481, "creation_date": 1541483262, "answer_id": 53166375, "question_id": 53166245, "link": "https://stackoverflow.com/questions/53166245/why-is-a-match-pattern-with-a-guard-clause-not-exhaustive/53166375#53166375", "title": "Why is a match pattern with a guard clause not exhaustive?", "body": "<blockquote>\n  <p>Why doesn't this work as written?</p>\n</blockquote>\n\n<p>Because the Rust compiler cannot take guard expressions into account when determining if a <code>match</code> is exhaustive.  As soon as you have a guard, it assumes that guard could fail.</p>\n\n<p>Note that this has nothing to do with the distinction between <a href=\"https://doc.rust-lang.org/book/second-edition/ch18-02-refutability.html\" rel=\"nofollow noreferrer\">refutable and irrefutable patterns</a>.  <code>if</code> guards are <em>not</em> part of the pattern, they're part of the <code>match</code> syntax.</p>\n\n<blockquote>\n  <p>What is the cleanest way to do what I am trying to do?</p>\n</blockquote>\n\n<p>List every possible combination.  A macro <em>could</em> slightly shorten writing the patterns, but you can't use macros to replace entire <code>match</code> arms.</p>\n"}], "owner": {"reputation": 1445, "user_id": 594173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31c93a9ca8d6e7ed662f3925a053a77b?s=128&d=identicon&r=PG", "display_name": "Michael Leonard", "link": "https://stackoverflow.com/users/594173/michael-leonard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 469, "favorite_count": 0, "accepted_answer_id": 53166375, "answer_count": 1, "score": 4, "last_activity_date": 1541530692, "creation_date": 1541482310, "last_edit_date": 1541530692, "question_id": 53166245, "link": "https://stackoverflow.com/questions/53166245/why-is-a-match-pattern-with-a-guard-clause-not-exhaustive", "title": "Why is a match pattern with a guard clause not exhaustive?", "body": "<p>Consider the following code sample (<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=d253c4332ae64bb3e4371c19b4ccd264\" rel=\"nofollow noreferrer\">playground</a>).</p>\n\n<pre><code>#[derive(PartialEq, Clone, Debug)]\nenum State {\n    Initial,\n    One,\n    Two,\n}\n\nenum Event {\n    ButtonOne,\n    ButtonTwo,\n}\n\nstruct StateMachine {\n    state: State,\n}\n\nimpl StateMachine {\n    fn new() -&gt; StateMachine {\n        StateMachine {\n            state: State::Initial,\n        }\n    }\n\n    fn advance_for_event(&amp;mut self, event: Event) {\n        // grab a local copy of the current state\n        let start_state = self.state.clone();\n\n        // determine the next state required\n        let end_state = match (start_state, event) {\n            // starting with initial\n            (State::Initial, Event::ButtonOne) =&gt; State::One,\n            (State::Initial, Event::ButtonTwo) =&gt; State::Two,\n\n            // starting with one\n            (State::One, Event::ButtonOne) =&gt; State::Initial,\n            (State::One, Event::ButtonTwo) =&gt; State::Two,\n\n            // starting with two\n            (State::Two, Event::ButtonOne) =&gt; State::One,\n            (State::Two, Event::ButtonTwo) =&gt; State::Initial,\n        };\n\n        self.transition(end_state);\n    }\n\n    fn transition(&amp;mut self, end_state: State) {\n        // update the state machine\n        let start_state = self.state.clone();\n        self.state = end_state.clone();\n\n        // handle actions on entry (or exit) of states\n        match (start_state, end_state) {\n            // transitions out of initial state\n            (State::Initial, State::One) =&gt; {}\n            (State::Initial, State::Two) =&gt; {}\n\n            // transitions out of one state\n            (State::One, State::Initial) =&gt; {}\n            (State::One, State::Two) =&gt; {}\n\n            // transitions out of two state\n            (State::Two, State::Initial) =&gt; {}\n            (State::Two, State::One) =&gt; {}\n\n            // identity states (no transition)\n            (ref x, ref y) if x == y =&gt; {}\n\n            // ^^^ above branch doesn't match, so this is required\n            // _ =&gt; {},\n        }\n    }\n}\n\nfn main() {\n    let mut sm = StateMachine::new();\n\n    sm.advance_for_event(Event::ButtonOne);\n    assert_eq!(sm.state, State::One);\n\n    sm.advance_for_event(Event::ButtonOne);\n    assert_eq!(sm.state, State::Initial);\n\n    sm.advance_for_event(Event::ButtonTwo);\n    assert_eq!(sm.state, State::Two);\n\n    sm.advance_for_event(Event::ButtonTwo);\n    assert_eq!(sm.state, State::Initial);\n}\n</code></pre>\n\n<p>In the <code>StateMachine::transition</code> method, the code as presented does not compile:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0004]: non-exhaustive patterns: `(Initial, Initial)` not covered\n  --&gt; src/main.rs:52:15\n   |\n52 |         match (start_state, end_state) {\n   |               ^^^^^^^^^^^^^^^^^^^^^^^^ pattern `(Initial, Initial)` not covered\n</code></pre>\n\n<p>But that is exactly the pattern I'm trying to match! Along with the <code>(One, One)</code> edge and <code>(Two, Two)</code> edge. Importantly I specifically want this case because I want to leverage the compiler to ensure that every possible state transition is handled (esp. when new states are added later) and I know that identity transitions will always be a no-op.</p>\n\n<p>I can resolve the compiler error by uncommenting the line below that one (<code>_ =&gt; {}</code>) but then I lose the advantage of having the compiler check for valid transitions because this will match on any states added in the future.</p>\n\n<p>I could also resolve this by manually typing each identity transition such as:</p>\n\n<pre><code>(State::Initial, State::Initial) =&gt; {}\n</code></pre>\n\n<p>That is tedious, and at that point I'm just fighting the compiler. This could probably be turned into a macro, so I could possibly do something like:</p>\n\n<pre><code>identity_is_no_op!(State);\n</code></pre>\n\n<p>Or worst case:</p>\n\n<pre><code>identity_is_no_op!(State::Initial, State::One, State::Two);\n</code></pre>\n\n<p>The macro can automatically write this boilerplate any time a new state is added, but that feels like unnecessary work when the pattern I have written should be covering the exact case that I'm looking for.</p>\n\n<ol>\n<li>Why doesn't this work as written?</li>\n<li>What is the cleanest way to do what I am trying to do?</li>\n</ol>\n\n<hr>\n\n<p>I have decided that a macro of the second form (i.e. <code>identity_is_no_op!(State::Initial, State::One, State::Two);</code>) is actually the preferred solution.</p>\n\n<p>It's easy to imagine a future in which I do want some of the states to do something in the 'no transition' case. Using this macro would still have the desired effect of forcing the state machine to be revisited when new <code>State</code>s are added and would just require adding the new state to the macro arglist if nothing needs to be done. A reasonable compromise IMO.</p>\n\n<p>I think the question is still useful because the behavior was surprising to me as a relatively new Rustacean.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541483125, "post_id": 53164725, "comment_id": 93222562, "body": "As compiler say, you can&#39;t use impl in this context, please describe what you try to do because currently the best to solve your issue is to just propose to not write anycode. Explain what you try to do instead of the solution you try to implement."}, {"owner": {"reputation": 3566, "user_id": 5138648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fdbc41d6ae88135845b5d965dac0b13?s=128&d=identicon&r=PG", "display_name": "aSpex", "link": "https://stackoverflow.com/users/5138648/aspex"}, "edited": false, "score": 0, "creation_date": 1541484259, "post_id": 53164725, "comment_id": 93222887, "body": "I bet you need a <code>Result&lt;&amp;&#39;a dyn A, Error&gt;</code> here"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1541489637, "post_id": 53164725, "comment_id": 93224829, "body": "Your <code>create_a</code> function should propably accept an argument of <code>self</code>, either <code>self</code>, <code>&amp;self</code> or <code>&amp;mut self</code>."}], "answers": [{"tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": false, "score": -1, "last_activity_date": 1541490132, "creation_date": 1541490132, "answer_id": 53167635, "question_id": 53164725, "link": "https://stackoverflow.com/questions/53164725/how-can-i-create-a-trait-method-that-has-a-trait-as-a-return-argument/53167635#53167635", "title": "How can I create a trait method that has a trait as a return argument?", "body": "<p>There are multiple ways of returning a trait, all of them rely on some kind of indirection.</p>\n\n<ol>\n<li>You could return <code>Box&lt;A&gt;</code></li>\n<li>You could return <code>Rc&lt;A&gt;</code>/<code>Arc&lt;A&gt;</code></li>\n<li>You could use <code>&amp;dyn A</code></li>\n<li>You could use a type parameter <code>T</code></li>\n</ol>\n\n<p>The difference between 1, 2, 3 and 4 is <a href=\"https://doc.rust-lang.org/1.0.0-beta/book/static-and-dynamic-dispatch.html\" rel=\"nofollow noreferrer\">static vs dynamic dispatching</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1541510661, "post_id": 53167786, "comment_id": 93235306, "body": "There is one case where <code>create_a&lt;&#39;a&gt;()</code> can make sense (well, two if you count always returning <code>Err</code>): if the returned reference is actually <code>&#39;static</code>. However, I agree this is probably not what the OP really wants."}], "tags": [], "owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "is_accepted": true, "score": 6, "last_activity_date": 1541491147, "last_edit_date": 1541491147, "creation_date": 1541490828, "answer_id": 53167786, "question_id": 53164725, "link": "https://stackoverflow.com/questions/53164725/how-can-i-create-a-trait-method-that-has-a-trait-as-a-return-argument/53167786#53167786", "title": "How can I create a trait method that has a trait as a return argument?", "body": "<blockquote>\n  <p><code>fn create_a&lt;'a&gt;() -&gt; Result&lt;&amp;'a impl A, Error&gt;;</code></p>\n</blockquote>\n\n<p>There is no way to create a reference that will live as long as arbitrary lifetime without having an object that already has that lifetime and can act as its owner\u2014and you have no object here at all, so this signature makes no sense.</p>\n\n<p>For further argument I will assume you do have a <code>self</code> argument with that lifetime (it probably needs to be mutable too): <code>fn create_a&lt;'a&gt;(&amp;'a mut self) -&gt; Result&lt;&amp;'a impl A, Error&gt;;</code></p>\n\n<p>(note that since there is only one life-time that all mentioned references have, you can elide it: <code>fn create_a(&amp;mut self) -&gt; Result&lt;&amp;impl A, Error&gt;;</code>)</p>\n\n<p>Now there are two options:</p>\n\n<ul>\n<li><p>You can define the concrete type as member of that trait like</p>\n\n<pre><code>trait B {\n    type ImplA: A;\n    fn create_a(&amp;mut self) -&gt; Result&lt;&amp;ImplA, Error&gt;;\n}\n</code></pre>\n\n<p>This is not object-safe, but it will be statically dispatched.</p>\n\n<p>You should be able to use the <code>impl</code> type alias when implementing the trait to name the type if desired.</p></li>\n<li><p>If you do want <code>B</code> to be object-safe, use object reference, i.e.</p>\n\n<pre><code>trait B {\n    fn create_a(&amp;mut self) -&gt; Result&lt;&amp;dyn A, Error&gt;;\n}\n</code></pre>\n\n<p>this way dispatch to the return value is always dynamic, but you do that to allow dynamic dispatch to <code>B::create_a</code> in the first place anyway.</p></li>\n</ul>\n"}], "owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 365, "favorite_count": 0, "accepted_answer_id": 53167786, "answer_count": 2, "score": 1, "last_activity_date": 1541491147, "creation_date": 1541469003, "last_edit_date": 1541489579, "question_id": 53164725, "link": "https://stackoverflow.com/questions/53164725/how-can-i-create-a-trait-method-that-has-a-trait-as-a-return-argument", "title": "How can I create a trait method that has a trait as a return argument?", "body": "<p>I have a trait <code>B</code> that defines a function which returns a reference to an object that implements the trait <code>A</code>.</p>\n\n<pre><code>enum Error { }\n\ntrait A { }\n\ntrait B {\n    fn create_a&lt;'a&gt;() -&gt; Result&lt;&amp;'a impl A, Error&gt;;\n}\n</code></pre>\n\n<p>However, when I try to <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=0b414930b4f9b5377f6e2aca343e5186\" rel=\"nofollow noreferrer\">compile</a> I get the following error</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0562]: `impl Trait` not allowed outside of function and inherent method return types\n  --&gt; src/lib.rs:10:37\n   |\n10 |     fn create_a&lt;'a&gt;() -&gt; Result&lt;&amp;'a impl A, Error&gt;;\n   |                                     ^^^^^^\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541455790, "post_id": 53162931, "comment_id": 93216384, "body": "<i>to inherit the noise function from <code>Bird</code></i>. Who is going to implement <code>Animal::noise</code>? It&#39;s <b>not</b> the same method as <code>Bird::noise</code>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541455834, "post_id": 53162931, "comment_id": 93216406, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/47965967/155423\">\u201cSubclassing\u201d traits in Rust</a>. If you disagree, please <a href=\"https://stackoverflow.com/posts/53162931/edit\">edit</a> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541455973, "post_id": 53162931, "comment_id": 93216454, "body": "You should also go back and re-read <a href=\"https://doc.rust-lang.org/book/second-edition/ch17-00-oop.html\" rel=\"nofollow noreferrer\">Object Oriented Programming Features of Rust</a> in <i>The Rust Programming Language</i>."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541458795, "post_id": 53163499, "comment_id": 93217461, "body": "Does this answer mean you agree that the question has already been answered by the proposed duplicate?"}, {"owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541459819, "post_id": 53163499, "comment_id": 93217775, "body": "@Shepmaster its 90% the same answer. However the proposed duplicate is more &quot;multi-class&quot; than &quot;heirarchical-class&quot; (if I&#39;m understanding it correctly)"}], "tags": [], "owner": {"reputation": 420, "user_id": 236378, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d73cb546da468a0b03888ff822dd42af?s=128&d=identicon&r=PG", "display_name": "Shchvova", "link": "https://stackoverflow.com/users/236378/shchvova"}, "is_accepted": true, "score": 2, "last_activity_date": 1541459742, "last_edit_date": 1541459742, "creation_date": 1541458680, "answer_id": 53163499, "question_id": 53162931, "link": "https://stackoverflow.com/questions/53162931/how-do-i-implement-hierarchical-traits/53163499#53163499", "title": "How do I implement hierarchical traits?", "body": "<p>Simple answer: you can't. Rust doesn't have inheritance by design.\nRust doesn't have same object-oriented model as Java or C++.</p>\n\n<p>If you really want to do something like this, you can implement one trait for another with <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=386ba2d41a16ea896b798a7a4782b13f\" rel=\"nofollow noreferrer\">this</a> code</p>\n\n<pre><code>trait Animal {\n    fn noise(&amp;self) -&gt; String;\n    fn print_noise(&amp;self) {\n        print!(\"{}\", self.noise());\n    }\n}\n\ntrait Bird:Animal {}\n\nimpl&lt;T: Bird&gt; Animal for T {\n    fn noise(&amp;self) -&gt; String {\n        \"chirp\".to_string()\n    }\n}\n\n\nstruct Chicken {}\n\nimpl Bird for Chicken {}\n\nfn main() {\n    let chicken = Chicken{};\n    chicken.print_noise();\n}\n</code></pre>\n\n<p>As others, I would suggest reading <a href=\"https://doc.rust-lang.org/book/\" rel=\"nofollow noreferrer\">The Rust Programming Language</a> book, specifically <a href=\"https://doc.rust-lang.org/book/2018-edition/ch17-00-oop.html\" rel=\"nofollow noreferrer\">OOP</a> and <a href=\"https://doc.rust-lang.org/book/2018-edition/ch10-00-generics.html\" rel=\"nofollow noreferrer\">Traits and Generics</a> sections. It's free when reading online.</p>\n"}], "owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 394, "favorite_count": 0, "accepted_answer_id": 53163499, "answer_count": 1, "score": 2, "last_activity_date": 1541459742, "creation_date": 1541455630, "last_edit_date": 1541455738, "question_id": 53162931, "link": "https://stackoverflow.com/questions/53162931/how-do-i-implement-hierarchical-traits", "title": "How do I implement hierarchical traits?", "body": "<p>I have two traits in a hierarchy: <code>Animal</code> and <code>Bird</code>. How can I create a <code>Chicken</code> that implements <code>Bird</code>?</p>\n\n<pre><code>trait Animal {\n    fn noise(&amp;self) -&gt; String;\n    fn print_noise(&amp;self) {\n        print!(\"{}\", self.noise());\n    }\n}\n\ntrait Bird: Animal {\n    fn noise(&amp;self) -&gt; String {\n        \"chirp\"\n    }\n}\n\nstruct Chicken {}\n\nimpl Bird for Chicken {}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=88cbb993ecbd242740cb20fde37120b7\" rel=\"nofollow noreferrer\">playground</a></p>\n\n<p>When I try to compile, I get:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `Chicken: Animal` is not satisfied\n  --&gt; src/lib.rs:16:6\n   |\n16 | impl Bird for Chicken {}\n   |      ^^^^ the trait `Animal` is not implemented for `Chicken`\n</code></pre>\n\n<p>I don't want to implement <code>Animal</code> before <code>Bird</code>, because I want <code>Chicken</code> to inherit the <code>noise</code> function from <code>Bird</code>.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1541449095, "post_id": 53161339, "comment_id": 93213540, "body": "Possibly relevant: <a href=\"https://stackoverflow.com/questions/36664327/how-to-get-the-size-of-a-user-defined-struct-sizeof\">How to get the size of a user defined struct? (sizeof)</a> and <a href=\"https://stackoverflow.com/questions/36285396/whats-the-alternative-to-u32bits-in-a-const\">What&#39;s the alternative to u32::BITS in a const?</a>"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1541483354, "post_id": 53161339, "comment_id": 93222621, "body": "Note that use usize in a data format is a bad idea. Prefer something like u64 with bound checking. (That also why this function doesn&#39;t exist in byteorder)"}], "answers": [{"comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1541489473, "post_id": 53161506, "comment_id": 93224769, "body": "While this answer is technically correct (like all (?) of your answers) I would not suggest to do something like this and point out, that this is normally not a wanted behavior."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 3, "last_activity_date": 1541449582, "last_edit_date": 1541449582, "creation_date": 1541448692, "answer_id": 53161506, "question_id": 53161339, "link": "https://stackoverflow.com/questions/53161339/how-do-i-use-the-byteorder-crate-to-read-a-usize/53161506#53161506", "title": "How do I use the byteorder crate to read a usize?", "body": "<p>One way is to use <a href=\"https://doc.rust-lang.org/std/mem/fn.size_of.html\" rel=\"nofollow noreferrer\"><code>mem::size_of</code></a> to get the size of a <code>usize</code>:</p>\n\n<pre><code>use byteorder::{ByteOrder, ReadBytesExt};\n\nfn read_usize&lt;B, R&gt;(mut b: R) -&gt; Result&lt;usize, std::io::Error&gt;\nwhere\n    B: ByteOrder,\n    R: ReadBytesExt,\n{\n    b.read_uint::&lt;B&gt;(std::mem::size_of::&lt;usize&gt;()).map(|v| v as usize)\n}\n</code></pre>\n\n<p>Another is to have different functions or function implementations for different architectures:</p>\n\n<pre><code>fn read_usize&lt;B, R&gt;(mut b: R) -&gt; Result&lt;usize, std::io::Error&gt;\nwhere\n    B: ByteOrder,\n    R: ReadBytesExt,\n{\n    if cfg!(target_pointer_width = \"64\") {\n        b.read_u64::&lt;B&gt;().map(|v| v as usize)\n    } else if cfg!(target_pointer_width = \"32\") {\n        b.read_u32::&lt;B&gt;().map(|v| v as usize)\n    } else {\n        b.read_u16::&lt;B&gt;().map(|v| v as usize)\n    }\n}\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/36664327/155423\">How to get the size of a user defined struct? (sizeof)</a></li>\n<li><a href=\"https://stackoverflow.com/q/41896462/155423\">How to check in Rust if architecture is 32 or 64 bit?</a></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541515448, "post_id": 53167479, "comment_id": 93238116, "body": "I agree, but the OP specifically stated that they understand that they will get different results on different platforms. This is a design decision that is acceptable to make, so long as you understand the tradeoffs."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1541515505, "post_id": 53167479, "comment_id": 93238151, "body": "For example, &quot;the protocol&quot; might be a dump of RAM that is never supposed to cross architectures."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541515794, "post_id": 53167479, "comment_id": 93238321, "body": "In that case that it is helpful, yes."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541762461, "post_id": 53167479, "comment_id": 93336318, "body": "@Shepmaster In this case, you simply don&#39;t need ByteOrder. your platform will not change of endianess ;)"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1542210262, "post_id": 53167479, "comment_id": 93488582, "body": "For the record, <code>byteorder</code> extends <code>Read</code> and <code>Write</code> with primitive reading and writing functions (e.g. <code>read_u32</code>) and as such, is not completely useless when only working under the system&#39;s native endianness."}], "tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": false, "score": 3, "last_activity_date": 1541489322, "creation_date": 1541489322, "answer_id": 53167479, "question_id": 53161339, "link": "https://stackoverflow.com/questions/53161339/how-do-i-use-the-byteorder-crate-to-read-a-usize/53167479#53167479", "title": "How do I use the byteorder crate to read a usize?", "body": "<p>TL;DR there is a good reason for not providing a <code>read_usize</code> function, because it is not consistent on different cpu-architectures.</p>\n\n<hr>\n\n<p>This is a bad idea. Normally you have some kind of protocol you are trying to deserialize. This format should be independent from the cpu-architecture and therefore you can't read an usize, because it is cpu-dependent.</p>\n\n<p>Let's assume you have a simple protocol where you first have the size of an array and afterwards <code>n</code> elements. </p>\n\n<pre><code>+------+---------+\n| size | ....... |\n+------+---------+\n</code></pre>\n\n<p>Let's suppose the protocol says that your size is 4 byte long. Now you want to do the thing Shepmaster suggested and read the usize dependent on your architecture.  </p>\n\n<p>On a x86_64 OS you will now read 8 bytes and therefore swallow the first element in your array.<br>\nOn a Atmega8 your usize would be 2 bytes and therefore only take the first 2 bytes of your size (which might be zero in case there are less than 65k elements and a BigEndian byte-order).</p>\n\n<p>This is the reason why there is no <code>read_usize</code> function and it is correct. You need to decide how long your size is, read the exact amount of bytes from your slice and then us <code>as</code> to convert that into an <code>usize</code>.</p>\n"}], "owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 0, "accepted_answer_id": 53161506, "answer_count": 2, "score": 2, "last_activity_date": 1541489322, "creation_date": 1541447914, "last_edit_date": 1541448111, "question_id": 53161339, "link": "https://stackoverflow.com/questions/53161339/how-do-i-use-the-byteorder-crate-to-read-a-usize", "title": "How do I use the byteorder crate to read a usize?", "body": "<p>I'm writing an encoding library and I'd like to convert a <code>slice</code> into a <code>usize</code>.</p>\n\n<p>I see a <a href=\"https://docs.rs/byteorder/1.1.0/byteorder/trait.ReadBytesExt.html#method.read_uint\" rel=\"nofollow noreferrer\"><code>read_uint</code></a> method that looks promising, though I'm unsure how to get the register size as a variable so I can put it in the function.</p>\n\n<p>For example I'd like to get <code>32</code> on a 32 bit processor, and <code>64</code> on a 64 bit processor.</p>\n"}, {"tags": ["rust"], "owner": {"reputation": 9182, "user_id": 219449, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/70faf49f616436be935cb8b9512f7673?s=128&d=identicon&r=PG", "display_name": "Leonti", "link": "https://stackoverflow.com/users/219449/leonti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1220, "favorite_count": 0, "closed_date": 1541386418, "answer_count": 0, "score": 5, "last_activity_date": 1541424755, "creation_date": 1541383399, "last_edit_date": 1541397037, "question_id": 53147395, "link": "https://stackoverflow.com/questions/53147395/incompatible-types-with-correct-function-signatures", "closed_reason": "Duplicate", "title": "Incompatible types with correct function signatures", "body": "<p>I have 2 functions which return the same type <code>impl Future&lt;Item = (), Error = ()&gt;</code></p>\n\n<pre><code>extern crate tokio;\nextern crate futures;\n\nuse tokio::timer::Interval;\nuse std::time::{Duration, Instant};\nuse tokio::prelude::*;\nuse futures::future;\n\nfn run2() -&gt; impl Future&lt;Item = (), Error = ()&gt; {\n    future::ok(())\n}\n\nfn run() -&gt; impl Future&lt;Item = (), Error = ()&gt; {\n    Interval::new(Instant::now(), Duration::from_millis(1000))\n        .for_each(move |instant| {\n            println!(\"fire; instant={:?}\", instant);\n            Ok(())\n        })\n        .map_err(|e| panic!(\"interval errored; err={:?}\", e))\n}\n\nfn main_run() -&gt; impl Future&lt;Item = (), Error = ()&gt; {\n    if 1 == 1 {\n        run()\n    } else {\n        run2()\n    }\n}\n\nfn main() {\n    tokio::run(main_run());\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=c1bb1cf73f8db0d91ca19ffce253a7f0\" rel=\"nofollow noreferrer\">playground</a></p>\n\n<p>I'm trying to execute functions conditionally in <code>main_run</code>, but I get a weird error:</p>\n\n<pre><code>error[E0308]: if and else have incompatible types\n  --&gt; src/main.rs:23:5\n   |\n23 | /     if 1 == 1 {\n24 | |         run()\n25 | |     } else {\n26 | |         run2()\n27 | |     }\n   | |_____^ expected opaque type, found a different opaque type\n   |\n   = note: expected type `impl futures::Future` (opaque type)\n          found type `impl futures::Future` (opaque type)\n</code></pre>\n\n<p>Both functions return the same type: <code>impl Future&lt;Item = (), Error = ()&gt;</code><br>\nWhy is compiler not happy?</p>\n\n<p>EDIT:<br>\nSince it was a duplicate I found a solution in the response to the original question, however here is the solution to this particular question if someone stumbles upon this question in the future:</p>\n\n<pre><code>extern crate tokio;\nextern crate futures;\n\nuse tokio::timer::Interval;\nuse std::time::{Duration, Instant};\nuse tokio::prelude::*;\nuse futures::future;\n\nfn run2() -&gt; Box&lt;Future&lt;Item = (), Error = ()&gt; + Send&gt; {\n    Box::new(future::ok(()))\n}\n\nfn run() -&gt; Box&lt;Future&lt;Item = (), Error = ()&gt; + Send&gt; {\n    Box::new(Interval::new(Instant::now(), Duration::from_millis(1000))\n        .for_each(move |instant| {\n            println!(\"fire; instant={:?}\", instant);\n            Ok(())\n        })\n        .map_err(|e| panic!(\"interval errored; err={:?}\", e)))\n}\n\nfn main_run() -&gt; impl Future&lt;Item = (), Error = ()&gt; {\n    if 1 == 1 {\n        run()\n    } else {\n        run2()\n    }\n}\n\nfn main() {\n    tokio::run(main_run());\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=c9c52ab364ecd25b0f645111cf537d55\" rel=\"nofollow noreferrer\">playgound</a></p>\n"}, {"tags": ["generics", "rust", "traits"], "answers": [{"tags": [], "owner": {"reputation": 679, "user_id": 5155574, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FX9BZpOiVdk/AAAAAAAAAAI/AAAAAAAAAI0/cHgtmpGWfgM/photo.jpg?sz=128", "display_name": "Josh Abraham", "link": "https://stackoverflow.com/users/5155574/josh-abraham"}, "is_accepted": false, "score": 2, "last_activity_date": 1541380205, "last_edit_date": 1541380205, "creation_date": 1541379118, "answer_id": 53146983, "question_id": 53146982, "link": "https://stackoverflow.com/questions/53146982/how-does-one-pass-a-vect-to-a-function-when-the-trait-seek-is-required/53146983#53146983", "title": "How does one pass a Vec&lt;T&gt; to a function when the trait Seek is required?", "body": "<p>You can wrap the <code>Vec&lt;u8&gt;</code> in a <a href=\"https://doc.rust-lang.org/std/io/struct.Cursor.html\" rel=\"nofollow noreferrer\"><code>std::io::Cursor</code></a>:</p>\n\n<pre><code>let mut buf: Cursor&lt;Vec&lt;u8&gt;&gt; = Cursor::new(Vec::new());\nsome_func(&amp;mut buf);\n</code></pre>\n"}], "owner": {"reputation": 679, "user_id": 5155574, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FX9BZpOiVdk/AAAAAAAAAAI/AAAAAAAAAI0/cHgtmpGWfgM/photo.jpg?sz=128", "display_name": "Josh Abraham", "link": "https://stackoverflow.com/users/5155574/josh-abraham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "closed_date": 1541380154, "answer_count": 1, "score": 1, "last_activity_date": 1541380205, "creation_date": 1541379118, "last_edit_date": 1541380182, "question_id": 53146982, "link": "https://stackoverflow.com/questions/53146982/how-does-one-pass-a-vect-to-a-function-when-the-trait-seek-is-required", "closed_reason": "Duplicate", "title": "How does one pass a Vec&lt;T&gt; to a function when the trait Seek is required?", "body": "<p>I have an API that I need to pass a <code>Vec&lt;u8&gt;</code> to that requires its parameter to implement <code>std::io::Seek</code>:</p>\n\n<pre><code>fn some_func&lt;T: Seek + Write&gt;(foo: &amp;mut T) {/* body */}\n</code></pre>\n\n<p>The crate author suggests using a <code>File</code> here, however I want to avoid using that here as it would result in unneeded file creation. A <code>Vec&lt;u8&gt;</code> satisfies the <code>Write</code> trait, but not the <code>Seek</code> trait. Is there any way to avoid using a <code>File</code> here?</p>\n"}, {"tags": ["hashmap", "rust", "borrow-checker"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541373216, "post_id": 53146385, "comment_id": 93184133, "body": "Idiomatic Rust uses <code>snake_case</code> for variables, methods, macros, and fields; <code>UpperCamelCase</code> for types; and <code>SCREAMING_SNAKE_CASE</code> for statics and constants. Use <code>swap_names</code> instead, please."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541373415, "post_id": 53146385, "comment_id": 93184170, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/47773849/155423\">Borrow two mutable values from the same HashMap</a>. If you disagree, please <a href=\"https://stackoverflow.com/posts/53146385/edit\">edit</a> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 1901, "user_id": 101066, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/9fdd8c7a09dc22e7ddac63c2b8a642de?s=128&d=identicon&r=PG", "display_name": "Daniel Sorichetti", "link": "https://stackoverflow.com/users/101066/daniel-sorichetti"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541374814, "post_id": 53146385, "comment_id": 93184431, "body": "Thanks for the comments. I&#39;ll update my question as soon as I can."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541379785, "post_id": 53146385, "comment_id": 93185245, "body": "And to address the cloning-related comments: <a href=\"https://stackoverflow.com/q/27098694/155423\">How can I swap in a new value for a field in a mutable reference to a structure?</a>; <a href=\"https://stackoverflow.com/q/41035869/155423\">How to use a struct members as its own &#39;key&#39; when inserting the struct into a map without duplicating it?</a>"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1541428064, "post_id": 53146385, "comment_id": 93202971, "body": "<a href=\"https://stackoverflow.com/questions/52846885/how-can-i-mutate-other-elements-of-a-hashmap-when-using-the-entry-pattern\">How can I mutate other elements of a HashMap when using the entry pattern?</a> is at least as relevant. As in that question, you can&#39;t do this safely with the <code>entry</code> API because <code>or_insert</code> can cause the <code>HashMap</code> to be reallocated. You have to first insert both values, and then you can apply either of the answers to <a href=\"https://stackoverflow.com/questions/47773849/borrow-two-mutable-values-from-the-same-hashmap\">Borrow two mutable values from the same HashMap</a>"}, {"owner": {"reputation": 1081, "user_id": 2178427, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gymYO.png?s=128&g=1", "display_name": "hyperum", "link": "https://stackoverflow.com/users/2178427/hyperum"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541500533, "post_id": 53146385, "comment_id": 93230012, "body": "I just had your issue a week ago and the answer in @Shepmaster\u2019s link - RefCell - worked. Is there any reason why you don\u2019t want to use it?"}, {"owner": {"reputation": 1901, "user_id": 101066, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/9fdd8c7a09dc22e7ddac63c2b8a642de?s=128&d=identicon&r=PG", "display_name": "Daniel Sorichetti", "link": "https://stackoverflow.com/users/101066/daniel-sorichetti"}, "reply_to_user": {"reputation": 1081, "user_id": 2178427, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gymYO.png?s=128&g=1", "display_name": "hyperum", "link": "https://stackoverflow.com/users/2178427/hyperum"}, "edited": false, "score": 0, "creation_date": 1541528495, "post_id": 53146385, "comment_id": 93245507, "body": "@AaronCruz I feel like using RefCell involves a huge change in a lot of lines of my codebase (adding  borrow() or borrow_mut()). I&#39;d rather use that as a last resort."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541608300, "post_id": 53146385, "comment_id": 93276285, "body": "You can always attempt to detangle the aspects of your code that need to mutate from those that don&#39;t. Often makes code cleaner and can make it easier to maintain."}], "owner": {"reputation": 1901, "user_id": 101066, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/9fdd8c7a09dc22e7ddac63c2b8a642de?s=128&d=identicon&r=PG", "display_name": "Daniel Sorichetti", "link": "https://stackoverflow.com/users/101066/daniel-sorichetti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 297, "favorite_count": 0, "closed_date": 1541608204, "answer_count": 0, "score": 1, "last_activity_date": 1541608242, "creation_date": 1541372850, "last_edit_date": 1541373652, "question_id": 53146385, "link": "https://stackoverflow.com/questions/53146385/issue-with-hashmap-and-borrowing-as-mutable-more-than-once-at-a-time", "closed_reason": "Duplicate", "title": "Issue with HashMap and borrowing as mutable more than once at a time", "body": "<p>I can't figure out a way to hold elements inside a <code>HashMap</code> and edit them at the same time:</p>\n\n<pre><code>use std::collections::HashMap;\n\n#[derive(Clone, Debug)]\npub struct Alliance {\n    pub name: String,\n    pub id: u32,\n}\n\nfn main() {\n    let mut hashmap = HashMap::new();\n\n    let mut alliance1 = Alliance {\n        name: \"alliance_1\".to_string(),\n        id: 1,\n    };\n\n    let mut alliance2 = Alliance {\n        name: \"alliance_2\".to_string(),\n        id: 2,\n    };\n\n    // Do I really need to clone the name strings here?\n    let mut entry1 = hashmap.entry(alliance1.name.clone()).or_insert(alliance1);\n    let mut entry2 = hashmap.entry(alliance2.name.clone()).or_insert(alliance2);\n\n    swapNames(entry1, entry2);\n\n    println!(\"{}\", entry1.name);\n    println!(\"{}\", entry2.name);\n}\n\nfn swapNames(entry1: &amp;mut Alliance, entry2: &amp;mut Alliance) {\n    let aux = entry1.name.clone();\n    entry1.name = entry2.name.clone();\n    entry2.name = aux;\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=6673121f8fae7c8ca9000814f51334df\" rel=\"nofollow noreferrer\">playground</a></p>\n\n<p>I get an error which I agree with:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0499]: cannot borrow `hashmap` as mutable more than once at a time\n  --&gt; src/main.rs:24:22\n   |\n23 |     let mut entry1 = hashmap.entry(alliance1.name.clone()).or_insert(alliance1);\n   |                      ------- first mutable borrow occurs here\n24 |     let mut entry2 = hashmap.entry(alliance2.name.clone()).or_insert(alliance2);\n   |                      ^^^^^^^ second mutable borrow occurs here\n...\n30 | }\n   | - first borrow ends here\n</code></pre>\n\n<p>I just don't know how to code this in a way that compiles. I need to keep the <code>Alliance</code> structs mutable to further edit them down in the code (the <code>swapNames</code> function is just an example).</p>\n"}, {"tags": ["rust", "lifetime", "type-parameter"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1541363387, "post_id": 53144591, "comment_id": 93181561, "body": "Probably you should derive <code>Clone</code> for <code>Complex</code> and then implement the ops for <code>Complex</code> instead of <code>&amp;Complex</code>. This doesn&#39;t just bypass the issue, it&#39;s often faster than references for a small struct like this."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1541363711, "post_id": 53144591, "comment_id": 93181630, "body": "I&#39;d even go one step further and derive <code>Copy</code> for the complex number type, so you don&#39;t even have to clone explicitly."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1541364080, "post_id": 53144591, "comment_id": 93181744, "body": "@SvenMarnach Thanks, that&#39;s actually what I intended to write! (<code>Copy</code>, not <code>Clone</code>) :)"}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1541364475, "post_id": 53144591, "comment_id": 93181858, "body": "Your constraints on <code>&amp;&#39;a T</code> are unnecessary. In the end you are going to copy the <code>T</code> out of the other <code>Complex&lt;T&gt;</code> and move them into a new <code>Complex&lt;T&gt;</code>. There isn&#39;t a way to reference the original <code>T</code> here, so there is no point considering operations on <code>&amp;T</code>."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541364775, "post_id": 53144591, "comment_id": 93181944, "body": "You look like you want impl <a href=\"https://doc.rust-lang.org/std/ops/trait.AddAssign.html\" rel=\"nofollow noreferrer\">AddAssign</a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10056269"}, "edited": false, "score": 0, "creation_date": 1541365943, "post_id": 53144591, "comment_id": 93182285, "body": "I mentioned I was aware of the Clone/copy solution. Also note that the structure is not necessarily small. I could place an arbitrary precision float in there. That&#39;s why I&#39;m trying to add this case to the value-value Mul so that if one knows that ref-ref operations are fast for T, then they can take advantage of it. Lastly, I don&#39;t necessarily copy any of the T&#39;s out of the Complex. In the //details irrelevant section it&#39;s all handled with ref-ref operations on the parts of each complex."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541366778, "post_id": 53144591, "comment_id": 93182558, "body": "@Nim As a side note, adding <code>Sized</code> as a trait bound to a type parameter is redundant, since all type parameters get an implicit <code>Sized</code> bound.  You can use <code>T: ?Sized</code> to remove that implicit bound, but <code>T: Sized</code> doesn&#39;t actually do anything."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10056269"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541367330, "post_id": 53144591, "comment_id": 93182705, "body": "@SvenMarnach I see. I remember a long while ago I had issues with leaving that off. Was that changed at some point (mind you, last I used Rust was probably a year ago). Thanks!"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541367899, "post_id": 53144591, "comment_id": 93182841, "body": "@Nim No, this did not change recently.  Note that <i>type parameters</i> have an implicit <code>Sized</code> bound, but the <code>Self</code> type of a trait doesn&#39;t, so writing <code>trait A: Sized</code> actually makes a difference."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10056269"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541382802, "post_id": 53144591, "comment_id": 93185809, "body": "@Stargateur That&#39;s a good workaround also; Using MulAssign can be used in conjunction of cloning to maintain a minimal number of allocations (I&#39;m assuming the case that T is possible a large structure with clones being bad), which should keep the same work done for allocation. This also is very helpful with division, as the lifetime specification is much more difficult. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1541365360, "post_id": 53145354, "comment_id": 93182114, "body": "HRTB are not necessary here. All of the lifetimes here are known at the point of calling the <code>mul</code> method."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10056269"}, "edited": false, "score": 0, "creation_date": 1541365663, "post_id": 53145354, "comment_id": 93182207, "body": "Yeah, the HRTB&#39;s were what I needed. Been so long I had forgotten about them. Thanks! Just noting I already had the value-value stuff done. Just not shown as that was trivial, and I have reasons for not doing it that way (mentioned in reply to the question comments)."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1541365939, "post_id": 53145354, "comment_id": 93182283, "body": "@PeterHall I don&#39;t think so. The lifetime of the local variable <code>t</code> isn&#39;t known at that time."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541408775, "post_id": 53145354, "comment_id": 93192796, "body": "@Nim I added a more concise way of writing the trait bounds."}], "tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 1, "last_activity_date": 1541408691, "last_edit_date": 1541408691, "creation_date": 1541364731, "answer_id": 53145354, "question_id": 53144591, "link": "https://stackoverflow.com/questions/53144591/communicating-rust-lifetimes-for-type-parameters/53145354#53145354", "title": "Communicating Rust Lifetimes for Type Parameters", "body": "<p>As suggested by Peter Hall in the comments, the easiest solution is to derive <code>Copy</code> for your complex type, and implement the operations for values.  For the ref-ref implementations and the ref-val implementations, you can then simply dereference the references and use the val-val implementation.</p>\n\n<p>If you want to make the approach you started work, you need higher-rank trait bounds:</p>\n\n<pre><code>use std::ops::*;\n\n#[derive(Clone, PartialEq)]\npub struct Complex&lt;T: Clone&gt; {\n    pub re: T,\n    pub im: T,\n}\n\n// Ref-Ref Multiplication\nimpl&lt;'a, 'b, T: Clone&gt; Mul&lt;&amp;'b Complex&lt;T&gt;&gt; for &amp;'a Complex&lt;T&gt;\nwhere\n    T: Add&lt;T, Output = T&gt;,\n    T: Sub&lt;T, Output = T&gt;,\n    &amp;'a T: Add&lt;&amp;'b T, Output = T&gt;,\n    &amp;'a T: Mul&lt;&amp;'b T, Output = T&gt;,\n    &amp;'a T: Sub&lt;&amp;'b T, Output = T&gt;,\n{\n    type Output = Complex&lt;T&gt;;\n    fn mul(self, rhs: &amp;'b Complex&lt;T&gt;) -&gt; Complex&lt;T&gt; {\n        Complex {\n            re: &amp;self.re * &amp;rhs.re - &amp;self.im * &amp;rhs.im,\n            im: &amp;self.re * &amp;rhs.im + &amp;self.im * &amp;rhs.re,\n        }\n    }\n}\n\n// Ref-Value Multiplication\nimpl&lt;'a, T: Clone&gt; Mul&lt;Complex&lt;T&gt;&gt; for &amp;'a Complex&lt;T&gt;\nwhere\n    T: Add&lt;T, Output = T&gt;,\n    T: Sub&lt;T, Output = T&gt;,\n    &amp;'a T: for&lt;'b&gt; Add&lt;&amp;'b T, Output = T&gt;,\n    &amp;'a T: for&lt;'b&gt; Mul&lt;&amp;'b T, Output = T&gt;,\n    &amp;'a T: for&lt;'b&gt; Sub&lt;&amp;'b T, Output = T&gt;,\n{\n    type Output = Complex&lt;T&gt;;\n    fn mul(self, rhs: Complex&lt;T&gt;) -&gt; Complex&lt;T&gt; {\n        let t = &amp;rhs;\n        self.mul(t)\n    }\n}\n</code></pre>\n\n<p>In your version, the lifetime <code>'b</code> in the ref-value implementation is chosen by the user of the trait.  Since the user could use any lifetime for <code>'b</code>, <code>rhs</code> would need static lifetime for your code to be valid. What you want instead is that <code>*'a T</code> satisfies the given trait bounds for <em>any</em> given lifetime <code>'b</code>, which is exactly what HRTBs are for.</p>\n\n<p>An alternative, less repetitive way of writing the trait bounds for the second implementation is this:</p>\n\n<pre><code>impl&lt;'a, T: Clone&gt; Mul&lt;Complex&lt;T&gt;&gt; for &amp;'a Complex&lt;T&gt;\nwhere\n    Self: for&lt;'b&gt; Mul&lt;&amp;'b Complex&lt;T&gt;, Output = Complex&lt;T&gt;&gt;,\n{\n    type Output = Complex&lt;T&gt;;\n    fn mul(self, rhs: Complex&lt;T&gt;) -&gt; Complex&lt;T&gt; {\n        self.mul(&amp;rhs)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user10056269"}, "edited": false, "score": 0, "creation_date": 1541367198, "post_id": 53145418, "comment_id": 93182659, "body": "The clone/copy method is something I&#39;ve seen done in other implementations, and something I was aware of. I have a few reasons for why I&#39;m wanting to avoid that, primarily if T is a more complex structure (e.g. arbitrary precision float); in case ref-ref operations are faster on those. Also a quick question, as you mentioned I can&#39;t return reference to T; could you elaborate upon that? Is it not possible for T to be structure which could contain a reference of T? Something like  <code>struct A&lt;&#39;a&gt; (Option&lt;&amp;&#39;a A&gt;)</code> I assumed that&#39;s why my code wasn&#39;t compiling unless I&#39;m mistaken."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541372480, "post_id": 53145418, "comment_id": 93183990, "body": "@Nim If you want to return a reference, it would need to point to a value that existed before the<code>mul()</code> method was called; you can&#39;t return a reference to a new value you compute inside the method."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10056269"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541382458, "post_id": 53145418, "comment_id": 93185738, "body": "@SvenMarnach That&#39;s why I thought the error was occurring. I wanted some clarification, because it was worded as references in general couldn&#39;t be returned, hence my example. Just wanted to make sure I wasn&#39;t missing something subtle, other than the lifetime being too short to be acceptable."}], "tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 0, "last_activity_date": 1541365242, "creation_date": 1541365242, "answer_id": 53145418, "question_id": 53144591, "link": "https://stackoverflow.com/questions/53144591/communicating-rust-lifetimes-for-type-parameters/53145418#53145418", "title": "Communicating Rust Lifetimes for Type Parameters", "body": "<p>The built-in numeric types implement these permutations using a <a href=\"https://doc.rust-lang.org/src/core/internal_macros.rs.html\" rel=\"nofollow noreferrer\">macro</a>. Doing it by hand, I'd start with the case where you are multiplying two values, rather than any references, and make sure that your <code>Complex</code> struct is <code>Copy</code>:</p>\n\n<pre><code>impl&lt;T: Copy&gt; Mul&lt;Complex&lt;T&gt;&gt; for Complex&lt;T&gt;\nwhere\n    T: Add&lt;T, Output = T&gt;,\n    T: Sub&lt;T, Output = T&gt;,\n    T: Mul&lt;T, Output = T&gt;,\n{\n    type Output = Complex&lt;T&gt;;\n    fn mul(self, rhs: Complex&lt;T&gt;) -&gt; Complex&lt;T&gt; {\n        unimplemented!()\n    }\n}\n</code></pre>\n\n<p>Note that you don't need any constraints on <code>&amp;T</code> - you can't return references to <code>T</code> anyway, so you are going to have to copy them, which is why I've specified <code>T: Copy</code>.</p>\n\n<p>The rest of the implementations are now straightforward and can delegate to the simplest case:</p>\n\n<pre><code>impl&lt;'a, T: Copy&gt; Mul&lt;Complex&lt;T&gt;&gt; for &amp;'a Complex&lt;T&gt;\nwhere\n    T: Add&lt;T, Output = T&gt;,\n    T: Sub&lt;T, Output = T&gt;,\n    T: Mul&lt;T, Output = T&gt;,\n{\n    type Output = Complex&lt;T&gt;;\n    fn mul(self, rhs: Complex&lt;T&gt;) -&gt; Complex&lt;T&gt; {\n        (*self).mul(rhs)\n    }\n}\n\nimpl&lt;'a, T: Copy&gt; Mul&lt;&amp;'a Complex&lt;T&gt;&gt; for Complex&lt;T&gt;\nwhere\n    T: Add&lt;T, Output = T&gt;,\n    T: Sub&lt;T, Output = T&gt;,\n    T: Mul&lt;T, Output = T&gt;,\n{\n    type Output = Complex&lt;T&gt;;\n    fn mul(self, rhs: &amp;'a Complex&lt;T&gt;) -&gt; Complex&lt;T&gt; {\n        self.mul(*rhs)\n    }\n}\n\nimpl&lt;'a, 'b, T: Copy&gt; Mul&lt;&amp;'a Complex&lt;T&gt;&gt; for &amp;'b Complex&lt;T&gt;\nwhere\n    T: Add&lt;T, Output = T&gt;,\n    T: Sub&lt;T, Output = T&gt;,\n    T: Mul&lt;T, Output = T&gt;,\n{\n    type Output = Complex&lt;T&gt;;\n    fn mul(self, rhs: &amp;'a Complex&lt;T&gt;) -&gt; Complex&lt;T&gt; {\n        (*self).mul(*rhs)\n    }\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10056269"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 53145354, "answer_count": 2, "score": 1, "last_activity_date": 1541408691, "creation_date": 1541359888, "last_edit_date": 1541361664, "question_id": 53144591, "link": "https://stackoverflow.com/questions/53144591/communicating-rust-lifetimes-for-type-parameters", "title": "Communicating Rust Lifetimes for Type Parameters", "body": "<p>I'm working on a simple complex number example, and trying to implement ref-value/value-ref operations as follows:</p>\n\n<pre><code>use std::ops::*;\n\n#[derive(Clone, PartialEq)]\npub struct Complex&lt;T: Sized + Clone&gt; {\n    pub re: T,\n    pub im: T,\n}\n\n// Ref-Ref Multiplication\nimpl&lt;'a, 'b, T: Sized + Clone&gt; Mul&lt;&amp;'b Complex&lt;T&gt;&gt; for &amp;'a Complex&lt;T&gt;\nwhere\n    T: Add&lt;T, Output = T&gt;,\n    T: Sub&lt;T, Output = T&gt;,\n    &amp;'a T: Add&lt;&amp;'b T, Output = T&gt;,\n    &amp;'a T: Mul&lt;&amp;'b T, Output = T&gt;,\n    &amp;'a T: Sub&lt;&amp;'b T, Output = T&gt;,\n{\n    type Output = Complex&lt;T&gt;;\n    fn mul(self, rhs: &amp;'b Complex&lt;T&gt;) -&gt; Complex&lt;T&gt; {\n        panic!(\"// Details irrelevant\")\n    }\n}\n\n// Ref-Value Multiplication\nimpl&lt;'a, 'b, T: Sized + Clone&gt; Mul&lt;Complex&lt;T&gt;&gt; for &amp;'a Complex&lt;T&gt;\nwhere\n    T: 'static,\n    T: Add&lt;T, Output = T&gt;,\n    T: Sub&lt;T, Output = T&gt;,\n    &amp;'a T: Add&lt;&amp;'b T, Output = T&gt;,\n    &amp;'a T: Mul&lt;&amp;'b T, Output = T&gt;,\n    &amp;'a T: Sub&lt;&amp;'b T, Output = T&gt;,\n{\n    type Output = Complex&lt;T&gt;;\n    fn mul(self, rhs: Complex&lt;T&gt;) -&gt; Complex&lt;T&gt; {\n        let t = &amp;rhs;\n        self.mul(t)\n    }\n}\n</code></pre>\n\n<p>The ref-ref implementation works, and from what I understand it it takes in two references of differing lifetimes, and returns a complex value-type. The ref-value part is where I'm having an issue; When I compile, the error is that <code>rhs</code> doesn't live long enough. I believe I know why this is already, and that is that T could hold a reference (either direct or indirectly) to rhs when the value is returned, thus <code>rhs</code> goes out of scope, but <code>T</code> could hold a reference to it still.</p>\n\n<p>My question is how to communicate that <code>T</code> will not hold some reference to <code>rhs</code> in some shape or form.</p>\n\n<p>Some notes on things that I've tried so far or looked at:</p>\n\n<ol>\n<li>Changed the lifetime specification on either Mul implementation.</li>\n<li>Tried lifetime-inheritence, but this specifieds a reference held by <code>T</code> will live at least as long as <code>T</code>, so I think I need something more in the lines of \"at most.\"</li>\n<li>Looked at other implementations; Either does not implement the case, or just uses clone to bypass the issue.</li>\n</ol>\n"}, {"tags": ["rust", "future"], "answers": [{"comments": [{"owner": {"reputation": 24901, "user_id": 198927, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/eExki.jpg?s=128&g=1", "display_name": "Petrus Theron", "link": "https://stackoverflow.com/users/198927/petrus-theron"}, "edited": false, "score": 0, "creation_date": 1542615041, "post_id": 53142509, "comment_id": 93617094, "body": "Thank you, @Shepmaster! Can you show how to use this with a hyper::Body? When I call <code>body.some_bytes()</code>, I get &quot;no method named some_bytes found for type hyper::Body in the current scope&quot;"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 24901, "user_id": 198927, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/eExki.jpg?s=128&g=1", "display_name": "Petrus Theron", "link": "https://stackoverflow.com/users/198927/petrus-theron"}, "edited": false, "score": 0, "creation_date": 1542637007, "post_id": 53142509, "comment_id": 93628668, "body": "@PetrusTheron <code>some_bytes</code> represents the act of getting a <code>Stream</code> in some manner. hyper&#39;s <code>Body</code> is already a <code>Stream</code>."}, {"owner": {"reputation": 24901, "user_id": 198927, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/eExki.jpg?s=128&g=1", "display_name": "Petrus Theron", "link": "https://stackoverflow.com/users/198927/petrus-theron"}, "edited": false, "score": 0, "creation_date": 1542639585, "post_id": 53142509, "comment_id": 93630167, "body": "Then how do I limit the amount of bytes that the client can POST to prevent memory overruns?"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 5, "last_activity_date": 1541352562, "last_edit_date": 1541352562, "creation_date": 1541346390, "answer_id": 53142509, "question_id": 53142508, "link": "https://stackoverflow.com/questions/53142508/how-do-i-apply-a-limit-to-the-number-of-bytes-read-by-futuresstreamconcat2/53142509#53142509", "title": "How do I apply a limit to the number of bytes read by futures::Stream::concat2?", "body": "<p>One solution is to create a stream combinator that ends the stream once some threshold of bytes has passed. Here's one possible implementation:</p>\n\n<pre><code>struct TakeBytes&lt;S&gt; {\n    inner: S,\n    seen: usize,\n    limit: usize,\n}\n\nimpl&lt;S&gt; Stream for TakeBytes&lt;S&gt;\nwhere\n    S: Stream&lt;Item = Vec&lt;u8&gt;&gt;,\n{\n    type Item = Vec&lt;u8&gt;;\n    type Error = S::Error;\n\n    fn poll(&amp;mut self) -&gt; Poll&lt;Option&lt;Self::Item&gt;, Self::Error&gt; {\n        if self.seen &gt;= self.limit {\n            return Ok(Async::Ready(None)); // Stream is over\n        }\n\n        let inner = self.inner.poll();\n        if let Ok(Async::Ready(Some(ref v))) = inner {\n            self.seen += v.len();\n        }\n        inner\n    }\n}\n\ntrait TakeBytesExt: Sized {\n    fn take_bytes(self, limit: usize) -&gt; TakeBytes&lt;Self&gt;;\n}\n\nimpl&lt;S&gt; TakeBytesExt for S\nwhere\n    S: Stream&lt;Item = Vec&lt;u8&gt;&gt;,\n{\n    fn take_bytes(self, limit: usize) -&gt; TakeBytes&lt;Self&gt; {\n        TakeBytes {\n            inner: self,\n            limit,\n            seen: 0,\n        }\n    }\n}\n</code></pre>\n\n<p>This can then be chained onto the stream before <code>concat2</code>:</p>\n\n<pre><code>fn limited() -&gt; impl Future&lt;Item = Vec&lt;u8&gt;, Error = ()&gt; {\n    some_bytes().take_bytes(999).concat2()\n}\n</code></pre>\n\n<p>This implementation has caveats:</p>\n\n<ul>\n<li>it only works for <code>Vec&lt;u8&gt;</code>. You can introduce generics to make it more broadly applicable, of course.</li>\n<li>it allows for more bytes than the limit to come in, it just stops the stream after that point. Those types of decisions are application-dependent.</li>\n</ul>\n\n<p>Another thing to keep in mind is that you want to attempt to tackle this problem as low as you can \u2014 if the source of the data has already allocated a gigabyte of memory, placing a limit won't help as much.</p>\n"}], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 1, "accepted_answer_id": 53142509, "answer_count": 1, "score": 2, "last_activity_date": 1541354894, "creation_date": 1541346390, "last_edit_date": 1541354894, "question_id": 53142508, "link": "https://stackoverflow.com/questions/53142508/how-do-i-apply-a-limit-to-the-number-of-bytes-read-by-futuresstreamconcat2", "title": "How do I apply a limit to the number of bytes read by futures::Stream::concat2?", "body": "<p>An answer to <a href=\"https://stackoverflow.com/q/43419974/155423\">How do I read the entire body of a Tokio-based Hyper request?</a> suggests:</p>\n\n<blockquote>\n  <p>you may wish to establish some kind of cap on the number of bytes read [when using <code>futures::Stream::concat2</code>]</p>\n</blockquote>\n\n<p>How can I actually achieve this? For example, here's some code that mimics a malicious user who is sending my service an infinite amount of data:</p>\n\n<pre><code>extern crate futures; // 0.1.25\n\nuse futures::{prelude::*, stream};\n\nfn some_bytes() -&gt; impl Stream&lt;Item = Vec&lt;u8&gt;, Error = ()&gt; {\n    stream::repeat(b\"0123456789ABCDEF\".to_vec())\n}\n\nfn limited() -&gt; impl Future&lt;Item = Vec&lt;u8&gt;, Error = ()&gt; {\n    some_bytes().concat2()\n}\n\nfn main() {\n    let v = limited().wait().unwrap();\n    println!(\"{}\", v.len());\n}\n</code></pre>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "is_accepted": true, "score": 5, "last_activity_date": 1541309663, "creation_date": 1541309663, "answer_id": 53138056, "question_id": 53137724, "link": "https://stackoverflow.com/questions/53137724/associated-function-without-explicit-return-is-errore0308-mismatched-types/53138056#53138056", "title": "Associated function without explicit return is error[E0308]: mismatched types", "body": "<p>When you don't have an explicit return statement in your function, the expression after the last statement is returned. A statement is an expression or a declaration followed by a semicolon. In this function:</p>\n\n<pre><code>pub fn new() -&gt; Queue {\n    let q = Queue { older: Vec::new(), younger: Vec::new() };\n    q\n}\n</code></pre>\n\n<p>The expression after the last statement is <code>q</code>, so that is what is returned from the function. But in this function:</p>\n\n<pre><code>pub fn new() -&gt; Queue {\n    Queue { older: Vec::new(), younger: Vec::new() };\n}\n</code></pre>\n\n<p>There is no expression after the last statement. So the rust compiler automatically inserts the <code>()</code> expression, also known as the unit expression. That's why the compiler is suggesting that you remove the semicolon, then that line is no longer a statement, but an expression. Follow that suggestion.</p>\n"}], "owner": {"reputation": 5661, "user_id": 2541276, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/100001587714573/picture?type=large", "display_name": "Rajkumar Natarajan", "link": "https://stackoverflow.com/users/2541276/rajkumar-natarajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "closed_date": 1541343920, "accepted_answer_id": 53138056, "answer_count": 1, "score": 1, "last_activity_date": 1541343901, "creation_date": 1541305400, "last_edit_date": 1541343901, "question_id": 53137724, "link": "https://stackoverflow.com/questions/53137724/associated-function-without-explicit-return-is-errore0308-mismatched-types", "closed_reason": "Duplicate", "title": "Associated function without explicit return is error[E0308]: mismatched types", "body": "<p>I have the struct <code>Queue</code> and <code>new</code> associated function which compile fine:</p>\n\n<pre><code>pub struct Queue {\n    older: Vec&lt;char&gt;,\n    younger: Vec&lt;char&gt;,\n}\n\nimpl Queue {\n    pub fn new() -&gt; Queue {\n        let q = Queue {\n            older: Vec::new(),\n            younger: Vec::new(),\n        };\n        q\n    }\n}\n</code></pre>\n\n<p>I changed the new function:</p>\n\n<pre><code>impl Queue {\n    pub fn new() -&gt; Queue {\n        Queue {\n            older: Vec::new(),\n            younger: Vec::new(),\n        };\n    }\n}\n</code></pre>\n\n<p>When I compile, I get an error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n  --&gt; src/lib.rs:7:27\n   |\n7  |       pub fn new() -&gt; Queue {\n   |  ___________________________^\n8  | |         Queue {\n9  | |             older: Vec::new(),\n10 | |             younger: Vec::new(),\n11 | |         };\n   | |          - help: consider removing this semicolon\n12 | |     }\n   | |_____^ expected struct `Queue`, found ()\n   |\n   = note: expected type `Queue`\n              found type `()`\n</code></pre>\n\n<p>Why I get the below error. What is wrong with the function in my version?</p>\n"}, {"tags": ["rust", "borrow-checker"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 2, "creation_date": 1541337081, "post_id": 53137532, "comment_id": 93174047, "body": "If I <a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2015&amp;gist=7afd32c77449323f34ca70007af64837\" rel=\"nofollow noreferrer\">make edits to your code so that I get the borrowing error</a>, it compiles on nightly with <code>#![feature(nll)]</code>. See <a href=\"https://stackoverflow.com/questions/50251487/what-are-non-lexical-lifetimes\">What are non-lexical lifetimes?</a>"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 2, "creation_date": 1541337187, "post_id": 53137532, "comment_id": 93174079, "body": "Also tangentially relevant: <a href=\"https://stackoverflow.com/questions/40006219/why-is-it-discouraged-to-accept-a-reference-to-a-string-string-vec-vec-or\">Why is it discouraged to accept a reference to a String (&amp;String), Vec (&amp;Vec) or Box (&amp;Box) as a function argument?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 555, "user_id": 1505475, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bc72887d0b9f71cdbc2eeb5f9899d8f?s=128&d=identicon&r=PG", "display_name": "simon1505475", "link": "https://stackoverflow.com/users/1505475/simon1505475"}, "edited": false, "score": 0, "creation_date": 1541383745, "post_id": 53138294, "comment_id": 93185994, "body": "I like these solutions. What if I wanted to stick to the initial idea to basically implement the functions you showed us here? Shouldn&#39;t I be able to write something like:  ``` { let x;   { x = cache.get(key).clone() };   if let Some(v) = x { ... ``` Why doesn&#39;t that work?"}, {"owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "reply_to_user": {"reputation": 555, "user_id": 1505475, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bc72887d0b9f71cdbc2eeb5f9899d8f?s=128&d=identicon&r=PG", "display_name": "simon1505475", "link": "https://stackoverflow.com/users/1505475/simon1505475"}, "edited": false, "score": 1, "creation_date": 1541389186, "post_id": 53138294, "comment_id": 93186844, "body": "@simon1505475: Because when you clone an <code>Option&lt;&amp;String&gt;</code>, you still have an <code>Option&lt;&amp;String&gt;</code>. That&#39;s why I used <code>map</code> to take the reference out, and then I cloned it, because calling <code>clone</code> on a reference clones the referred object. However, I just learned about another function for <code>Option</code> that does what I did with <code>map</code>. <code>if let Some(v) = cache.get(key).cloned() { ...</code>. (not that it&#39;s <code>cloned</code> instead of <code>clone</code>) I&#39;ll be updating my answer to reflect it."}], "tags": [], "owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "is_accepted": true, "score": 3, "last_activity_date": 1541389436, "last_edit_date": 1541389436, "creation_date": 1541312541, "answer_id": 53138294, "question_id": 53137532, "link": "https://stackoverflow.com/questions/53137532/how-to-limit-the-scope-in-which-a-value-is-borrowed-in-rust/53138294#53138294", "title": "How to limit the scope in which a value is borrowed in Rust?", "body": "<p>The problem is that the lifetime of <code>v</code> is for the whole <code>if/else</code> block, even though it is not available in the <code>else</code> section. You can get around this by with the help of <code>Option::cloned</code>.</p>\n\n<pre><code>pub fn calc_deps(cache: &amp;mut HashMap&lt;String, String&gt;, key: &amp;String) -&gt; String {\n    if let Some(v) = cache.get(key).cloned() {\n        v\n    } else {\n        let r = String::from(\"computations\");\n        cache.insert(key.clone(), r.clone());\n        r\n    }\n}\n</code></pre>\n\n<p><code>Option::cloned</code> maps <code>Option&lt;&amp;T&gt;</code> to <code>Option&lt;T&gt;</code> by cloning the contents. So now <code>v</code> becomes <code>String</code> instead of <code>&amp;String</code>, and is no longer borrowing <code>cache</code>.</p>\n\n<p>Another option is to use the <code>HashMap::entry/or_insert_with</code> interface. It's probably more idiomatic, but it requires unconditionally cloning the <code>key</code>.</p>\n\n<pre><code>pub fn calc_deps(cache: &amp;mut HashMap&lt;String, String&gt;, key: String) -&gt; String {\n    cache\n        .entry(key)\n        .or_insert_with(|| String::from(\"computations\"))\n        .clone()\n}\n</code></pre>\n\n<p>You could also simply use <code>or_insert</code> instead of <code>or_insert_with</code>, but that would require doing your computations for <code>r</code> unconditionally.</p>\n\n<pre><code>pub fn calc_deps(cache: &amp;mut HashMap&lt;String, String&gt;, key: String) -&gt; String {\n    cache\n        .entry(key)\n        .or_insert(String::from(\"computations\"))\n        .clone()\n}\n</code></pre>\n"}], "owner": {"reputation": 555, "user_id": 1505475, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bc72887d0b9f71cdbc2eeb5f9899d8f?s=128&d=identicon&r=PG", "display_name": "simon1505475", "link": "https://stackoverflow.com/users/1505475/simon1505475"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "closed_date": 1541342574, "accepted_answer_id": 53138294, "answer_count": 1, "score": 0, "last_activity_date": 1541389436, "creation_date": 1541302427, "last_edit_date": 1541336662, "question_id": 53137532, "link": "https://stackoverflow.com/questions/53137532/how-to-limit-the-scope-in-which-a-value-is-borrowed-in-rust", "closed_reason": "Duplicate", "title": "How to limit the scope in which a value is borrowed in Rust?", "body": "<p>I\u2019m trying to do some memoization in Rust and I\u2019m running afoul of the borrow checker. </p>\n\n<pre><code>fn calc_deps(cache: &amp;mut HashMap&lt;String, String&gt;, key: &amp;String) -&gt; String {\n    if let Some(v) = cache.get(key) {\n        v\n    } else {\n        let r = /* computations */\n        cache.insert(key.clone(),r.clone());\n        r\n    }\n}\n</code></pre>\n\n<p>I\u2019m told that cache is borrowed twice. Why is it a problem if I\u2019m done with get by the time I get to insert? Is there a way for me to encode that information? </p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1541299800, "post_id": 53137252, "comment_id": 93167651, "body": "Why should rust have this equivalent ? Describe your problem, here your are just bumping a concept from one language to another language. Rust is strongly type, having a dataView is not needed in general."}, {"owner": {"reputation": 1035, "user_id": 2854284, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a66cede09ad91417502051a3a146210a?s=128&d=identicon&r=PG", "display_name": "curiousdannii", "link": "https://stackoverflow.com/users/2854284/curiousdannii"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541307941, "post_id": 53137252, "comment_id": 93168483, "body": "@Stargateur Of course it&#39;s not needed in general, but it is helpful in some situations, which I outlined above. My specific use case is for a virtual machine, but that doesn&#39;t need to be in the question. I could manually write my own code using a u8 array, but I&#39;d like to know what other people with similar use cases do."}], "answers": [{"comments": [{"owner": {"reputation": 1035, "user_id": 2854284, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a66cede09ad91417502051a3a146210a?s=128&d=identicon&r=PG", "display_name": "curiousdannii", "link": "https://stackoverflow.com/users/2854284/curiousdannii"}, "edited": false, "score": 0, "creation_date": 1541335113, "post_id": 53140729, "comment_id": 93173592, "body": "Thanks for this, it&#39;s very helpful. So your recommendation would be to use a cursor and seek when random access is needed? I guess as most times you&#39;re reading more than a single value from each seek this wouldn&#39;t end up as a lot more code than the JS DataView pattern where you explicitly pass in the address each time, maybe even less code."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 1035, "user_id": 2854284, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a66cede09ad91417502051a3a146210a?s=128&d=identicon&r=PG", "display_name": "curiousdannii", "link": "https://stackoverflow.com/users/2854284/curiousdannii"}, "edited": false, "score": 0, "creation_date": 1541342801, "post_id": 53140729, "comment_id": 93175584, "body": "@curiousdannii: Actually, I would simply build the <code>Cursor</code> on the fly. Starting from a <code>memory: &amp;[u8]</code>, I&#39;d jump slice it with <code>split_at(offset).1</code> and build a <code>Cursor</code> on top: <code>let mut cursor = Cursor::new(memory.split_at(offset).1);</code>. This avoids having to keep a <code>Cursor</code> around and presumes you already keep the memory around, of course :)"}], "tags": [], "owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "is_accepted": true, "score": 4, "last_activity_date": 1541343143, "last_edit_date": 1541343143, "creation_date": 1541333816, "answer_id": 53140729, "question_id": 53137252, "link": "https://stackoverflow.com/questions/53137252/whats-the-equivalent-to-javascripts-dataview-in-rust/53140729#53140729", "title": "What&#39;s the equivalent to JavaScript&#39;s DataView in Rust?", "body": "<p>As a systems language, Rust natively has the ability to interact with raw memory, without requiring a specific wrapper.</p>\n\n<p>Therefore, reading a <code>u32</code> out of memory simply requires a sprinkling of <code>unsafe</code>:</p>\n\n<pre><code>fn read_u32(bytes: &amp;[u8]) -&gt; u32 {\n    assert!(bytes.as_ptr() as usize % std::mem::align_of::&lt;u32&gt;() == 0);\n    assert!(bytes.len() &gt;= 4);\n\n    unsafe { *(bytes.as_ptr() as *const u32) }\n}\n</code></pre>\n\n<p>This raw ability can be used to build better abstractions. Notably, abstractions taking care of alignment and endianness.</p>\n\n<hr>\n\n<p>The <code>byteorder</code> crate provides such abstraction: the <code>LitteEndian</code> and <code>BigEndian</code> types both implement the <a href=\"https://docs.rs/byteorder/1.2.7/byteorder/trait.ByteOrder.html\" rel=\"nofollow noreferrer\"><code>ByteOrder</code></a> trait.</p>\n\n<p>The above function can be improved to:</p>\n\n<pre><code>fn read_u32(bytes: &amp;[u8]) -&gt; u32 { LittleEndian::read_u32(bytes) }\n</code></pre>\n\n<p>which will take care of:</p>\n\n<ul>\n<li>Performing the conversion.</li>\n<li>Handling unaligned access evenly, instead of panicking.</li>\n<li>With explicit endianness.</li>\n</ul>\n\n<hr>\n\n<p>It only really accounts for primitive types, though, which is where the <code>bytes</code> crate steps in.</p>\n\n<p>For example, let's decode a <a href=\"https://en.wikipedia.org/wiki/User_Datagram_Protocol#Packet_structure\" rel=\"nofollow noreferrer\">UDP Header</a>:</p>\n\n<pre><code>use std::io::Cursor;\nuse bytes::buf::Buf;\n\nstruct UdpHeader {\n    src_port: u16,\n    dst_port: u16,\n    length: u16,\n    checksum: u16,\n}\n\nfn read_udp_header&lt;T: AsRef&lt;[u8]&gt;&gt;(bytes: &amp;mut Cursor&lt;T&gt;) -&gt; UdpHeader {\n    UdpHeader {\n        src_port: bytes.read_u16_be(),\n        dst_port: bytes.read_u16_be(),\n        length: bytes.read_u16_be(),\n        checksum: bytes.read_u16_be(),\n    }\n}\n</code></pre>\n\n<p>Which uses the <a href=\"https://doc.rust-lang.org/nightly/std/io/struct.Cursor.html\" rel=\"nofollow noreferrer\"><code>Cursor</code></a> struct from standard library and its implementation of the <a href=\"https://docs.rs/bytes/0.4.10/bytes/buf/trait.Buf.html\" rel=\"nofollow noreferrer\"><code>Buf</code></a> trait from <code>bytes</code>.</p>\n\n<p>You can create the cursor around a slice of bytes (<code>&amp;[u8]</code>) starting at any point of memory; reading from it advances it, positioning it for the next read, and it will handle alignment, endianness and bounds-checking.</p>\n\n<p><em>Note: unfortunately, there doesn't appear to be a version returning <code>Option&lt;u16&gt;</code>; I'd probably extend it if this was a concern.</em></p>\n\n<hr>\n\n<p>Thus I think you've got the right idea with the listed crates, they cover all the requirements you laid out.</p>\n"}], "owner": {"reputation": 1035, "user_id": 2854284, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a66cede09ad91417502051a3a146210a?s=128&d=identicon&r=PG", "display_name": "curiousdannii", "link": "https://stackoverflow.com/users/2854284/curiousdannii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 151, "favorite_count": 0, "accepted_answer_id": 53140729, "answer_count": 1, "score": 1, "last_activity_date": 1541343143, "creation_date": 1541298399, "last_edit_date": 1541343041, "question_id": 53137252, "link": "https://stackoverflow.com/questions/53137252/whats-the-equivalent-to-javascripts-dataview-in-rust", "title": "What&#39;s the equivalent to JavaScript&#39;s DataView in Rust?", "body": "<p>In JavaScript, a <code>DataView</code> is used when you need to access a block of memory with:</p>\n\n<ul>\n<li>differing width types (<code>uint8</code>, <code>uint16</code>, <code>uint32</code>, <code>float32</code> etc)</li>\n<li>non-aligned data</li>\n<li>specific endianness</li>\n</ul>\n\n<p><code>DataView</code>s are commonly used for networking code, parsing and creating binary file formats, and for implementing virtual machines. While the first two could make do with only sequential access, virtual machines which use a <code>DataView</code> as their RAM need to be able to access it freely (randomly even!)</p>\n\n<p>Is there a corresponding library in Rust? I've seen <a href=\"https://crates.io/crates/bytes/\" rel=\"nofollow noreferrer\">bytes</a> and <a href=\"https://crates.io/crates/byteorder/\" rel=\"nofollow noreferrer\">byteorder</a> but they seem more designed for streaming/sequential access rather than free random access.</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1541295009, "post_id": 53136717, "comment_id": 93167059, "body": "The message say, you must use nightly compiler. <a href=\"https://github.com/rust-lang-nursery/rustup.rs/blob/master/README.md#working-with-nightly-rust\" rel=\"nofollow noreferrer\">github.com/rust-lang-nursery/rustup.rs/blob/master/&hellip;</a> and more info, <a href=\"https://doc.rust-lang.org/book/2018-edition/appendix-06-nightly-rust.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/book/2018-edition/&hellip;</a> after installed you can just use <code>cargo +nightly build</code>"}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 61, "last_activity_date": 1617714625, "last_edit_date": 1617714625, "creation_date": 1541297124, "answer_id": 53137160, "question_id": 53136717, "link": "https://stackoverflow.com/questions/53136717/errore0554-feature-may-not-be-used-on-the-stable-release-channel-couldnt/53137160#53137160", "title": "error[E0554]: #![feature] may not be used on the stable release channel Couldn&#39;t install racer using cargo", "body": "<p>As the error message states, you cannot compile that code with stable Rust. You need to install nightly Rust and then use it to compile the program:</p>\n<pre class=\"lang-none prettyprint-override\"><code>rustup install nightly\ncargo +nightly install racer\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/q/48593858/155423\">How to execute cargo test using the nightly channel?</a></li>\n<li><a href=\"https://stackoverflow.com/q/22758779/155423\">Is it possible to have multiple coexisting Rust installations?</a></li>\n<li><a href=\"https://stackoverflow.com/q/55230896/155423\">Rocket requires a minimum version of Rust nightly, but a higher stable version is already installed</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 564, "user_id": 8425985, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-kBQ5KWvCEdo/AAAAAAAAAAI/AAAAAAAAQ20/zFjEyjMV4nw/photo.jpg?sz=128", "display_name": "Fiddy Bux", "link": "https://stackoverflow.com/users/8425985/fiddy-bux"}, "is_accepted": false, "score": 3, "last_activity_date": 1562356178, "last_edit_date": 1562356178, "creation_date": 1562354542, "answer_id": 56908311, "question_id": 53136717, "link": "https://stackoverflow.com/questions/53136717/errore0554-feature-may-not-be-used-on-the-stable-release-channel-couldnt/56908311#56908311", "title": "error[E0554]: #![feature] may not be used on the stable release channel Couldn&#39;t install racer using cargo", "body": "<p>I received error 0554 when trying to compile source code using the stable channel for <code>armv7-unknown-linux-gnueabihf</code>. </p>\n\n<p>It failed because the application uses features not available in the stable channel.</p>\n\n<p>The solution was to install the nightly channel with:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>rustup install nightly\n</code></pre>\n\n<p>And then to compile with:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cargo +nightly build --target=armv7-unknown-linux-gnueabihf\n</code></pre>\n\n<p>That did it for me.</p>\n\n<p>Don't be tempted to follow the syntax offered when rustup installs the nightly channel, because it won't work:</p>\n\n<pre><code>cargo build --target=nightly-armv7-unknown-linux-gnueabihf\n</code></pre>\n"}], "owner": {"reputation": 5661, "user_id": 2541276, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/100001587714573/picture?type=large", "display_name": "Rajkumar Natarajan", "link": "https://stackoverflow.com/users/2541276/rajkumar-natarajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16832, "favorite_count": 11, "accepted_answer_id": 53137160, "answer_count": 2, "score": 52, "last_activity_date": 1617714625, "creation_date": 1541291051, "last_edit_date": 1541297001, "question_id": 53136717, "link": "https://stackoverflow.com/questions/53136717/errore0554-feature-may-not-be-used-on-the-stable-release-channel-couldnt", "title": "error[E0554]: #![feature] may not be used on the stable release channel Couldn&#39;t install racer using cargo", "body": "<p>I'm trying to install racer using cargo, so I executed the command <code>cargo install racer</code> in the terminal and  it resulted in the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0554]: #![feature] may not be used on the stable release channel\n--&gt; /home/rajkumar/.cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-0.1.2/src/lib.rs:47:34\n|\n47 | #![cfg_attr(feature = \"nightly\", feature(macro_vis_matcher))]\n|                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nerror[E0554]: #![feature] may not be used on the stable release channel\n--&gt; /home/rajkumar/.cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-0.1.2/src/lib.rs:48:34\n|\n48 | #![cfg_attr(feature = \"nightly\", feature(allow_internal_unstable))]\n|                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nerror: aborting due to 2 previous errors\n\nFor more information about this error, try `rustc --explain E0554`.\nerror: failed to compile `racer v2.1.10`, intermediate artifacts can be found at `/tmp/cargo-install5YWPWW`\n\nCaused by:\nCould not compile `scoped-tls`.\n\nTo learn more, run the command again with --verbose.\n</code></pre>\n\n<p>Below are my Rust details:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$rustc --version\nrustc 1.30.0 (da5f414c2 2018-10-24)\n\n&gt; rustup --version \nrustup 1.14.0 (1e51b07cc 2018-10-04)\n\n&gt; cargo --version \ncargo 1.30.0 (36d96825d 2018-10-24)\n</code></pre>\n\n<p>Below is my opensuse version details:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>&gt; cat /usr/lib/os-release \nNAME=\"openSUSE Tumbleweed\"\n# VERSION=\"20181029\"\nID=\"opensuse-tumbleweed\"\nID_LIKE=\"opensuse suse\"\nVERSION_ID=\"20181029\"\nPRETTY_NAME=\"openSUSE Tumbleweed\"\nANSI_COLOR=\"0;32\"\nCPE_NAME=\"cpe:/o:opensuse:tumbleweed:20181029\"\nBUG_REPORT_URL=\"https://bugs.opensuse.org\"\nHOME_URL=\"https://www.opensuse.org/\"\n</code></pre>\n\n<p>Why am I not able to install racer using cargo? Am I missing anything?</p>\n"}, {"tags": ["rust", "rust-macros"], "comments": [{"owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "edited": false, "score": 2, "creation_date": 1541284055, "post_id": 53135923, "comment_id": 93165231, "body": "The reference probably isn&#39;t the best place to go for documentation on procedural macros - have you read <a href=\"https://doc.rust-lang.org/book/second-edition/appendix-04-macros.html#procedural-macros-for-custom-derive\" rel=\"nofollow noreferrer\">the &#39;Macros&#39; appendix from the Rust book</a> and the API docs for the <a href=\"https://doc.rust-lang.org/proc_macro/index.html\" rel=\"nofollow noreferrer\"><code>proc_macro</code></a> built-in library? They&#39;d be the best places to start, in my opinion."}, {"owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "edited": false, "score": 2, "creation_date": 1541284504, "post_id": 53135923, "comment_id": 93165331, "body": "The general gist of how procedural macros work is that they take in a <code>TokenStream</code> (in this case, it&#39;d be the tokens that make up the definition of <code>Example</code>), and then run a piece of code that generates a new <code>TokenStream</code> to add to the program (this would be the tokens that make up the <code>set_fields</code> definition). People generally use the <code>syn</code> crate to translate the input tokens to a proper Rust syntax tree, and the <code>quote</code> crate to generate the output."}], "answers": [{"comments": [{"owner": {"reputation": 4093, "user_id": 86381, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/9b9101201d96a4a5eec2cb81c633c3c5?s=128&d=identicon&r=PG", "display_name": "ehdv", "link": "https://stackoverflow.com/users/86381/ehdv"}, "edited": false, "score": 2, "creation_date": 1549487633, "post_id": 53136446, "comment_id": 95924150, "body": "To make parsing easier, I&#39;ve built <a href=\"https://crates.io/crates/darling\" rel=\"nofollow noreferrer\">darling</a>. It exposes a <code>serde</code>-like API where you define a struct for the arguments your macro needs, and then pass it a <code>syn::DeriveInput</code>. It handles parsing, field validation, duplicate field checking, and error creation."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 19, "last_activity_date": 1541288297, "last_edit_date": 1541288297, "creation_date": 1541287912, "answer_id": 53136446, "question_id": 53135923, "link": "https://stackoverflow.com/questions/53135923/how-to-write-a-custom-derive-macro/53136446#53136446", "title": "How to write a custom derive macro?", "body": "<ol>\n<li><p>Create a crate for your procedural macros:</p>\n\n<pre><code>cargo new my_derive --lib\n</code></pre></li>\n<li><p>Edit the Cargo.toml to make it a procedural macro crate:</p>\n\n<pre><code>[lib]\nproc-macro = true\n</code></pre></li>\n<li><p>Implement your procedural macro:</p>\n\n<pre><code>extern crate proc_macro;\n\nuse proc_macro::TokenStream;\n\n#[proc_macro_derive(MyMacroHere)]\npub fn my_macro_here_derive(input: TokenStream) -&gt; TokenStream { \n    // ...\n}\n</code></pre></li>\n<li><p>Import the procedural macro and use it:</p>\n\n<pre><code>extern crate my_derive;\n\nuse my_derive::MyMacroHere;\n\n#[derive(MyMacroHere)]\nstruct Example {\n    id: i64,\n    value: Option&lt;String&gt;,\n}\n</code></pre></li>\n</ol>\n\n<hr>\n\n<p>The hard part is in implementation of the macro. Most people use the <a href=\"https://crates.io/crates/syn\" rel=\"noreferrer\">syn</a> and <a href=\"https://crates.io/crates/quote\" rel=\"noreferrer\">quote</a> crates to parse the incoming Rust code and then generate new code.</p>\n\n<p>For example, syn's documentation starts with <a href=\"https://docs.rs/syn/0.15.18/syn/#example-of-a-custom-derive\" rel=\"noreferrer\">an example of a custom derive</a>. You will parse the struct (or enum or union) and then handle the various ways of defining a struct (unit, tuple, named fields). You'll collect the information you need (type, maybe name), then you'll generate the appropriate code.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://doc.rust-lang.org/book/second-edition/appendix-04-macros.html#procedural-macros-for-custom-derive\" rel=\"noreferrer\">Procedural Macros for Custom <code>derive</code></a></li>\n<li><a href=\"https://doc.rust-lang.org/proc_macro/\" rel=\"noreferrer\">Documentation for <code>proc_macro</code></a></li>\n<li><a href=\"https://docs.rs/syn/\" rel=\"noreferrer\">Documentation for <code>syn</code></a></li>\n<li><a href=\"https://docs.rs/quote/\" rel=\"noreferrer\">Documentation for <code>quote</code></a></li>\n<li><a href=\"https://stackoverflow.com/q/32626316/155423\">Is it possible to add your own derivable traits, or are these fixed by the compiler?</a></li>\n</ul>\n"}], "owner": {"reputation": 1054, "user_id": 3478959, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b52236406c4b6e4fa0bb619db556cf14?s=128&d=identicon&r=PG&f=1", "display_name": "Lev", "link": "https://stackoverflow.com/users/3478959/lev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5174, "favorite_count": 5, "accepted_answer_id": 53136446, "answer_count": 1, "score": 15, "last_activity_date": 1553121245, "creation_date": 1541282854, "last_edit_date": 1541288071, "question_id": 53135923, "link": "https://stackoverflow.com/questions/53135923/how-to-write-a-custom-derive-macro", "title": "How to write a custom derive macro?", "body": "<p>I'm trying to write my own derive mode macro in Rust, and the <a href=\"https://doc.rust-lang.org/reference/procedural-macros.html#derive-mode-macros\" rel=\"noreferrer\">documentation</a> on it is somewhat lacking in examples.</p>\n\n<p>I have a struct like:</p>\n\n<pre><code>#[derive(MyMacroHere)]\nstruct Example {\n    id: i64,\n    value: Option&lt;String&gt;,\n}\n</code></pre>\n\n<p>I want my macro to generate a method \u00e0 la </p>\n\n<pre><code>fn set_fields(&amp;mut self, id: i64, value: Option&lt;String&gt;) {\n    // ...\n}\n</code></pre>\n\n<p>What are the basic steps to use the <code>TokenStream</code> trait to achieve something like that?</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "edited": false, "score": 0, "creation_date": 1541273027, "post_id": 53134465, "comment_id": 93162681, "body": "You have your terminology backwards - <code>common</code> and <code>server</code> are projects within a workspace, not workspaces in a project."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "edited": false, "score": 0, "creation_date": 1541276343, "post_id": 53134465, "comment_id": 93163504, "body": "@JoeClay The general terminology in the docs is that a <i>workspace</i> contains multiple <i>packages</i> or <i>crates</i>."}], "answers": [{"tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 3, "last_activity_date": 1541276511, "creation_date": 1541276511, "answer_id": 53135175, "question_id": 53134465, "link": "https://stackoverflow.com/questions/53134465/how-can-i-build-a-specific-package-in-a-workspace/53135175#53135175", "title": "How can I build a specific package in a workspace?", "body": "<p>You can use the <code>--package</code> or <code>-p</code> flag to <code>cargo build</code>:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>cargo build                # build packages listed in the default-members key\ncargo build --all          # build all packages\ncargo build --package foo  # build the package \"foo\"\ncargo build -p foo         # ditto\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 694, "user_id": 620672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52c60241e2c149163ce4101e6a153205?s=128&d=identicon&r=PG", "display_name": "Ken", "link": "https://stackoverflow.com/users/620672/ken"}, "is_accepted": false, "score": 0, "last_activity_date": 1614655526, "creation_date": 1614655526, "answer_id": 66432867, "question_id": 53134465, "link": "https://stackoverflow.com/questions/53134465/how-can-i-build-a-specific-package-in-a-workspace/66432867#66432867", "title": "How can I build a specific package in a workspace?", "body": "<p>The first answer not work with:</p>\n<pre><code>error: package ID specification `foo` matched no packages\n</code></pre>\n<p>The correct way is:</p>\n<h2>find out <code>pkgid</code> first:</h2>\n<pre><code>$ cd server\n$ cargo pkgid\n</code></pre>\n<blockquote>\n<p>file:///dw/path/to/server:4.0.0-SNAPSHOT</p>\n</blockquote>\n<h2>Goto workspace folder and run <code>build</code></h2>\n<pre><code>$ cd -\ncargo build -p file:///dw/path/to/server:4.0.0-SNAPSHOT\n</code></pre>\n"}], "owner": {"reputation": 5661, "user_id": 2541276, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/100001587714573/picture?type=large", "display_name": "Rajkumar Natarajan", "link": "https://stackoverflow.com/users/2541276/rajkumar-natarajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 451, "favorite_count": 0, "accepted_answer_id": 53135175, "answer_count": 2, "score": 1, "last_activity_date": 1614655526, "creation_date": 1541271157, "last_edit_date": 1541276837, "question_id": 53134465, "link": "https://stackoverflow.com/questions/53134465/how-can-i-build-a-specific-package-in-a-workspace", "title": "How can I build a specific package in a workspace?", "body": "<p>I have two packages in my Cargo project. <code>Cargo.toml</code> looks like this:</p>\n\n<pre><code>[workspace]\nmembers = [\"common\", \"server\"]\n</code></pre>\n\n<p>When I run <code>cargo build --all</code> it compiles all the packages.</p>\n\n<p>I want to build only the <code>common</code> package.  If I do <code>cd common</code> and do <code>cargo build</code> it is working fine.</p>\n\n<p>But in the root directory, if I do <code>cargo build common</code>, the build is giving this error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: Found argument 'common' which wasn't expected, or isn't valid in this context\n\nUSAGE:\n    cargo build [OPTIONS]\n\nFor more information try --help\n</code></pre>\n\n<p>Is it possible to build a specific package?</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1541266057, "post_id": 53133637, "comment_id": 93160853, "body": "I think you should only put <code>[workspace]</code> inside the root manifest and so remove <code>[package]</code> and <code>[dependencies]</code>, put that only in the manifest inside <code>server</code> and <code>common</code>."}, {"owner": {"reputation": 5661, "user_id": 2541276, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/100001587714573/picture?type=large", "display_name": "Rajkumar Natarajan", "link": "https://stackoverflow.com/users/2541276/rajkumar-natarajan"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541270149, "post_id": 53133637, "comment_id": 93161991, "body": "@Stargateur - You are right. That works. I would&#39;ve accepted your answer if you answered the question."}], "answers": [{"tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 4, "last_activity_date": 1541325847, "creation_date": 1541325847, "answer_id": 53139624, "question_id": 53133637, "link": "https://stackoverflow.com/questions/53133637/how-to-build-multi-workspace-cargo-project-in-rust/53139624#53139624", "title": "How to build multi workspace cargo project in rust", "body": "<p>You included a <code>[package]</code> section in your main <code>Cargo.toml</code> file.  This section indicates that you want to build a main package in addition to the packages in the workspace.  However, you don't have any source files for the main package, so Cargo complains.</p>\n\n<p>The solution is to simply omit the <code>[package]</code> section, and only include <code>[workspace]</code>.  This configures a <em>virtual workspace</em> \u2013 a workspace that is only a container for member packages, but does not build a package itself.</p>\n\n<p>See the <a href=\"https://github.com/SergioBenitez/Rocket/blob/master/Cargo.toml\" rel=\"nofollow noreferrer\">main <code>Cargo.toml</code> file of Rocket</a> for a real-world example of a virtual workspace, and <a href=\"https://github.com/tokio-rs/tokio/blob/master/Cargo.toml\" rel=\"nofollow noreferrer\">Tokio</a> for a real-world example of a workspace with a main package.</p>\n"}], "owner": {"reputation": 5661, "user_id": 2541276, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/100001587714573/picture?type=large", "display_name": "Rajkumar Natarajan", "link": "https://stackoverflow.com/users/2541276/rajkumar-natarajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2365, "favorite_count": 0, "accepted_answer_id": 53139624, "answer_count": 1, "score": 2, "last_activity_date": 1541325847, "creation_date": 1541265075, "last_edit_date": 1541271516, "question_id": 53133637, "link": "https://stackoverflow.com/questions/53133637/how-to-build-multi-workspace-cargo-project-in-rust", "title": "How to build multi workspace cargo project in rust", "body": "<p>I have multi-workspace Cargo project. It has two workspaces, <code>common</code> and <code>server</code>. <code>common</code> is a <code>lib</code> project and server is a <code>bin</code> project.</p>\n\n<p>The location of the project in Github is <a href=\"https://github.com/rajcspsg/multi_module_cargo_project\" rel=\"nofollow noreferrer\">here.</a></p>\n\n<p>Below is the project structure.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>.\n\u251c\u2500\u2500 Cargo.toml\n\u251c\u2500\u2500 common\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Cargo.toml\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 src\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 lib.rs\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 server\n    \u251c\u2500\u2500 Cargo.toml\n    \u2514\u2500\u2500 src\n        \u2514\u2500\u2500 main.rs\n\n4 directories, 6 files\n</code></pre>\n\n<p>And the file contents of ./Cargo.toml file is </p>\n\n<pre><code>[package]\nname = \"multi_module_cargo_project\"\nversion = \"0.1.0\"\nauthors = [\"rajkumar\"]\n\n[workspace]\nmembers = [\"common\", \"server\"]\n\n[dependencies]\n</code></pre>\n\n<p>When I run the command <code>cargo build --all</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: failed to parse manifest at `/home/rajkumar/Coding/Rust/ProgrammingRust/multi_module_cargo_project/Cargo.toml`\n\nCaused by:\nno targets specified in the manifest\neither src/lib.rs, src/main.rs, a [lib] section, or [[bin]] section must be present\n</code></pre>\n\n<p>So I added below in <code>Cargo.toml</code> but still couldn't build the project.</p>\n\n<pre><code>[[bin]]\nname = \"server/src/main.rs\"\n</code></pre>\n\n<p>How can I build the project. What I'm missing?</p>\n"}, {"tags": ["rust", "pattern-matching", "smart-pointers"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541255819, "post_id": 53132035, "comment_id": 93158103, "body": "Deref is explained <a href=\"https://doc.rust-lang.org/std/ops/trait.Deref.html#tymethod.deref\" rel=\"nofollow noreferrer\">here</a>. As you can see its return a reference."}, {"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541255947, "post_id": 53132035, "comment_id": 93158134, "body": "@Stargateur Unfortunately that confuses more than it helps. While <code>foo.deref()</code> returns a reference, <code>*foo</code> does not (necessarily). In fact, <code>*foo</code> desugars to <code>*(foo.deref())</code>, where the <code>*</code> in this case derefs the reference returned by <code>deref()</code>. See <a href=\"https://stackoverflow.com/questions/31624743/why-is-the-return-type-of-derefderef-itself-a-reference\">this Q&amp;A</a>."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "edited": false, "score": 0, "creation_date": 1541256362, "post_id": 53132035, "comment_id": 93158237, "body": "@LukasKalbertodt Sometime I hate rust. <code>&amp;*</code> this should not exist."}, {"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541256879, "post_id": 53132035, "comment_id": 93158359, "body": "@Stargateur It&#39;s a unfortunate source of confusion, true. And I dislike the syntax, too. But there is not really another way in the current language. People expect <code>*foo</code> to not be a reference. So if you want a reference, an additional <code>&amp;</code> is just required. And we can&#39;t just change the <code>Deref</code> trait because what would you return instead? By value doesn&#39;t work. If Rust could return lvalues somehow, yeah, then it might be possible. But that&#39;s a complex language features that&#39;s probably not very useful apart from this situation. Language design is handling trade-offs ;-)"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "edited": false, "score": 0, "creation_date": 1541257283, "post_id": 53132035, "comment_id": 93158469, "body": "@LukasKalbertodt What wrong with keep <code>Deref</code> as it is, and just <code>*</code> doesn&#39;t expend to <code>*(foo.deref())</code> but just as expected <code>foo.deref()</code>... This choice is very strange to me. I prefer <code>**</code> to get the value than <code>&amp;*</code> to get a reference from a value from a reference."}], "answers": [{"comments": [{"owner": {"reputation": 291, "user_id": 759323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d0f1993ce5a41c960ba3e87f6efd729?s=128&d=identicon&r=PG", "display_name": "soulsource", "link": "https://stackoverflow.com/users/759323/soulsource"}, "edited": false, "score": 0, "creation_date": 1541257116, "post_id": 53132340, "comment_id": 93158427, "body": "I was of course assuming that in the real usage the enum holds (potentially lots of inline) data, and that using this data as function parameters in the match arms would cause the move of it onto the stack. Anyhow, my question is answered: I only have to be careful to use references inside the match arms to make sure only pointers get placed onto the stack."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "reply_to_user": {"reputation": 291, "user_id": 759323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d0f1993ce5a41c960ba3e87f6efd729?s=128&d=identicon&r=PG", "display_name": "soulsource", "link": "https://stackoverflow.com/users/759323/soulsource"}, "edited": false, "score": 0, "creation_date": 1541258791, "post_id": 53132340, "comment_id": 93158857, "body": "@soulsource You can afford to be less careful if you match against <code>&amp;*boxed_value</code> instead of <code>*boxed_value</code>. Because of match ergonomics, described by Shepmaster&#39;s answer, when you match against a reference, bindings to internal values are auto-referenced, and the compiler will stop you if you try to move out of one. <a href=\"https://rust.godbolt.org/z/9CCIcE\" rel=\"nofollow noreferrer\">Compare the code generated with and without the <code>&amp;</code></a>."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "reply_to_user": {"reputation": 291, "user_id": 759323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d0f1993ce5a41c960ba3e87f6efd729?s=128&d=identicon&r=PG", "display_name": "soulsource", "link": "https://stackoverflow.com/users/759323/soulsource"}, "edited": false, "score": 0, "creation_date": 1541429698, "post_id": 53132340, "comment_id": 93203994, "body": "@soulsource Also, it&#39;s tangential, but enums containing a lot of inline data can be bad for performance and memory usage, unless all the variants are roughly the same size. E.g., a value of type <code>Option&lt;[u8; 1000]&gt;</code> always consumes 1001 bytes even when it is <code>None</code>. You might consider <code>Box</code>ing some of that big data for this reason, which would make the cost of copying, if not unimportant, at least less important."}], "tags": [], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "is_accepted": true, "score": 3, "last_activity_date": 1608369558, "last_edit_date": 1608369558, "creation_date": 1541255813, "answer_id": 53132340, "question_id": 53132035, "link": "https://stackoverflow.com/questions/53132035/how-to-pattern-match-on-values-inside-a-type-implementing-deref-such-as-box-wi/53132340#53132340", "title": "How to pattern match on values inside a type implementing Deref, such as Box, without copying the contents?", "body": "<p><strong>First</strong>: in Rust, there are no implicit costly copies, unlike in, for example, C++. Whereas in C++, the default action is &quot;deep copy&quot; (via copy constructor or similar), the default action in Rust is moving. A move is a shallow copy which (a) is usually very small and cheap and (b) can be removed by the optimizer in most cases. To get deep clones in Rust you have manually use <code>.clone()</code>. If you don't do that, <strong>you usually don't really have to worry about this</strong>.</p>\n<p><strong>Second</strong>: matching on an enum only looks at the <em>discriminant</em> of that enum (unless you bind enum fields, see below). That's the &quot;tag&quot; or the &quot;metadata&quot; which specifies which variant of the enum is stored in a value. That tag is tiny: it fits in 8 bits in almost all cases (enums with more than 256 variants are rare). So you don't need to worry about that. And in your case, we have a C-like enum without any fields. So the enum only stores the tag and hence is tiny, too.</p>\n<p>So what about enum fields that might be costly to copy? Like this:</p>\n<pre><code>enum SomeEnum {\n    SomeEntry(String),\n    AnotherEntry,\n}\n\nlet boxed_value = Box::new(SomeEnum::AnotherEntry);\n\nmatch *boxed_value {\n    SomeEnum::SomeEntry(s) =&gt; drop::&lt;String&gt;(s), // make sure we own the string\n    SomeEnum::AnotherEntry =&gt; {},\n}\n</code></pre>\n<p>So in this case one variant stores a <code>String</code>. Since deep-copying a string is somewhat costly, Rust won't do it implicitly. In the match arm we try to drop <code>s</code> and assert it's a <code>String</code>. That means we (meaning: the body of the match arm) own the string. So, if the match arm owns it but we didn't get the owned value from cloning it, that means that the outer function doesn't own it anymore. And in fact, if you try to use <code>boxed_value</code> after the match, you will get move errors from the compiler. So again, either you get a compiler error or no bad things automatically happen.</p>\n<p>Furthermore, you can write <code>SomeEnum::SomeEntry(ref s)</code> in the <code>match</code>. In that case, the string is bound by reference to <code>s</code> (so the <code>drop()</code> call won't work anymore). In that case, we never move from <code>boxed_value</code>. This is something I call &quot;deferred moving&quot;, but I'm not sure if that's an official term for it. But it just means: when pattern matching, the input value is not moved at all until a binding in the pattern moves from it.</p>\n<p>Lastly, please take a look at <a href=\"https://rust.godbolt.org/z/2rMbnq\" rel=\"nofollow noreferrer\">this code and the generated assembly</a>. The assembly is optimal. So once again: while you might be worried about accidental clones when you come from the C++ world, this is not really something you need to worry about in Rust.</p>\n"}], "owner": {"reputation": 291, "user_id": 759323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d0f1993ce5a41c960ba3e87f6efd729?s=128&d=identicon&r=PG", "display_name": "soulsource", "link": "https://stackoverflow.com/users/759323/soulsource"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 919, "favorite_count": 0, "accepted_answer_id": 53132340, "answer_count": 1, "score": 2, "last_activity_date": 1608369558, "creation_date": 1541253601, "last_edit_date": 1541255805, "question_id": 53132035, "link": "https://stackoverflow.com/questions/53132035/how-to-pattern-match-on-values-inside-a-type-implementing-deref-such-as-box-wi", "title": "How to pattern match on values inside a type implementing Deref, such as Box, without copying the contents?", "body": "<p>I have data contained inside a <code>Box</code>, and would like to pattern match on it without accidentally copying the <code>Box</code>'s contents from the heap to the stack; how do I do that?</p>\n\n<p>Let's assume the following code:</p>\n\n<pre><code>enum SomeEnum {\n    SomeEntry,\n    AnotherEntry,\n}\n\nfn main() {\n    let boxed_value = Box::new(SomeEnum::AnotherEntry);\n\n    match *boxed_value {\n        SomeEnum::SomeEntry =&gt; {}\n        SomeEnum::AnotherEntry =&gt; {}\n    }\n}\n</code></pre>\n\n<p>Does this copy the enum out of the box onto the stack and pattern match on that copy, or does it do the matching directly on the value pointed to by the box?</p>\n\n<p>What about this variant?</p>\n\n<pre><code>use std::ops::Deref;\n\nenum SomeEnum {\n    SomeEntry,\n    AnotherEntry,\n}\n\nfn main() {\n    let boxed_value = Box::new(SomeEnum::AnotherEntry);\n\n    match boxed_value.deref() {\n        SomeEnum::SomeEntry =&gt; {}\n        SomeEnum::AnotherEntry =&gt; {}\n    }\n}\n</code></pre>\n\n<p>It seems that simply dereferencing a box does not automatically create a copy, otherwise one would not be able to create a reference to the contained value by using <code>let x = &amp;*boxed_value</code>. This leads to a question about this syntax:</p>\n\n<pre><code>enum SomeEnum {\n    SomeEntry,\n    AnotherEntry,\n}\n\nfn main() {\n    let boxed_value = Box::new(SomeEnum::AnotherEntry);\n\n    match &amp;*boxed_value {\n        SomeEnum::SomeEntry =&gt; {}\n        SomeEnum::AnotherEntry =&gt; {}\n    }\n}\n</code></pre>\n"}, {"tags": ["compilation", "rust", "rust-cargo"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1541231663, "post_id": 53127722, "comment_id": 93152891, "body": "You should define different macros depending on what features are selected in <code>common</code>, so feature selection happens at compile time and only in the <code>common</code> crate.  Then you only need to declare the features in that crate, and switching the features will have global effect, as long as all crates use the same version of<code>common</code>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541255206, "post_id": 53127722, "comment_id": 93157957, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/40021555/155423\">How do I &#39;pass down&#39; feature flags to subdependencies in Cargo?</a>. If you disagree, please <a href=\"https://stackoverflow.com/posts/53127722/edit\">edit</a> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 738, "user_id": 4496839, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/050b67773c3fcf861e786289b932daeb?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan1729", "link": "https://stackoverflow.com/users/4496839/ryan1729"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541268826, "post_id": 53127722, "comment_id": 93161666, "body": "@SvenMarnach That certainly sounds like less setup and maintenance than passing the flags to every single crate. If I understand correctly you are suggesting defining multiple macro with the same name and selecting which are enabled with attributes like <code>#[cfg(feature = &quot;logging&quot;)]</code> and <code>#[cfg(not(feature = &quot;logging&quot;))]</code>. That works. And at least in my toy example I only need to mention the features in the main  and <code>common</code>&#39;s <code>Cargo.toml</code> files!"}, {"owner": {"reputation": 738, "user_id": 4496839, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/050b67773c3fcf861e786289b932daeb?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan1729", "link": "https://stackoverflow.com/users/4496839/ryan1729"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541269115, "post_id": 53127722, "comment_id": 93161738, "body": "@Shepmaster I suppose that previous answer might have technically allowed me to figure out the answer, but I found gnzlbg &#39;s explanation more helpful than just pointing to small paragraph of documentation I missed. Go ahead and mark this question as you please though."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541269121, "post_id": 53127722, "comment_id": 93161740, "body": "@Ryan1729 Yes, that&#39;s what I meant.  I can expand in an answer now that I&#39;m at my desk (wrote the comment on mobile)."}], "answers": [{"tags": [], "owner": {"reputation": 6527, "user_id": 1422197, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6bcbddbd9c7b31aaff8cf25a356bc96c?s=128&d=identicon&r=PG", "display_name": "gnzlbg", "link": "https://stackoverflow.com/users/1422197/gnzlbg"}, "is_accepted": true, "score": 5, "last_activity_date": 1541255162, "last_edit_date": 1541255162, "creation_date": 1541243195, "answer_id": 53130702, "question_id": 53127722, "link": "https://stackoverflow.com/questions/53127722/how-can-i-activate-features-in-all-my-crates/53130702#53130702", "title": "How can I activate features in all my crates?", "body": "<blockquote>\n  <p>How can I enable and disable features across multiple crates?</p>\n</blockquote>\n\n<p>A <code>Cargo.toml</code> can add features that transitively enable other features which are allowed to belong to dependencies. </p>\n\n<p>For example, in the <code>Cargo.toml</code> of a crate which depends on crates <code>foo</code> and <code>bar</code>: </p>\n\n<pre><code>[dependencies]\nfoo = \"0.1\"\nbar = \"0.1\"\n\n[features]\ndefault = []\ninvariant-checking = [ \"foo/invariant-checking\", \"bar/invariant-checking\" ]\nlogging = [ \"foo/logging\", \"bar/logging\" ]\n</code></pre>\n\n<p>This crate adds the <code>invariant-checking</code> and <code>logging</code> features. Enabling them transitively enables the respective features of the crates <code>foo</code> and <code>bar</code>, so that </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cargo build --features=logging,invariant-checking\n</code></pre>\n\n<p>will enable the <code>logging</code> and <code>invariant-checking</code> features in this crate and also in its dependencies <code>foo</code> and <code>bar</code> as well.</p>\n\n<p>In your particular case, you probably want <code>main</code> to transitively enable the features of <code>middle</code> and <code>common</code>, and for <code>middle</code> to transitively enable the features of <code>common</code>. </p>\n"}, {"comments": [{"owner": {"reputation": 738, "user_id": 4496839, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/050b67773c3fcf861e786289b932daeb?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan1729", "link": "https://stackoverflow.com/users/4496839/ryan1729"}, "edited": false, "score": 0, "creation_date": 1541270899, "post_id": 53134364, "comment_id": 93162149, "body": "I had assumed that <code>if cfg!(...) { &#47;*...*&#47; }</code> would be easy to remove by the compiler. I tried out some simple examples on <a href=\"https://godbolt.org/z/Q2Nnex\" rel=\"nofollow noreferrer\">godbolt</a> and it seems like those are successfully removed. It&#39;s possible that more complex cases with lots of <code>cfg!</code> calls aren&#39;t though, so this technique seems useful since it should work in every case."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 738, "user_id": 4496839, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/050b67773c3fcf861e786289b932daeb?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan1729", "link": "https://stackoverflow.com/users/4496839/ryan1729"}, "edited": false, "score": 0, "creation_date": 1541277324, "post_id": 53134364, "comment_id": 93163712, "body": "@Ryan1729 if the configuration setting is known statically at compile time, the optimizer should <i>always</i> be able to resolve the branch statically.  However, the fact that this is a runtime check was only a side note.  The more important point is the context in which the feature gets resolved.  This version resolves all feature queries in the <code>common</code> crate, while your version resolved them in the crate that uses the macro."}], "tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": false, "score": 1, "last_activity_date": 1541270357, "creation_date": 1541270357, "answer_id": 53134364, "question_id": 53127722, "link": "https://stackoverflow.com/questions/53127722/how-can-i-activate-features-in-all-my-crates/53134364#53134364", "title": "How can I activate features in all my crates?", "body": "<p>The macro definitions in their current form have a problem:  The code inside the macro gets inlined whenever the macro is used, and then compiled in the context where it got inlined.  Since you use runtime feature checks like</p>\n\n<pre><code>if cfg!(feature = \"invariant-checking\")\n</code></pre>\n\n<p>this means that you need to define the features in every crate where you are using the macro.  In the <code>common</code> crate itself, on the other hand, the feature is never queried and thus redundant.</p>\n\n<p>This seems completely backwards to me.  The feature flag should be <em>only</em> queried in the common crate, and using the macro should not require first defining a feature flag in the crate that uses it.  For this reason, I suggest using compile-time checks to select what macro to define:</p>\n\n<pre><code>#[cfg(feature = \"invariant-checking\")]\nmacro_rules! check_invariant {\n    () =&gt; ( println!(\"invariant-checking {}:{}\", file!(), line!()); )\n}\n\n#[cfg(not(feature = \"invariant-checking\"))]\nmacro_rules! check_invariant {\n    () =&gt; ()\n}\n\n#[cfg(feature = \"logging\")]\nmacro_rules! logging {\n    () =&gt; ( println!(\"logging {}:{}\", file!(), line!()); )\n}\n\n#[cfg(not(feature = \"logging\"))]\nmacro_rules! logging {\n    () =&gt; ()\n}\n\n#[macro_export]\nmacro_rules! check {\n    () =&gt; ( check_invariant!(); logging!(); )\n}\n</code></pre>\n\n<p>This way, you will only need to define the feature in the <code>common</code> crate, as it should be.  As long as you only use a single version of that crate, switching the flag on and off has global effect.</p>\n"}], "owner": {"reputation": 738, "user_id": 4496839, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/050b67773c3fcf861e786289b932daeb?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan1729", "link": "https://stackoverflow.com/users/4496839/ryan1729"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1049, "favorite_count": 1, "accepted_answer_id": 53130702, "answer_count": 2, "score": 3, "last_activity_date": 1541270393, "creation_date": 1541210132, "last_edit_date": 1541270393, "question_id": 53127722, "link": "https://stackoverflow.com/questions/53127722/how-can-i-activate-features-in-all-my-crates", "title": "How can I activate features in all my crates?", "body": "<p>I want to conditionally enable run-time checks and logging, independently from each other and from debug and release mode. So I've started adding two <a href=\"https://doc.rust-lang.org/book/first-edition/conditional-compilation.html\" rel=\"nofollow noreferrer\">features</a> to my project, one called \"invariant-checking\" and one called \"logging\". Ultimately i want their use to be through macros I define in a crate which is visible project-wide.</p>\n\n<p>I had assumed that if I filled out the <a href=\"https://doc.rust-lang.org/cargo/reference/manifest.html#the-features-section\" rel=\"nofollow noreferrer\">features section</a> the same way in all of the crates the same way then when I activated the feature while compiling the bin crate, then all the lib crates would also have the feature enabled, but this is not the case! How can I enable and disable features across multiple crates? Hopefully this can be done by only changing one thing like the command-line arguments to cargo.</p>\n\n<p>To clarify exactly what I want, <a href=\"https://github.com/Ryan1729/features_across_multiple_crates/tree/a5a57411388d4593d52e1c4fa8d818b9e9b209b7\" rel=\"nofollow noreferrer\">here's an example</a>, which I will also reproduce below:</p>\n\n<p>There are three crates, the main, bin, crate, and two lib crates, called \"middle\" and \"common\". Here are the relevant parts of the relevant files:</p>\n\n<p><em>main.rs</em></p>\n\n<pre><code>extern crate common;\nextern crate middle;\n\nfn main() {\n    common::check!();\n\n    middle::run();\n\n    println!(\"done\");\n}\n</code></pre>\n\n<p>the main <em>Cargo.toml</em></p>\n\n<pre><code>[dependencies]\n\n[dependencies.common]\npath = \"libs/common\"\n\n[dependencies.middle]\npath = \"libs/middle\"\n\n[features]\ndefault = []\ninvariant-checking = []\nlogging = []\n</code></pre>\n\n<p>middle's <em>lib.rs</em></p>\n\n<pre><code>extern crate common;\n\npub fn run() {\n    common::check!();\n\n    common::run();\n}\n</code></pre>\n\n<p>middle's <em>Cargo.toml</em></p>\n\n<pre><code>[dependencies]\n\n[dependencies.common]\npath = \"../common\"\n\n[features]\ndefault = []\ninvariant-checking = []\nlogging = []\n</code></pre>\n\n<p>common's <em>lib.rs</em></p>\n\n<pre><code>#[macro_export]\nmacro_rules! check {\n    () =&gt; {{\n        if cfg!(feature = \"invariant-checking\") {\n            println!(\"invariant-checking {}:{}\", file!(), line!());\n        }\n        if cfg!(feature = \"logging\") {\n            println!(\"logging {}:{}\", file!(), line!());\n        }\n    }};\n}\n\npub fn run() {\n    check!()\n}\n</code></pre>\n\n<p>and finally common's <em>Cargo.toml</em></p>\n\n<pre><code>[dependencies]\n\n[features]\ndefault = []\ninvariant-checking = []\nlogging = []\n</code></pre>\n\n<p>When i run <code>cargo run --features \"invariant-checking,logging\"</code> I get the following output</p>\n\n<pre><code>invariant-checking src\\main.rs:5\nlogging src\\main.rs:5\ndone\n</code></pre>\n\n<p>but want it to log in middle and common as well. How can I transform this project such that it will do that, and still allow me to get only \"done\" as output by changing only one place?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 2659, "user_id": 8050514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6CRdl.jpg?s=128&g=1", "display_name": "Optimistic Peach", "link": "https://stackoverflow.com/users/8050514/optimistic-peach"}, "edited": false, "score": 1, "creation_date": 1541213349, "post_id": 53125999, "comment_id": 93150464, "body": "Why can&#39;t you just modify <code>Binary</code> to derive <code>Copy</code> or <code>Clone</code> and then use the clone of them in <code>execute</code> and forget about lifetimes entirely? It&#39;s impossible to pass a <code>&amp;Binary</code> or <code>&amp;&#39;a Binary</code> or really anything that isn&#39;t a <code>Binary</code> to a function (The <code>add</code> or <code>mul</code> or whatever function defined in the appropriate trait) that explicitly states that it takes <code>fn add(self, ..)</code>, because it&#39;s meant to consume <code>self</code>. Anyway, I&#39;m not posting an answer because I&#39;m not sure that I&#39;m qualified to write an answer under lifetimes yet. Please correct me if I&#39;m wrong!"}, {"owner": {"reputation": 791, "user_id": 4747937, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d9d99088c98489a7e0f718631b9e82fc?s=128&d=identicon&r=PG&f=1", "display_name": "kevlarr", "link": "https://stackoverflow.com/users/4747937/kevlarr"}, "reply_to_user": {"reputation": 2659, "user_id": 8050514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6CRdl.jpg?s=128&g=1", "display_name": "Optimistic Peach", "link": "https://stackoverflow.com/users/8050514/optimistic-peach"}, "edited": false, "score": 0, "creation_date": 1541253868, "post_id": 53125999, "comment_id": 93157624, "body": "<i>&quot;Please correct me if I&#39;m wrong!&quot;</i> Believe me, I would be the <i>last</i> person who is able to make any corrections on anything Rust-related! <i>&quot;It&#39;s impossible ... because it&#39;s meant to consume self.&quot;</i> I think that makes sense, you&#39;re probably right that the best thing to do is use <code>Copy</code> or <code>Clone</code>.. The whole <code>execute</code> thing is probably bad, too..."}, {"owner": {"reputation": 2659, "user_id": 8050514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6CRdl.jpg?s=128&g=1", "display_name": "Optimistic Peach", "link": "https://stackoverflow.com/users/8050514/optimistic-peach"}, "edited": false, "score": 0, "creation_date": 1541255161, "post_id": 53125999, "comment_id": 93157949, "body": "Yeah, the point of <code>std::ops::add</code> etc is really just syntactical sugar for <code>a + b</code>, I don&#39;t understand why you are passing the functions around"}, {"owner": {"reputation": 791, "user_id": 4747937, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d9d99088c98489a7e0f718631b9e82fc?s=128&d=identicon&r=PG&f=1", "display_name": "kevlarr", "link": "https://stackoverflow.com/users/4747937/kevlarr"}, "reply_to_user": {"reputation": 2659, "user_id": 8050514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6CRdl.jpg?s=128&g=1", "display_name": "Optimistic Peach", "link": "https://stackoverflow.com/users/8050514/optimistic-peach"}, "edited": false, "score": 0, "creation_date": 1541438691, "post_id": 53125999, "comment_id": 93208981, "body": "Well... Passing them around means I can handle the conversions &amp; printing boilerplate in a single place... but mostly it&#39;s just a &quot;see if and how I can&quot; kind of learning exercise."}], "answers": [{"comments": [{"owner": {"reputation": 791, "user_id": 4747937, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d9d99088c98489a7e0f718631b9e82fc?s=128&d=identicon&r=PG&f=1", "display_name": "kevlarr", "link": "https://stackoverflow.com/users/4747937/kevlarr"}, "edited": false, "score": 0, "creation_date": 1541439734, "post_id": 53133278, "comment_id": 93209454, "body": "Oh nice, I wish it had occurred to me to use closures, but that works perfectly! Also: &quot;I wondered why you chose...&quot; Definitely the beginner in me.. Looking at your suggestion, how does using the generic w/ constraint differ from defining the argument type as I did?"}, {"owner": {"reputation": 2659, "user_id": 8050514, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/6CRdl.jpg?s=128&g=1", "display_name": "Optimistic Peach", "link": "https://stackoverflow.com/users/8050514/optimistic-peach"}, "reply_to_user": {"reputation": 791, "user_id": 4747937, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d9d99088c98489a7e0f718631b9e82fc?s=128&d=identicon&r=PG&f=1", "display_name": "kevlarr", "link": "https://stackoverflow.com/users/4747937/kevlarr"}, "edited": false, "score": 1, "creation_date": 1541523968, "post_id": 53133278, "comment_id": 93243221, "body": "@kevlarr <code>Fn</code> is a trait and therefore unsized, and can&#39;t be passed around in the stack (function memory), on the other hand, <code>fn</code> is a function pointer, and therefore has a size and can be passed around like as if it were just a regular reference,"}], "tags": [], "owner": {"reputation": 30359, "user_id": 255688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74b63650ed07d745fd9accf52e4d286b?s=128&d=identicon&r=PG", "display_name": "phimuemue", "link": "https://stackoverflow.com/users/255688/phimuemue"}, "is_accepted": true, "score": 1, "last_activity_date": 1541262797, "last_edit_date": 1541262797, "creation_date": 1541262441, "answer_id": 53133278, "question_id": 53125999, "link": "https://stackoverflow.com/questions/53125999/how-to-pass-functions-for-traits-implemented-with-lifetimes/53133278#53133278", "title": "How to pass functions for traits implemented with lifetimes?", "body": "<p>I made an exemplary implementation for addition (I made some assumptions regarding the return type of <code>execute</code> and others, you'd have to adapt this if my assumptions are wrong):</p>\n\n<pre><code>use std::ops::Add;\n\n#[derive(Debug)]\npub enum Bit { Off, On }\n#[derive(Debug)]\npub struct Binary([Bit; 32]);\n\nimpl Binary {\n    fn to_int(&amp;self) -&gt; i64 {unimplemented!()}\n    fn from_int(n: i64) -&gt; Self {unimplemented!()}\n}\n\nimpl&lt;'a, 'b&gt; Add&lt;&amp;'b Binary&gt; for &amp;'a Binary {\n    type Output = Binary;\n    fn add(self, other: &amp;'b Binary) -&gt; Binary {\n        unimplemented!()\n    }\n}\n\npub fn add(x: i64, y: i64) -&gt; i64 {\n   execute(|a, b| a+b, x, y)\n}\n\nfn execute(f: fn(&amp;Binary, &amp;Binary) -&gt; Binary, x: i64, y: i64) -&gt; i64 {\n    let bx = Binary::from_int(x);\n    println!(\"{:?}\\n{}\\n\", bx, x);\n\n    let by = Binary::from_int(y);\n    println!(\"{:?}\\n{}\\n\", by, y);\n\n    let result = f(&amp;bx, &amp;by);\n    println!(\"{:?}\", result);\n\n    result.to_int()\n}\n</code></pre>\n\n<p>Note that within <code>execute</code>, you'd have to call <code>f(&amp;bx, &amp;by)</code> (i.e. borrow them instead of consuming).</p>\n\n<p>However: I wondered why you chose to have <code>fn(&amp;Binary, &amp;Binary) -&gt; Binary</code> as argument type instead of making <code>execute</code> generic over <code>F</code>, constraining <code>F</code> to be a callable:</p>\n\n<pre><code>fn execute&lt;F&gt;(f: F, x: i64, y: i64) -&gt; i64\n    where\n        F: Fn(&amp;Binary, &amp;Binary) -&gt; Binary,\n{\n    let bx = Binary::from_int(x);\n    println!(\"{:?}\\n{}\\n\", bx, x);\n\n    let by = Binary::from_int(y);\n    println!(\"{:?}\\n{}\\n\", by, y);\n\n    let result = f(&amp;bx, &amp;by);\n    println!(\"{:?}\", result);\n\n    result.to_int()\n}\n</code></pre>\n\n<p>This way, you are a bit more flexible (you can e.g. pass closures capturing variables in their scope).</p>\n"}], "owner": {"reputation": 791, "user_id": 4747937, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d9d99088c98489a7e0f718631b9e82fc?s=128&d=identicon&r=PG&f=1", "display_name": "kevlarr", "link": "https://stackoverflow.com/users/4747937/kevlarr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 53133278, "answer_count": 1, "score": 0, "last_activity_date": 1541262797, "creation_date": 1541194013, "question_id": 53125999, "link": "https://stackoverflow.com/questions/53125999/how-to-pass-functions-for-traits-implemented-with-lifetimes", "title": "How to pass functions for traits implemented with lifetimes?", "body": "<p>Rust beginner here. I have this \"binary calculator\" that uses a couple of types..</p>\n\n<pre><code>pub enum Bit { Off, On };\npub struct Binary([Bit; 64]);\n</code></pre>\n\n<p>Ignoring everything else that is implemented for them, I overloaded the operators for the <code>Binary</code> like so...</p>\n\n<pre><code>impl Add for Binary {\n    type Output = Binary;\n\n    /// Basic implementation of full addition circuit\n    fn add(self, other: Binary) -&gt; Binary {\n        ...\n    }\n}\n\n... Div, Sub, and Mul\n</code></pre>\n\n<p>... where each operator consumes the <code>Binary</code>s passed to them.  I was then able to define a set of public functions that took care of converting, calling, and printing everything how I wanted to...</p>\n\n<pre><code>pub fn add(x: i64, y: i64) -&gt; Calc {\n    execute(Binary::add, x, y)\n}\n\npub fn subtract(x: i64, y: i64) -&gt; Calc {\n    execute(Binary::sub, x, y)\n}\n\n...\n\nfn execute(f: fn(Binary, Binary) -&gt; Binary, x: i64, y: i64) -&gt; Calc {\n    let bx = Binary::from_int(x);\n    println!(\"{:?}\\n{}\\n\", bx, x);\n\n    let by = Binary::from_int(y);\n    println!(\"{:?}\\n{}\\n\", by, y);\n\n    let result = f(bx, by);\n    println!(\"{:?}\", result);\n\n    result.to_int()\n}\n</code></pre>\n\n<h2>problem</h2>\n\n<p>This worked, but the operations consumed the <code>Binary</code>s, which I didn't actually want. So instead, I implemented the traits using references instead...</p>\n\n<pre><code>impl&lt;'a, 'b&gt; Add&lt;&amp;'b Binary&gt; for &amp;'a Binary {\n    type Output = Binary;\n\n    /// Basic implementation of full addition circuit\n    fn add(self, other: &amp;'b Binary) -&gt; Binary {\n        ...\n    }\n}\n</code></pre>\n\n<p>Now, though, I cannot figure out how to pass those functions to <code>execute</code> as I did before. For example, <code>execute(Binary::div, x, y)</code> is giving the following error.</p>\n\n<pre><code>error[E0277]: cannot divide `types::binary::Binary` by `_`\n  --&gt; src/lib.rs:20:13\n   |\n20 |     execute(Binary::div, x, y)\n   |             ^^^^^^^^^^^ no implementation for `types::binary::Binary / _`\n   |\n   = help: the trait `std::ops::Div&lt;_&gt;` is not implemented for\n    `types::binary::Binary`\n</code></pre>\n\n<p>How can I pass that specific implementation with lifetimes? I assume that I need to update the signature for <code>execute</code> too, like...</p>\n\n<pre><code>fn execute&lt;'a, 'b&gt;(f: fn(&amp;'a Binary, &amp;'b Binary) -&gt; Binary, ...\n</code></pre>\n\n<p>But I wind up also seeing...</p>\n\n<pre><code>error[E0308]: mismatched types\n  --&gt; src/lib.rs:20:13\n   |\n20 |     execute(Binary::div, x, y)\n   |             ^^^^^^^^^^^ expected reference, found struct `types::binary::Binary`\n   |\n   = note: expected type `fn(&amp;types::binary::Binary, &amp;types::binary::Binary) -&gt; types::binary::Binary`\n          found type `fn(types::binary::Binary, _) -&gt; &lt;types::binary::Binary as std::ops::Div&lt;_&gt;&gt;::Output {&lt;types::binary::Binary as std::ops::Div&lt;_&gt;&gt;::div}`\n</code></pre>\n\n<p>Being a complete beginner, I was able to follow all the error messages that got me to the \"working\" point (where operations consumed the values), but now I'm a bit out of my league, I think.</p>\n"}, {"tags": ["types", "rust", "slice"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 6, "last_activity_date": 1541205360, "creation_date": 1541205360, "answer_id": 53127368, "question_id": 53125871, "link": "https://stackoverflow.com/questions/53125871/expected-a-slice-found-an-array-when-asserting-they-are-equal/53127368#53127368", "title": "Expected a slice, found an array when asserting they are equal", "body": "<p>Your example can be reduced:</p>\n\n<pre><code>fn example(input: Result&lt;&amp;[u8], ()&gt;) {\n    assert_eq!(input, Ok(&amp;[]));\n}\n</code></pre>\n\n<p>A reference to an array is a reference to an array, not a slice. In many contexts, a reference to an array may be <em>coerced</em> to a slice, but not everywhere. This is a case where it cannot.</p>\n\n<p>Use more explicit slicing syntax instead:</p>\n\n<pre><code>assert_eq!(input, Ok(&amp;[][..]));\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://github.com/rust-lang/rust/issues/51206\" rel=\"noreferrer\">assert_eq!(a,b) fails to compile for slices while assert!(a == b) works fine</a></li>\n<li><a href=\"https://stackoverflow.com/q/30429801/155423\">What&#39;s the most idiomatic way to test two Options for equality when they contain values which can be tested for equality?</a></li>\n<li><a href=\"https://stackoverflow.com/q/44351328/155423\">How does comparison of a slice with an array work in Rust?</a></li>\n</ul>\n"}], "owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2234, "favorite_count": 0, "accepted_answer_id": 53127368, "answer_count": 1, "score": 4, "last_activity_date": 1541205374, "creation_date": 1541193167, "last_edit_date": 1541205374, "question_id": 53125871, "link": "https://stackoverflow.com/questions/53125871/expected-a-slice-found-an-array-when-asserting-they-are-equal", "title": "Expected a slice, found an array when asserting they are equal", "body": "<p>I'm trying to assert that two slices are equal, but one of the slices is being interpreted as an array:</p>\n\n<pre><code>#[derive(Debug, PartialEq)]\nenum Error {\n    TooBig,\n}\n\ntype Bytes = [u8];\n\nstruct Fixed {\n    length: u32,\n}\n\nimpl&lt;'a&gt; Fixed {\n    pub fn new(length: u32) -&gt; Fixed {\n        Fixed { length: length }\n    }\n\n    pub fn length(&amp;self) -&gt; u32 {\n        self.length\n    }\n\n    pub fn encode(&amp;self, decoded: &amp;'a Bytes) -&gt; Result&lt;&amp;'a Bytes, Error&gt; {\n        if decoded.len() &gt; self.length() as usize {\n            Err(Error::TooBig)\n        } else {\n            Ok(&amp;decoded)\n        }\n    }\n\n    pub fn decode(&amp;self, decoded: &amp;'a Bytes) -&gt; Result&lt;&amp;'a Bytes, Error&gt; {\n        if decoded.len() &gt; self.length() as usize {\n            Err(Error::TooBig)\n        } else {\n            Ok(&amp;decoded)\n        }\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn fixed_0() {\n        let length = 0;\n        let fixed = Fixed::new(length);\n        let encoded = [];\n        let decoded = [];\n        assert_eq!(fixed.length(), length);\n        assert_eq!(fixed.encode(&amp;decoded), Ok(&amp;encoded));\n        assert_eq!(fixed.decode(&amp;encoded), Ok(&amp;decoded));\n        assert_eq!(fixed.encode(&amp;[1]), Err(Error::TooBig));\n    }\n\n    #[test]\n    fn fixed_1() {\n        let length = 1;\n        let fixed = Fixed::new(length);\n        let encoded: [u8; 1] = [1];\n        let decoded: [u8; 1] = [1];\n        assert_eq!(fixed.length(), length);\n        assert_eq!(fixed.encode(&amp;decoded).unwrap(), &amp;encoded);\n        assert_eq!(fixed.decode(&amp;encoded).unwrap(), &amp;decoded);\n    }\n}\n</code></pre>\n\n<p><a href=\"https://gist.github.com/aakilfernandes/32e77bb1f23b4ba3d005b713d59c3ca5#file-src-fixed-rs-L52-L53\" rel=\"nofollow noreferrer\">gist</a></p>\n\n<p>And here's my errors:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n  --&gt; src/lib.rs:49:9\n   |\n49 |         assert_eq!(fixed.encode(&amp;decoded), Ok(&amp;encoded));\n   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected slice, found array of 0 elements\n   |\n   = note: expected type `std::result::Result&lt;&amp;[u8], Error&gt;`\n              found type `std::result::Result&lt;&amp;[_; 0], _&gt;`\n   = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n\nerror[E0308]: mismatched types\n  --&gt; src/lib.rs:50:9\n   |\n50 |         assert_eq!(fixed.decode(&amp;encoded), Ok(&amp;decoded));\n   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected slice, found array of 0 elements\n   |\n   = note: expected type `std::result::Result&lt;&amp;[u8], Error&gt;`\n              found type `std::result::Result&lt;&amp;[u8; 0], _&gt;`\n   = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)\n</code></pre>\n\n<p>My reading of the <a href=\"https://doc.rust-lang.org/rust-by-example/primitives/array.html\" rel=\"nofollow noreferrer\">docs</a> leads me to believe that by using <code>&amp;</code>, I should be creating a slice. What am I missing?</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "is_accepted": true, "score": 6, "last_activity_date": 1541255220, "last_edit_date": 1541255220, "creation_date": 1541191136, "answer_id": 53125525, "question_id": 53125347, "link": "https://stackoverflow.com/questions/53125347/wrong-trait-chosen-based-on-type-parameter/53125525#53125525", "title": "Wrong trait chosen based on type parameter", "body": "<p>The trait bound on <code>foo</code> only says that <code>T</code> implements <code>Resolve</code>, but you try to call <code>.resolve()</code> on a value of type <code>&amp;T</code>.</p>\n\n<p>To say, instead, that <em>references</em> to <code>T</code> must implement <code>Resolve</code>, you need a <a href=\"https://stackoverflow.com/questions/35592750/how-does-for-syntax-differ-from-a-regular-lifetime-bound\">higher-ranked trait bound</a>:</p>\n\n<pre><code>impl&lt;'a, T&gt; Signal&lt;'a, T&gt;\nwhere\n    for&lt;'b&gt; &amp;'b T: Resolve&lt;&amp;'a T, Output = T&gt;,\n{\n    pub fn foo(&amp;mut self) { ... }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1541255975, "post_id": 53130132, "comment_id": 93158148, "body": "You are right, it does work in this case because <code>&amp;&#39;a T</code> is <code>Copy</code> (note that the <code>&amp;</code> in <code>&amp;self.ps[0]</code> does not do anything and can be deleted). In a more complex scenario, where you had to reborrow with the lifetime of <code>self</code>, you would need HRTBs."}], "tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": false, "score": 1, "last_activity_date": 1541238294, "creation_date": 1541238294, "answer_id": 53130132, "question_id": 53125347, "link": "https://stackoverflow.com/questions/53125347/wrong-trait-chosen-based-on-type-parameter/53130132#53130132", "title": "Wrong trait chosen based on type parameter", "body": "<p>After thinking about this I came up with a simpler solution that does not rely on HRTB.</p>\n\n<pre><code>impl&lt;'a, T&gt; Signal&lt;'a, T&gt;\nwhere\n    &amp;'a T: Resolve&lt;&amp;'a T, Output = T&gt; + 'a,\n{\n    pub fn foo(&amp;mut self) {\n        let a: &amp;T = &amp;self.ps[0];\n        let b = &amp;self.ps[1];\n        a.resolve(b);\n    }\n}\n</code></pre>\n\n<p>This does the same, namely describe, that <code>&amp;T</code> implements <code>Resolve</code>, but without the need of HRTB.<br>\nYou have to use the <a href=\"https://doc.rust-lang.org/1.8.0/book/traits.html#where-clause\" rel=\"nofollow noreferrer\">where clause</a> for this, but apart from that this is a nice and easy solution.</p>\n"}], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 53125525, "answer_count": 2, "score": 3, "last_activity_date": 1563974746, "creation_date": 1541190119, "last_edit_date": 1563974746, "question_id": 53125347, "link": "https://stackoverflow.com/questions/53125347/wrong-trait-chosen-based-on-type-parameter", "title": "Wrong trait chosen based on type parameter", "body": "<p>I have a binary trait <code>Resolve</code>.</p>\n\n<pre><code>pub trait Resolve&lt;RHS = Self&gt; {\n    type Output;\n    fn resolve(self, rhs: RHS) -&gt; Self::Output;\n}\n</code></pre>\n\n<p>I implemented the trait for something trivial where both arguments are taken by reference (<code>self</code> is <code>&amp;'a Foo</code> and <code>rhs</code> is <code>&amp;'b Foo</code>):</p>\n\n<pre><code>struct Foo;\n\nimpl &lt;'a, 'b&gt; Resolve&lt;&amp;'b Foo&gt; for &amp;'a Foo {\n    type Output = Foo;\n    fn resolve(self, rhs: &amp;'b Foo) -&gt; Self::Output {\n        unimplemented!()\n    }\n}\n</code></pre>\n\n<p>If I now write</p>\n\n<pre><code>fn main() {\n    let a: &amp;Foo = &amp;Foo;\n    let b = Foo;\n    a.resolve(&amp;b);\n}\n</code></pre>\n\n<p>it will compile just fine, but if I try to implement it on my struct <code>Signal</code>, it will not work.</p>\n\n<pre><code>pub struct Signal&lt;'a, T&gt; {\n    ps: Vec&lt;&amp;'a T&gt;,\n}\n\nimpl&lt;'a, T: Resolve&lt;&amp;'a T, Output = T&gt; + 'a&gt; Signal&lt;'a, T&gt; {\n    pub fn foo(&amp;mut self) {\n        let a: &amp;T = &amp;self.ps[0];\n        let b = &amp;self.ps[1];\n        a.resolve(b);\n    }\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0507]: cannot move out of borrowed content\n  --&gt; src/main.rs:25:9\n   |\n25 |         a.resolve(b);\n   |         ^ cannot move out of borrowed content\n</code></pre>\n\n<p>How do I get this example working? (<a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=f427b1d07ba980641d4aa59ab5102492\" rel=\"nofollow noreferrer\">playground</a>)</p>\n"}, {"tags": ["unit-testing", "testing", "error-handling", "rust"], "comments": [{"owner": {"reputation": 121, "user_id": 8402395, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JDAy4.png?s=128&g=1", "display_name": "\u0295\u0298\u0305\u035c\u0298\u0305\u0294", "link": "https://stackoverflow.com/users/8402395/%ca%95%ca%98%cc%85%cd%9c%ca%98%cc%85%ca%94"}, "edited": false, "score": 0, "creation_date": 1576425738, "post_id": 53124930, "comment_id": 104887521, "body": "You can use macro #[should_panic]. You can have a look to <a href=\"https://stackoverflow.com/a/26470361/8402395\">stackoverflow.com/a/26470361/8402395</a>"}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541187995, "post_id": 53124931, "comment_id": 93144588, "body": "<i>get the <code>Option</code> from <code>Result</code> with <code>.err</code></i> \u2014 why not just compare directly?"}, {"owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541188086, "post_id": 53124931, "comment_id": 93144623, "body": "@Shepmaster <code>Option</code> is not a variant of <code>Result</code>. Not sure if I understand your question. Also just started programming Rust yesterday so might be missing something obvious here"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541188131, "post_id": 53124931, "comment_id": 93144649, "body": "Why not compare with <code>Err(MyError::TooBig)</code>?"}, {"owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541188199, "post_id": 53124931, "comment_id": 93144675, "body": "When I try I get <code>expected enum &#39;std::result::Result&#39;, found enum &#39;fixed::Error&#39;</code>"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541188391, "post_id": 53124931, "comment_id": 93144767, "body": "@AakilFernandes Can you show the code resulting in this error?"}, {"owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541188448, "post_id": 53124931, "comment_id": 93144791, "body": "@SvenMarnach <code>assert_eq!(fixed.encode(&amp;[1]), Error::TooBig);</code>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1541188476, "post_id": 53124931, "comment_id": 93144805, "body": "<code>Err(MyError::TooBig)</code> is not the same as <code>MyError::TooBig</code>"}, {"owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541188528, "post_id": 53124931, "comment_id": 93144831, "body": "@Shepmaster the Error/MyError thing is just cause I&#39;m locally editing my version as we speak and copy/pasting"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541188589, "post_id": 53124931, "comment_id": 93144855, "body": "<b>Err(</b> foo <b>)</b> is not the same as foo, just like <code>Some(MyError::TooBig)</code> is not the same as <code>MyError::TooBig</code>."}, {"owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "edited": false, "score": 0, "creation_date": 1541188684, "post_id": 53124931, "comment_id": 93144894, "body": "Uploaded a gist so we could be working from the same code :) <a href=\"https://gist.github.com/aakilfernandes/7d6258ee18f91e5399f90239c6bf65b4\" rel=\"nofollow noreferrer\">gist.github.com/aakilfernandes/7d6258ee18f91e5399f90239c6bf6&zwnj;&#8203;5b4</a>"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541188737, "post_id": 53124931, "comment_id": 93144916, "body": "@AakilFernandes Shepmaster is suggesting you use <code>assert_eq!(fixed.encode(&amp;[1]), Err(Error::TooBig));</code>."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541188853, "post_id": 53124931, "comment_id": 93144956, "body": "Your function returns <code>Err(MyError::TooBig)</code> \u2013 literally.  You now want to know whether the function returned <code>Err(MyError::TooBig)</code>, so you compare the return value to <code>Err(MyError::TooBig)</code>."}, {"owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541188912, "post_id": 53124931, "comment_id": 93144976, "body": "@SvenMarnach thanks for sticking with me. I still get an error when trying that"}, {"owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "edited": false, "score": 0, "creation_date": 1541188930, "post_id": 53124931, "comment_id": 93144988, "body": "&gt; thread &#39;fixed::tests::fixed_0&#39; panicked at &#39;called <code>Result::unwrap()</code> on an <code>Err</code> value: TooBig&#39;"}, {"owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "edited": false, "score": 0, "creation_date": 1541188972, "post_id": 53124931, "comment_id": 93145003, "body": "<a href=\"https://gist.github.com/aakilfernandes/7d6258ee18f91e5399f90239c6bf65b4#file-fixed-rs-L58\" rel=\"nofollow noreferrer\">gist.github.com/aakilfernandes/&hellip;</a>"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541188978, "post_id": 53124931, "comment_id": 93145007, "body": "@AakilFernandes That&#39;s completely unrelated \u2013 none of the code you showed so far uses <code>unwrap()</code>."}, {"owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1541189014, "post_id": 53124931, "comment_id": 93145020, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/183030/discussion-between-aakil-fernandes-and-sven-marnach\">continue this discussion in chat</a>."}, {"owner": {"reputation": 37211, "user_id": 60075, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/da582d6fbfa2ae515004ef49fcb7c281?s=128&d=identicon&r=PG", "display_name": "Craig McQueen", "link": "https://stackoverflow.com/users/60075/craig-mcqueen"}, "edited": false, "score": 0, "creation_date": 1600068865, "post_id": 53124931, "comment_id": 112960142, "body": "I see the code in the last line has been edited, but now it doesn&#39;t match what is said in the first line. The first line should probably be updated to match the code."}], "tags": [], "owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "is_accepted": true, "score": 15, "last_activity_date": 1608239735, "last_edit_date": 1608239735, "creation_date": 1541187753, "answer_id": 53124931, "question_id": 53124930, "link": "https://stackoverflow.com/questions/53124930/how-do-you-test-for-a-specific-rust-error/53124931#53124931", "title": "How do you test for a specific Rust error?", "body": "<p>You can directly compare the returned <code>Err</code> variant if it <code>impl Debug + PartialEq</code>:</p>\n<pre><code>#[derive(Debug, PartialEq)]\nenum MyError {\n    TooBig,\n    TooSmall,\n}\n\npub fn encode(&amp;self, decoded: &amp;'a Bytes) -&gt; Result&lt;&amp;'a Bytes, MyError&gt; {\n    if decoded.len() &gt; self.length() as usize {\n        Err(MyError::TooBig)\n    } else {\n        Ok(&amp;decoded)\n    }\n}\n</code></pre>\n\n<pre><code>assert_eq!(fixed.encode(&amp;[1]), Err(MyError::TooBig));\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5096, "user_id": 183544, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7e497922b6a3060aa8fedd117b0eb7ff?s=128&d=identicon&r=PG", "display_name": "Ciantic", "link": "https://stackoverflow.com/users/183544/ciantic"}, "is_accepted": false, "score": 2, "last_activity_date": 1610056602, "last_edit_date": 1610056602, "creation_date": 1610047385, "answer_id": 65618681, "question_id": 53124930, "link": "https://stackoverflow.com/questions/53124930/how-do-you-test-for-a-specific-rust-error/65618681#65618681", "title": "How do you test for a specific Rust error?", "body": "<p>Following solution doesn't require <code>PartialEq</code> trait to be implemented. For instance <code>std::io::Error</code> does not implement this, and more general solution is required.</p>\n<p>In these cases, you can borrow a macro <code>assert_matches</code> from <a href=\"https://crates.io/crates/matches\" rel=\"nofollow noreferrer\">matches crate</a>. It works by giving more succinct way to pattern match, the macro is so short you can just type it too:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>macro_rules! assert_err {\n    ($expression:expr, $($pattern:tt)+) =&gt; {\n        match $expression {\n            $($pattern)+ =&gt; (),\n            ref e =&gt; panic!(&quot;expected `{}` but got `{:?}`&quot;, stringify!($($pattern)+), e),\n        }\n    }\n}\n\n// Example usages:\nassert_err!(your_func(), Err(Error::UrlParsingFailed(_)));\nassert_err!(your_func(), Err(Error::CanonicalizationFailed(_)));\nassert_err!(your_func(), Err(Error::FileOpenFailed(er)) if er.kind() == ErrorKind::NotFound);\n</code></pre>\n<p>Full playground buildable example, with example <code>Error</code> enum:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Debug)]\npub enum Error {\n    UrlCreationFailed,\n    CanonicalizationFailed(std::io::Error),\n    FileOpenFailed(std::io::Error),\n    UrlParsingFailed(url::ParseError),\n}\n\npub fn your_func() -&gt; Result&lt;(), Error&gt; {\n    Ok(())\n}\n\n#[cfg(test)]\nmod test {\n    use std::io::ErrorKind;\n    use super::{your_func, Error};\n\n    macro_rules! assert_err {\n        ($expression:expr, $($pattern:tt)+) =&gt; {\n            match $expression {\n                $($pattern)+ =&gt; (),\n                ref e =&gt; panic!(&quot;expected `{}` but got `{:?}`&quot;, stringify!($($pattern)+), e),\n            }\n        }\n    }\n\n    #[test]\n    fn test_failures() {\n        // Few examples are here:\n        assert_err!(your_func(), Err(Error::UrlParsingFailed(_)));\n        assert_err!(your_func(), Err(Error::CanonicalizationFailed(_)));\n        assert_err!(your_func(), Err(Error::FileOpenFailed(er)) if er.kind() == ErrorKind::NotFound);\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 6244, "user_id": 1074400, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/52386dc6c94ab9b807981c9616dc2bb5?s=128&d=identicon&r=PG", "display_name": "Aakil Fernandes", "link": "https://stackoverflow.com/users/1074400/aakil-fernandes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4438, "favorite_count": 0, "accepted_answer_id": 53124931, "answer_count": 2, "score": 18, "last_activity_date": 1610056602, "creation_date": 1541187753, "last_edit_date": 1541187912, "question_id": 53124930, "link": "https://stackoverflow.com/questions/53124930/how-do-you-test-for-a-specific-rust-error", "title": "How do you test for a specific Rust error?", "body": "<p>I can find ways to detect if Rust gives me an error,</p>\n\n<pre><code>assert!(fs::metadata(path).is_err())\n</code></pre>\n\n<p><a href=\"https://users.rust-lang.org/t/idiomatic-way-of-testing-result-t-error/2171/2\" rel=\"noreferrer\">source</a></p>\n\n<p>How do I test for a specific error?</p>\n"}, {"tags": ["serialization", "rust", "yaml", "serde"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541179770, "post_id": 53123256, "comment_id": 93141256, "body": "What should happen when there are duplicate values for <code>name</code>? Should it just generate invalid data?"}, {"owner": {"reputation": 2524, "user_id": 1000145, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ed1f474d23ef1e028ef377c4f638d409?s=128&d=identicon&r=PG", "display_name": "Tim Vis&#233;e", "link": "https://stackoverflow.com/users/1000145/tim-vis%c3%a9e"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541179931, "post_id": 53123256, "comment_id": 93141326, "body": "Good question. I believe YAML suggests duplicate items get overwritten in order, thus the last occurrence is used, other occurrences are dropped. For my use case, this is perfect."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541180316, "post_id": 53123256, "comment_id": 93141488, "body": "I&#39;d probably just deserialize to a <code>Map&lt;String, PartialItem&gt;</code> and then transform it to a <code>Vec&lt;Item&gt;</code>; I assume you are looking to avoid the transient <code>Map</code> being created?"}, {"owner": {"reputation": 2524, "user_id": 1000145, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ed1f474d23ef1e028ef377c4f638d409?s=128&d=identicon&r=PG", "display_name": "Tim Vis&#233;e", "link": "https://stackoverflow.com/users/1000145/tim-vis%c3%a9e"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541181991, "post_id": 53123256, "comment_id": 93142157, "body": "Correct. And I would also prefer not to implement an additional <code>PartialItem</code> struct. Using an <code>Option&lt;String&gt;</code> as name would be possible for this, although I don&#39;t think this is optimal. Maybe the transient <code>Map</code> is what I must go for if no better option is available."}, {"owner": {"reputation": 6137, "user_id": 847382, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b73e2fff665c33621c8a4347cf8074be?s=128&d=identicon&r=PG", "display_name": "PitaJ", "link": "https://stackoverflow.com/users/847382/pitaj"}, "edited": false, "score": 2, "creation_date": 1541183062, "post_id": 53123256, "comment_id": 93142614, "body": "You&#39;ll probably have to implement Deserialize it yourself <a href=\"https://serde.rs/deserialize-map.html\" rel=\"nofollow noreferrer\">serde.rs/deserialize-map.html</a>"}, {"owner": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 0, "creation_date": 1541225494, "post_id": 53123256, "comment_id": 93151950, "body": "The YAML spec clearly indicates that mapping keys have to be unique. Duplicate keys are invalid, although there are some parser/loader that (some even silently) allow them."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1541189229, "post_id": 53125073, "comment_id": 93145096, "body": "OP states that they want to &quot;avoid the transient Map being created&quot;"}], "tags": [], "owner": {"reputation": 11723, "user_id": 3356777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1c7bee1f2c7ba7f81ddb902b83626558?s=128&d=identicon&r=PG&f=1", "display_name": "attdona", "link": "https://stackoverflow.com/users/3356777/attdona"}, "is_accepted": false, "score": 1, "last_activity_date": 1541189174, "last_edit_date": 1541189174, "creation_date": 1541188546, "answer_id": 53125073, "question_id": 53123256, "link": "https://stackoverflow.com/questions/53123256/is-there-a-way-to-tell-serde-to-use-a-struct-field-as-a-maps-key/53125073#53125073", "title": "Is there a way to tell Serde to use a struct field as a map&#39;s key?", "body": "<p>Define a default value for <code>Item::name</code> field </p>\n\n<pre><code>#[derive(Debug, Serialize, Deserialize)]\nstruct Item {\n    #[serde(default)]\n    name: String,\n    some_field: usize,\n}\n</code></pre>\n\n<p>With this trick <code>Item</code>can be used both for deserializing and for transforming to a <code>Vec</code> of <code>Item</code>s:</p>\n\n<pre><code>let contents = read_to_string(\"file.yml\").unwrap();\n\nlet items: HashMap&lt;String, Item&gt; = serde_yaml::from_str(&amp;contents).unwrap();\n\nlet slist: Vec&lt;Item&gt; = items\n    .into_iter()\n    .map(|(k, v)| Item {\n        name: k,\n        some_field: v.some_field,\n    })\n    .collect();\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": false, "score": 4, "last_activity_date": 1541244018, "last_edit_date": 1541244018, "creation_date": 1541243206, "answer_id": 53130703, "question_id": 53123256, "link": "https://stackoverflow.com/questions/53123256/is-there-a-way-to-tell-serde-to-use-a-struct-field-as-a-maps-key/53130703#53130703", "title": "Is there a way to tell Serde to use a struct field as a map&#39;s key?", "body": "<p>One way is to <a href=\"https://serde.rs/deserialize-map.html\" rel=\"nofollow noreferrer\">deserialize</a> the map yourself:</p>\n\n<pre><code>use std::fmt;\n\nuse serde::de::{Deserialize, Deserializer, MapAccess, Visitor};\nuse serde_derive::Deserialize;\n\nstruct ItemMapVisitor {}\n\nimpl ItemMapVisitor {\n    fn new() -&gt; Self {\n        Self {}\n    }\n}\n\n#[derive(Debug, Deserialize)]\nstruct SomeField {\n    some_field: u32,\n}\n\n#[derive(Debug)]\nstruct Item {\n    name: String,\n    some_field: u32,\n}\n\n#[derive(Debug)]\nstruct VecItem(Vec&lt;Item&gt;);\n\nimpl Item {\n    fn new(name: String, some_field: u32) -&gt; Self {\n        Self { name, some_field }\n    }\n}\n\nimpl&lt;'de&gt; Visitor&lt;'de&gt; for ItemMapVisitor {\n    type Value = VecItem;\n\n    fn expecting(&amp;self, formatter: &amp;mut fmt::Formatter) -&gt; fmt::Result {\n        formatter.write_str(\"name: somefield:\")\n    }\n\n    fn visit_map&lt;M&gt;(self, mut access: M) -&gt; Result&lt;Self::Value, M::Error&gt;\n    where\n        M: MapAccess&lt;'de&gt;,\n    {\n        let mut items = Vec::with_capacity(access.size_hint().unwrap_or(0));\n        while let Some((key, value)) = access.next_entry::&lt;String, SomeField&gt;()? {\n            items.push(Item::new(key, value.some_field));\n        }\n        Ok(VecItem(items))\n    }\n}\n\nimpl&lt;'de&gt; Deserialize&lt;'de&gt; for VecItem {\n    fn deserialize&lt;D&gt;(deserializer: D) -&gt; Result&lt;Self, D::Error&gt;\n    where\n        D: Deserializer&lt;'de&gt;,\n    {\n        deserializer.deserialize_map(ItemMapVisitor::new())\n    }\n}\n\nfn main() {\n    let contents = r#\"\nname_a:\n    some_field: 0\nname_b:\n    some_field: 1\nname_c:\n    some_field: 2\n\"#;\n\n    let items: VecItem = serde_yaml::from_str(&amp;contents).unwrap();\n    println!(\"{:#?}\", items);\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>VecItem(\n    [\n        Item {\n            name: \"name_a\",\n            some_field: 0\n        },\n        Item {\n            name: \"name_b\",\n            some_field: 1\n        },\n        Item {\n            name: \"name_c\",\n            some_field: 2\n        }\n    ]\n)\n</code></pre>\n\n<hr>\n\n<p>If you don't want of <code>Somefield</code> structure. You could also use this:</p>\n\n<pre><code>#[derive(Debug, Deserialize)]\nstruct Item {\n    #[serde(skip)]\n    name: String,\n    some_field: u32,\n}\n\nwhile let Some((key, value)) = access.next_entry::&lt;String, Item&gt;()? {\n    items.push(Item::new(key, value.some_field));\n}\n</code></pre>\n\n<p>But this could add some useless copy.</p>\n"}], "owner": {"reputation": 2524, "user_id": 1000145, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ed1f474d23ef1e028ef377c4f638d409?s=128&d=identicon&r=PG", "display_name": "Tim Vis&#233;e", "link": "https://stackoverflow.com/users/1000145/tim-vis%c3%a9e"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1530, "favorite_count": 0, "answer_count": 2, "score": 7, "last_activity_date": 1541244018, "creation_date": 1541179500, "last_edit_date": 1541189332, "question_id": 53123256, "link": "https://stackoverflow.com/questions/53123256/is-there-a-way-to-tell-serde-to-use-a-struct-field-as-a-maps-key", "title": "Is there a way to tell Serde to use a struct field as a map&#39;s key?", "body": "<p>I have a map of items that I would like to serialize to a list of structs, each having a field for the corresponding key.</p>\n\n<p>Imagine having a YAML file like this:</p>\n\n<pre class=\"lang-yaml prettyprint-override\"><code>name_a:\n    some_field: 0\nname_b:\n    some_field: 0\nname_c:\n    some_field: 0\n</code></pre>\n\n<p>And a corresponding structure like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Item {\n    name: String,\n    some_field: usize,\n}\n</code></pre>\n\n<p>I would like to deserialize the named items into a <code>Vec&lt;Item&gt;</code> instead of a <code>Map&lt;String, Item&gt;</code>. The item names (<code>name_a</code>, ...) are put into the <code>name</code> field of the <code>Item</code> objects.</p>\n\n<p>I've attempted the following:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate serde_yaml;\nuse std::fs::read_to_string;\n\nlet contents = read_to_string(\"file.yml\").unwrap();\nlet items: Vec&lt;Item&gt; = serde_yaml::from_str(&amp;contents).unwrap();\n</code></pre>\n\n<p>This however doesn't work and produces the <code>invalid type: map, expected a sequence</code> error.</p>\n\n<p>I'd prefer to avoid creating a transient <code>Map&lt;String, PartialItem&gt;</code> that is converted to a <code>Vec</code>, and I would also prefer not to implement an additional <code>PartialItem</code> struct. Using an <code>Option&lt;String&gt;</code> as <code>name</code> would be possible, although I don't think this is optimal.</p>\n"}, {"tags": ["module", "rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541177302, "post_id": 53122612, "comment_id": 93140028, "body": "What happens when you try what the compiler suggests: <i>name the file either scene/libs.rs or scene/libs/mod.rs inside the directory &quot;src/scenes&quot;</i>?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541177438, "post_id": 53122612, "comment_id": 93140101, "body": "I think you have done a mistake somewhere."}, {"owner": {"reputation": 71, "user_id": 7738333, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mjVhxcD-E4c/AAAAAAAAAAI/AAAAAAAAKO4/qlDg4Th7AjY/photo.jpg?sz=128", "display_name": "Col", "link": "https://stackoverflow.com/users/7738333/col"}, "edited": false, "score": 0, "creation_date": 1541178253, "post_id": 53122612, "comment_id": 93140545, "body": "I completed with the content of files. I didn;t know  Rust-specific MCVE tips. I can&#39;t try scene/libs.rs or scene/libs/mod.rs cause scene is a file. Or I miss something"}, {"owner": {"reputation": 71, "user_id": 7738333, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mjVhxcD-E4c/AAAAAAAAAAI/AAAAAAAAKO4/qlDg4Th7AjY/photo.jpg?sz=128", "display_name": "Col", "link": "https://stackoverflow.com/users/7738333/col"}, "edited": false, "score": 0, "creation_date": 1541178427, "post_id": 53122612, "comment_id": 93140631, "body": "nop sorry typo mistake, I edited my question."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541178909, "post_id": 53122612, "comment_id": 93140849, "body": "<i>cause scene is a file</i> \u2014 scene <i>.rs</i> is a file \u2014 where is a file called only <i>scene</i>?"}, {"owner": {"reputation": 71, "user_id": 7738333, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mjVhxcD-E4c/AAAAAAAAAAI/AAAAAAAAKO4/qlDg4Th7AjY/photo.jpg?sz=128", "display_name": "Col", "link": "https://stackoverflow.com/users/7738333/col"}, "edited": false, "score": 0, "creation_date": 1541180302, "post_id": 53122612, "comment_id": 93141485, "body": "nowhere I thought to scene.rs effectively. If I tried to do <b>scene/libs.rs or scene/libs/mod.rs</b> It seems to offset the problem... I really don&#39;t feel like I&#39;m doing anything complicated but I am pretty sure to miss dumb something.  The logic and file structure is pretty classic."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541185770, "post_id": 53122612, "comment_id": 93143754, "body": "So, if you follow the error message, the error goes away and the code works? Sounds like there&#39;s no problem anymore and thus no question remaining."}, {"owner": {"reputation": 71, "user_id": 7738333, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mjVhxcD-E4c/AAAAAAAAAAI/AAAAAAAAKO4/qlDg4Th7AjY/photo.jpg?sz=128", "display_name": "Col", "link": "https://stackoverflow.com/users/7738333/col"}, "edited": false, "score": 0, "creation_date": 1541186743, "post_id": 53122612, "comment_id": 93144119, "body": "No the error still there. But I found a trick, if I move all my code in mod.rs of each package and delete scene.rs and components.rs, the module resolution is correct. I will read again and again the <i>book</i>.  Thanks, even if I don&#39;t understand why my previous case is wrong."}], "answers": [{"tags": [], "owner": {"reputation": 1081, "user_id": 2178427, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gymYO.png?s=128&g=1", "display_name": "hyperum", "link": "https://stackoverflow.com/users/2178427/hyperum"}, "is_accepted": true, "score": 2, "last_activity_date": 1554337496, "last_edit_date": 1554337496, "creation_date": 1541419561, "answer_id": 53154089, "question_id": 53122612, "link": "https://stackoverflow.com/questions/53122612/how-to-import-libs-module-in-different-files/53154089#53154089", "title": "How to import libs module in different files", "body": "<p>Instead of <code>mod libs</code>, write <code>use crate::scenes::libs</code>.</p>\n\n<p>The Rust 2018 Edition has changed the module system slightly to help clarify situations such as this.</p>\n\n<p>Your directory should be restructured like so:</p>\n\n<pre><code>main.rs\nscenes.rs\nscenes\n|   libs.rs\n|   libs\n|   |   components.rs\n|   scene.rs\n</code></pre>\n\n<p>The main difference here is that <code>mod.rs</code> files are now extracted from their folder and named appropriately.</p>\n\n<p><strong>PRE-RUST-2018 - NOV 2018</strong></p>\n\n<p>Instead of <code>mod libs</code>, write <code>use scenes::libs</code>. </p>\n\n<p>The error message is telling you is you're trying to declare the existence of a submodule of <code>scene</code> that does not exist. Instead, you want to import (with <code>use</code>) the <code>libs</code> module which is accessed by <code>scenes::libs</code> from the crate root.</p>\n"}], "owner": {"reputation": 71, "user_id": 7738333, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mjVhxcD-E4c/AAAAAAAAAAI/AAAAAAAAKO4/qlDg4Th7AjY/photo.jpg?sz=128", "display_name": "Col", "link": "https://stackoverflow.com/users/7738333/col"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 1, "accepted_answer_id": 53154089, "answer_count": 1, "score": 1, "last_activity_date": 1554337496, "creation_date": 1541176760, "last_edit_date": 1541178378, "question_id": 53122612, "link": "https://stackoverflow.com/questions/53122612/how-to-import-libs-module-in-different-files", "title": "How to import libs module in different files", "body": "<p>I have troubles resolving my module imports. Here is my file structure:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>.\n|-- scenes\n|   |-- libs\n|   |    |-- mod.rs\n|   |    `-- components.rs\n|   |-- mod.rs\n|   `-- scene.rs\n`-- main.rs\n</code></pre>\n\n<p>I can't import the module <code>libs</code> in scene.rs. I think I don't get it the module logical. Any help would be very appreciable. </p>\n\n<p>if I try to do <code>mod libs;</code> in scene.rs</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0583]: file not found for module `libs`\n --&gt; src/scenes/scene.rs:2:5\n  |\n2 | mod libs;\n  |     ^^^^\n  |\n  = help: name the file either scene/libs.rs or scene/libs/mod.rs inside the directory \"src/scenes\"\n</code></pre>\n\n<p>Contents files:</p>\n\n<p>main.rs</p>\n\n<pre><code>mod scenes;\nlet sc = scenes::scene::Scene{};\n</code></pre>\n\n<p>scenes/scene.rs</p>\n\n<pre><code>mod libs; // errors\npub struct Sphere {\n    pub center: libs::components::Point\n}\npub struct Scene {}\n</code></pre>\n\n<p>scenes/mod.rs</p>\n\n<pre><code>pub mod scene;\npub mod libs;\n</code></pre>\n\n<p>scenes/libs/components.rs</p>\n\n<pre><code>pub struct Point {}\n</code></pre>\n\n<p>scenes/libs/mod.rs</p>\n\n<pre><code>pub mod components;\n</code></pre>\n"}, {"tags": ["rust", "literals"], "answers": [{"comments": [{"owner": {"reputation": 6992, "user_id": 495157, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/UFMPn.png?s=128&g=1", "display_name": "JGFMK", "link": "https://stackoverflow.com/users/495157/jgfmk"}, "edited": false, "score": 1, "creation_date": 1598976223, "post_id": 53120756, "comment_id": 112627754, "body": "The documentation on Primitives <a href=\"https://doc.rust-lang.org/rust-by-example/primitives.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/rust-by-example/primitives.html</a> should provide a link Literals  (By Example link above). Also that page.. <a href=\"https://doc.rust-lang.org/rust-by-example/types/literals.html#literals\" rel=\"nofollow noreferrer\">doc.rust-lang.org/rust-by-example/types/literals.html#litera&zwnj;&#8203;ls</a> - could do with some rework - The example detracts. The lines at the top convey enough. Makes it easier to scan. The whole size in bytes/mem stuff is a whole different concept that muddies waters. asserts would make more sense it is really necessary to deviate from the concept."}, {"owner": {"reputation": 13606, "user_id": 527702, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/LrH0d.jpg?s=128&g=1", "display_name": "hippietrail", "link": "https://stackoverflow.com/users/527702/hippietrail"}, "edited": false, "score": 0, "creation_date": 1606339987, "post_id": 53120756, "comment_id": 114938576, "body": "I saw this line in the docs and immediately wondered &quot;what&#39;s the difference between a &#39;byte literal&#39; and a &#39;u8&#39;, an unsigned 8-bit int."}], "tags": [], "owner": {"reputation": 2316, "user_id": 4842857, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/k5xqy.jpg?s=128&g=1", "display_name": "Jack Steam", "link": "https://stackoverflow.com/users/4842857/jack-steam"}, "is_accepted": false, "score": 29, "last_activity_date": 1598972841, "last_edit_date": 1598972841, "creation_date": 1541170029, "answer_id": 53120756, "question_id": 53120755, "link": "https://stackoverflow.com/questions/53120755/what-do-number-literals-with-a-suffix-like-0u8-mean-in-rust/53120756#53120756", "title": "What do number literals with a suffix, like 0u8, mean in Rust?", "body": "<h2>Suffixed Literals</h2>\n<p>After searching, I've found this explanation in the <a href=\"https://doc.rust-lang.org/book/ch03-02-data-types.html#integer-types\" rel=\"noreferrer\">same book</a>:</p>\n<blockquote>\n<p>... all number literals except the byte literal allow a type suffix, such as <code>57u8</code>...</p>\n</blockquote>\n<p>So <code>0u8</code> is the number 0 as an unsigned 8-bit integer.</p>\n<p>These are referred to as &quot;suffixed literals&quot; and are discussed at length in <a href=\"https://doc.rust-lang.org/rust-by-example/types/literals.html#literals\" rel=\"noreferrer\">Rust By Example</a>.</p>\n"}], "owner": {"reputation": 2316, "user_id": 4842857, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/k5xqy.jpg?s=128&g=1", "display_name": "Jack Steam", "link": "https://stackoverflow.com/users/4842857/jack-steam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2284, "favorite_count": 1, "answer_count": 1, "score": 18, "last_activity_date": 1598972841, "creation_date": 1541170029, "last_edit_date": 1598972807, "question_id": 53120755, "link": "https://stackoverflow.com/questions/53120755/what-do-number-literals-with-a-suffix-like-0u8-mean-in-rust", "title": "What do number literals with a suffix, like 0u8, mean in Rust?", "body": "<p>I'm reading through <a href=\"https://doc.rust-lang.org/book/ch06-02-match.html#the-_-placeholder\" rel=\"noreferrer\">The Rust Programming Language</a> and have encountered this notation: <code>0u8</code>.</p>\n<pre><code>let some_u8_value = 0u8;\nmatch some_u8_value {\n    1 =&gt; println!(&quot;one&quot;),\n    3 =&gt; println!(&quot;three&quot;),\n    5 =&gt; println!(&quot;five&quot;),\n    7 =&gt; println!(&quot;seven&quot;),\n    _ =&gt; (),\n}\n</code></pre>\n<p>After searching the web, I've found lots of examples of this notation being used (<code>0b01001100u8</code>, <code>0x82u8</code>, <code>200u8</code>), but what <em>exactly</em> does this notation mean?</p>\n"}, {"tags": ["rust", "rust-tokio"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541165082, "post_id": 53119182, "comment_id": 93133174, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/51885745/155423\">How do I conditionally return different types of futures?</a>. If you disagree, please <a href=\"https://stackoverflow.com/posts/53119182/edit\">edit</a> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541165336, "post_id": 53119182, "comment_id": 93133305, "body": "@Shepmaster That other question is only part of the answer.  The focus here is how to conditionally chain a future in one branch, but not in the other.  So as second piece of the answer, we need to use <code>future::ok()</code> to pass the value through unchanged."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1541165630, "post_id": 53119182, "comment_id": 93133484, "body": "@SvenMarnach but OP already knows how to use <code>future::ok</code>, as evidenced by the usage of it provided in the code."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541165684, "post_id": 53119182, "comment_id": 93133514, "body": "@Shepmaster The rest of the question suggests otherwise."}, {"owner": {"reputation": 2865, "user_id": 171520, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3da837d1227e7df8153c68d502f64994?s=128&d=identicon&r=PG", "display_name": "Dave Challis", "link": "https://stackoverflow.com/users/171520/dave-challis"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541170681, "post_id": 53119182, "comment_id": 93136383, "body": "@Shepmaster I&#39;m happy to leave that in your hands. The questioned you linked gets me a bit closer to an answer (though I didn&#39;t find it through searching, as I was just looking for ways of conditionally chaining, rather than a solution that involved new futures).  Sven&#39;s answer is also helpful, and closer to the answer I might end up with.  The actual issue turns out to be more complicated than I&#39;d thought, but will see if I can get anything working with <code>Either</code> first."}, {"owner": {"reputation": 2865, "user_id": 171520, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3da837d1227e7df8153c68d502f64994?s=128&d=identicon&r=PG", "display_name": "Dave Challis", "link": "https://stackoverflow.com/users/171520/dave-challis"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541171202, "post_id": 53119182, "comment_id": 93136643, "body": "@Shepmaster sorry, hit return too early on that comment. I didn&#39;t initially realise what <code>and_then</code> returned, I thought it returned the original future, rather than a new one.  I&#39;m working with a type from a 3rd party crate that is both impl <code>Future</code> and some other things, so returning a new future from <code>and_then</code> doesn&#39;t work, as it lacks the other traits the original future did."}], "answers": [{"tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 5, "last_activity_date": 1541165050, "creation_date": 1541165050, "answer_id": 53119404, "question_id": 53119182, "link": "https://stackoverflow.com/questions/53119182/conditionally-chaining-a-rust-future-based-on-initial-future-result/53119404#53119404", "title": "Conditionally chaining a Rust future based on initial future result?", "body": "<p>If you want to chain another future, you need to use the <code>and_then()</code> future combinator, not <code>map()</code>.  This combinator expects another future as return value, so <em>both</em> branches of your <code>if</code> statement need to yield a future.  In the first branch, you want to chain <code>double(v)</code>, which already is a future.  In the second branch you want pass on the value unchanged, so you need to turn it into a future that immediately resolves to <code>v</code> using <code>future::ok()</code>.  Since <code>double(v)</code> and <code>future::ok(v)</code> have different types, you need to either use <code>future::Either</code>, or box the futures.  Here is one option:</p>\n\n<pre><code>fn add_one_then_double(x: i64) -&gt; impl Future&lt;Item=i64, Error=()&gt; {\n    future::ok(x)\n        .and_then(add_one)\n        .and_then(|v| {\n            if v &gt;= 0 {\n                future::Either::A(double(v))\n            } else {\n                future::Either::B(future::ok(v))\n            }\n        })\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=b59f24728233ab87e16ea856bddc6b2c\" rel=\"noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 2865, "user_id": 171520, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3da837d1227e7df8153c68d502f64994?s=128&d=identicon&r=PG", "display_name": "Dave Challis", "link": "https://stackoverflow.com/users/171520/dave-challis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 950, "favorite_count": 0, "accepted_answer_id": 53119404, "answer_count": 1, "score": 3, "last_activity_date": 1541165050, "creation_date": 1541164060, "last_edit_date": 1541165038, "question_id": 53119182, "link": "https://stackoverflow.com/questions/53119182/conditionally-chaining-a-rust-future-based-on-initial-future-result", "title": "Conditionally chaining a Rust future based on initial future result?", "body": "<p>If I've got some futures that I'm chaining together, how can I make the second chained future conditional on the result of the first future?</p>\n\n<p>For a contrived example, I've got something like:</p>\n\n<pre><code>extern crate futures;\nextern crate tokio_core;\n\nuse futures::{future, Future};\nuse tokio_core::reactor::Core;\n\nfn add_one(x: i64) -&gt; impl Future&lt;Item = i64, Error = ()&gt; {\n    future::ok(x).map(|x| x + 1)\n}\n\nfn double(x: i64) -&gt; impl Future&lt;Item = i64, Error = ()&gt; {\n    future::ok(x).map(|x| x * 2)\n}\n\nfn add_one_then_double(x: i64) -&gt; impl Future&lt;Item = i64, Error = ()&gt; {\n    future::ok(x).and_then(add_one).and_then(double)\n}\n\nfn main() {\n    let mut reactor = Core::new().unwrap();\n    println!(\"{:?}\", reactor.run(add_one_then_double(10)).unwrap());\n}\n</code></pre>\n\n<p>How can I then change the <code>add_one_then_double</code> future to be conditional on the result of the <code>add_one</code> future, e.g.:</p>\n\n<pre><code>fn add_one_then_double_if_positive(x: i64) -&gt; impl Future&lt;Item = i64, Error = ()&gt; {\n    future::ok(x).and_then(add_one).map(|v| {\n        if v &gt;= 0 {\n            // chain the `double` future\n        } else {\n            // return `v` as the result\n        }\n    })\n}\n</code></pre>\n"}, {"tags": ["reference", "rust", "iterator"], "answers": [{"comments": [{"owner": {"reputation": 51550, "user_id": 1458569, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mPKhD.png?s=128&g=1", "display_name": "Igor Chubin", "link": "https://stackoverflow.com/users/1458569/igor-chubin"}, "edited": false, "score": 0, "creation_date": 1541152616, "post_id": 53116103, "comment_id": 93126976, "body": "Yes, it works like a charm! The point was to add something before <code>collect()</code> and not after. Very well! But (I am just curious now) what happens if we already have a vector of references? and we want to convert them to vector of values? Should we use <code>cloned()</code> in this case too?"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "reply_to_user": {"reputation": 51550, "user_id": 1458569, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mPKhD.png?s=128&g=1", "display_name": "Igor Chubin", "link": "https://stackoverflow.com/users/1458569/igor-chubin"}, "edited": false, "score": 1, "creation_date": 1541153345, "post_id": 53116103, "comment_id": 93127350, "body": "Yes. Thefunction <code>ret_tup</code> does exactly that."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541163366, "post_id": 53116103, "comment_id": 93132286, "body": "<i>This works for every type that implements <code>Clone</code></i> \u2014 perhaps you can show the generic version that literally works for any type that implements <code>Clone</code>?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541164572, "post_id": 53116103, "comment_id": 93132895, "body": "@hellow the question and the error <i>never</i> matched \u2014 OP didn&#39;t provide anything that required a value, just showed an error from code they didn&#39;t post."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1541164818, "post_id": 53116103, "comment_id": 93133029, "body": "<i>you can&#39;t use <code>into_iter</code></i> \u2014 you can, and the function does own the slice, it just has the same problem."}, {"owner": {"reputation": 3719, "user_id": 2550406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GhBMm.png?s=128&g=1", "display_name": "lucidbrot", "link": "https://stackoverflow.com/users/2550406/lucidbrot"}, "edited": false, "score": 0, "creation_date": 1570392022, "post_id": 53116103, "comment_id": 102890218, "body": "I would appreciate an explanation why the vector iterator iterates over references in the first place. Is that because the values are at the same memory location as the values of the original vector?"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "reply_to_user": {"reputation": 3719, "user_id": 2550406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GhBMm.png?s=128&g=1", "display_name": "lucidbrot", "link": "https://stackoverflow.com/users/2550406/lucidbrot"}, "edited": false, "score": 1, "creation_date": 1570429434, "post_id": 53116103, "comment_id": 102896631, "body": "@lucidbrot <i>&quot;the vector iterator iterates over references&quot;</i>: it doesn&#39;t? The slice <code>iter()</code> function does. Do you mean that? If yes, the reason is that <code>into_iter</code> consumes the <code>Vec</code> which is not possible, because you only have a borrowed slice (<code>&amp;[T]</code>). You don&#39;t own it, therefore you only can iterate over its references."}, {"owner": {"reputation": 3719, "user_id": 2550406, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/GhBMm.png?s=128&g=1", "display_name": "lucidbrot", "link": "https://stackoverflow.com/users/2550406/lucidbrot"}, "edited": false, "score": 0, "creation_date": 1570446516, "post_id": 53116103, "comment_id": 102903805, "body": "@hellow oh thanks! As a rust newbie, I did not realize <a href=\"https://stackoverflow.com/a/34745885/2550406\">the difference between <code>iter</code> and <code>into_iter</code></a> and I think I read somewhere that they do the same thing, so I just believed that one is old syntax for the other. Your comment helped me :)"}], "tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": true, "score": 17, "last_activity_date": 1601026342, "last_edit_date": 1601026342, "creation_date": 1541151811, "answer_id": 53116103, "question_id": 53115999, "link": "https://stackoverflow.com/questions/53115999/what-is-the-idiomatic-way-of-converting-a-vec-of-references-to-a-vec-of-values/53116103#53116103", "title": "What is the idiomatic way of converting a Vec of references to a Vec of values?", "body": "<h3>Update from 1.36.0</h3>\n<p>Rust 1.36.0 introduced <a href=\"https://doc.rust-lang.org/core/iter/trait.Iterator.html#method.copied\" rel=\"nofollow noreferrer\"><code>copied</code></a> which works like <code>cloned</code>, but uses the <code>Copy</code> trait, which has the requirement, that the copy is cheap (e.g. a <code>memcpy</code> only). If you have primitive types or types that implement <code>Copy</code> you can use that instead.</p>\n<hr />\n<p>To make your example work, use <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.cloned\" rel=\"nofollow noreferrer\"><code>cloned</code></a> and then <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.collect\" rel=\"nofollow noreferrer\"><code>collect</code></a>.</p>\n<pre><code>let maxs: HashSet&lt;(usize,usize)&gt; = HashSet::new();\nlet mins: HashSet&lt;(usize,usize)&gt; = HashSet::new();\nlet output: Vec&lt;(usize, usize)&gt; = maxs.intersection(&amp;mins).cloned().collect();\n</code></pre>\n<hr />\n<p>This solution will work with any type than implements <a href=\"https://doc.rust-lang.org/std/clone/trait.Clone.html\" rel=\"nofollow noreferrer\"><code>Clone</code></a>:</p>\n<pre><code>pub fn clone_vec&lt;T: Clone&gt;(vec: Vec&lt;&amp;T&gt;) -&gt; Vec&lt;T&gt; {\n    vec.into_iter().cloned().collect()\n}\n</code></pre>\n<p>If your function accepts a slice, you have to use <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.cloned\" rel=\"nofollow noreferrer\"><code>cloned</code></a> twice.</p>\n<pre><code>pub fn clone_slice&lt;T: Clone&gt;(slice: &amp;[&amp;T]) -&gt; Vec&lt;T&gt; {\n    slice.iter().cloned().cloned().collect()\n}\n</code></pre>\n<p>The reason for this is that <a href=\"https://doc.rust-lang.org/std/primitive.slice.html#method.iter\" rel=\"nofollow noreferrer\"><code>iter()</code></a> returns an iterator over references of the slice, which results in <code>&amp;&amp;T</code>.</p>\n<hr />\n<p>If you happen to have a type that does not implement <a href=\"https://doc.rust-lang.org/std/clone/trait.Clone.html\" rel=\"nofollow noreferrer\"><code>Clone</code></a>, you can mimic the behavior with <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.map\" rel=\"nofollow noreferrer\"><code>map</code></a></p>\n<pre><code>pub struct Foo(u32);\n\nimpl Foo {\n    fn dup(&amp;self) -&gt; Self {\n        Foo(self.0)\n    }\n}\n\npub fn clone_vec(vec: Vec&lt;&amp;Foo&gt;) -&gt; Vec&lt;Foo&gt; {\n    vec.into_iter().map(|f| f.dup()).collect()\n}\n\npub fn clone_vec2(vec: Vec&lt;&amp;Foo&gt;) -&gt; Vec&lt;Foo&gt; {\n    // this function is identical to `clone_vec`, but with another syntax\n    vec.into_iter().map(Foo::dup).collect()\n}\n</code></pre>\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=d2d4c87def16b9112647c9756657f1ae\" rel=\"nofollow noreferrer\">playground</a>)</p>\n"}], "owner": {"reputation": 51550, "user_id": 1458569, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/mPKhD.png?s=128&g=1", "display_name": "Igor Chubin", "link": "https://stackoverflow.com/users/1458569/igor-chubin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3774, "favorite_count": 1, "accepted_answer_id": 53116103, "answer_count": 1, "score": 12, "last_activity_date": 1601026342, "creation_date": 1541151419, "last_edit_date": 1541163253, "question_id": 53115999, "link": "https://stackoverflow.com/questions/53115999/what-is-the-idiomatic-way-of-converting-a-vec-of-references-to-a-vec-of-values", "title": "What is the idiomatic way of converting a Vec of references to a Vec of values?", "body": "<p>My function returns a <code>Vec</code> of references to a tuple, but I need a <code>Vec</code> of tuples:</p>\n\n<pre><code>use std::collections::HashSet;\n\nfn main() {\n    let maxs: HashSet&lt;(usize, usize)&gt; = HashSet::new();\n    let mins: HashSet&lt;(usize, usize)&gt; = HashSet::new();\n    let intersection = maxs.intersection(&amp;mins).collect::&lt;Vec&lt;&amp;(usize, usize)&gt;&gt;();\n}\n</code></pre>\n\n<p>How should I do the conversion?</p>\n\n<p>Error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>19 |     maxs.intersection(&amp;mins).collect::&lt;Vec&lt;&amp;(usize, usize)&gt;&gt;()\n   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected tuple, found reference\n   |\n   = note: expected type `std::vec::Vec&lt;(usize, usize)&gt;`\n          found type `std::vec::Vec&lt;&amp;(usize, usize)&gt;`\n</code></pre>\n\n<p>I'm <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=f2858443a65735412c0c1c7bf99cab39\" rel=\"noreferrer\">using a <code>for</code> loop to do the conversion</a>, but I don't like it and I think there should be a mode idiomatic way:</p>\n\n<pre><code>for t in maxs.intersection(&amp;mins).collect::&lt;Vec&lt;&amp;(usize, usize)&gt;&gt;().iter() {\n    output.push(**t);\n}\n</code></pre>\n"}, {"tags": ["rust", "heap", "priority-queue"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 2, "last_activity_date": 1541162825, "last_edit_date": 1541162825, "creation_date": 1541124063, "answer_id": 53111755, "question_id": 53111721, "link": "https://stackoverflow.com/questions/53111721/can-i-modify-a-value-inside-a-binaryheap-that-isnt-the-top-value/53111755#53111755", "title": "Can I modify a value inside a BinaryHeap that isn&#39;t the top value?", "body": "<blockquote>\n  <p>modify a value [...] and have the heap updated</p>\n</blockquote>\n\n<p>No, the standard library's implementation of <code>BinaryHeap</code> does not allow adjusting any values that would require the heap ordering to change. The documentation even specifically <a href=\"https://doc.rust-lang.org/std/collections/struct.BinaryHeap.html\" rel=\"nofollow noreferrer\">calls out interior mutability as a bad idea</a> (emphasis mine):</p>\n\n<blockquote>\n  <p>It is a logic error for an item to be modified in such a way that the item's ordering relative to any other item, as determined by the <code>Ord</code> trait, changes while it is in the heap. This is normally only possible through <strong>Cell, RefCell</strong>, global state, I/O, or unsafe code.</p>\n</blockquote>\n\n<p>There may be alternate implementations of binary heaps on crates.io, however.</p>\n"}, {"comments": [{"owner": {"reputation": 117, "user_id": 7501404, "user_type": "registered", "profile_image": "https://graph.facebook.com/1382057821835787/picture?type=large", "display_name": "Khalid Akash", "link": "https://stackoverflow.com/users/7501404/khalid-akash"}, "edited": false, "score": 0, "creation_date": 1541197529, "post_id": 53116001, "comment_id": 93147731, "body": "Thank you for the detailed answer. Looks like I need to implement my own version. :p"}, {"owner": {"reputation": 6527, "user_id": 1422197, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6bcbddbd9c7b31aaff8cf25a356bc96c?s=128&d=identicon&r=PG", "display_name": "gnzlbg", "link": "https://stackoverflow.com/users/1422197/gnzlbg"}, "reply_to_user": {"reputation": 117, "user_id": 7501404, "user_type": "registered", "profile_image": "https://graph.facebook.com/1382057821835787/picture?type=large", "display_name": "Khalid Akash", "link": "https://stackoverflow.com/users/7501404/khalid-akash"}, "edited": false, "score": 0, "creation_date": 1541252756, "post_id": 53116001, "comment_id": 93157355, "body": "Note that you can go from <code>BinaryHeap</code> to a sorted <code>Vec</code> and back, so if you need to perform a modification, you could modify the sorted <code>Vec</code>, resort afterwards, and convert that back to a <code>BinaryHeap</code>."}, {"owner": {"reputation": 117, "user_id": 7501404, "user_type": "registered", "profile_image": "https://graph.facebook.com/1382057821835787/picture?type=large", "display_name": "Khalid Akash", "link": "https://stackoverflow.com/users/7501404/khalid-akash"}, "edited": false, "score": 0, "creation_date": 1541278246, "post_id": 53116001, "comment_id": 93163970, "body": "Mhm I noticed that. The issue is the move operation for the benchmarks I&#39;m doing can be expensive (at least that&#39;s how I assume ownership works with the into_vec function, still a rust beginner). I will keep this in mind in the future, already implemented my own though :p."}], "tags": [], "owner": {"reputation": 6527, "user_id": 1422197, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6bcbddbd9c7b31aaff8cf25a356bc96c?s=128&d=identicon&r=PG", "display_name": "gnzlbg", "link": "https://stackoverflow.com/users/1422197/gnzlbg"}, "is_accepted": true, "score": 2, "last_activity_date": 1541253457, "last_edit_date": 1541253457, "creation_date": 1541151420, "answer_id": 53116001, "question_id": 53111721, "link": "https://stackoverflow.com/questions/53111721/can-i-modify-a-value-inside-a-binaryheap-that-isnt-the-top-value/53116001#53116001", "title": "Can I modify a value inside a BinaryHeap that isn&#39;t the top value?", "body": "<blockquote>\n  <p>Is there any way I can modify a value inside a Min-Heap that isn't the top, and have the heap updated to do so? </p>\n</blockquote>\n\n<p>You can modify values inside a Min-Heap, but no, the modification shall not alter the ordering of the item relatively to any other item in the <code>BinaryHeap</code>. Otherwise, the <code>BinaryHeap</code> will not be a max heap any more and there is no way to update it. You could convert the <code>BinaryHeap</code> to a sorted <code>Vec</code>, modify, re-sort, and convert the sorted <code>Vec</code> back into a <code>BinaryHeap</code>.</p>\n\n<p>Example of how to modify elements inside a <code>BinaryHeap</code> without changing the relative order (full example in the <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=66a2826b7713ed93cd9f7351b81457d7\" rel=\"nofollow noreferrer\">playground</a>):</p>\n\n<pre><code>struct Foo(i32, Cell&lt;bool&gt;);\nimpl Ord for Foo {\n    fn cmp(&amp;self, other: &amp;Self) -&gt; cmp::Ordering {\n        self.0.cmp(&amp;other.0)\n    }\n}\n\nfn main() {\n    let mut bh = BinaryHeap::new();\n    bh.push(Foo(0, Cell::new(true)));\n    bh.push(Foo(1, Cell::new(false)));\n    bh.push(Foo(2, Cell::new(false)));\n\n    println!(\"{:?} =&gt; {:?}\", bh, bh.peek());\n    // prints: \n    // [..., Foo(1, Cell(false))] =&gt; Some(Foo(2, Cell(false)))\n\n    // Modify `Foo(1, false)` to `Foo(1, true)`:\n    for i in bh.iter() {\n        if i.0 == 1 {\n            i.1.set(true);\n        }\n    }\n\n    println!(\"{:?} =&gt; {:?}\", bh, bh.peek());\n    // prints:\n    // [..., Foo(1, Cell(true))] =&gt; Some(Foo(2, Cell(false)))\n}\n</code></pre>\n\n<p>Here, <code>Foo</code>'s <code>Ord</code> implementation only depends on the value of first field (<code>i32</code>). That is, modifying the value of <code>Foo</code>'s second field (<code>bool</code>) does not change the ordering of any <code>Foo</code> relatively to any other <code>Foo</code>. </p>\n\n<p>The requirements of <code>BinaryHeap</code> let us go one step further and also modify the first field of <code>Foo</code> as long as we don't change the ordering of any <code>Foo</code> relatively to any other <code>Foo</code> <em>in the <code>BinaryHeap</code></em>. That is, we can change <code>Foo(0,..)</code> to <code>Foo(-3,..)</code> in this particular <code>BinaryHeap</code> without issues. </p>\n\n<p>If the <code>BinaryHeap</code> were to contain a <code>Foo(-2,...)</code>, then changing <code>Foo(0,..)</code> to <code>Foo(-3,..)</code> would leave the <code>BinaryHeap</code> in an inconsistent state: it wouldn't be a max heap anymore. Still, note that no <code>unsafe</code> code is required anywhere to modify the elements of the <code>BinaryHeap</code>. That is, <code>BinaryHeap</code> upholds all safe Rust guarantees (no undefined behavior) even in the presence of \"logic errors\" that produce an inconsistent state.</p>\n\n<p>What you can do instead is to convert the heap into a vector, modify it, and convert it back into the heap which will rebuild the whole heap (<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=511646b459637ec8bb06c4baf08697d1\" rel=\"nofollow noreferrer\">playground</a>):</p>\n\n<pre><code>let mut bh = BinaryHeap::new();\nbh.push(0);\nbh.push(1);\nbh.push(2);\n\nprintln!(\"{:?} =&gt; {:?}\", bh, bh.peek());\n\n// convert into a vector:\nlet mut v = bh.into_vec();\nprintln!(\"{:?}\", v);\n\n// modify in a way that alters the order:\nv[1] = -1;\nprintln!(\"{:?}\", v);\n\n// convert back into a binary heap\nlet bh: BinaryHeap&lt;_&gt; = v.into();\nprintln!(\"{:?} =&gt; {:?}\", bh, bh.peek());\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 7501404, "user_type": "registered", "profile_image": "https://graph.facebook.com/1382057821835787/picture?type=large", "display_name": "Khalid Akash", "link": "https://stackoverflow.com/users/7501404/khalid-akash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 445, "favorite_count": 1, "accepted_answer_id": 53116001, "answer_count": 2, "score": 4, "last_activity_date": 1541253457, "creation_date": 1541123724, "last_edit_date": 1541123825, "question_id": 53111721, "link": "https://stackoverflow.com/questions/53111721/can-i-modify-a-value-inside-a-binaryheap-that-isnt-the-top-value", "title": "Can I modify a value inside a BinaryHeap that isn&#39;t the top value?", "body": "<p>Is there any way I can modify a value inside a Min-Heap that isn't the top, and have the heap updated to do so? Looking at the API, there doesn't seem to be any clear way to access these elements and invoke any type of update method. </p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541125585, "post_id": 53111718, "comment_id": 93118822, "body": "Your question may be answered by the answers of <a href=\"https://stackoverflow.com/questions/37370120/right-way-to-have-function-pointers-in-struct\">Right way to have Function pointers in struct</a> / <a href=\"https://stackoverflow.com/q/27994509/155423\">How do I call a function through a member variable?</a>. If you agree, we can mark this question as already answered."}, {"owner": {"reputation": 75, "user_id": 6159781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/061f05b9868774cb3e73e1e6db0aa734?s=128&d=identicon&r=PG&f=1", "display_name": "NutellaFan", "link": "https://stackoverflow.com/users/6159781/nutellafan"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541129559, "post_id": 53111718, "comment_id": 93119562, "body": "Ah, I need fn instead of Fn.  But I&#39;m now hitting a case where when I try to call the City new function.  Thanks for the other tips BTW, I&#39;ll try to create a new Rust playground should I have another question."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541288792, "post_id": 53123490, "comment_id": 93166131, "body": "<a href=\"https://stackoverflow.com/questions/42157511/what-is-a-function-signature-and-type\">What is a function signature and type?</a> \u2014 every function has a unique type that is <i>not</i> the function pointer type."}, {"owner": {"reputation": 1597, "user_id": 2161072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ba143872804741abb61bf862ac4bd75?s=128&d=identicon&r=PG", "display_name": "Desty", "link": "https://stackoverflow.com/users/2161072/desty"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1581973121, "post_id": 53123490, "comment_id": 106608872, "body": "@Shepmaster can you hint as to why this is? It seems that to have generic functions (e.g. a table of binary operators that take two u64s and return another u64) requires function signatures to be repeated with an <code>as fn(x) -&gt; y</code> cast. What&#39;s the benefit?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 1597, "user_id": 2161072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ba143872804741abb61bf862ac4bd75?s=128&d=identicon&r=PG", "display_name": "Desty", "link": "https://stackoverflow.com/users/2161072/desty"}, "edited": false, "score": 0, "creation_date": 1581984508, "post_id": 53123490, "comment_id": 106612291, "body": "@Desty <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=668cea6d3b1249d513d46d0571e1dbb4\" rel=\"nofollow noreferrer\">why do you say that</a>?"}, {"owner": {"reputation": 1597, "user_id": 2161072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ba143872804741abb61bf862ac4bd75?s=128&d=identicon&r=PG", "display_name": "Desty", "link": "https://stackoverflow.com/users/2161072/desty"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1582070413, "post_id": 53123490, "comment_id": 106648052, "body": "@Shepmaster just wondering if you knew the reason that the &quot;every function has a unique type&quot; feature was added to Rust. Like, what problem that solves. I just discovered it while trying to apply a series of functions to some input, and was surprised that it was not possible without casting them to a more generic function pointer with <code>as</code>."}, {"owner": {"reputation": 1597, "user_id": 2161072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ba143872804741abb61bf862ac4bd75?s=128&d=identicon&r=PG", "display_name": "Desty", "link": "https://stackoverflow.com/users/2161072/desty"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1582070492, "post_id": 53123490, "comment_id": 106648067, "body": "@Shepmaster oh just noticed your example in the Playground where that isn&#39;t necessary. Now I&#39;m more confused than ever! :D"}], "tags": [], "owner": {"reputation": 75, "user_id": 6159781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/061f05b9868774cb3e73e1e6db0aa734?s=128&d=identicon&r=PG&f=1", "display_name": "NutellaFan", "link": "https://stackoverflow.com/users/6159781/nutellafan"}, "is_accepted": false, "score": 1, "last_activity_date": 1541288707, "last_edit_date": 1541288707, "creation_date": 1541180625, "answer_id": 53123490, "question_id": 53111718, "link": "https://stackoverflow.com/questions/53111718/embedding-a-rust-generic-with-generic-functions-inside-another-struct/53123490#53123490", "title": "Embedding a Rust generic with generic functions inside another struct", "body": "<p>There's two answers to this question:</p>\n\n<ol>\n<li><p>Specifying the type parameters when creating the the container.  I don't know why that works, but it does:</p>\n\n<pre><code>let container = MyContainer::&lt;House, fn(&amp;House) -&gt; u32&gt;::new(num_houses, get_size_func);\n</code></pre></li>\n<li><p>You can also define a generic function that calls a generic trait for an added kick.  For example:</p>\n\n<pre><code> let container = MyContainer::&lt;House, fn(&amp;House) -&gt; u32&gt;::new(num_houses, get_size_func2::&lt;House&gt;);\n</code></pre>\n\n<p><code>get_size_func2</code> would be a trait bound generic function.</p></li>\n</ol>\n\n<p>Here's <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=ee22c5b392d1b1cbb128530f91d0abc0\" rel=\"nofollow noreferrer\">the full playground</a>. For both solutions, type parameters are required and not deduced in the <code>City::new</code> function.</p>\n"}], "owner": {"reputation": 75, "user_id": 6159781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/061f05b9868774cb3e73e1e6db0aa734?s=128&d=identicon&r=PG&f=1", "display_name": "NutellaFan", "link": "https://stackoverflow.com/users/6159781/nutellafan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1541288707, "creation_date": 1541123695, "last_edit_date": 1541288652, "question_id": 53111718, "link": "https://stackoverflow.com/questions/53111718/embedding-a-rust-generic-with-generic-functions-inside-another-struct", "title": "Embedding a Rust generic with generic functions inside another struct", "body": "<p>I have this generic type:</p>\n\n<pre><code>pub struct MyContainer&lt;T, S&gt; {\n    array: Vec&lt;T&gt;,\n    get_size: S,\n    size: u32,\n}\n\nimpl&lt;T: Default, S&gt; MyContainer&lt;T, S&gt;\nwhere\n    S: Fn(&amp;T) -&gt; u32,\n{\n    pub fn new(size: u32, get_size: S) -&gt; MyContainer&lt;T, S&gt; {\n        let array = Vec::with_capacity(size as usize);\n        MyContainer {\n            array,\n            get_size,\n            size,\n        }\n    }\n}\n</code></pre>\n\n<p>I can easily create a container using compiler deduction magic:</p>\n\n<pre><code>pub fn get_size_func(h: &amp;House) -&gt; u32 {\n    h.num_rooms\n}\n</code></pre>\n\n\n\n<pre><code>let container = MyContainer::new(6, get_size);\n</code></pre>\n\n<p>However, I'm hitting an issue when I try to instantiate my generic type in another struct:</p>\n\n<pre><code>pub struct City {\n    suburbs: MyContainer&lt;House, fn(&amp;House) -&gt; u32&gt;,\n}\n\nimpl City {\n    pub fn new(num_houses: u32) -&gt; City {\n        let container = MyContainer::new(num_houses, get_size_func);\n        City { suburbs: container }\n    }\n}\n</code></pre>\n\n<p>I get </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n  --&gt; src/lib.rs:44:25\n   |\n44 |         City { suburbs: container }\n   |                         ^^^^^^^^^ expected fn pointer, found fn item\n   |\n   = note: expected type `MyContainer&lt;_, for&lt;'r&gt; fn(&amp;'r House) -&gt; u32&gt;`\n              found type `MyContainer&lt;_, for&lt;'r&gt; fn(&amp;'r House) -&gt; u32 {get_size_func}&gt;`\n</code></pre>\n\n<p>Here's the <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=c9a87c826131b393ace8bb21f18116f1\" rel=\"nofollow noreferrer\">Rust playground that reproduces the problem</a></p>\n"}, {"tags": ["rust", "rust-tokio"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541119570, "post_id": 53110857, "comment_id": 93117666, "body": "<a href=\"https://stackoverflow.com/q/40006219/155423\">Why is it discouraged to accept a reference to a String (&amp;String), Vec (&amp;Vec) or Box (&amp;Box) as a function argument?</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541119712, "post_id": 53110857, "comment_id": 93117690, "body": "<i>expected signature of <code>fn(Result&lt;Vec&lt;...&gt;, ...&gt;</code></i> \u2014 why does your closure have a <code>Result&lt;(), ...&gt;</code>? What do you think the result of calling <code>collect</code> will be?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541119803, "post_id": 53110857, "comment_id": 93117709, "body": "<i>a future which returns a <code>Vec&lt;String&gt;</code></i> You don&#39;t have that. You have a <i>stream</i> that returns <code>Vec&lt;String&gt;</code>."}, {"owner": {"reputation": 362, "user_id": 3819791, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/4Mha2.png?s=128&g=1", "display_name": "Markus", "link": "https://stackoverflow.com/users/3819791/markus"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541154767, "post_id": 53110857, "comment_id": 93128125, "body": "@Shepmaster Yes, in the sample I&#39;ve a stream. Does this matter so much? I don&#39;t know how to get a future from a Vec in the same short way. About the result I&#39;m not quite sure: I think it will be a Vec out of (). At the end it doesn&#39;t matter for me. I&#39;d like to throw away all results. I&#39;ve thought I use the collect to get a single value in the &quot;result tree&quot; to come closer to the end result Future&lt;Item=(),...&gt;."}, {"owner": {"reputation": 362, "user_id": 3819791, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/4Mha2.png?s=128&g=1", "display_name": "Markus", "link": "https://stackoverflow.com/users/3819791/markus"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541155627, "post_id": 53110857, "comment_id": 93128543, "body": "Ah. I&#39;ve forgot to say that the collect is more or less an embarrassment, because of the Type errors. In my understanding a final then() at the outer end could be enough. But then there is no then() found for the traits... or something like that. I don&#39;t understand these error messages of the futures."}, {"owner": {"reputation": 362, "user_id": 3819791, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/4Mha2.png?s=128&g=1", "display_name": "Markus", "link": "https://stackoverflow.com/users/3819791/markus"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541157162, "post_id": 53110857, "comment_id": 93129266, "body": "Maybe I see this too much like JS Promises to understand what&#39;s going on. But I lack some documentation/information to get lucidity."}], "answers": [{"comments": [{"owner": {"reputation": 362, "user_id": 3819791, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/4Mha2.png?s=128&g=1", "display_name": "Markus", "link": "https://stackoverflow.com/users/3819791/markus"}, "edited": false, "score": 0, "creation_date": 1541165759, "post_id": 53119270, "comment_id": 93133559, "body": "Ok. I&#39;ll try this way."}, {"owner": {"reputation": 362, "user_id": 3819791, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/4Mha2.png?s=128&g=1", "display_name": "Markus", "link": "https://stackoverflow.com/users/3819791/markus"}, "edited": false, "score": 0, "creation_date": 1541241319, "post_id": 53119270, "comment_id": 93154608, "body": "Do you know why the inner futures only get polled if I use the block_on()? On run() or spawn() I have to either wait the inner ones or use another spawn(). That&#39;s the cause why I got into trouble with it. I thought I have something wrong with building my future chain... but maybe this probably works like this. At place of future::ok in your code, I&#39;ve another_future().then(|_| {println!(&quot;works&quot;);ok(())}) The &quot;works&quot; I only see when using block_on(iterate_over), wait() or tokio::spawn. I return all the inner futures back to the caller, shouldn&#39;t there be a &quot;relation/knowledge&quot;?!"}, {"owner": {"reputation": 362, "user_id": 3819791, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/4Mha2.png?s=128&g=1", "display_name": "Markus", "link": "https://stackoverflow.com/users/3819791/markus"}, "edited": false, "score": 0, "creation_date": 1541251982, "post_id": 53119270, "comment_id": 93157162, "body": "Here is one which starts with vec-&gt;stream: <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=2fc0a1532bc7b80520be2a31d593b461\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 0, "last_activity_date": 1541164480, "creation_date": 1541164480, "answer_id": 53119270, "question_id": 53110857, "link": "https://stackoverflow.com/questions/53110857/future-and-stream-nesting-with-type-problems/53119270#53119270", "title": "Future and Stream nesting with type problems", "body": "<pre><code>extern crate tokio; // 0.1.11\n\nuse tokio::prelude::*;\n\n// a future which returns a Vec&lt;String&gt;\nfn makes_strings() -&gt; impl Future&lt;Item = Vec&lt;String&gt;, Error = ()&gt; {\n    future::ok(vec![])\n}\n\nfn make_new_string(el: String) -&gt; impl Future&lt;Item = String, Error = ()&gt; {\n    future::ok(el + \"-ok\")\n}\n\nfn iterate_over() -&gt; impl Future&lt;Item = Vec&lt;String&gt;, Error = ()&gt; {\n    makes_strings().and_then(|v| {\n        // iterate over this\n        let strings = v.into_iter();\n        // give the values to another future\n        let futures = strings.map(make_new_string);\n        // The complete thing should be a future\n        future::join_all(futures)\n    })\n}\n</code></pre>\n\n<ul>\n<li><a href=\"https://docs.rs/futures/0.1.25/futures/future/fn.ok.html\" rel=\"nofollow noreferrer\"><code>future::ok</code></a></li>\n<li><a href=\"https://docs.rs/futures/0.1.25/futures/future/trait.Future.html#method.and_then\" rel=\"nofollow noreferrer\"><code>Future::and_then</code></a></li>\n<li><a href=\"https://docs.rs/futures/0.1.25/futures/future/fn.join_all.html\" rel=\"nofollow noreferrer\"><code>future::join_all</code></a></li>\n</ul>\n"}], "owner": {"reputation": 362, "user_id": 3819791, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/4Mha2.png?s=128&g=1", "display_name": "Markus", "link": "https://stackoverflow.com/users/3819791/markus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "accepted_answer_id": 53119270, "answer_count": 1, "score": 0, "last_activity_date": 1541164480, "creation_date": 1541115586, "last_edit_date": 1541119462, "question_id": 53110857, "link": "https://stackoverflow.com/questions/53110857/future-and-stream-nesting-with-type-problems", "title": "Future and Stream nesting with type problems", "body": "<p>I'd like to use a future which returns a <code>Vec&lt;String&gt;</code>, iterate over this in a future-stream and give the values to another future and the result of this future should be handled. The complete thing should be a future, too.</p>\n\n<p>What's the way to go? I've tried different approaches and with all I've got type problems, which I don't understand.</p>\n\n<p>Why there are these nested future result type signatures? Shouldn't this become the final result? Why doesn't the compiler know the types?</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0631]: type mismatch in closure arguments\n  --&gt; src/lib.rs:45:18\n   |\n45 |                 .then(|x: Result&lt;(), ()&gt;| ok(()))\n   |                  ^^^^ -------------------------- found signature of `fn(std::result::Result&lt;(), ()&gt;) -&gt; _`\n   |                  |\n   |                  expected signature of `fn(std::result::Result&lt;std::vec::Vec&lt;tokio::prelude::future::Then&lt;tokio::prelude::future::Then&lt;impl tokio::prelude::Future, tokio::prelude::future::FutureResult&lt;(), ()&gt;, [closure@src/lib.rs:35:31: 41:26]&gt;, tokio::prelude::future::FutureResult&lt;(), _&gt;, [closure@src/lib.rs:42:31: 42:57]&gt;&gt;, _&gt;) -&gt; _`\n</code></pre>\n\n<p>I've setup a <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=6bc5caece7a29fa46c776999010e4b59\" rel=\"nofollow noreferrer\">Playground</a> for this</p>\n\n<pre><code>extern crate tokio;\n\nuse tokio::prelude::future::ok;\nuse tokio::prelude::*;\n\n#[allow(dead_code)]\npub fn test_future&lt;F&gt;(f: F) -&gt; Result&lt;F::Item, F::Error&gt;\nwhere\n    F: IntoFuture,\n    F::Future: Send + 'static,\n    F::Item: Send + 'static,\n    F::Error: Send + 'static,\n{\n    let mut runtime = tokio::runtime::Runtime::new().expect(\"Unable to create a runtime\");\n    runtime.block_on(f.into_future())\n}\n\n#[allow(dead_code)]\nfn fut(el: &amp;String) -&gt; impl Future&lt;Item = String, Error = std::io::Error&gt; {\n    ok((el.to_string() + \"-ok\").to_string())\n}\n\n#[test]\nfn reporting_future_result_test() {\n    let v = vec![\n        vec![\"a\".to_string(), \"b\".to_string()],\n        vec![\"a\".to_string(), \"b\".to_string()],\n    ];\n\n    let f = stream::iter_ok(v.iter().cloned())\n        .map(|el: Vec&lt;String&gt;| {\n            stream::iter_ok(el.iter().cloned())\n                .map(|ell: String| {\n                    fut(&amp;ell)\n                        .then(|x: Result&lt;String, std::io::Error&gt;| {\n                            match x {\n                                Ok(s) =&gt; println!(\"{}\", s),\n                                Err(e) =&gt; println!(\"{:?}\", e),\n                            };\n                            ok(())\n                        })\n                        .then(|x: Result&lt;(), ()&gt;| ok(()))\n                })\n                .collect()\n                .then(|x: Result&lt;(), ()&gt;| ok(()))\n        })\n        .collect()\n        .then(|x: Result&lt;Vec&lt;_&gt;, std::io::Error&gt;| ok(()));\n\n    let r = test_future(f);\n\n    match r {\n        Ok(x) =&gt; println!(\"{:?}\", x),\n        Err(_) =&gt; println!(\"error\"),\n    }\n}\n</code></pre>\n"}, {"tags": ["for-loop", "rust"], "comments": [{"owner": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 0, "creation_date": 1541112505, "post_id": 53110318, "comment_id": 93116000, "body": "<a href=\"https://stackoverflow.com/questions/23920968/why-does-the-binary-operator-not-work-with-two-mut-int\">This here</a> looks related, but the answer says just <i>&quot;the <code>+</code> operator is not implemented for <code>&amp;mut i32</code>&quot;</i>. From that answer, it&#39;s not clear <i>why</i> it&#39;s not implemented."}, {"owner": {"reputation": 3469, "user_id": 2574612, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4b008a3d7ce933943329e84c1dbe6db7?s=128&d=identicon&r=PG", "display_name": "Nicholas Pipitone", "link": "https://stackoverflow.com/users/2574612/nicholas-pipitone"}, "reply_to_user": {"reputation": 38158, "user_id": 2707792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/hjDjB.png?s=128&g=1", "display_name": "Andrey Tyukin", "link": "https://stackoverflow.com/users/2707792/andrey-tyukin"}, "edited": false, "score": 0, "creation_date": 1541112957, "post_id": 53110318, "comment_id": 93116127, "body": "I can see that <code>+</code> is implemented for <code>&amp;</code> and not <code>&amp;mut</code>, but my question is more about what the type of <code>e</code> is in <code>sum2</code>. It doesn&#39;t appear that Rust has a <code>typeof</code> operator to check against."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541113161, "post_id": 53110318, "comment_id": 93116190, "body": "<i>My question boils down to: &quot;Is e an i32, or an &amp;i32?&quot;</i> \u2014 Does <a href=\"https://stackoverflow.com/q/21747136/155423\">How do I print the type of a variable in Rust?</a> answer your question?"}, {"owner": {"reputation": 3469, "user_id": 2574612, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4b008a3d7ce933943329e84c1dbe6db7?s=128&d=identicon&r=PG", "display_name": "Nicholas Pipitone", "link": "https://stackoverflow.com/users/2574612/nicholas-pipitone"}, "edited": false, "score": 0, "creation_date": 1541113445, "post_id": 53110318, "comment_id": 93116264, "body": "Hm, it may but moreso I was looking for something with respect to how for loops over vectors and iterators work. My <code>typeof</code> reference was a bit misplaced (And turns it into an XY problem if I&#39;m just looking for an answer to &quot;<code>typeof</code> in Rust?&quot;)"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541113671, "post_id": 53110318, "comment_id": 93116315, "body": "Then are you looking for <a href=\"https://stackoverflow.com/q/27224927/155423\">What is the exact definition of the for loop in Rust?</a>?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541114141, "post_id": 53110318, "comment_id": 93116453, "body": "Also related: <a href=\"https://stackoverflow.com/q/43036279/155423\">What does it mean to pass in a vector into a <code>for</code> loop versus a reference to a vector?</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541120009, "post_id": 53110318, "comment_id": 93117753, "body": "Argh, SO deleted your comment when I marked it as a duplicate \u2014 can you re-comment with the third link you listed? I think it was <a href=\"https://stackoverflow.com/questions/34733811/what-is-the-difference-between-iter-and-into-iter\" title=\"what is the difference between iter and into iter\">stackoverflow.com/questions/34733811/&hellip;</a>"}, {"owner": {"reputation": 3469, "user_id": 2574612, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4b008a3d7ce933943329e84c1dbe6db7?s=128&d=identicon&r=PG", "display_name": "Nicholas Pipitone", "link": "https://stackoverflow.com/users/2574612/nicholas-pipitone"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1541175455, "post_id": 53110318, "comment_id": 93139034, "body": "@Shepmaster Yes, that one was it."}], "owner": {"reputation": 3469, "user_id": 2574612, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4b008a3d7ce933943329e84c1dbe6db7?s=128&d=identicon&r=PG", "display_name": "Nicholas Pipitone", "link": "https://stackoverflow.com/users/2574612/nicholas-pipitone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "closed_date": 1541119938, "answer_count": 0, "score": 3, "last_activity_date": 1541175789, "creation_date": 1541111690, "last_edit_date": 1541175789, "question_id": 53110318, "link": "https://stackoverflow.com/questions/53110318/does-a-for-loop-operate-on-references-or-by-value", "closed_reason": "Duplicate", "title": "Does a for loop operate on references or by value?", "body": "<p>This aspect of Rust seems rather bizarre at first, and I'd like to know how <code>for</code> typing works in this case.</p>\n\n<pre><code>fn sum1(v: &amp;mut Vec&lt;i32&gt;) -&gt; i32 {\n    // I know I don't mutate v, but that's not the point\n    let mut s = 0;\n    for e in v {\n        s += *e;\n        // s += e; &lt;- Err!\n    }\n    s\n}\n\nfn sum2(v: &amp;Vec&lt;i32&gt;) -&gt; i32 {\n    let mut s = 0;\n    for e in v {\n        s += e; // Okay?\n    }\n    s\n}\n\nfn main() {\n    let mut v = vec![1, 2, 3];\n    println!(\"{}\", sum1(&amp;mut v));\n    println!(\"{}\", sum2(&amp;v));\n}\n</code></pre>\n\n<p>At first I was confused as to why it wanted me to dereference in <code>sum1</code>. But okay, it's saying <code>AddAssign&lt;&amp;mut i32&gt;</code> is not implemented, so I see that <code>e</code> is <code>&amp;mut i32</code>. That's really awesome for changing <code>e</code> on the fly.</p>\n\n<p>But now, with that information, why does <code>sum2</code> compile? It seems like <code>AddAssign&lt;&amp;i32&gt;</code> is indeed implemented (Which I tested separately), so it's possible that it's using that <code>AddAssign</code> method on a <code>&amp;i32</code>, but then again it's also possible that <code>e</code> is simply <code>i32</code>. My question boils down to:</p>\n\n<p><em>Is <code>e</code> an <code>i32</code>, or an <code>&amp;i32</code>?</em></p>\n\n<p>I don't know enough about references to easily check the difference myself (By using something other than <code>i32</code> and checking for crashes). <code>&amp;i32</code> is the most logical but I would like to know for sure.</p>\n\n<p>Coming from C, mixing between pointers and values is extremely confusing, and it has already taken me quite a bit to get used to with functions automatically dereferencing/referencing their arguments (which I don't think I've really done yet).</p>\n\n<p>EDIT:</p>\n\n<p>The type could be verified (And answer my question) with <a href=\"https://stackoverflow.com/questions/21747136/how-do-i-print-the-type-of-a-variable-in-rust\">How do I print the type of a variable in Rust?</a>, which is useful to mess around with but doesn't directly answer how for loops work. <a href=\"https://stackoverflow.com/questions/27224927/what-is-the-exact-definition-of-the-for-loop-in-rust\">What is the exact definition of the for loop in Rust?</a> helps a lot, and <a href=\"https://stackoverflow.com/questions/34733811/what-is-the-difference-between-iter-and-into-iter\">What is the difference between iter and into_iter?</a> talks about a related <code>IntoIterator</code> trait that can cause for loop confusion.</p>\n"}, {"tags": ["rust", "rhel", "rust-cargo", "libclang", "rocksdb"], "owner": {"reputation": 31, "user_id": 10592780, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5O7t2CQEbV4/AAAAAAAAAAI/AAAAAAAAATU/nxs2Luvybe4/photo.jpg?sz=128", "display_name": "Latifat Braimah", "link": "https://stackoverflow.com/users/10592780/latifat-braimah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 989, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1541618482, "creation_date": 1541099364, "last_edit_date": 1541618482, "question_id": 53107842, "link": "https://stackoverflow.com/questions/53107842/how-do-i-resolve-a-failure-to-compile-librocksdb-sys-error-on-rhel-7", "title": "How do I resolve a failure to compile librocksdb-sys error on RHEL 7?", "body": "<p>I have been trying to <a href=\"https://community.canvaslms.com/docs/DOC-11943-how-to-use-the-canvas-data-cli-tool#jive_content_id_2Navigate_to_localtoml\" rel=\"nofollow noreferrer\">build the Canvas Data Loader</a>. I've gone as far as step 10 and it's been pretty easy for me to resolve dependencies on a <code>cargo build fail</code>, but I've been stuck trying to resolve the librocksdb-sys v5.14.2 dependency for the past 4 days:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[root@localhost home]# gcc -v\n\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/4.8.5/lto-wrapper\nTarget: x86_64-redhat-linux\nConfigured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --disable-libgcj --with-isl=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.5-20150702/obj-x86_64-redhat-linux/cloog-install --enable-gnu-indirect-function --with-tune=generic --with-arch_32=x86-64 --build=x86_64-redhat-linux\nThread model: posix\ngcc version 4.8.5 20150623 (Red Hat 4.8.5-28) (GCC)\n\n[root@localhost home]# rustc -V\n\nrustc 1.30.0 (da5f414c2 2018-10-24)\n\n[root@localhost home]# rustup -V\n\nrustup 1.14.0 (1e51b07cc 2018-10-04)\n\n[root@localhost home]# rustup show\n\nDefault host: x86_64-unknown-linux-gnu\n\nstable-x86_64-unknown-linux-gnu (default)\nrustc 1.30.0 (da5f414c2 2018-10-24)\n\n[root@localhost home]# cargo build --release\n\n   Compiling gcc v0.3.55                                                                                                         \n   Compiling bit-vec v0.4.4                                                                                                      \n   Compiling rustc-demangle v0.1.9                                                                                               \n   Compiling percent-encoding v1.0.1                                                                                             \n   Compiling linked-hash-map v0.5.1                                                                                              \n   Compiling language-tags v0.2.2                                                                                                \n   Compiling smallvec v0.4.5                                                                                                     \n   Compiling uuid v0.5.1                                                                                                         \n   Compiling sha1 v0.2.0                                                                                                         \n   Compiling bufstream v0.1.4                                                                                                    \n   Compiling fnv v1.0.6                                                                                                          \n   Compiling untrusted v0.5.1                                                                                                    \n   Compiling crossbeam-utils v0.2.2                                                                                              \n   Compiling log v0.4.5                                                                                                          \n   Compiling arrayvec v0.4.7                                                                                                     \n   Compiling num_cpus v1.8.0                                                                                                     \n   Compiling iovec v0.1.2                                                                                                        \n   Compiling net2 v0.2.33                                                                                                        \n   Compiling memchr v1.0.2                                                                                                       \n   Compiling atty v0.2.11                                                                                                        \n   Compiling rand v0.4.3                                                                                                         \n   Compiling which v1.0.5                                                                                                        \n   Compiling time v0.1.40                                                                                                        \n   Compiling socket2 v0.3.8                                                                                                      \n   Compiling lazy_static v1.1.0                                                                                                  \n   Compiling memchr v2.1.0                                                                                                       \n   Compiling unicase v2.2.0                                                                                                      \n   Compiling semver v0.9.0                                                                                                       \n   Compiling unreachable v1.0.0                                                                                                  \n   Compiling owning_ref v0.3.3                                                                                                   \n   Compiling rand_core v0.2.2                                                                                                    \n   Compiling regex-syntax v0.6.2                                                                                                 \n   Compiling regex-syntax v0.5.6                                                                                                 \n   Compiling proc-macro2 v0.3.5                                                                                                  \n   Compiling clang-sys v0.23.0                                                                                                   \n   Compiling textwrap v0.10.0                                                                                                    \n   Compiling humantime v1.1.1                                                                                                    \n   Compiling tokio-executor v0.1.5                                                                                               \n   Compiling tokio-service v0.1.0                                                                                                \n   Compiling relay v0.1.1                                                                                                        \n   Compiling block-buffer v0.3.3                                                                                                 \n   Compiling unicode-bidi v0.3.4                                                                                                 \n   Compiling phf_shared v0.7.23                                                                                                  \n   Compiling foreign-types v0.3.2                                                                                                \n   Compiling base64 v0.6.0                                                                                                       \n   Compiling base64 v0.7.0                                                                                                       \n   Compiling nix v0.9.0                                                                                                          \n   Compiling base64 v0.9.3                                                                                                       \n   Compiling scheduled-thread-pool v0.1.0                                                                                        \n   Compiling serde_test v0.8.23                                                                                                  \n   Compiling yaml-rust v0.4.2                                                                                                    \n   Compiling log v0.3.9                                                                                                          \n   Compiling want v0.0.4                                                                                                         \n   Compiling bytes v0.4.10                                                                                                       \n   Compiling futures-cpupool v0.1.8                                                                                              \n   Compiling nom v3.2.1                                                                                                          \n   Compiling mio v0.6.16                                                                                                         \n   Compiling rand v0.3.22                                                                                                        \n   Compiling smallvec v0.6.5                                                                                                     \n   Compiling rand v0.5.5                                                                                                         \n   Compiling lock_api v0.1.4                                                                                                     \n   Compiling rustc_version v0.2.3                                                                                                \n   Compiling quote v0.5.2                                                                                                        \n   Compiling clap v2.32.0                                                                                                        \n   Compiling tokio-current-thread v0.1.3                                                                                         \n   Compiling tokio-timer v0.2.7                                                                                                  \n   Compiling phf v0.7.23                                                                                                         \n   Compiling stringprep v0.1.2                                                                                                   \n   Compiling idna v0.1.5                                                                                                         \n   Compiling linked-hash-map v0.3.0                                                                                              \n   Compiling r2d2 v0.7.4                                                                                                         \n   Compiling tokio-io v0.1.10                                                                                                    \n   Compiling generic-array v0.9.0                                                                                                \n   Compiling mio-uds v0.6.7                                                                                                      \n   Compiling parking_lot_core v0.3.1                                                                                             \n   Compiling cexpr v0.2.3                                                                                                        \n   Compiling twox-hash v1.1.1                                                                                                    \n   Compiling atoi v0.2.3                                                                                                         \n   Compiling num-traits v0.1.43                                                                                                  \n   Compiling serde_json v1.0.32                                                                                                  \n   Compiling toml v0.4.8                                                                                                         \n   Compiling quote v0.6.8                                                                                                        \n   Compiling tokio-codec v0.1.1                                                                                                  \n   Compiling crossbeam-epoch v0.3.1                                                                                              \n   Compiling crossbeam-epoch v0.5.2                                                                                              \n   Compiling thread_local v0.3.6                                                                                                 \n   Compiling url v1.7.1                                                                                                          \n   Compiling digest v0.7.6                                                                                                       \n   Compiling crypto-mac v0.5.2                                                                                                   \n   Compiling aho-corasick v0.6.8                                                                                                 \n   Compiling mime v0.3.12                                                                                                        \n   Compiling chrono v0.4.6                                                                                                       \n   Compiling crossbeam-deque v0.2.0                                                                                              \n   Compiling syn v0.15.13                                                                                                        \n   Compiling crossbeam-deque v0.6.1                                                                                              \n   Compiling sha2 v0.7.1                                                                                                         \n   Compiling hmac v0.5.0                                                                                                         \n   Compiling tokio-threadpool v0.1.8                                                                                             \n   Compiling postgres-protocol v0.3.2                                                                                            \n   Compiling parking_lot v0.6.4                                                                                                  \n   Compiling rayon v0.8.2                                                                                                        \n   Compiling mysql_common v0.5.0                                                                                                 \n   Compiling serde_derive v1.0.80                                                                                                \n   Compiling env_logger v0.5.13                                                                                                  \n   Compiling serde-hjson v0.8.2                                                                                                  \n   Compiling tokio-reactor v0.1.6                                                                                                \n   Compiling tokio-fs v0.1.4                                                                                                     \n   Compiling postgres-shared v0.4.2                                                                                              \n   Compiling ring v0.12.1                                                                                                        \n   Compiling cc v1.0.25                                                                                                          \n   Compiling tokio-tcp v0.1.2                                                                                                    \n   Compiling tokio-udp v0.1.2                                                                                                    \n   Compiling tokio-uds v0.2.3                                                                                                    \n   Compiling config v0.8.0                                                                                                       \n   Compiling postgres v0.15.2                                                                                                    \n   Compiling libloading v0.5.0                                                                                                   \n   Compiling openssl-sys v0.9.39                                                                                                 \n   Compiling backtrace-sys v0.1.24                                                                                               \n   Compiling libz-sys v1.0.25                                                                                                    \n   Compiling tokio v0.1.11                                                                                                       \n   Compiling r2d2_postgres v0.13.0                                                                                               \n   Compiling tokio-core v0.1.17                                                                                                  \n   Compiling flate2 v0.2.20                                                                                                      \n   Compiling backtrace v0.3.9                                                                                                    \n   Compiling tokio-proto v0.1.1                                                                                                  \n   Compiling error-chain v0.11.0                                                                                                 \n   Compiling hyper v0.11.27                                                                                                      \n   Compiling native-tls v0.1.5                                                                                                   \n   Compiling mysql v12.3.1                                                                                                       \n   Compiling tokio-tls v0.1.4                                                                                                    \n   Compiling hyper-tls v0.1.4                                                                                                    \n   Compiling librocksdb-sys v5.14.2                                                                                              \nerror: failed to run custom build command for `librocksdb-sys v5.14.2`                                                           \nprocess didn't exit successfully: `/user1/home/target/release/build/librocksdb-sys-56635e7b678cd86e/build-script-build` (exit code: 101)\n--- stdout\ncargo:rerun-if-changed=build.rs\ncargo:rerun-if-changed=rocksdb/\ncargo:rerun-if-changed=snappy/\n\n--- stderr\nthread 'main' panicked at 'Unable to find libclang: \"couldn\\'t find any of [\\'libclang.so\\', \\'libclang.so.*\\', \\'libclang-*.so\\'], set the LIBCLANG_PATH environment variable to a path where one of these files can be found (skipped: [])\"', libcore/result.rs:1009:5\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\n</code></pre>\n\n<p>I followed <a href=\"https://developers.redhat.com/blog/2018/07/07/yum-install-gcc7-clang/\" rel=\"nofollow noreferrer\">these instructions</a> to install clang, then <a href=\"https://stackoverflow.com/questions/25840088/how-to-build-libcxx-and-libcxxabi-by-clang-on-centos-7\">these instructions</a> to build the libcxx by clang.</p>\n\n<p>When trying to build again, I ended up with this error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Compiling librocksdb-sys v5.14.2                                                                                              \nerror: failed to run custom build command for `librocksdb-sys v5.14.2`                                                           \nprocess didn't exit successfully: `/user1/home/target/release/build/librocksdb-sys-56635e7b678cd86e/build-script-build` (exit code: 101)\n--- stdout\ncargo:rerun-if-changed=build.rs\ncargo:rerun-if-changed=rocksdb/\ncargo:rerun-if-changed=snappy/\nTARGET = Some(\"x86_64-unknown-linux-gnu\")\nOPT_LEVEL = Some(\"3\")\nHOST = Some(\"x86_64-unknown-linux-gnu\")\nCXX_x86_64-unknown-linux-gnu = None\nCXX_x86_64_unknown_linux_gnu = None\nHOST_CXX = None\nCXX = None\nCXXFLAGS_x86_64-unknown-linux-gnu = None\nCXXFLAGS_x86_64_unknown_linux_gnu = None\nHOST_CXXFLAGS = None\nCXXFLAGS = None\nDEBUG = Some(\"false\")\nrunning: \"c++\" \"-O3\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-m64\" \"-I\" \"rocksdb/include/\" \"-I\" \"rocksdb/\" \"-I\" \"rocksdb/third-party/gtest-1.7.0/fused-src/\" \"-I\" \"snappy/\" \"-I\" \".\" \"-Wall\" \"-Wextra\" \"-std=c++11\" \"-Wno-unused-parameter\" \"-DNDEBUG=1\" \"-DSNAPPY=1\" \"-DOS_LINUX=1\" \"-DROCKSDB_PLATFORM_POSIX=1\" \"-DROCKSDB_LIB_IO_POSIX=1\" \"-o\" \"/user1/home/target/release/build/librocksdb-sys-fe80efb4608df839/out/rocksdb/utilities/blob_db/blob_log_format.o\" \"-c\" \"rocksdb/utilities/blob_db/blob_log_format.cc\"\nrunning: \"c++\" \"-O3\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-m64\" \"-I\" \"rocksdb/include/\" \"-I\" \"rocksdb/\" \"-I\" \"rocksdb/third-party/gtest-1.7.0/fused-src/\" \"-I\" \"snappy/\" \"-I\" \".\" \"-Wall\" \"-Wextra\" \"-std=c++11\" \"-Wno-unused-parameter\" \"-DNDEBUG=1\" \"-DSNAPPY=1\" \"-DOS_LINUX=1\" \"-DROCKSDB_PLATFORM_POSIX=1\" \"-DROCKSDB_LIB_IO_POSIX=1\" \"-o\" \"/user1/home/target/release/build/librocksdb-sys-fe80efb4608df839/out/rocksdb/table/full_filter_block.o\" \"-c\" \"rocksdb/table/full_filter_block.cc\"\nrunning: \"c++\" \"-O3\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-m64\" \"-I\" \"rocksdb/include/\" \"-I\" \"rocksdb/\" \"-I\" \"rocksdb/third-party/gtest-1.7.0/fused-src/\" \"-I\" \"snappy/\" \"-I\" \".\" \"-Wall\" \"-Wextra\" \"-std=c++11\" \"-Wno-unused-parameter\" \"-DNDEBUG=1\" \"-DSNAPPY=1\" \"-DOS_LINUX=1\" \"-DROCKSDB_PLATFORM_POSIX=1\" \"-DROCKSDB_LIB_IO_POSIX=1\" \"-o\" \"/user1/home/target/release/build/librocksdb-sys-fe80efb4608df839/out/rocksdb/utilities/merge_operators/bytesxor.o\" \"-c\" \"rocksdb/utilities/merge_operators/bytesxor.cc\"\nrunning: \"c++\" \"-O3\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-m64\" \"-I\" \"rocksdb/include/\" \"-I\" \"rocksdb/\" \"-I\" \"rocksdb/third-party/gtest-1.7.0/fused-src/\" \"-I\" \"snappy/\" \"-I\" \".\" \"-Wall\" \"-Wextra\" \"-std=c++11\" \"-Wno-unused-parameter\" \"-DNDEBUG=1\" \"-DSNAPPY=1\" \"-DOS_LINUX=1\" \"-DROCKSDB_PLATFORM_POSIX=1\" \"-DROCKSDB_LIB_IO_POSIX=1\" \"-o\" \"/user1/home/target/release/build/librocksdb-sys-fe80efb4608df839/out/rocksdb/cache/clock_cache.o\" \"-c\" \"rocksdb/cache/clock_cache.cc\"\n\n--- stderr\nrocksdb/include/rocksdb/c.h:48:9: warning: #pragma once in main file, err: false\nthread 'main' panicked at '\n\nInternal error occurred: Failed to find tool. Is `c++` installed?\n\n', /root/.cargo/registry/src/github.com-1ecc6299db9ec823/cc-1.0.25/src/lib.rs:2260:5\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\n</code></pre>\n\n<p><code>c++</code> is installed at <code>/usr/include/c++</code></p>\n"}, {"tags": ["rust", "rust-tokio"], "comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 1, "creation_date": 1541076284, "post_id": 53096689, "comment_id": 93098443, "body": "Imagine that you have two tasks to run: a generic computation, and this &quot;notification&quot; after some time. How would you attempt to have the both of them running n the same thread?"}], "answers": [{"tags": [], "owner": {"reputation": 2072, "user_id": 1668605, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/bd9de0fc8125136b8d807fa14ea8bd1d?s=128&d=identicon&r=PG&f=1", "display_name": "Lesto", "link": "https://stackoverflow.com/users/1668605/lesto"}, "is_accepted": false, "score": 0, "last_activity_date": 1541080932, "creation_date": 1541080932, "answer_id": 53102875, "question_id": 53096689, "link": "https://stackoverflow.com/questions/53096689/improve-rusts-future-to-do-not-create-separate-thread/53102875#53102875", "title": "Improve Rust&#39;s Future to do not create separate thread", "body": "<p>I think I understand what you mean.\nLets say you have two task, the Main and the Worker1, in this case you are polling the worker1 to wait for an answer; BUT there is a better way, and this is to wait for competition of the Worker1; and this can be done without having any Future, you simply call from Main the Worker1 function, when the worker is over the Main will go on. You need no future, you are simply calling a function, and the division Main and Worker1 is just an over-complication.</p>\n\n<p>Now, I think your question became relevant in the moment you add at least another worker, last add Worker2, and you want the Main to resume the computation as soon as one of the two task complete; and you don't want those task to be executed in another thread/process, maybe because you are using asynchronous call (which simply mean the threading is done somewhere else, or you are low level enough that you receive Hardware Interrupt).</p>\n\n<p>Since your Worker1 and Worker2 have to share the same thread, you need a way to save the current execution Main, create the one for one of the worker, and after a certain amount of work, time or other even (Scheduler), switch to the other worker, and so on. This is a Multi-Tasking system, and there are various software implementation for it in Rust; but with HW support you could do things that in software only you could not do (like have the hardware prevent one Task to access the resource from the other), plus you can have the CPU take care of the task switching and all... Well, this is what Thread and Process are.</p>\n\n<p>Future are not what you are looking for, they are higher level and you can find some software scheduler that support them.</p>\n"}], "owner": {"reputation": 150, "user_id": 6353685, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2f6372f5cee0edce2e8db4a10b870cf?s=128&d=identicon&r=PG&f=1", "display_name": "Dmitrii Goriunov", "link": "https://stackoverflow.com/users/6353685/dmitrii-goriunov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1109, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1541080932, "creation_date": 1541056520, "last_edit_date": 1541057625, "question_id": 53096689, "link": "https://stackoverflow.com/questions/53096689/improve-rusts-future-to-do-not-create-separate-thread", "title": "Improve Rust&#39;s Future to do not create separate thread", "body": "<p>I have written a simple future based on this <a href=\"https://dev.to/mindflavor/rust-futures-an-uneducated-short-and-hopefully-not-boring-tutorial---part-4---a-real-future-from-scratch-734\" rel=\"nofollow noreferrer\">tutorial</a> which looks like this: </p>\n\n<pre><code>extern crate chrono; // 0.4.6\nextern crate futures; // 0.1.25\n\nuse std::{io, thread};\nuse chrono::{DateTime, Duration, Utc};\nuse futures::{Async, Future, Poll, task};\n\npub struct WaitInAnotherThread {\n    end_time: DateTime&lt;Utc&gt;,\n    running: bool,\n}\n\nimpl WaitInAnotherThread {\n    pub fn new(how_long: Duration) -&gt; WaitInAnotherThread {\n        WaitInAnotherThread {\n            end_time: Utc::now() + how_long,\n            running: false,\n        }\n    }\n\n    pub fn run(&amp;mut self, task: task::Task) {\n        let lend = self.end_time;\n\n        thread::spawn(move || {\n            while Utc::now() &lt; lend {\n                let delta_sec = lend.timestamp() - Utc::now().timestamp();\n                if delta_sec &gt; 0 {\n                    thread::sleep(::std::time::Duration::from_secs(delta_sec as u64));\n                }\n                task.notify();\n            }\n            println!(\"the time has come == {:?}!\", lend);\n        });\n    }\n}\n\nimpl Future for WaitInAnotherThread {\n    type Item = ();\n    type Error = Box&lt;io::Error&gt;;\n\n    fn poll(&amp;mut self) -&gt; Poll&lt;Self::Item, Self::Error&gt; {\n        if Utc::now() &lt; self.end_time {\n            println!(\"not ready yet! parking the task.\");\n\n            if !self.running {\n                println!(\"side thread not running! starting now!\");\n                self.run(task::current());\n                self.running = true;\n            }\n\n            Ok(Async::NotReady)\n        } else {\n            println!(\"ready! the task will complete.\");\n            Ok(Async::Ready(()))\n        }\n    }\n}\n</code></pre>\n\n<p>So the question is how do I replace <code>pub fn run(&amp;mut self, task: task::Task)</code> with something that will not create a new thread for the future to resolve. It be useful if someone could rewrite my code with replaced <code>run</code> function without separate thread it will help me to understand how things should be. Also I know that <code>tokio</code> has an timeout implementation but I need this code for learning.</p>\n"}, {"tags": ["c++", "c", "for-loop", "while-loop", "rust"], "comments": [{"owner": {"reputation": 1233, "user_id": 5366130, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ce3d4bd07d1115070e7727de382560ba?s=128&d=identicon&r=PG&f=1", "display_name": "Omid CompSCI", "link": "https://stackoverflow.com/users/5366130/omid-compsci"}, "edited": false, "score": 0, "creation_date": 1541042667, "post_id": 53094817, "comment_id": 93086129, "body": "What do you mean &quot;stop being unusable&quot; ...?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541042799, "post_id": 53094817, "comment_id": 93086155, "body": "What you say don&#39;t make any sense"}, {"owner": {"reputation": 107, "user_id": 8328954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cce310968f5d62c38c8f845423bde059?s=128&d=identicon&r=PG&f=1", "display_name": "Chi Wei Shen", "link": "https://stackoverflow.com/users/8328954/chi-wei-shen"}, "edited": false, "score": 0, "creation_date": 1541042905, "post_id": 53094817, "comment_id": 93086169, "body": "sorry,my description is wrong, it should be loop can&#39;t display the contents of printf."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1541043714, "post_id": 53094817, "comment_id": 93086333, "body": "Also I think you should include your rust code. Read <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 148, "user_id": 7263440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b16f456d714f65cb780cee9a87dc0f8?s=128&d=identicon&r=PG&f=1", "display_name": "Dan N", "link": "https://stackoverflow.com/users/7263440/dan-n"}, "edited": false, "score": 3, "creation_date": 1541047534, "post_id": 53094817, "comment_id": 93086962, "body": "Just a wild guess because there&#39;s no verifiable example. Besides the parameter and return type, the biggest difference is that the C version does not flush stdout. The C++ version uses <code>std::endl</code>, which has an implicit flush to stdout (that is the reason the use of <code>std::endl</code> is discouraged). Forcing a similar flush in the C version with a <code>fflush(stdout)</code> might be the cause."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541062136, "post_id": 53094817, "comment_id": 93091587, "body": "That definitely because you write on a fully buffered stdout. Also, your call of <code>print_it()</code> is invalid and exposed to undefined behavior."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "edited": false, "score": 0, "creation_date": 1541084000, "post_id": 53094817, "comment_id": 93102760, "body": "This problem has nothing to do with Rust. Please divide-and-conquer more in the future."}], "answers": [{"tags": [], "owner": {"reputation": 148, "user_id": 7263440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b16f456d714f65cb780cee9a87dc0f8?s=128&d=identicon&r=PG&f=1", "display_name": "Dan N", "link": "https://stackoverflow.com/users/7263440/dan-n"}, "is_accepted": false, "score": 2, "last_activity_date": 1541107137, "last_edit_date": 1541107137, "creation_date": 1541082624, "answer_id": 53103358, "question_id": 53094817, "link": "https://stackoverflow.com/questions/53094817/why-does-rust-code-using-printf-in-a-loop-from-c-not-display-output-but-using-s/53103358#53103358", "title": "Why does Rust code using printf in a loop from C not display output, but using std::cout in a loop from C++ does?", "body": "<p>I tried your C version and it worked for me in macOS. As you did not tell us your operating system, it's hard to know if it's something platform specific. Try adding a <code>fflush(stdout)</code> after your <code>printf</code>.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n\nvoid print_c() {\n  int s = 3;\n  while (1) {\n    printf(\"%d\\n\", s);\n    fflush(stdout); // This makes sure stdout is not being buffered.\n    sleep(1);\n  }\n}\n</code></pre>\n\n<hr>\n\n<p>As for your C++ version, it has its own problems in the Rust code.</p>\n\n<p>Since your C++ version returns an int, and takes an int as a parameter. You need to define your extern definition to show that. Since you actually take an <code>int32_t</code>, I used the <code>i32</code> for the type. But you return an <code>int</code> <em>(note: you don't actually return anything in your code).</em>, and because the size of an <code>int</code> can be different on different platform, it's best to use the <code>libc::c_int</code></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate libc;\nuse libc::c_int;\n\n#[link(name = \"cppthread\")]\nextern {\n    fn print_c(num: i32) -&gt; c_int;\n}\n\nfn main() {\n    unsafe { print_c(10) };\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "is_accepted": true, "score": 3, "last_activity_date": 1541107170, "last_edit_date": 1541107170, "creation_date": 1541083881, "answer_id": 53103726, "question_id": 53094817, "link": "https://stackoverflow.com/questions/53094817/why-does-rust-code-using-printf-in-a-loop-from-c-not-display-output-but-using-s/53103726#53103726", "title": "Why does Rust code using printf in a loop from C not display output, but using std::cout in a loop from C++ does?", "body": "<p><strong>Your C and C++ versions are not equivalent.</strong></p>\n\n<p>Your C version just prints a number and a newline. It does no explicit flushing (which is then left up to various layers of the I/O stack to decide when to do &mdash; almost certainly, given your <code>sleep(1)</code>, this will take some time!).</p>\n\n<p>Your C++ version prints a number, then (via <code>endl</code>) both prints a newline and flushes. That's why you always see the result straight away.</p>\n\n<p><strong><code>os &lt;&lt; endl</code> is <code>os &lt;&lt; '\\n' &lt;&lt; flush</code>.</strong></p>\n\n<p>Making your C version do this as well is easy, using <a href=\"https://en.cppreference.com/w/c/io/fflush\" rel=\"nofollow noreferrer\"><code>fflush</code></a>:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n\nvoid print_c() {\n  int s = 3;\n  while (1) {\n    printf(\"%d\\n\", s);\n    fflush(STDOUT);\n    sleep(1);\n  }\n}\n</code></pre>\n\n<p>This problem has nothing to do with Rust.</p>\n"}], "owner": {"reputation": 107, "user_id": 8328954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cce310968f5d62c38c8f845423bde059?s=128&d=identicon&r=PG&f=1", "display_name": "Chi Wei Shen", "link": "https://stackoverflow.com/users/8328954/chi-wei-shen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 622, "favorite_count": 0, "accepted_answer_id": 53103726, "answer_count": 2, "score": 0, "last_activity_date": 1541107170, "creation_date": 1541042595, "last_edit_date": 1541107059, "question_id": 53094817, "link": "https://stackoverflow.com/questions/53094817/why-does-rust-code-using-printf-in-a-loop-from-c-not-display-output-but-using-s", "title": "Why does Rust code using printf in a loop from C not display output, but using std::cout in a loop from C++ does?", "body": "<p>I use Rust to call a C function with a loop (<code>for</code> or <code>while</code>), which uses <code>printf</code> function to display something, but the C function doesn't display any output from <code>printf</code>.</p>\n\n<p>C code:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n\nvoid print_c() {\n  int s = 3;\n  while (1) {\n    printf(\"%d\\n\", s);\n    sleep(1);\n  }\n}\n</code></pre>\n\n<p>However, when using C++, output is successfully generated.</p>\n\n<p>C++ code:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;iostream&gt;\n#include &lt;stdint.h&gt;\n#include &lt;unistd.h&gt;\n\nextern \"C\" {\n  int print_it(int32_t num) {\n    while (1) {\n        std::cout &lt;&lt; num &lt;&lt; std::endl;\n        sleep(1);\n    }\n  }\n}\n</code></pre>\n\n<p>C is packaged as a shared library named \"cthread\". C++ is named \"cppthread\".</p>\n\n<p>This is the Rust calling the C library:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[link(name = \"cthread\")]\nextern \"C\" {\n    fn print_c();\n}\n\nfn main() {\n    unsafe { print_c() };\n}\n</code></pre>\n\n<p>And the Rust calling the C++ library:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[link(name = \"cppthread\")]\nextern \"C\" {\n    fn print_it();\n}\n\nfn main() {\n    unsafe { print_it() };\n}\n</code></pre>\n"}, {"tags": ["generics", "rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541037657, "post_id": 53094222, "comment_id": 93085175, "body": "What you want if I guess right, is a trait, but your question is very unclear, there is no link between <code>struct A</code> and <code>struct MyArray&lt;A, C&gt;</code> curently. Also A is not a suitable name for a struct."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541038441, "post_id": 53094222, "comment_id": 93085343, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/28219730/155423\">Is it possible to access struct fields from within a trait?</a>. If you disagree, please <a href=\"https://stackoverflow.com/posts/53094222/edit\">edit</a> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1541038455, "post_id": 53094222, "comment_id": 93085347, "body": "TL;DR the duplicate: no, you cannot access a field in a generic structure."}, {"owner": {"reputation": 75, "user_id": 6159781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/061f05b9868774cb3e73e1e6db0aa734?s=128&d=identicon&r=PG&f=1", "display_name": "NutellaFan", "link": "https://stackoverflow.com/users/6159781/nutellafan"}, "edited": false, "score": 0, "creation_date": 1541042678, "post_id": 53094222, "comment_id": 93086134, "body": "Okay, edited the question.  It&#39;s a little different that the trait case, since I need to instantiate a type."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1541043061, "post_id": 53094222, "comment_id": 93086195, "body": "Still don&#39;t make any sense, please read <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>. Also, <a href=\"https://codeblog.jonskeet.uk/2010/08/29/writing-the-perfect-question/\" rel=\"nofollow noreferrer\">Writing the perfect question</a>"}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1541079712, "post_id": 53094222, "comment_id": 93100486, "body": "@Shepmaster: My understanding is that the OP is looking for something akin to <i>pointer-to-member</i> in C++. That, in C++ you can instantiate a template <code>MyArray&lt;Struct, &amp;Struct::field_name&gt;</code>."}], "answers": [{"tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 2, "last_activity_date": 1541106126, "last_edit_date": 1541106126, "creation_date": 1541055929, "answer_id": 53096578, "question_id": 53094222, "link": "https://stackoverflow.com/questions/53094222/accessing-a-field-in-generic-structure/53096578#53096578", "title": "Accessing a field in generic structure", "body": "<p>You can store a getter function for the field you want to access alongside your container, e.g.</p>\n\n<pre><code>pub struct MyVec&lt;A, G&gt; {\n    data: Vec&lt;A&gt;,\n    getter: G,\n}\n\nimpl&lt;A, G, T&gt; MyVec&lt;A, G&gt;\nwhere\n    G: Fn(&amp;A) -&gt; T,\n{\n    pub fn get_value(&amp;self, i: usize) -&gt; T {\n        (self.getter)(&amp;self.data[i])\n    }\n}\n\nstruct Wobble {\n    gloink: u64,\n}\n\nimpl Wobble {\n    fn gloink(&amp;self) -&gt; u64 {\n        self.gloink\n    }\n}\n\nfn main() {\n    let v = MyVec {\n        data: vec![Wobble { gloink: 42 }],\n        getter: Wobble::gloink,\n    };\n    println!(\"{}\", v.get_value(0));\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=272b99c182ce7015d70d0e5242f0b9d6\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 75, "user_id": 6159781, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/061f05b9868774cb3e73e1e6db0aa734?s=128&d=identicon&r=PG&f=1", "display_name": "NutellaFan", "link": "https://stackoverflow.com/users/6159781/nutellafan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 361, "favorite_count": 0, "accepted_answer_id": 53096578, "answer_count": 1, "score": 0, "last_activity_date": 1541106126, "creation_date": 1541037365, "last_edit_date": 1541044736, "question_id": 53094222, "link": "https://stackoverflow.com/questions/53094222/accessing-a-field-in-generic-structure", "title": "Accessing a field in generic structure", "body": "<p>Given this struct: </p>\n\n<pre><code>pub struct A {\n    pub C: B,\n}\n</code></pre>\n\n<p>I'm looking create Rust container with elements of <code>A</code>, and access <code>A.C</code> in that generic Rust container.  Here is such a container:</p>\n\n<pre><code>pub struct MyArray&lt;A, C&gt; {\n    data: Vec&lt;A&gt;,\n    size: usize,\n}\n\nimpl&lt;A, C&gt; MyArray {\n    // Access the value in the ith element of data\n    pub fn get_value(self, i: u64) -&gt; u64 {\n        self.data[i].C\n    }\n}\n</code></pre>\n\n<p>Given the following struct:</p>\n\n<pre><code>pub struct House {\n    pub num_rooms: u64, \n} \n</code></pre>\n\n<p>I want to instantiate a generic types like this: </p>\n\n<p><code>let h: MyArray&lt;House, num_rooms&gt; = MyArray(6);</code></p>\n\n<p><code>let d: MyArray&lt;Cat, num_lives&gt; = MyArray(10);</code></p>\n\n<p>Then I want do be able to call <code>h.func(5)</code> to get the value of specified field in the 6th element of the Rust container.</p>\n\n<p>I'm not sure if this is possible at all.  If it is, macros / generics are probably needed.</p>\n"}]