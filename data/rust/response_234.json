[{"tags": ["rust", "cross-compiling", "endianness"], "comments": [{"owner": {"reputation": 392, "user_id": 4175326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4063dc584aafb9bb0bd60d7213becc23?s=128&d=identicon&r=PG&f=1", "display_name": "Dariusz Ostolski", "link": "https://stackoverflow.com/users/4175326/dariusz-ostolski"}, "edited": false, "score": 0, "creation_date": 1600853530, "post_id": 56876779, "comment_id": 113216675, "body": "Hi, I&#39;ve added a template project to compile rust binaries on this specific processor, please take a look <a href=\"https://github.com/DariuszOstolski/rust_ppc_e5500_template\" rel=\"nofollow noreferrer\">github.com/DariuszOstolski/rust_ppc_e5500_template</a>"}], "owner": {"reputation": 113, "user_id": 3887892, "user_type": "registered", "profile_image": "https://graph.facebook.com/690296009/picture?type=large", "display_name": "Yannick Koehler", "link": "https://stackoverflow.com/users/3887892/yannick-koehler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 674, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1588589307, "creation_date": 1562181991, "last_edit_date": 1588589307, "question_id": 56876779, "link": "https://stackoverflow.com/questions/56876779/how-to-compile-rustc-for-a-32-bit-little-endian-powerpc-processor", "title": "How to compile rustc for a 32-bit little-endian PowerPC processor?", "body": "<p>I'm trying to compile rustc for the e5500 FreeScale process CPU, which is 32-bit and little-endian. I'm following the instructions from <a href=\"https://github.com/japaric/rust-cross\" rel=\"nofollow noreferrer\">rust-cross</a>. </p>\n\n<p>I've tried two avenues:</p>\n\n<h2><code>powerpc-unknown-linux-gnu</code> for 32 bits</h2>\n\n<p>I get an error as it can't figure out the endianess:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cargo:warning=In file included from ./compiler-rt/lib/builtins/int_types.h:21,\ncargo:warning=                 from ./compiler-rt/lib/builtins/int_lib.h:75,\ncargo:warning=                 from ./compiler-rt/lib/builtins/absvdi2.c:15:\ncargo:warning=./compiler-rt/lib/builtins/int_endianness.h:113:2: error: #error Unable to determine endian\nexit code: 1\n\n--- stderr\nthread 'main' panicked at '\n\nInternal error occurred: Command \"powerpc-linux-gnu-gcc\" \"-O2\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-fno-builtin\" \"-fvisibility=hidden\" \"-ffreestanding\" \"-fomit-frame-pointer\" \"-DVISIBILITY_HIDDEN\" \"-o\" \"/home/ykoehler/rust-build-powerpc-fsl-linux/build/x86_64-unknown-linux-gnu/stage2-std/powerpc-unknown-linux-gnu/release/build/compiler_builtins-05a438b00e7bb558/out/./compiler-rt/lib/builtins/absvdi2.o\" \"-c\" \"./compiler-rt/lib/builtins/absvdi2.c\" with args \"powerpc-linux-gnu-gcc\" did not execute successfully (status code exit code: 1).\n\n', /home/ykoehler/.cargo/registry/src/github.com-1ecc6299db9ec823/cc-1.0.28/src/lib.rs:2314:5\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\n\nwarning: build failed, waiting for other jobs to finish...\nerror: build failed\ncommand did not execute successfully: \"/home/ykoehler/rust-build-powerpc-fsl-linux/build/x86_64-unknown-linux-gnu/stage0/bin/cargo\" \"build\" \"--target\" \"powerpc-unknown-linux-gnu\" \"-j\" \"4\" \"--release\" \"--features\" \"panic-unwind backtrace\" \"--manifest-path\" \"/home/ykoehler/rust/src/libstd/Cargo.toml\" \"--message-format\" \"json\"\nexpected success, got: exit code: 101\nfailed to run: /home/ykoehler/rust-build-powerpc-fsl-linux/build/bootstrap/debug/bootstrap build\nBuild completed unsuccessfully in 0:00:39\nmake: *** [Makefile:18: all] Error 1\n</code></pre>\n\n<h2><code>powerpc64le-unknown-linux-gnu</code> for little-endian</h2>\n\n<p>I set <code>-m32</code> in config.toml inside cflags. I get an error as the compiler I have doesn't support <code>-m64</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>CC_powerpc64le-unknown-linux-gnu = Some(\"powerpc64le-linux-gnu-gcc\")\nCFLAGS_powerpc64le-unknown-linux-gnu = Some(\"-ffunction-sections -fdata-sections -fPIC -m64\")\nrunning: \"powerpc64le-linux-gnu-gcc\" \"-O2\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-m64\" \"-m64\" \"-fno-builtin\" \"-fvisibility=hidden\" \"-ffreestanding\" \"-DVISIBILITY_HIDDEN\" \"-o\" \"/home/ykoehler/rust-build-powerpc-fsl-linux/build/x86_64-unknown-linux-gnu/stage2-std/powerpc64le-unknown-linux-gnu/release/build/compiler_builtins-05a438b00e7bb558/out/./compiler-rt/lib/builtins/absvdi2.o\" \"-c\" \"./compiler-rt/lib/builtins/absvdi2.c\"\ncargo:warning=./compiler-rt/lib/builtins/absvdi2.c:1: error: -m64 not supported in this configuration\nexit code: 1\n\n--- stderr\nthread 'main' panicked at '\n\nInternal error occurred: Command \"powerpc64le-linux-gnu-gcc\" \"-O2\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-ffunction-sections\" \"-fdata-sections\" \"-fPIC\" \"-m64\" \"-m64\" \"-fno-builtin\" \"-fvisibility=hidden\" \"-ffreestanding\" \"-DVISIBILITY_HIDDEN\" \"-o\" \"/home/ykoehler/rust-build-powerpc-fsl-linux/build/x86_64-unknown-linux-gnu/stage2-std/powerpc64le-unknown-linux-gnu/release/build/compiler_builtins-05a438b00e7bb558/out/./compiler-rt/lib/builtins/absvdi2.o\" \"-c\" \"./compiler-rt/lib/builtins/absvdi2.c\" with args \"powerpc64le-linux-gnu-gcc\" did not execute successfully (status code exit code: 1).\n\n', /home/ykoehler/.cargo/registry/src/github.com-1ecc6299db9ec823/cc-1.0.28/src/lib.rs:2314:5\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\n</code></pre>\n"}, {"tags": ["algorithm", "rust"], "comments": [{"owner": {"reputation": 44162, "user_id": 752843, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/dfab97c10311207545414b6d7d9bde93?s=128&d=identicon&r=PG", "display_name": "Richard", "link": "https://stackoverflow.com/users/752843/richard"}, "edited": false, "score": 0, "creation_date": 1562173605, "post_id": 56874920, "comment_id": 100298486, "body": "Why do you need to generate them iteratively? It seems like using recursion and Rust&#39;s generators/coroutines would be an easy solution."}, {"owner": {"reputation": 11, "user_id": 11735638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc724d2f9935edf693142a9983448e3?s=128&d=identicon&r=PG&f=1", "display_name": "Plasma_000", "link": "https://stackoverflow.com/users/11735638/plasma-000"}, "reply_to_user": {"reputation": 44162, "user_id": 752843, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/dfab97c10311207545414b6d7d9bde93?s=128&d=identicon&r=PG", "display_name": "Richard", "link": "https://stackoverflow.com/users/752843/richard"}, "edited": false, "score": 0, "creation_date": 1562173905, "post_id": 56874920, "comment_id": 100298616, "body": "@Richard I&#39;m hoping for something that works on stable as i&#39;m not sure whether generators will remain the same until release. But if I cant find anything that does seem like a good idea."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 44162, "user_id": 752843, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/dfab97c10311207545414b6d7d9bde93?s=128&d=identicon&r=PG", "display_name": "Richard", "link": "https://stackoverflow.com/users/752843/richard"}, "edited": false, "score": 0, "creation_date": 1562175442, "post_id": 56874920, "comment_id": 100299302, "body": "@Richard <a href=\"https://stackoverflow.com/a/30279122/155423\">Lazy sequence generation in Rust</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11735638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc724d2f9935edf693142a9983448e3?s=128&d=identicon&r=PG&f=1", "display_name": "Plasma_000", "link": "https://stackoverflow.com/users/11735638/plasma-000"}, "edited": false, "score": 0, "creation_date": 1562293526, "post_id": 56894942, "comment_id": 100337662, "body": "Thank you - this works, but I was hoping for a solution that wasn&#39;t bruteforce (this kind of solution quickly explodes in complexity)"}, {"owner": {"reputation": 3527, "user_id": 6925185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba6bd7821971973c8143f31356c85df3?s=128&d=identicon&r=PG&f=1", "display_name": "jottbe", "link": "https://stackoverflow.com/users/6925185/jottbe"}, "reply_to_user": {"reputation": 11, "user_id": 11735638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc724d2f9935edf693142a9983448e3?s=128&d=identicon&r=PG&f=1", "display_name": "Plasma_000", "link": "https://stackoverflow.com/users/11735638/plasma-000"}, "edited": false, "score": 0, "creation_date": 1562316598, "post_id": 56894942, "comment_id": 100344605, "body": "@Plasma_000 ah sorry. So isn&#39;t that a challenge? go for it!"}], "tags": [], "owner": {"reputation": 3527, "user_id": 6925185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba6bd7821971973c8143f31356c85df3?s=128&d=identicon&r=PG&f=1", "display_name": "jottbe", "link": "https://stackoverflow.com/users/6925185/jottbe"}, "is_accepted": false, "score": 0, "last_activity_date": 1562339416, "last_edit_date": 1562339416, "creation_date": 1562281255, "answer_id": 56894942, "question_id": 56874920, "link": "https://stackoverflow.com/questions/56874920/how-can-i-generate-de-bruijn-sequences-iteratively/56894942#56894942", "title": "How can I generate de Bruijn sequences iteratively?", "body": "<p>I am not familiar with Rust, so I programmed and tested it in Python. Since the poster translated the version in the question from a Python program, I hope it will not be a big issue.</p>\n\n<pre class=\"lang-py prettyprint-override\"><code># the following function treats list a as\n# k-adic number with n digtis\n# and increments this number returning\n# the index of the leftmost digit changed\ndef increment_a7(a, k, n):\n    digit= n-1\n    a[digit]+= 1\n    while a[digit] &gt;= k and digit&gt; 0:\n        #a[digit]= 0\n        a[digit]= a[0]+1\n        a[digit-1]+= 1\n        digit-= 1\n    return digit\n\n# the following function adds a to the sequence\n# and takes into account, that the beginning of a\n# could overlap with the end of sequence\n# in that case, it just removes the overlapping digits\n# from a before adding the remaining digits to sequence\ndef append_to_sequence(sequence, a, n):\n    # here we can assume safely, that a\n    # does not overlap completely with sequence[-n:]\n    i= -1\n    for i in range(n-1, -1, -1):\n        found= True\n        # check if the last i digits in sequence\n        # overlap with the first i digits in a\n        for j in range(i):\n            if a[j] != sequence[-i+j]:\n                # no, they don't overlap\n                found= False\n                break\n        if found:\n            # yes they overlap, so no need to \n            # continue the check with a smaller i\n            break\n    # now we can just append everything from\n    # digit i (digit 0 - i-1 are swallowed)\n    sequence.extend(a[i:])    \n    return n-i\n\n# during the operation we have to keep track of\n# the k-adic numbers a, that already occured in\n# the sequence. We store them in a set called used\n# everytime we add something to the sequence\n# we have to update it and add one entry for each\n# digit inserted\ndef update_used(sequence, used, n, num_inserted):\n    l= len(sequence)\n    for i in range(num_inserted):\n        used.add(tuple(sequence[-n-i:l-i]))\n\n# the main work is done in the following function\n# it creates and returns the generated sequence\ndef gen4(k, n):\n    a= [0]*n\n    sequence= a[:]\n    used= set()\n    # create a fake sequence to add the segments obtained by the cyclic nature\n    fake= ([k-1] * (n-1))\n    for i in range(n-1):\n        fake.append(0)\n        update_used(fake, used, n, 1)\n    update_used(sequence, used, n, 1)\n    valid= True\n    while valid:\n        # a is still a valid k-adic number\n        # this means the generation process\n        # has not ended\n        # so construct a new number from the n-1\n        # last digits of sequence\n        # followed by a zero\n        a= sequence[-n+1:]\n        a.append(0)\n        while valid and tuple(a) in used:\n            # the constructed k-adict number a\n            # was already used, so increment it\n            # and try again\n            increment_a(a, k, n)\n            valid= a[0]&lt;k\n        if valid:\n            # great, the number is still valid\n            # and is not jet part of the sequence\n            # so add it after removing the overlapping\n            # digits and update the set with the segments\n            # we already used\n            num_inserted= append_to_sequence(sequence, a, n)\n            update_used(sequence, used, n, num_inserted)\n    return sequence\n</code></pre>\n\n<p>I tested the code above by generating some sequences with the original version of <code>gen</code> and this one using the same parameters. For all sets of parameters I tested, the result was the same in both versions.</p>\n\n<p>Please note that this code is less efficient than the original version, especially if the sequence gets long. I guess the costs of the set operations has a non-linear influence on the runtime.</p>\n\n<p>If you like, you can improve it further such as by using a more efficient way to store the used segments. Instead of operating on the k-adic representation (the a-list), you could use a multidimensional array instead.</p>\n"}, {"tags": [], "owner": {"reputation": 65718, "user_id": 844416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e39c2364935265593d76247ddc6d07c?s=128&d=identicon&r=PG", "display_name": "MBo", "link": "https://stackoverflow.com/users/844416/mbo"}, "is_accepted": false, "score": 0, "last_activity_date": 1562339319, "last_edit_date": 1562339319, "creation_date": 1562305065, "answer_id": 56897090, "question_id": 56874920, "link": "https://stackoverflow.com/questions/56874920/how-can-i-generate-de-bruijn-sequences-iteratively/56897090#56897090", "title": "How can I generate de Bruijn sequences iteratively?", "body": "<p>Consider this approach:</p>\n\n<ol>\n<li><p>Choose the first (lexicographically) representative from every necklace class</p>\n\n<p><a href=\"https://stackoverflow.com/questions/55015313/generating-all-unique-orders-of-looping-series-of-characters-all-circular-permu/55020067#55020067\">Here is Python code</a> for generation of representatives for (<strong>binary</strong>) necklaces containing d ones (it is possible to repeat for all d values). <a href=\"https://core.ac.uk/download/pdf/82247950.pdf\" rel=\"nofollow noreferrer\">Sawada article link</a></p></li>\n<li><p>Sort representatives in lexicographic order</p></li>\n<li><p>Make periodic reduction for every representative (if possible): if string is periodic <code>s = p^m</code> like <code>010101</code>, choose <code>01</code></p>\n\n<p>To find the period, it is possible to use <a href=\"https://stackoverflow.com/questions/8253491/periodic-binary-strings/8257829#8257829\">string doubling</a> or <a href=\"https://stackoverflow.com/questions/55823298/how-do-i-check-if-a-string-is-entirely-made-of-the-same-substring/55823710#55823710\">z-algorithm</a> (I expect it's faster for compiled languages)</p></li>\n<li><p>Concatenate reductions</p>\n\n<p>Example for n=3,k=2:<br>\nSorted representatives: <code>000, 001, 011, 111</code><br>\nReductions: <code>0, 001, 011, 1</code><br>\nResult: <code>00010111</code></p></li>\n</ol>\n\n<p>The same essential method (with C code) is described in J\u00f6rg Arndt's book <a href=\"https://www.jjj.de/fxt/fxtpage.html#fxtbook\" rel=\"nofollow noreferrer\">\"Matters Computational\"</a>, chapter 18</p>\n\n<p>A similar way is mentioned in the <a href=\"https://en.wikipedia.org/wiki/De_Bruijn_sequence#Construction\" rel=\"nofollow noreferrer\">wiki</a></p>\n\n<blockquote>\n  <p>An alternative construction involves concatenating together, in\n  lexicographic order, all the Lyndon words whose length divides n</p>\n</blockquote>\n\n<p>You might look for effective way to generate appropriate Lyndon words</p>\n"}], "owner": {"reputation": 11, "user_id": 11735638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc724d2f9935edf693142a9983448e3?s=128&d=identicon&r=PG&f=1", "display_name": "Plasma_000", "link": "https://stackoverflow.com/users/11735638/plasma-000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 504, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1562339416, "creation_date": 1562173143, "last_edit_date": 1562175219, "question_id": 56874920, "link": "https://stackoverflow.com/questions/56874920/how-can-i-generate-de-bruijn-sequences-iteratively", "title": "How can I generate de Bruijn sequences iteratively?", "body": "<p>I am looking for a way to generate a de Bruijn sequence iteratively instead of with recursion. My goal is to generate it character by character.</p>\n\n<p>I found <a href=\"https://git.sagemath.org/sage.git/tree/src/sage/combinat/debruijn_sequence.pyx\" rel=\"nofollow noreferrer\">some example code in Python</a> for generating de Bruijn sequences and translated it into Rust. I am not yet able to comprehend this technique well enough to create my own method.</p>\n\n<p>Translated into Rust:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn gen(sequence: &amp;mut Vec&lt;usize&gt;, a: &amp;mut [usize], t: usize, p: usize, k: usize, n: usize) {\n    if t &gt; n {\n        if n % p == 0 {\n            for x in 1..(p + 1) {\n                sequence.push(a[x])\n            }\n        }\n    } else {\n        a[t] = a[t - p];\n        gen(sequence, a, t + 1, p, k, n);\n        for x in (a[t - p] + 1)..k {\n            a[t] = x;\n            gen(sequence, a, t + 1, t, k, n);\n        }\n    }\n}\n\nfn de_bruijn&lt;T: Clone&gt;(alphabet: &amp;[T], n: usize) -&gt; Vec&lt;T&gt; {\n    let k = alphabet.len();\n    let mut a = vec![0; n + 1];\n    let vecsize = k.checked_pow(n as u32).unwrap();\n    let mut sequence = Vec::with_capacity(vecsize);\n    gen(&amp;mut sequence, &amp;mut a, 1, 1, k, n);\n    sequence.into_iter().map(|x| alphabet[x].clone()).collect()\n}\n</code></pre>\n\n<p>However this is not able to generate iteratively - it goes through a whole mess of recursion and iteration which is impossible to untangle into a single state.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1562165300, "post_id": 56872714, "comment_id": 100294164, "body": "Related/Dup: <a href=\"https://stackoverflow.com/questions/52360464/what-is-the-syntax-instance-methodsomething\" title=\"what is the syntax instance methodsomething\">stackoverflow.com/questions/52360464/&hellip;</a>"}, {"owner": {"reputation": 1608, "user_id": 1576254, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jq33n.png?s=128&g=1", "display_name": "ikamen", "link": "https://stackoverflow.com/users/1576254/ikamen"}, "edited": false, "score": 0, "creation_date": 1562165682, "post_id": 56872714, "comment_id": 100294390, "body": "Perhaps experts can deduce how the other question helps me, but I definitely can&#39;t."}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 0, "creation_date": 1562165859, "post_id": 56872714, "comment_id": 100294518, "body": "As a side note, is there a reason why you write <code>let va : &amp;mut Vec&lt;f64&gt; = &amp;mut Vec::new()</code> instead the more usual <code>let mut va = Vec::new()</code>?"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1562165949, "post_id": 56872714, "comment_id": 100294565, "body": "If you feel that you cannot understand the answer, it&#39;s a sign that you need to stick to other learning resources before trying Stack Overflow. The official <a href=\"https://doc.rust-lang.org/stable/book\" rel=\"nofollow noreferrer\">book</a> contains sections regarding how Rust infers parameter types. (e.g. <a href=\"https://doc.rust-lang.org/stable/book/ch10-00-generics.html\" rel=\"nofollow noreferrer\">chapter 10</a>)"}, {"owner": {"reputation": 1608, "user_id": 1576254, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jq33n.png?s=128&g=1", "display_name": "ikamen", "link": "https://stackoverflow.com/users/1576254/ikamen"}, "edited": false, "score": 1, "creation_date": 1562166042, "post_id": 56872714, "comment_id": 100294613, "body": "I wonder why you prefer to close question as dup, when it is significantly different (though maybe related), instead of just giving an answer."}, {"owner": {"reputation": 1608, "user_id": 1576254, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jq33n.png?s=128&g=1", "display_name": "ikamen", "link": "https://stackoverflow.com/users/1576254/ikamen"}, "reply_to_user": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 0, "creation_date": 1562166079, "post_id": 56872714, "comment_id": 100294631, "body": "@rodrigo there is no good reason for &amp; in this example"}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 3, "creation_date": 1562166272, "post_id": 56872714, "comment_id": 100294759, "body": "I think that the problem is that you think that <code>as f64</code> is a type annotation. But it is not a &quot;type annotation&quot;, it is a &quot;type cast&quot;, which is a very different thing. If you write <code>let a = expr;</code> and the compiler complains that the type of <code>expr</code> is not known, (type annotation required), then writing <code>let a: f64 = expr;</code> will work, because now <code>expr</code> must be <code>f64</code>. But if you write <code>let a = expr as f64;</code> you are forcing <code>a</code> to be <code>f64</code>, but <code>expr</code> still may be of any numeric type, so the compiler error persists."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1562166491, "post_id": 56872714, "comment_id": 100294894, "body": "The last comment is covered by the duplicate <a href=\"https://stackoverflow.com/q/56477618/155423\">What is the difference between type casting by setting the type of a variable and using <code>as</code>?</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1562166721, "post_id": 56872714, "comment_id": 100295021, "body": "FWIW, the OP already knows <i>how</i> to solve this code, as it was <a href=\"https://stackoverflow.com/questions/56871875/what-is-the-canonical-way-to-sum-the-elements-in-a-vec#comment100293007_56871875\">provided to them in a previous question</a>."}, {"owner": {"reputation": 1608, "user_id": 1576254, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jq33n.png?s=128&g=1", "display_name": "ikamen", "link": "https://stackoverflow.com/users/1576254/ikamen"}, "edited": false, "score": 0, "creation_date": 1562166789, "post_id": 56872714, "comment_id": 100295055, "body": "I do not know how to solve it, even if some of the linked answers hint to solution."}, {"owner": {"reputation": 1608, "user_id": 1576254, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jq33n.png?s=128&g=1", "display_name": "ikamen", "link": "https://stackoverflow.com/users/1576254/ikamen"}, "reply_to_user": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 0, "creation_date": 1562166820, "post_id": 56872714, "comment_id": 100295071, "body": "@rodrigo thanks, I have learned something"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1562166881, "post_id": 56872714, "comment_id": 100295100, "body": "@ikamen we have <b>literally</b> pasted the exact code you need, and then <a href=\"https://stackoverflow.com/questions/56871875/what-is-the-canonical-way-to-sum-the-elements-in-a-vec#comment100293007_56871875\">linked to it</a> in case you missed it. Here it is again, tailored to this instance: <code>let va = vec![5.0]; let avg = va.iter().sum::&lt;f64&gt;() &#47; 2.0;</code>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1562166994, "post_id": 56872714, "comment_id": 100295151, "body": "@ikamen If you don&#39;t like the content quality rules we enforce here on Stack Overflow, that&#39;s totally fine! Stack Overflow isn&#39;t for everyone. You may wish to look at other resources, such as <a href=\"https://www.reddit.com/r/rust/\" rel=\"nofollow noreferrer\">the Rust subreddit</a>, <a href=\"https://users.rust-lang.org/\" rel=\"nofollow noreferrer\">the Rust users forum</a>, or <a href=\"https://www.rust-lang.org/community\" rel=\"nofollow noreferrer\">the Rust Discord server</a>."}, {"owner": {"reputation": 1608, "user_id": 1576254, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jq33n.png?s=128&g=1", "display_name": "ikamen", "link": "https://stackoverflow.com/users/1576254/ikamen"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1562167984, "post_id": 56872714, "comment_id": 100295705, "body": "@Shepmaster I was impolite and I apologize. Yet it was a long path to this solution. Consider posting it as an answer so that newbies find it faster by googling."}], "owner": {"reputation": 1608, "user_id": 1576254, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jq33n.png?s=128&g=1", "display_name": "ikamen", "link": "https://stackoverflow.com/users/1576254/ikamen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 509, "favorite_count": 0, "closed_date": 1562166363, "answer_count": 0, "score": 0, "last_activity_date": 1562166571, "creation_date": 1562165212, "last_edit_date": 1562166571, "question_id": 56872714, "link": "https://stackoverflow.com/questions/56872714/iter-sum-stops-working-as-soon-as-i-add-further-operation", "closed_reason": "Duplicate", "title": "iter().sum() stops working as soon as I add further operation", "body": "<p>I want to write concise code. Here is a snippet that fails for mysterious reasons:</p>\n\n<pre><code>let va: &amp;mut Vec&lt;f64&gt; = &amp;mut Vec::new();\nva.push(5.0);\n\nlet avg: f64 = va.iter().sum() / 2.0;\n</code></pre>\n\n<p>The error message is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0283]: type annotations required: cannot resolve `_: std::iter::Sum&lt;&amp;f64&gt;`\n  --&gt; src/main.rs:36:30\n   |\n36 |     let avg: f64 = va.iter().sum() / 2.0;\n   |                              ^^^\n</code></pre>\n\n<p>Putting types everywhere doesn't help either.</p>\n\n<pre><code>let avg: f64 = va.iter().sum() as f64 / 2.0f64;\n</code></pre>\n\n<p>Error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0282]: type annotations needed\n  --&gt; src/main.rs:36:20\n   |\n36 |     let avg: f64 = va.iter().sum() as f64 / 2.0f64;\n   |                    ^^^^^^^^^^^^^^^^^^^^^^ cannot infer type for `S`\n   |\n   = note: type must be known at this point\n</code></pre>\n\n<p>The following code, which is a trivial rewrite, works:</p>\n\n<pre><code>let va: &amp;mut Vec&lt;f64&gt; = &amp;mut Vec::new();\nva.push(5.0);\n\nlet sum: f64 = va.iter().sum();\nlet avg: f64 = sum / 2.0;\n</code></pre>\n\n<p>This problem is the same for any other arithmetic operation. What is the logic behind this behavior of the compiler?</p>\n\n<p>My question is not about the Turbofish syntax.</p>\n"}, {"tags": ["rust", "continuous-integration", "rust-cargo"], "answers": [{"tags": [], "owner": {"reputation": 7882, "user_id": 2722968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d0a9ce812892f03b8342c5a60be24632?s=128&d=identicon&r=PG&f=1", "display_name": "user2722968", "link": "https://stackoverflow.com/users/2722968/user2722968"}, "is_accepted": false, "score": 0, "last_activity_date": 1562167464, "last_edit_date": 1562167464, "creation_date": 1562166329, "answer_id": 56873092, "question_id": 56870422, "link": "https://stackoverflow.com/questions/56870422/how-can-i-cause-compilation-to-fail-on-warnings-on-ci-and-have-extra-rustflags-s/56873092#56873092", "title": "How can I cause compilation to fail on warnings on CI and have extra rustflags set in .cargo/config?", "body": "<p>You can use <a href=\"https://docs.rs/built/0.3.1/built/util/fn.detect_ci.html\" rel=\"nofollow noreferrer\"><code>built::util::detect_ci()</code></a> to figure out if the current build is executed under CI. You can then use a small build script to set a cfg</p>\n\n<p><strong>Cargo.toml</strong></p>\n\n<pre><code>[package]\nbuild = true\n\n[build-dependencies]\nbuilt = { version = \"0.3\", default_features = false }\n</code></pre>\n\n<p><strong>build.rs</strong></p>\n\n<pre><code>fn main() {\n    if let Some(ci) = built::util::detect_ci() {\n        // There may be a better way to do this\n        println!(\"cargo:rustc-cfg=DENY_WARNINGS\");\n        println!(\"cargo:warning=Denying warnings because we are in CI \\\"{}\\\"\", ci);\n    }\n}\n</code></pre>\n\n<p>Note that the result of the build script is cached, so once this build script has run and Cargo has decided whether we are running under CI or not, it will go with this result until you either modify the build script or <code>cargo clean</code>. This should not be a problem for either local development or CI unless Scotty beams you up on a regular basis.</p>\n\n<p><strong>main.rs</strong> or <strong>lib.rs</strong></p>\n\n<pre><code>#![cfg_attr(DENY_WARNINGS, deny(warnings))]\n\nfn main() {\n    // This will be a warning locally but fail to compile e.g. if built on Travis\n    Result::&lt;(), ()&gt;::Err(());\n}\n</code></pre>\n"}], "owner": {"reputation": 1057, "user_id": 2716377, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/0JbwB.png?s=128&g=1", "display_name": "Nicolas Mattia", "link": "https://stackoverflow.com/users/2716377/nicolas-mattia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 326, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1562167464, "creation_date": 1562157717, "last_edit_date": 1562158282, "question_id": 56870422, "link": "https://stackoverflow.com/questions/56870422/how-can-i-cause-compilation-to-fail-on-warnings-on-ci-and-have-extra-rustflags-s", "title": "How can I cause compilation to fail on warnings on CI and have extra rustflags set in .cargo/config?", "body": "<p>I\u2019m trying to have Cargo fail on warnings on CI but not when developing locally.</p>\n\n<p>I had a working solution which was to set <code>RUSTFLAGS=\u201c-D warnings\u201d</code> in the CI job. This worked well as it would indeed fail the build for the local crates but not the dependency crates (due to <code>\u2014cap-lints</code>).</p>\n\n<p>Recently, some rustflags had to be set in a (checked in) <code>.cargo/config</code> file:</p>\n\n<pre><code>[target.\u2019cfg(target_os = \u201clinux\u201d)\u2019]\nrustflags = [\u201csome\u201d, \u201coptions\u201d]\n</code></pre>\n\n<p>This didn\u2019t work since <code>RUSTFLAGS</code> takes precedence and the <code>.cargo/config</code> flags would be ignored. I don\u2019t want to add <code>-D warnings</code> to the <code>config</code> as this can be a pain when developing.</p>\n\n<p>The current work around is a script that tweaks the <code>config</code> prior to the CI job:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>sed -i \"s:\\(rustflags = .*\\)]:\\1, \\\"-D\\\", \\\"warnings\\\"]:g\" .cargo/config\necho '[build]' &gt;&gt; .cargo/config\necho 'rustflags = [ \"-D\", \"warnings\"]' &gt;&gt; .cargo/config\n</code></pre>\n\n<p>This appends <code>-D warnings</code> to existing <code>rustflags</code> in the config <em>and</em> creates an extra catch-all <code>config</code> entry that makes sure that <code>-D warnings</code> is also enabled on non-Linux CI builds.</p>\n\n<p>This is terribly hacky; is there a better solution I\u2019m missing?</p>\n\n<p>Maybe this should be a feature request on the Cargo repository but I don\u2019t know what the ideal solution would look like.</p>\n"}, {"tags": ["mysql", "error-handling", "rust"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1562155537, "post_id": 56869746, "comment_id": 100288038, "body": "Just to be sure: that&#39;s <code>Opts::from</code> that panics?"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1562155646, "post_id": 56869746, "comment_id": 100288108, "body": "I don&#39;t know this lib, but I&#39;d try to create an <code>Opts</code> with <a href=\"https://docs.rs/mysql/16.0.2/mysql/struct.Opts.html#method.from_url\" rel=\"nofollow noreferrer\"><code>from_url</code></a> to be sure that <code>Into&lt;Opts&gt;</code> wont panic"}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1562155823, "post_id": 56869746, "comment_id": 100288226, "body": "@FrenchBoiethios is right, <a href=\"https://docs.rs/mysql_async/0.19.1/src/mysql_async/opts.rs.html#713\" rel=\"nofollow noreferrer\">from_opts</a> is already using <code>from_url</code> with <code>unwrap()</code>"}], "answers": [{"comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1562156096, "post_id": 56869917, "comment_id": 100288407, "body": "The dev team should implement <a href=\"https://doc.rust-lang.org/std/convert/trait.TryFrom.html\" rel=\"nofollow noreferrer\"><code>TryFrom</code></a> instead of <code>From</code>."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1562156276, "post_id": 56869917, "comment_id": 100288538, "body": "thanks, how good/bad is to use <code>Opts::from_url(dsn).unwrap_or_else(|e| { &#47;&#47;handle erro});</code>"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1562156454, "post_id": 56869917, "comment_id": 100288644, "body": "@nbari That&#39;s much idiomatic"}], "tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 0, "last_activity_date": 1562156002, "creation_date": 1562156002, "answer_id": 56869917, "question_id": 56869746, "link": "https://stackoverflow.com/questions/56869746/how-to-verify-if-a-data-source-name-is-valid/56869917#56869917", "title": "How to verify if a data source name is valid?", "body": "<p>You can create the <code>Opts</code> with <a href=\"https://docs.rs/mysql/16.0.2/mysql/struct.Opts.html#method.from_url\" rel=\"nofollow noreferrer\"><code>from_url</code></a>, so that you are sure that it won't fail after that:</p>\n\n<pre><code>let opts = match Opts::from_url(dsn) {\n    Ok(opts) =&gt; opts,\n    Err(e) =&gt; panic!(),// manage error\n};\nlet mut opts = mysql::OptsBuilder::from_opts(opts);\nopts.stmt_cache_size(0);\nlet pool = mysql::Pool::new_manual(1, 3, opts).expect(\"Could not connect to MySQL\");\n</code></pre>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 56869917, "answer_count": 1, "score": 0, "last_activity_date": 1562156002, "creation_date": 1562155427, "last_edit_date": 1562155616, "question_id": 56869746, "link": "https://stackoverflow.com/questions/56869746/how-to-verify-if-a-data-source-name-is-valid", "title": "How to verify if a data source name is valid?", "body": "<p>I am using <a href=\"https://docs.rs/mysql/16.0.2/mysql/struct.OptsBuilder.html\" rel=\"nofollow noreferrer\"><code>OptsBuilder</code></a> passing a <a href=\"https://en.wikipedia.org/wiki/Data_source_name\" rel=\"nofollow noreferrer\">data source name</a> to create a connection pool:</p>\n\n<pre><code>let mut opts = mysql::OptsBuilder::from_opts(dsn);\nopts.stmt_cache_size(0);\nlet pool = mysql::Pool::new_manual(1, 3, opts).expect(\"Could not connect to MySQL\");\n</code></pre>\n\n<p>If I pass an invalid DSN, the code panics:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>thread 'main' panicked at 'URL ParseError { relative URL without a base }', ', /path/.cargo/registry/src/github.com-1ecc6299db9ec823/mysql-16.0.2/src/conn/opts.rs:827:25\n</code></pre>\n\n<p>How can I handle the error or verify in advance to prevent panicking?</p>\n"}, {"tags": ["rust", "gtk", "lifetime", "borrowing", "gtk-rs"], "answers": [{"comments": [{"owner": {"reputation": 1507, "user_id": 4296244, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/e8c0940effc84e18a8541145ef2dfbfe?s=128&d=identicon&r=PG&f=1", "display_name": "Natjo", "link": "https://stackoverflow.com/users/4296244/natjo"}, "edited": false, "score": 0, "creation_date": 1562145937, "post_id": 56866895, "comment_id": 100282721, "body": "I saw your comment and tried it, did not work. I wasn&#39;t sure if I understood you right, but trying your example returns the same error: <code>cannot move out of captured variable in an &#39;Fn&#39; closure</code>."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "reply_to_user": {"reputation": 1507, "user_id": 4296244, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/e8c0940effc84e18a8541145ef2dfbfe?s=128&d=identicon&r=PG&f=1", "display_name": "Natjo", "link": "https://stackoverflow.com/users/4296244/natjo"}, "edited": false, "score": 1, "creation_date": 1562146001, "post_id": 56866895, "comment_id": 100282758, "body": "@Jonas that&#39;s not the <b>same</b> error, but a different one."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1562146046, "post_id": 56866895, "comment_id": 100282780, "body": "Yes, that&#39;s a different error. Without more information, we cannot help you."}, {"owner": {"reputation": 1507, "user_id": 4296244, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/e8c0940effc84e18a8541145ef2dfbfe?s=128&d=identicon&r=PG&f=1", "display_name": "Natjo", "link": "https://stackoverflow.com/users/4296244/natjo"}, "edited": false, "score": 0, "creation_date": 1562146056, "post_id": 56866895, "comment_id": 100282785, "body": "Sorry, I meant the same error as the error I got when trying your approach from the initial comment."}], "tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 3, "last_activity_date": 1562147535, "last_edit_date": 1562147535, "creation_date": 1562145756, "answer_id": 56866895, "question_id": 56866539, "link": "https://stackoverflow.com/questions/56866539/why-does-cloning-data-inside-a-closure-not-prevent-the-error-closure-may-outliv/56866895#56866895", "title": "Why does cloning data inside a closure not prevent the error &quot;closure may outlive the current function&quot;?", "body": "<h1>General explanation</h1>\n\n<p>Minimal reproduction of a similar issue:</p>\n\n<pre><code>fn move_and_print(s: String) {\n    println!(\"{}\", s);\n}\n\nfn main() {\n    let s = String::from(\"Hello\");\n\n    let print_cloned_s = || println!(\"{}\", s.clone());\n\n    move_and_print(s);\n    print_cloned_s();\n}\n</code></pre>\n\n<p>The compiler complains:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0505]: cannot move out of `s` because it is borrowed\n</code></pre>\n\n<p>I want to clone <code>s</code> to avoid a borrow, and thus to be allowed to consume it afterwards. So, how can the compiler say that <code>s</code> is borrowed?</p>\n\n<p>This former reasoning is totally correct, however, there is a subtlety: the signature of <a href=\"https://doc.rust-lang.org/std/clone/trait.Clone.html#tymethod.clone\" rel=\"nofollow noreferrer\"><code>Clone::clone</code></a> is <code>clone(&amp;self) -&gt; Self</code>. So when <code>clone</code> is called, <strong>the data is borrowed by the clone function</strong>!</p>\n\n<p>The solution is to clone the data <strong>before</strong> creating the closure, and then to move it into the closure:</p>\n\n<pre><code>fn move_and_print(s: String) {\n    println!(\"{}\", s);\n}\n\nfn main() {\n    let s = String::from(\"Hello\");\n\n    // I clone `s` BEFORE creating the closure:\n    let cloned_s = s.clone();\n\n    // Then I move the cloned data into the closure:\n    let print_cloned_s = move || println!(\"{}\", cloned_s);\n\n    move_and_print(s);\n    print_cloned_s();\n}\n</code></pre>\n\n<h1>Solving your actual error</h1>\n\n<p>As I said, you must clone the configuration and move this clone inside the closure:</p>\n\n<pre><code>let cloned_config = config.clone();\n\napplication.connect_activate(move |app| {\n    build_ui(app, cloned_config.clone());\n});\n</code></pre>\n\n<p>You must also add a second clone call to allow the closure to be a <code>Fn</code> and not a <code>FnOnce</code>. Indeed, if you move your config inside <code>build_ui</code>, the function cannot be used twice. See <a href=\"https://stackoverflow.com/questions/33662098/cannot-move-out-of-captured-outer-variable-in-an-fn-closure\">this question</a> for more information.</p>\n\n<hr>\n\n<p>If I understand well your need, <code>config</code> is intended to be a read-only configuration that must be shared. In this situation, I would not move it at all, for example by changing the signature of <code>build_ui</code> to:</p>\n\n<pre><code>fn build_ui(application: &amp;gtk::Application, config: &amp;Config)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "is_accepted": false, "score": 0, "last_activity_date": 1566919077, "last_edit_date": 1566919077, "creation_date": 1566912743, "answer_id": 57675822, "question_id": 56866539, "link": "https://stackoverflow.com/questions/56866539/why-does-cloning-data-inside-a-closure-not-prevent-the-error-closure-may-outliv/57675822#57675822", "title": "Why does cloning data inside a closure not prevent the error &quot;closure may outlive the current function&quot;?", "body": "<p>Hate to say that the sanctioned answer isn't very accurate. It is correct but has subtle difference to the OP code. Actually if reading the original code carefully, there is no reason to believe that <code>rustc</code> can't conclude the local variable <code>config</code> outlive the <code>connect_activate</code> function call. It rejects it for other reasons.</p>\n\n<p>A more accurate minimal reproducible example is:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn reference_and_print(s: &amp;str) {\n    println!(\"{}\", s);\n}\n\nfn closure_and_print&lt;F: Fn()&gt;(f: F) {\n    f();\n}\n\nfn main() {\n    let s = \"Hello\";\n\n    reference_and_print(s);\n    closure_and_print(|| {\n        println!(\"{}\", s);\n    });\n    reference_and_print(s);\n}\n</code></pre>\n\n<p>This compiles. But, if only change one line:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn closure_and_print&lt;F: Fn() + 'static&gt;(f: F) {\n    f();\n}\n</code></pre>\n\n<p>This then causes <code>may outlive borrowed value</code> error. Pretty surprising.</p>\n\n<p>In fact, by examining <code>gtk-rs</code> code, I notice that closures with <code>'static</code> bound are everywhere. Nothing outlives <code>'static</code> unless you own them. That's why one must use <code>move</code> closures to own the captured variables when using <code>gtk-rs</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let cloned = config.clone();\napplication.connect_activate(move |app| {\n    build_ui(app, cloned);\n});\n</code></pre>\n"}], "owner": {"reputation": 1507, "user_id": 4296244, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/e8c0940effc84e18a8541145ef2dfbfe?s=128&d=identicon&r=PG&f=1", "display_name": "Natjo", "link": "https://stackoverflow.com/users/4296244/natjo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 56866895, "answer_count": 2, "score": 3, "last_activity_date": 1566919077, "creation_date": 1562144633, "last_edit_date": 1562156245, "question_id": 56866539, "link": "https://stackoverflow.com/questions/56866539/why-does-cloning-data-inside-a-closure-not-prevent-the-error-closure-may-outliv", "title": "Why does cloning data inside a closure not prevent the error &quot;closure may outlive the current function&quot;?", "body": "<p>I built a GTK application with gtk-rs. When I build the main window, I want to use some dynamic parameters such as window height. I created a struct which contains all such settings and want to use this as an input parameter for the function building the UI:</p>\n\n<pre><code>fn main() {\n    let application =\n        gtk::Application::new(Some(\"id\"), Default::default())\n            .expect(\"Initialization failed...\");\n\n    let config = Config {width: 100., height: 100.};\n    application.connect_activate(|app| {\n        build_ui(app, config.clone());\n    });\n\n    // Use config further\n\n    application.run(&amp;args().collect::&lt;Vec&lt;_&gt;&gt;());\n}\n\n#[derive(Debug, Clone)]\npub struct Config {\n    pub width: f64,\n    pub height: f64,\n}\n\nfn build_ui(application: &amp;gtk::Application, config: Config) {\n    ...\n}\n</code></pre>\n\n<p>I can't use a reference to <code>config</code> when calling <code>build_ui</code> since this function could be called after the main function finished and thus the config struct could not exist anymore.</p>\n\n<p>My idea was to create a copy of the config struct (it is only a few primitive variables), which exists apart of the original one and thus I wouldn't run into lifetime or ownership issues.</p>\n\n<p>Is this the right approach? What am I doing wrong? I get the same error I got from borrowing the config struct:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0373]: closure may outlive the current function, but it borrows `config`, which is owned by the current function\n  --&gt; src/main.rs:36:34\n   |\n36 |     application.connect_activate(|app| {\n   |                                  ^^^^^ may outlive borrowed value `config`\n37 |         build_ui(app, config.clone());\n   |                       ------ `config` is borrowed here\n</code></pre>\n"}, {"tags": ["rust", "operating-system"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1562089483, "post_id": 56856722, "comment_id": 100265318, "body": "Your instructor has forgotten to specify a version of <code>xargo</code> that is compatible with that specific version of the compiler. You need to figure out what version of <code>xargo</code> works with Rust from over a year ago; presumably a version from around that time. You are likely to encounter this problem with every library you attempt to use. This is normally prevented because <code>Cargo.lock</code> records the versions you&#39;ve selected, but (a) you probably don&#39;t have one and (b) Cargo.lock doesn&#39;t affect tools installed via <code>cargo install</code>."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1562135981, "post_id": 56856722, "comment_id": 100277464, "body": "xargo is soft deprecated and should only be used for very rare targets. Most of the common targets are nowedays included into the default rust list. Run <code>rustup target list</code> to see which targets are available and choose one which suits best for you."}], "owner": {"reputation": 159, "user_id": 11730293, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d5217dca082d3d10dde1f970d6a8fd3?s=128&d=identicon&r=PG&f=1", "display_name": "thedch", "link": "https://stackoverflow.com/users/11730293/thedch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1562089286, "creation_date": 1562084961, "last_edit_date": 1562089286, "question_id": 56856722, "link": "https://stackoverflow.com/questions/56856722/cannot-install-xargo-when-using-rust-nightly-non-string-literals-in-attribute", "title": "Cannot install xargo when using rust nightly - &quot;non-string literals in attributes, or string literals in top-level positions, are experimental&quot;", "body": "<p>I'm using a specific Rust nightly build for <a href=\"https://cs140e.sergio.bz/assignments/0-blinky/#phase-4-rusting-away\" rel=\"nofollow noreferrer\">CS 140E</a>. When I run the commands</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>rustup default nightly-2018-01-09\nrustup component add rust-src\ncargo install xargo\n</code></pre>\n\n<p>I end up with <code>libc</code> failing to build:</p>\n\n<blockquote>\n  <p>error: non-string literals in attributes, or string literals in top-level positions, are experimental (see issue #34981)\n    --> ~/.cargo/registry/src/github.com-1ecc6299db9ec823/libc-0.2.58/src/macros.rs:78:15</p>\n</blockquote>\n\n<p>It also mentions </p>\n\n<blockquote>\n  <p>= help: add #![feature(attr_literals)] to the crate attributes to enable</p>\n</blockquote>\n\n<p>Which I've done, which brings me to more complex errors that I have less confidence to fix. Is a nightly build failing in this manner expected? I've also tried <code>rustup default nightly</code> and <code>rustup default stable</code> and they both fail for other reasons.</p>\n"}, {"tags": ["function", "dynamic", "rust", "interpreter"], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 11730155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26b609080e3e275cd3fbd6e4c7dd3386?s=128&d=identicon&r=PG&f=1", "display_name": "Dumbfounded", "link": "https://stackoverflow.com/users/11730155/dumbfounded"}, "edited": false, "score": 0, "creation_date": 1562090780, "post_id": 56857542, "comment_id": 100265861, "body": "Thanks for the reply.  Indeed, I can do all that you propose, except for the step that converts a vector of AST enum variants (e.g. <code>vec![Arg::Bool(true), Arg::Float(2.0),  Arg::Int(1)])</code> to a heterogenous collection of values (e.g. <code>(true, 2.0, 1)</code> or <code>(true, (2.0, (1,)))</code> to pass the function.  I can look up the function signature in a map.  I can lookup the function pointer in different maps based on the signature.  And I can call the functions, up to some number of supported arguments.  But that crucial step is where I am stuck."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 17, "user_id": 11730155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26b609080e3e275cd3fbd6e4c7dd3386?s=128&d=identicon&r=PG&f=1", "display_name": "Dumbfounded", "link": "https://stackoverflow.com/users/11730155/dumbfounded"}, "edited": false, "score": 0, "creation_date": 1562091104, "post_id": 56857542, "comment_id": 100266000, "body": "Why not? <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=87c2725d8bccb78322dab9429f410111\" rel=\"nofollow noreferrer\">Just write the code</a>"}, {"owner": {"reputation": 17, "user_id": 11730155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26b609080e3e275cd3fbd6e4c7dd3386?s=128&d=identicon&r=PG&f=1", "display_name": "Dumbfounded", "link": "https://stackoverflow.com/users/11730155/dumbfounded"}, "edited": false, "score": 0, "creation_date": 1562103957, "post_id": 56857542, "comment_id": 100270667, "body": "Yes, you can take a <code>Vec&lt;Arg&gt;</code> and convert it to a tuple.  The issue is how to do so generically, for potentially any combination of types in the tuple.  E.g., there are a number of built-in functions with different signature types, some take (i32), some (i32, f64), some (&amp;str, bool, i32), etc.  Given a <code>Function(String,Vec&lt;Arg&gt;)</code>, how to generically take that <code>Vec&lt;Arg&gt;</code> and produce a tuple or <code>HList</code> that conforms to the function signature.  Implement something like <code>do_it</code> for all possible combination of argument types and argument numbers up to some limit, and then select the right one?"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 2, "last_activity_date": 1562091223, "last_edit_date": 1562091223, "creation_date": 1562088954, "answer_id": 56857542, "question_id": 56856382, "link": "https://stackoverflow.com/questions/56856382/how-to-dynamically-build-function-calls-with-different-numbers-of-arguments-in-r/56857542#56857542", "title": "How to dynamically build function calls with different numbers of arguments in Rust?", "body": "<p>You don't. Rust is a <em>statically typed</em> language and you are attempting to do non-statically-determinable actions.</p>\n\n<p>Instead, all of your functions need to take in a collection of arguments, verify that there is the right number of arguments (and type, if appropriate to your interpreter), then call the appropriate Rust function with a fixed number of arguments:</p>\n\n<pre><code>// All of the panicking can be replaced by proper error handling.\n\nenum Arg {\n    Bool(bool),\n    Int(i32),\n}\n\nimpl Arg {\n    fn into_bool(self) -&gt; bool {\n        match self {\n            Arg::Bool(b) =&gt; b,\n            _ =&gt; panic!(\"Not a bool\"),\n        }\n    }\n\n    fn into_int(self) -&gt; i32 {\n        match self {\n            Arg::Int(i) =&gt; i,\n            _ =&gt; panic!(\"Not an int\"),\n        }\n    }\n}\n\nfn some_fn_wrapper(mut args: Vec&lt;Arg&gt;) {\n    assert_eq!(args.len(), 3);\n\n    let c = args.pop().unwrap();\n    let b = args.pop().unwrap();\n    let a = args.pop().unwrap();\n\n    some_fn(a.into_bool(), b.into_int(), c.into_bool())\n}\n\nfn some_fn(_a: bool, _b: i32, _c: bool) {}\n</code></pre>\n\n<p>All of this will happen at runtime, as you want to create a highly dynamic language.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/50306894/155423\">How do I pass each element of a slice as a separate argument to a variadic C function?</a></li>\n<li><a href=\"https://stackoverflow.com/q/26555682/155423\">How to pass a dynamic amount of typed arguments to a function?</a></li>\n<li><a href=\"https://stackoverflow.com/q/30540807/155423\">Calling a function only known at runtime</a></li>\n<li><a href=\"https://stackoverflow.com/q/28951503/155423\">How can I create a function with a variable number of arguments?</a></li>\n<li><a href=\"https://stackoverflow.com/q/20445975/155423\">Is Reflection possible in Rust, and if so how can I invoke an unknown function with some arguments?</a></li>\n</ul>\n"}], "owner": {"reputation": 17, "user_id": 11730155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26b609080e3e275cd3fbd6e4c7dd3386?s=128&d=identicon&r=PG&f=1", "display_name": "Dumbfounded", "link": "https://stackoverflow.com/users/11730155/dumbfounded"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1029, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1562091223, "creation_date": 1562083653, "last_edit_date": 1562088706, "question_id": 56856382, "link": "https://stackoverflow.com/questions/56856382/how-to-dynamically-build-function-calls-with-different-numbers-of-arguments-in-r", "title": "How to dynamically build function calls with different numbers of arguments in Rust?", "body": "<p>How do I take a vector of function argument AST variants, extract the values, and use them to instantiate a function call? </p>\n\n<p>I am writing an interpreter that evaluates certain expressions.  Some of the expressions are function calls.  I am having a hard time figuring out how to translate the function calls AST to the actual call.  The AST gives me the function name and a vector of arguments.  I can lookup the function pointer to call from the name using a map, but passing the arguments to the function pointer is problem. </p>\n\n<p>Rust does not have a splat operator (argument expansion).  I could pass them as a tuple and use destructuring of the arguments, but I can't figure out how to convert the vector of AST argument enum variants to a tuple of the concrete types.  </p>\n\n<p>I can't simply map or loop over the AST arguments to extract the values and produce a tuple.</p>\n\n<p>I can use nested tuples to build a heterogenous list incrementally:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn prepend&lt;I,T&gt;(i: I, t: T) -&gt; (I,T) { (i, t) }\n\nfn foo() {\n    let x = ();\n    let x = prepend(1, x);\n    let x = prepend(2.0, x);\n    let x = prepend(true, x);\n}\n</code></pre>\n\n<p>But that only works because <code>x</code> gets shadowed and the new binding has a different type.  This won't work:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn foo() {\n    let mut x = ();\n    x = prepend(1, x);\n    x = prepend(2.0, x);\n    x = prepend(true, x);\n}\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["module", "rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1562081315, "post_id": 56855635, "comment_id": 100261634, "body": "<i>Is this how I am supposed to structure my project when writing idiomatic Rust code</i> \u2014 no."}, {"owner": {"reputation": 896, "user_id": 6314254, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-syObEwk9Mds/AAAAAAAAAAI/AAAAAAAAARU/Qz5nNseD1Pc/photo.jpg?sz=128", "display_name": "Hugo Trentesaux", "link": "https://stackoverflow.com/users/6314254/hugo-trentesaux"}, "edited": false, "score": 0, "creation_date": 1562085429, "post_id": 56855635, "comment_id": 100263714, "body": "I suggest you to read <a href=\"https://doc.rust-lang.org/book/ch07-00-managing-growing-projects-with-packages-crates-and-modules.html\" rel=\"nofollow noreferrer\">this chapter</a> in the Rust book, it contains detailed explanation on how to do."}], "owner": {"reputation": 1, "user_id": 11730052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f936cd49e2db3db110f87063a016b22f?s=128&d=identicon&r=PG&f=1", "display_name": "Rico Tekev", "link": "https://stackoverflow.com/users/11730052/rico-tekev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 20, "favorite_count": 0, "closed_date": 1562081185, "answer_count": 0, "score": 0, "last_activity_date": 1562081267, "creation_date": 1562080949, "last_edit_date": 1562081267, "question_id": 56855635, "link": "https://stackoverflow.com/questions/56855635/how-can-i-have-more-than-one-file-per-module", "closed_reason": "Duplicate", "title": "How can I have more than one file per module?", "body": "<p>I\u2019m having a bit of a fight with the module system. My idea was to structure my project into different files because keeping everything in the same one gets ugly rather fast\u2026</p>\n\n<p>I have these files:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>src\n\\--main.rs\n|--definitions.rs\n|--parsing.rs\n|--evaluation.rs\n</code></pre>\n\n<p><code>definitions.rs</code> contains enum declarations, <code>parsing.rs</code> and evaluation.rs both operate with the data structures defined in <code>definitions</code>, and <code>main.rs</code> uses stuff from all three of these files.</p>\n\n<p>How can I structure that in a way that works, preferably without having a folder for each new file?</p>\n\n<p>I tried using</p>\n\n<pre><code>//main.rs\npub mod parsing;\npub mod evaluation;\npub mod definitions;\n\n//parsing.rs and evaluation.rs\npub mod definitions;\n//also tried use definitions;\n</code></pre>\n\n<p>Nothing I've tried is working. Is this how I am supposed to structure my project when writing idiomatic Rust code?</p>\n"}, {"tags": ["rust", "rust-diesel"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1562072607, "post_id": 56853059, "comment_id": 100256277, "body": "It&#39;s hard to answer your question because it doesn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. We can&#39;t tell what crates (and their versions), types, traits, fields, etc. are present in the code. It would make it easier for us to help you if you try to reproduce your error in a brand new Cargo project then <a href=\"https://stackoverflow.com/posts/56853059/edit\">edit</a> your question to include the additional info. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-</a> and <a href=\"//stackoverflow.com/tags/diesel/info\">Diesel</a>-specific tips you can use to reduce your original code for posting here. Thanks!"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1562073078, "post_id": 56853059, "comment_id": 100256552, "body": "(that last link should be to <a href=\"https://stackoverflow.com/tags/rust-diesel/info\">the tag page</a>, oops!)"}, {"owner": {"reputation": 825, "user_id": 6392402, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/b64863f890a4a549823ba3fa320a9869?s=128&d=identicon&r=PG&f=1", "display_name": "crash springfield", "link": "https://stackoverflow.com/users/6392402/crash-springfield"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1562073292, "post_id": 56853059, "comment_id": 100256683, "body": "@Shepmaster I&#39;ll review those and updated as needed. I&#39;ve updated the issue with a github link to a branch that reproduces the error (and I&#39;ll keep that up as a future reference)"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1562073323, "post_id": 56853059, "comment_id": 100256704, "body": "<a href=\"https://meta.stackoverflow.com/q/380194/155423\">To make Stack Overflow a useful resource for future visitors beyond of the context of your repository</a>, please <a href=\"https://stackoverflow.com/posts/56853059/edit\">edit</a> your question to add a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> in the question itself, in addition to the link to your repository."}, {"owner": {"reputation": 825, "user_id": 6392402, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/b64863f890a4a549823ba3fa320a9869?s=128&d=identicon&r=PG&f=1", "display_name": "crash springfield", "link": "https://stackoverflow.com/users/6392402/crash-springfield"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1562076105, "post_id": 56853059, "comment_id": 100258462, "body": "@Shepmaster when I refactor it following Rust&#39;s minimal reproducible example, it runs fine. Futhermore, it runs fine if I remove the &quot;belongs_to&quot; macro"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1562076274, "post_id": 56853059, "comment_id": 100258569, "body": "That&#39;s great! That means that you are finding more details about the problem that you can update the question with. For example, you now know that <code>belongs_to</code> is responsible, so that can be part of your question title. I&#39;ve updated that to show an example of how you can improve your question."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1562076390, "post_id": 56853059, "comment_id": 100258640, "body": "Next, take smaller steps to reduce the problem. When the problem goes away, undo that change and try removing / changing other things. It&#39;s highly likely that you&#39;ll solve your own problem this way."}], "answers": [{"tags": [], "owner": {"reputation": 336, "user_id": 4937184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/060a97a0bc78c9e76b2ec314a7d63d77?s=128&d=identicon&r=PG&f=1", "display_name": "ocstl", "link": "https://stackoverflow.com/users/4937184/ocstl"}, "is_accepted": false, "score": 10, "last_activity_date": 1562076506, "creation_date": 1562076506, "answer_id": 56854367, "question_id": 56853059, "link": "https://stackoverflow.com/questions/56853059/use-of-undeclared-type-or-module-when-using-diesels-belongs-to-attribute/56854367#56854367", "title": "&quot;use of undeclared type or module&quot; when using Diesel&#39;s `belongs_to` attribute", "body": "<p>As the error mentions, <code>birds</code> is not in scope. The <code>table!</code> macro creates a public module (<code>birds</code>), which you then need to bring into scope to be able to derive <code>Associations</code> (in models.rs):</p>\n\n<pre><code>use super::schema::birds;\n</code></pre>\n\n<p>See <a href=\"https://docs.diesel.rs/diesel/associations/index.html\" rel=\"noreferrer\">diesel::associations</a> for an example, where it shows that one needs to <code>use</code> the schema for <code>derive</code>.</p>\n"}], "owner": {"reputation": 825, "user_id": 6392402, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/b64863f890a4a549823ba3fa320a9869?s=128&d=identicon&r=PG&f=1", "display_name": "crash springfield", "link": "https://stackoverflow.com/users/6392402/crash-springfield"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9901, "favorite_count": 2, "answer_count": 1, "score": 9, "last_activity_date": 1562076506, "creation_date": 1562072352, "last_edit_date": 1562076297, "question_id": 56853059, "link": "https://stackoverflow.com/questions/56853059/use-of-undeclared-type-or-module-when-using-diesels-belongs-to-attribute", "title": "&quot;use of undeclared type or module&quot; when using Diesel&#39;s `belongs_to` attribute", "body": "<p>I'm loosely following Diesel's <a href=\"https://diesel.rs/guides/getting-started/\" rel=\"noreferrer\">getting started</a> guide trying to set up a relational database, but getting the following error on compile:</p>\n\n<pre><code>error[E0433]: failed to resolve: use of undeclared type or module `birds`\n --&gt; src/models.rs:9:12\n  |\n9 | pub struct Bird {\n  |            ^^^^ use of undeclared type or module `birds`\n\nerror: aborting due to previous error\n\nFor more information about this error, try `rustc --explain E0433`.\nerror: Could not compile `prrr_gql`.\n\n</code></pre>\n\n<p>Here's the binary:</p>\n\n<pre><code>extern crate prrr_gql;\nextern crate diesel;\n\nuse self::prrr_gql::*;\nuse self::models::*;\nuse self::diesel::prelude::*;\n\nfn main() {\n    use prrr_gql::schema::cats::dsl::*;\n    use prrr_gql::schema::birds::dsl::*;\n\n    let connection = establish_connection();\n    let results = cats.load::&lt;Cat&gt;(&amp;connection)\n        .expect(\"Error hearding cats\");\n\n    for cat in results {\n        println!(\"{}\", cat.name);\n    }\n}\n</code></pre>\n\n<p>and lib.rs (imported as <code>prrr_gql</code>)</p>\n\n<pre><code>#[macro_use]\nextern crate diesel;\nextern crate dotenv;\n\nuse diesel::prelude::*;\nuse diesel::pg::PgConnection;\nuse dotenv::dotenv;\nuse std::env;\n\npub mod schema;\npub mod models;\n\npub fn establish_connection() -&gt; PgConnection {\n    dotenv().ok();\n\n    let database_url = env::var(\"DATABASE_URL\")\n        .expect(\"DATABASE_URL must be set\");\n\n    PgConnection::establish(&amp;database_url)\n        .expect(&amp;format!(\"Error connecting to {}\", database_url))\n}\n</code></pre>\n\n<p>models.rs</p>\n\n<pre><code>#[derive(Queryable, Debug)]\npub struct Cat {\n    pub id: i32,\n    pub name: String,\n}\n\n#[derive(Queryable, Associations, Debug)]\n#[belongs_to(Cat)]\npub struct Bird {\n    pub id: i32,\n    pub cat_id: i32,\n    pub species: String,\n    pub colors: String\n}\n</code></pre>\n\n<p>and the schema.rs generated by Diesel</p>\n\n<pre><code>table! {\n    birds (id) {\n        id -&gt; Int4,\n        species -&gt; Varchar,\n        colors -&gt; Varchar,\n        cat_id -&gt; Nullable&lt;Int4&gt;,\n    }\n}\n\ntable! {\n    cats (id) {\n        id -&gt; Int4,\n        name -&gt; Varchar,\n    }\n}\n\njoinable!(birds -&gt; cats (cat_id));\n\nallow_tables_to_appear_in_same_query!(\n    birds,\n    cats,\n);\n</code></pre>\n\n<p>The only <a href=\"https://github.com/diesel-rs/diesel/issues/1438\" rel=\"noreferrer\">issue</a> I could find related to this says I need to have <code>birds</code> in scope and references the <code>table!</code> macro that I have provided, so I'm not sure what's missing.</p>\n\n<p>When I comment out everything related to the <code>birds</code> database, everything runs as expected.</p>\n\n<p>Full project with Cargo.toml for reference: <a href=\"https://github.com/crashspringfield/prrr_gql/tree/diesel-error\" rel=\"noreferrer\">https://github.com/crashspringfield/prrr_gql/tree/diesel-error</a></p>\n"}, {"tags": ["rust", "closures", "lifetime"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1562071019, "post_id": 56852656, "comment_id": 100255222, "body": "Have you tried <code>move |_, cr|</code> ?"}, {"owner": {"reputation": 1507, "user_id": 4296244, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/e8c0940effc84e18a8541145ef2dfbfe?s=128&d=identicon&r=PG&f=1", "display_name": "Natjo", "link": "https://stackoverflow.com/users/4296244/natjo"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1562071428, "post_id": 56852656, "comment_id": 100255505, "body": "Wouldn&#39;t <code>move</code> take over ownership of <code>width</code>? I need it later on in my main function again."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1562071600, "post_id": 56852656, "comment_id": 100255618, "body": "No, because it implements the copy trait, see <a href=\"https://doc.rust-lang.org/std/primitive.tuple.html#trait-implementations\" rel=\"nofollow noreferrer\">doc.rust-lang.org/std/&hellip;</a>"}, {"owner": {"reputation": 1507, "user_id": 4296244, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/e8c0940effc84e18a8541145ef2dfbfe?s=128&d=identicon&r=PG&f=1", "display_name": "Natjo", "link": "https://stackoverflow.com/users/4296244/natjo"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1562071882, "post_id": 56852656, "comment_id": 100255824, "body": "You are right @hellow. Thank you, I didn&#39;t know it would automatically copy the value."}], "owner": {"reputation": 1507, "user_id": 4296244, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/e8c0940effc84e18a8541145ef2dfbfe?s=128&d=identicon&r=PG&f=1", "display_name": "Natjo", "link": "https://stackoverflow.com/users/4296244/natjo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 18, "favorite_count": 0, "closed_date": 1562072369, "answer_count": 0, "score": 0, "last_activity_date": 1562070966, "creation_date": 1562070966, "question_id": 56852656, "link": "https://stackoverflow.com/questions/56852656/use-copy-of-outside-variable-inside-closure", "closed_reason": "Duplicate", "title": "Use copy of outside variable inside closure", "body": "<p>I'm trying to use Cairo with Rust and came to a problem where I can't find a good solution for:</p>\n\n<pre><code>let (width, height) = (400., 300.);\n\nlet window = gtk::ApplicationWindow::new(application);\nwindow.set_default_size(width as i32, height as i32);\n\nlet drawing_area = Box::new(DrawingArea::new)();\n\ndrawing_area.connect_draw(|_, cr| {\n    cr.scale(width, height);\n    ...\n    });\n</code></pre>\n\n<p>I assumed I could use <code>width</code> and <code>height</code> directly inside the closure since those are primitive types that are copied by default. Yet the compiler complains:</p>\n\n<pre><code>   |     drawing_area.connect_draw(|_, cr| {\n   |                               ^^^^^^^ may outlive borrowed value `width`\n</code></pre>\n\n<p>I couldn't find a good solution for this issue in the Rust documentation, what is the best way to use outside variables inside a closure?</p>\n\n<p>I can't change the signature of the closure since <code>connect_draw</code> expects exactly two input parameters.</p>\n"}, {"tags": ["rust", "actix-web", "rusoto"], "answers": [{"comments": [{"owner": {"reputation": 1019, "user_id": 684562, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/4T5zR.jpg?s=128&g=1", "display_name": "Augusto", "link": "https://stackoverflow.com/users/684562/augusto"}, "edited": false, "score": 0, "creation_date": 1562146880, "post_id": 56866791, "comment_id": 100283248, "body": "makes sense. Thanks for the answer. unfortunately the code inside the process file does not support a partial stream, so I need to call it only after the stream is fully consumed. How would I chain the futures to do so?"}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "reply_to_user": {"reputation": 1019, "user_id": 684562, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/4T5zR.jpg?s=128&g=1", "display_name": "Augusto", "link": "https://stackoverflow.com/users/684562/augusto"}, "edited": false, "score": 0, "creation_date": 1562149609, "post_id": 56866791, "comment_id": 100284762, "body": "@Augusto updated the answer you can accumulate all parts into a collection, i&#39;ve used Vector in revision. I wouldn&#39;t load whole file into memory btw."}, {"owner": {"reputation": 1019, "user_id": 684562, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/4T5zR.jpg?s=128&g=1", "display_name": "Augusto", "link": "https://stackoverflow.com/users/684562/augusto"}, "edited": false, "score": 0, "creation_date": 1562152882, "post_id": 56866791, "comment_id": 100286480, "body": "The files won&#39;t be big enough to cause an issue, but I agree with you. The problem is I&#39;m using a library (opencv) to process images and it expects the whole array of bytes as input... How would recommend doing that?"}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "reply_to_user": {"reputation": 1019, "user_id": 684562, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/4T5zR.jpg?s=128&g=1", "display_name": "Augusto", "link": "https://stackoverflow.com/users/684562/augusto"}, "edited": false, "score": 1, "creation_date": 1562153748, "post_id": 56866791, "comment_id": 100286993, "body": "@Augusto IMO, If there is no alternative api and the file is not big enough it is ok to do that."}, {"owner": {"reputation": 658, "user_id": 457116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/840a3abaf67e9fef8c58225d2e20608a?s=128&d=identicon&r=PG", "display_name": "brainstorm", "link": "https://stackoverflow.com/users/457116/brainstorm"}, "edited": false, "score": 0, "creation_date": 1579763141, "post_id": 56866791, "comment_id": 105876748, "body": "@&#214;merErden, it seems like Rusoto is very close to transition to async-await now with 0.43.0: <a href=\"https://github.com/rusoto/rusoto/pull/1664\" rel=\"nofollow noreferrer\">github.com/rusoto/rusoto/pull/1664</a> ... would you mind editing this answer? :)"}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "reply_to_user": {"reputation": 658, "user_id": 457116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/840a3abaf67e9fef8c58225d2e20608a?s=128&d=identicon&r=PG", "display_name": "brainstorm", "link": "https://stackoverflow.com/users/457116/brainstorm"}, "edited": false, "score": 0, "creation_date": 1579764994, "post_id": 56866791, "comment_id": 105877510, "body": "@brainstorm thanks for letting me know, i&#39;ll check, probably we might avoid nested closures with async await, i&#39;ll let you know when i&#39;m done ^^ ."}, {"owner": {"reputation": 658, "user_id": 457116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/840a3abaf67e9fef8c58225d2e20608a?s=128&d=identicon&r=PG", "display_name": "brainstorm", "link": "https://stackoverflow.com/users/457116/brainstorm"}, "edited": false, "score": 1, "creation_date": 1579768021, "post_id": 56866791, "comment_id": 105878751, "body": "As a matter of fact, I just cooked my own hackish example over here, perhaps you and other people find it useful: <a href=\"https://github.com/brainstorm/rusoto-s3-async-await\" rel=\"nofollow noreferrer\">github.com/brainstorm/rusoto-s3-async-await</a> ... pullrequests/cleanups welcome ;P"}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "reply_to_user": {"reputation": 658, "user_id": 457116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/840a3abaf67e9fef8c58225d2e20608a?s=128&d=identicon&r=PG", "display_name": "brainstorm", "link": "https://stackoverflow.com/users/457116/brainstorm"}, "edited": false, "score": 0, "creation_date": 1579846409, "post_id": 56866791, "comment_id": 105910382, "body": "@brainstorm to me it looks fine but i still need to make more investigation on <code>async-await</code>, so don&#39;t trust me :), upvoted your comment so future visitors can see the link easily."}, {"owner": {"reputation": 658, "user_id": 457116, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/840a3abaf67e9fef8c58225d2e20608a?s=128&d=identicon&r=PG", "display_name": "brainstorm", "link": "https://stackoverflow.com/users/457116/brainstorm"}, "edited": false, "score": 0, "creation_date": 1579856343, "post_id": 56866791, "comment_id": 105913909, "body": "Thanks! The example above does work indeed :) Unfortunately I&#39;m getting some issues applying that proof of concept into another crate by using <a href=\"https://stackoverflow.com/questions/57810173/streamed-upload-to-s3-with-rusoto/59884256#comment102487432_57812269\" title=\"streamed upload to s3 with rusoto\">stackoverflow.com/questions/57810173/&hellip;</a> ... here&#39;s the other crate if you are curious too and want to investigate on an almost-done app: <a href=\"https://github.com/brainstorm/htsget-aws\" rel=\"nofollow noreferrer\">github.com/brainstorm/htsget-aws</a>"}], "tags": [], "owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "is_accepted": true, "score": 3, "last_activity_date": 1562181787, "last_edit_date": 1562181787, "creation_date": 1562145414, "answer_id": 56866791, "question_id": 56846492, "link": "https://stackoverflow.com/questions/56846492/why-does-reading-from-a-rusoto-s3-stream-inside-an-actix-web-handler-cause-a-dea/56866791#56866791", "title": "Why does reading from a Rusoto S3 stream inside an Actix Web handler cause a deadlock?", "body": "<pre class=\"lang-rust prettyprint-override\"><code>let mut stream = res.body.unwrap().into_blocking_read();\n</code></pre>\n\n<p>Check the <a href=\"https://github.com/rusoto/rusoto/blob/0fa9217a47ef5d573eb0f28a5a497137635e31cb/rusoto/core/src/stream.rs#L121\" rel=\"nofollow noreferrer\">implementation of <code>into_blocking_read()</code></a>: it calls <code>.wait()</code>. You shouldn't call blocking code inside a <code>Future</code>. </p>\n\n<p>Since Rusoto's <code>body</code> is a <code>Stream</code>, there is a way to read it asynchronously:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>.and_then(move |res| {\n    info!(\"Response {:?}\", res);\n    let stream = res.body.unwrap();\n\n    stream.concat2().map(move |file| {\n        process_file(&amp;file[..]).unwrap()\n    })\n    .map_err(|e| RusotoError::from(e)))\n})\n</code></pre>\n\n<p><code>process_file</code> should not block the enclosing <code>Future</code>. If it needs to block, you may consider running it on new thread or encapsulate with <a href=\"https://docs.rs/tokio-threadpool/0.1.14/tokio_threadpool/fn.blocking.html\" rel=\"nofollow noreferrer\">tokio_threadpool's <code>blocking</code></a>. </p>\n\n<p><strong>Note:</strong> You can use tokio_threadpool's <code>blocking</code> in your implementation, but I recommend you understand how it works first.  </p>\n\n<hr>\n\n<p>If you are not aiming to load the whole file into memory, you can use <code>for_each</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>stream.for_each(|part| {\n    //process each part in here \n    //Warning! Do not add blocking code here either.\n})\n</code></pre>\n\n<p><strong>See also</strong>: </p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/41932137/what-is-the-best-approach-to-encapsulate-blocking-i-o-in-future-rs\">What is the best approach to encapsulate blocking I/O in future-rs?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/48735952/why-does-futureselect-choose-the-future-with-a-longer-sleep-period-first\">Why does Future::select choose the future with a longer sleep period first?</a></li>\n</ul>\n"}], "owner": {"reputation": 1019, "user_id": 684562, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/4T5zR.jpg?s=128&g=1", "display_name": "Augusto", "link": "https://stackoverflow.com/users/684562/augusto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 750, "favorite_count": 1, "accepted_answer_id": 56866791, "answer_count": 1, "score": 3, "last_activity_date": 1562181787, "creation_date": 1562048751, "last_edit_date": 1562155868, "question_id": 56846492, "link": "https://stackoverflow.com/questions/56846492/why-does-reading-from-a-rusoto-s3-stream-inside-an-actix-web-handler-cause-a-dea", "title": "Why does reading from a Rusoto S3 stream inside an Actix Web handler cause a deadlock?", "body": "<p>I'm writing an application using <code>actix_web</code> and <code>rusoto_s3</code>.</p>\n\n<p>When I run a command outside of an actix request directly from <code>main</code>, it runs fine, and the <code>get_object</code> works as expected.  When this is encapsulated inside an actix_web request, the stream is blocked forever.</p>\n\n<p>I have a client that is shared for all requests which is encapsulated into an <code>Arc</code> (this happens in actix data internals).</p>\n\n<p>Full code:</p>\n\n<pre><code>fn index(\n    _req: HttpRequest,\n    path: web::Path&lt;String&gt;,\n    s3: web::Data&lt;S3Client&gt;,\n) -&gt; impl Future&lt;Item = HttpResponse, Error = actix_web::Error&gt; {\n    s3.get_object(GetObjectRequest {\n        bucket: \"my_bucket\".to_owned(),\n        key: path.to_owned(),\n        ..Default::default()\n    })\n    .and_then(move |res| {\n        info!(\"Response {:?}\", res);\n        let mut stream = res.body.unwrap().into_blocking_read();\n        let mut body = Vec::new();\n        stream.read_to_end(&amp;mut body).unwrap();\n        match process_file(body.as_slice()) {\n            Ok(result) =&gt; Ok(result),\n            Err(error) =&gt; Err(RusotoError::from(error)),\n        }\n    })\n    .map_err(|e| match e {\n        RusotoError::Service(GetObjectError::NoSuchKey(key)) =&gt; {\n            actix_web::error::ErrorNotFound(format!(\"{} not found\", key))\n        }\n        error =&gt; {\n            error!(\"Error: {:?}\", error);\n            actix_web::error::ErrorInternalServerError(\"error\")\n        }\n    })\n    .from_err()\n    .and_then(move |img| HttpResponse::Ok().body(Body::from(img)))\n}\n\nfn health() -&gt; HttpResponse {\n    HttpResponse::Ok().finish()\n}\n\nfn main() -&gt; std::io::Result&lt;()&gt; {\n    let name = \"rust_s3_test\";\n    env::set_var(\"RUST_LOG\", \"debug\");\n    pretty_env_logger::init();\n    let sys = actix_rt::System::builder().stop_on_panic(true).build();\n    let prometheus = PrometheusMetrics::new(name, \"/metrics\");\n    let s3 = S3Client::new(Region::Custom {\n        name: \"eu-west-1\".to_owned(),\n        endpoint: \"http://localhost:9000\".to_owned(),\n    });\n    let s3_client_data = web::Data::new(s3);\n\n    Server::build()\n        .bind(name, \"0.0.0.0:8080\", move || {\n            HttpService::build().keep_alive(KeepAlive::Os).h1(App::new()\n                .register_data(s3_client_data.clone())\n                .wrap(prometheus.clone())\n                .wrap(actix_web::middleware::Logger::default())\n                .service(web::resource(\"/health\").route(web::get().to(health)))\n                .service(web::resource(\"/{file_name}\").route(web::get().to_async(index))))\n        })?\n        .start();\n    sys.run()\n}\n</code></pre>\n\n<p>In <code>stream.read_to_end</code> the thread is being blocked and never resolved. </p>\n\n<p>I have tried cloning the client per request and also creating a new client per request, but I've got the same result in all scenarios. </p>\n\n<p>Am I doing something wrong?</p>\n\n<p>It works if I don't use it async...</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>s3.get_object(GetObjectRequest {\n    bucket: \"my_bucket\".to_owned(),\n    key: path.to_owned(),\n    ..Default::default()\n})\n.sync()\n.unwrap()\n.body\n.unwrap()\n.into_blocking_read();\nlet mut body = Vec::new();\nio::copy(&amp;mut stream, &amp;mut body);\n</code></pre>\n\n<p>Is this an issue with Tokio?</p>\n"}, {"tags": ["parsing", "rust", "parser-combinators", "nom"], "answers": [{"tags": [], "owner": {"reputation": 96489, "user_id": 788207, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/KQmlY.jpg?s=128&g=1", "display_name": "Vladimir Matveev", "link": "https://stackoverflow.com/users/788207/vladimir-matveev"}, "is_accepted": false, "score": 4, "last_activity_date": 1562081421, "last_edit_date": 1562081421, "creation_date": 1562046828, "answer_id": 56846118, "question_id": 56846090, "link": "https://stackoverflow.com/questions/56846090/nom-5-creating-a-combinator-using-another-parser-multiple-times/56846118#56846118", "title": "Nom 5: creating a combinator using another parser multiple times", "body": "<p>The simplest way would be to be explicit with the returned closure:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn quoted&lt;'a, F: 'a, O, E: ParseError&lt;&amp;'a str&gt;&gt;(f: F) -&gt; impl Fn(&amp;'a str) -&gt; IResult&lt;&amp;'a str, O, E&gt;\nwhere\n    F: Fn(&amp;'a str) -&gt; IResult&lt;&amp;'a str, O, E&gt;,\n{\n    move |i| {\n        map(\n            alt((\n                tuple((tag(\"'\"), &amp;f, tag(\"'\"))),\n                tuple((tag(\"\\\"\"), &amp;f, tag(\"\\\"\")))\n            )),\n            |(_, res, _)| res,\n        )(i)\n    }\n}\n</code></pre>\n\n<p>Now, because of the <code>move</code> keyword, the <code>f</code> value is moved into the closure. Then, inside the returned closure I invoke the complex parser combinator directly, and nothing except output/error is returned from the closure, which means I'm free to use references to <code>f</code>.</p>\n"}], "owner": {"reputation": 96489, "user_id": 788207, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/KQmlY.jpg?s=128&g=1", "display_name": "Vladimir Matveev", "link": "https://stackoverflow.com/users/788207/vladimir-matveev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1562081421, "creation_date": 1562046612, "last_edit_date": 1562047561, "question_id": 56846090, "link": "https://stackoverflow.com/questions/56846090/nom-5-creating-a-combinator-using-another-parser-multiple-times", "title": "Nom 5: creating a combinator using another parser multiple times", "body": "<p>Suppose I want to create a combinator which uses another parser multiple times, for example, to parse a string delimited by two kinds of quotes:</p>\n\n<pre><code>fn quoted&lt;'a, F: 'a, O, E: ParseError&lt;&amp;'a str&gt;&gt;(f: F) -&gt; impl Fn(&amp;'a str) -&gt; IResult&lt;&amp;'a str, O, E&gt;\nwhere\n    F: Fn(&amp;'a str) -&gt; IResult&lt;&amp;'a str, O, E&gt;,\n{\n    map(\n        alt((\n            tuple((tag(\"'\"), f, tag(\"'\"))),\n            tuple((tag(\"\\\"\"), f, tag(\"\\\"\")))\n        )),\n        |(_, res, _)| res,\n    )\n}\n</code></pre>\n\n<p>This parser, as expected, fails to compile with the \"use of moved value\" error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>149 |     fn quoted&lt;'a, F: 'a, O, E: ParseError&lt;&amp;'a str&gt;&gt;(f: F) -&gt; impl Fn(&amp;'a str) -&gt; IResult&lt;&amp;'a str, O, E&gt;\n    |                   -                                 - move occurs because `f` has type `F`, which does not implement the `Copy` trait\n    |                   |\n    |                   consider adding a `Copy` constraint to this type argument\n...\n155 |                 tuple((tag(\"'\"), f, tag(\"'\"))),\n    |                                  - value moved here\n156 |                 tuple((tag(\"\\\"\"), f, tag(\"\\\"\")))\n    |                                   ^ value used here after move\n</code></pre>\n\n<p>However, I can't just add <code>Copy</code> or <code>Clone</code> to the <code>F</code> bounds: a lot of parsers, in particular, returned by Nom's builtin functions, do not implement neither <code>Clone</code> nor <code>Copy</code>. I can't also use <code>&amp;f</code> as an argument to <code>tuple</code>, because then it would be a borrow checking error (<code>f</code> is a temporary local value, so it is not possible to return a parser constructed with it).</p>\n\n<p>The only way I see doing this is actually reimplementing the <code>alt</code> logic directly in the function, by unrolling it in a sequence of nested <code>match</code> statements, but this seems really suboptimal. Or maybe I'm missing something simple, and it is actually possible to do what I want using combinators only?</p>\n\n<p>I'm pretty sure that there is a better way of writing specifically the <code>quoted</code> combinator as described above, and it would be nice if someone shows it, but my question is more general - how do I write combinators which reuse the same parser?</p>\n"}, {"tags": ["rust", "ffi", "unsafe"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 4, "last_activity_date": 1588686413, "last_edit_date": 1588686413, "creation_date": 1562037079, "answer_id": 56844818, "question_id": 56843871, "link": "https://stackoverflow.com/questions/56843871/why-does-the-second-call-to-my-ffi-function-fail-to-match-the-string-comparison/56844818#56844818", "title": "Why does the second call to my FFI function fail to match the string comparison?", "body": "<p>There's nothing particular about the use of <code>unsafe</code> here. The same thing happens with regular curly braces:</p>\n\n<pre><code>fn main() {\n    let mut bytes = [0; 4];\n    let new_bytes = b\"demo\";\n\n    for (i, &amp;c) in { bytes }.iter_mut().zip(new_bytes) {\n        *i = c;\n    }\n\n    println!(\"{:?}\", bytes);\n    // [0, 0, 0, 0]\n\n    for (i, &amp;c) in { bytes.iter_mut().zip(new_bytes) } {\n        *i = c;\n    }\n\n    println!(\"{:?}\", bytes);\n    // [100, 101, 109, 111]\n}\n</code></pre>\n\n<p>Usage of the curly braces forces a move of the variables inside the braces. Since <code>[libc::c_char; 30]</code> and <code>[u8; 4]</code> both implement <code>Copy</code>, an implicit copy is made due to move. You can take a mutable reference and move that through the curly braces:</p>\n\n<pre><code>for (i, &amp;c) in { &amp;mut bytes }.iter_mut().zip(new_bytes) {\n    *i = c;\n}\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/61605289/155423\">What&#39;s the difference between &amp;mut unsafe { } and unsafe { &amp;mut }?</a></li>\n<li><a href=\"https://stackoverflow.com/q/45968885/155423\">Is there a builtin identity function in Rust?</a></li>\n<li><a href=\"https://stackoverflow.com/q/37986640/155423\">Cannot obtain a mutable reference when iterating a recursive structure: cannot borrow as mutable more than once at a time</a></li>\n<li><a href=\"https://bluss.github.io/rust/fun/2015/10/11/stuff-the-identity-function-does/\" rel=\"nofollow noreferrer\">Stuff the Identity Function Does (in Rust)</a></li>\n</ul>\n"}], "owner": {"reputation": 2102, "user_id": 2697397, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dKRYt.png?s=128&g=1", "display_name": "alarge", "link": "https://stackoverflow.com/users/2697397/alarge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 56844818, "answer_count": 1, "score": 3, "last_activity_date": 1588686413, "creation_date": 1562026893, "last_edit_date": 1562037084, "question_id": 56843871, "link": "https://stackoverflow.com/questions/56843871/why-does-the-second-call-to-my-ffi-function-fail-to-match-the-string-comparison", "title": "Why does the second call to my FFI function fail to match the string comparison?", "body": "<p>This code shows FFI from Rust to Fortran because it's where I noticed the issue, but I'm pretty sure this is not Fortran specific and maybe even FFI-independent.</p>\n\n<p>I have src/main.rs, a rather minimal thing:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate libc;\n\nextern \"C\" {\n    static mut __wrapper_mod_MOD_a_string: [libc::c_char; 30];\n    fn __wrapper_mod_MOD_say_hi();\n}\n\nfn main() {\n    let s = String::from(\"hello\");\n    unsafe { __wrapper_mod_MOD_say_hi() };\n\n    for i in unsafe { __wrapper_mod_MOD_a_string.iter_mut() } {\n        *i = ' ' as libc::c_char;\n    }\n\n    for (i, c) in unsafe { __wrapper_mod_MOD_a_string }.iter_mut().zip(s.chars()) {\n        *i = c as libc::c_char;\n    }\n\n    unsafe { __wrapper_mod_MOD_say_hi() };\n\n    for (i, c) in unsafe { __wrapper_mod_MOD_a_string.iter_mut().zip(s.chars()) } {\n        *i = c as libc::c_char;\n    }\n\n    unsafe { __wrapper_mod_MOD_say_hi() };\n}\n</code></pre>\n\n<p>This calls into src/wrapper.f90:</p>\n\n<pre><code>module wrapper_mod\n   implicit none\n\n   private\n   public :: say_hi\n   character(30) :: a_string\n\ncontains\n\n   subroutine say_hi\n      if (trim(a_string) == 'hello') then\n         write(6,*) 'Howdy there, partner'\n      else\n         write(6,*) 'Rude of you not to greet me'\n      endif\n   end subroutine say_hi\nend module wrapper_mod\n</code></pre>\n\n<p>I get the output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code> Rude of you not to greet me\n Rude of you not to greet me\n Howdy there, partner\n</code></pre>\n\n<p><strong>Why?</strong> The only difference in the last two lines is the scoping of the <code>unsafe</code> block. I thought the unsafe action is the access over FFI, but once I have an array, it should be \"safe\" to iterate it as I please. Clearly I've misunderstood something.</p>\n\n<p>My Cargo.toml has <code>cc = \"1.0\"</code> in <code>[build-dependencies]</code> and I have the following build.rs:</p>\n\n<pre><code>extern crate cc;\n\nfn main() {\n    cc::Build::new()\n        .file(\"src/wrapper.f90\")\n        .compile(\"libwrapper.a\");\n    println!(\"cargo:rustc-link-lib=static=wrapper\");\n    println!(\"cargo:rustc-link-lib=dylib=gfortran\");\n}\n</code></pre>\n"}, {"tags": ["rust", "java-native-interface"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1562103130, "post_id": 56842604, "comment_id": 100270445, "body": "I&#39;m afraid that something more is at play here. I would strongly advise you to add more details to the question, including the definition for the <code>ToPixels</code> class, the crate version of <code>jni</code>, and the code surrounding that snippet."}], "answers": [{"comments": [{"owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "edited": false, "score": 0, "creation_date": 1562021826, "post_id": 56843145, "comment_id": 100238381, "body": "I added a <code>je.exception_check()?;</code> before and after the call to <code>call_static_method</code> and I still get the warnings.  I am pretty sure they are occurring insdie the call because I put a println! right before the call and it gets printed before the messages.  <code>exception_check()</code> by itself is not sufficient to placate the warnings."}, {"owner": {"reputation": 15619, "user_id": 1548468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0745dce203d52699e63a575b3103ad70?s=128&d=identicon&r=PG", "display_name": "Botje", "link": "https://stackoverflow.com/users/1548468/botje"}, "edited": false, "score": 0, "creation_date": 1562054532, "post_id": 56843145, "comment_id": 100246435, "body": "Looking at the implementation, <code>exception_check()</code> always returns OK(...). If it is Ok(true) an exception occurred and you need to clear it (or handle it)"}, {"owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "edited": false, "score": 0, "creation_date": 1562168298, "post_id": 56843145, "comment_id": 100295872, "body": "Using <code>if je.exception_check()? { je.exception_clear(); }</code> does not make the warnings go away either."}], "tags": [], "owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "is_accepted": false, "score": 2, "last_activity_date": 1562019662, "creation_date": 1562019662, "answer_id": 56843145, "question_id": 56842604, "link": "https://stackoverflow.com/questions/56842604/how-can-rust-code-check-for-exceptions-thrown-by-calls-to-java-code/56843145#56843145", "title": "How can Rust code check for exceptions thrown by calls to Java code?", "body": "<p>When developing under the JNI, functions that can throw exceptions need to be followed by either the <code>ExceptionCheck</code> or <code>ExceptionOccurred</code> primitives in order to handle exceptions properly. In the <code>jni</code> crate, these are translated to the methods <a href=\"https://docs.rs/jni/0.12.3/jni/struct.JNIEnv.html#method.exception_occurred\" rel=\"nofollow noreferrer\"><code>exception_occurred</code></a> and <a href=\"https://docs.rs/jni/0.12.3/jni/struct.JNIEnv.html#method.exception_check\" rel=\"nofollow noreferrer\"><code>exception_check</code></a>. The methods <code>call_static_method</code> or <code>call_method</code> do not perform exception handling themselves.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let result = je.call_static_method(cls, \"renderTo\", \"(II[B)V\", &amp;[\n    JValue::from(width),\n    JValue::from(height),\n    JValue::from(rgbs2),\n])?;\nje.exception_check()?;\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/22624014/1233251\">Which way should I check exceptions in JNI?</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "is_accepted": false, "score": 0, "last_activity_date": 1598583793, "creation_date": 1598583793, "answer_id": 63626864, "question_id": 56842604, "link": "https://stackoverflow.com/questions/56842604/how-can-rust-code-check-for-exceptions-thrown-by-calls-to-java-code/63626864#63626864", "title": "How can Rust code check for exceptions thrown by calls to Java code?", "body": "<p>Another source of similar exceptions is java's event processing loop</p>\n<pre><code>WARNING in native method: JNI call made without checking exceptions when required to from CallStaticVoidMethod\n    at sun.awt.X11.XToolkit.waitForEvents(Native Method)\n    at sun.awt.X11.XToolkit.run(XToolkit.java:574)\n    at sun.awt.X11.XToolkit.run(XToolkit.java:538)\n    at java.lang.Thread.run(Thread.java:748)\n</code></pre>\n<p>This led me to investigate the possibility of disabling java's GUI event loop.  By modifying my code to pass <code>-Djava.awt.headless=true</code> to the JVM, I was able to eliminate the stream of warnings.</p>\n<pre><code>pub fn jvm8_args_with_classpath(classpath: &amp;&amp;str) -&gt; InitArgs {\n    let jvm_args = InitArgsBuilder::new()\n        .version(JNIVersion::V8)\n        .option(&quot;-Xcheck:jni&quot;)\n        .option(&amp;format!(&quot;-Djava.class.path={}&quot;, classpath))\n        .option(&quot;-Djava.awt.headless=true&quot;)\n        .build()\n        .expect(&quot;impossible, failed to construct JVM initialization args&quot;);\n    jvm_args\n}\n</code></pre>\n"}], "owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1598583793, "creation_date": 1562016004, "last_edit_date": 1562167980, "question_id": 56842604, "link": "https://stackoverflow.com/questions/56842604/how-can-rust-code-check-for-exceptions-thrown-by-calls-to-java-code", "title": "How can Rust code check for exceptions thrown by calls to Java code?", "body": "<p>I have Rust code that invokes a Java method:</p>\n\n<pre><code>let cls = je.find_class(\"com/purplefrog/batikExperiment/ToPixels\")?;\n\nlet width = 400;\nlet height = 400;\nlet rgbs = je.new_byte_array(width*height*3)?;\nlet rgbs2:JObject = JObject::from(rgbs);\n\nlet result = je.call_static_method(cls, \"renderTo\", \"(II[B)V\", &amp;[\n    JValue::from(width),\n    JValue::from(height),\n    JValue::from(rgbs2),\n])?;\n</code></pre>\n\n<p>When I run it, I get a lot of warnings like: </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>WARNING in native method: JNI call made without checking exceptions when required to from CallVoidMethod\n    at sun.dc.pr.PathStroker.dispose(Native Method)\n    at sun.dc.DuctusRenderingEngine.createStrokedShape(DuctusRenderingEngine.java:108)\n    at java.awt.BasicStroke.createStrokedShape(BasicStroke.java:301)\n    at org.apache.batik.gvt.StrokeShapePainter.getPaintedArea(StrokeShapePainter.java:125)\n    at org.apache.batik.gvt.StrokeShapePainter.getPaintedBounds2D(StrokeShapePainter.java:134)\n    at org.apache.batik.gvt.CompositeShapePainter.getPaintedBounds2D(CompositeShapePainter.java:156)\n    at org.apache.batik.gvt.ShapeNode.getPrimitiveBounds(ShapeNode.java:238)\n    at org.apache.batik.gvt.AbstractGraphicsNode.getTransformedPrimitiveBounds(AbstractGraphicsNode.java:854)\n    at org.apache.batik.gvt.AbstractGraphicsNode.getTransformedBounds(AbstractGraphicsNode.java:820)\n    at org.apache.batik.gvt.CompositeGraphicsNode.getPrimitiveBounds(CompositeGraphicsNode.java:224)\n    at org.apache.batik.gvt.CompositeGraphicsNode.getTransformedPrimitiveBounds(CompositeGraphicsNode.java:295)\n    at org.apache.batik.gvt.AbstractGraphicsNode.getTransformedBounds(AbstractGraphicsNode.java:820)\n    at org.apache.batik.gvt.CompositeGraphicsNode.getPrimitiveBounds(CompositeGraphicsNode.java:207)\n    at org.apache.batik.gvt.AbstractGraphicsNode.getBounds(AbstractGraphicsNode.java:768)\n    at org.apache.batik.gvt.AbstractGraphicsNode.paint(AbstractGraphicsNode.java:443)\n    at com.purplefrog.batikExperiment.ToPixels.renderTo(ToPixels.java:49)\n</code></pre>\n\n<p>Since E_net4 raises the possibility this problem might be caused by factors outside my core invocation, I include more complete source code:</p>\n\n<p>main.rs:</p>\n\n<pre><code>use jni::{InitArgsBuilder, JNIVersion, JavaVM, AttachGuard, JNIEnv};\nuse jni::objects::{JValue, JObject, AutoLocal};\n\nfn main() -&gt; Result&lt;(), jni::errors::Error&gt;\n{\n    let jvm_args = InitArgsBuilder::new()\n            .version(JNIVersion::V8)\n            .option(\"-Xcheck:jni\")\n            .option(&amp;format!(\"-Djava.class.path={}\", heinous_classpath()))\n            .build()\n            .expect(\"impossible, failed to construct JVM initialization args\");\n\n    let jvm:JavaVM = JavaVM::new(jvm_args)?;\n\n    let env:AttachGuard = jvm.attach_current_thread()?;\n    let je:&amp;JNIEnv = &amp;env; // this is just so intellij's larval rust plugin can give me method name completion\n\n    let cls = je.find_class(\"com/purplefrog/batikExperiment/ToPixels\")?;\n\n    je.exception_check()?;\n\n    let width = 400;\n    let height = 400;\n    let rgbs = AutoLocal::new(&amp;je,\n                              JObject::from(je.new_byte_array(width*height*3)? ) );\n    je.exception_check()?;\n\n    println!(\"before calling renderTo()\");\n\n    let result = je.call_static_method(cls, \"renderTo\", \"(II[B)V\", &amp;[\n        JValue::from(width),\n        JValue::from(height),\n        JValue::from(rgbs.as_obj()),\n    ])?;\n    je.exception_check()?;\n\n    println!(\"{:?}\", result);\n\n    let blen = je.get_array_length(*rgbs.as_obj())? as usize;\n    je.exception_check()?;\n    let mut rgbs3:Vec&lt;i8&gt; = vec![0; blen];\n    println!(\"byte array length = {}\", blen);\n\n    je.get_byte_array_region(*rgbs.as_obj(), 0, &amp;mut rgbs3)?;\n    je.exception_check()?;\n\n    save_as_PPM(width, height, &amp;rgbs3, \"/tmp/x.ppm\").expect(\"failed to save PPM\");\n\n    return Ok(());\n}\n\npub fn save_as_PPM(width: i32, height: i32, rgbs3: &amp; Vec&lt;i8&gt;, file_name: &amp;str)-&gt; Result&lt;(),std::io::Error&gt;\n{\n    use std::fs::File;\n    use std::path::Path;\n    use std::io::Write;\n    let mut f = File::create(Path::new(file_name))?;\n    f.write_all(format!(\"P6\\n{} {} 255\\n\", width, height).as_bytes())?;\n    let tmp: &amp;[u8] = unsafe { &amp;*(rgbs3.as_slice() as *const _ as *const [u8]) };\n    f.write_all(tmp)?;\n    println!(\"wrote {}\", file_name);\n\n    Ok(())\n}\n\nfn heinous_classpath() -&gt; String\n{\n    let x = \"/home/thoth/src/batik-experiment/target/appassembler/etc\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-rasterizer/1.11/batik-rasterizer-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-svgrasterizer/1.11/batik-svgrasterizer-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-parser/1.11/batik-parser-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-awt-util/1.11/batik-awt-util-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/xmlgraphics-commons/2.3/xmlgraphics-commons-2.3.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/commons-io/commons-io/1.3.1/commons-io-1.3.1.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/commons-logging/commons-logging/1.0.4/commons-logging-1.0.4.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-xml/1.11/batik-xml-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/xml-apis/xml-apis-ext/1.3.04/xml-apis-ext-1.3.04.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-transcoder/1.11/batik-transcoder-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-anim/1.11/batik-anim-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-css/1.11/batik-css-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-ext/1.11/batik-ext-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-svg-dom/1.11/batik-svg-dom-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-bridge/1.11/batik-bridge-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-script/1.11/batik-script-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-dom/1.11/batik-dom-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/xalan/xalan/2.7.2/xalan-2.7.2.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/xalan/serializer/2.7.2/serializer-2.7.2.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/xml-apis/xml-apis/1.3.04/xml-apis-1.3.04.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-gvt/1.11/batik-gvt-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-svggen/1.11/batik-svggen-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-util/1.11/batik-util-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-constants/1.11/batik-constants-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-i18n/1.11/batik-i18n-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/org/apache/xmlgraphics/batik-codec/1.11/batik-codec-1.11.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/com/purplefrog/penrose/1.0-SNAPSHOT/penrose-1.0-SNAPSHOT.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/com/purplefrog/knotwork/1.0-SNAPSHOT/knotwork-1.0-SNAPSHOT.jar\\\n:/home/thoth/src/batik-experiment/target/appassembler/repo/com/purplefrog/batikExperiment/batikExperiment/1.0-SNAPSHOT/batikExperiment-1.0-SNAPSHOT.jar\";\n    return String::from(x);\n}\n</code></pre>\n\n<p>Cargo.toml:</p>\n\n<pre><code>[package]\nname = \"rust_call_jni\"\nversion = \"0.1.0\"\nauthors = [\"Robert Forsman &lt;git@thoth.purplefrog.com&gt;\"]\nedition = \"2018\"\n\n\n[dependencies.jni]\nversion=\"0.12.3\"\nfeatures=[\"invocation\"]\n</code></pre>\n\n<p>ToPixels.java:</p>\n\n<pre><code>package com.purplefrog.batikExperiment;\n\nimport org.apache.batik.anim.dom.*;\nimport org.apache.batik.bridge.*;\nimport org.apache.batik.gvt.*;\nimport org.apache.batik.gvt.renderer.*;\nimport org.apache.batik.util.*;\nimport org.w3c.dom.*;\n\nimport javax.imageio.*;\nimport java.awt.*;\nimport java.awt.color.*;\nimport java.awt.geom.*;\nimport java.awt.image.*;\nimport java.io.*;\nimport java.util.List;\n\npublic class ToPixels\n{\n    public static void main(String[] args)\n        throws IOException\n    {\n        Document document = ultraflower();\n\n        // create the GVT\n        GraphicsNode gn = parseSVG(document);\n\n        BufferedImage bi = renderImageTest1(gn);\n\n        ImageIO.write(bi, \"PNG\", new File(\"/tmp/x.png\"));\n    }\n\n    public static void renderTo(int width, int height, byte[] rgbPixels)\n    {\n        System.out.println(\"renderTo\");\n        try {\n            List&lt;GraphicsNode&gt; gns = sampleGN1();\n            System.out.println(\"graphics node \"+gns);\n            BufferedImage bi = rgbToWritableRaster(width, height, rgbPixels);\n            System.out.println(\"BufferedImage \"+bi);\n            Graphics2D g = bi.createGraphics();\n            System.out.println(g);\n\n            double s = width / 1920.;\n\n            g.scale(s, s);\n            g.translate(0, (height/s-1080)/2.0);\n            for (Object child : gns) {\n                ((GraphicsNode) child).paint(g);\n            }\n            System.out.println(\"painted\");\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    public static BufferedImage rgbToWritableRaster(int width, int height, byte[] rgbPixels)\n    {\n        ColorModel cm = new ComponentColorModel(ColorSpace.getInstance(ColorSpace.CS_LINEAR_RGB),\n            new int[] {8,8,8}, false, false, Transparency.OPAQUE, DataBuffer.TYPE_BYTE);\n        System.out.println(\"ColorModel \"+cm);\n        System.out.println(rgbPixels.length +\" vs \"+(width*height*3));\n        DataBuffer buffer = new DataBufferByte(rgbPixels, width*height*3);\n        System.out.println(\"databuffer \"+buffer);\n        WritableRaster wr = Raster.createWritableRaster(cm.createCompatibleSampleModel(width, height), buffer, new Point());\n        System.out.println(\"writableraster \"+wr);\n        return new BufferedImage(cm, wr, false, null);\n    }\n\n    public static class Exp2 {\n        public static void main(String[] args)\n            throws IOException\n        {\n            int width = 400;\n            int height = 600;\n            byte[] rgbs = new byte[width * height *3];\n            renderTo(width, height, rgbs);\n            String fname = \"/tmp/x.ppm\";\n            OutputStream ostr = new FileOutputStream(fname);\n            ostr.write((\"P6\\n\"+width+\" \"+height+\" 255\\n\").getBytes());\n            ostr.write(rgbs);\n            ostr.close();\n        }\n    }\n\n    public static List&lt;GraphicsNode&gt; sampleGN1()\n        throws IOException\n    {\n        GraphicsNode gn = parseSVG(ultraflower());\n        CanvasGraphicsNode canvas = (CanvasGraphicsNode) gn.getRoot().getChildren().get(0);\n        return canvas.getChildren();\n    }\n\n    public static BufferedImage renderImageTest1(GraphicsNode gn)\n    {\n        BufferedImage bi;\n        if (false) {\n            StaticRenderer sr = new StaticRenderer();\n            sr.setTree(gn);\n\n            bi = sr.getOffScreen();\n        } else {\n            bi = new BufferedImage(400,400, BufferedImage.TYPE_INT_ARGB);\n            Graphics2D g = bi.createGraphics();\n            if (false) {\n                g.scale(0.25, 0.25);\n                gn.paint(g);\n            } else {\n                RootGraphicsNode rootGN = (RootGraphicsNode) gn;\n                rootGN.getChildren();\n                CanvasGraphicsNode canvasGN = (CanvasGraphicsNode) rootGN.getChildren().get(0);\n                double s = 400 / 1920.;\n                if (false) {\n                    AffineTransform at = new AffineTransform(s, 0, 0, s, 0, 0);\n                    //canvasGN.setViewingTransform(at);\n                    canvasGN.setPositionTransform(at);\n                    canvasGN.paint(g);\n                    // this appears to clip according to the viewBox\n                } else {\n                    g.scale(s, s);\n                    g.translate(0, (1920-1080)/2.0);\n                    for (Object child : canvasGN.getChildren()) {\n                        ((GraphicsNode) child).paint(g);\n                    }\n                }\n            }\n        }\n        return bi;\n    }\n\n    public static GraphicsNode parseSVG(Document document)\n    {\n        UserAgent userAgent = new UserAgentAdapter();\n        DocumentLoader loader = new DocumentLoader(userAgent);\n        BridgeContext bctx = new BridgeContext(userAgent, loader);\n        bctx.setDynamicState(BridgeContext.STATIC);\n        GVTBuilder builder = new GVTBuilder();\n        return builder.build(bctx, document);\n    }\n\n    public static Document ultraflower()\n        throws IOException\n    {\n        String fname = \"/home/thoth/art/ultraflower/ultraflower3.svg\";\n\n        // create the document\n        String parser = XMLResourceDescriptor.getXMLParserClassName();\n        SAXSVGDocumentFactory f = new SAXSVGDocumentFactory(parser);\n        return f.createDocument(fname, new FileInputStream(fname));\n    }\n\n    public static class Madness1\n    {\n        public static void main(String[] args)\n            throws IOException\n        {\n            String resource = \"example1.svg\";\n            String parser = XMLResourceDescriptor.getXMLParserClassName();\n            SAXSVGDocumentFactory f = new SAXSVGDocumentFactory(parser);\n            Document doc = f.createDocument(resource, Madness1.class.getResourceAsStream(resource));\n\n            GraphicsNode gn = parseSVG(doc);\n\n            RootGraphicsNode rootGN = (RootGraphicsNode)gn;\n            CanvasGraphicsNode canvasGN = (CanvasGraphicsNode) rootGN.getChildren().get(0);\n\n            CompositeGraphicsNode gn1 = (CompositeGraphicsNode) canvasGN.getChildren().get(1);\n            System.out.println(gn1.getOutline());\n        }\n    }\n}\n</code></pre>\n\n<p>pom.xml:</p>\n\n<pre><code>&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\"&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;groupId&gt;com.purplefrog.batikExperiment&lt;/groupId&gt;\n    &lt;artifactId&gt;batikExperiment&lt;/artifactId&gt;\n    &lt;packaging&gt;jar&lt;/packaging&gt;\n    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n    &lt;name&gt;batikExperiment&lt;/name&gt;\n    &lt;url&gt;http://maven.apache.org&lt;/url&gt;\n\n    &lt;build&gt;\n            &lt;plugins&gt;\n                &lt;plugin&gt;\n                    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;\n                    &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;\n                    &lt;version&gt;3.5.1&lt;/version&gt;\n                    &lt;configuration&gt;\n                        &lt;source&gt;1.8&lt;/source&gt;\n                        &lt;target&gt;1.8&lt;/target&gt;\n                    &lt;/configuration&gt;\n                &lt;/plugin&gt;\n\n                &lt;plugin&gt;\n                  &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;\n                  &lt;artifactId&gt;appassembler-maven-plugin&lt;/artifactId&gt;\n                  &lt;version&gt;1.10&lt;/version&gt;\n                  &lt;configuration&gt;\n                    &lt;programs&gt;\n                      &lt;program&gt;\n                        &lt;mainClass&gt;com.purplefrog.batikExperiment.PathConverter&lt;/mainClass&gt;\n                        &lt;id&gt;pathConverter&lt;/id&gt;\n                      &lt;/program&gt;\n                    &lt;/programs&gt;\n                  &lt;/configuration&gt;\n                &lt;/plugin&gt;\n\n            &lt;/plugins&gt;\n        &lt;/build&gt;\n\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.xmlgraphics&lt;/groupId&gt;\n            &lt;artifactId&gt;batik-rasterizer&lt;/artifactId&gt;\n            &lt;version&gt;1.11&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.purplefrog&lt;/groupId&gt;\n            &lt;artifactId&gt;penrose&lt;/artifactId&gt;\n            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;junit&lt;/groupId&gt;\n            &lt;artifactId&gt;junit&lt;/artifactId&gt;\n            &lt;version&gt;3.8.1&lt;/version&gt;\n            &lt;scope&gt;test&lt;/scope&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n&lt;/project&gt;\n</code></pre>\n\n<p>How can I modify my code to check for exceptions so it will not print hundreds of these warnings?</p>\n"}, {"tags": ["opengl", "rust", "glsl", "shader", "gfx"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1562026078, "post_id": 56842153, "comment_id": 100239121, "body": "<a href=\"https://meta.stackoverflow.com/q/380194/155423\">To make Stack Overflow a useful resource for future visitors beyond of the context of your repository</a>, please <a href=\"https://stackoverflow.com/posts/56842153/edit\">edit</a> your question to add a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> in the question itself, in addition to the link to your repository."}], "answers": [{"tags": [], "owner": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "is_accepted": true, "score": 4, "last_activity_date": 1564726929, "last_edit_date": 1564726929, "creation_date": 1564334990, "answer_id": 57243375, "question_id": 56842153, "link": "https://stackoverflow.com/questions/56842153/how-to-bind-a-vertex-buffer-to-a-uniform-array-in-gfx-rs/57243375#57243375", "title": "How to bind a vertex buffer to a uniform array in Gfx-rs?", "body": "<blockquote>\n  <p>How to bind a vertex buffer to a uniform array [...]</p>\n</blockquote>\n\n<p>In OpenGL a vertex buffer cannot be <em>\"bound\"</em> to a uniform array. </p>\n\n<p>A vertex attribute can address a named vertex buffer object (stored in the state vector of the Vertex Array Object), but a uniform can't. See <a href=\"https://www.khronos.org/opengl/wiki/Vertex_Specification\" rel=\"nofollow noreferrer\">Vertex Specification</a>.</p>\n\n<p>If you want to bind some kind of buffer to some kind of uniform, then you've to use a <a href=\"https://www.khronos.org/opengl/wiki/Uniform_Buffer_Object\" rel=\"nofollow noreferrer\">Uniform Buffer Object</a> which is available since OpenGL 3.1 respectively GLSL version 1.40.</p>\n\n<p>Or you can use a <a href=\"https://www.khronos.org/opengl/wiki/Shader_Storage_Buffer_Object\" rel=\"nofollow noreferrer\">Shader Storage Buffer Object</a>, where the last element of the buffer can be an array of variable size. SSBOs are available since OpenGL 4.3 (GLSL version 4.30) respectively by the extension <a href=\"https://www.khronos.org/registry/OpenGL/extensions/ARB/ARB_shader_storage_buffer_object.txt\" rel=\"nofollow noreferrer\"><code>ARB_shader_storage_buffer_object</code></a>.</p>\n\n<p>e.g.:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>layout(std430, binding = 0) buffer MyConst\n{\n    uint my_const[];\n};\n</code></pre>\n\n<p>See also <a href=\"https://jonathansteyfkens.com/blog/rust/2018/08/19/compute-shaders.html\" rel=\"nofollow noreferrer\">Using Shader Storage Buffer Objects (SSBOs)</a></p>\n"}], "owner": {"reputation": 2988, "user_id": 36858, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e817e01f02c3dc291a0cdf2ad050b708?s=128&d=identicon&r=PG", "display_name": "Mercurious", "link": "https://stackoverflow.com/users/36858/mercurious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "accepted_answer_id": 57243375, "answer_count": 1, "score": 5, "last_activity_date": 1607245526, "creation_date": 1562013448, "last_edit_date": 1607245526, "question_id": 56842153, "link": "https://stackoverflow.com/questions/56842153/how-to-bind-a-vertex-buffer-to-a-uniform-array-in-gfx-rs", "title": "How to bind a vertex buffer to a uniform array in Gfx-rs?", "body": "<p>I am trying to pass a list of <code>Uniform</code>s to a vertex shader using gfx-rs. The data is defined as follows</p>\n\n<pre><code>gfx_defines! {\n    vertex Vertex { ... }\n\n    constant MyConst {\n        valoo: i32 = \"my_val\",\n    }\n\n    pipeline pipe {\n        my_const: gfx::ConstantBuffer&lt;MyConst&gt; = \"my_const\",\n        vbuf: gfx::VertexBuffer&lt;Vertex&gt; = (),\n        out: gfx::RenderTarget&lt;ColorFormat&gt; = \"Target0\",\n    }\n}\n</code></pre>\n\n<p>The vertex shader is as follows:</p>\n\n<pre><code>#version 150 core\n\nstruct MyConst\n{\n    uint my_val;\n};\n\nin vec2 a_Pos;\nin vec3 a_Color;\nuniform MyConst my_const[];\nout vec4 v_Color;\n\nvoid main() {\n    MyConst cc = my_const[0];\n    v_Color = vec4(a_Color, 1.0);\n    gl_Position = vec4(a_Pos, 0.0, 1.0);\n}\n</code></pre>\n\n<p>When I introduce the first line in <code>main()</code>, the application crashes with the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: DescriptorInit(GlobalConstant(\"my_const[0].my_val\", None))'\n</code></pre>\n\n<p><a href=\"https://gist.github.com/pontjho/5cf3dc02056d0691b0d963e0949edc58\" rel=\"nofollow noreferrer\">Full code</a></p>\n"}, {"tags": ["types", "rust", "alias", "associated-const"], "answers": [{"tags": [], "owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "is_accepted": true, "score": 8, "last_activity_date": 1587733208, "last_edit_date": 1587733208, "creation_date": 1562003955, "answer_id": 56840330, "question_id": 56840129, "link": "https://stackoverflow.com/questions/56840129/why-cant-a-type-alias-use-associated-constants-from-the-original-type-in-rust/56840330#56840330", "title": "Why can&#39;t a type alias use associated constants from the original type in Rust?", "body": "<p>Before Rust 1.43, constants such as <code>std::u64::MAX</code> were not associated constants of the <code>u64</code> type but constants defined in a module called <code>u64</code>. \nThis is legacy from when Rust didn't have associated constants.</p>\n\n<p>As of Rust 1.43, those constants are defined as associated constants of the corresponding types.\nThere is currently <a href=\"https://github.com/rust-lang/rfcs/blob/e3de748ae48650d7b33325b8917e929a8e08e1b9/text/0000-associated-constants-on-ints.md\" rel=\"nofollow noreferrer\">an RFC opened to deprecate the modules</a>. For now they are only <a href=\"https://github.com/rust-lang/rust/commit/97bdd31b0eab51d0a51b8746123f910cd868dff3#diff-35afb383a78a1ee775142944d5b5d126\" rel=\"nofollow noreferrer\">\"soft-deprecated\"</a> and the documentation notes:</p>\n\n<blockquote>\n  <h1>Constant std::u32::MAX</h1>\n  \n  <pre class=\"lang-rust prettyprint-override\"><code>pub const MAX: u32 = u32::max_value(); // 4_294_967_295u32\n</code></pre>\n  \n  <p>The largest value that can be represented by this integer type. <strong>Use <a href=\"https://doc.rust-lang.org/std/primitive.u32.html#associatedconstant.MAX\" rel=\"nofollow noreferrer\"><code>u32::MAX</code></a> instead.</strong></p>\n</blockquote>\n\n<p>(Emphasis is mine)</p>\n\n<p>Another way to do this is to use the associated <code>const</code> methods (eg. <code>u32::max_value</code>) which were added because constant methods were available before associated constant. Those are also soft-deprecated and the documentation notes:</p>\n\n<blockquote>\n  <pre class=\"lang-rust prettyprint-override\"><code>pub const fn max_value() -&gt; u32\n</code></pre>\n  \n  <p><strong>This method is soft-deprecated.</strong></p>\n  \n  <p>Although using it won\u2019t cause compilation warning, new code should use <a href=\"https://doc.rust-lang.org/std/primitive.u32.html#associatedconstant.MAX\" rel=\"nofollow noreferrer\"><code>u32::MAX</code></a> instead.</p>\n  \n  <p>Returns the largest value that can be represented by this integer type.</p>\n</blockquote>\n\n<p>(Emphasis is <em>not</em> mine)</p>\n\n<hr>\n\n<p>Associated constants are also accessible via type aliases as you expect:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Foo;\n\nimpl Foo {\n    const FOO: u32 = 42;\n}\n\ntype Bar = Foo;\n\nfn main() {\n    let this_works = Foo::FOO;\n    let this_also_work = Bar::FOO;\n\n    let this_works_too = u32::MAX; // As of Rust 1.43\n\n    println!(\"The answer: {} and {} or {}\", this_works, this_also_work, this_works_too);\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=61bfdd4e9e1d37e4d002730915310f34\" rel=\"nofollow noreferrer\">(Permalink to the playground)</a></p>\n"}, {"tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": false, "score": 6, "last_activity_date": 1562047138, "last_edit_date": 1562047138, "creation_date": 1562003986, "answer_id": 56840340, "question_id": 56840129, "link": "https://stackoverflow.com/questions/56840129/why-cant-a-type-alias-use-associated-constants-from-the-original-type-in-rust/56840340#56840340", "title": "Why can&#39;t a type alias use associated constants from the original type in Rust?", "body": "<p>This is because <a href=\"https://doc.rust-lang.org/std/u64/constant.MAX.html\" rel=\"nofollow noreferrer\"><code>std::u64::MAX</code></a> is a module constant, not a type constant. </p>\n\n<p>You can use <a href=\"https://doc.rust-lang.org/std/primitive.u64.html#method.max_value\" rel=\"nofollow noreferrer\"><code>max_value</code></a> if you want to use it with a type alias:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::u64;\n\ntype CardId = u64;\n\nfn main() {\n    let this_works = u64::max_value();\n    let this_does_work_as_well = CardId::max_value();\n\n    println!(\"Max amount in integer: {} and {}\", this_works, this_does_work_as_well);\n}\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 5715244, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FDxlB.jpg?s=128&g=1", "display_name": "FireFlyForLife", "link": "https://stackoverflow.com/users/5715244/fireflyforlife"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 56840330, "answer_count": 2, "score": 3, "last_activity_date": 1587733208, "creation_date": 1562002983, "last_edit_date": 1587732634, "question_id": 56840129, "link": "https://stackoverflow.com/questions/56840129/why-cant-a-type-alias-use-associated-constants-from-the-original-type-in-rust", "title": "Why can&#39;t a type alias use associated constants from the original type in Rust?", "body": "<p>Editor's note: As of Rust 1.43, this works as expected.</p>\n\n<hr>\n\n<p>I have a type alias <code>type CardId = u64;</code> and I want to initialize it to the maximum number it can have through the <code>std::u64::MAX</code> constant. And was surprised to learn that I cannot do the same from the alias.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::u64;\n\ntype CardId = u64;\n\nfn main() {\n    let this_works = u64::MAX;\n    let this_doesnt_work = CardId::MAX;\n\n    println!(\"Max amount in integer: {} and {}\", this_works, this_doesnt_work);\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=0604b7fe00921bef59d33dbcc4b246fb\" rel=\"nofollow noreferrer\">(Permalink to the playground)</a></p>\n\n<p>I was expecting the <code>MAX</code> constant to be accessible from the type alias also. This would aid me when I would change the type to u32, and this causes the code to have two points where I would need to modify instead of just location of the type alias. Why was this decision made, and did I miss something which which maybe would make this possible?</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1561965850, "post_id": 56831462, "comment_id": 100214980, "body": "Probably unit tests: <a href=\"https://doc.rust-lang.org/rust-by-example/testing/unit_testing.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/rust-by-example/testing/unit_testing.html</a>  <a href=\"https://duckduckgo.com/?q=site%3Astackoverflow.com+rust+unit+test\" rel=\"nofollow noreferrer\">duckduckgo.com/?q=site%3Astackoverflow.com+rust+unit+test</a>"}, {"owner": {"reputation": 382, "user_id": 11571396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5def31ad84a650795c0aed92cb953224?s=128&d=identicon&r=PG&f=1", "display_name": "milck", "link": "https://stackoverflow.com/users/11571396/milck"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1561966177, "post_id": 56831462, "comment_id": 100215099, "body": "I know how to test them, but I&#39;d like to have example code anyway"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1561966964, "post_id": 56831462, "comment_id": 100215402, "body": "Sorry, not possible :/ (at least as far as I know)"}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 0, "creation_date": 1561979157, "post_id": 56831462, "comment_id": 100221221, "body": "Maybe declaring your function as <code>pub(crate)</code>?"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "reply_to_user": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 0, "creation_date": 1561980725, "post_id": 56831462, "comment_id": 100221969, "body": "@rodrigo no it&#39;s not possible, because tests are running with the crate as an external crate"}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1561994322, "post_id": 56831462, "comment_id": 100228937, "body": "A good compromise could be to split your crate into two: <code>my-crate</code> and <code>my-crate-internals</code>. The functions can be public in <code>my-crate-internals</code>, but not exported from <code>my-crate</code>."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1562017625, "post_id": 56831462, "comment_id": 100237475, "body": "You can consider filing an issue on Github for this, since this seems like a common problem, but I can&#39;t think of a reasonable way of fixing this. Using unit tests as example code for internal functions seems like the most reasonable option to me."}, {"owner": {"reputation": 382, "user_id": 11571396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5def31ad84a650795c0aed92cb953224?s=128&d=identicon&r=PG&f=1", "display_name": "milck", "link": "https://stackoverflow.com/users/11571396/milck"}, "edited": false, "score": 1, "creation_date": 1562058281, "post_id": 56831462, "comment_id": 100248394, "body": "Thanks for the ideas, guess I have to rely on unchecked example code for now. I&#39;ll check the github issue tracker, thanks for this one."}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1562064495, "post_id": 56831462, "comment_id": 100251702, "body": "@SvenMarnach: GCC has <code>-fno-access-control</code> that mocks public, I guess that the rationale if for this kind of problems. Would that be doable for Rust?"}], "owner": {"reputation": 382, "user_id": 11571396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5def31ad84a650795c0aed92cb953224?s=128&d=identicon&r=PG&f=1", "display_name": "milck", "link": "https://stackoverflow.com/users/11571396/milck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1562011278, "creation_date": 1561965652, "last_edit_date": 1562011278, "question_id": 56831462, "link": "https://stackoverflow.com/questions/56831462/how-can-i-add-example-code-to-a-private-methods-documentation", "title": "How can I add example code to a private method&#39;s documentation?", "body": "<p>When documenting module internal functions, I'd like to put some example code in it:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// in private module foo\n\n/// This functions does something etc.\n/// Example:\n/// ```\n/// use mylib::foo::my_func;\n/// assert_eq!(my_func(2), 3);\n/// ```\nfn my_func(x: i32) -&gt; i32 {\n    3\n}\n</code></pre>\n\n<p>Running <code>cargo test</code> does not work because <code>foo</code> is private (and should be) so I get a lot of failing tests.</p>\n\n<p>I read about putting <code>ignore</code> tags on the code snippet, however this does not seem to be a good solution, as I'd prefer having the code checked.</p>\n\n<p>What is the proper way to handle such a situation?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 31483, "user_id": 502381, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/74b99e687909be449e0130a50950eac7?s=128&d=identicon&r=PG&f=1", "display_name": "JJJ", "link": "https://stackoverflow.com/users/502381/jjj"}, "edited": false, "score": 1, "creation_date": 1561959163, "post_id": 56830274, "comment_id": 100212951, "body": "The end result of your code is different from the code in the documentation. How would you make two variables with your struct so that variable <code>home</code> is a V4 address (but doesn&#39;t have a V6 address) and variable <code>loopback</code> is a V6 address (but doesn&#39;t have a V4 address)?"}, {"owner": {"reputation": 327, "user_id": 11180444, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PwV4h.jpg?s=128&g=1", "display_name": "Muhammad Areeb Siddiqui", "link": "https://stackoverflow.com/users/11180444/muhammad-areeb-siddiqui"}, "reply_to_user": {"reputation": 31483, "user_id": 502381, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/74b99e687909be449e0130a50950eac7?s=128&d=identicon&r=PG&f=1", "display_name": "JJJ", "link": "https://stackoverflow.com/users/502381/jjj"}, "edited": false, "score": 0, "creation_date": 1561960206, "post_id": 56830274, "comment_id": 100213223, "body": "Thankyou so much! I got it."}], "answers": [{"tags": [], "owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "is_accepted": true, "score": 1, "last_activity_date": 1561959564, "creation_date": 1561959564, "answer_id": 56830470, "question_id": 56830274, "link": "https://stackoverflow.com/questions/56830274/difference-between-struct-and-enum/56830470#56830470", "title": "Difference between struct and enum", "body": "<p>It's not the same. All enum elements have the very same size! The size of an enum element is the size of the largest variant plus the variant identifier.</p>\n\n<p>With a struct it's a bit different. If we ignore padding, the size of the struct is the sum of the sizes of its members. With padding it will be a bit more:</p>\n\n<pre><code>fn main() {\n    let size = std::mem::size_of::&lt;TheEnum&gt;();\n    println!(\"Enum: {}\", size * 8);\n\n    let size = std::mem::size_of::&lt;TheStruct&gt;();\n    println!(\"Struct: {}\", size * 8);\n}\n\nstruct TheStruct {\n    a: u64,\n    b: u8,\n    c: u64\n}\n\nenum TheEnum {\n    A(u64),\n    B(u8),\n    C(u64)\n}\n</code></pre>\n\n<p>Here we can see the difference:</p>\n\n<ul>\n<li><p>Enum: 128; 64 for the largest variant and 64 for the variant identifier.</p></li>\n<li><p>Struct: 192; aligned to 64 bits, so we have 54 bits of padding</p></li>\n</ul>\n\n<p>Another difference is in the way you use enums and structures. In an enum, you have to initialize only one of the variants. In your case - either IPv4 or IPv6. With a structure as in your example you <em>have to</em> provide both V4 and v6 address. You cannot provide only V4 or only V6. </p>\n"}], "owner": {"reputation": 327, "user_id": 11180444, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PwV4h.jpg?s=128&g=1", "display_name": "Muhammad Areeb Siddiqui", "link": "https://stackoverflow.com/users/11180444/muhammad-areeb-siddiqui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 473, "favorite_count": 0, "accepted_answer_id": 56830470, "answer_count": 1, "score": -1, "last_activity_date": 1608760542, "creation_date": 1561958043, "last_edit_date": 1608760542, "question_id": 56830274, "link": "https://stackoverflow.com/questions/56830274/difference-between-struct-and-enum", "title": "Difference between struct and enum", "body": "<p>I'm confused about <a href=\"https://doc.rust-lang.org/book/ch06-01-defining-an-enum.html\" rel=\"nofollow noreferrer\">this statement from the Rust Book</a>:</p>\n<blockquote>\n<p>There\u2019s another advantage to using an enum rather than a struct: each variant can have different types and amounts of associated data. Version four type IP addresses will always have four numeric components that will have values between 0 and 255. If we wanted to store V4 addresses as four <code>u8</code> values but still express V6 addresses as one <code>String</code> value, we <strong>wouldn\u2019t be able to with a struct</strong>. Enums handle this case with ease:</p>\n<pre><code>#![allow(unused_variables)]\nfn main() {\n    enum IpAddr {\n        V4(u8, u8, u8, u8),\n        V6(String),\n    }\n\n    let home = IpAddr::V4(127, 0, 0, 1);\n\n    let loopback = IpAddr::V6(String::from(&quot;::1&quot;));\n}\n</code></pre>\n</blockquote>\n<p>But when I tried it with <strong>structs</strong> to store V4 addresses as four <code>u8</code> values but still express V6 addresses as one <code>String</code> value its also doing the same without any errors.</p>\n<pre><code>#[derive(Debug)]\nstruct IpAddr {\n    V4:(u8, u8, u8, u8),\n    V6:String,\n}\n\nfn main () {\n    let home = IpAddr {\n        V4: (127, 1, 1, 1), \n        V6: String::from(&quot;Hello&quot;),\n    };\n    println!(&quot;{:#?}&quot;, home);      \n}\n</code></pre>\n"}, {"tags": ["file", "rust", "copy", "metadata"], "comments": [{"owner": {"reputation": 827, "user_id": 962163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6cfe6e59978b1bb04311df2d846c579?s=128&d=identicon&r=PG", "display_name": "limon", "link": "https://stackoverflow.com/users/962163/limon"}, "edited": false, "score": 0, "creation_date": 1561956394, "post_id": 56827719, "comment_id": 100212355, "body": "or copy the timestamps use <code>utimensat</code>?"}, {"owner": {"reputation": 4182, "user_id": 2992101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7363e9ce46406af3326492e2f6cf40ca?s=128&d=identicon&r=PG", "display_name": "michalsrb", "link": "https://stackoverflow.com/users/2992101/michalsrb"}, "edited": false, "score": 2, "creation_date": 1561968010, "post_id": 56827719, "comment_id": 100215814, "body": "What operating system are you testing on and which filesystem is used for the source and destination paths?"}, {"owner": {"reputation": 9495, "user_id": 1395740, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/793c4377313587d742fad6f069d92d89?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1395740/nick"}, "reply_to_user": {"reputation": 4182, "user_id": 2992101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7363e9ce46406af3326492e2f6cf40ca?s=128&d=identicon&r=PG", "display_name": "michalsrb", "link": "https://stackoverflow.com/users/2992101/michalsrb"}, "edited": false, "score": 0, "creation_date": 1561996593, "post_id": 56827719, "comment_id": 100229986, "body": "@michalsrb Linux and Windows, any filesystem that is currently supported by <code>std::fs</code>."}, {"owner": {"reputation": 4182, "user_id": 2992101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7363e9ce46406af3326492e2f6cf40ca?s=128&d=identicon&r=PG", "display_name": "michalsrb", "link": "https://stackoverflow.com/users/2992101/michalsrb"}, "edited": false, "score": 0, "creation_date": 1562005498, "post_id": 56827719, "comment_id": 100233509, "body": "@Nick Ok, but is it happening on all of them?"}, {"owner": {"reputation": 9495, "user_id": 1395740, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/793c4377313587d742fad6f069d92d89?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1395740/nick"}, "reply_to_user": {"reputation": 4182, "user_id": 2992101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7363e9ce46406af3326492e2f6cf40ca?s=128&d=identicon&r=PG", "display_name": "michalsrb", "link": "https://stackoverflow.com/users/2992101/michalsrb"}, "edited": false, "score": 0, "creation_date": 1562157279, "post_id": 56827719, "comment_id": 100289117, "body": "@michalsrb In my case I can see it happening on Linux."}, {"owner": {"reputation": 4182, "user_id": 2992101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7363e9ce46406af3326492e2f6cf40ca?s=128&d=identicon&r=PG", "display_name": "michalsrb", "link": "https://stackoverflow.com/users/2992101/michalsrb"}, "edited": false, "score": 0, "creation_date": 1562184523, "post_id": 56827719, "comment_id": 100303077, "body": "@Nick My point is that different filesystems have different precision of timestamps. For example xfs and ext3 have second precision while ext4 has milisecond precision. So copying from ext4 to ext3 would cause this, but it would not be Rust&#39;s fault."}], "answers": [{"comments": [{"owner": {"reputation": 9495, "user_id": 1395740, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/793c4377313587d742fad6f069d92d89?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1395740/nick"}, "edited": false, "score": 1, "creation_date": 1561927916, "post_id": 56827818, "comment_id": 100208443, "body": "How would you use that method to ensure that the destination file has the same modified time of the source?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 9495, "user_id": 1395740, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/793c4377313587d742fad6f069d92d89?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1395740/nick"}, "edited": false, "score": 0, "creation_date": 1561928445, "post_id": 56827818, "comment_id": 100208558, "body": "@Nick I only answer &quot;When this fails the tv_nsec field is always set to 0. Is this a bug of std::fs::copy&quot; that the problem when you ask more than one question in one question. Copy metadata doesn&#39;t interest me, you seem to have found a solution already."}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": false, "score": -3, "last_activity_date": 1561926269, "last_edit_date": 1592644375, "creation_date": 1561926269, "answer_id": 56827818, "question_id": 56827719, "link": "https://stackoverflow.com/questions/56827719/how-to-copy-file-metadata-on-linux-and-windows-from-and-to-any-filesystem-that-i/56827818#56827818", "title": "How to copy file metadata on Linux and Windows from and to any filesystem that is supported by std::fs?", "body": "<p>You must call <a href=\"https://doc.rust-lang.org/std/fs/struct.File.html#method.sync_all\" rel=\"nofollow noreferrer\"><code>sync_all()</code></a>.</p>\n<blockquote>\n<p>Attempts to sync all OS-internal metadata to disk.</p>\n<p>This function will attempt to ensure that all in-memory data reaches the filesystem before returning.</p>\n<p>This can be used to handle errors that would otherwise only be caught when the File is closed. Dropping a file will ignore errors in synchronizing this in-memory data.</p>\n</blockquote>\n"}], "owner": {"reputation": 9495, "user_id": 1395740, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/793c4377313587d742fad6f069d92d89?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1395740/nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 313, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1562025962, "creation_date": 1561925316, "last_edit_date": 1562025962, "question_id": 56827719, "link": "https://stackoverflow.com/questions/56827719/how-to-copy-file-metadata-on-linux-and-windows-from-and-to-any-filesystem-that-i", "title": "How to copy file metadata on Linux and Windows from and to any filesystem that is supported by std::fs?", "body": "<p>I need to copy a file from a given source to a given destination, not just the file content, but its metadata as well. In particular, I need to be sure that the copy will have the same modified time as the source.</p>\n\n<p>To copy a file I use the function <a href=\"https://doc.rust-lang.org/std/fs/fn.copy.html\" rel=\"nofollow noreferrer\"><code>std::fs::copy</code></a>. Its  documentation doesn't specify if the metadata is copied or not, and it fails in rare cases in copying the file metadata.</p>\n\n<p>The following code:</p>\n\n<pre><code>fs::copy(source, dest)?;\ndebug_assert_eq!(\n    fs::metadata(source)?.modified()?,\n    fs::metadata(dest)?.modified()?\n);\n</code></pre>\n\n<p>sometimes panics:</p>\n\n<pre><code>thread 'main' panicked at 'assertion failed: `(left == right)`\n  left: `SystemTime { tv_sec: 1556721917, tv_nsec: 270615000 }`,\n right: `SystemTime { tv_sec: 1556721917, tv_nsec: 0 }`',\n</code></pre>\n\n<p>When this fails the <code>tv_nsec</code> field is always set to 0.\nIs this a bug of <code>std::fs::copy</code>? How can I copy the file metadata too?</p>\n"}, {"tags": ["generics", "rust", "traits"], "answers": [{"tags": [], "owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "is_accepted": true, "score": 2, "last_activity_date": 1562025505, "last_edit_date": 1562025505, "creation_date": 1561925099, "answer_id": 56827689, "question_id": 56827586, "link": "https://stackoverflow.com/questions/56827586/how-do-i-implement-from-to-convert-one-result-type-to-another/56827689#56827689", "title": "How do I implement From to convert one Result type to another?", "body": "<p>One does not implement conversions between two <code>Result</code> types. Such a conversion is not needed for two reasons:</p>\n\n<ol>\n<li><p>It is common and idiomatic to implement conversions <em>between error types</em> instead, from a specific type to a more generic error type. If none of the two types are more generic than the other one, one can create a new type that is the sum of both (i.e. an enum where each variant contains a distinct error type). With that, converting the result is as simple as using <code>map_err</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let res: Result&lt;_, LocalErrorType&gt; = do_something();\nlet res: Result&lt;_, GenericErrorType&gt; = res.map_err(From::from);\n</code></pre></li>\n<li><p>You might not need to call <code>map_err</code> either, because the <code>?</code> operator (or the <code>try!</code> macro before 1.13) already converts the error type using a similar procedure underneath.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn do_something() -&gt; Result&lt;Foo, LocalErrorType&gt; { unimplemented!() }\n\nfn foo() -&gt; Result&lt;(), GenericErrorType&gt; {\n    let stuff = do_something()?;\n    Ok(())\n}\n</code></pre></li>\n</ol>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/22187926/whats-the-benefit-of-using-a-result\">What&#39;s the benefit of using a Result?</a></li>\n<li><a href=\"https://stackoverflow.com/q/44756215/1233251\">Is it possible to cast type `std::result::Result` to `minhook::Hook`?</a></li>\n<li><a href=\"https://stackoverflow.com/q/48430836/155423\">Rust proper error handling (auto convert from one error type to another with question mark)</a></li>\n</ul>\n"}], "owner": {"reputation": 183, "user_id": 4369045, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/554741342/picture?type=large", "display_name": "Henry Bigelow", "link": "https://stackoverflow.com/users/4369045/henry-bigelow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 56827689, "answer_count": 1, "score": 0, "last_activity_date": 1562025505, "creation_date": 1561923993, "last_edit_date": 1562025420, "question_id": 56827586, "link": "https://stackoverflow.com/questions/56827586/how-do-i-implement-from-to-convert-one-result-type-to-another", "title": "How do I implement From to convert one Result type to another?", "body": "<p>Is it possible to have a generic conversion of <code>Result&lt;T, ErrorType1&gt;</code> to <code>Result&lt;T, ErrorType2&gt;</code>, if <code>ErrorType2::From(ErrorType1)</code> is already implemented?  It seems like it should be possible.</p>\n\n<p>This is my first attempt, but it doesn't compile.</p>\n\n<pre><code>impl&lt;T&gt; From&lt;Result&lt;T, LocalErrorType&gt;&gt; for Result&lt;T, ForeignErrorType&gt; {\n    fn from&lt;T&gt;(res: Result&lt;T, LocalErrorType&gt;) -&gt; Self {\n        match sr {\n            Ok(o) =&gt; Ok(o),\n            Err(se) =&gt; Err(se.into())\n        }\n    }\n}\n</code></pre>\n\n<p>because:</p>\n\n<ul>\n<li><p><code>From</code> is a foreign trait</p></li>\n<li><p><code>Result&lt;T, LocalErrorType&gt;</code> is a foreign type, despite <code>LocalErrorType</code> being a local type</p></li>\n<li><p><code>Result&lt;T, ForeignErrorType&gt;</code> is also a foreign type</p></li>\n</ul>\n\n<p>How might I achieve this?</p>\n"}, {"tags": ["rust", "formatting"], "answers": [{"tags": [], "owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "is_accepted": false, "score": 7, "last_activity_date": 1561913140, "creation_date": 1561913140, "answer_id": 56826502, "question_id": 56826464, "link": "https://stackoverflow.com/questions/56826464/why-is-the-width-ignored-for-my-custom-formatter-implementation/56826502#56826502", "title": "Why is the width ignored for my custom formatter implementation?", "body": "<p>By using <code>write!</code> in your <code>fmt</code> implementation, you are overriding the format provided by its caller.</p>\n\n<p>Instead you should call <code>fmt</code> on the strings themselves:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl fmt::Display for TestEnum {\n    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {\n        match self {\n            TestEnum::A =&gt; \"A\".fmt(f),\n            TestEnum::B =&gt; \"B\".fmt(f),\n        }\n    }\n}\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2d867cee38bc26ae1a82d960d59dd91b\" rel=\"noreferrer\">Permalink to the playground</a>)</p>\n\n<p>This will correctly print <code>-  A-</code>.</p>\n"}], "owner": {"reputation": 281, "user_id": 5405354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a987b9748fdf6d084e4c204912d740b?s=128&d=identicon&r=PG&f=1", "display_name": "Rich", "link": "https://stackoverflow.com/users/5405354/rich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1562025020, "creation_date": 1561912684, "last_edit_date": 1562025020, "question_id": 56826464, "link": "https://stackoverflow.com/questions/56826464/why-is-the-width-ignored-for-my-custom-formatter-implementation", "title": "Why is the width ignored for my custom formatter implementation?", "body": "<p>When I have an enum with <code>Display</code> implemented and I try to print it formatted, the width I give it is ignored.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::fmt;\nenum TestEnum {\n    A,\n    B,\n}\n\nimpl fmt::Display for TestEnum {\n    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {\n        match self {\n            TestEnum::A =&gt; write!(f, \"A\"),\n            TestEnum::B =&gt; write!(f, \"B\"),\n        }\n    }\n}\n\nfn main() {\n    println!(\"-{value:&gt;width$}-\", value = TestEnum::A, width = 3);\n}\n</code></pre>\n\n<p>I expect it to output <code>-  A-</code>, but it outputs <code>-A-</code>.</p>\n\n<p>If I replace the value with the actual string instead of the enum, it does the right thing,</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>println!(\"-{value:&gt;width$}-\", value = \"A\", width = 3);\n</code></pre>\n\n<p>outputs</p>\n\n<pre><code>-  A-\n</code></pre>\n\n<p>Why is the width being ignored? What do I need to do differently?</p>\n"}, {"tags": ["rust", "serde"], "answers": [{"tags": [], "owner": {"reputation": 790, "user_id": 3018232, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fe61ad7deac14f5426932c774c2e39a9?s=128&d=identicon&r=PG", "display_name": "tehAnswer", "link": "https://stackoverflow.com/users/3018232/tehanswer"}, "is_accepted": true, "score": 1, "last_activity_date": 1561906330, "last_edit_date": 1561906330, "creation_date": 1561906178, "answer_id": 56825775, "question_id": 56825661, "link": "https://stackoverflow.com/questions/56825661/how-do-i-declare-a-struct-that-contains-any-kind-of-deserializable-serializable/56825775#56825775", "title": "How do I declare a struct that contains any kind of Deserializable/Serializable struct?", "body": "<p>I found a solution thanks to a member of the Rust Discord who referred me to the following Github <a href=\"https://github.com/serde-rs/serde/issues/964\" rel=\"nofollow noreferrer\">issue</a>. The trick is not to use trait bounds but attribute bounds.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Debug, Serialize, Deserialize)]\npub struct Foo&lt;T&gt; {\n    #[serde(bound(\n        serialize = \"T: Serialize\",\n        deserialize = \"T: Deserialize&lt;'de&gt;\",\n    ))]\n    pub data: T,\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 790, "user_id": 3018232, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fe61ad7deac14f5426932c774c2e39a9?s=128&d=identicon&r=PG", "display_name": "tehAnswer", "link": "https://stackoverflow.com/users/3018232/tehanswer"}, "edited": false, "score": 0, "creation_date": 1561906786, "post_id": 56825790, "comment_id": 100203909, "body": "Can you elaborate on your suggestion on why it&#39;s preferable to add trait bounds on methods? I&#39;ve certainly seen this before, for example with <code>Result</code> and the <code>Debug</code> trait which adds the <code>unwrap</code> method. At first glance, it seems that the code becomes less predictable to me."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 790, "user_id": 3018232, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fe61ad7deac14f5426932c774c2e39a9?s=128&d=identicon&r=PG", "display_name": "tehAnswer", "link": "https://stackoverflow.com/users/3018232/tehanswer"}, "edited": false, "score": 1, "creation_date": 1561908195, "post_id": 56825790, "comment_id": 100204242, "body": "@tehAnswer I didn\u2019t state it was preferable, just that it\u2019s an option. See a related questions on <a href=\"https://stackoverflow.com/q/49229332/155423\">struct vs impl</a> and <a href=\"https://stackoverflow.com/q/36142626/155423\">impl vs method</a> for deeper discussion."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 1, "last_activity_date": 1561906279, "creation_date": 1561906279, "answer_id": 56825790, "question_id": 56825661, "link": "https://stackoverflow.com/questions/56825661/how-do-i-declare-a-struct-that-contains-any-kind-of-deserializable-serializable/56825790#56825790", "title": "How do I declare a struct that contains any kind of Deserializable/Serializable struct?", "body": "<p>Just don't place the bounds on the type:</p>\n\n<pre><code>use serde::{Deserialize, Serialize}; // 1.0.91\n\n#[derive(Debug, Serialize, Deserialize)]\npub struct Foo&lt;T&gt; {\n    pub data: T,\n}\n\n#[derive(Debug, Serialize, Deserialize)]\npub struct Boo {\n    pub a: i64,\n}\n\nfn main() {\n    let data = Boo { a: 1 };\n    let wrap = Foo { data };\n    println!(\"{:?}\", wrap);\n}\n</code></pre>\n\n<p>Then, place the bounds on methods where you need that behavior:</p>\n\n<pre><code>fn use_it&lt;T&gt;(foo: Foo&lt;T&gt;)\nwhere\n    Foo&lt;T&gt;: Serialize,\n{\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 790, "user_id": 3018232, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fe61ad7deac14f5426932c774c2e39a9?s=128&d=identicon&r=PG", "display_name": "tehAnswer", "link": "https://stackoverflow.com/users/3018232/tehanswer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 56825775, "answer_count": 2, "score": 1, "last_activity_date": 1561906435, "creation_date": 1561905250, "last_edit_date": 1561906435, "question_id": 56825661, "link": "https://stackoverflow.com/questions/56825661/how-do-i-declare-a-struct-that-contains-any-kind-of-deserializable-serializable", "title": "How do I declare a struct that contains any kind of Deserializable/Serializable struct?", "body": "<p>I am trying to declare a struct that contains another struct of any given type that can be <code>Deserialize</code> and <code>Serialize</code>.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Debug, Serialize, Deserialize)]\npub struct Foo&lt;T: Deserialize + Serialize&gt; {\n    pub data: T,\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=8d2de8c05b2c3ba6848a4bb6c454aded\" rel=\"nofollow noreferrer\">Rust playground</a>.</p>\n\n<p>For that, I have tried to use trait bounds, using traits such as <code>DeserializeOwned</code> or <code>Deserialize</code>. Both have failed at compilation time with the following errors:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0283]: type annotations required: cannot resolve `T: serde::Deserialize&lt;'de&gt;`\n --&gt; src/main.rs:9:28\n  |\n9 | #[derive(Debug, Serialize, Deserialize)]\n  |                            ^^^^^^^^^^^\n  |\n  = note: required by `serde::Deserialize`\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0637]: `&amp;` without an explicit lifetime name cannot be used here\n  --&gt; src/main.rs:10:19\n   |\n10 | pub struct Foo&lt;T: Deserialize + Serialize&gt; {\n   |                   ^^^^^^^^^^^ explicit lifetime name needed here\n</code></pre>\n\n<p>I faced errors trying to add a lifetime since I am not using storing a reference but a value.</p>\n\n<p>What is the most idiomatic way of declaring this type of struct?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 1, "creation_date": 1561962377, "post_id": 56825201, "comment_id": 100213826, "body": "it does not compile becaue it requires <code>#[cfg(feature = &quot;invocation&quot;)]</code> but I could not find what this feature is about. Most probably it&#39;s not on the stable channel."}], "answers": [{"comments": [{"owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 1, "creation_date": 1562006251, "post_id": 56837018, "comment_id": 100233758, "body": "You&#39;ll have to set LD_LIBRARY_PATH to point to the correct location of libjvm, otherwise it will fail at runtime with a message that it cannot find it."}, {"owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "reply_to_user": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 0, "creation_date": 1562016452, "post_id": 56837018, "comment_id": 100237143, "body": "yeah, I do that in the environment of my IntelilJ run configuration."}], "tags": [], "owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "is_accepted": false, "score": 0, "last_activity_date": 1563803496, "last_edit_date": 1563803496, "creation_date": 1561989596, "answer_id": 56837018, "question_id": 56825201, "link": "https://stackoverflow.com/questions/56825201/how-can-i-import-javavm-from-the-jni-crate-without-causing-compile-errors/56837018#56837018", "title": "How can I import JavaVM from the jni crate without causing compile errors?", "body": "<p>Based on <a href=\"https://stackoverflow.com/questions/56825201/how-can-i-import-javavm-from-the-jni-crate-without-causing-compile-errors#comment100213826_56825201\">the pointer from Svetlin Zarev</a>, I was able to rummage around in the documentation and figure out the proper syntax to enable the invocation feature.</p>\n\n<p>The most important thing was a modification to Cargo.toml.  The docstring for the jni crate might benefit from including this clause for folks with less experience writing Cargo.toml:</p>\n\n<pre><code>[package]\nname = \"rust_call_jni\"\nversion = \"0.1.0\"\nauthors = [\"Robert Forsman &lt;git@thoth.purplefrog.com&gt;\"]\nedition = \"2018\"\n\n[dependencies.jni]\nversion = \"0.12.3\"\nfeatures = [\"invocation\"]\n</code></pre>\n\n<p>I had to modify main.rs to fix some errors that were masked by the earlier errors:</p>\n\n<pre><code>use jni::{InitArgsBuilder, JNIVersion, JavaVM};\n\nfn main() {\n    let jvm_args = InitArgsBuilder::new()\n        .version(JNIVersion::V8)\n        .option(\"-Xcheck:jni\")\n        //.option(&amp;format!(\"-Djava.class.path={}\", heinous_classpath()))\n        .build()\n        .unwrap_or_else(|e| //panic!(\"{}\", e.display_chain().to_string())\n        panic!(\"{:?}\", e));\n\n    let jvm = JavaVM::new(jvm_args);\n}\n</code></pre>\n\n<p>It turns out there is another Cargo.toml syntax for dependencies with multiple attributes I discovered later on:</p>\n\n<pre><code>jni = {version=\"0.12.3\", features=[\"invocation\"]}\n</code></pre>\n"}], "owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563803496, "creation_date": 1561901172, "last_edit_date": 1562011739, "question_id": 56825201, "link": "https://stackoverflow.com/questions/56825201/how-can-i-import-javavm-from-the-jni-crate-without-causing-compile-errors", "title": "How can I import JavaVM from the jni crate without causing compile errors?", "body": "<p>I am trying to emulate the test cases at <a href=\"https://github.com/jni-rs/jni-rs/blob/master/tests/jni_api.rs\" rel=\"nofollow noreferrer\">https://github.com/jni-rs/jni-rs/blob/master/tests/jni_api.rs</a> and <a href=\"https://github.com/jni-rs/jni-rs/blob/master/tests/util/mod.rs\" rel=\"nofollow noreferrer\">https://github.com/jni-rs/jni-rs/blob/master/tests/util/mod.rs</a> .  I have created a project with main.rs</p>\n\n<pre><code>use jni::{InitArgsBuilder, JNIVersion, JavaVM};\n\nfn main() {\n    let jvm_args = InitArgsBuilder::new()\n        .version(JNIVersion::V8)\n        .option(\"-Xcheck:jni\")\n        //.option(format!(\"-Djava.class.path={}\", heinous_classpath()))\n        .build()\n        .unwrap_or_else(|e| panic!(\"{}\", e.display_chain().to_string()));\n\n    let jvm = JavaVM::new(jvm_args);\n}\n</code></pre>\n\n<p>and Cargo.toml:</p>\n\n<pre><code>[package]\nname = \"rust_call_jni\"\nversion = \"0.1.0\"\nauthors = [\"Robert Forsman &lt;git@thoth.purplefrog.com&gt;\"]\nedition = \"2018\"\n\n[dependencies]\njni = \"0.12.3\"\n</code></pre>\n\n<p>When I do a <code>cargo build</code> I get the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0432]: unresolved import `jni::InitArgsBuilder`\n --&gt; src/main.rs:1:11\n  |\n1 | use jni::{InitArgsBuilder, JNIVersion, JavaVM};\n  |           ^^^^^^^^^^^^^^^ no `InitArgsBuilder` in the root\n\nerror[E0599]: no function or associated item named `new` found for type `jni::wrapper::java_vm::vm::JavaVM` in the current scope\n  --&gt; src/main.rs:12:23\n   |\n12 |     let jvm = JavaVM::new(jvm_args);\n   |               --------^^^\n   |               |\n   |               function or associated item not found in `jni::wrapper::java_vm::vm::JavaVM`\n</code></pre>\n\n<p>I'm using Rust 1.34.2.</p>\n\n<p>How can I modify my source code to properly import and invoke the constructors?</p>\n"}, {"tags": ["multithreading", "concurrency", "rust"], "comments": [{"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1561897158, "post_id": 56824029, "comment_id": 100202007, "body": "You can park the main thread to <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=cc17256e0faf9df44fbc1b9548605847\" rel=\"nofollow noreferrer\">Play</a> around"}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1561905813, "post_id": 56824078, "comment_id": 100203699, "body": "Don&#39;t sleep. <a href=\"https://doc.rust-lang.org/std/thread/struct.JoinHandle.html#method.join\" rel=\"nofollow noreferrer\"><code>join</code></a>"}], "tags": [], "owner": {"reputation": 9296, "user_id": 1446742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff5e3600cba841c184385605d1d99d03?s=128&d=identicon&r=PG", "display_name": "fjh", "link": "https://stackoverflow.com/users/1446742/fjh"}, "is_accepted": true, "score": 0, "last_activity_date": 1561890181, "creation_date": 1561890181, "answer_id": 56824078, "question_id": 56824029, "link": "https://stackoverflow.com/questions/56824029/why-dont-i-see-any-output-from-a-print-inside-of-threadspawn/56824078#56824078", "title": "Why don&#39;t I see any output from a print inside of thread::spawn?", "body": "<p>The problem is that, immediately after spawning the thread, the <code>main</code> function returns, terminating the program. Therefore, the thread never actually has time to run. You can put a <code>sleep</code> call at the end of <code>main</code> to give the spawned thread time to run.</p>\n"}], "owner": {"reputation": 703, "user_id": 5355454, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/346c1e13a63f7a7ce89bbd6e112a36c4?s=128&d=identicon&r=PG&f=1", "display_name": "Skotti Bendler", "link": "https://stackoverflow.com/users/5355454/skotti-bendler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "closed_date": 1561905842, "accepted_answer_id": 56824078, "answer_count": 1, "score": 0, "last_activity_date": 1561905787, "creation_date": 1561889741, "last_edit_date": 1561905787, "question_id": 56824029, "link": "https://stackoverflow.com/questions/56824029/why-dont-i-see-any-output-from-a-print-inside-of-threadspawn", "closed_reason": "Duplicate", "title": "Why don&#39;t I see any output from a print inside of thread::spawn?", "body": "<p>I want to print inside a closure which is passed to <code>thread::spawn</code> but I don't see any output. I tried launching this piece of code on my computer, then in Rust playground. Flushing inside the closure does not give any results. What is the problem?</p>\n\n<pre><code>use std::io::{self, Write};\nuse std::thread;\n\nfn main() {\n    println!(\"run main process\");\n    thread::spawn(|| {\n        println!(\"Hello from a thread!\");\n    });\n}\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1561883569, "post_id": 56823465, "comment_id": 100199589, "body": "but what do you want to do? We can make your code compile in a lot of way, but I doubt this will do what you want"}, {"owner": {"reputation": 13, "user_id": 11698922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cad4b57fd1f2bfa4eaa68a017aaeda72?s=128&d=identicon&r=PG&f=1", "display_name": "helix_tp", "link": "https://stackoverflow.com/users/11698922/helix-tp"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1561884014, "post_id": 56823465, "comment_id": 100199669, "body": "precisely the code does not compile due to an error, in function init"}, {"owner": {"reputation": 445, "user_id": 529049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41985cbbf7ed7cde87d48e33978ff0b1?s=128&d=identicon&r=PG", "display_name": "chargedPeptide", "link": "https://stackoverflow.com/users/529049/chargedpeptide"}, "edited": false, "score": 0, "creation_date": 1561885045, "post_id": 56823465, "comment_id": 100199871, "body": "Is the point to allow reference to human.sprite both from the human and the sprites array?"}, {"owner": {"reputation": 13, "user_id": 11698922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cad4b57fd1f2bfa4eaa68a017aaeda72?s=128&d=identicon&r=PG&f=1", "display_name": "helix_tp", "link": "https://stackoverflow.com/users/11698922/helix-tp"}, "edited": false, "score": 0, "creation_date": 1561885698, "post_id": 56823465, "comment_id": 100199969, "body": "not exactly, it is to create the data of the sprite in human and to fill the \u02cb<code>\u02cbVEC</code>\u02cb` in the \u02cb<code>\u02cbimpl</code>\u02cb` of game, there will be of other outputs to create in other struct"}], "answers": [{"comments": [{"owner": {"reputation": 445, "user_id": 529049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41985cbbf7ed7cde87d48e33978ff0b1?s=128&d=identicon&r=PG", "display_name": "chargedPeptide", "link": "https://stackoverflow.com/users/529049/chargedpeptide"}, "edited": false, "score": 0, "creation_date": 1561886848, "post_id": 56823747, "comment_id": 100200150, "body": "Note that I would probably rethink my structure here a bit instead of doing this, for example by keeping a central &quot;Vec&lt;Sprite&gt;&quot; of sprites and keeping the index of each sprite in that Vec as the reference."}, {"owner": {"reputation": 13, "user_id": 11698922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cad4b57fd1f2bfa4eaa68a017aaeda72?s=128&d=identicon&r=PG&f=1", "display_name": "helix_tp", "link": "https://stackoverflow.com/users/11698922/helix-tp"}, "edited": false, "score": 0, "creation_date": 1561888846, "post_id": 56823747, "comment_id": 100200472, "body": "Thank you, it works nickel.  Maybe I should review my way of thinking in Rust (Thinking Rust, not Thinking C ++) ;-)  I try to encapsulate my objects, it is perhaps not necessarily the right way to do in Rust."}], "tags": [], "owner": {"reputation": 445, "user_id": 529049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41985cbbf7ed7cde87d48e33978ff0b1?s=128&d=identicon&r=PG", "display_name": "chargedPeptide", "link": "https://stackoverflow.com/users/529049/chargedpeptide"}, "is_accepted": false, "score": 2, "last_activity_date": 1561886614, "creation_date": 1561886614, "answer_id": 56823747, "question_id": 56823465, "link": "https://stackoverflow.com/questions/56823465/i-need-to-push-vec-of-a-member-of-struct-contained-he-is-a-struct-as-well/56823747#56823747", "title": "i need to push (Vec) of a member of struct contained, he is a struct as well", "body": "<p>Right, so your:  </p>\n\n<pre><code>let sprite = human.sprite \n</code></pre>\n\n<p>Attempts to take ownership of the sprite field away from the human it is defined in. \nThis is prohibited in rust since it would leave a dangling reference in the struct if the original reference is destroyed, or double references if copied. Both unsafe.<br>\nUsing a borrow allows simpler code semantics but borrows are supposed to have a specific lifetime, i.e. in general not stick around since the thing you are borrowing from might outlive the borrow reference otherwise.\nThe final option that's typically used is just copying the data, but since it seems you want to track the full state of your sprites from several places that wouldn't work here. Copying data would not leave a reference to the original.</p>\n\n<p>There are ways around this in Rust.\nSo, since it seems to me you want to be able to reference the same Sprite-struct from two locations you need a lot of wrapping here.\nI\u00b4ve added reference counting to your RefCell, this Rc wrapper can then be cloned and kept as a reference to the original Struct in several places.\nThe RefCell then provides the actual read-write \"lock\" to allow the data to be mutated from several places.</p>\n\n<p>Have a look below and see if this brings you closer to your usecase:</p>\n\n<pre><code>use std::rc::Rc;\nuse std::cell::RefCell;\n\npub struct Sprite {\n    pub x: f32,\n    pub y: f32,\n}\n\nimpl Sprite {\n    pub fn new(x: f32, y: f32) -&gt; Sprite {\n        let sprite: Sprite = Sprite { x: x, y: y };\n        sprite\n    }\n}\n\npub struct Human {\n    pub x: f32,\n    pub y: f32,\n    pub sprite: Rc&lt;RefCell&lt;Sprite&gt;&gt;,\n}\n\nimpl Human {\n    pub fn new() -&gt; Human {\n\n        Human {\n            x: 400.0,\n            y: 300.0,\n            sprite: Rc::new(RefCell::new(Sprite::new(1.0, 1.0))),\n        }\n    }\n}\n\npub struct Game {\n    pub human: Human,\n    sprites: Vec&lt;Rc&lt;RefCell&lt;Sprite&gt;&gt;&gt;,\n}\n\nimpl Game {\n    pub fn new() -&gt; Game {\n        let human = Human::new();\n\n        Game {\n            human: human,\n            sprites: vec![],\n        }\n    }\n\n    pub fn init(&amp;mut self) {\n        let  sprite  = self.human.sprite.clone(); //error : can not move out of borrowed content\n        self.create_sprite(sprite);\n    }\n\n    fn create_sprite(&amp;mut self, sprite: Rc&lt;RefCell&lt;Sprite&gt;&gt;) {\n        self.sprites.push(sprite);\n    }\n}\nfn main() {}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 11698922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cad4b57fd1f2bfa4eaa68a017aaeda72?s=128&d=identicon&r=PG&f=1", "display_name": "helix_tp", "link": "https://stackoverflow.com/users/11698922/helix-tp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1561886614, "creation_date": 1561883267, "question_id": 56823465, "link": "https://stackoverflow.com/questions/56823465/i-need-to-push-vec-of-a-member-of-struct-contained-he-is-a-struct-as-well", "title": "i need to push (Vec) of a member of struct contained, he is a struct as well", "body": "<p>I am trying to add a member of a structure that is itself a structure. I have the classic mistake \"can not move out of borrowed content\".</p>\n\n<p>How can I get around the problem</p>\n\n<p>thanks in advance.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::cell::RefCell;\n\npub struct Sprite {\n    pub x: f32,\n    pub y: f32,\n}\n\nimpl Sprite {\n    pub fn new(x: f32, y: f32) -&gt; Sprite {\n        let sprite: Sprite = Sprite { x: x, y: y };\n        sprite\n    }\n}\n\npub struct Human {\n    pub x: f32,\n    pub y: f32,\n    pub sprite: Sprite,\n}\n\nimpl Human {\n    pub fn new() -&gt; Human {\n\n        Human {\n            x: 400.0,\n            y: 300.0,\n            sprite: Sprite::new(1.0, 1.0),\n        }\n    }\n}\n\npub struct Game {\n    pub human: Human,\n    sprites: Vec&lt;RefCell&lt;Sprite&gt;&gt;,\n}\n\nimpl Game {\n    pub fn new() -&gt; Game {\n        let human = Human::new();\n\n        Game {\n            human: human,\n            sprites: vec![],\n        }\n    }\n\n    pub fn init(&amp;mut self) {\n        let  sprite  = self.human.sprite; //error : can not move out of borrowed content\n        self.create_sprite(sprite);\n    }\n\n    fn create_sprite(&amp;mut self, sprite: Sprite) {\n        self.sprites.push(RefCell::new(sprite));\n    }\n}\nfn main() {}\n</code></pre>\n\n<p>I made the change proposed by RLS, which only displaced the problem.</p>\n\n<p>I also tried to change the \"lifetime\" with annotations, it did not work either, but maybe I am wrong. I do not know this feature well.</p>\n\n<p>REM : The code is purge for shows the error and compiled</p>\n"}, {"tags": ["rust", "java-native-interface"], "comments": [{"owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 3, "creation_date": 1561917843, "post_id": 56821728, "comment_id": 100206295, "body": "What have you tried ? There are a lot of crates that allow you to call java from rust. The first that appears after a google search is <a href=\"https://github.com/jni-rs/jni-rs\" rel=\"nofollow noreferrer\">github.com/jni-rs/jni-rs</a> but there are others. So what have you tried ?"}, {"owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "reply_to_user": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 0, "creation_date": 1561930239, "post_id": 56821728, "comment_id": 100208863, "body": "I have tried <a href=\"https://stackoverflow.com/questions/56825201/how-can-i-import-javavm-from-the-jni-crate-without-causing-compile-errors\" title=\"how can i import javavm from the jni crate without causing compile errors\">stackoverflow.com/questions/56825201/&hellip;</a> .  I wish I knew of the other crates, but my question about what crates exist was closed before anyone could mention them."}], "answers": [{"comments": [{"owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "edited": false, "score": 0, "creation_date": 1561994775, "post_id": 56830089, "comment_id": 100229143, "body": "This is an example of how to call java from rust that is called from java.  I am interested in calling java from a rust main().  I will edit my question to make this more clear."}], "tags": [], "owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "is_accepted": false, "score": 7, "last_activity_date": 1562012097, "last_edit_date": 1562012097, "creation_date": 1561956263, "answer_id": 56830089, "question_id": 56821728, "link": "https://stackoverflow.com/questions/56821728/how-can-i-invoke-a-java-method-from-rust-via-jni/56830089#56830089", "title": "How can I invoke a Java method from Rust via JNI?", "body": "<p>Here is a simple one-file project to demonstrate how to use the jni crate:</p>\n\n<h2>Java side</h2>\n\n<pre class=\"lang-java prettyprint-override\"><code>package org.example.mcve.standalone;\n\npublic class Mcve {\n    static {\n        System.load(\"/Users/svetlin/CLionProjects/mcve/target/debug/libmcve.dylib\");\n    }\n\n    public static void main(String[] args) throws Exception {\n        doStuffInNative();\n    }\n\n    public static native void doStuffInNative();\n\n    public static void callback() {\n        System.out.println(\"Called From JNI\");\n    }\n}\n</code></pre>\n\n<ol>\n<li><p>Load the native library on startup. I'm using <code>load</code> which requires an absolute path. Alternatively you can use <code>loadLibrary</code> which requires just the name of the library, but on the other hand requires it to be in a specific location. </p></li>\n<li><p>In order to be able to call the native method from Java, you have to find what signature to use in your library. In order to do that you have to generate a C header file. This can be done in the following way:</p></li>\n</ol>\n\n<p><code>cd src/main/java/org/example/mcve/standalone/</code></p>\n\n<p><code>javac -h Mcve.java</code></p>\n\n<p>As a result you should get a file that looks like</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>/* DO NOT EDIT THIS FILE - it is machine generated */\n#include &lt;jni.h&gt;\n/* Header for class org_example_mcve_standalone_Mcve */\n\n#ifndef _Included_org_example_mcve_standalone_Mcve\n#define _Included_org_example_mcve_standalone_Mcve\n#ifdef __cplusplus\nextern \"C\" {\n#endif\n/*\n * Class:     org_example_mcve_standalone_Mcve\n * Method:    doStuffInNative\n * Signature: ()V\n */\nJNIEXPORT void JNICALL Java_org_example_mcve_standalone_Mcve_doStuffInNative\n  (JNIEnv *, jclass);\n\n#ifdef __cplusplus\n}\n#endif\n#endif\n</code></pre>\n\n<h2>Rust side</h2>\n\n<p>Now that we know the required method signature, we can create our Rust library! First create a Cargo.toml with <code>crate_type = \"cdylib\"</code>:</p>\n\n<pre><code>[package]\nname = \"mcve\"\nversion = \"0.1.0\"\nauthors = [\"Svetlin Zarev &lt;svetlin.zarev@hidden.com&gt;\"]\nedition = \"2018\"\n\n[dependencies]\njni = \"0.12.3\"\n\n[lib]\ncrate_type = [\"cdylib\"]\n</code></pre>\n\n<p>Then add a <code>lib.rs</code> file with the following content:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use jni::objects::JClass;\nuse jni::JNIEnv;\n\n#[no_mangle]\n#[allow(non_snake_case)]\npub extern \"system\" fn Java_org_example_mcve_standalone_Mcve_doStuffInNative(\n    env: JNIEnv,\n    _class: JClass,\n) {\n    let class = env\n        .find_class(\"org/example/mcve/standalone/Mcve\")\n        .expect(\"Failed to load the target class\");\n    let result = env.call_static_method(class, \"callback\", \"()V\", &amp;[]);\n\n    result.map_err(|e| e.to_string()).unwrap();\n}\n</code></pre>\n\n<p>Note that we used the ugly method name and signature from the generated  header file. Otherwise the JVM would not be able to find our method.</p>\n\n<p>First we load the required class. In this case it's not really necessary, as we have the very same class passed as the parameter named <code>_class</code>. Then we call the desired java method using the <code>env</code> we've received as a parameter. </p>\n\n<p>The first argument is the target class. </p>\n\n<p>The second - the target method name.</p>\n\n<p>The third - describes the parameter types and return values: <code>(arguments)return-type</code>. You can find out more about that fancy syntax and arcane letters <a href=\"http://journals.ecs.soton.ac.uk/java/tutorial/native1.1/implementing/method.html\" rel=\"noreferrer\">here</a> In our case we do not have any parameters and the return type is <code>V</code> which means <code>VOID</code></p>\n\n<p>The fourth - an array that contains the actual arguments. As the method does not expect any, we pass an empty array.</p>\n\n<p>Now build the Rust library and then run the Java application. As a result you have to see in your terminal <code>Called From JNI</code></p>\n\n<h2>Calling Java from <code>main()</code> in Rust</h2>\n\n<p>First you have to spawn a JVM instance. You have to use the \"invocation\" feature on the jni crate:</p>\n\n<pre><code>[dependencies.jni]\nversion = \"0.12.3\"\nfeatures = [\"invocation\", \"default\"]\n</code></pre>\n\n<p>You may want to customize the jvm settings using <code>.option()</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    let jvm_args = InitArgsBuilder::new()\n        .version(JNIVersion::V8)\n        .option(\"-Xcheck:jni\")\n        .build()\n        .unwrap();\n\n    let jvm = JavaVM::new(jvm_args).unwrap();\n    let guard = jvm.attach_current_thread().unwrap();\n\n    let system = guard.find_class(\"java/lang/System\").unwrap();\n    let print_stream = guard.find_class(\"java/io/PrintStream\").unwrap();\n\n    let out = guard\n        .get_static_field(system, \"out\", \"Ljava/io/PrintStream;\")\n        .unwrap();\n\n    if let JValue::Object(out) = out {\n        let message = guard.new_string(\"Hello World\").unwrap();\n        guard\n            .call_method(\n                out,\n                \"println\",\n                \"(Ljava/lang/String;)V\",\n                &amp;[JValue::Object(message.into())],\n            )\n            .unwrap();\n    }\n}\n</code></pre>\n\n<p>Everything is the same, except that we now use the <code>AttachGuard</code> to call Java methods instead of the passed <code>JNIEnv</code> object.</p>\n\n<p>The tricky part here is to properly set the <code>LD_LIBRARY_PATH</code> environment variable before launching the Rust application, otherwise it will not be able to find the libjvm.so. In my case it is:</p>\n\n<p><code>export LD_LIBRARY_PATH=/usr/lib/jvm/java-1.11.0-openjdk-amd64/lib/server/</code></p>\n\n<p>but the path may be different on your system</p>\n"}, {"comments": [{"owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "edited": false, "score": 0, "creation_date": 1562078814, "post_id": 56842068, "comment_id": 100260131, "body": "One thing that might be missing from the first version of my answer is a call to <code>env.delete_local_ref(rgbs)</code>, or just wrap it in an <code>AutoLocal</code> instance which does the same thing on <code>drop()</code>."}], "tags": [], "owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "is_accepted": true, "score": 3, "last_activity_date": 1562013004, "creation_date": 1562013004, "answer_id": 56842068, "question_id": 56821728, "link": "https://stackoverflow.com/questions/56821728/how-can-i-invoke-a-java-method-from-rust-via-jni/56842068#56842068", "title": "How can I invoke a Java method from Rust via JNI?", "body": "<p>Using Svetlin Zarev's answer as a starting point I have managed to expand on it and figure out how to answer the rest of the question.  I do not consider this a definitive answer because I anticipate there are still shortcomings because all I did was bang on it with a rock until it <em>seemed</em> to work.</p>\n\n<p>The Cargo.toml is:</p>\n\n<pre><code>[package]\nname = \"rust_call_jni\"\nversion = \"0.1.0\"\nauthors = [\"Robert Forsman &lt;git@thoth.purplefrog.com&gt;\"]\nedition = \"2018\"\n\n\n[dependencies.jni]\nversion=\"0.12.3\"\nfeatures=[\"invocation\"]\n</code></pre>\n\n<p>The first part of main.rs is almost identical to Svetlin's:</p>\n\n<pre><code>use jni::{InitArgsBuilder, JNIVersion, JavaVM, AttachGuard, JNIEnv};\nuse jni::objects::{JValue, JObject};\n\nfn main() -&gt; Result&lt;(), jni::errors::Error&gt;\n{\n    let jvm_args = InitArgsBuilder::new()\n            .version(JNIVersion::V8)\n            .option(\"-Xcheck:jni\")\n            .option(&amp;format!(\"-Djava.class.path={}\", heinous_classpath()))\n            .build()\n            .unwrap_or_else(|e|\n            panic!(\"{}\", e));\n\n    let jvm:JavaVM = JavaVM::new(jvm_args)?;\n\n    let env:AttachGuard = jvm.attach_current_thread()?;\n    let je:&amp;JNIEnv = &amp;env; // this is just so intellij's larval rust plugin can give me method name completion\n\n    let cls = je.find_class(\"com/purplefrog/batikExperiment/ToPixels\").expect(\"missing class\");\n</code></pre>\n\n<p>Since I intend to call <code>static void renderToPixelsShape3(int width, int height, byte[] rgbs)</code> instead of <code>System.out.println(String)</code> the code begins to diverge:</p>\n\n<pre><code>let width = 400;\nlet height = 400;\nlet rgbs = env.new_byte_array(width*height*3)?;\nlet rgbs2:JObject = JObject::from(rgbs);\n\nlet result = je.call_static_method(cls, \"renderToPixelsShape3\", \"(II[B)V\", &amp;[\n    JValue::from(width),\n    JValue::from(height),\n    JValue::from(rgbs2),\n])?;\n\nprintln!(\"{:?}\", result);\n\nlet blen = env.get_array_length(rgbs).unwrap() as usize;\nlet mut rgbs3:Vec&lt;i8&gt; = vec![0; blen];\nprintln!(\"byte array length = {}\", blen);\n\nenv.get_byte_array_region(rgbs, 0, &amp;mut rgbs3)?;\n</code></pre>\n\n<p>I am not absolutely certain I've done the array copy correctly, but it appears to work without exploding.  A more experienced Rust/Java coder might spot some mistakes (and leave a comment).</p>\n\n<p>And to wrap up this hairball, let's write the bytes to a file so we can look at the image in GIMP:</p>\n\n<pre><code>    {\n        use std::fs::File;\n        use std::path::Path;\n        use std::io::Write;\n        let mut f = File::create(Path::new(\"/tmp/x.ppm\")).expect(\"why can't I create the image file?\");\n        f.write_all(format!(\"P6\\n{} {} 255\\n\", width, height).as_bytes()).expect(\"failed to write image header\");\n        let tmp:&amp;[u8] =unsafe { &amp;*(rgbs3.as_slice() as *const _ as *const [u8])};\n        f.write_all( tmp).expect(\"failed to write image payload\");\n        println!(\"wrote /tmp/x.ppm\");\n    }\n\n    return Ok(());\n}\n</code></pre>\n\n<p>Please tell me there's a better way to write a <code>Vec&lt;i8&gt;</code> to a file (because while that is the solution that shows up in google search results it makes me sad to resort to an <code>unsafe</code> block).  </p>\n\n<p>I am omitting the definition of <code>heinous_classpath()</code> because that is just a list of about 30 jars for the classpath.  I'd like to know a maven command line to compute those for me without doing an appassemble and copying them out of the shell script but that is a different google search.</p>\n\n<p>I will reiterate that I expect this code can be improved upon by someone who has been studying rust for more than 3 weeks.</p>\n"}, {"comments": [{"owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "edited": false, "score": 0, "creation_date": 1601820319, "post_id": 64098718, "comment_id": 113518200, "body": "That seems good for an array of 3, but you&#39;ll notice I&#39;m creating an array of <code>400*400*3</code>."}, {"owner": {"reputation": 53, "user_id": 10585503, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c8ebf36ac6bf3a9edf98c4c249e8ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Aska", "link": "https://stackoverflow.com/users/10585503/aska"}, "reply_to_user": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "edited": false, "score": 1, "creation_date": 1601880580, "post_id": 64098718, "comment_id": 113531841, "body": "This was just an example. Edited to create a 400 * 400 * 3 array."}], "tags": [], "owner": {"reputation": 53, "user_id": 10585503, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c8ebf36ac6bf3a9edf98c4c249e8ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Aska", "link": "https://stackoverflow.com/users/10585503/aska"}, "is_accepted": false, "score": 2, "last_activity_date": 1601880485, "last_edit_date": 1601880485, "creation_date": 1601282411, "answer_id": 64098718, "question_id": 56821728, "link": "https://stackoverflow.com/questions/56821728/how-can-i-invoke-a-java-method-from-rust-via-jni/64098718#64098718", "title": "How can I invoke a Java method from Rust via JNI?", "body": "<p>Alternatively, You could use <a href=\"https://crates.io/crates/j4rs\" rel=\"nofollow noreferrer\">j4rs</a>.</p>\n<p>The somehow &quot;complicated&quot; stuff is the creation of the Java byte array. Otherwise, everything else is pretty straightforward:</p>\n<p>In Cargo.toml:</p>\n<p><code>j4rs = &quot;0.12.0&quot;</code></p>\n<p>Your Rust main:</p>\n<pre><code>use std::convert::TryFrom;\nuse j4rs::{Instance, InvocationArg, Jvm, JvmBuilder};\n\nfn main() -&gt; Result&lt;(), J4RsError&gt; {\n    // Create a Jvm\n    let jvm = JvmBuilder::new().build()?;\n    // Create the values for the byte array\n    let rgbs: Vec&lt;InvocationArg&gt; = [0i8; 400 * 400 * 3]\n       .iter()\n       .map(|r| InvocationArg::try_from(r).unwrap()\n                .into_primitive().unwrap())\n       .collect();\n\n    // Create a Java array from the above values\n    let byte_arr = jvm.create_java_array(&quot;byte&quot;, &amp;rgbs)?;\n    // Invoke the static method\n    jvm.invoke_static(\n        &quot;com.purplefrog.batikExperiment.ToPixels&quot;,\n        &quot;renderToPixelsShape3&quot;,\n        &amp;[\n            InvocationArg::try_from(33_i32)?.into_primitive()?,\n            InvocationArg::try_from(333_i32)?.into_primitive()?,\n            InvocationArg::try_from(byte_arr)?\n        ])?;\n\n    Ok(())\n}\n\n</code></pre>\n"}], "owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2268, "favorite_count": 4, "accepted_answer_id": 56842068, "answer_count": 3, "score": 3, "last_activity_date": 1601880485, "creation_date": 1561855509, "last_edit_date": 1562012120, "question_id": 56821728, "link": "https://stackoverflow.com/questions/56821728/how-can-i-invoke-a-java-method-from-rust-via-jni", "title": "How can I invoke a Java method from Rust via JNI?", "body": "<p>I have a Java library with a class <code>com.purplefrog.batikExperiment.ToPixels</code> which has a method <code>static void renderToPixelsShape3(int width, int height, byte[] rgbs)</code>. What Rust code is needed to invoke the Java method and access the freshly-populated <code>rgbs</code> array? </p>\n\n<p>I intend to call <code>ToPixels.renderToPixelsShape3</code> from a Rust <code>main()</code> function, so the Rust code will have to construct the JNI environment.</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 6, "last_activity_date": 1561840888, "creation_date": 1561840888, "answer_id": 56820753, "question_id": 56820295, "link": "https://stackoverflow.com/questions/56820295/does-rust-formally-distinguish-constructs-that-trade-compile-time-checks-for-run/56820753#56820753", "title": "Does Rust formally distinguish constructs that trade compile-time checks for runtime checks?", "body": "<p>No, there is no formal distinction.</p>\n\n<p>I believe you are asking if there is an <a href=\"https://en.wikipedia.org/wiki/Effect_system\" rel=\"noreferrer\"><em>effect system</em></a>. While this has been talked about by compiler developers for a while, there is no consensus about if it would truly be beneficial or detrimental in the long run.</p>\n\n<blockquote>\n  <p>\"getting around\" Rust's restrictions</p>\n</blockquote>\n\n<p>These \"get around\" nothing. The methods themselves ensure the requirements are upheld.</p>\n\n<blockquote>\n  <p>shifted from the compiler to the programmer</p>\n</blockquote>\n\n<p>I disagree with this assessment. Responsibility has been shifted from <strong>compile</strong> time to <strong>run</strong> time, but the compiler and the library code still ensures that safety is upheld. </p>\n\n<blockquote>\n  <p>using <code>unsafe</code></p>\n</blockquote>\n\n<p>Unsafe code truly moves the responsibility to the programmer. However, then that programmer builds safe abstractions that other programmers can make use of. Ideally, they build the abstractions using tools that are checked at compile time, helping to reduce runtime errors.</p>\n\n<blockquote>\n  <p>Rust's branding as a fully-safe language</p>\n</blockquote>\n\n\n\n<blockquote>\n  <p>responsibility for specific aspects of correctness </p>\n</blockquote>\n\n<p>Yes, Rust intends to be a <strong>memory-safe</strong> language, which does not mean that code written in Rust is correct. The branding emphasizes memory safety; other people assume that means things like \"cannot crash\", but we cannot prevent all mistaken interpretations.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/56107324/155423\">Why does Rust consider it safe to leak memory?</a></li>\n</ul>\n"}], "owner": {"reputation": 727, "user_id": 11392896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/240a1abd4a401577fa990ad0b7aecb51?s=128&d=identicon&r=PG&f=1", "display_name": "brundolf", "link": "https://stackoverflow.com/users/11392896/brundolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 56820753, "answer_count": 1, "score": 4, "last_activity_date": 1561840888, "creation_date": 1561836308, "last_edit_date": 1561840440, "question_id": 56820295, "link": "https://stackoverflow.com/questions/56820295/does-rust-formally-distinguish-constructs-that-trade-compile-time-checks-for-run", "title": "Does Rust formally distinguish constructs that trade compile-time checks for runtime checks?", "body": "<p>There are a number of tricks I've learned about for \"getting around\" Rust's restrictions without using <code>unsafe</code>. For example:</p>\n\n<ul>\n<li><code>Option::unwrap</code></li>\n<li><code>RefCell</code></li>\n</ul>\n\n<p>There are probably others I'm forgetting.</p>\n\n<p>In cases like these, responsibility for specific aspects of correctness is shifted from the compiler to the programmer. Things that would have been compilation errors become panics, and the programmer is expected to just \"know that their logic is right\".</p>\n\n<p>Panics are better than memory corruption, but given Rust's branding as a fully-safe language, I would think these \"trap-doors\" would be formally identified somehow - in the type system, documentation, or otherwise - for easy identification. The programmer should know when they're using a shortcut and taking on added responsibility.</p>\n\n<p>Does this kind of distinction exist? Even just an explicit list somewhere in the documentation? Is my mental model wrong, making such a thing unnecessary?</p>\n"}, {"tags": ["rust", "swap"], "comments": [{"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 1, "creation_date": 1561828295, "post_id": 56819121, "comment_id": 100191852, "body": "&quot;<i>which in turn roughly leads to (for a typical move constructor implementation) <code>3 (n+1) sizeof(T)</code> word assignments</i>&quot; Why? Can you show an example?"}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "reply_to_user": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1561828486, "post_id": 56819121, "comment_id": 100191900, "body": "@Acorn A typical move constructor invokes swap on every member field. For PODs, like <code>int</code>, the swap takes only 3 assignments like so: <code>int t = other.val; other.val = val; val = t;</code>"}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "reply_to_user": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1561829073, "post_id": 56819121, "comment_id": 100192024, "body": "@Acorn My above comment explains the factor 3. For the factor (n+1) consider the example I gave with variables a, b, c. This has 3 variables and 4 assignments (moves). This generalizes to n variables and n+1 moves."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1561831680, "post_id": 56819121, "comment_id": 100192555, "body": "I don&#39;t understand what you asking"}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1561832605, "post_id": 56819121, "comment_id": 100192757, "body": "@Stargateur The special case of rotation with 2 variables is called <code>swap</code>. I am asking for the general case with <code>n</code>  variables. Again, please take a look at the question."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 2, "creation_date": 1561835983, "post_id": 56819121, "comment_id": 100193457, "body": "I&#39;m not sure why you say <code>rotate</code> can&#39;t be implemented as efficiently in C++ -- surely you can just use <code>memcpy</code> to avoid calling any move constructors? Sure, it&#39;s not always valid to do so, but it&#39;s exactly what you&#39;re doing with <code>copy_nonoverlapping</code> in Rust. Don&#39;t get me wrong, the Rust version is <i>better</i> since it can&#39;t be misused to cause UB, but it should be simple to make an equally <i>efficient</i> version in C++."}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561836166, "post_id": 56819121, "comment_id": 100193496, "body": "@trentcl In C++ you can use <code>memcpy</code> when the type satisfies certain constraints (that&#39;s what I&#39;m referring to when I said rotate can be template specialized to PODs for extra efficiency). But for the toy <code>String</code> class I gave, C++ will incur a factor of 3 inefficiency. In Rust <i>every</i> type is byte swappable, so the rotate implementation I wrote using <code>copy_nonoverlapping</code> is valid for <i>every</i> type."}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561837253, "post_id": 56819121, "comment_id": 100193726, "body": "@trentcl The core of this issue stems from the fact that C++ structs are allowed to contain pointers to themselves whereas in Rust this is invalid. Due to this, in C++ you cannot safely swap things without invoking their move constructor (3 times)."}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 1, "creation_date": 1561837340, "post_id": 56819121, "comment_id": 100193743, "body": "@boinkboink First of all, I think you mean move assignment for <code>rotate</code>, not move constructor. Second, using <code>std::swap</code> is just a simple way to implement move assignment, but <a href=\"http://scottmeyers.blogspot.com/2014/06/the-drawbacks-of-implementing-move.html\" rel=\"nofollow noreferrer\">it is not efficient</a>. Finally, the fact that some C++ types have restrictions does not mean it cannot be optimized for <code>TriviallyCopyable</code> types. In other words, it is not a valid comparison."}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "reply_to_user": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1561837563, "post_id": 56819121, "comment_id": 100193794, "body": "@Acorn The temporary <i>is</i> move constructed. The other two operations (out of 3) are move assign, you are correct in that. How do you implement a <code>rotate</code> in C++with (n+1) operations that works for every type. I don&#39;t think this is possible."}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 1, "creation_date": 1561837769, "post_id": 56819121, "comment_id": 100193832, "body": "@boinkboink Sure, it <i>may</i> be (not necessarily, though; e.g. you could create the temporary first if possible and then move assign to it), but the core operations are <i>required</i> to be move assignment. Again, you can do it in C++ for every type where it is allowed. You cannot argue that &quot;C++ is inefficient&quot; because some types are made non-trivially copyable (something done on purpose)."}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1561838777, "post_id": 56819121, "comment_id": 100194027, "body": "By the way, claiming that <code>copy_nonoverlapping</code> is valid for every type in Rust is a bit misleading. It is the same as claiming that in C++ you can call <code>memcpy</code> for any valid pointer. It is true, yet that is not the whole story: both of them are <code>unsafe</code> calls, and in both C++ or Rust the call to <code>rotate</code> is restricted in some way (i.e. not valid/correct in all situations and/or for all values)."}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "reply_to_user": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1561839047, "post_id": 56819121, "comment_id": 100194055, "body": "@Acorn I disagree with this. In c++ you can do <code>struct A { char a; char *p; A() : p(&amp;a) {} }; </code>. Can you do this in Rust?"}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1561843096, "post_id": 56819121, "comment_id": 100194881, "body": "@boinkboink That class can be trivially copied, so it does not apply to this problem. Again, the fact that C++ allows to create types that shouldn&#39;t be copied byte-by-byte (typically because they manage a resource of some kind) does not put any restrictions on creating types that can be. For such types, the implementation goes down to the (n+1) assignments that you mention. For those that aren&#39;t, it depends on what they do, so you cannot say it takes 3 (n+1). If you really want, you can code all your program using such types -- but it is not usually done like that in C++."}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "reply_to_user": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1561843243, "post_id": 56819121, "comment_id": 100194908, "body": "@Acorn This is an example of a class that <i>cannot</i> be memcopied. I think you are missing something here."}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1561843341, "post_id": 56819121, "comment_id": 100194921, "body": "@boinkboink Nope. That class <i>can</i> be <code>memcpy</code>&#39;d."}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "reply_to_user": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1561843496, "post_id": 56819121, "comment_id": 100194945, "body": "@Acorn What happens if it has a method printA() { printf(&quot;%c&quot;, *p); }. I think understanding this will clear the misunderstanding going on between us."}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1561843539, "post_id": 56819121, "comment_id": 100194952, "body": "@boinkboink It will print the character where <code>p</code> points. The fact that the pointer may or may not point to the <code>c</code> of the same object does not mean the class is not <code>memcpy</code>able."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561843864, "post_id": 56819121, "comment_id": 100194999, "body": "<a href=\"http://coliru.stacked-crooked.com/a/878cda40e605eece\" rel=\"nofollow noreferrer\">Proof of concept</a>: although the compiler issues warnings about the <code>memcpy</code>s, it&#39;s exactly as safe and does the same thing as the Rust version for equivalent types. The fact that Rust forbids calling <code>rotate</code> with certain arguments is a <i>limitation</i> of Rust that C++ doesn&#39;t have."}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561844037, "post_id": 56819121, "comment_id": 100195019, "body": "@trentcl It&#39;s so hard being new here. As I alluded to earlier, structs having pointers to themselves are the only structs in c++ that cannot be bitwise swappable. String class I mentioned above is <i>not</i> such a class. But the compiler cannot know whether data2 is pointing to inside String or not so has to be defensive."}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "edited": false, "score": 0, "creation_date": 1561844180, "post_id": 56819121, "comment_id": 100195039, "body": "As opposed to Rust, where everything is bit swappable by design"}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "edited": false, "score": 0, "creation_date": 1561844874, "post_id": 56819121, "comment_id": 100195130, "body": "My claim was &#39;How do you implement a rotate in C++with (n+1) operations that works for every type. I don&#39;t think this is possible.&#39; You can do this for particular structs, just not generically."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561846083, "post_id": 56819121, "comment_id": 100195262, "body": "In the question, it sounds like you&#39;re saying Rust <i>allows</i> something that C++ <i>forbids</i>, which is why you can write <code>rotate</code> this way. In fact, you can write <code>rotate</code> the same way in both languages, but Rust will <i>forbid</i> using it inappropriately, while C++ will <i>allow</i> you to shoot yourself in the foot. That&#39;s the only point I am trying to make."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561846162, "post_id": 56819121, "comment_id": 100195270, "body": "(And, of course, if you really want to, you can still shoot yourself in the foot with Rust -- it just takes slightly more effort.)"}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "reply_to_user": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1561849373, "post_id": 56819121, "comment_id": 100195624, "body": "@Acorn Everything is memcopiable if you don&#39;t require it to function correctly afterwards. You can memcopy things setting member variables with <code>new</code>."}, {"owner": {"reputation": 21663, "user_id": 9305398, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqJvE.png?s=128&g=1", "display_name": "Acorn", "link": "https://stackoverflow.com/users/9305398/acorn"}, "edited": false, "score": 0, "creation_date": 1561886248, "post_id": 56819121, "comment_id": 100200058, "body": "@boinkboink The class you provided does function correctly afterwards. If <i>you</i> want to create a class with an invariant that <code>p</code> remains pointing to the <code>c</code> member, then C++ allows you to provide custom copy/move operations. That is what makes it non-<code>memcpy</code>able."}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "edited": false, "score": 0, "creation_date": 1561839945, "post_id": 56820637, "comment_id": 100194244, "body": "This you can do in any language. What rust allows for is the elimination of the 3 fold inefficiency in this method. Doing it this way uses <code>3(n-1) * size_of(T)</code> word assignments."}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1561847870, "post_id": 56820637, "comment_id": 100195462, "body": "@Stargateur Thank you! I&#39;m pleasantly surprised you called it <code>rotate</code> since you mentioned earlier nobody would call it rotate. Also it turns out something similar is rotate_left/right in rust standard library, so this is not a rust terminology diversion."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1561858502, "post_id": 56820637, "comment_id": 100196528, "body": "@Stargateur OP&#39;s original code uses generics. The version you have there does not work for any generic type, but only for those that implement <code>Copy</code>, a rather small set of all types. Perhaps that&#39;s what the OP means by &quot;bitwise swappable&quot;?"}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "edited": false, "score": 0, "creation_date": 1561859180, "post_id": 56820637, "comment_id": 100196589, "body": "@Shepmaster Yes that code requires Copy trait. Furthermore, in both your alternative solution and this solution, manual swapping <i>seems</i> efficient but you demonstrate this just for small primitive types like i32. What&#39;s more interesting is what happens when the type is a huge struct."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 5, "last_activity_date": 1561841448, "last_edit_date": 1561841448, "creation_date": 1561839806, "answer_id": 56820637, "question_id": 56819121, "link": "https://stackoverflow.com/questions/56819121/is-there-a-standard-way-of-cyclically-rotating-mutable-variables-in-rust/56820637#56820637", "title": "Is there a standard way of cyclically rotating mutable variables in Rust?", "body": "<blockquote>\n  <p>Is there a standard way of cyclically rotating mutable variables in Rust?</p>\n</blockquote>\n\n<p>No.</p>\n\n<p>I'd just swap the variables twice, no need for <code>unsafe</code>:</p>\n\n<pre><code>use std::mem;\n\npub fn rotate&lt;T&gt;(x: &amp;mut T, y: &amp;mut T, z: &amp;mut T) {\n    mem::swap(x, y);\n    mem::swap(y, z);\n}\n\nfn main() {\n    let mut a = 1;\n    let mut b = 2;\n    let mut c = 3;\n\n    println!(\"{}, {}, {}\", a, b, c);\n    // 1, 2, 3\n\n    rotate(&amp;mut a, &amp;mut b, &amp;mut c);\n\n    println!(\"{}, {}, {}\", a, b, c);\n    // 2, 3, 1\n}\n</code></pre>\n\n<hr>\n\n<p>This produces 7 <code>movl</code> instructions (Rust 1.35.0, Release, x86_64, Linux)</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>playground::rotate:\n    movl    (%rdi), %eax\n    movl    (%rsi), %ecx\n    movl    %ecx, (%rdi)\n    movl    %eax, (%rsi)\n    movl    (%rdx), %ecx\n    movl    %ecx, (%rsi)\n    movl    %eax, (%rdx)\n    retq\n</code></pre>\n\n<p>As opposed to the original 6 <code>movl</code> instructions:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>playground::rotate_original:\n    movl    (%rdx), %eax\n    movl    (%rsi), %ecx\n    movl    %ecx, (%rdx)\n    movl    (%rdi), %ecx\n    movl    %ecx, (%rsi)\n    movl    %eax, (%rdi)\n    retq\n</code></pre>\n\n<p>I'm OK giving up that single instruction for purely safe code that is also easier to reason about.</p>\n\n<hr>\n\n<p>In \"real\" code, I'd make use of the fact that all the variables are the same type and that <a href=\"https://doc.rust-lang.org/std/primitive.slice.html#method.rotate_left\" rel=\"nofollow noreferrer\"><code>slice::rotate_left</code></a> and <a href=\"https://doc.rust-lang.org/std/primitive.slice.html#method.rotate_right\" rel=\"nofollow noreferrer\"><code>slice::rotate_right</code></a> exist:</p>\n\n<pre><code>fn main() {\n    let mut vals = [1, 2, 3];\n\n    let [a, b, c] = &amp;vals;\n    println!(\"{}, {}, {}\", a, b, c);\n    // 1, 2, 3\n\n    vals.rotate_left(1);\n\n    let [a, b, c] = &amp;vals;\n    println!(\"{}, {}, {}\", a, b, c);\n    // 2, 3, 1\n}\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 457, "favorite_count": 1, "accepted_answer_id": 56820637, "answer_count": 1, "score": 0, "last_activity_date": 1561841588, "creation_date": 1561825829, "last_edit_date": 1561841588, "question_id": 56819121, "link": "https://stackoverflow.com/questions/56819121/is-there-a-standard-way-of-cyclically-rotating-mutable-variables-in-rust", "title": "Is there a standard way of cyclically rotating mutable variables in Rust?", "body": "<p>A very common operation in implementing algorithms is the cyclic rotate: given, say, 3 variables a, b, c change them to the effect of</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>t \u21fd c\nc \u21fd b\nb \u21fd a\na \u21fd t\n</code></pre>\n\n<p>Given that everything is bitwise swappable, cyclic rotation should be an area where Rust excels more than any other language I know of.</p>\n\n<p>For comparison, in C++ the most efficient generic way to rotate N elements is performing n+1 <code>std::move</code> operations, which in turn roughly leads to (for a typical move constructor implementation) <code>3 (n+1) sizeof(T)</code> word assignments (this can be improved for PODs via template specializing rotate, but requires work).</p>\n\n<p>In Rust, the language makes it possible to implement rotate with only <code>(n+1) size_of(T)</code> word assignments. To my surprise, I could not find standard library support for rotation. (No rotate method in <code>std::mem</code>). It would probably look like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn rotate&lt;T&gt;(x: &amp;mut T, y: &amp;mut T, z: &amp;mut T) {\n    unsafe {\n        let mut t: T = std::mem::uninitialized();\n        std::ptr::copy_nonoverlapping(&amp;*z, &amp;mut t, 1);\n        std::ptr::copy_nonoverlapping(&amp;*y, z, 1);\n        std::ptr::copy_nonoverlapping(&amp;*x, y, 1);\n        std::ptr::copy_nonoverlapping(&amp;t, x, 1);\n        std::mem::forget(t);\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>For clarification on why rotation cannot be implemented efficiently in C++, consider:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>struct String {\n  char *data1;\n  char *data2;\n  String(String &amp;&amp;other) : data1(other.data1), data2(other.data2)\n    { other.data1 = other.data2 = nullptr;}\n  String &amp;operator=(String &amp;&amp;other)\n    { std::swap(data1, other.data1); std::swap(data2, other.data2);\n      return *this; }\n  ~String() { delete [] data1; delete [] data2; }\n};\n</code></pre>\n\n<p>Here an operation like <code>s2 = std::move(s1);</code> will take 3 pointer assignments for each member field, totaling to 6 assignments since pointer swap requires 3 assignments (1 into temp, 1 out of temp, one across operands)</p>\n"}, {"tags": ["rust", "operator-overloading"], "comments": [{"owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 0, "creation_date": 1561822791, "post_id": 56818329, "comment_id": 100190776, "body": "<code>impl AddAssign&lt;&amp;Vec3&gt; for &amp;mut Vec3 {</code> is not idiomatic.  Instead better use <code>*vv</code> on the left-hand side if you ever need to assign via a mutable reference."}, {"owner": {"reputation": 19, "user_id": 11717433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0c5ac6a300c623ef17b71e4de4a9ac?s=128&d=identicon&r=PG&f=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/11717433/jason"}, "reply_to_user": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 0, "creation_date": 1561862394, "post_id": 56818329, "comment_id": 100196897, "body": "@starblue Thanks for the advice. The problem remains. Maybe rust does not know how to convert &amp;mut T if two options, T and &amp;T, are available?"}, {"owner": {"reputation": 19, "user_id": 11717433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0c5ac6a300c623ef17b71e4de4a9ac?s=128&d=identicon&r=PG&f=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/11717433/jason"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1561862597, "post_id": 56818329, "comment_id": 100196908, "body": "@Stargateur Missing code added, it should work now."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1561864456, "post_id": 56818329, "comment_id": 100197080, "body": "<a href=\"https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=b4328ed35157177255b1244cf4c564c3\" rel=\"nofollow noreferrer\">play.integer32.com/&hellip;</a> please <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}, {"owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 0, "creation_date": 1561892477, "post_id": 56818329, "comment_id": 100201152, "body": "Don&#39;t use <code>for &amp;mut Vec3</code>, because then the type of <code>self</code> in <code>add_assign</code> is <code>&amp;mut &amp;mut Vec3</code>. (<code>Self</code> is the type after the <code>for</code>, and <code>&amp;mut self</code> is an abbreviation for <code>self: &amp;mut Self</code>.)"}, {"owner": {"reputation": 19, "user_id": 11717433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0c5ac6a300c623ef17b71e4de4a9ac?s=128&d=identicon&r=PG&f=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/11717433/jason"}, "reply_to_user": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 0, "creation_date": 1561944290, "post_id": 56818329, "comment_id": 100210706, "body": "@starblue I know exactly what you mean but my problem is about the type of RHS."}], "owner": {"reputation": 19, "user_id": 11717433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca0c5ac6a300c623ef17b71e4de4a9ac?s=128&d=identicon&r=PG&f=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/11717433/jason"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1561862562, "creation_date": 1561818636, "last_edit_date": 1561862562, "question_id": 56818329, "link": "https://stackoverflow.com/questions/56818329/minimal-pairs-in-t-t-and-mut-t-required-to-overload-an-operator", "title": "Minimal pairs in T, &amp;T and &amp;mut T required to overload an operator", "body": "<p>I'm writing operator overloading code for my toy 3D vector type when I hit the problem.</p>\n\n<p>Here's the struct definition and subscription overloading.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct Vec3([f32; 3]);\n\nimpl Index&lt;usize&gt; for Vec3 {\n    type Output = f32;\n\n    fn index(&amp;self, index: usize) -&gt; &amp;Self::Output {\n        &amp;self.0[index]\n    }\n}\n\nimpl IndexMut&lt;usize&gt; for Vec3 {\n    fn index_mut(&amp;mut self, index: usize) -&gt; &amp;mut Self::Output {\n        &amp;mut self.0[index]\n    }\n}\n\n\nimpl Neg for Vec3 {\n    type Output = Self;\n\n    fn neg(self) -&gt; Self::Output {\n        let mut v = self;\n        for i in 0..3 {\n            v[i] = -v[i];\n        }\n        v\n    }\n}\n</code></pre>\n\n<p>Then I implemented <code>&amp;mut T += &amp;T</code> and wrote some test code</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl AddAssign&lt;&amp;Vec3&gt; for Vec3 {\n    fn add_assign(&amp;mut self, rhs: &amp;Vec3) {\n        for i in 0..3 {\n            self[i] += rhs[i];\n        } \n    }\n}\n\nimpl AddAssign&lt;&amp;Vec3&gt; for &amp;mut Vec3 {\n    fn add_assign(&amp;mut self, rhs: &amp;Vec3) {\n        (*self).add_assign(rhs);\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::Vec3;\n\n    #[test]\n    fn test_add() {\n        let mut v = -Vec3::new(1f32, 2f32, 3f32);\n        let mut w = -Vec3::new(1f32, 2f32, 3f32);\n        {\n            let mut vv = &amp;mut v;\n            let ww = &amp;mut w;\n            vv += ww;\n            println!(\"{:?}\", vv);\n        }\n    }\n}\n</code></pre>\n\n<p>Notice that <code>&amp;mut T += &amp;mut T</code> works now. But when I continue to implement <code>&amp;mut T += T</code></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl AddAssign&lt;Vec3&gt; for &amp;mut Vec3 {\n    fn add_assign(&amp;mut self, rhs: Vec3) {\n        (*self).add_assign(&amp;rhs);\n    }\n}\n</code></pre>\n\n<p><code>&amp;mut T += &amp;mut T</code> no longer works</p>\n\n<pre><code>error[E0277]: cannot add-assign `&amp;mut Vec3` to `&amp;mut Vec3`\n   --&gt; vec3/src/lib.rs:170:10\n    |\n170 |             vv += ww;\n    |                ^^ no implementation for `&amp;mut Vec3 += &amp;mut Vec3`\n    |\n    = help: the trait `std::ops::AddAssign&lt;&amp;mut Vec3&gt;` is not implemented for `&amp;mut Vec3`\n</code></pre>\n\n<p>I'm quite confused and wondering if you guys can shed some light on this. Thanks in advance.</p>\n"}, {"tags": ["linux", "windows", "rust", "rust-cargo"], "comments": [{"owner": {"reputation": 273, "user_id": 286021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8366e7b2d753db522f8ab5c0846807a4?s=128&d=identicon&r=PG", "display_name": "nelsonjchen", "link": "https://stackoverflow.com/users/286021/nelsonjchen"}, "edited": false, "score": 0, "creation_date": 1561818552, "post_id": 56817964, "comment_id": 100189809, "body": "Does this happen with &quot;Hello World&quot; (<code>cargo new --bin</code>) or is it specific to your program that you are making? Also, I would suggest opening an issue on the <a href=\"https://github.com/rust-lang/rustup.rs/issues\" rel=\"nofollow noreferrer\">Rustup repo with this</a>. Their issue tracker is really rather active."}, {"owner": {"reputation": 21, "user_id": 9586342, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XANJB1HcDjk/AAAAAAAAAAI/AAAAAAAAAC0/z_rBq--VdDc/photo.jpg?sz=128", "display_name": "Carlos Pereira", "link": "https://stackoverflow.com/users/9586342/carlos-pereira"}, "reply_to_user": {"reputation": 273, "user_id": 286021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8366e7b2d753db522f8ab5c0846807a4?s=128&d=identicon&r=PG", "display_name": "nelsonjchen", "link": "https://stackoverflow.com/users/286021/nelsonjchen"}, "edited": false, "score": 0, "creation_date": 1561820545, "post_id": 56817964, "comment_id": 100190275, "body": "I created a Hello World as suggessted. It seems to be working... I&#39;ve executed a few times and no problems regarding rustc.I&#39;ve also published this in the Rust forum, but perhaps I&#39;ll open a new issue on the repo. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 273, "user_id": 286021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8366e7b2d753db522f8ab5c0846807a4?s=128&d=identicon&r=PG", "display_name": "nelsonjchen", "link": "https://stackoverflow.com/users/286021/nelsonjchen"}, "edited": false, "score": 0, "creation_date": 1561826870, "post_id": 56818740, "comment_id": 100191588, "body": "Please name the Antivirus. Thanks! Helps SEO."}, {"owner": {"reputation": 21, "user_id": 9586342, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XANJB1HcDjk/AAAAAAAAAAI/AAAAAAAAAC0/z_rBq--VdDc/photo.jpg?sz=128", "display_name": "Carlos Pereira", "link": "https://stackoverflow.com/users/9586342/carlos-pereira"}, "reply_to_user": {"reputation": 273, "user_id": 286021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8366e7b2d753db522f8ab5c0846807a4?s=128&d=identicon&r=PG", "display_name": "nelsonjchen", "link": "https://stackoverflow.com/users/286021/nelsonjchen"}, "edited": false, "score": 0, "creation_date": 1561828077, "post_id": 56818740, "comment_id": 100191806, "body": "When I had the issue I was using Avast. Then I replaced it with AVG and everything is ok"}], "tags": [], "owner": {"reputation": 21, "user_id": 9586342, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XANJB1HcDjk/AAAAAAAAAAI/AAAAAAAAAC0/z_rBq--VdDc/photo.jpg?sz=128", "display_name": "Carlos Pereira", "link": "https://stackoverflow.com/users/9586342/carlos-pereira"}, "is_accepted": false, "score": 1, "last_activity_date": 1561822117, "creation_date": 1561822117, "answer_id": 56818740, "question_id": 56817964, "link": "https://stackoverflow.com/questions/56817964/rustc-disappears-when-executing-cargo-run-on-windows/56818740#56818740", "title": "rustc disappears when executing cargo run on windows", "body": "<p>The problem was the anti virus I had on my PC.</p>\n\n<p>After replacing it the program is working perfectly and finishing without the problem I had with rustc.</p>\n"}], "owner": {"reputation": 21, "user_id": 9586342, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XANJB1HcDjk/AAAAAAAAAAI/AAAAAAAAAC0/z_rBq--VdDc/photo.jpg?sz=128", "display_name": "Carlos Pereira", "link": "https://stackoverflow.com/users/9586342/carlos-pereira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561822117, "creation_date": 1561815318, "question_id": 56817964, "link": "https://stackoverflow.com/questions/56817964/rustc-disappears-when-executing-cargo-run-on-windows", "title": "rustc disappears when executing cargo run on windows", "body": "<p>I am curently developing a Rust program on Windows 10. A few months ago I created a library package using cargo. Since then, I've been developing this program. Whenever I want to execute what I have, I goto to cmd and execute the following command inside my cargo folder:</p>\n\n<pre><code>cargo run --release --bin main\n</code></pre>\n\n<p>But, a few weeks ago something strange started to happen. Whenever I execute this same command, I notice that the program in fact starts but it finishes preemptively (I know this because of the output to the terminal). When the program finishes it is supposed to write to the terminal \"FINISHED\". But this never happens. If I execute the command again (without changing the code), this time the only thing that's printed to the terminal is the build message that cargo puts out. Then, when I execute a third time, I have the following message on my terminal:</p>\n\n<pre><code>error: 'cargo.exe' is not installed for the toolchain 'stable-x86_64-pc-windows-msvc'\nTo install, run `rustup component add cargo --toolchain stable-x86_64-pc-windows-msvc`\n</code></pre>\n\n<p>Then if I execute the suggested command, I have the following:</p>\n\n<pre><code>component 'cargo' for target 'x86_64-pc-windows-msvc' was automatically added because it is required for toolchain 'stable-x86_64-pc-windows-msvc'\n</code></pre>\n\n<p>What's weird is that if I execute the previous cargo run command on the Ubuntu terminal application that I have (it simulates a linux terminal, but I am still on my windows file system), this problem doesn't occur. I can execute 100 or 1000 times and no problems. But this isn't good, since my program creates a multi threaded environment and my Ubuntu terminal is like a virtual machine, so I don't believe that I have access to all of my laptop's memory.</p>\n\n<p>Currently I have the following version of rust on windows and my ubuntu terminal:</p>\n\n<pre><code> rustup 1.18.3 (435397f48 2019-05-22)\n</code></pre>\n\n<p>What I have been doing until now to solve this is on my windows is to reboot my computer and reinstall rust, since when I execute \"rustup self uninstall\" sometimes an error of not having permissions to install it appears (I only have 1 user on my pc and supposedly I have admin privileges).</p>\n\n<p>I have googled this situation, but I haven't found anything regarding rustc disappearing when executing cargo run. Now I can't even run my program on windows cmd, since this problems happens every time.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1561810760, "post_id": 56817429, "comment_id": 100188223, "body": "Relevant method: <a href=\"https://doc.rust-lang.org/stable/std/collections/struct.VecDeque.html#method.back_mut\" rel=\"nofollow noreferrer\">doc.rust-lang.org/stable/std/collections/&hellip;</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4776812"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1561811288, "post_id": 56817429, "comment_id": 100188310, "body": "@E_net4theKindDownvoter yep, thanks, it&#39;s working."}], "answers": [{"tags": [], "owner": {"reputation": 827, "user_id": 962163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6cfe6e59978b1bb04311df2d846c579?s=128&d=identicon&r=PG", "display_name": "limon", "link": "https://stackoverflow.com/users/962163/limon"}, "is_accepted": false, "score": 1, "last_activity_date": 1561811106, "creation_date": 1561811106, "answer_id": 56817516, "question_id": 56817429, "link": "https://stackoverflow.com/questions/56817429/how-to-update-value-in-vecdeque/56817516#56817516", "title": "How to update value in VecDeque", "body": "<p>Use <code>back_mut</code></p>\n\n<pre><code>v.back_mut().unwrap().push_str(&amp;str);\n</code></pre>\n\n<p>or just store reference in the deque</p>\n\n<pre><code>v.push_back(&amp;mut str1);\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user4776812"}, "is_accepted": true, "score": 0, "last_activity_date": 1561811182, "creation_date": 1561811182, "answer_id": 56817527, "question_id": 56817429, "link": "https://stackoverflow.com/questions/56817429/how-to-update-value-in-vecdeque/56817527#56817527", "title": "How to update value in VecDeque", "body": "<p>My working example:</p>\n\n<pre><code>use std::collections::VecDeque;\n\nfn main() {\n    let mut v = VecDeque::new();\n    let mut str1 = String::from(\"Hello\");\n    v.push_back(str1);\n\n    let mut str2 = String::from(\" World\");\n\n    match v.back_mut() {\n        Some(value) =&gt; value.push_str(&amp;str2),\n        None =&gt; println!(\"Error\")\n    }\n\n    match v.back() {\n        Some(value) =&gt; println!(\"{}\", value),\n        None =&gt; println!(\"Error2\")\n    }\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4776812"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 56817527, "answer_count": 2, "score": 0, "last_activity_date": 1561811182, "creation_date": 1561810267, "last_edit_date": 1561810570, "question_id": 56817429, "link": "https://stackoverflow.com/questions/56817429/how-to-update-value-in-vecdeque", "title": "How to update value in VecDeque", "body": "<p>I want to store value in VecDeque and after it update the value.</p>\n\n<p>Minimal example:</p>\n\n<pre><code>use std::collections::VecDeque;\n\nfn main() {\n    let mut v = VecDeque::new();\n    let mut str1 = String::from(\"Hello\");\n\n    v.push_back(str1);\n\n    let str = String::from(\" World\");\n    str1.push_str(&amp;str);\n}\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>   Compiling playground v0.0.1 (/playground)\nerror[E0382]: borrow of moved value: `str1`\n  --&gt; src/main.rs:10:5\n   |\n5  |     let mut str1 = String::from(\"Hello\");\n   |         -------- move occurs because `str1` has type `std::string::String`, which does not implement the `Copy` trait\n6  |     \n7  |     v.push_back(str1);\n   |                 ---- value moved here\n...\n10 |     str1.push_str(&amp;str);\n   |     ^^^^ value borrowed here after move\n\nerror: aborting due to previous error\n</code></pre>\n\n<p>Question:</p>\n\n<p>How can I add item to collection and after it update this item?</p>\n"}, {"tags": ["rust", "raspberry-pi", "i2c"], "comments": [{"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1561810307, "post_id": 56817393, "comment_id": 100188144, "body": "<code>I2c::new()</code> returns result not the instance that you expected you may use <code>except(&quot;...&quot;)</code> for quick solution  like : <code>I2c::new().except(&quot;Couldn&#39;t initiate&quot;)</code>  or you may want to understand what is <code>Result</code> type in Rust or  what is the use of <code>?</code> operator."}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1561810492, "post_id": 56817393, "comment_id": 100188181, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/44756215/is-it-possible-to-cast-type-stdresultresult-to-minhookhook\">Is it possible to cast type `std::result::Result` to `minhook::Hook`?</a>"}, {"owner": {"reputation": 11, "user_id": 9683203, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-HOB8TOyv4Z4/AAAAAAAAAAI/AAAAAAAAAK8/d58EdTDz2wQ/photo.jpg?sz=128", "display_name": "George Sanger", "link": "https://stackoverflow.com/users/9683203/george-sanger"}, "reply_to_user": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1561812230, "post_id": 56817393, "comment_id": 100188527, "body": "@&#214;merErden Yes that was the issue, I had taken out the <code>?</code> as it was creating other bug. Need to bit the bullet and stick my nose into the book for a week :)."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9683203, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-HOB8TOyv4Z4/AAAAAAAAAAI/AAAAAAAAAK8/d58EdTDz2wQ/photo.jpg?sz=128", "display_name": "George Sanger", "link": "https://stackoverflow.com/users/9683203/george-sanger"}, "edited": false, "score": 0, "creation_date": 1561811736, "post_id": 56817441, "comment_id": 100188418, "body": "Yeah that was it, should do more research before continuing!"}, {"owner": {"reputation": 896, "user_id": 9019560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7024d310c7521f85292ab4961accee31?s=128&d=identicon&r=PG&f=1", "display_name": "Turksarama", "link": "https://stackoverflow.com/users/9019560/turksarama"}, "reply_to_user": {"reputation": 11, "user_id": 9683203, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-HOB8TOyv4Z4/AAAAAAAAAAI/AAAAAAAAAK8/d58EdTDz2wQ/photo.jpg?sz=128", "display_name": "George Sanger", "link": "https://stackoverflow.com/users/9683203/george-sanger"}, "edited": false, "score": 0, "creation_date": 1561812581, "post_id": 56817441, "comment_id": 100188586, "body": "Rust, more than any language I have ever used, gives extremely helpful error messages.  Pay attention to them!"}], "tags": [], "owner": {"reputation": 896, "user_id": 9019560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7024d310c7521f85292ab4961accee31?s=128&d=identicon&r=PG&f=1", "display_name": "Turksarama", "link": "https://stackoverflow.com/users/9019560/turksarama"}, "is_accepted": false, "score": 0, "last_activity_date": 1561810365, "creation_date": 1561810365, "answer_id": 56817441, "question_id": 56817393, "link": "https://stackoverflow.com/questions/56817393/why-doesnt-this-rppal-i2c-struct-have-any-methods/56817441#56817441", "title": "Why doesn&#39;t this rppal I2c struct have any methods?", "body": "<p>In the example you post there is this line:</p>\n\n<pre><code>let mut i2c = I2c::new()?;\n</code></pre>\n\n<p>The question mark is not an accident.  Note that in the error you get the type of i2c in your code:</p>\n\n<pre><code>error[E0599]: no method named `set_timeout` found for type `std::result::Result&lt;rppal::i2c::I2c, rppal::i2c::Error&gt;` in the current scope\n --&gt; src/main.rs:8:6\n  |\n8 |     foo.set_timeout(1000);\n  |     \n</code></pre>\n\n<p>It is not an <code>i2c</code>, but a <code>Result&lt;i2c, Error&gt;</code>.  The question mark in this case unpacks the <code>Result</code>, and if it is an error escalates it out of the current function.</p>\n\n<p>Note that for this to work, your current function must also return a Result type, so you should match the <code>main()</code> function signiature given in the example to <code>fn main() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt;</code></p>\n"}], "owner": {"reputation": 11, "user_id": 9683203, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-HOB8TOyv4Z4/AAAAAAAAAAI/AAAAAAAAAK8/d58EdTDz2wQ/photo.jpg?sz=128", "display_name": "George Sanger", "link": "https://stackoverflow.com/users/9683203/george-sanger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561810426, "creation_date": 1561809806, "last_edit_date": 1561810426, "question_id": 56817393, "link": "https://stackoverflow.com/questions/56817393/why-doesnt-this-rppal-i2c-struct-have-any-methods", "title": "Why doesn&#39;t this rppal I2c struct have any methods?", "body": "<p>I'm been playing around with Rust on the raspberry pi, looking to build a coffee machine controller. I'm hit this problem super early on.\nI'm using the rppal library with the hope of creating a i2c driver for a LCD screen.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0599]: no method named `set_timeout` found for type `std::result::Result&lt;rppal::i2c::I2c, rppal::i2c::Error&gt;` in the current scope\n --&gt; src/main.rs:8:6\n  |\n8 |     foo.set_timeout(1000);\n  |         ^^^^^^^^^^^\n\nerror[E0599]: no method named `set_slave_address` found for type `std::result::Result&lt;rppal::i2c::I2c, rppal::i2c::Error&gt;` in the current scope\n --&gt; src/main.rs:9:6\n  |\n9 |     foo.set_slave_address(ADDR);\n  |         ^^^^^^\n</code></pre>\n\n<p>I'm basicly following examples but it seems that I can't create a strut with the required methods!, feel like I'm missing something simple!</p>\n\n<p>Here is the code, not a lot to it.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use rppal::i2c::I2c;\n\nconst ADDR: u16 = 0x27;\n\nfn main() {\n    println!(\"hello world\");\n    let mut foo = I2c::new();\n    foo.set_timeout(1000);\n    foo.set_slave_address(ADDR);\n}\n</code></pre>\n\n<p>this is the library -> <a href=\"https://github.com/golemparts/rppal\" rel=\"nofollow noreferrer\">https://github.com/golemparts/rppal</a>\nand the example I was trying to copy -> <a href=\"https://github.com/golemparts/rppal/blob/master/examples/i2c_ds3231.rs\" rel=\"nofollow noreferrer\">https://github.com/golemparts/rppal/blob/master/examples/i2c_ds3231.rs</a></p>\n\n<p>Many thanks!!</p>\n"}, {"tags": ["rust", "ownership"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1561806862, "post_id": 56817036, "comment_id": 100187473, "body": "&quot;now we are having 2 mutable references to the same variable x at the same time?&quot; - Not at the same time, though. Compiler can prove that usages of <code>z</code> and <code>y</code> do not intertwine, and so it&#39;s safe to use <code>z</code> in this manner."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561811974, "post_id": 56817036, "comment_id": 100188460, "body": "Yes, it works because of NLLs, but what I encourage you to note is what Sergio says: <code>z</code> and <code>y</code> do not have to be alive at the same time, so it is valid to use <code>y</code> again after <code>z</code>&#39;s last use. That is, going forward, don&#39;t think of them as &quot;non-lexical lifetimes&quot; but just as &quot;lifetimes&quot;. The old borrow checker that would have rejected this code is going away, so it is unimportant to keep using the special name."}, {"owner": {"reputation": 31, "user_id": 9978635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22029af3a0ee255f518d6578f568ad26?s=128&d=identicon&r=PG&f=1", "display_name": "zakaster", "link": "https://stackoverflow.com/users/9978635/zakaster"}, "edited": false, "score": 0, "creation_date": 1561888625, "post_id": 56817036, "comment_id": 100200437, "body": "ok so i guess after line <code>*z += 1;</code> compiler will assume that z is no long used. my last question is actually what bothers me a lot, which is when you make a reborrow as <code>&amp;mut *y</code>, is it equal to <code>&amp;mut x</code>? and isn&#39;t that y here is a borrowed value so i am moving out of it which is common compiler [E0505]: cannot move out of xxx because it is borrowed."}], "owner": {"reputation": 31, "user_id": 9978635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22029af3a0ee255f518d6578f568ad26?s=128&d=identicon&r=PG&f=1", "display_name": "zakaster", "link": "https://stackoverflow.com/users/9978635/zakaster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "closed_date": 1561822763, "answer_count": 0, "score": 0, "last_activity_date": 1561806287, "creation_date": 1561806287, "question_id": 56817036, "link": "https://stackoverflow.com/questions/56817036/rust-function-returns-re-borrowed-reference-creates-multiple-mutable-reference", "closed_reason": "Duplicate", "title": "rust function returns re-borrowed reference creates multiple mutable reference", "body": "<p>based on\n<a href=\"https://www.reddit.com/r/rust/comments/46qwjv/why_can_i_use_an_mut_reference_twice/\" rel=\"nofollow noreferrer\">https://www.reddit.com/r/rust/comments/46qwjv/why_can_i_use_an_mut_reference_twice/</a></p>\n\n<p>function returns a <code>re-borrowed</code> reference actually compiles</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// rustc version = rustc 1.35.0 (3c235d560 2019-05-20)\n\nfn mutate(val: &amp;mut i32) -&gt; &amp;mut i32 {\n    *val += 1;\n    val         // &amp;mut *y returned?\n}\n\nfn main() {\n    let mut x = 0;\n\n    let y = &amp;mut x;\n\n    let z = mutate(y);  // re-borrow &amp;mut *y\n\n    *z += 1;\n    *y += 1;    // this goes first will cause error\n\n    println!(\"{}\", x);\n}\n</code></pre>\n\n<p>now we are having 2 mutable references to the same variable <code>x</code> at the same time? does this weird thing have something to do with <code>non-lexical lifetime</code>? \nand what's the difference between <code>y</code> and <code>z</code>, thanks.</p>\n"}, {"tags": ["json", "rust"], "comments": [{"owner": {"reputation": 6357, "user_id": 6086311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb99289473f6393b89474785f2d294d1?s=128&d=identicon&r=PG", "display_name": "dtolnay", "link": "https://stackoverflow.com/users/6086311/dtolnay"}, "edited": false, "score": 0, "creation_date": 1561824995, "post_id": 56817010, "comment_id": 100191263, "body": "What does the data look like around line 1 column 63 like the error refers to? The json object you showed is not 63 columns long so that is not what is being deserialized."}, {"owner": {"reputation": 55, "user_id": 9110411, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZsck.png?s=128&g=1", "display_name": "Tomdrc1", "link": "https://stackoverflow.com/users/9110411/tomdrc1"}, "reply_to_user": {"reputation": 6357, "user_id": 6086311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb99289473f6393b89474785f2d294d1?s=128&d=identicon&r=PG", "display_name": "dtolnay", "link": "https://stackoverflow.com/users/6086311/dtolnay"}, "edited": false, "score": 0, "creation_date": 1561916179, "post_id": 56817010, "comment_id": 100205932, "body": "@dtolnay My mistake, I realized now I took a different error from testing different values. It says line 1 column 60 when sending the data I present in the question."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1562025841, "post_id": 56817010, "comment_id": 100239086, "body": "It&#39;s great that you have the solution to your question! You should post it as an answer rather than an edit to your question and then potentially accept that answer. That way, the question shows up as solved in search results, people can vote on your answer, and your solution can be more helpful to future people with the same problem."}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 9110411, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZsck.png?s=128&g=1", "display_name": "Tomdrc1", "link": "https://stackoverflow.com/users/9110411/tomdrc1"}, "edited": false, "score": 1, "creation_date": 1561922026, "post_id": 56827221, "comment_id": 100207255, "body": "The quotation marks are just to show what will be printed. The raw print is: <code>{&quot;username&quot;:&quot;user&quot;,&quot;password&quot;:&quot;password&quot;,&quot;email&quot;:&quot;dwadwad&quot;}</code>"}, {"owner": {"reputation": 4945, "user_id": 341510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9162e8bca37c48433207c1fccfb3bba1?s=128&d=identicon&r=PG", "display_name": "chucksmash", "link": "https://stackoverflow.com/users/341510/chucksmash"}, "reply_to_user": {"reputation": 55, "user_id": 9110411, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZsck.png?s=128&g=1", "display_name": "Tomdrc1", "link": "https://stackoverflow.com/users/9110411/tomdrc1"}, "edited": false, "score": 1, "creation_date": 1561924510, "post_id": 56827221, "comment_id": 100207731, "body": "@Tomdrc1 I&#39;ve updated my answer. Can&#39;t tell you exactly what&#39;s different about the data you&#39;re receiving from Postman, but I&#39;ve added a test you can adapt to check it for yourself."}, {"owner": {"reputation": 55, "user_id": 9110411, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZsck.png?s=128&g=1", "display_name": "Tomdrc1", "link": "https://stackoverflow.com/users/9110411/tomdrc1"}, "edited": false, "score": 2, "creation_date": 1561931126, "post_id": 56827221, "comment_id": 100208999, "body": "Thank you so much! This helped me realize I have alot of NULL after the actual data because I read the data from the socket into a buffer. The &quot;trailing charters&quot; are just null. I realized this when the length of the message was 239 long."}], "tags": [], "owner": {"reputation": 4945, "user_id": 341510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9162e8bca37c48433207c1fccfb3bba1?s=128&d=identicon&r=PG", "display_name": "chucksmash", "link": "https://stackoverflow.com/users/341510/chucksmash"}, "is_accepted": true, "score": 3, "last_activity_date": 1561924182, "last_edit_date": 1561924182, "creation_date": 1561920206, "answer_id": 56827221, "question_id": 56817010, "link": "https://stackoverflow.com/questions/56817010/why-do-i-always-get-a-trailing-characters-error-when-trying-to-parse-data-with/56827221#56827221", "title": "Why do I always get a &quot;trailing characters&quot; error when trying to parse data with serde_json?", "body": "<p>Looking at the serde json <a href=\"https://github.com/serde-rs/json/blob/6ac689b2b327ed00e8a56d812a5c860177ab10dd/src/error.rs#L247\" rel=\"nofollow noreferrer\">code</a>, one finds the following comment above the relevant ErrorCode enum element:</p>\n\n<pre><code>/// JSON has non-whitespace trailing characters after the value.\nTrailingCharacters,\n</code></pre>\n\n<p>So as the error code implies, you've got some trailing character which is not whitespace. In your snippet, you say:</p>\n\n<pre><code>println!(\"{}\", content_of_msg[1]); \n// Will print \"{\"username\":\"user\",\"password\":\"password\",\"email\":\"dwadwad\"}\"\n</code></pre>\n\n<p>If you literally copy and pasted the printed output here, I'd note that I wouldn't expect the output to be wrapped in the leading and trailing quotation marks. Did you include these yourself or were they part of what was printed? If they were printed, I suspect that's the source of your problem.</p>\n\n<p>Edit:</p>\n\n<p>In fact, I can nearly recreate this using a raw string  with leading/trailing quotation marks in Rust:</p>\n\n<pre><code>extern crate serde_json;\n\n#[cfg(test)]\nmod tests {\n    #[test]\n    fn test_serde() {\n        let s =\n            r#\"\"{\"username\":\"user\",\"password\":\"password\",\"email\":\"dwadwad\"}\"\"#;\n        println!(\"{}\", s);\n        let _res: serde_json::Value = serde_json::from_str(s).unwrap();\n    }\n}\n</code></pre>\n\n<p>Running it via <code>cargo test</code> yields:</p>\n\n<pre><code>test tests::test_serde ... FAILED\n\nfailures:\n\n---- tests::test_serde stdout ----\n\"{\"username\":\"user\",\"password\":\"password\",\"email\":\"dwadwad\"}\"\nthread 'tests::test_serde' panicked at 'called `Result::unwrap()` on an `Err` value: Error(\"trailing characters\", line: 1, column: 4)', src/libcore/result.rs:997:5\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\n\n\nfailures:\n    tests::test_serde\n</code></pre>\n\n<p>Note that my printed output also includes leading/trailing quotation marks and I also get a <code>TrailingCharacter</code> error, albeit at a different column.</p>\n\n<p>Edit 2:</p>\n\n<p>Based on your comment that you've added the wrapping quotations yourself, you've got a known good string (the one you've defined in Rust), and one which you believe should match it but doesn't (the one from Postman).</p>\n\n<p>This is a data problem and so we should examine the data. You can adapt the below code to check the good string against the other:</p>\n\n<pre><code>#[test]\nfn test_str_comp() {\n    // known good string we'll compare against                                                                                                                                             \n    let good =\n        r#\"{\"username\":\"user\",\"password\":\"password\",\"email\":\"dwadwad\"}\"#;\n    // lengthened string, additional characters                                                                                                                                            \n    // also n and a in username are transposed                                                                                                                                             \n    let bad =\n        r#\"{\"useranme\":\"user\",\"password\":\"password\",\"email\":\"dwadwad\"}abc\"#;\n    let good_size = good.chars().count();\n    let bad_size = bad.chars().count();\n    for (idx, (c1, c2)) in (0..)\n        .zip(good.chars().zip(bad.chars()))\n        .filter(|(_, (c1, c2))| c1 != c2)\n    {\n        println!(\n            \"Strings differ at index {}: (good: `{}`, bad: `{}`)\",\n            idx, c1, c2\n        );\n    }\n    if good_size &lt; bad_size {\n        let trailing = bad.chars().skip(good_size);\n        println!(\n            \"bad string contains extra characters: `{}`\",\n            trailing.collect::&lt;String&gt;()\n        );\n    } else if good_size &gt; bad_size {\n        let trailing = good.chars().skip(bad_size);\n        println!(\n            \"good string contains extra characters: `{}`\",\n            trailing.collect::&lt;String&gt;()\n        );\n    }\n\n    assert!(false);\n}\n</code></pre>\n\n<p>For my example, this yields the failure:</p>\n\n<pre><code>test tests::test_str_comp ... FAILED\n\nfailures:\n\n---- tests::test_str_comp stdout ----\nStrings differ at index 6: (good: `n`, bad: `a`)\nStrings differ at index 7: (good: `a`, bad: `n`)\nbad string contains extra characters: `abc`\nthread 'tests::test_str_comp' panicked at 'assertion failed: false', src/lib.rs:52:9\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\n\n\nfailures:\n    tests::test_str_comp\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 9110411, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rZsck.png?s=128&g=1", "display_name": "Tomdrc1", "link": "https://stackoverflow.com/users/9110411/tomdrc1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1219, "favorite_count": 0, "accepted_answer_id": 56827221, "answer_count": 1, "score": 4, "last_activity_date": 1562025827, "creation_date": 1561806023, "last_edit_date": 1562025827, "question_id": 56817010, "link": "https://stackoverflow.com/questions/56817010/why-do-i-always-get-a-trailing-characters-error-when-trying-to-parse-data-with", "title": "Why do I always get a &quot;trailing characters&quot; error when trying to parse data with serde_json?", "body": "<p>I have a server that returns requests in a JSON format. When trying to parse the data I always get \"trailing characters\" error. This happens only when getting the JSON from postman </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let type_of_request = parsed_request[1];\nlet content_of_msg: Vec&lt;&amp;str&gt; = msg_from_client.split(\"\\r\\n\\r\\n\").collect();\n\nprintln!(\"{}\", content_of_msg[1]); \n// Will print \"{\"username\":\"user\",\"password\":\"password\",\"email\":\"dwadwad\"}\"\n\nlet res: serde_json::Value = serde_json::from_str(content_of_msg[1]).unwrap();\n\nprintln!(\"The username is: {}\", res[\"username\"]);\n</code></pre>\n\n<p>when getting the data from postman this happens:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: Error(\"trailing characters\", line: 1, column: 60)', src\\libcore\\result.rs:997:5\n</code></pre>\n\n<p>but when having the string inside Rust:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let j = \"{\\\"username\\\":\\\"user\\\",\\\"password\\\":\\\"password\\\",\\\"email\\\":\\\"dwadwad\\\"}\";\n\nlet res: serde_json::Value = serde_json::from_str(j).unwrap();\n\nprintln!(\"The username is: {}\", res[\"username\"]);\n</code></pre>\n\n<p>it works like a charm:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>The username is: \"user\"\n</code></pre>\n\n<p><strong>EDIT</strong>: Apparently as I read the message into a buffer and turned it into a string it saved all the NULL characters the buffer had which are of course the trailing characters. </p>\n"}, {"tags": ["templates", "generics", "rust"], "comments": [{"owner": {"reputation": 1925, "user_id": 2865757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dcfe7782349d59e50b1fa196f9c6669?s=128&d=identicon&r=PG&f=1", "display_name": "Zefick", "link": "https://stackoverflow.com/users/2865757/zefick"}, "edited": false, "score": 1, "creation_date": 1561788510, "post_id": 56814880, "comment_id": 100184497, "body": "Const generics are still unstable, as noticed below, but you can try macros. They are more powerful in Rust than in C++."}], "answers": [{"comments": [{"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 5, "creation_date": 1561807790, "post_id": 56815331, "comment_id": 100187670, "body": "&quot;we actually have generics in Rust!&quot; Yes but const generics are unstable, and not mentioned in the TRPL link you provided. <a href=\"https://meta.stackexchange.com/help/how-to-answer\">Link only answer</a> are also discouraged on SO. &quot;You don&#39;t really need [\u2026] destructor in Rust&quot; Well, yes you do! The default destructor might not be enough for some cases."}], "tags": [], "owner": {"reputation": 1, "user_id": 2236238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79cc86265ff91d2f42c4f3c92716b573?s=128&d=identicon&r=PG", "display_name": "ChrisLinn", "link": "https://stackoverflow.com/users/2236238/chrislinn"}, "is_accepted": false, "score": -8, "last_activity_date": 1561786909, "creation_date": 1561786909, "answer_id": 56815331, "question_id": 56814880, "link": "https://stackoverflow.com/questions/56814880/how-to-use-numeric-values-as-generics-paramters-in-rust/56815331#56815331", "title": "How to use numeric values as generics paramters in Rust?", "body": "<p>You know what, we actually have generics in Rust!</p>\n\n<p>I strongly suggest you read through <a href=\"https://doc.rust-lang.org/book/\" rel=\"nofollow noreferrer\">\"The Rust Programming Language\", TRPL</a>.</p>\n\n<p>And your question can be answer in <a href=\"https://doc.rust-lang.org/book/ch10-01-syntax.html\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>You don't really needs the contructor and destructor in Rust.  Rust will do it for you. TRPL provides a solid <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=98ff7a7adfe42b31fcc56915da81d6ee\" rel=\"nofollow noreferrer\">example</a>.</p>\n\n<p>Also, for vector, generic data type is already supported so you don't have to implement it yourself. Check <a href=\"https://doc.rust-lang.org/book/ch08-01-vectors.html\" rel=\"nofollow noreferrer\">this</a> out.</p>\n"}, {"comments": [{"owner": {"reputation": 2854, "user_id": 6923555, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh3.googleusercontent.com/-N8FUb3l8l44/AAAAAAAAAAI/AAAAAAAAAio/1HlhcKxsTPo/photo.jpg?sz=128", "display_name": "rodrigocfd", "link": "https://stackoverflow.com/users/6923555/rodrigocfd"}, "edited": false, "score": 0, "creation_date": 1617016113, "post_id": 56815399, "comment_id": 118173635, "body": "Just for the record, const generics <a href=\"https://blog.rust-lang.org/2021/03/25/Rust-1.51.0.html\" rel=\"nofollow noreferrer\">have been stabilized in 1.51</a>."}], "tags": [], "owner": {"reputation": 68, "user_id": 10881187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0a4f29c98969ff51c64dc910312c9c0?s=128&d=identicon&r=PG&f=1", "display_name": "nbrr", "link": "https://stackoverflow.com/users/10881187/nbrr"}, "is_accepted": true, "score": 3, "last_activity_date": 1561787883, "creation_date": 1561787883, "answer_id": 56815399, "question_id": 56814880, "link": "https://stackoverflow.com/questions/56814880/how-to-use-numeric-values-as-generics-paramters-in-rust/56815399#56815399", "title": "How to use numeric values as generics paramters in Rust?", "body": "<p>I believe you are looking for <a href=\"https://github.com/rust-lang/rust/issues/44580#issuecomment-488819344\" rel=\"nofollow noreferrer\">const generics</a>, which have yet to land in stable Rust. You may find an example <a href=\"https://github.com/maplant/aljabar\" rel=\"nofollow noreferrer\">here</a> using unstable Rust.</p>\n"}], "owner": {"reputation": 390, "user_id": 9532450, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8gvCc_mj0Hs/AAAAAAAAAAI/AAAAAAAABE0/Iae_Ww5uWKI/photo.jpg?sz=128", "display_name": "khanh", "link": "https://stackoverflow.com/users/9532450/khanh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2208, "favorite_count": 0, "closed_date": 1561838607, "accepted_answer_id": 56815399, "answer_count": 2, "score": 0, "last_activity_date": 1561838664, "creation_date": 1561778946, "last_edit_date": 1561788518, "question_id": 56814880, "link": "https://stackoverflow.com/questions/56814880/how-to-use-numeric-values-as-generics-paramters-in-rust", "closed_reason": "Duplicate", "title": "How to use numeric values as generics paramters in Rust?", "body": "<p>I am learning Rust as a beginner.\nI'm curious about how can we use numeric values as generics parameters that will be compiled at compile-time similar to template in C++</p>\n\n<p>This is an equivalent C++ code.</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>template&lt;class T, int dim&gt;\nstruct vec {\n    std::array&lt;T, dim&gt; data;\n    vec(): data() {}\n    vec(const vec&lt;T, dim&gt;&amp; obj): data(obj.data) {}\n    ~vec() {}\n};\nint main() {\n    vec&lt;float, 3&gt; v3;\n}\n</code></pre>\n\n<p>That code above will be compiled the same as</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>struct vec {\n    std::array&lt;float, 3&gt; data;\n    vec(): data() {}\n    vec(const vec&lt;float, 3&gt;&amp; obj): data(obj.data) {}\n    ~vec() {}\n};\nint main() {\n    vec v3;\n}\n</code></pre>\n"}, {"tags": ["rust", "event-handling"], "answers": [{"tags": [], "owner": {"reputation": 306, "user_id": 2117330, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dff90ae6e9eb6735844f2b78dc664647?s=128&d=identicon&r=PG", "display_name": "stephaneyfx", "link": "https://stackoverflow.com/users/2117330/stephaneyfx"}, "is_accepted": true, "score": 1, "last_activity_date": 1561747704, "creation_date": 1561747704, "answer_id": 56811887, "question_id": 56811309, "link": "https://stackoverflow.com/questions/56811309/how-to-get-a-value-from-a-query-without-using-nested-matches-and-unwrapping/56811887#56811887", "title": "how to get a value from a query without using nested matches and unwrapping", "body": "<p><code>?</code> and <code>map_err</code> should help getting rid of most of the nesting. Sketch:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let rows = pool.prep_exec(\"SELECT t FROM dbpulse_rw WHERE id=1\", ())?;\nfor row in rows {\n    let row = row.map_err(Error::MySQL)?;\n    let row = mysql::from_row_opt::&lt;u64&gt;(row).map_err(|e| Error::MySQL(e.into()))?;\n    if now != row {\n        return Err(Error::NotMatching(\"no matching...\".into()));\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 56811887, "answer_count": 1, "score": 0, "last_activity_date": 1561747704, "creation_date": 1561744369, "question_id": 56811309, "link": "https://stackoverflow.com/questions/56811309/how-to-get-a-value-from-a-query-without-using-nested-matches-and-unwrapping", "title": "how to get a value from a query without using nested matches and unwrapping", "body": "<p>I want to run some MySQL queries but handle different type of errors, from <a href=\"https://docs.rs/mysql/16.0.2/mysql/enum.Error.html#variant.IoError\" rel=\"nofollow noreferrer\"><code>Error::IoError</code></a> to check some timeouts, to a custom error type <code>NotMatching(String)</code> when the returned item from a query doesn't match, following up in other <a href=\"https://stackoverflow.com/q/56747417/1135424\">question</a>, I came up with this:</p>\n\n<pre><code>use std::{error, fmt};\n\n#[derive(Debug)]\npub enum Error {\n    MySQL(mysql::Error),\n    NotMatching(String),\n}\n\nimpl fmt::Display for Error {\n    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {\n        match *self {\n            Error::MySQL(ref err) =&gt; err.fmt(f),\n            Error::NotMatching(ref err) =&gt; err.fmt(f),\n        }\n    }\n}\n\nimpl error::Error for Error {}\n\nimpl From&lt;mysql::Error&gt; for Error {\n    fn from(err: mysql::Error) -&gt; Self {\n        Error::MySQL(err)\n    }\n}\n\npub struct Queries {\n    pool: mysql::Pool,\n}\n\npub fn new(pool: mysql::Pool) -&gt; Queries {\n    return Queries { pool: pool };\n}\n\nimpl Queries {\n    pub fn test_rw(&amp;self, now: u64) -&gt; Result&lt;(), Error&gt; {\n        let pool = &amp;self.pool.clone();\n\n        // create table\n        pool.prep_exec(\"CREATE TABLE IF NOT EXISTS dbpulse_rw (id INT NOT NULL, t INT(11) NOT NULL, PRIMARY KEY(id))\", ())?;\n\n        // write into table\n        let mut stmt = pool\n            .prepare(\"INSERT INTO dbpulse_rw (id, t) VALUES (1, ?) ON DUPLICATE KEY UPDATE t=?\")?;\n        stmt.execute((now, now))?;\n\n        let rows = pool.prep_exec(\"SELECT t FROM dbpulse_rw WHERE id=1\", ())?;\n        for row in rows {\n            match row {\n                Ok(row) =&gt; match mysql::from_row_opt::&lt;u64&gt;(row) {\n                    Ok(row) =&gt; {\n                        if now != row {\n                            return Result::Err(Error::NotMatching(\"no matching...\".into()));\n                        }\n                    }\n                    Err(e) =&gt; {\n                        return Result::Err(Error::MySQL(e.into()));\n                    }\n                },\n                Err(e) =&gt; {\n                    return Result::Err(Error::MySQL(e));\n                }\n            }\n        }\n        Ok(())\n    }\n}\n</code></pre>\n\n<p>It works but wondering if there is a better (clean) way, probably using <a href=\"https://doc.rust-lang.org/rust-by-example/error/option_unwrap/and_then.html\" rel=\"nofollow noreferrer\"><code>and_then</code> or <code>map</code></a> to reduce the code for getting a single value from the query, I am mainly referring to this part:</p>\n\n<pre><code>let rows = pool.prep_exec(\"SELECT t FROM dbpulse_rw WHERE id=1\", ())?;\nfor row in rows {\n    match row {\n        Ok(row) =&gt; match mysql::from_row_opt::&lt;u64&gt;(row) {\n            Ok(row) =&gt; {\n                if now != row {\n                    return Result::Err(Error::NotMatching(\"no matching...\".into()));\n                }\n            }\n            Err(e) =&gt; {\n                return Result::Err(Error::MySQL(e.into()));\n            }\n        },\n        Err(e) =&gt; {\n            return Result::Err(Error::MySQL(e));\n        }\n    }\n}\n</code></pre>\n\n<p>I would like to prevent panicking and handle better the error, that's why I am omitting the usage of <code>unwrap</code> but would appreciate some examples about how could this be improved.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 2, "creation_date": 1561738980, "post_id": 56809744, "comment_id": 100174775, "body": "I think you&#39;re misinterpreting the messages: <i>neither</i> <code>foo.rs</code> nor <code>bar.rs</code> can find the module named <code>foo_bar</code>. The compiler only gets as far as the first missing module before giving up, which is why rearranging the <code>mod</code> statements in <code>main.rs</code> changes which file you get the error from."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561739380, "post_id": 56809744, "comment_id": 100174904, "body": "I think you&#39;re saying <code>mod</code> when you mean to say <code>use</code> -- it may be a bit confusing because <code>mod</code> automatically <code>use</code>s -- but there should only ever be one <code>mod</code> for a given module, because the placement of the <code>mod</code> determines where the module fits in the hierarchy. If you change the <code>mod foo_bar;</code>s to <code>use foo_bar;</code> and put a <code>mod foo_bar;</code> in either lib.rs or main.rs, it should work. I can&#39;t test it now, unfortunately."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561739447, "post_id": 56809744, "comment_id": 100174922, "body": "<a href=\"https://stackoverflow.com/q/37610079/3650362\">Can&#39;t understand Rust module system</a> may be a question that helps you understand how this works."}, {"owner": {"reputation": 11, "user_id": 2148711, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AGZhQ.jpg?s=128&g=1", "display_name": "Jarsefax", "link": "https://stackoverflow.com/users/2148711/jarsefax"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561760749, "post_id": 56809744, "comment_id": 100181552, "body": "@trentcl If I do <code>mod foo_bar;</code>in <code>main.rs</code> and <code>use foo_bar;</code> in <code>main.rs</code> as you suggested then the compiler complains that I can&#39;t use foo_bar because it is not an external crate. So that did not work."}, {"owner": {"reputation": 11, "user_id": 2148711, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AGZhQ.jpg?s=128&g=1", "display_name": "Jarsefax", "link": "https://stackoverflow.com/users/2148711/jarsefax"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561761069, "post_id": 56809744, "comment_id": 100181594, "body": "But <code>use crate::foo_bar;</code> did work. Thank you @trentcl"}], "owner": {"reputation": 11, "user_id": 2148711, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AGZhQ.jpg?s=128&g=1", "display_name": "Jarsefax", "link": "https://stackoverflow.com/users/2148711/jarsefax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "closed_date": 1561761112, "answer_count": 0, "score": 1, "last_activity_date": 1593041727, "creation_date": 1561736536, "last_edit_date": 1593041727, "question_id": 56809744, "link": "https://stackoverflow.com/questions/56809744/why-file-not-found-for-module-for-sub-module", "closed_reason": "Duplicate", "title": "Why &quot;File not found for module&quot; for sub-module?", "body": "<p>I have two modules (in their own files) that both try to use a third, only one of them finds the file the third is in though.</p>\n<p>Why does the order of the mod-statements in <code>main.rs</code> matter? If I remove all the &quot;bar-stuff&quot; then the problem still remains.</p>\n<p><code>main.rs</code></p>\n<pre class=\"lang-rust prettyprint-override\"><code>mod foo;\nmod bar;\nfn main() {\n    foo::do_foo();\n    bar::do_bar();\n}\n</code></pre>\n<p><code>foo.rs</code></p>\n<pre class=\"lang-rust prettyprint-override\"><code>mod foo_bar; // error will be here when &quot;mod foo;&quot; is first in main.rs\npub fn do_foo() {\n    println!(&quot;foo::&quot;);\n    foo_bar::do_foo_bar();\n}\n</code></pre>\n<p><code>bar.rs</code></p>\n<pre class=\"lang-rust prettyprint-override\"><code>mod foo_bar; // error will move to here when putting &quot;mod bar;&quot; first in main.rs instead\npub fn do_bar() {\n    println!(&quot;bar::&quot;);\n    foo_bar::do_fo_bar();\n}\n</code></pre>\n<p><code>foo_bar.rs</code></p>\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn do_foo_bar() {\n    println!(&quot;foo_bar&quot;);\n}\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 1, "creation_date": 1561733039, "post_id": 56808872, "comment_id": 100172054, "body": "I suggest you read <a href=\"https://rust-unofficial.github.io/too-many-lists/\" rel=\"nofollow noreferrer\">Learn Rust With Entirely Too Many Linked Lists</a>"}, {"owner": {"reputation": 401, "user_id": 6792871, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1076642632424051/picture?type=large", "display_name": "SoptikHa", "link": "https://stackoverflow.com/users/6792871/soptikha"}, "reply_to_user": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1561733291, "post_id": 56808872, "comment_id": 100172190, "body": "I actually found this when I was trying to find out where is the mistake, but I didn&#39;t start reading it. I guess I&#39;ll study it now. Thanks!"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561745636, "post_id": 56808872, "comment_id": 100177316, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/32682876/is-there-any-way-to-return-a-reference-to-a-variable-created-in-a-function\">Is there any way to return a reference to a variable created in a function?</a> You&#39;re wrapping them in a <code>struct</code>, but fundamentally still trying to return references to locals, which doesn&#39;t make sense."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561745761, "post_id": 56808872, "comment_id": 100177381, "body": "Also see <a href=\"https://stackoverflow.com/questions/32300132/why-cant-i-store-a-value-and-a-reference-to-that-value-in-the-same-struct\">Why can&#39;t I store a value and a reference to that value in the same struct?</a> for the second part."}, {"owner": {"reputation": 401, "user_id": 6792871, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1076642632424051/picture?type=large", "display_name": "SoptikHa", "link": "https://stackoverflow.com/users/6792871/soptikha"}, "edited": false, "score": 0, "creation_date": 1561841055, "post_id": 56808872, "comment_id": 100194492, "body": "Thanks for the link. This is something I want to highlight from the answer: \u201cA lifetime is a bit of metadata that allows you and the compiler to know how long a value will be valid at its current memory location. That&#39;s an important distinction, as it&#39;s a common mistake Rust newcomers make. Rust lifetimes are not the time period between when an object is created and when it is destroyed!\u201d"}], "answers": [{"tags": [], "owner": {"reputation": 401, "user_id": 6792871, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1076642632424051/picture?type=large", "display_name": "SoptikHa", "link": "https://stackoverflow.com/users/6792871/soptikha"}, "is_accepted": false, "score": 2, "last_activity_date": 1561740755, "creation_date": 1561740755, "answer_id": 56810654, "question_id": 56808872, "link": "https://stackoverflow.com/questions/56808872/why-doesnt-the-borrowed-value-live-long-enough-when-created-in-constructor-in-l/56810654#56810654", "title": "Why doesn&#39;t the borrowed value live long enough when created in constructor in lifetime-annotated impl block?", "body": "<p>I ended up using Vec as kind of linked list, so I don't have to implement my own. If you are reading this, I strongly recommend you to read <a href=\"https://rust-unofficial.github.io/too-many-lists/\" rel=\"nofollow noreferrer\">Learn Rust With Entirely Too Many Linked Lists</a> as @Jmb suggested.</p>\n\n<p>This solution kind of avoids the issue altogether, so I won't mark this answer as a solution. The solution is in the guide linked above. However if you have similar problem, it's probably possible to solve your problem with similar solution as is this one - just use <code>Vec</code>, don't build it on your own.</p>\n\n<p>I just did this and <code>pop</code> and <code>push</code> from <code>snake_body</code> when moving the snake.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct Snake {\n    /// Snake body. The LAST item is head, the FIRST item is tail.\n    snake_body: Vec&lt;SnakePart&gt;,\n}\n\nstruct SnakePart {\n    x: f32,\n    y: f32,\n}\n</code></pre>\n"}], "owner": {"reputation": 401, "user_id": 6792871, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1076642632424051/picture?type=large", "display_name": "SoptikHa", "link": "https://stackoverflow.com/users/6792871/soptikha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561740755, "creation_date": 1561732726, "question_id": 56808872, "link": "https://stackoverflow.com/questions/56808872/why-doesnt-the-borrowed-value-live-long-enough-when-created-in-constructor-in-l", "title": "Why doesn&#39;t the borrowed value live long enough when created in constructor in lifetime-annotated impl block?", "body": "<p>I'm building a little program to learn rust. I'm trying to make snake.</p>\n\n<p>Snake consists of snake parts. Those snake parts work like linked list, each snake part knows which snake part is the previous one. Snake itself knows where is it's head and tail. It looks like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct Snake&lt;'a&gt; {\n    head: &amp;'a SnakePart&lt;'a&gt;,\n    tail: &amp;'a SnakePart&lt;'a&gt;,\n}\n\nstruct SnakePart&lt;'a&gt; {\n    x: f32,\n    y: f32,\n    previous_part: Option&lt;&amp;'a SnakePart&lt;'a&gt;&gt;,\n}\n</code></pre>\n\n<p>However I have problems writing Snake constructor. So far I have this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl&lt;'a&gt; Snake&lt;'a&gt; {\n    pub fn new(x: f32, y: f32) -&gt; Snake&lt;'a&gt; {\n        let snake_part: SnakePart&lt;'a&gt; = SnakePart::new(x, y);\n        Snake {\n            head: &amp;snake_part,\n            tail: &amp;snake_part,\n            current_angle: 0.,\n        }\n    }\n}\n</code></pre>\n\n<p>This creates snake, which has only one segment (or snake part), and it's both his tail and head. However this doesn't compile. Compiler tells me that <code>snake_part</code> only lives to the end of constructor, and it has to live for the lifetime <code>'a</code> as defined on the <code>impl</code> block.</p>\n\n<p>I know that it has to live as long as the whole snake, but why this does not work? I would think that the snake part will live while the snake itself live - the snake I return has lifetime <code>'a</code>. How can I persuade Rust to let snake parts live long enough?</p>\n\n<hr>\n\n<p>I tried to save all snake parts into the snake structure itself. So I changed it this way:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct Snake&lt;'a&gt; {\n    ...\n    snake_parts: Vec&lt;SnakePart&lt;'a&gt;&gt;,\n}\n\nimpl&lt;'a&gt; Snake&lt;'a&gt; {\n        let snake_part: SnakePart&lt;'a&gt; = SnakePart::new(x, y);\n        let mut snake_parts: Vec&lt;SnakePart&lt;'a&gt;&gt; = Vec::with_capacity(1);\n        snake_parts.push(snake_part);\n        Snake {\n            head: &amp;snake_parts[0],\n            tail: &amp;snake_parts[0],\n            snake_parts: snake_parts,\n            current_angle: 0.,\n        }\n}\n</code></pre>\n\n<p>Why this doesn't work? (It has exactly the same problem as the previous code). I take the snake part, push it into vector full of snake parts, and the vector itself is saved into the snake. Why doesn't it live long enough?</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "is_accepted": true, "score": 7, "last_activity_date": 1579976040, "last_edit_date": 1579976040, "creation_date": 1561727862, "answer_id": 56807685, "question_id": 56807445, "link": "https://stackoverflow.com/questions/56807445/what-does-do-in-rust/56807685#56807685", "title": "What does \u201c&amp;*\u201d do in Rust", "body": "<p>This is an explicit reborrow and it's a common idiom that pops up in Rust from time to time.</p>\n\n<ul>\n<li><p><code>&amp;</code> in an expression only has one meaning: it takes an expression (which must be a <a href=\"https://stackoverflow.com/a/51346943/3650362\">place expression</a>) of type <code>T</code> and borrows a reference to it of type <code>&amp;T</code>.</p></li>\n<li><p>For references, <code>*</code> does the opposite of <code>&amp;</code> -- it takes a reference (<code>&amp;T</code>) and makes a place expression of type <code>T</code>. But <code>*</code> can mean different things with different kinds of pointers, since you can override it by implementing <code>Deref</code>. Because <code>*</code> ties in some compiler magic that <a href=\"https://stackoverflow.com/q/31624743/1233251\">automatically dereferences the return value of <code>Deref::deref</code></a>, you can borrow the result of <code>*</code>, turning it back into a plain reference, by using the <code>&amp;</code> operator.</p></li>\n</ul>\n\n<p>So <code>&amp;*foo</code> is a way of explicitly reborrowing \"any kind of pointer to <code>T</code>\" as a <code>&amp;T</code>, and is the equivalent of manually calling <code>Deref::deref(&amp;foo)</code>.</p>\n\n<p>(The above explanation also works for <code>&amp;mut</code> borrows -- just replace <code>&amp;</code> with <code>&amp;mut</code> and <code>Deref</code> with <code>DerefMut</code>.)</p>\n\n<p>It's not clear in the example you link what <code>entities</code> is, but it's probably some kind of smart pointer, where the <code>join()</code> method requires a plain reference. For another example where this is required, consider using <a href=\"https://doc.rust-lang.org/std/primitive.slice.html#method.concat\" rel=\"nofollow noreferrer\"><code>[&amp;str]::concat</code></a> to concatenate a <code>String</code> with some <code>&amp;str</code>s:</p>\n\n<pre><code>// I want to concatenate this with some other strings\nlet s = String::from(\"Amelia\");\n// The following won't compile: you can't make an array of &amp;str and String\nassert_eq!([\"Hello\", \", \", s].concat(), \"Hello, Amelia\");    // WRONG\n// However, &amp;*s takes a reference to the str pointed to by s.\nassert_eq!([\"Hello\", \", \", &amp;*s].concat(), \"Hello, Amelia\");  // OK\n</code></pre>\n\n<h2>See also</h2>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/33860750/3650362\">Is there a difference between slicing and an explicit reborrow when converting Strings to &amp;strs?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/32084849/boxt-to-t-in-rust/32085042#32085042\">Box&lt;T&gt; to &amp;T in Rust</a></li>\n</ul>\n"}], "owner": {"reputation": 93, "user_id": 8174300, "user_type": "registered", "profile_image": "https://graph.facebook.com/1727684347246065/picture?type=large", "display_name": "Tien Nguyen", "link": "https://stackoverflow.com/users/8174300/tien-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 1, "accepted_answer_id": 56807685, "answer_count": 1, "score": 9, "last_activity_date": 1579976040, "creation_date": 1561726833, "question_id": 56807445, "link": "https://stackoverflow.com/questions/56807445/what-does-do-in-rust", "title": "What does \u201c&amp;*\u201d do in Rust", "body": "<p>I encountered this block of code while reading documentation from a Rust library:</p>\n\n<pre><code>for (ent, pos, vel) in (&amp;*entities, &amp;mut pos_storage, &amp;vel_storage).join() {\n    println!(\"Processing entity: {:?}\", ent);\n    *pos += *vel;\n}\n</code></pre>\n\n<p>Original link: <a href=\"https://slide-rs.github.io/specs/08_join.html\" rel=\"noreferrer\">https://slide-rs.github.io/specs/08_join.html</a></p>\n\n<p>What does &amp;*entities do here. From what I can tell it\u2019s dereferencing entities and then referencing it again?</p>\n"}, {"tags": ["for-loop", "rust", "iterator"], "comments": [{"owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "edited": false, "score": 0, "creation_date": 1561724156, "post_id": 56804678, "comment_id": 100167478, "body": "Tangential to your main question, but you should not need to <code>collect</code> inside your <code>flat_map</code> - you&#39;re allowed to return anything that implements <a href=\"https://docs.rs/rayon/1.1.0/rayon/iter/trait.IntoParallelIterator.html\" rel=\"nofollow noreferrer\"><code>IntoParallelIterator</code></a>, which includes <a href=\"https://docs.rs/rayon/1.1.0/rayon/iter/trait.IntoParallelIterator.html#implementors\" rel=\"nofollow noreferrer\">anything that implements <code>ParallelIterator</code></a>. By collecting into a <code>Vec</code>, you&#39;re needlessly allocating, and potentially slowing down your code. The same goes for <code>Iterator::flat_map</code> too."}], "answers": [{"tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": false, "score": 0, "last_activity_date": 1561722990, "creation_date": 1561722990, "answer_id": 56806508, "question_id": 56804678, "link": "https://stackoverflow.com/questions/56804678/convert-nested-for-loops-into-iterators/56806508#56806508", "title": "Convert nested for loops into iterators", "body": "<p>Don't unwrap. Instead generate and iterator of <code>Result</code>s and take advantage of the fact that <a href=\"http://doc.rust-lang.org/std/result/enum.Result.html#method.from_iter\" rel=\"nofollow noreferrer\"><code>Result</code> implements <code>FromIterator</code></a> to collect it into a <code>Result&lt;Vec&gt;</code>.</p>\n\n<p>See also <a href=\"https://stackoverflow.com/a/26370894/5397009\">this answer</a>.</p>\n"}], "owner": {"reputation": 532, "user_id": 5636688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LRDjo.png?s=128&g=1", "display_name": "shempignon", "link": "https://stackoverflow.com/users/5636688/shempignon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 677, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1561725614, "creation_date": 1561715463, "last_edit_date": 1561725614, "question_id": 56804678, "link": "https://stackoverflow.com/questions/56804678/convert-nested-for-loops-into-iterators", "title": "Convert nested for loops into iterators", "body": "<p>Rust-newbie here, I'm having trouble converting the following nested <code>for</code> loops into iterators:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#![allow(unused)]\n\nuse std::io::Error;\n\nfn main() {\n    let realms = vec![\"realm\".to_string()];\n    let auctions = get_auctions(&amp;realms);\n}\n\npub struct Auction;\npub struct RealmAuctionFile;\n\nfn get_realm_auctions(file: &amp;RealmAuctionFile) -&gt; Result&lt;Vec&lt;Auction&gt;, Error&gt; {\n    let auctions = vec![Auction {}];\n\n    Ok(auctions)\n}\n\nfn get_realm_auction_files(realm: &amp;str) -&gt; Result&lt;Vec&lt;RealmAuctionFile&gt;, Error&gt; {\n    let files = vec![RealmAuctionFile {}];\n\n    Ok(files)\n}\n\npub fn get_auctions(realms: &amp;Vec&lt;String&gt;) -&gt; Result&lt;Vec&lt;Auction&gt;, Error&gt; {\n    let mut auctions = vec![];\n\n    for realm in realms.iter() {\n        let files = get_realm_auction_files(realm)?;\n\n        for file in files.iter() {\n            let mut realm_auctions = get_realm_auctions(file)?;\n\n            auctions.append(&amp;mut realm_auctions);\n        }\n    }\n\n    Ok(auctions)\n}\n\npub fn get_auctions_with_iterator(realms: &amp;Vec&lt;String&gt;) -&gt; Result&lt;Vec&lt;Auction&gt;, Error&gt; {\n    let auctions = realms\n        .iter()\n        .flat_map(|realm| {\n            let realms_auctions: Vec&lt;Auction&gt; = get_realm_auction_files(realm)?\n                .iter()\n                .flat_map(|file| {\n                    let auctions = get_realm_auctions(file)?;\n\n                    Ok(auctions)\n                })\n                .collect();\n\n            Ok(realms_auctions)\n        })\n        .collect();\n\n    Ok(auctions)\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=0289b8e2ced6a266ff84a9dccd61abb1\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>I get two errors:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: a collection of type `std::vec::Vec&lt;Auction&gt;` cannot be built from an iterator over elements of type `std::vec::Vec&lt;Auction&gt;`\n  --&gt; src/main.rs:52:18\n   |\n52 |                 .collect();\n   |                  ^^^^^^^ a collection of type `std::vec::Vec&lt;Auction&gt;` cannot be built from `std::iter::Iterator&lt;Item=std::vec::Vec&lt;Auction&gt;&gt;`\n   |\n   = help: the trait `std::iter::FromIterator&lt;std::vec::Vec&lt;Auction&gt;&gt;` is not implemented for `std::vec::Vec&lt;Auction&gt;`\n\nerror[E0277]: a collection of type `std::vec::Vec&lt;Auction&gt;` cannot be built from an iterator over elements of type `std::vec::Vec&lt;Auction&gt;`\n  --&gt; src/main.rs:56:10\n   |\n56 |         .collect();\n   |          ^^^^^^^ a collection of type `std::vec::Vec&lt;Auction&gt;` cannot be built from `std::iter::Iterator&lt;Item=std::vec::Vec&lt;Auction&gt;&gt;`\n   |\n   = help: the trait `std::iter::FromIterator&lt;std::vec::Vec&lt;Auction&gt;&gt;` is not implemented for `std::vec::Vec&lt;Auction&gt;`\n</code></pre>\n\n<p>Also, I can't \"convert\" the <code>.unwrap()</code> with the more idiomatic <code>?</code></p>\n"}, {"tags": ["python", "python-3.x", "rust", "pyo3"], "answers": [{"tags": [], "owner": {"reputation": 776, "user_id": 13568555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/483f54bc3139f26690cc282dffec1d95?s=128&d=identicon&r=PG&f=1", "display_name": "Emerson Harkin", "link": "https://stackoverflow.com/users/13568555/emerson-harkin"}, "is_accepted": false, "score": 5, "last_activity_date": 1590337476, "creation_date": 1590337476, "answer_id": 61988891, "question_id": 56803942, "link": "https://stackoverflow.com/questions/56803942/how-to-call-a-rust-function-from-a-python-file-using-pyo3/61988891#61988891", "title": "How to call a Rust function from a Python file using pyo3?", "body": "<p>If I understood your issue correctly, what you're trying to do involves three steps:</p>\n\n<ol>\n<li>Create a Python module containing the function <code>hello_from_rust()</code></li>\n<li>Use it in a Python script <code>deep_hello.py</code></li>\n<li>Run <code>deep_hello.py</code> from within Rust.</li>\n</ol>\n\n<p>I wasn't able to completely reproduce your issue, but it seems like the root of your problem might be in the first or second step. </p>\n\n<h1>Defining a Python module using PyO3</h1>\n\n<p>From the <a href=\"https://pyo3.rs/v0.10.1/\" rel=\"noreferrer\">PyO3 documentation</a>, I would expect <code>hello_from_rust()</code> to be in a Rust file defining a Python module that looks something like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use pyo3::prelude::*;\nuse pyo3::wrap_pyfunction;\n\n#[pyfunction]\nfn hello_from_rust() {\n    println!(\"Hello from rust from python !\");\n}\n\n#[pymodule]\nfn hello_module(py: Python, m: &amp;PyModule) -&gt; PyResult&lt;()&gt; {\n    m.add_wrapped(wrap_pyfunction!(hello_from_rust));\n\n    Ok(())\n}\n</code></pre>\n\n<p>You can build this into a Python module with Cargo (see <a href=\"https://pyo3.rs/v0.10.1/#using-rust-from-python\" rel=\"noreferrer\">here</a>; instructions are slightly different depending on your OS) and place the resulting <code>.so</code> (Linux or MacOS) or <code>.pyd</code> (Windows) file in the same directory as your Python script.</p>\n\n<h2>Note</h2>\n\n<p>You have to create a function something along the lines of <code>hello_module</code> to initialize your Python module. If you don't, your Rust library might still compile, but you won't be able to import <code>hello_from_rust</code>.</p>\n\n<h1>Using your new Python module</h1>\n\n<p>Your <code>deep_hello.py</code> script should look like this:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>import hello_module\nhello_module.hello_from_rust()\n</code></pre>\n\n<p>Making sure that the <code>.so</code> or <code>.pyd</code> file is accessible in your <code>PYTHON_PATH</code> (eg by putting it in the same directory as your script), running <code>deep_hello.py</code> with Python >= 3.5 should work. (Note that your system Python is probably Python 2, so you might want to create an Anaconda environment with a newer version of Python and work from in there.)</p>\n\n<p>For me, following these steps did the trick.</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>(ruspy) ruspy $ python deep_hello.py\nHello from rust from python !\n</code></pre>\n\n<h2>Note</h2>\n\n<p>Make sure you remember to <code>import hello_module</code> in your Python script! The <code>PyErr</code> returned by your <code>py.run(&amp;script, None, None)</code> makes me wonder if the problem is actually in your Python script, and indeed I would expect <code>hello_from_rust()</code> without a preceding <code>from deep_hello import *</code> to produce a <code>NameError</code>, even if you put together your <code>deep_hello</code> module correctly.</p>\n\n<h1>Calling Rust from Python from Rust</h1>\n\n<p>I'm not totally sure why you want to do this, but you should now be able to run <code>deep_hello.py</code> from Rust.</p>\n"}], "owner": {"reputation": 131, "user_id": 11527078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e53d3fc9e34e4798f2fb1e892f44a3b?s=128&d=identicon&r=PG&f=1", "display_name": "Suraii", "link": "https://stackoverflow.com/users/11527078/suraii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 687, "favorite_count": 0, "answer_count": 1, "score": 13, "last_activity_date": 1590337476, "creation_date": 1561712543, "last_edit_date": 1579617668, "question_id": 56803942, "link": "https://stackoverflow.com/questions/56803942/how-to-call-a-rust-function-from-a-python-file-using-pyo3", "title": "How to call a Rust function from a Python file using pyo3?", "body": "<p>I'm working on a videogame in which I'll need to set Rust objects (like, add a button with <code>texture:\"\", coords:\"\", text:\"\", action:\"\"</code>) from Python files.</p>\n\n<p>I'm using the pyo3 crate to link Python and Rust. I succeed calling Python scripts from my Rust code, but I can't find how to call a Rust function from a Python file.</p>\n\n<p>Rust code that executes my Python script:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() -&gt; PyResult&lt;()&gt; {\n    let gil = Python::acquire_gil();\n    let py = gil.python();\n    let script = fs::read_to_string(\"deep_hello.py\")?;\n\n    println!(\"RUNNING :\\n[\\n{}]\", script);\n    py.run(&amp;script, None, None)\n}\n</code></pre>\n\n<p>Rust function that I'd like to call from my Python script:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>/// hello_from_rust(/)\n/// --\n///\n/// This function prints hello because she is very nice.\n#[pyfunction]\nfn hello_from_rust() {\n    println!(\"Hello from rust from python !\");\n}\n</code></pre>\n\n<p>My Python script:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>hello_from_rust()\n</code></pre>\n\n<p>I'm getting this output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>RUNNING :\n[\nhello_from_rust()\n]\nError: PyErr { type: Py(0x7f9cdd1e9580, PhantomData) }\n</code></pre>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 4182, "user_id": 2992101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7363e9ce46406af3326492e2f6cf40ca?s=128&d=identicon&r=PG", "display_name": "michalsrb", "link": "https://stackoverflow.com/users/2992101/michalsrb"}, "is_accepted": true, "score": 5, "last_activity_date": 1561708709, "last_edit_date": 1561708709, "creation_date": 1561706809, "answer_id": 56802650, "question_id": 56802468, "link": "https://stackoverflow.com/questions/56802468/rust-pattern-matching-with-an-existing-binding/56802650#56802650", "title": "Rust pattern matching with an existing binding?", "body": "<p>Many rust constructs can be used as expressions, i.e. they can return a value. So if every branch of your match returns a value of the same type, you can assign it directly into a variable. It does not need to be mutable unless you plan to change it later.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let mut reader = BufReader::new(file);\nlet mut bom: [u8; 3] = [0; 3];\n\nif let Ok(_) = reader.read_exact(&amp;mut bom) {\n    let enc = match Encoding::for_bom(&amp;bom) {\n        Some((encoding, _)) =&gt; Some(encoding),\n        None =&gt; Encoding::for_label(\"UTF-8\".as_bytes()),\n    };\n\n    if let Some(encoding) = enc {\n        println!(\"{:?}\", encoding);\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4182, "user_id": 2992101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7363e9ce46406af3326492e2f6cf40ca?s=128&d=identicon&r=PG", "display_name": "michalsrb", "link": "https://stackoverflow.com/users/2992101/michalsrb"}, "edited": false, "score": 0, "creation_date": 1561707011, "post_id": 56802658, "comment_id": 100159715, "body": "Also good answer. Combinators and manually written <code>match</code> end up almost the same length in this case, so it is a matter of taste which one to choose."}], "tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": false, "score": 1, "last_activity_date": 1593040170, "last_edit_date": 1593040170, "creation_date": 1561706845, "answer_id": 56802658, "question_id": 56802468, "link": "https://stackoverflow.com/questions/56802468/rust-pattern-matching-with-an-existing-binding/56802658#56802658", "title": "Rust pattern matching with an existing binding?", "body": "<p>I'd use a combination of <a href=\"https://doc.rust-lang.org/stable/std/option/enum.Option.html#method.map\" rel=\"nofollow noreferrer\"><code>map</code></a> and <a href=\"https://doc.rust-lang.org/stable/std/option/enum.Option.html#method.or_else\" rel=\"nofollow noreferrer\"><code>or_else</code></a>:</p>\n<pre><code>let enc = Encoding::for_bom(&amp;bom)\n    .map(|t| t.0)\n    .or_else(|| Encoding::for_label (&quot;UTF-8&quot;.as_bytes()));\n</code></pre>\n<p>Or (clearer but slightly longer):</p>\n<pre><code>let enc = Encoding::for_bom(&amp;bom)\n    .map(|(e, _)| e)\n    .or_else(|| Encoding::for_label (&quot;UTF-8&quot;.as_bytes()));\n</code></pre>\n"}], "owner": {"reputation": 10595, "user_id": 325320, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/23bc4a16f6a4bac91accd76c8078cd35?s=128&d=identicon&r=PG", "display_name": "Mr.Wang from Next Door", "link": "https://stackoverflow.com/users/325320/mr-wang-from-next-door"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 56802650, "answer_count": 2, "score": 2, "last_activity_date": 1593040170, "creation_date": 1561706038, "last_edit_date": 1561708238, "question_id": 56802468, "link": "https://stackoverflow.com/questions/56802468/rust-pattern-matching-with-an-existing-binding", "title": "Rust pattern matching with an existing binding?", "body": "<p>I am learning Rust from yesterday. The following code is simple -- </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use encoding_rs::Encoding;\nuse std::fs;\nuse std::fs::File;\nuse std::io::BufReader;\nuse std::io::Read;\nuse std::option::Option;\nuse std::path::Path;\n\nextern crate encoding_rs;\nextern crate encoding_rs_io;\n\nfn main() {\n    let mut reader = BufReader::new(file);\n    let mut bom: [u8; 3] = [0; 3];\n\n    // read BOM\n    if let Ok(_) = reader.read_exact(&amp;mut bom) {\n        // sniff BOM\n\n        // Because Rust disallows NULLs, hence I declare `Option&lt;&amp;Encoding&gt;` to store the result of encoding.\n        let mut enc: Option&lt;&amp;Encoding&gt; = None;\n        match Encoding::for_bom(&amp;bom) {\n            Some((encoding, _)) =&gt; {\n                // &lt;-- Some((enc, _))\n                enc = Some(encoding);\n            }\n            None =&gt; {\n                if let Some(encoding) = Encoding::for_label(\"UTF-8\".as_bytes()) {\n                    enc = Some(encoding);\n                }\n            }\n        }\n\n        if let Some(encoding) = enc {\n            println!(\"{:?}\", encoding);\n        }\n    }\n}\n</code></pre>\n\n<p>It opens a text file, and try to analyze its encoding by parsing BOM(Byte Order Marker).  If <code>Encoding::for_bom</code> does not return an encoding, the code will take use <code>UTF-8</code> as default. </p>\n\n<p>I dislike <code>unwrap()</code> because it always assume there is a valid result</p>\n\n<p>My question is : is there a way to do pattern matching and put the result directly into an existing mutable binding?</p>\n\n<p>e.g. Change <code>Some((encoding, _))</code> to <code>Some((enc, _))</code> hence I don't need the line of <code>enc = Some(encoding)</code></p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 4, "creation_date": 1561707413, "post_id": 56802486, "comment_id": 100159890, "body": "cast a char to a u8 is not a good thing to do use <code>bytes()</code> directly in this case."}, {"owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "edited": false, "score": 1, "creation_date": 1561709308, "post_id": 56802486, "comment_id": 100160628, "body": "You had your condition wrong. But even you correct it, It is not the behavior you asked. It skips until the first occurence and the string you get is only the first part skipped until the /n occurs. <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2d616c66b1a6b4c07514765d847f8437\" rel=\"nofollow noreferrer\">Playground</a>"}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 1619, "user_id": 4661875, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/KeUsL.png?s=128&g=1", "display_name": "Bussller", "link": "https://stackoverflow.com/users/4661875/bussller"}, "edited": false, "score": 1, "creation_date": 1561728455, "post_id": 56802486, "comment_id": 100169671, "body": "@RussellB: <code>take</code> and <code>skip</code> are common in functional languages for list operations: <code>take</code> will return a prefix list, and <code>skip</code> will return a suffix. There are variants build upon them: take/skip a number of elements, and take/skip while a predicate is true or until it becomes true. <code>skip_while</code> inherits this tradition, and therefore skip elements as long as the predicate is true, then returns whatever is remaining. In your case, since the predicate is false on the first element, it immediately stops skipping and returns the whole list."}], "tags": [], "owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "is_accepted": true, "score": 3, "last_activity_date": 1561709157, "last_edit_date": 1561709157, "creation_date": 1561706104, "answer_id": 56802486, "question_id": 56802302, "link": "https://stackoverflow.com/questions/56802302/how-to-remove-newline-characters-from-a-string/56802486#56802486", "title": "How to remove newline characters from a String?", "body": "<p>You can basically replace the <code>\\n</code> from the string then convert it to <code>Vec&lt;u8&gt;</code> with <a href=\"https://doc.rust-lang.org/std/string/struct.String.html#method.into_bytes\" rel=\"nofollow noreferrer\">into_bytes()</a></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn parse(s: String) -&gt; Vec&lt;u8&gt; {\n    s.replace(\"\\n\", \"\").into_bytes()\n}\n</code></pre>\n\n<hr>\n\n<p>If you want to do it with iterators you can do it with filter:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn parse(s: String) -&gt; Vec&lt;u8&gt; {\n    s.chars().filter(|c| *c != '\\n').map(|c| c as u8).collect()\n}\n</code></pre>\n\n<p>You can call it like following:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::str::from_utf8;\n\nfn main() {\n    let my_string = String::from(\"AAAAAAAA\\nBBBBBBBBB\\nCCCCCC\\nDDDDD\\n\\n\");\n    let parsed_string = parse(my_string.clone());\n    println!(\"{:?}\", from_utf8(&amp;parsed_string));\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=4643e1bee2986ccd31068a1685033ee9\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 1619, "user_id": 4661875, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/KeUsL.png?s=128&g=1", "display_name": "Bussller", "link": "https://stackoverflow.com/users/4661875/bussller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 871, "favorite_count": 0, "accepted_answer_id": 56802486, "answer_count": 1, "score": 4, "last_activity_date": 1593040453, "creation_date": 1561705188, "last_edit_date": 1593040453, "question_id": 56802302, "link": "https://stackoverflow.com/questions/56802302/how-to-remove-newline-characters-from-a-string", "title": "How to remove newline characters from a String?", "body": "<p>I'm trying to remove newline characters from a <code>String</code> (file content read from a file) and convert it to a <code>Vec&lt;u8&gt;</code>.</p>\n<p>Example input string:</p>\n<pre><code>let ss = String::from(&quot;AAAAAAAA\\nBBBBBBBBB\\nCCCCCC\\nDDDDD\\n\\n&quot;);\n</code></pre>\n<pre class=\"lang-rust prettyprint-override\"><code>fn parse(s: String) -&gt; Vec&lt;u8&gt; {\n    let s = s.chars().skip_while(|c| *c == '\\n');\n    let sett = s.into_iter().map(|c| c as u8).collect();\n    sett\n}\n</code></pre>\n<p>While I get no error, <code>skip_while</code> doesn't seem to remove the newline characters from the string. What am I doing wrong here?</p>\n"}, {"tags": ["rust", "switch-statement", "match", "fall-through"], "comments": [{"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 1, "creation_date": 1561704188, "post_id": 56802007, "comment_id": 100158514, "body": "that&#39;s called <a href=\"https://stackoverflow.com/questions/tagged/fall-through\">fall-through</a>. See <a href=\"https://stackoverflow.com/q/42509526/995714\">Idiomatic match with fall-through in Rust</a>"}, {"owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 1, "creation_date": 1561740397, "post_id": 56802007, "comment_id": 100175285, "body": "How does the marked duplicate provides an answer to this question ? A playground link please :)"}, {"owner": {"reputation": 5189, "user_id": 5223757, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FdOvO.png?s=128&g=1", "display_name": "wizzwizz4", "link": "https://stackoverflow.com/users/5223757/wizzwizz4"}, "edited": false, "score": 0, "creation_date": 1574006834, "post_id": 56802007, "comment_id": 104067896, "body": "I don&#39;t think the duplicate actually answers the general case of this question."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1574027894, "post_id": 56802007, "comment_id": 104073945, "body": "I believe Matthieu&#39;s answer to the other question adequately answers this one. That is: fall-through is not supported, so you&#39;ll need a loop."}, {"owner": {"reputation": 2337, "user_id": 930169, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/be36a036900e8c4a2d810db772e43280?s=128&d=identicon&r=PG", "display_name": "JACK M", "link": "https://stackoverflow.com/users/930169/jack-m"}, "edited": false, "score": 0, "creation_date": 1574129474, "post_id": 56802007, "comment_id": 104112445, "body": "If you would like to check how fall-through is implemented in Rust, check this repo <a href=\"https://github.com/yyklll/murmurhash3\" rel=\"nofollow noreferrer\">github.com/yyklll/murmurhash3</a>"}], "owner": {"reputation": 2337, "user_id": 930169, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/be36a036900e8c4a2d810db772e43280?s=128&d=identicon&r=PG", "display_name": "JACK M", "link": "https://stackoverflow.com/users/930169/jack-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 207, "favorite_count": 1, "closed_date": 1561705766, "answer_count": 0, "score": 4, "last_activity_date": 1574010918, "creation_date": 1561703729, "last_edit_date": 1574010918, "question_id": 56802007, "link": "https://stackoverflow.com/questions/56802007/c-style-switch-statement-with-fall-through-in-rust", "closed_reason": "Duplicate", "title": "C-style switch statement with fall-through in Rust", "body": "<p>The <code>match</code> in Rust only executes one arm. I found this <a href=\"https://github.com/aappleby/smhasher/blob/master/src/MurmurHash3.cpp\" rel=\"nofollow noreferrer\">code snippet from Murmurhash 3</a>:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>switch(len &amp; 15)\n{\n  case 15: k2 ^= ((uint64_t)tail[14]) &lt;&lt; 48;\n  case 14: k2 ^= ((uint64_t)tail[13]) &lt;&lt; 40;\n  case 13: k2 ^= ((uint64_t)tail[12]) &lt;&lt; 32;\n  case 12: k2 ^= ((uint64_t)tail[11]) &lt;&lt; 24;\n  case 11: k2 ^= ((uint64_t)tail[10]) &lt;&lt; 16;\n  case 10: k2 ^= ((uint64_t)tail[ 9]) &lt;&lt; 8;\n  case  9: k2 ^= ((uint64_t)tail[ 8]) &lt;&lt; 0;\n           k2 *= c2; k2  = ROTL64(k2,33); k2 *= c1; h2 ^= k2;\n\n  case  8: k1 ^= ((uint64_t)tail[ 7]) &lt;&lt; 56;\n  case  7: k1 ^= ((uint64_t)tail[ 6]) &lt;&lt; 48;\n  case  6: k1 ^= ((uint64_t)tail[ 5]) &lt;&lt; 40;\n  case  5: k1 ^= ((uint64_t)tail[ 4]) &lt;&lt; 32;\n  case  4: k1 ^= ((uint64_t)tail[ 3]) &lt;&lt; 24;\n  case  3: k1 ^= ((uint64_t)tail[ 2]) &lt;&lt; 16;\n  case  2: k1 ^= ((uint64_t)tail[ 1]) &lt;&lt; 8;\n  case  1: k1 ^= ((uint64_t)tail[ 0]) &lt;&lt; 0;\n           k1 *= c1; k1  = ROTL64(k1,31); k1 *= c2; h1 ^= k1;\n};\n\n</code></pre>\n\n<p>This <code>switch</code> is the traditional C <code>switch</code>. Is it possible to write this in Rust in an elegant way? I couldn't find a way to implement this with <code>match</code>.</p>\n"}, {"tags": ["vector", "rust", "slice"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1561699979, "post_id": 56801339, "comment_id": 100157123, "body": "<code>Box&lt;Vec&lt;Value&gt;&gt;</code> box a vector make no sense"}, {"owner": {"reputation": 79, "user_id": 8569114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3f5ed4f9c6a2b27fbecf544998a43da?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Vene", "link": "https://stackoverflow.com/users/8569114/joan-vene"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1561700233, "post_id": 56801339, "comment_id": 100157185, "body": "@Stargateur well, if the vector inside the enum is unboxed, the enum size will be 32 bytes, instead of the 16 bytes it would be if boxed. This might be important in certain situations"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1561700237, "post_id": 56801339, "comment_id": 100157187, "body": "<a href=\"https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=e2813856628ca9b0f68af85fb632d862\" rel=\"nofollow noreferrer\">play.integer32.com/&hellip;</a>, I don&#39;t see your problem"}, {"owner": {"reputation": 79, "user_id": 8569114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3f5ed4f9c6a2b27fbecf544998a43da?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Vene", "link": "https://stackoverflow.com/users/8569114/joan-vene"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1561700890, "post_id": 56801339, "comment_id": 100157388, "body": "@Stargateur you&#39;re right! I just tried returning an unboxed vector from a function, and everything works well. The issue was that I was not specifying the lifetime for the vector, hence the <code>Box</code>. Thank you :)"}, {"owner": {"reputation": 79, "user_id": 8569114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3f5ed4f9c6a2b27fbecf544998a43da?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Vene", "link": "https://stackoverflow.com/users/8569114/joan-vene"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1561701167, "post_id": 56801339, "comment_id": 100157468, "body": "@Stargateur but is there a way to decrease the size to 16? It is 24 now. It&#39;s not a big deal, but I figured I would ask"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1561701397, "post_id": 56801339, "comment_id": 100157534, "body": "I don&#39;t think slice need fat pointer and enum need some space too, note that you should not worry too much about that, code, and see after if it&#39;s a problem."}], "answers": [{"tags": [], "owner": {"reputation": 17491, "user_id": 901827, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86a6acccf7e8dbe398ebda4f8524ed50?s=128&d=identicon&r=PG", "display_name": "LinearZoetrope", "link": "https://stackoverflow.com/users/901827/linearzoetrope"}, "is_accepted": false, "score": 1, "last_activity_date": 1561703684, "last_edit_date": 1561703684, "creation_date": 1561702895, "answer_id": 56801851, "question_id": 56801339, "link": "https://stackoverflow.com/questions/56801339/accept-both-slice-and-vec-in-rust-enum-struct/56801851#56801851", "title": "Accept both slice and Vec in Rust enum/struct", "body": "<p>I <em>think</em> the closest thing to what you want is the <a href=\"https://doc.rust-lang.org/std/convert/trait.AsRef.html\" rel=\"nofollow noreferrer\"><code>AsRef</code></a> trait. Notably, <code>Vec&lt;T&gt;</code>, <code>[T]</code>, and <code>[T;n]</code> for <code>n &lt;= 32</code> implement <code>AsRef&lt;[T]&gt;</code>, as do a few other things (like an iterator over a slice). Additionally, <code>Box&lt;T&gt;</code> implements <code>AsRef&lt;T&gt;</code>, but your scenario of <code>Box&lt;Vec&lt;T&gt;&gt;</code> won't quite work here. The gets a little hairy with an enum, though. The type description doesn't quite work as:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>enum Value&lt;S&gt;\n    where S: AsRef&lt;[Value&lt;S&gt;]&gt;\n{\n    Int(i64),\n    Flt(f64),\n    Slice(S),\n}\n</code></pre>\n\n<p>Because you're committed to instantiating exactly one <code>S</code> at a time, and fixing that requires using a <code>Box&lt;dyn S&gt;</code> to make it heterogeneous which gets really messy.</p>\n\n<p>If you can refactor to make this work at the function level or create a higher level type above <code>Value</code>, you can have functions like</p>\n\n<pre><code>fn foo&lt;S&gt;(slice: S) where S: AsRef&lt;[Value]&gt; { }\n</code></pre>\n\n<p>Fairly easily with this construction, however. In this case if you have a <code>Box&lt;Vec&lt;Value&gt;&gt;</code> the invocation <code>foo(my_vec)</code> won't <em>quite</em> work, but can trivially be fixed with dereferencing since <code>Box&lt;[T]&gt;</code> implements <code>From&lt;Vec&lt;T&gt;&gt;</code>.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::convert::AsRef;\n\nenum Value\n{\n    Int(i64),\n    Flt(f64),\n}\n\nfn main() {\n    use Value::*;\n\n    let x = Box::new(vec![Int(5),Flt(22.5),Int(22)]);\n    foo(*x)\n}\n\nfn foo&lt;S&gt;(slice: S) where S: AsRef&lt;[Value]&gt; {\n\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=734f1b477bf45fd6572ce82dbedceb4a\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 102109, "user_id": 1600898, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/01377f8b31f24b0265854666b29d0c03?s=128&d=identicon&r=PG", "display_name": "user4815162342", "link": "https://stackoverflow.com/users/1600898/user4815162342"}, "edited": false, "score": 0, "creation_date": 1614153527, "post_id": 56802435, "comment_id": 117295271, "body": "There seems to be a <a href=\"https://github.com/rust-lang/rust/issues/47032#issuecomment-568784919\" rel=\"nofollow noreferrer\">workaround</a> for using <code>Cow</code> - I haven&#39;t yet tried to apply it to this case."}], "tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": true, "score": 2, "last_activity_date": 1561705874, "creation_date": 1561705874, "answer_id": 56802435, "question_id": 56801339, "link": "https://stackoverflow.com/questions/56801339/accept-both-slice-and-vec-in-rust-enum-struct/56802435#56802435", "title": "Accept both slice and Vec in Rust enum/struct", "body": "<p>What you want is <a href=\"https://doc.rust-lang.org/stable/std/borrow/enum.Cow.html\" rel=\"nofollow noreferrer\"><code>Cow</code></a>:</p>\n\n<pre><code>enum Value&lt;'a&gt; {\n    Int (i64),\n    Flt (f64),\n    Vec (Cow&lt;'a, [Value&lt;'a&gt;]&gt;),\n}\n</code></pre>\n\n<p>Unfortunately this doesn't work because of <a href=\"https://github.com/rust-lang/rust/issues/38962\" rel=\"nofollow noreferrer\">#38962</a>. Until that issue is fixed, you may need to re-implement a specialized version of <code>Cow</code> for <code>Value</code>:</p>\n\n<pre><code>enum MyCow&lt;'a&gt; {\n    Borrowed (&amp;'a[Value&lt;'a&gt;]),\n    Owned (Vec&lt;Value&lt;'a&gt;&gt;)\n}\n\nimpl&lt;'a&gt; Deref for MyCow&lt;'a&gt; {\n    type Target = [Value&lt;'a&gt;];\n    fn deref (&amp;self) -&gt; &amp;[Value&lt;'a&gt;] {\n        use crate::MyCow::{ Borrowed, Owned };\n        match *self {\n            Borrowed (borrowed) =&gt; borrowed,\n            Owned (ref owned) =&gt; &amp;owned,\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=ef1672a938ea1462034bd1cfb618c633\" rel=\"nofollow noreferrer\">playground</a></p>\n"}], "owner": {"reputation": 79, "user_id": 8569114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3f5ed4f9c6a2b27fbecf544998a43da?s=128&d=identicon&r=PG&f=1", "display_name": "Joan Vene", "link": "https://stackoverflow.com/users/8569114/joan-vene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 687, "favorite_count": 0, "accepted_answer_id": 56802435, "answer_count": 2, "score": 2, "last_activity_date": 1561705874, "creation_date": 1561699597, "question_id": 56801339, "link": "https://stackoverflow.com/questions/56801339/accept-both-slice-and-vec-in-rust-enum-struct", "title": "Accept both slice and Vec in Rust enum/struct", "body": "<p>I have some code similar to this</p>\n\n<pre><code>enum Value&lt;'a&gt; {\n    Int(i64),\n    Flt(f64),\n    Vec(&amp;'a [Value&lt;'a&gt;]),\n}\n</code></pre>\n\n<p>and this lets me reuse some data; however, some times I want to accept heap-allocated data, so I would need something like this</p>\n\n<pre><code>enum Value {\n   Int(i64),\n   Flt(f64),\n   Vec(Box&lt;Vec&lt;Value&gt;&gt;),\n}\n</code></pre>\n\n<p>but now I cannot accept slices! I know I could always have both of them in the same enum, like this</p>\n\n<pre><code>enum Value&lt;'a&gt; {\n   Int(i64),\n   Flt(f64),\n   VecSlice(&amp;'a [Value&lt;'a&gt;]),\n   VecBox(Box&lt;Vec&lt;Value&lt;'a&gt;&gt;&gt;),\n}\n</code></pre>\n\n<p>but this is very ugly.</p>\n\n<p><strong>Is there a way to have a struct or enum that accepts both slices and vectors in the same member/variant?</strong></p>\n\n<p>I know that for functions accepting &amp;str and String we can just set the parameters to something like <code>T: Into&lt;String&gt;</code> but I have not figured out how to do something like this for vectors inside data types.</p>\n"}, {"tags": ["rust", "substrate"], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 11711456, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ytzu-Px69jI/AAAAAAAAAAI/AAAAAAAAABQ/nm52jlGuQqs/photo.jpg?sz=128", "display_name": "Kaichao Sun", "link": "https://stackoverflow.com/users/11711456/kaichao-sun"}, "is_accepted": true, "score": 1, "last_activity_date": 1561711886, "last_edit_date": 1561711886, "creation_date": 1561697762, "answer_id": 56801090, "question_id": 56801076, "link": "https://stackoverflow.com/questions/56801076/is-there-a-way-for-me-to-use-the-standard-resultt-e-type-inside-a-substrate-m/56801090#56801090", "title": "Is there a way for me to use the standard Result&lt;T, E&gt; type inside a Substrate module?", "body": "<p>It's possible to use the Rust standard Result type in a module's private function, but not the dispatchable function.</p>\n\n<p>You need to import it first by <code>use rstd::result</code>, then use it like <code>result::Result&lt;your-value-type, your-error-type&gt;</code>.</p>\n"}], "owner": {"reputation": 31, "user_id": 11711456, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ytzu-Px69jI/AAAAAAAAAAI/AAAAAAAAABQ/nm52jlGuQqs/photo.jpg?sz=128", "display_name": "Kaichao Sun", "link": "https://stackoverflow.com/users/11711456/kaichao-sun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 56801090, "answer_count": 1, "score": 2, "last_activity_date": 1561711886, "creation_date": 1561697661, "last_edit_date": 1561698053, "question_id": 56801076, "link": "https://stackoverflow.com/questions/56801076/is-there-a-way-for-me-to-use-the-standard-resultt-e-type-inside-a-substrate-m", "title": "Is there a way for me to use the standard Result&lt;T, E&gt; type inside a Substrate module?", "body": "<p>Substrate already defines its own result type as <code>Result&lt;(), &amp;'static str&gt;</code> and doesn't let me use the generic type. How can I use the Rust standard <code>Result&lt;T, E&gt;</code> type?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1561673898, "post_id": 56798996, "comment_id": 100152719, "body": "I prefer this: <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=ea20ce1818c495e8cfdf212805f60f61\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "edited": false, "score": 0, "creation_date": 1561673966, "post_id": 56798996, "comment_id": 100152735, "body": "@mcarton Thank you, really appreciate this answer. Thanks for mentioning the more common ways of doing this, it really helps!"}, {"owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1561674016, "post_id": 56798996, "comment_id": 100152748, "body": "@Stargateur That code mutates the original array, which is a little different than the c++ code and what want to achieve"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "edited": false, "score": 2, "creation_date": 1561674565, "post_id": 56798996, "comment_id": 100152902, "body": "@boinkboink Oh indeed that odd, well in this case I would prefer this <a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=09e6e277be2b2db4e0563de386c980e7\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>."}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1561674709, "post_id": 56798996, "comment_id": 100152942, "body": "For any non-trivial example, I probably would have stuck a <code>map</code> in there too actually."}, {"owner": {"reputation": 100185, "user_id": 3234959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93bb12ca0f93dfddb33880316f7e66c2?s=128&d=identicon&r=PG&f=1", "display_name": "chi", "link": "https://stackoverflow.com/users/3234959/chi"}, "edited": false, "score": 1, "creation_date": 1561713065, "post_id": 56798996, "comment_id": 100162339, "body": "It is a pity that rust generates a warning, suggesting to remove the parentheses in <code>&amp;(mut i)</code> which are not redundant. Well, at least we have <code>#[allow(unused_parens)]</code>."}], "tags": [], "owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "is_accepted": true, "score": 5, "last_activity_date": 1561673392, "creation_date": 1561673392, "answer_id": 56798996, "question_id": 56798930, "link": "https://stackoverflow.com/questions/56798930/iterating-an-array-with-a-local-mutable-copy-in-rust/56798996#56798996", "title": "Iterating an array with a local mutable copy in Rust", "body": "<p>Yes!</p>\n\n<p>The left part of a <code>for</code> is a pattern.</p>\n\n<p>There are three patterns that you need for this:</p>\n\n<ul>\n<li><code>&amp;pat</code> as you already have, because you get references when iterating.</li>\n<li><code>mut name</code> that creates a mutable binding. You are currently using the <code>name</code> pattern, which creates an immutable binding, arguably the simplest of the patterns!</li>\n<li><code>(pat)</code> where parenthesis can be used to disambiguate sub-patterns.</li>\n</ul>\n\n<p>Patterns can be combined together which would give:</p>\n\n<pre><code>for &amp;(mut i) in &amp;[1, 2, 3, 4, 5] {\n    i += 1;\n    println!(\"{}\", i);\n}\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=246d9259bab110ec3c6b0a134a5eced4\" rel=\"noreferrer\">Permalink to the playground</a>)</p>\n\n<p>The parenthesis are necessary to disambiguate from another pattern <code>&amp;mut pat</code> which means binding a mutable reference, which isn't the same.</p>\n\n<p>However, I wouldn't say this is very common, and a more common way would be to do this is two steps:</p>\n\n<pre><code>for &amp;i in &amp;[1, 2, 3, 4, 5] {\n    let i = i + 1;\n    println!(\"{}\", i);\n}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>for &amp;i in &amp;[1, 2, 3, 4, 5] {\n    let mut i = i; // rebind as mutable\n    i += 1;\n    println!(\"{}\", i);\n}\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 11676933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76e9fc3938dabb6cd0c9d485a6103eb3?s=128&d=identicon&r=PG&f=1", "display_name": "boinkboink", "link": "https://stackoverflow.com/users/11676933/boinkboink"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 2, "accepted_answer_id": 56798996, "answer_count": 1, "score": 6, "last_activity_date": 1561673392, "creation_date": 1561672862, "last_edit_date": 1561673177, "question_id": 56798930, "link": "https://stackoverflow.com/questions/56798930/iterating-an-array-with-a-local-mutable-copy-in-rust", "title": "Iterating an array with a local mutable copy in Rust", "body": "<p>I am a Rust beginner and could not find anything regarding this in the docs. Would appreciate any help.\nThe following loop in C++ </p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>for (const int i : {1,2,3,4,5})\n  cout &lt;&lt; i;\n</code></pre>\n\n<p>roughly translates into</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>for &amp;i in &amp;[1,2,3,4,5] {\n    println!(\"{}\", i);\n}\n</code></pre>\n\n<p>Is there a way to write the equivalent of</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>for (int i : {1,2,3,4,5}) {\n  i += 1;\n  cout &lt;&lt; i;\n}\n</code></pre>\n\n<p>in Rust concisely? Namely is there a shorthand to make a local mutable copy of whats being iterated over?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1561671442, "post_id": 56798705, "comment_id": 100152093, "body": "Not exact duplicates but see <a href=\"https://stackoverflow.com/questions/54982977/rust-hashmap-why-do-i-need-a-double-ampersand\">Rust HashMap: Why do I need a double ampersand?</a> and <a href=\"https://stackoverflow.com/questions/43828013/why-is-being-used-here\">why is \u201c&amp;&amp;\u201d being used here?</a>"}, {"owner": {"reputation": 1446, "user_id": 2923937, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e584af3bf364d2fa35ea9be1eb305ad?s=128&d=identicon&r=PG&f=1", "display_name": "Perplexabot", "link": "https://stackoverflow.com/users/2923937/perplexabot"}, "edited": false, "score": 0, "creation_date": 1561671497, "post_id": 56798705, "comment_id": 100152105, "body": "Not familiar with rust. If it has a <code>type()</code> function or something similar I would print that out for <code>s</code> in both the snippets above and compare. I suspect it has to do with the double reference (<code>&amp;&amp;str</code>) shown in the error."}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 1, "creation_date": 1561671540, "post_id": 56798705, "comment_id": 100152121, "body": "TL;DR: you have a vector of references (<code>T == &amp;str</code>), <code>get</code> returns an optional reference (<code>Option&lt;&amp;T&gt;</code>), which means you got two references (<code>Option&lt;&amp;&amp;str&gt;</code>)."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1561673291, "post_id": 56798705, "comment_id": 100152585, "body": "<a href=\"https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=a1640110af6b89d85daa5ad655f97663\" rel=\"nofollow noreferrer\">play.integer32.com/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 96489, "user_id": 788207, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/KQmlY.jpg?s=128&g=1", "display_name": "Vladimir Matveev", "link": "https://stackoverflow.com/users/788207/vladimir-matveev"}, "is_accepted": true, "score": 0, "last_activity_date": 1561684031, "last_edit_date": 1561684031, "creation_date": 1561683599, "answer_id": 56799867, "question_id": 56798705, "link": "https://stackoverflow.com/questions/56798705/how-to-use-a-vector-of-string-slices/56799867#56799867", "title": "How to use a vector of string slices", "body": "<p>The <code>Vec::&lt;T&gt;::get()</code> method returns an <code>Option&lt;&amp;T&gt;</code>, that is, an option of a reference into the vector. Because your vector already contains references (<code>&amp;str</code>), it means that <code>get()</code> in your case returns <code>Option&lt;&amp;&amp;str&gt;</code>.</p>\n\n<p>Now, the reason why your first example compiles is that by being explicit about the type of the <code>s</code> variable you cause <a href=\"https://doc.rust-lang.org/book/ch15-02-deref.html#implicit-deref-coercions-with-functions-and-methods\" rel=\"nofollow noreferrer\">deref coercion</a> to fire, that is, the compiler will automatically insert a dereference operator:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// You write this:\nlet s: &amp;str = v.get(0).unwrap();\n\n// Compiler actually does this:\nlet s: &amp;str = *v.get(0).unwrap();\n</code></pre>\n\n<p>Then, because there <a href=\"https://doc.rust-lang.org/std/string/struct.String.html#impl-From%3C%26%27_%20str%3E\" rel=\"nofollow noreferrer\">exists</a> an implementation of the <code>From&lt;&amp;str&gt;</code> trait for <code>String</code>, the compiler accepts the <code>String::from(s)</code> call.</p>\n\n<p>In the second piece, however, without an explicit type annotation the type assigned to <code>s</code> is <code>&amp;&amp;str</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let s: &amp;&amp;str = v.get(0).unwrap();\n</code></pre>\n\n<p>This changes the situation with the <code>String::from()</code> method: there is no <code>From&lt;&amp;&amp;str&gt;</code> implementation for <code>String</code>, and the compiler fails to compile the code.</p>\n\n<p>A logical question here would be why no deref coercion happens in this case, when <code>s</code> is used as an argument for <code>from()</code>? The answer is that deref coercion does not happen for generic methods, and <code>String::from</code> is a generic method because it relies on the type parameter of the <code>From</code> trait. The compiler can't do a deref coercion, because it is <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=4061a2d804bc160797bc75f17bef8247\" rel=\"nofollow noreferrer\">totally possible</a> (in principle) to have both <code>From&lt;&amp;str&gt;</code> and <code>From&lt;&amp;&amp;str&gt;</code> methods which would potentially do different things.</p>\n\n<p>Even if <code>From&lt;&amp;&amp;str&gt;</code> does not exist now, and the compiler would have applied a deref coercion, it would make the code brittle against future evolution: if for some reason <code>From&lt;&amp;&amp;str&gt;</code> is added in a future version of the standard library, your code may silently break, because it will now call a different method than before, with potentially different logic.</p>\n\n<p>(Naturally, I'm not saying that <code>From&lt;&amp;&amp;str&gt;</code> would indeed be added in the future libstd version; this is generic reasoning applicable to any kind of trait, in any code base).</p>\n"}], "owner": {"reputation": 577, "user_id": 1075870, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5ee326c803355a02b32c266c5830a167?s=128&d=identicon&r=PG", "display_name": "otm", "link": "https://stackoverflow.com/users/1075870/otm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 56799867, "answer_count": 1, "score": 3, "last_activity_date": 1561684031, "creation_date": 1561671124, "question_id": 56798705, "link": "https://stackoverflow.com/questions/56798705/how-to-use-a-vector-of-string-slices", "title": "How to use a vector of string slices", "body": "<p>I am wondering why this works</p>\n\n<pre><code>fn main() {\n    let v: Vec&lt;&amp;str&gt; = Vec::new();\n    let s: &amp;str = v.get(0).unwrap();\n    let new_string = String::from(s);\n    println!(\"{}\", new_string);\n}\n</code></pre>\n\n<p>but not this one:</p>\n\n<pre><code>fn main() {\n    let v: Vec&lt;&amp;str&gt; = Vec::new();\n    let s = v.get(0).unwrap();\n    let new_string = String::from(s);\n    println!(\"{}\", new_string);\n}\n</code></pre>\n\n<p>I get the following error from the second snippet:</p>\n\n<pre><code>let new_string = String::from(s);\n                  ^^^^^^^^^^^^ the trait `std::convert::From&lt;&amp;&amp;str&gt;` is not implemented for `std::string::String`\n</code></pre>\n"}, {"tags": ["functional-programming", "rust", "traits"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 3, "creation_date": 1561667557, "post_id": 56798106, "comment_id": 100150824, "body": "<code>FnOnce() -&gt; ()</code> isn&#39;t a type, it&#39;s a trait. What&#39;s wrong with <code>let f = || println!(&quot;Hello&quot;);</code>?"}, {"owner": {"reputation": 892, "user_id": 3331931, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/667d26246734ae54783faeebf84ced20?s=128&d=identicon&r=PG", "display_name": "fcracker79", "link": "https://stackoverflow.com/users/3331931/fcracker79"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1561667617, "post_id": 56798106, "comment_id": 100150845, "body": "That&#39;s fine, I am just trying to understand how Fn* traits work."}, {"owner": {"reputation": 507143, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1561670061, "post_id": 56798106, "comment_id": 100151654, "body": "@fcracker79 this is more related to anonymous types of closures than to the Fn traits"}], "answers": [{"comments": [{"owner": {"reputation": 892, "user_id": 3331931, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/667d26246734ae54783faeebf84ced20?s=128&d=identicon&r=PG", "display_name": "fcracker79", "link": "https://stackoverflow.com/users/3331931/fcracker79"}, "edited": false, "score": 0, "creation_date": 1561716440, "post_id": 56798506, "comment_id": 100164031, "body": "Thanks for your answer. Indeed, I expected to have the same result as with <code>let f = move || println!(&quot;{}&quot;, a)</code>: since I am moving <code>a</code> in the closure environment, why isn&#39;t <code>f</code> an <code>FnOnce</code>?"}, {"owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "reply_to_user": {"reputation": 892, "user_id": 3331931, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/667d26246734ae54783faeebf84ced20?s=128&d=identicon&r=PG", "display_name": "fcracker79", "link": "https://stackoverflow.com/users/3331931/fcracker79"}, "edited": false, "score": 0, "creation_date": 1561724456, "post_id": 56798506, "comment_id": 100167593, "body": "@fcracker79 <code>println!</code> is a macro that does a lot of magic. So when <code>a</code> appears as an argument without <code>&amp;</code> that doesn&#39;t mean it is moved."}, {"owner": {"reputation": 892, "user_id": 3331931, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/667d26246734ae54783faeebf84ced20?s=128&d=identicon&r=PG", "display_name": "fcracker79", "link": "https://stackoverflow.com/users/3331931/fcracker79"}, "edited": false, "score": 0, "creation_date": 1561788857, "post_id": 56798506, "comment_id": 100184542, "body": "thanks for the explanation. Agreed, but the <code>move</code> keyword should do the trick. The <code>println!</code> should be unrelevant from that point of view. All in all, is there a way to let Rust decide to create a closure that is <i>only</i> a <code>FnOnce</code>, without requiring tricks such as functions that take a <code>FnOnce</code> as an argument?"}], "tags": [], "owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "is_accepted": false, "score": 1, "last_activity_date": 1561669806, "creation_date": 1561669806, "answer_id": 56798506, "question_id": 56798106, "link": "https://stackoverflow.com/questions/56798106/how-to-create-a-fnonce-function/56798506#56798506", "title": "How to create a `FnOnce` function", "body": "<p><code>FnOnce</code> is a trait for closures which can only be called once, typically because the captured values are moved into the closure, and they are consumed during the call. For example, we can capture a value and move it out as a return value:</p>\n\n<pre><code>fn delay&lt;A: 'static&gt;(a: A) -&gt; Box&lt;dyn FnOnce() -&gt; A&gt; {\n    Box::new(move || a)\n}\n\nfn main() {\n    let a = \"hello\".to_string();\n    let f = delay(a);\n    println!(\"{}\", f());\n}\n</code></pre>\n\n<p>Note that the <code>move</code> keyword is not strictly necessary. The compiler sees that <code>a</code> needs to be moved into the closure, in order to be returned as a value and moved out.</p>\n"}], "owner": {"reputation": 892, "user_id": 3331931, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/667d26246734ae54783faeebf84ced20?s=128&d=identicon&r=PG", "display_name": "fcracker79", "link": "https://stackoverflow.com/users/3331931/fcracker79"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1561669806, "creation_date": 1561667365, "question_id": 56798106, "link": "https://stackoverflow.com/questions/56798106/how-to-create-a-fnonce-function", "title": "How to create a `FnOnce` function", "body": "<p>I am trying to create a function that is only a <code>FnOnce</code>.</p>\n\n<p>The following snippet of code do not work:</p>\n\n<pre><code>// Attempt 1\n//  Error doesn't have a size known at compile-time\nlet f: FnOnce() -&gt; () = || println!(\"Hello\");\n\n// Attempt 2\nfn g&lt;T: FnOnce() -&gt; ()&gt;(c: T) -&gt; (FnOnce() -&gt; ()) {\n    c\n}\n// Error: doesn't have a size known at compile-time\nlet f = g(|| println!(\"Hello\"));\n\n// Attempt 3\n// Error: cast to unsized type\nlet f = (|| println!(\"Hello\")) as (FnOnce() -&gt; ());\n</code></pre>\n"}, {"tags": ["rust", "match"], "answers": [{"tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": true, "score": 3, "last_activity_date": 1561645373, "last_edit_date": 1561645373, "creation_date": 1561640781, "answer_id": 56791731, "question_id": 56791417, "link": "https://stackoverflow.com/questions/56791417/why-does-matching-on-the-result-of-find-one-return-an-option-instead-of-the-ex/56791731#56791731", "title": "Why does matching on the result of `find_one` return an Option instead of the expected type?", "body": "<p>The type returned from a <code>match</code> operation is whatever you put in it. In this case, the type is that of <code>c</code>.</p>\n\n<p><a href=\"https://docs.rs/mongodb/0.3.12/mongodb/coll/struct.Collection.html#method.find_one\" rel=\"nofollow noreferrer\"><code>find_one</code></a> returns a <code>Result&lt;Option&lt;Document&gt;&gt;</code>. Since your patterns only match on the <code>Result</code> part, you get the inner <code>Option</code>. One solution is to use some more precise patterns:</p>\n\n<pre><code>let doc = match db.media.find_one(Some(doc! { \"id\": id }), None) {\n    Ok(Some(c)) =&gt; c,\n    Ok(None) =&gt; {\n        println!(\"Nothing found\");\n        return;\n    }\n    Err(e) =&gt; {\n        println!(\"An error occurred: {:?}\", e);\n        return;\n    }\n};\n</code></pre>\n"}], "owner": {"reputation": 2837, "user_id": 1427563, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sdqnK.png?s=128&g=1", "display_name": "jla", "link": "https://stackoverflow.com/users/1427563/jla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 56791731, "answer_count": 1, "score": -1, "last_activity_date": 1561645373, "creation_date": 1561639796, "last_edit_date": 1561645339, "question_id": 56791417, "link": "https://stackoverflow.com/questions/56791417/why-does-matching-on-the-result-of-find-one-return-an-option-instead-of-the-ex", "title": "Why does matching on the result of `find_one` return an Option instead of the expected type?", "body": "<p>I'm trying to use the <code>.get</code> method on a BSON <code>OrderedDocument</code> that I'm retrieving from a MongoDB query. To handle any errors from the query I use a <code>match</code> operator on the query.</p>\n\n<pre><code>let id: String = \"example\".to_string();\n\nlet doc = match db.media.find_one(\n    Some(doc! {\n        \"id\" : id\n    }),\n    None,\n) {\n    Ok(c) =&gt; c,\n    Err(e) =&gt; {\n        // do stuff with the error\n        return;\n    }\n};\n\nprintln!(\"{:?}\", doc.get(\"field\"));\n</code></pre>\n\n<p>This returns an error for the last line:</p>\n\n<blockquote>\n  <p>error[E0599]: no method named <code>get</code> found for type <code>std::option::Option&lt;bson::ordered::OrderedDocument&gt;</code> in the current scope</p>\n</blockquote>\n\n<p>This must mean that the type returned from a <code>match</code> operation is an <code>Option</code>, not an <code>OrderedDocument</code> as I expected. Why is the <code>c</code> variable returned (in the example above) of type <code>Option</code> instead of the query's BSON document type, and how can I get the required type returned from a <code>match</code>? Or is this the wrong way of going about it?</p>\n"}, {"tags": ["javascript", "rust", "webassembly"], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 9813015, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Jacob Bohlin", "link": "https://stackoverflow.com/users/9813015/jacob-bohlin"}, "edited": false, "score": 0, "creation_date": 1561640878, "post_id": 56791259, "comment_id": 100137852, "body": "You wrote that the code is the correct way to do it. Does that mean that I can in fact take a JS Buffer as an argument and write to it in the way I described? If so, doesn&#39;t that mean it would write directly to JS memory from Wasm?  How exactly do you mean I could speed up the <code>copy_into</code>? Do you propose that I, instead of taking the buffer as an argument, simply return the values from Wasm in say an Array that I then copy into a buffer on the JS side?"}], "tags": [], "owner": {"reputation": 3796, "user_id": 4661625, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c3cd0caf54e0766c83f04f51f881303b?s=128&d=identicon&r=PG&f=1", "display_name": "Bumsik Kim", "link": "https://stackoverflow.com/users/4661625/bumsik-kim"}, "is_accepted": true, "score": 2, "last_activity_date": 1561646467, "last_edit_date": 1561646467, "creation_date": 1561639271, "answer_id": 56791259, "question_id": 56790649, "link": "https://stackoverflow.com/questions/56790649/is-there-a-way-to-write-to-a-javascript-buffer-from-the-webassembly-context/56791259#56791259", "title": "Is there a way to write to a JavaScript Buffer from the WebAssembly context?", "body": "<p>You can't import it directly, and the code you posted is the correct way to do it. WASM cannot touch JS buffers directly outside of its memory. That's how WASM is sandboxed, to protect the host environment (JS), for security reason.</p>\n\n<p>You may be able to boost the speed of <code>copy_into</code>. You can write the copy operation in JS side, instead of walking through the buffer in Rust side. This will be faster especially for large buffer because JS will perform a block copy operation internally.</p>\n"}], "owner": {"reputation": 115, "user_id": 9813015, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Jacob Bohlin", "link": "https://stackoverflow.com/users/9813015/jacob-bohlin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 1, "accepted_answer_id": 56791259, "answer_count": 1, "score": 3, "last_activity_date": 1561646467, "creation_date": 1561637347, "last_edit_date": 1561646445, "question_id": 56790649, "link": "https://stackoverflow.com/questions/56790649/is-there-a-way-to-write-to-a-javascript-buffer-from-the-webassembly-context", "title": "Is there a way to write to a JavaScript Buffer from the WebAssembly context?", "body": "<p>I want to have a WebAssembly function (compiled from Rust) that takes a JavaScript <a href=\"https://nodejs.org/api/buffer.html\" rel=\"nofollow noreferrer\"><code>Buffer</code></a> as an argument and writes data to the buffer. I then want to be able to use this buffer and interact with the data from the JavaScript context.</p>\n\n<p>I'm using wasm-bindgen to export the WebAssembly structs to JavaScript but I don't know how I can use the JavaScript <code>Buffer</code> inside the WebAssembly.</p>\n\n<p>This is a simplified version of what I want the Rust source code to look like:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Element {\n    a: u8,\n    b: String,\n}\n\nimpl Element {\n    fn new(a: u8, b: &amp;str) -&gt; Element {\n        Element {\n            a: a,\n            b: String::from(b),\n        }\n    }\n\n    fn copy_into(&amp;self, buffer: Buffer) {\n        let mut offset = 0;\n        buffer[offset] = self.a;\n        offset += std::mem::size_of::&lt;u8&gt;();\n        buffer[offset] = self.b;\n    }\n}\n</code></pre>\n\n<p>This is what I want to do in the JavaScript context:</p>\n\n<pre><code>// Code for importing Element and instantiating the wasm module omitted.\n\nlet element = new Element(1, 'abc');\nlet buffer = Buffer.allocUnsafe(4);\nelement.copy_into(buffer);\n\nconsole.log(buffer.toString('hex'));\n</code></pre>\n\n<p>I want the <code>console.log</code> at the end of above code to print '01616263' to the console. I want to achieve this without having to allocate new memory in WebAssembly and copying the contents. Instead, I want to write directly to the JavaScript memory, where <code>buffer</code> is a pointer to that memory.</p>\n\n<p>How can I accomplish this by somehow importing the <code>Buffer</code> to Rust?</p>\n"}, {"tags": ["vector", "rust", "indexoutofboundsexception", "populate"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1561625155, "post_id": 56786947, "comment_id": 100128620, "body": "<a href=\"https://stackoverflow.com/q/37152766/1233251\">This one</a> seems relevant, but the answers might not be very appealing."}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1561625281, "post_id": 56786947, "comment_id": 100128694, "body": "You may initalize vec like this <code>[0; 10].to_vec()</code>"}, {"owner": {"reputation": 5189, "user_id": 5223757, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FdOvO.png?s=128&g=1", "display_name": "wizzwizz4", "link": "https://stackoverflow.com/users/5223757/wizzwizz4"}, "reply_to_user": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1561625362, "post_id": 56786947, "comment_id": 100128758, "body": "@&#214;merErden It&#39;s not <code>{integer}</code>s, though, and I don&#39;t have access to the constructor."}, {"owner": {"reputation": 5189, "user_id": 5223757, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FdOvO.png?s=128&g=1", "display_name": "wizzwizz4", "link": "https://stackoverflow.com/users/5223757/wizzwizz4"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1561625392, "post_id": 56786947, "comment_id": 100128777, "body": "@E_net4theAbusedDownvoter Once again, you&#39;ve found the duplicate target."}, {"owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 1, "creation_date": 1561626819, "post_id": 56786947, "comment_id": 100129617, "body": "It would be nice to have something like <code>reverse_collect</code>."}, {"owner": {"reputation": 5189, "user_id": 5223757, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FdOvO.png?s=128&g=1", "display_name": "wizzwizz4", "link": "https://stackoverflow.com/users/5223757/wizzwizz4"}, "reply_to_user": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 0, "creation_date": 1561626906, "post_id": 56786947, "comment_id": 100129671, "body": "@starblue It&#39;s theoretically possible to create such a thing with <code>unsafe</code>, though I&#39;m nowhere near clever enough at Rust to do so."}, {"owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 0, "creation_date": 1561706107, "post_id": 56786947, "comment_id": 100159333, "body": "@wizzwizz4 The point is that somebody clever enough could write it using <code>unsafe</code>, then everybody could use it safely. Though I&#39;m not sure this use case is common enough to put it in the standard library."}], "answers": [{"comments": [{"owner": {"reputation": 5189, "user_id": 5223757, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FdOvO.png?s=128&g=1", "display_name": "wizzwizz4", "link": "https://stackoverflow.com/users/5223757/wizzwizz4"}, "edited": false, "score": 0, "creation_date": 1561625374, "post_id": 56787285, "comment_id": 100128765, "body": "But then I&#39;d have to convert that to a <code>Vec</code>."}, {"owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "reply_to_user": {"reputation": 5189, "user_id": 5223757, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FdOvO.png?s=128&g=1", "display_name": "wizzwizz4", "link": "https://stackoverflow.com/users/5223757/wizzwizz4"}, "edited": false, "score": 0, "creation_date": 1561625731, "post_id": 56787285, "comment_id": 100129016, "body": "Since Vec implements From trait for VecDeque, you can easily convert it to vec."}, {"owner": {"reputation": 5189, "user_id": 5223757, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FdOvO.png?s=128&g=1", "display_name": "wizzwizz4", "link": "https://stackoverflow.com/users/5223757/wizzwizz4"}, "edited": false, "score": 1, "creation_date": 1561625836, "post_id": 56787285, "comment_id": 100129077, "body": "But if I&#39;m doing this, couldn&#39;t I just populate the vector forwards and then reverse it? Why would this, which requires more memory allocations, be better?"}, {"owner": {"reputation": 4182, "user_id": 2992101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7363e9ce46406af3326492e2f6cf40ca?s=128&d=identicon&r=PG", "display_name": "michalsrb", "link": "https://stackoverflow.com/users/2992101/michalsrb"}, "edited": false, "score": 0, "creation_date": 1561639084, "post_id": 56787285, "comment_id": 100136684, "body": "Converting <code>VecDeque</code> to <code>Vec</code> will not cause any new allocations. Both of them hold internally <code>RawVec</code> and this buffer is passed from one to another. Depending on the current state of <code>VecDeque</code> the elements may need to be reordered, which is done by few calls to <code>ptr::copy</code>. That is probably faster than reversing order of elements (few big memcpy, vs multiple smallers ones). But of course writing the elements straight to their final position would be best."}], "tags": [], "owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "is_accepted": false, "score": 1, "last_activity_date": 1561634122, "last_edit_date": 1592644375, "creation_date": 1561625227, "answer_id": 56787285, "question_id": 56786947, "link": "https://stackoverflow.com/questions/56786947/how-can-i-populate-a-vector-in-reverse/56787285#56787285", "title": "How can I populate a vector in reverse?", "body": "<blockquote>\n<p>How can I Populate a vector in reverse?</p>\n</blockquote>\n<p>You can do it with <a href=\"https://doc.rust-lang.org/std/collections/struct.VecDeque.html\" rel=\"nofollow noreferrer\">VecDeque</a>:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>use std::collections::VecDeque;\n\nfn main() {\n    let mut v = VecDeque::new();\n\n    for i in 0..5 {\n        v.push_front(i);\n    }\n\n    for item in v {\n        print!(&quot;{}&quot;, item);\n    }\n}\n</code></pre>\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=e5fa8333d35426245ed1bce22377e084\" rel=\"nofollow noreferrer\">Playground</a></p>\n<hr />\n<p>Instead of using <code>VecDeque</code> you can solve this problem with using array and the iterator:</p>\n<ul>\n<li>Declare an array containing Option types.</li>\n<li>Set array cells with the indexes.</li>\n<li>Iterate over your array.</li>\n<li>Filter your array to eliminate <code>None</code> values</li>\n<li>Map the unwrapped values</li>\n<li>Collect them into vector.</li>\n</ul>\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    let mut v = [None; 10];\n    let mut i = 5i32;\n\n    while i &gt; 0 {\n        i -= 1;\n        v[i as usize] = Some(4i32 - i);\n    }\n\n    let reverse_populated: Vec&lt;i32&gt; = v\n        .iter()\n        .filter(|x| x.is_some())\n        .map(|x| x.unwrap())\n        .collect();\n\n    for item in reverse_populated {\n        print!(&quot;{:?}&quot;, item);\n    }\n}\n</code></pre>\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=c1d8dd167e36f050837e91c7c78a523c\" rel=\"nofollow noreferrer\">Playground</a></p>\n<hr />\n<blockquote>\n<p>Both output will be: <code>43210</code></p>\n</blockquote>\n"}], "owner": {"reputation": 5189, "user_id": 5223757, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/FdOvO.png?s=128&g=1", "display_name": "wizzwizz4", "link": "https://stackoverflow.com/users/5223757/wizzwizz4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "closed_date": 1561645115, "answer_count": 1, "score": 3, "last_activity_date": 1561645124, "creation_date": 1561624035, "question_id": 56786947, "link": "https://stackoverflow.com/questions/56786947/how-can-i-populate-a-vector-in-reverse", "closed_reason": "Duplicate", "title": "How can I populate a vector in reverse?", "body": "<p>I've got a vector:</p>\n\n<pre><code>let v = Vec&lt;T&gt;::with_capacity(10);\n</code></pre>\n\n<p>I want to populate it with data, in reverse order:</p>\n\n<pre><code>let i = 10;\nwhile i &gt; 0 {\n    i -= 1;\n    v[i] = non_pure_function(i);\n}\n</code></pre>\n\n<p>Unfortunately, this panics; when allocating with <code>Vec::with_capacity</code>, the actual initial length of the vector is still <code>0</code>.</p>\n\n<p>How can I best accomplish this? What if I have no constructor for <code>T</code>?</p>\n"}, {"tags": ["generics", "rust"], "comments": [{"owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "edited": false, "score": 0, "creation_date": 1561622336, "post_id": 56786387, "comment_id": 100127082, "body": "What is the problem with writing new trait for that? Imho, It seems good declaring a new trait for such case"}, {"owner": {"reputation": 2086, "user_id": 1517818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3416d94544d42f591139dbfcf878b35d?s=128&d=identicon&r=PG", "display_name": "Daniel Landau", "link": "https://stackoverflow.com/users/1517818/daniel-landau"}, "edited": false, "score": 0, "creation_date": 1561623036, "post_id": 56786387, "comment_id": 100127412, "body": "I don&#39;t mind declaring a new trait, I just couldn&#39;t figure out how to do it."}, {"owner": {"reputation": 2086, "user_id": 1517818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3416d94544d42f591139dbfcf878b35d?s=128&d=identicon&r=PG", "display_name": "Daniel Landau", "link": "https://stackoverflow.com/users/1517818/daniel-landau"}, "reply_to_user": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1561623116, "post_id": 56786387, "comment_id": 100127444, "body": "@&#214;mer I don&#39;t see how that question+answers would help me."}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1561623355, "post_id": 56786387, "comment_id": 100127572, "body": "for <code>trait IoDev  : Write + Read{}</code>  this <code>impl&lt;T: Write + Read&gt; IoDev for T {} </code>, then use it like <code>fn do_stuff&lt;T:IoDev&gt;</code>"}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1561623417, "post_id": 56786387, "comment_id": 100127600, "body": "that&#39;s what the Q&amp;A points"}], "answers": [{"comments": [{"owner": {"reputation": 2086, "user_id": 1517818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3416d94544d42f591139dbfcf878b35d?s=128&d=identicon&r=PG", "display_name": "Daniel Landau", "link": "https://stackoverflow.com/users/1517818/daniel-landau"}, "edited": false, "score": 0, "creation_date": 1561623981, "post_id": 56786782, "comment_id": 100127920, "body": "If I add <code>?Sized</code> to both the <code>impl</code> line and the function declaration, then this works. Is there no way to get that out too?"}], "tags": [], "owner": {"reputation": 4182, "user_id": 2992101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7363e9ce46406af3326492e2f6cf40ca?s=128&d=identicon&r=PG", "display_name": "michalsrb", "link": "https://stackoverflow.com/users/2992101/michalsrb"}, "is_accepted": false, "score": 0, "last_activity_date": 1561645003, "last_edit_date": 1561645003, "creation_date": 1561623392, "answer_id": 56786782, "question_id": 56786387, "link": "https://stackoverflow.com/questions/56786387/how-to-give-a-reusable-name-to-a-sized-multiple-type-bound-in-a-rust-generic-fu/56786782#56786782", "title": "How to give a reusable name to a ?Sized multiple type bound in a Rust generic function", "body": "<p>Your problem probably is that the trait is not automatically implemented. Even when a type fulfills all preconditions for a trait, you have to manually write the <code>impl</code> for it. The compiler does not do it automatically because implementing a trait may give it some new meaning.</p>\n\n<p>For example, the <code>std::iter::FusedIterator</code> trait has no methods or associated types and the only requirement is that the implementing type is an <code>Iterator</code>. The compiler must not implement it automatically, because it  carries special meaning and the programmer must decide whether it should be implemented for their specific iterator or not.</p>\n\n<p>If you want to implement your trait for every type that fulfills the conditions, you can do a blanket implementation:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait IoDev : io::Write + io::Read {}\n\nimpl&lt;T: io::Write + io::Read&gt; IoDev for T {}\n</code></pre>\n"}], "owner": {"reputation": 2086, "user_id": 1517818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3416d94544d42f591139dbfcf878b35d?s=128&d=identicon&r=PG", "display_name": "Daniel Landau", "link": "https://stackoverflow.com/users/1517818/daniel-landau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 0, "closed_date": 1561644934, "answer_count": 1, "score": 1, "last_activity_date": 1562068551, "creation_date": 1561621830, "last_edit_date": 1562068551, "question_id": 56786387, "link": "https://stackoverflow.com/questions/56786387/how-to-give-a-reusable-name-to-a-sized-multiple-type-bound-in-a-rust-generic-fu", "closed_reason": "Duplicate", "title": "How to give a reusable name to a ?Sized multiple type bound in a Rust generic function", "body": "<p>Take the following code</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn do_stuff&lt;T: ?Sized + io::Write + io::Read&gt;(mut serial: Box&lt;T&gt;) {\n  // stuff\n}\n</code></pre>\n\n<p>It can take for example a serial device to work with, or maybe a file for testing purposes. This works, but writing that type bound is quite a handful.</p>\n\n<p>How can I give a name for the bound that I can reuse in other functions? Using (as per <a href=\"https://stackoverflow.com/questions/26070559/is-there-any-way-to-create-a-type-alias-for-multiple-traits\">Is there any way to create a type alias for multiple traits?</a>)</p>\n\n<pre><code>trait IoDev : io::Write + io::Read {}\nimpl&lt;T: io::Write + io::Read&gt; IoDev for T {}\n</code></pre>\n\n<p>solves the issue partially, as there's no need to repeat <code>Write+Read</code> anymore, but I still have to repeat <code>?Sized</code> on each function. Is there a way to get out of repeating that too?</p>\n"}, {"tags": ["binding", "rust", "ffi"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1561648069, "post_id": 56786346, "comment_id": 100142562, "body": "Why not writing a wrapper for it?"}, {"owner": {"reputation": 522, "user_id": 153612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba347a31bc66bb2654de01850e914021?s=128&d=identicon&r=PG", "display_name": "Ta Thanh Dinh", "link": "https://stackoverflow.com/users/153612/ta-thanh-dinh"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1561714795, "post_id": 56786346, "comment_id": 100163177, "body": "@hellow thanks you. Could you elaborate a little bit? Sorry for my novice."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1561645813, "post_id": 56793148, "comment_id": 100141135, "body": "<i>With proc_macro2</i> \u2014 it&#39;s not <b>required</b> to use this crate, it&#39;s just one of the most common methods to interact with a token stream."}, {"owner": {"reputation": 522, "user_id": 153612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba347a31bc66bb2654de01850e914021?s=128&d=identicon&r=PG", "display_name": "Ta Thanh Dinh", "link": "https://stackoverflow.com/users/153612/ta-thanh-dinh"}, "edited": false, "score": 0, "creation_date": 1561714916, "post_id": 56793148, "comment_id": 100163234, "body": "@myrrlyn thanks you. I&#39;m not familiar with <code>proc_macro2</code> yet, but thanks a lot for the entry point."}], "tags": [], "owner": {"reputation": 136, "user_id": 4273450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f0e541a230b2f34004b12d773a3dc72?s=128&d=identicon&r=PG", "display_name": "myrrlyn", "link": "https://stackoverflow.com/users/4273450/myrrlyn"}, "is_accepted": false, "score": 1, "last_activity_date": 1561645758, "last_edit_date": 1561645758, "creation_date": 1561645309, "answer_id": 56793148, "question_id": 56786346, "link": "https://stackoverflow.com/questions/56786346/how-can-i-automatically-rewrite-the-signature-of-bindgen-created-ffi-functions/56793148#56793148", "title": "How can I automatically rewrite the signature of bindgen-created FFI functions?", "body": "<p>A declarative macro can't accomplish this but a procedural macro might be able to. With <a href=\"https://docs.rs/proc-macro2\" rel=\"nofollow noreferrer\"><code>proc_macro2</code></a>, you can modify the token stream of a function declaration by placing your rewrite attribute on it, e.g.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern \"C\" {\n    #[rustify]\n    pub fn foo(x: *mut A, y: *mut B);\n}\n</code></pre>\n\n<p>And your <code>rustify</code> macro would substitute <code>*mut Typename</code> with <code>Option&lt;&amp;mut Typename&gt;</code>.</p>\n\n<p>I don't know how you'd change the <code>mut</code> borrow offhand without replacing the original declaration with <code>*const</code>.</p>\n"}], "owner": {"reputation": 522, "user_id": 153612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba347a31bc66bb2654de01850e914021?s=128&d=identicon&r=PG", "display_name": "Ta Thanh Dinh", "link": "https://stackoverflow.com/users/153612/ta-thanh-dinh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1561646085, "creation_date": 1561621638, "last_edit_date": 1561646085, "question_id": 56786346, "link": "https://stackoverflow.com/questions/56786346/how-can-i-automatically-rewrite-the-signature-of-bindgen-created-ffi-functions", "title": "How can I automatically rewrite the signature of bindgen-created FFI functions?", "body": "<p>I'm writing a binding for a C library with the help of <code>rust-bindgen</code> for which the function signatures are generated automatically into a <code>bindings.rs</code> as:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[repr(C)]\nstruct A {\n    //...\n}\n\nstruct B {\n    //...\n}\n\nextern \"C\" {\n    pub fn foo(x: *mut A, y: *mut B);\n    //...\n}\n</code></pre>\n\n<p>I'm not very happy with this signature of <code>foo</code> because I know that <code>x</code> is a pointer to a constant struct. Moreover, I want to apply <a href=\"https://users.rust-lang.org/t/stateful-closure-for-ffi-callback/29339/2\" rel=\"nofollow noreferrer\">this idea</a> to improve this signature into something like</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern \"C\" {\n    pub fn foo(x: &amp;'_ A, y: &amp;'_ mut B);\n}\n</code></pre>\n\n<p>But <code>binding.rs</code> has a bunch functions like <code>foo</code> and rewriting them by hand is a very time consuming task and I think that macros (or something else) should help. For example, there might exist one (or several) magic macro <code>rewrite!</code></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>\n// hide\nmod ffi {\n    include!(\"binding.rs\"); // so bunch of functions: foo, bar\n}\n\n// re-exports\nextern \"C\" {\n    rewrite!(foo); // should expand to: pub fn foo(x: &amp;'_A, y: &amp;'_ mut B)\n    rewrite!(bar);\n}\n</code></pre>\n\n<p>I'm at a very early stage of this work. I don't even know if such a problem can be solved by a macro or anything else, so I'm looking for any entry point.</p>\n\n<p>I've <a href=\"https://users.rust-lang.org/t/reexport-auto-generated-ffi-functions-by-macros/29650\" rel=\"nofollow noreferrer\">cross-posted this question</a> to the Rust user forum.</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 73287, "user_id": 3874623, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6df0aa136ee42f4ea24ef08b7c348e7a?s=128&d=identicon&r=PG&f=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/3874623/mark"}, "is_accepted": true, "score": 4, "last_activity_date": 1561606547, "creation_date": 1561606547, "answer_id": 56783536, "question_id": 56783477, "link": "https://stackoverflow.com/questions/56783477/how-to-push-an-element-to-the-last-vector-in-a-vector-of-vectors/56783536#56783536", "title": "How to push an element to the last vector in a vector of vectors?", "body": "<p>Instead of <code>last</code>, use <a href=\"https://doc.rust-lang.org/std/vec/struct.Vec.html#method.last_mut\" rel=\"nofollow noreferrer\"><code>last_mut()</code></a>:</p>\n\n<pre><code>fn main(){\n    let mut pc:Vec&lt;Vec&lt;i32&gt;&gt; = vec![];\n    pc.push(vec![1]);\n    pc.last_mut().unwrap().push(2);\n    println!(\"{:?}\", pc);\n}\n</code></pre>\n\n<p>Prints: <code>[[1, 2]]</code></p>\n"}], "owner": {"reputation": 133, "user_id": 9790188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NqIWR.png?s=128&g=1", "display_name": "AC-5", "link": "https://stackoverflow.com/users/9790188/ac-5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 56783536, "answer_count": 1, "score": 2, "last_activity_date": 1561644891, "creation_date": 1561605978, "last_edit_date": 1561644891, "question_id": 56783477, "link": "https://stackoverflow.com/questions/56783477/how-to-push-an-element-to-the-last-vector-in-a-vector-of-vectors", "title": "How to push an element to the last vector in a vector of vectors?", "body": "<p>I am trying to access the last vector in a vector of vectors (<code>Vec&lt;Vec&lt;u32&gt;&gt;</code>) and push a value to it, but I continue to come across errors.  A simplified version of what I am trying to do is:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let mut pc: Vec&lt;Vec&lt;u32&gt;&gt; = vec![];\n\npc.push(vec![1]);\n\npc.last().unwrap().push(2);\n</code></pre>\n\n<p>The error I get is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0596]: cannot borrow data in a `&amp;` reference as mutable                                                                  \n   |                                                                                                                            \n   |         pc.last().unwrap().push(2);                                                                                        \n   |         ^^^^^^^^^^^^^^^^^^ cannot borrow as mutable\n</code></pre>\n\n<p>I have tried dereferencing the result of <code>unwrap()</code>: <code>(*(pc.last().unwrap())).push(2);</code> but the error persists.</p>\n\n<p>The expected behavior is a nested vector resembling: <code>[[1, 2]]</code>.</p>\n"}]