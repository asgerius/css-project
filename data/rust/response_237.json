[{"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 534, "user_id": 3882704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e5f3c0ad59d68324bd15384465a8f17?s=128&d=identicon&r=PG", "display_name": "Kellen", "link": "https://stackoverflow.com/users/3882704/kellen"}, "edited": false, "score": 1, "creation_date": 1563994028, "post_id": 57189167, "comment_id": 100888820, "body": "@Kellen: I think you just missed it. Last edit &quot;Jun 20&quot;, and &quot;As of Rust 1.36, the Rust 2015 edition also enables non-lexical lifetimes.&quot;"}, {"owner": {"reputation": 534, "user_id": 3882704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e5f3c0ad59d68324bd15384465a8f17?s=128&d=identicon&r=PG", "display_name": "Kellen", "link": "https://stackoverflow.com/users/3882704/kellen"}, "edited": false, "score": 0, "creation_date": 1563994080, "post_id": 57189167, "comment_id": 100888837, "body": "Thank you for the clarification"}, {"owner": {"reputation": 31, "user_id": 11020830, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wXHbS.gif?s=128&g=1", "display_name": "spacecadetmatt", "link": "https://stackoverflow.com/users/11020830/spacecadetmatt"}, "edited": false, "score": 0, "creation_date": 1563995038, "post_id": 57189167, "comment_id": 100889166, "body": "Ah thanks! (Haven&#39;t reached lifetimes chapter yet aha.)"}], "owner": {"reputation": 31, "user_id": 11020830, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wXHbS.gif?s=128&g=1", "display_name": "spacecadetmatt", "link": "https://stackoverflow.com/users/11020830/spacecadetmatt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "closed_date": 1563993969, "answer_count": 0, "score": 0, "last_activity_date": 1576609277, "creation_date": 1563992853, "last_edit_date": 1576609277, "question_id": 57189167, "link": "https://stackoverflow.com/questions/57189167/why-doesnt-the-rust-compiler-always-throw-an-immutable-and-mutable-reference-i", "closed_reason": "Duplicate", "title": "Why doesn&#39;t the Rust compiler always throw an &quot;immutable and mutable reference in same scope&quot; error?", "body": "<p>The Rust compiler doesn't throw error E0502 when the Rust 2015 book says it should. The newer book has updated code, but I can't understand why the changes cause the errors to be thrown.</p>\n\n<p>Using the variables in a <code>println!</code> macro causes the desired error to occur. This code is sourced from <em>The Rust Programming Language</em> Listing 8-7:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let mut v = vec![1, 2, 3, 4, 5];\nlet first = &amp;v[0];\nv.push(6);\nprintln!(\"The first element is: {}\", first);\n</code></pre>\n\n<p>I expect the \"immutable and mutable reference in same scope\" error to be thrown after <code>v.push(6)</code> but it is only thrown if I add the <code>println!</code> statement.</p>\n"}, {"tags": ["rust", "pattern-matching"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1563974468, "post_id": 57183891, "comment_id": 100878485, "body": "You can also add a closure for more fun: <code>let Foo { bar: ref bar8 } = *(|| foo)()</code>"}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "reply_to_user": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1563975178, "post_id": 57183891, "comment_id": 100878879, "body": "@DenysS&#233;guret You do realize that <code>bar1</code> in <code>let bar1 = \u2026</code> <i>is a pattern</i>? It&#39;s just irrefutable. Plus, I&#39;ve seen deconstruction happen quite a lot in method taking <code>self</code> parameters. I would definitely not say that &quot;Pattern matching makes mostly sense when it&#39;s unsure&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "is_accepted": true, "score": 5, "last_activity_date": 1563977076, "last_edit_date": 1563977076, "creation_date": 1563974877, "answer_id": 57184097, "question_id": 57183891, "link": "https://stackoverflow.com/questions/57183891/which-method-of-getting-a-reference-to-a-struct-field-is-the-preferred-way/57184097#57184097", "title": "Which method of getting a reference to a struct field is the preferred way?", "body": "<p>There's no reason to avoid the direct access which would be</p>\n\n<pre><code>let bar1 = &amp;foo.bar;\n</code></pre>\n\n<p>This is easier to write and to read. You don't need pattern matching here.</p>\n\n<p>Pattern matching is an additional tool, which basically solves two kinds of problems:</p>\n\n<ul>\n<li>destructure a value into several ones, for example <code>let (a, b) = c;</code></li>\n<li>being conditional (\"refutable\") in a <code>while let</code>, <code>if let</code>, <code>match</code> arm</li>\n</ul>\n\n<p>See <a href=\"https://doc.rust-lang.org/book/ch18-01-all-the-places-for-patterns.html#all-the-places-patterns-can-be-used\" rel=\"nofollow noreferrer\">All the places patterns can be used</a>.</p>\n\n<p>Some of your declarations are officially discouraged. Clippy would warn you about <a href=\"https://rust-lang.github.io/rust-clippy/master/index.html#toplevel_ref_arg\" rel=\"nofollow noreferrer\">the ref ones</a>.</p>\n"}], "owner": {"reputation": 489, "user_id": 5432349, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a49c998284a38d23d9e741472f26eef5?s=128&d=identicon&r=PG&f=1", "display_name": "FallenWarrior", "link": "https://stackoverflow.com/users/5432349/fallenwarrior"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 1, "accepted_answer_id": 57184097, "answer_count": 1, "score": 0, "last_activity_date": 1563977076, "creation_date": 1563974222, "last_edit_date": 1563974519, "question_id": 57183891, "link": "https://stackoverflow.com/questions/57183891/which-method-of-getting-a-reference-to-a-struct-field-is-the-preferred-way", "title": "Which method of getting a reference to a struct field is the preferred way?", "body": "<p>I've been overwhelmed by all the ways to get a reference to a struct field from a reference to a struct. These are the ways I'm aware of right now:</p>\n\n<pre><code>struct Foo {\n    bar: i32,\n}\n\nlet foo = &amp;Foo { bar: 123 };\n\nlet bar1 = &amp;foo.bar;\nlet ref bar2 = foo.bar;\nlet ref bar3 = (*foo).bar;\nlet &amp;Foo { bar: ref bar4 } = foo;\nlet Foo { bar: bar5 } = foo;\nlet Foo { bar: ref bar6 } = foo;\nlet Foo { bar: ref bar7 } = *foo;\n</code></pre>\n\n<p>Which of these is the \"preferred way\"? I assume that field access like <code>foo.bar</code> is preferred for a single field and pattern matching for getting multiple ones in one go, but it's unclear to me which of the multiple ways I've listed above I should use for each case.</p>\n"}, {"tags": ["performance", "loops", "rust"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 7, "last_activity_date": 1563974308, "last_edit_date": 1563974308, "creation_date": 1563973932, "answer_id": 57183808, "question_id": 57183573, "link": "https://stackoverflow.com/questions/57183573/how-to-disable-loop-unrolling-in-rust/57183808#57183808", "title": "How to disable loop unrolling in Rust?", "body": "<p>You cannot control how a given loop is/is not unrolled. It <a href=\"https://github.com/rust-lang/rfcs/issues/2219\" rel=\"noreferrer\">has been proposed</a>, but no real progress has been made on considering such an RFC, much less accepting and implementing it.</p>\n\n<hr>\n\n<p>If you are looking for very broad capabilities, you can pass <code>-C llvm-args=...</code> to the compiler to influence LLVM. If there's a way to disable loop unrolling completely, that <em>might</em> do what you want.</p>\n\n<p>Pragmatically, I'd encourage you to get a <a href=\"https://devops.stackexchange.com/questions/712/what-is-a-walking-skeleton\"><em>walking skeleton</em></a> of your code in Rust and see if the performance is acceptable. My personal experience has shown that \"general\" Rust code is more performant because of</p>\n\n<ul>\n<li>The borrow checker making it safe to be aggressive about using references instead of copies</li>\n<li>Comparatively easy usage of multithreading</li>\n<li>A strong type system that can help avoid performing work multiple times</li>\n</ul>\n"}], "owner": {"reputation": 11483, "user_id": 161331, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/cd3e90ded5f2669762a18d97d447e219?s=128&d=identicon&r=PG", "display_name": "Stringer", "link": "https://stackoverflow.com/users/161331/stringer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 620, "favorite_count": 0, "accepted_answer_id": 57183808, "answer_count": 1, "score": 10, "last_activity_date": 1563974308, "creation_date": 1563973175, "last_edit_date": 1563973781, "question_id": 57183573, "link": "https://stackoverflow.com/questions/57183573/how-to-disable-loop-unrolling-in-rust", "title": "How to disable loop unrolling in Rust?", "body": "<p>I am looking at Rust to rewrite a C++ codebase and I would like to know how to disable loop unrolling/vectorizing and control unroll count as well. In Clang we would use:</p>\n\n<pre><code>#pragma clang loop unroll(disable)\n#pragma clang loop unroll(disable) vectorize(disable)\n#pragma clang loop unroll_count(2)\n</code></pre>\n\n<p>It is highly performance sensitive code and not having control over loop codegen could be a showstopper.</p>\n"}, {"tags": ["rust", "installation", "rust-cargo", "rust-crates"], "answers": [{"tags": [], "owner": {"reputation": 327, "user_id": 9617771, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MTAUf.jpg?s=128&g=1", "display_name": "benyamin", "link": "https://stackoverflow.com/users/9617771/benyamin"}, "is_accepted": false, "score": -1, "last_activity_date": 1602313828, "creation_date": 1602313828, "answer_id": 64290941, "question_id": 57182594, "link": "https://stackoverflow.com/questions/57182594/error-failed-to-run-custom-build-command-for-openssl-v0-9-24/64290941#64290941", "title": "error: failed to run custom build command for `openssl v0.9.24`", "body": "<p>rust openssl-sys library needs openssl installed.</p>\n<p>then on Windows :\ndownload and install it from here first :\n<a href=\"http://slproweb.com/products/Win32OpenSSL.html\" rel=\"nofollow noreferrer\">http://slproweb.com/products/Win32OpenSSL.html</a></p>\n<pre><code>then set this EnvironmentVariable:\n</code></pre>\n<blockquote>\n<p>set OPENSSL_DIR=C:\\Program Files\\OpenSSL-Win64\\</p>\n</blockquote>\n<p>on linux :</p>\n<blockquote>\n<p>sudo apt-get install pkg-config libssl-dev</p>\n</blockquote>\n<p>or</p>\n<blockquote>\n<p>sudo pacman -S openssl</p>\n</blockquote>\n<p>or</p>\n<blockquote>\n<p>sudo dnf install openssl-devel</p>\n</blockquote>\n<p>or</p>\n<blockquote>\n<p>curl -O <a href=\"https://www.openssl.org/source/openssl-1.1.0f.tar.gz\" rel=\"nofollow noreferrer\">https://www.openssl.org/source/openssl-1.1.0f.tar.gz</a> tar xf</p>\n</blockquote>\n<blockquote>\n<p>openssl-1.1.0f.tar.gz cd openssl-1.1.0f export CC=... ./Configure</p>\n</blockquote>\n<blockquote>\n<p>--prefix=... linux-x86_64 -fPIC make -j$(nproc) make install</p>\n</blockquote>\n<p>and in osx just :</p>\n<blockquote>\n<p>xcode-select --install</p>\n</blockquote>\n<blockquote>\n<p>brew install openssl</p>\n</blockquote>\n"}], "owner": {"reputation": 51, "user_id": 11830160, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7103ae70c383c0b534ccd2cd9acd1f01?s=128&d=identicon&r=PG&f=1", "display_name": "Jura", "link": "https://stackoverflow.com/users/11830160/jura"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1371, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1602313828, "creation_date": 1563970135, "last_edit_date": 1565619603, "question_id": 57182594, "link": "https://stackoverflow.com/questions/57182594/error-failed-to-run-custom-build-command-for-openssl-v0-9-24", "title": "error: failed to run custom build command for `openssl v0.9.24`", "body": "<p>I want to install cargo-apk <code>cargo install cargo-apk</code> to my system (Linux Mint), but I'm getting this error</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: failed to run custom build command for `openssl v0.9.24`\n\nCaused by:\n  process didn't exit successfully: `/tmp/cargo-install7N44TO/release/build/openssl-65bb03053b1fc095/build-script-build` (exit code: 101)\n--- stderr\nthread 'main' panicked at 'Unable to detect OpenSSL version', /home/jiri/.cargo/registry/src/github.com-1ecc6299db9ec823/openssl-0.9.24/build.rs:16:14\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\n\nwarning: build failed, waiting for other jobs to finish...\nerror: failed to compile `cargo-apk v0.4.0`, intermediate artifacts can be found at `/tmp/cargo-install7N44TO`\n\nCaused by:\n  build failed\n</code></pre>\n\n<p>I found that I should install libssl-dev, so I did, but it didn't help.</p>\n"}, {"tags": ["rust", "gtk", "compositing", "gtk-rs"], "owner": {"reputation": 1507, "user_id": 4296244, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/e8c0940effc84e18a8541145ef2dfbfe?s=128&d=identicon&r=PG&f=1", "display_name": "Natjo", "link": "https://stackoverflow.com/users/4296244/natjo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1563965088, "creation_date": 1563965088, "question_id": 57181062, "link": "https://stackoverflow.com/questions/57181062/no-compositing-effects-on-quiting-the-gtk-application", "title": "No compositing effects on quiting the gtk application", "body": "<p>I want to quit my gtk application automatically after a certain time. How do I properly do this? My issue is, that while the window closes and the program exists, no window effects through compton appearto work, such as fading.</p>\n\n<p>This is my code:</p>\n\n<pre><code>extern crate gio;\nextern crate gtk;\n\nuse gio::prelude::*;\nuse gtk::prelude::*;\n\nuse std::env::args;\n\nfn build_ui(application: &amp;gtk::Application) {\n    let window = gtk::ApplicationWindow::new(application);\n\n    window.set_position(gtk::WindowPosition::Center);\n    window.set_default_size(350, 70);\n\n    window.connect_destroy_event(move |_, _| {\n        println!(\"Quit main\");\n        gtk::main_quit();\n        Inhibit(false)\n    });\n\n    window.show_all();\n\n    gtk::timeout_add(500, move || {\n        window.destroy();\n        gtk::Continue(false)\n    });\n}\n\nfn main() {\n    let application = gtk::Application::new(Some(\"example.basic\"), Default::default())\n        .expect(\"Initialization failed...\");\n\n    application.connect_activate(|app| {\n        build_ui(app);\n    });\n\n    application.run(&amp;args().collect::&lt;Vec&lt;_&gt;&gt;());\n}\n</code></pre>\n\n<p><code>connect_destroy_event</code> is not even called, since I don't get the print message.</p>\n"}, {"tags": ["generics", "rust", "traits"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 3, "creation_date": 1563966583, "post_id": 57178829, "comment_id": 100873961, "body": "The problem is that for some <code>T</code> there may be multiple types <code>U</code> that satisfy all the constraints, so there could be multiple implementations of <code>T2&lt;T&gt;</code> for <code>S1</code>. Perhaps <code>T</code> should actually be an associated type of <code>T2</code>?"}, {"owner": {"reputation": 5038, "user_id": 3579309, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Wn5ES.jpg?s=128&g=1", "display_name": "lovasoa", "link": "https://stackoverflow.com/users/3579309/lovasoa"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1563970985, "post_id": 57178829, "comment_id": 100876364, "body": "@trentcl I am not sure I understand... <code>U</code> only appears in the constraint for <code>T</code>. Of course there can be several types that <code>U</code> that satisfy the constraints, that&#39;s what generics are. But for a given concrete type T, there is a single U: the concrete type parameter of <code>S2</code>."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 2, "creation_date": 1563973112, "post_id": 57178829, "comment_id": 100877701, "body": "If <code>Foo</code> implements <code>T1</code>, and <code>Bar</code> implements <code>T1</code>, and <code>Baz</code> implements <i>both</i> <code>AsRef&lt;S2&lt;Foo&gt;&gt;</code> <i>and</i> <code>AsRef&lt;S2&lt;Bar&gt;&gt;</code>, which one does <code>impl T2&lt;Baz&gt; for S1</code> use?"}], "owner": {"reputation": 5038, "user_id": 3579309, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Wn5ES.jpg?s=128&g=1", "display_name": "lovasoa", "link": "https://stackoverflow.com/users/3579309/lovasoa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 121, "favorite_count": 0, "closed_date": 1563971058, "answer_count": 0, "score": 1, "last_activity_date": 1563964000, "creation_date": 1563958023, "last_edit_date": 1563964000, "question_id": 57178829, "link": "https://stackoverflow.com/questions/57178829/why-does-rust-say-unconstrained-type-parameter-whereas-it-seems-to-be-constrai", "closed_reason": "Duplicate", "title": "Why does rust say &quot;unconstrained type parameter&quot; whereas it seems to be constrained?", "body": "<p>There are two existing structs <code>S1</code> and <code>S2&lt;T&gt;</code> and two traits <code>T1</code> and <code>T2&lt;T&gt;</code>. I want to implement <code>T2&lt;T&gt;</code> for <code>S1</code>, for all <code>T</code> that are <code>AsRef&lt;S2&lt;T1&gt;&gt;</code>.</p>\n\n<p>I thought I could write : </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct S1;\nstruct S2&lt;T&gt;{t:T}\n\ntrait T1 {}\ntrait T2&lt;T&gt; {}\n\nimpl &lt;T: AsRef&lt;S2&lt;T1&gt;&gt;&gt; T2&lt;T&gt; for S1 {}\n</code></pre>\n\n<p>but I get the following error (<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=a9547fa583278c161daaef8978e5da39\" rel=\"nofollow noreferrer\">playground</a>):</p>\n\n<blockquote>\n  <p>error[E0277]: the size for values of type <code>(dyn T1 + 'static)</code> cannot be known at compilation time</p>\n</blockquote>\n\n<p>Of course the size of the type is not known at this point ! I want to create a generic implementation for all types that implement T1. So I tried the following :</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct S1;\nstruct S2&lt;T&gt;{t:T}\n\ntrait T1 {}\ntrait T2&lt;T&gt; {}\n\nimpl &lt;T,U&gt; T2&lt;T&gt; for S1 \n    where T: AsRef&lt;S2&lt;U&gt;&gt;,\n          U: T1\n{}\n</code></pre>\n\n<p>But this does not compile either, with the following error:</p>\n\n<blockquote>\n  <p>error[E0207]: the type parameter <code>U</code> is not constrained by the impl trait, self type, or predicates</p>\n</blockquote>\n\n<p>What is the problem with the code above, and how can it be fixed ?</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 1251, "user_id": 2603925, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/92e0bd82c3fbfeeef3996f83b7ed76f4?s=128&d=identicon&r=PG", "display_name": "Luke Skywalker", "link": "https://stackoverflow.com/users/2603925/luke-skywalker"}, "edited": false, "score": 0, "creation_date": 1564042185, "post_id": 57178691, "comment_id": 100902882, "body": "Apparently, someone from reddit had the same issue 4 months ago: <a href=\"https://www.reddit.com/r/rust/comments/b26f68/linking_with_linkexe_failed_exit_code_1181_rust/\" rel=\"nofollow noreferrer\">reddit.com/r/rust/comments/b26f68/&hellip;</a>. No proper solution though, except changing toolchain."}, {"owner": {"reputation": 1251, "user_id": 2603925, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/92e0bd82c3fbfeeef3996f83b7ed76f4?s=128&d=identicon&r=PG", "display_name": "Luke Skywalker", "link": "https://stackoverflow.com/users/2603925/luke-skywalker"}, "edited": false, "score": 0, "creation_date": 1564042329, "post_id": 57178691, "comment_id": 100902954, "body": "Probably a toolchain issue: <a href=\"https://github.com/rust-lang/rust/issues/51659\" rel=\"nofollow noreferrer\">github.com/rust-lang/rust/issues/51659</a>"}, {"owner": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "edited": false, "score": 0, "creation_date": 1564064389, "post_id": 57178691, "comment_id": 100915547, "body": "I also have the 1181 error when trying to compile a Rust program using GTK on Windows 10(same thing on Debian runs fine).  I am pretty sure my gtk install on Windows is borked.  When I get a chance I will see if I can sort this out.  If I do find a good answer I will post here."}], "answers": [{"tags": [], "owner": {"reputation": 2361, "user_id": 10736243, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iYzRZ.jpg?s=128&g=1", "display_name": "Zobia Kanwal", "link": "https://stackoverflow.com/users/10736243/zobia-kanwal"}, "is_accepted": false, "score": 4, "last_activity_date": 1567961578, "last_edit_date": 1567961578, "creation_date": 1567961162, "answer_id": 57843860, "question_id": 57178691, "link": "https://stackoverflow.com/questions/57178691/rust-link-failed-with-exit-code-1181/57843860#57843860", "title": "Rust: link failed with exit code 1181", "body": "<p>Download and install the <a href=\"https://visualstudio.microsoft.com/thank-you-downloading-visual-studio/?sku=BuildTools&amp;rel=16\" rel=\"nofollow noreferrer\">Build Tools for Visual Studio 2019</a>. During installation select the <strong>C++ tools</strong>. It will download almost 5GB of data. Then <strong>restart</strong> the machine after installation and compiling the code will work fine.</p>\n\n<p>You can visit this as well <a href=\"https://stackoverflow.com/questions/55603111/unable-to-compile-rust-hello-world-on-windows-linker-link-exe-not-found/55603112#55603112\">linker-link-exe-not-found</a></p>\n"}], "owner": {"reputation": 3673, "user_id": 531199, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/cf607469b78199cb8ff8d02724483bdf?s=128&d=identicon&r=PG", "display_name": "SOUser", "link": "https://stackoverflow.com/users/531199/souser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4324, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1567966666, "creation_date": 1563957572, "question_id": 57178691, "link": "https://stackoverflow.com/questions/57178691/rust-link-failed-with-exit-code-1181", "title": "Rust: link failed with exit code 1181", "body": "<p>Error is shown at \"cargo run\" upon the first example of <a href=\"https://www.rust-lang.org/learn/get-started\" rel=\"noreferrer\">Getting started</a></p>\n\n<pre><code>C:\\Users\\HiWin10\\hello-rust&gt;cargo run --verbose\n   Compiling hello-rust v0.1.0 (C:\\Users\\HiWin10\\hello-rust)\n     Running `rustc --edition=2018 --crate-name hello_rust src\\main.rs --color always --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=888d1f7b91fb6e4a -C extra-filename=-888d1f7b91fb6e4a --out-dir C:\\Users\\HiWin10\\hello-rust\\target\\debug\\deps -C incremental=C:\\Users\\HiWin10\\hello-rust\\target\\debug\\incremental -L dependency=C:\\Users\\HiWin10\\hello-rust\\target\\debug\\deps`\nerror: linking with `link.exe` failed: exit code: 1181\n  |\n  = note: \"C:\\\\Program Files (x86)\\\\Microsoft Visual Studio\\\\2017\\\\Enterprise\\\\VC\\\\Tools\\\\MSVC\\\\14.12.25827\\\\bin\\\\HostX64\\\\x64\\\\link.exe\" \"/NOLOGO\" \"/NXCOMPAT\" \"/LIBPATH:C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"C:\\\\Users\\\\HiWin10\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.1twe2j0sf4nhwv0v.rcgu.o\" \"C:\\\\Users\\\\HiWin10\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.1vsfetqgdl2mm9ku.rcgu.o\" \"C:\\\\Users\\\\HiWin10\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.2b2k1el9ge2t96a7.rcgu.o\" \"C:\\\\Users\\\\HiWin10\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.2wy84pmiszi6o3fj.rcgu.o\" \"C:\\\\Users\\\\HiWin10\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.51bmf9dki30948b3.rcgu.o\" \"C:\\\\Users\\\\HiWin10\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.q67qbh00yussp5o.rcgu.o\" \"/OUT:C:\\\\Users\\\\HiWin10\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.exe\" \"C:\\\\Users\\\\HiWin10\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.11f4ns4fn9v6i7z4.rcgu.o\" \"/OPT:REF,NOICF\" \"/DEBUG\" \"/NATVIS:C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\intrinsic.natvis\" \"/NATVIS:C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\liballoc.natvis\" \"/NATVIS:C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\libcore.natvis\" \"/LIBPATH:C:\\\\Users\\\\HiWin10\\\\hello-rust\\\\target\\\\debug\\\\deps\" \"/LIBPATH:C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libstd-c418a1c7c96bdbae.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libpanic_unwind-740e55ec30ec9b42.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librustc_demangle-4e3d4b2c73be2130.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libhashbrown-e03c95365300773b.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librustc_std_workspace_alloc-9b63ec27f8df7123.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libunwind-cc811f306714ba24.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liblibc-dee84a63f4b90027.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liballoc-7d070a58cfb70fe0.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librustc_std_workspace_core-10ec18f1dfe36e70.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcore-e0e69d50f48d4667.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcompiler_builtins-45eb0e961cc324b2.rlib\" \"advapi32.lib\" \"ws2_32.lib\" \"userenv.lib\" \"msvcrt.lib\"\n  = note: LINK : fatal error LNK1181:\n\n\nerror: aborting due to previous error\n\nerror: Could not compile `hello-rust`.\n\nCaused by:\n  process didn't exit successfully: `rustc --edition=2018 --crate-name hello_rust src\\main.rs --color always --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=888d1f7b91fb6e4a -C extra-filename=-888d1f7b91fb6e4a --out-dir C:\\Users\\HiWin10\\hello-rust\\target\\debug\\deps -C incremental=C:\\Users\\HiWin10\\hello-rust\\target\\debug\\incremental -L dependency=C:\\Users\\HiWin10\\hello-rust\\target\\debug\\deps` (exit code: 1)\n\nC:\\Users\\HiWin10\\hello-rust&gt;\n</code></pre>\n\n<p>Similar error is shown using intellij-rust in Intellij IDEA</p>\n\n<pre><code>C:/Users/HiWin10/.cargo/bin/cargo.exe run --package hello-rust --bin hello-rust\n   Compiling hello-rust v0.1.0 (C:\\Users\\HiWin10\\IdeaProjects\\hello-rust)\nerror: linking with `link.exe` failed: exit code: 1181\n  |\n  = note: \"C:\\\\Program Files (x86)\\\\Microsoft Visual Studio\\\\2017\\\\Enterprise\\\\VC\\\\Tools\\\\MSVC\\\\14.12.25827\\\\bin\\\\HostX64\\\\x64\\\\link.exe\" \"/NOLOGO\" \"/NXCOMPAT\" \"/LIBPATH:C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"C:\\\\Users\\\\HiWin10\\\\IdeaProjects\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.1twe2j0sf4nhwv0v.rcgu.o\" \"C:\\\\Users\\\\HiWin10\\\\IdeaProjects\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.1vsfetqgdl2mm9ku.rcgu.o\" \"C:\\\\Users\\\\HiWin10\\\\IdeaProjects\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.2b2k1el9ge2t96a7.rcgu.o\" \"C:\\\\Users\\\\HiWin10\\\\IdeaProjects\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.2wy84pmiszi6o3fj.rcgu.o\" \"C:\\\\Users\\\\HiWin10\\\\IdeaProjects\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.51bmf9dki30948b3.rcgu.o\" \"C:\\\\Users\\\\HiWin10\\\\IdeaProjects\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.q67qbh00yussp5o.rcgu.o\" \"/OUT:C:\\\\Users\\\\HiWin10\\\\IdeaProjects\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.exe\" \"C:\\\\Users\\\\HiWin10\\\\IdeaProjects\\\\hello-rust\\\\target\\\\debug\\\\deps\\\\hello_rust-888d1f7b91fb6e4a.11f4ns4fn9v6i7z4.rcgu.o\" \"/OPT:REF,NOICF\" \"/DEBUG\" \"/NATVIS:C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\intrinsic.natvis\" \"/NATVIS:C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\liballoc.natvis\" \"/NATVIS:C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\libcore.natvis\" \"/LIBPATH:C:\\\\Users\\\\HiWin10\\\\IdeaProjects\\\\hello-rust\\\\target\\\\debug\\\\deps\" \"/LIBPATH:C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libstd-c418a1c7c96bdbae.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libpanic_unwind-740e55ec30ec9b42.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librustc_demangle-4e3d4b2c73be2130.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libhashbrown-e03c95365300773b.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librustc_std_workspace_alloc-9b63ec27f8df7123.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libunwind-cc811f306714ba24.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liblibc-dee84a63f4b90027.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liballoc-7d070a58cfb70fe0.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librustc_std_workspace_core-10ec18f1dfe36e70.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcore-e0e69d50f48d4667.rlib\" \"C:\\\\Users\\\\HiWin10\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcompiler_builtins-45eb0e961cc324b2.rlib\" \"advapi32.lib\" \"ws2_32.lib\" \"userenv.lib\" \"msvcrt.lib\"\n  = note: LINK : fatal error LNK1181: \n\n\nerror: aborting due to previous error\n\nerror: Could not compile `hello-rust`.\n\nTo learn more, run the command again with --verbose.\n\nProcess finished with exit code 101\n</code></pre>\n\n<p>Since there is no specific names of libraries after LNK1181, I have no idea what is missing. Could you help to suggest how to diagnose ?</p>\n\n<p>PS: A maybe-different error is shown at \"cargo run\" under Windows Subsystem for Linux</p>\n\n<pre><code>testwsl@localdesktop:~/hello-rust$ cargo run\n   Compiling hello-rust v0.1.0 (/home/testwsl/hello-rust)\nerror: linking with `cc` failed: exit code: 2\n  |\n  = note: \"cc\" \"-Wl,--as-needed\" \"-Wl,-z,noexecstack\" \"-m64\" \"-L\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.1vqvvt1zu5yjmkx2.rcgu.o\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.35e6mijtpa61ekwc.rcgu.o\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.3guttdxbl4ju2ho3.rcgu.o\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.3w3apmysmbwmta20.rcgu.o\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.555cq0ss6gtr2lhv.rcgu.o\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.pnha9ks6selykbe.rcgu.o\" \"-o\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.2jltqdnkmdrx6xjn.rcgu.o\" \"-Wl,--gc-sections\" \"-pie\" \"-Wl,-zrelro\" \"-Wl,-znow\" \"-nodefaultlibs\" \"-L\" \"/home/testwsl/hello-rust/target/debug/deps\" \"-L\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,--start-group\" \"-Wl,-Bstatic\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-9895e8982b0a79e7.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libpanic_unwind-57306b8ed3378a0e.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libbacktrace_sys-54463ae5adae3649.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_demangle-d99667b199a9875a.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libhashbrown-51f4300e102199f5.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_alloc-b3ccf1f7737a6a91.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libunwind-157c37a3ceb78853.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liblibc-505bcee45aafb736.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liballoc-c29abd529ba4452b.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_core-895383a3232f6572.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-5594cb4f559bc761.rlib\" \"-Wl,--end-group\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-38e90baf978bc428.rlib\" \"-Wl,-Bdynamic\" \"-ldl\" \"-lrt\" \"-lpthread\" \"-lgcc_s\" \"-lc\" \"-lm\" \"-lrt\" \"-lpthread\" \"-lutil\" \"-lutil\"\n  = note: Non-UTF-8 output: /usr/bin/cc: 1: /usr/bin/cc: \\x7fELF\\x01\\x01\\x01\\x02\\x03\\x01\\xe4\\x90: not found\\n/usr/bin/cc: 4: /usr/bin/cc: Syntax error: \\\"(\\\" unexpected (expecting \\\")\\\")\\n\n\nerror: aborting due to previous error\n\nerror: Could not compile `hello-rust`.\n\nTo learn more, run the command again with --verbose.\ntestwsl@localdesktop:~/hello-rust$ cc\n-bash: /usr/bin/cc: cannot execute binary file: Exec format error\ntestwsl@localdesktop:~/hello-rust$ cargo run --verbose\n   Compiling hello-rust v0.1.0 (/home/testwsl/hello-rust)\n     Running `rustc --edition=2018 --crate-name hello_rust src/main.rs --color always --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=61a6dbe3daa05864 -C extra-filename=-61a6dbe3daa05864 --out-dir /home/testwsl/hello-rust/target/debug/deps -C incremental=/home/testwsl/hello-rust/target/debug/incremental -L dependency=/home/testwsl/hello-rust/target/debug/deps`\nerror: linking with `cc` failed: exit code: 2\n  |\n  = note: \"cc\" \"-Wl,--as-needed\" \"-Wl,-z,noexecstack\" \"-m64\" \"-L\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.1vqvvt1zu5yjmkx2.rcgu.o\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.35e6mijtpa61ekwc.rcgu.o\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.3guttdxbl4ju2ho3.rcgu.o\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.3w3apmysmbwmta20.rcgu.o\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.555cq0ss6gtr2lhv.rcgu.o\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.pnha9ks6selykbe.rcgu.o\" \"-o\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864\" \"/home/testwsl/hello-rust/target/debug/deps/hello_rust-61a6dbe3daa05864.2jltqdnkmdrx6xjn.rcgu.o\" \"-Wl,--gc-sections\" \"-pie\" \"-Wl,-zrelro\" \"-Wl,-znow\" \"-nodefaultlibs\" \"-L\" \"/home/testwsl/hello-rust/target/debug/deps\" \"-L\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,--start-group\" \"-Wl,-Bstatic\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-9895e8982b0a79e7.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libpanic_unwind-57306b8ed3378a0e.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libbacktrace_sys-54463ae5adae3649.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_demangle-d99667b199a9875a.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libhashbrown-51f4300e102199f5.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_alloc-b3ccf1f7737a6a91.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libunwind-157c37a3ceb78853.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liblibc-505bcee45aafb736.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liballoc-c29abd529ba4452b.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librustc_std_workspace_core-895383a3232f6572.rlib\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-5594cb4f559bc761.rlib\" \"-Wl,--end-group\" \"/home/testwsl/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-38e90baf978bc428.rlib\" \"-Wl,-Bdynamic\" \"-ldl\" \"-lrt\" \"-lpthread\" \"-lgcc_s\" \"-lc\" \"-lm\" \"-lrt\" \"-lpthread\" \"-lutil\" \"-lutil\"\n  = note: Non-UTF-8 output: /usr/bin/cc: 1: /usr/bin/cc: \\x7fELF\\x01\\x01\\x01\\x02\\x03\\x01\\xe4\\x90: not found\\n/usr/bin/cc: 4: /usr/bin/cc: Syntax error: \\\"(\\\" unexpected (expecting \\\")\\\")\\n\n\nerror: aborting due to previous error\n\nerror: Could not compile `hello-rust`.\n\nCaused by:\n  process didn't exit successfully: `rustc --edition=2018 --crate-name hello_rust src/main.rs --color always --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=61a6dbe3daa05864 -C extra-filename=-61a6dbe3daa05864 --out-dir /home/testwsl/hello-rust/target/debug/deps -C incremental=/home/testwsl/hello-rust/target/debug/incremental -L dependency=/home/testwsl/hello-rust/target/debug/deps` (exit code: 1)\ntestwsl@localdesktop:~/hello-rust$\n</code></pre>\n"}, {"tags": ["docker", "rust", "rust-actix"], "answers": [{"comments": [{"owner": {"reputation": 98, "user_id": 1174961, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76c1c8486e471c350eb102bf81e43115?s=128&d=identicon&r=PG", "display_name": "Isabaellchen", "link": "https://stackoverflow.com/users/1174961/isabaellchen"}, "edited": false, "score": 1, "creation_date": 1594675797, "post_id": 58124775, "comment_id": 111203352, "body": "I was following the getting started guide of actix-web and ended up at <a href=\"https://actix.rs/docs/autoreload/\" rel=\"nofollow noreferrer\">the autreload section</a>. It recommends using <code>systemfd --no-pid -s http::3000 -- cargo watch -x run</code> which needs to be changed to <code>http::0.0.0.0:3000</code> for it to bind to all interfaces."}], "tags": [], "owner": {"reputation": 1122, "user_id": 4702606, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/a8a71d2c68d2928bd27728aa40bd4de3?s=128&d=identicon&r=PG", "display_name": "John Halbert", "link": "https://stackoverflow.com/users/4702606/john-halbert"}, "is_accepted": true, "score": 11, "last_activity_date": 1569531929, "creation_date": 1569531929, "answer_id": 58124775, "question_id": 57177889, "link": "https://stackoverflow.com/questions/57177889/rust-actix-web-inside-docker-isnt-attainable-why/58124775#58124775", "title": "Rust actix_web inside docker isn&#39;t attainable, why?", "body": "<p>If you're like myself and followed the examples on the Actix website, you might have written something like this, or some variation thereof:</p>\n\n<pre><code>fn main() {\n    HttpServer::new(|| {\n        App::new()\n            .route(\"/\", web::get().to(index))\n            .route(\"/again\", web::get().to(index2))\n    })\n    .bind(\"127.0.0.1:8088\")\n    .unwrap()\n    .run()\n    .unwrap();\n}\n</code></pre>\n\n<p>The issue here is that you're binding to a specific IP, rather than using <code>0.0.0.0</code> to bind to all IPs on the host container.  I had the same issue as you and solved it by changing my code to:</p>\n\n<pre><code>fn main() {\n    HttpServer::new(|| {\n        App::new()\n            .route(\"/\", web::get().to(index))\n            .route(\"/again\", web::get().to(index2))\n    })\n    .bind(\"0.0.0.0:8088\")\n    .unwrap()\n    .run()\n    .unwrap();\n}\n</code></pre>\n\n<p>This might not be the issue for you, I couldn't know without seeing the code to run the server.</p>\n"}, {"comments": [{"owner": {"reputation": 1838, "user_id": 452090, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c4b0dd664290d8cb6bd3a651af99bf81?s=128&d=identicon&r=PG", "display_name": "hB0", "link": "https://stackoverflow.com/users/452090/hb0"}, "edited": false, "score": 0, "creation_date": 1602283385, "post_id": 60361941, "comment_id": 113682009, "body": "This is not an answer and should be a comment to the approved answer."}, {"owner": {"reputation": 51, "user_id": 7616518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25a4fc906c676f05d6cfdc40d3273bce?s=128&d=identicon&r=PG", "display_name": "nlko", "link": "https://stackoverflow.com/users/7616518/nlko"}, "reply_to_user": {"reputation": 1838, "user_id": 452090, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c4b0dd664290d8cb6bd3a651af99bf81?s=128&d=identicon&r=PG", "display_name": "hB0", "link": "https://stackoverflow.com/users/452090/hb0"}, "edited": false, "score": 1, "creation_date": 1609754245, "post_id": 60361941, "comment_id": 115911587, "body": "@hB0 I wish I could but comments are only available to user with 50 reputation."}], "tags": [], "owner": {"reputation": 51, "user_id": 7616518, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25a4fc906c676f05d6cfdc40d3273bce?s=128&d=identicon&r=PG", "display_name": "nlko", "link": "https://stackoverflow.com/users/7616518/nlko"}, "is_accepted": false, "score": 1, "last_activity_date": 1582458914, "creation_date": 1582458914, "answer_id": 60361941, "question_id": 57177889, "link": "https://stackoverflow.com/questions/57177889/rust-actix-web-inside-docker-isnt-attainable-why/60361941#60361941", "title": "Rust actix_web inside docker isn&#39;t attainable, why?", "body": "<p>To complete what John said, in my case I had to use a tuple: <code>.bind( (\"0.0.0.0\", 8088) )</code></p>\n"}], "owner": {"reputation": 675, "user_id": 11759324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21a203b04e986490ef45fe9d09e29467?s=128&d=identicon&r=PG&f=1", "display_name": "dronte7", "link": "https://stackoverflow.com/users/11759324/dronte7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1007, "favorite_count": 1, "accepted_answer_id": 58124775, "answer_count": 2, "score": 4, "last_activity_date": 1582458914, "creation_date": 1563954844, "last_edit_date": 1563955303, "question_id": 57177889, "link": "https://stackoverflow.com/questions/57177889/rust-actix-web-inside-docker-isnt-attainable-why", "title": "Rust actix_web inside docker isn&#39;t attainable, why?", "body": "<p>I'm trying to make a docker container of my rust programme, let's look</p>\n\n<p>Dockerfile</p>\n\n<pre><code>FROM debian\n\nRUN apt-get update &amp;&amp; \\\n    apt-get -y upgrade &amp;&amp; \\\n    apt-get -y install git curl g++ build-essential\n\nRUN curl https://sh.rustup.rs -sSf | bash -s -- -y\n\nWORKDIR /usr/src/app\n\nRUN git clone https://github.com/unegare/rust-actix-rest.git\n\nRUN [\"/bin/bash\", \"-c\", \"source $HOME/.cargo/env; cd ./rust-actix-rest/; cargo build --release; mkdir uploaded\"]\n\nEXPOSE 8080\n\nENTRYPOINT [\"/bin/bash\", \"-c\", \"echo 'Hello there!'; source $HOME/.cargo/env; cd ./rust-actix-rest/; cargo run --release\"]\n\n</code></pre>\n\n<p>cmd to run: <code>docker run -it -p 8080:8080 rust_rest_api/dev</code></p>\n\n<p>but curl from outside <code>curl -i -X POST -F files[]=@img.png 127.0.0.1:8080/upload</code> results into <code>curl: (56) Recv failure: \u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0440\u0430\u0437\u043e\u0440\u0432\u0430\u043d\u043e \u0434\u0440\u0443\u0433\u043e\u0439 \u0441\u0442\u043e\u0440\u043e\u043d\u043e\u0439</code> i.e. refused by the other side of the channel</p>\n\n<p>but inside the container:</p>\n\n<pre><code>root@43598d5d9e85:/usr/src/app# lsof -i\nCOMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nactix_003   6 root    3u  IPv4 319026      0t0  TCP localhost:http-alt (LISTEN)\n</code></pre>\n\n<p>but running the programme without docker works properly and processes the same request from curl adequately.</p>\n\n<p>and inside the container:</p>\n\n<pre><code>root@43598d5d9e85:/usr/src/app# curl -i -X POST -F files[]=@i.jpg 127.0.0.1:8080/upload\nHTTP/1.1 100 Continue\n\nHTTP/1.1 201 Created\ncontent-length: 70\ncontent-type: application/json\ndate: Wed, 24 Jul 2019 08:00:54 GMT\n\n{\"keys\":[\"uploaded/5nU1nHznvKRGbkQaWAGJKpLSG4nSAYfzCdgMxcx4U2mF.jpg\"]}\n</code></pre>\n\n<p>What is the problem from outside?</p>\n"}, {"tags": ["networking", "tcp", "rust"], "comments": [{"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 0, "creation_date": 1563954397, "post_id": 57176682, "comment_id": 100867250, "body": "It looks ok to me. Maybe it is an issue in the client code, that buffers its output? To be totally sure you could try and capture the network traffic with a sniffer."}, {"owner": {"reputation": 311, "user_id": 565185, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/363a3638166ad473a56728b743ca8080?s=128&d=identicon&r=PG", "display_name": "Vladislav Korotnev", "link": "https://stackoverflow.com/users/565185/vladislav-korotnev"}, "reply_to_user": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 0, "creation_date": 1563954856, "post_id": 57176682, "comment_id": 100867476, "body": "@rodrigo -- I have tried with the following simple python program: <a href=\"https://pastebin.com/tUGhBeN9\" rel=\"nofollow noreferrer\">pastebin.com/tUGhBeN9</a> -- still gets stuck on -&gt; Pkt ... and suddenly goes fine when I Ctrl-C out of python."}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 1, "creation_date": 1563964376, "post_id": 57176682, "comment_id": 100872701, "body": "Your code does not compile, something about <code>reader</code> being consumed in the <code>loop</code>. I&#39;m guessing that this is not the actual code you are running. You should post a MCVE, and also the contents of that <code>message.bin</code> you use int he pastebin. Anyway, I fixed the code, added the missing pieces and tested it and it works as expected."}], "owner": {"reputation": 311, "user_id": 565185, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/363a3638166ad473a56728b743ca8080?s=128&d=identicon&r=PG", "display_name": "Vladislav Korotnev", "link": "https://stackoverflow.com/users/565185/vladislav-korotnev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 516, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1563984305, "creation_date": 1563950245, "last_edit_date": 1563984305, "question_id": 57176682, "link": "https://stackoverflow.com/questions/57176682/tcpstream-not-returning-from-read-until-connection-closed", "title": "TcpStream not returning from Read until connection closed", "body": "<p>I'm trying to implement a simple TCP messaging protocol in Rust with the standard TCP Sockets. The protocol is like so:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[C0 FF EE EE] header\n[XX XX] type U16LE\n[XX XX] size U16LE\n... (size - 8) bytes of arbitrary data ...\n</code></pre>\n\n<p>I have come up with the following code:</p>\n\n<pre><code>const REQUEST_HEADER: [u8; 4] = [0xC0, 0xFF, 0xEE, 0xEE];\n\npub fn run_server(host: &amp;str, port: &amp;str) {\n\n    let listener = TcpListener::bind(format!(\"{}:{}\", host, port))\n        .expect(\"Could not bind to the requested host/port combination.\");\n\n    for stream in listener.incoming() {\n        thread::spawn(|| {\n            let stream = stream.unwrap();\n            handle_client(stream);\n        });\n    }\n}\n\nfn handle_client(stream: TcpStream) {\n    stream.set_nodelay(true).expect(\"set_nodelay call failed\");\n    loop {\n        match get_packet(stream) {\n            Ok(deframed) =&gt; {\n                match deframed.msgid {\n                    Some(FrameType::Hello) =&gt; say_hello(stream),\n                    Some(FrameType::Text) =&gt; {\n                        println!(\"-- Got text message: {:X?}\", deframed.content);\n                        save_text(deframed);\n                    },\n                    Some(FrameType::Goodbye) =&gt; {\n                        println!(\"-- You say goodbye, and I say hello\");\n                        break; // end of connection\n                    },\n                    _ =&gt; println!(\"!! I don't know this packet type\")\n                }\n            },\n\n\n            Err(x) =&gt; {\n                match x {\n                    1 =&gt; println!(\"!! Malformed frame header\"),\n                    2 =&gt; println!(\"!! Client gone?\"),\n                    _ =&gt; println!(\"!! Unknown error\")\n                }\n                break;\n            }\n        }\n    }\n}\n\n// Read one packet from the stream\nfn get_packet(reader: TcpStream) -&gt; Result&lt;MyFrame, u8&gt; {\n    // read the packet header in here\n    let mut heading = [0u8; 0x8];\n\n    match reader.read_exact(&amp;mut heading) {\n        Ok(_) =&gt; {\n            // check if header is OK\n            if heading[..4] == REQUEST_HEADER\n            {\n                // extract metadata\n                let mid: u16 = ((heading[4] as u16) &lt;&lt; 0)\n                                + ((heading[5] as u16) &lt;&lt; 8);\n                let len: u16 = ((heading[6] as u16) &lt;&lt; 0) \n                                + ((heading[7] as u16) &lt;&lt; 8);\n                let remain: u16 = len - 0x8;\n                println!(\"-&gt; Pkt: 0x{:X}, length: 0x{:X}, remain: 0x{:X}\", mid, len, remain);\n\n                let mut frame = vec![0; remain as usize];\n                reader.read_exact(&amp;mut frame).expect(\"Read packet failed\");\n\n                let deframed = MyFrame { \n                    msgid:  FromPrimitive::from_u16(mid),\n                    content: frame\n                };\n                Ok(deframed)\n            } else {\n                println!(\"!! Expected packet header but got {:X?}\", heading.to_vec());\n                Err(1)\n            }\n        },\n        _ =&gt; Err(2)\n    }\n}\n</code></pre>\n\n<p>This is the Python client:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>import socket, sys\nsock = socket.socket()\nsock.connect((\"127.0.0.1\", 12345))\nf = open(\"message.bin\",'rb')\ndat = f.read()\nsock.sendall(dat)\nwhile True:\n        sock.recv(64)\n</code></pre>\n\n<p>When the program receives a multiple messages in a row, they seem to be processed fine. If the client sends a message and waits for a response, the program gets stuck at reading the frame content until ~16 more bytes are received. As a result, the program cannot send a response to the client.</p>\n\n<p>I can tell it's stuck in there and not somewhere else because the <code>-&gt;Pkt</code> log line appears with the correct metadata but it doesn't continue further processing despite the client having already sent everything.</p>\n\n<p>I've tried replacing <code>read_exact</code> with <code>read</code> but it just keeps being stuck there. Once the client software drops the connection the message is suddenly processed as normal.</p>\n\n<p>Is this a design problem or am I missing out a setting I need to change on the socket?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1563971327, "post_id": 57175003, "comment_id": 100876595, "body": "Just an idea: make two versions of your library. One defines your types. The other just re-exports the standard types."}, {"owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "edited": false, "score": 0, "creation_date": 1563971355, "post_id": 57175003, "comment_id": 100876615, "body": "I think, without new Rust features or some macro magic, the latter example is the only way to do it. There&#39;s no way to turn a struct into a trait."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 3, "last_activity_date": 1563971379, "creation_date": 1563971379, "answer_id": 57182996, "question_id": 57175003, "link": "https://stackoverflow.com/questions/57175003/how-can-i-create-a-trait-for-the-inherent-methods-of-a-type-i-dont-own/57182996#57182996", "title": "How can I create a trait for the inherent methods of a type I don&#39;t own?", "body": "<p>You need to copy the entire interface of the type and reimplement it by calling the inherent methods.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/44445730/155423\">How to call a method when a trait and struct use the same method name?</a></li>\n</ul>\n\n<blockquote>\n  <p>Is there a better way?</p>\n</blockquote>\n\n<p>Not with how you've described the requirements.</p>\n\n<p>That being said, you aren't introducing any abstraction suited to your domain. In many cases, you don't want the full power of the underlying type(s), but want to do some higher-level abstraction. If you create <em>that</em> abstraction as a trait, then you can implement the new trait for any useful types.</p>\n"}], "owner": {"reputation": 655, "user_id": 1609522, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/72d23f6a81175214bf40e56ef0b37115?s=128&d=identicon&r=PG", "display_name": "Greg Owen", "link": "https://stackoverflow.com/users/1609522/greg-owen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 57182996, "answer_count": 1, "score": 1, "last_activity_date": 1563971451, "creation_date": 1563940426, "last_edit_date": 1563971451, "question_id": 57175003, "link": "https://stackoverflow.com/questions/57175003/how-can-i-create-a-trait-for-the-inherent-methods-of-a-type-i-dont-own", "title": "How can I create a trait for the inherent methods of a type I don&#39;t own?", "body": "<p>I'd like to implement my own version of a Rust standard library feature and use my version and the real standard library version interchangeably.</p>\n\n<p>If the standard library feature were a trait, this would be easy. However, the standard library feature (in this case, <a href=\"https://doc.rust-lang.org/std/sync/struct.Condvar.html\" rel=\"nofollow noreferrer\"><code>std::sync::Condvar</code></a>) is implemented as</p>\n\n<pre><code>pub struct Condvar {...}\n\nimpl Condvar {...}\n</code></pre>\n\n<p>I tried doing</p>\n\n<pre><code>impl Condvar for MyCondvar {...}\n</code></pre>\n\n<p>but got an error (\"error[E0404]: expected trait, found struct <code>Condvar</code>\")</p>\n\n<p>How should I do this? I've also tried</p>\n\n<pre><code>pub trait CondvarTrait { // copy entire interface of Condvar }\n\nimpl CondvarTrait for Condvar {\n  // copy entire interface of Condvar again,\n  // implementing foo(&amp;self, ...) by calling self.foo(...)\n}\n\nimpl CondvarTrait for MyCondvar { // my own implementation }\n</code></pre>\n\n<p>which compiles, but is super verbose. Is there a better way?</p>\n"}, {"tags": ["rust", "lifetime", "borrow-checker"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1563954911, "post_id": 57174539, "comment_id": 100867504, "body": "That&#39;s because <a href=\"https://doc.rust-lang.org/std/primitive.str.html#method.chars\" rel=\"nofollow noreferrer\"><code>chars()</code></a> borrows the string."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1563957107, "post_id": 57174539, "comment_id": 100868628, "body": "Does your string contain only ASCII chars?"}], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 9790188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NqIWR.png?s=128&g=1", "display_name": "AC-5", "link": "https://stackoverflow.com/users/9790188/ac-5"}, "edited": false, "score": 0, "creation_date": 1563971704, "post_id": 57181877, "comment_id": 100876842, "body": "Thanks @BurntSushi5 for the explanation and for pointing out the use of <code>flat_map</code>.  You make a good point about avoiding an unnecessary String allocation by using <code>char</code> lowercase methods but I&#39;m still wondering if it is possible to take ownership of the temporary string from <code>str::to_lowercase</code> within the iterator chain to avoid having it dropped at the end of the function scope?"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "reply_to_user": {"reputation": 133, "user_id": 9790188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NqIWR.png?s=128&g=1", "display_name": "AC-5", "link": "https://stackoverflow.com/users/9790188/ac-5"}, "edited": false, "score": 1, "creation_date": 1563973697, "post_id": 57181877, "comment_id": 100878062, "body": "@AC-5 That would be answered by <a href=\"https://stackoverflow.com/q/43952104/3650362\">How can I store a Chars iterator in the same struct as the String it is iterating on?</a>"}], "tags": [], "owner": {"reputation": 10100, "user_id": 619216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c07104de771c3b6f6c30be8f592ef8f7?s=128&d=identicon&r=PG", "display_name": "BurntSushi5", "link": "https://stackoverflow.com/users/619216/burntsushi5"}, "is_accepted": true, "score": 4, "last_activity_date": 1563967724, "creation_date": 1563967724, "answer_id": 57181877, "question_id": 57174539, "link": "https://stackoverflow.com/questions/57174539/why-can-i-return-an-owned-value-which-uses-char-to-ascii-lowercase-but-not-w/57181877#57181877", "title": "Why can I return an owned value which uses &#39;char.to_ascii_lowercase()` but not with `str.to_lowercase()`", "body": "<p>The issue here is that <a href=\"https://doc.rust-lang.org/std/primitive.str.html#method.to_lowercase\" rel=\"nofollow noreferrer\"><code>str::to_lowercase</code></a> allocates a new <code>String</code> value as the lowercased version of your string, and <em>then</em> the <a href=\"https://doc.rust-lang.org/std/primitive.str.html#method.chars\" rel=\"nofollow noreferrer\"><code>str::chars</code></a> method borrows from that new <code>String</code> value. (You can tell it borrows from the <code>String</code> value by looking at the <a href=\"https://doc.rust-lang.org/std/str/struct.Chars.html\" rel=\"nofollow noreferrer\"><code>std::str::Chars</code></a> struct, which has a lifetime parameter referring to the string whose characters it is iterating over.)</p>\n\n<p>So why is this problematic? Well, that <code>String</code> value allocated by <code>to_lowercase</code> is a temporary value created as part of your iterator chain, which is in turn dropped at the end of your function's scope (the compiler's error message should tell you this). Therefore, the compiler is preventing you from a use-after-free bug. If it let you return the iterator, then it would allow callers to read from a <code>String</code> that had been deallocated, which violates memory safety.</p>\n\n<p>Your variant that uses <code>char::to_ascii_lowercase</code> works because you never allocate that intermediate <code>String</code> value. Therefore, you wind up returning an iterator that borrows from the input to the function, which is valid, and is why you needed to add a lifetime parameter. (Otherwise, the compiler assumes the lifetime on a <code>impl Trait</code> is <code>'static</code>, which is not the case here. The lifetime of your returned value is <em>tied</em> to the lifetime of the input to the function.)</p>\n\n<p>You can fix this by avoiding the allocation of a temporary <code>String</code>, which should hopefully be more efficient. The trick is to realize that <code>char</code> has a method <a href=\"https://doc.rust-lang.org/std/primitive.char.html#method.to_lowercase\" rel=\"nofollow noreferrer\"><code>char::to_lowercase</code></a> which returns an <em>iterator</em> over the lowercase equivalent of the given character, and <em>not</em> a <code>String</code>. Therefore, you can just read from this directly:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn decode_to_iter&lt;'a&gt;(cipher: &amp;'a str) -&gt; impl Iterator&lt;Item = char&gt; + 'a {\n    cipher\n        .chars()\n        .flat_map(|c| c.to_lowercase())\n        .filter(|c| c.is_alphanumeric() &amp;&amp; c.is_ascii())\n        .map(|c| {\n            if c.is_alphabetic() {\n                (((b'z' - (c as u8)) + b'a') as char)\n            } else {\n                c\n            }\n        })\n}\n</code></pre>\n\n<p>The only real trick here is to use <code>flat_map</code>, which is like a normal <code>map</code>, but it lets you return an iterator that is then flattened into the original iterator (if you used a normal <code>map</code> here, you'd wind up with an iterator of iterators).</p>\n\n<p>With that said, if you really only care about ASCII codepoints here (due to your <code>filter</code> predicate), then you don't need the full Unicode aware lowercasing mechanism. So I'd probably write it similarly to your second variant, with <code>char::to_ascii_lowercase</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn decode_to_iter&lt;'a&gt;(cipher: &amp;'a str) -&gt; impl Iterator&lt;Item = char&gt; + 'a {\n    cipher\n        .chars()\n        .filter(|c| c.is_ascii_alphanumeric())\n        .map(|c| c.to_ascii_lowercase())\n        .map(|c| {\n            if c.is_alphabetic() {\n                (((b'z' - (c as u8)) + b'a') as char)\n            } else {\n                c\n            }\n        })\n}\n</code></pre>\n\n<p>And here's a <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=7b27ba2f118dd39c627c913a99117fd4\" rel=\"nofollow noreferrer\">playground link</a> showing the code.</p>\n"}], "owner": {"reputation": 133, "user_id": 9790188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NqIWR.png?s=128&g=1", "display_name": "AC-5", "link": "https://stackoverflow.com/users/9790188/ac-5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "accepted_answer_id": 57181877, "answer_count": 1, "score": 3, "last_activity_date": 1563967724, "creation_date": 1563936440, "question_id": 57174539, "link": "https://stackoverflow.com/questions/57174539/why-can-i-return-an-owned-value-which-uses-char-to-ascii-lowercase-but-not-w", "title": "Why can I return an owned value which uses &#39;char.to_ascii_lowercase()` but not with `str.to_lowercase()`", "body": "<p>Within a function which takes in <code>&amp;str</code> and returns <code>impl Iterator&lt;Item = char&gt;</code>, I am trying to convert the input to lowercase and then filter and map the characters of that lowered form.  I have been stuck for some time with the following error while using <code>str.to_lowercase()</code>:</p>\n\n<pre><code>  --&gt; src/lib.rs                                                                                                                      \n   |                                                                                                                                        \n   |        cipher                                                                                                                          \n   |   _____^                                                                                                                               \n   |  |_____|                                                                                                                               \n   | ||                                                                                                                                     \n   | ||         .to_lowercase()                                                                                                             \n   | ||_______________________- temporary value created here                                                                                \n   | |          .chars()                                                                                                                    \n   | |          .filter(|c| c.is_alphanumeric() &amp;&amp; c.is_ascii())                                                                            \n...  |                                                                                                                                      \n   | |              }                                                                                                                       \n   | |          })                                                                                                                          \n   | |___________^ returns a value referencing data owned by the current function    \n</code></pre>\n\n<p>The function in its original form:</p>\n\n<pre><code>pub fn decode_to_iter(cipher: &amp;str) -&gt; impl Iterator&lt;Item = char&gt; {\n    cipher\n        .to_lowercase()\n        .chars()\n        .filter(|c| c.is_alphanumeric() &amp;&amp; c.is_ascii())\n        .map(|c| {\n            if c.is_alphabetic() {\n                (((b'z' - (c as u8)) + b'a') as char)\n            } else {\n                c\n            }\n        })\n}\n</code></pre>\n\n<p>I came across a couple of questions online asking very similar questions about how to return an owned value that's been transformed with <code>.to_lowercase()</code> but none of the solutions posted work for me.</p>\n\n<p>I am trying to avoid using <code>&amp;char</code> and stick with <code>char</code> in my return type.</p>\n\n<p>I've tried to use functions like <code>.to_owned()</code> to take ownership of the reference but have come up empty-handed.</p>\n\n<p>Ultimately, I was able to get my function to compile and pass my tests using <code>char.to_ascii_lowercase()</code>.  The working version of my function is:</p>\n\n<pre><code>pub fn decode_to_iter&lt;'a&gt;(cipher: &amp;'a str) -&gt; impl Iterator&lt;Item = char&gt; + 'a {\n    cipher\n        .chars()\n        .filter(|c| c.is_alphanumeric() &amp;&amp; c.is_ascii())\n        .map(|c| {\n            if c.is_alphabetic() {\n                (((b'z' - (c.to_ascii_lowercase() as u8)) + b'a') as char)\n            } else {\n                c.to_ascii_lowercase()\n            }\n        })\n}\n</code></pre>\n\n<p>One of the things that are confusing me the most is what the difference between the <code>str.to_lowercase()</code> and <code>char.to_ascii_lowercase()</code> is.  The documentation for <code>.to_ascii_lowercase()</code> under <a href=\"https://doc.rust-lang.org/std/primitive.char.html#method.to_ascii_lowercase\" rel=\"nofollow noreferrer\">Primative Type Char</a> shows:</p>\n\n<pre><code>pub fn to_ascii_lowercase(&amp;self) -&gt; char\n</code></pre>\n\n<p>while the documentation for <code>.to_lowercase()</code> under <a href=\"https://doc.rust-lang.org/std/primitive.str.html\" rel=\"nofollow noreferrer\">Primative Type Str</a> shows:</p>\n\n<pre><code>pub fn to_lowercase(&amp;self) -&gt; String\n</code></pre>\n\n<p>Unless I'm misunderstanding, both functions seem to return an owned value so I am unsure why only <code>char.to_ascii_lowercase()</code> works.</p>\n\n<p>I am wondering:</p>\n\n<ol>\n<li><p>how to properly return an <code>Impl Iterator</code> value which uses <code>.to_lowercase()</code> rather than <code>.to_ascsii_lowercase()</code>?</p></li>\n<li><p>what the difference is between <code>char.to_lowercase()</code> and <code>str.to_ascii_lowercase()</code>?</p></li>\n</ol>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563920173, "post_id": 57172768, "comment_id": 100858789, "body": "Your last code block appears to be a mix of Rust code and an error message. Please take the time to review your question before and after posting to make sure it accurately and effectively communicates what you intended."}, {"owner": {"reputation": 40865, "user_id": 10431, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/22aac6106c44ae4078bd4c0a564714e0?s=128&d=identicon&r=PG", "display_name": "Keith Nicholas", "link": "https://stackoverflow.com/users/10431/keith-nicholas"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563920316, "post_id": 57172768, "comment_id": 100858819, "body": "@Shepmaster I think thats the point, they are showing the code and what error it&#39;s saying and wanting to know how to do it correctly?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 40865, "user_id": 10431, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/22aac6106c44ae4078bd4c0a564714e0?s=128&d=identicon&r=PG", "display_name": "Keith Nicholas", "link": "https://stackoverflow.com/users/10431/keith-nicholas"}, "edited": false, "score": 0, "creation_date": 1563920558, "post_id": 57172768, "comment_id": 100858868, "body": "@KeithNicholas my point is that the code they are attempting to compile and the error message should be in two separate code blocks. They make no sense to be smushed together."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563920678, "post_id": 57172768, "comment_id": 100858901, "body": "Applying the duplicate to this case: <code>unsafe extern &quot;C&quot; fn callback_button_0()</code> and <code>unsafe { set_button_handler(0, Some(callback_button_0)); }</code>"}, {"owner": {"reputation": 904, "user_id": 1505018, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/27c5e51811461ffac5f120adea9a0b6e?s=128&d=identicon&r=PG", "display_name": "dazedviper", "link": "https://stackoverflow.com/users/1505018/dazedviper"}, "edited": false, "score": 0, "creation_date": 1563922755, "post_id": 57172768, "comment_id": 100859346, "body": "Indeed, this is a duplicate. Thank you!"}], "owner": {"reputation": 904, "user_id": 1505018, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/27c5e51811461ffac5f120adea9a0b6e?s=128&d=identicon&r=PG", "display_name": "dazedviper", "link": "https://stackoverflow.com/users/1505018/dazedviper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 18, "favorite_count": 0, "closed_date": 1563920222, "answer_count": 0, "score": 0, "last_activity_date": 1563920122, "creation_date": 1563919278, "last_edit_date": 1563920122, "question_id": 57172768, "link": "https://stackoverflow.com/questions/57172768/passing-a-rust-function-as-an-argument-to-a-c-function", "closed_reason": "Duplicate", "title": "Passing a Rust function as an argument to a C function", "body": "<p>I have the following C function:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>typedef void (*button_handler_fn_t)();\n\nvoid set_button_handler(uint32_t button_no, button_handler_fn_t handler_fn);\n</code></pre>\n\n<p>The second parameter is a C function that takes no parameters and returns <code>void</code>.</p>\n\n<p>I want to call this C function from Rust, passing in a Rust function. <a href=\"https://rust-lang.github.io/rust-bindgen/\" rel=\"nofollow noreferrer\"><code>bindgen</code></a> generates the following bindings which I then import in my Rust program:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub type button_handler_fn_t = ::core::option::Option&lt;unsafe extern \"C\" fn()&gt;;\n\nextern \"C\" {\n    pub fn set_button_handler(button_no: u32, handler_fn: button_handler_fn_t);\n}\n</code></pre>\n\n<p>How can I make a function call?</p>\n\n<pre><code>include!(concat!(env!(\"OUT_DIR\"), \"/bindings.rs\"));\n\nunsafe fn callback_button_0() {\n    svc_leds_toggle(0);\n}\n\nfn main() -&gt; ! {\n    set_button_handler(0, callback_button_0);\n                          ^^^^^^^^^^^^^^^^^ expected enum `core::option::Option`, found fn item\n\n   = note: expected type `core::option::Option&lt;unsafe extern \"C\" fn()&gt;`\n              found type `unsafe fn() {callback_button_0}`                          \n</code></pre>\n"}, {"tags": ["rust", "iterator"], "answers": [{"tags": [], "owner": {"reputation": 67096, "user_id": 265521, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/34a66330977044d70165288c56740d4b?s=128&d=identicon&r=PG", "display_name": "Timmmm", "link": "https://stackoverflow.com/users/265521/timmmm"}, "is_accepted": false, "score": 2, "last_activity_date": 1563919957, "last_edit_date": 1563919957, "creation_date": 1563918655, "answer_id": 57172670, "question_id": 57172523, "link": "https://stackoverflow.com/questions/57172523/how-do-i-continue-using-an-iterator-after-calling-take/57172670#57172670", "title": "How do I continue using an iterator after calling take?", "body": "<p>You can use <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.by_ref\" rel=\"nofollow noreferrer\"><code>.by_ref()</code></a> like this:</p>\n\n<pre><code>let iterator = text.split_whitespace();\nlet first_ten_words = iterator.by_ref().take(10).collect();\n\nfor word in iterator {\n    // This should iterate over the remaining words.\n}\n</code></pre>\n"}], "owner": {"reputation": 67096, "user_id": 265521, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/34a66330977044d70165288c56740d4b?s=128&d=identicon&r=PG", "display_name": "Timmmm", "link": "https://stackoverflow.com/users/265521/timmmm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "closed_date": 1563919894, "answer_count": 1, "score": 1, "last_activity_date": 1563920021, "creation_date": 1563917744, "last_edit_date": 1563919921, "question_id": 57172523, "link": "https://stackoverflow.com/questions/57172523/how-do-i-continue-using-an-iterator-after-calling-take", "closed_reason": "Duplicate", "title": "How do I continue using an iterator after calling take?", "body": "<p>I want to collect a few items from an iterator, then iterate through the rest, something like this:</p>\n\n<pre><code>let iterator = text.split_whitespace();\nlet first_ten_words = iterator.take(10).collect();\n\nfor word in iterator {\n    // This should iterate over the remaining words.\n}\n</code></pre>\n\n<p>This doesn't work because <code>take()</code> consumes the iterator.</p>\n\n<p>Obviously I can use <code>split_whitespace()</code> twice and <code>skip(10)</code> but I assume that will do the splitting of the first 10 words twice, and therefore be inefficient.</p>\n\n<p>Is there a better way to do it?</p>\n"}, {"tags": ["enums", "rust", "matching"], "comments": [{"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 1, "creation_date": 1563916505, "post_id": 57171185, "comment_id": 100857780, "body": "<a href=\"https://crates.io/crates/matches\" rel=\"nofollow noreferrer\"><code>matches!(a, D::A(_))</code></a>"}], "answers": [{"comments": [{"owner": {"reputation": 187, "user_id": 2887274, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f5fb5ef8fb04cf06c49f03a9ad35f5e?s=128&d=identicon&r=PG&f=1", "display_name": "Matthew S", "link": "https://stackoverflow.com/users/2887274/matthew-s"}, "edited": false, "score": 1, "creation_date": 1594274145, "post_id": 57171257, "comment_id": 111069452, "body": "Man.. I still don&#39;t know why enums cannot be passed as parameters in Rust. It&#39;s really counter-intuitive."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 9, "last_activity_date": 1563920807, "last_edit_date": 1563920807, "creation_date": 1563911502, "answer_id": 57171257, "question_id": 57171185, "link": "https://stackoverflow.com/questions/57171185/how-do-i-pass-an-enum-variant-to-match-on-as-a-function-parameter/57171257#57171257", "title": "How do I pass an enum variant to match on as a function parameter?", "body": "<p>You cannot.</p>\n\n<ul>\n<li>It is not possible to pass types as function parameters.</li>\n<li>Enum variants are not types to start with.</li>\n</ul>\n\n<p>If you are OK using a macro instead of a function, see</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/a/51123901/155423\">How do I assert an enum is a specific variant if I don't care about its fields?</a></li>\n<li>The <a href=\"https://crates.io/crates/matches\" rel=\"nofollow noreferrer\">matches crate</a></li>\n</ul>\n\n<p>See also:</p>\n\n<ul>\n<li><p><a href=\"https://stackoverflow.com/q/32554285/155423\">Compare enums only by variant, not value</a></p></li>\n<li><p><a href=\"https://stackoverflow.com/q/51567350/155423\">Can traits be used on enum types?</a></p></li>\n<li><a href=\"https://stackoverflow.com/q/29935878/155423\">Can struct-like enums be used as types?</a></li>\n<li><a href=\"https://stackoverflow.com/q/49705007/155423\">Is there a way to use existing structs as enum variants?</a></li>\n</ul>\n"}], "owner": {"reputation": 1791, "user_id": 3527983, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/HfU8x.jpg?s=128&g=1", "display_name": "asosnovsky", "link": "https://stackoverflow.com/users/3527983/asosnovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2562, "favorite_count": 1, "accepted_answer_id": 57171257, "answer_count": 1, "score": 3, "last_activity_date": 1563920807, "creation_date": 1563911148, "last_edit_date": 1563911212, "question_id": 57171185, "link": "https://stackoverflow.com/questions/57171185/how-do-i-pass-an-enum-variant-to-match-on-as-a-function-parameter", "title": "How do I pass an enum variant to match on as a function parameter?", "body": "<p>I would like to pass in the parameters what arm of the enum I need to match, something like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>enum D {\n    A(i64),\n    B(u64),\n    C(u64, u64),\n}\n</code></pre>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let a = D.A(10);\nprintln!(a.is_of(D.A)); // true\nprintln!(a.is_of(D.B)); // false\n</code></pre>\n\n<p>I know I can use matching rules for this, but I'd like this <code>is_of</code> method to take as an input of the enum options for my purposes.</p>\n"}, {"tags": ["c++", "rust", "cross-compiling", "abi", "linaro"], "comments": [{"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 4, "creation_date": 1563909867, "post_id": 57170852, "comment_id": 100855121, "body": "I don&#39;t think there&#39;s anything guaranteeing rust/c++ binary compatibility.. at least not anything I&#39;ve heard of."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 6, "creation_date": 1563909903, "post_id": 57170852, "comment_id": 100855131, "body": "There&#39;s nothing that guarantees C++ ABI compatibility, period."}, {"owner": {"reputation": 41, "user_id": 2036016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b942b33f5a5f97daf01b7333b5b69d1d?s=128&d=identicon&r=PG", "display_name": "kodr", "link": "https://stackoverflow.com/users/2036016/kodr"}, "reply_to_user": {"reputation": 3108, "user_id": 4641116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gc52U.png?s=128&g=1", "display_name": "Eljay", "link": "https://stackoverflow.com/users/4641116/eljay"}, "edited": false, "score": 0, "creation_date": 1563911241, "post_id": 57170852, "comment_id": 100855706, "body": "@Eljay this is the API surface of the shared library - <a href=\"https://github.com/Azure/iotedge/blob/master/edgelet/hsm-sys/azure-iot-hsm-c/inc/hsm_client_data.h\" rel=\"nofollow noreferrer\">github.com/Azure/iotedge/blob/master/edgelet/hsm-sys/&hellip;</a>  The source in the linked repository is all C but I have an implementation of this API surface which is a combination of C and C++ instead.  The source in the linked repository when compiled with the same linaro toolchain yields a library with the SYSV ABI (which I&#39;m guessing is due to gcc use only) whereas compiling the implementation I have (with both C/C++) yields a binary with the GNU/Linux ABI instead"}, {"owner": {"reputation": 41, "user_id": 2036016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b942b33f5a5f97daf01b7333b5b69d1d?s=128&d=identicon&r=PG", "display_name": "kodr", "link": "https://stackoverflow.com/users/2036016/kodr"}, "reply_to_user": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1563911424, "post_id": 57170852, "comment_id": 100855780, "body": "@JesperJuhl are you aware of any guidance on how to link dynamic libraries to Rust executables? The repository I&#39;ve linked in my comment above has the Rust executable I had mentioned in my question (<a href=\"https://github.com/Azure/iotedge/tree/master/edgelet/iotedged\" rel=\"nofollow noreferrer\">github.com/Azure/iotedge/tree/master/edgelet/iotedged</a>) which links successfully against a C implementation of the shared library present here: <a href=\"https://github.com/Azure/iotedge/tree/master/edgelet/hsm-sys/azure-iot-hsm-c\" rel=\"nofollow noreferrer\">github.com/Azure/iotedge/tree/master/edgelet/hsm-sys/&hellip;</a>"}, {"owner": {"reputation": 3108, "user_id": 4641116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gc52U.png?s=128&g=1", "display_name": "Eljay", "link": "https://stackoverflow.com/users/4641116/eljay"}, "edited": false, "score": 0, "creation_date": 1563911507, "post_id": 57170852, "comment_id": 100855811, "body": "Thank you.  I did not know there were differences in the C ABI for GNU/Linux and SYSV.  I learned something new.  +1"}, {"owner": {"reputation": 41, "user_id": 2036016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b942b33f5a5f97daf01b7333b5b69d1d?s=128&d=identicon&r=PG", "display_name": "kodr", "link": "https://stackoverflow.com/users/2036016/kodr"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563911513, "post_id": 57170852, "comment_id": 100855815, "body": "@Shepmaster tagging you here to get your thoughts on the same question I&#39;ve asked in my response to JesperJuhl above."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563912545, "post_id": 57170852, "comment_id": 100856238, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/24105186/can-i-call-c-or-c-functions-from-rust-code\">Can I call C or C++ functions from Rust code?</a>"}, {"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1563912619, "post_id": 57170852, "comment_id": 100856269, "body": "&quot;are you aware of any guidance on how to link dynamic libraries to Rust executables&quot; - No. Sorry."}, {"owner": {"reputation": 41, "user_id": 2036016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b942b33f5a5f97daf01b7333b5b69d1d?s=128&d=identicon&r=PG", "display_name": "kodr", "link": "https://stackoverflow.com/users/2036016/kodr"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563912823, "post_id": 57170852, "comment_id": 100856340, "body": "@Stargateur I believe I went through that post earlier. As you mention in your answer to the question on that post - &quot;So, to call C++ from Rust, you must pass by C.&quot;, that is exactly what&#39;s happening my my case too. The problem here is more of an ABI incompat issue on aarch64 target architectures. As stated earlier, the dynamic loading of the shared library works perfectly on amd64 machines."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563913061, "post_id": 57170852, "comment_id": 100856460, "body": "In your question you are mixing C and C++, &quot;C/C++&quot; that very unclear when you want to talk of C or when you want to talk of C++. Please <a href=\"https://stackoverflow.com/posts/57170852/edit\">edit</a> your question to avoid mixing two languages specially when you talk about ABI that are both implementation behavior and totally different between C and C++."}, {"owner": {"reputation": 41, "user_id": 2036016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b942b33f5a5f97daf01b7333b5b69d1d?s=128&d=identicon&r=PG", "display_name": "kodr", "link": "https://stackoverflow.com/users/2036016/kodr"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563913365, "post_id": 57170852, "comment_id": 100856617, "body": "@Stargateur Just edited the question to add a bit more clarification. The reason I mentioned C/C++ both is because the library has code in both languages. To provide a brief overview, the library is an implementation of the this header file: <a href=\"https://github.com/Azure/iotedge/blob/master/edgelet/hsm-sys/azure-iot-hsm-c/inc/hsm_client_data.h\" rel=\"nofollow noreferrer\">github.com/Azure/iotedge/blob/master/edgelet/hsm-sys/&hellip;</a> I&#39;ve kept a lot of the C implementation code from the linked repository but have modified the implementation of some of the headers to use C++ instead.  I&#39;ll add this information to the question too"}], "owner": {"reputation": 41, "user_id": 2036016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b942b33f5a5f97daf01b7333b5b69d1d?s=128&d=identicon&r=PG", "display_name": "kodr", "link": "https://stackoverflow.com/users/2036016/kodr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 296, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1563913410, "creation_date": 1563909508, "last_edit_date": 1563913410, "question_id": 57170852, "link": "https://stackoverflow.com/questions/57170852/abi-incompatibility-of-rust-executable-with-c-dynamic-library", "title": "ABI incompatibility of Rust executable with C++ dynamic library", "body": "<p>I'm currently trying to link a Rust executable with a shared library written in C++ and C. The dynamic loading of the shared library works perfectly on amd64 architectures but I am running into segmentation fault errors when the executable tries to load the shared library on an aarch64 linux machine [Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-1033-raspi2 aarch64)].</p>\n\n<p>I am using the Linaro aarch64 toolchain (<a href=\"http://releases.linaro.org/components/toolchain/binaries/latest-7/aarch64-linux-gnu/gcc-linaro-7.4.1-2019.02-x86_64_aarch64-linux-gnu.tar.xz\" rel=\"nofollow noreferrer\">http://releases.linaro.org/components/toolchain/binaries/latest-7/aarch64-linux-gnu/gcc-linaro-7.4.1-2019.02-x86_64_aarch64-linux-gnu.tar.xz</a>) to cross-compile the shared library (combination of C++ and C code).</p>\n\n<p>On inspection using file/readelf, the resultant shared library has the GNU/Linux ABI which seems to be because of the use of g++ to build the C++ code in the library whereas the ABI of the Rust executable is SYSV (cross compiled for aarch64 using the <a href=\"https://github.com/rust-embedded/cross\" rel=\"nofollow noreferrer\">https://github.com/rust-embedded/cross</a> project)</p>\n\n<p>I\u2019ve noticed that manually editing the .so file of the shared library to change the ABI flag from GNU/Linux to SYSV resolves the problem.</p>\n\n<p>Is it possible to make either the executable or the library target a specific ABI? Ideally, I would like to build the Rust executable in a way so that it can link to the shared library irrespective of the library's ABI.</p>\n\n<p>To provide a brief overview, the shared library is an implementation of the this header file:\n<a href=\"https://github.com/Azure/iotedge/blob/master/edgelet/hsm-sys/azure-iot-hsm-c/inc/hsm_client_data.h\" rel=\"nofollow noreferrer\">https://github.com/Azure/iotedge/blob/master/edgelet/hsm-sys/azure-iot-hsm-c/inc/hsm_client_data.h</a>\nI've kept a lot of the C implementation code from the linked repository but have modified the implementation of some of the headers to use C++ instead.</p>\n\n<p>Please let me know if any additional details are required.</p>\n\n<p><em>I've tried switching back to older versions of g++ (4.9) to build the C and C++ shared library but it always yields an artifact that has an ABI of GNU/Linux.</em></p>\n\n<p>This question was identified as a duplicate of this one <a href=\"https://stackoverflow.com/questions/24105186/can-i-call-c-or-c-functions-from-rust-code\">Can I call C or C++ functions from Rust code?</a> but the answers to those questions haven't helped solve my problem as the suggestions/answers on that post state that C++ can be called by passing through a C 'interface' which is exactly what I have. The problem is more of an ABI incompatibility issue for a specific target architecture i.e., aarch64. The problem doesn't reproduce on an amd64 target architecture.</p>\n\n<p><strong>Expected</strong> - The Rust executable and the dynamic shared library built using both C and C++ to have compatible ABIs for aarch64.</p>\n\n<p><strong>Actual</strong> - Rust executable is targeting the SYSV ABI whereas the dynamic shared library is targeting the GNU/Linux ABI.</p>\n"}, {"tags": ["rust", "move-semantics"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563904121, "post_id": 57169639, "comment_id": 100852690, "body": "It looks like your question might be answered by the answers of <a href=\"https://stackoverflow.com/q/53038935/155423\">Cannot move out of captured variables in an <code>FnMut</code> closure</a>; <a href=\"https://stackoverflow.com/q/28521637/155423\">How can I move a captured variable into a closure within a closure?</a>; <a href=\"https://stackoverflow.com/q/50000453/155423\">Cannot move out of captured outer variable in an Fn closure</a>; etc.. If not, please <b><a href=\"https://stackoverflow.com/posts/57169639/edit\">edit</a></b> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 23, "user_id": 11826156, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9kdhtYwRueQ/AAAAAAAAAAI/AAAAAAAAAAc/PIqPjDiY5PI/photo.jpg?sz=128", "display_name": "Krey Lazory", "link": "https://stackoverflow.com/users/11826156/krey-lazory"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563905479, "post_id": 57169639, "comment_id": 100853320, "body": "@Shepmaster Okay, you know what, I&#39;ll just post what I&#39;m actually trying to do"}, {"owner": {"reputation": 23, "user_id": 11826156, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9kdhtYwRueQ/AAAAAAAAAAI/AAAAAAAAAAc/PIqPjDiY5PI/photo.jpg?sz=128", "display_name": "Krey Lazory", "link": "https://stackoverflow.com/users/11826156/krey-lazory"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563905650, "post_id": 57169639, "comment_id": 100853388, "body": "@Shepmaster I don&#39;t understand what closures are, I think. I tried learning about them in the docs, but they&#39;re really complicated"}, {"owner": {"reputation": 24901, "user_id": 198927, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/eExki.jpg?s=128&g=1", "display_name": "Petrus Theron", "link": "https://stackoverflow.com/users/198927/petrus-theron"}, "edited": false, "score": 0, "creation_date": 1563985290, "post_id": 57169639, "comment_id": 100884805, "body": "@KreyLazory I&#39;m stuck on exactly the same problem with ws-rs, where I&#39;m trying to get the server&#39;s ws::Sender value out so that I can loop over some other channel and broadcast to clients. I think the way I solved it last time was to use a completely different library."}, {"owner": {"reputation": 23, "user_id": 11826156, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9kdhtYwRueQ/AAAAAAAAAAI/AAAAAAAAAAc/PIqPjDiY5PI/photo.jpg?sz=128", "display_name": "Krey Lazory", "link": "https://stackoverflow.com/users/11826156/krey-lazory"}, "edited": false, "score": 0, "creation_date": 1566554959, "post_id": 57169639, "comment_id": 101701926, "body": "Solved it by using messaging channels and separate threads."}], "owner": {"reputation": 23, "user_id": 11826156, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9kdhtYwRueQ/AAAAAAAAAAI/AAAAAAAAAAc/PIqPjDiY5PI/photo.jpg?sz=128", "display_name": "Krey Lazory", "link": "https://stackoverflow.com/users/11826156/krey-lazory"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 508, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1563905586, "creation_date": 1563904008, "last_edit_date": 1563905586, "question_id": 57169639, "link": "https://stackoverflow.com/questions/57169639/cannot-move-out-of-discord-a-captured-variable-in-an-fnmut-closure", "title": "Cannot move out of &#39;discord&#39;, a captured variable in an &#39;FnMut&#39; closure", "body": "<p>I'm using the ws crate to make a single-threaded WebSocket server. I've reproduced the problem here:</p>\n\n<pre><code>extern crate rustcord;\nextern crate ws;\n\nuse rustcord::{Rustcord, User, EventHandlers};\nuse ws::listen;\n\nstruct Handlers;\n\nimpl EventHandlers for Handlers {\n    fn ready(_user: User) { }\n}\n\nfn main() {\n    let discord = Rustcord::init::&lt;Handlers&gt;(\"&lt;client_id&gt;\", true, None)\n        .expect(\"Failed\");\n\n    listen(\"127.0.0.1:8080\", |out| {\n        move |msg| {\n            discord.clear_presence();\n            out.send(msg)\n        }\n    });\n}\n</code></pre>\n\n<p>Here's the output from <code>cargo check</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0507]: cannot move out of `discord`, a captured variable in an `FnMut` closure\n  --&gt; src/main.rs:18:9\n   |\n14 |     let discord = Rustcord::init::&lt;Handlers&gt;(\"&lt;client_id&gt;\", true, None)\n   |         ------- captured outer variable\n...\n18 |         move |msg| {\n   |         ^^^^^^^^^^ move out of `discord` occurs here\n19 |             discord.clear_presence();\n   |             -------\n   |             |\n   |             move occurs because `discord` has type `rustcord::Rustcord`, which does not implement the `Copy` trait\n   |             move occurs due to use in closure\n</code></pre>\n\n<p>Here is my Cargo.toml file:</p>\n\n<pre><code>[package]\nname = \"fooproject\"\nversion = \"0.1.0\"\nauthors = [\"entity100011\"]\nedition = \"2018\"\n\n[dependencies]\nws = \"=0.8.1\"\nrustcord = \"=0.2.2\"\n</code></pre>\n\n<p>I'm new to Rust and don't grasp the whole concept of \"closures\" and other Rust things. There may be other questions with the solution for this, but I can't understand the code there.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563900845, "post_id": 57168816, "comment_id": 100851261, "body": "One of the duplicates <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=60b3e25ec0b0152f089aad42d456752e\" rel=\"nofollow noreferrer\">applied to your question</a>."}, {"owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563901493, "post_id": 57168816, "comment_id": 100851551, "body": "@Shepmaster <code>arrayvec</code> is not part of main Rust source tree, so I don&#39;t want to use unofficial crates."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1563902698, "post_id": 57168816, "comment_id": 100852036, "body": "<i>I don&#39;t want to use unofficial crates</i> \u2014 you are going to experience a lot of problems if you choose to keep this stance. Things that many people consider &quot;core functionality&quot; (like random number generation) are not part of the standard library."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563902716, "post_id": 57168816, "comment_id": 100852046, "body": "<i>Maybe someone would suggest to write a macro</i> \u2014 yes, they <a href=\"https://stackoverflow.com/a/36926695/155423\">already did</a>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563902950, "post_id": 57168816, "comment_id": 100852167, "body": "Your original question has no restriction about only using the standard library, but <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=76eea11f5d17cccad9a65077bcb9f737\" rel=\"nofollow noreferrer\">I&#39;d write it basically like your code</a>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563903154, "post_id": 57168816, "comment_id": 100852265, "body": "See also <a href=\"https://stackoverflow.com/q/33751796/155423\">Is there a way to count with macros?</a>."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563904248, "post_id": 57168816, "comment_id": 100852748, "body": "Your question is totally answered by the duplicates, why should it be close as duplicates ?"}], "owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 347, "favorite_count": 0, "closed_date": 1563900523, "answer_count": 0, "score": 1, "last_activity_date": 1563900602, "creation_date": 1563900319, "last_edit_date": 1563900581, "question_id": 57168816, "link": "https://stackoverflow.com/questions/57168816/initialize-array-with-consecutive-integers", "closed_reason": "Duplicate", "title": "Initialize array with consecutive integers", "body": "<p>What is the simplest form of initializing an array with consecutive integers from 0 to N?</p>\n\n<p>I have this code, but I think idiomatic Rust will look much simpler:</p>\n\n<pre><code>const NUM: u32 = 8;\n\nfn main() {\n    let mut int_list: [u32; NUM as usize] = [0; NUM as usize];\n    for i in 0..NUM {\n        int_list[i as usize] = i;\n    }\n    println!(\"data: {:?}\", int_list);\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=66583b8556d5eb4a624d2fff9f16ea80\" rel=\"nofollow noreferrer\">playground</a></p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 1, "creation_date": 1563894761, "post_id": 57166894, "comment_id": 100848168, "body": "isn&#39;t Dim publicly reexported in the ndarray prelude ?"}, {"owner": {"reputation": 474, "user_id": 5905325, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t4Uf-a54iNo/AAAAAAAAAAI/AAAAAAAAAdA/jc13jE20tww/photo.jpg?sz=128", "display_name": "murphy", "link": "https://stackoverflow.com/users/5905325/murphy"}, "reply_to_user": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1563896994, "post_id": 57166894, "comment_id": 100849442, "body": "Thanks, thats it. I let me fool by the compiler-output and then looked the wrong way. Also, &#39;reexported&#39; types were new to me. (I&#39;m still in my learning phase)"}], "answers": [{"comments": [{"owner": {"reputation": 24901, "user_id": 198927, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/eExki.jpg?s=128&g=1", "display_name": "Petrus Theron", "link": "https://stackoverflow.com/users/198927/petrus-theron"}, "edited": false, "score": 0, "creation_date": 1565041857, "post_id": 57168557, "comment_id": 101219146, "body": "What are the benefits to having an owned array over just an array?"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "reply_to_user": {"reputation": 24901, "user_id": 198927, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/eExki.jpg?s=128&g=1", "display_name": "Petrus Theron", "link": "https://stackoverflow.com/users/198927/petrus-theron"}, "edited": false, "score": 0, "creation_date": 1565043400, "post_id": 57168557, "comment_id": 101219528, "body": "@PetrusTheron That inquiry is unclear. Arrays are owned by default, unless you have a slice, a reference to an array, or for the case of ndarray, an array view. Perhaps you&#39;d like to ask a new question."}], "tags": [], "owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "is_accepted": true, "score": 3, "last_activity_date": 1563899345, "creation_date": 1563899345, "answer_id": 57168557, "question_id": 57166894, "link": "https://stackoverflow.com/questions/57166894/how-can-i-store-an-ndarray-in-a-struct-when-ndarraydimensiondimdim-is-priv/57168557#57168557", "title": "How can I store an ndarray in a struct when ndarray::dimension::dim::Dim is private?", "body": "<p><code>Dim</code> is re-exported to the crate's root (see <a href=\"https://doc.rust-lang.org/book/ch07-04-bringing-paths-into-scope-with-the-use-keyword.html#re-exporting-names-with-pub-use\" rel=\"nofollow noreferrer\"><em>re-exporting names with <code>pub use</code></em></a>).\nWhen in doubt, you can <a href=\"https://docs.rs/ndarray/0.12.1/ndarray/?search=Dim\" rel=\"nofollow noreferrer\">search the crate's documentation</a> for that type by name.</p>\n\n<p>In <code>ndarray</code>, there are multiple other useful type aliases that you might wish to use instead of specifying <code>ArrayBase</code> directly:</p>\n\n<ul>\n<li><a href=\"https://docs.rs/ndarray/0.12.1/ndarray/type.Array.html\" rel=\"nofollow noreferrer\"><code>Array&lt;A, D&gt;</code></a>, equivalent to <code>ArrayBase&lt;OwnedRepr&lt;A&gt;, D&gt;</code>, explicitly represents an owned array.</li>\n<li><a href=\"https://docs.rs/ndarray/0.12.1/ndarray/type.Array2.html\" rel=\"nofollow noreferrer\"><code>Array2&lt;A&gt;</code></a> can be used specifically for owned two-dimensional arrays, thus already defining the dimension type parameter (also <code>Array1&lt;A&gt;</code>, <code>Array3&lt;A&gt;</code>, and so on). </li>\n</ul>\n"}], "owner": {"reputation": 474, "user_id": 5905325, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t4Uf-a54iNo/AAAAAAAAAAI/AAAAAAAAAdA/jc13jE20tww/photo.jpg?sz=128", "display_name": "murphy", "link": "https://stackoverflow.com/users/5905325/murphy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 57168557, "answer_count": 1, "score": 1, "last_activity_date": 1563899345, "creation_date": 1563893608, "last_edit_date": 1563894177, "question_id": 57166894, "link": "https://stackoverflow.com/questions/57166894/how-can-i-store-an-ndarray-in-a-struct-when-ndarraydimensiondimdim-is-priv", "title": "How can I store an ndarray in a struct when ndarray::dimension::dim::Dim is private?", "body": "<p>The ndarray crate's examples use the following code where the <code>Array::random</code> return type is <code>ArrayBase&lt;S, D&gt;</code>:</p>\n\n<pre><code>let a = Array::random((hash_size, inp_dimensions), Uniform::new(0., 10.));\n</code></pre>\n\n<p>I want to store the result in a struct and therefore need the type. The compiler tells me that it expects <code>ArrayBase&lt;S, D&gt;</code> to be of type <code>ArrayBase&lt;OwnedRepr&lt;f64&gt;, ndarray::dimension::dim::Dim&gt;</code>, but <code>ndarray::dimension::dim::Dim</code> is private.</p>\n\n<p>How can I store this array in a struct?</p>\n"}, {"tags": ["android", "rust", "android-ndk", "cross-compiling"], "comments": [{"owner": {"reputation": 8554, "user_id": 632035, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8ed69ad748c440a055502c1b213757e5?s=128&d=identicon&r=PG", "display_name": "Dan Albert", "link": "https://stackoverflow.com/users/632035/dan-albert"}, "edited": false, "score": 1, "creation_date": 1563989953, "post_id": 57166218, "comment_id": 100886995, "body": "That looks like a bug in Rust. Presumably they see x86_64-linux and assume that means GNU, so they&#39;re trying to link libraries that don&#39;t exist on Android."}], "answers": [{"tags": [], "owner": {"reputation": 1595, "user_id": 158703, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/10236360c347906897eba1a138891a50?s=128&d=identicon&r=PG", "display_name": "CalumMcCall", "link": "https://stackoverflow.com/users/158703/calummccall"}, "is_accepted": true, "score": 0, "last_activity_date": 1564409718, "creation_date": 1564409718, "answer_id": 57255715, "question_id": 57166218, "link": "https://stackoverflow.com/questions/57166218/linking-fails-using-x86-64-ndk-toolchain-on-x86-64/57255715#57255715", "title": "Linking fails using x86_64 NDK toolchain on x86_64", "body": "<p>This issue was caused by me using the wrong target when invoking Rust. I was using <code>x86_64-unknown-linux-gnu</code> because I thought there was no target for x86_64 Android. However, there is indeed <code>x86_64-linux-android</code>, but you have to have an up-to-date rust compiler version selected as the default in order to see this target when searching. It doesn't exist for older rust compiler versions such as 1.16.0. With the right target selected, the compilation works.</p>\n"}], "owner": {"reputation": 1595, "user_id": 158703, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/10236360c347906897eba1a138891a50?s=128&d=identicon&r=PG", "display_name": "CalumMcCall", "link": "https://stackoverflow.com/users/158703/calummccall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 0, "accepted_answer_id": 57255715, "answer_count": 1, "score": 0, "last_activity_date": 1564409718, "creation_date": 1563891482, "last_edit_date": 1563977833, "question_id": 57166218, "link": "https://stackoverflow.com/questions/57166218/linking-fails-using-x86-64-ndk-toolchain-on-x86-64", "title": "Linking fails using x86_64 NDK toolchain on x86_64", "body": "<p>I'm building a library for 32/64-bit ARM and x86, using the Android NDK toolchain. The library is written in Rust, and I'm using clang as the linker. I'm using the <a href=\"https://developer.android.com/ndk/guides/other_build_systems\" rel=\"nofollow noreferrer\">Android NDK default toolchains</a> to get my Makefile working. Compiling on all platforms works fine, except for x86_64. I'm compiling on x86_64 Linux, but I get the same issue on Mac OSX. The error I get is the following:</p>\n\n<pre><code>error: linking with `x86_64-linux-android21-clang` failed: exit code: 1\n  |\n  = note: \"x86_64-linux-android21-clang\" \"-Wl,--as-needed\" \"-Wl,-z,noexecstack\" \"-m64\" \"-L\" \"/home/calum/.rustup/toolchains/1.16.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"/home/calum/code/cryptobox-jni/android/build/src/cryptobox-v1.1.1/target/x86_64-unknown-linux-gnu/release/deps/cryptobox-f7e54e68993dbdc8.0.o\" \"-o\" \"/home/calum/code/cryptobox-jni/android/build/src/cryptobox-v1.1.1/target/x86_64-unknown-linux-gnu/release/deps/libcryptobox-f7e54e68993dbdc8.so\" \"-Wl,--version-script=/tmp/rustc.QEOguYgk4mJf/list\" \"-Wl,--gc-sections\" \"-Wl,-O1\" \"-nodefaultlibs\" \"-L\" \"../../libsodium-android-x86_64/lib\" \"-L\" \"/home/calum/code/cryptobox-jni/android/build/src/cryptobox-v1.1.1/target/x86_64-unknown-linux-gnu/release/deps\" \"-L\" \"/home/calum/code/cryptobox-jni/android/build/src/cryptobox-v1.1.1/target/release/deps\" \"-L\" \"\\\"./libs\\\"\" \"-L\" \"/home/calum/.rustup/toolchains/1.16.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib\" \"-Wl,-Bstatic\" \"-Wl,-Bdynamic\" \"-l\" \"sodium\" \"/home/calum/code/cryptobox-jni/android/build/src/cryptobox-v1.1.1/target/x86_64-unknown-linux-gnu/release/deps/libcryptobox-9b6f2a0a353ba6df.rlib\" \"/home/calum/code/cryptobox-jni/android/build/src/cryptobox-v1.1.1/target/x86_64-unknown-linux-gnu/release/deps/libproteus-40e6a130b38468f5.rlib\" \"/home/calum/code/cryptobox-jni/android/build/src/cryptobox-v1.1.1/target/x86_64-unknown-linux-gnu/release/deps/libcbor-024d9926f0739f39.rlib\" \"/home/calum/code/cryptobox-jni/android/build/src/cryptobox-v1.1.1/target/x86_64-unknown-linux-gnu/release/deps/libbyteorder-30acb91327072c30.rlib\" \"/home/calum/code/cryptobox-jni/android/build/src/cryptobox-v1.1.1/target/x86_64-unknown-linux-gnu/release/deps/libhkdf-971b9da845836207.rlib\" \"/home/calum/code/cryptobox-jni/android/build/src/cryptobox-v1.1.1/target/x86_64-unknown-linux-gnu/release/deps/libsodiumoxide-eccd1814def93cba.rlib\" \"/home/calum/code/cryptobox-jni/android/build/src/cryptobox-v1.1.1/target/x86_64-unknown-linux-gnu/release/deps/liblibsodium_sys-f96178cc67fea277.rlib\" \"/home/calum/code/cryptobox-jni/android/build/src/cryptobox-v1.1.1/target/x86_64-unknown-linux-gnu/release/deps/liblibc-e8bd7a8d60e9ed01.rlib\" \"/home/calum/.rustup/toolchains/1.16.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd-13f36e2630c2d79b.rlib\" \"/home/calum/.rustup/toolchains/1.16.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libpanic_unwind-3b9d178f1de89528.rlib\" \"/home/calum/.rustup/toolchains/1.16.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libunwind-93bb403c9fc56f72.rlib\" \"/home/calum/.rustup/toolchains/1.16.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/librand-a2ef7979b4b3e1d5.rlib\" \"/home/calum/.rustup/toolchains/1.16.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcollections-d22754c8c52de3a1.rlib\" \"/home/calum/.rustup/toolchains/1.16.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liballoc-c53f99154bf815c4.rlib\" \"/home/calum/.rustup/toolchains/1.16.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libstd_unicode-1cc5fcd37568ebc4.rlib\" \"/home/calum/.rustup/toolchains/1.16.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liballoc_system-17a71bb92a82956c.rlib\" \"/home/calum/.rustup/toolchains/1.16.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/liblibc-739908a2e215dd88.rlib\" \"/home/calum/.rustup/toolchains/1.16.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcore-3f4289353c600297.rlib\" \"/home/calum/.rustup/toolchains/1.16.0-x86_64-unknown-linux-gnu/lib/rustlib/x86_64-unknown-linux-gnu/lib/libcompiler_builtins-07bfb3bcb2a51da0.rlib\" \"-l\" \"sodium\" \"-l\" \"util\" \"-l\" \"dl\" \"-l\" \"rt\" \"-l\" \"pthread\" \"-l\" \"gcc_s\" \"-l\" \"pthread\" \"-l\" \"c\" \"-l\" \"m\" \"-l\" \"rt\" \"-l\" \"util\" \"-shared\" \"-Wl,-soname,libcryptobox.so\"\n  = note: /opt/android-sdk/ndk-bundle/toolchains/llvm/prebuilt/linux-x86_64/bin/../lib/gcc/x86_64-linux-android/4.9.x/../../../../x86_64-linux-android/bin/ld: error: cannot find -lutil\n          /opt/android-sdk/ndk-bundle/toolchains/llvm/prebuilt/linux-x86_64/bin/../lib/gcc/x86_64-linux-android/4.9.x/../../../../x86_64-linux-android/bin/ld: error: cannot find -lrt\n          /opt/android-sdk/ndk-bundle/toolchains/llvm/prebuilt/linux-x86_64/bin/../lib/gcc/x86_64-linux-android/4.9.x/../../../../x86_64-linux-android/bin/ld: error: cannot find -lpthread\n          /opt/android-sdk/ndk-bundle/toolchains/llvm/prebuilt/linux-x86_64/bin/../lib/gcc/x86_64-linux-android/4.9.x/../../../../x86_64-linux-android/bin/ld: error: cannot find -lgcc_s\n          /opt/android-sdk/ndk-bundle/toolchains/llvm/prebuilt/linux-x86_64/bin/../lib/gcc/x86_64-linux-android/4.9.x/../../../../x86_64-linux-android/bin/ld: error: cannot find -lpthread\n          /opt/android-sdk/ndk-bundle/toolchains/llvm/prebuilt/linux-x86_64/bin/../lib/gcc/x86_64-linux-android/4.9.x/../../../../x86_64-linux-android/bin/ld: error: cannot find -lrt\n          /opt/android-sdk/ndk-bundle/toolchains/llvm/prebuilt/linux-x86_64/bin/../lib/gcc/x86_64-linux-android/4.9.x/../../../../x86_64-linux-android/bin/ld: error: cannot find -lutil\n          clang: error: linker command failed with exit code 1 (use -v to see invocation)\n</code></pre>\n\n<p>The relevant section of the Makefile is:</p>\n\n<pre><code>jni/x86_64/libcryptobox.so: libsodium | build/src/$(CRYPTOBOX_NAME)\ncd build/src/$(CRYPTOBOX_NAME) &amp;&amp; \\\nexport PATH=\"${PATH}:${TOOLCHAIN}/bin\" &amp;&amp; \\                                                             \ncargo rustc --lib --release --target=x86_64-unknown-linux-gnu -- \\\n  -L ../../libsodium-android-x86_64/lib \\\n  -l sodium \\\n  -C ar=x86_64-linux-android-ar \\\n  -C linker=x86_64-linux-android21-clang \\\n  -C link_args=\"-Wl,-soname,libcryptobox.so\"\n</code></pre>\n\n<p>The rest of the Makefile can be viewed <a href=\"https://github.com/wireapp/cryptobox-jni/blob/cb3a33177e6edce1a4055404e6c5a7c6edff1721/android/Makefile\" rel=\"nofollow noreferrer\">here</a>. How come only x86_64 has a problem with sourcing pthread and other libraries? Is the assumption that you would use 'native' compiling for the host platform, instead of trying to use the NDK to 'cross-compile'?</p>\n\n<p>Also, where does the \"--as-needed\" flag come from? I don't specify it in the <code>link_args</code> in the Makefile. I'm quite new to Rust and cross-compiling with Android, so I'm not even sure whether it's rust, clang or the NDK that is generating this flag. Some advice about this would also be useful, as this flag is causing the build to fail on MacOS, where '--as-needed' isn't supported.</p>\n"}, {"tags": ["rust", "closures"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563892446, "post_id": 57163944, "comment_id": 100846746, "body": "It&#39;s hard to answer your question because it doesn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. We can&#39;t tell what crates (and their versions), types, traits, fields, etc. are present in the code. It would make it easier for us to help you if you try to reproduce your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> if possible, otherwise in a brand new Cargo project, then <a href=\"https://stackoverflow.com/posts/57163944/edit\">edit</a> your question to include the additional info. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MRE tips</a> you can use to reduce your original code for posting here. Thanks!"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563892564, "post_id": 57163944, "comment_id": 100846807, "body": "It looks like your question might be answered by the answers of <a href=\"https://stackoverflow.com/q/28597380/155423\">How can I modify self in a closure called from a member function?</a>; <a href=\"https://stackoverflow.com/q/48717833/155423\">How to use struct self in member method closure</a>; <a href=\"https://stackoverflow.com/q/36379242/155423\">Mutably borrow one struct field while borrowing another in a closure</a>. If not, please <b><a href=\"https://stackoverflow.com/posts/57163944/edit\">edit</a></b> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 21, "user_id": 11779320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fcc03ffd2400f9747ee22a09f6dfc5f?s=128&d=identicon&r=PG&f=1", "display_name": "Giom", "link": "https://stackoverflow.com/users/11779320/giom"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563910094, "post_id": 57163944, "comment_id": 100855216, "body": "I looked through your links and I found something wrong in my HashMap using Fn and not FnMut. Unfortunately I didn&#39;t figure out how to fix my main Error. So tried to remove everything unnecessary and I added a Playground example for clearness. Thanks for your advices."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563910103, "post_id": 57163944, "comment_id": 100855220, "body": "It looks like your modified question might be answered by the answers of <a href=\"https://stackoverflow.com/q/32682876/155423\">Is there any way to return a reference to a variable created in a function?</a>. If not, please <b><a href=\"https://stackoverflow.com/posts/57163944/edit\">edit</a></b> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563910204, "post_id": 57163944, "comment_id": 100855267, "body": "See also <a href=\"https://stackoverflow.com/q/32300132/155423\">Why can&#39;t I store a value and a reference to that value in the same struct?</a>"}], "owner": {"reputation": 21, "user_id": 11779320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fcc03ffd2400f9747ee22a09f6dfc5f?s=128&d=identicon&r=PG&f=1", "display_name": "Giom", "link": "https://stackoverflow.com/users/11779320/giom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1563910047, "creation_date": 1563883868, "last_edit_date": 1563910047, "question_id": 57163944, "link": "https://stackoverflow.com/questions/57163944/how-to-add-closures-from-other-structs-into-a-hashmap", "title": "How to add closures from other structs into a Hashmap", "body": "<p>I'm trying to implement a <code>Dispatcher</code> that holds a <code>HashMap</code> of closures which contain methods from other structs. The <code>Dispatcher</code> should be able to be passed around as it represents one event handler with a state for many clients.  </p>\n\n<p>With <code>Dispatcher::add_method</code>, it should be possible to add new closures to the <code>HashMap</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Dispatcher&lt;'a&gt; {\n    methods: HashMap&lt;String, Box&lt;dyn FnMut(i32) + 'a&gt;&gt;,\n}\n\nimpl&lt;'a&gt; Dispatcher&lt;'a&gt; {\n    ...\n    pub fn add_method(&amp;mut self, name: String, method: impl FnMut(i32) + 'a) {\n        self.methods.insert(name, Box::new(method));\n    }\n    ...\n}\n\n</code></pre>\n\n<p>An example of a struct that uses the <code>Dispatcher</code> and adds new methods to it:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Example {\n    num: i32,\n}\nimpl Example {\n    pub fn init&lt;'a&gt;(&amp;'a mut self, dispatcher: &amp;'a mut Dispatcher&lt;'a&gt;) {\n        dispatcher.add_method(\"test\".to_string(), move |num| {\n            self.num = num;\n        });\n    }\n}\n</code></pre>\n\n<p>I don't know how to initialize the <code>Example</code> to add the closures to the <code>Dispatcher</code>. I'm trying this but the result is a compilation error.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Handler&lt;'a&gt;{\n    example: Example,\n    dispatcher: Dispatcher&lt;'a&gt;\n}\n\nimpl&lt;'a&gt; Handler&lt;'a&gt;{\n    fn new() -&gt; Self {\n\n        let mut dispatcher = Dispatcher::new();\n        let mut example = Example::new();\n\n        example.init(&amp;mut dispatcher);\n\n        Handler{\n            example: example,\n            dispatcher: dispatcher,\n        }\n    }\n}\n</code></pre>\n\n<p>I understand that I'm trying to move out an borrowed value, but I have to borrow the <code>Dispatcher</code> for the <code>init</code> method of the <code>Example</code>. How should I do it otherwise?</p>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=2999a5b25a06f3f7051b3c6b07484d23\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0515]: cannot return value referencing local variable `dispatcher`\n  --&gt; src/lib.rs:46:9\n   |\n44 |           example.init(&amp;mut dispatcher);\n   |                        --------------- `dispatcher` is borrowed here\n45 | \n46 | /         Handler {\n47 | |             example: example,\n48 | |             dispatcher: dispatcher\n49 | |         }\n   | |_________^ returns a value referencing data owned by the current function\n\nerror[E0515]: cannot return value referencing local variable `example`\n  --&gt; src/lib.rs:46:9\n   |\n44 |           example.init(&amp;mut dispatcher);\n   |           ------- `example` is borrowed here\n45 | \n46 | /         Handler {\n47 | |             example: example,\n48 | |             dispatcher: dispatcher\n49 | |         }\n   | |_________^ returns a value referencing data owned by the current function\n\nerror[E0505]: cannot move out of `example` because it is borrowed\n  --&gt; src/lib.rs:47:22\n   |\n39 |   impl&lt;'a&gt; Handler&lt;'a&gt; {\n   |        -- lifetime `'a` defined here\n...\n44 |           example.init(&amp;mut dispatcher);\n   |           ------- borrow of `example` occurs here\n45 | \n46 | /         Handler {\n47 | |             example: example,\n   | |                      ^^^^^^^ move out of `example` occurs here\n48 | |             dispatcher: dispatcher\n49 | |         }\n   | |_________- returning this value requires that `example` is borrowed for `'a`\n\nerror[E0505]: cannot move out of `dispatcher` because it is borrowed\n  --&gt; src/lib.rs:48:25\n   |\n39 |   impl&lt;'a&gt; Handler&lt;'a&gt; {\n   |        -- lifetime `'a` defined here\n...\n44 |           example.init(&amp;mut dispatcher);\n   |                        --------------- borrow of `dispatcher` occurs here\n45 | \n46 | /         Handler {\n47 | |             example: example,\n48 | |             dispatcher: dispatcher\n   | |                         ^^^^^^^^^^ move out of `dispatcher` occurs here\n49 | |         }\n   | |_________- returning this value requires that `dispatcher` is borrowed for `'a`\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1563876838, "post_id": 57161611, "comment_id": 100837435, "body": "Are you sure you need an <code>Option&lt;Arc&lt;T&gt;&gt;</code>, rather than an <code>Arc&lt;Option&lt;T&gt;&gt;</code>?"}, {"owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "edited": false, "score": 0, "creation_date": 1563877249, "post_id": 57161611, "comment_id": 100837698, "body": "The data in a <code>Arc</code> can only be accessed via an immutable reference. You need to wrap the contents in a <code>Mutex</code> (or something similar) if you want to mutate it (which you do, since <code>read_to_end</code> takes <code>&amp;mut self</code>)."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563891681, "post_id": 57161611, "comment_id": 100846266, "body": "It&#39;s great that you have a solution to your question! You should post it as an answer rather than an edit to your question and then potentially accept that answer. That way, the question shows up as solved in search results, people can vote on your answer, and your solution can be more helpful to future people with the same problem."}], "owner": {"reputation": 89, "user_id": 6684915, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MaDqT.png?s=128&g=1", "display_name": "skypitcher", "link": "https://stackoverflow.com/users/6684915/skypitcher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 276, "favorite_count": 0, "closed_date": 1563891716, "answer_count": 0, "score": 1, "last_activity_date": 1563891740, "creation_date": 1563876332, "last_edit_date": 1563891664, "question_id": 57161611, "link": "https://stackoverflow.com/questions/57161611/how-to-dereference-an-optionarct-as-mutable", "closed_reason": "Duplicate", "title": "How to dereference an Option&lt;Arc&lt;T&gt;&gt; as mutable?", "body": "<p>I want to write some code for my project. How can I dereference an <code>Option&lt;Arc&lt;T&gt;&gt;</code> correctly?</p>\n\n<p>I have tried: </p>\n\n<pre><code>use std::io::Read;\nuse std::sync::Arc;\n\nstruct Map&lt;T: Read&gt; {\n    shared_reader: Option&lt;Arc&lt;T&gt;&gt;,\n}\n\nimpl&lt;T: Read&gt; Default for Map&lt;T&gt; {\n    fn default() -&gt; Self {\n        Self {\n            shared_reader: None,\n        }\n    }\n}\n\nimpl&lt;T: Read&gt; Map&lt;T&gt; {\n    fn read_raw_data(&amp;mut self) -&gt; Option&lt;Vec&lt;u8&gt;&gt; {\n        if let Some(srd) = &amp;mut self.shared_reader {\n            /*I think the srd should have a type &amp;mut Arc&lt;T&gt;*/\n            let mut buf = Vec::with_capacity(4096);\n            if let Ok(_) = srd.read_to_end(&amp;mut buf) {\n                return Some(buf);\n            } else {\n                return None;\n            }\n        } else {\n            return None;\n        }\n    }\n}\n</code></pre>\n\n<p>When I compile this, I get an error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0596]: cannot borrow data in a `&amp;` reference as mutable\n  --&gt; src/lib.rs:21:28\n   |\n21 |             if let Ok(_) = srd.read_to_end(&amp;mut buf) {\n   |                            ^^^ cannot borrow as mutable\n</code></pre>\n\n<p>There is the solution </p>\n\n<pre><code>use std::borrow::BorrowMut;\nuse std::io::Read;\nuse std::sync::{Arc, Mutex};\n\nstruct Map&lt;T: Read&gt; {\n    shared_reader: Option&lt;Arc&lt;Mutex&lt;T&gt;&gt;&gt;,\n}\n\nimpl&lt;T: Read&gt; Default for Map&lt;T&gt; {\n    fn default() -&gt; Self {\n        Self {\n            shared_reader: None,\n        }\n    }\n}\n\nimpl&lt;T: Read&gt; Map&lt;T&gt; {\n    fn read_raw_data(&amp;mut self) -&gt; Option&lt;Vec&lt;u8&gt;&gt; {\n        if let Some(srd_lock) = &amp;self.shared_reader {\n            if let Ok(srd) = &amp;mut srd_lock.lock() {\n                let mut buf = Vec::with_capacity(4096);\n                if let Ok(_) = srd.read_to_end(&amp;mut buf) {\n                    return Some(buf);\n                } else {\n                    return None;\n                }\n            } else {\n                return None;\n            }\n        } else {\n            return None;\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 1, "creation_date": 1563867734, "post_id": 57159029, "comment_id": 100832474, "body": "The documentation doesn&#39;t say it&#39;s the only way to define a block code. By default it&#39;s safe to assume markdown rules apply (and an indented text is definitely a block code in markdown). As an aside, your comment should really not have indentations for what&#39;s not code."}, {"owner": {"reputation": 19105, "user_id": 3005167, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/t0bMQ.png?s=128&g=1", "display_name": "kazemakase", "link": "https://stackoverflow.com/users/3005167/kazemakase"}, "reply_to_user": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1563868177, "post_id": 57159029, "comment_id": 100832668, "body": "@DenysS&#233;guret I agree, the indentation looks awful here. And indeed this is the cause... It has not occurred to me that the doc comments are parsed as markdown. Feels kind of obvious now, thanks :)"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1563871071, "post_id": 57159029, "comment_id": 100834174, "body": "To make a list, you need 2 spaces indentation, not 4, I think."}], "answers": [{"tags": [], "owner": {"reputation": 19105, "user_id": 3005167, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/t0bMQ.png?s=128&g=1", "display_name": "kazemakase", "link": "https://stackoverflow.com/users/3005167/kazemakase"}, "is_accepted": false, "score": 6, "last_activity_date": 1563868748, "last_edit_date": 1592644375, "creation_date": 1563868748, "answer_id": 57159370, "question_id": 57159029, "link": "https://stackoverflow.com/questions/57159029/why-does-a-comment-without-fences-trigger-a-doctest/57159370#57159370", "title": "Why does a comment without fences trigger a doctest?", "body": "<p>This behavior is actually explained in the <a href=\"https://doc.rust-lang.org/rustdoc/documentation-tests.html#syntax-reference\" rel=\"noreferrer\">documentation</a>. In the very bottom it says (emphasis mine):</p>\n<blockquote>\n<p><strong>Rustdoc also accepts indented code blocks</strong> as an alternative to fenced code blocks: instead of surrounding your code with three backticks, you can indent each line by four or more spaces.</p>\n<p>...</p>\n<p>However, it's preferable to use fenced code blocks over indented code blocks. Not only are fenced code blocks considered more idiomatic for Rust code, but there is no way to use directives such as <code>ignore</code> or <code>should_panic</code> with indented code blocks.</p>\n</blockquote>\n"}], "owner": {"reputation": 19105, "user_id": 3005167, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/t0bMQ.png?s=128&g=1", "display_name": "kazemakase", "link": "https://stackoverflow.com/users/3005167/kazemakase"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "closed_date": 1563891497, "answer_count": 1, "score": 5, "last_activity_date": 1563868748, "creation_date": 1563867551, "last_edit_date": 1563867958, "question_id": 57159029, "link": "https://stackoverflow.com/questions/57159029/why-does-a-comment-without-fences-trigger-a-doctest", "closed_reason": "Duplicate", "title": "Why does a comment without fences trigger a doctest?", "body": "<p>I have the following commented code in a crate:</p>\n\n<pre><code>/// Complex Expression\n///\n///     - The `Undefined` variant is used as a placeholder during code \n///       transformations. It must never occur in the final result.\npub enum Cexp {\n    Undefined,\n    Unimplemented,\n}\n</code></pre>\n\n<p>When running <code>cargo test</code> on the crate it triggers a doctest run, which fails to compile. (In the <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=299105e13c2afeb5d609ee608ca863d2\" rel=\"noreferrer\">playground</a> make sure to run TEST rather than BUILD.)</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>   Doc-tests playground\n\nrunning 1 test\ntest src/lib.rs - Cexp (line 3) ... FAILED\n\nfailures:\n\n---- src/lib.rs - Cexp (line 3) stdout ----\nerror: unknown start of token: `\n --&gt; src/lib.rs:4:7\n  |\n1 | - The `Undefined` variant is used as a placeholder during code \n  |       ^\n</code></pre>\n\n<p>The actual error message is of no concern. The rust compiler chokes on the comment text, which is no surprise. But why does this comment trigger a doctest run? According to the <a href=\"https://doc.rust-lang.org/rustdoc/documentation-tests.html\" rel=\"noreferrer\">documentation</a> doctests are supposed to be fenced with <code>```</code>, which is not the case here.</p>\n"}, {"tags": ["rust", "lifetime", "ownership"], "comments": [{"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1563870341, "post_id": 57158569, "comment_id": 100833810, "body": "Your first thought is correct, but at the end it will not work unless <code>arr</code> has static lifetime, if it is a constant value for your function you can use it like this(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=bcfd843ccf2ca8018c74435345102b77\" rel=\"nofollow noreferrer\">Playground</a>) otherwise it is not possible because <code>arr</code> is going to be dropped at the end of function&#39;s scope, any reference of <code>arr</code> is going to be a dangling pointer."}], "answers": [{"comments": [{"owner": {"reputation": 15569, "user_id": 2302862, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e264db339bb96e343770fa38018e00f1?s=128&d=identicon&r=PG", "display_name": "Siguza", "link": "https://stackoverflow.com/users/2302862/siguza"}, "edited": false, "score": 0, "creation_date": 1563939271, "post_id": 57160746, "comment_id": 100861984, "body": "Well, I ended up creating my own struct, containing a <code>Box&lt;[u8]&gt;</code> and implementing <code>Read</code> manually. Thanks a bunch. :)"}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 2, "last_activity_date": 1563873943, "last_edit_date": 1563873943, "creation_date": 1563873470, "answer_id": 57160746, "question_id": 57158569, "link": "https://stackoverflow.com/questions/57158569/moving-ownership-to-a-stdiochain/57160746#57160746", "title": "Moving ownership to a std::io::Chain", "body": "<p>Because <code>Read</code> is implemented for <a href=\"https://doc.rust-lang.org/std/primitive.slice.html#impl-Read\" rel=\"nofollow noreferrer\"><code>&amp;'_ [u8]</code></a> but not for <code>[u8; 3]</code>, the compiler automatically converts your array into a reference slice. This mean your array must be valid as long as the slice live so as long as the <code>Chain</code> live.</p>\n\n<p>There are several solutions, you could ask to the caller a mutable slice, you could make it <code>static</code> if you want to be able to mutate it, if you don't you can make it <code>const</code>, if you need to resize it you need a <code>Vec</code>, etc...</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::io::{stdin, Chain, Read};\n\nfn a&lt;R: Read&gt;(arr: &amp;mut [u8; 3], r: R) -&gt; Chain&lt;&amp;[u8], R&gt; {\n    arr.copy_from_slice(&amp;[1, 2, 3]);\n    arr.chain(r)\n}\n\nfn b&lt;R: Read&gt;(r: R) -&gt; Chain&lt;&amp;'static [u8], R&gt; {\n    const ARR: [u8; 3] = [1, 2, 3];\n    ARR.chain(r)\n}\n\nfn main() {\n    let mut arr = [0; 3];\n    println!(\"{:?}\", a(&amp;mut arr, stdin()));\n\n    println!(\"{:?}\", b(stdin()));\n}\n</code></pre>\n\n<p>See:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/32682876/is-there-any-way-to-return-a-reference-to-a-variable-created-in-a-function\">Is there any way to return a reference to a variable created in a function?</a></li>\n</ul>\n"}], "owner": {"reputation": 15569, "user_id": 2302862, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e264db339bb96e343770fa38018e00f1?s=128&d=identicon&r=PG", "display_name": "Siguza", "link": "https://stackoverflow.com/users/2302862/siguza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 57160746, "answer_count": 1, "score": 3, "last_activity_date": 1563873943, "creation_date": 1563865875, "last_edit_date": 1563873207, "question_id": 57158569, "link": "https://stackoverflow.com/questions/57158569/moving-ownership-to-a-stdiochain", "title": "Moving ownership to a std::io::Chain", "body": "<p>I have a <code>Read</code>er that I want to prepend some bytes to, creating a <code>Chain</code>. Ideally I'd want to do this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::io::{Chain, Read};\n\nfn thingify&lt;R: Read&gt;(r: R) -&gt; Chain&lt;[u8; 3], R&gt; {\n    let mut arr = [1u8, 2u8, 3u8];\n    // Modify arr here\n    return arr.chain(r);\n}\n</code></pre>\n\n<p>But that throws a compiler error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n --&gt; test.rs:7:12\n  |\n3 | fn thingify&lt;R: Read&gt;(r: R) -&gt; Chain&lt;[u8; 3], R&gt;\n  |                               ----------------- expected `std::io::Chain&lt;[u8; 3], R&gt;` because of return type\n...\n7 |     return arr.chain(r);\n  |            ^^^^^^^^^^^^ expected array of 3 elements, found &amp;[u8]\n  |\n  = note: expected type `std::io::Chain&lt;[u8; 3], _&gt;`\n             found type `std::io::Chain&lt;&amp;[u8], _&gt;`\n</code></pre>\n\n<p>From what I understand, this seems to be because <code>Read</code> is implemented for slices rather than arrays, and somehow my array decays to a slice here.<br>\nBut when I change the array in the return type to a slice and give it an explicit lifetime like so:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::io::{Chain, Read};\n\nfn thingify&lt;'a, R: Read&gt;(r: R) -&gt; Chain&lt;&amp;'a [u8], R&gt; {\n    let arr = [1u8, 2u8, 3u8];\n    // Modify arr here\n    return arr.chain(r);\n}\n</code></pre>\n\n<p>I just get another compiler error instead:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0515]: cannot return value referencing local variable `arr`\n  --&gt; test.rs:19:12\n   |\n19 |     return arr.chain(r);\n   |            ---^^^^^^^^^\n   |            |\n   |            returns a value referencing data owned by the current function\n   |            `arr` is borrowed here\n</code></pre>\n\n<p>How can I transfer ownership of my array to the <code>Chain</code> so that I can return it? Is that simply not doable with a <code>[u8]</code>?</p>\n"}, {"tags": ["rust", "documentation", "rust-cargo"], "answers": [{"tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": false, "score": 2, "last_activity_date": 1563895259, "creation_date": 1563895259, "answer_id": 57167422, "question_id": 57158261, "link": "https://stackoverflow.com/questions/57158261/how-to-build-the-docs-rs-documentation-of-an-ffi-crate-when-the-native-library-i/57167422#57167422", "title": "How to build the docs.rs documentation of an FFI crate when the native library is not present?", "body": "<p>The <a href=\"https://docs.rs/about\" rel=\"nofollow noreferrer\">about page of docs.rs</a> gives more information about that. You can actually enable a specific feature (among other things) during the docs.rs doc generation. An example explains well how to achieve that:</p>\n\n<p><code>Cargo.toml</code>:</p>\n\n<pre><code>[features]\ndocs-rs = []\n\n[package.metadata.docs.rs]\nfeatures = [ \"docs-rs\" ] # This feature will be enabled during the docs.rs build\n</code></pre>\n\n<p>And then, the linking can be disabled in <code>build.rs</code>:</p>\n\n<pre><code>#[cfg(feature = \"docs-rs\")]\nfn main() {} // Skip the script when the doc is building\n\n#[cfg(not(feature = \"docs-rs\"))]\nfn main() {\n    println!(\"cargo:rustc-link-lib=dylib=foo-1.0\");\n}\n</code></pre>\n"}], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565619830, "creation_date": 1563864798, "last_edit_date": 1565619830, "question_id": 57158261, "link": "https://stackoverflow.com/questions/57158261/how-to-build-the-docs-rs-documentation-of-an-ffi-crate-when-the-native-library-i", "title": "How to build the docs.rs documentation of an FFI crate when the native library is not present?", "body": "<p>I have a \"sys\" crate that links statically to a library:</p>\n\n<p>Cargo.toml:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[package]\nlinks = \"foo-1.0\"\n</code></pre>\n\n<p>build.rs:</p>\n\n<pre><code>fn main() {\n    println!(\"cargo:rustc-link-lib=dylib=foo-1.0\");\n}\n</code></pre>\n\n<p>When I publish the package, docs.rs cannot generate the documentation because libfoo is not installed:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: failed to run custom build command for `foo-sys v0.0.1`\n\nCaused by:\n  process didn't exit successfully: `/home/cratesfyi/cratesfyi/debug/build/foo-sys-f4bd3ee95677500b/build-script-build` (exit code: 1)\n--- stderr\n`\"pkg-config\" \"--libs\" \"--cflags\" \"foo-1.0 &gt;= 1.0\"` did not exit successfully: exit code: 1\n--- stderr\n</code></pre>\n\n<p>How can I configure my crate so that the doc is generated without the library being installed?</p>\n"}, {"tags": ["arrays", "memory", "multidimensional-array", "rust", "initialization"], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 4358206, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-knvMCSsUP9s/AAAAAAAAAAI/AAAAAAAADWM/0H0gyqyBCfs/photo.jpg?sz=128", "display_name": "Ritoban Roy Chowdhury", "link": "https://stackoverflow.com/users/4358206/ritoban-roy-chowdhury"}, "edited": false, "score": 0, "creation_date": 1563910680, "post_id": 57162750, "comment_id": 100855472, "body": "Yes, an enum makes a lot of sense. I didn&#39;t realize that would work like that. The reason I didn&#39;t go for an <code>Rc&lt;Option&lt;dyn Piece&gt;&gt;</code> was because I was getting the &quot;size not defined error&quot;, as you can see in this playground: <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=9ce1c3cdb08f7f680806ad4137e44aa4\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>   However, with Piece being an enum, both forms appear to compile fine, so do you have any idea which is more efficient? I seem to recall that Option&lt;Rc&lt;T&gt;&gt; is optimized by storing None as zeros, and Some as any other pointer, though I&#39;m not sure."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 69, "user_id": 4358206, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-knvMCSsUP9s/AAAAAAAAAAI/AAAAAAAADWM/0H0gyqyBCfs/photo.jpg?sz=128", "display_name": "Ritoban Roy Chowdhury", "link": "https://stackoverflow.com/users/4358206/ritoban-roy-chowdhury"}, "edited": false, "score": 0, "creation_date": 1563912137, "post_id": 57162750, "comment_id": 100856077, "body": "@RitobanRoyChowdhury I never use dyn trait nevermind, well the efficient question is a good one, I really don&#39;t know. <a href=\"https://docs.rs/enum_dispatch/0.1.3/enum_dispatch/\" rel=\"nofollow noreferrer\">docs.rs/enum_dispatch/0.1.3/enum_dispatch</a> claim to speed up 10x by using enum. Yes <code>Option&lt;Rc&lt;T&gt;&gt;</code> will same some byte. I don&#39;t know why but in my mind the purpose was to stock the board not only the piece. In that maybe you should only have a hashmap of piece left in the board. where key is a tupple of their coordinate and just remove <code>Option</code>. There is not a only way to implement a chess game :p"}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 1, "last_activity_date": 1563912001, "last_edit_date": 1563912001, "creation_date": 1563879967, "answer_id": 57162750, "question_id": 57156478, "link": "https://stackoverflow.com/questions/57156478/rust-initialize-2d-array/57162750#57162750", "title": "Rust: Initialize 2D Array", "body": "<p>One way would be to use <a href=\"https://crates.io/crates/ndarray\" rel=\"nofollow noreferrer\"><code>ndarray</code></a>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use ndarray::Array;\nuse std::sync::Arc;\n\ntrait Piece: std::fmt::Debug {}\n\n#[derive(Debug)]\nstruct A {}\n\nimpl Piece for A {}\n\n#[derive(Debug)]\nstruct B {}\n\nimpl Piece for B {}\n\nfn main() {\n    const SIZE: usize = 8;\n    let a = Array::from_shape_fn((SIZE, SIZE), |i| {\n        if (i.0 + i.1) % 2 == 0 {\n            Some(Arc::new(A {}) as Arc&lt;dyn Piece&gt;)\n        } else {\n            Some(Arc::new(B {}) as Arc&lt;dyn Piece&gt;)\n        }\n    });\n\n    println!(\"{:?}\", a);\n}\n</code></pre>\n\n<p>But that not very idiomatic in my opinion, I think you should prefer use an enum:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use ndarray::Array;\nuse std::sync::Arc;\n\ntrait Action {\n    fn action(&amp;self);\n}\n\n#[derive(Debug)]\nstruct A {}\n\nimpl Action for A {\n    fn action(&amp;self) {\n        println!(\"Action of A\");\n    }\n}\n\n#[derive(Debug)]\nstruct B {}\n\nimpl Action for B {\n    fn action(&amp;self) {\n        println!(\"Action of B\");\n    }\n}\n\n#[derive(Debug)]\nenum Piece {\n    A(A),\n    B(B),\n}\n\nimpl Action for Piece {\n    fn action(&amp;self) {\n        match self {\n            Piece::A(a) =&gt; a.action(),\n            Piece::B(b) =&gt; b.action(),\n        }\n    }\n}\n\nfn main() {\n    const SIZE: usize = 8;\n    let a = Array::from_shape_fn((SIZE, SIZE), |i| {\n        if (i.0 + i.1) % 2 == 0 {\n            Some(Arc::new(Piece::A(A {})))\n        } else {\n            Some(Arc::new(Piece::B(B {})))\n        }\n    });\n\n    println!(\"{:?}\", a);\n    for piece in a.iter().flatten() {\n        piece.action();\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 4358206, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-knvMCSsUP9s/AAAAAAAAAAI/AAAAAAAADWM/0H0gyqyBCfs/photo.jpg?sz=128", "display_name": "Ritoban Roy Chowdhury", "link": "https://stackoverflow.com/users/4358206/ritoban-roy-chowdhury"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1595, "favorite_count": 0, "accepted_answer_id": 57162750, "answer_count": 1, "score": 1, "last_activity_date": 1563912001, "creation_date": 1563854163, "last_edit_date": 1563860204, "question_id": 57156478, "link": "https://stackoverflow.com/questions/57156478/rust-initialize-2d-array", "title": "Rust: Initialize 2D Array", "body": "<p>I have a struct, which contains the following 2D array: </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>board: [[Option&lt;Rc&lt;dyn Piece&gt;&gt;; SIZE]; SIZE]\n</code></pre>\n\n<p>Incidentally, this is representing a chess board, and Piece is a trait, so if there is a better way to store this data, I would be interested. </p>\n\n<p>I am having difficulty initializing this array. The obvious solution, setting everything to None:  </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>board: [[None; SIZE]; SIZE]\n</code></pre>\n\n<p>doesn't work because </p>\n\n<pre><code>error[E0277]: the trait bound `std::rc::Rc&lt;(dyn piece::Piece + 'static)&gt;: std::marker::Copy` is not satisfied\n  --&gt; src/chessboard.rs:17:21\n   |\n17 |             board: [[None; SIZE]; SIZE]\n   |                     ^^^^^^^^^^^^ the trait `std::marker::Copy` is not implemented for `std::rc::Rc&lt;(dyn piece::Piece + 'static)&gt;`\n   |\n   = note: required because of the requirements on the impl of `std::marker::Copy` for `std::option::Option&lt;std::rc::Rc&lt;(dyn piece::Piece + 'static)&gt;&gt;`\n   = note: the `Copy` trait is required because the repeated element will be copied\n</code></pre>\n\n<p>Some research led me to this github issue on the topic, <a href=\"https://github.com/rust-lang/rust/issues/54542\" rel=\"nofollow noreferrer\">https://github.com/rust-lang/rust/issues/54542</a>, where there seems to be some disagreement about the topic, though most solutions appear to use <code>MaybeUninit</code> and unsafe rust to create the array in memory, iterate over it to initialize it, then either <code>mem::transmute</code> or <code>into_inner</code> it into the regular array. Because I am not very familiar with unsafe rust or dealing with memory, I'd rather not use these solutions, and am not entirely certain how to adapt those solutions, which are for <code>[Vec&lt;u8&gt;; N]</code> to my use case. </p>\n\n<p>I found another article on the subject, <a href=\"https://www.joshmcguigan.com/blog/array-initialization-rust/\" rel=\"nofollow noreferrer\">https://www.joshmcguigan.com/blog/array-initialization-rust/</a>, which presents a crate with a macro, <code>arr!</code> which is supposed to be entirely safe. However, I am also not certain if this is the most idiomatic and clean solution. Having to install an entire crate for such a small thing seems excessive (though that may be my feelings from languages, as I don't know much about the best practices in Rust). </p>\n\n<p>Which, if either, of these solutions should I use, and if it is the former, how should I adapt it to arrays of arrays?</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 339851, "user_id": 149392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a561ec0875fcbbe3066ea8fe288ec77?s=128&d=identicon&r=PG", "display_name": "sepp2k", "link": "https://stackoverflow.com/users/149392/sepp2k"}, "is_accepted": true, "score": 3, "last_activity_date": 1563831872, "creation_date": 1563831872, "answer_id": 57154140, "question_id": 57154054, "link": "https://stackoverflow.com/questions/57154054/in-the-type-definition-for-and-then-where-does-the-t-come-from/57154140#57154140", "title": "In the type definition for and_then where does the T come from?", "body": "<p><code>T</code> is the type argument to <code>Option</code>. It comes from the <code>impl&lt;T&gt; Option&lt;T&gt;</code> block that surrounds the method definitions. You can't tell from the method's type signature alone (which doesn't tell you what the type of <code>self</code> is) - you have to look at the surrounding <code>impl</code> as well.</p>\n"}], "owner": {"reputation": 2304, "user_id": 2126889, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ZLkKF.jpg?s=128&g=1", "display_name": "timthelion", "link": "https://stackoverflow.com/users/2126889/timthelion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 57154140, "answer_count": 1, "score": 1, "last_activity_date": 1563834754, "creation_date": 1563831322, "last_edit_date": 1563834754, "question_id": 57154054, "link": "https://stackoverflow.com/questions/57154054/in-the-type-definition-for-and-then-where-does-the-t-come-from", "title": "In the type definition for and_then where does the T come from?", "body": "<p>In Rust the <a href=\"https://doc.rust-lang.org/std/option/enum.Option.html\" rel=\"nofollow noreferrer\"><code>Option</code></a> type has a method <a href=\"https://doc.rust-lang.org/std/option/enum.Option.html#method.and_then\" rel=\"nofollow noreferrer\"><code>and_then()</code></a> which is defined as:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn and_then&lt;U, F&gt;(self, f: F) -&gt; Option&lt;U&gt;\nwhere\n    F: FnOnce(T) -&gt; Option&lt;U&gt;,\n</code></pre>\n\n<p>I don't understand how I should read this type declaration. Where does the <code>T</code> come from? From context, I know that <code>T</code> is somehow related to the type contained by <code>self</code> but how do I know that from looking only at the type signature?</p>\n\n<p>For comparison, Haskell's <a href=\"https://hackage.haskell.org/package/base-4.12.0.0/docs/Prelude.html#v:fmap\" rel=\"nofollow noreferrer\"><code>fmap</code></a> function is defined as follows:</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>fmap :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>I <em>know</em> just by looking at the type signature that the type <code>a</code> which is passed to the first class function is contained in the input functor just by looking at the type signature.</p>\n\n<p>Similarly, we could define <code>and_then</code> like</p>\n\n<pre class=\"lang-hs prettyprint-override\"><code>and_then :: Functor f =&gt; (a -&gt; f b) -&gt; f a -&gt; f b\n</code></pre>\n\n<p>and things are similarly clear (to me).</p>\n"}, {"tags": ["arrays", "rust", "traits"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1563826137, "post_id": 57152852, "comment_id": 100821162, "body": "<a href=\"https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=579abbf444fa26b5a95de5dc61d63da1\" rel=\"nofollow noreferrer\">play.integer32.com/&hellip;</a>"}, {"owner": {"reputation": 892, "user_id": 3331931, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/667d26246734ae54783faeebf84ced20?s=128&d=identicon&r=PG", "display_name": "fcracker79", "link": "https://stackoverflow.com/users/3331931/fcracker79"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563826163, "post_id": 57152852, "comment_id": 100821175, "body": "@Stargateur thanks for the answer. Unfortunately here I cannot even compile it and I do not know why."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 3, "creation_date": 1563826370, "post_id": 57152852, "comment_id": 100821270, "body": "Your main problem is unrelated to dynamic method binding for trait objects. The <code>go_boxed()</code> function takes ownership of its argument, but the vector you are iterating over only has references, so you can&#39;t pass ownership to the function. This problem would also occur if your object type was, say, <code>String</code> rather than a trait object."}, {"owner": {"reputation": 892, "user_id": 3331931, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/667d26246734ae54783faeebf84ced20?s=128&d=identicon&r=PG", "display_name": "fcracker79", "link": "https://stackoverflow.com/users/3331931/fcracker79"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563826382, "post_id": 57152852, "comment_id": 100821275, "body": "@Stargateur ok thanks for the snippet of code. I am just studying the language and I do not understand what is wrong with my code. My objective as first is to understand what is happening."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1563826772, "post_id": 57152852, "comment_id": 100821444, "body": "@fcracker79 yes, but explain what is happening will not make you understand better I think. You are actually trying something very strange in Rust. So you get a very strange error that I don&#39;t think the explanation will help you much because you will run into an other error very hard to understand."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563836707, "post_id": 57152852, "comment_id": 100824642, "body": "<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=e9223adec01e9c1cb78775b73e47ef3e\" rel=\"nofollow noreferrer\">The duplicate applied to your situation</a>"}, {"owner": {"reputation": 892, "user_id": 3331931, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/667d26246734ae54783faeebf84ced20?s=128&d=identicon&r=PG", "display_name": "fcracker79", "link": "https://stackoverflow.com/users/3331931/fcracker79"}, "edited": false, "score": 1, "creation_date": 1563883820, "post_id": 57152852, "comment_id": 100841538, "body": "Thanks all guys."}], "owner": {"reputation": 892, "user_id": 3331931, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/667d26246734ae54783faeebf84ced20?s=128&d=identicon&r=PG", "display_name": "fcracker79", "link": "https://stackoverflow.com/users/3331931/fcracker79"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "closed_date": 1563836553, "answer_count": 0, "score": 0, "last_activity_date": 1563836394, "creation_date": 1563825017, "last_edit_date": 1563836394, "question_id": 57152852, "link": "https://stackoverflow.com/questions/57152852/how-can-i-work-with-a-vector-of-elements-that-implement-a-specific-trait-without", "closed_reason": "Duplicate", "title": "How can I work with a vector of elements that implement a specific trait without knowing the concrete type of each element?", "body": "<p>Given an array of objects that implement a specific trait, I would like to iterate over them and run a function that takes a boxed trait, as follows:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::boxed::Box;\n\ntrait MyTrait {\n    fn go(&amp;self);\n}\n\nstruct MyStruct1 {}\n\nstruct MyStruct2 {}\n\nimpl MyTrait for MyStruct1 {\n    fn go(&amp;self) {\n        println!(\"Go MyStruct1\");\n    }\n}\n\nimpl MyTrait for MyStruct2 {\n    fn go(&amp;self) {\n        println!(\"Go MyStruct2\");\n    }\n}\n\nfn go_boxed(t: Box&lt;MyTrait&gt;) {\n    t.go();\n}\n\nfn main() {\n    let t1 = MyStruct1 {};\n    let t2 = MyStruct2 {};\n    let ts: Vec&lt;&amp;MyTrait&gt; = vec![&amp;t1, &amp;t2];\n    go_boxed(Box::from(t1));\n    go_boxed(Box::from(t2));\n    // This will fail:\n    ts.into_iter()\n        .for_each(|x| go_boxed(Box::new(x) as Box&lt;MyTrait&gt;));\n}\n</code></pre>\n\n<p>Error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `&amp;dyn MyTrait: MyTrait` is not satisfied\n  --&gt; src/main.rs:35:32\n   |\n35 |         .for_each(|x| go_boxed(Box::new(x) as Box&lt;MyTrait&gt;));\n   |                                ^^^^^^^^^^^ the trait `MyTrait` is not implemented for `&amp;dyn MyTrait`\n   |\n   = note: required for the cast to the object type `dyn MyTrait`\n</code></pre>\n\n<p>What is happening?\nHow can I work with vector of elements without knowing the concrete type of each element?</p>\n\n<p>The referred question does not face my more trivial issue, which is why it is not compiling.</p>\n"}, {"tags": ["performance", "concurrency", "rust", "future"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563835766, "post_id": 57151795, "comment_id": 100824420, "body": "Please read <a href=\"https://stackoverflow.com/q/52835725/155423\">What is the purpose of async/await in Rust?</a>. Calling <code>.await</code> in an async block/function really only creates a new anonymous type that implements <code>Future</code>. No event loop or threads are involved from <code>.await</code>."}, {"owner": {"reputation": 11, "user_id": 4526037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/185abc203da9249e3b113391915f4cb7?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4526037/eric"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563837336, "post_id": 57151795, "comment_id": 100824775, "body": "So my mistake was thinking anything ever went back to the runtime with await, I see.  That drastically simplifies my understanding.  Thanks!  That eliminates 90% of my question, happy to accept that."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563837668, "post_id": 57151795, "comment_id": 100824839, "body": "What is the remaining 10%? You may want to think about rewriting your question to focus on that 10%, linking to any existing resources (like the previously linked question) that you need to to frame your question."}, {"owner": {"reputation": 11, "user_id": 4526037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/185abc203da9249e3b113391915f4cb7?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4526037/eric"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563837867, "post_id": 57151795, "comment_id": 100824877, "body": "Sorry, i mean you answered the 10%, &#39;How do i get from the Rust compiler&#39;s evaluation of .await...&#39; and made the other 90% unapplicable."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563837921, "post_id": 57151795, "comment_id": 100824885, "body": "Do you feel like this question has been suitably answered by the previously linked question? In that case, we can mark this as a duplicate."}], "owner": {"reputation": 11, "user_id": 4526037, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/185abc203da9249e3b113391915f4cb7?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/4526037/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "closed_date": 1563838315, "answer_count": 0, "score": 1, "last_activity_date": 1563835098, "creation_date": 1563820001, "last_edit_date": 1563835098, "question_id": 57151795, "link": "https://stackoverflow.com/questions/57151795/what-are-the-performance-implications-of-await-on-a-ready-future", "closed_reason": "Duplicate", "title": "What are the performance implications of .await on a Ready future?", "body": "<p>I'm using futures 0.3 and I would like to use a single trait that is implemented for both async scenarios and synchronous ones:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait Testy {\n    type FutType: Future&lt;Output = i32&gt;;\n\n    fn stuff(&amp;self) -&gt; Self::FutType;\n}\n\npub struct TestyImp;\nimpl Testy for TestyImp {\n    type FutType = Ready&lt;i32&gt;;\n\n    fn stuff(&amp;self) -&gt; Self::FutType {\n        ready(3)\n    }\n}\n</code></pre>\n\n<p>How do I get from the Rust compiler's evaluation of <code>.await</code> on this <code>Ready</code> future back into the runtime (i.e. Tokio)?  Was I able to get straight to a <code>poll</code> call with an immediate result from a stack-based future state machine, or did it cost me something along the way?  Did the use of <code>Ready</code> introduce:</p>\n\n<ul>\n<li>heap allocations?</li>\n<li>a path through a chain of non-inlined function calls in the runtime?</li>\n<li>a run through an event loop?</li>\n<li>a thread context switch? (not synchronously scheduled is how I would think of this from a C# perspective)</li>\n</ul>\n\n<p>Let's assume an intelligently designed runtime, or just assume Tokio if the answer is particularly dependent on it.</p>\n\n<p>I've spent a lot of time in C# where we have <code>ValueTask</code> and <code>Task</code>.  <code>ValueTask</code> provides two major advantages: an already completed value that can be on the stack, and no entry into task runtime overhead when awaited with a preexisting value.  Hopefully that helps explain the motivation of my question.</p>\n"}, {"tags": ["c++", "rust", "hashmap"], "comments": [{"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 6, "creation_date": 1563818798, "post_id": 57151374, "comment_id": 100818116, "body": "Some would call that a <i>feature</i>, not a bug."}, {"owner": {"reputation": 480272, "user_id": 1968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fdd630f72eef3790bfb4ef38d08c7f85?s=128&d=identicon&r=PG", "display_name": "Konrad Rudolph", "link": "https://stackoverflow.com/users/1968/konrad-rudolph"}, "edited": false, "score": 0, "creation_date": 1563820847, "post_id": 57151374, "comment_id": 100818983, "body": "It\u2019s definitely a feature: Although there\u2019s no direct concept of getters and setters, C++ could easily have implemented the Python behaviour. I have to assume the choice to do it differently was conscious. That said, the C++ <code>map</code> API is certainly easy to use incorrectly and thus not ideal."}, {"owner": {"reputation": 1492, "user_id": 776788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/227fcf39e6bdc1a86340fc1b32614140?s=128&d=identicon&r=PG", "display_name": "Demolishun", "link": "https://stackoverflow.com/users/776788/demolishun"}, "edited": false, "score": 0, "creation_date": 1563822678, "post_id": 57151374, "comment_id": 100819812, "body": "Interesting feature.  For C++ you can use the <a href=\"https://en.cppreference.com/w/cpp/container/map/at\" rel=\"nofollow noreferrer\">at()</a> method.  It excepts if the key is not available.  Not sure it is really a source of bugs unless you don&#39;t understand that it is happening.  The <a href=\"https://en.cppreference.com/w/cpp/container/map/operator_at\" rel=\"nofollow noreferrer\">documentation</a> states that this is how it works."}, {"owner": {"reputation": 18645, "user_id": 50385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2faf0c72f6a7f65431e7df489878be24?s=128&d=identicon&r=PG", "display_name": "Joseph Garvin", "link": "https://stackoverflow.com/users/50385/joseph-garvin"}, "reply_to_user": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1564417093, "post_id": 57151374, "comment_id": 101015008, "body": "@JesperJuhl Working with a large team of mixed skill level, it becomes clear very quickly it is not a feature, especially when it is combined with implicit inserts causing iterator invalidation. Python distinguishing dictionary (what you want in many cases) versus default dictionary (has the C++ behavior, which admittedly can be handy) is a better way to handle this, or Rust borrow checking protecting you against invalidation."}], "answers": [{"comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1563823250, "post_id": 57151415, "comment_id": 100820081, "body": "Well, the creation in C++ is not really implicit either... I mean, <code>operator[]</code> is specifically used when you want to create an item if it doesn&#39;t exist, so it&#39;s not much different than, say, <code>Vec::resize_default</code> which inserts <code>Default</code> values for the items created..."}, {"owner": {"reputation": 15754, "user_id": 9835872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PN0Lq.jpg?s=128&g=1", "display_name": "ruohola", "link": "https://stackoverflow.com/users/9835872/ruohola"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1563823373, "post_id": 57151415, "comment_id": 100820137, "body": "True, but OP used the word implicit in his question to refer to the C++ way, so I just used that also."}, {"owner": {"reputation": 18645, "user_id": 50385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2faf0c72f6a7f65431e7df489878be24?s=128&d=identicon&r=PG", "display_name": "Joseph Garvin", "link": "https://stackoverflow.com/users/50385/joseph-garvin"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 1, "creation_date": 1564417398, "post_id": 57151415, "comment_id": 101015141, "body": "@MatthieuM <code>operator[]</code> in practice is usually used even when people don&#39;t want to insert the item because it&#39;s much less verbose than the alternative, and because of it being the way to do it in other languages. Also most of the time it will appear to do what you want, so it takes newbies a long time to realize. Especially if the first time they ever run into it is because of an iterator invalidation issue."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 18645, "user_id": 50385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2faf0c72f6a7f65431e7df489878be24?s=128&d=identicon&r=PG", "display_name": "Joseph Garvin", "link": "https://stackoverflow.com/users/50385/joseph-garvin"}, "edited": false, "score": 1, "creation_date": 1564420475, "post_id": 57151415, "comment_id": 101016497, "body": "@JosephGarvin: Sure. C++ was first, though, so it&#39;s hard to blame it for behaving differently when it was the other languages which broke precedence :/"}, {"owner": {"reputation": 18645, "user_id": 50385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2faf0c72f6a7f65431e7df489878be24?s=128&d=identicon&r=PG", "display_name": "Joseph Garvin", "link": "https://stackoverflow.com/users/50385/joseph-garvin"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 1, "creation_date": 1564605098, "post_id": 57151415, "comment_id": 101090831, "body": "@MatthieuM I can blame it for making the error prone use the less verbose one, or for it just being a bad design choice to not make it a separate operation -- it&#39;s not efficient to default construct then copy assign either. Nobody is on trial and we have the benefit of hindsight, but I think it&#39;s safe to say now it&#39;s not the best design."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 18645, "user_id": 50385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2faf0c72f6a7f65431e7df489878be24?s=128&d=identicon&r=PG", "display_name": "Joseph Garvin", "link": "https://stackoverflow.com/users/50385/joseph-garvin"}, "edited": false, "score": 0, "creation_date": 1564642080, "post_id": 57151415, "comment_id": 101099391, "body": "@JosephGarvin: I can definitely agree on the default construct+assign part :)"}], "tags": [], "owner": {"reputation": 15754, "user_id": 9835872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PN0Lq.jpg?s=128&g=1", "display_name": "ruohola", "link": "https://stackoverflow.com/users/9835872/ruohola"}, "is_accepted": true, "score": 3, "last_activity_date": 1563823427, "last_edit_date": 1563823427, "creation_date": 1563818279, "answer_id": 57151415, "question_id": 57151374, "link": "https://stackoverflow.com/questions/57151374/does-rust-implicitly-create-map-entries-when-indexing-like-c/57151415#57151415", "title": "Does Rust implicitly create map entries when indexing, like C++?", "body": "<p>No Rust doesn't have that problem. There's no implicit creation of items in Rust collections.</p>\n\n<p>For example you'd insert a key-value pair to a <code>std::collections::HashMap</code> with <code>map.insert(key, value)</code> and retrieve a value with <code>let value = map.get(key);</code>.  </p>\n\n<p>Note that <code>.get()</code> will return an <code>Option&lt;&amp;V&gt;</code>, so if the key didn't exist you will get <code>None</code> as a result.</p>\n\n<p>Rust also offers an easy way to either retrieve a value or to insert some default value for the given key if the value doesn't exist with:</p>\n\n<pre><code>let value = map.entry(key).or_insert(0);\n</code></pre>\n\n<p>&nbsp;</p>\n\n<p><code>HashMap</code> also <a href=\"https://doc.rust-lang.org/std/collections/struct.HashMap.html#impl-Index%3C%26%27_%20Q%3E\" rel=\"nofollow noreferrer\">implements the <code>Index</code> trait</a>, which allows retrieval of  a value with <code>let value = map[key];</code>, which will panic if <code>key</code> doesn't exist in <code>map</code>.</p>\n\n<p>Note that because <code>HashMap</code> does not implement <code>IndexMut</code>, this <code>[ ]</code> bracket syntax always returns an immutable reference to the value, so you cannot insert or modify values this way.</p>\n"}], "owner": {"reputation": 18645, "user_id": 50385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2faf0c72f6a7f65431e7df489878be24?s=128&d=identicon&r=PG", "display_name": "Joseph Garvin", "link": "https://stackoverflow.com/users/50385/joseph-garvin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 0, "accepted_answer_id": 57151415, "answer_count": 1, "score": 0, "last_activity_date": 1564681105, "creation_date": 1563818132, "last_edit_date": 1564681105, "question_id": 57151374, "link": "https://stackoverflow.com/questions/57151374/does-rust-implicitly-create-map-entries-when-indexing-like-c", "title": "Does Rust implicitly create map entries when indexing, like C++?", "body": "<p>In C++ the indexing operator is defined for <code>std::map</code> and <code>std::unordered_map</code> so that if your reference to the container is non-const just the act of indexing without assigning is enough to have implicitly created a value inside the container. This sometimes creates subtle bugs, where you expect to be referencing a value inside a container but instead actually create one, e.g. <code>config[\"stting\"]</code> instead of <code>config[\"setting\"]</code>.</p>\n\n<p>I know Python addresses this by having <code>__setitem__</code> and <code>__getitem__</code> be separate methods but this requires cooperation with the parser.</p>\n\n<p>Does Rust do anything to address this frequent source of bugs?</p>\n"}, {"tags": ["multithreading", "rust"], "comments": [{"owner": {"reputation": 1817, "user_id": 7556604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hgWR8.jpg?s=128&g=1", "display_name": "Clonk", "link": "https://stackoverflow.com/users/7556604/clonk"}, "edited": false, "score": 0, "creation_date": 1563804879, "post_id": 57147852, "comment_id": 100811211, "body": "Have you taken a look into <a href=\"https://rust-lang.github.io/async-book/03_async_await/01_chapter.html\" rel=\"nofollow noreferrer\">async / await</a> and usage of std::Future ?"}, {"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 4, "creation_date": 1563805042, "post_id": 57147852, "comment_id": 100811332, "body": "The code we see seems to build the buffer. Maybe your problem is just that it&#39;s slow. Are you aware that you don&#39;t display anything before the computation is finished ? If you want to display while computing you need to draw <b>in</b> the <code>for received in rx</code> loop."}, {"owner": {"reputation": 39, "user_id": 11308016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0d872cf368cf3bebf6bdfd07892dc58?s=128&d=identicon&r=PG&f=1", "display_name": "aphsai", "link": "https://stackoverflow.com/users/11308016/aphsai"}, "reply_to_user": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1563805706, "post_id": 57147852, "comment_id": 100811767, "body": "@DenysS&#233;guret Oh wow. You&#39;re right. I didn&#39;t realize it would be this much slower than a non-threaded loop, but after I move the drawing inside the <code>for received in rx</code> loop, I could see the progress. Thank you for your help!"}, {"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 1, "creation_date": 1563806124, "post_id": 57147852, "comment_id": 100812030, "body": "You should have a look at crossbeam. This would also make it easier to deal with several types of events at the same time. And you should probably not redraw the whole every pixel (depends on what&#39;s in the hidden code)"}, {"owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "edited": false, "score": 3, "creation_date": 1563806382, "post_id": 57147852, "comment_id": 100812184, "body": "Note that threads in Rust are OS threads, not lightweight green threads like you may be used to if you&#39;re coming from a language like Go. Spawning a thread per row of pixels is likely going to cause more overhead than speedup. Instead, you should look into using a threadpool to divide the work up over a smaller number of threads - <a href=\"https://github.com/rayon-rs/rayon\" rel=\"nofollow noreferrer\"><code>rayon</code></a> is an excellent library for this. <code>crossbeam</code> also provides some useful utilities, like a more performant <code>channel</code> than the one in <code>std</code>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1563814705, "post_id": 57147852, "comment_id": 100816460, "body": "It&#39;s hard to answer your question because it doesn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. Your code is not syntactically valid and we can&#39;t tell what crates (and their versions), types, traits, fields, etc. are present in the code. It would make it easier for us to help you if you try to reproduce your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> if possible, <i>otherwise</i> in a brand new Cargo project, then <a href=\"https://stackoverflow.com/posts/57147852/edit\">edit</a> your question to include the additional info. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MRE tips</a> you can use to reduce your original code for posting here. Thanks!"}], "owner": {"reputation": 39, "user_id": 11308016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0d872cf368cf3bebf6bdfd07892dc58?s=128&d=identicon&r=PG&f=1", "display_name": "aphsai", "link": "https://stackoverflow.com/users/11308016/aphsai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 938, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1563814669, "creation_date": 1563804506, "last_edit_date": 1563814669, "question_id": 57147852, "link": "https://stackoverflow.com/questions/57147852/how-to-add-threading-to-a-for-loop-in-rust", "title": "How to add threading to a for loop in Rust?", "body": "<p>I'm trying to write a raytracer in Rust. I'm having difficulty getting the for loops to run in parallel. I'm not sure where the problem is, but I can't seem to get anything on the screen. Is this the correct approach or am I completely heading in the wrong direction?</p>\n\n<p>I've tried running the for loops without multi-threading and it does correctly produce output. I've also added loggers to the consumer loop and I'm getting the correct values as well. It just doesn't seem to update the window. </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Clone, Copy)]\npub struct Pixel {\n    pub x: usize,\n    pub y: usize,\n    pub color: Vec3,\n}\n</code></pre>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let mut buffer : Vec&lt;u32&gt; = vec![0; WIDTH * HEIGHT];\nlet (tx, rx) = mpsc::channel()\n\nfor x in 0..HEIGHT {\n   let tx_t = tx.clone();\n   thread::spawn(move || {\n      for y in 0..WIDTH {\n         let mut color = cast_ray(x, y); // returns vec3\n         let pixel = Pixel { x: x, y: y, color: color };\n         tx_t.send(pixel).unwrap();\n      }\n   });\n}\n\nfor received in rx {\n   buffer[received.x * WIDTH + received.y] = received.color.x &lt;&lt; 16 | received.color.y &lt;&lt; 8 | received.color.z;\n}\n\nwhile window.is_open() &amp;&amp; !window.is_key_down(Key::Escape) {\n   window.update_with_buffer(&amp;buffer).unwrap();\n}\n</code></pre>\n\n<p>I'm expecting a few spheres or color to appear on the screen, but it's just black.</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 602, "user_id": 377182, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ae8749027be0825a656abdd50a00d0a5?s=128&d=identicon&r=PG", "display_name": "Tristan Dub&#233;", "link": "https://stackoverflow.com/users/377182/tristan-dub%c3%a9"}, "edited": false, "score": 0, "creation_date": 1563756432, "post_id": 57137979, "comment_id": 100791746, "body": "I see ! I will try to update my code with this. Thanks, let you know how it goes."}, {"owner": {"reputation": 602, "user_id": 377182, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ae8749027be0825a656abdd50a00d0a5?s=128&d=identicon&r=PG", "display_name": "Tristan Dub&#233;", "link": "https://stackoverflow.com/users/377182/tristan-dub%c3%a9"}, "edited": false, "score": 0, "creation_date": 1564610660, "post_id": 57137979, "comment_id": 101092646, "body": "Ok so I tried to adjust the code with the new structure you suggested but I did not manage to grasp the lifetimes I needed to sprinkle in the code. Instead I changed my approach to avoid using static values and opted instead for a vector created at the higher scopes and passed to down to the dependents that needs a reference to it. Your answer is correct though so I will accept it."}], "tags": [], "owner": {"reputation": 22505, "user_id": 1411457, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XqssD.png?s=128&g=1", "display_name": "harmic", "link": "https://stackoverflow.com/users/1411457/harmic"}, "is_accepted": true, "score": 2, "last_activity_date": 1563755359, "creation_date": 1563755359, "answer_id": 57137979, "question_id": 57137790, "link": "https://stackoverflow.com/questions/57137790/can-i-have-non-static-struct-inside-a-static-vector/57137979#57137979", "title": "Can I have non-static struct inside a static vector", "body": "<p>With this:</p>\n\n<pre><code>pub struct PlayerSession {\n    pub state: SessionState,\n    pub player_socket: Option&lt;&amp;TcpStream&gt;\n}\n</code></pre>\n\n<p>you are telling rust that a <code>PlayerSession</code> may contain a reference to a <code>TcpStream</code>.</p>\n\n<p>If you want to store a reference to a socket safely in this data structure, you need to specify the lifetime relationship between the socket owner (not shown in your code sample) and the <code>PlayerSession</code> structure. Otherwise, the compiler cannot verify that the socket might be dropped leaving a dangling reference.</p>\n\n<p>The fact that the <code>PlayerSession</code> structures happen to be stored in a static <code>Vec</code> does not alter this.</p>\n\n<p>If you do not actually need shared access to the socket, the simplest solution might be to make the <code>PlayerSession</code> own the socket, rather than just reference it.</p>\n"}], "owner": {"reputation": 602, "user_id": 377182, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ae8749027be0825a656abdd50a00d0a5?s=128&d=identicon&r=PG", "display_name": "Tristan Dub&#233;", "link": "https://stackoverflow.com/users/377182/tristan-dub%c3%a9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 57137979, "answer_count": 1, "score": 1, "last_activity_date": 1563755359, "creation_date": 1563752890, "question_id": 57137790, "link": "https://stackoverflow.com/questions/57137790/can-i-have-non-static-struct-inside-a-static-vector", "title": "Can I have non-static struct inside a static vector", "body": "<p>I have a server application and I'd like to keep sockets and other info in a vector. Right now, for convenience, I want to use a global static vector accessible through a Mutex <code>game_sessions</code>.</p>\n\n<p>I know keeping global objects isn't really the best idea in Rust but since this is mostly prototype work it would simplify this part a lot.</p>\n\n<p>The error can be found below but it's asking for a lifetime specifier for the <code>Option&lt;&amp;TcpStream&gt;</code> property of PlayerSession.</p>\n\n<p>I'm assuming that it's asking for a <em>`static</em> lifetime specifier. Now, I understand that the Mutex and the Vec would have static lifetime but I don't see why the elements inside the vector would have to be static.</p>\n\n<p>Is there any way to make this work ? I know there's other ways to do this but I want to know why this specific way isn't working.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::net::{TcpStream};\nuse std::sync::*;\n\n#[derive(PartialEq)]\npub enum SessionState {\n    Closed,\n    Active\n}\n\npub struct PlayerSession {\n    pub state: SessionState,\n    pub player_socket: Option&lt;&amp;TcpStream&gt;\n}\n\nlazy_static! {\n    static ref game_sessions: Mutex&lt;Vec&lt;PlayerSession&gt;&gt; = Mutex::new(vec![]);\n}\n\npub fn create_player_session(client_socket: &amp;TcpStream) {\n\n    let mut x = game_sessions.lock().unwrap();\n    x.push(PlayerSession {\n        state: SessionState::Closed,\n        player_socket: Some(client_socket)\n    });\n}\n</code></pre>\n\n<p>When building, the error is : </p>\n\n<pre><code>error[E0106]: missing lifetime specifier\n  --&gt; src\\sessions.rs:12:31\n   |\n12 |     pub player_socket: Option&lt;&amp;TcpStream&gt;\n   |                               ^ expected lifetime parameter\n</code></pre>\n\n<p>Still learning the language so, forgive the poor quality of the code, working on it.</p>\n"}, {"tags": ["rust", "rust-macros"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1563732981, "post_id": 57135615, "comment_id": 100787383, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/52910783/is-it-possible-to-store-state-within-rusts-procedural-macros\">Is it possible to store state within Rust&#39;s procedural macros?</a>"}, {"owner": {"reputation": 167, "user_id": 4610716, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/318e46619794c838204b4c6acc4775dd?s=128&d=identicon&r=PG&f=1", "display_name": "lesurp", "link": "https://stackoverflow.com/users/4610716/lesurp"}, "edited": false, "score": 0, "creation_date": 1563783332, "post_id": 57135615, "comment_id": 100798760, "body": "Note that the linked question is about storing state <i>between</i> macro calls, while I&#39;m trying to save state <i>within</i> one (I basically want to do two passes over the arguments)."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1563787869, "post_id": 57135615, "comment_id": 100801103, "body": "Ah, actually, that is the kind of thing you could do with a proc macro (though not with <code>macro_rules</code>, and not with the syntax you&#39;re using). I&#39;m retracting my close vote"}], "answers": [{"tags": [], "owner": {"reputation": 167, "user_id": 4610716, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/318e46619794c838204b4c6acc4775dd?s=128&d=identicon&r=PG&f=1", "display_name": "lesurp", "link": "https://stackoverflow.com/users/4610716/lesurp"}, "is_accepted": true, "score": 0, "last_activity_date": 1563959702, "creation_date": 1563959702, "answer_id": 57179329, "question_id": 57135615, "link": "https://stackoverflow.com/questions/57135615/store-state-in-macro-rules/57179329#57179329", "title": "Store state in macro_rules", "body": "<p>As pointed by @trentcl, what I want to achieve is indeed possible with proc macro (I thought proc macros were limited to <code>Derive</code> and attributes...)</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[proc_macro]\npub fn generate(input: proc_macro::TokenStream) -&gt; proc_macro::TokenStream {\n    let input = proc_macro2::TokenStream::from(input);\n\n    println!(\"{:?}\", input);\n\n    proc_macro::TokenStream::from(input)\n}\n\ngenerate!(struct Foo;);\n\n// outputs its argument without changing anything, i.e:\n// struct Foo ;\n</code></pre>\n\n<p>The previous example demonstrates a trivial macro that prints to sdout the parsed input: <code>TokenStream [Ident { ident: \"struct\", span: #0 bytes(330..336) }, Ident { ident: \"Foo\", span: #0 bytes(337..340) }, Punct { ch: ';', spacing: Alone, span: #0 bytes(340..341) }]</code></p>\n\n<p>Note that it parses the tokens but does not create an AST; we'll have to use <code>syn</code> for that.</p>\n\n<p><a href=\"https://github.com/dtolnay/proc-macro-workshop\" rel=\"nofollow noreferrer\">This repo</a> has examples many of what can be done with proc macros, pretty helpful!</p>\n"}], "owner": {"reputation": 167, "user_id": 4610716, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/318e46619794c838204b4c6acc4775dd?s=128&d=identicon&r=PG&f=1", "display_name": "lesurp", "link": "https://stackoverflow.com/users/4610716/lesurp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 57179329, "answer_count": 1, "score": 0, "last_activity_date": 1563959702, "creation_date": 1563731333, "last_edit_date": 1563783481, "question_id": 57135615, "link": "https://stackoverflow.com/questions/57135615/store-state-in-macro-rules", "title": "Store state in macro_rules", "body": "<p>I'd like to create a macro that operates on a given list of types, but I need to be able to store which other types are being processed.</p>\n\n<p>A simple example of something I want to do:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Foo;\n\nstruct Bar {\n   foo: Foo,\n   data: u32,\n}\n\nbaz!(Foo, Bar);\n\n// outputs\nstruct OptFoo;\n\nstruct OptBar {\n   foo: OptFoo,\n   data: u32\n}\n</code></pre>\n\n<p>The problem is that it doesn't seem like <code>macro_rules</code> allows me to store a temporary state (i.e a <code>HashSet</code> where I would tag which types are part of the macro invocation). The only workaround I have in mind is to write what I want as a <code>proc_macro_derive</code> and manually adding a custom attribute for each type I need but that's obviously far from perfect...</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>The question is similar to <a href=\"https://stackoverflow.com/questions/52910783/is-it-possible-to-store-state-within-rusts-procedural-macros\">this one</a>, but here I'mm trying to save a state locally and temporarily (basically doing two passes over the arguments while storing data about those) in a single macro call. However it seems it's also not possible.</p>\n"}, {"tags": ["rust", "gtk", "gtk-rs"], "comments": [{"owner": {"reputation": 3049, "user_id": 6150775, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f16a0c1701c5debb928d96fa22ba0582?s=128&d=identicon&r=PG&f=1", "display_name": "theGtknerd", "link": "https://stackoverflow.com/users/6150775/thegtknerd"}, "edited": false, "score": 1, "creation_date": 1563757325, "post_id": 57135341, "comment_id": 100791889, "body": "Would you mind posting how to compile this example? I usually use Python. I know the answer to this question, but I am not fluent in Rust."}, {"owner": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "reply_to_user": {"reputation": 3049, "user_id": 6150775, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f16a0c1701c5debb928d96fa22ba0582?s=128&d=identicon&r=PG&f=1", "display_name": "theGtknerd", "link": "https://stackoverflow.com/users/6150775/thegtknerd"}, "edited": false, "score": 0, "creation_date": 1563807124, "post_id": 57135341, "comment_id": 100812630, "body": "To compile this may be more than you want to waste your time on, although I do appreciate the offer.   If do want to compile &amp; run you will need the Rust Setup (<a href=\"https://www.rust-lang.org/learn/get-started\" rel=\"nofollow noreferrer\">rust-lang.org/learn/get-started</a>)."}, {"owner": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "reply_to_user": {"reputation": 3049, "user_id": 6150775, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f16a0c1701c5debb928d96fa22ba0582?s=128&d=identicon&r=PG&f=1", "display_name": "theGtknerd", "link": "https://stackoverflow.com/users/6150775/thegtknerd"}, "edited": false, "score": 0, "creation_date": 1563807647, "post_id": 57135341, "comment_id": 100812943, "body": "Once Rust is installed, run command &quot;cargo new testit&quot; from the terminal then navigate to that folder.  Inside you will see a single file &quot;Cargo.toml&quot; - for this paste the gio &amp; gtk lines from the Cargo,toml above into that file and save it.   Next, open the &#39;&quot;src&quot; folder and open the file &quot;main.rs&quot; and delete all the text in it.  Copy &amp; paste the main code listing from this bug into &quot;main.rs&quot; and save it.  On the terminal type &quot;cargo run&quot; and you should see the crates updating and when it finishes, the gui window will appear."}, {"owner": {"reputation": 3049, "user_id": 6150775, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f16a0c1701c5debb928d96fa22ba0582?s=128&d=identicon&r=PG&f=1", "display_name": "theGtknerd", "link": "https://stackoverflow.com/users/6150775/thegtknerd"}, "edited": false, "score": 0, "creation_date": 1563807904, "post_id": 57135341, "comment_id": 100813090, "body": "I get yada-yada errors, ending in <b>Could not compile <code>fragile</code></b>. So I will wait until you get to test my suggestions."}], "answers": [{"comments": [{"owner": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "edited": false, "score": 0, "creation_date": 1563806641, "post_id": 57138557, "comment_id": 100812347, "body": "Thanks very much for your input!.  The Rust compiler is very fussy and would not let me compile the line of code you recommend.  I suspect it is due to the single quotes as Rust uses a single quote for lifetimes (which is another whole can of worms).  Nevertheless, you have given me a good direction to investigate further which I appreciate greatly.  I won&#39;t have much time to spend on this again until this weekend (I am just a hobbyist not a real programmer).  If I am able to get your code tweaked to work in my little project I will definitely return and log this a fix."}, {"owner": {"reputation": 3049, "user_id": 6150775, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f16a0c1701c5debb928d96fa22ba0582?s=128&d=identicon&r=PG&f=1", "display_name": "theGtknerd", "link": "https://stackoverflow.com/users/6150775/thegtknerd"}, "reply_to_user": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "edited": false, "score": 0, "creation_date": 1563807246, "post_id": 57138557, "comment_id": 100812693, "body": "Double quotes, then? <code>renderer.set_property(&quot;xalign&quot;, 1.00)</code>"}, {"owner": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "edited": false, "score": 0, "creation_date": 1563808135, "post_id": 57138557, "comment_id": 100813209, "body": "Played around a bit more and it turns out on Rust what I need is this:  renderer.set_property(1.0, 1.0)"}, {"owner": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "edited": false, "score": 0, "creation_date": 1563808164, "post_id": 57138557, "comment_id": 100813229, "body": "I never would have found this without your help - thank you very much!"}, {"owner": {"reputation": 3049, "user_id": 6150775, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f16a0c1701c5debb928d96fa22ba0582?s=128&d=identicon&r=PG&f=1", "display_name": "theGtknerd", "link": "https://stackoverflow.com/users/6150775/thegtknerd"}, "reply_to_user": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "edited": false, "score": 0, "creation_date": 1563808223, "post_id": 57138557, "comment_id": 100813266, "body": "That seems wierd according to the Gtk semantics. Are you sure the &quot;xalign&quot; property doesn&#39;t work?"}, {"owner": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "edited": false, "score": 0, "creation_date": 1563808981, "post_id": 57138557, "comment_id": 100813723, "body": "Rust, in my limited experience, is very weird to me at times.  The last image shows the compiler error where it wants a float instead of a string.  Changing this to a float fixed everything.  I never would have gotten this working without your help and I cannot thank you enough!"}, {"owner": {"reputation": 3049, "user_id": 6150775, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f16a0c1701c5debb928d96fa22ba0582?s=128&d=identicon&r=PG&f=1", "display_name": "theGtknerd", "link": "https://stackoverflow.com/users/6150775/thegtknerd"}, "reply_to_user": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "edited": false, "score": 1, "creation_date": 1563809360, "post_id": 57138557, "comment_id": 100813959, "body": "Aha, you are using <code>renderer.set_alignment(1.0, 1.0)</code>! While this works, I actually stated <code>renderer.set_property(&quot;xalign&quot;, 1.0)</code>. With <code>set_alignment</code> you are actually setting the x and y alignment properties. Due to some other things that may bite you later on, I would only use the xalign property."}], "tags": [], "owner": {"reputation": 3049, "user_id": 6150775, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f16a0c1701c5debb928d96fa22ba0582?s=128&d=identicon&r=PG&f=1", "display_name": "theGtknerd", "link": "https://stackoverflow.com/users/6150775/thegtknerd"}, "is_accepted": true, "score": 4, "last_activity_date": 1563809419, "last_edit_date": 1563809419, "creation_date": 1563763111, "answer_id": 57138557, "question_id": 57135341, "link": "https://stackoverflow.com/questions/57135341/how-to-right-justify-numeric-data-in-list-store-tree-view-using-gtk-rs/57138557#57138557", "title": "How to right justify numeric data in list store / tree view using gtk-rs", "body": "<p>You are looking for the <a href=\"https://developer.gnome.org/gtk3/stable/GtkCellRenderer.html#GtkCellRenderer--xalign\" rel=\"nofollow noreferrer\">xalign</a> property. As far as I can tell, this would result in:</p>\n\n<pre><code>renderer.set_property(\"xalign\", 1.00)\n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 2891944, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iJFwu.jpg?s=128&g=1", "display_name": "Jman", "link": "https://stackoverflow.com/users/2891944/jman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 1, "accepted_answer_id": 57138557, "answer_count": 1, "score": 3, "last_activity_date": 1563833302, "creation_date": 1563729081, "last_edit_date": 1563833302, "question_id": 57135341, "link": "https://stackoverflow.com/questions/57135341/how-to-right-justify-numeric-data-in-list-store-tree-view-using-gtk-rs", "title": "How to right justify numeric data in list store / tree view using gtk-rs", "body": "<p><a href=\"https://i.stack.imgur.com/uWDv2.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uWDv2.png\" alt=\"enter image description here\"></a></p>\n\n<p>I have been recently learning making simple GUIs with gtk-rs but have run into an issue where numeric data is left justified in the list store / tree view and I want to have it right justified.</p>\n\n<p>The code below is a modification from here: <a href=\"https://github.com/gtk-rs/examples/blob/master/src/bin/list_store.rs\" rel=\"nofollow noreferrer\">https://github.com/gtk-rs/examples/blob/master/src/bin/list_store.rs</a></p>\n\n<p>I have been able to get the column headers to justify to center (for date) and right (for population &amp; area) by using \".set_alignment\" but have been unable to change the alignment of the data itself.  </p>\n\n<p>String data is easy enough to manipulate (I embedded a tab in the date items and it lines up nicely.  However, if I change the population &amp; area data to be formatted strings, they will sort as such when their column header is clicked rather than as a numeric.</p>\n\n<p>Any &amp; all help is greatly appreciated!</p>\n\n<pre><code>extern crate gio;\nextern crate gtk;\n\nuse gtk::prelude::*;\nuse std::rc::Rc;\nuse std::env::args;\nuse gio::prelude::*;\n\n#[repr(i32)]\nenum Columns {\n    State,\n    Population,\n    Area,\n    Date,\n}\n\nfn build_ui(application: &amp;gtk::Application) {\n    let window = gtk::ApplicationWindow::new(application);\n\n    window.set_title(\"List Store\");\n    window.set_border_width(10);\n    window.set_position(gtk::WindowPosition::Center);\n    window.set_default_size(300, 500);\n\n    let vbox = gtk::Box::new(gtk::Orientation::Vertical, 8);\n    window.add(&amp;vbox);\n\n    let label = gtk::Label::new(Some(\"US State Facts\"));\n    vbox.add(&amp;label);\n\n    let sw = gtk::ScrolledWindow::new(None::&lt;&amp;gtk::Adjustment&gt;, None:: &lt;&amp;gtk::Adjustment&gt;);\n    sw.set_shadow_type(gtk::ShadowType::EtchedIn);\n    sw.set_policy(gtk::PolicyType::Never, gtk::PolicyType::Automatic);\n    vbox.add(&amp;sw);\n\n    let model = Rc::new(create_model());\n    let treeview = gtk::TreeView::new_with_model(&amp;*model);\n    treeview.set_vexpand(true);\n\n    sw.add(&amp;treeview);\n\n    add_columns(&amp;treeview);\n\n    window.show_all();\n}\n\nstruct Data {\n    state: String,\n    population: u32,\n    area: u32,\n    date: String,\n}\n\nfn create_model() -&gt; gtk::ListStore {\n\n    let col_types: [gtk::Type; 4] = [\n        gtk::Type::String,\n        gtk::Type::U32,\n        gtk::Type::U32,\n        gtk::Type::String,\n    ];\n\n    let data: [Data; 14] = [\n        Data {\n            state: \"Alabama\".to_string(),\n            population: 4887871,\n            area: 125767,\n            date: \"\\t1819.12.14\".to_string(),\n        },\n        Data {\n            state: \"Alaska\".to_string(),\n            population: 737438,\n            area: 1723337,\n            date: \"\\t1959.01.03\".to_string(),\n        },\n        Data {\n            state: \"Arkansas\".to_string(),\n            population: 3013825,\n            area: 137732,\n            date: \"\\t1836.06.15\".to_string(),\n        },\n        Data {\n            state: \"Arizona\".to_string(),\n            population: 7171646,\n            area: 295234,\n            date: \"\\t1912.02.14\".to_string(),\n        },\n        Data {\n            state: \"California\".to_string(),\n            population: 39557045,\n            area: 423972,\n            date: \"\\t1850.09.09\".to_string(),\n        },\n        Data {\n            state: \"Colorado\".to_string(),\n            population: 5695564,\n            area: 269601,\n            date: \"\\t1876.08.01\".to_string(),\n        },\n        Data {\n            state: \"Connecticut\".to_string(),\n            population: 3572665,\n            area: 14357,\n            date: \"\\t1788.01.09\".to_string(),\n        },\n        Data {\n            state: \"Delaware\".to_string(),\n            population: 967171,\n            area: 6446,\n            date: \"\\t1787.12.07\".to_string(),\n        },\n        Data {\n            state: \"Maine\".to_string(),\n            population: 1338404,\n            area: 91633,\n            date: \"\\t1820.03.15\".to_string(),\n        },\n        Data {\n            state: \"Maryland\".to_string(),\n            population: 6042718,\n            area: 32131,\n            date: \"\\t1788.04.28\".to_string(),\n        },\n        Data {\n            state: \"Massachusetts\".to_string(),\n            population: 6902149,\n            area: 27336,\n            date: \"\\t1788.02.06\".to_string(),\n        },\n        Data {\n            state: \"Michigan\".to_string(),\n            population: 9998915,\n            area: 250487,\n            date: \"\\t1837.01.26\".to_string(),\n        },\n        Data {\n            state: \"Missouri\".to_string(),\n            population: 6126452,\n            area: 180540,\n            date: \"\\t1821.08.10\".to_string(),\n        },\n        Data {\n            state: \"Nebraska\".to_string(),\n            population: 1929268,\n            area: 200330,\n            date: \"\\t1867.03.01\".to_string(),\n        },\n    ];\n\n    let store = gtk::ListStore::new(&amp;col_types);\n\n    let col_indices: [u32; 4] = [0, 1, 2, 3];\n\n    for (_, d) in data.iter().enumerate() {\n        let values: [&amp;dyn ToValue; 4] = [\n            &amp;d.state,\n            &amp;d.population,\n            &amp;d.area,\n            &amp;d.date,\n        ];\n        store.set(&amp;store.append(), &amp;col_indices, &amp;values);\n    }\n\n    store\n}\n\n//fn add_columns(treeview: &amp;gtk::TreeView) \nfn add_columns(treeview: &amp;gtk::TreeView) {\n\n    // Column for state name\n    {\n        let renderer = gtk::CellRendererText::new();\n        let column = gtk::TreeViewColumn::new();\n        column.pack_start(&amp;renderer, true);\n        column.set_title(\"State\");\n        column.add_attribute(&amp;renderer, \"text\", Columns::State as i32);\n        column.set_sort_column_id(Columns::State as i32);\n        column.set_fixed_width(150);\n        column.set_alignment(0.0);\n        treeview.append_column(&amp;column);\n    }\n\n    // Column for population\n    {\n        let renderer = gtk::CellRendererText::new();\n        let column = gtk::TreeViewColumn::new();\n        column.pack_start(&amp;renderer, true);\n        column.set_title(\"Population\");\n        column.add_attribute(&amp;renderer, \"text\", Columns::Population as i32);\n        column.set_sort_column_id(Columns::Population as i32);\n        column.set_fixed_width(150);\n        column.set_alignment(1.0);\n        treeview.append_column(&amp;column);\n    } \n\n    // Column for area\n    {\n        let renderer = gtk::CellRendererText::new();\n        let column = gtk::TreeViewColumn::new();\n        column.pack_start(&amp;renderer, true);\n        column.set_title(\"Area\");\n        column.add_attribute(&amp;renderer, \"text\", Columns::Area as i32);\n        column.set_sort_column_id(Columns::Area as i32);\n        column.set_fixed_width(150);\n        column.set_alignment(1.0);\n        treeview.append_column(&amp;column);\n    }\n\n    // Column for date\n    {\n        let renderer = gtk::CellRendererText::new();\n        let column = gtk::TreeViewColumn::new();\n        column.pack_start(&amp;renderer, true);\n        column.set_title(\"Date\");\n        column.add_attribute(&amp;renderer, \"text\", Columns::Date as i32);\n        column.set_sort_column_id(Columns::Date as i32);\n        column.set_fixed_width(150);\n        column.set_alignment(0.5);\n        treeview.append_column(&amp;column);\n    }\n}\n\n\nfn main() {\n    let application = gtk::Application::new(\n        Some(\"com.github.gtk-rs.examples.list-store\"),\n        Default::default(),\n    )\n    .expect(\"Initialization failed...\");\n\n    application.connect_startup(|app| {\n         build_ui(app);\n    });\n\n    application.connect_activate(|_| {});\n\n    application.run(&amp;args().collect::&lt;Vec&lt;_&gt;&gt;());\n}\n</code></pre>\n\n<p>Cargo.toml:</p>\n\n<pre><code>[package]\nname = \"testit\"\nversion = \"0.1.0\"\nauthors = [\"jerry\"]\nedition = \"2018\"\n\n[dependencies]\ngio = \"0.7.0\"\ngtk = \"0.7.0\"   \n</code></pre>\n\n<p>The Fix:\nrenderer.set_alignment(1.0, 1.0);</p>\n\n<pre><code>// Column for population\n{\n    let renderer = gtk::CellRendererText::new();\n    renderer.set_alignment(1.0, 1.0);\n    let column = gtk::TreeViewColumn::new();\n    column.pack_start(&amp;renderer, true);\n    column.set_title(\"Population\");\n    column.add_attribute(&amp;renderer, \"text\", Columns::Population as i32);\n    column.set_sort_column_id(Columns::Population as i32);\n    column.set_fixed_width(150);\n    column.set_alignment(1.0);\n    treeview.append_column(&amp;column);\n} \n</code></pre>\n\n<p>Good result:\n<a href=\"https://i.stack.imgur.com/PnQfH.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PnQfH.png\" alt=\"enter image description here\"></a></p>\n\n<p>Compiler Error:\n<a href=\"https://i.stack.imgur.com/WMPcB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/WMPcB.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["rust", "stream", "ssh2"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563721487, "post_id": 57134077, "comment_id": 100784692, "body": "I don&#39;t think it&#39;s possible you need to copy at least one time the data to the user space cause that how ssh2 is working, it must probably do some transformation on the data from the socket and so need a buffer to write encrypted data on it."}, {"owner": {"reputation": 15750, "user_id": 465590, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/637c4bbe3ae3ef4e53899bd41a43b614?s=128&d=identicon&r=PG", "display_name": "Joyce Babu", "link": "https://stackoverflow.com/users/465590/joyce-babu"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563723300, "post_id": 57134077, "comment_id": 100785196, "body": "@Stargateur I am using the latest version <code>v0.3.3</code>. The question is not really about an issue with the above code, but on how to do something in Rust. i.e. how to write <code>stream:ssh2::Stream</code> to a file without using a loop. I included the above code only to show the type of <code>stream</code> variable."}, {"owner": {"reputation": 15750, "user_id": 465590, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/637c4bbe3ae3ef4e53899bd41a43b614?s=128&d=identicon&r=PG", "display_name": "Joyce Babu", "link": "https://stackoverflow.com/users/465590/joyce-babu"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1563725943, "post_id": 57134077, "comment_id": 100785788, "body": "@Stargateur Thank you. I fixed the error while creating the minimal reproducible example as you suggested :)  <code>io::copy</code> had to be called with <code>remote_file</code> (<code>ssh2::Channel</code>) and not <code>remote_file.stream()</code> (<code>ssh2::Stream</code>)."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1563837471, "post_id": 57134077, "comment_id": 100824800, "body": "It&#39;s great that you have the solution to your question! You should post it as an answer rather than an edit to your question and then potentially accept that answer. That way, the question shows up as solved in search results, people can vote on your answer, and your solution can be more helpful to future people with the same problem."}], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563721167, "post_id": 57134328, "comment_id": 100784622, "body": "This isn&#39;t doing what the question ask &quot;without reading the data into memory with stream.read() within a loop?&quot; <code>copy</code> use a buffer, <a href=\"https://doc.rust-lang.org/src/std/io/util.rs.html#43-63\" rel=\"nofollow noreferrer\">doc.rust-lang.org/src/std/io/util.rs.html#43-63</a>"}, {"owner": {"reputation": 3472, "user_id": 4072509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/16VK8.jpg?s=128&g=1", "display_name": "apetranzilla", "link": "https://stackoverflow.com/users/4072509/apetranzilla"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563721431, "post_id": 57134328, "comment_id": 100784677, "body": "@Stargateur You&#39;re going to need to buffer the data somewhere if you want to efficiently copy data, and it won&#39;t get much easier or faster than what the standard library already provides. What exactly is the issue with having data in memory?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563721578, "post_id": 57134328, "comment_id": 100784710, "body": "I don&#39;t have one, but actually your answer is wrong, it doesn&#39;t answer the OP question. I&#39;m not an expert in ssh2, but just know that the answer &quot;no, you can&#39;t&quot; is perfectly acceptable if it&#39;s true. copy is probably the way to go but that need a buffer data."}, {"owner": {"reputation": 15750, "user_id": 465590, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/637c4bbe3ae3ef4e53899bd41a43b614?s=128&d=identicon&r=PG", "display_name": "Joyce Babu", "link": "https://stackoverflow.com/users/465590/joyce-babu"}, "edited": false, "score": 0, "creation_date": 1563722790, "post_id": 57134328, "comment_id": 100785051, "body": "@apemanzilla The code hangs at <code>std::io::copy(&amp;mut stream, &amp;mut file);</code>. There is nothing written to the target file."}, {"owner": {"reputation": 15750, "user_id": 465590, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/637c4bbe3ae3ef4e53899bd41a43b614?s=128&d=identicon&r=PG", "display_name": "Joyce Babu", "link": "https://stackoverflow.com/users/465590/joyce-babu"}, "edited": false, "score": 0, "creation_date": 1563727142, "post_id": 57134328, "comment_id": 100786021, "body": "@apemanzilla Thank you. <code>io::copy</code> and <code>indicatif::ProgressBar</code> worked perfectly for me."}], "tags": [], "owner": {"reputation": 3472, "user_id": 4072509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/16VK8.jpg?s=128&g=1", "display_name": "apetranzilla", "link": "https://stackoverflow.com/users/4072509/apetranzilla"}, "is_accepted": true, "score": 2, "last_activity_date": 1563720958, "creation_date": 1563720958, "answer_id": 57134328, "question_id": 57134077, "link": "https://stackoverflow.com/questions/57134077/how-can-i-write-a-ssh2stream-to-a-file-without-reading-the-data-into-memory/57134328#57134328", "title": "How can I write a ssh2::Stream to a file without reading the data into memory?", "body": "<p>Since <code>Stream</code> implements <code>Read</code>, you should be able to just use <code>std::io::copy(&amp;mut stream, &amp;mut File::create(...).unwrap())</code> to copy all the data into a file. If you want a progress bar, I'd recommend using the <a href=\"https://docs.rs/indicatif/0.11.0/indicatif/\" rel=\"nofollow noreferrer\"><code>indicatif</code></a> crate, which has a <a href=\"https://docs.rs/indicatif/0.11.0/indicatif/struct.ProgressBar.html#method.wrap_read\" rel=\"nofollow noreferrer\">method to wrap a <code>Read</code> instance</a>, automatically updating a progress bar as data is read.</p>\n"}], "owner": {"reputation": 15750, "user_id": 465590, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/637c4bbe3ae3ef4e53899bd41a43b614?s=128&d=identicon&r=PG", "display_name": "Joyce Babu", "link": "https://stackoverflow.com/users/465590/joyce-babu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 392, "favorite_count": 0, "accepted_answer_id": 57134328, "answer_count": 1, "score": 0, "last_activity_date": 1563837518, "creation_date": 1563719085, "last_edit_date": 1563837518, "question_id": 57134077, "link": "https://stackoverflow.com/questions/57134077/how-can-i-write-a-ssh2stream-to-a-file-without-reading-the-data-into-memory", "title": "How can I write a ssh2::Stream to a file without reading the data into memory?", "body": "<p>I am trying to download a large binary file via SCP using <a href=\"https://crates.io/crates/ssh2\" rel=\"nofollow noreferrer\"><code>ssh2</code></a> crate <code>v0.3.3</code>.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate ssh2;\n\nuse std::net::TcpStream;\nuse ssh2::Session;\nuse std::path::Path;\nuse std::fs::File;\nuse indicatif::ProgressBar;\n\nfn main() -&gt; Result&lt;(), Box&lt;std::error::Error&gt;&gt; {\n    let ssh_host_port = \"prokerala.com:22\";\n    let ssh_user = \"prokeral\";\n    let remote_temp_file = \"/tmp/dbimport_Rk6Iwwm5.sql.bz2\";\n\n    let tcp = TcpStream::connect(&amp;ssh_host_port).unwrap();\n    let mut sess = Session::new().unwrap();\n    sess.handshake(&amp;tcp).expect(\"SSH handshake failed\");\n    let _ = sess.userauth_agent(ssh_user);\n\n    let path = Path::new(&amp;remote_temp_file);\n    let (mut remote_file, stat) = sess.scp_recv(path).unwrap();\n\n    let stream:ssh2::Stream = remote_file.stream(1);\n\n    // Update: solved by using io::copy as suggested by @apemanzilla below\n    // let mut target = File::create(\"/tmp/done.txt\").unwrap();\n    // let pb = ProgressBar::new(stat.size());\n    // std::io::copy(&amp;mut pb.wrap_read(remote_file), &amp;mut target)?;\n    Ok(())\n}\n</code></pre>\n\n<p>I want to write <code>stream</code> to a file, and show a progress bar. Is it possible to write <code>stream</code> to a file directly, without reading the data into memory with <code>stream.read()</code> within a loop?</p>\n"}, {"tags": ["multithreading", "concurrency", "static", "rust", "lazy-initialization"], "comments": [{"owner": {"reputation": 685, "user_id": 5641333, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xQ9JE.jpg?s=128&g=1", "display_name": "JayDepp", "link": "https://stackoverflow.com/users/5641333/jaydepp"}, "edited": false, "score": 2, "creation_date": 1563731449, "post_id": 57134076, "comment_id": 100786974, "body": "If I understand the issue correctly, there is no reasonable way to get what you want. <code>Pairs</code> cannot be shared across threads, so you must make a new one for each test. Also, I&#39;m not sure it would even do what you want, since it&#39;s an iterator that would be shared across the tests, and you&#39;d get the items in a nondeterministic order."}], "answers": [{"comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1563781752, "post_id": 57141296, "comment_id": 100798024, "body": "I am not actually sure whether a thread is spawned for each test, or if a thread-pool is used with one thread per core. This could be determined empirically by creating 2x or 4x as many tests as you have cores and count how many times parsing occurs."}, {"owner": {"reputation": 2509, "user_id": 3719101, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z4L8i.jpg?s=128&g=1", "display_name": "iago-lito &#39;considering leaving", "link": "https://stackoverflow.com/users/3719101/iago-lito-considering-leaving"}, "edited": false, "score": 0, "creation_date": 1563789689, "post_id": 57141296, "comment_id": 100802091, "body": "I think I understand better now. The most reasonable seems to post-process the parse output into something <code>Sync</code>. I&#39;ll give it a try. Thank you for this very clear answer :)"}, {"owner": {"reputation": 2509, "user_id": 3719101, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z4L8i.jpg?s=128&g=1", "display_name": "iago-lito &#39;considering leaving", "link": "https://stackoverflow.com/users/3719101/iago-lito-considering-leaving"}, "edited": false, "score": 0, "creation_date": 1563832330, "post_id": 57141296, "comment_id": 100823529, "body": "Interestingly, the cost of post-processing the output of <code>pest</code> in <code>lazy_static</code> is to somehow <i>rewrite the grammar structure</i> entirely by hand so as to convert it into anything <code>Sync</code>. That is too much duplication to maintain in a <code>test</code> procedure. I&#39;m dropping it in favour of multiple parsing passes. Anyway, my goal was to learn something. I did. Thank you :)"}], "tags": [], "owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "is_accepted": true, "score": 1, "last_activity_date": 1563781626, "last_edit_date": 1592644375, "creation_date": 1563781626, "answer_id": 57141296, "question_id": 57134076, "link": "https://stackoverflow.com/questions/57134076/share-static-lazy-initialized-object-containing-rc-refs-among-multiple-threads/57141296#57141296", "title": "Share static lazy-initialized object containing `Rc` refs among multiple threads with `thread_local!` and `OnceCell`", "body": "<h3>Why isn't <code>lazy_static!</code> suitable?</h3>\n<p>Whether <code>cargo test</code> spins up a new thread per test or not is actually irrelevant.</p>\n<p>A <code>static</code> variable is global, and thus <em>potentially</em> shared between threads, thus even if no thread is ever spawned, it must be <code>Sync</code>.</p>\n<p>And since <code>Rc</code> is not <code>Sync</code> (cannot be shared between threads), this cannot work.</p>\n<h3>Why isn't <code>thread_local!</code> suitable?</h3>\n<p>There is one <code>thread_local!</code> variable per thread, as the name suggests.</p>\n<p>The code within <code>thread_local!</code> is actually not run immediately upon thread-creation; as the variable is lazily instantiated on first access.</p>\n<h3>How do I make parsing occur only once per section?</h3>\n<p>Don't use the output of <code>pest</code> directly.</p>\n<p>If you post-process the output of <code>pest</code> and create a structure that is <code>Sync</code> out of it, then you can store it with <code>lazy_static</code> and it will only be parsed once.</p>\n<p>Actually, you could go further and avoid <code>lazy_static</code> entirely. If you can express the structure in a purely <code>const</code> way, then you could use a <code>build.rs</code> script or procedural macro to transform the string into a model at compile-time. For tests, though, this may not be worth the effort.</p>\n"}], "owner": {"reputation": 2509, "user_id": 3719101, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/Z4L8i.jpg?s=128&g=1", "display_name": "iago-lito &#39;considering leaving", "link": "https://stackoverflow.com/users/3719101/iago-lito-considering-leaving"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 57141296, "answer_count": 1, "score": 0, "last_activity_date": 1563781626, "creation_date": 1563719082, "question_id": 57134076, "link": "https://stackoverflow.com/questions/57134076/share-static-lazy-initialized-object-containing-rc-refs-among-multiple-threads", "title": "Share static lazy-initialized object containing `Rc` refs among multiple threads with `thread_local!` and `OnceCell`", "body": "<p>I have split my tests into several, similar sections. Within each section, results are compared against a static test string, written in a dedicated tested language (here called <code>dum</code>) and parsed with <a href=\"https://pest.rs/\" rel=\"nofollow noreferrer\"><code>pest</code></a>.</p>\n\n<hr>\n\n<p>Here is the global structure of my MWE.</p>\n\n<pre><code>$ tree\n.\n\u251c\u2500\u2500 Cargo.lock\n\u251c\u2500\u2500 Cargo.toml\n\u251c\u2500\u2500 src\n\u2502   \u2514\u2500\u2500 main.rs\n\u2514\u2500\u2500 tests\n    \u251c\u2500\u2500 dum.pest\n    \u251c\u2500\u2500 section_1.rs\n    \u2514 .. imagine more similar sections here.\n</code></pre>\n\n<ul>\n<li><code>Cargo.toml</code></li>\n</ul>\n\n<pre><code>[package]\n...\nedition = \"2018\"\n\n[dev-dependencies]\npest = \"*\"\npest_derive = \"*\"\nonce_cell = \"*\"\nlazy_static = \"*\"\n\n</code></pre>\n\n<ul>\n<li><code>main.rs</code> only contains <code>fn main() {}</code>.</li>\n<li><code>dum.pest</code> is a dummy <code>any = { ANY* }</code>.</li>\n<li><code>section_1.rs</code> preamble is:</li>\n</ul>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use pest_derive::Parser;\nuse pest::{iterators::Pairs, Parser};\n\n// Compile dedicated grammar.\n#[derive(Parser)]\n#[grammar = \"../tests/dum.pest\"]\npub struct DumParser;\n\n// Here is the static test string to run section 1 against.\nstatic SECTION_1: &amp;'static str = \"Content to parse for section 1.\";\n\n// Type of the result expected to be globally available in the whole test section.\ntype ParseResult = Pairs&lt;'static, Rule&gt;;\n</code></pre>\n\n<hr>\n\n<p>Now, my first naive attempt to make the parse result available to all test function was:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// Naive lazy_static! attempt:\nuse lazy_static::lazy_static;\nlazy_static! {\n    static ref PARSED: ParseResult = {\n        DumParser::parse(Rule::any, &amp;*SECTION_1).expect(\"Parse failed.\")\n    };\n}\n#[test]\nfn first() {\n    println!(\"1: {:?} parsed to {:?}\", &amp;*SECTION_1, *PARSED);\n}\n#[test]\nfn second() {\n    println!(\"2: {:?} parsed to {:?}\", &amp;*SECTION_1, *PARSED);\n}\n</code></pre>\n\n<p>This does not compile. According to <a href=\"https://github.com/pest-parser/pest/issues/400#issuecomment-513039043\" rel=\"nofollow noreferrer\"><code>pest</code></a>, it's because they use inner <code>Rc</code> references that cannot be safely shared among threads, and I think <code>cargo test</code> does spin a new thread for each <code>#[test]</code> function.</p>\n\n<p>The suggested solution involves the use of <code>thread_local!</code> and <code>OnceCell</code>, but I cannot figure it out. The following two attempts:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// Naive thread_local! attempt:\nthread_local! {\n    static PARSED: ParseResult = {\n        println!(\" + + + + + + + PARSING! + + + + + + + \"); // /!\\ SHOULD APPEAR ONLY ONCE!\n        DumParser::parse(Rule::any, &amp;*SECTION_1).expect(\"Parse failed.\")\n    };\n}\n#[test]\nfn first() {\n    PARSED.with(|p| println!(\"1: {:?} parsed to {:?}\", &amp;*SECTION_1, p));\n}\n#[test]\nfn second() {\n    PARSED.with(|p| println!(\"2: {:?} parsed to {:?}\", &amp;*SECTION_1, p));\n}\n</code></pre>\n\n<p>and</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// Naive OnceCell attempt:\nuse once_cell::sync::OnceCell;\nthread_local! {\nstatic PARSED: OnceCell&lt;ParseResult&gt; = {\n    println!(\" + + + + + + + PARSING! + + + + + + + \"); // /!\\ SHOULD APPEAR ONLY ONCE!\n        let once = OnceCell::new();\n        once.set(DumParser::parse(Rule::any, &amp;*SECTION_1).expect(\"Parse failed.\"))\n        .expect(\"Already set.\");\n        once\n    };\n}\n#[test]\nfn first() {\n    PARSED.with(|p| println!(\"1: {:?} parsed_to {:?}\", &amp;*SECTION_1, p.get().unwrap()));\n}\n#[test]\nfn second() {\n    PARSED.with(|p| println!(\"2: {:?} parsed_to {:?}\", &amp;*SECTION_1, p.get().unwrap()));\n}\n</code></pre>\n\n<p>Both compile and run fine. But the output of <code>cargo test -- --nocapture</code>\nsuggests that the parsing is actually done once for each test function:</p>\n\n<pre><code>running 2 tests\n + + + + + + + PARSING! + + + + + + +\n + + + + + + + PARSING! + + + + + + +\n1: \"Content to parse for section 1.\" parsed_to [Pair { rule: any, span: Span { str: \"Content to parse for section 1.\", start: 0, end: 31 }, inner: [] }]\n2: \"Content to parse for section 1.\" parsed_to [Pair { rule: any, span: Span { str: \"Content to parse for section 1.\", start: 0, end: 31 }, inner: [] }]\ntest first ... ok\ntest second ... ok\n\ntest result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n</code></pre>\n\n<p>This reveals that I have failed in both my attempts.</p>\n\n<p>What is wrong with these approaches?<br>\nHow do I make the parsing occur only once per section?</p>\n"}, {"tags": ["rust", "integer-overflow"], "answers": [{"comments": [{"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 1, "creation_date": 1563718616, "post_id": 57132480, "comment_id": 100783951, "body": "Using <code>From</code> or <code>TryFrom</code> would be more idiomatic nowadays."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1563718979, "post_id": 57132480, "comment_id": 100784047, "body": "@mcarton: good to know, thanks. I&#39;m not even a rust newbie. Just an embryo of one :)"}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 1, "creation_date": 1563891488, "post_id": 57132480, "comment_id": 100846133, "body": "@SergioTulentsev: <code>as</code> works fine, it&#39;s just not maintenance-friendly. If the type of <code>a</code> switches to <code>i64</code> the operation <code>a as i32</code> will continue to compile, now silently truncating the value. <code>From</code> is defined only for conversion which cannot fail, so would stop compiling. <code>TryFrom</code> is defined for all conversions, but returns an <code>Option&lt;Target&gt;</code> which must be unwrapped at run-time; it is idiomatically used for conversions that <i>may</i> fail."}], "tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": false, "score": 1, "last_activity_date": 1563706352, "creation_date": 1563706352, "answer_id": 57132480, "question_id": 57132438, "link": "https://stackoverflow.com/questions/57132438/how-to-add-or-multiply-two-i16-in-rust-to-form-an-i32-without-overflowing/57132480#57132480", "title": "How to add or multiply two i16 in Rust to form an i32 without overflowing?", "body": "<p>You can cast them both to <code>i32</code> before addition.</p>\n\n<pre><code>let c: i32 = (a as i32) + (b as i32); \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "reply_to_user": {"reputation": 24901, "user_id": 198927, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/eExki.jpg?s=128&g=1", "display_name": "Petrus Theron", "link": "https://stackoverflow.com/users/198927/petrus-theron"}, "edited": false, "score": 1, "creation_date": 1563707575, "post_id": 57132489, "comment_id": 100781409, "body": "@PetrusTheron: Not really, it will generate exactly the same code. The idea is that Rust relies heavily in type inference, so if in the future your types change so that the casts may overflow, then this code will fail to compile."}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 2, "creation_date": 1563784765, "post_id": 57132489, "comment_id": 100799405, "body": "Note that an overflow in typical integer addition only panics when compiled in debug mode."}, {"owner": {"reputation": 161, "user_id": 4471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d518fc9576bc596e4a4e5fed6849288?s=128&d=identicon&r=PG&f=1", "display_name": "lights0123", "link": "https://stackoverflow.com/users/4471524/lights0123"}, "edited": false, "score": 0, "creation_date": 1563850967, "post_id": 57132489, "comment_id": 100827142, "body": "&quot;If what you want is wrapping arithmetic, just like in old C&quot;: <a href=\"https://godbolt.org/z/y4vIi1\" rel=\"nofollow noreferrer\">note that this is considered undefined behavior</a>."}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1563891285, "post_id": 57132489, "comment_id": 100845998, "body": "@E_net4: Not quite. Rust <i>the language</i> specifies that the result of an overflow is unspecified, and may be a panic. <code>rustc</code> <i>the compiler</i> allows to select one of two behaviors with a switch: panic or wrapping; furthermore, it also <i>defaults</i> to panicking in Debug and wrapping in Release, but the user can always change this. Ideally, <code>rustc</code> would want to <i>always</i> panic by default, however LLVM optimizes such code poorly, and the presence of panics hinders vectorization in general, so the default for Release had to be wrapping to match C performance <i>for now</i>."}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "reply_to_user": {"reputation": 161, "user_id": 4471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d518fc9576bc596e4a4e5fed6849288?s=128&d=identicon&r=PG&f=1", "display_name": "lights0123", "link": "https://stackoverflow.com/users/4471524/lights0123"}, "edited": false, "score": 0, "creation_date": 1563898498, "post_id": 57132489, "comment_id": 100850208, "body": "@lights0123: This is true only for <i>signed overflow</i>. In C, unisgned overflow is well defined. I hinted at that in my answer, but I didn&#39;t want to get into those details, as this is not a question about C but Rust."}, {"owner": {"reputation": 3201, "user_id": 5986907, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0521ce05a7fcb2580e4f513990a5a8c8?s=128&d=identicon&r=PG&f=1", "display_name": "joel", "link": "https://stackoverflow.com/users/5986907/joel"}, "edited": false, "score": 0, "creation_date": 1566675016, "post_id": 57132489, "comment_id": 101733620, "body": "I&#39;m surprised that rust defines <code>as</code> this way, since it seems to promote unexpected behaviour. Assuming it&#39;s needed by some, I would have expected <code>as</code> to refuse to compile if truncation or wrapping is required, and <code>from</code> to truncate/wrap"}], "tags": [], "owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "is_accepted": false, "score": 7, "last_activity_date": 1563837803, "last_edit_date": 1563837803, "creation_date": 1563706411, "answer_id": 57132489, "question_id": 57132438, "link": "https://stackoverflow.com/questions/57132438/how-to-add-or-multiply-two-i16-in-rust-to-form-an-i32-without-overflowing/57132489#57132489", "title": "How to add or multiply two i16 in Rust to form an i32 without overflowing?", "body": "<p>There are no integral promotions or implicit casts in Rust, so you must do all type conversions manually.</p>\n\n<p>For casts, you can use <code>&lt;value&gt; as &lt;type&gt;</code>. However, if the destination type is a superset of the original one and converting it cannot lose information (such as your case), you can self-document that by using <code>&lt;type&gt;::from</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let a: i16 = i16::max_value();\nlet b: i16 = i16::max_value();\nlet c: i32 = i32::from(a) + i32::from(b);\nassert_eq!(c, 65534);\n</code></pre>\n\n<p>This particular case cannot overflow, but for other cases you can prevent overflows using <code>{integer}::checked_*()</code> functions:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let a: i16 = i16::max_value();\nlet b: i16 = i16::max_value();\nlet c: Option&lt;i16&gt; = a.checked_add(b);\nassert_eq!(c, None); //overflow!\n</code></pre>\n\n<p>Note that overflowing an integer operation panics by default in debug builds.</p>\n\n<p>If what you want is wrapping arithmetic, just like in old C, you can use <code>{integer}::wraping_*()</code>, with the additional bonus that it works for signed as well as unsigned values.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let a: i16 = i16::max_value();\nlet b: i16 = i16::max_value();\nlet c: i16 = a.wrapping_add(b);\nassert_eq!(c, -2);\n</code></pre>\n"}], "owner": {"reputation": 24901, "user_id": 198927, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/eExki.jpg?s=128&g=1", "display_name": "Petrus Theron", "link": "https://stackoverflow.com/users/198927/petrus-theron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1563837803, "creation_date": 1563705949, "question_id": 57132438, "link": "https://stackoverflow.com/questions/57132438/how-to-add-or-multiply-two-i16-in-rust-to-form-an-i32-without-overflowing", "title": "How to add or multiply two i16 in Rust to form an i32 without overflowing?", "body": "<p>How to add or multiply two <code>i16</code> numbers in Rust into a larger <code>i32</code> without overflowing?</p>\n\n<pre><code>let a: i16 = i16::max_value();\nlet b: i16 = i16::max_value();\nlet c: i32 = a + b; // throws EO308 \"Expected `u32`, found `u16`\n</code></pre>\n"}, {"tags": ["rust", "pyo3"], "answers": [{"tags": [], "owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "is_accepted": true, "score": 2, "last_activity_date": 1563706052, "creation_date": 1563706052, "answer_id": 57132448, "question_id": 57132033, "link": "https://stackoverflow.com/questions/57132033/how-to-implement-trait-frompyobject-for-my-rust-struct/57132448#57132448", "title": "How to implement trait FromPyObject for my rust struct", "body": "<p>I don't know much about this crate but I think that you should take your objects by reference. Note that they are shared with the rest of the Python interpreter, so you can't actually own them.</p>\n\n<p>That is, just write:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[pyfunction]\nfn foo(a: &amp;PyMyStruct, b: &amp;PyMyStruct) -&gt; PyResult&lt;PyMyStruct&gt; {\n  // some high performance logic implemented in rust ...\n}\n</code></pre>\n\n<p>Or if you want mutable objects:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[pyfunction]\nfn foo(a: &amp;mut PyMyStruct, b: &amp;mut PyMyStruct) -&gt; PyResult&lt;PyMyStruct&gt; {\n  // some high performance logic implemented in rust ...\n}\n</code></pre>\n\n<p>This works because there are <a href=\"https://docs.rs/pyo3/0.7.0/pyo3/trait.FromPyObject.html\" rel=\"nofollow noreferrer\">these impls</a>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl&lt;'a, T&gt; FromPyObject&lt;'a&gt; for &amp;'a T where\n    T: PyTryFrom&lt;'a&gt;\nimpl&lt;'a, T&gt; FromPyObject&lt;'a&gt; for &amp;'a mut T where\n    T: PyTryFrom&lt;'a&gt;,\n</code></pre>\n\n<p>and then this <a href=\"https://docs.rs/pyo3/0.7.0/pyo3/prelude/trait.PyTryFrom.html\" rel=\"nofollow noreferrer\">other one</a>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl&lt;'v, T&gt; PyTryFrom&lt;'v&gt; for T where\n    T: PyTypeInfo\n</code></pre>\n\n<p>What happens if you use the <code>&amp;mut</code> variant and you pass the same object twice to this function? Well, I'm not sure but skimming the code I guess that you get two <code>&amp;mut</code> references to the same object, and thus <em>undefined behavior</em>. If I were you, I'd use the non <code>mut</code> variant and use a <code>RefCell</code> if you actually want to change the object.</p>\n"}], "owner": {"reputation": 777, "user_id": 6863221, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh4.googleusercontent.com/-f5m1FK2hI1s/AAAAAAAAAAI/AAAAAAAAABw/o6L7n6Vydlw/photo.jpg?sz=128", "display_name": "Matthias", "link": "https://stackoverflow.com/users/6863221/matthias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 399, "favorite_count": 2, "accepted_answer_id": 57132448, "answer_count": 1, "score": 4, "last_activity_date": 1563706052, "creation_date": 1563702781, "question_id": 57132033, "link": "https://stackoverflow.com/questions/57132033/how-to-implement-trait-frompyobject-for-my-rust-struct", "title": "How to implement trait FromPyObject for my rust struct", "body": "<p>Consider a simple rust class exposed via pyo3 to python</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use pyo3::prelude::*;\n\n#[pyclass(name=MyClass)]\npub struct PyMyClass {\n  // Some fields\n}\n\n#[pymethods]\nimpl PyMyStruct {\n  #[new]\n  fn py_new(obj: PyRawObject) {\n    obj.init({\n      PyMyStruct {\n        // ...\n      }\n    });\n  }\n}\n</code></pre>\n\n<p>now there is a function which should be called with two of this structs from python in that manner:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>a = MyStruct()\nb = MyStruct()\n\nc = foo(a,b)\n</code></pre>\n\n<p>Therefore one defines </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[pyfunction]\nfn foo(a: PyMyStruct, b: PyMyStruct) -&gt; PyResult&lt;PyMyStruct&gt; {\n  // some high performance logic implemented in rust ...\n}\n</code></pre>\n\n<p>Now the compiler claims <code>PyMyStruct</code> should implement the trait <code>FromPyObject</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl FromPyObject&lt;'_&gt; for PyMyStruct {\n    fn extract(ob: &amp;'_ PyAny) -&gt;PyResult&lt;Self&gt; {\n        // I dont know what to do here :(\n    }\n}\n</code></pre>\n\n<p>But I dont know how to retrieve an instance, pointer or whatever of <code>PyMyStruct</code> from <code>PyAny</code>...\nCan someone help me?</p>\n"}, {"tags": ["rust", "tuples", "destructuring"], "answers": [{"tags": [], "owner": {"reputation": 530, "user_id": 8807809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6150c2b1e72864800de8df5a7afff2f3?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin W Matthews", "link": "https://stackoverflow.com/users/8807809/kevin-w-matthews"}, "is_accepted": false, "score": 3, "last_activity_date": 1563660301, "creation_date": 1563660301, "answer_id": 57128935, "question_id": 57128842, "link": "https://stackoverflow.com/questions/57128842/how-are-tuples-destructured-into-references/57128935#57128935", "title": "How are Tuples destructured into references?", "body": "<p>The compiler is helping us using <a href=\"https://rust-lang.github.io/rfcs/2005-match-ergonomics.html\" rel=\"nofollow noreferrer\">match ergonomics</a>. Match ergonomics applies to tuple destructuring and the <code>match</code> expression; we'll look at the case of the <code>match</code> expression first.</p>\n\n<p>Match ergonomics simplifies how Rust binds variables when a <em>reference</em> is matched to a <em>non-reference pattern</em>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let x = Some(42);\nlet x_ref = &amp;x;\n\nmatch x_ref { // &lt;-- reference match expression: `x_ref`\n    Some(a) =&gt; {}, // &lt;-- non-reference pattern: `Some(a)`\n    None =&gt; {},\n}\n</code></pre>\n\n<p>Older version of the Rust compiler didn't allow this. Instead, one had to either specify references (<code>&amp;</code>) in the pattern:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// Old Rust\nmatch x_ref {\n    &amp;Some(a) =&gt; {},\n    &amp;None =&gt; {},\n}\n</code></pre>\n\n<p>or dereference before matching:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// Old Rust\nmatch *x_ref {\n    Some(a) =&gt; {},\n    None =&gt; {},\n}\n</code></pre>\n\n<p>Notice that <code>a</code> owns the <code>Option</code>'s inner value, which is problematic for non-<code>Copy</code> types. To avoid this, one also had to borrow the inner value. This is done by binding <code>a</code> as a reference using the <code>ref</code> keyword:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// Old Rust\nlet x = Some(Box::new(42));\nlet x_ref = &amp;x;\n\nmatch x_ref {\n    &amp;Some(ref a) =&gt; {},\n    &amp;None =&gt; {},\n}\n</code></pre>\n\n<p>or</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// Old Rust\nmatch *x_ref {\n    Some(ref a) =&gt; {},\n    None =&gt; {},\n}\n</code></pre>\n\n<p>Rust's new match ergonomics allow a simplified version:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// New Rust\nmatch x_ref {\n    Some(a) =&gt; {\n        // x_ref is automatically dereferenced\n        // a is automatically bound as a reference\n    },\n    None =&gt; {},\n}\n</code></pre>\n\n<p>for both <code>Copy</code> and non-<code>Copy</code> types.</p>\n\n<p>Applying this to tuple destructuring,</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let pair = Arc::new((Mutex::new(false), Condvar::new()));\nlet (lock, cvar) = &amp;*pair;\n//                 ^^^^^^ reference match expression\n//  ^^^^^^^^^^^^ non-reference pattern\n</code></pre>\n\n<ul>\n<li><code>*pair</code> is a tuple</li>\n<li><code>&amp;*pair</code> is a reference to a tuple</li>\n<li>Both <code>lock</code> and <code>cvar</code> are bound as references</li>\n</ul>\n\n<p>Also see these Stack Overflow posts on:</p>\n\n<ul>\n<li>the <a href=\"https://stackoverflow.com/q/55130932/8807809\">matching and the ref keyword</a></li>\n<li><a href=\"https://stackoverflow.com/q/43370054/8807809\">pattern matching on a reference or a dereferenced value</a></li>\n<li><a href=\"https://stackoverflow.com/q/56511328/8807809\">binding during pattern matching</a></li>\n</ul>\n"}], "owner": {"reputation": 530, "user_id": 8807809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6150c2b1e72864800de8df5a7afff2f3?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin W Matthews", "link": "https://stackoverflow.com/users/8807809/kevin-w-matthews"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 267, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1563660301, "creation_date": 1563659404, "question_id": 57128842, "link": "https://stackoverflow.com/questions/57128842/how-are-tuples-destructured-into-references", "title": "How are Tuples destructured into references?", "body": "<p>I'm looking at the <a href=\"https://doc.rust-lang.org/std/sync/struct.Condvar.html#examples\" rel=\"nofollow noreferrer\"><code>Condvar</code> example</a> and am curious how the tuples <code>pair</code> and <code>pair2</code> are destructured:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let pair = Arc::new((Mutex::new(false), Condvar::new()));\nlet pair2 = pair.clone();\n// ...\n\nthread::spawn(move|| {\n    let &amp;(ref lock, ref cvar) = &amp;*pair2;\n    // ...\n}\n</code></pre>\n\n<p>Removing the <code>&amp;</code> from <code>pair2</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let &amp;(ref lock, ref cvar) = *pair2;\n</code></pre>\n\n<p>gives a compiler error as I expected:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>11 |     let &amp;(ref lock, ref cvar) = *pair2;\n   |         ^^^^^^^^^^^^^^^^^^^^^ expected tuple, found reference\n   |\n   = note: expected type `(std::sync::Mutex&lt;bool&gt;, std::sync::Condvar)`\n              found type `&amp;_`\n</code></pre>\n\n<p>However, it seems to compile and run fine if the <code>&amp;</code> around the tuple is removed:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let (ref lock, ref cvar) = &amp;*pair2;\n</code></pre>\n\n<p>or if both of the <code>&amp;</code>'s are removed:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let (ref lock, ref cvar) = *pair2;\n</code></pre>\n\n<p>or even with</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let (lock, cvar) = &amp;*pair2;\n</code></pre>\n\n<p>Is the compiler is helping us in the latter cases?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563657078, "post_id": 57128565, "comment_id": 100773579, "body": "you create a <code>String</code> just return it why do you want return a <code>&amp;str</code>"}, {"owner": {"reputation": 65, "user_id": 5677043, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VmaHy979Pfc/AAAAAAAAAAI/AAAAAAAAAB8/szgMpMawrak/photo.jpg?sz=128", "display_name": "Ruixing Wang", "link": "https://stackoverflow.com/users/5677043/ruixing-wang"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563657490, "post_id": 57128565, "comment_id": 100773675, "body": "@Stargateur well.. it&#39;s a homework and that is the required type.  I tried to change it to String and it has the same problem, so doesn&#39;t matter.."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563658924, "post_id": 57128565, "comment_id": 100773971, "body": "if it&#39;s a homework, it would help to put it in your question."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1563658983, "post_id": 57128565, "comment_id": 100773991, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/29428227/return-local-string-as-a-slice-str\">Return local String as a slice (&amp;str)</a>"}, {"owner": {"reputation": 65, "user_id": 5677043, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VmaHy979Pfc/AAAAAAAAAAI/AAAAAAAAAB8/szgMpMawrak/photo.jpg?sz=128", "display_name": "Ruixing Wang", "link": "https://stackoverflow.com/users/5677043/ruixing-wang"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563659563, "post_id": 57128565, "comment_id": 100774101, "body": "Thanks, now I understand. I would have to return the slice of the input <code>s</code> given the function definition is fixed to be <code>&amp;str -&gt; Option(&amp;str)</code>.."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1563659691, "post_id": 57128565, "comment_id": 100774118, "body": "well, you must avoid to create a string, you must use the str in parameter."}], "answers": [{"tags": [], "owner": {"reputation": 73287, "user_id": 3874623, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6df0aa136ee42f4ea24ef08b7c348e7a?s=128&d=identicon&r=PG&f=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/3874623/mark"}, "is_accepted": false, "score": 2, "last_activity_date": 1563663429, "creation_date": 1563663429, "answer_id": 57129189, "question_id": 57128565, "link": "https://stackoverflow.com/questions/57128565/borrowed-value-does-not-live-long-enough-str-optionstr/57129189#57129189", "title": "Borrowed value does not live long enough (&amp;str -&gt; Option&lt;&amp;str&gt;)", "body": "<p>I think this would make a lot more sense if you kept track of indexes into the passed in string and then returned a slice of that string with:</p>\n\n<pre><code>s.get(start_index..stop_index)\n</code></pre>\n\n<p>Rust makes this a little tricky because you need to index the bytes of utf-8 characters properly, but you don't just want the longest string of bytes, you want the longest run of characters.</p>\n\n<p>Still, I think it's easier to understand and cleaner to do something like this: Keep track of the length of the current longest sequence and start and stop bytes. Keep a character count of the current run of characters, then use <code>get()</code> to return the slice. This avoids the problem of making a new string in the function.</p>\n\n<pre><code>pub fn longest_sequence(s: &amp;str) -&gt; Option&lt;&amp;str&gt; {\n    if s.is_empty() {\n        return None\n    }\n\n    let mut chars = s.char_indices();\n    let (mut char_start, mut curr) = chars.next().unwrap(); // get initial character\n    let mut longest = (char_start,curr.len_utf8(), 1);      // (start(byte), stop(byte), len(characters)\n    let mut curr_char_count = 1;                            // number of chars in current run\n\n    for (idx, c) in chars {\n        match c {\n            c if c == curr =&gt; {\n                curr_char_count += 1;\n                if curr_char_count &gt; longest.2 {\n                    longest = (char_start, idx + c.len_utf8(), curr_char_count);\n                }\n            }\n            n =&gt; {\n                curr = n;\n                curr_char_count = 1;\n                char_start = idx;\n            }\n        }\n    }\n    s.get(longest.0..longest.1)\n}\n</code></pre>\n\n<p>This will allow non-ascii strings to work and still return a slice of the original string:</p>\n\n<pre><code>fn main() {     \n    let s= longest_sequence(\"BB\ud83d\udca3\ud83d\udca3\ud83d\udca3\ud83d\udca3mmm!\");\n    println!(\"{:?}\", s);\n\n    // Some(\"\ud83d\udca3\ud83d\udca3\ud83d\udca3\ud83d\udca3\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 183, "user_id": 5114106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f77c14990b0d85b695f1ec0134140ef2?s=128&d=identicon&r=PG", "display_name": "Technocoder", "link": "https://stackoverflow.com/users/5114106/technocoder"}, "is_accepted": false, "score": 1, "last_activity_date": 1563697842, "creation_date": 1563697842, "answer_id": 57131566, "question_id": 57128565, "link": "https://stackoverflow.com/questions/57128565/borrowed-value-does-not-live-long-enough-str-optionstr/57131566#57131566", "title": "Borrowed value does not live long enough (&amp;str -&gt; Option&lt;&amp;str&gt;)", "body": "<p>The fundamental problem is you're creating a heap allocated string in the middle of the function, and you're returning a reference to the string. When the function exits, any values that were owned by the function (such as the string) will be dropped (and the reference will be invalidated). Rust just saved you from a memory error!</p>\n\n<p>For example, this line here:</p>\n\n<p><code>let string = charstr.repeat(max_occ);</code></p>\n\n<p>repeats a character and creates a string but it needs somewhere to put the string. Hence it creates a string on the heap. However, the string must be deallocated at some point (otherwise you'll have a memory leak!) so Rust has the concept of ownership. Any values that are owned by the current function must also be dropped or deallocated by the function.</p>\n\n<p>Here you are taking a <em>borrow</em> of the string:</p>\n\n<p><code>let strr = string.as_str();</code></p>\n\n<p>Borrows do not transfer ownership. Hence, the string is still owned by the current function. This explains the error message: <code>error[E0597]: `string` does not live long enough</code>. You can't return the borrow because the owned value gets dropped at the end of the function (or more specifically, the lifetime of the borrow is only for the current function).</p>\n\n<p>There are two ways to fix this:</p>\n\n<ol>\n<li>Return the string directly:</li>\n</ol>\n\n<p><code>pub fn longest_sequence(s: &amp;str) -&gt; Option&lt;String&gt;</code></p>\n\n<p>If you return <code>String</code> instead of <code>&amp;str</code>, you're transferring the ownership of the string to the caller.</p>\n\n<ol start=\"2\">\n<li>Return a borrow of the string in the function parameter</li>\n</ol>\n\n<p>You can modify the algorithm to take the indexes of the substring you want, and then return a slice of <code>s</code>. This is fine because the return value won't outlive any owned values. Specifically, it will have the same lifetime as <code>s</code>.</p>\n\n<p>Finally, if you have a variable of type <code>String</code> anywhere in the function, you'll generally have issues with lifetimes (with string processing anyway) when returning <code>&amp;str</code>.  </p>\n"}], "owner": {"reputation": 65, "user_id": 5677043, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-VmaHy979Pfc/AAAAAAAAAAI/AAAAAAAAAB8/szgMpMawrak/photo.jpg?sz=128", "display_name": "Ruixing Wang", "link": "https://stackoverflow.com/users/5677043/ruixing-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 338, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1563697842, "creation_date": 1563656478, "last_edit_date": 1563658990, "question_id": 57128565, "link": "https://stackoverflow.com/questions/57128565/borrowed-value-does-not-live-long-enough-str-optionstr", "title": "Borrowed value does not live long enough (&amp;str -&gt; Option&lt;&amp;str&gt;)", "body": "<p>It's a piece of homework to get the longest substring of consecutive equal characters.</p>\n\n<pre><code>pub fn longest_sequence(s: &amp;str) -&gt; Option&lt;&amp;str&gt; {\n    let s_len = s.len();\n    if s_len == 0 {\n        return None\n    }\n    let mut cur_char = s.chars().nth(0);\n    let mut cur_occ = 0;\n    let mut max_char = s.chars().nth(0);\n    let mut max_occ = 0;\n\n    for i in 0..s_len {\n        let c = s.chars().nth(i);\n        if c == cur_char {\n            cur_occ = cur_occ + 1;\n        } else {\n            if cur_occ &gt; max_occ {\n                max_occ = cur_occ;\n                max_char = cur_char;\n            }\n            cur_char = c.clone();\n            cur_occ = 1;\n        }\n    }\n    if cur_occ &gt; max_occ {\n        max_occ = cur_occ;\n        max_char = cur_char;\n    }\n    let cr = max_char.unwrap();\n    let charstr = cr.to_string();\n    let string = charstr.repeat(max_occ);\n    let strr = string.as_str();\n    let some = Some(strr.clone());\n    println!(\"in {:?}\",some);\n    some // Compilation error\n//  None  // if returning None, then it compiles and runs as expected\n}\n\nfn main () {\n    println!(\"out {:?}\",longest_sequence(&amp;\"aaabbbcccc\"));\n}\n</code></pre>\n\n<p>I expected the output to be </p>\n\n<pre><code>in Some(\"cccc\")\nout Some(\"cccc\")\n</code></pre>\n\n<p>but got a compilation error. </p>\n\n<pre><code>error[E0597]: `string` does not live long enough\n  --&gt; r.rs:31:16\n   |\n31 |     let strr = string.as_str();\n   |                ^^^^^^ borrowed value does not live long enough\n...\n35 | }\n   | - borrowed value only lives until here\n   |\nnote: borrowed value must be valid for the anonymous lifetime #1 defined on the function body at 1:1...\n  --&gt; r.rs:1:1\n   |\n1  | / pub fn longest_sequence(s: &amp;str) -&gt; Option&lt;&amp;str&gt; {\n2  | |     let s_len = s.len();\n3  | |     if s_len == 0 {\n4  | |         return None\n...  |\n34 | |     some\n35 | | }\n   | |_^\n\nerror: aborting due to previous error\n\n</code></pre>\n\n<p>If returning <code>None</code> instead of <code>some</code>, the code compiles and runs as you would expect:</p>\n\n<pre><code>in Some(\"cccc\")\nout None\n</code></pre>\n\n<p>I got confused because the error message is pointing to a line before this change..</p>\n\n<p>Can someone help? Thanks.</p>\n\n<p>P.S.: I changed it to record the start and end position indices, so that I can return <code>Some(&amp;s[start..end])</code>. I thought <code>s</code> should definitely have enough lifetime, and yeah it works! but I still want to know why the above implementation doesn't work..</p>\n"}, {"tags": ["error-handling", "rust"], "comments": [{"owner": {"reputation": 1925, "user_id": 2865757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dcfe7782349d59e50b1fa196f9c6669?s=128&d=identicon&r=PG&f=1", "display_name": "Zefick", "link": "https://stackoverflow.com/users/2865757/zefick"}, "edited": false, "score": 4, "creation_date": 1563652480, "post_id": 57128036, "comment_id": 100772710, "body": "If &quot;method can potentially panic if the slices are of two different lengths&quot; then obvious solution to avoid panic is to check sizes of slices before calling the method."}], "answers": [{"tags": [], "owner": {"reputation": 46, "user_id": 10781687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d177c1bad366f6d526bae5ab1099c44?s=128&d=identicon&r=PG&f=1", "display_name": "Robear Selwans", "link": "https://stackoverflow.com/users/10781687/robear-selwans"}, "is_accepted": false, "score": 0, "last_activity_date": 1563710204, "creation_date": 1563710204, "answer_id": 57132997, "question_id": 57128036, "link": "https://stackoverflow.com/questions/57128036/how-can-i-capture-whether-an-error-occurred-in-rusts-swap-with-slice-vec-meth/57132997#57132997", "title": "How can I capture whether an error occurred in Rust&#39;s swap_with_slice() vec method?", "body": "<p>This should work </p>\n\n<pre><code>let result = std::panic::catch_unwind(|| &lt;expected_to_panic_operation_here&gt;);\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 7786405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8fd4a9a68b261e23c1bca2d9842ef6e?s=128&d=identicon&r=PG&f=1", "display_name": "CollaborativeLearner", "link": "https://stackoverflow.com/users/7786405/collaborativelearner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563710204, "creation_date": 1563651909, "question_id": 57128036, "link": "https://stackoverflow.com/questions/57128036/how-can-i-capture-whether-an-error-occurred-in-rusts-swap-with-slice-vec-meth", "title": "How can I capture whether an error occurred in Rust&#39;s swap_with_slice() vec method?", "body": "<p>The documentation tells me that the <code>swap_with_slice()</code> method can potentially panic if the slices are of two different lengths. I am writing a parser which deals with data coming across TCP. My encoding scheme is such that the following <em>should</em> never panic, unless it is a malformed request. In this case, I don't want my programme to crash, but instead handle the error. How do I capture whether <code>swap_with_slice</code> panics or not? Since it itself does not return a Result?</p>\n\n<pre><code>let mut bytes_id = [0; 16];\nbytes_id.swap_with_slice(&amp;mut self.raw_bytes[Headers::MessageLength as usize..Headers::Data as usize]);\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 534, "user_id": 3882704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e5f3c0ad59d68324bd15384465a8f17?s=128&d=identicon&r=PG", "display_name": "Kellen", "link": "https://stackoverflow.com/users/3882704/kellen"}, "edited": false, "score": 0, "creation_date": 1563659897, "post_id": 57127505, "comment_id": 100774155, "body": "Is <code>pub mod file2</code> in <code>lib.rs</code>?"}, {"owner": {"reputation": 1098, "user_id": 989615, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bdaff808be1ee4e0378cda9412401af2?s=128&d=identicon&r=PG", "display_name": "krojew", "link": "https://stackoverflow.com/users/989615/krojew"}, "reply_to_user": {"reputation": 534, "user_id": 3882704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e5f3c0ad59d68324bd15384465a8f17?s=128&d=identicon&r=PG", "display_name": "Kellen", "link": "https://stackoverflow.com/users/3882704/kellen"}, "edited": false, "score": 0, "creation_date": 1563688019, "post_id": 57127505, "comment_id": 100777558, "body": "@Kellen tried it, but the error persists."}], "answers": [{"comments": [{"owner": {"reputation": 1098, "user_id": 989615, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bdaff808be1ee4e0378cda9412401af2?s=128&d=identicon&r=PG", "display_name": "krojew", "link": "https://stackoverflow.com/users/989615/krojew"}, "edited": false, "score": 1, "creation_date": 1563684514, "post_id": 57129432, "comment_id": 100777134, "body": "I&#39;ve been looking for the exact example as in my case in the book, but can&#39;t find it. Your examples are not quite the same and I suspect this might be the problem. Note that you&#39;re using mod.rs and not a named module file in src. Also, you&#39;re not importing some_code in this file."}, {"owner": {"reputation": 534, "user_id": 3882704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e5f3c0ad59d68324bd15384465a8f17?s=128&d=identicon&r=PG", "display_name": "Kellen", "link": "https://stackoverflow.com/users/3882704/kellen"}, "reply_to_user": {"reputation": 1098, "user_id": 989615, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bdaff808be1ee4e0378cda9412401af2?s=128&d=identicon&r=PG", "display_name": "krojew", "link": "https://stackoverflow.com/users/989615/krojew"}, "edited": false, "score": 1, "creation_date": 1563699060, "post_id": 57129432, "comment_id": 100779523, "body": "@krojew The reason for the difference is that @eric is using the older Rust 2015 module naming. <code>mod.rs</code> in <code>src&#47;core</code> is the equivalent to <code>src&#47;core.rs</code> in Rust 2018"}], "tags": [], "owner": {"reputation": 900, "user_id": 6359394, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HV0nz.jpg?s=128&g=1", "display_name": "eric", "link": "https://stackoverflow.com/users/6359394/eric"}, "is_accepted": false, "score": 2, "last_activity_date": 1563666986, "last_edit_date": 1592644375, "creation_date": 1563666986, "answer_id": 57129432, "question_id": 57127505, "link": "https://stackoverflow.com/questions/57127505/rust-importing-root-file-to-a-module/57129432#57129432", "title": "Rust - importing root file to a module", "body": "<p>Beginning new things is fun (and can be difficult). Now, your description of the problem you are having makes helping you kind of difficult. But, when you're starting out it can be hard to help yourself help-yourself. Check out how to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">MVCE</a>.</p>\n<p>Also check out what the <a href=\"https://doc.rust-lang.org/book/ch07-00-managing-growing-projects-with-packages-crates-and-modules.html\" rel=\"nofollow noreferrer\">Rust Book</a> says about <code>crate</code>s, modules, paths, and <code>use</code>. And, join the <a href=\"https://users.rust-lang.org/\" rel=\"nofollow noreferrer\">Rust Community</a> if you want rust-specific help.</p>\n<p>Okay, I'm making some assumptions about your code structure because you've left out a good deal of information.</p>\n<p>So, if you run <code>cargo new app</code> you'll end up with a project folder containing a <code>src/</code> directory.</p>\n<p>I've added some files/directories and the result looks like this:</p>\n<pre><code>src/\n\u251c\u2500\u2500 core                    # a directory/folder\n\u2502   \u251c\u2500\u2500 mod.rs        \n\u2502   \u2514\u2500\u2500 some_other_code.rs  # a &quot;file&quot;\n\u251c\u2500\u2500 main.rs                 \n\u2514\u2500\u2500 some_code.rs            # another &quot;file&quot;\n</code></pre>\n<p>In <code>main.rs</code>:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>/// Module declarations.\nmod core;\nmod some_code;\n\n/// Bring paths into scope with the `use`\n/// keyword keyword.\nuse self::some_code::hello;\n// The above can also be written as:\n// use some_code::hello;\n// why?\n\n/// An absolute path starts from a crate root by\n/// using a crate name or a literal `crate`.\nuse crate::core::greeting;\n\nconst JUPITER: &amp;str = &quot;jupiter&quot;;\n\nfn main() {\n    hello();\n    greeting();\n\n    // A relative path starts from the current\n    // module and uses self, super, or an identifier\n    // in the current module.\n    use self::another_mod;\n    // You can also check if the following would work:\n    // use crate::another_mod;\n    // Or even,\n    // use another_mod;\n    // why?\n    another_mod::jupiter();\n}\n\nmod another_mod {\n    use super::*;\n\n    pub fn jupiter() {\n        println!(&quot;hello, {}!&quot;, JUPITER);\n    }\n}\n</code></pre>\n<p>In <code>some_code.rs</code>:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn hello() {\n    println!(&quot;mars&quot;);\n}\n</code></pre>\n<p>In <code>core/mod.rs</code>:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>/// Module declaration.\npub mod some_other_code;\n\n/// Re-exporting the greeting function.\npub use some_other_code::greeting;\n</code></pre>\n<p>In <code>core/some_other_code.rs</code>:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>use crate::some_code;\n\npub fn greeting() {\n    println!(&quot;hello&quot;);\n    some_code::hello();\n}\n</code></pre>\n<p>To give you an idea of what you'll find in the <strong>Rust Book</strong>:</p>\n<blockquote>\n<p>Packages: A Cargo feature that lets you build, test, and share crates</p>\n<p>Crates: A tree of modules that produces a library or executable</p>\n<p>Modules and use: Let you control the organization, scope, and privacy of paths</p>\n<p>Paths: A way of naming an item, such as a struct, function, or module</p>\n</blockquote>\n<p>And,</p>\n<blockquote>\n<p><code>src/main.rs</code> and <code>src/lib.rs</code> are called <strong>crate roots</strong>. The reason for their name is that the contents of either of these two files <strong>form a module named crate at the root of the crate\u2019s module structure</strong>, known as the module tree.</p>\n</blockquote>\n"}], "owner": {"reputation": 1098, "user_id": 989615, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/bdaff808be1ee4e0378cda9412401af2?s=128&d=identicon&r=PG", "display_name": "krojew", "link": "https://stackoverflow.com/users/989615/krojew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1710, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1563666986, "creation_date": 1563647173, "question_id": 57127505, "link": "https://stackoverflow.com/questions/57127505/rust-importing-root-file-to-a-module", "title": "Rust - importing root file to a module", "body": "<p>I'm starting to learn Rust and I stumbled into a weird import problem. I have an example directory structure:</p>\n\n<pre><code>example_mod\n    file1.rs\nexample_mod.rs\nfile2.rs\n</code></pre>\n\n<p>I would like to import the contents of file2.rs into example_mod.rs. I tried:</p>\n\n<pre><code>use crate::file2;\nuse super::file2;\nuse file2;\n</code></pre>\n\n<p>And each time I get the <code>use of undeclared type or module file2</code> error. How such sibling module should be imported?</p>\n"}, {"tags": ["arrays", "rust"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1563636406, "post_id": 57126013, "comment_id": 100769049, "body": "Is <i>&quot;without using mutable variables&quot;</i> an artificial constraint? Creating the array and then doing <code>for v in &amp;mut w {</code> or <code>for v in w.iter_mut()</code> would appear to be the usual way of doing this. See also: <a href=\"https://stackoverflow.com/q/26185618/1233251\">stackoverflow.com/q/26185618/1233251</a>"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1563638754, "post_id": 57126013, "comment_id": 100769599, "body": "Of course you can limit the mutability to a nested scope: <code>let w = { let mut array = ...; ...; array };</code>."}, {"owner": {"reputation": 73287, "user_id": 3874623, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6df0aa136ee42f4ea24ef08b7c348e7a?s=128&d=identicon&r=PG&f=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/3874623/mark"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1563652497, "post_id": 57126013, "comment_id": 100772714, "body": "@E_net4 does <code>for v in &amp;mut w {</code> work if <code>w</code> is not declated as mutable to begin with?"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1563652993, "post_id": 57126013, "comment_id": 100772803, "body": "it does not without declaring <code>w</code> as mutable, thus why I&#39;m asking."}, {"owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1563663730, "post_id": 57126013, "comment_id": 100774835, "body": "@E_net4 Yes. I am avoiding using mutable variables."}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1563672626, "post_id": 57126013, "comment_id": 100775826, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/26435046/how-do-i-create-and-initialize-an-immutable-array\">How do I create and initialize an immutable array?</a>"}, {"owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1563724512, "post_id": 57126013, "comment_id": 100785506, "body": "@E_net4 Not a duplicate. The questions are distinctly different."}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1563727331, "post_id": 57126013, "comment_id": 100786064, "body": "What about this one? <a href=\"https://stackoverflow.com/q/26757355/1233251\">stackoverflow.com/q/26757355/1233251</a>"}], "answers": [{"tags": [], "owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "is_accepted": false, "score": -1, "last_activity_date": 1563663932, "creation_date": 1563663932, "answer_id": 57129229, "question_id": 57126013, "link": "https://stackoverflow.com/questions/57126013/how-to-populate-an-array-without-using-mut/57129229#57129229", "title": "How to populate an array without using mut?", "body": "<p>The answer is <strong>NO</strong>.                                  \u2800          </p>\n"}, {"tags": [], "owner": {"reputation": 90851, "user_id": 27009, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f0a29af415477aa8c498a4f41ffe6640?s=128&d=identicon&r=PG", "display_name": "Kornel", "link": "https://stackoverflow.com/users/27009/kornel"}, "is_accepted": false, "score": 0, "last_activity_date": 1563955871, "creation_date": 1563955871, "answer_id": 57178217, "question_id": 57126013, "link": "https://stackoverflow.com/questions/57126013/how-to-populate-an-array-without-using-mut/57178217#57178217", "title": "How to populate an array without using mut?", "body": "<p>You can't. </p>\n\n<p><code>Iterator</code> can't guarantee any specific length at compile time, so <code>.collect()</code> can't produce fixed-size arrays.</p>\n\n<p>You can do:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let w = w;\n</code></pre>\n\n<p>to recreate the binding as immutable afterwards, or move the initialization to a helper function.</p>\n"}], "owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 188, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1563955871, "creation_date": 1563635679, "last_edit_date": 1563724468, "question_id": 57126013, "link": "https://stackoverflow.com/questions/57126013/how-to-populate-an-array-without-using-mut", "title": "How to populate an array without using mut?", "body": "<p>If I wanted to populate a list of numbers, I can use a vector, and hence the heap, by doing this:</p>\n\n<pre><code>let w = (0..1024).collect::&lt;Vec&lt;_&gt;&gt;();\n</code></pre>\n\n<p>But, if I wanted to avoid the heap I have to use an array. To use an array, I have to use a loop which means I must have a mutable variable:</p>\n\n<pre><code>let mut w = [0u32; 1024];\nfor i in 0..1024 {\n    w[i] = i as u32;\n}\n</code></pre>\n\n<p>Is it possible to populate an array without using mutable variables?</p>\n\n<hr>\n\n<p>This question has been flagged as a dup. I'm not sure how this can possibly be confused. </p>\n\n<p>\"How to populate an array without using mut?\" means how do I populate an array without using a mutable variable to do so. Any <code>mut</code>, not just the array variable itself.</p>\n\n<p>\"How do I create and initialize an immutable array?\" means how do I create an immutable array.</p>\n"}, {"tags": ["rust", "substrate", "parity-io"], "comments": [{"owner": {"reputation": 8871, "user_id": 1260906, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/aPM5A.png?s=128&g=1", "display_name": "Afr", "link": "https://stackoverflow.com/users/1260906/afr"}, "edited": false, "score": 0, "creation_date": 1564311562, "post_id": 57124447, "comment_id": 100981735, "body": "You tagged your question with <code>substrate</code>, would you be interested in a dedicated Stack Exchange Q&amp;A site for Substrate, Polkadot, et al. -- check out the <a href=\"https://area51.stackexchange.com/proposals/122626/substrate?referrer=NTUwMTkxYjJjOTJiNjE0YzMxYjgwMGNkZmFlYzdhZTczYjk1ZWY3ZGI4NzJmODUwN2RlYTQ2MTNjZTdkOTZhMAzuL-zybtPN9CHzwE-WUdvBC8WxvPG46b4ayadke6kG0\">Area51 Substrate Proposal</a>"}], "answers": [{"tags": [], "owner": {"reputation": 9375, "user_id": 1396977, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PylBh.jpg?s=128&g=1", "display_name": "Shawn Tabrizi", "link": "https://stackoverflow.com/users/1396977/shawn-tabrizi"}, "is_accepted": true, "score": 3, "last_activity_date": 1563625876, "last_edit_date": 1563625876, "creation_date": 1563624147, "answer_id": 57124506, "question_id": 57124447, "link": "https://stackoverflow.com/questions/57124447/how-to-disambiguate-between-traits-with-the-same-name/57124506#57124506", "title": "How to disambiguate between traits with the same name?", "body": "<p>Rather than use <code>T::Balance</code> here, you need to be more specific for the Rust compiler.</p>\n\n<p>You can do <code>&lt;T as balances::Trait&gt;::Balance</code> or <code>&lt;T as assets::Trait&gt;::Balance</code> to specify which \"Balance\" you actually want to use.</p>\n\n<p>Let me know if this helps!</p>\n"}], "owner": {"reputation": 168, "user_id": 9344712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fKjrd.png?s=128&g=1", "display_name": "Lsaether", "link": "https://stackoverflow.com/users/9344712/lsaether"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 57124506, "answer_count": 1, "score": 0, "last_activity_date": 1563628279, "creation_date": 1563623648, "last_edit_date": 1563628279, "question_id": 57124447, "link": "https://stackoverflow.com/questions/57124447/how-to-disambiguate-between-traits-with-the-same-name", "title": "How to disambiguate between traits with the same name?", "body": "<p>I am trying to use both the Assets module and Balances module in my runtime. They both export the Trait <code>T::Balance</code>. When I bring the Assets module in scope of my trait like so:</p>\n\n<pre><code>pub trait Trait: assets::Trait + balances::Trait {}\n</code></pre>\n\n<p>I get the following error: </p>\n\n<pre><code>error[E0221]: ambiguous associated type `Balance` in bounds of `T`\n   --&gt; /home/volt/workspaces/lsaether/vyzer/runtime/src/markets.rs:124:42\n    |\n124 |         ValidityBond get(validity_bond): T::Balance;\n    |                                          ^^^^^^^^^^ ambiguous associated type `Balance`\n    |\nnote: associated type `T` could derive from `srml_assets::Trait`\n   --&gt; /home/volt/workspaces/lsaether/vyzer/runtime/src/markets.rs:124:42\n    |\n124 |         ValidityBond get(validity_bond): T::Balance;\n    |                                          ^^^^^^^^^^\nnote: associated type `T` could derive from `srml_balances::Trait`\n   --&gt; /home/volt/workspaces/lsaether/vyzer/runtime/src/markets.rs:124:42\n    |\n124 |         ValidityBond get(validity_bond): T::Balance;\n    |                                          ^^^^^^^^^^\n\n</code></pre>\n"}, {"tags": ["database", "multithreading", "sqlite", "rust", "locking"], "comments": [{"owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 0, "creation_date": 1563620872, "post_id": 57123453, "comment_id": 100765654, "body": "I&#39;m not 100% sure about the SQLite architecture (<a href=\"https://www.sqlite.org/lockingv3.html\" rel=\"nofollow noreferrer\">sqlite.org/lockingv3.html</a>), but have you tried performing your <code>inser_into</code> and <code>delete</code> inside transactions? It&#39;s a long shot. SQLite isn&#39;t the best choice for high concurrency; you could circumvent it by having a SQL &quot;worker&quot; thread that aggregates SQL events concurrently but executes them sequentially."}, {"owner": {"reputation": 8448, "user_id": 995246, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/0d956964e915c9b3efd2731abb7371b0?s=128&d=identicon&r=PG&f=1", "display_name": "gliderkite", "link": "https://stackoverflow.com/users/995246/gliderkite"}, "reply_to_user": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 0, "creation_date": 1563621707, "post_id": 57123453, "comment_id": 100765823, "body": "@Martin Gallagher Unfortunately, using transactions does not solve the issue."}], "answers": [{"comments": [{"owner": {"reputation": 1067, "user_id": 1783732, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b2d57b42782b30f9c394b5ee213cc7c2?s=128&d=identicon&r=PG", "display_name": "user1783732", "link": "https://stackoverflow.com/users/1783732/user1783732"}, "edited": false, "score": 0, "creation_date": 1618870855, "post_id": 57717533, "comment_id": 118729412, "body": "For some reason <code>conn.batch_execute</code> is not available in diesel 1.4.5 when I am trying this solution. Maybe I am missing something?"}, {"owner": {"reputation": 86, "user_id": 7989982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb118bc4c422c73656edabf301f30d22?s=128&d=identicon&r=PG&f=1", "display_name": "markazmierczak", "link": "https://stackoverflow.com/users/7989982/markazmierczak"}, "reply_to_user": {"reputation": 1067, "user_id": 1783732, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/b2d57b42782b30f9c394b5ee213cc7c2?s=128&d=identicon&r=PG", "display_name": "user1783732", "link": "https://stackoverflow.com/users/1783732/user1783732"}, "edited": false, "score": 0, "creation_date": 1618983360, "post_id": 57717533, "comment_id": 118763789, "body": "@user1783732 you are missing <code>use diesel::connection::SimpleConnection;</code> trait import (omitted for clarity)."}], "tags": [], "owner": {"reputation": 86, "user_id": 7989982, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb118bc4c422c73656edabf301f30d22?s=128&d=identicon&r=PG&f=1", "display_name": "markazmierczak", "link": "https://stackoverflow.com/users/7989982/markazmierczak"}, "is_accepted": true, "score": 7, "last_activity_date": 1604213960, "last_edit_date": 1604213960, "creation_date": 1567111493, "answer_id": 57717533, "question_id": 57123453, "link": "https://stackoverflow.com/questions/57123453/how-to-use-diesel-with-sqlite-connections-and-avoid-database-is-locked-type-of/57717533#57717533", "title": "How to use Diesel with SQLite connections and avoid `database is locked` type of errors", "body": "<p>Recently I also stumbled onto this problem. Here's what I found.</p>\n<p>SQLite does <strong>not</strong> support multiple writers.</p>\n<p>From documentation:</p>\n<blockquote>\n<p>When SQLite tries to access a file that is locked by another process, the default behavior is to return SQLITE_BUSY.</p>\n</blockquote>\n<p>So how to get around this limitation ? There are two solutions I see.</p>\n<h2>Busy timeout</h2>\n<p>You can retry the query multiple times until lock has been acquired.\nIn fact SQLite provides <a href=\"https://www.sqlite.org/pragma.html#pragma_busy_timeout\" rel=\"nofollow noreferrer\">built-in mechanism</a>.\nYou can instruct the SQLite to try lock the database multiple times.</p>\n<p>Now the only thing you need is to somehow pass this pragma to SQLite.\nFortunately <code>diesel::r2d2</code> gives an easy way to pass initial setup for a newly established connection:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Debug)]\npub struct ConnectionOptions {\n    pub enable_wal: bool,\n    pub enable_foreign_keys: bool,\n    pub busy_timeout: Option&lt;Duration&gt;,\n}\n\nimpl diesel::r2d2::CustomizeConnection&lt;SqliteConnection, diesel::r2d2::Error&gt;\n    for ConnectionOptions\n{\n    fn on_acquire(&amp;self, conn: &amp;mut SqliteConnection) -&gt; Result&lt;(), diesel::r2d2::Error&gt; {\n        (|| {\n            if self.enable_wal {\n                conn.batch_execute(&quot;PRAGMA journal_mode = WAL; PRAGMA synchronous = NORMAL;&quot;)?;\n            }\n            if self.enable_foreign_keys {\n                conn.batch_execute(&quot;PRAGMA foreign_keys = ON;&quot;)?;\n            }\n            if let Some(d) = self.busy_timeout {\n                conn.batch_execute(&amp;format!(&quot;PRAGMA busy_timeout = {};&quot;, d.as_millis()))?;\n            }\n            Ok(())\n        })()\n        .map_err(diesel::r2d2::Error::QueryError)\n    }\n}\n\n// ------------- Example -----------------\n\n    let pool = Pool::builder()\n        .max_size(16)\n        .connection_customizer(Box::new(ConnectionOptions {\n            enable_wal: true,\n            enable_foreign_keys: true,\n            busy_timeout: Some(Duration::from_secs(30)),\n        }))\n        .build(ConnectionManager::&lt;SqliteConnection&gt;::new(db_url))\n        .unwrap();\n\n</code></pre>\n<h2>WAL mode</h2>\n<p>The second variant you might want to use is WAL mode. It improves concurrency by letting readers and writer to work at the same time (WAL mode is waaay faster than default journal mode).\nNote however that busy timeout is <a href=\"https://www.sqlite.org/wal.html#sometimes_queries_return_sqlite_busy_in_wal_mode\" rel=\"nofollow noreferrer\">still required</a> for all of this to work.</p>\n<p>(Please, read also about consequences of <a href=\"https://www.sqlite.org/pragma.html#pragma_synchronous\" rel=\"nofollow noreferrer\">&quot;synchronous&quot;</a> mode set to &quot;NORMAL&quot;.)</p>\n<p><a href=\"https://www.sqlite.org/rescode.html#busy_snapshot\" rel=\"nofollow noreferrer\">SQLITE_BUSY_SNAPSHOT</a> is the next thing that may occur with WAL mode. But there is easy remedy to that - use <code>BEGIN IMMEDIATE</code> to start transaction in write mode.</p>\n<p>This way you can have <strong>multiple readers/writers</strong> which makes life easier. Multiple writers use locking mechanism (through <code>busy_timeout</code>), so there is one active writer at the time. You certainly don't want to qualify connections as read and write and do locking manually in your application, e.g. with <code>Mutex</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 772, "user_id": 5269531, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/2aF80.jpg?s=128&g=1", "display_name": "Etienne Prothon", "link": "https://stackoverflow.com/users/5269531/etienne-prothon"}, "is_accepted": false, "score": 2, "last_activity_date": 1570624717, "last_edit_date": 1570624717, "creation_date": 1570607152, "answer_id": 58299335, "question_id": 57123453, "link": "https://stackoverflow.com/questions/57123453/how-to-use-diesel-with-sqlite-connections-and-avoid-database-is-locked-type-of/58299335#58299335", "title": "How to use Diesel with SQLite connections and avoid `database is locked` type of errors", "body": "<p>I find setting <code>r2d2::Pool::builder().max_size(1)</code> solves the issue, but you need to be careful with your connection management and don't ask if you already got one, for example:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn create(pool: &amp;DbPool, data: User) {\n    let conn = pool.get().unwrap(); // One connection\n    if !exist(pool, data) { // Two connection\n        diesel::insert_into(users::table)\n            .values(User { name: data.name })\n            .execute(&amp;conn)\n            .unwrap();\n    }\n}\n\nfn exist(pool: &amp;DbPool, data: User) -&gt; bool {\n    let conn = pool.get().unwrap();\n    Ok(\n        select(exists(users::table.filter(col_user_name.eq(data.name))))\n            .get_result(&amp;conn)\n            .unwrap(),\n    )\n}\n</code></pre>\n\n<p>I removed all <code>let conn = pool.get().unwrap();</code> and only try to get it inside the request.</p>\n\n<pre><code>diesel::insert_into(users::table)\n    .values(User { name })\n    .execute(&amp;pool.get().unwrap())\n    .unwrap();\n</code></pre>\n"}], "owner": {"reputation": 8448, "user_id": 995246, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/0d956964e915c9b3efd2731abb7371b0?s=128&d=identicon&r=PG&f=1", "display_name": "gliderkite", "link": "https://stackoverflow.com/users/995246/gliderkite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2821, "favorite_count": 1, "accepted_answer_id": 57717533, "answer_count": 2, "score": 8, "last_activity_date": 1604213960, "creation_date": 1563615312, "question_id": 57123453, "link": "https://stackoverflow.com/questions/57123453/how-to-use-diesel-with-sqlite-connections-and-avoid-database-is-locked-type-of", "title": "How to use Diesel with SQLite connections and avoid `database is locked` type of errors", "body": "<p>In my Rust application I am using <code>Diesel</code> to interact with an <code>SQLite</code> database. I have multiple threads that may query at the same time the database, and I am using the crate <code>r2d2</code> to create a pool of connections.</p>\n\n<p>The issue that I am seeing is that I am not able to concurrently query the database. If I try to do that, I always get the error <code>database is locked</code>, which is unrecoverable (any following request will fail from the same error even if only a single thread is querying).</p>\n\n<p>The following code reproduces the issue.</p>\n\n<pre><code># Cargo.toml\n[dependencies]\ncrossbeam = { version = \"0.7.1\" }\ndiesel = { version = \"1.4.2\", features = [\"sqlite\", \"r2d2\"] }\n</code></pre>\n\n<pre><code>-- The database table\nCREATE TABLE users (\n    name TEXT PRIMARY KEY NOT NULL\n);\n</code></pre>\n\n<pre><code>#[macro_use]\nextern crate diesel;\n\nmod schema;\n\nuse crate::schema::*;\nuse crossbeam;\nuse diesel::r2d2::{ConnectionManager, Pool};\nuse diesel::RunQueryDsl;\nuse diesel::{ExpressionMethods, SqliteConnection};\n\n#[derive(Insertable, Queryable, Debug, Clone)]\n#[table_name = \"users\"]\nstruct User {\n    name: String,\n}\n\nfn main() {\n    let db_url = \"test.sqlite3\";\n    let pool = Pool::builder()\n        .build(ConnectionManager::&lt;SqliteConnection&gt;::new(db_url))\n        .unwrap();\n\n    crossbeam::scope(|scope| {\n        let pool2 = pool.clone();\n        scope.spawn(move |_| {\n            let conn = pool2.get().unwrap();\n            for i in 0..100 {\n                let name = format!(\"John{}\", i);\n                diesel::delete(users::table)\n                    .filter(users::name.eq(&amp;name))\n                    .execute(&amp;conn)\n                    .unwrap();\n            }\n        });\n\n        let conn = pool.get().unwrap();\n        for i in 0..100 {\n            let name = format!(\"John{}\", i);\n            diesel::insert_into(users::table)\n                .values(User { name })\n                .execute(&amp;conn)\n                .unwrap();\n        }\n    })\n    .unwrap();\n}\n</code></pre>\n\n<p>This is the error as shown when the application panics:</p>\n\n<pre><code>thread '&lt;unnamed&gt;' panicked at 'called `Result::unwrap()` on an `Err` value: DatabaseError(__Unknown, \"database is locked\")'\n</code></pre>\n\n<p>AFAIK, I should be able to use the connection pool with multiple threads (that is, multiple connections for multiple threads), as shown in the <code>r2d2_sqlite</code> crate <a href=\"https://docs.rs/r2d2_sqlite/0.11.0/r2d2_sqlite/\" rel=\"noreferrer\">example</a>.</p>\n\n<p>Moreover, the sqlite3 library I have installed in my system supports the <strong>Serialized</strong> threading model, which from <a href=\"https://www.sqlite.org/threadsafe.html\" rel=\"noreferrer\">here</a>:</p>\n\n<blockquote>\n  <p>In serialized mode, SQLite can be safely used by multiple threads with\n  no restriction.</p>\n</blockquote>\n\n<p>How can I avoid the <code>database is locked</code> errors? Also, if these errors are not avoidable for any reason, how can I unlock the database?</p>\n"}, {"tags": ["rust", "iterator"], "comments": [{"owner": {"reputation": 1925, "user_id": 2865757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dcfe7782349d59e50b1fa196f9c6669?s=128&d=identicon&r=PG&f=1", "display_name": "Zefick", "link": "https://stackoverflow.com/users/2865757/zefick"}, "edited": false, "score": 4, "creation_date": 1563608456, "post_id": 57122549, "comment_id": 100763155, "body": "There is no much sense to add the <code>iter!</code> macro when you can just write <code>vec![...].iter()</code>. Under the hood, any implementation will do the same."}, {"owner": {"reputation": 6608, "user_id": 4497253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc929d11ae26463d18e337d295c86fcc?s=128&d=identicon&r=PG&f=1", "display_name": "CoronA", "link": "https://stackoverflow.com/users/4497253/corona"}, "edited": false, "score": 1, "creation_date": 1563612381, "post_id": 57122549, "comment_id": 100763893, "body": "I think it is a rather bad idea to compare iterators in tests. Iterators change their content if being consumed, which makes failure reporting a problem. And there is no generic equals on <code>Iterators</code>. Rather collect the results into a vector and compare it with a vector."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 6608, "user_id": 4497253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc929d11ae26463d18e337d295c86fcc?s=128&d=identicon&r=PG&f=1", "display_name": "CoronA", "link": "https://stackoverflow.com/users/4497253/corona"}, "edited": false, "score": 1, "creation_date": 1563613763, "post_id": 57122549, "comment_id": 100764142, "body": "@CoronA It perfectly ok to compare two iterator. <a href=\"https://docs.rs/itertools/0.8.0/itertools/fn.assert_equal.html\" rel=\"nofollow noreferrer\">docs.rs/itertools/0.8.0/itertools/fn.assert_equal.html</a>"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1563615387, "post_id": 57122549, "comment_id": 100764453, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/52605781/how-do-i-create-a-by-value-iterator-on-the-stack\">How do I create a by-value iterator on the stack?</a>"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "reply_to_user": {"reputation": 1925, "user_id": 2865757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dcfe7782349d59e50b1fa196f9c6669?s=128&d=identicon&r=PG&f=1", "display_name": "Zefick", "link": "https://stackoverflow.com/users/2865757/zefick"}, "edited": false, "score": 0, "creation_date": 1563616148, "post_id": 57122549, "comment_id": 100764588, "body": "@Zefick Consider having a look at the proposed duplicate. There do exist implementations which do not have to allocate any heap memory."}], "owner": {"reputation": 630, "user_id": 3757407, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c109d2de31d5364a464f5547f5dec96e?s=128&d=identicon&r=PG&f=1", "display_name": "Dincio", "link": "https://stackoverflow.com/users/3757407/dincio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 197, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563606351, "creation_date": 1563606351, "question_id": 57122549, "link": "https://stackoverflow.com/questions/57122549/is-there-a-way-to-initialize-an-iterator-with-a-list-of-elements-in-rust", "title": "Is there a way to initialize an iterator with a list of elements in Rust?", "body": "<p>I was wandering if there is a way to initialize an Iterator sequence with a list of items (similar to how you would initialize a <code>Vector&lt;String&gt;</code> using <code>vec![1, 2, 3]</code>).</p>\n\n<p>I've tried searching online for something similar to what I require, but found nothing. I am aware of the existence of this feature in other languages (such as Java's <code>Stream.of</code>).</p>\n\n<p>Here is my use case (taken from a variation of the minigrep example explained in the Rust Book):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>...\n\npub fn grep&lt;'a&gt;(to_search_into: &amp;'a str, pattern: &amp;'a str) -&gt; impl Iterator&lt;Item = &amp;'a str&gt; {\n    to_search_into.lines()\n        .filter(move |line| line.contains(pattern))\n}\n\n...\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn one_result() {\n        let test_string = \"\\\nI am Grogg the everlasting\nThe great potato eater of old\nBeware my ravenous maws.\";\n\n        assert_eq!(\n            grep(test_string, \"Grogg\"),\n            // what should go here?\n            iter![\"Grogg\"]\n        );\n    }\n}\n\n</code></pre>\n"}, {"tags": ["oop", "rust", "polymorphism", "traits"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1563582410, "post_id": 57120668, "comment_id": 100759909, "body": "<code>petgraph</code> has a <a href=\"https://docs.rs/petgraph/0.4.13/petgraph/graph/struct.Graph.html\" rel=\"nofollow noreferrer\"><code>Graph</code></a> struct generic over <code>Ty</code> which can be either <code>Directed</code> or <code>Undirected</code> (marker types that contain no data). Perhaps you could do something like that?"}, {"owner": {"reputation": 3869, "user_id": 559552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fY01B.jpg?s=128&g=1", "display_name": "solartic", "link": "https://stackoverflow.com/users/559552/solartic"}, "edited": false, "score": 1, "creation_date": 1563587736, "post_id": 57120668, "comment_id": 100760532, "body": "Would creating a trait with default implementations for the dfs and bfs methods work?"}, {"owner": {"reputation": 2173, "user_id": 1804656, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/47ea159b5819a724a31a95f8dd1fc037?s=128&d=identicon&r=PG", "display_name": "kyle", "link": "https://stackoverflow.com/users/1804656/kyle"}, "edited": false, "score": 3, "creation_date": 1563592128, "post_id": 57120668, "comment_id": 100760951, "body": "I agree with the above. Use a trait and define getters and setters that shared between them."}, {"owner": {"reputation": 7096, "user_id": 3990767, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a5741a212e3b0e6bd46a8a1e6d76a4a?s=128&d=identicon&r=PG", "display_name": "SOFe", "link": "https://stackoverflow.com/users/3990767/sofe"}, "edited": false, "score": 0, "creation_date": 1563602170, "post_id": 57120668, "comment_id": 100762103, "body": "You might want to define a Node trait with a directed edges impl and an undirect edges impl, providing a common iterator method. Then you can have a <code>struct Graph&lt;N: Node&gt;(typed_arena::Arena&lt;N&gt;)</code>"}, {"owner": {"reputation": 7096, "user_id": 3990767, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a5741a212e3b0e6bd46a8a1e6d76a4a?s=128&d=identicon&r=PG", "display_name": "SOFe", "link": "https://stackoverflow.com/users/3990767/sofe"}, "edited": false, "score": 0, "creation_date": 1563608133, "post_id": 57120668, "comment_id": 100763103, "body": "By the way, if traits really don&#39;t work, you might want to use macros. Macros are widely used in, say, serialization libraries that generate a separate impl for each <code>[iuf](16|32|64)</code>."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563615558, "post_id": 57120668, "comment_id": 100764479, "body": "Please include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3869, "user_id": 559552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fY01B.jpg?s=128&g=1", "display_name": "solartic", "link": "https://stackoverflow.com/users/559552/solartic"}, "edited": false, "score": 1, "creation_date": 1563636257, "post_id": 57123114, "comment_id": 100769013, "body": "I was not thinking about this initially, but as @Kyle points out we can use getters and setters to access and manipulate the shared fields. We can then use these in the default implementations for for the search methods."}, {"owner": {"reputation": 2389, "user_id": 9453926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3faa500658bbb2d2e88c5463a75c32e1?s=128&d=identicon&r=PG&f=1", "display_name": "politinsa", "link": "https://stackoverflow.com/users/9453926/politinsa"}, "edited": false, "score": 0, "creation_date": 1563661730, "post_id": 57123114, "comment_id": 100774516, "body": "I end up using getters. Hope this RFC will soon be available"}], "tags": [], "owner": {"reputation": 31241, "user_id": 242493, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8893e2e206c0377ff776d2535887d23f?s=128&d=identicon&r=PG", "display_name": "Jimmy Cuadra", "link": "https://stackoverflow.com/users/242493/jimmy-cuadra"}, "is_accepted": false, "score": 1, "last_activity_date": 1563612186, "creation_date": 1563612186, "answer_id": 57123114, "question_id": 57120668, "link": "https://stackoverflow.com/questions/57120668/how-to-represent-two-structs-that-are-really-similar-without-code-redundancy/57123114#57123114", "title": "How to represent two structs that are really similar without code redundancy?", "body": "<p>Traits cannot implicitly access the data of implementing types in default method implementations. That is to say, you can't provide a single trait method implementation that accesses specific fields of the <code>Self</code> type because it cannot be assumed that <code>Self</code> has any particular field. It's possible a nicer construct for traits accessing fields may be allowed in a future extension to the language. See <a href=\"https://github.com/rust-lang/rfcs/pull/1546\" rel=\"nofollow noreferrer\">RFC 1546</a> for one such proposal and discussion about it. But that is still only for direct field access. If you need to manipulate a field in any way before returning it, even that wouldn't help.</p>\n\n<p>For now, you'll either need to write the implementations of <code>Graph</code> for the two types manually, or if the implementations are indeed trivially similar, you could use a macro that has the contents of the implementation and invoke it once for each type. Whether or not the amount of duplication necessary for two manual implementations </p>\n"}, {"comments": [{"owner": {"reputation": 2389, "user_id": 9453926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3faa500658bbb2d2e88c5463a75c32e1?s=128&d=identicon&r=PG&f=1", "display_name": "politinsa", "link": "https://stackoverflow.com/users/9453926/politinsa"}, "edited": false, "score": 0, "creation_date": 1563661661, "post_id": 57126236, "comment_id": 100774499, "body": "Well, I did figure it out by myself this trick without seeing your answer, you can check my edit. Your solution is still better than mine who got some redundancy you don&#39;t have in your code."}, {"owner": {"reputation": 3869, "user_id": 559552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fY01B.jpg?s=128&g=1", "display_name": "solartic", "link": "https://stackoverflow.com/users/559552/solartic"}, "reply_to_user": {"reputation": 2389, "user_id": 9453926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3faa500658bbb2d2e88c5463a75c32e1?s=128&d=identicon&r=PG&f=1", "display_name": "politinsa", "link": "https://stackoverflow.com/users/9453926/politinsa"}, "edited": false, "score": 0, "creation_date": 1563662630, "post_id": 57126236, "comment_id": 100774664, "body": "@politinsa Awesome, I&#39;m glad you figured it out. I&#39;m not sure if my solution is better than yours at this point since I didn&#39;t do a full implementation. Plus the core idea is the same."}], "tags": [], "owner": {"reputation": 3869, "user_id": 559552, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fY01B.jpg?s=128&g=1", "display_name": "solartic", "link": "https://stackoverflow.com/users/559552/solartic"}, "is_accepted": true, "score": 1, "last_activity_date": 1563645261, "last_edit_date": 1563645261, "creation_date": 1563637363, "answer_id": 57126236, "question_id": 57120668, "link": "https://stackoverflow.com/questions/57120668/how-to-represent-two-structs-that-are-really-similar-without-code-redundancy/57126236#57126236", "title": "How to represent two structs that are really similar without code redundancy?", "body": "<p>You can't access the data's attributes directly from a trait (see <strong>Jimmy Cuadra</strong> answer). However we can use shared getters and setters as <strong>kyle</strong> commented.</p>\n\n<p>Something akin to the code below should work.</p>\n\n<pre><code>trait Graph {\n    fn adjacent_edges(&amp;self, v: &amp;Vertex) -&gt; SomeOutput;\n\n    fn dfs(&amp;self, v: &amp;Vertex) -&gt; SomeOutput {\n        let adjacent_edges = self.adjacent_edges(v);\n        // ...\n    }\n\n    fn bfs(&amp;self, v: &amp;Vertex) -&gt; SomeOutput {\n        let adjacent_edges = self.adjacent_edges(v);\n        // ...\n    }\n}\n\n\nstruct UndirectedGraph { ... }\n\nimpl Graph for UndirectedGraph {\n    fn adjacent_edges(&amp;self, v: &amp;Vertex) -&gt; SomeOutput {\n        // ...\n    }\n}\n\n\nstruct DirectedGraph { ... }\n\nimpl Graph for DirectedGraph {\n    fn adjacent_edges(&amp;self, v: &amp;Vertex) -&gt; SomeOutput {\n        // ...\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2389, "user_id": 9453926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3faa500658bbb2d2e88c5463a75c32e1?s=128&d=identicon&r=PG&f=1", "display_name": "politinsa", "link": "https://stackoverflow.com/users/9453926/politinsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 57126236, "answer_count": 2, "score": 1, "last_activity_date": 1563661453, "creation_date": 1563579959, "last_edit_date": 1563661453, "question_id": 57120668, "link": "https://stackoverflow.com/questions/57120668/how-to-represent-two-structs-that-are-really-similar-without-code-redundancy", "title": "How to represent two structs that are really similar without code redundancy?", "body": "<p>I'd like to create a small graph module for my project. I do need both <strong>directed and undirected graphs.</strong></p>\n\n<p>If it was C++ or Java, I'd make an abstract class Graph implementing depth first search, breadth first search and 2 children classes Directed and Undirected for specific implementations or specific methods.</p>\n\n<p>I did read the OOP part of the book; however, how would I represent this behaviour with trait ?</p>\n\n<p>Ideally, I could be able to use my mod like this :</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use graph::{UndirectedGraph, DirectedGraph, Graph};\n\n\npub fn main() {\n    let g1 = Undirectedgraph::new(); // implementing Graph trait\n    let g2 = DirectedGraph::new(); // implementing Graph trait\n    g1.dfs(); // from Graph\n    g2.dfs(); // from Graph\n    g1.bfs(); // from Graph\n    g2.bfs(); // from Graph\n\n    let _ = g1.has_loop(); // from UndirectedGraph implementation only\n    let _ = g2.has_loop() // from DirectedGraph implementation only\n}\n\n</code></pre>\n\n<p>So I ended up with something like this ; as you can see  </p>\n\n<h1>there is still a lot of redundancy with attributes and getters :</h1>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Debug)]\npub struct Node {\n    value: i32,\n}\n\npub trait Graph {\n    fn get_vertices(&amp;self) -&gt; &amp;Vec&lt;Node&gt;;\n\n    fn print_nodes(&amp;self) {\n        self.get_vertices()\n            .iter()\n            .for_each(|x| println!(\"{:#?}\", x));\n    }\n\n    fn bfs(&amp;self) {\n        println!(\"Common implementation\");\n    }\n\n    fn dfs(&amp;self) {\n        println!(\"Common implementation\");\n    }\n\n    fn has_loop(&amp;self) -&gt; bool; // should be implemented\n}\n\npub struct DirectedGraph {\n    vertices: Vec&lt;Node&gt;,\n}\n\nimpl Graph for DirectedGraph {\n    fn get_vertices(&amp;self) -&gt; &amp;Vec&lt;Node&gt; {\n        &amp;(self.vertices)\n    }\n\n    fn has_loop(&amp;self) -&gt; bool {\n        //some weird stuff\n        // specific to DirectedGraph\n        true\n    }\n}\n\npub struct UndirectedGraph {\n    vertices: Vec&lt;Node&gt;,\n}\n\nimpl Graph for UndirectedGraph {\n    fn get_vertices(&amp;self) -&gt; &amp;Vec&lt;Node&gt; {\n        &amp;(self.vertices)\n    }\n\n    fn has_loop(&amp;self) -&gt; bool {\n        //some weird stuff\n        // specific to UndirectedGraph\n        true\n    }\n}\n</code></pre>\n"}, {"tags": ["types", "rust", "integer", "integer-arithmetic"], "comments": [{"owner": {"reputation": 123967, "user_id": 251153, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4b25144c09555e7d5b5e288469e011ef?s=128&d=identicon&r=PG", "display_name": "zneak", "link": "https://stackoverflow.com/users/251153/zneak"}, "edited": false, "score": 3, "creation_date": 1563574782, "post_id": 57119562, "comment_id": 100758619, "body": "Consider that for values that are not 0 or 1, the biggest possible non-overflowing exponent is 63."}, {"owner": {"reputation": 14957, "user_id": 734463, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/efw4Z.jpg?s=128&g=1", "display_name": "joedborg", "link": "https://stackoverflow.com/users/734463/joedborg"}, "edited": false, "score": 0, "creation_date": 1564493607, "post_id": 57119562, "comment_id": 101043835, "body": "Thanks, that was my assumption too, it just kinda makes the code messy (but that&#39;s better than getting runtime errors obviously."}], "answers": [{"comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1566524098, "post_id": 57120020, "comment_id": 101692227, "body": "If that is the reason, why isn&#39;t it <code>u8</code> instead of <code>u32</code>?"}, {"owner": {"reputation": 126353, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1566534716, "post_id": 57120020, "comment_id": 101694059, "body": "@PeterHall <a href=\"https://stackoverflow.com/a/57120777/14660\">trentcl&#39;s answer</a> has a theory. I&#39;ll add my own. In low level languages like Rust integer overflow is occasionally a desirable thing, like for a hashing function. Limiting exponentiation to <code>u8</code> would take that away. <a href=\"https://huonw.github.io/blog/2016/04/myths-and-legends-about-integer-overflow-in-rust/\" rel=\"nofollow noreferrer\">Rust&#39;s design wrt overflow has evolved over time</a>, and they <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/0560-integer-overflow.md\" rel=\"nofollow noreferrer\">appear to have settled on explicit &quot;wrapping&quot; operators</a>."}], "tags": [], "owner": {"reputation": 126353, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": 7, "last_activity_date": 1563574079, "last_edit_date": 1563574079, "creation_date": 1563573696, "answer_id": 57120020, "question_id": 57119562, "link": "https://stackoverflow.com/questions/57119562/why-does-rusts-u64-pow-expect-a-u32/57120020#57120020", "title": "Why does Rust&#39;s u64.pow expect a u32?", "body": "<p>This is an educated guess.</p>\n\n<p>Consider that a u64 raised to a u32 is already more than capable of overflowing any u64. For example, if we take 2 (the smallest possible significant u64) and raise it to merely 2^10 or 1024 we get something rather larger than a u64.</p>\n\n<blockquote>\n  <p>179769313486231590772930519078902473361797697894230657273430081157732675805500963132708477322407536021120113879871393357658789768814416622492847430639474124377767893424865485276302219601246094119453082952085005768838150682342462881473913110540827237163350510684586298239947245938479716304835356329624224137216</p>\n</blockquote>\n\n<p>There's no point in allowing an even larger exponent, it just means a more expensive calculation that is more likely to overflow.</p>\n\n<p>If a u64 cannot safely be downgraded to a u32, it <em>definitely</em> cannot safely be used as an exponent. <a href=\"https://doc.rust-lang.org/std/primitive.u128.html#method.pow\" rel=\"noreferrer\">u128.pow</a> also only takes a u32 exponent for the same reason.</p>\n\n<p>Note: there is <a href=\"https://doc.rust-lang.org/std/primitive.u64.html#method.overflowing_pow\" rel=\"noreferrer\">overflowing_pow</a> to detect a likely overflow.</p>\n"}, {"tags": [], "owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "is_accepted": true, "score": 10, "last_activity_date": 1563581367, "creation_date": 1563581367, "answer_id": 57120777, "question_id": 57119562, "link": "https://stackoverflow.com/questions/57119562/why-does-rusts-u64-pow-expect-a-u32/57120777#57120777", "title": "Why does Rust&#39;s u64.pow expect a u32?", "body": "<h1>Why do most operations require operands of the same type?</h1>\n\n<p>It's easy for <em>us</em> to see that <code>2i32 + 2i64</code> should be <code>4i64</code>, but to a CPU, <code>2i32</code> and <code>2i64</code> are completely different and totally unrelated things. <code>+</code> inside a CPU is really just a piece of hardware that typically supports two 32-bit inputs or two 64-bit inputs, but not one 32-bit input and one 64-bit input. So in order to add an <code>i32</code> to an <code>i64</code>, the shorter number has to be sign-extended to 64 bits before both values can be plugged in to the ALU.</p>\n\n<p>The same is generally true for most integer and floating-point arithmetic operations: A conversion has to be done to do math on mismatched types. In C, the compiler usually promotes both operands to the smallest type that can represent both values; these implicit conversions are called the <a href=\"https://stackoverflow.com/q/20747614/3650362\">\"integer promotions\" or \"usual arithmetic conversions\"</a> depending on context. In Rust, however, the compiler mostly only knows about same-type operations, so you have to choose what kind of operation you want by deciding how to convert the operands. People who like Rust generally consider this to be a good thing.\u00b9</p>\n\n<h1>Why doesn't this apply to <code>u64::pow</code>?</h1>\n\n<p>Not all arithmetic operations, even those implemented in hardware, accept arguments of the same type. In hardware (although not in LLVM), shift instructions often ignore the higher bits of the shift argument (this is why in C shifting by more than the size of the integer invokes undefined behavior). LLVM offers <a href=\"https://llvm.org/docs/LangRef.html#llvm-powi-intrinsic\" rel=\"noreferrer\"><code>powi</code> instructions</a> that raise a floating-point number to an integer power.</p>\n\n<p>These operations are different because the inputs are asymmetric, and designers often take advantage of these asymmetries to make hardware faster and smaller. In the case of <code>u64::pow</code>, though, it's <em>not</em> implemented with a hardware instruction: <a href=\"https://doc.rust-lang.org/src/core/num/mod.rs.html#3669-3689\" rel=\"noreferrer\">it's just written in plain Rust</a>. Bearing that in mind, it's clear that requiring the exponent to be a <code>u64</code> is quite unnecessary: As <a href=\"https://stackoverflow.com/a/57120020/3650362\">Schwern's answer</a> points out, <code>u32</code> is more than capable of containing all the possible powers that a <code>u64</code> could be raised to with any hope of accuracy, so the extra 32 bits would be just pointless.</p>\n\n<h1>OK, why <code>u32</code>?</h1>\n\n<p>The last sentence is equally true of <code>u16</code> or even <code>u8</code> -- a <code>u64</code> can't contain <code>pow(2, 255)</code>, so using <code>u32</code> seems nearly as wasteful. However, there are also practical considerations. Many calling conventions pass function arguments in registers, so on a 32-bit (or larger) platform you will not see any advantage from going smaller than that. Many CPUs also do not support native 8-bit or 16-bit arithmetic, so the argument would have to be sign-extended anyway to implement the exponentiation-by-squaring algorithm I linked to earlier. In short, I don't know specifically why <code>u32</code> was chosen, but things like this may have factored into the decision.</p>\n\n<hr>\n\n<p>\u00b9 C's rules are somewhat encumbered by history and supporting a wide range of historical hardware. Rust only targets LLVM, so the compiler doesn't need to worry about whether the underlying hardware has a primitive 8-bit <code>add</code> instruction or not; it just emits <code>add</code> and lets LLVM worry about whether it will be compiled to a primitive instruction or emulated with 32-bit ones. This is why <code>char</code> + <code>char</code> is <code>int</code> in C, but <code>i8</code> + <code>i8</code> is <code>i8</code> in Rust.</p>\n"}], "owner": {"reputation": 14957, "user_id": 734463, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/efw4Z.jpg?s=128&g=1", "display_name": "joedborg", "link": "https://stackoverflow.com/users/734463/joedborg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1344, "favorite_count": 1, "accepted_answer_id": 57120777, "answer_count": 2, "score": 10, "last_activity_date": 1566523806, "creation_date": 1563570127, "last_edit_date": 1566523806, "question_id": 57119562, "link": "https://stackoverflow.com/questions/57119562/why-does-rusts-u64-pow-expect-a-u32", "title": "Why does Rust&#39;s u64.pow expect a u32?", "body": "<p>Why is it that Rust's <code>u64</code> primitive expects a <code>u32</code> exponent?</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n  --&gt; src/protagonists.rs:13:25\n   |\n13 |         return root.pow(self.secret) % prime;\n   |                         ^^^^^^^^^^^ expected u32, found u64\nhelp: you can convert an `u64` to `u32` and panic if the converted value wouldn't fit\n\n</code></pre>\n\n<p><a href=\"https://doc.rust-lang.org/std/primitive.u64.html#pow.v\" rel=\"nofollow noreferrer\">https://doc.rust-lang.org/std/primitive.u64.html#pow.v</a></p>\n"}, {"tags": ["algorithm", "rust"], "comments": [{"owner": {"reputation": 314794, "user_id": 67579, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/BJXub.png?s=128&g=1", "display_name": "Willem Van Onsem", "link": "https://stackoverflow.com/users/67579/willem-van-onsem"}, "edited": false, "score": 3, "creation_date": 1563564237, "post_id": 57118537, "comment_id": 100755496, "body": "Hint: use the <a href=\"https://en.wikipedia.org/wiki/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm#Efficiency_of_the_search_algorithm\" rel=\"nofollow noreferrer\"><i>Knuth-Morris-Pratt algorithm</i></a>."}], "answers": [{"tags": [], "owner": {"reputation": 6367, "user_id": 6914441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbc12c764b93fa915b8e5384f521fe12?s=128&d=identicon&r=PG&f=1", "display_name": "jferard", "link": "https://stackoverflow.com/users/6914441/jferard"}, "is_accepted": true, "score": 1, "last_activity_date": 1564067977, "last_edit_date": 1564067977, "creation_date": 1563700867, "answer_id": 57131856, "question_id": 57118537, "link": "https://stackoverflow.com/questions/57118537/rust-how-can-i-search-a-vec-for-a-subset-and-find-the-start-index-of-the-sub/57131856#57131856", "title": "Rust - How can I search a vec for a subset - and find the start index of the subvec?", "body": "<p>This is a classic <a href=\"https://en.wikipedia.org/wiki/String-searching_algorithm\" rel=\"nofollow noreferrer\">string search problem</a>. @Willem Van Onsem suggested the KMP algorithm, but you should start with the naive algorithm. </p>\n\n<p>For every index of <code>haystack</code>, try to compare the string of the same length as <code>needle</code> and starting at this index in <code>haystack</code> to <code>needle</code> itself.</p>\n\n<p>Have a look at this:</p>\n\n<pre><code>0   0   0   1   48  120 49  49  1   0\n48  120 49  49\nx fail\n    48  120 49  49\n    x fail\n        48  120 49  49\n        x fail\n            48  120 49  49\n            x fail\n                48  120 49  49\n                -   -   -   - match!\n</code></pre>\n\n<p><code>x</code> means that the elements are different, <code>-</code> that they are the same. On every <code>x</code>, shift to the next element of <code>haystack</code> (that's the difference with KMP which may shift more than one element at once).</p>\n\n<p>In Rust, you will write something like:</p>\n\n<pre><code>fn find1(haystack: &amp;Vec&lt;i32&gt;, needle: &amp;Vec&lt;i32&gt;) -&gt; i64 {\n    for i in 0..haystack.len()-needle.len()+1 { // last indices of haystack are too far right to get a match\n        let mut j = 0;\n        while j &lt; needle.len() { // check every char of needle\n            if needle[j] != haystack[i+j] { // doesn't match\n                break; // try the next i\n            }\n            j += 1; // else: match so far\n        }\n        if j == needle.len() { // no break: a full match was found\n            return i as i64;\n        }\n    }\n    return -1; // not a single full match\n}\n</code></pre>\n\n<p>Of course, you can use some of Rust features to shorten the code (and avoid the C-like style above):</p>\n\n<pre><code>fn find2(haystack: &amp;Vec&lt;i32&gt;, needle: &amp;Vec&lt;i32&gt;) -&gt; Option&lt;usize&gt; {\n    for i in 0..haystack.len()-needle.len()+1 {\n        if haystack[i..i+needle.len()] == needle[..] {\n            return Some(i);\n        }\n    }\n    None\n}\n</code></pre>\n\n<p>Or the functional style if you prefer:</p>\n\n<pre><code>fn find3(haystack: &amp;Vec&lt;i32&gt;, needle: &amp;Vec&lt;i32&gt;) -&gt; Option&lt;usize&gt; {\n    (0..haystack.len()-needle.len()+1)\n        .filter(|&amp;i| haystack[i..i+needle.len()] == needle[..]).next()\n}\n</code></pre>\n\n<p>If you understand the naive algorithm and its naive implementation, you can move to faster algorithms.</p>\n"}], "owner": {"reputation": 31, "user_id": 7786405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8fd4a9a68b261e23c1bca2d9842ef6e?s=128&d=identicon&r=PG&f=1", "display_name": "CollaborativeLearner", "link": "https://stackoverflow.com/users/7786405/collaborativelearner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 1, "accepted_answer_id": 57131856, "answer_count": 1, "score": 0, "last_activity_date": 1564067977, "creation_date": 1563564012, "question_id": 57118537, "link": "https://stackoverflow.com/questions/57118537/rust-how-can-i-search-a-vec-for-a-subset-and-find-the-start-index-of-the-sub", "title": "Rust - How can I search a vec for a subset - and find the start index of the subvec?", "body": "<p>If I have a vec, how can I search this to find whether it contains another vec - and return the index where this subvec begins?</p>\n\n<pre><code>let mut haystack = vec!(0, 0, 0, 1, 48, 120, 49, 49, 1, 0);\nlet mut needle = vec!(48, 120, 49, 49);\n</code></pre>\n\n<p>Such that it returns 4 (the starting index of this subset in the original) (or rather, it would return a Result which contains 4 in this case - and which would error if it is not found at all).</p>\n"}, {"tags": ["asynchronous", "rust", "rust-tokio"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1563535841, "post_id": 57109699, "comment_id": 100742036, "body": "<i>&quot;namely if a request failed or not&quot;</i> Have you tried yielding a <code>Result</code> from the future?"}, {"owner": {"reputation": 19, "user_id": 6126692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77fac16b1eefeb9c6dcd9d0cfa2ea692?s=128&d=identicon&r=PG", "display_name": "Artir", "link": "https://stackoverflow.com/users/6126692/artir"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1563617329, "post_id": 57109699, "comment_id": 100764828, "body": "How would I do that? I refactored the code to get rid of the odd wrapping a stream in a stream and then flattening it, a .then() does the job. But ideally, it should be possible to do something like mapping a function to an array with the return values. In python this can be done using a threadpool (Not async, but still) and .map, but in rust I have no idea"}], "owner": {"reputation": 19, "user_id": 6126692, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77fac16b1eefeb9c6dcd9d0cfa2ea692?s=128&d=identicon&r=PG", "display_name": "Artir", "link": "https://stackoverflow.com/users/6126692/artir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563617299, "creation_date": 1563529167, "last_edit_date": 1563617299, "question_id": 57109699, "link": "https://stackoverflow.com/questions/57109699/sharing-data-between-async-requests-in-tokio", "title": "Sharing data between async requests in Tokio", "body": "<p>EDIT: I refactored the code to make it simpler.</p>\n\n<p>I'm writing a small program to check a website for dead links, using tokio and reqwests to make requests async without the need for threading. But I also need to be able to return something from each of the requests that tokio is running; namely if a request failed or not.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn fetch(req: Vec&lt;&amp;'static str&gt;) {\n    let client = Client::new();\n    let (tx, rx) = mpsc::channel();\n    let req_len = req.len();\n    let work = stream::iter_ok(req)\n        .map(move |url| client.get(url).send())\n        .buffer_unordered(PARALLEL_REQUESTS)\n        .then(move |response| {\n            let this_tx = tx.clone();\n            match response {\n                Ok(x) =&gt; {\n                    format_response(x);\n\n                    this_tx.send(1).unwrap();\n                }\n\n                Err(x) =&gt; {\n                    format_error(x);\n                }\n            }\n\n            future::ok(())\n        })\n        .for_each(|n| Ok(()));\n\n    tokio::run(work);\n</code></pre>\n\n<p>The code works, but I'd like some feedback as to what the best way of writing this in Rust would be.</p>\n"}, {"tags": ["rust", "rust-tokio"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563528510, "post_id": 57108769, "comment_id": 100738505, "body": "this is how tokio do it without using a stream of chunk, <a href=\"https://tokio-rs.github.io/tokio/doc/src/tokio_fs/read.rs.html#48\" rel=\"nofollow noreferrer\">tokio-rs.github.io/tokio/doc/src/tokio_fs/read.rs.html#48</a>."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563528759, "post_id": 57108769, "comment_id": 100738641, "body": "you could probably use <a href=\"https://tokio-rs.github.io/tokio/doc/tokio/prelude/trait.AsyncRead.html\" rel=\"nofollow noreferrer\">tokio-rs.github.io/tokio/doc/tokio/prelude/trait.AsyncRead.h&zwnj;&#8203;tml</a>"}, {"owner": {"reputation": 8224, "user_id": 985383, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/anF0k.png?s=128&g=1", "display_name": "piggyback", "link": "https://stackoverflow.com/users/985383/piggyback"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563530972, "post_id": 57108769, "comment_id": 100739765, "body": "do both strategy avoid waiting to read?"}], "owner": {"reputation": 8224, "user_id": 985383, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/anF0k.png?s=128&g=1", "display_name": "piggyback", "link": "https://stackoverflow.com/users/985383/piggyback"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 231, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1563526010, "creation_date": 1563526010, "question_id": 57108769, "link": "https://stackoverflow.com/questions/57108769/reading-multiple-parts-of-a-file-async-using-tokio", "title": "Reading multiple parts of a file async using tokio", "body": "<p>I got really stuck at this very simple problem in rust:</p>\n\n<p>Ideally using a single core CPU, I want to be able to read a parts of the same file in a non blocking way:</p>\n\n<pre><code>struct PrefetchOp {\n}\n\nimpl PrefetchOp {\n\n  async fn start (currentData: [u8;8]) {\n    let next = self.prefetch(); // this reads data from disk and puts it in memory\n    self.perform_slow_step(currentData);\n\n    let mut future\n    for x in 0..100 {\n      future = self.prefetch();\n      self.perform_slow_step(next.await);\n      next = future;\n    }\n  }\n}\n</code></pre>\n\n<p>Now, I want to write a prefetch which reads data in an async way such that hopefully it will be ready by the next slow step or that line will wait for it to be done.</p>\n\n<p>Now, prefetch is reading parts of the same file and my plan was to:</p>\n\n<ul>\n<li>Implement a future that creates the file descriptor, performs a <code>poll_seek</code> and performs <code>poll_read</code></li>\n<li>Or, create a file descriptor before the loop and have a future that does the <code>poll_seek</code> and the <code>poll_read</code>. Will I not have concurrency issues then?</li>\n</ul>\n\n<p>How can I do this in the simplest most elegant way?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 2, "creation_date": 1563513780, "post_id": 57105950, "comment_id": 100732080, "body": "You have several possible paths. The simplest and most immediate would be regular expressions. There&#39;s a very good crate in rust for that and those transformations are trivial. For the long term, depending on the complexity of your language, you&#39;ll probably need a parser approach."}, {"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1563514193, "post_id": 57105950, "comment_id": 100732215, "body": "<i>&quot;I was looking for a method that counts how many times a character appears at the start of a string&quot;</i> What was exactly the problem with doing that ? What prevented you from counting the number of <code>$</code> at the start of a string ?"}, {"owner": {"reputation": 50126, "user_id": 1717300, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/81b91f602ce8acea8cbeb29f62725627?s=128&d=identicon&r=PG", "display_name": "hyde", "link": "https://stackoverflow.com/users/1717300/hyde"}, "edited": false, "score": 0, "creation_date": 1563514194, "post_id": 57105950, "comment_id": 100732216, "body": "Whats wrong with <code>if string is longer than 1 char and first char is equal to second char</code>?"}, {"owner": {"reputation": 4020, "user_id": 388739, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vqsVi.jpg?s=128&g=1", "display_name": "Mark LeMoine", "link": "https://stackoverflow.com/users/388739/mark-lemoine"}, "reply_to_user": {"reputation": 50126, "user_id": 1717300, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/81b91f602ce8acea8cbeb29f62725627?s=128&d=identicon&r=PG", "display_name": "hyde", "link": "https://stackoverflow.com/users/1717300/hyde"}, "edited": false, "score": 0, "creation_date": 1563514594, "post_id": 57105950, "comment_id": 100732344, "body": "@hyde Is there a good way to index by character? It seems that doing do isn&#39;t encouraged."}], "answers": [{"tags": [], "owner": {"reputation": 11277, "user_id": 3657941, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/304d8d4cceca5f9ce2383ff97b53e36b?s=128&d=identicon&r=PG&f=1", "display_name": "David Cullen", "link": "https://stackoverflow.com/users/3657941/david-cullen"}, "is_accepted": false, "score": 4, "last_activity_date": 1563519542, "last_edit_date": 1563519542, "creation_date": 1563516430, "answer_id": 57106436, "question_id": 57105950, "link": "https://stackoverflow.com/questions/57105950/consolidating-multiple-copies-of-a-character-at-start-of-string-into-one-in-rust/57106436#57106436", "title": "Consolidating multiple copies of a character at start of string into one in Rust", "body": "<p>Can't you just use <code>starts_with</code>?</p>\n\n<pre><code>fn main() {\n    let line_list= [ \"hello\", \"$add\", \"$$add\" ];\n    let mut result;\n    for line in line_list.iter() {\n        if line.starts_with(\"$$\") {\n            result = line[1..].to_string();\n        }\n        else if line.starts_with(\"$\") {\n            result = format!(\"operator:{}\", &amp;line[1..]);\n        }\n        else {\n            result = line.to_string();\n        }\n        println!(\"result = {}\", result);\n    }\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre><code>result = hello\nresult = operator:add\nresult = $add\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "is_accepted": false, "score": 2, "last_activity_date": 1563526517, "last_edit_date": 1563526517, "creation_date": 1563516983, "answer_id": 57106567, "question_id": 57105950, "link": "https://stackoverflow.com/questions/57105950/consolidating-multiple-copies-of-a-character-at-start-of-string-into-one-in-rust/57106567#57106567", "title": "Consolidating multiple copies of a character at start of string into one in Rust", "body": "<p>According to the comments, your problem seems to be related to the access to the first chars.</p>\n\n<p>The proper and efficient way is to <a href=\"https://doc.rust-lang.org/std/primitive.str.html#method.chars\" rel=\"nofollow noreferrer\">get a char iterator</a>:</p>\n\n<pre><code>#[derive(Debug)]\nenum Token {\n    Str(String),\n    Operator(String),\n}\nimpl From&lt;&amp;str&gt; for Token {\n    fn from(s: &amp;str) -&gt; Self {\n        let mut chars = s.chars();\n        let first_char = chars.next();\n        let second_char = chars.next();\n        match (first_char, second_char) {\n            (Some('$'), Some('$')) =&gt; {\n                Token::Str(format!(\"${}\", chars.as_str()))\n            }\n            (Some('$'), Some(c)) =&gt; {\n                // your real handling here is probably different\n                Token::Operator(format!(\"{}{}\", c, chars.as_str()))\n            }\n            _ =&gt; {\n                Token::Str(s.to_string())\n            }\n        }        \n    }\n}\n\nfn main() {\n    println!(\"{:?}\", Token::from(\"\u03c0\"));\n    println!(\"{:?}\", Token::from(\"hello\"));\n    println!(\"{:?}\", Token::from(\"$add\"));\n    println!(\"{:?}\", Token::from(\"$$add\"));\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>Str(\"\u03c0\")\nStr(\"hello\")\nOperator(\"add\")\nStr(\"$add\")\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=41c6ec85921980ed5d4fd2989d1a2245\" rel=\"nofollow noreferrer\">playground</a></p>\n"}], "owner": {"reputation": 4020, "user_id": 388739, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vqsVi.jpg?s=128&g=1", "display_name": "Mark LeMoine", "link": "https://stackoverflow.com/users/388739/mark-lemoine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 2, "answer_count": 2, "score": 2, "last_activity_date": 1563526517, "creation_date": 1563513659, "last_edit_date": 1563515078, "question_id": 57105950, "link": "https://stackoverflow.com/questions/57105950/consolidating-multiple-copies-of-a-character-at-start-of-string-into-one-in-rust", "title": "Consolidating multiple copies of a character at start of string into one in Rust", "body": "<p>I'm working on a parser for a mini language, and I have the need to differentiate between plain strings (\"hello\") and strings that are meant to be operators/commands, and start with a specific sigil character (e.g. \"$add\").</p>\n\n<p>I also want to add a way for the user to escape the sigil, in which a double-sigil gets consolidated into one, and then is treated like a plain string.</p>\n\n<p>As an example:<br>\n<code>\"hello\"</code> becomes <code>Str(\"hello\")</code><br>\n<code>\"$add\"</code> becomes <code>Operator(Op::Add)</code><br>\n<code>\"$$add\"</code> becomes <code>Str(\"$add\")</code></p>\n\n<p>What would be the best way to do this check and manipulation? I was looking for a method that counts how many times a character appears at the start of a string, to no avail.</p>\n"}, {"tags": ["types", "rust", "traits"], "answers": [{"tags": [], "owner": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "is_accepted": true, "score": 6, "last_activity_date": 1563508849, "creation_date": 1563508849, "answer_id": 57105355, "question_id": 57105093, "link": "https://stackoverflow.com/questions/57105093/i-get-a-expected-type-parameter-even-though-i-think-i-have-returned-the-correct/57105355#57105355", "title": "I get a expected type parameter, even though I think I have returned the correct type data", "body": "<p>Looking at the compiler warning here is very helpful.</p>\n\n<pre><code>warning: type parameter `i32` should have an upper camel case name\n  --&gt; src/main.rs:10:19\n   |\n10 |     fn get_weight&lt;i32&gt;(&amp;self) -&gt; i32 {\n   |                   ^^^ help: convert the identifier to upper camel case: `I32`\n   |\n   = note: #[warn(non_camel_case_types)] on by default\n</code></pre>\n\n<p>As you can see, the <code>i32</code> between the brackets is being parsed as a type parameter. I believe this locally shadows the type <code>i32</code> (specifically, the return type is this generic type), so when you return a normal <code>i32</code>, the compiler complains. This isn't really relevant, since that isn't the root of the problem.</p>\n\n<p>The problem here is that the <code>Animal</code> trait requires that its <code>get_weight</code> method be generic in <code>T</code>. When you implement the trait, you have to provide a <code>get_weight</code> method that works for <em>every</em> possible type <code>T</code> (with the implicit restriction that the type is <code>Sized</code>). This should be impossible, since you'd have to produce an element of any given type out of thin air. Some types don't even have any elements!</p>\n\n<p>Instead, you have two choices. First, you could make a generic trait. The syntax for this is</p>\n\n<pre><code>trait Animal&lt;T&gt; {\n    fn get_weight(&amp;self) -&gt; T;\n}\n</code></pre>\n\n<p>Note that <code>T</code> is introduced with the trait, rather than on the method. With this setup, you conceptually don't have a single trait anymore, but rather one trait for every type (again with implicit <code>Sized</code> bounds). That means that a given type can implement the trait for different values of <code>T</code>. Like you might have both <code>Animal&lt;i32&gt;</code> and <code>Animal&lt;u32&gt;</code> implemented for<code>Cat</code>.</p>\n\n<p>If you still want each type to only implement the trait once and have a single output type, you can use an associated type. The syntax for this is</p>\n\n<pre><code>trait Animal{\n    type Weight;\n\n    fn get_weight(&amp;self) -&gt; Self::Weight;\n}\n</code></pre>\n\n<p>Now when you implement this trait on a type, you have to provide the output type. You could implement <code>Cat</code> by adding the line <code>type Weight = i32;</code> inside the trait implementation. Then the <code>get_weight</code> method would simply need to return <code>i32</code>, just like what you have already.</p>\n"}], "owner": {"reputation": 1201, "user_id": 10861398, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-vWqDAX0_3CU/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcb8uE71Fa7S1ue1ggOWwDVqykVLWw/mo/photo.jpg?sz=128", "display_name": "Laode Muhammad Al Fatih", "link": "https://stackoverflow.com/users/10861398/laode-muhammad-al-fatih"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 1, "accepted_answer_id": 57105355, "answer_count": 1, "score": 3, "last_activity_date": 1563508849, "creation_date": 1563506512, "question_id": 57105093, "link": "https://stackoverflow.com/questions/57105093/i-get-a-expected-type-parameter-even-though-i-think-i-have-returned-the-correct", "title": "I get a expected type parameter, even though I think I have returned the correct type data", "body": "<p>I get a expected type parameter, even though I think I have returned the correct type data.I am in the learning phase of generic material in rust.</p>\n\n<pre><code>struct Cat {\n    weight: i32,\n}\n\ntrait Animal{\n    fn get_weight&lt;T&gt;(&amp;self) -&gt; T;\n}\n\nimpl Animal for Cat {\n    fn get_weight&lt;i32&gt;(&amp;self) -&gt; i32 {\n        self.weight // I got error in here\n    }\n}\n\nfn main() {}\n</code></pre>\n\n<p>Error message:</p>\n\n<pre><code>mismatched types\n\nexpected type parameter, found i32\n\nnote: expected type `i32` (type parameter)\n         found type `i32` (i32)\n\nexpected `i32` because of return type\nexpected type parameter, found i32\n</code></pre>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 416, "user_id": 3183526, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RwNsS.png?s=128&g=1", "display_name": "64_", "link": "https://stackoverflow.com/users/3183526/64"}, "is_accepted": false, "score": 2, "last_activity_date": 1563513296, "creation_date": 1563513296, "answer_id": 57105909, "question_id": 57104975, "link": "https://stackoverflow.com/questions/57104975/shadowing-in-rust-and-fighting-the-borrow-checker/57105909#57105909", "title": "Shadowing in Rust and Fighting the Borrow Checker", "body": "<p>The error tells you the problem:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>error[E0502]: cannot borrow `input` as mutable because it is also borrowed as immutable\n  --&gt; src/main.rs:20:27\n   |\n13 |     name = input.trim();\n   |            ----- immutable borrow occurs here\n...\n20 |     io::stdin().read_line(&amp;mut input).expect(\"failed to read from stdin\");\n   |                           ^^^^^^^^^^ mutable borrow occurs here\n...\n47 |     println!(\"{}, your gain from interest is : ${}\", name, (interest * balance * 0.01)); //Print\n   |                                                      ---- immutable borrow later used here\n</code></pre>\n\n<p><code>input.trim()</code> creates an immutable reference to input and stores it in <code>name</code>. If you remove the <code>String::new()</code> calls, then you are calling <code>io::stdin().read_line(&amp;mut input)</code> which takes a mutable reference to input, but there is still an immutable reference to input in the <code>name</code> variable.</p>\n\n<p>In Rust, you are not allowed an immutable reference and a mutable reference to exist at the same time, so the compiler gives an error.</p>\n\n<p>You cannot really reuse the variable here, you need to clone or do what you are doing and create a new string entirely.</p>\n"}, {"tags": [], "owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "is_accepted": false, "score": 2, "last_activity_date": 1563542544, "creation_date": 1563542544, "answer_id": 57113408, "question_id": 57104975, "link": "https://stackoverflow.com/questions/57104975/shadowing-in-rust-and-fighting-the-borrow-checker/57113408#57113408", "title": "Shadowing in Rust and Fighting the Borrow Checker", "body": "<p><a href=\"https://stackoverflow.com/a/57105909/3650362\">HexCoder's answer</a> explains that you cannot reuse the <code>String</code> in <code>input</code> because it is borrowed by <code>name</code>. However, to make it reusable, all you need to do is copy <code>input.trim()</code> into a new <code>String</code> with its own buffer:</p>\n\n<pre><code>let name: String = input.trim().into();\n</code></pre>\n\n<p>Since <code>name</code> no longer borrows <code>input</code>, you can erase <code>input</code> and re-use its buffer. To erase a string, use <a href=\"https://doc.rust-lang.org/std/string/struct.String.html#method.clear\" rel=\"nofollow noreferrer\"><code>String::clear</code></a>:</p>\n\n<pre><code>input.clear(); // instead of `input = String::new();`\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=5671b60a3b5af5c45ce8f1beb04f6c7c\" rel=\"nofollow noreferrer\">Here is a more complete example</a> in which I also use pattern bindings to avoid parsing <code>input</code> twice, and move the declaration of <code>balance</code> and <code>interest</code> to when they can be immediately initialized.</p>\n\n<h3>See also</h3>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/45232943/weird-behaviour-when-using-read-line-in-a-loop\">Weird behaviour when using read_line in a loop</a></li>\n</ul>\n\n<p>There are some subtleties to variable shadowing, especially when you take compiler optimization into account; these questions may also be useful:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/48227347/does-rust-free-up-the-memory-of-overwritten-variables\">Does Rust free up the memory of overwritten variables?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/56370397/what-happens-on-the-stack-when-one-value-shadows-another-in-rust\">What happens on the stack when one value shadows another in Rust?</a></li>\n</ul>\n"}], "owner": {"reputation": 62, "user_id": 4451417, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-13c7wzXpg_w/AAAAAAAAAAI/AAAAAAAAAEk/54ePYfikKSI/photo.jpg?sz=128", "display_name": "Md5 Software", "link": "https://stackoverflow.com/users/4451417/md5-software"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1593041428, "creation_date": 1563505496, "last_edit_date": 1593041428, "question_id": 57104975, "link": "https://stackoverflow.com/questions/57104975/shadowing-in-rust-and-fighting-the-borrow-checker", "title": "Shadowing in Rust and Fighting the Borrow Checker", "body": "<p>Every time I take user input I created a new variable (via shadowing) to get the input. I think this is inefficient and not the purpose of shadowing, how else can I efficiently reuse the variable input?</p>\n<p>Without shadowing it gives the error <code>cannot borrow &quot;input&quot; as mutable because it is also borrowed as immutable</code>. As I understand taking user input requires a mutable reference.</p>\n<pre><code>use std::io; // Import for IO\n\nfn main() {\n    let name: &amp;str;                 // Variables\n    let balance: f32;               // Variables\n    let interest: f32;              // Variables\n    let mut input = String::new();  // Variables\n\n    println!(&quot;Please enter your name: &quot;); // Print\n    io::stdin().read_line(&amp;mut input).expect(&quot;failed to read from stdin&quot;);\n    name = input.trim();\n    println!(&quot;Please enter your bank account balance: &quot;); // Print\n\n    loop {\n        let mut input = String::new(); // Remove this and I get an error\n        io::stdin().read_line(&amp;mut input).expect(&quot;failed to read from stdin&quot;);\n\n        match input.trim().parse::&lt;f32&gt;() {\n            Ok(_) =&gt; {\n                balance = input.trim().parse().unwrap();\n                break;\n            },\n            Err(_) =&gt; println!(&quot;Your balance cannot contain letters or symbols&quot;),};\n        }\n    }\n\n    println!(&quot;Please enter your interest rate percent: &quot;); // Print\n     \n    loop {\n        let mut input = String::new(); // Remove this and I get an error\n        io::stdin().read_line(&amp;mut input).expect(&quot;failed to read from stdin&quot;);\n    \n        match input.trim().parse::&lt;f32&gt;() {\n            Ok(_) =&gt;  {   \n                interest = input.trim().parse().unwrap();\n                break;\n            },\n            Err(_) =&gt; println!(&quot;Your balance cannot contain letters or symbols&quot;),};       \n        }\n    }\n\n    println!(&quot;{}, your gain from interest is : ${}&quot;, name, (interest * balance * 0.01)); // Print\n}\n</code></pre>\n<p>Coming from Java I am perplexed on how borrowing works and when shadowing is a good idea. I understand that the old value still exists and any references to it which means if you don't need the old value anymore then you're taking up resources for no reason. Any advice is helpful, thanks.</p>\n"}, {"tags": ["unit-testing", "rust", "substrate", "parity-io"], "answers": [{"comments": [{"owner": {"reputation": 9375, "user_id": 1396977, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PylBh.jpg?s=128&g=1", "display_name": "Shawn Tabrizi", "link": "https://stackoverflow.com/users/1396977/shawn-tabrizi"}, "edited": false, "score": 0, "creation_date": 1563520948, "post_id": 57105131, "comment_id": 100734742, "body": "Note that this does not trigger any other functions like <code>on_finalize</code> or <code>on_initialize</code>. You will have to do that manually."}, {"owner": {"reputation": 42460, "user_id": 642626, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/fedc5e6b7fef29a8b539e20da8c85971?s=128&d=identicon&r=PG", "display_name": "Bryan Chen", "link": "https://stackoverflow.com/users/642626/bryan-chen"}, "reply_to_user": {"reputation": 9375, "user_id": 1396977, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/PylBh.jpg?s=128&g=1", "display_name": "Shawn Tabrizi", "link": "https://stackoverflow.com/users/1396977/shawn-tabrizi"}, "edited": false, "score": 1, "creation_date": 1563529157, "post_id": 57105131, "comment_id": 100738847, "body": "Tracking issue for fast forward blocks (instead of time): <a href=\"https://github.com/paritytech/substrate/issues/2818\" rel=\"nofollow noreferrer\">github.com/paritytech/substrate/issues/2818</a>"}, {"owner": {"reputation": 999, "user_id": 3798072, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/9JV4G.jpg?s=128&g=1", "display_name": "kianenigma", "link": "https://stackoverflow.com/users/3798072/kianenigma"}, "edited": false, "score": 0, "creation_date": 1568274318, "post_id": 57105131, "comment_id": 102224282, "body": "Additionally, you might need to call <code>session::rotate_session()</code> as well."}], "tags": [], "owner": {"reputation": 42460, "user_id": 642626, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/fedc5e6b7fef29a8b539e20da8c85971?s=128&d=identicon&r=PG", "display_name": "Bryan Chen", "link": "https://stackoverflow.com/users/642626/bryan-chen"}, "is_accepted": true, "score": 3, "last_activity_date": 1563506878, "creation_date": 1563506878, "answer_id": 57105131, "question_id": 57104802, "link": "https://stackoverflow.com/questions/57104802/fast-forward-time-when-writing-substrate-runtime-test/57105131#57105131", "title": "Fast forward time when writing Substrate Runtime Test", "body": "<p>You can just use <code>Timestamp::set_timestamp</code> to change the timestamp to whatever value you want. e.g. <code>Timestamp::set_timestamp(42);</code></p>\n\n<p>You can check the tests for <code>srml-timestamp</code> for examples</p>\n\n<p><a href=\"https://github.com/paritytech/substrate/blob/fe7f6aff197cd68e102539a42df1134d600b4584/srml/timestamp/src/lib.rs#L368\" rel=\"nofollow noreferrer\">https://github.com/paritytech/substrate/blob/fe7f6aff197cd68e102539a42df1134d600b4584/srml/timestamp/src/lib.rs#L368</a></p>\n"}], "owner": {"reputation": 842, "user_id": 523060, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d75657f4b4c80a3eaf3db8c3c77104d8?s=128&d=identicon&r=PG", "display_name": "Jimmy Chu", "link": "https://stackoverflow.com/users/523060/jimmy-chu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 57105131, "answer_count": 1, "score": 1, "last_activity_date": 1580545835, "creation_date": 1563503557, "last_edit_date": 1563524541, "question_id": 57104802, "link": "https://stackoverflow.com/questions/57104802/fast-forward-time-when-writing-substrate-runtime-test", "title": "Fast forward time when writing Substrate Runtime Test", "body": "<p>I am writing an auction type application with Substrate runtime. In writing test case, how can I fast forward the blockchain time (what's retrieved from <code>&lt;timestamp::Module&lt;T&gt;&gt;::get()</code>) so I can reach the auction closing time and test the closing logic?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["string", "rust", "match"], "answers": [{"tags": [], "owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "is_accepted": true, "score": 7, "last_activity_date": 1563479239, "creation_date": 1563479239, "answer_id": 57101692, "question_id": 57101650, "link": "https://stackoverflow.com/questions/57101650/how-to-match-string-against-string-in-rust/57101692#57101692", "title": "How to match String against String in Rust?", "body": "<p><a href=\"https://doc.rust-lang.org/std/string/struct.String.html#method.starts_with\" rel=\"noreferrer\"><code>starts_with</code></a> takes an argument which implements <a href=\"https://doc.rust-lang.org/std/str/pattern/trait.Pattern.html\" rel=\"noreferrer\"><code>Pattern</code></a>. There is not a <code>Pattern</code> instance for <code>String</code>, but there is one for <code>&amp;String</code>.</p>\n\n<pre><code>fn main() {\n  let a = String::from(\"hello world!\");\n  let b = String::from(\"hello\");\n  a.starts_with(&amp;b);\n}\n</code></pre>\n"}], "owner": {"reputation": 2792, "user_id": 8626243, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LYirU.jpg?s=128&g=1", "display_name": "Zhiyao", "link": "https://stackoverflow.com/users/8626243/zhiyao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 0, "accepted_answer_id": 57101692, "answer_count": 1, "score": 2, "last_activity_date": 1564465459, "creation_date": 1563479030, "last_edit_date": 1564465459, "question_id": 57101650, "link": "https://stackoverflow.com/questions/57101650/how-to-match-string-against-string-in-rust", "title": "How to match String against String in Rust?", "body": "<p>I would like to decide whether a String begins with another String in Rust.</p>\n\n<p>I saw similar questions of asking matching String against literal string in Rust, but that does not work here. For example in the following code,</p>\n\n<pre><code>fn main() {\n    let a = String::from(\"hello world!\");\n    let b = String::from(\"hello\");\n    a.starts_with(b);\n}\n</code></pre>\n\n<p>The compiler complains:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: expected a `std::ops::FnMut&lt;(char,)&gt;` closure, found `std::string::String`\n --&gt; temp.rs:4:7\n  |\n4 |     a.starts_with(b);\n  |       ^^^^^^^^^^^ expected an `FnMut&lt;(char,)&gt;` closure, found `std::string::String`\n  |\n  = help: the trait `std::ops::FnMut&lt;(char,)&gt;` is not implemented for `std::string::String`\n  = note: required because of the requirements on the impl of `std::str::pattern::Pattern&lt;'_&gt;` for `std::string::String`\n</code></pre>\n\n<p>I could implement the simple function manually, but that is reimplementing wheels. How can I get this done gracefully in Rust?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 22505, "user_id": 1411457, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XqssD.png?s=128&g=1", "display_name": "harmic", "link": "https://stackoverflow.com/users/1411457/harmic"}, "edited": false, "score": 0, "creation_date": 1563498223, "post_id": 57100454, "comment_id": 100729328, "body": "Surely you&#39;d use <code>Vec&lt;u8&gt;</code> ?"}, {"owner": {"reputation": 1286, "user_id": 675799, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/87c5d0a7b707c5bfc04b415e96edef11?s=128&d=identicon&r=PG", "display_name": "krokodil", "link": "https://stackoverflow.com/users/675799/krokodil"}, "reply_to_user": {"reputation": 22505, "user_id": 1411457, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XqssD.png?s=128&g=1", "display_name": "harmic", "link": "https://stackoverflow.com/users/1411457/harmic"}, "edited": false, "score": 0, "creation_date": 1563557827, "post_id": 57100454, "comment_id": 100753068, "body": "my data structure is readonly. Can I make it readonly? Also how efficient is index access? For example, doing repeatedly <code>vec[n]</code> version calculating <code>vec+n</code> in C once and using it repeatedly."}, {"owner": {"reputation": 34798, "user_id": 1362755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97aa8c37ffa60c4262955aefae56e605?s=128&d=identicon&r=PG", "display_name": "the8472", "link": "https://stackoverflow.com/users/1362755/the8472"}, "edited": false, "score": 0, "creation_date": 1563572854, "post_id": 57100454, "comment_id": 100758189, "body": "Which of your requirements are not met by <code>&amp;[u8]</code>?"}, {"owner": {"reputation": 1286, "user_id": 675799, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/87c5d0a7b707c5bfc04b415e96edef11?s=128&d=identicon&r=PG", "display_name": "krokodil", "link": "https://stackoverflow.com/users/675799/krokodil"}, "reply_to_user": {"reputation": 34798, "user_id": 1362755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97aa8c37ffa60c4262955aefae56e605?s=128&d=identicon&r=PG", "display_name": "the8472", "link": "https://stackoverflow.com/users/1362755/the8472"}, "edited": false, "score": 0, "creation_date": 1565152546, "post_id": 57100454, "comment_id": 101257341, "body": "@the8472 bounds checking (reading past allocated memory block), read-only (I guess I can add <code>const</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 34798, "user_id": 1362755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97aa8c37ffa60c4262955aefae56e605?s=128&d=identicon&r=PG", "display_name": "the8472", "link": "https://stackoverflow.com/users/1362755/the8472"}, "edited": false, "score": 0, "creation_date": 1563821644, "post_id": 57121978, "comment_id": 100819370, "body": "<i>That is the minimum you could get away with, really</i> - not quite, <code>Box&lt;[u8]&gt;</code> would be smaller."}], "tags": [], "owner": {"reputation": 22505, "user_id": 1411457, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XqssD.png?s=128&g=1", "display_name": "harmic", "link": "https://stackoverflow.com/users/1411457/harmic"}, "is_accepted": true, "score": 0, "last_activity_date": 1563599296, "creation_date": 1563599296, "answer_id": 57121978, "question_id": 57100454, "link": "https://stackoverflow.com/questions/57100454/pointer-like-constant-memory-type-in-rust/57121978#57121978", "title": "pointer-like constant memory type in Rust", "body": "<p>If you want a heap allocated immutable buffer of bytes <a href=\"https://doc.rust-lang.org/std/vec/struct.Vec.html\" rel=\"nofollow noreferrer\"><code>Vec&lt;u8&gt;</code></a> is the obvious choice.</p>\n\n<p>From the tone of your question, I suspect you might be thinking there is too much overhead with a Vec - not so:</p>\n\n<ul>\n<li><p>It contains only a pointer to the allocated heap memory and the size. That is the minimum you could get away with, really, if you want a safe place to store your protocol message</p></li>\n<li><p>In line with the philosophy of rust: you only pay for the features you use. </p></li>\n<li><p>Because it is a fundamental building block, the std library designers have made a lot of guarantees about it's design that allow it to be used in a very low overhead way. I recommend reading the std library docs linked above - there is a section on these guarantees.</p></li>\n</ul>\n\n<blockquote>\n  <p>Can I make it read-only?</p>\n</blockquote>\n\n<p>Yes, all variables in rust are immutable unless you declare them <code>mut</code>. You can even start with it being mutable (necessary if you intend to fill the buffer to begin with) and then rebind to an immutable variable.</p>\n\n<blockquote>\n  <p>Also how efficient is index access? For example, doing repeatedly vec[n] version calculating vec+n in C once and using it repeatedly.</p>\n</blockquote>\n\n<p>Before worrying about that, I recommend writing your code in the way that is clearest and most logical. The compiler will make optimizations that may well make these concerns meaningless. If, after profiling, you have performance issues then sure there are tweaks you could make. </p>\n\n<p>If you want to access a single element multiple times, you could take a reference to it:</p>\n\n<pre><code>let el = &amp;buf[n];\n</code></pre>\n\n<p>then use <code>*el</code> to reference the element. </p>\n\n<p>If you want to move through the buffer sequentially, then use an iterator, rather than sequentially indexing the bytes. An iterator is implemented with pointers internally.</p>\n\n<p>If you want to pass around a part of the buffer, without copying, then take a slice:</p>\n\n<pre><code>let s1 = &amp;buf[10..12];\n// s1 now contains a slice of bytes 10 through 12\n</code></pre>\n\n<p>Again, a slice is low overhead: a pointer to the start and a length.</p>\n\n<p>All of the above is safe code. There are also unsafe functions (eg. <code>get_unchecked</code> to access an element without bounds checking). You can even get a raw pointer with <code>as_ptr()</code> if you really need it.</p>\n"}], "owner": {"reputation": 1286, "user_id": 675799, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/87c5d0a7b707c5bfc04b415e96edef11?s=128&d=identicon&r=PG", "display_name": "krokodil", "link": "https://stackoverflow.com/users/675799/krokodil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 57121978, "answer_count": 1, "score": 0, "last_activity_date": 1563599296, "creation_date": 1563473616, "last_edit_date": 1563570273, "question_id": 57100454, "link": "https://stackoverflow.com/questions/57100454/pointer-like-constant-memory-type-in-rust", "title": "pointer-like constant memory type in Rust", "body": "<p>I am writing a simple network protocol implementation in Rust as an exercise. It will be reading a Protocol Data Unit from a socket to memory and proceed to parse its components into Rust <code>struct</code> with appropriate fields.</p>\n\n<p>What would be the best type for memory block which could be used in parsing? I should be able to call separate functions to parse parts of it at different offsets. In C I would go with simple <code>const char *</code>. Looks like raw pointers in Rust are possible but do not provide any additional safety benefits since most operations on them are unsafe and there are no bounds checking.</p>\n\n<p>On the other hand, I would like to keep the PDU block on the heap as a continuous memory block, exactly as it was read from the socket. In other words, I do not ant any representation overhead.</p>\n"}, {"tags": ["rust", "thread-safety"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1563473158, "post_id": 57099873, "comment_id": 100721804, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/27791532/how-do-i-create-a-global-mutable-singleton\">How do I create a global, mutable singleton?</a>"}, {"owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563482675, "post_id": 57099873, "comment_id": 100725671, "body": "the global mutable singleton answer does not directly lead to working code.  There are extra techniques needed to make it work."}], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563485206, "post_id": 57102375, "comment_id": 100726642, "body": "more simply: <a href=\"https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=a5272e90d395c508ed5d5c82bfcc1d21\" rel=\"nofollow noreferrer\">play.integer32.com/&hellip;</a>"}, {"owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563543509, "post_id": 57102375, "comment_id": 100746101, "body": "There ended up being a couple of ways to arrange the <code>if</code>, like <code>if let Ok(mut f) = tmp.as_mut() {</code> .  I&#39;m not sure if there&#39;s a stylistic ranking for them.  I often introduce a variable so I can see how IntelliJ guesses the type and then explicitly declare the type to help me understand what is going on and give me access to the source in the crate through IntelliJ&#39;s Go To&gt;Declaration ability.  It is like the ancient trade-off of compactness for &quot;readability&quot;."}], "tags": [], "owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "is_accepted": false, "score": 0, "last_activity_date": 1563482543, "creation_date": 1563482543, "answer_id": 57102375, "question_id": 57099873, "link": "https://stackoverflow.com/questions/57099873/what-is-a-code-compact-thread-safe-way-to-dump-debugging-data-to-a-static-file-i/57102375#57102375", "title": "What is a code-compact thread-safe way to dump debugging data to a static File in Rust?", "body": "<p>The first attempt at <code>lazy_static!</code> usage would be</p>\n\n<pre><code>use lazy_static::lazy_static;\nuse std::sync::Mutex;\n\nuse std::fs::File;\nuse std::io::Write;\n\n\nlazy_static! {\nstatic ref meshes : Mutex&lt;Result&lt;File, std::io::Error&gt;&gt; = Mutex::new(File::open(\"/tmp/meshes.txt\"));\n}\n\npub fn log_mesh(message: &amp;str)\n{\n    let mut tmp = meshes.lock().unwrap();\n\n    if let Ok(ref mut f) = tmp {\n        f.write_all(message.as_bytes());\n        f.flush();\n    }\n}\n</code></pre>\n\n<p>which triggers this compile error:</p>\n\n<pre><code>error[E0308]: mismatched types\n  --&gt; src/module2.rs:16:12\n   |\n16 |     if let Ok(ref mut f) = tmp {\n   |            ^^^^^^^^^^^^^   --- this match expression has type `std::sync::MutexGuard&lt;'_, std::result::Result&lt;std::fs::File, std::io::Error&gt;&gt;`\n   |            |\n   |            expected struct `std::sync::MutexGuard`, found enum `std::result::Result`\n   |\n   = note: expected type `std::sync::MutexGuard&lt;'_, std::result::Result&lt;std::fs::File, std::io::Error&gt;, &gt;`\n              found type `std::result::Result&lt;_, _&gt;`\n</code></pre>\n\n<p>which is somewhat discouraging and chock-full of behind-the-curtain magic, but can be solved by changing it to</p>\n\n<pre><code>    if let Ok(ref mut f) = *tmp {\n</code></pre>\n\n<p>I hesitate to mark it as an answer because there could be race conditions a more experienced coder can spot or another idiom that is superior.</p>\n"}], "owner": {"reputation": 1907, "user_id": 995935, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/uO0in.gif?s=128&g=1", "display_name": "Mutant Bob", "link": "https://stackoverflow.com/users/995935/mutant-bob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563482543, "creation_date": 1563471029, "question_id": 57099873, "link": "https://stackoverflow.com/questions/57099873/what-is-a-code-compact-thread-safe-way-to-dump-debugging-data-to-a-static-file-i", "title": "What is a code-compact thread-safe way to dump debugging data to a static File in Rust?", "body": "<p>I am testing some Rust code and want to log some of the intermediate data to a file to make sure it is correct before I write the next element in the pipeline that consumes the data.  In any other language I'd just write the data to a file handle stored in a static variable, but rust complains (correctly) that this is not thread safe.  Since the application in question uses gstreamer this is theoretically a threat.  I'll just paste my naive version below:</p>\n\n<pre><code>use std::fs::File;\nuse std::io::Write;\n\nfn main() {\n    log_mesh(\"bacon\");\n}\n\nstatic mut meshes : Option&lt;Result&lt;File, std::io::Error&gt;&gt; = None;\n\nfn log_mesh(message: &amp;str)\n{\n    if let None = meshes {\n        meshes = Some(File::open(\"/tmp/meshes.txt\"));\n    }\n\n    if let Ok(mut f) = meshes.unwrap() {\n        f.write_all(message.as_bytes());\n        f.flush();\n    }\n}\n</code></pre>\n\n<p>This results in two important kinds of compile errors:</p>\n\n<pre><code>error[E0507]: cannot move out of static item\n  --&gt; src/main.rs:16:24\n   |\n16 |     if let Ok(mut f) = meshes.unwrap() {\n   |                        ^^^^^^ cannot move out of static item\n\nerror[E0133]: use of mutable static is unsafe and requires unsafe function or block\n  --&gt; src/main.rs:12:19\n   |\n12 |     if let None = meshes {\n   |                   ^^^^^^ use of mutable static\n   |\n   = note: mutable statics can be mutated by multiple threads: aliasing violations or data races will cause undefined behavior\n</code></pre>\n\n<p>I have flailed around with <code>Mutex</code>, <code>lazy_static!</code>, <code>mut_static</code>, but all of them lead me into the woods and I get lost.  I assume there has to be some compact idiom to solve this problem that isn't coming up in Google search results.</p>\n"}, {"tags": ["javascript", "node.js", "rust", "webassembly"], "comments": [{"owner": {"reputation": 2173, "user_id": 1804656, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/47ea159b5819a724a31a95f8dd1fc037?s=128&d=identicon&r=PG", "display_name": "kyle", "link": "https://stackoverflow.com/users/1804656/kyle"}, "edited": false, "score": 0, "creation_date": 1563482712, "post_id": 57099410, "comment_id": 100725698, "body": "Does the pkg/dom file exist?"}, {"owner": {"reputation": 73, "user_id": 9785509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ho1Ph.png?s=128&g=1", "display_name": "Kamil Xovitz", "link": "https://stackoverflow.com/users/9785509/kamil-xovitz"}, "reply_to_user": {"reputation": 2173, "user_id": 1804656, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/47ea159b5819a724a31a95f8dd1fc037?s=128&d=identicon&r=PG", "display_name": "kyle", "link": "https://stackoverflow.com/users/1804656/kyle"}, "edited": false, "score": 0, "creation_date": 1563483075, "post_id": 57099410, "comment_id": 100725842, "body": "No. Forgot to mention that. I don&#39;t know how to generate it, or what should be in it."}, {"owner": {"reputation": 2173, "user_id": 1804656, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/47ea159b5819a724a31a95f8dd1fc037?s=128&d=identicon&r=PG", "display_name": "kyle", "link": "https://stackoverflow.com/users/1804656/kyle"}, "edited": false, "score": 0, "creation_date": 1563483364, "post_id": 57099410, "comment_id": 100725960, "body": "Did you download everything in the dom example folder? I just did, ran <code>yarn</code> and then <code>yarn serve</code> and it works correctly as well as generates the pkg folder and file."}, {"owner": {"reputation": 73, "user_id": 9785509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ho1Ph.png?s=128&g=1", "display_name": "Kamil Xovitz", "link": "https://stackoverflow.com/users/9785509/kamil-xovitz"}, "reply_to_user": {"reputation": 2173, "user_id": 1804656, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/47ea159b5819a724a31a95f8dd1fc037?s=128&d=identicon&r=PG", "display_name": "kyle", "link": "https://stackoverflow.com/users/1804656/kyle"}, "edited": false, "score": 0, "creation_date": 1563484662, "post_id": 57099410, "comment_id": 100726430, "body": "Yes, I have everything. Why did you use yarn? I&#39;m not familiar with it. I thought cargo will be enough to build this."}, {"owner": {"reputation": 73, "user_id": 9785509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ho1Ph.png?s=128&g=1", "display_name": "Kamil Xovitz", "link": "https://stackoverflow.com/users/9785509/kamil-xovitz"}, "reply_to_user": {"reputation": 2173, "user_id": 1804656, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/47ea159b5819a724a31a95f8dd1fc037?s=128&d=identicon&r=PG", "display_name": "kyle", "link": "https://stackoverflow.com/users/1804656/kyle"}, "edited": false, "score": 0, "creation_date": 1563485083, "post_id": 57099410, "comment_id": 100726593, "body": "I&#39;ve tried this approach with yarn (on clean pull). The result is still the same."}, {"owner": {"reputation": 2173, "user_id": 1804656, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/47ea159b5819a724a31a95f8dd1fc037?s=128&d=identicon&r=PG", "display_name": "kyle", "link": "https://stackoverflow.com/users/1804656/kyle"}, "edited": false, "score": 0, "creation_date": 1563486265, "post_id": 57099410, "comment_id": 100727010, "body": "I prefer yarn, it isn&#39;t required. But you shouldn&#39;t need to call cargo at all -- wasm-pack will build the rust code for you.  You could call cargo to generate the wasm file but then you would have to manually create the js file that creates the wasm heap."}, {"owner": {"reputation": 2173, "user_id": 1804656, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/47ea159b5819a724a31a95f8dd1fc037?s=128&d=identicon&r=PG", "display_name": "kyle", "link": "https://stackoverflow.com/users/1804656/kyle"}, "edited": false, "score": 0, "creation_date": 1563486342, "post_id": 57099410, "comment_id": 100727032, "body": "Also what version of node and rustc are you using?"}, {"owner": {"reputation": 73, "user_id": 9785509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ho1Ph.png?s=128&g=1", "display_name": "Kamil Xovitz", "link": "https://stackoverflow.com/users/9785509/kamil-xovitz"}, "reply_to_user": {"reputation": 2173, "user_id": 1804656, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/47ea159b5819a724a31a95f8dd1fc037?s=128&d=identicon&r=PG", "display_name": "kyle", "link": "https://stackoverflow.com/users/1804656/kyle"}, "edited": false, "score": 0, "creation_date": 1563487589, "post_id": 57099410, "comment_id": 100727401, "body": "<code>rustc 1.35.0 (3c235d560 2019-05-20)</code> node <code>v11.15.0</code>"}, {"owner": {"reputation": 73, "user_id": 9785509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ho1Ph.png?s=128&g=1", "display_name": "Kamil Xovitz", "link": "https://stackoverflow.com/users/9785509/kamil-xovitz"}, "reply_to_user": {"reputation": 2173, "user_id": 1804656, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/47ea159b5819a724a31a95f8dd1fc037?s=128&d=identicon&r=PG", "display_name": "kyle", "link": "https://stackoverflow.com/users/1804656/kyle"}, "edited": false, "score": 0, "creation_date": 1563571970, "post_id": 57099410, "comment_id": 100757967, "body": "kyle, what this generated folder contains?"}, {"owner": {"reputation": 7933, "user_id": 343834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7db87ae1ef295bd3616a0dc8dd1e5e6?s=128&d=identicon&r=PG", "display_name": "Maxime R.", "link": "https://stackoverflow.com/users/343834/maxime-r"}, "edited": false, "score": 0, "creation_date": 1574639474, "post_id": 57099410, "comment_id": 104292098, "body": "since you&#39;re using wasm-pack try running <code>wasm-pack build</code> instead of <code>cargo build</code>, it&#39;s what generates the ./pkg folder. You have a <code>wasm-pack error: undefined</code> error..."}], "answers": [{"tags": [], "owner": {"reputation": 2860, "user_id": 2016353, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0d7b22e8ea693b36a249f7f626df6439?s=128&d=identicon&r=PG", "display_name": "Daniel Bank", "link": "https://stackoverflow.com/users/2016353/daniel-bank"}, "is_accepted": false, "score": 1, "last_activity_date": 1589166791, "creation_date": 1589166791, "answer_id": 61721707, "question_id": 57099410, "link": "https://stackoverflow.com/questions/57099410/js-import-not-finding-wasm-file/61721707#61721707", "title": "js import not finding wasm file", "body": "<p>The index.js file is trying to <code>import('./pkg')</code> which doesn't exist.  You generate this folder by running <code>wasm-pack build</code>.  After doing so, you should have a <code>./pkg</code> folder which contains the wasm binary and JS wrapper code.  See the <a href=\"https://github.com/rustwasm/wasm-pack#%EF%B8%8F-commands\" rel=\"nofollow noreferrer\">wasm-pack README</a> for more information on commands.</p>\n\n<p>Playing with Rust, it is tempting to just call <code>cargo build</code> and expect it to create the wasm binary, however wasm-pack is actually <a href=\"https://github.com/rustwasm/wasm-pack/blob/master/src/command/build.rs#L177\" rel=\"nofollow noreferrer\">doing a lot more</a> under the hood.  Ultimately though, <code>wasm-pack build</code> does call <a href=\"https://github.com/rustwasm/wasm-pack/blob/master/src/build/mod.rs#L119\" rel=\"nofollow noreferrer\">cargo build</a>.</p>\n"}], "owner": {"reputation": 73, "user_id": 9785509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ho1Ph.png?s=128&g=1", "display_name": "Kamil Xovitz", "link": "https://stackoverflow.com/users/9785509/kamil-xovitz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 547, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1589166791, "creation_date": 1563469010, "last_edit_date": 1563484304, "question_id": 57099410, "link": "https://stackoverflow.com/questions/57099410/js-import-not-finding-wasm-file", "title": "js import not finding wasm file", "body": "<p>I'm striving to build following example of wasm from rust :</p>\n\n<p><a href=\"https://github.com/rustwasm/wasm-bindgen/tree/master/examples/dom\" rel=\"nofollow noreferrer\">example</a></p>\n\n<p>I've executed</p>\n\n<blockquote>\n  <p>cargo build</p>\n</blockquote>\n\n<p>and it resolved with libdom.d and libdom.so files in target/debug/ file.</p>\n\n<p>Application starts with given </p>\n\n<blockquote>\n  <p>npm run serve</p>\n</blockquote>\n\n<p>but it throws error when js tries to import wasm file on line:</p>\n\n<blockquote>\n  <p>import('./pkg/dom')</p>\n</blockquote>\n\n<p>resulting with </p>\n\n<pre><code>&gt; @ serve /home/kamil/projects/dom\n&gt; webpack-dev-server\n\n\ud83e\uddd0  Checking for wasm-pack...\n\n\u2139\ufe0f  Installing wasm-pack \n\n\u2139 \uff62wds\uff63: Project is running at http://localhost:8080/\n\u2139 \uff62wds\uff63: webpack output is served from /\n\u2139 \uff62wds\uff63: Content not from webpack is served from /home/kamil/projects/dom\n\u2139 \uff62wdm\uff63: wait until bundle finished: /\nwasm-pack error: undefined\n\u2716 \uff62wdm\uff63: Hash: d6af309c4a2560e4a081\nVersion: webpack 4.36.1\nTime: 21666ms\nBuilt at: 07/18/2019 6:53:10 PM\n     Asset       Size  Chunks             Chunk Names\nindex.html  226 bytes          [emitted]  \n  index.js    360 KiB    main  [emitted]  main\nEntrypoint main = index.js\n[0] multi (webpack)-dev-server/client?http://localhost ./index.js 40 bytes {main} [built]\n[./index.js] 133 bytes {main} [built]\n[./node_modules/ansi-html/index.js] 4.16 KiB {main} [built]\n[./node_modules/ansi-regex/index.js] 135 bytes {main} [built]\n[./node_modules/html-entities/index.js] 231 bytes {main} [built]\n[./node_modules/loglevel/lib/loglevel.js] 7.68 KiB {main} [built]\n[./node_modules/strip-ansi/index.js] 161 bytes {main} [built]\n[./node_modules/webpack-dev-server/client/index.js?http://localhost] (webpack)-dev-server/client?http://localhost 4.29 KiB {main} [built]\n[./node_modules/webpack-dev-server/client/overlay.js] (webpack)-dev-server/client/overlay.js 3.51 KiB {main} [built]\n[./node_modules/webpack-dev-server/client/socket.js] (webpack)-dev-server/client/socket.js 1.53 KiB {main} [built]\n[./node_modules/webpack-dev-server/client/utils/createSocketUrl.js] (webpack)-dev-server/client/utils/createSocketUrl.js 2.77 KiB {main} [built]\n[./node_modules/webpack-dev-server/client/utils/log.js] (webpack)-dev-server/client/utils/log.js 964 bytes {main} [built]\n[./node_modules/webpack-dev-server/client/utils/reloadApp.js] (webpack)-dev-server/client/utils/reloadApp.js 1.63 KiB {main} [built]\n[./node_modules/webpack-dev-server/client/utils/sendMessage.js] (webpack)-dev-server/client/utils/sendMessage.js 402 bytes {main} [built]\n[./node_modules/webpack/hot sync ^\\.\\/log$] (webpack)/hot sync nonrecursive ^\\.\\/log$ 170 bytes {main} [built]\n    + 18 hidden modules\n\nERROR in ./index.js\nModule not found: Error: Can't resolve './pkg/dom' in '/home/kamil/projects/dom'\n @ ./index.js 3:0-19\nChild html-webpack-plugin for \"index.html\":\n     1 asset\n    Entrypoint undefined = index.html\n    [./node_modules/html-webpack-plugin/lib/loader.js!./index.html] 372 bytes {0} [built]\n    [./node_modules/lodash/lodash.js] 528 KiB {0} [built]\n    [./node_modules/webpack/buildin/global.js] (webpack)/buildin/global.js 472 bytes {0} [built]\n    [./node_modules/webpack/buildin/module.js] (webpack)/buildin/module.js 497 bytes {0} [built]\n\u2139 \uff62wdm\uff63: Failed to compile.\n</code></pre>\n\n<p>There is no <code>./pkg/dom</code> folder. I don't know how to generate it, or what should be in it.</p>\n"}, {"tags": ["rust", "stream", "rust-tokio"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1563461837, "post_id": 57097276, "comment_id": 100716125, "body": "Why don&#39;t u use: <code>StateStream&lt;T, I&gt; where I: Iterator&lt;Item = T&gt;</code>"}, {"owner": {"reputation": 1565, "user_id": 758801, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/2xIHo.png?s=128&g=1", "display_name": "Mats Kindahl", "link": "https://stackoverflow.com/users/758801/mats-kindahl"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1563462118, "post_id": 57097276, "comment_id": 100716294, "body": "It is possible, if I want a generic <code>StateStream</code>, but in this case I made the question simpler by using a concrete type."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1563462197, "post_id": 57097276, "comment_id": 100716349, "body": "Your question could be much smaller. It boils down to the fact that the compiler cannot infer <code>I</code>."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1563462342, "post_id": 57097276, "comment_id": 100716425, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/32551177/expected-type-parameter-error-in-the-constructor-of-a-generic-struct\">&quot;Expected type parameter&quot; error in the constructor of a generic struct</a>"}, {"owner": {"reputation": 1565, "user_id": 758801, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/2xIHo.png?s=128&g=1", "display_name": "Mats Kindahl", "link": "https://stackoverflow.com/users/758801/mats-kindahl"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1563463871, "post_id": 57097276, "comment_id": 100717323, "body": "But it is a generic struct is <code>Cycle&lt;I&gt;</code> and it tries to match <code>Cycle&lt;std::slice::Iter&lt;i32&gt;&gt;</code>, which can&#39;t it deduce <code>I</code> to be <code>std::slice::Iter&lt;i32&gt;</code>?"}, {"owner": {"reputation": 1565, "user_id": 758801, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/2xIHo.png?s=128&g=1", "display_name": "Mats Kindahl", "link": "https://stackoverflow.com/users/758801/mats-kindahl"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1563463895, "post_id": 57097276, "comment_id": 100717341, "body": "I have referenced that question in the post."}], "owner": {"reputation": 1565, "user_id": 758801, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/2xIHo.png?s=128&g=1", "display_name": "Mats Kindahl", "link": "https://stackoverflow.com/users/758801/mats-kindahl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1563518554, "creation_date": 1563461198, "last_edit_date": 1563518554, "question_id": 57097276, "link": "https://stackoverflow.com/questions/57097276/creating-a-cyclic-tokio-stream-connected-to-a-shared-state", "title": "Creating a cyclic Tokio stream connected to a shared state", "body": "<p>I am running into a problem that I do not really understand and hoped\nthat somebody might be able to see what I have misunderstood.</p>\n\n<p>The problem is quite straightforward: I have a global state (shared\nbetween several tasks) and want to have an infinite cycle over a\nvector in the global state. I will then zip that with an interval\nstream and hence get a regular emission of the next value in the\nstream.</p>\n\n<p>If the vector in the state changes, the inifinite stream should just\nreload the vector and start reading from the new one instead, and\ndiscard the old array.</p>\n\n<p>Here is the code that I've gotten this far, and the questions are at\nthe end of the post.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use futures::stream::Stream;\nuse futures::{Async, Poll};\nuse std::iter::Cycle;\nuse std::sync::{Arc, Mutex};\nuse std::time::{Duration, Instant};\nuse tokio::timer::Interval;\n</code></pre>\n\n<p>We define a global state that hold an array that can be\nupdated. Whenever the array is updated, we will step the version and\nset the array.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct State&lt;T&gt; {\n    version: u32,\n    array: Vec&lt;T&gt;,\n}\n\nimpl&lt;T&gt; State&lt;T&gt; {\n    fn new(array: Vec&lt;T&gt;) -&gt; Self {\n        Self {\n            version: 0,\n            array: Vec::new(),\n        }\n    }\n\n    fn update(&amp;mut self, array: Vec&lt;T&gt;) {\n        self.version += 1;\n        self.array = array;\n    }\n}\n</code></pre>\n\n<p>Now, we create an stream over the state. When initialized, it will\nread the array and version from the state and store it and then keep\nan instance of <code>std::iter::Cycle</code> internally that will cycle over the\narray.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct StateStream&lt;I&gt; {\n    state: Arc&lt;Mutex&lt;State&lt;I::Item&gt;&gt;&gt;,\n    version: u32,\n    iter: Cycle&lt;I&gt;,\n}\n\nimpl&lt;I&gt; StateStream&lt;I&gt;\nwhere\n    I: Iterator,\n{\n    fn new(state: Arc&lt;Mutex&lt;State&lt;I::Item&gt;&gt;&gt;) -&gt; Self {\n        let (version, array) = {\n            let locked_state = state.lock().unwrap();\n            (locked_state.version, locked_state.array)\n        };\n\n        Self {\n            state: state,\n            version: version,\n            iter: array.iter().cycle(),\n        }\n    }\n}   \n</code></pre>\n\n<p>We now implement the stream for the <code>StateStream</code>. With each poll, it\nwill check if the version of the state changed, and if it did, reload\nthe array and version.</p>\n\n<p>We will then take the next item from the iterator and return that.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl&lt;I&gt; Stream for StateStream&lt;I&gt;\nwhere\n    I: Iterator + Clone,\n{\n    type Item = I::Item;\n    type Error = ();\n\n    fn poll(&amp;mut self) -&gt; Poll&lt;Option&lt;Self::Item&gt;, Self::Error&gt; {\n        let locked_state = self.state.lock().unwrap();\n        if locked_state.version &gt; self.version {\n            self.iter = locked_state.array.clone().iter().cycle();\n            self.version = locked_state.version;\n        }\n        Ok(Async::Ready(self.iter.next()))\n    }\n}\n</code></pre>\n\n<p>The main program looks like this. I do not update the vector here, but\nthat is not important for the case at hand.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    let state = Arc::new(Mutex::new(State::new(vec![2, 3, 5, 7, 11, 13])));\n    let primes = StateStream::new(state)\n        .take(20)\n        .zip(\n            Interval::new(Instant::now(), Duration::from_millis(500))\n                .map_err(|err| println!(\"Error: {}\", err)),\n        )\n        .for_each(|(number, instant)| {\n            println!(\"fire; number={}, instant={:?}\", number, instant);\n            Ok(())\n        });\n    tokio::run(primes);\n}\n</code></pre>\n\n<p>When compiling this, I get the following errors:</p>\n\n<pre><code>cargo run --example cycle_stream_shared\n   Compiling tokio-testing v0.1.0 (/home/mats/crates/tokio-examples)\nerror[E0308]: mismatched types\n  --&gt; examples/cycle_stream_shared.rs:66:19\n   |\n66 |             iter: array.iter().cycle(),\n   |                   ^^^^^^^^^^^^^^^^^^^^ expected type parameter, found struct `std::slice::Iter`\n   |\n   = note: expected type `std::iter::Cycle&lt;I&gt;`\n              found type `std::iter::Cycle&lt;std::slice::Iter&lt;'_, &lt;I as std::iter::Iterator&gt;::Item&gt;&gt;`\n\nerror[E0308]: mismatched types\n  --&gt; examples/cycle_stream_shared.rs:81:25\n   |\n81 |             self.iter = locked_state.array.clone().iter().cycle();\n   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected type parameter, found struct `std::slice::Iter`\n   |\n   = note: expected type `std::iter::Cycle&lt;I&gt;`\n              found type `std::iter::Cycle&lt;std::slice::Iter&lt;'_, &lt;I as std::iter::Iterator&gt;::Item&gt;&gt;`\n\nerror: aborting due to 2 previous errors\n\nFor more information about this error, try `rustc --explain E0308`.\nerror: Could not compile `tokio-testing`.\n\nTo learn more, run the command again with --verbose.\n</code></pre>\n\n<p>Now, the error and the explanation says that the concrete type is not\npossible to derive, but in this case, I am using the generic struct\n<code>Cycle&lt;I&gt;</code> and expect <code>I</code> to be instantiated to <code>std::slice::Iter&lt;'_,\nI::Item&gt;</code>. Since <code>std::slice::Iter</code> has implemented <code>Iterator</code> and, the type have implemented all necessary traits to match.</p>\n\n<p>Some answers to similar questions exist, but nothing that seems to\nmatch this case:</p>\n\n<ul>\n<li><p><a href=\"https://stackoverflow.com/questions/32551177/expected-type-parameter-error-in-the-constructor-of-a-generic-struct\">\u201cExpected type parameter\u201d error in the constructor of a generic\nstruct</a> is showing that the types do not match (same\nas the explanation gives) because the generic struct definition allow any type, but the construction require a specific type.</p>\n\n<p>In this case, we are using a generic type <code>Cycle&lt;I&gt;</code>, where <code>I</code> should implement the <code>Iterator</code> trait, and try to use a type <code>std::slice::Iter&lt;..&gt;</code> that <em>does</em> implement <code>Iterator</code>.</p></li>\n<li><p><a href=\"https://stackoverflow.com/questions/30661046/how-do-i-return-an-instance-of-a-trait-from-a-method\">How do I return an instance of a trait from a\nmethod?</a> talk about how to return an arbitrary type\nmatching a trait, which is not the case here.</p></li>\n</ul>\n\n<p>The other questions are mostly referring to these two, or variations\nof these.</p>\n\n<p><strong>Update:</strong> Changed it to be a generic type to demonstrate that it still does not work.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1563477520, "post_id": 57096621, "comment_id": 100723641, "body": "one way: <a href=\"https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=51db844af5fdebc7ed9cf7a5d052617c\" rel=\"nofollow noreferrer\">play.integer32.com/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1563465360, "post_id": 57097307, "comment_id": 100718225, "body": "The suggested change is not a generalization because you can&#39;t pass <code>Vec&lt;&amp;mut Box&lt;dyn Listener&gt;&gt;</code> anymore. You need <code>+ ?Sized</code> on <code>T</code> to allow both (trait objects and concrete types)."}, {"owner": {"reputation": 344, "user_id": 7174977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4e5b70f1390f44dbc78b3e2342cddfd?s=128&d=identicon&r=PG&f=1", "display_name": "Hellstorm", "link": "https://stackoverflow.com/users/7174977/hellstorm"}, "edited": false, "score": 0, "creation_date": 1563516113, "post_id": 57097307, "comment_id": 100732802, "body": "Thanks. This worked for one type. I could add <code>Mock</code> to the vector. Unfortunately, if I create a second struct <code>Mock2</code> which implements <code>Listener</code>, the compiler complains about: <code>^^^^^^^^^^ expected struct </code>Mock<code>, found struct </code>Mock2``. I&#39;ve read in the Rust book, that the <code>dyn</code> keyword is especially used for trait objects, but seem to have been removed in your solution? Does it play a role? Thanks :)"}, {"owner": {"reputation": 76, "user_id": 11615961, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673938b7e89b06dc85576f83e061d9b3?s=128&d=identicon&r=PG&f=1", "display_name": "JDU", "link": "https://stackoverflow.com/users/11615961/jdu"}, "edited": false, "score": 0, "creation_date": 1563526049, "post_id": 57097307, "comment_id": 100737168, "body": "Right sorry, that&#39;s my fault, I made an assumption that you would be passing vecs of a strict type. I&#39;ll add an edit momentarily that accomodates vecs of trait objects. This is what trenctl is referring to in part above."}, {"owner": {"reputation": 344, "user_id": 7174977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4e5b70f1390f44dbc78b3e2342cddfd?s=128&d=identicon&r=PG&f=1", "display_name": "Hellstorm", "link": "https://stackoverflow.com/users/7174977/hellstorm"}, "edited": false, "score": 0, "creation_date": 1563954410, "post_id": 57097307, "comment_id": 100867260, "body": "Thanks for the help! I&#39;ve now managed to include it into my real application. Learned a lot about Rust while implementing it."}], "tags": [], "owner": {"reputation": 76, "user_id": 11615961, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673938b7e89b06dc85576f83e061d9b3?s=128&d=identicon&r=PG&f=1", "display_name": "JDU", "link": "https://stackoverflow.com/users/11615961/jdu"}, "is_accepted": true, "score": 2, "last_activity_date": 1563526954, "last_edit_date": 1563526954, "creation_date": 1563461280, "answer_id": 57097307, "question_id": 57096621, "link": "https://stackoverflow.com/questions/57096621/pass-vector-of-mutable-trait-objects-to-function/57097307#57097307", "title": "Pass vector of mutable trait objects to function", "body": "<p>The issue is actually with your trigger_listeners function rather than with the specific typing itself. </p>\n\n<p>You're starting into the world of generics here and it's worth a read through the <a href=\"https://doc.rust-lang.org/rust-by-example/generics.html\" rel=\"nofollow noreferrer\">https://doc.rust-lang.org/rust-by-example/generics.html</a> to get a better understanding, but to get started all you need to do is modify the signature of your <code>trigger_listeners</code> function a bit.</p>\n\n<p>You currently have </p>\n\n<pre><code>pub fn trigger_listeners(listeners: Vec&lt;&amp;mut Box&lt;dyn Listener&gt;&gt;) {\n        for mut x in listeners {\n            x.trigger();\n        }\n    }\n</code></pre>\n\n<p>In rust, traits play a double-role where they are also considered types to an extent. So you need to generalize your method signature in order to reflect that.</p>\n\n<pre><code>\npub fn trigger_listeners&lt;T: Listener&gt;(listeners: Vec&lt;&amp;mut Box&lt;T&gt;&gt;) {\n        for mut x in listeners {\n            x.trigger();\n        }\n    }\n\n</code></pre>\n\n<p>Here we're saying trigger_listeneres should accept any type <code>T</code> where that type implements the <code>Listener</code> trait versus passing the trait itself in the type signature. </p>\n\n<hr>\n\n<p>Edit:</p>\n\n<p>As trentctl pointed out and based on the fact you need vecs of a non-contigous type to be able to be passed to the <code>trigger_listeners</code> function, we need to modify a few things.</p>\n\n<p>1) We can actually do this without Box in order to simplify things.</p>\n\n<pre><code>let mut mock = Mock { times_called: 0 };\nlet mut mock2 = Mock2 { times_called: 0 };\n\nlet items: Vec&lt;&amp;mut dyn Listener&gt; = vec![&amp;mut mock, &amp;mut mock2];\ntrigger_listeners(&amp;mut items);\n</code></pre>\n\n<p>2) To accept a vec of Unsized dyn Listeners, we need to add the ?Sized trait to the trait bounds of the trigger_listeners function.</p>\n\n<pre><code>pub fn trigger_listeners&lt;t&gt;(listeners: &amp;mut Vec&lt;&amp;mut T&gt;) \nwhere T: Listener + ?Sized\n{\n    for x in listeners {\n        x.trigger();\n    }\n}\n</code></pre>\n\n<p>Another point, if you aren't expecting the types that you need to pass to the trigger_listener function to change, you can possibly step away from using trait objects and instead wrap your types in an enum type and pass a vec of those instead of trait objects. If, however you're expecting users of your library to extend the known types with their own implementing the Listener trait then trait objects is the right way to go about it.</p>\n"}], "owner": {"reputation": 344, "user_id": 7174977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4e5b70f1390f44dbc78b3e2342cddfd?s=128&d=identicon&r=PG&f=1", "display_name": "Hellstorm", "link": "https://stackoverflow.com/users/7174977/hellstorm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 398, "favorite_count": 0, "accepted_answer_id": 57097307, "answer_count": 1, "score": 0, "last_activity_date": 1563526954, "creation_date": 1563459257, "question_id": 57096621, "link": "https://stackoverflow.com/questions/57096621/pass-vector-of-mutable-trait-objects-to-function", "title": "Pass vector of mutable trait objects to function", "body": "<p>I am quite new to Rust, coming from a Java background. I am trying to implement the observer pattern in Rust (I guess this is not idiomatic Rust, though). My attempt is like this:</p>\n\n<pre><code>use crate::observable::{Listener, trigger_listeners};\n\nmod observable {\n    pub trait Listener {\n        fn trigger(&amp;mut self);\n    }\n\n    pub fn trigger_listeners(listeners: Vec&lt;&amp;mut Box&lt;dyn Listener&gt;&gt;) {\n        for mut x in listeners {\n            x.trigger();\n        }\n    }\n}\n\nstruct Mock {\n    times_called: u32\n}\nimpl Listener for Mock {\n    fn trigger(&amp;mut self) {\n        self.times_called += 1;\n    }\n}\n#[test]\nfn test() {\n    let mut mock = Box::new(Mock{ times_called: 0 });\n    trigger_listeners(vec![&amp;mut mock]);\n\n    assert_eq!(mock.times_called, 1)\n}\n</code></pre>\n\n<p>Every listener should implement the Listener trait and be passed as an array to the function <code>trigger_listener</code>.</p>\n\n<p>This gives me the following error:</p>\n\n<pre><code>error[E0308]: mismatched types\n--&gt; src/lib.rs:27:28\n|\n27 |     trigger_listeners(vec![&amp;mut mock]);\n|                            ^^^^^^^^^ expected trait observable::Listener, found struct `Mock`\n|\n= note: expected type `&amp;mut std::boxed::Box&lt;(dyn observable::Listener + 'static)&gt;`\nfound type `&amp;mut std::boxed::Box&lt;Mock&gt;`\n\nerror: aborting due to previous error\n</code></pre>\n\n<p>I was thinking that because the Mock implements the trait Listener, I can pass it as a reference.</p>\n\n<p>My other try is to only use a Box which is moved (<code>pub fn trigger_listeners(listeners: Vec&lt;Box&lt;dyn Listener&gt;&gt;) {}</code>). This works, but then I cannot access the <code>mock.times_called</code> anymore.</p>\n\n<p>I've also made some attempts with a <code>Rc</code>, but this didn't work either.</p>\n"}, {"tags": ["rust", "readwritelock"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1563461307, "post_id": 57096117, "comment_id": 100715782, "body": "Note that a type should be written in PascalCase."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 11803095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6da2735eba23bd9ceb8daadd759b01a6?s=128&d=identicon&r=PG&f=1", "display_name": "Kandah", "link": "https://stackoverflow.com/users/11803095/kandah"}, "edited": false, "score": 1, "creation_date": 1563460634, "post_id": 57096288, "comment_id": 100715325, "body": "Thank you, it is exactly what I want. :)"}], "tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 3, "last_activity_date": 1563461221, "last_edit_date": 1563461221, "creation_date": 1563458319, "answer_id": 57096288, "question_id": 57096117, "link": "https://stackoverflow.com/questions/57096117/how-to-create-a-vector-of-rwlock-in-rust/57096288#57096288", "title": "How to create a vector of RwLock in rust?", "body": "<p>This vector initialization clones the parameter. Use <a href=\"https://doc.rust-lang.org/std/iter/fn.repeat_with.html\" rel=\"nofollow noreferrer\"><code>std::iter::repeat_with</code></a>:</p>\n\n<pre><code>use std::sync::{Arc, RwLock};\n\n#[derive(Default, Debug, Clone, Copy)]\npub struct SharedValues {\n    x: usize,\n    y: usize,\n}\n\nfn main() {\n    let shared: Vec&lt;_&gt; =\n        std::iter::repeat_with(|| Arc::new(RwLock::new(SharedValues { x: 0, y: 0 })))\n            .take(10)\n            .collect();\n\n    //changing value of the element [0]\n    {\n        let mut sh = shared[0].write().unwrap();\n        *sh = SharedValues { x: 10, y: 10 };\n    }\n\n    //Printing\n    {\n        println!(\"Print RwLock\");\n        for x in shared {\n            println!(\"{:?}\", x.read().unwrap());\n        }\n    }\n}\n</code></pre>\n\n<p>If you miss the simplicity of a macro, you can write your own:</p>\n\n<pre><code>macro_rules! vec_no_clone {\n    ( $val:expr; $n:expr ) =&gt; {{\n        let result: Vec&lt;_&gt; = std::iter::repeat_with(|| $val).take($n).collect();\n        result\n    }};\n}\n\nfn main() {\n    let shared = vec_no_clone![Arc::new(RwLock::new(SharedValues { x: 0, y: 0 })); 10];\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 11803095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6da2735eba23bd9ceb8daadd759b01a6?s=128&d=identicon&r=PG&f=1", "display_name": "Kandah", "link": "https://stackoverflow.com/users/11803095/kandah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 427, "favorite_count": 0, "accepted_answer_id": 57096288, "answer_count": 1, "score": 3, "last_activity_date": 1603219514, "creation_date": 1563457849, "last_edit_date": 1603219514, "question_id": 57096117, "link": "https://stackoverflow.com/questions/57096117/how-to-create-a-vector-of-rwlock-in-rust", "title": "How to create a vector of RwLock in rust?", "body": "<p>I need to make a vector of struct. Each element of the vector have to be protected by a RwLock. Threads need to read and write in this vector ( thanks to RwLock ). How can I do that in Rust.</p>\n\n<p>I've tried using a vector of Arc.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Default, Debug, Clone, Copy)]\npub struct shared_values {\n    x: usize,\n    y: usize,\n}\n\nfn main() {\n    let mut shared = vec![Arc::new(RwLock::new(shared_values { x: 0, y: 0 })); 10];\n\n    //changing value of the element [0]\n    {\n        let mut sh = shared[0].write().unwrap();\n        *sh = shared_values { x: 10, y: 10 };\n    }\n\n    //Printing\n    {\n        println!(\"Print RwLock\");\n        for i in 0..g.ns {\n            {\n                let val = shared[i].read().unwrap();\n                println!(\"{:?}\", val);\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>The result is like that :</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>RwLockReadGuard { lock: RwLock { data: shared_values { suitor: 10, ws: 10 } } }\nRwLockReadGuard { lock: RwLock { data: shared_values { suitor: 10, ws: 10 } } }\nRwLockReadGuard { lock: RwLock { data: shared_values { suitor: 10, ws: 10 } } }\nRwLockReadGuard { lock: RwLock { data: shared_values { suitor: 10, ws: 10 } } }\nRwLockReadGuard { lock: RwLock { data: shared_values { suitor: 10, ws: 10 } } }\nRwLockReadGuard { lock: RwLock { data: shared_values { suitor: 10, ws: 10 } } }\nRwLockReadGuard { lock: RwLock { data: shared_values { suitor: 10, ws: 10 } } }\nRwLockReadGuard { lock: RwLock { data: shared_values { suitor: 10, ws: 10 } } }\nRwLockReadGuard { lock: RwLock { data: shared_values { suitor: 10, ws: 10 } } }\nRwLockReadGuard { lock: RwLock { data: shared_values { suitor: 10, ws: 10 } } }\n\n</code></pre>\n\n<p>I expected the element 0 to be set with { x : 10, y : 10 }</p>\n\n<p>I think Arc increase the counting reference of shared_values { x : 0 , y : 0 } but doesn't create an independant element for each index in the vector.</p>\n"}, {"tags": ["rust", "runtime", "substrate", "parity-io", "polkadot-js"], "answers": [{"tags": [], "owner": {"reputation": 8871, "user_id": 1260906, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/aPM5A.png?s=128&g=1", "display_name": "Afr", "link": "https://stackoverflow.com/users/1260906/afr"}, "is_accepted": true, "score": 2, "last_activity_date": 1563444560, "creation_date": 1563444560, "answer_id": 57092097, "question_id": 57091595, "link": "https://stackoverflow.com/questions/57091595/no-kitties-module-available-in-the-extrinsics-tab/57092097#57092097", "title": "No `kitties` module available in the extrinsics tab", "body": "<p>The issue here potentially is your chain did not upgrade the runtime yet, and therefore you cannot see new modules on an <em>existing</em> chain. This happens when you run the chain while developing and registering new modules with the runtime. </p>\n\n<p>To fix this and ensure all your modules are registered properly, you would have to purge your chain and start a new development chain with your latest code. To purge, run:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>\u276f target/release/substratekitties purge-chain --dev\n</code></pre>\n\n<p>Restart a new chain:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>\u276f target/release/substratekitties --dev\n</code></pre>\n\n<p>And the kitties module should be available in the extrinsics tab.</p>\n"}], "owner": {"reputation": 8871, "user_id": 1260906, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/aPM5A.png?s=128&g=1", "display_name": "Afr", "link": "https://stackoverflow.com/users/1260906/afr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 57092097, "answer_count": 1, "score": 2, "last_activity_date": 1582306230, "creation_date": 1563443035, "question_id": 57091595, "link": "https://stackoverflow.com/questions/57091595/no-kitties-module-available-in-the-extrinsics-tab", "title": "No `kitties` module available in the extrinsics tab", "body": "<p>I'm following the <a href=\"https://www.shawntabrizi.com/substrate-collectables-workshop/#/1/viewing-a-storage-mapping\" rel=\"nofollow noreferrer\">Substrate Kitties</a> workshop. In <code>1/Viewing a Storage Mapping</code>, I cannot access my <code>kitties</code> module on the <code>#extrinsics</code> tab of the Polkadot UI:</p>\n\n<p><img src=\"https://user-images.githubusercontent.com/47772477/61446932-49ac0980-a950-11e9-9fde-f5f0d30483cd.png\" alt=\"Screenshot at 2019-07-18 11-36-02\"></p>\n\n<p>I tried reloading it multiple times. This is my <code>kitties.rs</code> (compiles fine):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use support::{decl_storage, decl_module, StorageMap, dispatch::Result};\nuse system::ensure_signed;\n\npub trait Trait: balances::Trait {}\n\ndecl_storage! {\n    trait Store for Module&lt;T: Trait&gt; as KittyStorage {\n        Value: map T::AccountId =&gt; u64;\n    }\n}\n\ndecl_module! {\n    pub struct Module&lt;T: Trait&gt; for enum Call where origin: T::Origin {\n        fn set_value(origin, value: u64) -&gt; Result {\n            let sender = ensure_signed(origin)?;\n            &lt;Value&lt;T&gt;&gt;::insert(sender, value);\n            Ok(())\n        }\n    }\n}\n</code></pre>\n\n<p>I defined the module in <code>lib.rs</code></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>/// Used for the Substrate Kitties in `./kitties.rs`\nmod kitties;\n\n[...]\n\n/// Used for the Substrate Kitties in `./kitties.rs`\nimpl kitties::Trait for Runtime {}\n</code></pre>\n\n<p>And added it to the runtime.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>construct_runtime!(\n    pub enum Runtime with Log(InternalLog: DigestItem&lt;Hash, AuthorityId, AuthoritySignature&gt;) where\n        Block = Block,\n        NodeBlock = opaque::Block,\n        UncheckedExtrinsic = UncheckedExtrinsic\n    {\n        System: system::{default, Log(ChangesTrieRoot)},\n        Timestamp: timestamp::{Module, Call, Storage, Config&lt;T&gt;, Inherent},\n        Consensus: consensus::{Module, Call, Storage, Config&lt;T&gt;, Log(AuthoritiesChange), Inherent},\n        Aura: aura::{Module},\n        Indices: indices,\n        Balances: balances,\n        Sudo: sudo,\n        Kitties: kitties::{Module, Call, Storage},\n        // Used for the module template in `./template.rs`\n        TemplateModule: template::{Module, Call, Storage, Event&lt;T&gt;},\n        ExampleModule: substrate_module_template::{Module, Call, Storage, Event&lt;T&gt;},\n\n    }\n);\n</code></pre>\n\n<p>What did I miss? What else is required to register my module with the Substrate runtime?</p>\n"}, {"tags": ["rust", "lifetime"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 2, "creation_date": 1563440898, "post_id": 57090758, "comment_id": 100703730, "body": "If you don&#39;t like the if...else, you can use a match instead of that weird formatting: <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=617851d2504360720adcddabc6a3eb2f\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1563443453, "post_id": 57090758, "comment_id": 100705152, "body": "The book explains those differences in chapter 10, section 3: <a href=\"https://doc.rust-lang.org/stable/book/ch10-03-lifetime-syntax.html\" rel=\"nofollow noreferrer\">Validating References with Lifetimes</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1925, "user_id": 2865757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dcfe7782349d59e50b1fa196f9c6669?s=128&d=identicon&r=PG&f=1", "display_name": "Zefick", "link": "https://stackoverflow.com/users/2865757/zefick"}, "is_accepted": false, "score": 2, "last_activity_date": 1563441622, "creation_date": 1563441622, "answer_id": 57091140, "question_id": 57090758, "link": "https://stackoverflow.com/questions/57090758/why-my-code-of-lifetime-function-call-is-ok-or-fail/57091140#57091140", "title": "Why my code of lifetime function call is ok or fail?", "body": "<p>Strings <code>\"ajoisd\"</code> and <code>\"aso\"</code> have the <code>'static</code> lifetime. They outlive any variable in the program. Variables <code>x</code> and <code>y</code> in the first block live only in this block which is less than the lifetime of <code>z</code>.</p>\n"}], "owner": {"reputation": 1, "user_id": 11796629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84cb20e7eba0c9c37f572b8fbe534151?s=128&d=identicon&r=PG&f=1", "display_name": "urcllr", "link": "https://stackoverflow.com/users/11796629/urcllr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563445772, "creation_date": 1563440421, "last_edit_date": 1563445772, "question_id": 57090758, "link": "https://stackoverflow.com/questions/57090758/why-my-code-of-lifetime-function-call-is-ok-or-fail", "title": "Why my code of lifetime function call is ok or fail?", "body": "<ol>\n<li>I'm new to Rust lang and wonder what difference between two blocks in <code>fn main()</code>, can anyone explain in words of lifetime.</li>\n<li>Are .<code>as_str()</code> calls change the lifetime of x and y?</li>\n<li>Whose lifetime does <code>-&gt; &amp;a' str</code> refer to? a,b,c at <code>lifetime()</code> returning position or z to receive the result?</li>\n</ol>\n\n<p>I consider the variables x and y have the same lifetime scopes in both blocks. And that of z covers the x's and y's.</p>\n\n<p>If <code>(x: &amp;'a str, y: &amp;'a str, z: &amp;'a str)</code> demands same lifetime scope of x,y,z, both blocks should fail.</p>\n\n<pre><code>fn main()\n{\n    let mut z = \"123abc\";\n\n    {////    CAN ONLY SUCCEED WHEN REMOVE THE BRACES OF THIS BLOCK\n        let x = String::from(\"ajoisd\");\n        let y = String::from(\"aso\");\n        z = lifetime(x.as_str(), y.as_str(), z);\n    }\n\n    {////    GOES WELL WITH/WITHOUT BRACES\n        let x = \"ajoisd\";\n        let y = \"aso\";\n        z = lifetime(x, y, z);\n    }\n\n    println!(\"{}\", z);\n}\n\nfn lifetime&lt;'a&gt;(a: &amp;'a str, b: &amp;'a str, c: &amp;'a str) -&gt; &amp;'a str\n{\n    if a.len() &gt; b.len()          {a}\n    else if a.len() &lt; b.len()     {b}\n    else                          {c}\n}\n</code></pre>\n"}, {"tags": ["sql", "postgresql", "rust"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1563430053, "post_id": 57087912, "comment_id": 100698449, "body": "How many rows does the query return if you run it manually?"}, {"owner": {"reputation": 10424, "user_id": 4047092, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/n5HM6.jpg?s=128&g=1", "display_name": "ravi", "link": "https://stackoverflow.com/users/4047092/ravi"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1563430527, "post_id": 57087912, "comment_id": 100698611, "body": "@melpomene I should&#39;ve updated in question earlier :)"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1563431054, "post_id": 57087912, "comment_id": 100698828, "body": "You&#39;re selecting a single row (<code>... where id = 1</code>). Why use <code>AVG</code> at all? Or is <code>id</code> not a primary key?"}, {"owner": {"reputation": 10424, "user_id": 4047092, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/n5HM6.jpg?s=128&g=1", "display_name": "ravi", "link": "https://stackoverflow.com/users/4047092/ravi"}, "reply_to_user": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1563432886, "post_id": 57087912, "comment_id": 100699567, "body": "@melpomene I have edited the query for obvious reasons. Please ignore this"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1563432992, "post_id": 57087912, "comment_id": 100699617, "body": "What do you want the average of 0 rows to be?"}], "answers": [{"tags": [], "owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "is_accepted": false, "score": 1, "last_activity_date": 1563431076, "creation_date": 1563431076, "answer_id": 57088235, "question_id": 57087912, "link": "https://stackoverflow.com/questions/57087912/postgresql-returning-null-as-a-row-in-case-query-returns-empty/57088235#57088235", "title": "PostgreSQL returning NULL as a row in case query returns empty", "body": "<p>An <code>i32</code> can't be empty. You should use an <a href=\"https://doc.rust-lang.org/std/option/index.html\" rel=\"nofollow noreferrer\"><code>Option</code></a> as your query can return <code>NULL</code>:</p>\n\n<pre><code>let extended_time: Option&lt;i32&gt; = row.get(\"extended_time\");\n</code></pre>\n"}], "owner": {"reputation": 10424, "user_id": 4047092, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/n5HM6.jpg?s=128&g=1", "display_name": "ravi", "link": "https://stackoverflow.com/users/4047092/ravi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563431076, "creation_date": 1563429263, "last_edit_date": 1563431011, "question_id": 57087912, "link": "https://stackoverflow.com/questions/57087912/postgresql-returning-null-as-a-row-in-case-query-returns-empty", "title": "PostgreSQL returning NULL as a row in case query returns empty", "body": "<p>I have a generic code which is trying to access field values after query returns.</p>\n\n<pre><code>SELECT \n    ROUND(AVG(EXTRACT(EPOCH FROM (time::timestamp)))) as extended_time\nFROM log_info \nWHERE \n    id = 1 AND \n    code = 200;\n</code></pre>\n\n<p>However, this is returning NULL value as single row which is causing my application to crash.</p>\n\n<pre><code>for row in &amp;con.query(query, args.as_slice()).unwrap() {\n    let extended_time: i32 = row.get(\"extended_time\");\n    ...\n}\n</code></pre>\n\n<p>crashes with following error :-</p>\n\n<pre><code>error retrieving column \"extended_time\": Conversion(WasNull)\n</code></pre>\n\n<p>Running manually returns</p>\n\n<pre><code> extended_time\n-------------\n\n(1 row)\n</code></pre>\n\n<p>Without <code>AVG</code> query returns expected result</p>\n\n<pre><code>SELECT \n    EXTRACT(EPOCH FROM (time::timestamp)) as extended_time\nFROM log_info \nWHERE \n    id = 1 AND \n    code = 200;\n\n extended_time\n-------------\n(0 rows)\n</code></pre>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 1, "creation_date": 1563433652, "post_id": 57087386, "comment_id": 100699962, "body": "No you don&#39;t need to do a cargo clean (which would be very inconvenient for a larger project with dependencies). What you see isn&#39;t normal, assuming you don&#39;t just save the wrong file. You should probably try to reproduce this with a new clean project and maybe another editor."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 5, "creation_date": 1563449855, "post_id": 57087386, "comment_id": 100708556, "body": "98% you have been saving the wrong file, or you&#39;re running cargo in the wrong directory. 2% there&#39;s something weird going on with your editor or cargo, but we don&#39;t have enough information to troubleshoot it."}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1563460582, "post_id": 57087386, "comment_id": 100715288, "body": "Except that if he was saving the wrong file or running cargo in the wrong directory, the second <code>cargo run</code> wouldn&#39;t recompile the project\u2026"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1563466395, "post_id": 57087386, "comment_id": 100718745, "body": "Unless OP has the real file open in an editor that autosaves periodically, or the files are actually in the same project but <code>fn main()</code> is not in <code>main.rs</code>, or they are just mistaken about the output of <code>cargo run</code>, etc. It happens to everyone. To the absent-minded among us it may happen multiple times a day."}, {"owner": {"reputation": 534, "user_id": 3882704, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e5f3c0ad59d68324bd15384465a8f17?s=128&d=identicon&r=PG", "display_name": "Kellen", "link": "https://stackoverflow.com/users/3882704/kellen"}, "edited": false, "score": 0, "creation_date": 1563467979, "post_id": 57087386, "comment_id": 100719523, "body": "does <code>cat src&#47;main.rs</code> show the two print calls?"}, {"owner": {"reputation": 153, "user_id": 5008606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df0b426f4bd065d57f53034a5bbf120?s=128&d=identicon&r=PG&f=1", "display_name": "Defake", "link": "https://stackoverflow.com/users/5008606/defake"}, "edited": false, "score": 0, "creation_date": 1563470872, "post_id": 57087386, "comment_id": 100720831, "body": "Updated question with the whole process described in terminal step by step. Did nothing outside of the terminal window. Can you see something weird there?"}, {"owner": {"reputation": 153, "user_id": 5008606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df0b426f4bd065d57f53034a5bbf120?s=128&d=identicon&r=PG&f=1", "display_name": "Defake", "link": "https://stackoverflow.com/users/5008606/defake"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1563471975, "post_id": 57087386, "comment_id": 100721333, "body": "@trentcl What information do I need to provide to shed light on the cause of the problem?"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1563473035, "post_id": 57087386, "comment_id": 100721753, "body": "What you have added is great, thanks (I&#39;m assuming <code>z</code> is just an alias for <code>cd</code>). That said, I can&#39;t see anything you&#39;re doing wrong, so I&#39;m going with &quot;there&#39;s something weird going on.&quot; How did you install cargo and what version is it?"}, {"owner": {"reputation": 153, "user_id": 5008606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df0b426f4bd065d57f53034a5bbf120?s=128&d=identicon&r=PG&f=1", "display_name": "Defake", "link": "https://stackoverflow.com/users/5008606/defake"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1563473528, "post_id": 57087386, "comment_id": 100721948, "body": "@trentcl first I installed as it states in rust docs: <code>curl https:&#47;&#47;sh.rustup.rs -sSf | sh</code>. Now I deleted it using <code>rustup self uninstall</code> and installied via brew: <code>brew install rust</code>. Now the version is &quot;cargo 1.36.0&quot;. <code>cargo run</code> does the same thing anyway..."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1563475976, "post_id": 57087386, "comment_id": 100722988, "body": "<i>exaggerated shrug</i> Works for me. Filesystem corruption due to impending hard drive failure, maybe? Buggy NFS server? Something weird going on with timestamps? Symlink shenanigans? Poltergeist? That the fourth <code>cargo run</code> cut off part of the message suggests to me this is more than a bug in Cargo, but I could be wrong. Does <code>target&#47;debug&#47;notworking</code> always have the same behavior if you run it directly instead of through <code>cargo run</code>?"}, {"owner": {"reputation": 153, "user_id": 5008606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df0b426f4bd065d57f53034a5bbf120?s=128&d=identicon&r=PG&f=1", "display_name": "Defake", "link": "https://stackoverflow.com/users/5008606/defake"}, "edited": false, "score": 0, "creation_date": 1563476910, "post_id": 57087386, "comment_id": 100723359, "body": "oooook it&#39;s definitely a poltergeist. I executed <code>brew cask install cargo</code> (that failed, no such package) Then I ran target/debug/notworking directly as you said, and now this projects always has correct output! I change the file in any editor, do <code>cargo run</code> and it works. Then I created another project and step by step repeated my commands in terminal (including cask and direct run). NOT WORKING. <code>cargo run</code> for &quot;notworking&quot; still works. For &quot;secondtry&quot; does not. Dark magic"}, {"owner": {"reputation": 153, "user_id": 5008606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df0b426f4bd065d57f53034a5bbf120?s=128&d=identicon&r=PG&f=1", "display_name": "Defake", "link": "https://stackoverflow.com/users/5008606/defake"}, "edited": false, "score": 0, "creation_date": 1563477722, "post_id": 57087386, "comment_id": 100723748, "body": "and yes, always the same as I run it without other actions"}, {"owner": {"reputation": 153, "user_id": 5008606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df0b426f4bd065d57f53034a5bbf120?s=128&d=identicon&r=PG&f=1", "display_name": "Defake", "link": "https://stackoverflow.com/users/5008606/defake"}, "edited": false, "score": 0, "creation_date": 1563478041, "post_id": 57087386, "comment_id": 100723876, "body": "if I only delete the executable file and leave other files in target/debug unchanged, the next first <code>cargo run</code> will correctly work. Maybe some stuff with permissions. I&#39;ll try to do something tomorrow. Thanks for helping anyway!"}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1563516877, "post_id": 57087386, "comment_id": 100733034, "body": "Can you check the timestamp for the executable file (eg. with <code>ls -l</code>) before and after the second <code>cargo run</code>? Also, can you run <code>strings</code> on the executable?"}, {"owner": {"reputation": 153, "user_id": 5008606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df0b426f4bd065d57f53034a5bbf120?s=128&d=identicon&r=PG&f=1", "display_name": "Defake", "link": "https://stackoverflow.com/users/5008606/defake"}, "reply_to_user": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1563630184, "post_id": 57087386, "comment_id": 100767640, "body": "@Jmb updated my post with this commands output"}, {"owner": {"reputation": 153, "user_id": 5008606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df0b426f4bd065d57f53034a5bbf120?s=128&d=identicon&r=PG&f=1", "display_name": "Defake", "link": "https://stackoverflow.com/users/5008606/defake"}, "edited": false, "score": 0, "creation_date": 1564166325, "post_id": 57087386, "comment_id": 100955266, "body": "Some new info: it works correctly on another hard drive (on the system disk, where the OS is installed). Could you please give an advice on how to find out what exactly is wrong with the other disk?"}], "owner": {"reputation": 153, "user_id": 5008606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6df0b426f4bd065d57f53034a5bbf120?s=128&d=identicon&r=PG&f=1", "display_name": "Defake", "link": "https://stackoverflow.com/users/5008606/defake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 548, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1604254934, "creation_date": 1563425873, "last_edit_date": 1565619820, "question_id": 57087386, "link": "https://stackoverflow.com/questions/57087386/cargo-run-does-not-reflect-any-code-changes-in-main-rs", "title": "cargo run does not reflect any code changes in main.rs", "body": "<p><code>cargo run</code> or <code>cargo rebuild</code> ignore any code changes.</p>\n\n<p>I have a program</p>\n\n<pre><code>fn main() {\n    println!(\"Hello, World!\");\n}\n</code></pre>\n\n<p>Then I do <code>cargo run</code> and see:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>   Compiling myproject v0.1.0 (/Volumes/.../myproject)\n    Finished dev [unoptimized + debuginfo] target(s) in 0.52s\n     Running `target/debug/myproject`\nHello, World!\n</code></pre>\n\n<p>Then I change the code to:</p>\n\n<pre><code>fn main() {\n    println!(\"Hello, Worldaefafeff!\");\n    print!(\"22222412414\");\n}\n</code></pre>\n\n<p><code>cargo run</code> again:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>   Compiling myproject v0.1.0 (/Volumes/.../myproject)\n    Finished dev [unoptimized + debuginfo] target(s) in 0.76s\n     Running `target/debug/myproject`\nHello, World!\n</code></pre>\n\n<p>Even if I see the \"Compiling\" line that means <code>cargo</code> knows that file has been changed, the output is the same. The same happens when I run <code>cargo build</code>. Do I need to run <code>cargo clean</code> every time? </p>\n\n<p>I see that many people say I'm doing something wrong. I repeated all my steps in one terminal. Is there something wrong?</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Genychs-iMac:~ defake$ z /Volumes/MainBrain/Programming/Projects/Personal\nGenychs-iMac:Personal defake$ cargo new notworking\n     Created binary (application) `notworking` package\nGenychs-iMac:Personal defake$ cd notworking/\nGenychs-iMac:notworking defake$ cargo run\n   Compiling notworking v0.1.0 (/Volumes/MainBrain/Programming/Projects/Personal/notworking)\n    Finished dev [unoptimized + debuginfo] target(s) in 0.55s\n     Running `target/debug/notworking`\nHello, world!\nGenychs-iMac:notworking defake$ printf 'fn main() {' &gt; src/main.rs\nGenychs-iMac:notworking defake$ printf '\\n\\tprintln!(\"Other text\");' &gt;&gt; src/main.rs\nGenychs-iMac:notworking defake$ printf '\\n}\\n' &gt;&gt; src/main.rs\nGenychs-iMac:notworking defake$ cargo run\n   Compiling notworking v0.1.0 (/Volumes/MainBrain/Programming/Projects/Personal/notworking)\n    Finished dev [unoptimized + debuginfo] target(s) in 0.33s\n     Running `target/debug/notworking`\nHello, world!\nGenychs-iMac:notworking defake$ cd src\nGenychs-iMac:src defake$ cargo run\n    Finished dev [unoptimized + debuginfo] target(s) in 0.00s\n     Running `/Volumes/MainBrain/Programming/Projects/Personal/notworking/target/debug/notworking`\nHello, world!\nGenychs-iMac:src defake$ cat main.rs\nfn main() {\n    println!(\"Other text\");\n}\nGenychs-iMac:src defake$ cargo run\n    Finished dev [unoptimized + debuginfo] target(s) in 0.00s\n     Running `/Volumes/MainBrain/Programming/Projects/Personal/notworking/target/debug/notworking`\nHello, worlGenychs-iMac:src defake$ cargo clean\nGenychs-iMac:src defake$ cargo run\n   Compiling notworking v0.1.0 (/Volumes/MainBrain/Programming/Projects/Personal/notworking)\n    Finished dev [unoptimized + debuginfo] target(s) in 0.48s\n     Running `/Volumes/MainBrain/Programming/Projects/Personal/notworking/target/debug/notworking`\nOther text\nGenychs-iMac:src defake$\n</code></pre>\n\n<p>\"Compiling\" happens, but the output is the same. The second time there's no \"Compiling\" step. I clearly don't understand what I'm doing wrong.</p>\n\n<p>And there's no mistake, the penultimate launch actually shows \"Hello, worl\". I did copy the terminal content properly</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Genychs-iMac:secondtry defake$ cargo run\n   Compiling secondtry v0.1.0 (/Volumes/MainBrain/Programming/Projects/Personal/secondtry)\n    Finished dev [unoptimized + debuginfo] target(s) in 1.13s\n     Running `target/debug/secondtry`\nOther text 15\nGenychs-iMac:secondtry defake$ ls -l target/debug/\ntotal 776\ndrwxr-xr-x  0 defake  staff       0 Jul 20 18:03 build\ndrwxr-xr-x  0 defake  staff    4096 Jul 20 18:03 deps\ndrwxr-xr-x  0 defake  staff       0 Jul 20 18:03 examples\ndrwxr-xr-x  0 defake  staff       0 Jul 20 18:03 incremental\ndrwxr-xr-x  0 defake  staff       0 Jul 20 18:03 native\n-rwxr-xr-x  2 defake  staff  291112 Jul 20 18:03 secondtry\n-rw-r--r--  1 defake  staff     159 Jul 20 18:03 secondtry.d\nlrwxr-xr-x  1 defake  staff       0 Jul 20 18:03 secondtry.dSYM -&gt; deps/secondtry-d4f28f61785f1e66.dSYM\n</code></pre>\n\n<p>Then updated the code</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Genychs-iMac:secondtry defake$ cargo run\n   Compiling secondtry v0.1.0 (/Volumes/MainBrain/Programming/Projects/Personal/secondtry)\n    Finished dev [unoptimized + debuginfo] target(s) in 0.36s\n     Running `target/debug/secondtry`\nOther text 15\nGenychs-iMac:secondtry defake$ ls -l target/debug/\ntotal 776\ndrwxr-xr-x  0 defake  staff       0 Jul 20 18:03 build\ndrwxr-xr-x  0 defake  staff    4096 Jul 20 18:04 deps\ndrwxr-xr-x  0 defake  staff       0 Jul 20 18:03 examples\ndrwxr-xr-x  0 defake  staff       0 Jul 20 18:03 incremental\ndrwxr-xr-x  0 defake  staff       0 Jul 20 18:03 native\n-rwxr-xr-x  2 defake  staff  291112 Jul 20 18:04 secondtry\n-rw-r--r--  1 defake  staff     159 Jul 20 18:04 secondtry.d\nlrwxr-xr-x  1 defake  staff       0 Jul 20 18:03 secondtry.dSYM -&gt; deps/secondtry-d4f28f61785f1e66.dSYM\nGenychs-iMac:secondtry defake$ strings target/debug/secondtry\nOther text 15\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\nstack backtrace:\n &lt;... and possibly more&gt;RUST_BACKTRACE0full  :  -\n&lt;unknown&gt;\n\n  at .:  at\nmain\ncalled `Option::unwrap()` on a `None` valuesrc/libcore/option.rscalled `Result::unwrap()` on an `Err` valuefailed to get environment variable ``: src/libstd/env.rs\nsrc/libstd/sync/once.rsassertion failed: state &amp; STATE_MASK == RUNNINGOnce instance has previously been poisoned\nassertion failed: `(left == right)`\n  left: ``,\n right: ``memory allocation of  bytes failed\n&lt;unnamed&gt;' panicked at '',\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\nthread panicked while processing panic. aborting.\nthread panicked while panicking. aborting.\nfailed to initiate panic, error\nsrc/libstd/sys/unix/os.rsstrerror_r failure\nsrc/libstd/sys/unix/rwlock.rsrwlock maximum reader count exceededrwlock read lock would result in deadlock\nBox&lt;Any&gt;thread '...\ncalled `Option::unwrap()` on a `None` valuesrc/libcore/option.rsfailed to write the buffered data\nstack overflowsrc/libstd/sys/unix/stack_overflow.rsfailed to allocate an alternative stack\ncalled `Option::unwrap()` on a `None` valuesrc/libcore/option.rscalled `Result::unwrap()` on an `Err` valueuse of std::thread::current() is not possible after the thread's local data has been destroyedsrc/libstd/thread/mod.rsinconsistent park stateassertion failed: `(left == right)`\n  left: ``,\n right: ``: park state changed unexpectedly\nfailed to generate unique thread ID: bitspace exhaustedthread name may not contain interior null bytesinconsistent state in unpark\ndata provided contains a nul byteunexpected end of fileother os erroroperation interruptedwrite zerotimed outinvalid datainvalid input parameteroperation would blockentity already existsbroken pipeaddress not availableaddress in usenot connectedconnection abortedconnection refusedpermission denied\n (os error )\nconnection resetentity not found\nalready borrowed\n: src/libcore/result.rs\ncannot access stdout during shutdownfailed printing to src/libstd/io/stdio.rsstdout\nfailed to write whole bufferformatter errorsrc/libstd/sys_common/at_exit_imp.rsassertion failed: queue != DONE\nsrc/libstd/sys/unix/mod.rsassertion failed: signal(libc::SIGPIPE, libc::SIG_IGN) != libc::SIG_ERR\nsrc/libcore/slice/mod.rsassertion failed: `(left == right)`\n  left: ``,\n right: ``: destination and source slices have different lengths\nsrc/libstd/sync/condvar.rsattempted to use a condition variable with two mutexes\nSomeNoneinternal error: entered unreachable codesrc/liballoc/raw_vec.rsTried to shrink to a larger capacity\n/private/tmp/rust-20190704-90201-o56ua9/rustc-1.36.0-src/src/libcore/str/pattern.rs\nattempt to calculate the remainder with a divisor of zero\nsrc/liballoc/vec.rsassertion failed: end &lt;= len\n__rust_begin_short_backtracePoisonError { inner: .. }failed to allocate libbacktrace state\nsrc/libstd/sys/unix/thread.rsassertion failed: PAGE_SIZE != 0\nsrc/libstd/sys/unix/thread.rsfailed to allocate a guard pagefailed to protect the guard page\nfailed to write whole bufferformatter error\nunexpected return value while unwinding:\nsrc/libstd/sys/unix/backtrace/tracing/gcc_s.rs\nUnwindError\nNulErrorkind\n/private/tmp/rust-20190704-90201-o56ua9/rustc-1.36.0-src/src/libcore/str/pattern.rsalready mutably borrowedcalled `Option::unwrap()` on a `None` valuesrc/libcore/option.rs\nAccessError\ncannot access a TLS value during or after it is destroyed\n__rust_begin_short_backtrace\nsrc/libstd/sys_common/thread_info.rsassertion failed: c.borrow().is_none()fatal runtime error:\nthread '' has overflowed its stack\n&lt;unknown&gt;StringErroralready borrowedcalled `Option::unwrap()` on a `None` valuesrc/libcore/option.rs\n/private/tmp/rust-20190704-90201-o56ua9/rustc-1.36.0-src/src/libcore/str/pattern.rscalled `Option::unwrap()` on a `None` valuesrc/libcore/option.rscalled `Result::unwrap()` on an `Err` value.llvm.\nE._ZNZN::_$.@*&amp;&lt;&gt;()$C$,$u7e$~$u20$ $u27$'$u3d$=$u5b$[$u5d$]$u7b${$u7d$}$u3b$;$u2b$+$u22$\"\n__ZN$SP$$BP$$RF$$LT$$GT$$LP$$RP$\n: src/libcore/result.rs_URC_FAILURE_URC_CONTINUE_UNWIND_URC_INSTALL_CONTEXT_URC_HANDLER_FOUND_URC_END_OF_STACK_URC_FATAL_PHASE1_ERROR_URC_FATAL_PHASE2_ERROR_URC_FOREIGN_EXCEPTION_CAUGHT_URC_NO_REASON\n_URC_NORMAL_STOPsrc/liballoc/raw_vec.rscapacity overflow0x00010203040506070809101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899\nsrc/libcore/option.rs\n,  { } }(\n5556\n\n:index out of bounds: the len is  but the index is called `Option::unwrap()` on a `None` valuesrc/libcore/option.rs\n./?\\]_\n)147:;=IJ]\n)14:;EFIJ^de\n)EIWde\nEIde\nINOWY^_\nFGNOXZ\\^~\n/_&amp;./\nNOZ[\nno7=?BE\n\n';&gt;NO\n6=&gt;V\n67VW\n)14:EFIJNOdeZ\\\n;&gt;fi\n:?EQ\n #%&amp;(38:HJLPSUVXZ\\^`cefksx}\n?qr{^\"{\nPI73\n&lt;dS\n\nt\n Y'\n\nParseIntErrorUnderflowInvalidDigitEmpty\nZeroOverflow\n) when slicing `\nBorrowError\nBorrowMutErrorcalled `Option::unwrap()` on a `None` valuesrc/libcore/option.rs\nsrc/libcore/slice/mod.rsindex  out of range for slice of length slice index starts at  but ends at attempted to index slice up to maximum usize\nsrc/libcore/str/mod.rs[...]byte index  is out of bounds of ``begin &lt;= end ( is not a char boundary; it is inside ) of `\nUtf8Errorvalid_up_toerror_len &lt;=  (bytes called `Option::unwrap()` on a `None` valuesrc/libcore/option.rssrc/libcore/fmt/mod.rs\nsrc/libcore/str/pattern.rs\nsrc/libcore/unicode/bool_trie.rs\nmalloc\nrealloc\n.debug_info\nunrecognized DWARF version\nDWARF underflow\n%s in %s at %d\nabbrev offset out of range\n.debug_abbrev\nLEB128 overflows uint64_t\ninvalid abbreviation code\nDW_FORM_strp out of range\nunrecognized DWARF form\nunrecognized address size\nsigned LEB128 overflows uint64_t\nranges offset out of range\n.debug_ranges\nunit line offset out of range\n.debug_line\nunsupported line number version\ninvalid directory index in line number program header\ninvalid directory index in line number program\ninvalid file number in line number program\ninvalid file number in DW_AT_call_file attribute\nabstract origin or specification out of range\ninvalid abstract origin or specification\nfunction ranges offset out of range\nfailed to read executable information\n/proc/self/exe\n/proc/curproc/file\n/proc/%ld/object/a.out\nlibbacktrace could not find executable to open\nclose\nlseek\nread\nfile too short\nbacktrace library does not support threads\nexecutable file contains out of range command offset\nexecutable file is missing an identifying UUID\n__TEXT\nexecutable is missing __TEXT segment\ndSYM file contains out of range string table index\ndSYM file contains unterminated string\ndSYM file is missing an identifying uuid\ndSYM file contains out of range command offset\n__DWARF\n/Contents/Resources/DWARF\ncould not open DWARF directory in dSYM\nexecutable file is not loaded\ncould not open directory containing executable\n.dSYM\n__debug_info\n__debug_line\n__debug_abbrev\n__debug_ranges\n__debug_str\nno debug info in Mach-O executable\nno symbol table in Mach-O executable\n\"#$%&amp;\n,-./0\n&gt;?@ABCDEF\n</code></pre>\n\n<p>What I noticed is that if I run <code>target/debug/secondtry</code> the output is outdated, but if I run <code>target/debug/deps/secondtry-8f71784d4f2f1e66</code> then I get correct output.</p>\n"}]