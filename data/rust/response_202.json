[{"tags": ["mongodb", "rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542845264, "post_id": 53422069, "comment_id": 93718872, "body": "The error message is pretty clear: <code>not authorized on rustcrud to execute command { insert: \\&quot;test\\&quot;, $db: \\&quot;rustcrud\\&quot; }&quot;)</code> \u2014 your credentials are bad."}], "answers": [{"comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1542855604, "post_id": 53422193, "comment_id": 93720969, "body": "Oh that really is embarrassing. Well it &quot;is&quot; a prototype, and we see why. Worth adding that the same is true for the &quot;database&quot; namespace on the uri as given in the question as this also needs to be omitted. The credentials &quot;should&quot; be stored within the <code>admin</code> database, which is where that <code>auth()</code> method and all default authentication is actually done. Unless explicitly told otherwise."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 2, "last_activity_date": 1542845573, "creation_date": 1542845573, "answer_id": 53422193, "question_id": 53422069, "link": "https://stackoverflow.com/questions/53422069/unable-to-connect-to-mongodb-when-using-a-uri-with-credentials/53422193#53422193", "title": "Unable to connect to MongoDB when using a URI with credentials", "body": "<p>From the project's GitHub repository, <a href=\"https://github.com/mongodb-labs/mongo-rust-driver-prototype/issues/256\" rel=\"nofollow noreferrer\">issue 256: Add auth to base examples</a></p>\n\n<blockquote>\n  <p>user-password authentication occurs at the database-level. The user, password, and database are parsed from the URI, but I don't believe we have it set up to automatically authenticate when you create the database object</p>\n</blockquote>\n\n<pre><code>let client = Client::with_uri(\"mongodb://x:y@localhost:27017\")?;\nclient.auth(\"x\", \"y\");\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 8352845, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/de507f4bf3f8d1c22ea6ec5b7834fe60?s=128&d=identicon&r=PG&f=1", "display_name": "Hugo Sanchez", "link": "https://stackoverflow.com/users/8352845/hugo-sanchez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1542845573, "creation_date": 1542844420, "last_edit_date": 1542845257, "question_id": 53422069, "link": "https://stackoverflow.com/questions/53422069/unable-to-connect-to-mongodb-when-using-a-uri-with-credentials", "title": "Unable to connect to MongoDB when using a URI with credentials", "body": "<p>I'm trying to build a simple CRUD API with the MongoDB Rust driver but I'm failing to insert anything into the DB. I'm using Mlab to host my database.</p>\n\n<p>The code that I'm running:</p>\n\n<pre><code>#[macro_use(bson, doc)]\nextern crate bson;\nextern crate mongodb;\n\nuse mongodb::db::ThreadedDatabase;\nuse mongodb::{Client, ThreadedClient};\n\nfn main() {\n    let client = Client::with_uri(\n        \"mongodb://&lt;my_db_username&gt;:&lt;my_db_password&gt;@ds235711.mlab.com:35711/rustcrud\",\n    )\n    .expect(\"Failed to initialize client\");\n\n    let coll = client.db(\"rustcrud\").collection(\"test\");\n\n    coll.insert_one(doc! { \"title\": \"Back to the Future\" }, None)\n        .unwrap();\n}\n</code></pre>\n\n<p>And the error that I get:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: OperationError(\"not authorized on rustcrud to execute command { insert: \\\"test\\\", $db: \\\"rustcrud\\\" }\")', libcore/result.rs:1009:5\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 2348, "user_id": 864406, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd625e8a9c68a44bee8185847b7b59b0?s=128&d=identicon&r=PG", "display_name": "Lucretiel", "link": "https://stackoverflow.com/users/864406/lucretiel"}, "edited": false, "score": 1, "creation_date": 1542845858, "post_id": 53422033, "comment_id": 93719020, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/33818141/how-do-i-pass-disjoint-slices-from-a-vector-to-different-threads\">How do I pass disjoint slices from a vector to different threads?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542845609, "post_id": 53422187, "comment_id": 93718957, "body": "So, you agree this is a duplicate <a href=\"https://stackoverflow.com/q/33818141/155423\">of the proposed duplicate</a>?"}, {"owner": {"reputation": 2348, "user_id": 864406, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd625e8a9c68a44bee8185847b7b59b0?s=128&d=identicon&r=PG", "display_name": "Lucretiel", "link": "https://stackoverflow.com/users/864406/lucretiel"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542845840, "post_id": 53422187, "comment_id": 93719015, "body": "Oh, I didn&#39;t see that. Their solution is different, but yes,"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542921473, "post_id": 53422187, "comment_id": 93749815, "body": "The OP has edited the question such that this answer is no longer valid \u2014 <code>split_at</code> is impossible to call here."}], "tags": [], "owner": {"reputation": 2348, "user_id": 864406, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd625e8a9c68a44bee8185847b7b59b0?s=128&d=identicon&r=PG", "display_name": "Lucretiel", "link": "https://stackoverflow.com/users/864406/lucretiel"}, "is_accepted": false, "score": 2, "last_activity_date": 1542845480, "creation_date": 1542845480, "answer_id": 53422187, "question_id": 53422033, "link": "https://stackoverflow.com/questions/53422033/what-is-the-proper-way-to-atomically-update-a-vector-or-a-slice-that-overlaps-be/53422187#53422187", "title": "What is the proper way to atomically update a vector or a slice that overlaps between multiple threads?", "body": "<p>Assuming that each thread has unique access to a particular element or sub-slice of your vector, this would be a case to use <a href=\"https://doc.rust-lang.org/std/primitive.slice.html#method.split_at\" rel=\"nofollow noreferrer\"><code>split_at</code></a> (or one of the similar functions). <code>split_at</code> splits a mutable slice into two independent mutable slices; you can call it multiple times to split your slice into the correct number of segments, and pass each sub-slice to a separate thread.</p>\n\n<p>The best way to pass the sub-slices to a thread would be to use something like the scoped threads in <a href=\"https://docs.rs/crossbeam/0.5.0/crossbeam/\" rel=\"nofollow noreferrer\">crossbeam</a>.</p>\n"}], "owner": {"reputation": 21, "user_id": 7886218, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oFKkG.png?s=128&g=1", "display_name": "The_Server201", "link": "https://stackoverflow.com/users/7886218/the-server201"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 973, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1542921351, "creation_date": 1542844105, "last_edit_date": 1542921351, "question_id": 53422033, "link": "https://stackoverflow.com/questions/53422033/what-is-the-proper-way-to-atomically-update-a-vector-or-a-slice-that-overlaps-be", "title": "What is the proper way to atomically update a vector or a slice that overlaps between multiple threads?", "body": "<p>I want to some work on a vector shared by multiple threads but I don't want to use a <code>Mutex</code> because it is not wait-free.</p>\n\n<p>The code below is written as I would in C. </p>\n\n<pre><code>#![feature(core_intrinsics, ptr_internals)]\n\nuse std::intrinsics::atomic_xadd_rel;\nuse std::ptr::Unique;\nuse std::thread::spawn;\n\nfn main() {\n    let mut data = [0; 8];\n    let mut pool = Vec::with_capacity(8);\n    for index in 0..8 {\n        let data_ptr = Unique::new(data.as_mut_ptr());\n        pool.push(spawn(move || {\n            println!(\"Thread {} -&gt; {}\", index, unsafe {\n                atomic_xadd_rel(\n                    data_ptr\n                        .unwrap()\n                        .as_ptr()\n                        .add(if index % 2 != 0 { index - 1 } else { index }),\n                    1,\n                )\n            });\n        }));\n    }\n    for work in pool {\n        work.join().unwrap();\n    }\n    println!(\"Data {:?}\", data);\n}\n</code></pre>\n\n<p>I've also written the code using only the stable API:</p>\n\n<pre><code>use std::iter::repeat_with;\nuse std::sync::atomic::{AtomicUsize, Ordering::*};\nuse std::sync::Arc;\nuse std::thread::spawn;\n\nfn main() {\n    let data = Arc::new(\n        repeat_with(|| AtomicUsize::new(0))\n            .take(8)\n            .collect::&lt;Vec&lt;_&gt;&gt;(),\n    );\n    let mut pool = Vec::with_capacity(8);\n    for index in 0..8 {\n        let data_clone = data.clone();\n        pool.push(spawn(move || {\n            let offset = index - (index % 2 != 0) as usize;\n            println!(\n                \"Thread {} -&gt; {}\",\n                index,\n                data_clone[offset].fetch_add(1, Relaxed)\n            );\n        }));\n    }\n    for work in pool {\n        work.join().unwrap();\n    }\n    println!(\"Data {:?}\", data);\n}\n</code></pre>\n\n<p>This code returns</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Thread 0 -&gt; 0\nThread 1 -&gt; 1\nThread 3 -&gt; 0\nThread 5 -&gt; 1\nThread 7 -&gt; 1\nThread 2 -&gt; 1\nThread 6 -&gt; 0\nThread 4 -&gt; 0\nData [2, 0, 2, 0, 2, 0, 2, 0]\n</code></pre>\n\n<p>Is there is a proper way to do this in Rust?</p>\n\n<p>I do not think this is a duplicate of <a href=\"https://stackoverflow.com/questions/33818141/how-do-i-pass-disjoint-slices-from-a-vector-to-different-threads\">How do I pass disjoint slices from a vector to different threads?</a> because my vector / slice elements overlap between threads. In my sample, each odd index of the slice is incremented twice by two different threads.</p>\n"}, {"tags": ["rust", "ownership"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542844833, "post_id": 53421617, "comment_id": 93718739, "body": "Idiomatic Rust uses <code>snake_case</code> for variables, methods, macros, and fields; <code>UpperCamelCase</code> for types; and <code>SCREAMING_SNAKE_CASE</code> for statics and constants. Use <code>op_a</code> / <code>op_b</code> instead, please."}], "answers": [{"tags": [], "owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "is_accepted": true, "score": 1, "last_activity_date": 1542843667, "last_edit_date": 1542843667, "creation_date": 1542842286, "answer_id": 53421796, "question_id": 53421617, "link": "https://stackoverflow.com/questions/53421617/is-there-a-way-to-split-up-a-variable-inside-an-option-without-having-to-use-if/53421796#53421796", "title": "Is there a way to split up a variable inside an Option without having to use if statements?", "body": "<p>You can use <a href=\"https://doc.rust-lang.org/stable/std/option/enum.Option.html#method.map_or_else\" rel=\"nofollow noreferrer\"><code>map_or_else</code></a>.</p>\n\n<pre><code>let (opA, opB) = foo.map_or_else(\n    || (None, None),\n    |c| (Some(c.a), Some(c.b))\n);\n</code></pre>\n\n<p>The first function is called if <code>foo</code> is <code>None</code>, and returns two <code>None</code>s. The second function is called if <code>foo</code> is <code>Some</code> and splits the members into a tuple.</p>\n\n<p>Of course, this doesn't really save you much over a simple <code>match</code>, and will probably be harder to follow.</p>\n\n<pre><code>let (opA, opB) = match foo {\n    None =&gt; (None, None),\n    Some(c) =&gt; (Some(c.a), Some(c.b))\n};\n</code></pre>\n\n<p>By the way, <code>Option</code> does implement <code>Clone</code>, but it requires that the contained type implements <code>Clone</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": false, "score": -1, "last_activity_date": 1542870921, "creation_date": 1542870921, "answer_id": 53425645, "question_id": 53421617, "link": "https://stackoverflow.com/questions/53421617/is-there-a-way-to-split-up-a-variable-inside-an-option-without-having-to-use-if/53425645#53425645", "title": "Is there a way to split up a variable inside an Option without having to use if statements?", "body": "<blockquote>\n  <p>[T]here doesn't seem to be a <code>clone()</code> function for <code>Option</code> [...]</p>\n</blockquote>\n\n<p>That's wrong, <a href=\"https://doc.rust-lang.org/std/option/enum.Option.html#method.clone\" rel=\"nofollow noreferrer\">there is</a>, if the inner type implements <code>clone</code> as well. So in your case, just add <code>#[derive(Clone)]</code> to your <code>struct ItemA</code>.</p>\n\n<p>Next, you can use <a href=\"https://doc.rust-lang.org/std/option/enum.Option.html#method.as_ref\" rel=\"nofollow noreferrer\"><code>as_ref</code></a> to create an <code>Option&lt;&amp;T&gt;</code> and then use <code>map</code>.</p>\n\n<pre><code>let op_a = foo.as_ref().map(|c| &amp;c.a);\nlet op_b = foo.as_ref().map(|c| &amp;c.b);\n\nprintln!(\"{:?}\", op_a);\nprintln!(\"{:?}\", op_b);\n</code></pre>\n"}], "owner": {"reputation": 2058, "user_id": 3958875, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f6149ddd4636bcab17c52b751d79f7fd?s=128&d=identicon&r=PG&f=1", "display_name": "Prime_Aqasix", "link": "https://stackoverflow.com/users/3958875/prime-aqasix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 53421796, "answer_count": 2, "score": 0, "last_activity_date": 1542870921, "creation_date": 1542841070, "last_edit_date": 1542844805, "question_id": 53421617, "link": "https://stackoverflow.com/questions/53421617/is-there-a-way-to-split-up-a-variable-inside-an-option-without-having-to-use-if", "title": "Is there a way to split up a variable inside an Option without having to use if statements?", "body": "<p>I want the code below to work, but since <code>map()</code> takes ownership of <code>Option</code>, and there doesn't seem to be a <code>clone()</code> function for <code>Option</code>, the following doesn't compile.</p>\n\n<pre><code>fn main() {\n    struct ItemA {\n        a: String,\n        b: String,\n    }\n    let foo = Some(ItemA {\n        a: \"A String\".to_owned(),\n        b: \"B String\".to_owned(),\n    });\n    // OR\n    // let foo = None;\n\n    let opA: Option&lt;String&gt; = foo.map(|c| c.a);\n    let opB: Option&lt;String&gt; = foo.map(|c| c.b);\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0382]: use of moved value: `foo`\n  --&gt; src/main.rs:15:31\n   |\n14 |     let opA: Option&lt;String&gt; = foo.map(|c| c.a);\n   |                               --- value moved here\n15 |     let opB: Option&lt;String&gt; = foo.map(|c| c.b);\n   |                               ^^^ value used here after move\n   |\n   = note: move occurs because `foo` has type `std::option::Option&lt;main::ItemA&gt;`, which does not implement the `Copy` trait\n</code></pre>\n\n<p>It would be nice if <code>opA</code> can take ownership of <code>ItemA.a</code> (so it doesn't have to clone the strings), and <code>opB</code> can take ownership of <code>ItemA.b</code></p>\n\n<p>Is this possible to do without having to use if statements to check if the <code>Option</code> is <code>Some</code> or <code>None</code>, unwrapping, and wrapping it back up individually.</p>\n"}, {"tags": ["data-structures", "struct", "tree", "rust"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 2, "creation_date": 1542825928, "post_id": 53418328, "comment_id": 93711437, "body": "This is a bit broad; there&#39;s an infinite amount of solutions how to implement such a tree, depending on requirements. Could you please add more information what you are trying to achieve, and what specific obstacle you hit?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542826489, "post_id": 53418328, "comment_id": 93711736, "body": "Duplicate of <a href=\"https://stackoverflow.com/questions/45108489/what-is-the-paradigmatic-way-to-create-a-rust-tree-with-a-parent-pointer\">What is the paradigmatic way to create a Rust tree with a parent pointer?</a> (which is itself a duplicate of those two questions)."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1542826545, "post_id": 53418328, "comment_id": 93711758, "body": "Have you worked through <a href=\"http://cglab.ca/~abeinges/blah/too-many-lists/book/\" rel=\"nofollow noreferrer\">Learning Rust With Entirely Too Many Linked Lists</a>? It will answer many of your questions about the unique problems posed by cyclic data structures in Rust."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542826604, "post_id": 53418328, "comment_id": 93711789, "body": "See also <a href=\"https://stackoverflow.com/q/22268861/155423\">How would you implement a bi-directional linked list in Rust?</a>"}], "owner": {"reputation": 5193, "user_id": 1019129, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/357b7f0f0ca6e2c0f0ebccbec9b1a87b?s=128&d=identicon&r=PG", "display_name": "sten", "link": "https://stackoverflow.com/users/1019129/sten"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 472, "favorite_count": 0, "closed_date": 1542826431, "answer_count": 0, "score": 0, "last_activity_date": 1542848907, "creation_date": 1542824475, "last_edit_date": 1542848907, "question_id": 53418328, "link": "https://stackoverflow.com/questions/53418328/how-can-i-define-two-way-tree-structure-in-rust", "closed_reason": "Duplicate", "title": "How can I define two-way tree structure in Rust?", "body": "<p>I mean a tree where every node has multiple children and every child refers back to its parent.</p>\n\n<p>I've got this far:</p>\n\n<pre><code>pub struct Post {\n    content: String,\n    links: Vec&lt;Post&gt;,\n    parent: Box&lt;Post&gt;,\n}\n\nimpl Post {\n    pub fn new() -&gt; Post {\n        Post {\n            content: String::new(),\n            links: Vec::new(),\n            parent: Box::new(......),\n        }\n    }\n}\n</code></pre>\n\n<p>What do I put in the place of the dots?</p>\n"}, {"tags": ["file", "asynchronous", "rust", "checksum", "rust-tokio"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1542806366, "post_id": 53412922, "comment_id": 93700406, "body": "Using a <a href=\"https://doc.rust-lang.org/std/io/struct.BufReader.html\" rel=\"nofollow noreferrer\"><code>BufReader</code></a>?"}, {"owner": {"reputation": 27448, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 2, "creation_date": 1542808152, "post_id": 53412922, "comment_id": 93701507, "body": "You might also want to explore calculating the checksum for the actual data uploaded as it&#39;s being uploaded.  You already have the data passing through your processing at that point, so calculating the checksum then is almost a free operation.  This is especially true if you have performance considerations, because by calculating the checksum off the data after it&#39;s been saved to disk you&#39;re effectively doubling the IO operations you need to do to support file uploading."}, {"owner": {"reputation": 886, "user_id": 8170773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61b971ec934427a008d8b263ad4142b9?s=128&d=identicon&r=PG&f=1", "display_name": "hedgar2017", "link": "https://stackoverflow.com/users/8170773/hedgar2017"}, "edited": false, "score": 0, "creation_date": 1542811667, "post_id": 53412922, "comment_id": 93703586, "body": "Yeah, I totally agree. But it seems that I need to implement such thing myself, doesn&#39;t it? I&#39;d like to have something like another <code>Sink</code>, where I could feed the chunks so the <code>Sink</code> could calculate the checksum on the fly."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542823143, "post_id": 53412922, "comment_id": 93710272, "body": "What checksum? Is the implementation of the checksum naturally asynchronous? If so, just use it. If it&#39;s not, then this is a duplicate of <a href=\"https://stackoverflow.com/q/41932137/155423\">What is the best approach to encapsulate blocking I/O in future-rs?</a>."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1542813109, "post_id": 53414906, "comment_id": 93704519, "body": "This appears to be completely synchronous. The OP has explicitly requested an asynchronous solution."}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1542815164, "post_id": 53414906, "comment_id": 93705767, "body": "@Shepmaster I don&#39;t see how you can tell whether this is synchronous or asynchronous: I only said that for each block of data he should call <code>md5_context.consume</code>, I never said that he should do it in a synchronous loop."}], "tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": false, "score": 0, "last_activity_date": 1542815384, "last_edit_date": 1542815384, "creation_date": 1542812660, "answer_id": 53414906, "question_id": 53412922, "link": "https://stackoverflow.com/questions/53412922/how-do-i-asynchronously-calculate-the-checksum-of-a-file-on-the-hard-disk-in-rus/53414906#53414906", "title": "How do I asynchronously calculate the checksum of a file on the hard disk in Rust?", "body": "<p>It depends on what checksum algorithm you want to use, but using the <a href=\"https://crates.io/crates/md5\" rel=\"nofollow noreferrer\">md5 crate</a> as an example, you can compute the checksum on the fly. Something like this should do it:</p>\n\n<pre><code>// When starting the file transfer\nlet mut md5_context = md5::Context::new();\n\n// ...\n\n// as part of your existing processing for each block of data\nmd5_context.consume (&amp;block);\n\n// ...\n\n// once the last block has been processed\nreturn md5_context.compute();\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 886, "user_id": 8170773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61b971ec934427a008d8b263ad4142b9?s=128&d=identicon&r=PG&f=1", "display_name": "hedgar2017", "link": "https://stackoverflow.com/users/8170773/hedgar2017"}, "is_accepted": true, "score": 0, "last_activity_date": 1550923553, "last_edit_date": 1550923553, "creation_date": 1542920173, "answer_id": 53437888, "question_id": 53412922, "link": "https://stackoverflow.com/questions/53412922/how-do-i-asynchronously-calculate-the-checksum-of-a-file-on-the-hard-disk-in-rus/53437888#53437888", "title": "How do I asynchronously calculate the checksum of a file on the hard disk in Rust?", "body": "<p>Actually, making simple hashing algorithms asynchronous is in such cases somewhat redundant, as long as one MD5 calculation takes less then 1 us (about 500 ns).</p>\n\n<p>But, a new <code>blocking</code> API is now available in <code>tokio</code>. It allows executing blocking or CPU heavy operations using internal threading mechanisms.</p>\n"}], "owner": {"reputation": 886, "user_id": 8170773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61b971ec934427a008d8b263ad4142b9?s=128&d=identicon&r=PG&f=1", "display_name": "hedgar2017", "link": "https://stackoverflow.com/users/8170773/hedgar2017"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 666, "favorite_count": 0, "accepted_answer_id": 53437888, "answer_count": 2, "score": 1, "last_activity_date": 1550923553, "creation_date": 1542806232, "last_edit_date": 1542812029, "question_id": 53412922, "link": "https://stackoverflow.com/questions/53412922/how-do-i-asynchronously-calculate-the-checksum-of-a-file-on-the-hard-disk-in-rus", "title": "How do I asynchronously calculate the checksum of a file on the hard disk in Rust?", "body": "<p>I have a TCP file server in Rust / Tokio stack.</p>\n\n<p>When a client is uploading a file, the data is being read from a <code>tokio::net::TcpStream</code> and written to a <code>futures_fs::FsWriteSink</code>, which has been started on a separate <code>futures_fs::FsPool</code>.</p>\n\n<p>When the file is completely uploaded, I need to check its consistency by checking its checksum against the one sent by the client.</p>\n\n<p>What is the easiest way to asynchronously calculate the checksum, especially if the file does not fit into RAM?</p>\n"}, {"tags": ["multithreading", "rust"], "comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 2, "creation_date": 1542796181, "post_id": 53409879, "comment_id": 93694856, "body": "Rule of thumb for Rust: if you don&#39;t have to type <code>unsafe</code>, the code is memory safe, type safe and data-race free... aka &quot;safe&quot; ;)"}, {"owner": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1542797978, "post_id": 53409879, "comment_id": 93695960, "body": "I just have some confuse about <code>Arc</code>, and when to use it."}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1542801316, "post_id": 53409879, "comment_id": 93697748, "body": "&quot;When to use Arc?&quot; is a different question though."}, {"owner": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "edited": false, "score": 0, "creation_date": 1542804655, "post_id": 53409879, "comment_id": 93699485, "body": "I figure it out now.    : )"}], "answers": [{"comments": [{"owner": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "edited": false, "score": 0, "creation_date": 1542796511, "post_id": 53410036, "comment_id": 93695079, "body": "I have some threads which was in some threads. So I collect  the sub-sub-threads&#39; <code>JoinHandle</code>. I need the main thread to wait for them. Any suggestion?"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "reply_to_user": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "edited": false, "score": 0, "creation_date": 1542801364, "post_id": 53410036, "comment_id": 93697772, "body": "Why not have the creating thread wait for them before it exits? The main thread then waits for the creating thread, and it all works out."}, {"owner": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "edited": false, "score": 0, "creation_date": 1542803362, "post_id": 53410036, "comment_id": 93698765, "body": "But the creating thread have a lot of works to do, it&#39;s about flash sale. I don&#39;t want it to wait the payment thread."}], "tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": true, "score": 1, "last_activity_date": 1542796078, "creation_date": 1542796078, "answer_id": 53410036, "question_id": 53409879, "link": "https://stackoverflow.com/questions/53409879/is-it-safe-to-use-a-mutex-without-arc-in-multithreading/53410036#53410036", "title": "Is it safe to use a Mutex without Arc in multithreading?", "body": "<p>This is safe, yes. Multithreading is exactly what mutexes are for. <code>Arc</code> doesn't give you anything you need here.</p>\n\n<p>Note, of course, that your current code is horrendously inefficient. I hope your real use case does a lot more work between mutex locks than this.</p>\n"}], "owner": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 0, "accepted_answer_id": 53410036, "answer_count": 1, "score": 0, "last_activity_date": 1542805253, "creation_date": 1542795619, "last_edit_date": 1542805253, "question_id": 53409879, "link": "https://stackoverflow.com/questions/53409879/is-it-safe-to-use-a-mutex-without-arc-in-multithreading", "title": "Is it safe to use a Mutex without Arc in multithreading?", "body": "<pre><code>lazy_static! {\n    pub static ref A: Mutex&lt;Vec&lt;u8&gt;&gt; = Mutex::new(vec![]);\n}\n\n#[test]\nfn test() {\n    let mut handles = vec![];\n    for _ in 0..100 {\n        let handle = thread::spawn(|| for _ in 0..10000 { A.lock().unwrap().push(1); });\n        handles.push(handle);\n    }\n\n    for handle in handles { handle.join().unwrap(); }\n    println!(\"{}\", A.lock().unwrap().len());\n}\n</code></pre>\n\n<p>I got the output which was <code>1000000</code>, but I'm not sure this is a right way to collect the <code>data</code> in multithreading.</p>\n\n<p>Should I change it to <code>Arc&lt;Mutex&lt;_&gt;&gt;</code>?</p>\n"}, {"tags": ["types", "reference", "rust", "type-inference"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1542834636, "post_id": 53405287, "comment_id": 93715343, "body": "@Lucretiel I&#39;ve reduced the <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=f107e16e3daf793f846800c494799418\" rel=\"nofollow noreferrer\">playground example to a fraction of its size</a>. Note that removing the empty <code>impl</code> block makes the error go away. This gives some clues why it is occurring, but I don&#39;t really have an explanation yet. Also note that the line triggering the error now is <code>let _ = join;</code>."}, {"owner": {"reputation": 2348, "user_id": 864406, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd625e8a9c68a44bee8185847b7b59b0?s=128&d=identicon&r=PG", "display_name": "Lucretiel", "link": "https://stackoverflow.com/users/864406/lucretiel"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1542842586, "post_id": 53405287, "comment_id": 93718086, "body": "@SvenMarnach that microexample has the same error as my code, but doesn&#39;t reproduce my specific issue. In my code, <code>IntoIterator</code> DOES work fine; it&#39;s the <code>fn iter()</code> (which literally just calls <code>into_iter()</code>) that inexplicably breaks"}], "answers": [{"comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1542909735, "post_id": 53432226, "comment_id": 93746200, "body": "I still don&#39;t have any clue where the infinite recursion is coming from. Why does <code>&lt;&amp;T as IntoIterator&gt;::IntoIter</code> need to be &quot;inferred&quot;? My understanding is the <code>T</code> and <code>S</code> are inferred from the type of <code>join</code>, but once <code>T</code> is known, <code>&lt;&amp;T as IntoIterator&gt;::IntoIter</code> is a complete type that does not require any inference. The work-around is nice, but the source of the problem remains a complete mystery to me."}, {"owner": {"reputation": 11723, "user_id": 3356777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1c7bee1f2c7ba7f81ddb902b83626558?s=128&d=identicon&r=PG&f=1", "display_name": "attdona", "link": "https://stackoverflow.com/users/3356777/attdona"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1542955318, "post_id": 53432226, "comment_id": 93756309, "body": "Could be that the recursion happens before <code>T</code> and <code>S</code> are inferred from <code>join</code>? Look at <a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2015&amp;gist=0b46b9a5f617d3e7e7e6d2bb0b2740d0\" rel=\"nofollow noreferrer\">this</a>"}, {"owner": {"reputation": 11723, "user_id": 3356777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1c7bee1f2c7ba7f81ddb902b83626558?s=128&d=identicon&r=PG&f=1", "display_name": "attdona", "link": "https://stackoverflow.com/users/3356777/attdona"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1542957880, "post_id": 53432226, "comment_id": 93757341, "body": "cross-posted <a href=\"https://users.rust-lang.org/t/strange-rust-compiler-recursion/22543\" rel=\"nofollow noreferrer\">here</a>"}], "tags": [], "owner": {"reputation": 11723, "user_id": 3356777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1c7bee1f2c7ba7f81ddb902b83626558?s=128&d=identicon&r=PG&f=1", "display_name": "attdona", "link": "https://stackoverflow.com/users/3356777/attdona"}, "is_accepted": false, "score": 2, "last_activity_date": 1543081867, "last_edit_date": 1543081867, "creation_date": 1542893853, "answer_id": 53432226, "question_id": 53405287, "link": "https://stackoverflow.com/questions/53405287/whats-going-on-with-this-bizarre-recursive-type-error-in-rust/53432226#53432226", "title": "What&#39;s going on with this bizarre recursive type error in Rust?", "body": "<p>It seems that the compiler is not able to resolve the trait requirement needed by <code>iter()</code> return type <code>JoinIter&lt;&lt;&amp;T as IntoIterator&gt;::IntoIter, &amp;S&gt;</code>.</p>\n\n<p>I've received an hint for this from <code>rustc --explain E0275</code> error explanation: </p>\n\n<blockquote>\n  <p>This error occurs when there was a recursive trait requirement that overflowed\n  before it could be evaluated. Often this means that there is unbounded\n  recursion in resolving some type bounds.</p>\n</blockquote>\n\n<p>I don't know the details of the inference process of rust, I imagine the following is happening.</p>\n\n<p>Take this signature:</p>\n\n<pre><code>fn iter(&amp;self) -&gt; JoinIter&lt;&lt;&amp;T as IntoIterator&gt;::IntoIter, &amp;S&gt;\n</code></pre>\n\n<p>The compiler try to infer the return type from:</p>\n\n<pre><code>JoinIter&lt;&lt;&amp;T as IntoIterator&gt;::IntoIter, &amp;S&gt;\n</code></pre>\n\n<p>but <code>&lt;&amp;T as IntoIterator&gt;::IntoIter</code> is inferred from the <code>&amp;'a Join</code> impl:</p>\n\n<pre><code>impl&lt;'a, T, S&gt; IntoIterator for &amp;'a Join&lt;T, S&gt;\n    where &amp;'a T: IntoIterator\n{\n    type IntoIter = JoinIter&lt;&lt;&amp;'a T as IntoIterator&gt;::IntoIter, &amp;'a S&gt;;\n    type Item = JoinItem&lt;&lt;&amp;'a T as IntoIterator&gt;::Item, &amp;'a S&gt;;\n\n    fn into_iter(self) -&gt; Self::IntoIter {\n        JoinIter::new(self.container.into_iter(), &amp;self.separator)\n    }\n}\n</code></pre>\n\n<p>and <code>IntoIter</code> is again a <code>JoinIter&lt;&lt;&amp;'a T as IntoIterator&gt;::IntoIter, &amp;'a S&gt;</code> that has an <code>IntoIter</code> and so and so ad infinitum. </p>\n\n<p>A way to make it compile it is to help the compiler with a <a href=\"https://doc.rust-lang.org/book/first-edition/generics.html#resolving-ambiguities\" rel=\"nofollow noreferrer\">turbofish</a>: </p>\n\n<pre><code>let mut bad_ref_iter = Join::&lt;Vec&lt;i32&gt;, &amp;str&gt;::iter(&amp;join);\n</code></pre>\n\n<p>instead of:</p>\n\n<pre><code>let bad_ref_iter = join.iter();\n</code></pre>\n\n<h2>Update</h2>\n\n<p>The line:</p>\n\n<pre><code>type IntoIter = JoinIter&lt;&lt;&amp;'a T as IntoIterator&gt;::IntoIter, &amp;'a S&gt;;    \n</code></pre>\n\n<p>generate a recursion because Rust checks that traits are valid when they are defined rather than when they are used.</p>\n\n<p>See <a href=\"https://users.rust-lang.org/t/strange-rust-compiler-recursion/22543\" rel=\"nofollow noreferrer\">this post</a> for some more details and pointers to the progress of work\nof lazy normalization, which may solve this problem.</p>\n"}], "owner": {"reputation": 2348, "user_id": 864406, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd625e8a9c68a44bee8185847b7b59b0?s=128&d=identicon&r=PG", "display_name": "Lucretiel", "link": "https://stackoverflow.com/users/864406/lucretiel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 543, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1543081867, "creation_date": 1542774663, "last_edit_date": 1542921086, "question_id": 53405287, "link": "https://stackoverflow.com/questions/53405287/whats-going-on-with-this-bizarre-recursive-type-error-in-rust", "title": "What&#39;s going on with this bizarre recursive type error in Rust?", "body": "<p>I have an iterable struct called <code>Join</code>:</p>\n\n<pre><code>use std::iter::Peekable;\n\n#[derive(Debug)]\npub struct Join&lt;T, S&gt; {\n    container: T,\n    separator: S,\n}\n\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum JoinItem&lt;T, S&gt; {\n    Element(T),\n    Separator(S),\n}\n\npub struct JoinIter&lt;Iter: Iterator, Sep&gt; {\n    iter: Peekable&lt;Iter&gt;,\n    sep: Sep,\n    next_sep: bool,\n}\n\nimpl&lt;Iter: Iterator, Sep&gt; JoinIter&lt;Iter, Sep&gt; {\n    fn new(iter: Iter, sep: Sep) -&gt; Self {\n        JoinIter {\n            iter: iter.peekable(),\n            sep,\n            next_sep: false,\n        }\n    }\n}\n\nimpl&lt;I: Iterator, S: Clone&gt; Iterator for JoinIter&lt;I, S&gt; {\n    type Item = JoinItem&lt;I::Item, S&gt;;\n\n    /// Advance to the next item in the Join. This will either be the next\n    /// element in the underlying iterator, or a clone of the separator.\n    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {\n        let sep = &amp;self.sep;\n        let next_sep = &amp;mut self.next_sep;\n\n        if *next_sep {\n            self.iter.peek().map(|_| {\n                *next_sep = false;\n                JoinItem::Separator(sep.clone())\n            })\n        } else {\n            self.iter.next().map(|element| {\n                *next_sep = true;\n                JoinItem::Element(element)\n            })\n        }\n    }\n}\n</code></pre>\n\n<p>A reference to <code>Join</code> implements <code>IntoIterator</code>:</p>\n\n<pre><code>impl&lt;'a, T, S&gt; IntoIterator for &amp;'a Join&lt;T, S&gt;\nwhere\n    &amp;'a T: IntoIterator,\n{\n    type IntoIter = JoinIter&lt;&lt;&amp;'a T as IntoIterator&gt;::IntoIter, &amp;'a S&gt;;\n    type Item = JoinItem&lt;&lt;&amp;'a T as IntoIterator&gt;::Item, &amp;'a S&gt;;\n\n    fn into_iter(self) -&gt; Self::IntoIter {\n        JoinIter::new(self.container.into_iter(), &amp;self.separator)\n    }\n}\n</code></pre>\n\n<p>This compiles and passes usage tests.</p>\n\n<p>I also have an <code>iter</code> method defined on my <code>Join</code> struct:</p>\n\n<pre><code>impl&lt;T, S&gt; Join&lt;T, S&gt;\nwhere\n    for&lt;'a&gt; &amp;'a T: IntoIterator,\n{\n    pub fn iter(&amp;self) -&gt; JoinIter&lt;&lt;&amp;T as IntoIterator&gt;::IntoIter, &amp;S&gt; {\n        self.into_iter()\n    }\n}\n</code></pre>\n\n<p>This compiles fine, but when I actually try to use it:</p>\n\n<pre><code>fn main() {\n    // Create a join struct\n    let join = Join {\n        container: vec![1, 2, 3],\n        separator: \", \",\n    };\n\n    // This works fine\n    let mut good_ref_iter = (&amp;join).into_iter();\n    assert_eq!(good_ref_iter.next(), Some(JoinItem::Element(&amp;1)));\n    assert_eq!(good_ref_iter.next(), Some(JoinItem::Separator(&amp;\", \")));\n    assert_eq!(good_ref_iter.next(), Some(JoinItem::Element(&amp;2)));\n    assert_eq!(good_ref_iter.next(), Some(JoinItem::Separator(&amp;\", \")));\n    assert_eq!(good_ref_iter.next(), Some(JoinItem::Element(&amp;3)));\n    assert_eq!(good_ref_iter.next(), None);\n\n    // This line fails to compile; comment out this section and it all works\n    let bad_ref_iter = join.iter();\n    assert_eq!(bad_ref_iter.next(), Some(JoinItem::Element(&amp;1)));\n    assert_eq!(bad_ref_iter.next(), Some(JoinItem::Separator(&amp;\", \")));\n    assert_eq!(bad_ref_iter.next(), Some(JoinItem::Element(&amp;2)));\n    assert_eq!(bad_ref_iter.next(), Some(JoinItem::Separator(&amp;\", \")));\n    assert_eq!(bad_ref_iter.next(), Some(JoinItem::Element(&amp;3)));\n    assert_eq!(bad_ref_iter.next(), None);\n}\n</code></pre>\n\n<p>I get some kind of weird type recursion error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0275]: overflow evaluating the requirement `&amp;_: std::marker::Sized`\n   --&gt; src/join.rs:288:29\n    |\n 96 |         let mut iter = join.iter();\n    |                             ^^^^\n    |\n    = help: consider adding a `#![recursion_limit=\"128\"]` attribute to your crate\n    = note: required because of the requirements on the impl of `std::iter::IntoIterator` for `&amp;_`\n    = note: required because of the requirements on the impl of `std::iter::IntoIterator` for `&amp;join::Join&lt;_, _&gt;`\n    = note: required because of the requirements on the impl of `std::iter::IntoIterator` for `&amp;join::Join&lt;join::Join&lt;_, _&gt;, _&gt;`\n    = note: required because of the requirements on the impl of `std::iter::IntoIterator` for `&amp;join::Join&lt;join::Join&lt;join::Join&lt;_, _&gt;, _&gt;, _&gt;`\n    = note: required because of the requirements on the impl of `std::iter::IntoIterator` for `&amp;join::Join&lt;join::Join&lt;join::Join&lt;join::Join&lt;_, _&gt;, _&gt;, _&gt;, _&gt;`\n    = note: required because of the requirements on the impl of `std::iter::IntoIterator` for `&amp;join::Join&lt;join::Join&lt;join::Join&lt;join::Join&lt;join::Join&lt;_, _&gt;, _&gt;, _&gt;, _&gt;, _&gt;`\n    = note: required because of the requirements on the impl of `std::iter::IntoIterator` for `&amp;join::Join&lt;join::Join&lt;join::Join&lt;join::Join&lt;join::Join&lt;join::Join&lt;_, _&gt;, _&gt;, _&gt;, _&gt;, _&gt;, _&gt;`\n...\n</code></pre>\n\n<p>(I redacted about 100 more lines of recursive type error in the ...)</p>\n\n<p>As best I can tell, it appears to be attempting to proactively evaluate whether <code>&amp;Join&lt;_, _&gt;</code> implements <code>IntoIterator</code>, which requires checking if <code>&amp;Join&lt;Join&lt;_, _&gt;, _&gt;</code> fulfills IntoIterator, and so on forever. What I can't figure out is why it thinks it has to do this, since my actual type is fully qualified as <code>Join&lt;Vec&lt;{integer}, &amp;'static str&gt;</code>. Some things I've tried:</p>\n\n<ul>\n<li><p>Moving the trait bound off of the impl header and into the <code>iter</code> function, like so:</p>\n\n<pre><code>fn iter(&amp;'a self) -&gt; JoinIter&lt;&lt;&amp;'a T as IntoIterator&gt;::IntoIter, &amp;'a S&gt;\nwhere &amp;'a T: IntoIterator\n</code></pre>\n\n<p>This has the same result.</p></li>\n<li><p>Replacing <code>self.into_iter()</code> with the underlying expression, <code>JoinIter::new(self.container.into_iter(), self.separator)</code>, in the hopes that maybe it's struggling to differentiate <code>self.into_iter()</code> from <code>(&amp;self).into_iter()</code>. I've tried all of the following patterns:</p>\n\n<ul>\n<li><code>fn iter(&amp;self) -&gt; ... { self.into_iter() }</code></li>\n<li><code>fn iter(&amp;self) -&gt; ... { (&amp;self).into_iter() }</code></li>\n<li><code>fn iter(&amp;self) -&gt; ... { JoinIter::new(self.container.into_iter(), &amp;self.separator) }</code></li>\n<li><code>fn iter(&amp;self) -&gt; ... { JoinIter::new((&amp;self.container).into_iter(), &amp;self.separator) }</code></li>\n</ul></li>\n<li>Speaking of which, replacing the call to <code>self.iter()</code> with <code>(&amp;self).into_iter()</code> fixes the problem, but replacing it with <code>(&amp;self).iter()</code> does not.</li>\n</ul>\n\n<p>Why does <code>(&amp;join).into_iter()</code> work, but <code>join.iter()</code> does not, even though <code>iter()</code> simply calls <code>self.into_iter()</code> under the hood?</p>\n\n<p>This complete example, with identical code, is also available in the <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=4a48b1df26336392de8a267a95f056b0\" rel=\"nofollow noreferrer\">Rust Playground</a></p>\n\n<hr>\n\n<p>For more context about <code>Join</code>, see my older <a href=\"https://stackoverflow.com/q/53364798/864406\">Stack Overflow question</a> and my actual <a href=\"https://github.com/Lucretiel/joinery/blob/9bc3b2ddaa2609e7f9a9bc499555255eff2c334b/src/iter.rs\" rel=\"nofollow noreferrer\">source code</a>.</p>\n"}, {"tags": ["sockets", "rust", "sctp"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1542735246, "post_id": 53396016, "comment_id": 93672135, "body": "How rust could do anymore that what OS provide ???  use <a href=\"https://rust-num.github.io/num/libc/fn.recvmmsg.html\" rel=\"nofollow noreferrer\">rust-num.github.io/num/libc/fn.recvmmsg.html</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1542736645, "post_id": 53396016, "comment_id": 93672833, "body": "@Stargateur Rust has many abstractions on top of what the OS provides. It&#39;s difficult to tell exactly what OP wants to do, but possibly there would be some wrapped version of that specific system call with nice Rust semantics. The <a href=\"https://crates.io/crates/nix\" rel=\"nofollow noreferrer\">nix crate</a> is one such example (although it doesn&#39;t have anything for <code>recvmmsg</code> specifically)."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542739219, "post_id": 53396016, "comment_id": 93674093, "body": "@Shepmaster Yes, of course, what I want to say is that linux AFAIK, don&#39;t provide alternative, and that if a lib want to implement this feature it can only use this API. However I agree question is not clear. If SctpStream crate doesn&#39;t use it then the answer is &quot;there is not&quot;, dev it yourself that should be simple to add."}, {"owner": {"reputation": 8006, "user_id": 600170, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/6b0caa74c7b0a925622eb5075e1fc726?s=128&d=identicon&r=PG", "display_name": "laslowh", "link": "https://stackoverflow.com/users/600170/laslowh"}, "edited": false, "score": 0, "creation_date": 1558624353, "post_id": 53396016, "comment_id": 99170748, "body": "I wonder if its exclusion from the nix crate has to do with the required &quot;_GNU_SOURCE&quot; feature test macro (when in C-land). (edit: bad link)"}], "owner": {"reputation": 37, "user_id": 10233671, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f2836463fb194c064072a67eca07bcc?s=128&d=identicon&r=PG&f=1", "display_name": "JRD", "link": "https://stackoverflow.com/users/10233671/jrd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 253, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1542736360, "creation_date": 1542726805, "last_edit_date": 1542736360, "question_id": 53396016, "link": "https://stackoverflow.com/questions/53396016/is-there-a-way-to-receive-multiple-messages-in-a-single-system-call-using-a-sctp", "title": "Is there a way to receive multiple messages in a single system call using a SctpStream?", "body": "<p>I want to receive multiple messages from a <a href=\"https://docs.rs/rust-sctp/0.0.4/sctp/struct.SctpStream.html\" rel=\"nofollow noreferrer\"><code>SctpStream</code></a> in a single system call. My goal is to know the number of bytes received every time I make a receive call.</p>\n\n<p>The Linux socket function <code>recvmmsg</code> returns multiple messages:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>int recvmmsg(int sockfd, struct mmsghdr *msgvec, unsigned int vlen,\n                unsigned int flags, struct timespec *timeout);\nDESCRIPTION         \nThe recvmmsg() system call is an extension of recvmsg(2) that allows\nthe caller to receive multiple messages from a socket using a single\nsystem call. ...\n</code></pre>\n\n<p>I tried reading the socket buffer but it always returns 0 bytes. Does this  mean that EOF has been reached? I tried sending different number of packets and the buffer is also very large. Still I always get 0 as the number of bytes returned.  I am receiving the packets; transmission is not a problem here.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1542718169, "post_id": 53386717, "comment_id": 93661962, "body": "This is effectively the same question as <a href=\"https://stackoverflow.com/questions/40053550/the-compiler-suggests-i-add-a-static-lifetime-because-the-parameter-type-may-no\">The compiler suggests I add a &#39;static lifetime because the parameter type may not live long enough, but I don&#39;t think that&#39;s what I want</a>: <code>T: &#39;f</code> does not mean that <i>every</i> <code>T</code> lives for at least <code>&#39;f</code>, it means that <code>T</code> cannot contain any references with a lifetime less than <code>&#39;f</code>."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1542792522, "post_id": 53386717, "comment_id": 93692694, "body": "The only lifetime bound that makes sense here is using <code>T: &#39;static</code>. Since the function pointed to by <code>f</code> does not take any arguments, it can&#39;t really return a reference with any other lifetime than the static lifetime. (The situation would be different if you changed the type of <code>f</code> to a generic type <code>F: Fn() -&gt; T</code>, since this would also allow for closures, which can return captured references that have different lifetimes.)"}], "answers": [{"comments": [{"owner": {"reputation": 603, "user_id": 5426649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06e8dc32d97b1f0deb88bba090f58e46?s=128&d=identicon&r=PG&f=1", "display_name": "Olivier", "link": "https://stackoverflow.com/users/5426649/olivier"}, "edited": false, "score": 0, "creation_date": 1542707647, "post_id": 53390120, "comment_id": 93656134, "body": "Thank you. I understand your statement and I agree with it. However it does not answer my question. In the case you are showing I agree that <code>T</code> should be live longer than the lifetime<code>&#39;f</code>. However, I still do not understand why the statement &quot;<code>T</code> should be live longer than the lifetime`&#39;f&quot; is true for the case I presented in my question. You say &quot;This error has nothing to do with the fact that Function::f is a function&quot;. To this I want to ask &quot;Why?&quot;. Sorry if I am dumb."}, {"owner": {"reputation": 11723, "user_id": 3356777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1c7bee1f2c7ba7f81ddb902b83626558?s=128&d=identicon&r=PG&f=1", "display_name": "attdona", "link": "https://stackoverflow.com/users/3356777/attdona"}, "reply_to_user": {"reputation": 603, "user_id": 5426649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06e8dc32d97b1f0deb88bba090f58e46?s=128&d=identicon&r=PG&f=1", "display_name": "Olivier", "link": "https://stackoverflow.com/users/5426649/olivier"}, "edited": false, "score": 0, "creation_date": 1542709029, "post_id": 53390120, "comment_id": 93656961, "body": "I see your doubt, I&#39;ve added a note."}], "tags": [], "owner": {"reputation": 11723, "user_id": 3356777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1c7bee1f2c7ba7f81ddb902b83626558?s=128&d=identicon&r=PG&f=1", "display_name": "attdona", "link": "https://stackoverflow.com/users/3356777/attdona"}, "is_accepted": true, "score": 4, "last_activity_date": 1542783340, "last_edit_date": 1592644375, "creation_date": 1542706903, "answer_id": 53390120, "question_id": 53386717, "link": "https://stackoverflow.com/questions/53386717/lifetime-error-on-struct-referring-to-a-parametrized-function/53390120#53390120", "title": "Lifetime error on struct referring to a parametrized function", "body": "<p>Short answer: You need <code>T: 'f</code> because <code>T</code> may contains field that hold references and <code>fn() -&gt; T</code> is covariant over <code>T</code>.</p>\n<p>To simplify things may help to understand ...</p>\n<p>For a moment substitute <code>fn() -&gt; T</code> with <code>T</code>, because for me it is more simple to explain what it is happening with lifetimes.\nSee the Note below why with this substitution does not change the lifetime related error.</p>\n<pre><code>struct Function&lt;T&gt; {\n    f: T,\n}\n\nstruct FunctionRef&lt;'f, T&gt; {\n    f: &amp;'f Function&lt;T&gt;,\n}\n</code></pre>\n<p>This lead to the same <code>error[E0309]: the parameter type 'T' may not live long enough</code> error.</p>\n<p><code>FunctionRef</code> instances cannot outlive the reference it holds in <code>f</code> field:\nyou declare a generic lifetime parameter <code>'f</code> inside angle brackets and then you use <code>'f</code> as an annotation\ninside the struct body. See also the <a href=\"https://doc.rust-lang.org/book/2018-edition/ch10-03-lifetime-syntax.html#lifetime-annotations-in-struct-definitions\" rel=\"nofollow noreferrer\">book</a>.</p>\n<p>But <code>FunctionRef::f</code> depends on a type parameter <code>T</code>. The explicit constraint <code>T: 'f</code> guarantee that <code>T</code> instances\ndoes not outlive references holded by <code>T</code> and  <code>FunctionRef</code> does not outlive <code>FunctionRef::f</code>.</p>\n<p>If it can help to understand substitute the generic <code>T</code> with a specific <code>Foo</code> type:</p>\n<pre><code>struct Foo&lt;'a&gt; {\n    n: &amp;'a i32,\n}\n\nstruct FunctionRef&lt;'f, 'a: 'f&gt; {\n    f: &amp;'f Foo&lt;'a&gt;,\n}\n</code></pre>\n<p>You need to constraint lifetime <code>'a</code> to be valid at least as long as <code>'f</code> lifetime, otherwise memory safety rules would be violated.</p>\n<h2>Note</h2>\n<p>I have considered the case <code>f: T</code> equivalent of <code>f: fn() -&gt; T</code> because such type constructor is covariant over <code>T</code>.</p>\n<p>To grasp the meaning of <code>fn() -&gt; T</code> is covariant over <code>T</code>, consider this struct:</p>\n<pre><code>struct Foo&lt;'a&gt; {\n    v: &amp;'a i32\n}\n</code></pre>\n<p>In this case is safe to assign to <code>v</code> a value with a lifetime &quot;bigger&quot; than <code>'a</code>, for example:</p>\n<pre><code>let ref_value: &amp;'static i32 =  &amp;100;\nlet foo = Foo { v: ref_value};\n</code></pre>\n<p>Now the same holds for the following struct:</p>\n<pre><code>struct Function&lt;'a&gt; {\n    f: fn() -&gt; &amp;'a i32\n}\n</code></pre>\n<p>The field <code>f</code> expects a function that returns a <code>&amp;i32</code> that outlive <code>'a</code>.</p>\n<p>In this case it is safe to pass a function that returns a <code>&amp;i32</code> with a &quot;bigger&quot; lifetime, for example:</p>\n<pre><code>fn my_f() -&gt; &amp;'static i32 {\n    &amp;100\n}\n\nfn main() {\n    let foo = Function { f: my_f};\n}\n</code></pre>\n<p>There is quite a lot of type theory behind this, <a href=\"https://doc.rust-lang.org/nomicon/subtyping.html?highlight=constructor#variance\" rel=\"nofollow noreferrer\">see the nomicom</a> for a detailed explanation.</p>\n"}], "owner": {"reputation": 603, "user_id": 5426649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06e8dc32d97b1f0deb88bba090f58e46?s=128&d=identicon&r=PG&f=1", "display_name": "Olivier", "link": "https://stackoverflow.com/users/5426649/olivier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "accepted_answer_id": 53390120, "answer_count": 1, "score": 6, "last_activity_date": 1542783340, "creation_date": 1542691528, "last_edit_date": 1542698181, "question_id": 53386717, "link": "https://stackoverflow.com/questions/53386717/lifetime-error-on-struct-referring-to-a-parametrized-function", "title": "Lifetime error on struct referring to a parametrized function", "body": "<p>If I write the code below, I get <code>error[E0309]: the parameter type 'T' may not live long enough</code>.</p>\n\n<pre><code>struct Function&lt;T&gt; {\n    f: fn() -&gt; T,\n}\n\nstruct FunctionRef&lt;'f, T&gt; {\n    f: &amp;'f Function&lt;T&gt;,\n}\n</code></pre>\n\n<p>This fixes the error:</p>\n\n<pre><code>struct FunctionRef&lt;'f, T: 'f&gt; {\n    f: &amp;'f Function&lt;T&gt;,\n}\n</code></pre>\n\n<p>However, as far as I can tell, <code>T</code> is not bound on the lifetime <code>'f</code>. Indeed, <code>T</code> is a new object created when the function of type <code>fn () -&gt; T</code> is run.</p>\n\n<p>Where am I missing something?</p>\n"}, {"tags": ["rust", "nom"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1542682116, "post_id": 53384920, "comment_id": 93646895, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/52720072/155423\">Why does my nom parser not consume the entire input, leaving the last piece unparsed?</a> / <a href=\"https://stackoverflow.com/q/51257031/155423\">Parsing an integer with nom</a>. If you disagree, please <a href=\"https://stackoverflow.com/posts/53384920/edit\">edit</a> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 1823, "user_id": 868540, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/82d71d3e4512f325a6a0c5b3eef16719?s=128&d=identicon&r=PG", "display_name": "Pumphouse", "link": "https://stackoverflow.com/users/868540/pumphouse"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542688170, "post_id": 53384920, "comment_id": 93648136, "body": "I changed it as I read up and still can&#39;t seem to get it to work"}], "answers": [{"tags": [], "owner": {"reputation": 8789, "user_id": 539465, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/2acba600ecfbe1cc2e7f3c94b686ac84?s=128&d=identicon&r=PG", "display_name": "Valentin Lorentz", "link": "https://stackoverflow.com/users/539465/valentin-lorentz"}, "is_accepted": true, "score": 5, "last_activity_date": 1542826369, "last_edit_date": 1542826369, "creation_date": 1542702680, "answer_id": 53388960, "question_id": 53384920, "link": "https://stackoverflow.com/questions/53384920/why-does-nom-expect-a-str-when-i-pass-a-completestr/53388960#53388960", "title": "Why does nom expect a &amp;str when I pass a CompleteStr?", "body": "<p>The error is not on the last digit parser, it's on each of them (Rust 1.30.0 prints the error three times). That's because <code>u64::from_str</code> works on <code>&amp;str</code>, not <code>CompleteStr</code>.</p>\n\n<p>You can fix your parsers to use <code>u64::from_str</code> correctly this way:</p>\n\n<pre><code>do_parse!(\n    l: map_res!(digit, |CompleteStr(s)| u64::from_str(s)) &gt;&gt;\n    tag!(\"x\") &gt;&gt;\n    w: map_res!(digit, |CompleteStr(s)| u64::from_str(s)) &gt;&gt;\n    tag!(\"x\") &gt;&gt;\n    h: map_res!(digit, |CompleteStr(s)| u64::from_str(s)) &gt;&gt;\n    (Order { l: l, w: w, h: h })\n)\n</code></pre>\n\n<p>There are also some unrelated error with the next function, which can be fixed by using the appropriate types in the signature:</p>\n\n<pre><code>pub fn wrap_order(order: &amp;str) -&gt; Result&lt;(CompleteStr, Order), nom::Err&lt;CompleteStr&gt;&gt; {\n    order_parser(CompleteStr(order))\n}\n</code></pre>\n"}], "owner": {"reputation": 1823, "user_id": 868540, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/82d71d3e4512f325a6a0c5b3eef16719?s=128&d=identicon&r=PG", "display_name": "Pumphouse", "link": "https://stackoverflow.com/users/868540/pumphouse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 358, "favorite_count": 0, "accepted_answer_id": 53388960, "answer_count": 1, "score": 0, "last_activity_date": 1542826369, "creation_date": 1542676927, "last_edit_date": 1542729047, "question_id": 53384920, "link": "https://stackoverflow.com/questions/53384920/why-does-nom-expect-a-str-when-i-pass-a-completestr", "title": "Why does nom expect a &amp;str when I pass a CompleteStr?", "body": "<p>The parser works as expected until I want to parse the <code>h:</code> digit which is always the last digit in the string and the compiler gives me </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>^ expected &amp;str, found struct `nom::types::CompleteStr`\n</code></pre>\n\n<p>I assume it's because the parser is looking ahead. How do I stop that, or how can I signify it's done? </p>\n\n<pre><code>#[macro_use]\nextern crate nom;\n\nuse nom::digit;\nuse nom::types::CompleteStr;\nuse std::str::FromStr;\n\n#[derive(Debug, PartialEq)]\npub struct Order {\n    pub l: u64,\n    pub w: u64,\n    pub h: u64,\n}\n\nnamed!(order_parser&lt;CompleteStr, Order&gt;,\n    do_parse!(\n        l: map_res!(digit, u64::from_str) &gt;&gt;\n        tag!(\"x\") &gt;&gt;\n        w: map_res!(digit, u64::from_str) &gt;&gt;\n        tag!(\"x\") &gt;&gt;\n        h: map_res!(digit, u64::from_str) &gt;&gt;\n        (Order {l:  l, w: w, h: h })\n    )\n);\n\npub fn wrap_order(order: &amp;str) -&gt; Result&lt;(CompleteStr, Order), nom::Err&lt;&amp;str&gt;&gt; {\n    order_parser(order)\n}\n\n#[test]\nfn test_order_parser() {\n    assert_eq!(\n        wrap_order(CompleteStr(\"2x3x4\")),\n        Ok((CompleteStr(\"\"), Order { l: 2, w: 3, h: 4 }))\n    );\n}\n</code></pre>\n"}, {"tags": ["vector", "memory-management", "rust", "heap"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542664048, "post_id": 53382985, "comment_id": 93642156, "body": "<i>the largest type in the enum</i> \u2014 yes (duplicate <a href=\"https://stackoverflow.com/q/40365336/155423\">#1</a>). <i>kind of inefficient to allocate so much memory</i> \u2014 maybe (duplicate <a href=\"https://stackoverflow.com/q/27324821/155423\">#2</a> and <a href=\"https://stackoverflow.com/q/51200405/155423\">#3</a>)."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1542664136, "post_id": 53382985, "comment_id": 93642197, "body": "<i>coming from a C/C++ background</i> \u2014 how would you propose solving the problem of creating a vector of heterogenous types in either of these languages in a manner that is safe and &quot;efficient&quot;?"}, {"owner": {"reputation": 740, "user_id": 5275945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/02e26f954321fb0b208690369b38a22f?s=128&d=identicon&r=PG&f=1", "display_name": "Mihai", "link": "https://stackoverflow.com/users/5275945/mihai"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542664484, "post_id": 53382985, "comment_id": 93642331, "body": "i&#39;n not proposing anything and i&#39;m definitely not saying that this flexibility is not nice, but if you have some hard memory allocation requirements, you should keep this is mind when writing such code. since i am new to Rust i just want to understand how allocation works. @Shepmaster"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1542665290, "post_id": 53382985, "comment_id": 93642641, "body": "For something to be <b>in</b>efficient, there needs to be some technique that is more efficient."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1542667088, "post_id": 53382985, "comment_id": 93643273, "body": "C have the same limitation."}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1542667240, "post_id": 53382985, "comment_id": 93643330, "body": "Might be worth pointing out that most allocations happening here are very cheap (save for the vector allocation and re-allocations to increase capacity), so pushing new values (such as that <code>i32</code> or  <code>EnumTypes</code>) is not something as expensive as a <code>make_unique</code> in C++. Regarding efficiency, saving the space &quot;lost&quot; as a consequence of storing inline <code>Sized</code> values deriving from a sum of types of different sizes requires a much more complex vector data structure."}], "owner": {"reputation": 740, "user_id": 5275945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/02e26f954321fb0b208690369b38a22f?s=128&d=identicon&r=PG&f=1", "display_name": "Mihai", "link": "https://stackoverflow.com/users/5275945/mihai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 262, "favorite_count": 0, "closed_date": 1542663896, "answer_count": 0, "score": 1, "last_activity_date": 1542663924, "creation_date": 1542663394, "last_edit_date": 1542663854, "question_id": 53382985, "link": "https://stackoverflow.com/questions/53382985/how-is-memory-allocation-for-vectors-efficient-when-storing-multiple-types-using", "closed_reason": "Duplicate", "title": "How is memory allocation for vectors efficient when storing multiple types using enums?", "body": "<p>The Rust documentation says:</p>\n\n<blockquote>\n  <p>Vectors can only store values that are the same type. </p>\n</blockquote>\n\n<p>This makes sense because every time you want to push a new value in the vector, it needs to know how much memory to allocate for the new value.</p>\n\n<p>If we have:</p>\n\n<pre><code>let mut v = vec![1, 2, 3, 4, 5];\n</code></pre>\n\n<p>And then we want to add another value:</p>\n\n<pre><code>v.push(12);\n</code></pre>\n\n<p>It will allocate 32 bits for this new value. This makes perfect sense.</p>\n\n<p>Let's say we have this code which store multiple types using enums:</p>\n\n<pre><code>enum EnumTypes {\n    Float(f64),\n    Bool(bool),\n}\n\nlet mut v: Vec&lt;EnumTypes&gt; = Vec::new();\n</code></pre>\n\n<p>This is valid code; it follows Rust's rules regarding values in the vector being the same type, <code>EnumTypes</code> in this case, then we push a <code>EnumTypes::Bool</code> value to the vector:</p>\n\n<pre><code>v.push(EnumTypes::Bool(true));\n</code></pre>\n\n<p>How does Rust knows how much memory to allocate for <code>EnumTypes::Bool(true)</code> when we push it in the vector? Does Rust allocate sufficient memory to hold the largest type in the enum (f64 in this case)? If this is the case isn't kind of inefficient to allocate so much memory just to hold a bool type? Of course this flexibility is super nice compared to other languages but coming from a C/C++ background I feel like so much memory is wasted using this feature of the language.</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 561, "user_id": 2127148, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fcd1d9bdaa1feee2fd77396057fb8f10?s=128&d=identicon&r=PG", "display_name": "Johan Bj&#228;reholt", "link": "https://stackoverflow.com/users/2127148/johan-bj%c3%a4reholt"}, "edited": false, "score": 0, "creation_date": 1542653162, "post_id": 53380170, "comment_id": 93637339, "body": "Oh, that&#39;s unfortunate. Works for a few of my test cases but I also now get a stack overflow in one apparently but that&#39;s a seperate issue. Thanks!"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 4, "last_activity_date": 1542651786, "last_edit_date": 1542651786, "creation_date": 1542649939, "answer_id": 53380170, "question_id": 53380040, "link": "https://stackoverflow.com/questions/53380040/function-pointer-with-a-reference-argument-cannot-derive-debug/53380170#53380170", "title": "Function pointer with a reference argument cannot derive Debug", "body": "<blockquote>\n  <p>Is this a bug in Rust </p>\n</blockquote>\n\n<p>No, but it is a limitation:</p>\n\n<ul>\n<li><a href=\"https://github.com/rust-lang/rust/issues/45048\" rel=\"nofollow noreferrer\">Cannot derive(Debug) for a struct with a function with a reference parameter (#45048)</a></li>\n<li><a href=\"https://github.com/rust-lang/rust/issues/54508\" rel=\"nofollow noreferrer\">#[derive] Debug, PartialEq, Hash, etc. for any function pointers, regardless of type signature (#54508)</a></li>\n</ul>\n\n<blockquote>\n  <p>is there a solution or an alternative method</p>\n</blockquote>\n\n<p>Yes, <a href=\"https://stackoverflow.com/q/22243527/155423\">you must implement <code>Debug</code> for the type <code>Enum</code> yourself</a>.</p>\n"}], "owner": {"reputation": 561, "user_id": 2127148, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fcd1d9bdaa1feee2fd77396057fb8f10?s=128&d=identicon&r=PG", "display_name": "Johan Bj&#228;reholt", "link": "https://stackoverflow.com/users/2127148/johan-bj%c3%a4reholt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 1, "accepted_answer_id": 53380170, "answer_count": 1, "score": 0, "last_activity_date": 1542651786, "creation_date": 1542649444, "last_edit_date": 1542649575, "question_id": 53380040, "link": "https://stackoverflow.com/questions/53380040/function-pointer-with-a-reference-argument-cannot-derive-debug", "title": "Function pointer with a reference argument cannot derive Debug", "body": "<p>I have a enum where I want to generalize an function pointer. As soon as I add a reference inside the function pointer definition. it fails to compile because it cannot print it with <code>Debug</code>:</p>\n\n<pre><code>fn div1(t: i64, b: i64) -&gt; i64 {\n    t / b\n}\n\nfn div2(t: i64, b: &amp;i64) -&gt; i64 {\n    t / b\n}\n\n#[derive(Debug)]\nenum Enum {\n    FnTest1(fn(i64, i64) -&gt; i64),\n    FnTest2(fn(i64, &amp;i64) -&gt; i64),\n}\n\nfn main() {\n    println!(\"{:?}\", Enum::FnTest1(div1));\n    println!(\"{:?}\", Enum::FnTest2(div2));\n}\n</code></pre>\n\n<p>The error I get is this</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: `for&lt;'r&gt; fn(i64, &amp;'r i64) -&gt; i64` doesn't implement `std::fmt::Debug`\n  --&gt; src/main.rs:12:13\n   |\n12 |     FnTest2(fn(i64, &amp;i64) -&gt; i64),\n   |             ^^^^^^^^^^^^^^^^^^^^ `for&lt;'r&gt; fn(i64, &amp;'r i64) -&gt; i64` cannot be formatted using `{:?}` because it doesn't implement `std::fmt::Debug`\n   |\n   = help: the trait `std::fmt::Debug` is not implemented for `for&lt;'r&gt; fn(i64, &amp;'r i64) -&gt; i64`\n   = note: required because of the requirements on the impl of `std::fmt::Debug` for `&amp;for&lt;'r&gt; fn(i64, &amp;'r i64) -&gt; i64`\n   = note: required for the cast to the object type `dyn std::fmt::Debug`\n</code></pre>\n\n<p>It only shows an error for <code>FnTest2</code> which has a reference argument while <code>FnTest1</code> works fine.</p>\n\n<p>Is this a bug in Rust or is there a solution or an alternative method to this issue?</p>\n\n<p>I am running Rust nightly (rustup says: <code>rustc 1.30.0-nightly (ae7fe84e8 2018-09-26)</code>).</p>\n"}, {"tags": ["rust", "rust-crypto"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542649378, "post_id": 53379821, "comment_id": 93635622, "body": "Can not reproduce on macOS 10.14.1 / Rust 1.30.0."}, {"owner": {"reputation": 7882, "user_id": 2722968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d0a9ce812892f03b8342c5a60be24632?s=128&d=identicon&r=PG&f=1", "display_name": "user2722968", "link": "https://stackoverflow.com/users/2722968/user2722968"}, "edited": false, "score": 0, "creation_date": 1542650935, "post_id": 53379821, "comment_id": 93636430, "body": "Post <code>rustc --version</code> and <code>cargo --version</code> at the least."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1542656681, "post_id": 53379821, "comment_id": 93638876, "body": "If the stack is too small, how about trying a bigger one? On Linux, the stack size can be increased with <code>ulimit -s</code>; not sure whether this works on OSX as well."}, {"owner": {"reputation": 33, "user_id": 5544399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c851ed107225d90a6d319565f308f79f?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5544399/jeff"}, "edited": false, "score": 0, "creation_date": 1542671981, "post_id": 53379821, "comment_id": 93644702, "body": "<code>rustc --version rustc 1.30.1 (1433507eb 2018-11-07) cargo --version cargo 1.30.0 (a1a4ad372 2018-11-02)</code>  I increased ulimit to max, including stack size to 65532 kb."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1542698720, "post_id": 53379821, "comment_id": 93651529, "body": "@Jeff, have you tried nightly? <code>rustup install nightly; cargo +nightly build</code>"}, {"owner": {"reputation": 33, "user_id": 5544399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c851ed107225d90a6d319565f308f79f?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5544399/jeff"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1542913433, "post_id": 53379821, "comment_id": 93747402, "body": "@hellow, Just tried nightly but doesnt help :("}], "owner": {"reputation": 33, "user_id": 5544399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c851ed107225d90a6d319565f308f79f?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5544399/jeff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 144, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1542649028, "creation_date": 1542648561, "last_edit_date": 1542649028, "question_id": 53379821, "link": "https://stackoverflow.com/questions/53379821/why-does-compiling-rust-crypto-lead-to-a-stack-overflow", "title": "Why does compiling rust-crypto lead to a stack overflow?", "body": "<p>I'm trying to compile rust-crypto on Mac OS 10.10. I set my stack size at the hard limit of 65532 KB, but I get a stack overflow error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>sh-3.2$ cargo build --verbose                                                       \n\nCompiling rust-crypto v0.2.36                                                                                               \nRunning `rustc --crate-name crypto /Users/adminuser/.cargo/registry/src/github.com-1ecc6299db9ec823/rust-crypto-0.2.36/src/lib.rs --color always --crate-type lib --emit=dep-info,link -C debuginfo=2 -C metadata=532b3e4fff823a9b -C extra-filename=-532b3e4fff823a9b --out-dir /Users/adminuser/abc/target/debug/deps -L dependency=/Users/adminuser/abc/target/debug/deps --extern libc=/Users/adminuser/abc/target/debug/deps/liblibc-3ffb3aaa3935201b.rlib --extern rand=/Users/adminuser/abc/target/debug/deps/librand-59170c5140920682.rlib --extern rustc_serialize=/Users/adminuser/abc/target/debug/deps/librustc_serialize-05a36c10a732afd3.rlib --extern time=/Users/adminuser/abc/target/debug/deps/libtime-d920778de8a0916a.rlib --cap-lints allow -L native=/Users/adminuser/abc/target/debug/build/rust-crypto-6abe0ddd90a37e77/out -l static=_rust_crypto_helpers`                                    \n\nthread 'main' has overflowed its stack                                          \nfatal runtime error: stack overflow                                             \nerror: Could not compile `rust-crypto`.                                         \n\nCaused by:\n  process didn't exit successfully: `rustc --crate-name crypto /Users/adminuser/.cargo/registry/src/github.com-1ecc6299db9ec823/rust-crypto-0.2.36/src/lib.rs --color always --crate-type lib --emit=dep-info,link -C debuginfo=2 -C metadata=532b3e4fff823a9b -C extra-filename=-532b3e4fff823a9b --out-dir /Users/adminuser/abc/target/debug/deps -L dependency=/Users/adminuser/abc/target/debug/deps --extern libc=/Users/adminuser/abc/target/debug/deps/liblibc-3ffb3aaa3935201b.rlib --extern rand=/Users/adminuser/abc/target/debug/deps/librand-59170c5140920682.rlib --extern rustc_serialize=/Users/adminuser/abc/target/debug/deps/librustc_serialize-05a36c10a732afd3.rlib --extern time=/Users/adminuser/abc/target/debug/deps/libtime-d920778de8a0916a.rlib --cap-lints allow -L native=/Users/adminuser/abc/target/debug/build/rust-crypto-6abe0ddd90a37e77/out -l static=_rust_crypto_helpers` (signal: 6, SIGABRT: process abort signal)\n</code></pre>\n"}, {"tags": ["json", "serialization", "rust", "serde", "rust-rocket"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 2, "creation_date": 1542644790, "post_id": 53378780, "comment_id": 93633351, "body": "In the future, please provide a proper <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>, where you descripe your problem in a minimal way and let us see some code please."}], "answers": [{"comments": [{"owner": {"reputation": 301, "user_id": 7692787, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BHZtQ.jpg?s=128&g=1", "display_name": "ludeed", "link": "https://stackoverflow.com/users/7692787/ludeed"}, "edited": false, "score": 0, "creation_date": 1542645655, "post_id": 53378985, "comment_id": 93633833, "body": "Thanks, that really helped"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542648931, "post_id": 53378985, "comment_id": 93635402, "body": "This answer makes no sense to me in relation to the original question \u2014 the OP <b>never uses</b> the indexing syntax. They specifically use typed deserialization."}], "tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": true, "score": 2, "last_activity_date": 1542645431, "last_edit_date": 1542645431, "creation_date": 1542645119, "answer_id": 53378985, "question_id": 53378780, "link": "https://stackoverflow.com/questions/53378780/deserialization-of-json-reponse-keeps-quotation-marks-in-strings/53378985#53378985", "title": "Deserialization of JSON reponse keeps quotation marks in Strings", "body": "<p>I'll try to provide a simple example here.</p>\n\n<pre><code>extern crate serde; // 1.0.80\nextern crate serde_json; // 1.0.33\n\nuse serde_json::Value;\n\nconst JSON: &amp;str = r#\"{\n  \"name\": \"John Doe\",\n  \"age\": 43\n}\"#;\n\nfn main() {\n    let v: Value = serde_json::from_str(JSON).unwrap();\n    println!(\"{} is {} years old\", v[\"name\"], v[\"age\"]);\n}\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=dc1e9c43160bf7848cb7a0df990309b2\" rel=\"nofollow noreferrer\">playground</a>)</p>\n\n<p>will lead to</p>\n\n<blockquote>\n  <p>\"John Doe\" is 43 years old</p>\n</blockquote>\n\n<p>The reason is, that <code>v[\"name\"]</code> is not a <code>String</code>, but a <a href=\"https://docs.rs/serde_json/1.0.33/serde_json/enum.Value.html\" rel=\"nofollow noreferrer\"><code>Value</code></a> instead (You can check that by adding the line <code>let a: () = v[\"name\"];</code> which will result in the error: <code>expected (), found enum 'serde_json::Value'</code>).</p>\n\n<p>If you want a <code>&amp;str</code>/<code>String</code>, you have to convert it first by using <a href=\"https://docs.rs/serde_json/1.0.33/serde_json/enum.Value.html#method.as_str\" rel=\"nofollow noreferrer\"><code>Value::as_str</code></a>.</p>\n\n<p>If you change the <code>println!</code> line accordingly:</p>\n\n<pre><code>println!(\"{} is {} years old\", v[\"name\"].as_str().unwrap(), v[\"age\"]);\n</code></pre>\n\n<p>it will print out:</p>\n\n<blockquote>\n  <p>John Doe is 43 years old</p>\n</blockquote>\n"}], "owner": {"reputation": 301, "user_id": 7692787, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BHZtQ.jpg?s=128&g=1", "display_name": "ludeed", "link": "https://stackoverflow.com/users/7692787/ludeed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 679, "favorite_count": 0, "accepted_answer_id": 53378985, "answer_count": 1, "score": 0, "last_activity_date": 1543958833, "creation_date": 1542644455, "last_edit_date": 1543958833, "question_id": 53378780, "link": "https://stackoverflow.com/questions/53378780/deserialization-of-json-reponse-keeps-quotation-marks-in-strings", "title": "Deserialization of JSON reponse keeps quotation marks in Strings", "body": "<p>I am querying a Google API using reqwest:</p>\n\n<pre><code>let request_url = format!(\n    \"https://maps.googleapis.com/maps/api/place/findplacefromtext/json?input=*\\\n     &amp;inputtype=textquery\\\n     &amp;fields=formatted_address,name,place_id,types\\\n     &amp;locationbias=circle:50@{},{}\\\n     &amp;key=my-secret-key\",\n    lat, lng\n);\n\nlet mut response = reqwest::get(&amp;request_url).expect(\"pffff\");\n\nlet gr: GoogleResponse = response.json::&lt;GoogleResponse&gt;().expect(\"geeez\");\n</code></pre>\n\n<p>The <code>GoogleResponse</code> struct is defined as</p>\n\n<pre><code>#[derive(Debug, Serialize, Deserialize)]\npub struct DebugLog {\n    pub line: Vec&lt;String&gt;,\n}\n\n#[derive(Debug, Serialize, Deserialize)]\npub struct Candidate {\n    pub formatted_address: String,\n    pub name: String,\n    pub place_id: String,\n    pub types: Vec&lt;String&gt;,\n}\n\n#[derive(Debug, Serialize, Deserialize)]\npub struct GoogleResponse {\n    pub candidates: Vec&lt;Candidate&gt;,\n    pub debug_log: DebugLog,\n    pub status: String,\n}\n</code></pre>\n\n<p>This all compiles and I can make the request, however the result that I am having in the <code>String</code> fields contain the original <code>\"</code>. Is it supposed to be this way?</p>\n\n<p>For instance, when printing one of the formatted addresses I get:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\"result\": \"\\\"Street blabh blahab blahb\\\"\",\n</code></pre>\n\n<p>When I really wanted just</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\"result\": \"Street blabh blahab blahb\",\n</code></pre>\n\n<p>Am I doing something wrong or is this expected behavior?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1542639110, "post_id": 53377010, "comment_id": 93629886, "body": "Not sure about your usecase, but this is a bad idea to do so, unless you really know what you do."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1542639471, "post_id": 53377010, "comment_id": 93630099, "body": "Global, static, mutable variables are pure evil! Use <code>lazy_static!</code>, RefCell or a Mutex, if you really have to, but I would avoid them at all cost!"}, {"owner": {"reputation": 12555, "user_id": 1750757, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Zmc7D.jpg?s=128&g=1", "display_name": "Victor Polevoy", "link": "https://stackoverflow.com/users/1750757/victor-polevoy"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1542700532, "post_id": 53377010, "comment_id": 93652346, "body": "@hellow Oh, guys, of course I know that, I was just curious whether I can do so or not, because, you know, when I saw that I could not do this even with <code>unsafe</code> block, I was stuck. I haven&#39;t had a real use case for this by now, but I wanted to know whether it was possible in general or not."}], "answers": [{"tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": true, "score": 10, "last_activity_date": 1542641950, "last_edit_date": 1542641950, "creation_date": 1542638948, "answer_id": 53377104, "question_id": 53377010, "link": "https://stackoverflow.com/questions/53377010/is-it-possible-to-declare-2-static-mutable-variables-depending-on-each-other/53377104#53377104", "title": "Is it possible to declare 2 static mutable variables depending on each other?", "body": "<p>Yes it is.</p>\n\n<p>In your case, just remove <code>mut</code>, because static globals are safe to access, because they cannot be changed and therefore do not suffer from all the bad attributes, like unsynchronized access.</p>\n\n<pre><code>static I: i64 = 5;\nstatic J: i64 = I + 3;\n\nfn main() {\n    println!(\"I: {}, J: {}\", I, J);\n}\n</code></pre>\n\n<hr>\n\n<p>If you want them to be mutable, you can use <code>unsafe</code> where you access the unsafe variable (in this case <code>I</code>).</p>\n\n<pre><code>static mut I: i64 = 5;\nstatic mut J: i64 = unsafe { I } + 3;\n\nfn main() {\n    unsafe {\n        println!(\"I: {}, J: {}\", I, J);\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 12555, "user_id": 1750757, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Zmc7D.jpg?s=128&g=1", "display_name": "Victor Polevoy", "link": "https://stackoverflow.com/users/1750757/victor-polevoy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 53377104, "answer_count": 1, "score": 5, "last_activity_date": 1542641950, "creation_date": 1542638581, "last_edit_date": 1542640718, "question_id": 53377010, "link": "https://stackoverflow.com/questions/53377010/is-it-possible-to-declare-2-static-mutable-variables-depending-on-each-other", "title": "Is it possible to declare 2 static mutable variables depending on each other?", "body": "<p>I am trying to declare two static mutable variables but I have a <a href=\"https://play.rust-lang.org/?version=beta&amp;mode=debug&amp;edition=2018&amp;gist=7816e51f4d89b8dd7dfaf06cfc9d2ec1\" rel=\"noreferrer\">error</a>:</p>\n\n<pre><code>static mut I: i64 = 5;\nstatic mut J: i64 = I + 3;\n\nfn main() {\n    unsafe {\n        println!(\"I: {}, J: {}\", I, J);\n    }\n}\n</code></pre>\n\n<p>Error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0133]: use of mutable static is unsafe and requires unsafe function or block\n --&gt; src/main.rs:2:21\n  |\n2 | static mut J: i64 = I + 3;\n  |                     ^ use of mutable static\n  |\n  = note: mutable statics can be mutated by multiple threads: aliasing violations or data races will cause undefined behavior\n</code></pre>\n\n<p>Is it impossible? I also tried to <a href=\"https://play.rust-lang.org/?version=beta&amp;mode=debug&amp;edition=2018&amp;gist=35f17a4a04480667618ead85103fc852\" rel=\"noreferrer\">put an <code>unsafe</code> block on the declaration</a> but it seems to be incorrect grammar:</p>\n\n<pre><code>static mut I: i64 = 5;\n\nunsafe {\n    static mut J: i64 = I + 3;\n}\n</code></pre>\n"}, {"tags": ["vector", "hashmap", "rust"], "answers": [{"comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 2, "creation_date": 1542613005, "post_id": 53369040, "comment_id": 93616336, "body": "I would suggest to use <code>or_insert_with</code>, because of <a href=\"https://rust-lang-nursery.github.io/rust-clippy/v0.0.212/index.html#or_fun_call\" rel=\"nofollow noreferrer\">rust-lang-nursery.github.io/rust-clippy/v0.0.212/&hellip;</a>"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1542624923, "post_id": 53369040, "comment_id": 93622114, "body": "And I would suggest <code>or_default()</code>."}], "tags": [], "owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "is_accepted": false, "score": 2, "last_activity_date": 1542637532, "last_edit_date": 1542637532, "creation_date": 1542606978, "answer_id": 53369040, "question_id": 53368852, "link": "https://stackoverflow.com/questions/53368852/how-do-i-add-an-element-to-the-value-of-a-hash-map-that-pairs-strings-with-vecto/53369040#53369040", "title": "How do I add an element to the value of a hash map that pairs strings with vectors of strings?", "body": "<p>You need to understand the difference between an enum variant and the type of that variant. The variants of <code>Entry</code> are <code>Vacant</code>, and <code>Occupied</code>. You need to match against those variants, not their types.</p>\n\n<p>One way to fix your code would be like this:</p>\n\n<pre><code>use std::collections::hash_map::Entry::{Vacant, Occupied};\nmatch employees.entry(department) {\n    Vacant(entry) =&gt; { entry.insert(vec![name]); },\n    Occupied(mut entry) =&gt; { entry.get_mut().push(name); },\n}\n</code></pre>\n\n<p>But a much simpler solution would to use the return value of <code>or_insert</code>, which is a reference to the vector, and push onto it.</p>\n\n<pre><code>employees\n    .entry(department)\n    .or_insert(Vec::new())\n    .push(name);\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6276428, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8vQ6i.jpg?s=128&g=1", "display_name": "notthemessiah", "link": "https://stackoverflow.com/users/6276428/notthemessiah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1542637532, "creation_date": 1542605698, "last_edit_date": 1542637499, "question_id": 53368852, "link": "https://stackoverflow.com/questions/53368852/how-do-i-add-an-element-to-the-value-of-a-hash-map-that-pairs-strings-with-vecto", "title": "How do I add an element to the value of a hash map that pairs strings with vectors of strings?", "body": "<p>Like many new Rustaceans, I've been working my way through the <a href=\"https://doc.rust-lang.org/book/second-edition/\" rel=\"nofollow noreferrer\">Rust Book</a>. I'm reading through the chapter on collections, and I'm stuck on <a href=\"https://doc.rust-lang.org/book/second-edition/ch08-03-hash-maps.html\" rel=\"nofollow noreferrer\">one of the exercises</a>. It reads:</p>\n\n<blockquote>\n  <p>Using a hash map and vectors, create a text interface to allow a user to add employee names to a department in a company. For example, \u201cAdd Sally to Engineering\u201d or \u201cAdd Amir to Sales.\u201d Then let the user retrieve a list of all people in a department or all people in the company by department, sorted alphabetically.</p>\n</blockquote>\n\n<p>Here is my code so far:</p>\n\n<pre><code>use std::collections::hash_map::OccupiedEntry;\nuse std::collections::hash_map::VacantEntry;\nuse std::collections::HashMap;\nuse std::io;\n\nfn main() {\n    println!(\"Welcome to the employee database text interface.\\nHow can I help you?\");\n\n    let mut command = String::new();\n\n    io::stdin()\n        .read_line(&amp;mut command)\n        .expect(\"Failed to read line.\");\n\n    command = command.to_lowercase();\n\n    let commands = command.split_whitespace().collect::&lt;Vec&lt;&amp;str&gt;&gt;();\n\n    let mut department = commands[3];\n    let mut name = commands[1];\n\n    let mut employees = HashMap::new();\n\n    if commands[0] == \"add\" {\n        match employees.entry(department) {\n            VacantEntry(entry) =&gt; entry.entry(department).or_insert(vec![name]),\n            OccupiedEntry(entry) =&gt; entry.get_mut().push(name),\n        }\n    }\n}\n</code></pre>\n\n<p>The compiler returns the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0532]: expected tuple struct/variant, found struct `VacantEntry`\n  --&gt; src/main.rs:26:13\n   |\n26 |             VacantEntry(entry) =&gt; entry.entry(department).or_insert(vec![name]),\n   |             ^^^^^^^^^^^ did you mean `VacantEntry { /* fields */ }`?\n\nerror[E0532]: expected tuple struct/variant, found struct `OccupiedEntry`\n  --&gt; src/main.rs:27:13\n   |\n27 |             OccupiedEntry(entry) =&gt; entry.get_mut().push(name),\n   |             ^^^^^^^^^^^^^ did you mean `OccupiedEntry { /* fields */ }`?\n</code></pre>\n\n<p>I'm not exactly sure what I'm doing wrong. What do these errors mean, and what can I do to fix them and get my code to compile?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 1, "creation_date": 1542639481, "post_id": 53368303, "comment_id": 93630107, "body": "You are &quot;handling&quot; the error returned by <code>foo()</code>, but not the error returned by <code>map_err(...)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 7, "creation_date": 1542613776, "post_id": 53368681, "comment_id": 93616623, "body": "Or <a href=\"https://doc.rust-lang.org/stable/std/result/enum.Result.html#method.unwrap_or_else\" rel=\"nofollow noreferrer\"><code>foo().unwrap_or_else(|err| println!(&quot;{:?}&quot;, err))</code></a>"}], "tags": [], "owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "is_accepted": true, "score": 18, "last_activity_date": 1542604795, "last_edit_date": 1542604795, "creation_date": 1542604471, "answer_id": 53368681, "question_id": 53368303, "link": "https://stackoverflow.com/questions/53368303/why-am-i-getting-unused-result-which-must-be-used-result-may-be-an-err-vari/53368681#53368681", "title": "Why am I getting &quot;unused Result which must be used ... Result may be an Err variant, which should be handled&quot; even though I am handling it?", "body": "<p>You're not handling the result, you're mapping the result from one type to another.</p>\n\n<pre><code>foo().map_err(|err| println!(\"{:?}\", err));\n</code></pre>\n\n<p>What that line does is call <code>foo()</code>, which returns <code>Result&lt;(), std::io::Error&gt;</code>. Then <code>map_err</code> uses the type returned by your closure (in this case, <code>()</code>), and modifies the error type and returns <code>Result&lt;(), ()&gt;</code>. This is the result that you are not handling. Since you seem to want to just ignore this result, the simplest thing to do would probably be to call <code>ok()</code>.</p>\n\n<pre><code>foo().map_err(|err| println!(\"{:?}\", err)).ok();\n</code></pre>\n\n<p><code>ok()</code> converts <code>Result&lt;T,E&gt;</code> to <code>Option&lt;T&gt;</code>, converting errors to <code>None</code>, which you won't get a warning for ignoring.</p>\n\n<p>Alternatively:</p>\n\n<pre><code>match foo() {\n    Err(e) =&gt; println!(\"{:?}\", e),\n    _ =&gt; ()\n}\n</code></pre>\n"}], "owner": {"reputation": 6509, "user_id": 356011, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/d17ff41be1044be6fb5ef186b83efb20?s=128&d=identicon&r=PG", "display_name": "marathon", "link": "https://stackoverflow.com/users/356011/marathon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5781, "favorite_count": 0, "accepted_answer_id": 53368681, "answer_count": 1, "score": 10, "last_activity_date": 1542637596, "creation_date": 1542601534, "last_edit_date": 1542637596, "question_id": 53368303, "link": "https://stackoverflow.com/questions/53368303/why-am-i-getting-unused-result-which-must-be-used-result-may-be-an-err-vari", "title": "Why am I getting &quot;unused Result which must be used ... Result may be an Err variant, which should be handled&quot; even though I am handling it?", "body": "<pre><code>fn main() {\n    foo().map_err(|err| println!(\"{:?}\", err));\n}\n\nfn foo() -&gt; Result&lt;(), std::io::Error&gt; {\n    Ok(())\n}\n</code></pre>\n\n<p>results:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>warning: unused `std::result::Result` that must be used\n --&gt; src/main.rs:2:5\n  |\n2 |     foo().map_err(|err| println!(\"{:?}\", err));\n  |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  |\n  = note: #[warn(unused_must_use)] on by default\n  = note: this `Result` may be an `Err` variant, which should be handled\n\n    Finished dev [unoptimized + debuginfo] target(s) in 0.58s\n     Running `target/debug/playground`\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=beta&amp;mode=debug&amp;edition=2018&amp;gist=ab5084d87397e890a61c4495fc195e22\" rel=\"noreferrer\">playground link</a></p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 5800, "user_id": 6163736, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/TKHBG.jpg?s=128&g=1", "display_name": "stacksonstacks", "link": "https://stackoverflow.com/users/6163736/stacksonstacks"}, "edited": false, "score": 0, "creation_date": 1542598851, "post_id": 53367989, "comment_id": 93612532, "body": "Question title may need an update but I&#39;m not sure what else to call it"}, {"owner": {"reputation": 2757, "user_id": 1042144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d1bc195cf067a719735316e970a5449?s=128&d=identicon&r=PG", "display_name": "Brian Kung", "link": "https://stackoverflow.com/users/1042144/brian-kung"}, "edited": false, "score": 0, "creation_date": 1542599720, "post_id": 53367989, "comment_id": 93612700, "body": "I&#39;m fairly certain this is an <a href=\"https://doc.rust-lang.org/book/second-edition/ch03-02-data-types.html#the-tuple-type\" rel=\"nofollow noreferrer\">empty tuple.</a> In this case, it looks like an OK result will unwrap to reveal an empty tuple. I&#39;m not sure what the <code>error::Result&lt;()&gt;</code> means in this case, though, so I&#39;ve refrained from adding an answer"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1542613433, "post_id": 53367989, "comment_id": 93616493, "body": "Also related: <a href=\"https://stackoverflow.com/questions/24842271/what-is-the-purpose-of-the-unit-type-in-rust\" title=\"what is the purpose of the unit type in rust\">stackoverflow.com/questions/24842271/&hellip;</a>"}], "owner": {"reputation": 5800, "user_id": 6163736, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/TKHBG.jpg?s=128&g=1", "display_name": "stacksonstacks", "link": "https://stackoverflow.com/users/6163736/stacksonstacks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 428, "favorite_count": 0, "closed_date": 1542616542, "answer_count": 0, "score": 3, "last_activity_date": 1542637142, "creation_date": 1542598689, "last_edit_date": 1542599286, "question_id": 53367989, "link": "https://stackoverflow.com/questions/53367989/what-does-mean-in-rust", "closed_reason": "Duplicate", "title": "What does () mean in Rust?", "body": "<p>I'm trying to understand a function similar to the following:</p>\n\n<pre><code>fn some_func(arg1: str, arg2: str) -&gt; error::Result&lt;()&gt;\n{\n  /// Do some stuff ...\n  Ok(())\n}\n</code></pre>\n\n<p>What does the <code>()</code> given to <code>Ok</code> and <code>Result</code> mean in this case? Is this idiomatic or an implementation detail of the codebase?</p>\n\n<hr>\n\n<p>Update: Compiled the following code block which may serve as a more useful MVCE</p>\n\n<pre><code>fn main() -&gt; Result&lt;(), ()&gt; {\n  Ok(())\n}\n</code></pre>\n"}, {"tags": ["rust", "formatting", "traits"], "comments": [{"owner": {"reputation": 46065, "user_id": 234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/463c0219a51a5d1fd08e1fa280811b57?s=128&d=identicon&r=PG", "display_name": "Francis Gagn&#233;", "link": "https://stackoverflow.com/users/234590/francis-gagn%c3%a9"}, "edited": false, "score": 0, "creation_date": 1542574113, "post_id": 53364798, "comment_id": 93607133, "body": "It looks like the compiler is treating <code>for&lt;&#39;a&gt; Display</code> as different from <code>Display</code>. This might be a bug in the compiler."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1542574360, "post_id": 53364798, "comment_id": 93607204, "body": "This indeed looks like a shortcoming in the compiler to me. You are right that the item type is <code>&amp;&amp;str</code>, as you can easily verify by trying to compile <code>let _: &lt;&amp;Vec&lt;&amp;str&gt; as IntoIterator&gt;::Item = ();</code>. And <code>&amp;&amp;str</code> definitely <i>does</i> implement <code>Display</code>, as can be verified by adding <code>&lt;&amp;&amp;str as fmt::Display&gt;::fmt(&amp;&amp;&quot;hello&quot;, f)?;</code> to the body of <code>fmt()</code>. So this should definitely work. My guess is that <code>&lt;&amp;&#39;a std::vec::Vec&lt;&amp;str&gt; as std::iter::IntoIterator&gt;::Item</code> isn&#39;t correctly normalized to <code>&amp;&#39;a &amp;str</code> for some reason."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1542575963, "post_id": 53364798, "comment_id": 93607622, "body": "See also <a href=\"https://github.com/rust-lang/rust/issues/24159\" rel=\"nofollow noreferrer\">github.com/rust-lang/rust/issues/24159</a> and the issues linked there. Often this can be worked around by adding an additional type parameter for the item type, and forcing it to be the actual item type by changing the trait bound <code>IntoIterator</code> to <code>IntoIterator&lt;Item = T&gt;</code>, where <code>T</code> is the new type parameter. This doesn&#39;t work int his case, though, due to the HRTBs."}, {"owner": {"reputation": 2348, "user_id": 864406, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd625e8a9c68a44bee8185847b7b59b0?s=128&d=identicon&r=PG", "display_name": "Lucretiel", "link": "https://stackoverflow.com/users/864406/lucretiel"}, "edited": false, "score": 0, "creation_date": 1542581285, "post_id": 53364798, "comment_id": 93609039, "body": "You actually can do that in this case; I was able to try <code>&lt;T: Display&gt; ... where &amp;&#39;a C: IntoIterator&lt;Item=T&gt;</code>. However, I got a different and somehow even less useful error message about unfulfilled lifetime bounds."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1542613088, "post_id": 53364798, "comment_id": 93616373, "body": "@Lucretiel The reason this does not work is because of the lifetime of <code>Item</code>. In your example, the item type is <code>&amp;&amp;str</code>, but annoted with the lifetime of the HRTB, it would have to be <code>&amp;&#39;a &amp;str</code> for <i>all lifetimes</i> <code>&#39;a</code>, which of course is impossible. That&#39;s what I meant in my previous comment."}, {"owner": {"reputation": 2348, "user_id": 864406, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd625e8a9c68a44bee8185847b7b59b0?s=128&d=identicon&r=PG", "display_name": "Lucretiel", "link": "https://stackoverflow.com/users/864406/lucretiel"}, "edited": false, "score": 0, "creation_date": 1542655221, "post_id": 53364798, "comment_id": 93638235, "body": "Oh, of course! That does make sense."}], "answers": [{"tags": [], "owner": {"reputation": 6357, "user_id": 6086311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb99289473f6393b89474785f2d294d1?s=128&d=identicon&r=PG", "display_name": "dtolnay", "link": "https://stackoverflow.com/users/6086311/dtolnay"}, "is_accepted": true, "score": 8, "last_activity_date": 1542575812, "creation_date": 1542575812, "answer_id": 53365549, "question_id": 53364798, "link": "https://stackoverflow.com/questions/53364798/why-does-the-compiler-claim-that-a-generic-doesnt-implement-display-even-thou/53365549#53365549", "title": "Why does the compiler claim that a generic doesn&#39;t implement `Display` even though it should?", "body": "<p>Seems like a compiler limitation. You can work around it for now by writing the impl bound in terms of a private helper trait that represents \"display with lifetime\". This enables the compiler to see that <code>for&lt;'a&gt; private::Display&lt;'a&gt;</code> implies <code>fmt::Display</code>.</p>\n\n<pre><code>use std::fmt;\n\npub struct Join&lt;Container, Sep&gt; {\n    container: Container,\n    sep: Sep,\n}\n\nmod private {\n    use std::fmt;\n    pub trait Display&lt;'a&gt;: fmt::Display {}\n    impl&lt;'a, T&gt; Display&lt;'a&gt; for T where T: fmt::Display {}\n}\n\nimpl&lt;Container, Sep&gt; fmt::Display for Join&lt;Container, Sep&gt;\nwhere\n    for&lt;'a&gt; &amp;'a Container: IntoIterator,\n    for&lt;'a&gt; &lt;&amp;'a Container as IntoIterator&gt;::Item: private::Display&lt;'a&gt;,\n    Sep: fmt::Display,\n{\n    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {\n        let mut iter = self.container.into_iter();\n\n        match iter.next() {\n            None =&gt; Ok(()),\n            Some(first) =&gt; {\n                first.fmt(f)?;\n\n                iter.try_for_each(move |element| {\n                    self.sep.fmt(f)?;\n                    element.fmt(f)\n                })\n            }\n        }\n    }\n}\n\nfn main() {\n    println!(\"{}\", Join {\n        container: vec![\"Hello\", \"World\"],\n        sep: \", \",\n    });\n}\n</code></pre>\n"}], "owner": {"reputation": 2348, "user_id": 864406, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd625e8a9c68a44bee8185847b7b59b0?s=128&d=identicon&r=PG", "display_name": "Lucretiel", "link": "https://stackoverflow.com/users/864406/lucretiel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1496, "favorite_count": 0, "accepted_answer_id": 53365549, "answer_count": 1, "score": 12, "last_activity_date": 1542575812, "creation_date": 1542570383, "last_edit_date": 1542570841, "question_id": 53364798, "link": "https://stackoverflow.com/questions/53364798/why-does-the-compiler-claim-that-a-generic-doesnt-implement-display-even-thou", "title": "Why does the compiler claim that a generic doesn&#39;t implement `Display` even though it should?", "body": "<p>I'm building a library that implements string joins; that is, printing all the elements of a container separated by a separator. My basic design looks like this:</p>\n\n<pre><code>use std::fmt;\n\n#[derive(Debug, Clone, PartialEq, Eq)]\npub struct Join&lt;Container, Sep&gt; {\n    container: Container,\n    sep: Sep,\n}\n\nimpl&lt;Container, Sep&gt; fmt::Display for Join&lt;Container, Sep&gt;\nwhere\n    for&lt;'a&gt; &amp;'a Container: IntoIterator,\n    for&lt;'a&gt; &lt;&amp;'a Container as IntoIterator&gt;::Item: fmt::Display,\n    Sep: fmt::Display,\n{\n    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {\n        let mut iter = self.container.into_iter();\n\n        match iter.next() {\n            None =&gt; Ok(()),\n            Some(first) =&gt; {\n                first.fmt(f)?;\n\n                iter.try_for_each(move |element| {\n                    self.sep.fmt(f)?;\n                    element.fmt(f)\n                })\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>This trait implementation compiles without complaint. Notice the bound on <code>&amp;'a C: IntoIterator</code>. Many containers implement <code>IntoIterator</code> for a reference to themselves, to allow for iterating over references to the contained items (for instance, <code>Vec</code> implements it <a href=\"https://doc.rust-lang.org/std/vec/struct.Vec.html#impl-IntoIterator-2\" rel=\"noreferrer\">here</a>).</p>\n\n<p>However, when I actually try to use my <code>Join</code> struct, I get an unsatisfied trait bound:</p>\n\n<pre><code>fn main() {\n    let data = vec![\"Hello\", \"World\"];\n    let join = Join {\n        container: data,\n        sep: \", \",\n    };\n    println!(\"{}\", join);\n}\n</code></pre>\n\n<p>This code produces a compilation error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: `&lt;&amp;'a std::vec::Vec&lt;&amp;str&gt; as std::iter::IntoIterator&gt;::Item` doesn't implement `std::fmt::Display`\n  --&gt; src/main.rs:38:20\n   |\n38 |     println!(\"{}\", join);\n   |                    ^^^^ `&lt;&amp;'a std::vec::Vec&lt;&amp;str&gt; as std::iter::IntoIterator&gt;::Item` cannot be formatted with the default formatter\n   |\n   = help: the trait `for&lt;'a&gt; std::fmt::Display` is not implemented for `&lt;&amp;'a std::vec::Vec&lt;&amp;str&gt; as std::iter::IntoIterator&gt;::Item`\n   = note: in format strings you may be able to use `{:?}` (or {:#?} for pretty-print) instead\n   = note: required because of the requirements on the impl of `std::fmt::Display` for `Join&lt;std::vec::Vec&lt;&amp;str&gt;, &amp;str&gt;`\n   = note: required by `std::fmt::Display::fmt`\n</code></pre>\n\n<p>The key line seems to be this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>the trait `for&lt;'a&gt; std::fmt::Display` is not implemented for `&lt;&amp;'a std::vec::Vec&lt;&amp;str&gt; as std::iter::IntoIterator&gt;::Item`\n</code></pre>\n\n<p>Unfortunately, the compiler doesn't actually tell me what the <code>Item</code> type is, but based on my reading of <a href=\"https://doc.rust-lang.org/std/vec/struct.Vec.html#impl-IntoIterator-2\" rel=\"noreferrer\">the docs</a>, it appears to be <code>&amp;T</code>, which in this case means <code>&amp;&amp;str</code>. </p>\n\n<p>Why doesn't the compiler think that <code>&amp;&amp;str</code> implements <code>Display</code>? I've tried this with many other types, like <code>usize</code> and <code>String</code>, and none of them work; they all fail with the same error. I know that these reference type don't <em>directly</em> implement <code>Display</code>, but the implementation should be picked up automatically through deref coercion, right?</p>\n"}, {"tags": ["rust", "rust-macros", "wasm-bindgen"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 1, "last_activity_date": 1543349673, "creation_date": 1543349673, "answer_id": 53507421, "question_id": 53364002, "link": "https://stackoverflow.com/questions/53364002/how-do-i-apply-a-macro-attribute-to-a-function-defined-in-a-separate-module/53507421#53507421", "title": "How do I apply a macro attribute to a function defined in a separate module?", "body": "<p>As far as I know, there's no way to do this. Macros operate on the AST of the code they are attached to, and there's no code to be attached to here.</p>\n\n<p>If you really need this, you'll have to copy-and-paste the signature of your function:</p>\n\n<pre><code>mod my_code {\n    pub fn my_function(_: i32) -&gt; String {\n        unimplemented!()\n    }\n}\n\n#[wasm_bindgen]\nfn my_function(a: i32) -&gt; String {\n    my_code::my_function(a)\n}\n</code></pre>\n\n<p>It's possible you could write a macro to make the wrapping slightly less tedious, but you'll still need to replicate the function name, argument types, and return type.</p>\n"}], "owner": {"reputation": 743, "user_id": 194264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aae3fb775af795e69e463033d5d2eda7?s=128&d=identicon&r=PG&f=1", "display_name": "Stefan Novak", "link": "https://stackoverflow.com/users/194264/stefan-novak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 53507421, "answer_count": 1, "score": 1, "last_activity_date": 1543349673, "creation_date": 1542564666, "last_edit_date": 1542565024, "question_id": 53364002, "link": "https://stackoverflow.com/questions/53364002/how-do-i-apply-a-macro-attribute-to-a-function-defined-in-a-separate-module", "title": "How do I apply a macro attribute to a function defined in a separate module?", "body": "<p>I'm interested in using <code>wasm-bindgen</code> via <code>rust-webpack-template</code> to compile Rust code to WebAssembly. However, I'd like to avoid directly wrapping my code with the <code>#[wasm_bindgen]</code> attribute macro directly so that I can separate out the function logic from the generated WebAssembly interface to better organize my project. Instead, I would prefer to have binding generation be in a separate file, for example:</p>\n\n<pre><code>mod my_code;\nuse my_code::my_function;\n\n#[wasm_bindgen]\nmy_function; // I want to do something like this!\n</code></pre>\n\n<p>I understand that <code>#[wasm_bindgen]</code> is a macro attribute that operates on the AST of the function definition that usually follows, but is there an approach for applying that macro to code defined elsewhere?</p>\n"}, {"tags": ["asynchronous", "tcp", "rust", "future", "rust-tokio"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542548555, "post_id": 53361472, "comment_id": 93599580, "body": "Please review how to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> and then <a href=\"https://stackoverflow.com/posts/53361472/edit\">edit</a> your question to include it. We cannot tell what crates, types, traits, fields, etc. are present in the code. Try to produce something that reproduces your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> or you can reproduce it in a brand new Cargo project. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MCVE tips</a> as well."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542549148, "post_id": 53361472, "comment_id": 93599759, "body": "Please include the <b>exact</b> error message you are getting."}, {"owner": {"reputation": 886, "user_id": 8170773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61b971ec934427a008d8b263ad4142b9?s=128&d=identicon&r=PG&f=1", "display_name": "hedgar2017", "link": "https://stackoverflow.com/users/8170773/hedgar2017"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542575596, "post_id": 53361472, "comment_id": 93607530, "body": "I think my questions are pretty simple for you so it is unnecessary to provide so much data. Today I am a bit in a hurry, but next time I will have more time."}], "answers": [{"comments": [{"owner": {"reputation": 886, "user_id": 8170773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61b971ec934427a008d8b263ad4142b9?s=128&d=identicon&r=PG&f=1", "display_name": "hedgar2017", "link": "https://stackoverflow.com/users/8170773/hedgar2017"}, "edited": false, "score": 0, "creation_date": 1542575377, "post_id": 53361628, "comment_id": 93607478, "body": "Thanks, it works. But for some reason <code>read_exact</code> writes data to the end of the buffer. Actually, I ended up with implementing a custom future that consumes the stream and returns the stream along with the read data as a tuple - just like <code>write_all</code>, but for reading."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 4, "last_activity_date": 1542584332, "last_edit_date": 1542584332, "creation_date": 1542549119, "answer_id": 53361628, "question_id": 53361472, "link": "https://stackoverflow.com/questions/53361472/how-do-i-read-until-the-tokionettcpstream-in-a-future-chain/53361628#53361628", "title": "How do I read_until the tokio::net::TcpStream in a future chain?", "body": "<p>Reading the documentation for <a href=\"https://doc.rust-lang.org/nightly/std/io/trait.BufRead.html\" rel=\"nofollow noreferrer\"><code>BufRead</code></a>, you'll see the text:</p>\n\n<blockquote>\n  <p>If you have something that implements <a href=\"https://doc.rust-lang.org/nightly/std/io/trait.Read.html\" rel=\"nofollow noreferrer\"><code>Read</code></a>, you can use the <a href=\"https://doc.rust-lang.org/nightly/std/io/struct.BufReader.html\" rel=\"nofollow noreferrer\"><code>BufReader</code> type</a> to turn it into a <code>BufRead</code>.</p>\n</blockquote>\n\n<pre><code>fn example(stream: TcpStream) {\n    io::read_until(std::io::BufReader::new(stream), 0, vec![]);\n}\n</code></pre>\n"}], "owner": {"reputation": 886, "user_id": 8170773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61b971ec934427a008d8b263ad4142b9?s=128&d=identicon&r=PG&f=1", "display_name": "hedgar2017", "link": "https://stackoverflow.com/users/8170773/hedgar2017"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 582, "favorite_count": 0, "accepted_answer_id": 53361628, "answer_count": 1, "score": 3, "last_activity_date": 1542584332, "creation_date": 1542548233, "question_id": 53361472, "link": "https://stackoverflow.com/questions/53361472/how-do-i-read-until-the-tokionettcpstream-in-a-future-chain", "title": "How do I read_until the tokio::net::TcpStream in a future chain?", "body": "<p>I would like to read data from the <code>TcpStream</code> until I encounter a '\\0'.\nThe issue is that <code>tokio::io::read_until</code> needs the stream to be <code>BufRead</code>.</p>\n\n<pre><code>fn poll(&amp;mut self) -&gt; Poll&lt;(), Self::Error&gt; {\n    match self.listener.poll_accept()? {\n        Async::Ready((stream, _addr)) =&gt; {\n            let task = tokio::io::read_until(stream, 0, vec![0u8; buffer])\n                 .map_err(|_| ...)\n                 .map(|_| ...);\n            tokio::spawn(task);\n        }\n        Async::NotReady =&gt; return Ok(Async::NotReady),\n    }\n}\n</code></pre>\n\n<p>How can I read data from the <code>TcpStream</code> this way?</p>\n"}, {"tags": ["rust", "generic-type-argument"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542548392, "post_id": 53361363, "comment_id": 93599514, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/49341520/155423\">How to specify lifetime bounds for a closure involving references to intermediate local variables?</a> and <a href=\"https://stackoverflow.com/q/35592750/155423\">How does for&lt;&gt; syntax differ from a regular lifetime bound?</a>. If you disagree, please <a href=\"https://stackoverflow.com/posts/53361363/edit\">edit</a> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1542548474, "post_id": 53361363, "comment_id": 93599546, "body": "See also <a href=\"https://stackoverflow.com/q/43554679/155423\">Lifetime error when creating a function that returns a value implementing serde::Deserialize</a>"}, {"owner": {"reputation": 207, "user_id": 2519977, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e49452fdc198e591d73f5e373d860e23?s=128&d=identicon&r=PG", "display_name": "rudib", "link": "https://stackoverflow.com/users/2519977/rudib"}, "edited": false, "score": 0, "creation_date": 1542548702, "post_id": 53361363, "comment_id": 93599615, "body": "Thanks a lot, I&#39;ll see if it works."}, {"owner": {"reputation": 207, "user_id": 2519977, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e49452fdc198e591d73f5e373d860e23?s=128&d=identicon&r=PG", "display_name": "rudib", "link": "https://stackoverflow.com/users/2519977/rudib"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1542549224, "post_id": 53361363, "comment_id": 93599786, "body": "@Shepmaster Thank you, <code>serde::de::DeserializeOwned</code> seems to be the perfect solution. Didn&#39;t find even this after after looking for it for days!"}], "owner": {"reputation": 207, "user_id": 2519977, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e49452fdc198e591d73f5e373d860e23?s=128&d=identicon&r=PG", "display_name": "rudib", "link": "https://stackoverflow.com/users/2519977/rudib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 17, "favorite_count": 0, "closed_date": 1542549267, "answer_count": 0, "score": 0, "last_activity_date": 1542548785, "creation_date": 1542547517, "last_edit_date": 1542548785, "question_id": 53361363, "link": "https://stackoverflow.com/questions/53361363/type-arguments-with-block-level-lifetime", "closed_reason": "Duplicate", "title": "Type arguments with block-level lifetime", "body": "<p>I have a fuction I want to supply with generic type arguments. However, in this case they require a specific lifetime (because of <code>serde::de::Deserialize&lt;'de&gt;</code>).</p>\n\n<p>The type arguments are to be passed to a function, here called <code>run</code> within the function <code>myfunction</code>.\nThe argument <code>&amp;data</code> is only alive for the lifetime of the <code>Ok(data)</code> block, which is in conflict of the lifetime <code>'b</code> of the generic type argument of <code>myfunction</code>.</p>\n\n<p>If concrete types are supplied, this works right away, but as generic types are bound to the lifetime I'm not sure how to work around this.\nIs there a way to specify the lifetime of the <code>Ok(data)</code> block or another way to supply the type arguments? Otherwise I'd have to have a <code>myfunction</code> variant for every type combination I need, which is possible, but not optimal or elegant.</p>\n\n<p>I've put code with the functions that make this example run on the <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=e878ae78c897bf375b5d9b2af8311dc3\" rel=\"nofollow noreferrer\">rust playground</a>.</p>\n\n<pre><code>//the function in question\nfn myfunction&lt;'b, T1, T2&gt;(req: &amp;'b [u8]) -&gt; Result&lt;(), ()&gt;\nwhere\n    T2: TaskResult&lt;'b&gt;,\n    T1: TaskInfo&lt;'b, T2&gt;,\n{\n    match extract_body(req) {\n        Ok(data) =&gt; {\n            // if concrete types are supplied, it works.\n            //let t = run::&lt;Test1, Test2&gt;(&amp;data);\n            // as the generic types are bound to the lifetime 'b,\n            // which is longer than data would live\n            let t = run::&lt;T1, T2&gt;(&amp;data);\n            //do something with t\n            Ok(())\n        }\n        Err(_) =&gt; panic!(\"error\"),\n    }\n}\n\n//can't be changed, as it is an abbreviated function of a crate I'm using.\nfn extract_body(req: &amp;[u8]) -&gt; Result&lt;bytes::Bytes, ()&gt; {\n    Ok(bytes::Bytes::from(req))\n}\n</code></pre>\n\n<p>I hope there is a workaround for this.</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1542548036, "post_id": 53361052, "comment_id": 93599397, "body": "Restore the files you deleted. You <b>did</b> remember to back them up before following the advice of a random site on the internet that told you to delete them, right? If you don&#39;t have a backup, try deleting all of <code>~&#47;.cargo</code>."}, {"owner": {"reputation": 207, "user_id": 2519977, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e49452fdc198e591d73f5e373d860e23?s=128&d=identicon&r=PG", "display_name": "rudib", "link": "https://stackoverflow.com/users/2519977/rudib"}, "edited": false, "score": 0, "creation_date": 1542548147, "post_id": 53361052, "comment_id": 93599448, "body": "I&#39;m not an expert on cargo, but you could just try reinstalling it, if you don&#39;t mind removing <code>.cargo</code>."}, {"owner": {"reputation": 7882, "user_id": 2722968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d0a9ce812892f03b8342c5a60be24632?s=128&d=identicon&r=PG&f=1", "display_name": "user2722968", "link": "https://stackoverflow.com/users/2722968/user2722968"}, "edited": false, "score": 8, "creation_date": 1542549058, "post_id": 53361052, "comment_id": 93599733, "body": "You can set <code>RUST_LOG</code> to <code>cargo=debug</code>: <code>RUST_LOG=cargo=debug cargo update</code>. More specific to your problem would be <code>RUST_LOG=cargo::sources=debug cargo update</code>."}, {"owner": {"reputation": 2278, "user_id": 32700, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1caa9df4218cf8fe00a96549358ebc51?s=128&d=identicon&r=PG&f=1", "display_name": "qxotk", "link": "https://stackoverflow.com/users/32700/qxotk"}, "edited": false, "score": 0, "creation_date": 1556415558, "post_id": 53361052, "comment_id": 98430461, "body": "I had a different error, and moving my ~/.cargo/registry to a backup at ~/.cargo/registry.backup worked.  Next I did <code>Cargo build --release</code> and my project updated my crates.io index."}, {"owner": {"reputation": 2341, "user_id": 2225444, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1d5a3f96e4d79bac13f2349c70f75aa0?s=128&d=identicon&r=PG", "display_name": "Turtles Are Cute", "link": "https://stackoverflow.com/users/2225444/turtles-are-cute"}, "edited": false, "score": 2, "creation_date": 1565448876, "post_id": 53361052, "comment_id": 101362400, "body": "I&#39;m having this issue with a clean install, on Windows, on a slow internet connection. Takes ~12 hours. I wonder if this is related to Windows&#39; anti-virus that causes building rust docs to take a while, or the way crates is fetching files. It makes progress, but very very slowly. (incommensurate with the connection speed for other things)"}, {"owner": {"reputation": 207, "user_id": 8865811, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BGfwF.jpg?s=128&g=1", "display_name": "Prajwal Dhatwalia", "link": "https://stackoverflow.com/users/8865811/prajwal-dhatwalia"}, "reply_to_user": {"reputation": 2278, "user_id": 32700, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1caa9df4218cf8fe00a96549358ebc51?s=128&d=identicon&r=PG&f=1", "display_name": "qxotk", "link": "https://stackoverflow.com/users/32700/qxotk"}, "edited": false, "score": 1, "creation_date": 1566453439, "post_id": 53361052, "comment_id": 101662064, "body": "@qxotk. That didn&#39;t work for me. Thanks for sharing your results anyways."}, {"owner": {"reputation": 207, "user_id": 8865811, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BGfwF.jpg?s=128&g=1", "display_name": "Prajwal Dhatwalia", "link": "https://stackoverflow.com/users/8865811/prajwal-dhatwalia"}, "reply_to_user": {"reputation": 207, "user_id": 2519977, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e49452fdc198e591d73f5e373d860e23?s=128&d=identicon&r=PG", "display_name": "rudib", "link": "https://stackoverflow.com/users/2519977/rudib"}, "edited": false, "score": 0, "creation_date": 1566453711, "post_id": 53361052, "comment_id": 101662165, "body": "@rudib That did not work. I uninstalled rust with <code>rustup self uninstall</code> and deleted the C:\\Users\\my_username\\.cargo folder and then installed rust again with rust-init.exe"}, {"owner": {"reputation": 207, "user_id": 8865811, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BGfwF.jpg?s=128&g=1", "display_name": "Prajwal Dhatwalia", "link": "https://stackoverflow.com/users/8865811/prajwal-dhatwalia"}, "edited": false, "score": 2, "creation_date": 1566454667, "post_id": 53361052, "comment_id": 101662507, "body": "@Fei Did you find any solution? In my case, it was because github.com was blocked on my system."}, {"owner": {"reputation": 121, "user_id": 6436674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a66a78865ce2ba8220af9085f0d0ada?s=128&d=identicon&r=PG&f=1", "display_name": "RajkumarG", "link": "https://stackoverflow.com/users/6436674/rajkumarg"}, "edited": false, "score": 1, "creation_date": 1586622838, "post_id": 53361052, "comment_id": 108197029, "body": "I encountered same problem I deleted .package-cache in .cargo/ . It worked for me you can try It. Take backup first"}, {"owner": {"reputation": 1168, "user_id": 222167, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/3f43f2219b24130cce31e06577d6cc8c?s=128&d=identicon&r=PG", "display_name": "Fei", "link": "https://stackoverflow.com/users/222167/fei"}, "reply_to_user": {"reputation": 207, "user_id": 8865811, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BGfwF.jpg?s=128&g=1", "display_name": "Prajwal Dhatwalia", "link": "https://stackoverflow.com/users/8865811/prajwal-dhatwalia"}, "edited": false, "score": 0, "creation_date": 1591711042, "post_id": 53361052, "comment_id": 110155078, "body": "@PrajwalDhatwalia I believe it should be bug of the toolset - upgrading to newer version of rust fixed that."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 15573017, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3jmYa.jpg?s=128&g=1", "display_name": "Tianyi Liu", "link": "https://stackoverflow.com/users/15573017/tianyi-liu"}, "is_accepted": false, "score": 0, "last_activity_date": 1617791170, "creation_date": 1617791170, "answer_id": 66984155, "question_id": 53361052, "link": "https://stackoverflow.com/questions/53361052/how-do-i-debug-cargo-build-hanging-at-updating-crates-io-index/66984155#66984155", "title": "How do I debug `cargo build` hanging at &quot;Updating crates.io index&quot;?", "body": "<p>Change cargo source in ~/.cargo/config. This works for me.</p>\n<p>For example:</p>\n<pre><code>[source.crates-io]\nregistry = &quot;https://github.com/rust-lang/crates.io-index&quot;\nreplace-with = 'ustc'\n\n[source.ustc]\nregistry = &quot;git://mirrors.ustc.edu.cn/crates.io-index&quot;\n</code></pre>\n"}], "owner": {"reputation": 1168, "user_id": 222167, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/3f43f2219b24130cce31e06577d6cc8c?s=128&d=identicon&r=PG", "display_name": "Fei", "link": "https://stackoverflow.com/users/222167/fei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2756, "favorite_count": 1, "answer_count": 1, "score": 8, "last_activity_date": 1617791170, "creation_date": 1542545390, "last_edit_date": 1542649245, "question_id": 53361052, "link": "https://stackoverflow.com/questions/53361052/how-do-i-debug-cargo-build-hanging-at-updating-crates-io-index", "title": "How do I debug `cargo build` hanging at &quot;Updating crates.io index&quot;?", "body": "<p>My Rust project no longer builds after some conflicts between my RLS plugin and terminal build. I searched around the web and found suggestion of removing my <code>~/.cargo/registry/index/*</code>, but after that I can't even build any project.</p>\n\n<p>Now the build always stops at</p>\n\n<blockquote>\n  <p>Updating crates.io index</p>\n</blockquote>\n\n<p>Passing in the <code>--verbose</code> option doesn't help so I don't even know whether it's dying. What should I do next? How to debug this issue?</p>\n"}, {"tags": ["syntax", "rust", "rust-tokio"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1542537842, "post_id": 53359939, "comment_id": 93596756, "body": "The main problem is in the compiler&#39;s error message: <i>&quot;constructor is not visible here due to private fields&quot;</i> You may wish to review the entirey of <a href=\"https://doc.rust-lang.org/stable/book/second-edition/ch07-00-modules.html\" rel=\"nofollow noreferrer\">chapter 7 from the book</a>, which is dedicated to modules and visibility among them."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1542539224, "post_id": 53359939, "comment_id": 93597091, "body": "The easiest fix, as explained in the duplicate, is to change the definition of <code>Display</code> to <code>pub struct Display&lt;T&gt;(pub T);</code>. <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=c04e3995839801130392471bddde5a92\" rel=\"nofollow noreferrer\">(Playground)</a>"}], "owner": {"reputation": 9, "user_id": 10669959, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-fMnRjf8xc4I/AAAAAAAAAAI/AAAAAAAAAhg/g1kYdGlcw6Q/photo.jpg?sz=128", "display_name": "a3r", "link": "https://stackoverflow.com/users/10669959/a3r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "closed_date": 1542547928, "answer_count": 0, "score": 0, "last_activity_date": 1542544200, "creation_date": 1542537499, "last_edit_date": 1542544200, "question_id": 53359939, "link": "https://stackoverflow.com/questions/53359939/rust-split-src-to-multiple-files", "closed_reason": "Duplicate", "title": "rust, split src to multiple files", "body": "<p>I got this code: (from samples of rust-tokio)\nsrc/main.rs::</p>\n\n<pre><code>extern crate futures;\nextern crate tokio;\nmod hw;\n\nuse hw::{Display, HelloWorld};\n\nfn main() {\n    let future = Display(HelloWorld);\n    tokio::run(future);\n}\n</code></pre>\n\n<p>and src/hw.rs::</p>\n\n<pre><code>extern crate futures;\nextern crate tokio;\n\npub use futures::{Async, Future, Poll, try_ready};\npub use std::fmt;\n\npub struct HelloWorld;\nimpl Future for HelloWorld {\n    type Item = String;\n    type Error = ();\n\n    fn poll(&amp;mut self) -&gt; Poll&lt;Self::Item, Self::Error&gt; {\n        Ok(Async::Ready(\"helloworld\".to_string()))\n    }\n}\n\npub struct Display&lt;T&gt;(T);\nimpl&lt;T&gt; Future for Display&lt;T&gt;\nwhere\n    T: Future,\n    T::Item: fmt::Display,\n{\n    type Item = ();\n    type Error = T::Error;\n\n    fn poll(&amp;mut self) -&gt; Poll&lt;(), T::Error&gt; {\n        let value = try_ready!(self.0.poll());\n        println!(\"{}\", value);\n        Ok(Async::Ready(()))\n    }\n}\n</code></pre>\n\n<p>, which got error:</p>\n\n<pre><code>error[E0423]: expected function, found struct `Display`\n--&gt; src/main.rs:12:18                                                                                                                                                                            \n   |                                                                                                                                                                                               \n12 |     let future = Display(HelloWorld);                                                                                                                                                         \n   |                  ^^^^^^^ constructor is not visible here due to private   fields                                                                                                                \n</code></pre>\n\n<p>But if i split these files and remove any \"mod\" and \"use\", everything is fine.\nSo, what the \"right\" error: \"function vs struct\" or \"constructor is not visible\"? \nPlease help</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 4, "creation_date": 1542531260, "post_id": 53358687, "comment_id": 93595359, "body": "Due to borrowing rules, linked lists are actually surprisingly hard to do in rust. In fact, there is a rather comprehensive <a href=\"https://cglab.ca/~abeinges/blah/too-many-lists/book/\" rel=\"nofollow noreferrer\">introduction to rust</a> built solely on them. You might find it interesting."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542547823, "post_id": 53358687, "comment_id": 93599332, "body": "TL;DR the duplicate: <code>let next = &amp;mut {tail}.as_mut().unwrap().next;</code>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1542552624, "post_id": 53358687, "comment_id": 93600868, "body": "How <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=aeae36d2af68b325454e368a358a3c53\" rel=\"nofollow noreferrer\">I&#39;d write the entire function</a>"}], "owner": {"reputation": 14015, "user_id": 1441328, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/b96e85a38e05615837daedb7296a9f49?s=128&d=identicon&r=PG", "display_name": "ridiculous_fish", "link": "https://stackoverflow.com/users/1441328/ridiculous-fish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "closed_date": 1542547805, "answer_count": 0, "score": 0, "last_activity_date": 1542525314, "creation_date": 1542525314, "question_id": 53358687, "link": "https://stackoverflow.com/questions/53358687/iteratively-building-a-singly-linked-list-in-rust", "closed_reason": "Duplicate", "title": "Iteratively building a singly linked list in Rust", "body": "<p>(Rust noob here) I would like to create a singly linked list in Rust, by holding a reference to the tail and writing into it. Here is the algorithm in C++:</p>\n\n<pre><code>#include &lt;memory&gt;\n#include &lt;string&gt;\n\nstruct CharList {\n    char c;\n    std::unique_ptr&lt;CharList&gt; next;\n    explicit CharList(char c) : c(c) {}\n};\n\nCharList make_list(const std::string &amp;s) {\n    CharList res{'a'};\n    auto *tail = &amp;res.next;\n    for (char c : s) {\n        *tail = std::make_unique&lt;CharList&gt;(c);\n        tail = &amp;(*tail)-&gt;next;\n    }\n    return res;\n}\n</code></pre>\n\n<p>This is my attempt in Rust (<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=3a2b7ede994ef80eedf8d63a753dd193\" rel=\"nofollow noreferrer\">Rust playground link</a>)</p>\n\n<pre><code>struct CharList {\n    c: char,\n    next: Option&lt;Box&lt;CharList&gt;&gt;,\n}\n\nfn make(s:&amp;str) -&gt; CharList {\n    let mut result = CharList{\n        c: 'a',\n        next: None\n    };\n    {\n        let mut tail = &amp;mut result.next;\n        for c in s.chars() {\n            let cl = CharList {\n                c: c,\n                next: None\n            };\n            mem::replace(tail, Some(Box::new(cl)))\n            let mut next = &amp;mut tail.as_mut().unwrap().next;\n            tail = next\n        }\n    }\n    result\n}\n</code></pre>\n\n<p>The resulting error is:</p>\n\n<pre><code>error[E0499]: cannot borrow `*tail` as mutable more than once at a time\n  --&gt; src/main.rs:21:26\n   |\n21 |             mem::replace(tail, Some(Box::new(cl)));\n   |                          ^^^^ second mutable borrow occurs here\n22 |             let next = &amp;mut tail.as_mut().unwrap().next;\n   |                             ---- first mutable borrow occurs here\n...\n25 |     }\n   |     - first borrow ends here\n</code></pre>\n\n<p>I find it confusing that the first borrow is reported to occur <em>after</em> the second borrow, but I suppose that is because they occur in different iterations of the loop.</p>\n\n<p>What is the right way to implement this algorithm in Rust?</p>\n"}, {"tags": ["rust", "future", "rust-tokio"], "answers": [{"tags": [], "owner": {"reputation": 511, "user_id": 1927976, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/59a9cb96b87e3e41394f4104f509c163?s=128&d=identicon&r=PG", "display_name": "Josh Leeb-du Toit", "link": "https://stackoverflow.com/users/1927976/josh-leeb-du-toit"}, "is_accepted": false, "score": 0, "last_activity_date": 1542621781, "last_edit_date": 1542621781, "creation_date": 1542534496, "answer_id": 53359586, "question_id": 53358256, "link": "https://stackoverflow.com/questions/53358256/rust-concurrent-execution-with-futures-and-tokio/53359586#53359586", "title": "Rust Concurrent Execution with Futures and Tokio", "body": "<p>Found a solution with the use of the <a href=\"https://docs.rs/futures-timer/0.1.1/futures_timer\" rel=\"nofollow noreferrer\"><code>futures-timer</code></a> crate. </p>\n\n<pre><code>use chrono::Local;\nuse futures::{future, sync::mpsc, Future, Sink, Stream};\nuse futures_timer::Delay;\nuse std::{io::stdin, thread, time::Duration};\n\nfn read_stdin(mut tx: mpsc::Sender&lt;String&gt;) {\n    let stdin = stdin();\n    loop {\n        let mut buf = String::new();\n        stdin.read_line(&amp;mut buf).unwrap();\n        tx = tx.send(buf).wait().unwrap()\n    }\n}\n\nfn main() {\n    let (stdin_tx, stdin_rx) = mpsc::channel(0);\n    thread::spawn(move || read_stdin(stdin_tx));\n\n    let server = stdin_rx\n        .map(|data| data.trim().parse::&lt;u64&gt;().unwrap_or(0) * 100)\n        .for_each(|delay| {\n            println!(\"[{}] {} ms -&gt; start\", Local::now().format(\"%T%.3f\"), delay);\n            tokio::spawn({\n                Delay::new(Duration::from_millis(delay))\n                    .and_then(move |_| {\n                        println!(\"[{}] {} ms -&gt; done\", Local::now().format(\"%T%.3f\"), delay);\n                        future::ok(())\n                    })\n                    .map_err(|e| panic!(e))\n            })\n        });\n\n    tokio::run(server);\n}\n</code></pre>\n\n<p>The issue is that the rather letting the future to become parked and then notifying the current task, the code presented in the question was just sleeping the thread and so no progress could be made. </p>\n\n<p>Update: Now I've just come across <code>tokio-timer</code> which seems like the standard way of doing this.</p>\n"}], "owner": {"reputation": 511, "user_id": 1927976, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/59a9cb96b87e3e41394f4104f509c163?s=128&d=identicon&r=PG", "display_name": "Josh Leeb-du Toit", "link": "https://stackoverflow.com/users/1927976/josh-leeb-du-toit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 579, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1542621781, "creation_date": 1542520037, "last_edit_date": 1542520366, "question_id": 53358256, "link": "https://stackoverflow.com/questions/53358256/rust-concurrent-execution-with-futures-and-tokio", "title": "Rust Concurrent Execution with Futures and Tokio", "body": "<p>I've got some Rust code that currently looks like this</p>\n\n<pre><code>fn read_stdin(mut tx: mpsc::Sender&lt;String&gt;) {\n    loop {\n        // read from stdin and send value over tx.\n    }\n}\n\nfn sleep_for(n: u64) -&gt; impl Future&lt;Item = (), Error = ()&gt; {\n    thread::sleep(time::Duration::from_millis(n));\n    println!(\"[{}] slept for {} ms\", Local::now().format(\"%T%.3f\"), n);\n    future::ok(())\n}\n\nfn main() {\n    let (stdin_tx, stdin_rx) = mpsc::channel(0);\n    thread::spawn(move || read_stdin(stdin_tx));\n\n    let server = stdin_rx\n        .map(|data| data.trim().parse::&lt;u64&gt;().unwrap_or(0))\n        .for_each(|n| tokio::spawn(sleep_for(n * 100)));\n    tokio::run(server);\n}\n</code></pre>\n\n<p>It uses tokio and futures, with the aim of running some \"cpu heavy\" work (emulated by the <code>sleep_for</code> function) and then outputting some stuff to <code>stdout</code>.</p>\n\n<p>When I run it, things seems to work fine and I get this output</p>\n\n<pre><code>2\n[00:00:00.800] slept for 200 ms\n10\n1\n[00:00:01.800] slept for 1000 ms\n[00:00:01.900] slept for 100 ms\n</code></pre>\n\n<p>The first output with the value <code>2</code> is exactly as expected, and I see the timestamp printed after 200ms. But for the next inputs, it becomes clear that the <code>sleep_for</code> function is being executed sequentially, and not concurrently.</p>\n\n<p>The output that I want to see is</p>\n\n<pre><code>2\n[00:00:00.800] slept for 200 ms\n10\n1\n[00:00:00.900] slept for 100 ms\n[00:00:01.900] slept for 1000 ms\n</code></pre>\n\n<p>It seems that to get the output I'm looking for I want to execute <code>sleep_for(10)</code> and <code>sleep_for(1)</code> concurrently. How would I go about doing this in Rust with futures and tokio?</p>\n\n<p>(Note: the actual values of the timestamps aren't important I'm using them more to show the ordering of execution within the program)</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 2, "creation_date": 1542497348, "post_id": 53356359, "comment_id": 93590691, "body": "Why do you not want to return a <code>String</code>?"}, {"owner": {"reputation": 1540, "user_id": 2606171, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F4ncy.png?s=128&g=1", "display_name": "belst", "link": "https://stackoverflow.com/users/2606171/belst"}, "edited": false, "score": 1, "creation_date": 1542497398, "post_id": 53356359, "comment_id": 93590704, "body": "<code>std::env::var(key)</code> creates <code>String</code> so that <code>String</code> gets deallocated when you leave the function unless you return it. you cannot return a reference to it."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1542499197, "post_id": 53356359, "comment_id": 93591063, "body": "tl;dr: you can turn it into a <code>Box&lt;str&gt;</code>, <code>Vec&lt;u8&gt;</code>, etc. but those are all somewhat silly responses. Returning a <code>String</code> is the most reasonable thing to do, unless you are doing something <i>very</i> unusual."}, {"owner": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "edited": false, "score": 0, "creation_date": 1542741979, "post_id": 53356359, "comment_id": 93675397, "body": "Thanks, trentcl and belst.  Rust is new to me, but it&#39;s starting to make more and more sense.  Your comments helped."}], "owner": {"reputation": 4233, "user_id": 199335, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/f13795a3e9cd2678006fe6e029ba566b?s=128&d=identicon&r=PG", "display_name": "Gattster", "link": "https://stackoverflow.com/users/199335/gattster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 193, "favorite_count": 0, "closed_date": 1542498181, "answer_count": 0, "score": 0, "last_activity_date": 1542501588, "creation_date": 1542495587, "question_id": 53356359, "link": "https://stackoverflow.com/questions/53356359/rust-lifetimes-returning-a-pointer", "closed_reason": "Duplicate", "title": "Rust Lifetimes: Returning a pointer", "body": "<p>When I write a function like this,</p>\n\n<pre><code>fn must_get_env&lt;'a&gt;(key: &amp;'a str) -&gt; &amp;'a str {\n    match std::env::var(key) {\n        Ok(val) =&gt; {\n            return &amp;val;\n        }\n        Err(_) =&gt; panic!(\"Missing required environment variable: {}\", key),\n    }\n}\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>error[E0597]: `val` does not live long enough\n  --&gt; src/main.rs:19:21\n   |\n19 |             return &amp;val;\n   |                     ^^^ borrowed value does not live long enough\n...\n22 |     }\n   |     - borrowed value only lives until here\n</code></pre>\n\n<p>I thought I had a good understanding of lifetimes in rust, but apparently not. What options do I have besides returning a <code>String</code>?</p>\n"}, {"tags": ["asynchronous", "tcp", "rust", "future", "rust-tokio"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542500103, "post_id": 53355914, "comment_id": 93591217, "body": "Please review how to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> and then <a href=\"https://stackoverflow.com/posts/53355914/edit\">edit</a> your question to include it. We cannot tell what crates, types, traits, fields, etc. are present in the code. Try to produce something that reproduces your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> or you can reproduce it in a brand new Cargo project. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MCVE tips</a> as well."}], "answers": [{"comments": [{"owner": {"reputation": 886, "user_id": 8170773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61b971ec934427a008d8b263ad4142b9?s=128&d=identicon&r=PG&f=1", "display_name": "hedgar2017", "link": "https://stackoverflow.com/users/8170773/hedgar2017"}, "edited": false, "score": 0, "creation_date": 1542541069, "post_id": 53356848, "comment_id": 93597561, "body": "Thank you. I have already found the <code>then</code> combinator and it works perfectly for me!"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1542501055, "creation_date": 1542501055, "answer_id": 53356848, "question_id": 53355914, "link": "https://stackoverflow.com/questions/53355914/how-to-use-a-tcpstream-in-multiple-branches-of-a-tokio-future-chain/53356848#53356848", "title": "How to use a TcpStream in multiple branches of a Tokio future chain?", "body": "<p>The documentation for <a href=\"https://docs.rs/tokio/0.1.12/tokio/io/fn.write_all.html\" rel=\"nofollow noreferrer\"><code>io::write_all</code></a> states:</p>\n\n<blockquote>\n  <p>Any error which happens during writing will cause both the stream and the buffer to get destroyed.</p>\n</blockquote>\n\n<p>Since your code appears to be attempting to send a network message to indicate that the previous network message failed (which seems... dubious), the <code>TcpStream</code> is already gone by the time you try to send the second message.</p>\n\n<p>The easiest solution is thus to clone the stream:</p>\n\n<pre><code>let stream2 = stream.try_clone().expect(\"Couldn't clone\");\n\nlet task = database_connection\n    .and_then(|_| io::write_all(stream, b\"success\"))\n    .map_err(|_| io::write_all(stream2, b\"error\"));\n</code></pre>\n\n<p>If you only wanted to try to report the failure of the database connection, it's much easier: use <a href=\"https://docs.rs/futures/0.1.25/futures/future/trait.Future.html#method.then\" rel=\"nofollow noreferrer\"><code>Future::then</code></a> instead of <code>and_then</code>:</p>\n\n<pre><code>let task = database_connection.then(|connection| match connection {\n    Ok(_) =&gt; io::write_all(stream, &amp;b\"success\"[..]),\n    Err(_) =&gt; io::write_all(stream2, &amp;b\"error\"[..]),\n});\n</code></pre>\n"}], "owner": {"reputation": 886, "user_id": 8170773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61b971ec934427a008d8b263ad4142b9?s=128&d=identicon&r=PG&f=1", "display_name": "hedgar2017", "link": "https://stackoverflow.com/users/8170773/hedgar2017"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 0, "accepted_answer_id": 53356848, "answer_count": 1, "score": 1, "last_activity_date": 1542501055, "creation_date": 1542491723, "question_id": 53355914, "link": "https://stackoverflow.com/questions/53355914/how-to-use-a-tcpstream-in-multiple-branches-of-a-tokio-future-chain", "title": "How to use a TcpStream in multiple branches of a Tokio future chain?", "body": "<p>I have a Rust Tokio TCP server. Each client is handled by the Tokio future chain that looks like this:</p>\n\n<pre><code>let stream = &lt;TcpStream from elsewhere&gt;;\n\nlet task = database_connection\n        .and_then(connection| {\n            tokio::io::write_all(stream, SomeSuccessData);\n        }).map_err(|error| {\n            tokio::io::write_all(stream, SomeErrorData(error));\n        });\n\n...\n\ntokio::spawn(task);\n</code></pre>\n\n<p>The issue is I cannot use the same <code>TcpStream</code> in multiple branches of the chain, because <code>tokio::io::write_all</code> consumes the stream, even though it is supposed to be used in sequential manner. It is crucial to send different data depending on if there was, e.g., a database error.</p>\n\n<p>How can I overcome this problem? Maybe there is a different API?</p>\n"}, {"tags": ["multithreading", "rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542491336, "post_id": 53355801, "comment_id": 93589284, "body": "Performing a Google search for &quot;rwlock condvar&quot; points to <a href=\"https://tutorialedge.net/rust/using-rwlocks-and-condvars-rust/\" rel=\"nofollow noreferrer\">Using RwLock and CondVars in Rust</a> as the very first solution. It does not seem like you have put a lot of effort into answering your own question."}, {"owner": {"reputation": 555, "user_id": 4637817, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/849a2d4951995c9fcb2b9aec36faaf2c?s=128&d=identicon&r=PG&f=1", "display_name": "Remagpie", "link": "https://stackoverflow.com/users/4637817/remagpie"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1542491562, "post_id": 53355801, "comment_id": 93589336, "body": "@Shepmaster I read that article before writing this question, but I think it only explains how to use RwLock and Condvar separately. My question is about how to use them &quot;together&quot;."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542491867, "post_id": 53355801, "comment_id": 93589407, "body": "Hmm. An unfortunate title for that article, then."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1564449407, "post_id": 57260533, "comment_id": 101025294, "body": "This does not appear to be an answer to the question. Absent any other information, the OP is most likely asking about the standard library. parking_lot is not the standard library."}], "tags": [], "owner": {"reputation": 1606, "user_id": 559833, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0cf07c8cc2ec5892dd92722bf28e07e1?s=128&d=identicon&r=PG", "display_name": "Gyscos", "link": "https://stackoverflow.com/users/559833/gyscos"}, "is_accepted": false, "score": 0, "last_activity_date": 1564429737, "creation_date": 1564429737, "answer_id": 57260533, "question_id": 53355801, "link": "https://stackoverflow.com/questions/53355801/how-can-i-use-a-condvar-with-a-rwlock/57260533#57260533", "title": "How can I use a Condvar with a RwLock?", "body": "<p>See <a href=\"https://github.com/Amanieu/parking_lot/issues/165\" rel=\"nofollow noreferrer\">https://github.com/Amanieu/parking_lot/issues/165</a> for an example of using a <code>CondVar</code> with a <code>RwLockGuard</code>.</p>\n"}], "owner": {"reputation": 555, "user_id": 4637817, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/849a2d4951995c9fcb2b9aec36faaf2c?s=128&d=identicon&r=PG&f=1", "display_name": "Remagpie", "link": "https://stackoverflow.com/users/4637817/remagpie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 212, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1564429737, "creation_date": 1542490690, "last_edit_date": 1542491138, "question_id": 53355801, "link": "https://stackoverflow.com/questions/53355801/how-can-i-use-a-condvar-with-a-rwlock", "title": "How can I use a Condvar with a RwLock?", "body": "<p>I have several threads waiting on the same <code>Condvar</code> associated with data wrapped inside a <code>RwLock</code>. I'd like to call <code>Condvar::wait</code> and check a condition after holding the write lock to the data, but it seems <code>Condvar::wait</code> only accepts <code>MutexGuard</code> as an argument. Since there are many other parts that use this data as a read-only variable, I can't simply replace <code>RwLock</code> with <code>Mutex</code>.</p>\n\n<p>How should I use <code>Condvar</code> together with <code>RwLock</code>-wrapped data?</p>\n"}, {"tags": ["compiler-errors", "rust", "compiler-warnings", "rust-cargo"], "answers": [{"comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1542549335, "post_id": 53361496, "comment_id": 93599814, "body": "You may use <code>cargo check -- -Awarnings</code>? I haven&#39;t tried, but it can save you some time."}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1542549433, "post_id": 53361496, "comment_id": 93599851, "body": "@hellow: I tried, but unfortunately <code>cargo check</code> is not able to use <code>rustc</code> flags... at least I don&#39;t know how. You can use it with the <code>RUSTFLAGS</code> trick, though."}], "tags": [], "owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "is_accepted": false, "score": 2, "last_activity_date": 1542549237, "last_edit_date": 1542549237, "creation_date": 1542548350, "answer_id": 53361496, "question_id": 53355265, "link": "https://stackoverflow.com/questions/53355265/how-can-i-only-show-warnings-if-there-are-no-errors/53361496#53361496", "title": "How can I only show warnings if there are no errors?", "body": "<p>You can suppress warnings in your compilation using the <code>-Awarnings</code> flags. If you use Cargo, you can add it with:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cargo rustc -- -Awarnings\n</code></pre>\n\n<p>That will compile your crate with warnings disabled, so only errors will show up. When you get a successful compilation, you can switch back to:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cargo build\n</code></pre>\n\n<p>And your crate will compile again (because the flags have changed, the target is no longer up to date) and you will get the detailed warnings.</p>\n\n<p>You can try automating them by running:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cargo rustc -- -Awarnings &amp;&amp; cargo build\n</code></pre>\n\n<p>This has the drawback of compiling the crate twice if there are no errors and that can take some extra time.</p>\n\n<p>If you want to compile all the dependencies without the warnings, you can run instead:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>RUSTFLAGS=-Awarnings cargo build\n</code></pre>\n\n<p>But then, the double compilation issue is quite more relevant.</p>\n\n<hr>\n\n<p>As as side note, I think that some IDEs (VSCode?) are able to do that: sort the compiler messages and filter out the ones you are not interested in. </p>\n"}], "owner": {"reputation": 15065, "user_id": 723090, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ML1tj.png?s=128&g=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/723090/mark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1260, "favorite_count": 0, "answer_count": 1, "score": 8, "last_activity_date": 1542549237, "creation_date": 1542486470, "last_edit_date": 1542487877, "question_id": 53355265, "link": "https://stackoverflow.com/questions/53355265/how-can-i-only-show-warnings-if-there-are-no-errors", "title": "How can I only show warnings if there are no errors?", "body": "<p>Often during development, I have a bunch of unused imports and variables. I like to fix those <em>after</em> I have correctly working code. The warnings these generate cause me to scroll though the <code>cargo build</code> output to find errors among all the warnings.</p>\n\n<p>Is that possible to only show the warnings if compilation succeeds?</p>\n\n<p>I don't want to <em>ignore</em> the warnings entirely, since I do want to solve them before committing the code.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 2512, "user_id": 5808553, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6be8254e63e22cc820bb14938d532814?s=128&d=identicon&r=PG&f=1", "display_name": "Rajeev Ranjan", "link": "https://stackoverflow.com/users/5808553/rajeev-ranjan"}, "edited": false, "score": 2, "creation_date": 1542484136, "post_id": 53354917, "comment_id": 93587397, "body": "What are you trying to achieve? Your expectations?"}], "answers": [{"tags": [], "owner": {"reputation": 859, "user_id": 5048815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d934ae597d38fbcc5a8bcf113d12a9d?s=128&d=identicon&r=PG", "display_name": "wiomoc", "link": "https://stackoverflow.com/users/5048815/wiomoc"}, "is_accepted": false, "score": 1, "last_activity_date": 1542486088, "creation_date": 1542486088, "answer_id": 53355220, "question_id": 53354917, "link": "https://stackoverflow.com/questions/53354917/reference-before-assignment-in-rust/53355220#53355220", "title": "Reference before assignment in Rust", "body": "<p>You dont need that <code>&amp;</code>at <code>let x</code></p>\n\n<pre><code>let str = String::from(\"Hallo\");\nlet x = &amp;str;\n</code></pre>\n\n<p>Or if you want to declare the type manually</p>\n\n<pre><code>let string = String::from(\"Hallo\");\nlet x: &amp;str = &amp;string;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 46, "user_id": 10202797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7182c5553d19ced44320df92a4b74342?s=128&d=identicon&r=PG&f=1", "display_name": "dario", "link": "https://stackoverflow.com/users/10202797/dario"}, "is_accepted": true, "score": 3, "last_activity_date": 1542488313, "last_edit_date": 1542488313, "creation_date": 1542487795, "answer_id": 53355453, "question_id": 53354917, "link": "https://stackoverflow.com/questions/53354917/reference-before-assignment-in-rust/53355453#53355453", "title": "Reference before assignment in Rust", "body": "<p>Adding to <a href=\"https://stackoverflow.com/a/53355220/155423\">wiomoc's answer</a>: depending on what language(s) you've previously known, variable declaration in Rust might be a little different. Whereas in C/C++ you explicitly have to declare that you want a pointer/reference variable:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>int *p = &amp;other_int;\n</code></pre>\n\n<p>In Rust it's enough to just use <code>let</code>, so the above would in Rust be</p>\n\n<pre><code>let p = &amp;other_int;\n</code></pre>\n\n<p>and when you write</p>\n\n<pre><code>let &amp;s = &amp;string;\n</code></pre>\n\n<p>It pattern-matches that, so the Rust compiler reads it roughly as \"I know I have a reference, and I want to bind whatever it is referring to to the name <code>p</code>\". If you're not familiar with pattern-matching, a more obvious example (that works in Rust as well) would be</p>\n\n<pre><code>let point = (23, 42);\nlet (x, y) = point;\n</code></pre>\n\n<p>The second line unpacks the right-hand side to match the left-hand side (both are tuples of two values) and binds the variable names on the left to the values at the same position in the structure on the right. In the case above, it's less obvious that it's matching your \"structural description\".</p>\n\n<p>The result of <code>let &amp;x = &amp;str;</code>, i.e. \"I know <code>&amp;str</code> is a reference, please bind whatever it refers to to the variable <code>x</code>\" means that you're trying to have <code>x</code> be the same as <code>str</code>, when at that line all you have is a borrowed reference to <code>str</code>. That's why the compiler tells you you can't create an owned value (which <code>x</code> would be, because it's not being created as a reference) from a reference.</p>\n"}], "owner": {"reputation": 269, "user_id": 7272130, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4f731e81d96903d3a06439adf360512d?s=128&d=identicon&r=PG&f=1", "display_name": "Felix Ha", "link": "https://stackoverflow.com/users/7272130/felix-ha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 53355453, "answer_count": 2, "score": -1, "last_activity_date": 1542488313, "creation_date": 1542483913, "last_edit_date": 1542487765, "question_id": 53354917, "link": "https://stackoverflow.com/questions/53354917/reference-before-assignment-in-rust", "title": "Reference before assignment in Rust", "body": "<p>I am playing around with Rust references:</p>\n\n<pre><code>fn main() {\n    let str = String::from(\"Hallo\");\n    let &amp;x = &amp;str;\n}\n</code></pre>\n\n<p>This produces the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0507]: cannot move out of borrowed content\n --&gt; src/main.rs:3:9\n  |\n3 |     let &amp;x = &amp;str;\n  |         ^-\n  |         ||\n  |         |hint: to prevent move, use `ref x` or `ref mut x`\n  |         cannot move out of borrowed content\n</code></pre>\n\n<p>What is going on here? </p>\n"}, {"tags": ["rust", "hex"], "answers": [{"comments": [{"owner": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "edited": false, "score": 0, "creation_date": 1542477907, "post_id": 53353952, "comment_id": 93585603, "body": "Thanks, under current circumstance <code>u128</code> is big enough for me. But, does convert it to bigint a good choice?"}, {"owner": {"reputation": 1210, "user_id": 1091731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa416baaefe3b4dca1defb1d2b3f5c05?s=128&d=identicon&r=PG", "display_name": "Illya Kysil", "link": "https://stackoverflow.com/users/1091731/illya-kysil"}, "reply_to_user": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "edited": false, "score": 0, "creation_date": 1542478140, "post_id": 53353952, "comment_id": 93585668, "body": "It depends on the semantics of the inputs and outputs. What are those strings on input and output? Where are inputs coming from? How outputs are used?"}, {"owner": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "edited": false, "score": 0, "creation_date": 1542478354, "post_id": 53353952, "comment_id": 93585723, "body": "Input is always a <code>String</code>. Output for the <code>value</code> field of ethereum&#39;s transaction."}, {"owner": {"reputation": 1210, "user_id": 1091731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa416baaefe3b4dca1defb1d2b3f5c05?s=128&d=identicon&r=PG", "display_name": "Illya Kysil", "link": "https://stackoverflow.com/users/1091731/illya-kysil"}, "reply_to_user": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "edited": false, "score": 0, "creation_date": 1542479289, "post_id": 53353952, "comment_id": 93585985, "body": "Oh, great! I missed share feature at Rust playground somehow. Link updated."}, {"owner": {"reputation": 1210, "user_id": 1091731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa416baaefe3b4dca1defb1d2b3f5c05?s=128&d=identicon&r=PG", "display_name": "Illya Kysil", "link": "https://stackoverflow.com/users/1091731/illya-kysil"}, "reply_to_user": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "edited": false, "score": 0, "creation_date": 1542479609, "post_id": 53353952, "comment_id": 93586069, "body": "You need to consult the valid range for the <code>value</code> field of ethereum&#39;s transaction.  Common sense may provide some hints if there are no technical limits. For example, I can hardly imagine a transaction value larger than 100K EUR/USD in common-case online payment systems. Also, regulations on online money transfers apply."}, {"owner": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "edited": false, "score": 0, "creation_date": 1542480304, "post_id": 53353952, "comment_id": 93586274, "body": "Thanks for your tips. I got the contracts from a App which don&#39;t cost too much. <code>u128</code> is good enough.  : )"}, {"owner": {"reputation": 361, "user_id": 12845381, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mARoMFM-kxwMrEHo4qVrjWjvNNPqlnm7SZzlLcBbw=k-s128", "display_name": "Tomek Czajka", "link": "https://stackoverflow.com/users/12845381/tomek-czajka"}, "edited": false, "score": 0, "creation_date": 1615663964, "post_id": 53353952, "comment_id": 117763520, "body": "Check out <a href=\"https://crates.io/crates/ibig\" rel=\"nofollow noreferrer\">crates.io/crates/ibig</a> and <a href=\"https://crates.io/crates/bigint-benchmark\" rel=\"nofollow noreferrer\">crates.io/crates/bigint-benchmark</a>"}], "tags": [], "owner": {"reputation": 1210, "user_id": 1091731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa416baaefe3b4dca1defb1d2b3f5c05?s=128&d=identicon&r=PG", "display_name": "Illya Kysil", "link": "https://stackoverflow.com/users/1091731/illya-kysil"}, "is_accepted": true, "score": 3, "last_activity_date": 1542487653, "last_edit_date": 1542487653, "creation_date": 1542477310, "answer_id": 53353952, "question_id": 53353764, "link": "https://stackoverflow.com/questions/53353764/how-to-convert-a-very-large-decimal-string-to-hexadecimal/53353952#53353952", "title": "How to convert a very large decimal string to hexadecimal?", "body": "<p>One needs to be aware of the range of representable values for different numeric types in Rust. In this particular case, the value exceeds the limits of an <code>u64</code>, but the <code>u128</code> type accommodates the value. The following code outputs the same value as the example in Python:</p>\n\n<pre><code>fn main() {\n    let my_string = \"100000000000000000000000\".to_string();  // `parse()` works with `&amp;str` and `String`!\n    let my_int = my_string.parse::&lt;u128&gt;().unwrap();\n    let my_hex = format!(\"{:X}\", my_int);\n    println!(\"{}\", my_hex);\n}\n</code></pre>\n\n<p>Checked with the <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=ca06e8507256e66841e27cef10d4e9bf\" rel=\"nofollow noreferrer\">Rust Playground</a>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>152D02C7E14AF6800000\n</code></pre>\n\n<p>An explicit usage of arbitrary precision arithmetic is required in the general case. A few suggestions from <a href=\"https://www.reddit.com/r/rust/comments/77x3m8/whats_the_best_crate_for_arbitrary_precision/\" rel=\"nofollow noreferrer\">What's the best crate for arbitrary precision arithmetic in Rust?</a> on Reddit:</p>\n\n<ul>\n<li><code>num_bigint</code> works on stable and does not have unsafe code.</li>\n<li><code>ramp</code> uses unsafe and does not work on stable Rust, but it is faster.</li>\n<li><code>rust-gmp</code> and <code>rug</code> bind to the state-of-the-art bigint implementation in C (GMP). They are the fastest and have the most features. You probably want to use one of those.</li>\n</ul>\n"}], "owner": {"reputation": 986, "user_id": 6819040, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/IJDZr.jpg?s=128&g=1", "display_name": "AurevoirXavier", "link": "https://stackoverflow.com/users/6819040/aurevoirxavier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "accepted_answer_id": 53353952, "answer_count": 1, "score": 1, "last_activity_date": 1542487653, "creation_date": 1542475972, "last_edit_date": 1542487557, "question_id": 53353764, "link": "https://stackoverflow.com/questions/53353764/how-to-convert-a-very-large-decimal-string-to-hexadecimal", "title": "How to convert a very large decimal string to hexadecimal?", "body": "<pre><code>let hex = \"100000000000000000\".as_bytes().to_hex();\n// hex == \"313030303030303030303030303030303030\"\n\nprintln!(\"{:x}\", 100000000000000000000000u64);\n// literal out of range for u64\n</code></pre>\n\n<p>How can I got that value?</p>\n\n<p>In Python, I would just call <code>hex(100000000000000000000000)</code> and I get <code>'0x152d02c7e14af6800000'</code>.</p>\n\n<p><code>to_hex()</code> comes from the <a href=\"https://crates.io/crates/hex\" rel=\"nofollow noreferrer\">hex crate</a>.</p>\n"}, {"tags": ["rust", "priority-queue", "weak"], "comments": [{"owner": {"reputation": 319, "user_id": 7698902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504b47ca61e2dea92102495da1750314?s=128&d=identicon&r=PG&f=1", "display_name": "vandenheuvel", "link": "https://stackoverflow.com/users/7698902/vandenheuvel"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1542457312, "post_id": 53350686, "comment_id": 93580148, "body": "I expanded my answer to include the reason for wanting to avoid traversal of the entire data structure. I don&#39;t know how to give an example; it should be clear that the implementation of <code>Ord</code> requires upgrading weak references, which might fail."}], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1542462597, "post_id": 53351325, "comment_id": 93581430, "body": "Ah I forget that the state can change at anytime so indeed use a binaryheap is not at all a good idea."}, {"owner": {"reputation": 79096, "user_id": 865874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ACMnN.png?s=128&g=1", "display_name": "rodrigo", "link": "https://stackoverflow.com/users/865874/rodrigo"}, "edited": false, "score": 6, "creation_date": 1542466308, "post_id": 53351325, "comment_id": 93582317, "body": "The problem I see with your suggesting implementing <code>Ord</code> is that when a <code>Weak</code> expires (that is, its referent is destroyed) its relative order to the rest of the heap changes, and that is against the <a href=\"https://doc.rust-lang.org/std/collections/struct.BinaryHeap.html\" rel=\"nofollow noreferrer\"><code>BinaryHeap</code> contract</a>: <i>It is a logic error for an item to be modified in such a way that the item&#39;s ordering relative to any other item, as determined by the Ord trait, changes while it is in the heap.</i>"}], "tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": false, "score": 3, "last_activity_date": 1542808935, "last_edit_date": 1542808935, "creation_date": 1542458183, "answer_id": 53351325, "question_id": 53350686, "link": "https://stackoverflow.com/questions/53350686/how-do-i-remove-a-weakt-value-from-a-binaryheap-if-it-fails-to-upgrade-to-a-st/53351325#53351325", "title": "How do I remove a Weak&lt;T&gt; value from a BinaryHeap if it fails to upgrade to a strong reference?", "body": "<p>You can't remove an item while you are comparing something.</p>\n\n<p>Also, from my point of view, implementing <code>Ord</code> would be wrong for the same reason why <code>Ord</code> is not implemented for floating-point values in Rust. If you have two non-upgradable <code>Weak</code> structures, there is no order between them and that's the reason why <code>PartialOrd</code> exists.</p>\n\n<p>If you really want to make your example work, implement <code>Ord</code> for your type and order non-upgradable <code>Weak</code>s at the very top (e.g. it is always the biggest element), then use <code>peek</code> on your <code>BinaryHeap</code> to check if it is upgradable; if not, remove it and take the next one.<br>\nThis is a nasty hack but probably your best solution if you want your thing to work.</p>\n"}], "owner": {"reputation": 319, "user_id": 7698902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/504b47ca61e2dea92102495da1750314?s=128&d=identicon&r=PG&f=1", "display_name": "vandenheuvel", "link": "https://stackoverflow.com/users/7698902/vandenheuvel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1542808935, "creation_date": 1542453363, "last_edit_date": 1542466065, "question_id": 53350686, "link": "https://stackoverflow.com/questions/53350686/how-do-i-remove-a-weakt-value-from-a-binaryheap-if-it-fails-to-upgrade-to-a-st", "title": "How do I remove a Weak&lt;T&gt; value from a BinaryHeap if it fails to upgrade to a strong reference?", "body": "<p>I would like to use a <code>BinaryHeap</code> with elements of type <code>MyWrapperStruct(Weak&lt;MyStruct&gt;)</code>, where I implement <code>Ord</code> for <code>MyWrapperStruct</code>. In this implementation, I need to upgrade the weak references, which might fail. If they fail, I want the element to be removed from the heap.</p>\n\n<p>How could I implement this in a way that doesn't require me to traverse the entire heap first to remove all the non-upgradable weak references? There will be a large amount of data in this heap, while only very few of these will become invalid. For the sake of performance, I would like to avoid traversal of all data.</p>\n"}, {"tags": ["rust", "rust-tokio"], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 1296849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15429ba65d37cb4e2b2b2f8a248e33ee?s=128&d=identicon&r=PG", "display_name": "Greg Melton", "link": "https://stackoverflow.com/users/1296849/greg-melton"}, "edited": false, "score": 0, "creation_date": 1542393417, "post_id": 53343523, "comment_id": 93566003, "body": "Wow. I didn&#39;t see this deprecation notice at all. Nice to see the consolidation of all these separate tokio-* crates, though."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 71, "user_id": 1296849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15429ba65d37cb4e2b2b2f8a248e33ee?s=128&d=identicon&r=PG", "display_name": "Greg Melton", "link": "https://stackoverflow.com/users/1296849/greg-melton"}, "edited": false, "score": 0, "creation_date": 1542393573, "post_id": 53343523, "comment_id": 93566070, "body": "@GregMelton like many bigger projects, there still will be multiple crates. The big fa&#231;ade is for end users, the smaller crates are aimed at reusable libraries."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 2, "last_activity_date": 1542393130, "creation_date": 1542393130, "answer_id": 53343523, "question_id": 53343347, "link": "https://stackoverflow.com/questions/53343347/importing-the-channel-module-from-tokio-core-fails/53343523#53343523", "title": "Importing the channel module from Tokio Core fails", "body": "<p>If you look at the top of <a href=\"https://github.com/tokio-rs/tokio-core/blob/8cd731fe469166dfba316a67987532b77d8dcea4/src/channel.rs#L6-L8\" rel=\"nofollow noreferrer\">channel.rs</a>, you'll see that the entire module is deprecated and is only available if you add the appropriate feature:</p>\n\n<pre><code>#![deprecated(since = \"0.1.1\", note = \"use `futures::sync::mpsc` instead\")]\n#![allow(deprecated)]\n#![cfg(feature = \"with-deprecated\")]\n</code></pre>\n\n<p>However, the Cargo.toml does not even allow for this feature to be enabled, and it <a href=\"https://github.com/tokio-rs/tokio-core/commit/89fcc96dd44bff0ba85432d96a3a8f5b20adc94e\" rel=\"nofollow noreferrer\">apparently <strong>never</strong> did</a>. Indeed, the <em>entire crate</em> is now deprecated:</p>\n\n<blockquote>\n  <h1>Deprecation notice.</h1>\n  \n  <p>This crate is scheduled for deprecation in favor of\n  <a href=\"http://github.com/tokio-rs/tokio\" rel=\"nofollow noreferrer\">tokio</a>.</p>\n  \n  <p><code>tokio-core</code> is still actively maintained, but only bug fixes will be\n  applied. All new feature development is happening in\n  <a href=\"http://github.com/tokio-rs/tokio\" rel=\"nofollow noreferrer\">tokio</a>.</p>\n</blockquote>\n\n<p>As mentioned in the deprecation notice, use <a href=\"https://docs.rs/futures/0.1.25/futures/sync/mpsc/fn.channel.html\" rel=\"nofollow noreferrer\"><code>futures::sync::mpsc::channel</code></a> instead.</p>\n"}], "owner": {"reputation": 71, "user_id": 1296849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15429ba65d37cb4e2b2b2f8a248e33ee?s=128&d=identicon&r=PG", "display_name": "Greg Melton", "link": "https://stackoverflow.com/users/1296849/greg-melton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1542393130, "creation_date": 1542392258, "last_edit_date": 1542392800, "question_id": 53343347, "link": "https://stackoverflow.com/questions/53343347/importing-the-channel-module-from-tokio-core-fails", "title": "Importing the channel module from Tokio Core fails", "body": "<p>Inside a lib.rs I have this:</p>\n\n<pre><code>extern crate tokio_core;\nuse tokio_core::channel::{channel, Sender, Receiver};\n</code></pre>\n\n<p>Which ends up with this error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0432]: unresolved import `tokio_core::channel`\n --&gt; src/main.rs:2:17\n  |\n2 | use tokio_core::channel::{channel, Sender, Receiver};\n  |                 ^^^^^^^ Could not find `channel` in `tokio_core`\n</code></pre>\n\n<p>Looking at the <a href=\"https://github.com/tokio-rs/tokio-core/blob/8cd731fe469166dfba316a67987532b77d8dcea4/src/lib.rs#L118-L119\" rel=\"nofollow noreferrer\">tokio_core crate's lib.rs file</a>, it exports <code>channel</code> as such:</p>\n\n<pre><code>#[doc(hidden)]\npub mod channel;\n</code></pre>\n\n<p>For the life of me, I can't figure out why this doesn't work.  I've tried this on both Rust 1.29 and 1.30.1.</p>\n"}, {"tags": ["rust", "terminology", "dereference"], "answers": [{"comments": [{"owner": {"reputation": 11723, "user_id": 3356777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1c7bee1f2c7ba7f81ddb902b83626558?s=128&d=identicon&r=PG&f=1", "display_name": "attdona", "link": "https://stackoverflow.com/users/3356777/attdona"}, "edited": false, "score": 0, "creation_date": 1542452374, "post_id": 53344847, "comment_id": 93578875, "body": "I think the point is in the last sentence. Rephrasing my question: the semantic of dereferencing known by the compiler may be called auto-dereferencing?   At coercion site there is more then a <code>deref coercion</code> mechanisms, because, as you pointed out, the defer blanket impl <code>fn deref(&amp;self) -&gt; &amp;T { *self }</code> is idempotent and it does not explain &amp;&amp;&amp;&amp;x  -&gt; &amp;x."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 11723, "user_id": 3356777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1c7bee1f2c7ba7f81ddb902b83626558?s=128&d=identicon&r=PG&f=1", "display_name": "attdona", "link": "https://stackoverflow.com/users/3356777/attdona"}, "edited": false, "score": 0, "creation_date": 1542490548, "post_id": 53344847, "comment_id": 93589125, "body": "@attdona I can&#39;t follow. Auto-dereferencing means implicit rather than explicit dereferencing. It has nothing to do with the semantics of dereferencing. I also can&#39;t make sense of the word &quot;idempotent&quot; in this context. A function can only be idempotent when the range is a subset of the domain, which isn&#39;t the case here - the function maps values of type <code>&amp;&amp;T</code> to values of type <code>&amp;T</code>."}, {"owner": {"reputation": 11723, "user_id": 3356777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1c7bee1f2c7ba7f81ddb902b83626558?s=128&d=identicon&r=PG&f=1", "display_name": "attdona", "link": "https://stackoverflow.com/users/3356777/attdona"}, "edited": false, "score": 0, "creation_date": 1542555243, "post_id": 53344847, "comment_id": 93601685, "body": "I used the term idempotent inappropriately to signify that the deref blanket implementation transforms a &amp;T in a &amp;T.  Clearly if we apply <code>deref()</code> to a <code>&amp;&amp;T</code>, or a <code>&amp;&amp;&amp;T</code> we got a <code>&amp;T</code>, but in this case the main actor I see in action is auto-deref. After the auto-deref of the <code>&amp;&amp;&amp;x.deref()</code> receiver, <code>deref()</code> returns a <code>&amp;T</code> from a <code>&amp;T</code>: a sort of do-nothing operation (I assume <code>deref</code> it is called because the docs states that <code>deref</code> is always called but to me it seems useless in this case). Which term best describe what is happening: auto-deref or deref coercion?"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 11723, "user_id": 3356777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1c7bee1f2c7ba7f81ddb902b83626558?s=128&d=identicon&r=PG&f=1", "display_name": "attdona", "link": "https://stackoverflow.com/users/3356777/attdona"}, "edited": false, "score": 0, "creation_date": 1542555937, "post_id": 53344847, "comment_id": 93601898, "body": "@attdona I&#39;m sorry, I still can&#39;t follow. The prototype of the blanket deref implementation is essentially <code>deref(&amp;&amp;T) -&gt; &amp;T</code>, while you appear to think it&#39;s <code>deref(&amp;T) -&gt; &amp;T</code>. I may have misread your comment though."}, {"owner": {"reputation": 11723, "user_id": 3356777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1c7bee1f2c7ba7f81ddb902b83626558?s=128&d=identicon&r=PG&f=1", "display_name": "attdona", "link": "https://stackoverflow.com/users/3356777/attdona"}, "edited": false, "score": 0, "creation_date": 1542565388, "post_id": 53344847, "comment_id": 93604779, "body": "Many Thanks for your patience!. I wrongly thought blanket impl as <code>deref(&amp;T) -&gt; &amp;T</code> and this make me write non-sense comments."}], "tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 17, "last_activity_date": 1542560477, "last_edit_date": 1542560477, "creation_date": 1542399719, "answer_id": 53344847, "question_id": 53341819, "link": "https://stackoverflow.com/questions/53341819/what-is-the-relation-between-auto-dereferencing-and-deref-coercion/53344847#53344847", "title": "What is the relation between auto-dereferencing and deref coercion?", "body": "<p>The parallels between the two cases are rather superficial.</p>\n\n<p>In a method call expression, the compiler first needs to determine which method to call. This decision is based on the type of the receiver. The compiler builds a list of candidate receiver types, which include all types obtained by repeatedly derefencing the receiver, but also <code>&amp;T</code> and <code>&amp;mut T</code> for all types <code>T</code> encountered. This is the reason why you can call a method receiving <code>&amp;mut self</code> directly as <code>x.foo()</code> instead of having to write <code>(&amp;mut x).foo()</code>. For each type in the candidate list, the compiler then looks up inherent methods and methods on visible traits. See the <a href=\"https://doc.rust-lang.org/1.26.1/reference/expressions/method-call-expr.html\" rel=\"noreferrer\">language reference</a> for further details.</p>\n\n<p>A deref coercion is rather different. It only occurs at a <em>coercion site</em> where the compiler exactly knows what type to expect. If the actual type encountered is different from the expected type, the compiler can use any coercion, including a deref coercion, to convert the actual type to the expected type. The list of possible coercions includes unsized coercions, pointer weakening and deref coercions. See the the <a href=\"https://doc.rust-lang.org/nomicon/coercions.html\" rel=\"noreferrer\">chapter on coercions in the Nomicon</a> for further details.</p>\n\n<p>So these are really two quite different mechanisms \u2013 one for finding the right method, and one for converting types when it is already known what type exactly to expect. The first mechanism also automatically <em>references</em> the receiver, which can never happen in a coercion.</p>\n\n<blockquote>\n  <p>I thought that a dereference does not always involve deref coercion, but I'm not sure: does dereferencing always use some <code>Deref::deref</code> trait implementation?</p>\n</blockquote>\n\n<p>Not every dereferencing is a deref coercion. If you write <code>*x</code>, you <em>explicitly</em> dereference <code>x</code>. A deref <em>coercion</em> in contrast is performed implicitly by the compiler, and only in places where the compiler knows the expected type.</p>\n\n<p>The <a href=\"https://doc.rust-lang.org/reference/expressions/operator-expr.html#the-dereference-operator\" rel=\"noreferrer\">semantics of dereferencing</a> depend on whether the type of <code>x</code> is a <em>pointer type</em>, i.e. a reference or a raw pointer, or not. For pointer types, <code>*x</code> denotes the object <code>x</code> points to, while for other types <code>*x</code> is equivalent to <code>*Deref::deref(&amp;x)</code> (or the mutable anlogue of this).</p>\n\n<blockquote>\n  <p>If so, is the implementor of <code>T: Deref&lt;Target = U&gt; where T: &amp;U</code> built into the compiler?</p>\n</blockquote>\n\n<p>I'm not quite sure what your syntax is supposed to mean \u2013 it's certainly not valid Rust syntax \u2013 but I guess you are asking whether derefencing an instance of <code>&amp;T</code> to <code>T</code> is built into the compiler. As mentioned above, dereferencing of pointer types, including references, is build into the compiler, but there is also a <a href=\"https://doc.rust-lang.org/nightly/src/core/ops/deref.rs.html#86-90\" rel=\"noreferrer\">blanket implementation of <code>Deref</code> for <code>&amp;T</code></a> in the standard library. This blanket implementation is useful for generic code \u2013 the trait bound <code>T: Deref&lt;Target = U&gt;</code> otherwise wouldn't allow for <code>T = &amp;U</code>.</p>\n"}], "owner": {"reputation": 11723, "user_id": 3356777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/1c7bee1f2c7ba7f81ddb902b83626558?s=128&d=identicon&r=PG&f=1", "display_name": "attdona", "link": "https://stackoverflow.com/users/3356777/attdona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 923, "favorite_count": 3, "accepted_answer_id": 53344847, "answer_count": 1, "score": 15, "last_activity_date": 1566816616, "creation_date": 1542385549, "last_edit_date": 1566816616, "question_id": 53341819, "link": "https://stackoverflow.com/questions/53341819/what-is-the-relation-between-auto-dereferencing-and-deref-coercion", "title": "What is the relation between auto-dereferencing and deref coercion?", "body": "<p>After some <a href=\"https://stackoverflow.com/questions/53294663/program-with-multiple-ampersand-works-fine\">discussion</a>, I'm now a little bit confused about the relation between <code>auto-dereferencing</code> and <code>deref coercion</code>.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/28519997/what-are-rusts-exact-auto-dereferencing-rules\">It seems</a> that the term \"auto-dereferencing\" applies only when the target to dereference is a method receiver,\nwhereas <a href=\"https://doc.rust-lang.org/book/second-edition/ch15-02-deref.html#implicit-deref-coercions-with-functions-and-methods\" rel=\"noreferrer\">it seems</a> that the term \"deref coercion\" applies to function arguments and all contexts it needs to.</p>\n\n<p>I thought that a dereference does not always involve deref coercion, but  I'm not sure: does dereferencing always use some <code>Deref::deref</code> trait implementation?</p>\n\n<p>If so, is the implementor of <code>T: Deref&lt;Target = U&gt; where T: &amp;U</code> built into the compiler? </p>\n\n<p>Finally, it sounds natural to use the term \"autoderef\" in all the cases where the compiler implicitly transforms <code>&amp;&amp;&amp;&amp;x</code> to <code>&amp;x</code>: </p>\n\n<pre><code>pub fn foo(_v: &amp;str) -&gt; bool {\n    false\n}\n\nlet x=\"hello world\";\nfoo(&amp;&amp;&amp;&amp;x);\n</code></pre>\n\n<p>Is this the general consensus of the community? </p>\n"}, {"tags": ["rust", "future", "rust-actix"], "answers": [{"tags": [], "owner": {"reputation": 2156, "user_id": 4347341, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OUTXT.jpg?s=128&g=1", "display_name": "swizard", "link": "https://stackoverflow.com/users/4347341/swizard"}, "is_accepted": false, "score": 0, "last_activity_date": 1543056087, "creation_date": 1543056087, "answer_id": 53457314, "question_id": 53338900, "link": "https://stackoverflow.com/questions/53338900/multiple-actix-web-client-requests-expected-struct-actix-weberror-found/53457314#53457314", "title": "Multiple actix-web client requests - expected struct actix_web::Error found ()", "body": "<p>As <code>rustc</code> says there are two errors here: </p>\n\n<ol>\n<li><p>First is about error types mismatch. It could be fixed with <code>map_err</code> as you already noticed:</p>\n\n<pre><code>questions_data(n)\n    .map(move |n| {\n        res.lock().unwrap().push(n);\n    })\n    .map_err(|e| println!(\"an error occurred: {}\", e))\n</code></pre></li>\n<li><p>Second (about <code>Send</code> marker) is somewhat more confusing. Basically it means that <code>tokio::Runtime::spawn</code> want its argument future to be also <code>Send + 'static</code> because tokio could move it to another thread. But your future cannot be send between threads safely because it contains non-sendable type (<code>dyn futures::Stream&lt;Item=bytes::bytes::Bytes, Error=actix_web::Error&gt; + 'static</code>) inside <code>actix_web::client::ClientRequest</code> type.</p></li>\n</ol>\n\n<p>Probably the easiest way to fix the second error is to use <code>actix::spawn</code> function instead <code>tokio::Runtime::spawn</code> method: it requires only <code>'static</code> marker for its argument. </p>\n\n<p>After these changes your program compiles at least.</p>\n"}], "owner": {"reputation": 11878, "user_id": 588759, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/216ea4da5cae7be4030b6242ab90631c?s=128&d=identicon&r=PG", "display_name": "rofrol", "link": "https://stackoverflow.com/users/588759/rofrol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 703, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1543056087, "creation_date": 1542375163, "last_edit_date": 1542379634, "question_id": 53338900, "link": "https://stackoverflow.com/questions/53338900/multiple-actix-web-client-requests-expected-struct-actix-weberror-found", "title": "Multiple actix-web client requests - expected struct actix_web::Error found ()", "body": "<p>I have this code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate actix;\nextern crate actix_web;\nextern crate env_logger;\nextern crate futures; // 0.1.25\nextern crate tokio; // 0.1.17\nuse futures::future::ok as fut_ok;\nuse futures::Future;\nuse tokio::runtime::Builder;\n\nuse std::sync::{Arc, Mutex};\nextern crate serde_json;\n\ntype Error = ();\n\nfn questions_data(\n    val: i32,\n) -&gt; Box&lt;Future&lt;Item = serde_json::Value, Error = actix_web::error::Error&gt;&gt; {\n    let f = std::fs::read_to_string(\"auth_token\").unwrap();\n    let token = f.trim();\n    use actix_web::{client, HttpMessage};\n    use std::time::Duration;\n    Box::new(\n        client::ClientRequest::get(\n            \"https://jsonplaceholder.typicode.com/todos/\".to_owned() + &amp;val.to_string(),\n        )\n        .header(\n            actix_web::http::header::AUTHORIZATION,\n            \"Bearer \".to_owned() + token,\n        )\n        .finish()\n        .unwrap()\n        .send()\n        .timeout(Duration::from_secs(30))\n        .map_err(actix_web::error::Error::from) // &lt;- convert SendRequestError to an Error\n        .and_then(|resp| {\n            resp.body().limit(67_108_864).from_err().and_then(|body| {\n                let resp: serde_json::Value = serde_json::from_slice(&amp;body).unwrap();\n                fut_ok(resp)\n            })\n        }),\n    )\n}\n\nfn main() {\n    let num_workers = 8;\n\n    let mut core = Builder::new().core_threads(num_workers).build().unwrap();\n\n    let results = Arc::new(Mutex::new(Vec::new()));\n    for n in 1..100 {\n        let res = results.clone();\n        core.spawn(questions_data(n).map(move |n| {\n            res.lock().unwrap().push(n);\n        }));\n    }\n    core.shutdown_on_idle().wait().unwrap();\n    let data = results.lock().unwrap();\n    println!(\"{:?}\", *data);\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>[dependencies]\nfutures = \"0.1.25\"\ntokio-core = \"0.1.17\"\nfutures-util = \"0.2.1\"\ntokio = \"0.1.11\"\nrand = \"0.6.0\"\nactix-web = \"0.7.14\"\nactix = \"0.7.6\"\nenv_logger = \"0.6.0\"\nserde_json = \"1.0.33\"\n</code></pre>\n\n<p>I get error when I <code>cargo run</code> it:</p>\n\n<pre><code>error[E0271]: type mismatch resolving `&lt;std::boxed::Box&lt;futures::Map&lt;std::boxed::Box&lt;dyn futures::Future&lt;Item=serde_json::Value, Error=actix_web::Error&gt;&gt;, [closure@src/main.rs:52:51: 54:10 res:_]&gt;&gt; as futures::Future&gt;::Error == ()`\n  --&gt; src/main.rs:52:14\n   |\n52 |         core.spawn(Box::new(questions_data(n).map(move |n| {\n   |              ^^^^^ expected struct `actix_web::Error`, found ()\n   |\n   = note: expected type `actix_web::Error`\n              found type `()`\n\nerror[E0277]: `dyn futures::Future&lt;Item=serde_json::Value, Error=actix_web::Error&gt;` cannot be sent between threads safely\n  --&gt; src/main.rs:52:14\n   |\n52 |         core.spawn(Box::new(questions_data(n).map(move |n| {\n   |              ^^^^^ `dyn futures::Future&lt;Item=serde_json::Value, Error=actix_web::Error&gt;` cannot be sent between threads safely\n   |\n   = help: the trait `std::marker::Send` is not implemented for `dyn futures::Future&lt;Item=serde_json::Value, Error=actix_web::Error&gt;`\n   = note: required because of the requirements on the impl of `std::marker::Send` for `std::ptr::Unique&lt;dyn futures::Future&lt;Item=serde_json::Value, Error=actix_web::Error&gt;&gt;`\n   = note: required because it appears within the type `std::boxed::Box&lt;dyn futures::Future&lt;Item=serde_json::Value, Error=actix_web::Error&gt;&gt;`\n   = note: required because it appears within the type `futures::Map&lt;std::boxed::Box&lt;dyn futures::Future&lt;Item=serde_json::Value, Error=actix_web::Error&gt;&gt;, [closure@src/main.rs:52:51: 54:10 res:_]&gt;`\n   = note: required because of the requirements on the impl of `std::marker::Send` for `std::ptr::Unique&lt;futures::Map&lt;std::boxed::Box&lt;dyn futures::Future&lt;Item=serde_json::Value, Error=actix_web::Error&gt;&gt;, [closure@src/main.rs:52:51: 54:10 res:_]&gt;&gt;`\n   = note: required because it appears within the type `std::boxed::Box&lt;futures::Map&lt;std::boxed::Box&lt;dyn futures::Future&lt;Item=serde_json::Value, Error=actix_web::Error&gt;&gt;, [closure@src/main.rs:52:51: 54:10 res:_]&gt;&gt;`\n</code></pre>\n\n<p>Similar code, without running actix-web client, works <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=e81185a73fcb40a3426875573c78accd\" rel=\"nofollow noreferrer\">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=e81185a73fcb40a3426875573c78accd</a></p>\n\n<p>EDIT:</p>\n\n<p>Maybe something like <code>map_err(|_| ())</code> but don\u2019t know how to apply that:</p>\n\n<ul>\n<li><a href=\"https://users.rust-lang.org/t/type-error-when-combining-streams/21619\" rel=\"nofollow noreferrer\">https://users.rust-lang.org/t/type-error-when-combining-streams/21619</a></li>\n<li><a href=\"https://stackoverflow.com/questions/47582586/type-mismatch-resolving-the-error-type-when-forwarding-messages-from-a-futures-c\">Type mismatch resolving the error type when forwarding messages from a futures channel to a WebSocket Sink</a></li>\n</ul>\n"}, {"tags": ["rust", "rust-tokio"], "answers": [{"tags": [], "owner": {"reputation": 2156, "user_id": 4347341, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OUTXT.jpg?s=128&g=1", "display_name": "swizard", "link": "https://stackoverflow.com/users/4347341/swizard"}, "is_accepted": true, "score": 1, "last_activity_date": 1543095497, "creation_date": 1543095497, "answer_id": 53462589, "question_id": 53335596, "link": "https://stackoverflow.com/questions/53335596/add-new-tasks-to-tokio-event-loop-and-retry-tasks-on-failure/53462589#53462589", "title": "Add new tasks to tokio event loop and retry tasks on failure", "body": "<blockquote>\n  <p>I assume I need to use loop_fn for the main loop</p>\n</blockquote>\n\n<p>I'd suggest slightly another approach: implement <code>futures::sync::mpsc::Receiver</code> stream consumer instead of a loop. </p>\n\n<p>It could be viewed as some kind of master process: after receiving an url via <code>Receiver</code> a tokio task could be spawned for contents downloading. Then there will be no problem with retrying: just send the failed or timed out url again to master channel via its <code>Sender</code> endpoint. </p>\n\n<p>Here is a working code sketch:</p>\n\n<pre><code>extern crate futures;\nextern crate tokio;\n\nuse std::{io, time::{Duration, Instant}};\nuse futures::{\n    Sink,\n    Stream,\n    stream,\n    sync::mpsc,\n    future::Future,\n};\nuse tokio::{\n    runtime::Runtime,\n    timer::{Delay, Timeout},\n};\n\nfn main() -&gt; Result&lt;(), io::Error&gt; {\n    let mut rt = Runtime::new()?;\n    let executor = rt.executor();\n\n    let (tx, rx) = mpsc::channel(0);\n    let master_tx = tx.clone();\n    let master = rx.for_each(move |url: String| {\n        let download_future = download(&amp;url)\n            .map(|_download_contents| {\n                // TODO: actually do smth with contents\n                ()\n            });\n        let timeout_future =\n            Timeout::new(download_future, Duration::from_millis(2000));\n        let job_tx = master_tx.clone();\n        let task = timeout_future\n            .or_else(move |error| {\n                // actually download error or timeout, retry\n                println!(\"retrying {} because of {:?}\", url, error);\n                job_tx.send(url).map(|_| ()).map_err(|_| ())\n            });\n        executor.spawn(task);\n        Ok(())\n    });\n\n    rt.spawn(master);\n\n    let urls = vec![\n        \"http://url1\".to_string(),\n        \"http://url2\".to_string(),\n        \"http://url3\".to_string(),\n    ];\n    rt.executor()\n        .spawn(tx.send_all(stream::iter_ok(urls)).map(|_| ()).map_err(|_| ()));\n\n    rt.shutdown_on_idle().wait()\n        .map_err(|()| io::Error::new(io::ErrorKind::Other, \"shutdown failure\"))\n}\n\n#[derive(Debug)]\nstruct DownloadContents;\n#[derive(Debug)]\nstruct DownloadError;\n\nfn download(url: &amp;str) -&gt; Box&lt;Future&lt;Item = DownloadContents, Error = DownloadError&gt; + Send&gt; {\n    // TODO: actually download here\n\n    match url {\n        // url2 always fails\n        \"http://url2\" =&gt; {\n            println!(\"FAILED downloading: {}\", url);\n            let future = Delay::new(Instant::now() + Duration::from_millis(1000))\n                .map_err(|_| DownloadError)\n                .and_then(|()| Err(DownloadError));\n            Box::new(future)\n        },\n        // url3 always timeouts\n        \"http://url3\" =&gt; {\n            println!(\"TIMEOUT downloading: {}\", url);\n            let future = Delay::new(Instant::now() + Duration::from_millis(5000))\n                .map_err(|_| DownloadError)\n                .and_then(|()| Ok(DownloadContents));\n            Box::new(future)\n        },\n        // everything else succeeds\n        _ =&gt; {\n            println!(\"SUCCESS downloading: {}\", url);\n            let future = Delay::new(Instant::now() + Duration::from_millis(50))\n                .map_err(|_| DownloadError)\n                .and_then(|()| Ok(DownloadContents));\n            Box::new(future)\n        },\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 4335, "user_id": 314784, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/c9414b15cfad914b3e8af1bf40f01c13?s=128&d=identicon&r=PG", "display_name": "Ben Ruijl", "link": "https://stackoverflow.com/users/314784/ben-ruijl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 0, "accepted_answer_id": 53462589, "answer_count": 1, "score": 0, "last_activity_date": 1543095497, "creation_date": 1542362999, "question_id": 53335596, "link": "https://stackoverflow.com/questions/53335596/add-new-tasks-to-tokio-event-loop-and-retry-tasks-on-failure", "title": "Add new tasks to tokio event loop and retry tasks on failure", "body": "<p>I am trying to write a tokio event loop that can perform get request from the same server, with the following characteristics:</p>\n\n<ul>\n<li>A connection pool should be used</li>\n<li>The get requests are generally slow (>1s), so they need to be performed in parallel</li>\n<li>The server may not respond so I need a timeout. If the request wasn't received,  send it again</li>\n<li>Poll a receiver for new urls that have to be downloaded. They should be added to the event loop</li>\n</ul>\n\n<p>In my tries so far, I've managed to get different combinations of the 4 items working, but never all together. My main problem is that I don't quite understand how I can add new futures to the tokio event loop. </p>\n\n<p>I assume I need to use <code>loop_fn</code> for the main loop that polls the receiver, and <code>handle.spawn</code> to spawn new tasks? <code>handle.spawn</code> only allows futures of <code>Result&lt;(),()&gt;</code>, so I can't use its output to respawn a job on failure, so I need to move the retry check into that future?</p>\n\n<p>Below is an attempt that accepts and processes urls in batch (so no continuous polling), and has a timeout (but no retry):</p>\n\n<pre><code>fn place_dls(&amp;mut self, reqs: Vec&lt;String&gt;) {\n    let mut core = Core::new().unwrap();\n    let handle = core.handle();\n\n    let timeout = Timeout::new(Duration::from_millis(5000), &amp;handle).unwrap();\n\n    let send_dls = stream::iter_ok::&lt;_, reqwest::Error&gt;(reqs.iter().map(|o| {\n        // send with request through an async reqwest client in self\n    }));\n\n    let rec_dls = send_dls.buffer_unordered(dls.len()).for_each(|n| {\n        n.into_body().concat2().and_then(|full_body| {\n            debug!(\"Received: {:#?}\", full_body);\n\n            // TODO: how to put the download back in the queue if failure code is received?\n        })\n    });\n\n    let work = rec_dls.select2(timeout).then(|res| match res {\n        Ok(Either::A((got, _timeout))) =&gt; {\n            Ok(got)\n        },\n        Ok(Either::B((_timeout_error, _get))) =&gt; {\n            // TODO: put back in queue\n            Err(io::Error::new(\n                io::ErrorKind::TimedOut,\n                \"Client timed out while connecting\",\n            ).into())\n        }\n        Err(Either::A((get_error, _timeout))) =&gt; Err(get_error.into()),\n        Err(Either::B((timeout_error, _get))) =&gt; Err(timeout_error.into()),\n    });\n\n    core.run(work);\n}\n</code></pre>\n\n<p>My try with a <code>loop_fn</code> was sadly unsuccessful.</p>\n"}, {"tags": ["hashmap", "rust"], "answers": [{"comments": [{"owner": {"reputation": 429, "user_id": 5081997, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GmesG-HGk2A/AAAAAAAAAAI/AAAAAAAACLI/lmInTd8OR3A/photo.jpg?sz=128", "display_name": "cotigao", "link": "https://stackoverflow.com/users/5081997/cotigao"}, "edited": false, "score": 1, "creation_date": 1542372397, "post_id": 53333439, "comment_id": 93555105, "body": "With Rc (<i>not allowed yet to comment on @jmb&#39;s answer</i>):   <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=3b9f2f67ce57a22583d68511295b2ecb\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 492, "user_id": 3059546, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/528688700/picture?type=large", "display_name": "WarSame", "link": "https://stackoverflow.com/users/3059546/warsame"}, "edited": false, "score": 0, "creation_date": 1542589890, "post_id": 53333439, "comment_id": 93610947, "body": "Thanks Vikram. Could I get a little more detail on the test case itself? I tried to implement it without using Rc(for familiarity with the language) but got the double mutable borrow problem again. Considering it only takes the reference to the V it shouldn&#39;t be a problem. <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=4f8846f6349e4c1e1dbb9b9b4b4c36fa\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 429, "user_id": 5081997, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GmesG-HGk2A/AAAAAAAAAAI/AAAAAAAACLI/lmInTd8OR3A/photo.jpg?sz=128", "display_name": "cotigao", "link": "https://stackoverflow.com/users/5081997/cotigao"}, "reply_to_user": {"reputation": 492, "user_id": 3059546, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/528688700/picture?type=large", "display_name": "WarSame", "link": "https://stackoverflow.com/users/3059546/warsame"}, "edited": false, "score": 1, "creation_date": 1542598584, "post_id": 53333439, "comment_id": 93612480, "body": "@WarSame, Yes, the function signature of <code>value()</code> on its own is fine, but to work in tandem with your <code>test</code>, it is not. (as explained). I see, you have already declared  <code>V</code> to be a <code>Clone</code> type, so why not change the signature to <code>fn value(&amp;mut self, k: K) -&gt; V  { ..</code>  ? since you don&#39;t want want to use <code>Rc</code>.  <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=c342786e2300ab66ed0b716448b30548\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>."}, {"owner": {"reputation": 429, "user_id": 5081997, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GmesG-HGk2A/AAAAAAAAAAI/AAAAAAAACLI/lmInTd8OR3A/photo.jpg?sz=128", "display_name": "cotigao", "link": "https://stackoverflow.com/users/5081997/cotigao"}, "reply_to_user": {"reputation": 492, "user_id": 3059546, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/528688700/picture?type=large", "display_name": "WarSame", "link": "https://stackoverflow.com/users/3059546/warsame"}, "edited": false, "score": 0, "creation_date": 1542599825, "post_id": 53333439, "comment_id": 93612719, "body": "@WarSame, Another way could be to use raw pointers. This will allow you to keep the signature of <code>value()</code> intact and <code>V</code> is not required to be a <code>Clone</code> type. Note that usage of raw pointers is generally considered &quot;unsafe&quot;, but if strictly speaking of this particular case, it seems fine. <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=27f5ff5691ac5e0b8e6cc151a676577e\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 492, "user_id": 3059546, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/528688700/picture?type=large", "display_name": "WarSame", "link": "https://stackoverflow.com/users/3059546/warsame"}, "edited": false, "score": 1, "creation_date": 1542600211, "post_id": 53333439, "comment_id": 93612807, "body": "Thanks Vikram. I am brand new to Rust and have not played around with cloning or many different elements yet. I appreciate your patient explanations and the extra detail/options you present. I would definitely prefer to avoid raw pointers because I am aware they can be very dangerous. I switched to the Clone method and it works!"}], "tags": [], "owner": {"reputation": 429, "user_id": 5081997, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GmesG-HGk2A/AAAAAAAAAAI/AAAAAAAACLI/lmInTd8OR3A/photo.jpg?sz=128", "display_name": "cotigao", "link": "https://stackoverflow.com/users/5081997/cotigao"}, "is_accepted": true, "score": 4, "last_activity_date": 1542366570, "last_edit_date": 1542366570, "creation_date": 1542354217, "answer_id": 53333439, "question_id": 53331382, "link": "https://stackoverflow.com/questions/53331382/how-do-i-build-a-cacher-in-rust-without-relying-on-the-copy-trait/53333439#53333439", "title": "How do I build a Cacher in Rust without relying on the Copy trait?", "body": "<p>I think there a quite a few issues to look into here: </p>\n\n<p>First, for the definition of the function <code>value(&amp;mut self, k: K) -&gt; &amp;V</code> ; the compiler will insert the lifetimes for you so that it becomes <code>value(&amp;'a mut self, k: K) -&gt; &amp;'a V</code>. This means, the lifetime of the <code>self</code> cannot shrink for the sake of the function, because there is reference coming out of the function with the same lifetime, and will live for as long as the scope. Since it is a mutable reference, you cannot borrow it again. Hence the error <code>error[E0499]: cannot borrow cacher as mutable more than once at a time</code>.</p>\n\n<p>Second, you call the <code>calculation</code> function that returns the value within some inner scope of the function <code>value()</code> and then you return the reference to it, which is not possible. You expect the reference to  live longer than the the referent. Hence the error  <code>error[E0597]: v does not live long enough</code></p>\n\n<p>The third error is a bit involved. You see, <code>let result = self.values.get(&amp;k);</code> as mentioned in the first statement, causes <code>k</code> to be held immutably till the end of the function. <code>result</code> returned will live for as long  your function <code>value()</code>, which means you cannot take a borrow(mutable) in the same scope, giving the error\n<code>error[E0502]: cannot borrow self.values as mutable because it is also borrowed as immutable in value() self.values.get(&amp;k)</code></p>\n\n<p>Your <code>K</code> needs to be a <code>Clone</code>, reason being <code>k</code> will be moved into the function <code>calculation</code>, rendering it unusable during <code>insert</code>.</p>\n\n<p>So with <code>K</code> as a <code>Clone</code>, the <code>Cacher</code> implementation will be:</p>\n\n<pre><code>impl&lt;T, K: Eq + Hash + Clone, V&gt; Cacher&lt;T, K, V&gt;\nwhere\n    T: Fn(K) -&gt; V,\n{\n    pub fn new(calculation: T) -&gt; Cacher&lt;T, K, V&gt; {\n        Cacher {\n            calculation,\n            values: hash_map::HashMap::new(),\n        }\n    }\n\n    pub fn value(&amp;mut self, k: K) -&gt; &amp;V {\n        if self.values.contains_key(&amp;k) {\n            return &amp;self.values[&amp;k];\n        }\n\n        self.values.insert(k.clone(), (self.calculation)(k.clone()));\n        self.values.get(&amp;k).unwrap()\n    }\n}\n</code></pre>\n\n<p>This lifetimes here are based on the branching control flow. The <code>if self.values.contains_key ...</code> block always returns, hence the code after <code>if</code> block can only be executed when <code>if self.values.contains_key ...</code> is <code>false</code>. The tiny scope created for <code>if</code> condition, will only live within the condition check, i.e reference taken (and returned) for <code>if self.values.contains_key(...</code>  will go away with this tiny scope.</p>\n\n<p>For more please refer <a href=\"https://github.com/nikomatsakis/nll-rfc/blob/master/0000-nonlexical-lifetimes.md\" rel=\"nofollow noreferrer\">NLL RFC</a></p>\n\n<p>As mentioned by @jmb in his answer, for your test to work, <code>V</code> will need to be a <code>Clone</code> (<code>impl &lt;... V:Clone&gt; Cacher&lt;T, K, V&gt;</code>) to return by value  or use shared ownership like <code>Rc</code> to avoid the cloning cost.</p>\n\n<p>eg.</p>\n\n<pre><code>fn value(&amp;mut self, k: K) -&gt; V  { ..\nfn value(&amp;mut self, k: K) -&gt; Rc&lt;V&gt; { ..\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1542356231, "post_id": 53333533, "comment_id": 93547028, "body": "Your code does not compile at all. Please fix that!"}], "tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": false, "score": 2, "last_activity_date": 1542354638, "creation_date": 1542354638, "answer_id": 53333533, "question_id": 53331382, "link": "https://stackoverflow.com/questions/53331382/how-do-i-build-a-cacher-in-rust-without-relying-on-the-copy-trait/53333533#53333533", "title": "How do I build a Cacher in Rust without relying on the Copy trait?", "body": "<ol>\n<li><p>Returning a reference to a value is the same thing as borrowing that value. Since that value is owned by the cacher, it implicitly borrows the cacher too. This makes sense: if you take a reference to a value inside the cacher then destroy the cacher, what happens to your reference? Note also that if you modify the cacher (e.g. by inserting a new element), this could reallocate the storage, which would invalidate any references to values stored inside.</p>\n\n<p>You need your values to be at least <code>Clone</code> so that <code>Cacher::value</code> can return by value instead of by reference. You can use <a href=\"https://doc.rust-lang.org/stable/std/rc/struct.Rc.html\" rel=\"nofollow noreferrer\"><code>Rc</code></a> if your values are too expensive to clone and you are ok with all callers getting the same instance.</p></li>\n<li><p>The naive way to get the instance that was stored in the <code>HashMap</code> as opposed to the temporary you allocated to build it would be to call <code>self.values.get (k).unwrap()</code> after inserting the value in the map. In order to avoid the cost of computing twice the location of the value in the map, you can use the <a href=\"https://doc.rust-lang.org/stable/std/collections/hash_map/enum.Entry.html\" rel=\"nofollow noreferrer\"><code>Entry</code></a> interface:</p>\n\n<pre><code>pub fn value(&amp;mut self, k: K) -&gt; Rc&lt;V&gt; {\n    self.values.entry (&amp;k).or_insert_with (|| Rc::new (self.calculation (k)))\n}\n</code></pre></li>\n<li><p>I believe my answer to point 2 also solves this point.</p></li>\n</ol>\n"}], "owner": {"reputation": 492, "user_id": 3059546, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/528688700/picture?type=large", "display_name": "WarSame", "link": "https://stackoverflow.com/users/3059546/warsame"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 533, "favorite_count": 1, "accepted_answer_id": 53333439, "answer_count": 2, "score": 5, "last_activity_date": 1542366570, "creation_date": 1542341927, "last_edit_date": 1542356138, "question_id": 53331382, "link": "https://stackoverflow.com/questions/53331382/how-do-i-build-a-cacher-in-rust-without-relying-on-the-copy-trait", "title": "How do I build a Cacher in Rust without relying on the Copy trait?", "body": "<p>I am trying to implement a <code>Cacher</code> as mentioned in <a href=\"https://doc.rust-lang.org/book/2018-edition/ch13-01-closures.html#limitations-of-the-cacher-implementation\" rel=\"noreferrer\">Chapter 13</a> of the Rust book and running into trouble.</p>\n\n<p>My <code>Cacher</code> code looks like:</p>\n\n<pre><code>use std::collections::HashMap;\nuse std::hash::Hash;\n\npub struct Cacher&lt;T, K, V&gt;\nwhere\n    T: Fn(K) -&gt; V,\n{\n    calculation: T,\n    values: HashMap&lt;K, V&gt;,\n}\n\nimpl&lt;T, K: Eq + Hash, V&gt; Cacher&lt;T, K, V&gt;\nwhere\n    T: Fn(K) -&gt; V,\n{\n    pub fn new(calculation: T) -&gt; Cacher&lt;T, K, V&gt; {\n        Cacher {\n            calculation,\n            values: HashMap::new(),\n        }\n    }\n\n    pub fn value(&amp;mut self, k: K) -&gt; &amp;V {\n        let result = self.values.get(&amp;k);\n        match result {\n            Some(v) =&gt; {\n                return v;\n            }\n            None =&gt; {\n                let v = (self.calculation)(k);\n                self.values.insert(k, v);\n                &amp;v\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>and my test case for this lib looks like:</p>\n\n<pre><code>mod cacher;\n\n#[cfg(test)]\nmod tests {\n    use cacher::Cacher;\n\n    #[test]\n    fn repeated_runs_same() {\n        let mut cacher = Cacher::new(|x| x);\n        let run1 = cacher.value(5);\n        let run2 = cacher.value(7);\n\n        assert_ne!(run1, run2);\n    }\n}\n</code></pre>\n\n<p>I ran into the following problems when running my test case:</p>\n\n<ol>\n<li><code>error[E0499]: cannot borrow cacher as mutable more than once at a time</code>\nEach time I make a run1, run2 value it is trying to borrow <code>cacher</code> as a mutable borrow. I don't understand why it is borrowing at all - I thought <code>cacher.value()</code> should be returning a reference to the item that is stored in the <code>cacher</code> which is not a borrow.</li>\n<li><code>error[E0597]: v does not live long enough</code> pointing to the v I return in the None case of value(). How do I properly move the <code>v</code> into the <code>HashMap</code> and give it the same lifetime as the <code>HashMap</code>? Clearly the lifetime is expiring as it returns, but I want to just return a reference to it to use as the return from value().</li>\n<li><code>error[E0502]: cannot borrow</code>self.values<code>as mutable because it is also borrowed as immutable</code> in value(). <code>self.values.get(&amp;k)</code> is an immutable borrow and <code>self.values.insert(k,v)</code> is a mutable borrow - though I thought <code>.get()</code> was an immutable borrow and <code>.insert()</code> was a transfer of ownership.</li>\n</ol>\n\n<p>and a few other errors related to moving which I should be able to handle separately. These are much more fundamental errors that indicate I have misunderstood the idea of ownership in Rust, yet rereading the segment of the book doesn't make clear to me what I missed.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1542340886, "post_id": 53330919, "comment_id": 93542307, "body": "Your immediate problem is that you are using invalid syntax. You want <code>impl&lt;P: AsRef&lt;Path&gt;&gt; From&lt;P&gt; for Example</code>. However, yes, what you are trying to do is fundamentally disallowed, as explained by the duplicate."}, {"owner": {"reputation": 257, "user_id": 6274654, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f0b36df143b09356a689cef652cd628?s=128&d=identicon&r=PG&f=1", "display_name": "ratorx", "link": "https://stackoverflow.com/users/6274654/ratorx"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1542341213, "post_id": 53330919, "comment_id": 93542383, "body": "Thanks for linking the duplicate. I should&#39;ve searched harder before posting."}], "owner": {"reputation": 257, "user_id": 6274654, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f0b36df143b09356a689cef652cd628?s=128&d=identicon&r=PG&f=1", "display_name": "ratorx", "link": "https://stackoverflow.com/users/6274654/ratorx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "closed_date": 1542340816, "answer_count": 0, "score": 0, "last_activity_date": 1542340787, "creation_date": 1542338207, "last_edit_date": 1542340787, "question_id": 53330919, "link": "https://stackoverflow.com/questions/53330919/how-to-implement-the-from-trait-for-any-type-that-implements-asrefpath", "closed_reason": "Duplicate", "title": "How to implement the From trait for any type that implements AsRef&lt;Path&gt;?", "body": "<p>I'm having trouble trying to implement From on a struct. A simple example is:</p>\n\n<pre><code>#[derive(Debug)]\nstruct Example {\n    field: String,\n}\n\nimpl From&lt;P: AsRef&lt;Path&gt;&gt; for Example {\n    fn from(path: P) -&gt; Self {\n        Example {\n            field: path.as_ref().to_str().unwrap().to_owned(),\n        }\n    }\n}\n\nfn main() {\n    println!(\"{:?}\", Example::from(\"test\"));\n}\n</code></pre>\n\n<p>This fails to compile with:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: expected one of `!`, `(`, `+`, `,`, `::`, `&lt;`, or `&gt;`, found `:`\n --&gt; src/main.rs:6:12\n  |\n6 | impl From&lt;P: AsRef&lt;Path&gt;&gt; for Example {\n  |            ^ expected one of 7 possible tokens here\n</code></pre>\n\n<p>I have also tried <code>From&lt;AsRef&lt;Path&gt;&gt;</code>, but couldn't get that to work either. I expected the first example to work because that is the syntax I would use for a function.</p>\n\n<p>Is what I'm trying to do fundamentally not possible? Or am I doing it wrong?</p>\n"}, {"tags": ["rust", "future", "borrow-checker", "rust-tokio", "hyper"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1542336307, "post_id": 53330556, "comment_id": 93541396, "body": "I think there is no point to use <code>for_each()</code>, <code>into_body()</code> return an option so just use <code>map()</code> instead. But maybe I totally wrong I don&#39;t understand a thing in hyper/futures"}, {"owner": {"reputation": 1171, "user_id": 3758543, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a4a349f90341d8d2b1045f6cf8cc54b3?s=128&d=identicon&r=PG&f=1", "display_name": "lhahn", "link": "https://stackoverflow.com/users/3758543/lhahn"}, "edited": false, "score": 0, "creation_date": 1542338031, "post_id": 53330556, "comment_id": 93541708, "body": "As far as I understand from the answers both of them write synchronously to the file using <code>write_all</code>. In my case <code>io::write_all</code> is done asynchronously as well."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 3, "last_activity_date": 1542426081, "last_edit_date": 1542426081, "creation_date": 1542384582, "answer_id": 53341578, "question_id": 53330556, "link": "https://stackoverflow.com/questions/53330556/writing-a-chunk-stream-to-a-file-asynchronously-using-hyper/53341578#53341578", "title": "Writing a chunk stream to a file asynchronously using hyper", "body": "<p>You do not want to use <code>for_each</code>. <a href=\"https://docs.rs/tokio-io/0.1.10/tokio_io/io/fn.write_all.html\" rel=\"nofollow noreferrer\"><code>io::write_all</code></a> consumes the target and the buffer in exchange for a future that will return the target and the buffer when it is done. You can combine this with <a href=\"https://docs.rs/futures/0.1.25/futures/stream/trait.Stream.html#method.fold\" rel=\"nofollow noreferrer\"><code>Stream::fold</code></a> to reuse the file:</p>\n\n<pre><code>.fold(file, |file, chunk| {\n    io::write_all(file, chunk)\n        .map(|(f, _c)| f)\n        .map_err(|_| DownloadFileError::FileWrite)\n})\n.map(drop)\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/53245412/155423\">How do I write a futures::Stream to disk without storing it entirely in memory first?</a></li>\n<li><a href=\"https://stackoverflow.com/q/51287360/155423\">How to save a file downloaded from S3 with Rusoto to my hard drive?</a></li>\n</ul>\n"}], "owner": {"reputation": 1171, "user_id": 3758543, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a4a349f90341d8d2b1045f6cf8cc54b3?s=128&d=identicon&r=PG&f=1", "display_name": "lhahn", "link": "https://stackoverflow.com/users/3758543/lhahn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1256, "favorite_count": 0, "accepted_answer_id": 53341578, "answer_count": 1, "score": 3, "last_activity_date": 1542426081, "creation_date": 1542334970, "last_edit_date": 1542338220, "question_id": 53330556, "link": "https://stackoverflow.com/questions/53330556/writing-a-chunk-stream-to-a-file-asynchronously-using-hyper", "title": "Writing a chunk stream to a file asynchronously using hyper", "body": "<p>I am trying to create a simple function that downloads a remote file to a local filepath using hyper. I need the file write to be asynchronous as well (in my case I am using <code>tokio_fs</code> for that). Here is the code:</p>\n\n<p><a href=\"https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=eff37a9983a367359e901a28ce51bb01\" rel=\"nofollow noreferrer\">View in the playground</a></p>\n\n<pre><code>// Parts of the code were omitted, see the playground for full source code\npub fn download_file(\n    uri: Uri,\n    file_location: &amp;Path,\n) -&gt; Box&lt;Future&lt;Item = (), Error = DownloadFileError&gt;&gt; {\n    let temp_dir_path = tempfile::tempdir().unwrap().into_path();\n    let file_name = match file_location.file_name() {\n        Some(file_name) =&gt; file_name,\n        None =&gt; return Box::new(futures::failed(DownloadFileError::IncorrectFilePath)),\n    };\n\n    let temp_filepath = temp_dir_path.join(&amp;file_name);\n\n    let connector = HttpsConnector::new(2).unwrap();\n    let client: Client&lt;_, Body&gt; = Client::builder().build(connector);\n\n    let response_future = client\n        .get(uri)\n        .map_err(|err| DownloadFileError::GetRequest(err));\n\n    let create_file_future =\n        File::create(temp_filepath).map_err(|err| DownloadFileError::CreateFile(err));\n\n    Box::new(\n        response_future\n            .join(create_file_future)\n            .and_then(move |(res, file)| {\n                res.into_body()\n                    .map_err(|e| DownloadFileError::GetRequest(e))\n                    .for_each(move |chunk| {\n                        io::write_all(file, chunk)\n                            .map(|_| ())\n                            .map_err(|_| DownloadFileError::FileWrite)\n                    })\n            }),\n    )\n}\n</code></pre>\n\n<p>However, I get the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0507]: cannot move out of captured outer variable in an `FnMut` closure\n  --&gt; src/lib.rs:79:39\n   |\n75 |             .and_then(move |(res, file)| {\n   |                                   ---- captured outer variable\n...\n79 |                         io::write_all(file, chunk)\n   |                                       ^^^^ cannot move out of captured outer variable in an `FnMut` closure\n</code></pre>\n\n<p>Conceptually, I understand what the error means: Since a <code>FnMut</code> captures variables by mutable reference, I cannot move a captured variable. However, I do not understand how can I work around this problem in the example given, since I need to write the stream to the file returned by the <code>Join</code> future.</p>\n\n<p>The <code>write_all</code> method from the <code>Write</code> trait would work here since it takes the file as a mutable reference, but the problem is that it does the writing on the same thread.</p>\n"}, {"tags": ["rust", "rust-diesel"], "answers": [{"comments": [{"owner": {"reputation": 2476, "user_id": 5931673, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/aTpXN.jpg?s=128&g=1", "display_name": "ajxs", "link": "https://stackoverflow.com/users/5931673/ajxs"}, "edited": false, "score": 4, "creation_date": 1556439970, "post_id": 54250872, "comment_id": 98434123, "body": "After reading just about everything I could find online, this issue was resolved for me finally by fixing <code>uuid</code> to version 0.6. Thank you for pointing this out, it wasn&#39;t made obvious anywhere else."}], "tags": [], "owner": {"reputation": 71, "user_id": 10932502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee8e2504f6237153d832eb1385188669?s=128&d=identicon&r=PG&f=1", "display_name": "canab", "link": "https://stackoverflow.com/users/10932502/canab"}, "is_accepted": false, "score": 7, "last_activity_date": 1547955812, "last_edit_date": 1547955812, "creation_date": 1547803245, "answer_id": 54250872, "question_id": 53326887, "link": "https://stackoverflow.com/questions/53326887/rust-diesel-how-to-query-and-insert-into-postgres-tables-which-have-uuid/54250872#54250872", "title": "Rust/Diesel: How to query and insert into postgres tables which have uuid", "body": "<p>The type in the struct needs to be a Rust type rather than a SQL type, specifically <code>Uuid</code> from the <a href=\"https://docs.rs/crate/uuid\" rel=\"noreferrer\">uuid crate</a> (in Diesel 1.3, only version 0.6 is supported by Diesel). In the code from the question, the <code>Uuid</code> is expanded to a <code>diesel::sql_types::Uuid</code> </p>\n\n<pre><code>#[derive(Queryable)]\npub struct User {\n    pub id: uuid::Uuid,\n    pub name: String,\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 81, "user_id": 10736715, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/opeK9.jpg?s=128&g=1", "display_name": "danitrod", "link": "https://stackoverflow.com/users/10736715/danitrod"}, "is_accepted": false, "score": 4, "last_activity_date": 1613270226, "creation_date": 1613270226, "answer_id": 66191941, "question_id": 53326887, "link": "https://stackoverflow.com/questions/53326887/rust-diesel-how-to-query-and-insert-into-postgres-tables-which-have-uuid/66191941#66191941", "title": "Rust/Diesel: How to query and insert into postgres tables which have uuid", "body": "<p>Just spent a lot of time with this problem as well. It looks like as of Diesel 1.4.5, you can add the latest version of <code>uuid</code>, but you have to specify the <code>uuidv07</code> feature on Diesel.</p>\n<p>Your <code>Cargo.toml</code> should look something like this:</p>\n<pre><code>uuid = { version = &quot;0.8.2&quot;, features = [&quot;serde&quot;, &quot;v4&quot;] }\ndiesel = { version = &quot;1.4.5&quot;, features = [&quot;chrono&quot;, &quot;postgres&quot;, &quot;r2d2&quot;, &quot;uuidv07&quot;] }\n</code></pre>\n<p>Source: <a href=\"https://github.com/diesel-rs/diesel/issues/2348\" rel=\"nofollow noreferrer\">https://github.com/diesel-rs/diesel/issues/2348</a></p>\n<p>Note: Also, like @canab said, the <code>Uuid</code> type on the struct should be from the <code>uuid</code> library, not the Diesel SQL type.</p>\n"}], "owner": {"reputation": 241, "user_id": 3912090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdf615e98f4f29a21263f48f4e7257da?s=128&d=identicon&r=PG&f=1", "display_name": "user3912090", "link": "https://stackoverflow.com/users/3912090/user3912090"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4027, "favorite_count": 1, "answer_count": 2, "score": 11, "last_activity_date": 1613270226, "creation_date": 1542311168, "last_edit_date": 1547955839, "question_id": 53326887, "link": "https://stackoverflow.com/questions/53326887/rust-diesel-how-to-query-and-insert-into-postgres-tables-which-have-uuid", "title": "Rust/Diesel: How to query and insert into postgres tables which have uuid", "body": "<p>I have the following schema generated by Diesel:</p>\n\n<pre><code>table! {\nuser (id) {\n    id -&gt; Uuid,\n    name -&gt; Text\n}\n</code></pre>\n\n<p>and the associated model</p>\n\n<pre><code>use diesel::{\n    self,\n    Queryable,\n    Insertable,\n};\nuse diesel::prelude::*;\nuse diesel::sql_types::Uuid;\nuse super::schema::user;\n\n#[derive(Queryable)]\npub struct User {\n    pub id: Uuid,\n    pub name: String,\n}\n\nimpl User {\n\n    pub fn get(id: i32, connection: &amp;PgConnection) -&gt; Vec&lt;User&gt; {\n        user::table.load::&lt;User&gt;(connection).unwrap()\n    }\n}\n</code></pre>\n\n<p>I get an error when I try to compile this which says:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>21 |         user::table.load::&lt;User&gt;(connection).unwrap()                                                                                                                              \n   |                         ^^^^ the trait `diesel::Queryable&lt;diesel::sql_types::Uuid, diesel::pg::Pg&gt;` is not implemented for `diesel::sql_types::Uuid` \n</code></pre>\n\n<p>If I try to insert I get a similar error saying that <code>Expression</code> is not implemented.</p>\n\n<p>Could this be a problem with my dependencies or something I may have forgotten to add to the model?</p>\n\n<pre><code>[dependencies]\nrocket = \"0.4.0-rc.1\"\nserde = \"1.0\"\nserde_derive = \"1.0\"\nserde_json = \"1.0\"\ndiesel = { version = \"1.0.0\", features = [\"postgres\", \"uuid\"] }\nr2d2 = \"*\"\nr2d2-diesel = \"*\"\n\n[dependencies.rocket_contrib]\nversion = \"0.4.0-rc.1\"\ndefault-features = false\nfeatures = [\"json\", \"diesel_postgres_pool\", \"uuid\"]\n</code></pre>\n"}, {"tags": ["utf-8", "rust"], "comments": [{"owner": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 4, "creation_date": 1542305768, "post_id": 53325547, "comment_id": 93531704, "body": "Well, that byte string isn&#39;t UTF-8."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 2, "creation_date": 1542308316, "post_id": 53325547, "comment_id": 93532847, "body": "One thing to try first when getting an error is to search the web for information. Your error is a <code>FromUtf8Error</code>, so I suggest you google that and click the first hit. In general, you may want to add more context to the search terms, e.g. &quot;Rust&quot;, but in this case <a href=\"https://www.google.com/search?q=FromUtf8Error\" rel=\"nofollow noreferrer\">just &quot;FromUtf8Error&quot; does the trick</a>. The documentation of the error should be self-explanatory. As a solution, I suggest you work with byte vectors instead of strings, or simply discard everything with character values above 127."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1542308524, "post_id": 53325547, "comment_id": 93532935, "body": "Looking at the data, the easiest solution seems to be to change <code>for i in 0..256</code> to <code>for i in 0..128</code>."}], "answers": [{"comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1542311552, "post_id": 53326393, "comment_id": 93534316, "body": "It doesn&#39;t really make sense to interpret the essentially random strings as UTF-8 data, since they just are not. The input data is all 7-bit ASCII, and it is a reasonable assumption that the output data is also 7-bit ASCII, so if you restrict the range of keys to seven bits, the result is guaranteed to be valid 7-bit ASCII (which implies valid UTF-8)."}], "tags": [], "owner": {"reputation": 73, "user_id": 6184106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c27da4d6722464209264f99044d51fad?s=128&d=identicon&r=PG&f=1", "display_name": "jupper", "link": "https://stackoverflow.com/users/6184106/jupper"}, "is_accepted": false, "score": 0, "last_activity_date": 1542308946, "creation_date": 1542308946, "answer_id": 53326393, "question_id": 53325547, "link": "https://stackoverflow.com/questions/53325547/rust-utf-8-error-thread-main-panicked-at-called-resultunwrap/53326393#53326393", "title": "Rust UTF-8 error, thread &#39;main&#39; panicked at &#39;called `Result::unwrap()", "body": "<p>I solved it by changing this</p>\n\n<pre><code>for s in vec_bin {\n    let mut vec_utf8: Vec&lt;u8&gt; = Vec::new();\n    for i in 0..(s.len()/8) {\n        vec_utf8.push(bits_to_int(s[(i*8)..((i*8)+8)].to_string()));\n    }\n    vec_plain.push(String::from_utf8(vec_utf8).unwrap());\n}\n</code></pre>\n\n<p>to this</p>\n\n<pre><code>for s in vec_bin {\n    let mut vec_utf8: Vec&lt;u8&gt; = Vec::new();\n    for i in 0..(s.len()/8) {\n        vec_utf8.push(bits_to_int(s[(i*8)..((i*8)+8)].to_string()));\n    }\n    let mut tmp = String::new();\n    tmp.push_str(&amp;String::from_utf8_lossy(&amp;vec_utf8));\n    vec_plain.push(tmp);\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60850, "user_id": 221955, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0bc09e1bd45610fc85274cd7bb002c56?s=128&d=identicon&r=PG", "display_name": "Michael Anderson", "link": "https://stackoverflow.com/users/221955/michael-anderson"}, "is_accepted": false, "score": 0, "last_activity_date": 1542331089, "creation_date": 1542331089, "answer_id": 53330119, "question_id": 53325547, "link": "https://stackoverflow.com/questions/53325547/rust-utf-8-error-thread-main-panicked-at-called-resultunwrap/53330119#53330119", "title": "Rust UTF-8 error, thread &#39;main&#39; panicked at &#39;called `Result::unwrap()", "body": "<p>You should be checking if the string you've got is a valid UTF-8 string. <code>String::from_utf8</code> will check this for you and returns either <code>Ok(s)</code> or <code>Err(_)</code>. \nYou should then match on the return value and either print the decoded string, or report a failure. Something like this does the trick.</p>\n\n<pre><code>use std::io;    \n\nfn main() {\n    let mut hex_string = \"1b37373331363f78151b7f2b783431333d78397828372d363c78373e783a393b3736\";\n    let raw:Vec&lt;u8&gt; = hex_string_to_raw(hex_string);\n    for i in 0..255 {\n        // Get XOR'd version\n        let mut vec_utf8:Vec&lt;u8&gt; = raw.iter().map(|v| v ^ i ).collect();\n        // Try to decode it\n        let s = String::from_utf8(vec_utf8);\n        match s {\n            Err(_) =&gt; { println!(\"Failed to decode using {}\", i); }\n            Ok(s) =&gt; { println!(\"Decoded with {} to '{}'\", i, s); }\n        }\n    }\n}\n\nfn hex_string_to_raw(hex: &amp;str) -&gt; Vec&lt;u8&gt; {\n    let chars:Vec&lt;char&gt; = hex.chars().collect();\n    let mut raw:Vec&lt;u8&gt; = vec![];\n    for cs in chars.chunks(2) {\n        let c0:char = cs[0];\n        let c1:char = cs[1];\n        raw.push( (c0.to_digit(16).unwrap()*16 + c1.to_digit(16).unwrap()) as u8);\n    }\n    raw\n}\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 6184106, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c27da4d6722464209264f99044d51fad?s=128&d=identicon&r=PG&f=1", "display_name": "jupper", "link": "https://stackoverflow.com/users/6184106/jupper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1360, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1542333262, "creation_date": 1542305499, "last_edit_date": 1542333262, "question_id": 53325547, "link": "https://stackoverflow.com/questions/53325547/rust-utf-8-error-thread-main-panicked-at-called-resultunwrap", "title": "Rust UTF-8 error, thread &#39;main&#39; panicked at &#39;called `Result::unwrap()", "body": "<p>I'm working on <a href=\"https://cryptopals.com/sets/1/challenges/3\" rel=\"nofollow noreferrer\">cryptopals challenge set 1 challenge 3</a>:</p>\n\n<blockquote>\n  <p>The hex encoded string:</p>\n  \n  <pre class=\"lang-none prettyprint-override\"><code>1b37373331363f78151b7f2b783431333d78397828372d363c78373e783a393b3736\n</code></pre>\n  \n  <p>... has been XOR'd against a single character. Find the key, decrypt the message.</p>\n  \n  <p>You can do this by hand. But don't: write code to do it for you.</p>\n  \n  <p>How? Devise some method for \"scoring\" a piece of English plaintext. Character frequency is a good metric. Evaluate each output and choose the one with the best score. </p>\n</blockquote>\n\n<p>I've programmed this:</p>\n\n<pre><code>extern crate num_traits;\n\nuse num_traits::pow;\nuse std::io;\n\nfn main() {\n    let mut hex_string = String::new();\n    let mut bin_string = String::new();\n    let mut vec_bin: Vec&lt;String&gt; = Vec::new();\n    let mut vec_plain: Vec&lt;String&gt; = Vec::new();\n    println!(\"Please enter the string: \");\n    io::stdin()\n        .read_line(&amp;mut hex_string)\n        .expect(\"Failed to read line\");\n    bin_string = string_to_hex(hex_string.trim());\n    for i in 0..256 {\n        let mut tmp = bin_string.clone();\n        vec_bin.push(xor(tmp, i));\n    }\n    for s in vec_bin {\n        let mut vec_utf8: Vec&lt;u8&gt; = Vec::new();\n        for i in 0..(s.len() / 8) {\n            vec_utf8.push(bits_to_int(s[(i * 8)..((i * 8) + 8)].to_string()));\n        }\n        vec_plain.push(String::from_utf8(vec_utf8).unwrap());\n    }\n    for s in vec_plain {\n        println!(\"{}\", s);\n    }\n}\n\nfn string_to_hex(text: &amp;str) -&gt; String {\n    let mut hex_string = String::new();\n    for c in text.chars() {\n        hex_string.push_str(&amp;hex_to_bits(c));\n    }\n    hex_string\n}\n\nfn hex_to_bits(c: char) -&gt; String {\n    let mut result = String::new();\n    let x = c.to_digit(16).unwrap();\n    let mut tmp = x;\n    while tmp != 0 {\n        result = (tmp % 2).to_string() + &amp;result;\n        tmp = tmp / 2;\n    }\n    while result.len() &lt; 4 {\n        result = \"0\".to_string() + &amp;result;\n    }\n    result\n}\n\nfn xor(s: String, u: u16) -&gt; String {\n    let mut result = String::new();\n    let bin = dec_to_bin(u);\n    for i in 0..(s.len() / 8) {\n        let mut tmp = bin.clone();\n        result = result + &amp;single_byte_xor(s[(i * 8)..((i * 8) + 8)].to_string(), tmp);\n    }\n    result\n}\n\nfn dec_to_bin(u: u16) -&gt; String {\n    let mut result = String::new();\n    let mut tmp = u;\n    while tmp != 0 {\n        result = (tmp % 2).to_string() + &amp;result;\n        tmp = tmp / 2;\n    }\n    while result.len() &lt; 8 {\n        result = \"0\".to_string() + &amp;result;\n    }\n    result\n}\n\nfn single_byte_xor(s: String, u: String) -&gt; String {\n    let mut result = String::new();\n    for i in 0..s.len() {\n        if &amp;s[i..(i + 1)] == \"1\" &amp;&amp; &amp;u[i..(i + 1)] == \"1\" {\n            result = result + &amp;\"0\".to_string();\n        } else if &amp;s[i..(i + 1)] == \"1\" || &amp;u[i..(i + 1)] == \"1\" {\n            result = result + &amp;\"1\".to_string();\n        } else {\n            result = result + &amp;\"0\".to_string();\n        }\n    }\n    result\n}\n\nfn bits_to_int(s: String) -&gt; u8 {\n    let mut result: u8 = 0;\n    let mut counter = 0;\n    for c in s.chars().rev() {\n        let x = c.to_digit(10).unwrap();\n        if x == 1 {\n            result += pow(2u8, counter);\n        }\n        counter += 1;\n    }\n    result\n}\n</code></pre>\n\n<p>When I run the program, I get this error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Please enter the string: \n\n1b37373331363f78151b7f2b783431333d78397828372d363c78373e783a393b3736\nthread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: FromUtf8Error { bytes: [155, 183, 183, 179, 177, 182, 191, 248, 149, 155, 255, 171, 248, 180, 177, 179, 189, 248, 185, 248, 168, 183, 173, 182, 188, 248, 183, 190, 248, 186, 185, 187, 183, 182], error: Utf8Error { valid_up_to: 0, error_len: Some(1) } }', /checkout/src/libcore/result.rs:916:5\nstack backtrace:\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\n         at /checkout/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\n   1: std::sys_common::backtrace::print\n         at /checkout/src/libstd/sys_common/backtrace.rs:68\n         at /checkout/src/libstd/sys_common/backtrace.rs:57\n   2: std::panicking::default_hook::{{closure}}\n         at /checkout/src/libstd/panicking.rs:381\n   3: std::panicking::default_hook\n         at /checkout/src/libstd/panicking.rs:397\n   4: std::panicking::rust_panic_with_hook\n         at /checkout/src/libstd/panicking.rs:577\n   5: std::panicking::begin_panic\n         at /checkout/src/libstd/panicking.rs:538\n   6: std::panicking::begin_panic_fmt\n         at /checkout/src/libstd/panicking.rs:522\n   7: rust_begin_unwind\n         at /checkout/src/libstd/panicking.rs:498\n   8: core::panicking::panic_fmt\n         at /checkout/src/libcore/panicking.rs:71\n   9: core::result::unwrap_failed\n         at /checkout/src/libcore/macros.rs:23\n  10: &lt;core::result::Result&lt;T, E&gt;&gt;::unwrap\n         at /checkout/src/libcore/result.rs:782\n  11: nr3::main\n         at src/main.rs:24\n  12: std::rt::lang_start::{{closure}}\n         at /checkout/src/libstd/rt.rs:74\n  13: std::panicking::try::do_call\n         at /checkout/src/libstd/rt.rs:59\n         at /checkout/src/libstd/panicking.rs:480\n  14: __rust_maybe_catch_panic\n         at /checkout/src/libpanic_unwind/lib.rs:101\n  15: std::rt::lang_start_internal\n         at /checkout/src/libstd/panicking.rs:459\n         at /checkout/src/libstd/panic.rs:365\n         at /checkout/src/libstd/rt.rs:58\n  16: std::rt::lang_start\n         at /checkout/src/libstd/rt.rs:74\n  17: main\n  18: __libc_start_main\n  19: _start\n</code></pre>\n\n<p>I can not figure out what the problem is.</p>\n"}, {"tags": ["c++", "rust"], "comments": [{"owner": {"reputation": 12066, "user_id": 3924118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/abb01e1c2a8e3d9e1534dca14b19b3d8?s=128&d=identicon&r=PG&f=1", "display_name": "nbro", "link": "https://stackoverflow.com/users/3924118/nbro"}, "edited": false, "score": 1, "creation_date": 1542301228, "post_id": 53324276, "comment_id": 93529327, "body": "Rust is not a class-based language, but a trait-based language. Drop is a trait that can be implemented or not. In C++, every class has a destructor, either if you want/need it or not."}, {"owner": {"reputation": 205, "user_id": 7816353, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-S3tHJJ35of8/AAAAAAAAAAI/AAAAAAAAAm0/us_9hLFEMvc/photo.jpg?sz=128", "display_name": "ayush prashar", "link": "https://stackoverflow.com/users/7816353/ayush-prashar"}, "reply_to_user": {"reputation": 12066, "user_id": 3924118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/abb01e1c2a8e3d9e1534dca14b19b3d8?s=128&d=identicon&r=PG&f=1", "display_name": "nbro", "link": "https://stackoverflow.com/users/3924118/nbro"}, "edited": false, "score": 0, "creation_date": 1542301501, "post_id": 53324276, "comment_id": 93529491, "body": "@nbro If we don&#39;t implement the Drop trait, wouldn&#39;t the compiler do it on its own to get a default version of drop method to free up the memory? Because without that, the system would not be able to free up the memory."}, {"owner": {"reputation": 12066, "user_id": 3924118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/abb01e1c2a8e3d9e1534dca14b19b3d8?s=128&d=identicon&r=PG&f=1", "display_name": "nbro", "link": "https://stackoverflow.com/users/3924118/nbro"}, "edited": false, "score": 0, "creation_date": 1542301925, "post_id": 53324276, "comment_id": 93529718, "body": "In safe Rust, you cannot have memory leaks. Rust uses lifetimes to handle the life of &quot;objects&quot;. I don&#39;t think there&#39;s a &quot;default&quot; implementation of the Drop trait for each struct. Rust simply knows the lifetimes of objects and knows when they need to be cleaned up.  See the discussion here: <a href=\"https://www.reddit.com/r/rust/comments/6cognt/do_i_have_to_manually_implement_drop/\" rel=\"nofollow noreferrer\">reddit.com/r/rust/comments/6cognt/&hellip;</a>."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 12066, "user_id": 3924118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/abb01e1c2a8e3d9e1534dca14b19b3d8?s=128&d=identicon&r=PG&f=1", "display_name": "nbro", "link": "https://stackoverflow.com/users/3924118/nbro"}, "edited": false, "score": 0, "creation_date": 1542302058, "post_id": 53324276, "comment_id": 93529793, "body": "@nbro Well, you can have memory leaks in safe Rust, but it mostly have to be intentional, unless you mess with weak shared references."}, {"owner": {"reputation": 12066, "user_id": 3924118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/abb01e1c2a8e3d9e1534dca14b19b3d8?s=128&d=identicon&r=PG&f=1", "display_name": "nbro", "link": "https://stackoverflow.com/users/3924118/nbro"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1542302224, "post_id": 53324276, "comment_id": 93529873, "body": "@Boiethios Ha, ok. We also have this discussion related to this topic: <a href=\"https://users.rust-lang.org/t/memory-leaks-are-memory-safe/5288/3\" rel=\"nofollow noreferrer\">users.rust-lang.org/t/memory-leaks-are-memory-safe/5288/3</a>."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 12066, "user_id": 3924118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/abb01e1c2a8e3d9e1534dca14b19b3d8?s=128&d=identicon&r=PG&f=1", "display_name": "nbro", "link": "https://stackoverflow.com/users/3924118/nbro"}, "edited": false, "score": 1, "creation_date": 1542302417, "post_id": 53324276, "comment_id": 93529990, "body": "@nbro The <a href=\"https://doc.rust-lang.org/std/mem/fn.forget.html\" rel=\"nofollow noreferrer\"><code>mem::forget</code></a> function is safe Rust, but you cannot call it unintentionally"}, {"owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "edited": false, "score": 4, "creation_date": 1542302717, "post_id": 53324276, "comment_id": 93530156, "body": "I won&#39;t say there&#39;s no difference, but the differences are probably trivial. <a href=\"https://doc.rust-lang.org/stable/std/ops/trait.Drop.html\" rel=\"nofollow noreferrer\">The documentation for Drop</a> even calls it a destructor. Do you have a more specific question?"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "edited": false, "score": 0, "creation_date": 1542302784, "post_id": 53324276, "comment_id": 93530195, "body": "@BenjaminLindley Yes, even thinking hard, I don&#39;t see real differences."}, {"owner": {"reputation": 12066, "user_id": 3924118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/abb01e1c2a8e3d9e1534dca14b19b3d8?s=128&d=identicon&r=PG&f=1", "display_name": "nbro", "link": "https://stackoverflow.com/users/3924118/nbro"}, "edited": false, "score": 1, "creation_date": 1542302896, "post_id": 53324276, "comment_id": 93530249, "body": "Well, the differences I mentinoed above are still significant, but this is due to the different design of the languages."}, {"owner": {"reputation": 205, "user_id": 7816353, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-S3tHJJ35of8/AAAAAAAAAAI/AAAAAAAAAm0/us_9hLFEMvc/photo.jpg?sz=128", "display_name": "ayush prashar", "link": "https://stackoverflow.com/users/7816353/ayush-prashar"}, "reply_to_user": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "edited": false, "score": 0, "creation_date": 1542303127, "post_id": 53324276, "comment_id": 93530369, "body": "@BenjaminLindley No. This was the exact precise query. I was just trying to draw a parallel, which in this case is kind of an overlap."}, {"owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "reply_to_user": {"reputation": 12066, "user_id": 3924118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/abb01e1c2a8e3d9e1534dca14b19b3d8?s=128&d=identicon&r=PG&f=1", "display_name": "nbro", "link": "https://stackoverflow.com/users/3924118/nbro"}, "edited": false, "score": 0, "creation_date": 1542303253, "post_id": 53324276, "comment_id": 93530428, "body": "@nbro: I don&#39;t think they really are significant. Just like with drop, you don&#39;t have to manually implement a C++ destructor. And just like with drop, the destructors of member objects will still be called, even if you don&#39;t. And just like with drop, the &quot;destructors&quot; of trivial objects will do nothing and result in no code being generated."}, {"owner": {"reputation": 138, "user_id": 1144858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3cba17cd5c6e976d2a58ff135587aec?s=128&d=identicon&r=PG", "display_name": "David Brown", "link": "https://stackoverflow.com/users/1144858/david-brown"}, "edited": false, "score": 0, "creation_date": 1542303303, "post_id": 53324276, "comment_id": 93530453, "body": "The only real difference that I can think of is that C++ has rules about destructors involving inheritance. Since Rust has no inheritance, these rules don&#39;t really apply to Rust."}], "answers": [{"comments": [{"owner": {"reputation": 205, "user_id": 7816353, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-S3tHJJ35of8/AAAAAAAAAAI/AAAAAAAAAm0/us_9hLFEMvc/photo.jpg?sz=128", "display_name": "ayush prashar", "link": "https://stackoverflow.com/users/7816353/ayush-prashar"}, "edited": false, "score": 0, "creation_date": 1542303395, "post_id": 53325001, "comment_id": 93530501, "body": "Is drop( ) actually used to clean up the resources? Resources will be cleaned up irrespective of implementation of the Drop trait, won&#39;t they?"}, {"owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "reply_to_user": {"reputation": 205, "user_id": 7816353, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-S3tHJJ35of8/AAAAAAAAAAI/AAAAAAAAAm0/us_9hLFEMvc/photo.jpg?sz=128", "display_name": "ayush prashar", "link": "https://stackoverflow.com/users/7816353/ayush-prashar"}, "edited": false, "score": 2, "creation_date": 1542303813, "post_id": 53325001, "comment_id": 93530714, "body": "@ayushprashar: If you make a system call to allocate a resource, for example, to allocate memory, no, that will not be cleaned up for you. The rust compiler wouldn&#39;t even know how to clean that up, and it would be presumptuous for it to assume that you wanted it cleaned up and how."}, {"owner": {"reputation": 205, "user_id": 7816353, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-S3tHJJ35of8/AAAAAAAAAAI/AAAAAAAAAm0/us_9hLFEMvc/photo.jpg?sz=128", "display_name": "ayush prashar", "link": "https://stackoverflow.com/users/7816353/ayush-prashar"}, "reply_to_user": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "edited": false, "score": 0, "creation_date": 1542304305, "post_id": 53325001, "comment_id": 93530970, "body": "@BenjaminLindley I wasn&#39;t intending to convey a system call but a general object declaration within the governing laws of Rust."}, {"owner": {"reputation": 205, "user_id": 7816353, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-S3tHJJ35of8/AAAAAAAAAAI/AAAAAAAAAm0/us_9hLFEMvc/photo.jpg?sz=128", "display_name": "ayush prashar", "link": "https://stackoverflow.com/users/7816353/ayush-prashar"}, "edited": false, "score": 0, "creation_date": 1542305060, "post_id": 53325001, "comment_id": 93531371, "body": "But nowhere in the drop method do we tell the Runtime to return the memory back to the OS, does that automatically happen when ever <b>drop( )</b> runs?"}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "reply_to_user": {"reputation": 205, "user_id": 7816353, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-S3tHJJ35of8/AAAAAAAAAAI/AAAAAAAAAm0/us_9hLFEMvc/photo.jpg?sz=128", "display_name": "ayush prashar", "link": "https://stackoverflow.com/users/7816353/ayush-prashar"}, "edited": false, "score": 1, "creation_date": 1542305868, "post_id": 53325001, "comment_id": 93531751, "body": "@ayushprashar: By default, calling <code>Drop</code> on a pointer does... <b>nothing</b>. This is why for classes such as <code>Vec</code>, which allocates memory and owns it, a manual <code>Drop</code> implementation exists which releases the memory."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 205, "user_id": 7816353, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-S3tHJJ35of8/AAAAAAAAAAI/AAAAAAAAAm0/us_9hLFEMvc/photo.jpg?sz=128", "display_name": "ayush prashar", "link": "https://stackoverflow.com/users/7816353/ayush-prashar"}, "edited": false, "score": 0, "creation_date": 1542313956, "post_id": 53325001, "comment_id": 93535330, "body": "@ayushprashar Local variables are allocated on the stack, and they are automatically deallocated when the stack frame of the current functions is destroyed upon returning from the function. Apart from this the compiler knows about cleaning up memory allocated by <code>Box</code>. All other resources need to be deallocated by explicit implementations of <code>Drop</code>, including the memory allocated by custom allocators."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1542321161, "post_id": 53325001, "comment_id": 93538073, "body": "<i>the compiler knows about cleaning up memory allocated by <code>Box</code></i> \u2014 because <a href=\"https://doc.rust-lang.org/std/boxed/struct.Box.html#impl-Drop\" rel=\"nofollow noreferrer\"><code>Box</code> implements <code>Drop</code></a>"}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 1, "creation_date": 1542355354, "post_id": 53325001, "comment_id": 93546674, "body": "@Shepmaster Here&#39;s the implementation of <code>Drop</code> for <code>Box</code>: <code>&#47;&#47; FIXME: Do nothing, drop is currently performed by compiler.</code> \u263a"}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 4, "last_activity_date": 1542303845, "last_edit_date": 1542303845, "creation_date": 1542303213, "answer_id": 53325001, "question_id": 53324276, "link": "https://stackoverflow.com/questions/53324276/what-is-the-difference-between-rusts-drop-and-cs-destructor/53325001#53325001", "title": "What is the difference between Rust&#39;s Drop and C++&#39;s destructor?", "body": "<p>In practice, there is no appreciable difference. Both are used to clean up the resources of a type when appropriate.</p>\n\n<blockquote>\n  <p>Resources will be cleaned up irrespective of implementation of the <code>Drop</code> trait, won't they?</p>\n</blockquote>\n\n<p>Yes. The compiler <em>essentially</em> automatically implements <code>Drop</code> for any type where the programmer does not. This automatic implementation simply calls <code>drop</code> for each member variable in turn.</p>\n\n<p>If you allocate a resource that Rust doesn't know about, such as allocating memory directly from an allocator, Rust won't know that the returned value needs to be dropped or how to do so. That's when you implement <code>Drop</code> directly. </p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://doc.rust-lang.org/book/second-edition/ch15-03-drop.html\" rel=\"nofollow noreferrer\">Running Code on Cleanup with the <code>Drop</code> Trait</a></li>\n</ul>\n"}], "owner": {"reputation": 205, "user_id": 7816353, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-S3tHJJ35of8/AAAAAAAAAAI/AAAAAAAAAm0/us_9hLFEMvc/photo.jpg?sz=128", "display_name": "ayush prashar", "link": "https://stackoverflow.com/users/7816353/ayush-prashar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 466, "favorite_count": 0, "accepted_answer_id": 53325001, "answer_count": 1, "score": 2, "last_activity_date": 1542303845, "creation_date": 1542300631, "last_edit_date": 1542303082, "question_id": 53324276, "link": "https://stackoverflow.com/questions/53324276/what-is-the-difference-between-rusts-drop-and-cs-destructor", "title": "What is the difference between Rust&#39;s Drop and C++&#39;s destructor?", "body": "<p>While reading about the <a href=\"https://doc.rust-lang.org/std/ops/trait.Drop.html\" rel=\"nofollow noreferrer\"><code>Drop</code></a> trait, I found a lot of similarities between the <code>drop</code> method of Rust and the destructor in a C++. What is the difference between the two?</p>\n"}, {"tags": ["rust", "future", "rust-actix"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1542291908, "post_id": 53321373, "comment_id": 93523230, "body": "It&#39;s not quite clear what you are asking here. Are you looking for <code>nums.into_iter().map(|n| make_request(n)).collect()</code>?"}, {"owner": {"reputation": 11878, "user_id": 588759, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/216ea4da5cae7be4030b6242ab90631c?s=128&d=identicon&r=PG", "display_name": "rofrol", "link": "https://stackoverflow.com/users/588759/rofrol"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1542292476, "post_id": 53321373, "comment_id": 93523618, "body": "@SvenMarnach I have expaned the question."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1542294626, "post_id": 53321373, "comment_id": 93525003, "body": "Don&#39;t understand your problem."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1542294844, "post_id": 53321373, "comment_id": 93525149, "body": "If you want to perform all the requests concurrently, you can use <a href=\"https://docs.rs/futures/0.1.25/futures/future/fn.join_all.html\" rel=\"nofollow noreferrer\"><code>futures::future::join_all()</code></a> to combine the individual request futures into a single future returning a vector of results."}, {"owner": {"reputation": 11878, "user_id": 588759, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/216ea4da5cae7be4030b6242ab90631c?s=128&d=identicon&r=PG", "display_name": "rofrol", "link": "https://stackoverflow.com/users/588759/rofrol"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1542296115, "post_id": 53321373, "comment_id": 93526072, "body": "@SvenMarnach and sequentially? Or concurrently but limit number of simultaneous connections?"}, {"owner": {"reputation": 11878, "user_id": 588759, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/216ea4da5cae7be4030b6242ab90631c?s=128&d=identicon&r=PG", "display_name": "rofrol", "link": "https://stackoverflow.com/users/588759/rofrol"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1542296378, "post_id": 53321373, "comment_id": 93526279, "body": "@Stargateur I have expaned more"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1542303039, "post_id": 53321373, "comment_id": 93530324, "body": "You need <code>iter()</code> or <code>into_iter()</code> to map over a vector. There are further problems with your code, but that&#39;s the one causing the error message."}], "owner": {"reputation": 11878, "user_id": 588759, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/216ea4da5cae7be4030b6242ab90631c?s=128&d=identicon&r=PG", "display_name": "rofrol", "link": "https://stackoverflow.com/users/588759/rofrol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 629, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1542361268, "creation_date": 1542291214, "last_edit_date": 1542361268, "question_id": 53321373, "link": "https://stackoverflow.com/questions/53321373/how-to-map-a-vector-into-actix-web-client-requests-and-run-them-sequentially", "title": "How to map a vector into actix-web client requests and run them sequentially?", "body": "<p>I have a vector and I want to make multiple requests and get vector of values. Something like:</p>\n\n<pre><code>use actix_web::client;\nlet nums = vec![1, 2, 3];\nlet values = nums.map(|num| {\n    client::ClientRequest::get(\"http://example.com\".to_owned() + &amp;num);\n});\n</code></pre>\n\n<p>And I will get <code>[1, 4, 9]</code>.</p>\n\n<p>Said another way:</p>\n\n<pre><code>fn question_data(id: &amp;str) -&gt; Box&lt;Future&lt;Item = Question, Error = actix_web::error::Error&gt;&gt; {\n    let f = std::fs::read_to_string(\"auth_token\").unwrap();\n    let token = f.trim();\n    Box::new(\n        client::ClientRequest::get(\"https://example.com/api/questions/\".to_owned() + id)\n            .header(\n                actix_web::http::header::AUTHORIZATION,\n                \"Bearer \".to_owned() + token,\n            )\n            .finish()\n            .unwrap()\n            .send()\n            .timeout(Duration::from_secs(30))\n            .map_err(actix_web::error::Error::from) // &lt;- convert SendRequestError to an Error\n            .and_then(|resp| {\n                resp.body().limit(67_108_864).from_err().and_then(|body| {\n                    let resp: QuestionResponse = serde_json::from_slice(&amp;body).unwrap();\n                    fut_ok(resp.data)\n                })\n            }),\n    )\n}\n</code></pre>\n\n<p>Then I use it:</p>\n\n<pre><code>let question_ids = vec![\"q1\", \"q2\", \"q3\"];\n\nlet mut questions = questions_data().wait().expect(\"Failed to fetch questions\");\nlet question = question_data(\"q2\")\n    .wait()\n    .expect(\"Failed to fetch question\");\nprintln!(\"{:?}\", question);\n\nlet data = question_ids.map(|id| Box::new(question_data(id)));\n</code></pre>\n\n<p>But I get the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>245 |     let data = question_ids.map(|id| Box::new(question_data(id)));\n    |                             ^^^\n    |\n    = note: the method `map` exists but the following trait bounds were not satisfied:\n            `&amp;mut std::vec::Vec&lt;std::string::String&gt; : futures::Future`\n            `&amp;mut std::vec::Vec&lt;std::string::String&gt; : std::iter::Iterator`\n            `&amp;mut [std::string::String] : futures::Future`\n            `&amp;mut [std::string::String] : std::iter::Iterator`\n</code></pre>\n\n<p>These are similar but does not compile for me, and also I want to use actix-web:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/49087958/getting-multiple-urls-concurrently-with-hyper\">Getting multiple URLs concurrently with Hyper</a></li>\n<li><a href=\"https://stackoverflow.com/questions/51044467/how-can-i-perform-parallel-asynchronous-http-get-requests-with-reqwest\">How can I perform parallel asynchronous HTTP GET requests with reqwest?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/50850309/how-do-i-iterate-over-a-vec-of-functions-returning-futures-in-rust\">How do I iterate over a Vec of functions returning Futures in Rust?</a></li>\n<li><a href=\"https://www.reddit.com/r/rust/comments/7wwhhk/patterns_for_processing_a_stream_of_urls/du4jw0t/\" rel=\"nofollow noreferrer\">https://www.reddit.com/r/rust/comments/7wwhhk/patterns_for_processing_a_stream_of_urls/du4jw0t/</a></li>\n</ul>\n"}, {"tags": ["rust", "future"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1542288886, "post_id": 53320236, "comment_id": 93521247, "body": "Have you consider to consider giving <code>tasks</code> a type ? <code>let tasks : Vec&lt;FutureResult&lt;_, ()&gt;&gt; = vec![fut_ok(1u32), fut_ok(2), fut_ok(3)];</code> or <code>let tasks  = vec![fut_ok::&lt;_, ()&gt;(1), fut_ok(2), fut_ok(3)];</code>"}], "answers": [{"comments": [{"owner": {"reputation": 11878, "user_id": 588759, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/216ea4da5cae7be4030b6242ab90631c?s=128&d=identicon&r=PG", "display_name": "rofrol", "link": "https://stackoverflow.com/users/588759/rofrol"}, "edited": false, "score": 0, "creation_date": 1542289127, "post_id": 53320676, "comment_id": 93521377, "body": "nice. And how to print the result? <code>println!(&quot;{:?}&quot;, futures::future::join_all(tasks).wait()?);</code> the trait <code>std::error::Error</code> is not implemented for <code>()</code>"}], "tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": true, "score": 4, "last_activity_date": 1542288864, "creation_date": 1542288864, "answer_id": 53320676, "question_id": 53320236, "link": "https://stackoverflow.com/questions/53320236/why-do-i-get-the-error-cannot-infer-type-when-using-futuresok/53320676#53320676", "title": "Why do I get the error &quot;cannot infer type&quot; when using futures::ok?", "body": "<p>The problem is that any future may in theory return an error. So the <code>FutureResult</code> type (which is returned from <code>fut_ok</code>) is generic with two type parameters: a type <code>T</code> for success and a type <code>E</code> for errors.</p>\n\n<p>If this was real code instead of a toy example, you would have some error handling code that would allow the compiler to infer type <code>E</code>. In this case you need to specify it, but since you don't use it you can use the empty type <code>()</code>. So either of the following should work:</p>\n\n<pre><code>let tasks: Vec&lt;FutureResult&lt;_, ()&gt;&gt; = vec![fut_ok(1), fut_ok(2), fut_ok(3)];\n</code></pre>\n\n<p>or</p>\n\n<pre><code>let tasks = vec![fut_ok::&lt;_, ()&gt;(1), fut_ok(2), fut_ok(3)];\n</code></pre>\n\n<p>Note that the first is what the compiler means when it says: \"consider giving <code>tasks</code> a type\".</p>\n"}, {"tags": [], "owner": {"reputation": 11878, "user_id": 588759, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/216ea4da5cae7be4030b6242ab90631c?s=128&d=identicon&r=PG", "display_name": "rofrol", "link": "https://stackoverflow.com/users/588759/rofrol"}, "is_accepted": false, "score": 0, "last_activity_date": 1542295258, "creation_date": 1542295258, "answer_id": 53322603, "question_id": 53320236, "link": "https://stackoverflow.com/questions/53320236/why-do-i-get-the-error-cannot-infer-type-when-using-futuresok/53322603#53322603", "title": "Why do I get the error &quot;cannot infer type&quot; when using futures::ok?", "body": "<p>Full example</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate futures; // 0.1.25\nuse futures::future::ok as fut_ok;\nuse futures::future::FutureResult;\nfn main() {\n    let tasks: Vec&lt;FutureResult&lt;_, ()&gt;&gt; = vec![fut_ok(1), fut_ok(2), fut_ok(3)];\n    println!(\n        \"{:?}\",\n        futures::future::join_all(tasks).wait().map_err(|_| \"Error\")\n    );\n}\n</code></pre>\n\n<p>Prints <code>Ok([1, 2, 3])</code></p>\n"}], "owner": {"reputation": 11878, "user_id": 588759, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/216ea4da5cae7be4030b6242ab90631c?s=128&d=identicon&r=PG", "display_name": "rofrol", "link": "https://stackoverflow.com/users/588759/rofrol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2364, "favorite_count": 0, "accepted_answer_id": 53320676, "answer_count": 2, "score": 1, "last_activity_date": 1542333929, "creation_date": 1542287375, "last_edit_date": 1542333929, "question_id": 53320236, "link": "https://stackoverflow.com/questions/53320236/why-do-i-get-the-error-cannot-infer-type-when-using-futuresok", "title": "Why do I get the error &quot;cannot infer type&quot; when using futures::ok?", "body": "<p>I know there is <code>join_all</code> but it cannot infer type:</p>\n\n<pre><code>extern crate futures; // 0.1.25\n\nuse futures::future::ok as fut_ok;\n\nfn main() {\n    let tasks = vec![fut_ok(1), fut_ok(2), fut_ok(3)];\n    println!(\"{:?}\", futures::future::join_all(tasks).wait().unwrap());\n}\n</code></pre>\n\n<p>I got this error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>let tasks = vec![fut_ok(1), fut_ok(2), fut_ok(3)];\n    -----        ^^^^^^ cannot infer type for `E`\n    |\n    consider giving `tasks` a type\n</code></pre>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": true, "score": 6, "last_activity_date": 1542283697, "creation_date": 1542283697, "answer_id": 53319178, "question_id": 53318918, "link": "https://stackoverflow.com/questions/53318918/vecdedup-does-not-work-how-do-i-filter-duplicates-from-vector-of-chars/53319178#53319178", "title": "Vec::dedup does not work \u2014&#160;how do I filter duplicates from vector of chars?", "body": "<p>Quoting the documentation for <a href=\"https://doc.rust-lang.org/std/vec/struct.Vec.html#method.dedup\" rel=\"noreferrer\"><code>Vec::dedup</code></a></p>\n\n<blockquote>\n  <p>Removes <strong>consecutive</strong> repeated elements in the vector.<br>\n  If the vector is sorted, this removes all duplicates.</p>\n</blockquote>\n\n<p>You have to sort the vector first, then dedup it.</p>\n\n<pre><code>fn main() {\n    let mut a = \"abccdddd\".chars().collect::&lt;Vec&lt;char&gt;&gt;();\n    let mut b = \"addddefacd\".chars().collect::&lt;Vec&lt;char&gt;&gt;();\n    a.append(&amp;mut b);\n    a.sort();\n    a.dedup();\n    println!(\"{:?}\", a)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 4, "creation_date": 1542286276, "post_id": 53319757, "comment_id": 93519748, "body": "This solution retains the order of the original vector, which is sometimes a desirable property. If you don&#39;t care about the order, I&#39;d recommend using a <code>HashSet</code> instead of a <code>Vec</code> from the outset."}], "tags": [], "owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "is_accepted": false, "score": 9, "last_activity_date": 1542285803, "creation_date": 1542285803, "answer_id": 53319757, "question_id": 53318918, "link": "https://stackoverflow.com/questions/53318918/vecdedup-does-not-work-how-do-i-filter-duplicates-from-vector-of-chars/53319757#53319757", "title": "Vec::dedup does not work \u2014&#160;how do I filter duplicates from vector of chars?", "body": "<p>In addition to the answer by hellow it is also possible to deduplicate a vector without sorting it by using a <code>HashSet</code>:</p>\n\n<pre><code>use std::collections::HashSet;\n\nfn main() {\n    let mut a = \"zabccdddd\".chars().collect::&lt;Vec&lt;char&gt;&gt;();\n    let mut b = \"dadddefacdz\".chars().collect::&lt;Vec&lt;char&gt;&gt;();\n    a.append(&amp;mut b);\n\n    let mut uniques = HashSet::new();\n    a.retain(|e| uniques.insert(e.clone()));\n\n    println!(\"{:?}\", a) // ['z', 'a', 'b', 'c', 'd', 'e', 'f']\n}\n</code></pre>\n\n<p><a href=\"https://doc.rust-lang.org/std/vec/struct.Vec.html#method.retain\" rel=\"noreferrer\"><code>Vec::retain</code></a> preserves the elements fulfilling the predicate and <a href=\"https://doc.rust-lang.org/std/collections/struct.HashSet.html#method.insert\" rel=\"noreferrer\"><code>HashSet::insert</code></a> returns <code>true</code> if the inserted element is not present in the set. Since a <code>HashSet</code> can only have unique members, this makes the vector only keep the first occurences of its repeated elements.</p>\n"}], "owner": {"reputation": 21, "user_id": 1891107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a7c13e09008909374a4618d72e2329c?s=128&d=identicon&r=PG", "display_name": "Alexander Korotkikh", "link": "https://stackoverflow.com/users/1891107/alexander-korotkikh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1227, "favorite_count": 0, "closed_date": 1542333429, "accepted_answer_id": 53319178, "answer_count": 2, "score": 1, "last_activity_date": 1542333525, "creation_date": 1542282786, "last_edit_date": 1542333525, "question_id": 53318918, "link": "https://stackoverflow.com/questions/53318918/vecdedup-does-not-work-how-do-i-filter-duplicates-from-vector-of-chars", "closed_reason": "Duplicate", "title": "Vec::dedup does not work \u2014&#160;how do I filter duplicates from vector of chars?", "body": "<p>I need to filter out duplicates from a <code>Vec&lt;char&gt;</code> which is the result of merging two <code>vectors</code>. I'm using the <code>dedup</code> method, however it only removes duplicates from the origin parts and neighborhood elements.\nE.g:</p>\n\n<pre><code>fn main() {\n    let mut a = \"abccdddd\".chars().collect::&lt;Vec&lt;char&gt;&gt;();\n    let mut b = \"dadddefacd\".chars().collect::&lt;Vec&lt;char&gt;&gt;();\n    a.append(&amp;mut b);\n    a.dedup();\n    println!(\"{:?}\", a)\n}\n</code></pre>\n\n<p>Expected: <code>['a', 'b', 'c', 'd', 'e', 'f']</code><br>\nGot: <code>['a', 'b', 'c', 'd', 'a', 'd', 'e', 'f', 'a', 'c', 'd']</code></p>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=cc06d9fd15e48de591f5827263ad9388\" rel=\"nofollow noreferrer\">playground</a>)</p>\n\n<p>How can I delete the duplicates from the merged vector?</p>\n"}, {"tags": ["rust", "serde"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1542275302, "post_id": 53314981, "comment_id": 93513320, "body": "Welcome to Stack Overflow! Consider reading <a href=\"https://stackoverflow.com/q/50021897/1233251\">this question</a>, I feel it&#39;s close to what you are looking for. However, dealing with serialization/deserialization for <code>Any</code> can become <a href=\"https://stackoverflow.com/q/44231020/1233251\">particularly tricky</a>."}, {"owner": {"reputation": 53, "user_id": 3124233, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L5rWH.png?s=128&g=1", "display_name": "RustGear", "link": "https://stackoverflow.com/users/3124233/rustgear"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1542278995, "post_id": 53314981, "comment_id": 93515485, "body": "yeah it&#39;s close I&#39;ve already read it before asking the question but actually gives no idea about what we did for the solution, thanks by the way."}], "answers": [{"tags": [], "owner": {"reputation": 343, "user_id": 2590316, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GPdJe.jpg?s=128&g=1", "display_name": "Alican Beydemir", "link": "https://stackoverflow.com/users/2590316/alican-beydemir"}, "is_accepted": true, "score": 1, "last_activity_date": 1542373355, "creation_date": 1542373355, "answer_id": 53338464, "question_id": 53314981, "link": "https://stackoverflow.com/questions/53314981/how-do-i-implement-sized-serialize-deserialize-functions-on-any-and-send-traits/53338464#53338464", "title": "How do I implement Sized, Serialize/Deserialize functions on Any and Send Traits?", "body": "<p>You can use this solution as a work around but it should work it out for you i guess.</p>\n\n<p>You have to access the <code>data: Arc&lt;Mutex&lt;Any + Send&gt;&gt;</code> then serialize/deserialze data and id separately.</p>\n\n<pre><code>#[macro_use]\nextern crate serde_derive;\nextern crate serde;\nextern crate serde_json;\n\nuse serde::Serialize;\nuse std::sync::Mutex;\nuse std::sync::Arc;\nuse std::any::Any;\n\n#[derive(Debug, Clone)]\npub struct Message {\n    pub id: u64,\n    pub data: Arc&lt;Mutex&lt;Any + Send&gt;&gt;,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct Data {\n    pub name: String,\n}\n\nimpl Data {\n    fn new(name_parameter: String) -&gt; Data {\n        let data = Data {\n            name: name_parameter,\n        };\n        data\n    }\n}\n\nfn main() {\n    let msg: Message = Message { id: 23, data: (Arc::new(Mutex::new(Data::new(String::from(\"TesData\"))))) };\n    let _id = msg.id;\n    let guard = msg.data.lock().unwrap();\n    let msg_data: Option&lt;&amp;Data&gt; = guard.downcast_ref::&lt;Data&gt;();\n    let ser_msg_data = serde_json::to_string(&amp;msg_data).unwrap();\n    let des_msg_data: Data = serde_json::from_str(&amp;ser_msg_data).unwrap();\n    println!(\"{:?}\", des_msg_data);\n    let des_msg:Message = Message {id : _id, data: Arc::new(Mutex::new(des_msg_data))};\n    println!(\"{:?}\", msg);\n    println!(\"{:?}\", ser_msg_data);\n    println!(\"{:?}\", des_msg);\n\n}\n</code></pre>\n\n<p>Here is the playground.\n<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=3356ce3530246b00e99b4d53e8db60bd\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 53, "user_id": 3124233, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L5rWH.png?s=128&g=1", "display_name": "RustGear", "link": "https://stackoverflow.com/users/3124233/rustgear"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 872, "favorite_count": 4, "accepted_answer_id": 53338464, "answer_count": 1, "score": 5, "last_activity_date": 1542373355, "creation_date": 1542269657, "last_edit_date": 1542277688, "question_id": 53314981, "link": "https://stackoverflow.com/questions/53314981/how-do-i-implement-sized-serialize-deserialize-functions-on-any-and-send-traits", "title": "How do I implement Sized, Serialize/Deserialize functions on Any and Send Traits?", "body": "<p>I got an issue while implement serializing/deserializing and sizing functionalities on a struct that have complex data types like <code>Arc</code> pointers <code>Mutex</code> locks. First I've resolved these <code>Arc</code> and <code>Mutex</code> serialization/deserialization problem using this topic:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/49312600/how-do-i-serialize-or-deserialize-an-arct-in-serde\">How do I serialize or deserialize an Arc&lt;T&gt; in Serde?</a></p>\n\n<p>but now, I got stuck on implementing <code>ser</code>/<code>desr</code> and sizing for <code>Any</code> and <code>Send</code> traits, and I have neither an idea nor a compiling example to solve this issue. </p>\n\n<p>Code is here:</p>\n\n<pre><code>#[macro_use]\nextern crate serde_derive;\nextern crate serde;\nextern crate serde_json;\n\nuse serde::Serialize;\nuse std::sync::Mutex;\nuse std::sync::Arc;\nuse std::any::Any;\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct Message {\n    pub id: u64,\n    pub data: Arc&lt;Mutex&lt;Any + Send&gt;&gt;,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct Data {\n    pub name: String,\n}\n\nimpl Data {\n    fn new(name_parameter: String) -&gt; Data {\n        let data = Data {\n            name: name_parameter,\n        };\n        data\n    }\n}\n\nfn main() {\n    let msg: Message = Message { id: 23, data: (Arc::new(Mutex::new(Data::new(String::from(\"TesData\"))))) };\n    let ser_msg = serde_json::to_string(&amp;msg).unwrap();\n    let des_msg: Message = serde_json::from_str(&amp;ser_msg).unwrap();\n\n    println!(\"{:?}\", msg);\n    println!(\"{:?}\", ser_msg);\n    println!(\"{:?}\", des_msg);\n}\n</code></pre>\n\n<p>Here is the code in the <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=d72b6d31096a25deabd6536a0ce21873\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>It gives the following errors:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the size for values of type `(dyn std::any::Any + std::marker::Send + 'static)` cannot be known at compilation time\n  --&gt; src/main.rs:15:5\n   |\n15 |     pub data: Arc&lt;Mutex&lt;Any + Send&gt;&gt;,\n   |     ^^^ doesn't have a size known at compile-time\n   |\n   = help: the trait `std::marker::Sized` is not implemented for `(dyn std::any::Any + std::marker::Send + 'static)`\n   = note: to learn more, visit &lt;https://doc.rust-lang.org/book/second-edition/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait&gt;\n   = note: required because of the requirements on the impl of `serde::Serialize` for `std::sync::Mutex&lt;(dyn std::any::Any + std::marker::Send + 'static)&gt;`\n   = note: required because of the requirements on the impl of `serde::Serialize` for `std::sync::Arc&lt;std::sync::Mutex&lt;(dyn std::any::Any + std::marker::Send + 'static)&gt;&gt;`\n   = note: required by `serde::ser::SerializeStruct::serialize_field`\n\nerror[E0277]: the trait bound `(dyn std::any::Any + std::marker::Send + 'static): serde::Serialize` is not satisfied\n  --&gt; src/main.rs:15:5\n   |\n15 |     pub data: Arc&lt;Mutex&lt;Any + Send&gt;&gt;,\n   |     ^^^ the trait `serde::Serialize` is not implemented for `(dyn std::any::Any + std::marker::Send + 'static)`\n   |\n   = note: required because of the requirements on the impl of `serde::Serialize` for `std::sync::Mutex&lt;(dyn std::any::Any + std::marker::Send + 'static)&gt;`\n   = note: required because of the requirements on the impl of `serde::Serialize` for `std::sync::Arc&lt;std::sync::Mutex&lt;(dyn std::any::Any + std::marker::Send + 'static)&gt;&gt;`\n   = note: required by `serde::ser::SerializeStruct::serialize_field`\n\nerror[E0277]: the trait bound `(dyn std::any::Any + std::marker::Send + 'static): serde::Deserialize&lt;'_&gt;` is not satisfied\n  --&gt; src/main.rs:15:5\n   |\n15 |     pub data: Arc&lt;Mutex&lt;Any + Send&gt;&gt;,\n   |     ^^^ the trait `serde::Deserialize&lt;'_&gt;` is not implemented for `(dyn std::any::Any + std::marker::Send + 'static)`\n</code></pre>\n"}, {"tags": ["rust", "bit-manipulation"], "answers": [{"tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": true, "score": 12, "last_activity_date": 1557207806, "last_edit_date": 1557207806, "creation_date": 1542267107, "answer_id": 53314407, "question_id": 53314005, "link": "https://stackoverflow.com/questions/53314005/how-can-i-convert-the-lower-upper-8-bits-of-a-u16-to-a-u8-in-rust/53314407#53314407", "title": "How can I convert the lower/upper 8 bits of a u16 to a u8 in Rust?", "body": "<p>Update: As of Rust 1.32.0 there is <a href=\"https://doc.rust-lang.org/std/primitive.u16.html#method.to_be_bytes\" rel=\"noreferrer\"><code>u16::to_be_bytes</code></a>, which can be used in favor a custom function.</p>\n\n<pre><code>fn main() {\n    let bytes = 28923u16.to_be_bytes();\n    assert_eq!([0x70, 0xFB], bytes);\n}\n</code></pre>\n\n<hr>\n\n<p>You can use the <a href=\"https://doc.rust-lang.org/nightly/std/keyword.as.html\" rel=\"noreferrer\"><code>as</code> keyword</a> to convert a <code>u16</code> to <code>u8</code> in a safe way.</p>\n\n<pre><code>fn convert_u16_to_two_u8s_be(integer: u16) -&gt; [u8; 2] {\n    [(integer &gt;&gt; 8) as u8, integer as u8]\n}\n</code></pre>\n\n<p>If you need more types or different endianness use the <a href=\"https://crates.io/crates/byteorder\" rel=\"noreferrer\">byteorder crate</a>.</p>\n\n<pre><code>extern crate byteorder;\n\nuse byteorder::{WriteBytesExt, BigEndian};\n\nfn convert_u16_to_two_u8s_be(integer: u16) -&gt; Vec&lt;u8&gt; {\n    let mut res = vec![];\n    res.write_u16::&lt;BigEndian&gt;(integer).unwrap();\n    res\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "is_accepted": false, "score": 6, "last_activity_date": 1542267113, "creation_date": 1542267113, "answer_id": 53314408, "question_id": 53314005, "link": "https://stackoverflow.com/questions/53314005/how-can-i-convert-the-lower-upper-8-bits-of-a-u16-to-a-u8-in-rust/53314408#53314408", "title": "How can I convert the lower/upper 8 bits of a u16 to a u8 in Rust?", "body": "<p>You can cast between integer types with <code>as</code>.</p>\n\n<pre><code>let b1 = n2 as u8;\nlet b2 = (n2 &gt;&gt; 8) as u8;\n</code></pre>\n\n<p>Note that the masking is unnecessary, because the cast will truncate the upper bits.</p>\n"}], "owner": {"reputation": 1691, "user_id": 6396569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://lh3.googleusercontent.com/-f0efiZGjd9s/AAAAAAAAAAI/AAAAAAAAAFQ/A1O5wGFybXA/photo.jpg?sz=128", "display_name": "the_endian", "link": "https://stackoverflow.com/users/6396569/the-endian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5129, "favorite_count": 1, "accepted_answer_id": 53314407, "answer_count": 2, "score": 6, "last_activity_date": 1557207806, "creation_date": 1542265187, "last_edit_date": 1542301427, "question_id": 53314005, "link": "https://stackoverflow.com/questions/53314005/how-can-i-convert-the-lower-upper-8-bits-of-a-u16-to-a-u8-in-rust", "title": "How can I convert the lower/upper 8 bits of a u16 to a u8 in Rust?", "body": "<p>I want to convert a <code>u16</code> to two separate <code>u8</code>s. I tried to use some bit masks:</p>\n\n<pre><code>use std::convert::From;\n\nfn main() {\n    let n1: u8 = 0x41;\n    let n2: u16 = 0x4157;\n\n    println!(\"Number:{}\", char::from(n1));\n\n    let b1: u8 = n2 &amp; 0xFF;\n    let b2: u8 = n2 &gt;&gt; 8;\n\n    println!(\"b1: {}\", b1);\n    println!(\"b2: {}\", b2);\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n --&gt; src/main.rs:9:18\n  |\n9 |     let b1: u8 = n2 &amp; 0xFF;\n  |                  ^^^^^^^^^ expected u8, found u16\n\nerror[E0308]: mismatched types\n  --&gt; src/main.rs:10:18\n   |\n10 |     let b2: u8 = n2 &gt;&gt; 8;\n   |                  ^^^^^^^ expected u8, found u16\n</code></pre>\n\n<p>This question is not <em>why does the compiler raise a mismatched type error?</em>, rather, it is <em>How can I convert the lower/upper 8 bits of a <code>u16</code> to a <code>u8</code> in Rust?</em>. Potentially, there are other ways to do this and this question does not constrain the answer to the <code>as</code> keyword.</p>\n"}, {"tags": ["docker", "rust", "hyperledger-sawtooth", "rustup"], "comments": [{"owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "edited": false, "score": 0, "creation_date": 1542260540, "post_id": 53312917, "comment_id": 93506550, "body": "Is installing <code>ca-certificates</code> not an option?"}, {"owner": {"reputation": 400, "user_id": 6259472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad078669a74170178cfcfbd62a8fa28a?s=128&d=identicon&r=PG&f=1", "display_name": "Akhil Kintali", "link": "https://stackoverflow.com/users/6259472/akhil-kintali"}, "reply_to_user": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "edited": false, "score": 0, "creation_date": 1542261562, "post_id": 53312917, "comment_id": 93506897, "body": "I tried installing <code>ca-certificates</code> too. Bu they don&#39;t seem to work."}, {"owner": {"reputation": 15864, "user_id": 1870153, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/juCKe.png?s=128&g=1", "display_name": "ljedrz", "link": "https://stackoverflow.com/users/1870153/ljedrz"}, "edited": false, "score": 0, "creation_date": 1542269426, "post_id": 53312917, "comment_id": 93509989, "body": "Do you have the proxy credentials? You could then run <code>export https_proxy=https:&#47;&#47;user:password@your.proxy.server:port</code> before running curl."}, {"owner": {"reputation": 400, "user_id": 6259472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad078669a74170178cfcfbd62a8fa28a?s=128&d=identicon&r=PG&f=1", "display_name": "Akhil Kintali", "link": "https://stackoverflow.com/users/6259472/akhil-kintali"}, "edited": false, "score": 0, "creation_date": 1542271895, "post_id": 53312917, "comment_id": 93511232, "body": "I&#39;ve set the proxy too. Both <code>http_proxy</code> and <code>https_proxy</code>"}], "owner": {"reputation": 400, "user_id": 6259472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad078669a74170178cfcfbd62a8fa28a?s=128&d=identicon&r=PG&f=1", "display_name": "Akhil Kintali", "link": "https://stackoverflow.com/users/6259472/akhil-kintali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 559, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1612765286, "creation_date": 1542259324, "last_edit_date": 1612765286, "question_id": 53312917, "link": "https://stackoverflow.com/questions/53312917/rust-installation-fails-the-command-rustup-init-y-throws-and-error", "title": "Rust installation fails. The command &#39;rustup-init -y&#39; throws and error.", "body": "<p>I am behind a corporate proxy and I'm trying to install Hyperledger Sawtooth on an Ubuntu machine.</p>\n<p>Part of that setup is installing rust which is failing.</p>\n<p>It uses the following command which is taken from a 'Dockerfile' file as part of the command <code>docker-compose up</code>:</p>\n<p><code>curl --insecure https://sh.rustup.rs -sSf &gt; /usr/bin/rustup-init  &amp;&amp; chmod +x /usr/bin/rustup-init  &amp;&amp; rustup-init -y</code></p>\n<p>This gives me an error:</p>\n<pre><code>curl: (60) server certificate verification failed. CAfile: /etc/ssl/certs/ca-certificates.crt CRLfile: none\nMore details here: http://curl.haxx.se/docs/sslcerts.html\n\ncurl performs SSL certificate verification by default, using a &quot;bundle&quot;\n of Certificate Authority (CA) public keys (CA certs). If the default\n bundle file isn't adequate, you can specify an alternate file\n using the --cacert option.\nIf this HTTPS server uses a certificate signed by a CA represented in\n the bundle, the certificate verification probably failed due to a\n problem with the certificate (it might be expired, or the name might\n not match the domain name in the URL).\nIf you'd like to turn off curl's verification of the certificate, use\n the -k (or --insecure) option.\nrustup: command failed: downloader https://static.rust-lang.org/rustup/dist/x86_64-unknown-linux-gnu/rustup-init /tmp/tmp.KEMZg5vZRK/rustup-init\n</code></pre>\n<p>Apparently, the command <code>rustup-init -y</code> is failing as I'm behind a corporate proxy and it failed to connect the url <a href=\"https://static.rust-lang.org/rustup/dist/x86_64-unknown-linux-gnu/rustup-init\" rel=\"nofollow noreferrer\">https://static.rust-lang.org/rustup/dist/x86_64-unknown-linux-gnu/rustup-init</a>.</p>\n<p>Where do I do the modification (add the -k flag) to turn off curl's certificate verification option so that I get an insecure connection and my installation is successful?</p>\n<p>I tried modifying the rustup-init.sh file, but it is of no use.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1542254754, "post_id": 53312222, "comment_id": 93505133, "body": "Neither of your example links work FYI. You probably forgot to make sharable links."}, {"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 3, "creation_date": 1542255099, "post_id": 53312222, "comment_id": 93505184, "body": "The case to consider is, what would happen if <code>update</code> were to panic? You&#39;d have transferred <code>st.item</code> to <code>update</code>, so what value would be in <code>st.item</code> after the panic? It needs to be something or else the you&#39;re leaving your <code>State</code> object in an invalid state. Also good reading: <a href=\"http://smallcultfollowing.com/babysteps/blog/2018/11/10/after-nll-moving-from-borrowed-data-and-the-sentinel-pattern/\" rel=\"nofollow noreferrer\">smallcultfollowing.com/babysteps/blog/2018/11/10/&hellip;</a>"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 3, "creation_date": 1542283893, "post_id": 53312222, "comment_id": 93518328, "body": "The difference to the question tagged as duplicate is that the <code>update()</code> function requires to temporarily take ownership of <code>st.item</code> <i>while the new value is build</i>. This means the solutions based on <code>std::mem::replace()</code> and <code>std::mem::swap()</code> in the first answer won&#39;t work as written there. The best solution would be to change the interface of <code>update()</code> to take a reference instead, if possible. If not, I recommend reading <a href=\"http://smallcultfollowing.com/babysteps/blog/2018/11/10/after-nll-moving-from-borrowed-data-and-the-sentinel-pattern/\" rel=\"nofollow noreferrer\">this blog post on the subject</a>."}, {"owner": {"reputation": 476, "user_id": 105793, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0579b951482b5176a25f9141a73ef9e8?s=128&d=identicon&r=PG", "display_name": "Arjun Guha", "link": "https://stackoverflow.com/users/105793/arjun-guha"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1542284609, "post_id": 53312222, "comment_id": 93518769, "body": "Thanks, @SvenMarnach. That blog post has essentially the same example. <code>mem::swap</code> is slightly cleaner than my solution."}], "answers": [{"comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1542319900, "post_id": 53322653, "comment_id": 93537669, "body": "Please don&#39;t post link-only answers. If you agree that your question is answered at <a href=\"https://stackoverflow.com/questions/27098694/how-can-i-swap-in-a-new-value-for-a-field-in-a-mutable-reference-to-a-structure\">How can I swap in a new value for a field in a mutable reference to a structure?</a>, you can close it yourself -- there should be a &quot;close&quot; button underneath the post. If you don&#39;t see that, you might not have enough reputation; you don&#39;t need to do anything. If you don&#39;t believe your question is substantially the same as that one, you can answer it yourself, but..."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1542320038, "post_id": 53322653, "comment_id": 93537720, "body": "... don&#39;t just post a link. Copy and quote the relevant portions of the article, and add any explanation that might be necessary to make your answer stand alone. Blogs can go down; Stack Overflow is interested in answers (and questions) that don&#39;t depend on external links."}], "tags": [], "owner": {"reputation": 476, "user_id": 105793, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0579b951482b5176a25f9141a73ef9e8?s=128&d=identicon&r=PG", "display_name": "Arjun Guha", "link": "https://stackoverflow.com/users/105793/arjun-guha"}, "is_accepted": false, "score": -2, "last_activity_date": 1542295483, "creation_date": 1542295483, "answer_id": 53322653, "question_id": 53312222, "link": "https://stackoverflow.com/questions/53312222/is-it-possible-to-take-temporary-ownership-of-a-struct-field/53322653#53322653", "title": "Is it possible to take temporary ownership of a struct field?", "body": "<p>As Sven points out, this question is answered here:</p>\n\n<p><a href=\"http://smallcultfollowing.com/babysteps/blog/2018/11/10/after-nll-moving-from-borrowed-data-and-the-sentinel-pattern/\" rel=\"nofollow noreferrer\">http://smallcultfollowing.com/babysteps/blog/2018/11/10/after-nll-moving-from-borrowed-data-and-the-sentinel-pattern/</a></p>\n"}], "owner": {"reputation": 476, "user_id": 105793, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0579b951482b5176a25f9141a73ef9e8?s=128&d=identicon&r=PG", "display_name": "Arjun Guha", "link": "https://stackoverflow.com/users/105793/arjun-guha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 717, "favorite_count": 0, "closed_date": 1542333756, "answer_count": 1, "score": 0, "last_activity_date": 1542333833, "creation_date": 1542254227, "last_edit_date": 1542295434, "question_id": 53312222, "link": "https://stackoverflow.com/questions/53312222/is-it-possible-to-take-temporary-ownership-of-a-struct-field", "closed_reason": "Duplicate", "title": "Is it possible to take temporary ownership of a struct field?", "body": "<p>I have an immutable data structure, and an update function that takes ownership of the data structure and returns a new data structure:</p>\n\n<pre><code>enum Immutable {\n    Item(i32)\n}\n\nfn update(imm: Immutable) -&gt; Immutable {\n    match imm {\n        Immutable::Item(x) =&gt; Immutable::Item(x + 1)\n    }\n}\n</code></pre>\n\n<p>I need to store the data structure in a mutable field of a container:</p>\n\n<pre><code>struct State {\n    item: Immutable\n}\n</code></pre>\n\n<p>I want to write an imperative update function for <code>State</code> that calls the function updater:</p>\n\n<pre><code>fn update_mut(st: &amp;mut State) -&gt; () {\n    let mut owned = Immutable::Item(42); // junk\n    std::mem::swap(&amp;mut st.item, &amp;mut owned);\n    st.item = update(owned);\n}\n</code></pre>\n\n<p>This code works, but it seems sily to use <code>mem::swap</code> and allocate a junk object. I would really like to write:</p>\n\n<pre><code>fn update_mut_type_error(st: &amp;mut State) -&gt; () {\n    let mut owned = Immutable::Item(42); // junk\n    std::mem::swap(&amp;mut st.item, &amp;mut owned);\n    st.item = update(st.item); // type error\n}\n</code></pre>\n\n<p>Is there any way to address this? Or, do I have to use <code>mem::swap</code> here, even though it seems spurious.</p>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2015&amp;gist=e4d2e7687cb5fb2eb2c1489138142ef6\" rel=\"nofollow noreferrer\">Example on Rust Playground</a></p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1542247080, "post_id": 53311325, "comment_id": 93503546, "body": "Please add your Cargo.toml relevant section and the <code>extern crate</code> lines"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1542249498, "post_id": 53311325, "comment_id": 93504079, "body": "I guess that&#39;s just an issue of crate alias. Does it work if you do <code>extern crate md5 as md5_other;</code>?"}, {"owner": {"reputation": 6344, "user_id": 1084684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/32b10232489646c1940c202e91f475b9?s=128&d=identicon&r=PG", "display_name": "dstromberg", "link": "https://stackoverflow.com/users/1084684/dstromberg"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1542250245, "post_id": 53311325, "comment_id": 93504227, "body": "&quot;crate as&quot; gives an almost identical error, except the last bit is &quot;error[E0463]: can&#39;t find crate for <code>md5_other</code>&quot;."}, {"owner": {"reputation": 6344, "user_id": 1084684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/32b10232489646c1940c202e91f475b9?s=128&d=identicon&r=PG", "display_name": "dstromberg", "link": "https://stackoverflow.com/users/1084684/dstromberg"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1542292973, "post_id": 53311325, "comment_id": 93523917, "body": "Yes, it&#39;s a duplicate.  I switched to cargo +nightly, added cargo-features = [&quot;rename-dependency&quot;], and then &quot;md_5 = { package = &quot;md-5&quot;, version = &quot;^0.8.0&quot; }&quot; worked."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1542294209, "post_id": 53311325, "comment_id": 93524728, "body": "Unfortunately, this does not exists in stable Rust. I hope for you it will be stabilized soon! As a workaround, you can maybe create your own crate with a different name and reexport the whole md5 crate"}], "owner": {"reputation": 6344, "user_id": 1084684, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/32b10232489646c1940c202e91f475b9?s=128&d=identicon&r=PG", "display_name": "dstromberg", "link": "https://stackoverflow.com/users/1084684/dstromberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 198, "favorite_count": 0, "closed_date": 1542297450, "answer_count": 0, "score": 4, "last_activity_date": 1542297432, "creation_date": 1542246757, "last_edit_date": 1542297432, "question_id": 53311325, "link": "https://stackoverflow.com/questions/53311325/is-there-a-way-of-resolving-a-crate-naming-conflict", "closed_reason": "Duplicate", "title": "Is there a way of resolving a crate naming conflict?", "body": "<p>I want to use several MD5 implementations in the same Rust program.</p>\n\n<p>Two of them both want to be named \"md5\", which is causing an error from the compiler:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0465]: multiple rlib candidates for `md5` found\n  --&gt; md5s/src/lib.rs:10:1\n   |\n10 | extern crate md5;\n   | ^^^^^^^^^^^^^^^^^\n   |\nnote: candidate #1: /home/dstromberg/src/home-svn/md5s/trunk/target/debug/deps/libmd5-256ebb56f51dbbc0.rlib\n  --&gt; md5s/src/lib.rs:10:1\n   |\n10 | extern crate md5;\n   | ^^^^^^^^^^^^^^^^^\nnote: candidate #2: /home/dstromberg/src/home-svn/md5s/trunk/target/debug/deps/libmd5-56cccd41ff35cdb0.rlib\n  --&gt; md5s/src/lib.rs:10:1\n   |\n10 | extern crate md5;\n   | ^^^^^^^^^^^^^^^^^\n\nerror[E0463]: can't find crate for `md5`\n  --&gt; md5s/src/lib.rs:10:1\n   |\n10 | extern crate md5;\n   | ^^^^^^^^^^^^^^^^^ can't find crate\n</code></pre>\n\n<p>Is there a way of renaming one or both of them without subverting cargo?</p>\n\n<p>The specific crates are:</p>\n\n<ul>\n<li><a href=\"https://crates.io/crates/md5\" rel=\"nofollow noreferrer\">md5</a></li>\n<li><a href=\"https://crates.io/crates/md-5\" rel=\"nofollow noreferrer\">md-5</a></li>\n</ul>\n\n<p>I have 2 Cargo.toml's:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ grep -n . $(find . -name Cargo.toml -print)\nbelow cmd output started 2018 Wed Nov 14 06:03:48 PM PST\n./md5s/Cargo.toml:1:[package]\n./md5s/Cargo.toml:2:name = \"md5s\"\n./md5s/Cargo.toml:3:version = \"0.1.0\"\n./md5s/Cargo.toml:4:authors = [\"xxxxxxxx@gmail.com\"]\n./md5s/Cargo.toml:6:[dependencies]\n./md5s/Cargo.toml:7:rust-crypto = \"^0.2\"\n./md5s/Cargo.toml:8:md5 = \"^0.5\"\n./md5s/Cargo.toml:9:# md-5 = \"^0.8.0\"\n./Cargo.toml:1:# Cargo structure based on https://stackoverflow.com/questions/26946646/rust-package-with-both-a-library-and-a-binary\n./Cargo.toml:2:[package]\n./Cargo.toml:3:name = \"compare-md5s\"\n./Cargo.toml:4:version = \"0.1.0\"\n./Cargo.toml:5:authors = [\"Dan Stromberg &lt;xxxxxxxx@gmail.com&gt;\"]\n./Cargo.toml:7:[workspace]\n./Cargo.toml:9:[dependencies]\n./Cargo.toml:10:md5s = { path = \"md5s\" }\n./Cargo.toml:11:rust-crypto = \"^0.2\"\n./Cargo.toml:12:md5 = \"^0.5\"\n./Cargo.toml:13:# md-5 = \"^0.8.0\"\n</code></pre>\n\n<p>The project builds if I leave the 2 md-5's commented out, and fails with the error above if I uncomment them.</p>\n\n<p>In md5s/src/lib.rs, I have:</p>\n\n<pre><code>extern crate md5;\n</code></pre>\n"}]