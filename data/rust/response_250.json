[{"tags": ["enums", "rust", "serde"], "comments": [{"owner": {"reputation": 126, "user_id": 4709888, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PslUe.png?s=128&g=1", "display_name": "dotPoozer", "link": "https://stackoverflow.com/users/4709888/dotpoozer"}, "edited": false, "score": 1, "creation_date": 1571877243, "post_id": 58532247, "comment_id": 103388696, "body": "I don&#39;t think there&#39;s any way to do this out of the box. You can try manually implementing Deserialize and Serialize as in examples <a href=\"https://serde.rs/custom-serialization.html\" rel=\"nofollow noreferrer\">serde.rs/custom-serialization.html</a>"}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1571899991, "post_id": 58532247, "comment_id": 103394162, "body": "@Stargateur There are already examples in the question for what the OP wants. Specifically, if input is the string <code>X1</code>, output should be <code>Main::A (SubA::X1)</code> and if input is <code>Y3</code>, output should be <code>Main::B (SubB::Y3)</code>\u2026"}, {"owner": {"reputation": 30359, "user_id": 255688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74b63650ed07d745fd9accf52e4d286b?s=128&d=identicon&r=PG", "display_name": "phimuemue", "link": "https://stackoverflow.com/users/255688/phimuemue"}, "edited": false, "score": 1, "creation_date": 1571902766, "post_id": 58532247, "comment_id": 103395419, "body": "I am not sure if <code>serde</code> implements this out of the box, because it seems hard to do when you have an enum holding the same type in different variants (i.e. <code>enum Main{A(SubA), B(SubA)}</code>. What should <code>X1</code> then be deserialized to? (Similar problem if <code>SubA</code> and <code>SubB</code> both contain a variant <code>X1</code>.)"}], "answers": [{"tags": [], "owner": {"reputation": 4182, "user_id": 2992101, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7363e9ce46406af3326492e2f6cf40ca?s=128&d=identicon&r=PG", "display_name": "michalsrb", "link": "https://stackoverflow.com/users/2992101/michalsrb"}, "is_accepted": true, "score": 1, "last_activity_date": 1571910137, "creation_date": 1571910137, "answer_id": 58538566, "question_id": 58532247, "link": "https://stackoverflow.com/questions/58532247/is-there-a-way-to-flatten-enums-for-deserialization-in-rust/58538566#58538566", "title": "Is there a way to &quot;flatten&quot; enums for (de)serialization in Rust?", "body": "<p>It works pretty much out of the box if you put <code>serde(untagged)</code> on the outer enum and nothing special on the inner enums:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use serde_derive::{Deserialize, Serialize};\n\n#[derive(Debug, Deserialize, Serialize, PartialEq)]\n#[serde(untagged)]\nenum Main {\n    A(SubA),\n    B(SubB),\n}\n\n#[derive(Debug, Deserialize, Serialize, PartialEq)]\nenum SubA { X1, X2, X3 }\n\n#[derive(Debug, Deserialize, Serialize, PartialEq)]\nenum SubB { Y1, Y2, Y3 }\n\nfn main() {\n    let x1 = Main::A(SubA::X1);\n    let y2 = Main::B(SubB::Y2);\n\n    assert_eq!(serde_json::to_string(&amp;x1).unwrap(), \"\\\"X1\\\"\");\n    assert_eq!(serde_json::to_string(&amp;y2).unwrap(), \"\\\"Y2\\\"\");\n\n    assert_eq!(serde_json::de::from_str::&lt;Main&gt;(\"\\\"X1\\\"\").unwrap(), x1);\n    assert_eq!(serde_json::de::from_str::&lt;Main&gt;(\"\\\"Y2\\\"\").unwrap(), y2);\n}\n\n</code></pre>\n"}], "owner": {"reputation": 4020, "user_id": 388739, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vqsVi.jpg?s=128&g=1", "display_name": "Mark LeMoine", "link": "https://stackoverflow.com/users/388739/mark-lemoine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 744, "favorite_count": 0, "accepted_answer_id": 58538566, "answer_count": 1, "score": 1, "last_activity_date": 1571910137, "creation_date": 1571873854, "question_id": 58532247, "link": "https://stackoverflow.com/questions/58532247/is-there-a-way-to-flatten-enums-for-deserialization-in-rust", "title": "Is there a way to &quot;flatten&quot; enums for (de)serialization in Rust?", "body": "<p>I have an enum that is composed of other enums, similar to the following (<code>serde</code> derives and annotations omitted for brevity):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>enum Main {\n    A(SubA),\n    B(SubB),\n}\n\nenum SubA { X1, X2, X3 }\nenum SubB { Y1, Y2, Y3 }\n</code></pre>\n\n<p>I'd love to be able to use <code>serde</code> to deserialize a string such as \"X1\" or \"Y3\", and automatically get back a <code>Main::A(SubA::X1)</code> or <code>Main::B(SubB::Y3)</code>, respectively.</p>\n\n<p>I understand that <code>serde</code> supports a <code>#[serde(transparent)]</code> attribute on newtype-style structs, which would do what I like. However, it only seems to work on the struct or enum level, not at the enum-variant level. Is there a way I can automagically get the behavior I'm looking for? I can ensure that there would be no overlap in any of the variant names in any of the contained sub-enums.</p>\n\n<p>Aside from wanting to remain on Rust 2018 stable, I have no other restrictions on my project, and I'm open to any crate suggestions that would help.</p>\n"}, {"tags": ["generics", "rust", "type-conversion", "traits"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1571871325, "post_id": 58531749, "comment_id": 103387606, "body": "This is already implemented by std"}, {"owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1571871685, "post_id": 58531749, "comment_id": 103387690, "body": "@Stargateur: What do you mean? If it&#39;s implemented, how do I call it? Removing my implementation results in another error: <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=910e7aaf828f02adffd36f14ac602ad5\" rel=\"nofollow noreferrer\">the trait bound <code>Item&lt;i32&gt;: std::convert::From&lt;Item&lt;i8&gt;&gt;</code> is not satisfied</a>"}, {"owner": {"reputation": 126, "user_id": 4709888, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PslUe.png?s=128&g=1", "display_name": "dotPoozer", "link": "https://stackoverflow.com/users/4709888/dotpoozer"}, "edited": false, "score": 0, "creation_date": 1571871943, "post_id": 58531749, "comment_id": 103387749, "body": "It&#39;s not though. This touches specialisation and higher kinded types I believe. First one is unstable and latter one is not supported as of yet. Rust resolves this problem using some hacky way involving SpecExtend trait in vec for example. <a href=\"https://doc.rust-lang.org/src/alloc/vec.rs.html#1904-1907\" rel=\"nofollow noreferrer\">doc.rust-lang.org/src/alloc/vec.rs.html#1904-1907</a>"}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 4, "creation_date": 1571872419, "post_id": 58531749, "comment_id": 103387843, "body": "Your implementation is conflicting with the <code>From&lt;T&gt; for T</code> implementation from <code>core</code> because it also covers <code>From&lt;Item&lt;T&gt;&gt; for Item&lt;T&gt;</code>."}, {"owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "reply_to_user": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1571872587, "post_id": 58531749, "comment_id": 103387874, "body": "@mcarton: Yes, that is correct."}], "owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1571908362, "creation_date": 1571869746, "last_edit_date": 1571908362, "question_id": 58531749, "link": "https://stackoverflow.com/questions/58531749/how-to-implement-fromfoou-for-foot", "title": "How to implement From&lt;Foo&lt;U&gt;&gt; for Foo&lt;T&gt;", "body": "<p>I want to implement <code>From</code> for instantiations of a generic type in cases where the type parameters can be converted.</p>\n\n<pre><code>struct Item&lt;T&gt;(T);\n\nimpl&lt;T, U&gt; From&lt;Item&lt;U&gt;&gt; for Item&lt;T&gt; where T: From&lt;U&gt; {\n    fn from(other: Item&lt;U&gt;) -&gt; Item&lt;T&gt; {\n        Item(other.0.into())\n    }\n}\n\nfn main() {\n    let a = Item(10i8);\n    let b: Item&lt;i32&gt; = a.into();\n}\n</code></pre>\n\n<p>This fails with</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0119]: conflicting implementations of trait `std::convert::From&lt;Item&lt;_&gt;&gt;` for type `Item&lt;_&gt;`:\n --&gt; src/main.rs:4:1\n  |\n3 | impl&lt;T, U&gt; From&lt;Item&lt;U&gt;&gt; for Item&lt;T&gt; where T: From&lt;U&gt; {\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  |\n</code></pre>\n\n<p>Is there any way to do this?</p>\n"}, {"tags": ["multithreading", "concurrency", "rust"], "answers": [{"comments": [{"owner": {"reputation": 1058, "user_id": 2797757, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4db8a84f0f567cc5df66a9a480ce5b08?s=128&d=identicon&r=PG&f=1", "display_name": "hydradon", "link": "https://stackoverflow.com/users/2797757/hydradon"}, "edited": false, "score": 0, "creation_date": 1571882233, "post_id": 58532746, "comment_id": 103389561, "body": "Hi @loganfsmyth, with your code, the program can return now but it still prints only 1 line. I expect it to print 10 since I have 10 items in <code>item_list</code>. Is my thread logic correct?"}, {"owner": {"reputation": 1058, "user_id": 2797757, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4db8a84f0f567cc5df66a9a480ce5b08?s=128&d=identicon&r=PG&f=1", "display_name": "hydradon", "link": "https://stackoverflow.com/users/2797757/hydradon"}, "edited": false, "score": 0, "creation_date": 1571882577, "post_id": 58532746, "comment_id": 103389610, "body": "I have updated my answer with some investigation. Apparently, all 10 threads run but they don&#39;t print anything from <code>item_action</code> function..."}, {"owner": {"reputation": 1058, "user_id": 2797757, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4db8a84f0f567cc5df66a9a480ce5b08?s=128&d=identicon&r=PG&f=1", "display_name": "hydradon", "link": "https://stackoverflow.com/users/2797757/hydradon"}, "edited": false, "score": 0, "creation_date": 1571882932, "post_id": 58532746, "comment_id": 103389674, "body": "after one thread, the <code>attributes</code> in <code>Bag</code> becomes all zeros"}, {"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "reply_to_user": {"reputation": 1058, "user_id": 2797757, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4db8a84f0f567cc5df66a9a480ce5b08?s=128&d=identicon&r=PG&f=1", "display_name": "hydradon", "link": "https://stackoverflow.com/users/2797757/hydradon"}, "edited": false, "score": 0, "creation_date": 1571883666, "post_id": 58532746, "comment_id": 103389825, "body": "<code>attributes</code> doesn&#39;t become all zeroes, you are creating it with all zeroes to begin with. Your output prints 2 lines because those are the only 2 lines where one of the arguments is <code>0</code> and thus <code>.contains()</code> returns <code>true</code> for only those 2."}, {"owner": {"reputation": 1058, "user_id": 2797757, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4db8a84f0f567cc5df66a9a480ce5b08?s=128&d=identicon&r=PG&f=1", "display_name": "hydradon", "link": "https://stackoverflow.com/users/2797757/hydradon"}, "edited": false, "score": 0, "creation_date": 1571886501, "post_id": 58532746, "comment_id": 103390325, "body": "you are right! Silly me! Thank you for the solution!"}], "tags": [], "owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "is_accepted": true, "score": 1, "last_activity_date": 1571878764, "creation_date": 1571878764, "answer_id": 58532746, "question_id": 58531550, "link": "https://stackoverflow.com/questions/58531550/rust-concurrency-error-program-hangs-after-first-thread/58532746#58532746", "title": "Rust: concurrency error, program hangs after first thread", "body": "<p>I believe this is because Rust is not running your </p>\n\n<pre><code>if self.attributes.lock().unwrap().contains(&amp;item_attr1) ||\n    self.attributes.lock().unwrap().contains(&amp;item_attr2) {\n</code></pre>\n\n<p>expression in the order you expect. The evaluation order of subexpressions in Rust is currently undefined. What appears to be happening is that you essentially end up with</p>\n\n<pre><code>const condition = {\n  let lock1 = self.attributes.lock().unwrap();\n  let lock2 = self.attributes.lock().unwrap();\n  lock1.contains(&amp;item_attr1) || lock2.contains(&amp;item_attr2)\n};\nif condition {\n</code></pre>\n\n<p>which is causing your code to deadlock.</p>\n\n<p>You should instead write:</p>\n\n<pre><code>let attributes = self.attributes.lock().unwrap();\nif attributes.contains(&amp;item_attr1) ||\n   attributes.contains(&amp;item_attr2) {\n</code></pre>\n\n<p>so that there is only one lock.</p>\n\n<p>Your code would also work as-is if you used an <a href=\"https://doc.rust-lang.org/std/sync/struct.RwLock.html\" rel=\"nofollow noreferrer\"><code>RwLock</code></a> or <a href=\"https://docs.rs/parking_lot/0.3.8/parking_lot/struct.ReentrantMutex.html\" rel=\"nofollow noreferrer\"><code>ReentrantMutex</code></a> instead of a <code>Mutex</code> since those allow the same thread to have multiple immutable references to the data.</p>\n"}], "owner": {"reputation": 1058, "user_id": 2797757, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4db8a84f0f567cc5df66a9a480ce5b08?s=128&d=identicon&r=PG&f=1", "display_name": "hydradon", "link": "https://stackoverflow.com/users/2797757/hydradon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 58532746, "answer_count": 1, "score": 0, "last_activity_date": 1571882334, "creation_date": 1571868221, "last_edit_date": 1571882334, "question_id": 58531550, "link": "https://stackoverflow.com/questions/58531550/rust-concurrency-error-program-hangs-after-first-thread", "title": "Rust: concurrency error, program hangs after first thread", "body": "<p>I have created a simplified version of my problem below, I have a <code>Bag</code> struct and <code>Item</code> struct. I want to spawn 10 threads that execute <code>item_action</code> method from Bag on each <code>item</code> in an <code>item_list</code>, and print a statement if both item's attributes are in the bag's <code>attributes</code>.</p>\n\n<pre><code>use std::sync::{Mutex,Arc};\nuse std::thread;\n\n#[derive(Clone, Debug)]\nstruct Bag{\n    attributes: Arc&lt;Mutex&lt;Vec&lt;usize&gt;&gt;&gt;\n}\n\nimpl Bag {\n    fn new(n: usize) -&gt; Self {\n        let mut v = Vec::with_capacity(n);\n        for _ in 0..n {\n            v.push(0);\n        }\n\n        Bag{\n            attributes:Arc::new(Mutex::new(v)),\n        }\n}\n\n    fn item_action(&amp;self, item_attr1: usize, item_attr2: usize) -&gt; Result&lt;(),()&gt; {\n\n        if self.attributes.lock().unwrap().contains(&amp;item_attr1) ||\n        self.attributes.lock().unwrap().contains(&amp;item_attr2) {\n\n            println!(\"Item attributes {} and {} are in Bag attribute list!\", item_attr1, item_attr2);\n            Ok(())\n        } else {\n            Err(())\n        }\n    }\n}\n\n#[derive(Clone, Debug)]\nstruct Item{\n    item_attr1: usize,\n    item_attr2: usize,\n}\n\nimpl Item{\n    pub fn new(item_attr1: usize, item_attr2: usize) -&gt; Self {\n        Item{\n            item_attr1: item_attr1,\n            item_attr2: item_attr2\n        }\n    }\n}\n\nfn main() { \n    let mut item_list: Vec&lt;Item&gt; = Vec::new();\n    for i in 0..10 { \n        item_list.push(Item::new(i, (i+1)%10));\n    }\n\n    let bag: Bag= Bag::new(10); //create 10 attributes\n\n    let mut handles = Vec::with_capacity(10);\n\n    for x in 0..10 {\n        let bag2 = bag.clone();\n        let item_list2= item_list.clone();\n\n        handles.push(\n            thread::spawn(move || {\n                bag2.item_action(item_list2[x].item_attr1, item_list2[x].item_attr2);\n            })\n        )\n    }\n\n    for h in handles {\n        println!(\"Here\");\n        h.join().unwrap();\n    }\n}\n</code></pre>\n\n<p>When running, I only got one line, and the program just stops there without returning. </p>\n\n<pre><code>Item attributes 0 and 1 are in Bag attribute list!\n</code></pre>\n\n<p>May I know what went wrong? Please see code in <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=982789636dc417d27b7f453c38e4cf67\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p><strong>Updated</strong>:</p>\n\n<p>With suggestion from @loganfsmyth, the program can return now... but still only prints 1 line as above. I expect it to print 10 because my <code>item_list</code> has 10 items. Not sure if my thread logic is correct.</p>\n\n<p>I have added <code>println!(\"Here\");</code> when calling <code>join</code> all threads. And I can see <code>Here</code> is printed 10 times, just not the actual log from <code>item_action</code></p>\n"}, {"tags": ["rust", "ffi"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571861761, "post_id": 58530104, "comment_id": 103384593, "body": "It&#39;s hard to answer your question because it doesn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. We can&#39;t tell what the types (<code>handle</code>) or functions (<code>create_handle</code> / <code>close_handle</code>) present in the code are."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571861878, "post_id": 58530104, "comment_id": 103384650, "body": "Your function is declared as <code>(handle** ptr)</code>, but the Rust equivalent is <code>(handle: *mut c_int)</code>. Why do you believe that these are equivalent types?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1571861931, "post_id": 58530104, "comment_id": 103384669, "body": "Your question might be answered by the answers of <a href=\"https://stackoverflow.com/q/47878236/155423\">How do I make the equivalent of a C double pointer in Rust?</a>. If not, please <b><a href=\"https://stackoverflow.com/posts/58530104/edit\">edit</a></b> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 57, "user_id": 1860369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/27174b86495bec3bbe40b730a435fcb0?s=128&d=identicon&r=PG", "display_name": "troop357", "link": "https://stackoverflow.com/users/1860369/troop357"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571862290, "post_id": 58530104, "comment_id": 103384812, "body": "@Shepmaster Fixed the image import (it is part of a bigger program, I copied by mistake). Thanks for the info on the revision history. I dont see how to include a minimal reproducible example without the DLL. I&#39;ll check the provided link and give a follow up."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571862554, "post_id": 58530104, "comment_id": 103384915, "body": "The <i>minimized</i> DLL code should likely boil down to one or two statements per function, plus another few for for the definition of <code>handle</code>, for a likely total of ~10 lines. That&#39;s easily included and the entire point of creating a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 57, "user_id": 1860369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/27174b86495bec3bbe40b730a435fcb0?s=128&d=identicon&r=PG", "display_name": "troop357", "link": "https://stackoverflow.com/users/1860369/troop357"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571863141, "post_id": 58530104, "comment_id": 103385182, "body": "@Shepmaster the last bit of the linked answer was what I was missing. The *mut *mut notation was not something I was familiar with, but looking at it now it makes sense. The working solution could be added as an edit marker?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571863277, "post_id": 58530104, "comment_id": 103385256, "body": "If you don&#39;t think that the linked question is a duplicate, you can answer your own question below."}], "answers": [{"tags": [], "owner": {"reputation": 57, "user_id": 1860369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/27174b86495bec3bbe40b730a435fcb0?s=128&d=identicon&r=PG", "display_name": "troop357", "link": "https://stackoverflow.com/users/1860369/troop357"}, "is_accepted": false, "score": 0, "last_activity_date": 1571863850, "last_edit_date": 1571863850, "creation_date": 1571863710, "answer_id": 58530805, "question_id": 58530104, "link": "https://stackoverflow.com/questions/58530104/what-is-the-proper-way-to-use-a-pointer-to-pointer-in-a-foreign-function-in-rust/58530805#58530805", "title": "What is the proper way to use a pointer to pointer in a foreign function in Rust?", "body": "<p>Here is the working solution:</p>\n\n<pre><code>extern crate libc;\n\n#[link(name = \"my_dll\")]\nextern {\n   fn create_handle(handle_ptr: *mut *mut i32) -&gt; i32;\n   fn close_handle(handle: *mut i32) -&gt; i32;\n}\n\nfn main() {\n    unsafe {\n        let mut handle: *mut i32 = std::ptr::null_mut();\n        let handle_ptr: *mut *mut i32 = &amp;mut handle;\n\n        let ret = create_handle(handle_ptr);\n        if ret != 0 {\n            panic!(\"return code fail: {0}\", ret);\n        }\n\n        let ret = close_handle(handle);\n        if ret != 0 {\n           panic!(\"return code fail: {0}\", ret);\n        }\n    }\n}\n</code></pre>\n\n<p>The solution was the <code>*mut *mut</code> notation to reference a <code>std::ptr::null_mut()</code>, found on <a href=\"https://stackoverflow.com/q/47878236/155423\">How do I make the equivalent of a C double pointer in Rust?</a>.</p>\n"}], "owner": {"reputation": 57, "user_id": 1860369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/27174b86495bec3bbe40b730a435fcb0?s=128&d=identicon&r=PG", "display_name": "troop357", "link": "https://stackoverflow.com/users/1860369/troop357"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 378, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1571863850, "creation_date": 1571860458, "last_edit_date": 1571863256, "question_id": 58530104, "link": "https://stackoverflow.com/questions/58530104/what-is-the-proper-way-to-use-a-pointer-to-pointer-in-a-foreign-function-in-rust", "title": "What is the proper way to use a pointer to pointer in a foreign function in Rust?", "body": "<p>I have a DLL that exports a bunch of C functions which I'd like to use in Rust. I have the following exported functions that are used to create a handle and delete it for the DLL API, respectively:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>__declspec(dllexport) int create_handle(handle** ptr);\n__declspec(dllexport) int close_handle(handle* h);\n</code></pre>\n\n<p>I tried implementing it in a few different manners such as this:</p>\n\n<pre><code>extern crate libc;\n\nuse libc::{c_int, c_float, c_void};\n\n#[link(name = \"my_dll\")]\nextern {\n   fn create_handle(handle: *mut c_int) -&gt; i32;\n   fn close_handle(handle: i32) -&gt; i32;\n}\n\nfn main() {\n    unsafe {\n        let mut ptr = 0 as i32;\n        let ret = create_handle(&amp;mut ptr);\n        if ret != 0 {\n            panic!(\"return code fail: {0}\", ret);\n        }\n\n        let ret = close_handle(ptr);\n        if ret != 0 {\n            panic!(\"return code fail: {0}\", ret);\n        }\n    }\n}\n</code></pre>\n\n<p>Although <code>ptr</code> is assigned a value, it is not the expected one. The <code>close_handle</code> native function checks if the passed pointer matches the created one. In this code, the second <code>panic!</code> is reached.</p>\n\n<p>I am very new to Rust so the pointer interoperability is not very clear to me at the moment. The native function will do the proper type casting, so should I be using the <code>c_void</code> type? Or is a <code>i32</code> with the pointer value enough? </p>\n"}, {"tags": ["pointers", "rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1571862758, "post_id": 58529934, "comment_id": 103385013, "body": "See also <a href=\"https://stackoverflow.com/q/56066534/155423\">Why is it possible to return a mutable reference to a literal from a function?</a>"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 7, "creation_date": 1571864422, "post_id": 58529934, "comment_id": 103385669, "body": "Regarding your second question: there is no actual need, and <a href=\"https://github.com/rust-lang/rust/pull/63635\" rel=\"nofollow noreferrer\">the beta and nightly versions of Rust don&#39;t create stack allocations for ZSTs anymore</a>."}], "owner": {"reputation": 2106, "user_id": 7191047, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EWSwl.png?s=128&g=1", "display_name": "Danila Kiver", "link": "https://stackoverflow.com/users/7191047/danila-kiver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 448, "favorite_count": 3, "answer_count": 0, "score": 12, "last_activity_date": 1571861256, "creation_date": 1571859606, "last_edit_date": 1571861256, "question_id": 58529934, "link": "https://stackoverflow.com/questions/58529934/why-do-zero-sized-types-cause-real-allocations-in-some-cases", "title": "Why do zero-sized types cause real allocations in some cases?", "body": "<p>I was playing with zero-sized types (ZSTs) as I was curious about how they are actually implemented under the hood. Given that ZSTs do not require any space in memory and taking a raw pointer is a safe operation, I was interested what raw pointers I would get from different kinds of ZST \"allocations\" and how weird (for safe Rust) the results would be.</p>\n\n<p>My first attempt (<code>test_stk.rs</code>) was to take const pointers to a few on-stack instances of ZSTs:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Empty;\nstruct EmptyAgain;\n\nfn main() {\n    let stk_ptr: *const Empty = &amp;Empty;\n    let stk_ptr_again: *const EmptyAgain = &amp;EmptyAgain;\n    let nested_stk_ptr = nested_stk();\n\n    println!(\"Pointer to on-stack Empty:        {:?}\", stk_ptr);\n    println!(\"Pointer to on-stack EmptyAgain:   {:?}\", stk_ptr_again);\n    println!(\"Pointer to Empty in nested frame: {:?}\", nested_stk_ptr);\n}\n\nfn nested_stk() -&gt; *const Empty {\n    &amp;Empty\n}\n</code></pre>\n\n<p>Compiling and running this produced the following result:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ rustc test_stk.rs -o test_stk\n$ ./test_stk \nPointer to on-stack Empty:        0x55ab86fc6000\nPointer to on-stack EmptyAgain:   0x55ab86fc6000\nPointer to Empty in nested frame: 0x55ab86fc6000\n</code></pre>\n\n<p>A short analysis of the process memory map showed that <code>0x55ab86fc6000</code> was actually not a stack allocation, but the very beginning of the <code>.rodata</code> section. This seems logical: the compiler pretends that there is a single zero-sized value for each ZST, known at compile time, and each of these values resides in <code>.rodata</code>, as compile-time constants do.</p>\n\n<p>The second attempt was with boxed ZSTs (<code>test_box.rs</code>):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Empty;\nstruct EmptyAgain;\n\nfn main() {\n    let ptr = Box::into_raw(Box::new(Empty));\n    let ptr_again = Box::into_raw(Box::new(EmptyAgain));\n    let nested_ptr = nested_box();\n\n    println!(\"Pointer to boxed Empty:                 {:?}\", ptr);\n    println!(\"Pointer to boxed EmptyAgain:            {:?}\", ptr_again);\n    println!(\"Pointer to boxed Empty in nested frame: {:?}\", nested_ptr);\n}\n\nfn nested_box() -&gt; *mut Empty {\n    Box::into_raw(Box::new(Empty))\n}\n</code></pre>\n\n<p>Running this snippet gave:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ rustc test_box.rs -o test_box\n$ ./test_box \nPointer to boxed Empty:                 0x1\nPointer to boxed EmptyAgain:            0x1\nPointer to boxed Empty in nested frame: 0x1\n</code></pre>\n\n<p>Quick debugging showed that this is how the allocator works for ZSTs (Rust's <code>liballoc/alloc.rs</code>):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>unsafe fn exchange_malloc(size: usize, align: usize) -&gt; *mut u8 {\n    if size == 0 {\n        align as *mut u8\n    } else {\n        // ...\n    }\n}\n</code></pre>\n\n<p>The minimum possible alignment is 1 (as per the Nomicon), so for ZSTs the <code>box</code> operator calls <code>exchange_malloc(0, 1)</code> and the resulting address is <code>0x1</code>.</p>\n\n<p>After noticing that <code>into_raw()</code> returns a mutable pointer, I decided to retry the previous test (on-stack) with mutable pointers (<code>test_stk_mut.rs</code>):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Empty;\nstruct EmptyAgain;\n\nfn main() {\n    let stk_ptr: *mut Empty = &amp;mut Empty;\n    let stk_ptr_again: *mut EmptyAgain = &amp;mut EmptyAgain;\n    let nested_stk_ptr = nested_stk();\n\n    println!(\"Pointer to on-stack Empty:        {:?}\", stk_ptr);\n    println!(\"Pointer to on-stack EmptyAgain:   {:?}\", stk_ptr_again);\n    println!(\"Pointer to Empty in nested frame: {:?}\", nested_stk_ptr);\n}\n\nfn nested_stk() -&gt; *mut Empty {\n    &amp;mut Empty\n}\n</code></pre>\n\n<p>And running this printed the following:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ rustc test_stk_mut.rs -o test_stk_mut\n$ ./test_stk_mut \nPointer to on-stack Empty:        0x7ffc3817b5e0\nPointer to on-stack EmptyAgain:   0x7ffc3817b5f0\nPointer to Empty in nested frame: 0x7ffc3817b580\n</code></pre>\n\n<p>It turns out that this time I had <strong>real stack-allocated values</strong>, each having its own address! When I tried to declare them sequentially (<code>test_stk_seq.rs</code>), I discovered that each of these values occupied <strong>eight</strong> bytes:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Empty;\n\nfn main() {\n    let mut stk1 = Empty;\n    // &lt;4 times more&gt;\n\n    let stk_ptr1: *mut Empty = &amp;mut stk1;\n    // &lt;4 times more&gt;\n\n    println!(\"Pointer to on-stack Empty:        {:?}\", stk_ptr1);\n    // &lt;4 times more&gt;\n}\n</code></pre>\n\n<p>Run:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ rustc test_stk_seq.rs -o test_stk_seq\n$ ./test_stk_seq \nPointer to on-stack Empty:        0x7ffdba303840\nPointer to on-stack Empty:        0x7ffdba303848\nPointer to on-stack Empty:        0x7ffdba303850\nPointer to on-stack Empty:        0x7ffdba303858\nPointer to on-stack Empty:        0x7ffdba303860\n</code></pre>\n\n<p>So, here are the things I cannot understand:</p>\n\n<ol>\n<li><p>Why do boxed ZST allocations use the dumb <code>0x1</code> address instead of something more meaningful, like in case of \"on-stack\" values?</p></li>\n<li><p>Why is there need to allocate real space for on-stack ZST values when there are mutable raw pointers to them?</p></li>\n<li><p>Why are exactly eight bytes used for mutable on-stack allocations? Should I treat this size as \"0 bytes of actual type size + 8 bytes of alignment\"?</p></li>\n</ol>\n"}, {"tags": ["process", "rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1571855852, "post_id": 58529008, "comment_id": 103382228, "body": "<a href=\"https://doc.rust-lang.org/std/process/struct.Command.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/std/process/struct.Command.html</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571856180, "post_id": 58529008, "comment_id": 103382352, "body": "and <a href=\"https://doc.rust-lang.org/std/env/fn.current_exe.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/std/env/fn.current_exe.html</a>"}, {"owner": {"reputation": 1899, "user_id": 7058363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zppXn.jpg?s=128&g=1", "display_name": "Genarito", "link": "https://stackoverflow.com/users/7058363/genarito"}, "edited": false, "score": 0, "creation_date": 1571856410, "post_id": 58529008, "comment_id": 103382452, "body": "I&#39;ve read the Command docs. But as I understood It starts a <b>child</b> process. So if the parent process finish, the child process will too"}, {"owner": {"reputation": 1899, "user_id": 7058363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zppXn.jpg?s=128&g=1", "display_name": "Genarito", "link": "https://stackoverflow.com/users/7058363/genarito"}, "edited": false, "score": 0, "creation_date": 1571857927, "post_id": 58529008, "comment_id": 103383074, "body": "I&#39;m also testing right now and Command is also blocking"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571859193, "post_id": 58529008, "comment_id": 103383564, "body": "It sounds like you have multiple additional constraints on a given answer, but those constraints are not clearly expressed in the question. If someone had provided an answer with the content of the above suggestions, it seems likely they would have wasted their time. Please help avoid wasting their time (and yours!) by <a href=\"https://stackoverflow.com/posts/58529008/edit\">edit</a>ing and placing <b>all</b> requirements you have in the question (and do so starting with the initial question in the future, please)."}, {"owner": {"reputation": 1899, "user_id": 7058363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zppXn.jpg?s=128&g=1", "display_name": "Genarito", "link": "https://stackoverflow.com/users/7058363/genarito"}, "edited": false, "score": 0, "creation_date": 1571862009, "post_id": 58529008, "comment_id": 103384701, "body": "I don&#39;t know what are the new requeriments you&#39;re talking about. I&#39;ve edited the question to talk about independence, but I think It was explicit in the title. That&#39;s why a Child process does not work for me. Also, as the last comment in the program indicates, I need a non blocking solution. Thank you!"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1571862356, "post_id": 58529008, "comment_id": 103384847, "body": "<i><code>Command</code> is not a solution for me as it waits for the process to finish</i> \u2014 the documentation directly contradicts your point: <a href=\"https://doc.rust-lang.org/std/process/struct.Child.html\" rel=\"nofollow noreferrer\">The standard library does not automatically wait on child processes (not even if the <code>Child</code> is dropped), it is up to the application developer to do so</a>. Are you saying that the documentation is incorrect?"}, {"owner": {"reputation": 1899, "user_id": 7058363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zppXn.jpg?s=128&g=1", "display_name": "Genarito", "link": "https://stackoverflow.com/users/7058363/genarito"}, "edited": false, "score": 0, "creation_date": 1571864908, "post_id": 58529008, "comment_id": 103385836, "body": "My bad! I don&#39;t know why a child process still works even Its parent has finished... But It worked! If you want to submit an answer I&#39;ll accept It as the correct one. If you don&#39;t want to, I&#39;ll submit my own later. Thank so much"}], "owner": {"reputation": 1899, "user_id": 7058363, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zppXn.jpg?s=128&g=1", "display_name": "Genarito", "link": "https://stackoverflow.com/users/7058363/genarito"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 162, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571864676, "creation_date": 1571855323, "last_edit_date": 1571864676, "question_id": 58529008, "link": "https://stackoverflow.com/questions/58529008/is-there-a-way-to-execute-a-rust-function-in-an-independent-process", "title": "Is there a way to execute a Rust function in an independent process?", "body": "<p>I have a program that takes an argument called <code>start-master</code>. When it is passed, I need to start a daemon listening on a port.</p>\n\n<p>I have a function:</p>\n\n<pre><code>fn startMaster() {\n    // Sockets, connections, logic, etc\n}\n</code></pre>\n\n<p>Can I make a new process that executes <code>startMaster</code> in the background so that a user can call <code>./mainprogram start-master</code> without using bash's <code>&amp;</code>? </p>\n\n<p>The process has to be independent from the main process as it must not stop when the caller process finishes. I need a non blocking solution.</p>\n\n<p>My main program would be:</p>\n\n<pre><code>fn main() {\n    let args: Vec&lt;String&gt; = env::args().collect();\n    let arg1 = &amp;args[1];\n    // ...\n    match arg1.as_ref() {\n        \"start-master\" =&gt; {\n            // Starts process in background which executes startMaster function\n        }\n        _ =&gt; println!(\"Not valid argument\")\n    }\n\n    // Ends program but now there is an active daemon \n}\n</code></pre>\n"}, {"tags": ["vector", "types", "rust", "slice"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571852554, "post_id": 58528260, "comment_id": 103380819, "body": "It&#39;s hard to answer your question because it doesn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. We can&#39;t tell what the methods <code>permutation</code> and <code>combination</code>, etc. are. Perhaps you can remove them? It would make it easier for us to help you if you try to reproduce your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> if possible, otherwise in a brand new Cargo project, then <a href=\"https://stackoverflow.com/posts/58528260/edit\">edit</a> your question to include the additional info. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MRE tips</a> you can use to reduce your original code for posting here. Thanks!"}, {"owner": {"reputation": 1114, "user_id": 10111567, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Miguel", "link": "https://stackoverflow.com/users/10111567/miguel"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571852586, "post_id": 58528260, "comment_id": 103380833, "body": "It is  a library I forgot to include it."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571852603, "post_id": 58528260, "comment_id": 103380839, "body": "Don&#39;t include it if you can make the problem minimal instead."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571852664, "post_id": 58528260, "comment_id": 103380864, "body": "Please paste the exact and entire error that you&#39;re getting \u2014 that will help us to understand what the problem is so we can help best. Sometimes trying to interpret an error message is tricky and it&#39;s actually a different part of the error message that&#39;s important."}, {"owner": {"reputation": 5513, "user_id": 2718801, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d4b144cdafa73e1d470362ed8d7c3a9?s=128&d=identicon&r=PG", "display_name": "jhpratt", "link": "https://stackoverflow.com/users/2718801/jhpratt"}, "edited": false, "score": 0, "creation_date": 1571852886, "post_id": 58528260, "comment_id": 103380970, "body": "Looks like you just need to tell the compiler the exact type."}, {"owner": {"reputation": 1114, "user_id": 10111567, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Miguel", "link": "https://stackoverflow.com/users/10111567/miguel"}, "edited": false, "score": 0, "creation_date": 1571853093, "post_id": 58528260, "comment_id": 103381061, "body": "So the thing is, it stays C is a Vec of &amp;integers. If I declare actions as Vec&lt;Vec&lt;&amp;u32&gt;&gt; then I need to put &#39;static on the return, and then the elements are all &amp;integers instead of u32, I want the elements of the vectors to be normal integers"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571853176, "post_id": 58528260, "comment_id": 103381092, "body": "Where do you believe that your inner <code>Vec</code> is created?"}, {"owner": {"reputation": 1114, "user_id": 10111567, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Miguel", "link": "https://stackoverflow.com/users/10111567/miguel"}, "edited": false, "score": 0, "creation_date": 1571853427, "post_id": 58528260, "comment_id": 103381200, "body": "I thought when I called &quot;data.combination...&quot; It would return a new vec structure? I do not understand what &quot;c&quot; is and how can I save it. It is weird because it says it is a Vec&lt;&amp;integer&gt;."}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1571906088, "post_id": 58528260, "comment_id": 103397028, "body": "You have a vector of references to integers, which you need to convert to a vector of straight integers. Try with <code>actions.push (c.iter().cloned().collect())</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1114, "user_id": 10111567, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Miguel", "link": "https://stackoverflow.com/users/10111567/miguel"}, "edited": false, "score": 0, "creation_date": 1571929884, "post_id": 58544278, "comment_id": 103409917, "body": "If anyone has a better way of doing this please feel free to answer. The original question is a bit over complicated and if mods think this is too confusing feel free to close/delete the post."}], "tags": [], "owner": {"reputation": 1114, "user_id": 10111567, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Miguel", "link": "https://stackoverflow.com/users/10111567/miguel"}, "is_accepted": false, "score": 0, "last_activity_date": 1571929879, "creation_date": 1571929879, "answer_id": 58544278, "question_id": 58528260, "link": "https://stackoverflow.com/questions/58528260/why-do-i-get-expected-u32-found-integer-when-pushing-into-a-vector-using-i/58544278#58544278", "title": "Why do I get &quot;expected u32, found &amp;{integer}&quot; when pushing into a vector using iterators from the permutator crate?", "body": "<p>I've found a way to solve this that is very ugly but since I'm new at the language it was the best I could come up with.</p>\n\n<p>The main problem seems to be that I have a Vec of references to integers instead of a Vector of integers so I changed it with a temporary variable:</p>\n\n<pre><code>            let mut temp:Vec&lt;u32&gt; = vec![];\n            for z in c.iter(){\n                temp.push(**z);\n            }\n            actions.push(temp);\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1114, "user_id": 10111567, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Miguel", "link": "https://stackoverflow.com/users/10111567/miguel"}, "edited": false, "score": 0, "creation_date": 1572006899, "post_id": 58549413, "comment_id": 103436305, "body": "Thanks for the thorough description. I just had to use actions.push(c.clone) instead because c is being borrowed in the &quot;3rd for&quot; after being moved in the &quot;push&quot;. What is the difference between the for and the for_each here? Since in rust you can always use for to iterate over any iterable, right? I used the for_each because it showed up in some code example for this library."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "reply_to_user": {"reputation": 1114, "user_id": 10111567, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Miguel", "link": "https://stackoverflow.com/users/10111567/miguel"}, "edited": false, "score": 1, "creation_date": 1572010778, "post_id": 58549413, "comment_id": 103438309, "body": "Ah, sorry -- I didn&#39;t test this because I was at work. Added the <code>clone()</code>. If the order of <code>actions</code> is not important, you could also move <code>actions.push(c)</code> to after the third <code>for</code> loop to avoid having to clone it."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "reply_to_user": {"reputation": 1114, "user_id": 10111567, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Miguel", "link": "https://stackoverflow.com/users/10111567/miguel"}, "edited": false, "score": 1, "creation_date": 1572010787, "post_id": 58549413, "comment_id": 103438315, "body": "There&#39;s no semantic difference between <code>for x in y {...}</code> and <code>y.for_each(|x| {...});</code> but because the first one is dedicated syntax and less visually noisy I prefer to use it. <code>for_each</code> can technically be more performant in certain situations (<a href=\"https://medium.com/@veedrac/rust-is-slow-and-i-am-the-cure-32facc0fdcb\" rel=\"nofollow noreferrer\">this article is a place to start understanding why</a>), but it comes with other tradeoffs, so I recommend you normally use <code>for</code> and only use <code>for_each</code> when <code>for</code> happens to be slow or ugly for some reason."}], "tags": [], "owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "is_accepted": true, "score": 3, "last_activity_date": 1572011855, "last_edit_date": 1572011855, "creation_date": 1571952852, "answer_id": 58549413, "question_id": 58528260, "link": "https://stackoverflow.com/questions/58528260/why-do-i-get-expected-u32-found-integer-when-pushing-into-a-vector-using-i/58549413#58549413", "title": "Why do I get &quot;expected u32, found &amp;{integer}&quot; when pushing into a vector using iterators from the permutator crate?", "body": "<blockquote>\n  <p>When trying <code>actions.push(c.iter().cloned().collect())</code> it returns the following error...</p>\n</blockquote>\n\n<p>This happens because <code>c</code> is a <code>Vec&lt;&amp;u32&gt;</code>, and <code>.iter()</code> iterates over references to items, so <code>c.iter()</code> is an iterator over <code>&amp;&amp;u32</code>s. <code>.cloned()</code> removes one of the <code>&amp;</code>s but not the second one. You could fix this by adding another <code>.cloned()</code> (or <code>.copied()</code>), but I prefer to use <code>.map</code>:</p>\n\n<pre><code>actions.push(c.iter().map(|c| **c).collect());\n</code></pre>\n\n<p>If you don't need to keep around the references, you can instead shadow <code>c</code> with a <code>Vec&lt;u32&gt;</code> to use inside the loop:</p>\n\n<pre><code>let c: Vec&lt;u32&gt; = c.into_iter().cloned().collect();\n</code></pre>\n\n<p><code>cloned</code> works here because <code>c.into_iter()</code>, unlike <code>c.iter()</code>, consumes the <code>Vec&lt;u32&gt;</code> to return an iterator over <code>u32</code>s.</p>\n\n<p>I also don't see a good reason to use <code>for_each</code> here in place of a regular <code>for</code> loop. Here's how I would suggest writing <code>init</code>:</p>\n\n<pre><code>pub fn init() -&gt; Vec&lt;Vec&lt;u32&gt;&gt; {\n    let actions: Vec&lt;Vec&lt;u32&gt;&gt;;\n    let data = &amp;[1, 2, 3];\n    let mut counter = 1;\n    for i in 1..=data.len() {\n        for c in data.combination(i) {\n            let mut c = c.into_iter().cloned().collect();\n            println!(\"{:?}\", c);\n            actions.push(c.clone());\n            for p in c.permutation() {\n                println!(\"k-perm@{} = {:?}\", counter, p);\n                counter += 1;\n                actions.push(p);\n            }\n        }\n    }\n    actions\n}\n</code></pre>\n\n<p><code>actions.push(p)</code> works here without <code>.into_iter().cloned().collect()</code> because <code>permutator::HeapPermutationIterator</code> does the cloning internally.</p>\n"}], "owner": {"reputation": 1114, "user_id": 10111567, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Miguel", "link": "https://stackoverflow.com/users/10111567/miguel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 626, "favorite_count": 0, "accepted_answer_id": 58549413, "answer_count": 2, "score": 2, "last_activity_date": 1572011855, "creation_date": 1571852233, "last_edit_date": 1571928490, "question_id": 58528260, "link": "https://stackoverflow.com/questions/58528260/why-do-i-get-expected-u32-found-integer-when-pushing-into-a-vector-using-i", "title": "Why do I get &quot;expected u32, found &amp;{integer}&quot; when pushing into a vector using iterators from the permutator crate?", "body": "<p>I wanted to create a function that returns a data structure with all possible combinations for a certain group of numbers: e.g.: for <code>[1, 2, 3]</code> return <code>[[1], [2], [3], [1, 2], [2,1], ..., [1, 2, 3], [2, 1, 3], ...[3, 2, 1]]</code>.</p>\n\n<p>I understand that <code>c</code> and <code>p</code> are some kind of vector of <code>&amp;integer</code>, but I cannot find a way to save them into an array or vector. I was trying to save it as a vector of vectors since I do not think it is possible to save them as a vector of arrays, since the arrays have different sizes. It's also not possible as an array of vectors since I do not know the number of combinations at the start.  </p>\n\n<p>How can I store all <code>c</code> and <code>p</code> in a data structure so that it can be returned and used outside?</p>\n\n<pre><code>use permutator::{Combination, Permutation}; // 0.3.3\n\npub fn init() -&gt; Vec&lt;Vec&lt;u32&gt;&gt; {\n    let actions: Vec&lt;Vec&lt;u32&gt;&gt;;\n    let mut data = &amp;[1, 2, 3];\n    let mut counter = 1;\n    for i in 1..=data.len() {\n        data.combination(i).for_each(|mut c| {\n            println!(\"{:?}\", c);\n            actions.push(c);\n            c.permutation().for_each(|p| {\n                println!(\"k-perm@{} = {:?}\", counter, p);\n                counter += 1;\n                actions.push(p);\n            });\n        });\n    }\n    actions\n}\n</code></pre>\n\n<p>The error I'm getting is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n  --&gt; src/main.rs:10:26\n   |\n10 |             actions.push(c);\n   |                          ^ expected u32, found &amp;{integer}\n   |\n   = note: expected type `std::vec::Vec&lt;u32&gt;`\n              found type `std::vec::Vec&lt;&amp;{integer}&gt;`\n\nerror[E0308]: mismatched types\n  --&gt; src/main.rs:14:30\n   |\n14 |                 actions.push(p);\n   |                              ^ expected u32, found &amp;{integer}\n   |\n   = note: expected type `std::vec::Vec&lt;u32&gt;`\n              found type `std::vec::Vec&lt;&amp;{integer}&gt;`\n</code></pre>\n\n<p><strong>edit:</strong>\nWhen trying <code>actions.push(c.iter().cloned().collect())</code> it returns the following error:</p>\n\n<pre><code>error[E0277]: a collection of type `std::vec::Vec&lt;u32&gt;` cannot be built from an iterator over elements of type `&amp;u32`\n  --&gt; src/rl.rs:59:44\n   |\n59 |             actions.push(c.iter().cloned().collect());\n   |                                            ^^^^^^^ a collection of type `std::vec::Vec&lt;u32&gt;` cannot be built from `std::iter::Iterator&lt;Item=&amp;u32&gt;`\n   |\n   = help: the trait `std::iter::FromIterator&lt;&amp;u32&gt;` is not implemented for `std::vec::Vec&lt;u32&gt;`\n\n\n</code></pre>\n"}, {"tags": ["rust", "closures"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1571847240, "post_id": 58526867, "comment_id": 103378502, "body": "TL;DR the duplicates: the <b>body</b> of the closure determines what traits are implemented. Your closure only takes references to the value, so it can be called multiple times."}], "owner": {"reputation": 1194, "user_id": 1191070, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JPU4k.jpg?s=128&g=1", "display_name": "Patrik Stas", "link": "https://stackoverflow.com/users/1191070/patrik-stas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 698, "favorite_count": 0, "closed_date": 1571847026, "answer_count": 0, "score": 2, "last_activity_date": 1571847120, "creation_date": 1571846352, "last_edit_date": 1571847082, "question_id": 58526867, "link": "https://stackoverflow.com/questions/58526867/why-is-a-closure-using-the-move-keyword-not-inferred-as-fnonce", "closed_reason": "Duplicate", "title": "Why is a closure using the `move` keyword not inferred as FnOnce?", "body": "<p>I am playing with examples from <a href=\"https://medium.com/swlh/understanding-closures-in-rust-21f286ed1759\" rel=\"nofollow noreferrer\">Understanding Closures in Rust.</a>. I defined the following structure:</p>\n\n<pre><code>struct MyStruct {\n    text: &amp;'static str,\n    number: u32,\n}\n\nimpl MyStruct {\n    fn new(text: &amp;'static str, number: u32) -&gt; MyStruct {\n        MyStruct {\n            text: text,\n            number: number,\n        }\n    }\n    // We have to specify that 'self' is an argument.\n    fn get_number(&amp;self) -&gt; u32 {\n        self.number\n    }\n    // We can specify different kinds of ownership and mutability of self.\n    fn inc_number(&amp;mut self) {\n        self.number += 1;\n    }\n    // There are three different types of 'self'\n    fn destructor(self) {\n        println!(\"Destructing {}\", self.text);\n    }\n}\n</code></pre>\n\n<p>I created these \"testing\" functions to classify a closure based on compile time errors:</p>\n\n<pre><code>fn is_fn&lt;A, R&gt;(_x: fn(A) -&gt; R) {}\nfn is_Fn&lt;A, R, F: Fn(A) -&gt; R&gt;(_x: &amp;F) {}\nfn is_FnMut&lt;A, R, F: FnMut(A) -&gt; R&gt;(_x: &amp;F) {}\nfn is_FnOnce&lt;A, R, F: FnOnce(A) -&gt; R&gt;(_x: &amp;F) {}\n</code></pre>\n\n<p>The article demonstrates following example as a <code>FnOnce</code> closure:</p>\n\n<pre><code>let obj1 = MyStruct::new(\"Hello\", 15);\nlet obj2 = MyStruct::new(\"More Text\", 10);\n// obj1 is owned by the closure\nlet mut closure4 = move |x: &amp;MyStruct| {\n    obj1.destructor();\n    x.get_number()\n};\nis_FnMut(&amp;closure4);\n</code></pre>\n\n<p>This has a compilation error: </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0525]: expected a closure that implements the `FnMut` trait, but this closure only implements `FnOnce`\n  --&gt; src/main.rs:36:24\n   |\n36 |     let mut closure4 = move |x: &amp;MyStruct| {\n   |                        ^^^^^^^^^^^^^^^^^^^ this closure implements `FnOnce`, not `FnMut`\n37 |         obj1.destructor();\n   |         ---- closure is `FnOnce` because it moves the variable `obj1` out of its environment\n...\n40 |     is_FnMut(&amp;closure4);\n   |     -------- the requirement to implement `FnMut` derives from here\n</code></pre>\n\n<p>That makes sense. From my understanding, the compiler infers that the value is moved into the closure because the destructor is called.</p>\n\n<p>I was trying to see what else causes the closure to be inferred as <code>FnOnce</code>. I declared the closure as a <code>move</code> closure:</p>\n\n<pre><code>let obj1 = MyStruct::new(\"Hello\", 15);\nlet obj2 = MyStruct::new(\"More Text\", 10);\n// obj1 is owned by the closure\nlet mut closure4 = move |x: &amp;MyStruct| {\n    obj1.get_number();\n    x.get_number()\n};\nis_Fn(&amp;closure4);\nis_FnMut(&amp;closure4);\n</code></pre>\n\n<p>To my surprise, this actually passes, so this closure is actually considered to be also <code>Fn</code>, not exclusively <code>FnOnce</code> as I expected. Why is that? I thought if a value is moved into closure, it wouldn't implement <code>Fn</code> but only <code>FnOnce</code>.</p>\n\n<p>So I though, \"Okay, maybe somehow <code>obj1</code> is not really moved into the closure, let me test that\". So I tried to use <code>obj1</code> in any way after constructing <code>closure4</code>, the compiler indicates that <code>obj1</code> was indeed moved into the closure:</p>\n\n<pre><code>let obj1 = MyStruct::new(\"Hello\", 15);\nlet obj2 = MyStruct::new(\"More Text\", 10);\n// obj1 is owned by the closure\nlet mut closure4 = move |x: &amp;MyStruct| {\n    obj1.get_number();\n    x.get_number()\n};\nobj1.get_number();\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0382]: borrow of moved value: `obj1`\n  --&gt; src/main.rs:40:5\n   |\n33 |     let obj1 = MyStruct::new(\"Hello\", 15);\n   |         ---- move occurs because `obj1` has type `MyStruct`, which does not implement the `Copy` trait\n...\n36 |     let mut closure4 = move |x: &amp;MyStruct| {\n   |                        ------------------- value moved into closure here\n37 |         obj1.get_number();\n   |         ---- variable moved due to use in closure\n...\n40 |     obj1.get_number();\n   |     ^^^^ value borrowed here after move\n</code></pre>\n\n<p>Can someone enlighten this behaviour for me? What must hold true for a closure to implement none of <code>fn</code>, <code>Fn</code>, <code>FnMut</code>, but only implement <code>FnOnce</code>?</p>\n"}, {"tags": ["rust", "runtime", "static-linking", "libc"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1571846225, "post_id": 58526782, "comment_id": 103377985, "body": "Did you try this answer? <a href=\"https://stackoverflow.com/a/44387312/4498831\">stackoverflow.com/a/44387312/4498831</a>"}, {"owner": {"reputation": 11828, "user_id": 1175080, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5c1ca2e94db0e6c1dba18ddd8d563216?s=128&d=identicon&r=PG", "display_name": "Lone Learner", "link": "https://stackoverflow.com/users/1175080/lone-learner"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1571846374, "post_id": 58526782, "comment_id": 103378069, "body": "@FrenchBoiethios That answer is meant for Windows."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1571846556, "post_id": 58526782, "comment_id": 103378152, "body": "See also <a href=\"https://unix.stackexchange.com/q/505868/74536\">Static linking libc, possible or not, recommended or not?</a> and <a href=\"https://sourceware.org/glibc/wiki/FAQ#Even_statically_linked_programs_need_some_shared_libraries_which_is_not_acceptable_for_me.__What_can_I_do.3F\" rel=\"nofollow noreferrer\">Even statically linked programs need some shared libraries which is not acceptable for me. What can I do?</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571853449, "post_id": 58526782, "comment_id": 103381206, "body": "Do you have a static version of glibc on your system?"}, {"owner": {"reputation": 11828, "user_id": 1175080, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5c1ca2e94db0e6c1dba18ddd8d563216?s=128&d=identicon&r=PG", "display_name": "Lone Learner", "link": "https://stackoverflow.com/users/1175080/lone-learner"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571975595, "post_id": 58526782, "comment_id": 103424267, "body": "@Shepmaster How can I check if static version of glibc is available on my system? <code>apt-cache search glibc | grep static</code> turns up no results. But there is <code>&#47;usr&#47;lib&#47;x86_64-linux-gnu&#47;libc.a</code> on my system. Also, as explained in my question above <code>gcc -static -o cfoo foo.c</code> produces a static binary. So I am guessing static glibc is present on my system. Am I right?"}], "answers": [{"tags": [], "owner": {"reputation": 90851, "user_id": 27009, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f0a29af415477aa8c498a4f41ffe6640?s=128&d=identicon&r=PG", "display_name": "Kornel", "link": "https://stackoverflow.com/users/27009/kornel"}, "is_accepted": false, "score": 1, "last_activity_date": 1572579807, "creation_date": 1572579807, "answer_id": 58653837, "question_id": 58526782, "link": "https://stackoverflow.com/questions/58526782/how-can-i-create-a-static-executable-with-rustc-using-glibc-instead-of-musl/58653837#58653837", "title": "How can I create a static executable with rustc using glibc instead of musl?", "body": "<p>You need to compile for MUSL, otherwise Rust will depend on your libc.</p>\n\n<p><a href=\"https://doc.rust-lang.org/edition-guide/rust-2018/platform-and-target-support/musl-support-for-fully-static-binaries.html\" rel=\"nofollow noreferrer\">https://doc.rust-lang.org/edition-guide/rust-2018/platform-and-target-support/musl-support-for-fully-static-binaries.html</a></p>\n"}], "owner": {"reputation": 11828, "user_id": 1175080, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5c1ca2e94db0e6c1dba18ddd8d563216?s=128&d=identicon&r=PG", "display_name": "Lone Learner", "link": "https://stackoverflow.com/users/1175080/lone-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 789, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1572579807, "creation_date": 1571846057, "last_edit_date": 1571853349, "question_id": 58526782, "link": "https://stackoverflow.com/questions/58526782/how-can-i-create-a-static-executable-with-rustc-using-glibc-instead-of-musl", "title": "How can I create a static executable with rustc using glibc instead of musl?", "body": "<p>I wrote simple code in C, Go and Rust.</p>\n\n<p>foo.c</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    printf(\"hello\\n\");\n    return 0;\n}\n</code></pre>\n\n<p>foo.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"hello\");\n}\n</code></pre>\n\n<p>foo.rs</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    println!(\"hello\");\n}\n</code></pre>\n\n<p>Then I built them all.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ gcc -static -o cfoo foo.c\n$ go build -o gofoo foo.go\n$ rustc -o rustfoo foo.rs\n</code></pre>\n\n<p>They run fine.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ ./cfoo; ./gofoo; ./rustfoo\nhello\nhello\nhello\n</code></pre>\n\n<p>The binary of Rust executable was too small compared to the other two, so I suspected that it is not a static executable.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ ls -l cfoo gofoo rustfoo\n-rwxr-xr-x 1 lone lone  755744 Oct 23 21:17 cfoo\n-rwxr-xr-x 1 lone lone 1906945 Oct 23 21:17 gofoo\n-rwxr-xr-x 1 lone lone  253528 Oct 23 21:17 rustfoo\n</code></pre>\n\n<p>I confirmed that Rust does not produce a static executable.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ ldd cfoo gofoo rustfoo\ncfoo:\n    not a dynamic executable\ngofoo:\n    not a dynamic executable\nrustfoo:\n    linux-vdso.so.1 (0x00007ffe6dfb7000)\n    libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fd8d9b75000)\n    librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007fd8d9b6b000)\n    libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007fd8d9b4a000)\n    libgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007fd8d9b30000)\n    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fd8d996f000)\n    /lib64/ld-linux-x86-64.so.2 (0x00007fd8d9bbb000)\n</code></pre>\n\n<p>Is there any way to produce a static executable for Rust?</p>\n\n<p>I checked other similar answers and they talk about using musl. Is there no way to produce a static executable with glibc? If I must use an alternate way, can you provide a step by step with commands to produce a static executable with <code>rustc</code>?</p>\n"}, {"tags": ["sql-server", "database", "rust"], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 3801517, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3RNbt.gif?s=128&g=1", "display_name": "Niklas Hallqvist", "link": "https://stackoverflow.com/users/3801517/niklas-hallqvist"}, "is_accepted": false, "score": 0, "last_activity_date": 1579614515, "creation_date": 1579614515, "answer_id": 59842580, "question_id": 58524688, "link": "https://stackoverflow.com/questions/58524688/how-to-execute-a-collection-of-statements-in-tiberius/59842580#59842580", "title": "How to execute a collection of statements in Tiberius?", "body": "<p>There are actual two questions here:</p>\n\n<ol>\n<li>The header question: how to perform multiple sequential statements using tiberius?</li>\n<li>The specific question concerning why an error message comes from a specific bit of code.\nI will answer them separately.</li>\n</ol>\n\n<p>Multiple statements</p>\n\n<p>There are many ways to skin a cat.  In TDS (the underlying protocol Tiberius is implementing) there is the possibility to execute several statements in a single command.  They just need to be delimited by using semicolon. The response from such an execution is in Tiberius represented a stream of futures, one for each statement.\nSo if your chain of statements is not too big to fit into one command, just build one string and send it over:</p>\n\n<pre><code>fn main() { \n    let mut files: Vec&lt;String&gt; = Vec::new(); \n    find_files(&amp;mut files); \n    let stmts = vec![ \n        String::from( \n            \"CREATE TABLE db.dbo.[Filenames] ( [Spalte 0] varchar(80) )\")] \n        .into_iter() \n        .chain(files.iter().map(|k| \n            format!(\"INSERT INTO db.dbo.Filenames ([Spalte 0]) VALUES ('{}')\", k))) \n        .collect::&lt;Vec&lt;_&gt;&gt;() \n        .join(\";\"); \n\n    let future \n        = SqlConnection::connect(std::env::var(\"CONN_STR\").unwrap().as_str()) \n            .and_then(|conn| \n                conn.simple_exec(stmts) \n                    .into_stream() \n                    .and_then(|future| future) \n                    .for_each(|_| Ok(()))); \n\n    current_thread::block_on_all(future).unwrap(); \n} \n</code></pre>\n\n<p>There is some simple boilerplate in that example.</p>\n\n<ul>\n<li><code>simple_exec</code> returns an <code>ExecResult</code>, a wrapper around the individual statement's future results.  Calling `into_stream() on that provides a stream of those futures.</li>\n<li>That stream of results need to be forced to be carried out, one way of doing that is to call <code>and_then</code>, which awaits each future and does something with it.</li>\n<li>We don't actually care about the results here, so we just do a noop <code>for_each</code>.</li>\n</ul>\n\n<p>But, say that there is a <em>lot</em> of statements, more than can fit in a single TDS command, then there is a need to issue them separately (another case is when the statements themselves depend on earlier ones).  A version of that problem is solved in <a href=\"https://stackoverflow.com/questions/50850309/how-do-i-iterate-over-a-vec-of-functions-returning-futures-in-rust\">How do I iterate over a Vec of functions returning Futures in Rust?</a> .</p>\n\n<p>Then finally, what is your specific error?  Well <code>conn</code> is <em>consumed</em> by <code>simple_exec</code>, so it cannot be used afterwards, that is what the error tells you.  If you want to use the connection after that execution is done you <em>have</em> to use the <code>Future</code> it returns, which is wrapping the mutated connection.  I defer to the link above, on one way to do that.</p>\n"}], "owner": {"reputation": 41, "user_id": 6748084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/572cc1ecb1e54176a7d371ab0c814189?s=128&d=identicon&r=PG&f=1", "display_name": "Serbroda", "link": "https://stackoverflow.com/users/6748084/serbroda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1579614515, "creation_date": 1571839510, "last_edit_date": 1571839800, "question_id": 58524688, "link": "https://stackoverflow.com/questions/58524688/how-to-execute-a-collection-of-statements-in-tiberius", "title": "How to execute a collection of statements in Tiberius?", "body": "<p>I could not figure out how to iterate over a collection and execute statements one by one with Tiberius.</p>\n\n<p>My current code looks like this (simplified):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use futures::Future;\nuse futures_state_stream::StateStream;\nuse tokio::executor::current_thread;\nuse tiberius::SqlConnection;\n\nfn find_files(files: &amp;mut Vec&lt;String&gt;) {\n    files.push(String::from(\"file1.txt\"));\n    files.push(String::from(\"file2.txt\"));\n    files.push(String::from(\"file3.txt\"));\n}\n\nfn main() {\n    let mut files: Vec&lt;String&gt; = Vec::new();\n    find_files(&amp;mut files);\n\n    let future = SqlConnection::connect(CONN_STR)\n        .and_then(|conn| {\n            conn.simple_exec(\"CREATE TABLE db.dbo.[Filenames] ( [Spalte 0] varchar(80) );\")\n        })\n        .and_then(|(_, conn)| {\n            for k in files.iter() {\n                let sql = format!(\"INSERT INTO db.dbo.Filenames ([Spalte 0]) VALUES ('{}')\", k);\n                &amp;conn.simple_exec(sql);\n            }\n            Ok(())\n        });\n\n    current_thread::block_on_all(future).unwrap();\n}\n</code></pre>\n\n<p>I got the following error message</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0382]: use of moved value: `conn`\n  --&gt; src/main.rs:23:18\n   |\n20 |         .and_then(|(_, conn)| {\n   |                        ---- move occurs because `conn` has type `tiberius::SqlConnection&lt;std::boxed::Box&lt;dyn tiberius::BoxableIo&gt;&gt;`, which does not implement the `Copy` trait\n...\n23 |                 &amp;conn.simple_exec(sql);\n   |                  ^^^^ value moved here, in previous iteration of loop\n</code></pre>\n\n<p>I'm new to Rust but I know there is something wrong with the use of the <code>conn</code> variable but nothing works. </p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 1, "creation_date": 1571841367, "post_id": 58524056, "comment_id": 103375415, "body": "Not quite sure what you mean... but wouldn&#39;t placing <code>[build] target = &quot;yourtarget&quot;</code> in <code>.cargo&#47;config</code> do the trick?"}, {"owner": {"reputation": 67096, "user_id": 265521, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/34a66330977044d70165288c56740d4b?s=128&d=identicon&r=PG", "display_name": "Timmmm", "link": "https://stackoverflow.com/users/265521/timmmm"}, "reply_to_user": {"reputation": 16233, "user_id": 4253229, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-e2FAQvlj5CQ/AAAAAAAAAAI/AAAAAAAAAqM/TlSnekirgNE/photo.jpg?sz=128", "display_name": "Eugene Sh.", "link": "https://stackoverflow.com/users/4253229/eugene-sh"}, "edited": false, "score": 0, "creation_date": 1572603803, "post_id": 58524056, "comment_id": 103618300, "body": "Wouldn&#39;t that always mean it uses <code>yourtarget</code>? That isn&#39;t what I want. I want it to use its default target but to put it in a directory with the name of that target."}], "owner": {"reputation": 67096, "user_id": 265521, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/34a66330977044d70165288c56740d4b?s=128&d=identicon&r=PG", "display_name": "Timmmm", "link": "https://stackoverflow.com/users/265521/timmmm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1571837674, "creation_date": 1571837470, "last_edit_date": 1571837674, "question_id": 58524056, "link": "https://stackoverflow.com/questions/58524056/is-there-a-way-to-make-cargo-build-always-include-the-targets-name-in-the-outpu", "title": "Is there a way to make cargo build always include the target&#39;s name in the output directory?", "body": "<p>By default, <code>cargo build</code> will put its output in <code>target/debug/</code>, and <code>cargo build --target foo</code> will put it in <code>target/foo/debug/</code> <em>even if it is the same target!</em></p>\n\n<p>Is there a way to make <code>cargo build</code> always put its output in <code>target/&lt;default_target&gt;/debug</code> without having to specify <code>--target</code>?</p>\n"}, {"tags": ["struct", "rust"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1571837131, "post_id": 58523797, "comment_id": 103372826, "body": "What&#39;s the error? It will be easier for someone to answer if you provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 2, "creation_date": 1571837396, "post_id": 58523797, "comment_id": 103373002, "body": "As written, <code>Bond</code> <i>owns</i> two <code>Atom</code>s. If you construct a <code>Bond</code> from <code>Atom</code>s that are already owned by a <code>Vec</code>, then you will need to clone them or else you would invalidate the <code>Vec</code> (which would cause an error along the lines of <i>&quot;cannot move out of index of <code>std::vec::Vec&lt;Atom&gt;</code>&quot;</i>). Probably you want the fields of <code>Bond</code> to be <code>&amp;Atom</code>, \u2014 or possibly <code>Rc&lt;Atom&gt;</code>, depending on how you need them to be shared."}, {"owner": {"reputation": 756, "user_id": 8960078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b4df0a57a0df19a686508ee126a5e2c?s=128&d=identicon&r=PG&f=1", "display_name": "QuantumChris", "link": "https://stackoverflow.com/users/8960078/quantumchris"}, "reply_to_user": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1571837424, "post_id": 58523797, "comment_id": 103373023, "body": "@PeterHall, I&#39;ve edited in the error I get when compiling"}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1571837558, "post_id": 58523797, "comment_id": 103373102, "body": "See also: <a href=\"https://stackoverflow.com/questions/30288782/what-are-move-semantics-in-rust/30289815\" title=\"what are move semantics in rust\">stackoverflow.com/questions/30288782/&hellip;</a>"}, {"owner": {"reputation": 756, "user_id": 8960078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b4df0a57a0df19a686508ee126a5e2c?s=128&d=identicon&r=PG&f=1", "display_name": "QuantumChris", "link": "https://stackoverflow.com/users/8960078/quantumchris"}, "reply_to_user": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1571837587, "post_id": 58523797, "comment_id": 103373124, "body": "I tried making the <code>Bond</code> struct contain references <code>&amp;Atom</code> but that required a lifetime specifier which I couldn&#39;t get to work either."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 2, "creation_date": 1571838219, "post_id": 58523797, "comment_id": 103373488, "body": "As it stands, no one can answer your question in a way that is useful to other people coming along later. It would devolve into a series of solutions to each new problem, until your very specific code is written for you. Writing a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> will help you focus on, and fully understand, one isolated problem at a time. You can write a new question (or hopefully find an existing answer) if that leads to new problems in your real code."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571838616, "post_id": 58523797, "comment_id": 103373709, "body": "Try to reproduce your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> if possible, otherwise in a brand new Cargo project, then <a href=\"https://stackoverflow.com/posts/58523797/edit\">edit</a> your question to include the additional info. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MRE tips</a> you can use to reduce your original code for posting here. Thanks!"}, {"owner": {"reputation": 756, "user_id": 8960078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b4df0a57a0df19a686508ee126a5e2c?s=128&d=identicon&r=PG&f=1", "display_name": "QuantumChris", "link": "https://stackoverflow.com/users/8960078/quantumchris"}, "edited": false, "score": 0, "creation_date": 1571838937, "post_id": 58523797, "comment_id": 103373890, "body": "I&#39;ve rewritten the question to (hopefully) better describe my issue. Let me know if there&#39;s anything more I should change, thanks!"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571838995, "post_id": 58523797, "comment_id": 103373937, "body": "<i>as minimal and clear as possible.</i> \u2014 are the <b>5</b> fields of <code>Atom</code> required to reproduce the problem? I expect you can remove all of them. That&#39;s the first most obvious thing I see. Make sure to try all of the reduction tips listed."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571839099, "post_id": 58523797, "comment_id": 103373996, "body": "Also, you might be interested in the <a href=\"https://doc.rust-lang.org/std/macro.vec.html\" rel=\"nofollow noreferrer\"><code>vec!</code></a> macro."}, {"owner": {"reputation": 756, "user_id": 8960078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b4df0a57a0df19a686508ee126a5e2c?s=128&d=identicon&r=PG&f=1", "display_name": "QuantumChris", "link": "https://stackoverflow.com/users/8960078/quantumchris"}, "edited": false, "score": 0, "creation_date": 1571839214, "post_id": 58523797, "comment_id": 103374080, "body": "Updated again. Also, I create an empty <code>vec</code> and add to it as a file is read, so I use <code>vec::new()</code> first. <code>vec!</code> is only for initialising a non-empty <code>vec</code>, isn&#39;t it?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571839336, "post_id": 58523797, "comment_id": 103374139, "body": "The post does not contain the error you are asking about. The example here does not do any incremental reading of a file, so there&#39;s no reason you cannot use <code>vec!</code>. So long as it continues to produce the same error."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571839490, "post_id": 58523797, "comment_id": 103374264, "body": "It looks like your question might be answered by the answers of <a href=\"https://stackoverflow.com/q/27904864/155423\">What does \u201ccannot move out of index of\u201d mean?</a>. If not, please <b><a href=\"https://stackoverflow.com/posts/58523797/edit\">edit</a></b> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571839579, "post_id": 58523797, "comment_id": 103374319, "body": "For example, I think your code can be fully reduced to <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=b516b45c18ff27e758784d02c713738a\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 756, "user_id": 8960078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b4df0a57a0df19a686508ee126a5e2c?s=128&d=identicon&r=PG&f=1", "display_name": "QuantumChris", "link": "https://stackoverflow.com/users/8960078/quantumchris"}, "edited": false, "score": 0, "creation_date": 1571839913, "post_id": 58523797, "comment_id": 103374523, "body": "I don&#39;t think the answers to the above are what I&#39;m after. Unless the only solution is to have bonds be a vec of references? But then I go back to the issue of a missing lifetime specifier"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571840169, "post_id": 58523797, "comment_id": 103374687, "body": "References is an answer, cloning is an answer, reference-counting is an answer. See also <a href=\"https://stackoverflow.com/q/45674479/155423\">Need holistic explanation about Rust&#39;s cell and reference counted types</a>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 756, "user_id": 8960078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b4df0a57a0df19a686508ee126a5e2c?s=128&d=identicon&r=PG&f=1", "display_name": "QuantumChris", "link": "https://stackoverflow.com/users/8960078/quantumchris"}, "edited": false, "score": 0, "creation_date": 1571840462, "post_id": 58523797, "comment_id": 103374864, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/201334/discussion-between-shepmaster-and-quantumchris\">continue this discussion in chat</a>."}], "owner": {"reputation": 756, "user_id": 8960078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b4df0a57a0df19a686508ee126a5e2c?s=128&d=identicon&r=PG&f=1", "display_name": "QuantumChris", "link": "https://stackoverflow.com/users/8960078/quantumchris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1571845554, "creation_date": 1571836667, "last_edit_date": 1571845554, "question_id": 58523797, "link": "https://stackoverflow.com/questions/58523797/vec-of-structs-causing-borrowing-issues", "title": "Vec of structs causing borrowing issues", "body": "<p>I am trying to build a molecule data structure. Starting with an <code>Atom</code> struct, a molecule <code>Vec</code> stores all of the <code>Atom</code>s (with their coordinates and indices, etc). I also want a <code>Bond</code> struct which will have pairs of <code>Atom</code> structs, and another <code>Vec</code> which stores all of the bonds. I'll do the same for <code>Angle</code> and so on...</p>\n\n<p>Once in the structs, the data will not be mutated, it will just be used to calculate things like bond lengths via methods, but I can't quite work out how to get around the ownership issue.</p>\n\n<p><code>mvp_molecule.rs</code></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Debug)]\nstruct Atom {\n    atomic_symbol: String,\n    index: i16,\n}\n\n#[derive(Debug)]\nstruct Bond {\n    atom_1: Atom,\n    atom_2: Atom,\n}\n\npub fn make_molecule() {\n    let mut molecule = Vec::new();\n    let mut bonds = Vec::new();\n\n    let atom_1 = Atom {\n        atomic_symbol: \"C\".to_string(),\n        index: 0,\n    };\n    molecule.push(atom_1);\n    let atom_2 = Atom {\n        atomic_symbol: \"H\".to_string(),\n        index: 1,\n    };\n    molecule.push(atom_2);\n    let bond = Bond {\n        atom_1: molecule[0],\n        atom_2: molecule[1],\n    };\n    bonds.push(bond);\n}\n</code></pre>\n\n<p>I think the issue is that Rust thinks I might change an <code>Atom</code> while it's in a <code>Bond</code>, which I won't do. How can I convince Rust of that?</p>\n\n<p>I appreciate this may be a common problem but I'm not learned enough to realise what I should be looking for to solve it. I've looked through a lot of the documentation on references, borrowing and lifetimes but I'm still not quite sure what the issue I'm trying to solve is, or if it's solvable in this way.</p>\n"}, {"tags": ["rust", "rust-cargo", "rust-crates"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 3, "creation_date": 1571836044, "post_id": 58523436, "comment_id": 103372112, "body": "why isn&#39;t the source of my_lib directly in <code>my_lib&#47;src</code> ? I would expect <code>my_lib&#47;src&#47;lib.rs</code>. What&#39;s that <code>lib&#47;</code> directory ?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571836544, "post_id": 58523436, "comment_id": 103372462, "body": "It&#39;s hard to answer your question because it doesn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. We can&#39;t tell what the contents of the <code>Cargo.toml</code> files are. You also don&#39;t show any Rust files (and their contents) inside of <code>my_lib</code>. It would make it easier for us to help you if you try to reproduce your error in a brand new Cargo project, then <a href=\"https://stackoverflow.com/posts/58523436/edit\">edit</a> your question to include the additional info. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MRE tips</a> you can use to reduce your original code for posting here. Thanks!"}, {"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1571837140, "post_id": 58523436, "comment_id": 103372832, "body": "Following edit: A lib usually has a <code>lib.rs</code> file, not a <code>main.rs</code> one. That&#39;s probably your first problem."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 1, "last_activity_date": 1571837183, "creation_date": 1571837183, "answer_id": 58523943, "question_id": 58523436, "link": "https://stackoverflow.com/questions/58523436/unresolved-import-when-importing-from-a-local-crate-with-a-main-rs-file/58523943#58523943", "title": "Unresolved import when importing from a local crate with a main.rs file", "body": "<p>A crate can be <strong>either</strong> a library or an executable, not both. Your <code>my_lib</code> contains a <em>main.rs</em> file, which means Cargo will treat it as an executable file. You cannot import from an executable.</p>\n\n<p>You will need to restructure your code. Perhaps you actually meant for <code>my_lib</code> to be a library, in which case it should have a top-level <em>lib.rs</em>. You probably want to:</p>\n\n<ul>\n<li>delete <em>my_lib/src/main.rs</em></li>\n<li>move <em>my_lib/src/lib/mod.rs</em> to <em>my_lib/src/lib.rs</em> </li>\n<li>move <em>my_lib/src/lib/foo.rs</em> to <em>my_lib/src/foo.rs</em></li>\n</ul>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/26946646/rust-package-with-both-a-library-and-a-binary\">Rust package with both a library and a binary?</a></li>\n</ul>\n"}], "owner": {"reputation": 1053, "user_id": 5837583, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/u3sSZ.jpg?s=128&g=1", "display_name": "cuoka", "link": "https://stackoverflow.com/users/5837583/cuoka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1467, "favorite_count": 0, "accepted_answer_id": 58523943, "answer_count": 1, "score": 1, "last_activity_date": 1571837183, "creation_date": 1571835567, "last_edit_date": 1571837096, "question_id": 58523436, "link": "https://stackoverflow.com/questions/58523436/unresolved-import-when-importing-from-a-local-crate-with-a-main-rs-file", "title": "Unresolved import when importing from a local crate with a main.rs file", "body": "<p>I have included a library as a submodule in my program. The structure looks like this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>.\n\u251c\u2500\u2500 my_lib/\n     \u251c\u2500\u2500 Cargo.toml\n     \u2514\u2500\u2500 src/\n          \u251c\u2500\u2500 lib/\n               \u251c\u2500\u2500 mod.rs\n               \u2514\u2500\u2500 foo.rs\n          \u2514\u2500\u2500 main.rs\n\u251c\u2500\u2500 src/\n     \u2514\u2500\u2500 main.rs\n\u2514\u2500\u2500 Cargo.toml\n</code></pre>\n\n<p>In my program's <code>Cargo.toml</code> file I have added the dependency following this <a href=\"https://stackoverflow.com/a/33025972/5837583\">answer</a>:</p>\n\n<pre><code>[dependencies]\nmy_lib = { path = \"./my_lib\" }\n</code></pre>\n\n<p>However I'm not able to use this library inside my program, I'm a bit new to Rust and this import system is very confusing to me. I've tried this in <code>main.rs</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use my_lib::foo;\n</code></pre>\n\n<p>But I get an <code>unresolved import 'my_lib'</code> error.</p>\n"}, {"tags": ["generics", "serialization", "struct", "rust", "msgpack"], "answers": [{"tags": [], "owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "is_accepted": true, "score": 3, "last_activity_date": 1571848134, "last_edit_date": 1571848134, "creation_date": 1571834228, "answer_id": 58523029, "question_id": 58522793, "link": "https://stackoverflow.com/questions/58522793/how-to-serialize-or-deserialize-a-generic-struct-with-messagepack/58523029#58523029", "title": "How to serialize or deserialize a generic struct with messagepack?", "body": "<p>You need to convince <code>rustc</code> that <code>T</code> is indeed serializable and deserializable:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn serializeResponseMessage&lt;T&gt;(obj: &amp;Message&lt;T&gt;) -&gt; Vec&lt;u8&gt;\nwhere\n    T: Serialize,\n{\n    rmps::encode::to_vec_named(obj).unwrap()\n}\n\npub fn deserializeUserLoginRequest&lt;'de, T&gt;(msg: &amp;'de Bytes) -&gt; Message&lt;T&gt;\nwhere\n    T: Deserialize&lt;'de&gt;,\n{\n    rmps::decode::from_read_ref(msg).unwrap()\n}\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 9018487, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LQrZmtYn09k/AAAAAAAAAAI/AAAAAAAADfY/C3A7MMlUMe8/photo.jpg?sz=128", "display_name": "Piotr P\u0142aczek", "link": "https://stackoverflow.com/users/9018487/piotr-p%c5%82aczek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 698, "favorite_count": 0, "accepted_answer_id": 58523029, "answer_count": 1, "score": 0, "last_activity_date": 1571849012, "creation_date": 1571833389, "last_edit_date": 1571849012, "question_id": 58522793, "link": "https://stackoverflow.com/questions/58522793/how-to-serialize-or-deserialize-a-generic-struct-with-messagepack", "title": "How to serialize or deserialize a generic struct with messagepack?", "body": "<p>I use rmp_serde to serialize and deserialize some structures. One structure contains a generic type, and the compiler says:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: the trait bound `T: api::_IMPL_SERIALIZE_FOR_User::_serde::Serialize` is not satisfied\nlabel: the trait `api::_IMPL_SERIALIZE_FOR_User::_serde::Serialize` is not implemented for `T`\n</code></pre>\n\n<p>For NodeJs, messagepack works without any problems, but I'm working with rust for few days...</p>\n\n<pre><code>extern crate rmp_serde as rmps;\nuse bytes::Bytes;\nuse serde::{Deserialize, Serialize};\n\n#[derive(Deserialize, Serialize, PartialEq, Debug)]\npub struct User {\n    pub name: String,\n    pub token: String,\n    pub hash: String,\n}\n\n#[derive(Deserialize, Serialize, PartialEq, Debug)]\npub struct Message&lt;T&gt; {\n    pub utc: u64,\n    pub mtd: u64,\n    pub user: User,\n    pub payload: T,\n}\n\npub fn serializeResponseMessage&lt;T&gt;(obj: &amp;Message&lt;T&gt;) -&gt; Vec&lt;u8&gt; {\n    let serialized = rmps::encode::to_vec_named(&amp;obj).unwrap();\n    serialized\n}\n\npub fn deserializeUserLoginRequest&lt;T&gt;(msg: &amp;Bytes) -&gt; Message&lt;T&gt; {\n    // let mut obj = Message {\n    //     utc: 0,\n    //     mtd: 0,\n    //     user: User {\n    //         name: \"\".to_string(),\n    //         token: \"\".to_string(),\n    //         hash: \"\".to_string(),\n    //     },\n    //     payload: User {\n    //         name: \"\".to_string(),\n    //         token: \"\".to_string(),\n    //         hash: \"\".to_string(),\n    //     },\n    // };\n\n    let obj: Message&lt;T&gt; = rmps::decode::from_read_ref(&amp;msg).unwrap();\n\n    obj\n}\n</code></pre>\n\n<p>How can I implement this?</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1571822442, "post_id": 58519474, "comment_id": 103364732, "body": "What command are you running to get the error? <code>cargo run --example client</code>?"}, {"owner": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "reply_to_user": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1571822790, "post_id": 58519474, "comment_id": 103364943, "body": "I just use &quot;cargo build. I have a lot of errors and I just noticed it says: &quot;could not compile swagger_client&quot;. Do you think the fact that it hasn&#39;t been compiled is causing the issue?"}, {"owner": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "reply_to_user": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1571822831, "post_id": 58519474, "comment_id": 103364964, "body": "the cannot find crate error is only showing up on the visual studio code editor not on the terminal I use to compile the code."}, {"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 3, "creation_date": 1571822966, "post_id": 58519474, "comment_id": 103365035, "body": "<code>only showing up on the visual studio code</code> may just be what happens with <code>examples</code> when open in VSCode, hard to say. Sounds like you need to get <code>cargo build</code> working first, so this question seems unanswerable as-is. I&#39;d remove the example, get it building, and then add it back."}, {"owner": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "reply_to_user": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1572001084, "post_id": 58519474, "comment_id": 103433556, "body": "@loganfsmyth when it was compiled without warnings the cannot find crate warning disappeared. thanks for taking the time to answer"}], "owner": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 169, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571822248, "creation_date": 1571822248, "question_id": 58519474, "link": "https://stackoverflow.com/questions/58519474/rust-file-in-package-cannot-find-package-name-when-using-use-extern-package-nam", "title": "rust file in package cannot find package name when using &#39;use extern PACKAGE_NAME&#39;", "body": "<pre><code>\u251c\u2500\u2500 Cargo.lock\n\u251c\u2500\u2500 Cargo.toml\n\u251c\u2500\u2500 src\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 model.rs\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 lib.rs\n\u2514\u2500\u2500 examples\n    \u2514\u2500\u2500 client.rs\n</code></pre>\n\n<p>What my cargo.toml looks like:</p>\n\n<pre><code>[package]\nname = \"swagger_client\"\nversion = \"1.0.0\"\nauthors = []\ndescription = \"example test\"\n</code></pre>\n\n<p>In client.rs I try to say:</p>\n\n<pre><code>extern crate swagger_client;\n\nuse swagger_client::{testing_struct,alpha,beta};\n</code></pre>\n\n<p>However \"extern crate swagger_client;\" causes an error.</p>\n\n<pre><code>src/lib.rs\ncan't find crate for `swagger_client`\n\ncan't find crate rustc(E0463)\nclient.rs(3, 1): can't find crate\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571835169, "post_id": 58514822, "comment_id": 103371610, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/30407009/using-reflection-to-enumerate-through-the-fields-of-a-struct-at-runtime\">Using reflection to enumerate through the fields of a struct at runtime</a>"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571835295, "post_id": 58514822, "comment_id": 103371676, "body": "Or perhaps not... you did not specify it has to be done at runtime. Certainly this can be done at compile time with a proc macro, although I don&#39;t know how myself."}, {"owner": {"reputation": 790, "user_id": 1355121, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7fde47be1461f757f6e7bbac40c4df97?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1355121/nick"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571840187, "post_id": 58514822, "comment_id": 103374697, "body": "I would rather have this done at compile time, but runtime could work too if necessary. I did consider macros but I am not sure how to write one that would do what I want."}], "answers": [{"comments": [{"owner": {"reputation": 790, "user_id": 1355121, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7fde47be1461f757f6e7bbac40c4df97?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1355121/nick"}, "edited": false, "score": 0, "creation_date": 1571862485, "post_id": 58514897, "comment_id": 103384883, "body": "Thanks for the suggestion, this was useful for a different problem I had later! I decided to go with my macro solution below which is heavily based on: <a href=\"https://stackoverflow.com/a/54177889/1355121\">stackoverflow.com/a/54177889/1355121</a>"}], "tags": [], "owner": {"reputation": 30697, "user_id": 31667, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/082b069c287878a1bd5731f44c8f10e7?s=128&d=identicon&r=PG", "display_name": "viraptor", "link": "https://stackoverflow.com/users/31667/viraptor"}, "is_accepted": false, "score": 6, "last_activity_date": 1571800059, "creation_date": 1571800059, "answer_id": 58514897, "question_id": 58514822, "link": "https://stackoverflow.com/questions/58514822/print-all-struct-fields-in-rust/58514897#58514897", "title": "Print all struct fields in Rust", "body": "<p>This may not be the most minimal implementation, but you can derive serialisable and use the <code>serde</code> crate. Here's an example of a custom serialiser: <a href=\"https://serde.rs/impl-serializer.html\" rel=\"noreferrer\">https://serde.rs/impl-serializer.html</a></p>\n\n<p>In your case it may be much simpler (you need only a handful of types and can panic/ignore on anything unexpected).</p>\n\n<p>Another approach could be to write a macro and create your own lightweight serialisation solution.</p>\n"}, {"tags": [], "owner": {"reputation": 790, "user_id": 1355121, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7fde47be1461f757f6e7bbac40c4df97?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1355121/nick"}, "is_accepted": false, "score": 3, "last_activity_date": 1571862354, "creation_date": 1571862354, "answer_id": 58530515, "question_id": 58514822, "link": "https://stackoverflow.com/questions/58514822/print-all-struct-fields-in-rust/58530515#58530515", "title": "Print all struct fields in Rust", "body": "<p>I ended up solving this with a macro. While it is not ideal it does the job.</p>\n\n<p>My macro currently looks like this:</p>\n\n<pre><code>macro_rules! MyDisplay {\n    ($struct:ident {$( $field:ident:$type:ty ),*,}) =&gt; {\n        #[derive(Debug)]\n        pub struct $struct { pub $($field: $type),*}\n\n        impl fmt::Display for $struct {\n            fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;'_&gt;) -&gt; fmt::Result {\n                $(\n                    write!(f, \"{}: {}\\n\",\n                        stringify!($field).to_string(),\n                        match &amp;self.$field {\n                            None =&gt; \"-\".to_string(),\n                            Some(x) =&gt; format!(\"{:#?}\", x)\n                        }\n                    )?;\n                )*\n                Ok(())\n            }\n        }\n    };\n}\n</code></pre>\n\n<p>Which can be used like this:</p>\n\n<pre><code>MyDisplay! {\n    Example {\n        a: Option&lt;String&gt;,\n        b: Option&lt;i64&gt;,\n        c: Option&lt;String&gt;,\n    } \n}\n</code></pre>\n\n<p>Playground with an example:\n<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=cc089f8aecaa04ce86f3f9e0307f8785\" rel=\"nofollow noreferrer\">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=cc089f8aecaa04ce86f3f9e0307f8785</a></p>\n\n<p>My macro is based on the one here <a href=\"https://stackoverflow.com/a/54177889/1355121\">https://stackoverflow.com/a/54177889/1355121</a> provided by Cerberus</p>\n"}], "owner": {"reputation": 790, "user_id": 1355121, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7fde47be1461f757f6e7bbac40c4df97?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1355121/nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 972, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1571862354, "creation_date": 1571799400, "question_id": 58514822, "link": "https://stackoverflow.com/questions/58514822/print-all-struct-fields-in-rust", "title": "Print all struct fields in Rust", "body": "<p>I have around 10 structs with between 5-10 fields each and I want to be able to print them out using the same format.</p>\n\n<p>Most of my structs look like this:</p>\n\n<pre><code>struct Example {\n  a: Option&lt;String&gt;,\n  b: Option&lt;i64&gt;,\n  c: Option&lt;String&gt;,\n  ... etc\n}\n</code></pre>\n\n<p>I would like to be able to define a <code>impl</code> for <code>fmt::Display</code> without having to enumerate the fields again so there is no chance for missing one if a new one is added.</p>\n\n<p>For the struct:</p>\n\n<pre><code>let eg = Example{\n  a: Some(\"test\".to_string),\n  b: Some(123),\n  c: None,\n}\n</code></pre>\n\n<p>I would like the output format:</p>\n\n<pre><code>a: test\nb: 123\nc: -\n</code></pre>\n\n<p>I currently am using <code>#[derive(Debug)]</code> but I don't like that it prints out <code>Some(X)</code> and <code>None</code> and a few other things.</p>\n\n<p>If I know that all the values inside my structs are <code>Option&lt;T: fmt::Display&gt;</code> can I generate myself a <code>Display</code> method without having to list the fields again?</p>\n"}, {"tags": ["parsing", "rust", "nom"], "answers": [{"comments": [{"owner": {"reputation": 2141, "user_id": 1644471, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/cc67b23ba788b61fc17fdf4af314c378?s=128&d=identicon&r=PG", "display_name": "mottosson", "link": "https://stackoverflow.com/users/1644471/mottosson"}, "edited": false, "score": 0, "creation_date": 1571898313, "post_id": 58520871, "comment_id": 103393420, "body": "Thank you! But the allocation is a bit of a deal breaker for me since I will be parsing large amounts of text and want it to be as performant as possible! =) Isn&#39;t it possible to use the <code>bytes::complete::escaped</code> parser somehow? This <code>escaped(alphanumeric1, &#39;\\&#39;&#39;, char(&#39;\\&#39;&#39;))(i)</code> does not work... =("}, {"owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "reply_to_user": {"reputation": 2141, "user_id": 1644471, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/cc67b23ba788b61fc17fdf4af314c378?s=128&d=identicon&r=PG", "display_name": "mottosson", "link": "https://stackoverflow.com/users/1644471/mottosson"}, "edited": false, "score": 0, "creation_date": 1571899188, "post_id": 58520871, "comment_id": 103393816, "body": "@mottosson <code>escaped</code> and <code>escaped_transform</code> have different semantics, the former only check if the input conforms to the given escape rule. Replacing double quotes with single one requires to manipulate the inside of a potentially long string, I don&#39;t see how to avoid allocation. Unless you can relax that requirement somehow."}, {"owner": {"reputation": 2141, "user_id": 1644471, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/cc67b23ba788b61fc17fdf4af314c378?s=128&d=identicon&r=PG", "display_name": "mottosson", "link": "https://stackoverflow.com/users/1644471/mottosson"}, "edited": false, "score": 0, "creation_date": 1571904963, "post_id": 58520871, "comment_id": 103396447, "body": "Hmm... you are correct. Maybe the transform can be made in a separate step in a later stage to circumvent the initial performance implications. So can I use <code>escaped</code> then in a similar way as my previous comment to make the parser understand that the string does not end with the first single quote it finds if the next char is also a single quote?"}, {"owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "reply_to_user": {"reputation": 2141, "user_id": 1644471, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/cc67b23ba788b61fc17fdf4af314c378?s=128&d=identicon&r=PG", "display_name": "mottosson", "link": "https://stackoverflow.com/users/1644471/mottosson"}, "edited": false, "score": 1, "creation_date": 1571912142, "post_id": 58520871, "comment_id": 103400179, "body": "@mottosson then you can get rid of <code>unquote</code> and <code>map_parser</code> altogether. <code>let res = delimited(tag(&quot;&#39;&quot;), seq, tag(&quot;&#39;&quot;))(input)?;</code> would be sufficient, and of course the return type is going to be <code>IResult&lt;&amp;str, &amp;str&gt;</code>."}, {"owner": {"reputation": 2141, "user_id": 1644471, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/cc67b23ba788b61fc17fdf4af314c378?s=128&d=identicon&r=PG", "display_name": "mottosson", "link": "https://stackoverflow.com/users/1644471/mottosson"}, "edited": false, "score": 0, "creation_date": 1572340658, "post_id": 58520871, "comment_id": 103519875, "body": "Just another question about <code>many0</code>. It says in the docs that many0 <code>Repeats the embedded parser until it fails and returns the results in a Vec</code>. Does this mean it will allocate memory even if it&#39;s wrapped in <code>recognize</code>?"}, {"owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "reply_to_user": {"reputation": 2141, "user_id": 1644471, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/cc67b23ba788b61fc17fdf4af314c378?s=128&d=identicon&r=PG", "display_name": "mottosson", "link": "https://stackoverflow.com/users/1644471/mottosson"}, "edited": false, "score": 0, "creation_date": 1572342678, "post_id": 58520871, "comment_id": 103520957, "body": "@mottosson yes, it should. But even so, that&#39;ll be <code>Vec&lt;&amp;str&gt;</code> and doesn&#39;t consume too much memory. Plus, here it is wrapped in <code>recognize</code> so the result is never bound to anything or returned, it should be discarded immediately."}, {"owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "reply_to_user": {"reputation": 2141, "user_id": 1644471, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/cc67b23ba788b61fc17fdf4af314c378?s=128&d=identicon&r=PG", "display_name": "mottosson", "link": "https://stackoverflow.com/users/1644471/mottosson"}, "edited": false, "score": 0, "creation_date": 1572344664, "post_id": 58520871, "comment_id": 103522086, "body": "@mottosson that being said, you can experiment with other combintor such as <code>take_while</code> here to see if it is even better."}, {"owner": {"reputation": 2141, "user_id": 1644471, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/cc67b23ba788b61fc17fdf4af314c378?s=128&d=identicon&r=PG", "display_name": "mottosson", "link": "https://stackoverflow.com/users/1644471/mottosson"}, "edited": false, "score": 0, "creation_date": 1572348790, "post_id": 58520871, "comment_id": 103524115, "body": "Great. Thanks for clarifying! =)"}], "tags": [], "owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "is_accepted": true, "score": 3, "last_activity_date": 1571827242, "last_edit_date": 1571827242, "creation_date": 1571826759, "answer_id": 58520871, "question_id": 58511515, "link": "https://stackoverflow.com/questions/58511515/parse-string-with-escaped-single-quotes/58520871#58520871", "title": "Parse string with escaped single quotes", "body": "<p>This is pretty tricky, but the following works:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>//# nom = \"5.0.1\"\nuse nom::{\n    bytes::complete::{escaped_transform, tag},\n    character::complete::none_of,\n    combinator::{recognize, map_parser},\n    multi::{many0, separated_list},\n    sequence::delimited,\n    IResult,\n};\n\nfn main() {\n    let (_, res) = parse_quoted(\"'abc''def'\").unwrap();\n    assert_eq!(res, \"abc'def\");\n    let (_, res) = parse_quoted(\"'xy@$%!z'\").unwrap();\n    assert_eq!(res, \"xy@$%!z\");\n    let (_, res) = parse_quoted(\"'single quotes -&gt; '' and so on...'\").unwrap();\n    assert_eq!(res, \"single quotes -&gt; ' and so on...\");\n}\n\nfn parse_quoted(input: &amp;str) -&gt; IResult&lt;&amp;str, String&gt; {\n    let seq = recognize(separated_list(tag(\"''\"), many0(none_of(\"'\"))));\n    let unquote = escaped_transform(none_of(\"'\"), '\\'', tag(\"'\"));\n    let res = delimited(tag(\"'\"), map_parser(seq, unquote), tag(\"'\"))(input)?;\n\n    Ok(res)\n}\n</code></pre>\n\n<p>Some explanations:</p>\n\n<ol>\n<li>the parser <code>seq</code> recognizes any sequence that alternates between double quotes and anything else;</li>\n<li><code>unquote</code> transforms any double quotes into single one;</li>\n<li><code>map_parser</code> then combines the two together to produce the desired result.</li>\n</ol>\n\n<p>Be aware that due to the use of <code>escaped_transform</code> combinator, the parsing result is <code>String</code> instead of <code>&amp;str</code>. I.e., there are extra allocations.</p>\n"}], "owner": {"reputation": 2141, "user_id": 1644471, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/cc67b23ba788b61fc17fdf4af314c378?s=128&d=identicon&r=PG", "display_name": "mottosson", "link": "https://stackoverflow.com/users/1644471/mottosson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 469, "favorite_count": 0, "accepted_answer_id": 58520871, "answer_count": 1, "score": 2, "last_activity_date": 1571827242, "creation_date": 1571774514, "question_id": 58511515, "link": "https://stackoverflow.com/questions/58511515/parse-string-with-escaped-single-quotes", "title": "Parse string with escaped single quotes", "body": "<p>I want to parse a string containing ASCII characters between single quotes and that can contain escaped single quotes by two ' in a row.</p>\n\n<blockquote>\n  <p>'string value contained between single quotes -> '' and so on...'</p>\n</blockquote>\n\n<p>which should result in:</p>\n\n<blockquote>\n  <p>string value contained between single quotes -> ' and so on...</p>\n</blockquote>\n\n<pre><code>use nom::{\n    bytes::complete::{tag, take_while},\n    error::{ErrorKind, ParseError},\n    sequence::delimited,\n    IResult,\n};\n\nfn main() {\n    let res = string_value::&lt;(&amp;str, ErrorKind)&gt;(\"'abc''def'\");\n\n    assert_eq!(res, Ok((\"\", \"abc\\'def\")));\n}\n\npub fn is_ascii_char(chr: char) -&gt; bool {\n    chr.is_ascii()\n}\n\nfn string_value&lt;'a, E: ParseError&lt;&amp;'a str&gt;&gt;(i: &amp;'a str) -&gt; IResult&lt;&amp;'a str, &amp;'a str, E&gt; {\n    delimited(tag(\"'\"), take_while(is_ascii_char), tag(\"'\"))(i)\n}\n</code></pre>\n\n<p>How can I detect escaped quotes and not the end of the string?</p>\n"}, {"tags": ["arrays", "rust", "slice", "string-comparison"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1571770539, "post_id": 58510649, "comment_id": 103348887, "body": "It&#39;s hard to answer your question because it doesn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. The code you have provided does not produce the error you are asking about. It would make it easier for us to help you if you try to reproduce your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> if possible, otherwise in a brand new Cargo project, then <a href=\"https://stackoverflow.com/posts/58510649/edit\">edit</a> your question to include the additional info. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MRE tips</a> you can use to reduce your original code for posting here. Thanks!"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 4, "creation_date": 1571770569, "post_id": 58510649, "comment_id": 103348908, "body": "Your error message also appears to refer to code that isn&#39;t present."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1571770977, "post_id": 58510649, "comment_id": 103349085, "body": "It <b>really</b> seems like you want <code>alpha == input</code>, but you haven&#39;t defined what the value of <code>find</code> should be when they <i>aren&#39;t</i> equal."}], "answers": [{"tags": [], "owner": {"reputation": 6608, "user_id": 4497253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc929d11ae26463d18e337d295c86fcc?s=128&d=identicon&r=PG&f=1", "display_name": "CoronA", "link": "https://stackoverflow.com/users/4497253/corona"}, "is_accepted": true, "score": 1, "last_activity_date": 1571802603, "creation_date": 1571802603, "answer_id": 58515207, "question_id": 58510649, "link": "https://stackoverflow.com/questions/58510649/how-to-compare-2-different-string-literals-byte-by-byte-in-rust/58515207#58515207", "title": "How to compare 2 different String literals byte by byte in RUST", "body": "<p>The compiler message is not reproducable, yet your code reveals some misunderstandings. Here some hints how you could change it:</p>\n\n<p>You want an array of unknown size (and it shall probably contain the bytes already matched, so it must be mutable):</p>\n\n<ul>\n<li>replace <code>let find : Box&lt;[u8]&gt;;</code> by <code>let mut find = Vec::new();</code></li>\n</ul>\n\n<p>You want to iterate the bytes of name1 and name2</p>\n\n<ul>\n<li>replace <code>for (i, &amp;place1) in name1.iter().enumerate()</code> by <code>for &amp;place1 in name1.iter()</code></li>\n<li>replace <code>for (i, &amp;place2) in name2.iter().enumerate()</code> by <code>for &amp;place2 in name2.iter()</code></li>\n</ul>\n\n<p><code>let variable = ...</code> shadows all former definitions of <code>variable</code>. You do not want to shadow the variables <code>place1</code>, <code>place2</code> you want to use these variables.</p>\n\n<ul>\n<li>remove <code>let place1 = name1[i];</code></li>\n<li>remove <code>let place2 = name2[j];</code></li>\n</ul>\n\n<p>You want to add the matching byte to the array <code>find</code>. Your code will again shadow the definition of find. So</p>\n\n<ul>\n<li>replace <code>let find = place2;</code> by <code>find.push(place2);</code></li>\n</ul>\n"}], "owner": {"reputation": 39, "user_id": 12216603, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6Y4SGasbJSI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc2G5AeeiAniwngl6m0KOCka1Lkjg/photo.jpg?sz=128", "display_name": "Fawad Ahmed", "link": "https://stackoverflow.com/users/12216603/fawad-ahmed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 316, "favorite_count": 0, "accepted_answer_id": 58515207, "answer_count": 1, "score": -2, "last_activity_date": 1571836812, "creation_date": 1571770316, "last_edit_date": 1571836812, "question_id": 58510649, "link": "https://stackoverflow.com/questions/58510649/how-to-compare-2-different-string-literals-byte-by-byte-in-rust", "title": "How to compare 2 different String literals byte by byte in RUST", "body": "<p>I entered two string literals and converted them into arrays of bytes and now I'm trying to compare both arrays bytes to check for a match. If they match successfully, I want to save it into an unknown size array <code>find</code>, but it is not saving:</p>\n\n<pre><code>fn main() {\n    let mut m: u8 = 0;\n    // enter the first_name\n    let alpha = \"fawad\";\n    //covert name1 into array bytes\n    let name1 = alpha.as_bytes();\n    // enter the second_name\n    let input = String::new();\n    //covert name2 into array bytes\n    let name2 = input.as_bytes();\n    //want to create an unknown size of an array\n    let find: Box&lt;[u8]&gt;;\n    for (i, &amp;place1) in name1.iter().enumerate() {\n        let place1 = name1[i];\n        for (j, &amp;place2) in name2.iter().enumerate() {\n            let place2 = name2[j];\n            if place1 == place2 {\n                let find = place2;\n                m = m + 1;\n            } else {\n                break;\n            }\n        }\n    }\n    println!(\"comparison shows {:?}\", find);\n}\n</code></pre>\n\n<p>I get:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: expected one of `:`, `;`, `=`, or `@`, found `[`\n  --&gt; src\\main.rs:17:13\n\n   |\n17 |     let find[] : Box&lt;[u8]&gt;;\n   |             ^ expected one of `:`, `;`, `=`, or `@` here\n</code></pre>\n"}, {"tags": ["rust", "swagger"], "comments": [{"owner": {"reputation": 57048, "user_id": 113116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e0v1H.png?s=128&g=1", "display_name": "Helen", "link": "https://stackoverflow.com/users/113116/helen"}, "edited": false, "score": 1, "creation_date": 1571758405, "post_id": 58507708, "comment_id": 103343384, "body": "<a href=\"https://editor.swagger.io\" rel=\"nofollow noreferrer\">editor.swagger.io</a> is the latest version of Swagger Editor. What do you mean by &quot;out of date&quot;?"}, {"owner": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "reply_to_user": {"reputation": 57048, "user_id": 113116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e0v1H.png?s=128&g=1", "display_name": "Helen", "link": "https://stackoverflow.com/users/113116/helen"}, "edited": false, "score": 0, "creation_date": 1571760930, "post_id": 58507708, "comment_id": 103344729, "body": "Well the stubs I generate from it have old version of certain crates. eg the &#39;swagger&#39; crate is at version 0.12 (at version 3+) which causes issues since the code it&#39;s depending on from third party crates has changed. It&#39;s using structs that don&#39;t exist, accessing scopes that have been changed and no longer exist. So the stub that&#39;s actually generated is basically broken, cannot compile as the dependencies are relying on old version of crates"}], "answers": [{"tags": [], "owner": {"reputation": 57048, "user_id": 113116, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e0v1H.png?s=128&g=1", "display_name": "Helen", "link": "https://stackoverflow.com/users/113116/helen"}, "is_accepted": true, "score": 0, "last_activity_date": 1571761906, "creation_date": 1571761906, "answer_id": 58508682, "question_id": 58507708, "link": "https://stackoverflow.com/questions/58507708/is-the-swagger-editor-demo-out-of-date/58508682#58508682", "title": "Is the swagger editor demo out of date?", "body": "<p>Swagger Editor demo at <a href=\"https://editor.swagger.io\" rel=\"nofollow noreferrer\">https://editor.swagger.io</a> always hosts the latest release of the editor.</p>\n\n<p>Note that code generation via the \"Generate Server\" and \"Generate Client\" menus is powered by another project, Swagger Codegen. Swagger Editor uses the latest release of Swagger Codegen by default. If you face any issues with code generation, open an issue in the Swagger Codegen repository:</p>\n\n<p><a href=\"https://github.com/swagger-api/swagger-codegen/issues\" rel=\"nofollow noreferrer\">https://github.com/swagger-api/swagger-codegen/issues</a></p>\n"}, {"tags": [], "owner": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "is_accepted": false, "score": 0, "last_activity_date": 1572000990, "creation_date": 1572000990, "answer_id": 58557230, "question_id": 58507708, "link": "https://stackoverflow.com/questions/58507708/is-the-swagger-editor-demo-out-of-date/58557230#58557230", "title": "Is the swagger editor demo out of date?", "body": "<p>The Swagger Codegen was indeed up to date but the up to date version doesn't seem to be able to generate the most up to date code for rust so switched to openapigenerator instead:</p>\n\n<p><a href=\"https://github.com/OpenAPITools/openapi-generator\" rel=\"nofollow noreferrer\">https://github.com/OpenAPITools/openapi-generator</a></p>\n"}], "owner": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 58508682, "answer_count": 2, "score": 0, "last_activity_date": 1572000990, "creation_date": 1571758322, "last_edit_date": 1571758580, "question_id": 58507708, "link": "https://stackoverflow.com/questions/58507708/is-the-swagger-editor-demo-out-of-date", "title": "Is the swagger editor demo out of date?", "body": "<p>I tried generating a stub in Rust <a href=\"https://editor.swagger.io/\" rel=\"nofollow noreferrer\">through the editor demo</a>, because I'd rather not download a huge chunk of software that I am only using once. Later on, I encountered problems with crates being out of date or which were trying to use structs/functions that were out of date.</p>\n\n<p>Is the demo out of date and I'll have to download the actual swagger-generator to get the latest server/client stubs in Rust? Is the actual swagger-generator just as old as the demo version in the browser?</p>\n"}, {"tags": ["recursion", "rust", "iterator", "traits", "recursive-type"], "comments": [{"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1571754549, "post_id": 58506199, "comment_id": 103341235, "body": "@Shepmaster I have clarified the question: I believe/hope that a solution without dynamic polymorphism (trait objects or the likes) is possible because regardless of how often you call <code>flat_map</code> the end result should have (at least morally) have the same type. So I hope there is a way to shoehorn the (non-matching) nested <code>FlatMap</code> struct in a matching single static type somehow."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571755504, "post_id": 58506199, "comment_id": 103341811, "body": "<i><code>n</code> is only known at runtime, and can be specified by the user</i> So why do you think it can be encoded into the type system rather than resolved dynamically? I don&#39;t know what Haskell would do with this, but I imagine something analogous to <code>Box&lt;dyn Iterator&gt;</code>. If <code>n</code> is unknown at compile time, the compiler can&#39;t generate <code>n</code> of anything."}, {"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571755889, "post_id": 58506199, "comment_id": 103342047, "body": "@trentcl You are probably correct; I know that (a) in (standard) Haskell, all values are boxed and (b) as @Shepmaster pointed out, the only situation in which a function like <code>recursive_flatmap</code> can compile (regardless of language) is if there are a finite number of memory sizes (and thus polymorphic function variants to store as code in the binary) to consider, which for a recursive type can only be the case if there is indirection through e.g. a pointer type."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 4, "last_activity_date": 1571755014, "last_edit_date": 1571755014, "creation_date": 1571754573, "answer_id": 58506534, "question_id": 58506199, "link": "https://stackoverflow.com/questions/58506199/how-to-perform-a-flat-map-or-similar-operation-on-an-iterator-n-times-withou/58506534#58506534", "title": "How to perform a `flat_map` (or similar operation) on an iterator N times without runtime polymorphism?", "body": "<blockquote>\n  <p>Is there a way to resolve this without runtime polymorphism?</p>\n</blockquote>\n\n<p>No.</p>\n\n<p>To solve it using a trait object:</p>\n\n<pre><code>let mut iter: Box&lt;dyn Iterator&lt;Item = i32&gt;&gt; = Box::new(vec![1, 2, 3].into_iter());\nfor _ in 0..n {\n    iter = Box::new(iter.flat_map(|x| vec![x, x * 2].into_iter()));\n}\n</code></pre>\n\n<blockquote>\n  <p>regardless of how often you call <code>flat_map</code> the end result should have (at least morally) have the same type</p>\n</blockquote>\n\n<p>I don't know which morality to apply to type systems, but the literal size in memory is (very likely to be) different for <code>FlatMap&lt;...&gt;</code> and <code>FlatMap&lt;FlatMap&lt;...&gt;&gt;</code>. They are different types.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/a/29760740/155423\">Conditionally iterate over one of several possible iterators</a></li>\n<li><a href=\"https://stackoverflow.com/q/48696290/155423\">Creating Diesel.rs queries with a dynamic number of .and()&#39;s</a></li>\n<li><a href=\"https://stackoverflow.com/q/50850309/155423\">How do I iterate over a Vec of functions returning Futures in Rust?</a></li>\n<li><a href=\"https://stackoverflow.com/q/56691225/155423\">How can I extend the lifetime of a temporary variable inside of an iterator adaptor in Rust?</a></li>\n<li><a href=\"https://stackoverflow.com/q/31374051/155423\">Why does Iterator::take_while take ownership of the iterator?</a></li>\n</ul>\n"}], "owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 402, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1571755312, "creation_date": 1571753387, "last_edit_date": 1571755312, "question_id": 58506199, "link": "https://stackoverflow.com/questions/58506199/how-to-perform-a-flat-map-or-similar-operation-on-an-iterator-n-times-withou", "title": "How to perform a `flat_map` (or similar operation) on an iterator N times without runtime polymorphism?", "body": "<p>I want to be able to repeat a process where a collection that we are iterating over is altered an <code>n</code> number of times. <code>n</code> is only known at runtime, and can be specified by the user, so we cannot hard-code it into the type.</p>\n\n<p>An approach that uses intermediate data structures by <code>collect</code>-ing between iterations is possible, like so:</p>\n\n<pre><code>let n = 10;\n\nlet mut vec1 = vec![1, 2, 3];\n{\n    for _index in 0..n {\n        let temp_vec = vec1.into_iter().flat_map(|x| vec![x, x * 2]).collect();\n        vec1 = temp_vec;\n    }\n}\n</code></pre>\n\n<p>However, this seems wasteful, because we are creating intermediate datastructures, so I went on looking for a solution that chains iterators directly.</p>\n\n<p>At first I thought one could just do something like:</p>\n\n<pre><code>let mut iter = vec![1, 2, 3].into_iter();\nfor index in 0..n {\n    iter = iter.flat_map(|x| vec![x, x * 2].into_iter());\n}\n</code></pre>\n\n<p>However, this does not work because in Rust, all functions on iterators return their own kind of 'compound iterator' struct. (In for instance Haskell, functions on iterators return the appropriate kind of result iterator, which does not become a 'bigger and bigger compound type'.)\nRewriting this as a recursive function had similar problems because (a) I was returning 'some kind of Iterator' whose type was (near?)-impossible to write out by hand because of the recursion, and (b) this type was different in the base case from the recursive case.</p>\n\n<p>I found <a href=\"https://stackoverflow.com/a/50204370/1067339\">this question</a> about conditionally returning either one or the other iterator type, as well as using <code>impl Iterator</code> to indicate that we return some concrete type that implements the Iterator trait, but we do not care about its exact nature. \nA similar example to the code in the linked answer has been implemented in the code below as <code>maybe_flatmap</code>. This works.</p>\n\n<p>However, I don't want to run <code>flat_map</code> zero or one time, but rather <code>N</code> times on the incoming iterator. Therefore, I adapted the code to call itself recursively up to a depth of <code>N</code>.</p>\n\n<p>Attempting to do that, then makes the Rust compiler complain with an <code>error[E0720]: opaque type expands to a recursive type</code>:</p>\n\n<pre><code>use either::Either; // 1.5.3\n\n/// Later we want to work with any appropriate items,\n/// but for simplicity's sake, just use plain integers for now.\ntype I = u64;\n\n/// Works, but limited to single level.\nfn maybe_flatmap&lt;T: Iterator&lt;Item = I&gt;&gt;(iter: T, flag: bool) -&gt; impl Iterator&lt;Item = I&gt; {\n    match flag {\n        false =&gt; Either::Left(iter),\n        true =&gt; Either::Right(iter.flat_map(move |x| vec![x, x * 2].into_iter())),\n    }\n}\n\n/// Does not work: opaque type expands to a recursive type!\nfn rec_flatmap&lt;T: Iterator&lt;Item = I&gt;&gt;(iter: T, depth: usize) -&gt; impl Iterator&lt;Item = I&gt; {\n    match depth {\n        0 =&gt; Either::Left(iter),\n        _ =&gt; {\n            let iter2 = iter.flat_map(move |x| vec![x, x * 2]).into_iter();\n            Either::Right(rec_flatmap(iter2, depth - 1))\n        }\n    }\n}\n\nfn main() {\n    let xs = vec![1, 2, 3, 4];\n    let xs2 = xs.into_iter();\n    let xs3 = maybe_flatmap(xs2, true);\n    let xs4: Vec&lt;_&gt; = xs3.collect();\n    println!(\"{:?}\", xs4);\n\n    let ys = vec![1, 2, 3, 4];\n    let ys2 = ys.into_iter();\n    let ys3 = rec_flatmap(ys2, 5);\n    let ys4: Vec&lt;_&gt; = ys3.collect();\n    println!(\"{:?}\", ys4);\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=release&amp;edition=2018&amp;gist=de3f050add5fd958c3916e0426b8381d\" rel=\"nofollow noreferrer\">Rust playground</a></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0720]: opaque type expands to a recursive type\n  --&gt; src/main.rs:16:65\n   |\n16 | fn rec_flatmap&lt;T: Iterator&lt;Item = I&gt;&gt;(iter: T, depth: usize) -&gt; impl Iterator&lt;Item = I&gt; {\n   |                                                                 ^^^^^^^^^^^^^^^^^^^^^^^ expands to a recursive type\n   |\n   = note: expanded type is `either::Either&lt;T, impl std::iter::Iterator&gt;`\n</code></pre>\n\n<p>I am stuck. </p>\n\n<p>Since regardless of how often you <code>flat_map</code>, the final answer is going to be an (iterator over) a vector of integers, it seems like there ought to be a way of writing this function using only a single concrete return type. </p>\n\n<p>Is this possible? Is there a way out of this situation <em>without resorting to  runtime polymorphism</em>?</p>\n\n<p>I believe/hope that a solution without dynamic polymorphism (trait objects or the like) is possible because regardless of how often you call <code>flat_map</code> the end result should have (at least morally) have the same type. I hope there is a way to shoehorn the (non-matching) nested <code>FlatMap</code> struct in a matching single static type somehow.</p>\n"}, {"tags": ["asynchronous", "rust", "async-await", "future", "hyper"], "answers": [{"tags": [], "owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "is_accepted": true, "score": 3, "last_activity_date": 1572030650, "last_edit_date": 1572030650, "creation_date": 1571955883, "answer_id": 58549873, "question_id": 58505000, "link": "https://stackoverflow.com/questions/58505000/how-to-write-a-simple-rust-asynchronous-proxy-using-futures-0-3-and-hyper-0-1/58549873#58549873", "title": "How to write a simple Rust asynchronous proxy using futures &quot;0.3&quot; and hyper &quot;0.13.0-alpha.4&quot;?", "body": "<p>By this <a href=\"https://github.com/hyperium/hyper/issues/1650#issuecomment-433526852\" rel=\"nofollow noreferrer\">issue</a>, to create a new service for each connection  you need to create  <a href=\"https://docs.rs/hyper/0.12.18/hyper/service/trait.MakeService.html\" rel=\"nofollow noreferrer\">MakeService</a> in <code>hyper = \"0.13.0-alpha.4\"</code>. You can create <code>MakeService</code> with a closure by using <code>make_service_fn</code>. </p>\n\n<blockquote>\n  <p>Also, I cannot use <code>hyper::rt::run</code> because it might have been implemented differently in <code>hyper = 0.13.0-alpha.4</code>.</p>\n</blockquote>\n\n<p>Correct, under the hood <code>hyper::rt::run</code> was calling <code>tokio::run</code>, it has been removed from the api but currently  i don't know the reason. You can run your future with calling <code>tokio::run</code> by yourself or use <code>#[tokio::main]</code> annotation. To do this you need to add <code>tokio</code> to your cargo: </p>\n\n<pre><code>#this is the version of tokio inside hyper \"0.13.0-alpha.4\"\ntokio = \"=0.2.0-alpha.6\" \n</code></pre>\n\n<p>then change your <code>run_server</code> like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>async fn run_server(forward_url: &amp;'static str, addr: SocketAddr) {\n    let server = Server::bind(&amp;addr).serve(make_service_fn(move |_| {\n        async move { Ok::&lt;_, Error&gt;(service_fn(move |req| call(forward_url, req))) }\n    }));\n    if let Err(err) = server.await {\n        eprintln!(\"server error: {}\", err);\n    }\n}\n</code></pre>\n\n<p>and <code>main</code> :</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[tokio::main]\nasync fn main() -&gt; () {\n    // Set the address to run our socket on.\n    let addr = SocketAddr::from(([127, 0, 0, 1], 3000));\n    let url = \"http://www.google.com:80\"; // i have tested with google \n\n    run_server(url, addr).await\n}\n</code></pre>\n"}], "owner": {"reputation": 410, "user_id": 9555505, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0OeJG.jpg?s=128&g=1", "display_name": "maaniB", "link": "https://stackoverflow.com/users/9555505/maanib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 568, "favorite_count": 0, "accepted_answer_id": 58549873, "answer_count": 1, "score": 2, "last_activity_date": 1572812164, "creation_date": 1571749540, "last_edit_date": 1572812164, "question_id": 58505000, "link": "https://stackoverflow.com/questions/58505000/how-to-write-a-simple-rust-asynchronous-proxy-using-futures-0-3-and-hyper-0-1", "title": "How to write a simple Rust asynchronous proxy using futures &quot;0.3&quot; and hyper &quot;0.13.0-alpha.4&quot;?", "body": "<p>I am trying to rewrite the proxy <a href=\"https://rust-lang.github.io/async-book/01_getting_started/05_http_server_example.html\" rel=\"nofollow noreferrer\">example</a> of <a href=\"https://rust-lang.github.io/async-book/01_getting_started/01_chapter.html\" rel=\"nofollow noreferrer\">Asynchronous Programming in Rust</a> book by migrating to :</p>\n\n<pre><code>futures-preview = { version = \"0.3.0-alpha.19\", features = [\"async-await\"]}`\nhyper = \"0.13.0-alpha.4\"`\n</code></pre>\n\n<p>from:</p>\n\n<pre><code>futures-preview = { version = \"=0.3.0-alpha.17\", features = [\"compat\"] }`\nhyper = \"0.12.9\"\n</code></pre>\n\n<p>The current example converts the returned <code>Future</code> from a <code>futures 0.3</code> into a <code>futures 0.1</code>, because <code>hyper = \"0.12.9\"</code> is not compatible with <code>futures 0.3</code>'s async/await. </p>\n\n<p>My code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use {\n    futures::future::{FutureExt, TryFutureExt},\n    hyper::{\n        rt::run,\n        service::{make_service_fn, service_fn},\n        Body, Client, Error, Request, Response, Server, Uri,\n    },\n    std::net::SocketAddr,\n    std::str::FromStr,\n};\n\nfn forward_uri&lt;B&gt;(forward_url: &amp;'static str, req: &amp;Request&lt;B&gt;) -&gt; Uri {\n    let forward_uri = match req.uri().query() {\n        Some(query) =&gt; format!(\"{}{}?{}\", forward_url, req.uri().path(), query),\n        None =&gt; format!(\"{}{}\", forward_url, req.uri().path()),\n    };\n\n    Uri::from_str(forward_uri.as_str()).unwrap()\n}\n\nasync fn call(\n    forward_url: &amp;'static str,\n    mut _req: Request&lt;Body&gt;,\n) -&gt; Result&lt;Response&lt;Body&gt;, hyper::Error&gt; {\n    *_req.uri_mut() = forward_uri(forward_url, &amp;_req);\n    let url_str = forward_uri(forward_url, &amp;_req);\n    let res = Client::new().get(url_str).await;\n    res\n}\n\nasync fn run_server(forward_url: &amp;'static str, addr: SocketAddr) {\n    let forwarded_url = forward_url;\n    let serve_future = service_fn(move |req| call(forwarded_url, req).boxed());\n\n    let server = Server::bind(&amp;addr).serve(serve_future);\n    if let Err(err) = server.await {\n        eprintln!(\"server error: {}\", err);\n    }\n}\n\nfn main() {\n    // Set the address to run our socket on.\n    let addr = SocketAddr::from(([127, 0, 0, 1], 3000));\n    let url = \"http://127.0.0.1:9061\";\n    let futures_03_future = run_server(url, addr);\n    run(futures_03_future);\n}\n</code></pre>\n\n<p>First, I receive this error for <code>server</code> in <code>run_server</code> function:</p>\n\n<blockquote>\n  <p>the trait <code>tower_service::Service&lt;&amp;'a\n  hyper::server::tcp::addr_stream::AddrStream&gt;</code> is not implemented for\n  <code>hyper::service::service::ServiceFn&lt;[closure@src/main.rs:35:35: 35:78\n  forwarded_url:_], hyper::body::body::Body&gt;</code></p>\n</blockquote>\n\n<p>Also, I cannot use <code>hyper::rt::run</code> because it might have been implemented differently in <code>hyper = 0.13.0-alpha.4</code>.</p>\n\n<p>I will be grateful if you tell me your ideas on how to fix it.</p>\n"}, {"tags": ["rust", "rust-tokio"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 3, "creation_date": 1571743150, "post_id": 58502916, "comment_id": 103334632, "body": "There&#39;s clearly a question missing."}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 1, "creation_date": 1571745322, "post_id": 58502916, "comment_id": 103335822, "body": "<code>tokio::spawn</code> expects <code>Future</code> as argument not a random closure. You might use <code>let process = futures::future::lazy(move || Ok(()));</code> to use closure as Future(which will be executed on it&#39;s first poll) but this depends on your requirement, what do you really want to achieve?  Please check <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=77c6fe3ade55a3211aefc011f3634daf\" rel=\"nofollow noreferrer\">this code</a> and compare with yours"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1571755279, "post_id": 58502916, "comment_id": 103341664, "body": "@&#214;merErden sounds like an answer to me!"}], "answers": [{"tags": [], "owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "is_accepted": true, "score": 2, "last_activity_date": 1571757848, "last_edit_date": 1571757848, "creation_date": 1571757629, "answer_id": 58507495, "question_id": 58502916, "link": "https://stackoverflow.com/questions/58502916/how-do-i-solve-the-trait-bound-closure-tokiopreludefuture-is-not-satis/58507495#58507495", "title": "How do I solve &quot;the trait bound `[closure]: tokio::prelude::Future` is not satisfied&quot; when calling tokio::spawn?", "body": "<p>Please check the <a href=\"https://docs.rs/tokio/0.1.22/tokio/executor/fn.spawn.html\" rel=\"nofollow noreferrer\">definition of <code>tokio::spawn</code></a>: </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn spawn&lt;F&gt;(f: F) -&gt; Spawn \nwhere\n    F: Future&lt;Item = (), Error = ()&gt; + 'static + Send\n</code></pre>\n\n<p>It expects an implementation of <code>Future</code> as its argument. The closure you passed into <code>tokio::spawn</code> is not an implementation of <code>Future</code>. Instead of a closure, Futures-rs has <a href=\"https://docs.rs/futures/0.1.29/futures/future/fn.lazy.html\" rel=\"nofollow noreferrer\"><code>lazy</code></a> </p>\n\n<blockquote>\n  <p>Creates a new future which will eventually be the same as the one created by the closure provided.</p>\n</blockquote>\n\n<p>Simply, a <code>lazy</code> future holds a closure to execute. This happens on the first execution of <code>poll</code> made by the executor (in this case you are using Tokio executor).</p>\n\n<p>If you wrap your closure with <code>lazy</code>, your code will work as you expected.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate tokio; // 0.1.22\n\nuse tokio::net::TcpListener;\nuse tokio::prelude::*;\n\nfn main() {\n    let addr = \"0.0.0.0:1502\".parse().unwrap();\n    let listener = TcpListener::bind(&amp;addr).unwrap();\n\n    let done = listener\n        .incoming()\n        .map_err(|e| println!(\"failed to accept socket; error = {:?}\", e))\n        .for_each(move |_socket| {\n            let process = futures::future::lazy(move || {\n                println!(\"My closure executed at future\");\n                Ok(())\n            });\n\n            tokio::spawn(process)\n        });\n\n    tokio::run(done);\n}\n</code></pre>\n"}], "owner": {"reputation": 144, "user_id": 5613164, "user_type": "registered", "profile_image": "https://graph.facebook.com/959533824107532/picture?type=large", "display_name": "Micha\u0142 Hanusek", "link": "https://stackoverflow.com/users/5613164/micha%c5%82-hanusek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 58507495, "answer_count": 1, "score": 0, "last_activity_date": 1571757848, "creation_date": 1571742539, "last_edit_date": 1571755259, "question_id": 58502916, "link": "https://stackoverflow.com/questions/58502916/how-do-i-solve-the-trait-bound-closure-tokiopreludefuture-is-not-satis", "title": "How do I solve &quot;the trait bound `[closure]: tokio::prelude::Future` is not satisfied&quot; when calling tokio::spawn?", "body": "<pre><code>extern crate tokio; // 0.1.22\n\nuse tokio::io;\nuse tokio::net::TcpListener;\nuse tokio::prelude::*;\n\nuse bytes::Bytes; // 0.4.12\n\nfn main() {\n    let addr = \"0.0.0.0:1502\".parse().unwrap();\n    let mut listener = TcpListener::bind(&amp;addr).unwrap();\n\n    let done = listener\n        .incoming()\n        .map_err(|e| println!(\"failed to accept socket; error = {:?}\", e))\n        .for_each(move |socket| {\n            let process = move || {};\n\n            tokio::spawn(process)\n        });\n\n    tokio::run(done);\n    Ok(());\n\n    tokio::run(done);\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `[closure@src/main.rs:17:27: 17:37]: tokio::prelude::Future` is not satisfied\n  --&gt; src/main.rs:19:13\n   |\n19 |             tokio::spawn(process)\n   |             ^^^^^^^^^^^^ the trait `tokio::prelude::Future` is not implemented for `[closure@src/main.rs:17:27: 17:37]`\n   |\n   = note: required by `tokio::spawn`\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=9dbfa8a0918df9d1d261c2b9d18eb8dc\" rel=\"nofollow noreferrer\">Playground</a>)</p>\n"}, {"tags": ["oracle", "rust"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 5554685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9556800d5f1178d1db6ce9b94c98b56b?s=128&d=identicon&r=PG&f=1", "display_name": "Loa", "link": "https://stackoverflow.com/users/5554685/loa"}, "edited": false, "score": 0, "creation_date": 1571836123, "post_id": 58501046, "comment_id": 103372161, "body": "Thanks, I&#39;m still learning, especially how to read and use the external crates.Unfortunately I&#39;m still receiving the &quot;error[E0106]: missing lifetime specifier&quot; at ResultSet&lt;Row&gt;&gt;."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 3, "user_id": 5554685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9556800d5f1178d1db6ce9b94c98b56b?s=128&d=identicon&r=PG&f=1", "display_name": "Loa", "link": "https://stackoverflow.com/users/5554685/loa"}, "edited": false, "score": 0, "creation_date": 1571843831, "post_id": 58501046, "comment_id": 103376746, "body": "That&#39;s how the return type is written in the documentation, that&#39;s strange. I cannot test the code right now, so I cannot help you anymore. I think that you cannot do the thing like that since the result set lifetime is bound to the connection lifetime."}, {"owner": {"reputation": 3, "user_id": 5554685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9556800d5f1178d1db6ce9b94c98b56b?s=128&d=identicon&r=PG&f=1", "display_name": "Loa", "link": "https://stackoverflow.com/users/5554685/loa"}, "edited": false, "score": 0, "creation_date": 1571923567, "post_id": 58501046, "comment_id": 103406292, "body": "I opened an issue in Github."}], "tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 1, "last_activity_date": 1571736237, "creation_date": 1571736237, "answer_id": 58501046, "question_id": 58500551, "link": "https://stackoverflow.com/questions/58500551/how-to-return-oracle-query-results-to-rust-main-function/58501046#58501046", "title": "How to return Oracle query results to Rust main function?", "body": "<p>There are many errors in your code. <a href=\"https://docs.rs/oracle/0.3.1/oracle/struct.ResultSet.html\" rel=\"nofollow noreferrer\"><code>ResultSet</code></a> expects 2 generic parameters: one lifetime, and one type. <a href=\"https://docs.rs/oracle/0.3.1/oracle/struct.Connection.html#method.query\" rel=\"nofollow noreferrer\"><code>query</code></a> returns a <code>oracle::Result&lt;ResultSet&lt;Row&gt;&gt;</code>, so your code must looks like:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use oracle::{Connection, ResultSet, Row};\n\nfn oracle_connect(uid: &amp;str, pass: &amp;str, server: &amp;str, sql: &amp;str) -&gt; oracle::Result&lt;ResultSet&lt;Row&gt;&gt; {\n    let conn = Connection::connect(uid, pass, server)?;\n    let mut stmt = conn.prepare(sql, &amp;[])?;\n\n    stmt.query(&amp;[])\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 5554685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9556800d5f1178d1db6ce9b94c98b56b?s=128&d=identicon&r=PG&f=1", "display_name": "Loa", "link": "https://stackoverflow.com/users/5554685/loa"}, "is_accepted": false, "score": 0, "last_activity_date": 1572257342, "creation_date": 1572257342, "answer_id": 58588993, "question_id": 58500551, "link": "https://stackoverflow.com/questions/58500551/how-to-return-oracle-query-results-to-rust-main-function/58588993#58588993", "title": "How to return Oracle query results to Rust main function?", "body": "<p>The maintainer of the Oracle crate helped out. This code works but is inefficient.</p>\n\n<pre><code>use oracle::{Connection, Row};\n\nfn oracle_connect(uid: &amp;str, pass: &amp;str, server: &amp;str, sql: &amp;str) -&gt; \noracle::Result&lt;Vec&lt;Row&gt;&gt; {\n    let conn = Connection::connect(uid, pass, server)?;\n    let mut rows = Vec::new();\n    for row_result in conn.query(sql, &amp;[])? {\n        rows.push(row_result?);\n    }\n    Ok(rows)\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 5554685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9556800d5f1178d1db6ce9b94c98b56b?s=128&d=identicon&r=PG&f=1", "display_name": "Loa", "link": "https://stackoverflow.com/users/5554685/loa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 625, "favorite_count": 0, "accepted_answer_id": 58501046, "answer_count": 2, "score": 0, "last_activity_date": 1572257342, "creation_date": 1571734628, "last_edit_date": 1571735415, "question_id": 58500551, "link": "https://stackoverflow.com/questions/58500551/how-to-return-oracle-query-results-to-rust-main-function", "title": "How to return Oracle query results to Rust main function?", "body": "<p>I'm using the Oracle crate to connect to an Oracle database, which works. I have created an extra function to pass the schema, uid, password and sql statement. I'm not able to have this function return a resultset.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate oracle;\n\nuse oracle::{Connection, Version};\n\nfn oracle_connect(uid: &amp;str, pass: &amp;str, server: &amp;str, sql: &amp;str) -&gt; oracle::ResultSet&lt;&amp;T&gt; {\n    let client_ver = Version::client().unwrap();\n    let conn = Connection::connect(uid, pass, server).unwrap();\n    let (server_ver, banner) = conn.server_version().unwrap();\n    let mut stmt = conn.prepare(sql, &amp;[]).unwrap();\n    let rows = stmt.query(&amp;[]).unwrap();\n}\n\nfn main() {\n    let mut sql_result = oracle_connect(\"test\", \"test\", \"SID\", \"select * from OPTIONS\");\n    println!(\"{:?}\", sql_result);\n}\n</code></pre>\n\n<p>errors I receive are: '^^ undeclared lifetime' or 'wrong number of type arguments'. I expect to get the  query results or rows back.</p>\n"}, {"tags": ["rust", "reqwest"], "answers": [{"comments": [{"owner": {"reputation": 2022, "user_id": 4915222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wuFdJ.jpg?s=128&g=1", "display_name": "Peter Paul Kiefer", "link": "https://stackoverflow.com/users/4915222/peter-paul-kiefer"}, "edited": false, "score": 0, "creation_date": 1572286446, "post_id": 58499946, "comment_id": 103505345, "body": "I have no problem with down voting my answer. But I see nothing wrong with it. I&#39;m no rust guru, but I can read the manuals. And it was useful for the OP. So why mark this answer as not valuable and keeping other from getting a useful information or link? And if there is a mistake why just down vote. Why don&#39;t you write a comment what&#39;s wrong and help others. From my point of view: I got a message that there is something wrong with my answer but I don&#39;t know what it is."}], "tags": [], "owner": {"reputation": 2022, "user_id": 4915222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wuFdJ.jpg?s=128&g=1", "display_name": "Peter Paul Kiefer", "link": "https://stackoverflow.com/users/4915222/peter-paul-kiefer"}, "is_accepted": false, "score": -1, "last_activity_date": 1571732946, "last_edit_date": 1571732946, "creation_date": 1571732587, "answer_id": 58499946, "question_id": 58499665, "link": "https://stackoverflow.com/questions/58499665/adding-headers-to-a-get-call/58499946#58499946", "title": "Adding Headers to a GET Call", "body": "<p>I have neither deep knowledge of rust nor reqwest, but from what I see, you transform the Response object to text and print the Response structure without the message body or payload. With quick search on Google, I found a method <code>text()</code> belonging to the Response object which should give you the payload. </p>\n\n<p>Here is the link:\n<a href=\"https://docs.rs/reqwest/0.8.4/reqwest/struct.Response.html\" rel=\"nofollow noreferrer\">https://docs.rs/reqwest/0.8.4/reqwest/struct.Response.html</a></p>\n\n<p>That might be a solution:</p>\n\n<pre><code>extern crate reqwest;\nuse reqwest::header::HeaderName;\nuse reqwest::header::HeaderValue;\nuse reqwest::header::ACCEPT;\nuse reqwest::header::CONTENT_DISPOSITION;\n\nfn main() {\n    let client = reqwest::Client::new();\n    let response_text = client\n        .get(\"http://nemlog.com.au/show/1h/NEMLOG.json?id1=RRP.DISPATCHPRICE0&amp;k1=vic\")\n        .header(CONTENT_DISPOSITION, \"inline\")\n        .header(ACCEPT, \"*/*\")\n        //.send() &lt;-- it seems that you do not have to send explicitly\n        .text();  // &lt;-- !!!!!!! Change\n\n    println!(\"Response Text: {:#?}\", response_text);\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 10616092, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RUSIwSBPjYc/AAAAAAAAAAI/AAAAAAAAAEs/s6eyKtem2fY/photo.jpg?sz=128", "display_name": "simwilso", "link": "https://stackoverflow.com/users/10616092/simwilso"}, "edited": false, "score": 0, "creation_date": 1571804841, "post_id": 58501883, "comment_id": 103357571, "body": "Thanks Omer.  I managed to fix this issue and it was a combination of what you and Peter have described so thanks alot."}], "tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": false, "score": 0, "last_activity_date": 1571739965, "last_edit_date": 1571739965, "creation_date": 1571738953, "answer_id": 58501883, "question_id": 58499665, "link": "https://stackoverflow.com/questions/58499665/adding-headers-to-a-get-call/58501883#58501883", "title": "Adding Headers to a GET Call", "body": "<p><code>send</code> is lazy: it returns as soon as the reply headers are received without waiting for the body. You can get the text with the <a href=\"https://docs.rs/reqwest/0.8.4/reqwest/struct.Response.html#method.text\" rel=\"nofollow noreferrer\"><code>text</code></a> method, which does wait until the full text is received, or you can use the <a href=\"https://docs.rs/reqwest/0.8.4/reqwest/struct.Response.html#impl-Read\" rel=\"nofollow noreferrer\"><code>Read</code></a> implementation to process it in chunks:</p>\n\n<pre><code>let mut response = client\n    .get(\"http://nemlog.com.au/show/1h/NEMLOG.json?id1=RRP.DISPATCHPRICE0&amp;k1=vic\")\n    .header(CONTENT_DISPOSITION, \"inline\")\n    .header(ACCEPT, \"*/*\")\n    .send()\n    .unwrap();\n\nprintln!(\"Response: {:#?}\", response);\nprintln!(\"Response text: {}\", response.text().unwrap());\n</code></pre>\n\n<p>As for the <code>content-disposition</code> of the reply, are you sure that your server honors the <code>content-disposition</code> header? Can you check the response headers you get with JS and Postman?</p>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 10616092, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RUSIwSBPjYc/AAAAAAAAAAI/AAAAAAAAAEs/s6eyKtem2fY/photo.jpg?sz=128", "display_name": "simwilso", "link": "https://stackoverflow.com/users/10616092/simwilso"}, "is_accepted": false, "score": 0, "last_activity_date": 1571805241, "creation_date": 1571805241, "answer_id": 58515556, "question_id": 58499665, "link": "https://stackoverflow.com/questions/58499665/adding-headers-to-a-get-call/58515556#58515556", "title": "Adding Headers to a GET Call", "body": "<p>Thanks Peter and Omer.</p>\n\n<p>I managed to get this fixed and the answer was a combination of your suggestions.\nI needed to add the following to my code to send, unwrap the response then run the text method:</p>\n\n<pre><code>.send()\n.unwrap()\n.text();\n</code></pre>\n\n<p>Thanks so much both!</p>\n"}], "owner": {"reputation": 3, "user_id": 10616092, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RUSIwSBPjYc/AAAAAAAAAAI/AAAAAAAAAEs/s6eyKtem2fY/photo.jpg?sz=128", "display_name": "simwilso", "link": "https://stackoverflow.com/users/10616092/simwilso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 400, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1571805241, "creation_date": 1571731491, "last_edit_date": 1571731799, "question_id": 58499665, "link": "https://stackoverflow.com/questions/58499665/adding-headers-to-a-get-call", "title": "Adding Headers to a GET Call", "body": "<p>I am new to Rust and trying to call an API using the <code>reqwest</code> crate.\nI want my code to;</p>\n\n<ol>\n<li>Include with the GET request the 'Content-Disposition: Inline' header.</li>\n<li>Return and print the JSON as text</li>\n</ol>\n\n<p>I'm not sure what I'm doing wrong and hoping someone can help identify it for me.</p>\n\n<p>The request works fine for me in JS and in Postman and returns the array JSON data,\nalso in my RUST code below the request returns a 200 success.</p>\n\n<p>But I can't see the response data\n&amp; the remote server responds with the <code>\"Content-Disposition\"</code> header default (not 'inline' as I specify).</p>\n\n<p>My Rust Code which compiles fine and seems to send ok:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate reqwest;\nuse reqwest::header::HeaderName;\nuse reqwest::header::HeaderValue;\nuse reqwest::header::ACCEPT;\nuse reqwest::header::CONTENT_DISPOSITION;\n\nfn main() {\n    let client = reqwest::Client::new();\n    let response_text = client\n        .get(\"http://nemlog.com.au/show/1h/NEMLOG.json?id1=RRP.DISPATCHPRICE0&amp;k1=vic\")\n        .header(CONTENT_DISPOSITION, \"inline\")\n        .header(ACCEPT, \"*/*\")\n        .send()\n        .unwrap();\n\n    println!(\"Response Text: {:#?}\", response_text);\n}\n</code></pre>\n\n<p>the response I recieve in the console from the above request is:</p>\n\n<pre><code>Response Text: Response {\n  url: \"http://nemlog.com.au/show/1h/NEMLOG.json?id1=RRP.DISPATCHPRICE0&amp;k1=vic\",\n  status: 200,\n  headers: {\n    \"date\": \"Tue, 22 Oct 2019 06:33:45 GMT\",\n    \"server\": \"Apache/2.4.6 (CentOS) PHP/5.4.16 mod_wsgi/3.4 Python/2.7.5\",\n    \"content-disposition\": \"attachment; filename=NEMLOG.json\",\n    \"transfer-encoding\": \"chunked\",\n    \"content-type\": \"text/json; name=\\\"NEMLOG.json\\\"\",\n  },\n}\n</code></pre>\n\n<p>The output I wish to see is the inline response from the call which looks like this:</p>\n\n<pre><code>{\"SETTLEMENTDATE\":\"2019-10-22T10:45:00Z\",\"REGIONID\":\"VIC1\",\"RRP.DISPATCHPRICE0\":91.272}\n{\"SETTLEMENTDATE\":\"2019-10-22T10:50:00Z\",\"REGIONID\":\"VIC1\",\"RRP.DISPATCHPRICE0\":75.7859}\n{\"SETTLEMENTDATE\":\"2019-10-22T10:55:00Z\",\"REGIONID\":\"VIC1\",\"RRP.DISPATCHPRICE0\":74.8683}\n{\"SETTLEMENTDATE\":\"2019-10-22T11:00:00Z\",\"REGIONID\":\"VIC1\",\"RRP.DISPATCHPRICE0\":25.14}\n{\"SETTLEMENTDATE\":\"2019-10-22T11:05:00Z\",\"REGIONID\":\"VIC1\",\"RRP.DISPATCHPRICE0\":16.4812}\n{\"SETTLEMENTDATE\":\"2019-10-22T11:10:00Z\",\"REGIONID\":\"VIC1\",\"RRP.DISPATCHPRICE0\":56.4572}\n{\"SETTLEMENTDATE\":\"2019-10-22T11:15:00Z\",\"REGIONID\":\"VIC1\",\"RRP.DISPATCHPRICE0\":38.5679}\n{\"SETTLEMENTDATE\":\"2019-10-22T11:20:00Z\",\"REGIONID\":\"VIC1\",\"RRP.DISPATCHPRICE0\":47.5941}\n{\"SETTLEMENTDATE\":\"2019-10-22T11:25:00Z\",\"REGIONID\":\"VIC1\",\"RRP.DISPATCHPRICE0\":25.14}\n{\"SETTLEMENTDATE\":\"2019-10-22T11:30:00Z\",\"REGIONID\":\"VIC1\",\"RRP.DISPATCHPRICE0\":51.8465}\n{\"SETTLEMENTDATE\":\"2019-10-22T11:35:00Z\",\"REGIONID\":\"VIC1\",\"RRP.DISPATCHPRICE0\":71.7957}\n{\"SETTLEMENTDATE\":\"2019-10-22T11:40:00Z\",\"REGIONID\":\"VIC1\",\"RRP.DISPATCHPRICE0\":72.0757}\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 3, "creation_date": 1571727154, "post_id": 58497367, "comment_id": 103326135, "body": "There are several small errors which would have been avoided by testing the code before asking. If you can&#39;t do it locally you can always use a playground like <a href=\"https://play.rust-lang.org/\" rel=\"nofollow noreferrer\">play.rust-lang.org</a>"}], "answers": [{"tags": [], "owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "is_accepted": false, "score": 1, "last_activity_date": 1571720914, "creation_date": 1571720914, "answer_id": 58497422, "question_id": 58497367, "link": "https://stackoverflow.com/questions/58497367/how-to-add-more-than-one-string-in-rust-arrays/58497422#58497422", "title": "How to add more than one string in rust arrays?", "body": "<p>The first argument of <code>print!</code> should be the full string that you want to print. It seems like you probably want this:</p>\n\n<pre><code>print!(\"Fourth Index {} \\n\\n\\n\\n\\t\\t:{}\", list[4], list1[1]);\n</code></pre>\n\n<p>Two other quick notes:</p>\n\n<ol>\n<li><code>\"TURKEY\"};</code> should be <code>\"TURKEY\"];</code> with <code>]</code> instead of <code>}</code>.</li>\n<li>As in the line above, you have <code>/t</code> when I assume you meant <code>\\t</code>.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 19413, "user_id": 581076, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/KQGy0.png?s=128&g=1", "display_name": "tymtam", "link": "https://stackoverflow.com/users/581076/tymtam"}, "is_accepted": false, "score": 0, "last_activity_date": 1571741897, "last_edit_date": 1571741897, "creation_date": 1571740556, "answer_id": 58502348, "question_id": 58497367, "link": "https://stackoverflow.com/questions/58497367/how-to-add-more-than-one-string-in-rust-arrays/58502348#58502348", "title": "How to add more than one string in rust arrays?", "body": "<p>Your code, after @loganfsmyth's improvements will print:</p>\n\n<ul>\n<li>element at index <code>4</code> from <code>list</code>,</li>\n<li>element at index <code>2</code> from <code>list1</code>.</li>\n</ul>\n\n<p>I wonder if you wanted to print:</p>\n\n<ul>\n<li>element at index <code>4</code> from <code>list</code>,</li>\n<li>element at index <code>4</code> from <code>list1</code>. </li>\n</ul>\n\n<p>If this is the case, the risk of using two different indexes can be reduced by, instead of two, having a single list of <a href=\"https://doc.rust-lang.org/nightly/std/primitive.tuple.html\" rel=\"nofollow noreferrer\">tuples</a>.</p>\n\n<p>The tuple-ed version of the code could be as the following. </p>\n\n<pre><code>let list = [(\"PAKISTAN\",2),(\"INDIA\",3),(\"IRAN\",4),(\"CHINA\",5),(\"TURKEY\",6)];\n\nlet i = 4;\nprint!(\"Fifth Element {} \\n\\n\\n\\n\\t\\t:{}\",list[i].0, list[i].1);\n</code></pre>\n\n<p><em>Please note that <code>list[4]</code> is the <strong>Fift</strong> index, not the <strong>Forth</strong>.</em></p>\n\n<hr>\n\n<h2>Note on alignment</h2>\n\n<p>With <code>\\t\\t</code> the code seems to align the country with the number. The <code>t</code> technique doesn't work well with strings of different widths. Fortunately Rust comes with padding and alignment options for formatting strings. </p>\n\n<p>Let's showcase how this could be used for your example. </p>\n\n<pre><code>let list = [(\"PAKISTAN\",2),(\"INDIA\",3),(\"IRAN\",4),(\"CHINA\",5),(\"TURKEY\",6)];\n\nlet i = 4;\nlet score = format!(\":{}\",list[i].1);  //This gives us ':6'\n\n//&gt;30 = right alignment, width of 30   \nprint!(\"Fifth Element\\n{:&gt;30}\\n\\n\\n\\n{:&gt;30}\",list[i].0, score);\n</code></pre>\n\n<h3>Output</h3>\n\n<pre><code>Fifth Element\n                        TURKEY\n\n\n\n                            :6\n</code></pre>\n\n<p><em>Please note that this only works for <a href=\"https://en.wikipedia.org/wiki/Monospaced_font\" rel=\"nofollow noreferrer\">fixed width fonts</a>.</em></p>\n"}], "owner": {"reputation": 1, "user_id": 9173939, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--h5Klmkmw4I/AAAAAAAAAAI/AAAAAAAAAG4/778kUZe6Y2M/photo.jpg?sz=128", "display_name": "Rao Kamran", "link": "https://stackoverflow.com/users/9173939/rao-kamran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 2, "score": -5, "last_activity_date": 1571741897, "creation_date": 1571720556, "last_edit_date": 1571721715, "question_id": 58497367, "link": "https://stackoverflow.com/questions/58497367/how-to-add-more-than-one-string-in-rust-arrays", "title": "How to add more than one string in rust arrays?", "body": "<p>This is the code which i want tried to write but get  error in solving it i am beginner in  rust dont know so much Will be great if some one guide me</p>\n\n<pre><code>fn main(){\n\n  let list = [\"PAKISTAN\",\"INDIA\",\"IRAN\",\"CHINA\",\"TURKEY\"};\n\n  let list1 = [2,3,4,5,6];\n\n  print!(\"Fourth Index {} \\n\\n\\n\\n\",list[4],\"/t/t:{}\",list1[1]);\n\n}\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "edited": false, "score": 1, "creation_date": 1571714991, "post_id": 58496623, "comment_id": 103322732, "body": "You should share the code for <code>Zoo::hi_all</code> and probably all the code for <code>Zoo</code>. As it is, your code isn&#39;t a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">Minimal, Reproducible Example</a> so it&#39;s hard to explain its behavior. In particular, it&#39;s not clear how <code>Zoo::hi_all</code> uses its type parameter which is the crux of the issue."}, {"owner": {"reputation": 15, "user_id": 12207479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ff736b1602245b89ddfbbec784b4f2?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/12207479/john"}, "reply_to_user": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "edited": false, "score": 0, "creation_date": 1571716553, "post_id": 58496623, "comment_id": 103323006, "body": "Hi @SCappella, thank you for taking the time! I&#39;ve updated the question with impl of Zoo."}, {"owner": {"reputation": 6608, "user_id": 4497253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc929d11ae26463d18e337d295c86fcc?s=128&d=identicon&r=PG&f=1", "display_name": "CoronA", "link": "https://stackoverflow.com/users/4497253/corona"}, "edited": false, "score": 0, "creation_date": 1571716702, "post_id": 58496623, "comment_id": 103323030, "body": "You use a generic type parameter <code>T : Animal</code> never bound to any variable. Rust does (astonishingly) not complain about unused type parameters. Just remove <code>T</code> from the signature of <code>hi_all</code>, it makes no difference."}, {"owner": {"reputation": 15, "user_id": 12207479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ff736b1602245b89ddfbbec784b4f2?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/12207479/john"}, "reply_to_user": {"reputation": 6608, "user_id": 4497253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc929d11ae26463d18e337d295c86fcc?s=128&d=identicon&r=PG&f=1", "display_name": "CoronA", "link": "https://stackoverflow.com/users/4497253/corona"}, "edited": false, "score": 0, "creation_date": 1571717627, "post_id": 58496623, "comment_id": 103323198, "body": "Ookay, mind blown. Thank you @CoronA. I have so many questions though: I guess it makes sense that <code>add()</code> actually accepts an <code>animal</code>, so I need <code>T</code> there but 1) why doesn&#39;t rust warn me to get rid of it on <code>hi_all()</code> and more importantly 2) why does the original <code>hi_all::&lt;Monkey&gt;()</code> work?!"}, {"owner": {"reputation": 6608, "user_id": 4497253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc929d11ae26463d18e337d295c86fcc?s=128&d=identicon&r=PG&f=1", "display_name": "CoronA", "link": "https://stackoverflow.com/users/4497253/corona"}, "edited": false, "score": 1, "creation_date": 1571719230, "post_id": 58496623, "comment_id": 103323509, "body": "I do not know why rust does not warn in this case (1). Yet why should your code fail (2)? <code>Monkey</code> has the <code>trait Animal?  and the lifetime </code>&#39;a` so the type checker is pleased. And it is hard to prove that there could not be any meaningful use of <code>T</code> in future implementations."}, {"owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 0, "creation_date": 1571721904, "post_id": 58496623, "comment_id": 103324177, "body": "The generic parameter <code>T</code> in <code>hi_all&lt;T&gt;</code> is never used"}, {"owner": {"reputation": 15, "user_id": 12207479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ff736b1602245b89ddfbbec784b4f2?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/12207479/john"}, "reply_to_user": {"reputation": 6608, "user_id": 4497253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc929d11ae26463d18e337d295c86fcc?s=128&d=identicon&r=PG&f=1", "display_name": "CoronA", "link": "https://stackoverflow.com/users/4497253/corona"}, "edited": false, "score": 0, "creation_date": 1571764528, "post_id": 58496623, "comment_id": 103346423, "body": "Thank you @CoronA and Svetlin Zarev, I think that makes sense now!"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 12207479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ff736b1602245b89ddfbbec784b4f2?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/12207479/john"}, "edited": false, "score": 0, "creation_date": 1571764478, "post_id": 58502959, "comment_id": 103346394, "body": "Thank you @Peter Hall, makes sense!"}], "tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": true, "score": 3, "last_activity_date": 1571743051, "last_edit_date": 1571743051, "creation_date": 1571742690, "answer_id": 58502959, "question_id": 58496623, "link": "https://stackoverflow.com/questions/58496623/why-is-rust-ok-with-accepting-a-different-struct-when-implementing-the-same-trai/58502959#58502959", "title": "Why is Rust ok with accepting a different struct when implementing the same trait?", "body": "<p>The type variable <code>T</code> is declared in the type of this function:</p>\n\n<pre><code>pub fn hi_all&lt;T&gt;(&amp;self) -&gt; Vec&lt;String&gt;\nwhere\n    T: Animal + 'a,\n{\n    let mut hi: Vec&lt;String&gt; = vec![];\n    for animal in &amp;self.list {\n        if let Some(what) = animal.says() {\n            hi.push(what);\n        }\n    }\n    hi\n}\n</code></pre>\n\n<p>but is never actually used in the function's body! Removing that constraint will have no impact because there is no variable of type <code>T</code> mentioned in the function.</p>\n\n<p>In fact, it never <em>could</em> be used in any practical way, because the elements of the <code>VecDeque</code> are of a specific concrete type, <code>Box&lt;dyn Animal&gt;</code> whereas, from the perspective of code inside the function, <code>T</code> could be <em>any</em> type that implements <code>Animal</code>.</p>\n\n<p>If you need to filter the animals <em>by type</em> then I suggest you use an enum instead of trait objects, so you can discriminate on the enum variant.</p>\n"}], "owner": {"reputation": 15, "user_id": 12207479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ff736b1602245b89ddfbbec784b4f2?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/12207479/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 105, "favorite_count": 0, "accepted_answer_id": 58502959, "answer_count": 1, "score": 0, "last_activity_date": 1571764689, "creation_date": 1571714114, "last_edit_date": 1571764689, "question_id": 58496623, "link": "https://stackoverflow.com/questions/58496623/why-is-rust-ok-with-accepting-a-different-struct-when-implementing-the-same-trai", "title": "Why is Rust ok with accepting a different struct when implementing the same trait?", "body": "<p>I have the following in my tests which compiles and works well:</p>\n\n<pre><code>#[test]\nfn zoo_test() {\n    let mut zoo = Zoo::new();\n\n    zoo.add(Monkey::new(\"m1\".to_string()));\n    zoo.add(Limur::new(\"l1\".to_string()));\n\n    assert_eq!(zoo.hi_all::&lt;Monkey&gt;(), vec![\n        \"Monkey m1 says: ah ah ah\".to_string(),\n        \"Limur l1 says: yo\".to_string()\n    ]);\n}\n</code></pre>\n\n<p>However, I'm a bit confused why <code>zoo.hi_all::&lt;Monkey&gt;()</code> works since it could be <strong>either monkey or limur</strong>. In other words I don't understand why it works for limur, or am I doing this wrong?</p>\n\n<p><strong>Edit:</strong> Here's the code I'm using for <code>src/zoo.rs</code>:</p>\n\n<pre><code>pub mod animal;\npub mod monkey;\npub mod limur;\n\nuse std::collections::VecDeque;\nuse animal::Animal;\n\npub struct Zoo&lt;'a&gt; {\n    list: VecDeque&lt;Box&lt;dyn Animal + 'a&gt;&gt;,\n}\n\nimpl&lt;'a&gt; Zoo&lt;'a&gt; {\n    pub fn new() -&gt; Zoo&lt;'a&gt; {\n        Zoo {\n            list: VecDeque::new(),\n        }\n    }\n\n    pub fn add&lt;T&gt;(&amp;mut self, animal: T)\n    where\n        T: Animal + 'a,\n    {\n        self.list.push_back(Box::new(animal));\n    }\n\n    pub fn hi_all&lt;T&gt;(&amp;self) -&gt; Vec&lt;String&gt;\n    where\n        T: Animal + 'a,\n    {\n        let mut hi: Vec&lt;String&gt; = vec![];\n        for animal in &amp;self.list {\n            if let Some(what) = animal.says() {\n                hi.push(what);\n            }\n        }\n        hi\n    }\n}\n</code></pre>\n"}, {"tags": ["rust", "serde"], "comments": [{"owner": {"reputation": 7882, "user_id": 2722968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d0a9ce812892f03b8342c5a60be24632?s=128&d=identicon&r=PG&f=1", "display_name": "user2722968", "link": "https://stackoverflow.com/users/2722968/user2722968"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571685629, "post_id": 58492598, "comment_id": 103315659, "body": "@shepmaster, the problem comes with <code>Vec&lt;...&gt;</code>, so I need/want to delegate to the <code>Vec</code>-deserializer. <code>deserialize_with=&quot;Vec&lt;Foobar&lt;T&gt;&gt;&quot;</code> is not legal syntax"}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1572903112, "last_edit_date": 1572903112, "creation_date": 1571686434, "answer_id": 58493026, "question_id": 58492598, "link": "https://stackoverflow.com/questions/58492598/deserialize-a-vecfoobart-as-vect-directly-when-foobar-has-exactly-one-fiel/58493026#58493026", "title": "Deserialize a Vec&lt;Foobar&lt;T&gt;&gt; as Vec&lt;T&gt; directly when Foobar has exactly one field", "body": "<p>In the general case, there's no trivial way to make this transformation. For that, review these existing answers:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/48288988/155423\">How do I write a Serde Visitor to convert an array of arrays of strings to a Vec&lt;Vec&lt;f64&gt;&gt;?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/46753955/how-to-transform-fields-before-deserialization-using-serde\">How to transform fields during deserialization using Serde?</a></li>\n</ul>\n\n<p>The first is my normal go-to solution and <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=8d8eb0efbeec42ca056a5ff3d17ce4b9\" rel=\"nofollow noreferrer\">looks like this</a> in this example.</p>\n\n<hr>\n\n<p>However, in your <em>specific</em> case, you say:</p>\n\n<blockquote>\n  <p>objects with exactly one named field value </p>\n</blockquote>\n\n<p>And you've identified a key requirement:</p>\n\n<blockquote>\n  <p>While <code>Foobar</code> adds no extra cost beyond <code>T</code></p>\n</blockquote>\n\n<p>This means that you can make <code>Foobar</code> have a <a href=\"https://doc.rust-lang.org/reference/type-layout.html#the-transparent-representation\" rel=\"nofollow noreferrer\"><em>transparent</em> representation</a> and use <strong>unsafe Rust</strong> to transmute between the types (although <a href=\"https://github.com/rust-lang/rust/issues/64073#issuecomment-533039084\" rel=\"nofollow noreferrer\">not actually with <code>mem::transmute</code></a>):</p>\n\n<pre><code>struct FoobarContainer&lt;T&gt; {\n    values: Vec&lt;T&gt;,\n}\n\n#[derive(serde::Deserialize)]\n#[repr(transparent)]\nstruct Foobar&lt;T&gt; {\n    value: T,\n}\n\nimpl&lt;'de, T&gt; serde::Deserialize&lt;'de&gt; for FoobarContainer&lt;T&gt;\nwhere\n    T: serde::Deserialize&lt;'de&gt;,\n{\n    fn deserialize&lt;D&gt;(deserializer: D) -&gt; Result&lt;Self, D::Error&gt;\n    where\n        D: serde::Deserializer&lt;'de&gt;,\n    {\n        let mut v: Vec&lt;Foobar&lt;T&gt;&gt; = serde::Deserialize::deserialize(deserializer)?;\n\n        // I copied this from Stack Overflow without reading the surrounding\n        // text that describes why this is actually safe.\n        let values = unsafe {\n            let data = v.as_mut_ptr() as *mut T;\n            let len = v.len();\n            let cap = v.capacity();\n\n            std::mem::forget(v);\n\n            Vec::from_raw_parts(data, len, cap)\n        };\n\n        Ok(FoobarContainer { values })\n    }\n}\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/48308759/155423\">How do I convert a Vec&lt;T&gt; to a Vec&lt;U&gt; without copying the vector?</a></li>\n</ul>\n"}], "owner": {"reputation": 7882, "user_id": 2722968, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d0a9ce812892f03b8342c5a60be24632?s=128&d=identicon&r=PG&f=1", "display_name": "user2722968", "link": "https://stackoverflow.com/users/2722968/user2722968"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 58493026, "answer_count": 1, "score": 0, "last_activity_date": 1572903112, "creation_date": 1571684316, "last_edit_date": 1571686654, "question_id": 58492598, "link": "https://stackoverflow.com/questions/58492598/deserialize-a-vecfoobart-as-vect-directly-when-foobar-has-exactly-one-fiel", "title": "Deserialize a Vec&lt;Foobar&lt;T&gt;&gt; as Vec&lt;T&gt; directly when Foobar has exactly one field", "body": "<p>I'm given a data-format that includes a sequence of objects with exactly one named field <code>value</code> each. Can I remove this layer of indirection while deserializing?</p>\n\n<p>When deserializing, the natural representation would be</p>\n\n<pre><code>/// Each record has it's own `{ value: ... }` object\n#[derive(serde::Deserialize)]\nstruct Foobar&lt;T&gt; {\n    value: T,\n}\n\n/// The naive representation, via `Foobar`...\n#[derive(serde::Deserialize)]\nstruct FoobarContainer {\n    values: Vec&lt;Foobar&lt;T&gt;&gt;,\n}\n</code></pre>\n\n<p>While <code>Foobar</code> adds no extra cost beyond <code>T</code>, I'd like to remove this layer of indirection at the type-level:</p>\n\n<pre><code>#[derive(serde::Deserialize)]\nstruct FoobarContainer {\n    values: Vec&lt;T&gt;,\n}\n</code></pre>\n\n<p>Can <code>Foobar</code> be removed from <code>FoobarContainer</code>, while still using it using deserialization?</p>\n"}, {"tags": ["rust", "iterator"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571684265, "post_id": 58492506, "comment_id": 103315091, "body": "There&#39;s nothing built in, but you could create your own iterator that does it."}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 2, "creation_date": 1571689925, "post_id": 58492506, "comment_id": 103317326, "body": "How about <code>for j in i.iter().map(|&amp;i| v[i]) {}</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 5358, "user_id": 1932452, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/7dfca62a1e4eb69f39ce00152862c70e?s=128&d=identicon&r=PG", "display_name": "wyer33", "link": "https://stackoverflow.com/users/1932452/wyer33"}, "edited": false, "score": 0, "creation_date": 1571693136, "post_id": 58493824, "comment_id": 103318466, "body": "This is definitely better than the 60 lines of code that it took to define an appropriate iterator.  It reverses the ordering of indexing to values that I had thought, but works well.  Thanks!"}], "tags": [], "owner": {"reputation": 30359, "user_id": 255688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74b63650ed07d745fd9accf52e4d286b?s=128&d=identicon&r=PG", "display_name": "phimuemue", "link": "https://stackoverflow.com/users/255688/phimuemue"}, "is_accepted": true, "score": 3, "last_activity_date": 1571690387, "creation_date": 1571690387, "answer_id": 58493824, "question_id": 58492506, "link": "https://stackoverflow.com/questions/58492506/how-to-create-an-iterator-that-yields-elements-of-a-collection-specified-by-a-li/58493824#58493824", "title": "How to create an iterator that yields elements of a collection specified by a list of indices in Rust?", "body": "<p>One possibility:</p>\n\n<pre><code>i.iter().map(|idx| v[*idx])\n</code></pre>\n\n<p>as in:</p>\n\n<pre><code>fn main() {\n    // Create a vector\n    let v = vec![0.1, 1.2, 2.3, 3.4, 4.5, 5.6, 7.8];\n\n    // Create a series of indices\n    let i = vec![3, 4, 2, 1];\n\n    // Iterate over the elements in v in the order specified by i\n    for j in i.iter().map(|idx| v[*idx]) {\n        println!(\"{}\", j);\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 5358, "user_id": 1932452, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/7dfca62a1e4eb69f39ce00152862c70e?s=128&d=identicon&r=PG", "display_name": "wyer33", "link": "https://stackoverflow.com/users/1932452/wyer33"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "accepted_answer_id": 58493824, "answer_count": 1, "score": 2, "last_activity_date": 1573653977, "creation_date": 1571683956, "last_edit_date": 1573653977, "question_id": 58492506, "link": "https://stackoverflow.com/questions/58492506/how-to-create-an-iterator-that-yields-elements-of-a-collection-specified-by-a-li", "title": "How to create an iterator that yields elements of a collection specified by a list of indices in Rust?", "body": "<p>Is there a concise way to iterate over a vector using a given list of indices? I have code that looks similar to this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    // Create a vector\n    let v = vec![0.1, 1.2, 2.3, 3.4, 4.5, 5.6, 7.8];\n\n    // Create a series of indices\n    let i = vec![3, 4, 2, 1];\n\n    // Iterate over the elements in v in the order specified by each index in i\n    for j in &amp;i {\n        println!(\"{}\", v[*j]);\n    }\n}\n</code></pre>\n\n<p>I'd like to modify it so that I loop directly over elements in <code>v</code> rather than having to loop over the indices in <code>i</code>.  Basically, something that looks similar to <code>for x in vs[i]</code>.</p>\n"}, {"tags": ["python", "python-3.x", "performance", "rust"], "comments": [{"owner": {"reputation": 711, "user_id": 10734880, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VqInoFdU3M8/AAAAAAAAAAI/AAAAAAAAAA4/KLtzLyk_ZJ0/photo.jpg?sz=128", "display_name": "Nick Martin", "link": "https://stackoverflow.com/users/10734880/nick-martin"}, "edited": false, "score": 2, "creation_date": 1571679687, "post_id": 58491486, "comment_id": 103313112, "body": "Remove the print statement?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1571679979, "post_id": 58491486, "comment_id": 103313231, "body": "<code>build --release</code> is not a Rust command. Did you mean <b><code>cargo build --release</code></b>?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571680013, "post_id": 58491486, "comment_id": 103313245, "body": "Tangentially, no need for <code>&amp;n</code>: <a href=\"https://stackoverflow.com/q/30450399/155423\">Does println! borrow or own the variable?</a>"}, {"owner": {"reputation": 18268, "user_id": 5218354, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-NEO9rZKeffY/AAAAAAAAAAI/AAAAAAAAAKc/9IttO1jUOr4/photo.jpg=k-s128", "display_name": "norok2", "link": "https://stackoverflow.com/users/5218354/norok2"}, "edited": false, "score": 2, "creation_date": 1571680145, "post_id": 58491486, "comment_id": 103313302, "body": "How do you compute the timings?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1571680666, "post_id": 58491486, "comment_id": 103313535, "body": "Without printing of any kind, I expect the Rust program to be completely optimized away to the equivalent of <code>fn main() {}</code>."}], "answers": [{"tags": [], "owner": {"reputation": 30359, "user_id": 255688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74b63650ed07d745fd9accf52e4d286b?s=128&d=identicon&r=PG", "display_name": "phimuemue", "link": "https://stackoverflow.com/users/255688/phimuemue"}, "is_accepted": false, "score": 4, "last_activity_date": 1571691121, "last_edit_date": 1571691121, "creation_date": 1571690713, "answer_id": 58493887, "question_id": 58491486, "link": "https://stackoverflow.com/questions/58491486/how-can-i-improve-the-performance-of-my-rust-code-compared-to-python-code/58493887#58493887", "title": "How can I improve the performance of my Rust code compared to Python code?", "body": "<p>If I recall correctly, <code>println</code> locks stdout. Taken from <a href=\"https://llogiq.github.io/2017/06/01/perf-pitfalls.html\" rel=\"nofollow noreferrer\">Rust Performance Pitfalls</a>:</p>\n\n<blockquote>\n  <p>[...] the default <code>print!</code> macros will lock STDOUT <em>for each write operation</em>. So if you have a larger textual output (or input from STDIN), you should lock manually.</p>\n  \n  <p>This:</p>\n\n<pre><code>let mut out = File::new(\"test.out\");\nprintln!(\"{}\", header);\nfor line in lines {\n    println!(\"{}\", line);\n    writeln!(out, \"{}\", line);\n}\nprintln!(\"{}\", footer);\n</code></pre>\n  \n  <p>locks and unlocks io::stdout a lot, and does a linear number of (potentially small) writes both to stdout and the file. Speed it up with:</p>\n\n<pre><code>{\n    let mut out = File::new(\"test.out\");\n    let mut buf = BufWriter::new(out);\n    let mut lock = io::stdout().lock();\n    writeln!(lock, \"{}\", header);\n    for line in lines {\n        writeln!(lock, \"{}\", line);\n        writeln!(buf, \"{}\", line);\n    }\n    writeln!(lock, \"{}\", footer);\n}   // end scope to unlock stdout and flush/close buf&gt; \n</code></pre>\n  \n  <p>This locks only once and writes only once the buffer is filled (or buf is closed), so it should be much faster.</p>\n  \n  <p>Similarly, for network IO, you may want to use buffered IO.</p>\n</blockquote>\n"}], "owner": {"reputation": 1, "user_id": 12252994, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCmMVB4tBz9xlY56iZRgyoDjsne2P5yCMIU8JCB6w=k-s128", "display_name": "Taza I", "link": "https://stackoverflow.com/users/12252994/taza-i"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1571691121, "creation_date": 1571679343, "last_edit_date": 1571679915, "question_id": 58491486, "link": "https://stackoverflow.com/questions/58491486/how-can-i-improve-the-performance-of-my-rust-code-compared-to-python-code", "title": "How can I improve the performance of my Rust code compared to Python code?", "body": "<p>How can I improve the performance of my Rust code as Python takes around 5 seconds to finish and Rust takes 7 seconds.</p>\n\n<p>I am using <code>build --release</code></p>\n\n<p><strong>Rust code</strong></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    let mut n = 0;\n\n    loop {\n        n += 1;\n        println!(\"The value of n is {}\", &amp;n);\n        if n == 100000 {\n            break;\n        }\n    }\n}\n</code></pre>\n\n<p><strong>Python3 code</strong></p>\n\n<pre class=\"lang-py prettyprint-override\"><code>n = 0\nwhile True:\n   n+=1\n   print(\"The value of n is \",n)\n   if n == 100000:\n       break\n</code></pre>\n"}, {"tags": ["rust", "borrowing"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571679321, "post_id": 58491468, "comment_id": 103312952, "body": "It&#39;s hard to answer your question because it doesn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. We can&#39;t tell what crates (and their versions), types, traits, fields, etc. are present in the code. It would make it easier for us to help you if you try to reproduce your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> if possible, otherwise in a brand new Cargo project, then <a href=\"https://stackoverflow.com/posts/58491468/edit\">edit</a> your question to include the additional info. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MRE tips</a> you can use to reduce your original code for posting here. Thanks!"}, {"owner": {"reputation": 25, "user_id": 7290330, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-H2kZKzXzUSM/AAAAAAAAAAI/AAAAAAAAA2U/xVSlPpwaKIk/photo.jpg?sz=128", "display_name": "Mindstorm38", "link": "https://stackoverflow.com/users/7290330/mindstorm38"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1571679527, "post_id": 58491468, "comment_id": 103313047, "body": "Thanks for your reply (I did not know these tips for Rust questions ...), I will try to reproduce that on Rust Playground but my project is so specific that I don&#39;t know how to reproduce this..."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1571679696, "post_id": 58491468, "comment_id": 103313116, "body": "Your project may be specific, the the problem is not. It&#39;s going to be a duplicate of <a href=\"https://www.google.com/search?q=site:stackoverflow.com%20rust%20borrow%20self%20mutable%20time\" rel=\"nofollow noreferrer\">one or more of hundreds of previous questions</a>, but we can&#39;t tell which until the code you&#39;ve given reproduces the problem."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1571679812, "post_id": 58491468, "comment_id": 103313162, "body": "Specifically, your problem is likely solved by <a href=\"https://stackoverflow.com/q/28512394/155423\">How to lookup from and insert into a HashMap efficiently?</a> and the reasoning is explained in <a href=\"https://stackoverflow.com/q/38023871/155423\">Returning a reference from a HashMap or Vec causes a borrow to last beyond the scope it&#39;s in?</a>."}, {"owner": {"reputation": 25, "user_id": 7290330, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-H2kZKzXzUSM/AAAAAAAAAAI/AAAAAAAAA2U/xVSlPpwaKIk/photo.jpg?sz=128", "display_name": "Mindstorm38", "link": "https://stackoverflow.com/users/7290330/mindstorm38"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571683055, "post_id": 58491468, "comment_id": 103314560, "body": "@Shepmaster Thank you for your reply ! Very interesting."}], "owner": {"reputation": 25, "user_id": 7290330, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-H2kZKzXzUSM/AAAAAAAAAAI/AAAAAAAAA2U/xVSlPpwaKIk/photo.jpg?sz=128", "display_name": "Mindstorm38", "link": "https://stackoverflow.com/users/7290330/mindstorm38"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571679534, "creation_date": 1571679282, "last_edit_date": 1571679534, "question_id": 58491468, "link": "https://stackoverflow.com/questions/58491468/strange-borrowing-lifetime-in-rust", "title": "Strange borrowing lifetime in Rust", "body": "<p>I'm building a little Rust application used to make some statistics about programs and projects. My initial goal was to make it generic, so it can be modified and used as a library.</p>\n\n<p>To do that I've created a <code>Processor</code> structure:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct Processor {\n    handles: Vec&lt;Box&lt;dyn FileTypeHandle&gt;&gt;,\n    files_types: HashMap&lt;String, Box&lt;dyn FileType&gt;&gt;,\n    bytes_count: usize,\n    files_count: usize,\n    dirs_count: usize,\n}\n</code></pre>\n\n<p>What I've named <code>handle</code> is an implementation of <code>FileTypeHandle</code> trait that checks, from the extension of a file, if it can handle it. If it can, the file is processed by it and statistics are made.</p>\n\n<p>Secondly, <code>file_types</code> are implementations of <code>FileType</code> trait that implement methods to write final statistics in console.</p>\n\n<p>Let's assume that my <code>handles</code> vector is filled with some handles.</p>\n\n<p>First, I needed to implement a function in the <code>Processor</code> to search in <code>handles</code> vector for one that can handle the <code>ext</code> file extension:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn handle_ext(&amp;mut self, ext: &amp;String) -&gt; Option&lt;&amp;Box&lt;dyn FileTypeHandle&gt;&gt; {\n    self.handles\n        .iter()\n        .find(move |handle: &amp;&amp;Box&lt;dyn FileTypeHandle&gt;| handle.can_handle(ext))\n}\n</code></pre>\n\n<p><code>FileTypeHandle::can_handle</code> is defined as:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn can_handle(&amp;self, ext: &amp;String) -&gt; bool;\n</code></pre>\n\n<p>I'm using the next function to get a file type in the processor, or create a default one:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn get_file_type(&amp;mut self, ext: &amp;String) -&gt; Option&lt;&amp;Box&lt;dyn FileType&gt;&gt; {\n    if !self.files_types.contains_key(ext) {\n        let base = FileTypeBase::new(String::clone(ext));\n\n        if let Some(v) = self.handle_ext(ext) {\n            self.files_types.insert(String::clone(ext), v.handle(base));\n        }\n    }\n\n    self.files_types.get(ext)\n}\n</code></pre>\n\n<p>I think you understand what I expect from this code, but:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0499]: cannot borrow `self.files_types` as mutable more than once at a time\n  --&gt; src\\processor.rs:61:17\n   |\n59 |             if let Some(v) = self.handle_ext(ext) {\n   |                              ---- first mutable borrow occurs here\n60 | \n61 |                 self.files_types.insert(String::clone(ext), v.handle(base));\n   |                 ^^^^^^^^^^^^^^^^                            - first borrow later used here\n   |                 |\n   |                 second mutable borrow occurs here\n</code></pre>\n\n<p>I've read lot of Rust documentation including the official book, but I didn't know why the static compilation check fails.</p>\n\n<p>Okay, line 61 uses the <code>self.file_types</code> as said in the error message, but why is it the second borrow?! The first underlined word on line 59 is just <code>self</code> (or <code>self.handle_ext</code>?) which are not borrowing <code>self.file_types</code>.</p>\n"}, {"tags": ["python-3.x", "rust", "setuptools", "snips"], "comments": [{"owner": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "edited": false, "score": 1, "creation_date": 1571673301, "post_id": 58489913, "comment_id": 103310139, "body": "You&#39;ve done as <code>rustup</code> tells you to for the first use and <code>source ~&#47;.cargo&#47;env</code>, right?"}, {"owner": {"reputation": 1, "user_id": 12252245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/353fbaca5a347b944551fd1a0ba6a2b7?s=128&d=identicon&r=PG&f=1", "display_name": "zelihakavak", "link": "https://stackoverflow.com/users/12252245/zelihakavak"}, "reply_to_user": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "edited": false, "score": 0, "creation_date": 1571683825, "post_id": 58489913, "comment_id": 103314892, "body": "I hope, I understood you corecctly! I executed at first curl <a href=\"https://sh.rustup.rs\" rel=\"nofollow noreferrer\">sh.rustup.rs</a> -sSf | sh; After that I have source ~/.cargo/env executed. And after that sudo python3 -m pip install setuptools-rust"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11349324, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e0IQxYC_pM0/AAAAAAAAAAI/AAAAAAAAACc/d5RVWrbsock/photo.jpg?sz=128", "display_name": "Beverly Wang", "link": "https://stackoverflow.com/users/11349324/beverly-wang"}, "is_accepted": false, "score": 0, "last_activity_date": 1582526268, "last_edit_date": 1582526268, "creation_date": 1582526096, "answer_id": 60370641, "question_id": 58489913, "link": "https://stackoverflow.com/questions/58489913/cannot-install-snips-nlu-on-raspberry-pi-can-not-find-rust-compiler/60370641#60370641", "title": "Cannot install snips-nlu on Raspberry Pi: Can not find Rust compiler", "body": "<p>After install Rust compiler: </p>\n\n<pre><code>curl https://sh.rustup.rs -sSf | sh\n</code></pre>\n\n<p>You can try a restart and then continue the installation of NLU. \nRestart is to ensure that path of Rust is being recorded in PATH.</p>\n"}], "owner": {"reputation": 1, "user_id": 12252245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/353fbaca5a347b944551fd1a0ba6a2b7?s=128&d=identicon&r=PG&f=1", "display_name": "zelihakavak", "link": "https://stackoverflow.com/users/12252245/zelihakavak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1559, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1582526268, "creation_date": 1571673179, "last_edit_date": 1571673319, "question_id": 58489913, "link": "https://stackoverflow.com/questions/58489913/cannot-install-snips-nlu-on-raspberry-pi-can-not-find-rust-compiler", "title": "Cannot install snips-nlu on Raspberry Pi: Can not find Rust compiler", "body": "<p>I followed <a href=\"https://snips-nlu.readthedocs.io/en/latest/installation.html\" rel=\"nofollow noreferrer\">these instructions</a> to install snips-nlu on a Raspberry Pi:</p>\n\n<ol>\n<li>Rust Installation: <code>curl https://sh.rustup.rs -sSf | sh</code></li>\n<li>Setuptools-rust:   <code>sudo python3 -m pip install setuptools-rust</code></li>\n<li>NLU Installation:  <code>sudo python3 -m pip install snips-nlu</code></li>\n</ol>\n\n<p>My console log:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Building wheels for collected packages: snips-nlu-utils, snips-nlu-parsers\n.\n.\n.  error: Can not find Rust compiler\n</code></pre>\n\n<p>I tried with different Python versions.</p>\n\n<p>I found <a href=\"https://github.com/PyO3/setuptools-rust\" rel=\"nofollow noreferrer\">setuptools-rust</a>, but it did not help, because I don't understand what I should do with it.</p>\n\n<p>How can I fix this Rust compiler error message and install snips-nlu on a Raspberry Pi?</p>\n"}, {"tags": ["rust", "traits", "associated-types"], "comments": [{"owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 0, "creation_date": 1571680449, "post_id": 58488614, "comment_id": 103313440, "body": "What about <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f30bc9926ae27a7f19d45945fd349e4f\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a> Do you really need the associated type"}, {"owner": {"reputation": 561, "user_id": 266704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/62b20dd1ce566175ee2dc612aa8d2c11?s=128&d=identicon&r=PG", "display_name": "andrewtc", "link": "https://stackoverflow.com/users/266704/andrewtc"}, "reply_to_user": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 0, "creation_date": 1571687807, "post_id": 58488614, "comment_id": 103316499, "body": "@SvetlinZarev The reason I can&#39;t is because <code>Make</code> is part of my library, but <code>Bootstrapper</code> needs to be user-defined. I want the user to be able to define their own <code>trait</code> that extends <code>Make</code>, since I have library methods that operate on generics with this <code>trait</code> bound. However, I don&#39;t want calling <code>make</code> to just return a <code>Box&lt;Any&gt;</code> and require the user to cast up and down again in order to get back to <code>Box&lt;Bootstrapper&gt;</code>. I want the user to control what type of <code>Box</code> is returned, while still being able to define their own <code>trait</code> that requires <code>make</code> to return a <code>Box&lt;dyn ...&gt;</code> of itself."}], "answers": [{"tags": [], "owner": {"reputation": 561, "user_id": 266704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/62b20dd1ce566175ee2dc612aa8d2c11?s=128&d=identicon&r=PG", "display_name": "andrewtc", "link": "https://stackoverflow.com/users/266704/andrewtc"}, "is_accepted": true, "score": 0, "last_activity_date": 1572128828, "last_edit_date": 1572128828, "creation_date": 1572127193, "answer_id": 58575051, "question_id": 58488614, "link": "https://stackoverflow.com/questions/58488614/is-there-a-way-to-have-a-trait-specify-itself-for-an-associated-type-in-another/58575051#58575051", "title": "Is there a way to have a trait specify itself for an associated type in another trait that it extends?", "body": "<p>The solution I ended up with was this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>/// A meta-`trait` that defines the associated types for a subset of `Make`.\ntrait Traits {\n    type Output : ?Sized;\n}\n\n/// A `trait` for making things. Takes in a set of `Traits` that define the\n/// output for the `make()` function.\ntrait Make {\n    type Traits : Traits;\n    fn make(self : Box&lt;Self&gt;) -&gt; Box&lt;&lt;Self::Traits as Traits&gt;::Output&gt;;\n}\n</code></pre>\n\n<p>By separating out the associated <code>type</code>s as a separate <code>Traits</code> meta-interface, I was able to implement <code>Traits</code> for a new concrete type and pass that in to <code>Make</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>/// `Traits` implementation for `Bootstrapper`, which constrains the `Make`\n/// implementation for `Bootstrapper` to outputting a `Box&lt;Bootstrapper&gt;`.\nstruct BootstrapperTraits;\nimpl Traits for BootstrapperTraits {\n    // NOTE: Specifying Self here gets around the circular dependency.\n    type Output = dyn Bootstrapper&lt;Traits = Self&gt;;\n}\n\n/// A special case of Make that makes the same *kind* of thing as itself, but\n/// not *necessarily* `Self`.\ntrait Bootstrapper : Make&lt;Traits = BootstrapperTraits&gt; {\n    fn is_best(&amp;self) -&gt; bool;\n}\n</code></pre>\n\n<p>The concrete type (<code>BootstrapperTraits</code>) is able to get around the circular supertraits dependency by specifying <code>Self</code> as the <code>type Traits</code> for <code>Output</code>. Then <code>BootstrapperTraits</code> is specified as the specific <code>Traits</code> implementation for <code>Bootstrapper</code>. Hence, anyone who implements <code>Bootstrapper</code> must now also implement <code>Make&lt;Traits = BootstrapperTraits&gt;</code>, which requires that <code>Output</code> is a <code>dyn Bootstrapper</code>.</p>\n\n<p>See this <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f43d3dcdd74e891c7a497fa5ff1e6367\" rel=\"nofollow noreferrer\">Rust playground</a> for the full solution.</p>\n"}], "owner": {"reputation": 561, "user_id": 266704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/62b20dd1ce566175ee2dc612aa8d2c11?s=128&d=identicon&r=PG", "display_name": "andrewtc", "link": "https://stackoverflow.com/users/266704/andrewtc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 856, "favorite_count": 1, "accepted_answer_id": 58575051, "answer_count": 1, "score": 2, "last_activity_date": 1572128828, "creation_date": 1571668596, "last_edit_date": 1571673819, "question_id": 58488614, "link": "https://stackoverflow.com/questions/58488614/is-there-a-way-to-have-a-trait-specify-itself-for-an-associated-type-in-another", "title": "Is there a way to have a trait specify itself for an associated type in another trait that it extends?", "body": "<p>I'd like to define a trait that has as supertrait another trait with its own trait object type as an associated type:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>/// A trait for making things.\ntrait Make {\n    type Output: ?Sized;\n    fn make(self: Box&lt;Self&gt;) -&gt; Box&lt;Self::Output&gt;;\n}\n\n/// A special case of Make, which makes things that impl the same trait.\ntrait Bootstrapper: Make&lt;Output = dyn Bootstrapper&gt; {} // Will NOT compile.\n</code></pre>\n\n<p>However, I can't do this because it creates an infinite cycle. In the example above, I would need to specify <code>Output</code> for <code>dyn Bootstrapper</code>, which is itself (<code>dyn Bootstrapper</code>). But then, I'd need to specify <code>Output</code> for <em>that</em> <code>dyn Bootstrapper</code>, and so on and so forth, e.g. <code>Make&lt;Output = dyn Bootstrapper&lt;Output = dyn Bootstrapper&lt;Output = dyn Bootstrapper&lt;...&gt;&gt;&gt;</code>.</p>\n\n<p>The Rust compiler seems to agree that this won't work:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0391]: cycle detected when computing the supertraits of `Bootstrapper`\n --&gt; src/lib.rs:8:1\n  |\n8 | trait Bootstrapper: Make&lt;Output = dyn Bootstrapper&gt; {} // Will NOT compile.\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  |\n  = note: ...which again requires computing the supertraits of `Bootstrapper`, completing the cycle\nnote: cycle used when collecting item types in top-level module\n --&gt; src/lib.rs:8:1\n  |\n8 | trait Bootstrapper: Make&lt;Output = dyn Bootstrapper&gt; {} // Will NOT compile.\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>I also can't specify <code>Output = Self</code> because that would overly constrain the trait, so that a given implementation of <code>Bootstrapper</code> could only <code>make()</code> more of itself. I want a <code>Bootstrapper</code> to be able to <code>make()</code> other kinds of <code>Bootstrapper</code>. Please see this <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=595ff198b5be0aa5e0f2c284ba3cd6cf\" rel=\"nofollow noreferrer\">Rust playground</a> for an example of (roughly) what I'm trying to do.</p>\n\n<p>Is there a way to get around this, and have <code>Bootstrapper</code> specify <code>Bootstrapper</code> (<strong>not</strong> <code>Self</code>) for <code>Output</code>?</p>\n"}, {"tags": ["rust", "future", "rust-tokio"], "comments": [{"owner": {"reputation": 144, "user_id": 5613164, "user_type": "registered", "profile_image": "https://graph.facebook.com/959533824107532/picture?type=large", "display_name": "Micha\u0142 Hanusek", "link": "https://stackoverflow.com/users/5613164/micha%c5%82-hanusek"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571680017, "post_id": 58487418, "comment_id": 103313247, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/201221/discussion-between-michal-hanusek-and-shepmaster\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 144, "user_id": 5613164, "user_type": "registered", "profile_image": "https://graph.facebook.com/959533824107532/picture?type=large", "display_name": "Micha\u0142 Hanusek", "link": "https://stackoverflow.com/users/5613164/micha%c5%82-hanusek"}, "is_accepted": true, "score": 1, "last_activity_date": 1571772932, "creation_date": 1571772932, "answer_id": 58511162, "question_id": 58487418, "link": "https://stackoverflow.com/questions/58487418/how-to-send-bytesbytesbytes-by-futuresstreamstream/58511162#58511162", "title": "How to send bytes::bytes::Bytes by futures:stream::Stream?", "body": "<p>I'm solved this problem.</p>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f195f0c2758a8c216b2eb4808107032a\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<pre><code>extern crate tokio; // 0.1.22\n\nuse tokio::codec::{BytesCodec, Decoder};\nuse tokio::net::TcpListener;\nuse tokio::prelude::*;\n\nuse bytes::Bytes; // 0.4.12\n\nfn main() {\n    let addr = \"0.0.0.0:1502\".parse().unwrap();\n    let mut socket = TcpListener::bind(&amp;addr).unwrap();\n\n    let done = socket\n        .incoming()\n        .map_err(|e| println!(\"failed to accept socket; error = {:?}\", e))\n        .for_each(move |socket| {\n            let framed = BytesCodec::new().framed(socket);\n            let (mut writer, reader) = framed.split();\n\n            let processor = reader\n                .for_each(move |bytes| {\n                    println!(\"bytes: {:?}\", bytes);\n                    let mut data_to_send = [0 as u8; 1024];\n                    let buf = Bytes::from(&amp;data_to_send[..1024]);\n                    writer.start_send(buf).unwrap();\n                    writer.poll_complete().unwrap();\n                    Ok(())\n                })\n                .and_then(|()| Ok(()))\n                .or_else(|err| Err(err))\n                .then(|result| Ok(()));\n\n            tokio::spawn(processor)\n        });\n\n    tokio::run(done);\n}\n</code></pre>\n"}], "owner": {"reputation": 144, "user_id": 5613164, "user_type": "registered", "profile_image": "https://graph.facebook.com/959533824107532/picture?type=large", "display_name": "Micha\u0142 Hanusek", "link": "https://stackoverflow.com/users/5613164/micha%c5%82-hanusek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 1, "accepted_answer_id": 58511162, "answer_count": 1, "score": 0, "last_activity_date": 1571772932, "creation_date": 1571664674, "last_edit_date": 1571680135, "question_id": 58487418, "link": "https://stackoverflow.com/questions/58487418/how-to-send-bytesbytesbytes-by-futuresstreamstream", "title": "How to send bytes::bytes::Bytes by futures:stream::Stream?", "body": "<p>I'm trying write a TCP server based on <a href=\"https://github.com/tokio-rs/tokio/blob/v0.1.x/tokio/examples/print_each_packet.rs\" rel=\"nofollow noreferrer\">Tokio's example</a>.</p>\n\n<p>When I try to send the buffer, the compiler returns error 0277.</p>\n\n<p>My code: (<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=c4eb8cc62dd87334fb0bc73f9b74ef3d\" rel=\"nofollow noreferrer\">playground</a>)</p>\n\n<pre><code>extern crate tokio; // 0.1.22\n\nuse tokio::codec::{BytesCodec, Decoder};\nuse tokio::net::TcpListener;\nuse tokio::prelude::*;\n\nuse bytes::Bytes; // 0.4.12\n\nfn main() {\n    let addr = \"0.0.0.0:1502\".parse().unwrap();\n    let mut socket = TcpListener::bind(&amp;addr).unwrap();\n\n    let done = socket\n        .incoming()\n        .map_err(|e| println!(\"failed to accept socket; error = {:?}\", e))\n        .for_each(move |socket| {\n            let framed = BytesCodec::new().framed(socket);\n            let (writer, reader) = framed.split();\n\n            let processor = reader\n                .for_each(move |bytes| {\n                    println!(\"bytes: {:?}\", bytes);\n                    let mut data_to_send = [0 as u8; 1024];\n                    let buf = Bytes::from(&amp;data_to_send[..1024]);\n                    writer.send_all(&amp;mut buf);\n                    Ok(())\n                })\n                .and_then(|()| Ok(()))\n                .or_else(|err| Err(err))\n                .then(|result| Ok(()));\n            tokio::spawn(processor)\n        });\n    tokio::run(done);\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `bytes::bytes::Bytes: tokio::prelude::Stream` is not satisfied\n  --&gt; src/main.rs:25:28\n   |\n25 |                     writer.send_all(&amp;mut buf); // ERROR : E0277\n   |                            ^^^^^^^^ the trait `tokio::prelude::Stream` is not implemented for `bytes::bytes::Bytes`\n   |\n   = note: required because of the requirements on the impl of `tokio::prelude::Stream` for `&amp;mut bytes::bytes::Bytes`\n</code></pre>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571663270, "post_id": 58485723, "comment_id": 103304605, "body": "Just reread <a href=\"https://doc.rust-lang.org/cargo/reference/manifest.html#the-features-section\" rel=\"nofollow noreferrer\">doc.rust-lang.org/cargo/reference/&hellip;</a>  and I get what the issue is. Because I used a tool to automatically generate this I didn&#39;t know why this was failing, features only for optional compilation so yes @Shepmaster, there&#39;s no need to add compulsory crates under [features] . Sorry for that, I was pretty sure that the issue was to do with [features] and that&#39;s why I only posted about that."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1571665344, "creation_date": 1571665344, "answer_id": 58487599, "question_id": 58485723, "link": "https://stackoverflow.com/questions/58485723/feature-xxx-depends-on-yyy-which-is-not-an-optional-dependency/58487599#58487599", "title": "Feature &#39;xxx&#39; depends on &#39;yyy&#39; which is not an optional dependency", "body": "<p>You should only include a dependency in a feature list if the dependency is optional. If the dependency is not optional, solely include it in the <code>[dependencies]</code> section.</p>\n"}], "owner": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1049, "favorite_count": 0, "accepted_answer_id": 58487599, "answer_count": 1, "score": 1, "last_activity_date": 1571665442, "creation_date": 1571658625, "last_edit_date": 1571665442, "question_id": 58485723, "link": "https://stackoverflow.com/questions/58485723/feature-xxx-depends-on-yyy-which-is-not-an-optional-dependency", "title": "Feature &#39;xxx&#39; depends on &#39;yyy&#39; which is not an optional dependency", "body": "<p>I got this error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: failed to parse manifest at `...\\Cargo.toml`\n\nCaused by:\n  Feature `client` depends on `rusttls` which is not an optional dependency.\nConsider adding `optional = true` to the dependency\n</code></pre>\n\n<p>It goes away if I add <code>optional = true</code>, but I don't want rusttls to be optional for security reasons.</p>\n\n<p>What's the exact cause of this error and possible solutions other than making it optional?</p>\n\n<p>My Cargo.toml has this:</p>\n\n<pre><code>[features]\n\ndefault = [\"client\", \"server\"]\n\nclient = [\"serde_json\",  \"serde-xml-rs\", \"serde_ignored\", \"hyper\", \"hyper-tls\", \"rusttls\", \"tokio-core\", \"url\", \"uuid\", \"multipart\"]\n\nserver = [\"serde_json\", \"serde-xml-rs\", \"serde_ignored\", \"hyper\", \"hyper-tls\", \"rusttls\", \"tokio-core\", \"tokio-proto\", \"tokio-tls\", \"regex\", \"percent-encoding\", \"url\", \"uuid\", \"multipart\"]\n</code></pre>\n\n<p>From what I read in the Rust book, doing this should mean that by default the client and server have these dependencies, right?</p>\n"}, {"tags": ["rust", "httprequest", "payload", "actix-web"], "answers": [{"comments": [{"owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "edited": false, "score": 0, "creation_date": 1601833490, "post_id": 58485638, "comment_id": 113522165, "body": "Thanks, this worked for me! I&#39;d add that for this to work we need <code>use bytes</code>. Not super obvious for a newbie struggling with these type of things. BTW: it&#39;s kind of a bummer that we cannot extract the body from <code>HttpRequest</code>."}], "tags": [], "owner": {"reputation": 131, "user_id": 9018487, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LQrZmtYn09k/AAAAAAAAAAI/AAAAAAAADfY/C3A7MMlUMe8/photo.jpg?sz=128", "display_name": "Piotr P\u0142aczek", "link": "https://stackoverflow.com/users/9018487/piotr-p%c5%82aczek"}, "is_accepted": true, "score": 2, "last_activity_date": 1571658287, "creation_date": 1571658287, "answer_id": 58485638, "question_id": 58484319, "link": "https://stackoverflow.com/questions/58484319/how-to-get-binary-payload-from-actix-webhttprequest/58485638#58485638", "title": "How to get (binary) payload from actix_web::HttpRequest", "body": "<p>Bytes extractor works fine</p>\n\n<pre><code>pub fn user_login_bin(req: HttpRequest, body: Bytes) -&gt; HttpResponse {\n   println!(\"{:?}\", req);\n   println!(\"{:?}\", body);\n\n   HttpResponse::Ok().into()\n}\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 9018487, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-LQrZmtYn09k/AAAAAAAAAAI/AAAAAAAADfY/C3A7MMlUMe8/photo.jpg?sz=128", "display_name": "Piotr P\u0142aczek", "link": "https://stackoverflow.com/users/9018487/piotr-p%c5%82aczek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 654, "favorite_count": 0, "accepted_answer_id": 58485638, "answer_count": 1, "score": 2, "last_activity_date": 1571658287, "creation_date": 1571653499, "last_edit_date": 1571655749, "question_id": 58484319, "link": "https://stackoverflow.com/questions/58484319/how-to-get-binary-payload-from-actix-webhttprequest", "title": "How to get (binary) payload from actix_web::HttpRequest", "body": "<p>I'm writing some web api in Rust. I send Unit8Array from JavaScript with XMLHttpRequest, and I need to read them in server as Bytes.</p>\n\n<p>Declaration of my service method is:</p>\n\n<pre><code>pub fn user_login_bin(mut req: HttpRequest) {\n println!(\"{:?}\", req);\n let mut stream = req.take_payload().take();\n\n // error label: method not found in `actix_http::payload::Payload&lt;()&gt;`\n let item = stream.poll().unwrap(); \n\n println!(\"{:?}\", item);\n\n HttpResponse::Ok().into()\n}\n</code></pre>\n\n<p>How can i read Vec from actix_web::HttpRequest payload ?</p>\n\n<p>I tried some example code but it doesn't work too:</p>\n\n<pre><code> req.take_payload()\n    // error label: method (fold) not found in `actix_http::payload::Payload&lt;()&gt;`\n    .fold(BytesMut::new(), move |mut body, chunk| {\n        body.extend_from_slice(&amp;chunk);\n        Ok::&lt;_, Error&gt;(body)\n    })\n    .and_then(|bytes| {\n        println!(\"request body: {:?}\", bytes);\n    });\n</code></pre>\n"}, {"tags": ["file", "rust"], "comments": [{"owner": {"reputation": 14722, "user_id": 401137, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/j25bf.png?s=128&g=1", "display_name": "Some Guy", "link": "https://stackoverflow.com/users/401137/some-guy"}, "edited": false, "score": 1, "creation_date": 1571654553, "post_id": 58484259, "comment_id": 103300172, "body": "What have you tried? As it is, the question is too broad for us to really answer, because there are several ways to accomplish that. We&#39;re here to <i>help</i> you achieve your goals, not write your code for you, so make sure you share code that you&#39;ve written, even if it doesn&#39;t work, and how you expect it to work."}, {"owner": {"reputation": 22505, "user_id": 1411457, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XqssD.png?s=128&g=1", "display_name": "harmic", "link": "https://stackoverflow.com/users/1411457/harmic"}, "edited": false, "score": 1, "creation_date": 1571654713, "post_id": 58484259, "comment_id": 103300259, "body": "Did you see <a href=\"https://doc.rust-lang.org/stable/std/fs/struct.File.html#method.set_len\" rel=\"nofollow noreferrer\">File::set_len</a>?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1571663447, "post_id": 58484259, "comment_id": 103304734, "body": "You want to add 20 bytes and then remove 20 bytes. That means you wish to perform no changes to the file, so you don&#39;t need to write any code whatsoever. Problem solved."}, {"owner": {"reputation": 1234, "user_id": 554893, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9b1773b46fd3a2032dd8007949ec0314?s=128&d=identicon&r=PG", "display_name": "IdontCareAboutReputationPoints", "link": "https://stackoverflow.com/users/554893/idontcareaboutreputationpoints"}, "edited": false, "score": 0, "creation_date": 1571791464, "post_id": 58484259, "comment_id": 103355091, "body": "I searched the std lib but couldn&#39;t find a function to perform truncate on file, that&#39;s why I thought it would be better to ask here. Sorry I didn&#39;t mention that I won&#39;t be removing these bytes at the same time, I want make two functions one for adding some data to the end of the file, and another to remove that data from the end of the file. these functions don&#39;t have to be executed at the same timing.@harmic Looks like this is the thing I was looking for, looks like I didn&#39;t search enough. thank you for the hint. would you please add it as answer."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571836215, "post_id": 58484259, "comment_id": 103372223, "body": "It&#39;s great that you have the solution to your question! You should post it as an answer rather than an edit to your question and then potentially accept that answer. That way, the question shows up as solved in search results, people can vote on your answer, and your solution can be more helpful to future people with the same problem."}, {"owner": {"reputation": 1234, "user_id": 554893, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9b1773b46fd3a2032dd8007949ec0314?s=128&d=identicon&r=PG", "display_name": "IdontCareAboutReputationPoints", "link": "https://stackoverflow.com/users/554893/idontcareaboutreputationpoints"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571897480, "post_id": 58484259, "comment_id": 103393070, "body": "@Shepmaster thank you for your comment, I was planning to do it, I am just waiting for <b>harmic</b> to post it since it&#39;s his answer, if not, I will do it. :)"}], "answers": [{"comments": [{"owner": {"reputation": 3653, "user_id": 786102, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/15fbc7eac0e190a249d7495cc9cdf156?s=128&d=identicon&r=PG", "display_name": "kralyk", "link": "https://stackoverflow.com/users/786102/kralyk"}, "edited": false, "score": 1, "creation_date": 1610462028, "post_id": 58585434, "comment_id": 116136547, "body": "It&#39;s worth noting that you should also remember to adjust cursor position after using <code>set_len()</code>, as that doesn&#39;t move the cursor and it might be in an unexpected position."}], "tags": [], "owner": {"reputation": 1234, "user_id": 554893, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9b1773b46fd3a2032dd8007949ec0314?s=128&d=identicon&r=PG", "display_name": "IdontCareAboutReputationPoints", "link": "https://stackoverflow.com/users/554893/idontcareaboutreputationpoints"}, "is_accepted": true, "score": 2, "last_activity_date": 1572232907, "creation_date": 1572232907, "answer_id": 58585434, "question_id": 58484259, "link": "https://stackoverflow.com/questions/58484259/how-can-i-truncate-or-reduce-contents-from-the-end-of-a-file-using-rust/58585434#58585434", "title": "How can I truncate or reduce contents from the end of a file using Rust?", "body": "<p><a href=\"https://doc.rust-lang.org/std/fs/struct.File.html#method.set_len\" rel=\"nofollow noreferrer\">std::fs::File::set_len</a> will do the work.</p>\n"}], "owner": {"reputation": 1234, "user_id": 554893, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9b1773b46fd3a2032dd8007949ec0314?s=128&d=identicon&r=PG", "display_name": "IdontCareAboutReputationPoints", "link": "https://stackoverflow.com/users/554893/idontcareaboutreputationpoints"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1023, "favorite_count": 0, "accepted_answer_id": 58585434, "answer_count": 1, "score": 2, "last_activity_date": 1572232907, "creation_date": 1571653297, "last_edit_date": 1571798926, "question_id": 58484259, "link": "https://stackoverflow.com/questions/58484259/how-can-i-truncate-or-reduce-contents-from-the-end-of-a-file-using-rust", "title": "How can I truncate or reduce contents from the end of a file using Rust?", "body": "<p>I have a 90MB file. I want to append about 20 bytes of data at the end and also be able to truncate that 20 bytes of appended data afterwards. How can I do this using Rust?</p>\n\n<p><strong>Update</strong>\nI think my question was not very clear so I am going to explain again what I am looking for.\nTo put it simple I am looking for a function from the <code>std</code> lib or whatever library, that could truncate a file at a given size, or remove a give amount of bytes from the end of a file. no need for a full example how to do it.</p>\n\n<p><strong>Answer</strong>: Thanks @harmic it was that simple still I didn't notice it.</p>\n\n<p><code>std::fs::File::set_len</code> will do the work I think.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "edited": false, "score": 0, "creation_date": 1571637607, "post_id": 58480303, "comment_id": 103292930, "body": "<code>Conditions::SmaCheck</code> and <code>SmaCheck</code> are two different types.  And what returns from <code>Conditions::iter()</code> is already a value with defaults. But you didn&#39;t provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal-reproducible-example</a>, hard to give more concrete advice."}, {"owner": {"reputation": 3525, "user_id": 517529, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c2a5bc0633a2eef9274744bd273063a4?s=128&d=identicon&r=PG", "display_name": "hakunin", "link": "https://stackoverflow.com/users/517529/hakunin"}, "reply_to_user": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "edited": false, "score": 0, "creation_date": 1571637960, "post_id": 58480303, "comment_id": 103293032, "body": "Thanks for the hint, I will make one in the afternoon."}, {"owner": {"reputation": 3525, "user_id": 517529, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c2a5bc0633a2eef9274744bd273063a4?s=128&d=identicon&r=PG", "display_name": "hakunin", "link": "https://stackoverflow.com/users/517529/hakunin"}, "reply_to_user": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "edited": false, "score": 0, "creation_date": 1571691786, "post_id": 58480303, "comment_id": 103318032, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/25818082/vector-of-objects-belonging-to-a-trait\">Vector of objects belonging to a trait</a>"}], "answers": [{"comments": [{"owner": {"reputation": 3525, "user_id": 517529, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c2a5bc0633a2eef9274744bd273063a4?s=128&d=identicon&r=PG", "display_name": "hakunin", "link": "https://stackoverflow.com/users/517529/hakunin"}, "edited": false, "score": 0, "creation_date": 1571659767, "post_id": 58482679, "comment_id": 103302762, "body": "Ahh, I didn&#39;t even realise Enum created new types, this makes a lot of sense! Can I buy you a drink sir?"}], "tags": [], "owner": {"reputation": 7096, "user_id": 3990767, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a5741a212e3b0e6bd46a8a1e6d76a4a?s=128&d=identicon&r=PG", "display_name": "SOFe", "link": "https://stackoverflow.com/users/3990767/sofe"}, "is_accepted": true, "score": 1, "last_activity_date": 1571669537, "last_edit_date": 1571669537, "creation_date": 1571647334, "answer_id": 58482679, "question_id": 58480303, "link": "https://stackoverflow.com/questions/58480303/construct-vector-of-of-types-and-initialize-them/58482679#58482679", "title": "Construct vector of of types and initialize them", "body": "<p>It seems that you have an enum that represents types, and a struct with the same name as an enum variant.</p>\n\n<p>Note that enum variant names have nothing to do with any types they might represent.</p>\n\n<p>In addition, reflections do not exist (not in the Java sense) in Rust,\nso you can't have a value that contains a type name and create that type from it.</p>\n\n<p>However, it is possible to take an enum of unknown value\n(the type checker cannot constraint the enum values anyway),\nand return a value based on this enum.</p>\n\n<p>Furthermore, while a method may not return unknown types directly,\nyou can use a <code>Box&lt;dyn Trait&gt;</code> to wrap a value of unknown type,\nor create an enum that implements the trait and delegates to sealed implementations.</p>\n\n<p>The following might be closer to what you wanted:</p>\n\n<pre><code>pub enum ConditionTypes {\n    SmaCheck,\n    CandlesPassed,\n}\n\npub enum Condition {\n    SmaCheck(SmaCheck), // the first word is the enum variant, the second word is the type of the value it contains\n    CandlesPassed(CandlesPassed),\n}\n\nimpl ConditionType {\n    pub fn new(&amp;self) -&gt; Condition {\n        match self {\n            Self::SmaCheck =&gt; Condition::SmaCheck(SmaCheck::new()),\n            Self::CandlesPassed =&gt; Condition::CandlesPassed(CandlesPassed::new()),\n        }\n    }\n}\n\npub trait Testable {\n    // we don't really need new() in this trait, do we?\n    // if you want to use this trait when it could be of runtime-unknown type\n    // instead of compile-time generics, all methods must have a receiver.\n\n    fn test(&amp;self, candle: &amp;Candle) -&gt; bool;\n}\n\nimpl Testable for Condition {\n    fn test(&amp;self, candle: &amp;Candle) -&gt; bool {\n        match self {\n            Condition::SmaCheck(inner) =&gt; inner.test(candle),\n            Condition::CandlesPassed(inner) =&gt; inner.test(candle),\n        }\n    }\n}\n\n// impl Testable for SmaCheck and CandlesPassed omitted\n</code></pre>\n\n<p>This looks a bit boilerplate, but there are macros to derive this.</p>\n"}], "owner": {"reputation": 3525, "user_id": 517529, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c2a5bc0633a2eef9274744bd273063a4?s=128&d=identicon&r=PG", "display_name": "hakunin", "link": "https://stackoverflow.com/users/517529/hakunin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 58482679, "answer_count": 1, "score": 1, "last_activity_date": 1571669537, "creation_date": 1571636115, "question_id": 58480303, "link": "https://stackoverflow.com/questions/58480303/construct-vector-of-of-types-and-initialize-them", "title": "Construct vector of of types and initialize them", "body": "<p>I am trying to have some sort of list of types which I can then initialize and build genetic algorithms.</p>\n\n<p>The issue is working with \"types\" themselves, I haven't found the right way to take an array of types and call <code>::new</code> on each to get an \"instance\".</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// --- conditions.rs ----------------------------------\nextern crate strum;\nuse strum_macros::{EnumIter}; // etc.\n\npub trait Testable {\n    fn new() -&gt; Self;\n    fn test(&amp;self, candle: &amp;Candle) -&gt; bool;\n}\n\n// use strum::IntoEnumIterator;\n#[derive(EnumIter,Debug)]\npub enum Conditions {\n    SmaCheck,\n    CandlesPassed,\n}\n\n// simple moving average check\npub struct SmaCheck {\n    sma1: i8,\n    sma2: i8,\n}\n\nimpl Testable for SmaCheck {\n    fn new() -&gt; Self {\n        Self { sma1: 10, sma2: 20 }\n    }\n    fn test(&amp;self, candle: &amp;Candle) -&gt; bool {\n        return true;\n    }\n}\n\n\n// --- generator.rs -----------------------------------\n// creates random conditions, which will then be mutated and bred\n\nuse strum::IntoEnumIterator;\nuse crate::conditions::{Conditions, Testable};\n\n\npub fn run() {\n    for condition in Conditions::iter() {\n        println!(\"{:?}\", condition); // this works\n\n        let testable = condition::new(); // undeclared type or module `condition`\n        println!(\"{:?}\", testable::new());\n    }\n}\n</code></pre>\n"}, {"tags": ["rust", "rust-cargo"], "answers": [{"tags": [], "owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "is_accepted": true, "score": 23, "last_activity_date": 1571643732, "last_edit_date": 1571643732, "creation_date": 1571635642, "answer_id": 58480230, "question_id": 58480205, "link": "https://stackoverflow.com/questions/58480205/how-do-you-enable-a-rust-crate-feature/58480230#58480230", "title": "How do you enable a Rust &quot;crate feature&quot;?", "body": "<p>Specify the dependencies in Cargo.toml like so:</p>\n\n<pre><code>[dependencies]\nrand = { version = \"0.7.2\", features = [\"small_rng\"] }\n</code></pre>\n\n<p>Alternatively:</p>\n\n<pre><code>[dependencies.rand]\nversion = \"0.7.2\"\nfeatures = [\"small_rng\"]\n</code></pre>\n\n<p>Both work.</p>\n"}], "owner": {"reputation": 727, "user_id": 11392896, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/240a1abd4a401577fa990ad0b7aecb51?s=128&d=identicon&r=PG&f=1", "display_name": "brundolf", "link": "https://stackoverflow.com/users/11392896/brundolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4157, "favorite_count": 1, "accepted_answer_id": 58480230, "answer_count": 1, "score": 21, "last_activity_date": 1580246561, "creation_date": 1571635488, "last_edit_date": 1580246561, "question_id": 58480205, "link": "https://stackoverflow.com/questions/58480205/how-do-you-enable-a-rust-crate-feature", "title": "How do you enable a Rust &quot;crate feature&quot;?", "body": "<p>I'm trying to use <a href=\"https://docs.rs/rand/0.7.2/rand/rngs/struct.SmallRng.html\" rel=\"noreferrer\"><code>rand::SmallRng</code></a>. The documentation says</p>\n\n<blockquote>\n  <p>This PRNG is <strong>feature-gated</strong>: to use, you must enable the crate feature <code>small_rng</code>.</p>\n</blockquote>\n\n<p>I've been searching and can't figure out how to enable \"crate features\". The phrase isn't even used anywhere in the Rust docs. This is the best I could come up with:</p>\n\n<pre><code>[features]\ndefault = [\"small_rng\"]\n</code></pre>\n\n<p>But I get:</p>\n\n<blockquote>\n  <p>Feature <code>default</code> includes <code>small_rng</code> which is neither a dependency nor another feature</p>\n</blockquote>\n\n<p>Are the docs wrong, or is there something I'm missing?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 3836, "user_id": 3003401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f2de9e3bd27825488f4cf0a1dd86ac0?s=128&d=identicon&r=PG&f=1", "display_name": "Cerberus", "link": "https://stackoverflow.com/users/3003401/cerberus"}, "edited": false, "score": 1, "creation_date": 1571633054, "post_id": 58479348, "comment_id": 103291783, "body": "This is possibly more appropriate to post as codereview.stackexchange.com or users.rust-lang.org, if your code does actually work; or to narrow down to the concrete problem, if it doesn&#39;t."}, {"owner": {"reputation": 23, "user_id": 12197651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42daa34057986e2fd8e9f4e154a0d53?s=128&d=identicon&r=PG&f=1", "display_name": "brasides", "link": "https://stackoverflow.com/users/12197651/brasides"}, "reply_to_user": {"reputation": 3836, "user_id": 3003401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f2de9e3bd27825488f4cf0a1dd86ac0?s=128&d=identicon&r=PG&f=1", "display_name": "Cerberus", "link": "https://stackoverflow.com/users/3003401/cerberus"}, "edited": false, "score": 0, "creation_date": 1571634185, "post_id": 58479348, "comment_id": 103292029, "body": "Thanks for the suggestion! Is it inappropriate to post this here? I am pretty new and not sure about norms for stackoverflow. Is there a way for me to delete the question?"}, {"owner": {"reputation": 3836, "user_id": 3003401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f2de9e3bd27825488f4cf0a1dd86ac0?s=128&d=identicon&r=PG&f=1", "display_name": "Cerberus", "link": "https://stackoverflow.com/users/3003401/cerberus"}, "edited": false, "score": 0, "creation_date": 1571639000, "post_id": 58479348, "comment_id": 103293347, "body": "I&#39;ve flagged it as &quot;opinion-based&quot;, hope that the moderator would come to decide. But yes, StackOverflow is the place to ask if something doesn&#39;t work as expected. If all does work, but you wonder if it could done better, this question would be offtopic. Personally, I&#39;d advise to go to the Rust forum mentioned in the previous comment - from my own experience, such questions are usually welcome there."}], "answers": [{"tags": [], "owner": {"reputation": 23, "user_id": 12197651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42daa34057986e2fd8e9f4e154a0d53?s=128&d=identicon&r=PG&f=1", "display_name": "brasides", "link": "https://stackoverflow.com/users/12197651/brasides"}, "is_accepted": false, "score": 0, "last_activity_date": 1571740033, "creation_date": 1571740033, "answer_id": 58502207, "question_id": 58479348, "link": "https://stackoverflow.com/questions/58479348/atbash-cipher-in-rust/58502207#58502207", "title": "Atbash Cipher in Rust", "body": "<p>So this was the wrong place to post this kind of thing, but in case any other exercism students find this with a google search, I want to point to the good advice given on users.rustlang.org.</p>\n\n<p>I made a similar post and the people there made some <a href=\"https://users.rust-lang.org/t/good-needs-work-atbash-cipher-for-exercism/33839\" rel=\"nofollow noreferrer\">really good suggestions</a>.</p>\n"}], "owner": {"reputation": 23, "user_id": 12197651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42daa34057986e2fd8e9f4e154a0d53?s=128&d=identicon&r=PG&f=1", "display_name": "brasides", "link": "https://stackoverflow.com/users/12197651/brasides"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571740033, "creation_date": 1571627680, "question_id": 58479348, "link": "https://stackoverflow.com/questions/58479348/atbash-cipher-in-rust", "title": "Atbash Cipher in Rust", "body": "<p>So I'm working on an implementation of the Atbash Cipher for Rust - it is an exercise on exercism.io. I come from a little C experience and found my code to be rather round about and kind of tortured. Doing str and String manipulation in Rust is something I haven't really grokked yet. It seems like this would take up fewer lines of code in C.</p>\n\n<p>Below is my code - am I going about this in the right way for Rust, or am I missing some important concept or way of minupulating the data? Is this as simple as it should be?</p>\n\n<p>The exercise involves getting an input <code>&amp;str</code> and outputting a <code>String</code>, with each character changed as per the atbash cipher, adding a space every 5 characters. Included is also a <code>decode</code> function. This all goes in a <code>lib.rs</code>.</p>\n\n<pre><code>// \"Encipher\" with the Atbash cipher.\npub fn encode(plain: &amp;str) -&gt; String {\n    let mut coded: String = plain.to_string();\n\n    coded.retain(|c| c.is_ascii_alphanumeric());\n    coded.make_ascii_lowercase();\n\n    let coded_no_spacing = String::from_utf8(\n        coded\n            .bytes()\n            .map(|c| {\n                if c.is_ascii_alphabetic() {\n                    122 - c + 97\n                } else {\n                    c\n                }\n            })\n            .collect(),\n    )\n    .unwrap();\n\n    spacer(coded_no_spacing)\n}\n\n/// \"Decipher\" with the Atbash cipher.\npub fn decode(cipher: &amp;str) -&gt; String {\n    let mut out = encode(cipher);\n    out.retain(|c| c.is_ascii_alphanumeric());\n    out\n}\n\nfn spacer(coded_no_spacing: String) -&gt; String {\n    let mut coded_no_spacing = coded_no_spacing.chars();\n\n    let mut temp_char = coded_no_spacing.next();\n    let mut counter = 0;\n    let mut coded_with_spaces = \"\".to_string();\n    while temp_char.is_some() {\n        if counter % 5 == 0 &amp;&amp; counter != 0 {\n            coded_with_spaces.push(' ');\n        }\n        coded_with_spaces.push(temp_char.unwrap());\n        temp_char = coded_no_spacing.next();\n        counter += 1;\n    }\n    coded_with_spaces\n}\n</code></pre>\n"}, {"tags": ["rust", "trait-objects"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1571620075, "post_id": 58478426, "comment_id": 103289572, "body": "<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=ec3cab8a120010af0b52dffb30c10f28\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>, but I don&#39;t know if it&#39;s make sense to do that"}, {"owner": {"reputation": 15, "user_id": 12207479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ff736b1602245b89ddfbbec784b4f2?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/12207479/john"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1571629227, "post_id": 58478426, "comment_id": 103291090, "body": "@Stargateur That&#39;s awesome, you fixed it and I can compile now :) Thank you so much for taking the time! Is there some basic logic as to how that works and why it&#39;s better than static? Also you say you don&#39;t know if it makes sense to do that, is it not the best route to go or there&#39;s some other reason?"}, {"owner": {"reputation": 416, "user_id": 10904994, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xzqb0.png?s=128&g=1", "display_name": "L117", "link": "https://stackoverflow.com/users/10904994/l117"}, "edited": false, "score": 0, "creation_date": 1571635960, "post_id": 58478426, "comment_id": 103292464, "body": "@John <code>Box&lt;dyn Animal&gt;</code> is equal to <code>Box&lt;dyn Animal + &#39;static&gt;</code> in this context. So, anything you put in <code>VecDeque</code> has to be <code>&#39;static</code> - that&#39;s why you add <code>&#39;static</code> bound in <code>add</code> method&#39;s <code>where</code> clause. <code>&#39;static</code> limits what you can put into <code>Zoo</code>, only objects without references (or with <code>&#39;static</code> references) in them are <code>&#39;static</code> themselves."}, {"owner": {"reputation": 416, "user_id": 10904994, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xzqb0.png?s=128&g=1", "display_name": "L117", "link": "https://stackoverflow.com/users/10904994/l117"}, "edited": false, "score": 0, "creation_date": 1571636433, "post_id": 58478426, "comment_id": 103292617, "body": "@John And what about <code>#[path=&quot;...&quot;]</code>, you&#39;re violating convention about project structure. Here&#39;s documentation for this: <a href=\"https://doc.rust-lang.org/book/ch07-00-managing-growing-projects-with-packages-crates-and-modules.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/book/&hellip;</a>"}, {"owner": {"reputation": 15, "user_id": 12207479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ff736b1602245b89ddfbbec784b4f2?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/12207479/john"}, "reply_to_user": {"reputation": 416, "user_id": 10904994, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xzqb0.png?s=128&g=1", "display_name": "L117", "link": "https://stackoverflow.com/users/10904994/l117"}, "edited": false, "score": 0, "creation_date": 1571668419, "post_id": 58478426, "comment_id": 103307488, "body": "Thank you for following up @L117. Following <a href=\"https://doc.rust-lang.org/book/ch07-05-separating-modules-into-different-files.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/book/&hellip;</a> I still can&#39;t get it to work. It asks me to create a file in <code>src&#47;lib&#47;front_of_house.rs</code> and not in <code>src&#47;front_of_house.rs</code> as the guide suggests. I&#39;m using 2018 edition and can&#39;t figure out what I&#39;m doing wrong."}, {"owner": {"reputation": 15, "user_id": 12207479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ff736b1602245b89ddfbbec784b4f2?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/12207479/john"}, "reply_to_user": {"reputation": 416, "user_id": 10904994, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xzqb0.png?s=128&g=1", "display_name": "L117", "link": "https://stackoverflow.com/users/10904994/l117"}, "edited": false, "score": 0, "creation_date": 1571670901, "post_id": 58478426, "comment_id": 103308854, "body": "@L117 Ok, I think somehow I got it to work. My <code>src&#47;lib.rs</code> has <code>pub mod zoo;</code>. My <code>src&#47;zoo.rs</code> has <code>pub mod animal; pub mod monkey;</code>. My <code>src&#47;zoo&#47;monkey.rs</code> has <code>use crate::zoo::animal::Animal</code>. Is this structure normal?"}, {"owner": {"reputation": 416, "user_id": 10904994, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xzqb0.png?s=128&g=1", "display_name": "L117", "link": "https://stackoverflow.com/users/10904994/l117"}, "edited": false, "score": 0, "creation_date": 1571729959, "post_id": 58478426, "comment_id": 103327431, "body": "@John No. <code>crate</code> references either <code>src&#47;lib.rs</code> or <code>src&#47;main.rs</code>. For some module <code>crate::zoo</code> you should either have no separate file (Module has body in <code>lib.rs</code>/<code>main.rs</code>), <code>src&#47;zoo.rs</code> file (If there are no nested <i>module files</i>) or <code>src&#47;zoo&#47;mod.rs</code> file (If there <i>are</i> nested <i>module files</i>). Next, for <code>crate::zoo::monkey</code> module you should either have no file (Module has body in either <code>src&#47;zoo.rs</code> or in <code>src&#47;zoo&#47;mod.rs</code>), have <code>src&#47;zoo&#47;monkey.rs</code> file or <code>src&#47;zoo&#47;monkey&#47;mod.rs</code> file."}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 12207479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ff736b1602245b89ddfbbec784b4f2?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/12207479/john"}, "edited": false, "score": 0, "creation_date": 1571666943, "post_id": 58487065, "comment_id": 103306645, "body": "Got it, thank you so much!"}], "tags": [], "owner": {"reputation": 579, "user_id": 5878876, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e5dfcdce69507476298e16ce6b0e3ec?s=128&d=identicon&r=PG&f=1", "display_name": "Unlikus", "link": "https://stackoverflow.com/users/5878876/unlikus"}, "is_accepted": true, "score": 0, "last_activity_date": 1571663761, "last_edit_date": 1571663761, "creation_date": 1571663545, "answer_id": 58487065, "question_id": 58478426, "link": "https://stackoverflow.com/questions/58478426/how-to-apply-a-lifetime-to-vecdequeboxdyn-trait/58487065#58487065", "title": "How to apply a lifetime to VecDeque&lt;Box&lt;dyn Trait&gt;&gt;?", "body": "<p>As already pointed out, <code>Box&lt;dyn Animal&gt;</code> is equivalent to <code>Box&lt;dyn Animal + 'static&gt;</code>, which means a pointer to something which is valid through the whole program (like string literals). This is probably not what you want.</p>\n\n<p>You want it such that your <code>Zoo</code> cannot live longer than your <code>Animal</code>s. (This is what the compiler will enforce). So you annotate <code>Zoo</code> with a lifetime <code>'a</code> and you require that every <code>Animal</code> which is stored in the <code>Zoo</code> lives at least as long as <code>'a</code>:</p>\n\n<pre><code>pub struct Zoo&lt;'a&gt; {\n    animals: VecDeque&lt;Box&lt;dyn Animal + 'a&gt;&gt;,\n}   \n</code></pre>\n\n<p>The compiler will check whether your lifetime annotations will make sense and enforce that a reference cannot outlive an object. </p>\n"}], "owner": {"reputation": 15, "user_id": 12207479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ff736b1602245b89ddfbbec784b4f2?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/12207479/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 0, "closed_date": 1571663669, "accepted_answer_id": 58487065, "answer_count": 1, "score": 1, "last_activity_date": 1571663761, "creation_date": 1571617688, "last_edit_date": 1571663694, "question_id": 58478426, "link": "https://stackoverflow.com/questions/58478426/how-to-apply-a-lifetime-to-vecdequeboxdyn-trait", "closed_reason": "Duplicate", "title": "How to apply a lifetime to VecDeque&lt;Box&lt;dyn Trait&gt;&gt;?", "body": "<p>I'm trying to create a VecDeque of structs that all implement an <code>Animal</code> trait. This code works, but I don't understand why adding <code>' static</code> fixes it and how to make it use <code>'a</code> instead.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub trait Animal {\n    fn says(self) -&gt; Option&lt;String&gt;;\n}\n\nuse std::collections::VecDeque;\n\npub struct Zoo {\n    list: VecDeque&lt;Box&lt;dyn Animal&gt;&gt;,\n}\n\nimpl Zoo {\n    pub fn new() -&gt; Zoo {\n        Zoo {\n            list: VecDeque::new(),\n        }\n    }\n\n    pub fn add&lt;T&gt;(&amp;mut self, animal: T)\n    where\n        T: Animal + 'static,\n    {\n        self.list.push_back(Box::new(animal));\n    }\n}\n</code></pre>\n\n<p>Two questions:</p>\n\n<ol>\n<li>Could someone please explain how to use <code>'a</code> properly and how this would work / what it would mean? And also I guess why I even need a lifetime here (is it because I'm using Box)?</li>\n<li>I'm also confused why I have to use <code>#[path=\"...\"]</code> since without it, it asks me to move the file to <code>src/lib/animal.rs</code> but when I move it, that still doesn't work.</li>\n</ol>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 87, "user_id": 159573, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e1020249ec6861ecf4c98a72ddb2577?s=128&d=identicon&r=PG", "display_name": "maddanio", "link": "https://stackoverflow.com/users/159573/maddanio"}, "edited": false, "score": 0, "creation_date": 1571615937, "post_id": 58478268, "comment_id": 103288933, "body": "Hmm, while thinking about this I finally realized I can do this with arc, maybe combined with mutex, and a weak reference from the objects to the pool. But this feels somewhat inefficient for something like a stack allocator, but may be enough for my current problems. Yet the question remains, are high performance, highly local allocators possible in rust? I.e. a simple non-releasing, bounded-size stack allocator in some use cases is blazingly fast, but of course not if you wrap everything with reference counted pointers."}], "answers": [{"tags": [], "owner": {"reputation": 90851, "user_id": 27009, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f0a29af415477aa8c498a4f41ffe6640?s=128&d=identicon&r=PG", "display_name": "Kornel", "link": "https://stackoverflow.com/users/27009/kornel"}, "is_accepted": false, "score": -1, "last_activity_date": 1572579682, "creation_date": 1572579682, "answer_id": 58653823, "question_id": 58478268, "link": "https://stackoverflow.com/questions/58478268/how-do-you-model-handles-to-resources-of-a-bigger-resource/58653823#58653823", "title": "how do you model handles to resources of a bigger resource", "body": "<p>Usually long-lived handles are wrapped in <code>Arc</code>, so that they can be stored and passed around freely. </p>\n"}], "owner": {"reputation": 87, "user_id": 159573, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e1020249ec6861ecf4c98a72ddb2577?s=128&d=identicon&r=PG", "display_name": "maddanio", "link": "https://stackoverflow.com/users/159573/maddanio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1572579682, "creation_date": 1571615760, "question_id": 58478268, "link": "https://stackoverflow.com/questions/58478268/how-do-you-model-handles-to-resources-of-a-bigger-resource", "title": "how do you model handles to resources of a bigger resource", "body": "<p>I am very intrigued by Rust, but the one thing I cannot wrap my head around is how to handle resources of some larger system.</p>\n\n<p>For example I may have a Graphics context based on some driver system like cuda or vulkan. And now I create resources in that context, memory handles, textures, etc. I will most likely want to \"own\" these resources somewhere, a scenegraph or whatever. How do I make this safe? I mean, it will likely not be safe to destroy the context before the texture.</p>\n\n<p>Another example would be some kind of pool of things that are expensive to create, or part of something bigger. I take things out of that pool, and when I am done with them they should return to the pool. Also it shall not be allowed to destroy the pool before the objects it hands out.</p>\n\n<p>In the work I do i end up having these things all the time. And have not yet found a solution.</p>\n"}, {"tags": ["rust", "type-conversion"], "answers": [{"comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1571638608, "post_id": 58478242, "comment_id": 103293237, "body": "You could also write <code>struct TryFromSliceError;</code> and create an instance with <code>Err(TryFromSliceError)</code>, so you don&#39;t need the unit type as a struct member."}, {"owner": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1571639333, "post_id": 58478242, "comment_id": 103293465, "body": "@hellow Yep. I just copied what the standard library has. I think it&#39;s so instances can&#39;t be created outside of the module."}], "tags": [], "owner": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "is_accepted": true, "score": 2, "last_activity_date": 1571615460, "creation_date": 1571615460, "answer_id": 58478242, "question_id": 58478116, "link": "https://stackoverflow.com/questions/58478116/how-to-convert-u8-into-u8-64/58478242#58478242", "title": "How to convert &amp;[u8] into &amp;[u8; 64]?", "body": "<p>If so desired, you could use <a href=\"https://github.com/rust-lang/rust/blob/7979016aff545f7b41cc517031026020b340989d/src/libcore/array.rs#L142-L157\" rel=\"nofollow noreferrer\">the code that Rust currently uses</a> for sizes 0-32.</p>\n\n<pre><code>#[stable(feature = \"try_from\", since = \"1.34.0\")]\nimpl&lt;'a, T, const N: usize&gt; TryFrom&lt;&amp;'a [T]&gt; for &amp;'a [T; N]\nwhere\n    [T; N]: LengthAtMost32,\n{\n    type Error = TryFromSliceError;\n\n    fn try_from(slice: &amp;[T]) -&gt; Result&lt;&amp;[T; N], TryFromSliceError&gt; {\n        if slice.len() == N {\n            let ptr = slice.as_ptr() as *const [T; N];\n            unsafe { Ok(&amp;*ptr) }\n        } else {\n            Err(TryFromSliceError(()))\n        }\n    }\n}\n</code></pre>\n\n<p>When constant generics are stabilized, the bound <code>[T; N]: LengthAtMost32</code> will presumably be removed. Until then, you can implement your own function. Either use nightly with constant generics enabled or simply have a function for your specific size.</p>\n\n<pre><code>struct TryFromSliceError(());\n\nfn slice_to_array_64&lt;T&gt;(slice: &amp;[T]) -&gt; Result&lt;&amp;[T; 64], TryFromSliceError&gt; {\n    if slice.len() == 64 {\n        let ptr = slice.as_ptr() as *const [T; 64];\n        unsafe {Ok(&amp;*ptr)}\n    } else {\n        Err(TryFromSliceError(()))\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=e9e8441e8e417dfeb1368d8c1aea2f46\" rel=\"nofollow noreferrer\">(playground)</a></p>\n"}], "owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 0, "accepted_answer_id": 58478242, "answer_count": 1, "score": 2, "last_activity_date": 1571639188, "creation_date": 1571614039, "last_edit_date": 1571639188, "question_id": 58478116, "link": "https://stackoverflow.com/questions/58478116/how-to-convert-u8-into-u8-64", "title": "How to convert &amp;[u8] into &amp;[u8; 64]?", "body": "<p>I'm writing code that takes 64-byte blocks and I want to enforce this size at the type level:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn f(buf: &amp;[u8; 64]) { ... }\n</code></pre>\n\n<p>However, the data is coming in as a slice <code>&amp;[u8]</code>. So, I'd like to be able to take subspaces of this and convert to <code>&amp;[u8; 64]</code>. It turns out that it the following conversion works:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let buf = (0..32).collect::&lt;Vec&lt;u8&gt;&gt;();\nlet z: &amp;[u8; 32] = &amp;(&amp;buf[..]).try_into().unwrap();\n</code></pre>\n\n<p>But the following doesn't:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let buf = (0..64).collect::&lt;Vec&lt;u8&gt;&gt;();\nlet z: &amp;[u8; 64] = &amp;(&amp;buf[..]).try_into().unwrap();\n</code></pre>\n\n<p>The difference being from 0 to 32 inclusive, the conversion works, but not for sizes above 32. What can I do to enable this <code>&amp;[u8]</code> -> <code>&amp;[u8; 64]</code> conversion without manually doing data copy?</p>\n"}, {"tags": ["rust", "lifetime"], "comments": [{"owner": {"reputation": 561, "user_id": 6781431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/474851c0a5ec3cf43cf852a2a6d8595a?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Pearce", "link": "https://stackoverflow.com/users/6781431/chris-pearce"}, "edited": false, "score": 0, "creation_date": 1571591658, "post_id": 58475323, "comment_id": 103283792, "body": "Does <code>Effect</code> Borrow from player?"}, {"owner": {"reputation": 4172, "user_id": 3508956, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/umLTo.jpg?s=128&g=1", "display_name": "laptou", "link": "https://stackoverflow.com/users/3508956/laptou"}, "reply_to_user": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1571594765, "post_id": 58475323, "comment_id": 103284563, "body": "@mcarton Updated to include more code."}, {"owner": {"reputation": 4172, "user_id": 3508956, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/umLTo.jpg?s=128&g=1", "display_name": "laptou", "link": "https://stackoverflow.com/users/3508956/laptou"}, "reply_to_user": {"reputation": 561, "user_id": 6781431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/474851c0a5ec3cf43cf852a2a6d8595a?s=128&d=identicon&r=PG&f=1", "display_name": "Chris Pearce", "link": "https://stackoverflow.com/users/6781431/chris-pearce"}, "edited": false, "score": 0, "creation_date": 1571595020, "post_id": 58475323, "comment_id": 103284624, "body": "@ChrisPearce <code>Effect</code> can borrow from <code>Player</code> by holding a reference to one of the <code>Player</code>&#39;s <code>PropertySet</code>s."}, {"owner": {"reputation": 4172, "user_id": 3508956, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/umLTo.jpg?s=128&g=1", "display_name": "laptou", "link": "https://stackoverflow.com/users/3508956/laptou"}, "edited": false, "score": 0, "creation_date": 1571597489, "post_id": 58475323, "comment_id": 103285179, "body": "Here&#39;s a minimum reproducible example: <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=d717cf04c8d3226378d98c643fb423c9\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1571599971, "post_id": 58475323, "comment_id": 103285836, "body": "because <code>Effect</code> borrow it"}], "owner": {"reputation": 4172, "user_id": 3508956, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/umLTo.jpg?s=128&g=1", "display_name": "laptou", "link": "https://stackoverflow.com/users/3508956/laptou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1571599567, "creation_date": 1571591213, "last_edit_date": 1571599567, "question_id": 58475323, "link": "https://stackoverflow.com/questions/58475323/why-does-variable-need-to-continue-living-after-output-is-consumed", "title": "Why does variable need to continue living after output is consumed?", "body": "<pre class=\"lang-rust prettyprint-override\"><code>use std::cell::RefCell;\nuse std::collections::VecDeque;\n\n// minimum reproducible example for stack overflow question\n// which is essentially the whole thing b/c all of these types\n// depend on each other\n\n// this is an implementation of Monopoly Deal (see http://monopolydealrules.com/)\n// but the only relevant part to the question is in main(), around line 400\n\n// card.rs\n\npub trait Card {\n    fn value(&amp;self) -&gt; i32;\n\n    fn kind(&amp;self) -&gt; CardKind;\n}\n\npub enum CardKind {\n    Money,\n    Action,\n    Property,\n    Building,\n}\n\n// property.rs\n\npub struct PropertySet {\n    color: Color,\n    properties: Vec&lt;Property&gt;,\n    house: bool,\n    hotel: bool,\n}\n\nimpl PropertySet {\n    pub fn rent(&amp;self) -&gt; i32 {\n        unimplemented!() // stub\n    }\n\n    pub fn color(&amp;self) -&gt; Color {\n        self.color\n    }\n\n    pub fn properties(&amp;self) -&gt; &amp;Vec&lt;Property&gt; {\n        &amp;self.properties\n    }\n\n    pub fn is_full(&amp;self) -&gt; bool {\n        self.properties().len() == self.color.set_size() as usize\n    }\n\n    pub fn is_empty(&amp;self) -&gt; bool {\n        self.properties().len() == 0\n    }\n\n    pub fn add(&amp;mut self, property: Property) -&gt; Result&lt;(), PropertySetAddError&gt; {\n        if !property.matches(self.color) {\n            return Err(PropertySetAddError {\n                property,\n                kind: PropertySetAddErrorKind::WrongColor,\n            });\n        }\n\n        if self.properties.len() + 1 &lt; self.color.set_size() as usize {\n            self.properties.push(property);\n            Ok(())\n        } else {\n            Err(PropertySetAddError {\n                property,\n                kind: PropertySetAddErrorKind::SetFull,\n            })\n        }\n    }\n\n    fn remove(&amp;mut self, index: usize) -&gt; Property {\n        self.properties.remove(index)\n    }\n}\n\npub struct PropertySetAddError {\n    property: Property,\n    kind: PropertySetAddErrorKind,\n}\n\npub enum PropertySetAddErrorKind {\n    WrongColor,\n    SetFull,\n}\n\npub enum Property {\n    Basic { name: String, color: Color },\n    Wild { colors: [Color; 2], value: i32 },\n    Any,\n}\n\nimpl Card for Property {\n    fn value(&amp;self) -&gt; i32 {\n        unimplemented!() // stub\n    }\n\n    fn kind(&amp;self) -&gt; CardKind {\n        CardKind::Property\n    }\n}\n\nimpl Property {\n    pub fn matches(&amp;self, color: Color) -&gt; bool {\n        unimplemented!() // stub\n    }\n}\n\n#[derive(Eq, PartialEq, Hash, Copy, Clone)]\npub enum Color {\n    Red,\n    Orange,\n    Yellow,\n    Green,\n    LightBlue,\n    DarkBlue,\n    Magenta,\n    Brown,\n    Utility,\n    Railroad,\n}\n\nimpl Color {\n    pub fn set_size(&amp;self) -&gt; i32 {\n        unimplemented!() // stub\n    }\n}\n\n// money.rs\n\n#[derive(PartialOrd, Ord, PartialEq, Eq, Hash)]\npub struct Money(pub i32);\n\nimpl Card for Money {\n    fn value(&amp;self) -&gt; i32 {\n        self.0\n    }\n\n    fn kind(&amp;self) -&gt; CardKind {\n        CardKind::Money\n    }\n}\n\n#[derive(Copy, Clone, Hash, Eq, PartialEq)]\npub struct Id(pub usize);\n\npub struct Possessions {\n    bank: Vec&lt;Money&gt;,\n    hand: Vec&lt;Box&lt;dyn Card&gt;&gt;,\n    properties: Vec&lt;PropertySet&gt;,\n}\n\n// brain.rs\n\npub trait Brain {\n    fn act(&amp;self, state: &amp;GameState, possessions: &amp;mut Possessions) -&gt; Vec&lt;Effect&gt;;\n\n    fn react(\n        &amp;self,\n        state: &amp;GameState,\n        possessions: &amp;mut Possessions,\n        effect: &amp;Effect,\n    ) -&gt; Vec&lt;Effect&gt;;\n}\n\npub struct Human {}\n\nimpl Human {\n    pub fn new() -&gt; Human {\n        Human {}\n    }\n}\n\nimpl Brain for Human {\n    fn act(&amp;self, state: &amp;GameState, possessions: &amp;mut Possessions) -&gt; Vec&lt;Effect&gt; {\n        unimplemented!()\n    }\n\n    fn react(\n        &amp;self,\n        state: &amp;GameState,\n        possessions: &amp;mut Possessions,\n        effect: &amp;Effect,\n    ) -&gt; Vec&lt;Effect&gt; {\n        unimplemented!()\n    }\n}\n\n// action.rs\n\npub enum Action {\n    Rent { colors: [Color; 2] },\n    AnyRent,\n    DoubleRent,\n    DealBreaker,\n    DebtCollector,\n    Birthday,\n    SayNo,\n    PassGo,\n    SlyDeal,\n    ForcedDeal,\n}\n\nimpl Card for Action {\n    fn value(&amp;self) -&gt; i32 {\n        unimplemented!() // stub\n    }\n\n    fn kind(&amp;self) -&gt; CardKind {\n        CardKind::Action\n    }\n}\n\nimpl Action {\n    pub fn effect&lt;'a&gt;(\n        &amp;self,\n        source: Id,\n        target: ActionTarget&lt;'a&gt;,\n    ) -&gt; Result&lt;Effect&lt;'a&gt;, EffectError&gt; {\n        unimplemented!() // stub\n    }\n}\n\npub enum ActionTarget&lt;'a&gt; {\n    None,\n\n    Player {\n        player: Id,\n    },\n\n    Set {\n        /// The player that this action is targeted against\n        player: Id,\n\n        /// Can be a set that player owns, such as in the case of Deal Breaker, or it\n        /// can be a set that the source owns, such as in the case of rent cards\n        set: &amp;'a PropertySet,\n    },\n\n    Property {\n        player: Id,\n        property: (&amp;'a PropertySet, usize),\n    },\n\n    Swap {\n        player: Id,\n        take: (&amp;'a PropertySet, usize),\n        give: (&amp;'a PropertySet, usize),\n    },\n}\n\n// effect.rs\n\n#[derive(Clone)]\npub enum Effect&lt;'a&gt; {\n    // swaps properties with another player\n    Swap {\n        source: Id,\n        target: Id,\n        give: (&amp;'a PropertySet, usize),\n        take: (&amp;'a PropertySet, usize),\n    },\n\n    // steals properties from another player\n    Steal {\n        source: Id,\n        target: Id,\n        set: &amp;'a PropertySet,\n        indices: Vec&lt;usize&gt;,\n    },\n\n    // charges another player\n    Charge {\n        source: Id,\n        target: Option&lt;Id&gt;,\n        amount: i32,\n        reason: ChargeReason,\n    },\n\n    // cancels prior effect\n    Cancel {\n        source: Id,\n        target: Id,\n    },\n\n    // pass Go, credit $2M\n    Go {\n        source: Id,\n    },\n}\n\n#[derive(Clone)]\npub enum ChargeReason {\n    Rent,\n    Birthday,\n    DebtCollector,\n}\n\npub enum EffectError {\n    /// The target supplied was not valid for this action.\n    InvalidTarget,\n\n    /// You tried to charge rent for a color, but the specified set isn't that color\n    NoProperty,\n}\n\n// player.rs\n\npub struct Player {\n    pub id: Id,\n    pub name: String,\n    pub possessions: Possessions,\n    pub brain: Box&lt;dyn Brain&gt;,\n}\n\nimpl Player {\n    pub fn new(id: Id, name: String, brain: Box&lt;dyn Brain&gt;) -&gt; Player {\n        Player {\n            id,\n            possessions: Possessions {\n                bank: vec![],\n                hand: vec![],\n                properties: vec![],\n            },\n            name,\n            brain,\n        }\n    }\n\n    pub fn id(&amp;self) -&gt; Id {\n        self.id\n    }\n    pub fn bank(&amp;self) -&gt; &amp;Vec&lt;Money&gt; {\n        &amp;self.possessions.bank\n    }\n    pub fn properties(&amp;self) -&gt; &amp;Vec&lt;PropertySet&gt; {\n        &amp;self.possessions.properties\n    }\n    pub fn name(&amp;self) -&gt; &amp;str {\n        &amp;self.name\n    }\n    pub fn brain(&amp;self) -&gt; &amp;Box&lt;dyn Brain&gt; {\n        &amp;self.brain\n    }\n\n    pub fn act(&amp;mut self, state: &amp;GameState) -&gt; Vec&lt;Effect&gt; {\n        self.brain.act(state, &amp;mut self.possessions)\n    }\n\n    pub fn react(&amp;mut self, state: &amp;GameState, effect: &amp;Effect) -&gt; Vec&lt;Effect&gt; {\n        self.brain.react(state, &amp;mut self.possessions, effect)\n    }\n}\n\n// state.rs\n\npub struct GameState {\n    pub players: Vec&lt;RefCell&lt;Player&gt;&gt;,\n    pub current: Id,\n    pub stack: Vec&lt;Box&lt;dyn Card&gt;&gt;,\n}\n\nimpl GameState {\n    pub fn next(&amp;mut self) {\n        self.current = Id((self.current.0 + 1) % self.players.len())\n    }\n\n    pub fn current_player(&amp;self) -&gt; &amp;RefCell&lt;Player&gt; {\n        self.players.get(self.current.0).unwrap()\n    }\n\n    pub fn get_player(&amp;self, id: Id) -&gt; Option&lt;&amp;RefCell&lt;Player&gt;&gt; {\n        self.players.get(id.0)\n    }\n}\n\n// deck.rs\n\npub fn create_deck() -&gt; Vec&lt;Box&lt;dyn Card&gt;&gt; {\n    vec![\n        // ...\n    ]\n}\n\n// main.rs\n\npub fn main() {\n    let brain = Human::new(); // Human implements Brain\n    let me = Player::new(Id(0), \"Ibi\".to_owned(), Box::new(brain));\n    let current = me.id();\n    let players = vec![RefCell::new(me)];\n    let stack = create_deck(); // returns Vec&lt;Box&lt;dyn Card&gt;&gt;\n\n    let mut state = GameState {\n        players,\n        stack,\n        current,\n    };\n\n    while !state.players.iter().any(|player| {\n        player\n            .borrow()\n            .properties()\n            .iter()\n            .filter(|&amp;set| set.is_full())\n            .count()\n            &gt;= 3\n    }) {\n        // ...\n\n        let mut effects = VecDeque::new();\n\n        {\n            let mut current_player = state.current_player().borrow_mut();\n            let action = current_player.act(&amp;state);\n            effects.extend(action);\n        }\n\n        // let all other players react to effects until no more reactions are generated\n        while !effects.is_empty() {\n            let effect = effects.pop_front().unwrap();\n\n            // ...\n        }\n    }\n}\n</code></pre>\n\n<p>I can't get this code to compile; it says that <code>current_player</code> does not live long enough and complains that it is dropped at the end of the block. Why does <code>current_player</code> need to survive beyond the end of the block? My understanding is that it returns a <code>Vec&lt;Effect&gt;</code> which my method now owns, and then that vector is consumed by <code>extend()</code> and the values it contained are now owned by <code>effects</code>, so why is <code>current_player</code> still necessary?</p>\n"}, {"tags": ["design-patterns", "rust", "factory-pattern"], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 7190915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7342221a412d273d79fdf56adb029d0?s=128&d=identicon&r=PG&f=1", "display_name": "Edward Starlight", "link": "https://stackoverflow.com/users/7190915/edward-starlight"}, "edited": false, "score": 0, "creation_date": 1571593837, "post_id": 58475553, "comment_id": 103284339, "body": "Changed a code example to better describe my problem. I hope it&#39;s more clean now. I want to have hashmap of fabrics actually."}, {"owner": {"reputation": 73, "user_id": 7190915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7342221a412d273d79fdf56adb029d0?s=128&d=identicon&r=PG&f=1", "display_name": "Edward Starlight", "link": "https://stackoverflow.com/users/7190915/edward-starlight"}, "edited": false, "score": 0, "creation_date": 1571594695, "post_id": 58475553, "comment_id": 103284550, "body": "Removing the reference from pattern matching solves copy problem, but I still don&#39;t know what to write in hashmap type declaration."}], "tags": [], "owner": {"reputation": 1321, "user_id": 1291664, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/95854ef7aaf132a9f9ed8fd61366f7df?s=128&d=identicon&r=PG", "display_name": "\u0110or\u0111e Zelji\u0107", "link": "https://stackoverflow.com/users/1291664/%c4%90or%c4%91e-zelji%c4%87"}, "is_accepted": false, "score": 0, "last_activity_date": 1571592963, "creation_date": 1571592963, "answer_id": 58475553, "question_id": 58475255, "link": "https://stackoverflow.com/questions/58475255/rust-fabric-pattern-storing-multiple-factories-in-hashmap/58475553#58475553", "title": "Rust fabric pattern, storing multiple factories in hashmap", "body": "<p>Do you mean something like</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::collections::HashMap;\n\ntrait A {\n    fn boo(&amp;self) -&gt; i32;\n}\n\nstruct B {}\n\nimpl A for B {\n    fn boo(&amp;self) -&gt; i32 {\n        15\n    }\n}\n\nstruct C {\n    map: HashMap&lt;String, Box&lt;dyn A&gt;&gt;,\n}\n\nimpl C {\n    pub fn new() -&gt; C {\n        C {\n            map: HashMap::new(),\n        }\n    }\n\n    pub fn foo(&amp;self, key: String) {\n        match self.map.get(&amp;key) {\n            Some(val) =&gt; println!(\"{}\", val.boo()),\n            _ =&gt; println!(\"None\"),\n        }\n    }\n}\nfn main() {\n    let mut c = C::new();\n\n    c.map.insert(String::from(\"bar\"), Box::new(B{}));\n\n    c.foo(String::from(\"bar\"));\n}\n\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f9d6d9ff94eb8714ef6a6d0ab023fe84\" rel=\"nofollow noreferrer\">https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f9d6d9ff94eb8714ef6a6d0ab023fe84</a></p>\n\n<p>BTW. it's <code>Factory Design Pattern</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 7190915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7342221a412d273d79fdf56adb029d0?s=128&d=identicon&r=PG&f=1", "display_name": "Edward Starlight", "link": "https://stackoverflow.com/users/7190915/edward-starlight"}, "edited": false, "score": 0, "creation_date": 1571644378, "post_id": 58480173, "comment_id": 103295520, "body": "I really like the first solution, works like a charm! For those who interested and want to check by yourself, my final code is here - <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=a6f108c51ad1247ff8d9ee0231a1f27a\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}], "tags": [], "owner": {"reputation": 6608, "user_id": 4497253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc929d11ae26463d18e337d295c86fcc?s=128&d=identicon&r=PG&f=1", "display_name": "CoronA", "link": "https://stackoverflow.com/users/4497253/corona"}, "is_accepted": true, "score": 1, "last_activity_date": 1571635235, "creation_date": 1571635235, "answer_id": 58480173, "question_id": 58475255, "link": "https://stackoverflow.com/questions/58475255/rust-fabric-pattern-storing-multiple-factories-in-hashmap/58480173#58480173", "title": "Rust fabric pattern, storing multiple factories in hashmap", "body": "<p>I can think of two options:</p>\n\n<p><strong>Dynamic dispatch (trait objects)</strong>:</p>\n\n<pre><code>trait Fabric {\n  fn build(&amp;self) -&gt; Box&lt;dyn Fruit&gt;;\n}\n\n[...]\n\nimpl Fabric for BananaFabric  {\n  fn build(&amp;self) -&gt; Box&lt;dyn Fruit&gt; {\n    Box::new(Banana {})\n  }\n}\n</code></pre>\n\n<p><strong>Using an <code>enum</code></strong>:</p>\n\n<pre><code>enum Fruits {\n  Banana, \n  Apple\n}\nimpl Fruit for Fruits {\n  fn get_name(&amp;self) -&gt; String { \n    match self {\n      Banana =&gt; String::from(\"I'm banana\"),\n      Apple =&gt; String::from(\"I'm apple\"),\n      _ =&gt; String::from(\"\")\n    }\n  }\n}\n\n[...]\n\nimpl Fabric for BananaFabric  {\n  fn build(&amp;self) -&gt; Box&lt;Fruits&gt; {\n    Box::new(Fruits::Banana)\n  }\n}\n</code></pre>\n\n<p>In both cases the <code>foo</code> method will look like:</p>\n\n<pre><code>pub fn foo(&amp;self, key: String) {\n  match self.map.get(&amp;key) {\n    Some(fabric) =&gt; {\n      let fruit = fabric.build();\n        println!(\"{}\", fruit.get_name())\n      },\n      _ =&gt; println!(\"No fabric found\")\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 7190915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7342221a412d273d79fdf56adb029d0?s=128&d=identicon&r=PG&f=1", "display_name": "Edward Starlight", "link": "https://stackoverflow.com/users/7190915/edward-starlight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 0, "accepted_answer_id": 58480173, "answer_count": 2, "score": 1, "last_activity_date": 1571635235, "creation_date": 1571590623, "last_edit_date": 1571595183, "question_id": 58475255, "link": "https://stackoverflow.com/questions/58475255/rust-fabric-pattern-storing-multiple-factories-in-hashmap", "title": "Rust fabric pattern, storing multiple factories in hashmap", "body": "<p>I want to be able to store multiple factories in a single hashmap in order to add them to it later (by plugins for example) and then get each one by key-name in application (this is a resource manager).</p>\n\n<p>The problem is in generic of Fabric trait, fabrics can create fruits of different types but I need to specify something in here <code>HashMap&lt;String, Box&lt;dyn Fabric&gt;&gt;</code>, for example <code>HashMap&lt;String, Box&lt;Fabric&lt;Apple&gt;&gt;&gt;</code> or <code>HashMap&lt;String, Box&lt;Fabric&lt;T&gt;&gt;&gt;</code> which is also not wery useful because as I said we can create really different fruits.</p>\n\n<p>Also I guess there might be a problem in foo method, about borrowing content.</p>\n\n<p>So how would you implement this \"the rust way\"?</p>\n\n<pre><code>use std::collections::HashMap;\n\ntrait Fruit {\n    fn get_name(&amp;self) -&gt; String;\n}\n\ntrait Fabric&lt;T: Fruit&gt; {\n    fn build(&amp;self) -&gt; Box&lt;T&gt;;\n}\n\nstruct Banana {}\nimpl Fruit for Banana {\n    fn get_name(&amp;self) -&gt; String { String::from(\"I'm banana\") }\n}\n\nstruct BananaFabric {}\nimpl Fabric&lt;Banana&gt; for BananaFabric  {\n    fn build(&amp;self) -&gt; Box&lt;Banana&gt; {\n        Box::new(Banana {})\n    }\n}\n\nstruct Apple {}\nimpl Fruit for Apple {\n    fn get_name(&amp;self) -&gt; String { String::from(\"I'm apple\") }\n}\n\nstruct AppleFabric {}\nimpl Fabric&lt;Apple&gt; for AppleFabric  {\n    fn build(&amp;self) -&gt; Box&lt;Apple&gt; {\n        Box::new(Apple {})\n    }\n}\n\nstruct C {\n    map: HashMap&lt;String, Box&lt;dyn Fabric&gt;&gt;,\n}\n\nimpl C {\n    pub fn new() -&gt; C {\n        C {\n            map: HashMap::new()\n        }\n    }\n\n    pub fn foo(&amp;self, key: String) {\n        match self.map.get(&amp;key) {\n            Some(&amp;fabric) =&gt; {\n                let fruit = fabric.build();\n                println!(\"{}\", fruit.get_name())\n            },\n            _ =&gt; println!(\"No fabric found\")\n        }\n    }\n}\n\nfn main() {\n    let c = C::new();\n    c.foo(String::from(\"bar\"));\n}\n</code></pre>\n"}, {"tags": ["docker", "rust", "dockerfile", "actix-web"], "comments": [{"owner": {"reputation": 2436, "user_id": 12153397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c2953382ea987f63d81335242c2561c?s=128&d=identicon&r=PG", "display_name": "ckaserer", "link": "https://stackoverflow.com/users/12153397/ckaserer"}, "edited": false, "score": 0, "creation_date": 1571583549, "post_id": 58473606, "comment_id": 103281612, "body": "please provide your cargo.toml as well"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1571584060, "post_id": 58473606, "comment_id": 103281752, "body": "Your Dockerfile is missing a <code>CMD</code> line; what&#39;s the container supposed to run when it starts up?  (Is the build sequence actually completing?)"}, {"owner": {"reputation": 2436, "user_id": 12153397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c2953382ea987f63d81335242c2561c?s=128&d=identicon&r=PG", "display_name": "ckaserer", "link": "https://stackoverflow.com/users/12153397/ckaserer"}, "edited": false, "score": 0, "creation_date": 1574080634, "post_id": 58473606, "comment_id": 104091204, "body": "If the answer solved your question please accept it or provide additional information to further debug the issue at hand"}], "answers": [{"comments": [{"owner": {"reputation": 14905, "user_id": 931303, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1798bf4504775c89be6686fa6fc74e3?s=128&d=identicon&r=PG", "display_name": "Jorge Leitao", "link": "https://stackoverflow.com/users/931303/jorge-leitao"}, "edited": false, "score": 5, "creation_date": 1584861074, "post_id": 58474618, "comment_id": 107564775, "body": "Great answer. For reference, <code>COPY dummy.rs</code> can be replaced by <code>RUN echo &quot;fn main() {}&quot; &gt; dummy.rs</code>, which avoids having a file <code>dummy.rs</code> on the repository."}, {"owner": {"reputation": 146, "user_id": 9788471, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Martin Sommer", "link": "https://stackoverflow.com/users/9788471/martin-sommer"}, "edited": false, "score": 1, "creation_date": 1615737590, "post_id": 58474618, "comment_id": 117778334, "body": "Instead of manipulating the <code>Cargo.toml</code> you could add a 2nd <code>[[bin]]</code> target to it. Make sure to copy <code>src&#47;dummy.rs</code> together with your <code>Cargo.toml</code>. Then add a 2nd bin target (like lines 5-7 fro your example). Set  <code>name= &quot;download-only&quot;</code>, <code>path = &quot;src&#47;dummy.rs&quot;</code> and call <code>cargo build --bin download-only</code>."}, {"owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 1, "creation_date": 1616240057, "post_id": 58474618, "comment_id": 117943107, "body": "If you&#39;re doing <code>RUN echo &quot;fn main() {}&quot; &gt; .&#47;src&#47;main.rs</code>, then <code>COPY .&#47;src .&#47;src</code>, cargo may not rebuild your app. You&#39;ll need to update the last modified of the main.rs file to inform cargo to rebuild it. Before your 2nd cargo build, you need to run <code>RUN touch -a -m .&#47;src&#47;main.rs</code> to update the last modified of the file."}, {"owner": {"reputation": 691, "user_id": 4385342, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh3.googleusercontent.com/-ywHOrlzk5g4/AAAAAAAAAAI/AAAAAAAAB9Y/mO2q6r1jr60/photo.jpg?sz=128", "display_name": "a3y3", "link": "https://stackoverflow.com/users/4385342/a3y3"}, "reply_to_user": {"reputation": 146, "user_id": 9788471, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Martin Sommer", "link": "https://stackoverflow.com/users/9788471/martin-sommer"}, "edited": false, "score": 0, "creation_date": 1619055845, "post_id": 58474618, "comment_id": 118791648, "body": "@MartinSommer the <code>[[bin]]</code> approach doesn&#39;t work. For your binary <code>download-only</code>, you&#39;ll need to <code>cargo build --bin download-only</code>, which will make docker cache dependencies only for this command. However, you&#39;ll still need to <code>cargo build --bin app</code>, which won&#39;t be cached. The only way for docker to cache properly is if both the build commands are exactly the same, so I don&#39;t think there&#39;s an alternative to manipulating <code>Cargo.toml</code>"}], "tags": [], "owner": {"reputation": 2436, "user_id": 12153397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c2953382ea987f63d81335242c2561c?s=128&d=identicon&r=PG", "display_name": "ckaserer", "link": "https://stackoverflow.com/users/12153397/ckaserer"}, "is_accepted": true, "score": 17, "last_activity_date": 1571586260, "creation_date": 1571586260, "answer_id": 58474618, "question_id": 58473606, "link": "https://stackoverflow.com/questions/58473606/cache-rust-dependencies-with-docker-build/58474618#58474618", "title": "Cache Rust dependencies with Docker build", "body": "<p>Seems like you are not alone in your endeavor to cache rust dependencies via the docker build process. Here is a great article that helps you along the way: <a href=\"https://blog.mgattozzi.dev/caching-rust-docker-builds/\" rel=\"noreferrer\">https://blog.mgattozzi.dev/caching-rust-docker-builds/</a></p>\n\n<p>The gist of it is you need a dummy.rs and your Cargo.toml first, then build it to cache the dependencies and then copy your application source later in order to not invalidate the cache with every build. </p>\n\n<p><strong>Dockerfile</strong></p>\n\n<pre><code>FROM rust\nWORKDIR /var/www/app\nCOPY dummy.rs .\nCOPY Cargo.toml .\nRUN sed -i 's#src/main.rs#dummy.rs#' Cargo.toml\nRUN cargo build --release\nRUN sed -i 's#dummy.rs#src/main.rs#' Cargo.toml\nCOPY . .\nRUN cargo build --release\nCMD [\"target/release/app\"]\n</code></pre>\n\n<p>CMD application name \"app\" is based on what you have specified in your Cargo.toml for your binary.</p>\n\n<p><strong>dummy.rs</strong></p>\n\n<pre><code>fn main() {}\n</code></pre>\n\n<p><strong>Cargo.toml</strong></p>\n\n<pre><code>[package]\nname = \"app\"\nversion = \"0.1.0\"\nauthors = [\"...\"]\n[[bin]]\nname = \"app\"\npath = \"src/main.rs\"\n\n[dependencies]\nactix-web = \"1.0.0\"\n</code></pre>\n\n<p><strong>src/main.rs</strong></p>\n\n<pre><code>extern crate actix_web;\n\nuse actix_web::{web, App, HttpServer, Responder};\n\nfn index() -&gt; impl Responder {\n    \"Hello world\"\n}\n\nfn main() -&gt; std::io::Result&lt;()&gt; {\n    HttpServer::new(|| App::new().service(web::resource(\"/\").to(index)))\n        .bind(\"0.0.0.0:8080\")?\n        .run()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17090, "user_id": 526741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/041a16c31147b188e339f6d7f5ca7c9d?s=128&d=identicon&r=PG", "display_name": "0b10011", "link": "https://stackoverflow.com/users/526741/0b10011"}, "is_accepted": false, "score": 1, "last_activity_date": 1574451937, "creation_date": 1574451937, "answer_id": 59000812, "question_id": 58473606, "link": "https://stackoverflow.com/questions/58473606/cache-rust-dependencies-with-docker-build/59000812#59000812", "title": "Cache Rust dependencies with Docker build", "body": "<p>I think the problem is your <code>volumes</code> definition is not doing a bind mount. I believe your current config is copying <code>HOST ./registry/</code> into <code>DOCKER /root/.cargo/registry/</code>, writing to <code>DOCKER /root/.cargo/registry/</code>, and discarding the contents when the container is shut down.</p>\n\n<p>Instead, you'll want to specify the <code>bind</code> type on the volume:</p>\n\n<pre><code>version: \"3\"\nservices:\n  app:\n    container_name: hello-world\n    build: .\n    environment:\n      - CARGO_HOME=/var/www/\n    ports:\n      - '8080:8080'\n    volumes:\n      - .:/var/www/app\n      - type: bind\n        source: ./registry\n        target: /root/.cargo/registry\n</code></pre>\n\n<p>However, keep in mind a <code>/root/.cargo/.package-cache</code> file is also created, but not kept here. Instead, you could change the <code>source</code> to <code>./.cargo</code> and target to <code>/root/.cargo</code>.</p>\n\n<hr>\n\n<p>For my own (mostly cli) rust projects, I like to use a <a href=\"https://gist.github.com/0b10011/137a167bdb8ada1ecfdcd8b6aecf0e6d\" rel=\"nofollow noreferrer\">drop-in replacement I've written for <code>cargo</code></a> that I've confirmed caches packages between builds, greatly reducing build time. This can be copied to <code>/usr/local/bin</code> to be used globally, or ran as <code>./cargo build</code> within a single project. But do keep in mind this specific script assumes the app is located at <code>/usr/src/app</code> within the container, so it'd likely need adjusting for your use.</p>\n"}, {"comments": [{"owner": {"reputation": 349, "user_id": 187539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac450184a905950c26fe2f124898d571?s=128&d=identicon&r=PG", "display_name": "Cody Schafer", "link": "https://stackoverflow.com/users/187539/cody-schafer"}, "edited": false, "score": 0, "creation_date": 1609890296, "post_id": 60590697, "comment_id": 115962351, "body": "Won&#39;t using <code>--mount=type=cache,target=&#47;home&#47;rust&#47;src&#47;target</code> mean that other simultaneous builds access the <code>target</code> directory? Should <code>sharing=private</code> or <code>sharing=locked</code> be added to that cache line? Perhaps in combination with a separate layer to populate a build local <code>target&#47;</code> from the cache and another layer to push the new stuff back into the cache?"}], "tags": [], "owner": {"reputation": 6266, "user_id": 2302437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/abb8e13633480a4d3add0f113e596501?s=128&d=identicon&r=PG&f=1", "display_name": "electronix384128", "link": "https://stackoverflow.com/users/2302437/electronix384128"}, "is_accepted": false, "score": 8, "last_activity_date": 1583691976, "creation_date": 1583691976, "answer_id": 60590697, "question_id": 58473606, "link": "https://stackoverflow.com/questions/58473606/cache-rust-dependencies-with-docker-build/60590697#60590697", "title": "Cache Rust dependencies with Docker build", "body": "<p>With the (still experimental) Docker Buildkit you can finally properly cache build folders during a <code>docker build</code> step:</p>\n\n<p><strong>Dockerfile:</strong></p>\n\n<pre><code># syntax=docker/dockerfile:experimental\nfrom rust\nENV HOME=/home/root\nWORKDIR $HOME/app\n[...]\nRUN --mount=type=cache,target=/usr/local/cargo/registry \\\n    --mount=type=cache,target=/home/root/app/target \\\n    cargo build --release\n</code></pre>\n\n<p>Then run:</p>\n\n<p><code>DOCKER_BUILDKIT=1 docker build . --progress=plain</code></p>\n\n<p>Subsequent docker builds will reuse the cargo and target folders from cache, hence massively speeding up your builds.</p>\n\n<p>To clear the docker cache mount: <code>docker builder prune --filter type=exec.cachemount</code></p>\n\n<p>If you don't see proper caching: Make sure to confirm the location of your cargo/registry and target folders in the docker image, if you don't see proper caching.</p>\n\n<p>Minimal working Example: <a href=\"https://github.com/benmarten/sccache-docker-test/tree/no-sccache\" rel=\"noreferrer\">https://github.com/benmarten/sccache-docker-test/tree/no-sccache</a></p>\n"}, {"tags": [], "owner": {"reputation": 378, "user_id": 2330143, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/95a600c4c9e618a2dc3f43a0103eeddd?s=128&d=identicon&r=PG", "display_name": "Stephen Eckels", "link": "https://stackoverflow.com/users/2330143/stephen-eckels"}, "is_accepted": false, "score": 1, "last_activity_date": 1587749069, "creation_date": 1587749069, "answer_id": 61413980, "question_id": 58473606, "link": "https://stackoverflow.com/questions/58473606/cache-rust-dependencies-with-docker-build/61413980#61413980", "title": "Cache Rust dependencies with Docker build", "body": "<p>This is what i do, and it's compatible with build scripts. It's a multi-stage build so it results in a small image, but caches the built dependencies in the first image.</p>\n\n<pre><code>FROM rust:1.43 AS builder\n\nRUN apt-get update\nRUN cd /tmp &amp;&amp; USER=root cargo new --bin &lt;projectname&gt;\nWORKDIR /tmp/&lt;projectname&gt;\n\n# cache rust dependencies in docker layer\nCOPY Cargo.toml Cargo.lock ./\nRUN touch build.rs &amp;&amp; echo \"fn main() {println!(\\\"cargo:rerun-if-changed=\\\\\\\"/tmp/&lt;projectname&gt;/build.rs\\\\\\\"\\\");}\" &gt;&gt; build.rs\nRUN cargo build --release\n\n# build the real stuff and disable cache via the ADD\nADD \"https://www.random.org/cgi-bin/randbyte?nbytes=10&amp;format=h\" skipcache\nCOPY ./build.rs ./build.rs\n\n# force the build.rs script to run by modifying it\nRUN echo \" \" &gt;&gt; build.rs\nCOPY ./src ./src\nRUN cargo build --release\n\nFROM rust:1.43\nWORKDIR /bin\nCOPY --from=builder /tmp/&lt;projectname&gt;/target/release/server /bin/&lt;project binary&gt;\nRUN chmod +x ./&lt;project binary&gt;\nCMD ./&lt;project binary&gt;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 349, "user_id": 187539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac450184a905950c26fe2f124898d571?s=128&d=identicon&r=PG", "display_name": "Cody Schafer", "link": "https://stackoverflow.com/users/187539/cody-schafer"}, "edited": false, "score": 0, "creation_date": 1609890278, "post_id": 64141061, "comment_id": 115962346, "body": "Won&#39;t using <code>--mount=type=cache,target=&#47;home&#47;rust&#47;src&#47;target</code> mean that other simultaneous builds access the <code>target</code> directory? Should <code>sharing=private</code> or <code>sharing=locked</code> be added to that cache line? Perhaps in combination with a separate layer to populate a build local <code>target&#47;</code> from the cache and another layer to push the new stuff back into the cache?"}, {"owner": {"reputation": 23, "user_id": 1103925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d9f6c8ebc7c22f2f181652d0a862b47?s=128&d=identicon&r=PG", "display_name": "jetersen", "link": "https://stackoverflow.com/users/1103925/jetersen"}, "reply_to_user": {"reputation": 349, "user_id": 187539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac450184a905950c26fe2f124898d571?s=128&d=identicon&r=PG", "display_name": "Cody Schafer", "link": "https://stackoverflow.com/users/187539/cody-schafer"}, "edited": false, "score": 1, "creation_date": 1612721006, "post_id": 64141061, "comment_id": 116849305, "body": "Thanks for the hint, I have updated the example and dockerfile syntax is now no longer experimental \ud83d\udc4f"}], "tags": [], "owner": {"reputation": 23, "user_id": 1103925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d9f6c8ebc7c22f2f181652d0a862b47?s=128&d=identicon&r=PG", "display_name": "jetersen", "link": "https://stackoverflow.com/users/1103925/jetersen"}, "is_accepted": false, "score": 2, "last_activity_date": 1612720860, "last_edit_date": 1612720860, "creation_date": 1601480323, "answer_id": 64141061, "question_id": 58473606, "link": "https://stackoverflow.com/questions/58473606/cache-rust-dependencies-with-docker-build/64141061#64141061", "title": "Cache Rust dependencies with Docker build", "body": "<p>While <a href=\"https://stackoverflow.com/users/2302437/electronix384128\">electronix384128</a> answer is excellent. I would like to expand on it by adding cache for <code>.cargo/git</code> which is needed for any dependency using git and by adding a multistage docker example.</p>\n<p>Using rust-musl-builder and Docker Buildkit feature, which is now default in Docker Desktop 2.4. On other versions you may still need to enable it via: <code>DOCKER_BUILDKIT=1 docker build .</code></p>\n<p><code>rusl-musl-builder</code>'s working directory is <code>/home/rust/src</code><br />\nTried setting uid/gid on <code>--mount</code> but failed to compile rust due to permission issue in target.</p>\n<pre><code># syntax=docker/dockerfile:1.2\nFROM ekidd/rust-musl-builder:stable AS builder\n\nCOPY . .\nRUN --mount=type=cache,target=/home/rust/.cargo/git \\\n    --mount=type=cache,target=/home/rust/.cargo/registry \\\n    --mount=type=cache,sharing=private,target=/home/rust/src/target \\\n    sudo chown -R rust: target /home/rust/.cargo &amp;&amp; \\\n    cargo build --release &amp;&amp; \\\n    # Copy executable out of the cache so it is available in the final image.\n    cp target/x86_64-unknown-linux-musl/release/my-executable ./my-executable\n\nFROM alpine\nCOPY --from=builder /home/rust/src/my-executable .\nUSER 1000\nCMD [&quot;./my-executable&quot;]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 349, "user_id": 187539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac450184a905950c26fe2f124898d571?s=128&d=identicon&r=PG", "display_name": "Cody Schafer", "link": "https://stackoverflow.com/users/187539/cody-schafer"}, "edited": false, "score": 1, "creation_date": 1609890290, "post_id": 64528456, "comment_id": 115962350, "body": "Won&#39;t using <code>--mount=type=cache,target=&#47;home&#47;rust&#47;src&#47;target</code> mean that other simultaneous builds access the <code>target</code> directory? Should <code>sharing=private</code> or <code>sharing=locked</code> be added to that cache line? Perhaps in combination with a separate layer to populate a build local <code>target&#47;</code> from the cache and another layer to push the new stuff back into the cache?"}, {"owner": {"reputation": 5962, "user_id": 3873510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/YpJMi.jpg?s=128&g=1", "display_name": "Paul Razvan Berg", "link": "https://stackoverflow.com/users/3873510/paul-razvan-berg"}, "edited": false, "score": 0, "creation_date": 1612273520, "post_id": 64528456, "comment_id": 116710734, "body": "I am getting this error: <code>docker: Error response from daemon: OCI runtime create failed: container_linux.go:370: starting container process caused: exec: &quot;.&#47;usr&#47;local&#47;bin&#47;app&quot;: stat .&#47;usr&#47;local&#47;bin&#47;app: no such file or directory: unknown.</code>"}, {"owner": {"reputation": 5962, "user_id": 3873510, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/YpJMi.jpg?s=128&g=1", "display_name": "Paul Razvan Berg", "link": "https://stackoverflow.com/users/3873510/paul-razvan-berg"}, "edited": false, "score": 0, "creation_date": 1612274202, "post_id": 64528456, "comment_id": 116711095, "body": "<b>Update</b>: I fixed the error by deleting the dot in the array value of &quot;ENTRYPOINT&quot;."}], "tags": [], "owner": {"reputation": 51, "user_id": 5861287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I9Alu.png?s=128&g=1", "display_name": "LukeMathWalker", "link": "https://stackoverflow.com/users/5861287/lukemathwalker"}, "is_accepted": false, "score": 5, "last_activity_date": 1603657789, "creation_date": 1603657789, "answer_id": 64528456, "question_id": 58473606, "link": "https://stackoverflow.com/questions/58473606/cache-rust-dependencies-with-docker-build/64528456#64528456", "title": "Cache Rust dependencies with Docker build", "body": "<p>You can use <code>cargo-chef</code> to leverage Docker layer caching using a multi-stage build.</p>\n<pre><code>FROM rust as planner\nWORKDIR app\n# We only pay the installation cost once, \n# it will be cached from the second build onwards\nRUN cargo install cargo-chef \nCOPY . .\nRUN cargo chef prepare  --recipe-path recipe.json\n\nFROM rust as cacher\nWORKDIR app\nRUN cargo install cargo-chef\nCOPY --from=planner /app/recipe.json recipe.json\nRUN cargo chef cook --release --recipe-path recipe.json\n\nFROM rust as builder\nWORKDIR app\nCOPY . .\n# Copy over the cached dependencies\nCOPY --from=cacher /app/target target\nRUN cargo build --release --bin app\n\nFROM rust as runtime\nWORKDIR app\nCOPY --from=builder /app/target/release/app /usr/local/bin\nENTRYPOINT [&quot;./usr/local/bin/app&quot;]\n</code></pre>\n<p>It does not require Buildkit and works for both simple projects and workspaces.\nYou can find more details in the <a href=\"https://www.lpalmieri.com/posts/fast-rust-docker-builds/\" rel=\"noreferrer\">release announcement</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "is_accepted": false, "score": 0, "last_activity_date": 1616240594, "creation_date": 1616240594, "answer_id": 66721148, "question_id": 58473606, "link": "https://stackoverflow.com/questions/58473606/cache-rust-dependencies-with-docker-build/66721148#66721148", "title": "Cache Rust dependencies with Docker build", "body": "<p>Based on <a href=\"https://stackoverflow.com/a/58474618/4988637\">@ckaserer</a>'s answer, you can <code>RUN echo &quot;fn main() {}&quot; &gt; ./src/main.rs</code> to build the dependencies before building your app.</p>\n<p>First copy just your <code>Cargo.toml</code> and <code>Cargo.lock</code> files and build the dummy main.rs file:</p>\n<pre><code>FROM rust as rust-builder\nWORKDIR /usr/src/app\n\n# Copy Cargo files\nCOPY ./Cargo.toml .\nCOPY ./Cargo.lock .\n\n# Create fake main.rs file in src and build\nRUN mkdir ./src &amp;&amp; echo 'fn main() { println!(&quot;Dummy!&quot;); }' &gt; ./src/main.rs\nRUN cargo build --release\n</code></pre>\n<p>Then you can copy over your real src directory and run build again:</p>\n<pre><code># Copy source files over\nRUN rm -rf ./src\nCOPY ./src ./src\n\n# The last modified attribute of main.rs needs to be updated manually,\n# otherwise cargo won't rebuild it.\nRUN touch -a -m ./src/main.rs\n\nRUN cargo build --release\n</code></pre>\n<p>Then we can copy our file to a slim version of debain.\nHere's the full docker file:</p>\n<pre><code>FROM rust as rust-builder\nWORKDIR /usr/src/app\nCOPY ./Cargo.toml .\nCOPY ./Cargo.lock .\nRUN mkdir ./src &amp;&amp; echo 'fn main() { println!(&quot;Dummy!&quot;); }' &gt; ./src/main.rs\nRUN cargo build --release\nRUN rm -rf ./src\nCOPY ./src ./src\nRUN touch -a -m ./src/main.rs\nRUN cargo build --release\n\nFROM debian:buster-slim\nCOPY --from=rust-builder /usr/src/app/target/release/app /usr/local/bin/\nWORKDIR /usr/local/bin\nCMD [&quot;app&quot;]\n</code></pre>\n"}], "owner": {"reputation": 441, "user_id": 10364449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14647f02302a1fc1ee251f5cd7318f69?s=128&d=identicon&r=PG&f=1", "display_name": "Arek C.", "link": "https://stackoverflow.com/users/10364449/arek-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4193, "favorite_count": 5, "accepted_answer_id": 58474618, "answer_count": 7, "score": 16, "last_activity_date": 1616240594, "creation_date": 1571578947, "last_edit_date": 1571601124, "question_id": 58473606, "link": "https://stackoverflow.com/questions/58473606/cache-rust-dependencies-with-docker-build", "title": "Cache Rust dependencies with Docker build", "body": "<p>I have hello world web project in Rust + Actix-web. I have several problems. First is every change in code causes recompiling whole project including downloading and compiling every crate. I'd like to work like in normal development - it means cache compiled crates and only recompile my codebase. Second problem is it doesn't expose my my app. It's unreachable via web browser</p>\n\n<p>Dockerfile:</p>\n\n<pre><code>FROM rust\n\nWORKDIR /var/www/app\n\nCOPY . .\n\nEXPOSE 8080\n\nRUN cargo run\n</code></pre>\n\n<p>docker-compose.yml:</p>\n\n<pre><code>version: \"3\"\nservices:\n  app:\n    container_name: hello-world\n    build: .\n    ports:\n      - '8080:8080'\n    volumes:\n      - .:/var/www/app\n      - registry:/root/.cargo/registry\n\nvolumes:\n  registry:\n    driver: local\n</code></pre>\n\n<p>main.rs:</p>\n\n<pre><code>extern crate actix_web;\n\nuse actix_web::{web, App, HttpServer, Responder};\n\nfn index() -&gt; impl Responder {\n    \"Hello world\"\n}\n\nfn main() -&gt; std::io::Result&lt;()&gt; {\n    HttpServer::new(|| App::new().service(web::resource(\"/\").to(index)))\n        .bind(\"0.0.0.0:8080\")?\n        .run()\n}\n</code></pre>\n\n<p>Cargo.toml:</p>\n\n<pre><code>[package]\nname = \"hello-world\"\nversion = \"0.1.0\"\nauthors = []\nedition = \"2018\"\n\n[dependencies]\nactix-web = \"1.0\"\n</code></pre>\n"}, {"tags": ["testing", "rust", "panic"], "answers": [{"tags": [], "owner": {"reputation": 938, "user_id": 3894179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c6b1c2c08d1075995cb780ee8a2e36e?s=128&d=identicon&r=PG", "display_name": "Andra", "link": "https://stackoverflow.com/users/3894179/andra"}, "is_accepted": true, "score": 4, "last_activity_date": 1571573978, "creation_date": 1571573978, "answer_id": 58472927, "question_id": 58472697, "link": "https://stackoverflow.com/questions/58472697/rust-panic-unit-test-specifics-of-matching-the-error-message/58472927#58472927", "title": "Rust panic unit test - specifics of matching the error message", "body": "<p>Use <code>#[should_panic(expected = \"substring of panic message\")]</code></p>\n\n<p>Example</p>\n\n<pre><code>fn some_panic_function() {\n    panic!(\"abc substring of panic message abc\");\n}\n\n#[test]\n#[should_panic(expected = \"substring of panic message\")]\nfn test_some_panic_function() {\n    some_panic_function();\n}\n</code></pre>\n\n<p>From this <a href=\"https://doc.rust-lang.org/book/ch11-01-writing-tests.html\" rel=\"nofollow noreferrer\">https://doc.rust-lang.org/book/ch11-01-writing-tests.html</a></p>\n"}], "owner": {"reputation": 30833, "user_id": 275501, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f7c3dc8ca7088469d8d0a1c53e671913?s=128&d=identicon&r=PG", "display_name": "goofballLogic", "link": "https://stackoverflow.com/users/275501/goofballlogic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 0, "closed_date": 1571665657, "accepted_answer_id": 58472927, "answer_count": 1, "score": 1, "last_activity_date": 1571587086, "creation_date": 1571572084, "last_edit_date": 1571587086, "question_id": 58472697, "link": "https://stackoverflow.com/questions/58472697/rust-panic-unit-test-specifics-of-matching-the-error-message", "closed_reason": "Duplicate", "title": "Rust panic unit test - specifics of matching the error message", "body": "<p>I'm looking for a way to assert that a piece of code panics, and that the panic message contains a particular string. I came up with the following which appears to work:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let actual = std::panic::catch_unwind(|| decode(notation.to_string()));\nassert!(actual.is_err());\nlet err = *(actual.unwrap_err().downcast::&lt;String&gt;().unwrap());\nassert!(err.contains(\"Invalid\"));\n</code></pre>\n\n<p>I know that I can use <code>#[should_panic]</code> and that it lets me specify a message to check for, but I only want to partially match the exact error message.</p>\n"}, {"tags": ["rust", "hyper"], "answers": [{"tags": [], "owner": {"reputation": 221, "user_id": 7039144, "user_type": "registered", "profile_image": "https://graph.facebook.com/1824254821119702/picture?type=large", "display_name": "Asya Corbeau", "link": "https://stackoverflow.com/users/7039144/asya-corbeau"}, "is_accepted": true, "score": 1, "last_activity_date": 1571639615, "last_edit_date": 1571639615, "creation_date": 1571594842, "answer_id": 58475811, "question_id": 58471848, "link": "https://stackoverflow.com/questions/58471848/return-a-struct-from-a-body-stream/58475811#58475811", "title": "Return a struct from a body stream", "body": "<p>You are trying to use hyper synchronously, by nature hyper is not made for that and require a layer of abstraction, you should look at this\n <a href=\"https://github.com/hyperium/hyper/issues/123\" rel=\"nofollow noreferrer\">issus</a> </p>\n\n<pre><code>There is no documentation specifically to that effect. Since\nyou'd need to block the thread at a certain point in execution\nuntil it is ready, you'd need the work of the event loop to occur\nin another thread, and send the results over a channel that you\nblock on.\n\nAlternatively, you can look at reqwest, which even with the hyper\nupgrade (not quite released to crate.io, but super soon), it\nstill offers a synchronous API besides the new async API.\n</code></pre>\n\n<p>Note: <code>reqwest</code> is now released on crate.io</p>\n"}], "owner": {"reputation": 395, "user_id": 8636906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e17c868e496ca3b1d3e2070c8771d2ce?s=128&d=identicon&r=PG&f=1", "display_name": "Silva", "link": "https://stackoverflow.com/users/8636906/silva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 58475811, "answer_count": 1, "score": 0, "last_activity_date": 1571639615, "creation_date": 1571565295, "question_id": 58471848, "link": "https://stackoverflow.com/questions/58471848/return-a-struct-from-a-body-stream", "title": "Return a struct from a body stream", "body": "<p>Please assist, i have looked at the <a href=\"https://hyper.rs/guides/server/echo/\" rel=\"nofollow noreferrer\">hyper doc</a> and <a href=\"https://github.com/hyperium/hyper/tree/master/examples\" rel=\"nofollow noreferrer\">example</a> </p>\n\n<p>Most examples when dealing with hyper <code>Request&lt;Body&gt;</code> will either <code>map(|chunk|{ //do something })</code> or <code>and_then(|chunk|{ //do something })</code> then return the Stream, that works but now i want to try and return the chunk or actual item in the stream. see below</p>\n\n<pre><code>pub fn to_struct(body: Body) -&gt; Option&lt;Person&gt; {\n    let person = body.and_then(|chunk|{\n        let body = std::str::from_utf8(&amp;chunk).unwrap();\n        let results: Person = serde_json::from_str(&amp;body).unwrap();\n        Ok(results)\n    });\n    // match person or if let \n    // return Some or None\n\n    // Don't wan't to Body::wrap_stream(person) then return Response&lt;Body&gt;\n}\n</code></pre>\n\n<p><code>streams do nothing unless polled</code> now i want to poll the following stream and return the results.<code>await</code> might solve the issue i believe but i am using rust Stable. I wish to <code>poll()</code> but i will receive a <code>NotReady</code>.Please advise.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 938, "user_id": 3894179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c6b1c2c08d1075995cb780ee8a2e36e?s=128&d=identicon&r=PG", "display_name": "Andra", "link": "https://stackoverflow.com/users/3894179/andra"}, "edited": false, "score": 0, "creation_date": 1571574397, "post_id": 58470912, "comment_id": 103279122, "body": "If you want to iterate on some u32, you can use <code>for i in 1u32..10u32</code>"}], "answers": [{"tags": [], "owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "is_accepted": false, "score": 4, "last_activity_date": 1571558341, "last_edit_date": 1571558341, "creation_date": 1571556816, "answer_id": 58470934, "question_id": 58470912, "link": "https://stackoverflow.com/questions/58470912/no-implementation-for-integer-stdopsrangeinteger/58470934#58470934", "title": "No implementation for `{integer} % &amp;std::ops::Range&lt;{integer}&gt;`", "body": "<p>In your code, <code>[1..10]</code> is actually a fixed-size array with a range <code>1..10</code> as its only element. You want to iterate over range itself rather than that 1-element array:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let n = 2;\nfor i in 1..10 {\n  if n % i == 0 {\n    ...\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 339, "user_id": 2147956, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/116f8f6b7451dc45dc02609fbfabd435?s=128&d=identicon&r=PG", "display_name": "waaadim", "link": "https://stackoverflow.com/users/2147956/waaadim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571558341, "creation_date": 1571556640, "last_edit_date": 1571557430, "question_id": 58470912, "link": "https://stackoverflow.com/questions/58470912/no-implementation-for-integer-stdopsrangeinteger", "title": "No implementation for `{integer} % &amp;std::ops::Range&lt;{integer}&gt;`", "body": "<p>I understand the error, but still have no idea how to cast <code>i</code> to <code>u32/integer</code>.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let n = 2;\nfor i in [1..10].into_iter() {\n  if n % i == 0 {\n    ...\n  }\n}\n</code></pre>\n\n<p><code>if n % (i as u32) == 0</code> doesn't work</p>\n\n<blockquote>\n  <p>help: the trait <code>std::ops::Rem&lt;&amp;std::ops::Range&lt;{integer}&gt;&gt;</code> is not implemented for <code>{integer}</code></p>\n</blockquote>\n"}, {"tags": ["windows", "rust", "mqtt"], "comments": [{"owner": {"reputation": 40434, "user_id": 504554, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/006ffde9ed3fac6396222405fc5e9bf0?s=128&d=identicon&r=PG", "display_name": "hardillb", "link": "https://stackoverflow.com/users/504554/hardillb"}, "edited": false, "score": 0, "creation_date": 1571555412, "post_id": 58470768, "comment_id": 103275271, "body": "What happens when you follow the instructions in the error message (&quot;run the command again with --verbose&quot;)?"}, {"owner": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "edited": false, "score": 1, "creation_date": 1571575709, "post_id": 58470768, "comment_id": 103279435, "body": "You actually need to ave <code>mosquitto</code> itself installed and in path for the linker to be able to link to it."}, {"owner": {"reputation": 23, "user_id": 12245718, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b89d8cf8c2ef583b0bd2497d897e1f5e?s=128&d=identicon&r=PG&f=1", "display_name": "Tanc", "link": "https://stackoverflow.com/users/12245718/tanc"}, "edited": false, "score": 0, "creation_date": 1571587994, "post_id": 58470768, "comment_id": 103282748, "body": "Mosquitto is Indeed installed in folder C:\\Program Files\\mosquitto\\devel. I tried to read <a href=\"https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/cargo/reference/specifying-dependencies.ht&zwnj;&#8203;ml</a> but i can&#39;t make it run atm. As a quickstart, can someone kindly show me how to do it ?"}, {"owner": {"reputation": 90851, "user_id": 27009, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f0a29af415477aa8c498a4f41ffe6640?s=128&d=identicon&r=PG", "display_name": "Kornel", "link": "https://stackoverflow.com/users/27009/kornel"}, "edited": false, "score": 0, "creation_date": 1572579531, "post_id": 58470768, "comment_id": 103612096, "body": "See what mosquitto-client crate requires in their documentation. The error is caused by that create not being able to guess where you installed the library."}], "owner": {"reputation": 23, "user_id": 12245718, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b89d8cf8c2ef583b0bd2497d897e1f5e?s=128&d=identicon&r=PG&f=1", "display_name": "Tanc", "link": "https://stackoverflow.com/users/12245718/tanc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 538, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1571569874, "creation_date": 1571555136, "last_edit_date": 1571569874, "question_id": 58470768, "link": "https://stackoverflow.com/questions/58470768/rust-on-windows-getting-link-fatal-error-lnk1181-error", "title": "RUST on windows : getting LINK : fatal error LNK1181 error", "body": "<p>I am a complete beginner (following <a href=\"https://livevideo.manning.com/course/42/rust-in-motion\" rel=\"nofollow noreferrer\">this</a> course actually) regarding Rust language and i was wondering if it was possible to create an app for Windows involving a mqtt client.</p>\n\n<p>I created my project using <code>cargo new testmqtt --bin</code>,</p>\n\n<p>my toml file is </p>\n\n<pre><code>[package]\nname = \"testmqtt\"\nversion = \"0.1.0\"\nauthors = [\"Pierre\"]\nedition = \"2018\"\n\n# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\n\n[dependencies]\nmosquitto-client = \"0.1.5\"\n</code></pre>\n\n<p>Main.rs file is exactly the first one found <a href=\"https://docs.rs/mosquitto-client/0.1.5/mosquitto_client/\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<pre><code>extern crate mosquitto_client as mosq;\nuse mosq::Mosquitto;\n\nfn main() {\n    let m = Mosquitto::new(\"test\");\n\n    m.will_set(\"test/will\",b\"finished!\",0,false).expect(\"can't set will\");\n\n    m.connect(\"localhost\",1883).expect(\"can't connect\");\n    let bonzo = m.subscribe(\"bonzo/#\",0).expect(\"can't subscribe to bonzo\");\n    let frodo = m.subscribe(\"frodo/#\",0).expect(\"can't subscribe to frodo\");\n\n    // not interested in any retained messages!\n    let mut mc = m.callbacks(());\n    mc.on_message(|_,msg| {\n        if ! msg.retained() {\n            if bonzo.matches(&amp;msg) {\n                println!(\"bonzo {:?}\",msg);\n            } else\n            if frodo.matches(&amp;msg) {\n                println!(\"frodo {:?}\",msg);\n                m.disconnect().unwrap();\n            }\n        }\n    });\n\n    m.loop_forever(200).expect(\"broken loop\");\n}\n</code></pre>\n\n<p>When doing cargo run, i do have an error saying more or less that i have to include mosquitto.lib file.</p>\n\n<pre><code>Compiling testmqtt v0.1.0 (C:\\Users\\Pierre\\rust\\testmqtt)\n    Finished dev [unoptimized + debuginfo] target(s) in 3.43s\n     Running `target\\debug\\testmqtt.exe`\nHello, world!\nPS C:\\Users\\Pierre\\rust\\testmqtt&gt; cargo run\n    Updating crates.io index\n   Compiling mosquitto-client v0.1.5\n   Compiling testmqtt v0.1.0 (C:\\Users\\Pierre\\rust\\testmqtt)\nerror: linking with `link.exe` failed: exit code: 1181\n  |\n  = note: \"C:\\\\Program Files (x86)\\\\Microsoft Visual Studio\\\\2019\\\\BuildTools\\\\VC\\\\Tools\\\\MSVC\\\\14.23.28105\\\\bin\\\\HostX64\\\\x64\\\\link.exe\" \"/NOLOGO\" \"/NXCOMPAT\" \"/LIBPATH:C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.18yxopwcqksqllf0.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.26hriqf9eoqoz70e.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.287dmq688xsz3isv.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.2e77zj76zbvh065j.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.2huuzosvc51r1ocl.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.2o9r9r2t2clr39wq.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.2wggiqwux76jad1h.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.3mqzooten3ugyse9.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.3vqvdeaqidai2p26.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.4fnmrub2ky4biwf5.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.4tdiuzs0kqadbi75.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.4u40iyf9g9kmiphf.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.51m4wneyq731nq60.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.5d67na1jjhizscb4.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.ap2kea3xxb47i5p.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.h5xgbt8abre0rtw.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.vlg3p2hoy45m5m6.rcgu.o\" \"/OUT:C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.exe\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.49ivjbnnhficmjo4.rcgu.o\" \"/OPT:REF,NOICF\" \"/DEBUG\" \"/NATVIS:C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\intrinsic.natvis\" \"/NATVIS:C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\liballoc.natvis\" \"/NATVIS:C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\libcore.natvis\" \"/LIBPATH:C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\" \"/LIBPATH:C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\libmosquitto_client-23967bfdaa3a5433.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libstd-8864852919b3dde3.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libpanic_unwind-60bab00b06422126.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libbacktrace-e90b3ab99b608a07.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librustc_demangle-d9b7b1604d471c6c.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libhashbrown-a439eac7fda93b7a.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librustc_std_workspace_alloc-058c975bf38e4686.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libunwind-711d56157cf28645.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcfg_if-d802c196c150a787.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liblibc-7147008fc56d32b8.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liballoc-57b2ee5c835455f8.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librustc_std_workspace_core-6391a360e3eeafba.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcore-6c8df881cdc2afb2.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcompiler_builtins-f998976453a15b70.rlib\" \"mosquitto.lib\" \"c.lib\" \"advapi32.lib\" \"ws2_32.lib\" \"userenv.lib\" \"msvcrt.lib\"\n  = note: Non-UTF-8 output: LINK : fatal error LNK1181: impossible d\\'ouvrir le fichier en entr\\xe9e \\'mosquitto.lib\\'\\r\\n\n\nerror: aborting due to previous error\n\nerror: Could not compile `testmqtt`.\n\nTo learn more, run the command again with --verbose.\n</code></pre>\n\n<p>Here is the verbose ouput</p>\n\n<p>To learn more, run the command again with --verbose.</p>\n\n<pre><code>PS C:\\Users\\Pierre\\rust\\testmqtt&gt; cargo run --verbose\n       Fresh mosquitto-client v0.1.5\n   Compiling testmqtt v0.1.0 (C:\\Users\\Pierre\\rust\\testmqtt)\n     Running `rustc --edition=2018 --crate-name testmqtt src\\main.rs --color always --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=e2a79a549b8dacef -C extra-filename=-e2a79a549b8dacef --out-dir C:\\Users\\Pierre\\rust\\testmqtt\\target\\debug\\deps -C incremental=C:\\Users\\Pierre\\rust\\testmqtt\\target\\debug\\incremental -L dependency=C:\\Users\\Pierre\\rust\\testmqtt\\target\\debug\\deps --extern mosquitto_client=C:\\Users\\Pierre\\rust\\testmqtt\\target\\debug\\deps\\libmosquitto_client-23967bfdaa3a5433.rlib`error: linking with `link.exe` failed: exit code: 1181\n  |\n  = note: \"C:\\\\Program Files (x86)\\\\Microsoft Visual Studio\\\\2019\\\\BuildTools\\\\VC\\\\Tools\\\\MSVC\\\\14.23.28105\\\\bin\\\\HostX64\\\\x64\\\\link.exe\" \"/NOLOGO\" \"/NXCOMPAT\" \"/LIBPATH:C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.18yxopwcqksqllf0.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.26hriqf9eoqoz70e.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.287dmq688xsz3isv.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.2e77zj76zbvh065j.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.2huuzosvc51r1ocl.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.2o9r9r2t2clr39wq.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.2wggiqwux76jad1h.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.3mqzooten3ugyse9.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.3vqvdeaqidai2p26.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.4fnmrub2ky4biwf5.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.4tdiuzs0kqadbi75.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.4u40iyf9g9kmiphf.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.51m4wneyq731nq60.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.5d67na1jjhizscb4.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.ap2kea3xxb47i5p.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.h5xgbt8abre0rtw.rcgu.o\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.vlg3p2hoy45m5m6.rcgu.o\" \"/OUT:C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.exe\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\testmqtt-e2a79a549b8dacef.49ivjbnnhficmjo4.rcgu.o\" \"/OPT:REF,NOICF\" \"/DEBUG\" \"/NATVIS:C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\intrinsic.natvis\" \"/NATVIS:C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\liballoc.natvis\" \"/NATVIS:C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\etc\\\\libcore.natvis\" \"/LIBPATH:C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\" \"/LIBPATH:C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\" \"C:\\\\Users\\\\Pierre\\\\rust\\\\testmqtt\\\\target\\\\debug\\\\deps\\\\libmosquitto_client-23967bfdaa3a5433.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libstd-8864852919b3dde3.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libpanic_unwind-60bab00b06422126.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libbacktrace-e90b3ab99b608a07.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librustc_demangle-d9b7b1604d471c6c.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libhashbrown-a439eac7fda93b7a.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librustc_std_workspace_alloc-058c975bf38e4686.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libunwind-711d56157cf28645.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcfg_if-d802c196c150a787.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liblibc-7147008fc56d32b8.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\liballoc-57b2ee5c835455f8.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\librustc_std_workspace_core-6391a360e3eeafba.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcore-6c8df881cdc2afb2.rlib\" \"C:\\\\Users\\\\Pierre\\\\.rustup\\\\toolchains\\\\stable-x86_64-pc-windows-msvc\\\\lib\\\\rustlib\\\\x86_64-pc-windows-msvc\\\\lib\\\\libcompiler_builtins-f998976453a15b70.rlib\" \"mosquitto.lib\" \"c.lib\" \"advapi32.lib\" \"ws2_32.lib\" \"userenv.lib\" \"msvcrt.lib\"\n  = note: Non-UTF-8 output: LINK : fatal error LNK1181: impossible d\\'ouvrir le fichier en entr\\xe9e \\'mosquitto.lib\\'\\r\\n     \n\nerror: aborting due to previous error\n\nerror: Could not compile `testmqtt`.\n\nCaused by:\n  process didn't exit successfully: `rustc --edition=2018 --crate-name testmqtt src\\main.rs --color always --crate-type bin --emit=dep-info,link -C debuginfo=2 -C metadata=e2a79a549b8dacef -C extra-filename=-e2a79a549b8dacef --out-dir C:\\Users\\Pierre\\rust\\testmqtt\\target\\debug\\deps -C incremental=C:\\Users\\Pierre\\rust\\testmqtt\\target\\debug\\incremental -L dependency=C:\\Users\\Pierre\\rust\\testmqtt\\target\\debug\\deps --extern mosquitto_client=C:\\Users\\Pierre\\rust\\testmqtt\\target\\debug\\deps\\libmosquitto_client-23967bfdaa3a5433.rlib` (exit code: 1)\n</code></pre>\n\n<p>It is possible to do that, isn't ?</p>\n\n<p>Regards,</p>\n\n<p>Pierre</p>\n"}, {"tags": ["methods", "types", "rust"], "comments": [{"owner": {"reputation": 97521, "user_id": 565635, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7b4b3e7c9ac68b7d2c93ad02d0b9c79d?s=128&d=identicon&r=PG", "display_name": "orlp", "link": "https://stackoverflow.com/users/565635/orlp"}, "edited": false, "score": 0, "creation_date": 1571566826, "post_id": 58470218, "comment_id": 103277361, "body": "What is the definition of <code>Pivot</code>?"}, {"owner": {"reputation": 15131, "user_id": 166838, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0c01a983961c34967d0ccedda9eb7d49?s=128&d=identicon&r=PG", "display_name": "Elf Sternberg", "link": "https://stackoverflow.com/users/166838/elf-sternberg"}, "reply_to_user": {"reputation": 97521, "user_id": 565635, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7b4b3e7c9ac68b7d2c93ad02d0b9c79d?s=128&d=identicon&r=PG", "display_name": "orlp", "link": "https://stackoverflow.com/users/565635/orlp"}, "edited": false, "score": 0, "creation_date": 1571587506, "post_id": 58470218, "comment_id": 103282620, "body": "It&#39;s a struct with the exact same signature and a full implementation of <code>I</code>."}], "answers": [{"comments": [{"owner": {"reputation": 15131, "user_id": 166838, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0c01a983961c34967d0ccedda9eb7d49?s=128&d=identicon&r=PG", "display_name": "Elf Sternberg", "link": "https://stackoverflow.com/users/166838/elf-sternberg"}, "edited": false, "score": 0, "creation_date": 1571587410, "post_id": 58472067, "comment_id": 103282594, "body": "That seems a bit counter-intuitive, as <code>Pivot</code> is an implementation of <code>I</code>.  It would have been nice if the error message had been more clear.  I understand why it&#39;s not working, and there&#39;s an acceptable work-around for it (keep the energy map in the main struct for caching, but pass it to a function for the actual mapping process), but that seems less OO-y than I expected.  (I know, Rust isn&#39;t an OO language, but sometimes <code>impl</code>s feel like it should be.)"}, {"owner": {"reputation": 97521, "user_id": 565635, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7b4b3e7c9ac68b7d2c93ad02d0b9c79d?s=128&d=identicon&r=PG", "display_name": "orlp", "link": "https://stackoverflow.com/users/565635/orlp"}, "reply_to_user": {"reputation": 15131, "user_id": 166838, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0c01a983961c34967d0ccedda9eb7d49?s=128&d=identicon&r=PG", "display_name": "Elf Sternberg", "link": "https://stackoverflow.com/users/166838/elf-sternberg"}, "edited": false, "score": 0, "creation_date": 1571587567, "post_id": 58472067, "comment_id": 103282635, "body": "@ElfSternberg No, you&#39;re still a bit confused. <code>Pivot</code> is not an implementation of <code>I</code> (which isn&#39;t even possible, <code>I</code> is a concrete type, not a trait), it is an implementation of <code>GenericImageView</code>. But <code>calculate_energy</code> expects <code>I</code>, not a <code>GenericImageView</code> when you made it non-generic. You can keep it inside the class but make it generic again."}, {"owner": {"reputation": 15131, "user_id": 166838, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0c01a983961c34967d0ccedda9eb7d49?s=128&d=identicon&r=PG", "display_name": "Elf Sternberg", "link": "https://stackoverflow.com/users/166838/elf-sternberg"}, "edited": false, "score": 0, "creation_date": 1571671771, "post_id": 58472067, "comment_id": 103309331, "body": "That makes sense.  I&#39;ll see if I can genericize it, and maybe that&#39;ll help me understand the difference."}], "tags": [], "owner": {"reputation": 97521, "user_id": 565635, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7b4b3e7c9ac68b7d2c93ad02d0b9c79d?s=128&d=identicon&r=PG", "display_name": "orlp", "link": "https://stackoverflow.com/users/565635/orlp"}, "is_accepted": true, "score": 2, "last_activity_date": 1571567231, "creation_date": 1571567231, "answer_id": 58472067, "question_id": 58470218, "link": "https://stackoverflow.com/questions/58470218/a-rust-type-mystery-convert-a-function-to-a-method-and-calling-functions-sign/58472067#58472067", "title": "A Rust Type Mystery: Convert a function to a method, and calling function&#39;s signatures break compilation", "body": "<p>There is a very important change, <code>calculate_energy</code> is no longer a generic function for all types <code>I</code> such that <code>I: Gener...</code> etc, etc. Instead it is a regular function expecting a very specific type <code>I</code>.</p>\n\n<p>Which type <code>I</code>? Well, whichever <code>I</code> <code>AviShaOne</code> uses, which I'll assume is the same type as <code>self.image</code>. So calling <code>calculate_energy(self.image)</code> is fine.</p>\n\n<p>However, <code>Pivot::new(self.image)</code> has an entirely different type, it is <code>Pivot</code>, not <code>I</code>. And since <code>calculate_energy</code> is no longer a generic function it can not deal with this.</p>\n"}], "owner": {"reputation": 15131, "user_id": 166838, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0c01a983961c34967d0ccedda9eb7d49?s=128&d=identicon&r=PG", "display_name": "Elf Sternberg", "link": "https://stackoverflow.com/users/166838/elf-sternberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 58472067, "answer_count": 1, "score": 0, "last_activity_date": 1571587462, "creation_date": 1571548217, "last_edit_date": 1571587462, "question_id": 58470218, "link": "https://stackoverflow.com/questions/58470218/a-rust-type-mystery-convert-a-function-to-a-method-and-calling-functions-sign", "title": "A Rust Type Mystery: Convert a function to a method, and calling function&#39;s signatures break compilation", "body": "<p>A Mystery about Rust Types that I don't quite get.</p>\n\n<p>I was recently refactoring code for a project and ran into a typing\nmystery that has me puzzled, and I hope someone here can clarify what's\ngoing on.</p>\n\n<p>I've been writing a program to <a href=\"https://github.com/elfsternberg/pamseam-rs\" rel=\"nofollow noreferrer\">implement the Seam Carving\nalgorithm</a>.  \"Seam Carving\"\nis a way of reducing an image's dimensions automatically by finding, for\neach pixel in a first row, the meandering path of pixels from\ntop-to-bottom or left-to-right that would do the least damage to the\nimage, and then removing that \"seam.\"  The path is calculated from the\n<em>energy</em> of each pixel: the distance between the colors of that pixel's\ntwo neighbors is calculated, and then the seam with the <em>lowest total\ndelta</em> is identified.</p>\n\n<p>So, Image \u2192 Energy Map \u2192 Seam \u2192 Reduced Image.</p>\n\n<p>In memory, an image is a collection of rows concatenated together.\nScanning for a vertical seam means scanning <em>rows</em> (left and right\nneighbors form the delta), but scanning for a horizontal seam means\nscanning <em>columns</em>.  Adjacent pixels in columns are <em>not</em> adjacent in\nmemory, and this makes multi-threading with rayon or crossbeam\ndifficult.</p>\n\n<p>The good news is that each <em>source</em> is read-only.  Generating the energy\nmap requires write access only to the energy map.  For columns, if I\ncould rotate the energy map I could multi-thread horizontal scanning.\nThat turns out to be easy, and all I need is a proxy object to map the\n<code>(x, y)</code> to <code>(y, x)</code> when reading the image.  Let's call that proxy\nobject a <code>Pivot</code>.</p>\n\n<p>Let me show some code (AviShaOne is the first seam carving algorithm, \nfrom Avidan &amp; Shamir, \"Seam Carving,\" 2007):</p>\n\n<pre><code>fn calculate_energy&lt;I, P, S&gt;(image: &amp;I) -&gt; TwoDimensionalMap&lt;u32&gt;\nwhere\n    I: GenericImageView&lt;Pixel = P&gt;,\n    P: Pixel&lt;Subpixel = S&gt; + 'static,\n    S: Primitive + 'static,\n{\n   ...\n}\n\nimpl&lt;'a, I, P, S&gt; AviShaOne&lt;'a, I, P, S&gt;\nwhere\n    I: GenericImageView&lt;Pixel = P&gt;,\n    P: Pixel&lt;Subpixel = S&gt; + 'static,\n    S: Primitive + 'static,\n{\n    fn find_vertical_seam(&amp;self) -&gt; Vec&lt;u32&gt; {\n        energy_to_seam(&amp;calculate_energy(self.image))\n    }\n    fn find_horizontal_seam(&amp;self) -&gt; Vec&lt;u32&gt; {\n        energy_to_seam(&amp;calculate_energy(&amp;Pivot::new(self.image)))\n    }\n}\n</code></pre>\n\n<p>Let me emphasize: The above code <em>works</em>.  The Pivot remaps the\ncoordinates, and now the internal functions can work with thread-capable\nmemory objects.</p>\n\n<p>If I want to reduce an image by more than one seam, I have to run this\ncalculation repeatedly.  It would be nice if I could <em>cache</em> the energy\nmap.  (Since the seam meanders, and removing that seam would damage\nseams that cross it, the column removed would be fairly large, but\nit would still be less bad than recalculating it for <em>every seam</em>.)  I\nwant to add the energy map to the <code>struct</code>, and bring <code>calculate_energy</code>\ninto the the <code>impl</code>.</p>\n\n<p>This is where things get weird:</p>\n\n<pre><code>impl&lt;'a, I, P, S&gt;  AviShaOne&lt;'a, I, P, S&gt;\nwhere\n    I: GenericImageView&lt;Pixel = P&gt;,\n    P: Pixel&lt;Subpixel = S&gt; + 'static,\n    S: Primitive + 'static,\n{\n    fn calculate_energy(&amp;self, image: &amp;I) -&gt; TwoDimensionalMap&lt;u32&gt;\n    {\n        ...\n    }\n\n    fn find_horizontal_seam(&amp;self) -&gt; Vec&lt;u32&gt; {\n        energy_to_seam(&amp;self.calculate_energy(&amp;Pivot::new(self.image)))\n    }\n}\n</code></pre>\n\n<p>All I did was move <code>calculate_energy</code> into the implementation.  No other\ncode was changed.  <code>Pivot</code> has the same type signature as <code>AviShaOne</code>,\nas they're both handling these <code>GenericImageView</code> objects.  And now it\nwon't compile:</p>\n\n<pre><code>176 |         energy_to_seam(&amp;self.calculate_energy(&amp;Pivot::new(self.image)))\n    |                                               ^^^^^^ expected type parameter, found struct `pivot::Pivot`\n</code></pre>\n\n<p>This is the mystery.  The functions are literally the same.  The type\nsignatures are, as far as I can tell, congruent, literally copied &amp;\npasted for consistency. I have not added <code>energy</code> as a field yet! It worked fine when the function was just a\nfunction, but now that it's a member of the implementation, the compiler\nwants something else, but I have no idea what.</p>\n\n<p>What does the compiler want?</p>\n"}, {"tags": ["rust", "lifetime"], "answers": [{"comments": [{"owner": {"reputation": 165, "user_id": 541254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b910226ff1999f2ee7fde56670df8d74?s=128&d=identicon&r=PG", "display_name": "Andre Genereux", "link": "https://stackoverflow.com/users/541254/andre-genereux"}, "edited": false, "score": 0, "creation_date": 1571587893, "post_id": 58469629, "comment_id": 103282726, "body": "Thanks, that&#39;s a great explanation! So if I understand it correctly, I don&#39;t have to explicitly identify all of the lifetimes that contribute to constraints on my type. I just have to declare its lifetime, and then indicate that the lifetimes of my inputs must be subtypes of that?"}], "tags": [], "owner": {"reputation": 46065, "user_id": 234590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/463c0219a51a5d1fd08e1fa280811b57?s=128&d=identicon&r=PG", "display_name": "Francis Gagn&#233;", "link": "https://stackoverflow.com/users/234590/francis-gagn%c3%a9"}, "is_accepted": true, "score": 2, "last_activity_date": 1571539407, "creation_date": 1571539407, "answer_id": 58469629, "question_id": 58469240, "link": "https://stackoverflow.com/questions/58469240/how-can-i-return-an-impl-iterator-that-has-multiple-lifetimes/58469629#58469629", "title": "How can I return an impl Iterator that has multiple lifetimes?", "body": "<p>Lifetime parameters don't always represent the <em>exact</em> lifetime of an object (or of a borrow). Let's consider this example:</p>\n\n<pre><code>fn main() {\n    let a = 3;\n    let b = 5;\n    let c = min(&amp;a, &amp;b);\n    println!(\"{:?}\", c);\n}\n\nfn min&lt;'a&gt;(a: &amp;'a i32, b: &amp;'a i32) -&gt; &amp;'a i32 {\n    if a &lt; b {\n        a\n    } else {\n        b\n    }\n}\n</code></pre>\n\n<p>Here, <code>min</code> takes two reference arguments with the same lifetime. However, we call it with borrows of different variables, which have different lifetimes. So why does this code compile?</p>\n\n<p>The answer is <a href=\"https://doc.rust-lang.org/nomicon/subtyping.html\" rel=\"nofollow noreferrer\">subtyping and variance</a>. Larger lifetimes are <em>subtypes</em> of shorter lifetimes; conversely, shorter lifetimes are <em>supertypes</em> of larger lifetimes. In the example above, the compiler has to find one lifetime that is compatible with both input lifetimes. The compiler does this by finding the common supertype of both lifetimes (i.e. the shortest lifetime that contains both). This is called <em>unification</em>.</p>\n\n<hr>\n\n<p>Back to your problem. It seems like the compiler <a href=\"https://github.com/rust-lang/rust/issues/61756\" rel=\"nofollow noreferrer\">doesn't handle multiple lifetime bounds on <code>impl Trait</code> too well</a> at the moment. However, there's no real need to have two lifetime bounds: one is enough. The compiler will shorten this single lifetime if necessary to satisfy the requirements of both <code>self</code> and <code>input_iter</code>.</p>\n\n<pre><code>struct Foo&lt;'op, Input&gt; {\n    op: Box&lt;dyn Fn(Input) -&gt; i32 + 'op&gt;,\n}\n\nimpl&lt;'op, Input&gt; Foo&lt;'op, Input&gt; {\n    fn new&lt;Op&gt;(op: Op) -&gt; Foo&lt;'op, Input&gt;\n    where\n        Op: Fn(Input) -&gt; i32 + 'op,\n    {\n        Foo { op: Box::new(op) }\n    }\n\n    fn apply&lt;InputIter&gt;(\n        self,\n        input_iter: InputIter,\n    ) -&gt; impl Iterator&lt;Item = i32&gt; + 'op\n    where\n        Input: 'op,\n        InputIter: IntoIterator&lt;Item = Input&gt; + 'op,\n    {\n        input_iter.into_iter().map(move |input| (self.op)(input))\n    }\n}\n\nfn main() {\n    let y = 1;\n    let foo = Foo::new(|x| x as i32 + y);\n\n    let s = \"abc\".to_string();\n    let sr: &amp;str = &amp;*s;\n    let bar = sr.chars();\n\n    let baz: Vec&lt;_&gt; = foo.apply(bar).collect();\n    println!(\"{:?}\", baz);\n}\n</code></pre>\n\n<p>Try moving the lines in <code>main</code> around to convince yourself that the lifetimes are indeed unified.</p>\n\n<p>At this point, calling the lifetime <code>'op</code> is somewhat misleading; it might as well be called <code>'a</code>.</p>\n"}], "owner": {"reputation": 165, "user_id": 541254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b910226ff1999f2ee7fde56670df8d74?s=128&d=identicon&r=PG", "display_name": "Andre Genereux", "link": "https://stackoverflow.com/users/541254/andre-genereux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 0, "accepted_answer_id": 58469629, "answer_count": 1, "score": 2, "last_activity_date": 1571539407, "creation_date": 1571533247, "question_id": 58469240, "link": "https://stackoverflow.com/questions/58469240/how-can-i-return-an-impl-iterator-that-has-multiple-lifetimes", "title": "How can I return an impl Iterator that has multiple lifetimes?", "body": "<p>I'm having trouble with lifetimes on an impl trait. I'm trying to get the following code to work:</p>\n\n<pre><code>struct Foo&lt;'op, Input&gt; {\n    op: Box&lt;dyn Fn(Input) -&gt; i32 + 'op&gt;,\n}\n\nimpl&lt;'op, Input&gt; Foo&lt;'op, Input&gt; {\n    fn new&lt;Op&gt;(op: Op) -&gt; Foo&lt;'op, Input&gt;\n    where\n        Op: Fn(Input) -&gt; i32 + 'op,\n    {\n        Foo { op: Box::new(op) }\n    }\n\n    fn apply&lt;'input_iter, InputIter&gt;(\n        self,\n        input_iter: InputIter,\n    ) -&gt; impl Iterator&lt;Item = i32&gt; + 'op + 'input_iter\n    where\n        InputIter: IntoIterator&lt;Item = Input&gt; + 'input_iter,\n    {\n        input_iter.into_iter().map(move |input| (self.op)(input))\n    }\n}\n\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f380f5de71883fbc734a2f6400f7e6ca\" rel=\"nofollow noreferrer\">Playground</a>)</p>\n\n<p>This is giving me the following error:</p>\n\n<pre><code>error[E0495]: cannot infer an appropriate lifetime due to conflicting requirements\n  --&gt; src/lib.rs:20:36\n   |\n20 |         input_iter.into_iter().map(move |input| (self.op)(input))\n   |                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n   |\nnote: first, the lifetime cannot outlive the lifetime 'op as defined on the impl at 5:6...\n  --&gt; src/lib.rs:5:6\n   |\n5  | impl&lt;'op, Input&gt; Foo&lt;'op, Input&gt; {\n   |      ^^^\n   = note: ...so that the types are compatible:\n           expected Foo&lt;'_, _&gt;\n              found Foo&lt;'op, _&gt;\nnote: but, the lifetime must be valid for the lifetime 'input_iter as defined on the method body at 13:14...\n  --&gt; src/lib.rs:13:14\n   |\n13 |     fn apply&lt;'input_iter, InputIter&gt;(\n   |              ^^^^^^^^^^^\nnote: ...so that return value is valid for the call\n  --&gt; src/lib.rs:16:10\n   |\n16 |     ) -&gt; impl Iterator&lt;Item = i32&gt; + 'op + 'input_iter\n   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n\n<p>Here's my understanding of the lifetimes involved. Foo owns an op, which is a closure that may have a reference in it somewhere, so it may have a bound lifetime. This is denoted by 'op, and Foo is constrained such that it can't outlive it. So far, so good.</p>\n\n<p>In apply(), the idea is that we want to consume an input_iter and self and return an iterator of each element in input_iter mapped using self.op. input_iterator may also contain references, so it may have its own lifetime bounds, denoted by 'input_iter.</p>\n\n<p>What I want is to return an iterator that takes ownership of both self and input_iter. In doing so, it would have to take on both of their lifetime parameters to ensure that it didn't outlast either the input_iter references or the op references. I thought <code>impl Iterator&lt;Item = i32&gt; + 'op + 'input_iter</code> would accomplish this, but I seem to have taken a wrong turn somewhere.</p>\n\n<p>It's also weird that it's complaining about the closure. I understand that the closure can't outlive 'op, because it takes ownership of the operator and its references. That makes perfect sense. What I don't understand is why it needs to live as long as 'input_iter. The closure and the input iterator shouldn't care about each other at all; the only thing connecting them is that they both have the same owner (the output iterator).</p>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["compiler-errors", "rust", "rust-cargo", "rust-diesel"], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 8302310, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0f43ecf5a823fb338c779eb36d962fc8?s=128&d=identicon&r=PG&f=1", "display_name": "mso4491", "link": "https://stackoverflow.com/users/8302310/mso4491"}, "edited": false, "score": 0, "creation_date": 1571681617, "post_id": 58469602, "comment_id": 103313926, "body": "Yea, after testing it does seem that way which prevents the server from connecting with PostGres. The safest way to get around it unfortunately seems to be to paste the PostGres pathway in the terminal, as environmental variables only work if I delete the <code>ssleay32.dll</code> file mentioned in that post. Hoping eventually there will be a better solution."}], "tags": [], "owner": {"reputation": 61, "user_id": 6107066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sIYbk.png?s=128&g=1", "display_name": "Ethan", "link": "https://stackoverflow.com/users/6107066/ethan"}, "is_accepted": false, "score": 0, "last_activity_date": 1571539058, "creation_date": 1571539058, "answer_id": 58469602, "question_id": 58469199, "link": "https://stackoverflow.com/questions/58469199/rust-compiling-error-process-didnt-exit-successfully/58469602#58469602", "title": "Rust compiling error: process didn&#39;t exit successfully", "body": "<p>I think you are experiencing the same thing as <a href=\"https://stackoverflow.com/questions/53456457/ordinal-not-found-when-running-the-diesel-cli-tool\">&quot;Ordinal Not Found&quot; when running the Diesel CLI tool</a>. It seems like there's some kind of version conflict with the Intel drivers.</p>\n"}], "owner": {"reputation": 89, "user_id": 8302310, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0f43ecf5a823fb338c779eb36d962fc8?s=128&d=identicon&r=PG&f=1", "display_name": "mso4491", "link": "https://stackoverflow.com/users/8302310/mso4491"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1209, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1571539058, "creation_date": 1571532649, "question_id": 58469199, "link": "https://stackoverflow.com/questions/58469199/rust-compiling-error-process-didnt-exit-successfully", "title": "Rust compiling error: process didn&#39;t exit successfully", "body": "<p>Recently, I have not been able to do <code>cargo run</code> in Rust. The error I get is\n<code>error: process didn't exit successfully: target\\debug\\backend.exe (exit code: 0xc0000138, STATUS_ORDINAL_NOT_FOUND)</code></p>\n\n<p>It happens after the compiler seems to finish saying\n<code>Finished dev [unoptimized + debuginfo] target(s) in 2m 43s\n     Running target\\debug\\backend.exe</code></p>\n\n<p>I have tried running <code>cargo clean</code> and the running <code>cargo run</code>, but I get the same error. <code>cargo fix</code> doesn't seem to help either.</p>\n"}, {"tags": ["rust", "borrow-checker"], "answers": [{"comments": [{"owner": {"reputation": 14204, "user_id": 732016, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d2eb40aff994d83e1d271a3543efb22?s=128&d=identicon&r=PG", "display_name": "wchargin", "link": "https://stackoverflow.com/users/732016/wchargin"}, "edited": false, "score": 0, "creation_date": 1571550872, "post_id": 58470221, "comment_id": 103274635, "body": "Fascinating. Thanks for the reference! I\u2019ll keep around the extra runtime cost for now, then (my application isn\u2019t concurrent, so it\u2019s just runtime cost and not a correctness issue), and look into Polonius in more detail. Thank you!"}, {"owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "reply_to_user": {"reputation": 14204, "user_id": 732016, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d2eb40aff994d83e1d271a3543efb22?s=128&d=identicon&r=PG", "display_name": "wchargin", "link": "https://stackoverflow.com/users/732016/wchargin"}, "edited": false, "score": 0, "creation_date": 1571658463, "post_id": 58470221, "comment_id": 103302080, "body": "@wchargin yeah, this is not a soundness issue. rustc rejects something it shouldn&#39;t have. A bit annoying, that&#39;s all."}], "tags": [], "owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "is_accepted": true, "score": 1, "last_activity_date": 1571551333, "last_edit_date": 1571551333, "creation_date": 1571548244, "answer_id": 58470221, "question_id": 58469070, "link": "https://stackoverflow.com/questions/58469070/how-can-i-implement-a-fetch-cached-or-load-operation-in-rust/58470221#58470221", "title": "How can I implement a fetch-cached-or-load operation in Rust?", "body": "<p>Both implementations should be legal Rust code. The fact that <code>rustc</code> rejected the second one is actually a bug as tracked by <a href=\"https://github.com/rust-lang/rust/issues/58910\" rel=\"nofollow noreferrer\">issue 58910</a>.</p>\n\n<p>Let's elaborate:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn get(&amp;mut self, path: &amp;Path) -&gt; io::Result&lt;&amp;[u8]&gt; {\n    if let Some(x) = self.files.get(path) { // ---+ x\n        println!(\"Cached\");                    // |\n        return Ok(x);                          // |\n    }                                          // |\n    let buf = self.load(path)?;                // |\n    Ok(self.files.entry(path.to_owned())       // |\n        .or_insert(buf))                       // |\n}                                              // v\n</code></pre>\n\n<p>By binding to variable <code>x</code> in let some expression, <code>self.files</code> is borrowed as immutable. The same <code>x</code> is later returned out to the caller, which implies <code>self.files</code> remains borrowed until some point in the caller. So in current Rust borrow checker implementation, <code>self.files</code> is <strong>unnecessarily</strong> kept being borrowed the whole <code>get</code> function. It can't be borrowed again later on as mutable. The fact that <code>x</code> is never used after the early return is not taken into consideration.</p>\n\n<p>Your first implementation works as a workaround to this. Since <code>let some(_) = ...</code> doesn't create any binding, it doesn't have the same problem. It does incur additional runtime cost though due to multiple lookups.</p>\n\n<p>This is the <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/2094-nll.md#problem-case-3-conditional-control-flow-across-functions\" rel=\"nofollow noreferrer\">problem case #3</a> described in Niko's NLL RFC. Good news is:</p>\n\n<blockquote>\n  <p>TL;DR: Polonius is supposed to fix this.</p>\n</blockquote>\n\n<p>(<a href=\"https://github.com/rust-lang/polonius\" rel=\"nofollow noreferrer\">Polonius</a> is the more sophisticated 3rd incarnation of Rust borrow checker which is still in developement).</p>\n"}], "owner": {"reputation": 14204, "user_id": 732016, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d2eb40aff994d83e1d271a3543efb22?s=128&d=identicon&r=PG", "display_name": "wchargin", "link": "https://stackoverflow.com/users/732016/wchargin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 58470221, "answer_count": 1, "score": 0, "last_activity_date": 1571551333, "creation_date": 1571530939, "question_id": 58469070, "link": "https://stackoverflow.com/questions/58469070/how-can-i-implement-a-fetch-cached-or-load-operation-in-rust", "title": "How can I implement a fetch-cached-or-load operation in Rust?", "body": "<p>I\u2019m trying to create a simple cache that has one operation: \u201cget from\ncache, loading if necessary\u201d. Here\u2019s a <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=5ac3dc50c17f3ea7763051f9a12df55c\" rel=\"nofollow noreferrer\">working example</a> (just\nusing file loading for simplicity):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::collections::HashMap;\nuse std::fs::File;\nuse std::io;\nuse std::path::{Path, PathBuf};\n\n#[derive(Debug, Default)]\npub struct FileCache {\n    /// Map storing contents of loaded files.\n    files: HashMap&lt;PathBuf, Vec&lt;u8&gt;&gt;,\n}\n\nimpl FileCache {\n    /// Get a file's contents, loading it if it hasn't yet been loaded.\n    pub fn get(&amp;mut self, path: &amp;Path) -&gt; io::Result&lt;&amp;[u8]&gt; {\n        if let Some(_) = self.files.get(path) {\n            println!(\"Cached\");\n            return Ok(self.files.get(path).expect(\"just checked\"));\n        }\n        let buf = self.load(path)?;\n        Ok(self.files.entry(path.to_owned()).or_insert(buf))\n    }\n    /// Load a file, returning its contents.\n    fn load(&amp;self, path: &amp;Path) -&gt; io::Result&lt;Vec&lt;u8&gt;&gt; {\n        println!(\"Loading\");\n        let mut buf = Vec::new();\n        use std::io::Read;\n        File::open(path)?.read_to_end(&amp;mut buf)?;\n        Ok(buf)\n    }\n}\n\npub fn main() -&gt; io::Result&lt;()&gt; {\n    let mut store = FileCache::default();\n    let path = Path::new(\"src/main.rs\");\n    println!(\"Length: {}\", store.get(path)?.len());\n    println!(\"Length: {}\", store.get(path)?.len());\n    Ok(())\n}\n</code></pre>\n\n<p>The success branch of the <code>if let</code> has an extra call to <code>self.files.get</code>\nand an extra <code>expect</code>. We just called that and pattern-matched on its\nresult, so we should like to just return the match:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>    pub fn get(&amp;mut self, path: &amp;Path) -&gt; io::Result&lt;&amp;[u8]&gt; {\n        if let Some(x) = self.files.get(path) {\n            println!(\"Cached\");\n            return Ok(x);\n        }\n        let buf = self.load(path)?;\n        Ok(self.files.entry(path.to_owned()).or_insert(buf))\n    }\n</code></pre>\n\n<p>But this <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=0eedc8bb5241900902567f861773cd04\" rel=\"nofollow noreferrer\">fails the borrow checker</a>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0502]: cannot borrow `self.files` as mutable because it is also borrowed as immutable\n  --&gt; src/main.rs:20:12\n   |\n14 |     pub fn get(&amp;mut self, path: &amp;Path) -&gt; io::Result&lt;&amp;[u8]&gt; {\n   |                - let's call the lifetime of this reference `'1`\n15 |         if let Some(x) = self.files.get(path) {\n   |                          ---------- immutable borrow occurs here\n16 |             println!(\"Cached\");\n17 |             return Ok(x);\n   |                    ----- returning this value requires that `self.files` is borrowed for `'1`\n...\n20 |         Ok(self.files.entry(path.to_owned()).or_insert(buf))\n   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ mutable borrow occurs here\n</code></pre>\n\n<p>I don\u2019t understand why these two versions behave differently. Isn\u2019t\n<code>self.files</code> borrowed for <code>&amp;self</code> lifetime in both cases? In the first\nform, we drop the borrow and obtain a new one, but I don\u2019t see why that\nshould make a difference. How does the second form enable me to violate\nmemory safety, and how can I write this code without the extra lookup\nand <code>expect</code> check?</p>\n\n<p>I\u2019ve read <a href=\"https://stackoverflow.com/q/55859983\">How do I write a rust function that can both read and write to a cache?</a>, which is related, but\nthe answers there either duplicate the lookup (as in my working example)\nor clone the value (prohibitively expensive), so aren\u2019t sufficient.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1571560053, "post_id": 58467659, "comment_id": 103275987, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/35869078/if-bufreader-takes-ownership-of-a-stream-how-can-i-read-and-write-lines-on-it\">If BufReader takes ownership of a stream, how can I read and write lines on it?</a>"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1571560530, "post_id": 58467659, "comment_id": 103276056, "body": "You probably want something like that <a href=\"https://doc.rust-lang.org/nightly/std/pin/index.html#example-self-referential-struct\" rel=\"nofollow noreferrer\">doc.rust-lang.org/nightly/std/pin/&hellip;</a>, I don&#39;t know, if it&#39;s a good thing to do. I advise you to use something like <a href=\"https://docs.rs/bufstream/0.1.4/bufstream/\" rel=\"nofollow noreferrer\">docs.rs/bufstream/0.1.4/bufstream</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571673644, "post_id": 58467659, "comment_id": 103310313, "body": "The code you&#39;ve posted is not valid Rust syntax."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571673691, "post_id": 58467659, "comment_id": 103310350, "body": "It&#39;s hard to answer your question because it doesn&#39;t include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. We can&#39;t tell what crates (and their versions), types, traits, fields, etc. are present in the code. It would make it easier for us to help you if you try to reproduce your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> if possible, otherwise in a brand new Cargo project, then <a href=\"https://stackoverflow.com/posts/58467659/edit\">edit</a> your question to include the additional info. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MRE tips</a> you can use to reduce your original code for posting here. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 615, "user_id": 6552577, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-f4beEqcNq_s/AAAAAAAAAAI/AAAAAAAAAv4/TUMNBquywhA/photo.jpg?sz=128", "display_name": "uben", "link": "https://stackoverflow.com/users/6552577/uben"}, "is_accepted": false, "score": -1, "last_activity_date": 1571682863, "last_edit_date": 1571682863, "creation_date": 1571614055, "answer_id": 58478122, "question_id": 58467659, "link": "https://stackoverflow.com/questions/58467659/how-to-store-tcpstream-with-bufreader-and-bufwriter-in-a-data-structure/58478122#58478122", "title": "How to store TcpStream with BufReader and BufWriter in a data structure", "body": "<h2>No. This implementation is not safe. For two reasons.</h2>\n\n<h3>1) A reference to the <code>TcpStream</code> can live longer than the structure itself</h3>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let bad_ref = {\n    let buffer = BufTcpStream::new(...);\n    let (i, o) = buffer.reach();\n    *i.get_ref()\n};// &lt;-- buffer is dropped here\n// bad_ref is now an invalid ref but the compiler won't see it\nbad_ref.write(b\"hello world\").unwrap();\n</code></pre>\n\n<p>The <code>*i.get_ref()</code> is of type <code>&amp;'a TcpStream</code>, but the <code>&amp;'a</code> lifetime is never inferred by the compiler, so it does not take it in account.</p>\n\n<p><strong>It can be fixed in the <code>reach()</code> method, by linking the lifetime of <code>self</code> to the returned references:</strong></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn reach&lt;'b&gt;(&amp;'b mut self) -&gt; (\n    &amp;mut BufReader&lt;&amp;'b TcpStream&gt;,\n    &amp;mut BufWriter&lt;&amp;'b TcpStream&gt;\n) {\n    (&amp;mut self.input, &amp;mut self.output)\n}\n</code></pre>\n\n<p><br></p>\n\n<h3>2) The <code>TcpStream</code> is dropped before <code>BufReader</code> and <code>BufWriter</code></h3>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct BufTcpStream&lt;'a&gt; {\n    _socket: Pin&lt;Box&lt;TcpStream&gt;&gt;,//       First to be dropped   |\n    input : BufReader&lt;&amp;'a TcpStream&gt;,//   Second to be dropped  |\n    output: BufWriter&lt;&amp;'a TcpStream&gt;,//   Last to be dropped    V\n}\n</code></pre>\n\n<p><strong>It can be fixed by placing <code>_socket</code> as the last element:</strong></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct BufTcpStream&lt;'a&gt; {\n    input : BufReader&lt;&amp;'a TcpStream&gt;,//   First to be dropped   |\n    output: BufWriter&lt;&amp;'a TcpStream&gt;,//   Second to be dropped  |\n    _socket: Pin&lt;Box&lt;TcpStream&gt;&gt;,//       Last to be dropped    V\n}\n</code></pre>\n\n<p><br>\n<br>\n<br>\nActually, the <code>'a</code> lifetime in <code>struct BufTcpStream&lt;'a&gt;</code> is useless.\nLifetime of the unsafe references can be set to <code>'static</code>.</p>\n\n<h2>Here is the fixed implementation:</h2>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::io::{BufReader, BufWriter};\nuse std::net::TcpStream;\nuse std::pin::Pin;\n\npub struct BufTcpStream {\n    input : BufReader&lt;&amp;'static TcpStream&gt;,\n    output: BufWriter&lt;&amp;'static TcpStream&gt;,\n    _socket: Pin&lt;Box&lt;TcpStream&gt;&gt;,\n}\n\nimpl BufTcpStream {\n    pub fn new(socket: TcpStream) -&gt; Self {\n        let pin = Box::pin(socket);\n        unsafe {\n            Self{\n                input : BufReader::new(std::mem::transmute(&amp;*pin)),\n                output: BufWriter::new(std::mem::transmute(&amp;*pin)),\n                _socket: pin,\n            }\n        }\n    }\n    pub fn reach&lt;'b&gt;(&amp;'b mut self) -&gt; (\n        &amp;mut BufReader&lt;&amp;'b TcpStream&gt;,\n        &amp;mut BufWriter&lt;&amp;'b TcpStream&gt;\n    ) {\n        unsafe {\n            std::mem::transmute((&amp;mut self.input, &amp;mut self.output))\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 457352, "user_id": 87234, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/FkjBe.png?s=128&g=1", "display_name": "GManNickG", "link": "https://stackoverflow.com/users/87234/gmannickg"}, "edited": false, "score": 0, "creation_date": 1615787135, "post_id": 58491889, "comment_id": 117789623, "body": "In case it&#39;s helpful for a future reader: in tokio&#39;s <code>TcpStream</code> there is <code>split</code> (or, <code>into_split</code>) to accomplish the same end goal. You can pass each returned half into a <code>BufReader</code> or <code>BufWriter</code>, respectively."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 3, "last_activity_date": 1571682104, "last_edit_date": 1571682104, "creation_date": 1571681043, "answer_id": 58491889, "question_id": 58467659, "link": "https://stackoverflow.com/questions/58467659/how-to-store-tcpstream-with-bufreader-and-bufwriter-in-a-data-structure/58491889#58491889", "title": "How to store TcpStream with BufReader and BufWriter in a data structure", "body": "<p>Use <a href=\"https://doc.rust-lang.org/std/net/struct.TcpStream.html#method.try_clone\" rel=\"nofollow noreferrer\"><code>TcpStream::try_clone</code></a> to get a second stream:</p>\n\n<blockquote>\n  <p>The returned <code>TcpStream</code> is a reference to the same stream that this object references. <strong>Both handles will read and write the same stream of data</strong>, and options set on one stream will be propagated to the other stream.</p>\n</blockquote>\n\n<p>You can then wrap one in a reader and one in a writer:</p>\n\n<pre><code>use std::{\n    io::{self, BufReader, BufWriter},\n    net::TcpStream,\n};\n\nstruct BufTcpStream {\n    input: BufReader&lt;TcpStream&gt;,\n    output: BufWriter&lt;TcpStream&gt;,\n}\n\nimpl BufTcpStream {\n    fn new(stream: TcpStream) -&gt; io::Result&lt;Self&gt; {\n        let input = BufReader::new(stream.try_clone()?);\n        let output = BufWriter::new(stream);\n\n        Ok(Self { input, output })\n    }\n}\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/35969943/155423\">How to read and write to a TCPStream simultaneously?</a></li>\n<li><a href=\"https://stackoverflow.com/q/26621746/155423\">How do I handle parallel reads and writes on a TcpStream?</a></li>\n</ul>\n"}], "owner": {"reputation": 615, "user_id": 6552577, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-f4beEqcNq_s/AAAAAAAAAAI/AAAAAAAAAv4/TUMNBquywhA/photo.jpg?sz=128", "display_name": "uben", "link": "https://stackoverflow.com/users/6552577/uben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1425, "favorite_count": 0, "accepted_answer_id": 58491889, "answer_count": 2, "score": 3, "last_activity_date": 1571682863, "creation_date": 1571516412, "last_edit_date": 1571682408, "question_id": 58467659, "link": "https://stackoverflow.com/questions/58467659/how-to-store-tcpstream-with-bufreader-and-bufwriter-in-a-data-structure", "title": "How to store TcpStream with BufReader and BufWriter in a data structure", "body": "<p>I wanted a <code>TcpStream</code> shared by both a <code>BufReader</code> and a <code>BufWriter</code>, I found a solution in:<br>\n<a href=\"https://stackoverflow.com/questions/35869078/if-bufreader-takes-ownership-of-a-stream-how-can-i-read-and-write-lines-on-it\">If BufReader takes ownership of a stream, how can I read and write lines on it?</a></p>\n\n<p>Now I want it in its own data structure, but I only got a partial answer from:<br> \n<a href=\"https://stackoverflow.com/questions/32300132/why-cant-i-store-a-value-and-a-reference-to-that-value-in-the-same-struct\">Why can&#39;t I store a value and a reference to that value in the same struct?</a></p>\n\n<h2>The desired implementation is violating ownership rules.</h2>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::io::{BufReader, BufWriter};\nuse std::net::TcpStream;\n\npub struct BufTcpStream&lt;'a&gt; {\n    _socket: TcpStream,\n    input:  BufReader&lt;&amp;'a TcpStream&gt;;\n    output: BufWriter&lt;&amp;'a TcpStream&gt;;\n}\n\nimpl&lt;'a&gt; BufTcpStream&lt;'a&gt; {\n    pub fn new(socket: TcpStream) -&gt; Self {\n        Self{\n            input : BufReader::new(&amp;socket),\n            output: BufWriter::new(&amp;socket),\n            _socket: socket,//                 &lt;-- MOVE OF BORROWED VALUE HERE\n        }\n    }\n}\n</code></pre>\n\n<p>To solve this problem, I had to ensure the <code>TcpStream</code> references will stay valid during all the structure lifetime, I used a <code>Pin&lt;Box&lt;TcpStream&gt;&gt;</code> to ensure it.</p>\n\n<p>But the compiler still complain about the move of the borrowed value <code>socket</code>. To remove this barrier I used <code>std::meme::transmute()</code>.</p>\n\n<p>Now, what i want to know is:</p>\n\n<h2>Is this implementation safe?</h2>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::io::{BufReader, BufWriter};\nuse std::net::TcpStream;\nuse std::pin::Pin;\n\npub struct BufTcpStream&lt;'a&gt; {\n    _socket: Pin&lt;Box&lt;TcpStream&gt;&gt;,\n    input : BufReader&lt;&amp;'a TcpStream&gt;,\n    output: BufWriter&lt;&amp;'a TcpStream&gt;,\n}\n\nimpl&lt;'a&gt; BufTcpStream&lt;'a&gt; {\n    pub fn new(socket: TcpStream) -&gt; Self {\n        let pin = Box::pin(socket);\n        unsafe {\n            Self{\n                input : BufReader::new(std::mem::transmute(&amp;*pin)),\n                output: BufWriter::new(std::mem::transmute(&amp;*pin)),\n                _socket: pin,\n            }\n        }\n    }\n    pub fn reach(&amp;mut self) -&gt; (\n        &amp;mut BufReader&lt;&amp;'a TcpStream&gt;,\n        &amp;mut BufWriter&lt;&amp;'a TcpStream&gt;\n    ) {\n        (&amp;mut self.input, &amp;mut self.output)\n    }\n}\n</code></pre>\n"}, {"tags": ["enums", "rust"], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 2151145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9BYKI.jpg?s=128&g=1", "display_name": "Ivan", "link": "https://stackoverflow.com/users/2151145/ivan"}, "edited": false, "score": 0, "creation_date": 1571516158, "post_id": 58467592, "comment_id": 103269756, "body": "Is it possible to do this without allocating a vector for a single element? Maybe somehow turning it into iterator?"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 119, "user_id": 2151145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9BYKI.jpg?s=128&g=1", "display_name": "Ivan", "link": "https://stackoverflow.com/users/2151145/ivan"}, "edited": false, "score": 1, "creation_date": 1571516197, "post_id": 58467592, "comment_id": 103269763, "body": "Please see the latest version of the answer."}, {"owner": {"reputation": 119, "user_id": 2151145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9BYKI.jpg?s=128&g=1", "display_name": "Ivan", "link": "https://stackoverflow.com/users/2151145/ivan"}, "edited": false, "score": 0, "creation_date": 1571516352, "post_id": 58467592, "comment_id": 103269799, "body": "The <code>either</code> solution looks just like what I need. Is there a similar solution for a <code>match</code> clause (in the case of more than 2 branches) ?"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 119, "user_id": 2151145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9BYKI.jpg?s=128&g=1", "display_name": "Ivan", "link": "https://stackoverflow.com/users/2151145/ivan"}, "edited": false, "score": 1, "creation_date": 1571516560, "post_id": 58467592, "comment_id": 103269841, "body": "@Ivan I&#39;m not aware of one. You can search for one yourself, but it&#39;s probably better to write your own enum in that case \u2013 it will probably make your code more readable. That said, it&#39;s unlikely the additional allocation matters \u2013 it hardly ever does, so please consider that solution as well."}], "tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 2, "last_activity_date": 1571516168, "last_edit_date": 1571516168, "creation_date": 1571515928, "answer_id": 58467592, "question_id": 58467511, "link": "https://stackoverflow.com/questions/58467511/how-do-i-process-single-elements-inside-a-flat-map/58467592#58467592", "title": "How do I process single elements inside a flat_map?", "body": "<p>The obvious solution is to use a vector in both cases:</p>\n\n<pre><code>my_vec\n    .iter()\n    .flat_map(|_| {\n        if condition {\n            vec![Enum::Ident(\"id\".to_string())].into_iter()\n        } else {\n            vec![Enum::Val(1), Enum::Val(2)].into_iter()\n        }\n    })\n    .collect::&lt;Vec&lt;Enum&gt;&gt;();\n</code></pre>\n\n<p>This will cause an additional allocation for the one-element vector, but it is a simple and readable solution. If you want to avoid this overhead, one option is to use the <code>either</code> crate:</p>\n\n<pre><code>use either::{Left, Right};\n\nenum Enum {\n    Ident(String),\n    Val(i32),\n}\n\nfn main() {\n    let my_vec = vec![1, 2, 3];\n    let _ = my_vec\n        .iter()\n        .flat_map(|&amp;x| {\n            if x &gt; 1 {\n                Left(std::iter::once(Enum::Ident(\"id\".to_string())))\n            } else {\n                Right(vec![Enum::Val(1), Enum::Val(2)].into_iter())\n            }\n        })\n        .collect::&lt;Vec&lt;Enum&gt;&gt;();\n}\n</code></pre>\n\n<p>The crate defines a generic enum <code>Either</code> with the variants <code>Left</code> and <code>Right</code>. If the types of both side support iteration, the enum also supports iterations by dispatching to the respective underlying iterator types.</p>\n"}], "owner": {"reputation": 119, "user_id": 2151145, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9BYKI.jpg?s=128&g=1", "display_name": "Ivan", "link": "https://stackoverflow.com/users/2151145/ivan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "closed_date": 1596049742, "accepted_answer_id": 58467592, "answer_count": 1, "score": 1, "last_activity_date": 1596049708, "creation_date": 1571515153, "last_edit_date": 1596049708, "question_id": 58467511, "link": "https://stackoverflow.com/questions/58467511/how-do-i-process-single-elements-inside-a-flat-map", "closed_reason": "Duplicate", "title": "How do I process single elements inside a flat_map?", "body": "<p>Is it possible to handle different numbers of elements inside a <code>flat_map</code> in Rust?</p>\n<p>I have a case where based on a condition I need to either map a single <code>enum</code> element or a vector of <code>enum</code> elements.</p>\n<p>I tried to use <code>std::iter::once</code> but it's not working since <code>once</code> and <code>Vec::iter</code> are different types the could not be returned from the same <code>if</code> condition.</p>\n<pre class=\"lang-rust prettyprint-override\"><code>enum Enum {\n    Ident(String),\n    Val(i32),\n}\n\nfn main() {\n    let my_vec = vec![1, 2, 3];\n    let condition = true; // Any condition\n\n    my_vec\n        .iter()\n        .flat_map(|x| {\n            if condition {\n                std::iter::once(Enum::Ident(&quot;id&quot;.to_string())).into_iter() /* single Enum element */\n            } else {\n                vec![Enum::Val(1), Enum::Val(2)].iter() /* vector of Enum elements */\n            }\n        })\n        .collect::&lt;Vec&lt;Enum&gt;&gt;()\n}\n</code></pre>\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: `if` and `else` have incompatible types\n  --&gt; src/main.rs:16:17\n   |\n13 | /             if condition {\n14 | |                 std::iter::once(Enum::Ident(&quot;id&quot;.to_string())).into_iter() /* single Enum element */\n   | |                 ---------------------------------------------------------- expected because of this\n15 | |             } else {\n16 | |                 vec![Enum::Val(1), Enum::Val(2)].iter() /* vector of Enum elements */\n   | |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected struct `std::iter::Once`, found struct `std::slice::Iter`\n17 | |             }\n   | |_____________- `if` and `else` have incompatible types\n   |\n   = note: expected type `std::iter::Once&lt;Enum&gt;`\n            found struct `std::slice::Iter&lt;'_, Enum&gt;`\n</code></pre>\n"}, {"tags": ["rust", "iterator", "predicate", "type-signature"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1571501526, "post_id": 58465458, "comment_id": 103265903, "body": "so you can have a state in your closure. FnMut mean it&#39;s allowed to mutate its state <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=3fcda31e3bbe2fa974adaf92cd8d323b\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>. as doc said &quot;Use FnMut as a bound when you want to accept a parameter of function-like type and need to call it repeatedly, while allowing it to mutate state. If you don&#39;t want the parameter to mutate state, use Fn as a bound; if you don&#39;t need to call it repeatedly, use FnOnce.&quot; <a href=\"https://doc.rust-lang.org/std/ops/trait.FnMut.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/std/ops/trait.FnMut.html</a>"}], "answers": [{"comments": [{"owner": {"reputation": 63855, "user_id": 124486, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/605442f85418d858e2ce1e1aea2092bb?s=128&d=identicon&r=PG", "display_name": "Evan Carroll", "link": "https://stackoverflow.com/users/124486/evan-carroll"}, "edited": false, "score": 0, "creation_date": 1571502546, "post_id": 58465588, "comment_id": 103266194, "body": "I guess that makes sense. I&#39;ve never seen &quot;predicate&quot; refer to anything that had state. I guess it&#39;s just a definition but <a href=\"https://stackoverflow.com/questions/1344015/what-is-a-predicate\">it seems like a &quot;predicate&quot; here is any call back that returns a boolean, which seems to be the definition (according to stackoverflow)</a> I wonder if <code>scan</code> is ever needed? Could you write something about how a predicate w/ state ties into scan?"}], "tags": [], "owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "is_accepted": false, "score": 3, "last_activity_date": 1571501716, "creation_date": 1571501716, "answer_id": 58465588, "question_id": 58465458, "link": "https://stackoverflow.com/questions/58465458/why-are-predicates-for-rust-iterators-fnmut-and-not-fn/58465588#58465588", "title": "Why are predicates for Rust iterator&#39;s FnMut and not Fn?", "body": "<p>The <code>Mut</code> in <code>FnMut</code> means that the predicate can have a mutable state. It says nothing about the parameters.</p>\n\n<p>Additionaly, <code>FnMut</code> is a super-trait of <code>Fn</code>, so you can also pass an <code>Fn</code> where <code>FnMut</code> is accepted.</p>\n\n<p>As a silly example, consider this closure that stores a state (hence is <code>FnMut</code>, but not <code>Fn</code>), but cannot modify the elements in the iterator:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn main() {\n    let v = vec![1, 2, 3, 4, 0, 5, 6, 7];\n\n    println!(\"{:?}\", v.iter().skip_while(|&amp;&amp;v| v != 0).collect::&lt;Vec&lt;_&gt;&gt;());\n\n    let mut state = false;\n    let one_after_zero = |&amp;&amp;v: &amp;&amp;u32| {\n        if state {\n            false\n        } else if v == 0 {\n            state = true;\n            true\n        } else {\n            true\n        }\n    };\n\n    println!(\"{:?}\", v.iter().skip_while(one_after_zero).collect::&lt;Vec&lt;_&gt;&gt;());\n}\n</code></pre>\n\n<p>(<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=7a0745b5f17a4b62fc7ccae387932faf\" rel=\"nofollow noreferrer\">Permalink to the playground</a>)</p>\n\n<p>Output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[0, 5, 6, 7]\n[5, 6, 7]\n</code></pre>\n"}], "owner": {"reputation": 63855, "user_id": 124486, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/605442f85418d858e2ce1e1aea2092bb?s=128&d=identicon&r=PG", "display_name": "Evan Carroll", "link": "https://stackoverflow.com/users/124486/evan-carroll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1571501716, "creation_date": 1571500736, "question_id": 58465458, "link": "https://stackoverflow.com/questions/58465458/why-are-predicates-for-rust-iterators-fnmut-and-not-fn", "title": "Why are predicates for Rust iterator&#39;s FnMut and not Fn?", "body": "<p>Looking at the predicates like <code>skip_while</code> and <code>take_while</code> they're</p>\n\n<pre><code>skip_while&lt;P&gt;(self, predicate P) -&gt; ...\n  where Self: Sized, P: FnMut(&amp;Self::Item) -&gt; bool;\n</code></pre>\n\n<p>If a predicate is just returning true or false, and not modifying the values, why does it have to be <code>FnMut</code> and not <code>Fn</code> (like <code>Fn(&amp;Self::Item) -&gt; bool</code>)?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1571491655, "post_id": 58464094, "comment_id": 103263568, "body": "Per the duplicate: <code>Some(digit @ &#39;0&#39;) | Some(digit @ &#39;1&#39;)</code>  (and so on)"}], "answers": [{"comments": [{"owner": {"reputation": 15544, "user_id": 864393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59ae69e09086fed821a36d36814022c2?s=128&d=identicon&r=PG", "display_name": "Jeremy Roman", "link": "https://stackoverflow.com/users/864393/jeremy-roman"}, "edited": false, "score": 0, "creation_date": 1571491741, "post_id": 58464135, "comment_id": 103263591, "body": "You could make this shorter by using <a href=\"https://doc.rust-lang.org/std/primitive.char.html#method.is_digit\" rel=\"nofollow noreferrer\">is_digit</a>:  <code>Some(c) if c.is_digit(10) =&gt; { ... }</code>"}], "tags": [], "owner": {"reputation": 2849, "user_id": 1431255, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6ac58ecb70f5b8dc7a3e2801d4750a8a?s=128&d=identicon&r=PG", "display_name": "wirrbel", "link": "https://stackoverflow.com/users/1431255/wirrbel"}, "is_accepted": false, "score": 0, "last_activity_date": 1571493001, "last_edit_date": 1571493001, "creation_date": 1571491380, "answer_id": 58464135, "question_id": 58464094, "link": "https://stackoverflow.com/questions/58464094/rust-match-pattern-bind-literal-value-for-specific-cases/58464135#58464135", "title": "Rust Match pattern: Bind literal value for specific cases", "body": "<p>I came up with this</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>match it.peek() {\n    Some(c)\n        if *c == '0'\n            || *c == '1'\n            || *c == '2'\n            || *c == '3'\n            || *c == '4'\n            || *c == '5'\n            || *c == '6'\n            || *c == '7'\n            || *c == '8'\n            || *c == '9' =&gt; {}\n}\n</code></pre>\n\n<p>which seems to do the trick. Still interested in better ways</p>\n"}, {"tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 3, "last_activity_date": 1571491506, "creation_date": 1571491506, "answer_id": 58464151, "question_id": 58464094, "link": "https://stackoverflow.com/questions/58464094/rust-match-pattern-bind-literal-value-for-specific-cases/58464151#58464151", "title": "Rust Match pattern: Bind literal value for specific cases", "body": "<p>You can use a conditional matching with <code>char::is_digit</code>:</p>\n\n<pre><code>fn main() {\n    let c = Some('2');\n    match c {\n        Some(c) if c.is_digit(10) =&gt; println!(\"Found a digit: {}\", c),\n        _ =&gt; println!(\"Found another thing\"),\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2849, "user_id": 1431255, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6ac58ecb70f5b8dc7a3e2801d4750a8a?s=128&d=identicon&r=PG", "display_name": "wirrbel", "link": "https://stackoverflow.com/users/1431255/wirrbel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "closed_date": 1571558140, "accepted_answer_id": 58464151, "answer_count": 2, "score": 0, "last_activity_date": 1571493001, "creation_date": 1571491092, "question_id": 58464094, "link": "https://stackoverflow.com/questions/58464094/rust-match-pattern-bind-literal-value-for-specific-cases", "closed_reason": "Duplicate", "title": "Rust Match pattern: Bind literal value for specific cases", "body": "<p>I do have the following match statement</p>\n\n<pre><code>match it.peek() {\n     Some('0') | Some('1') | Some('2') | Some('3')\n   | Some('4') | Some('5') | Some('6') | Some('7')\n   | Some('8') | Some('9') =&gt; { list.push(...) }\n     _ =&gt; {...}\n}\n</code></pre>\n\n<p>Now I would like to write a simply get the element in the <code>Some</code> cases, I'm certain this will not work but you'll get the idea from it:</p>\n\n<pre><code>match it.peek() {\n     Some('0' as digit) | Some('1' as digit) | Some('2' as digit) | Some('3' as digit)\n   | Some('4' as digit) | Some('5' as digit) | Some('6' as digit) | Some('7'  as digit)\n   | Some('8' as digit) | Some('9' as digit) =&gt; { list.push(digit) }\n     _ =&gt; {...}\n}\n</code></pre>\n\n<p>Is this possible? I know I can nest a second match the unpacks the character from the digit, but then I need to implement the <code>_</code> case twice, which I would like to avoid.</p>\n"}, {"tags": ["sockets", "rust", "stream", "openssl", "nonblocking"], "comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 1, "creation_date": 1571483171, "post_id": 58463007, "comment_id": 103261622, "body": "<a href=\"https://stackoverflow.com/questions/tagged/asynchronous\">asynchronous</a> and <a href=\"https://stackoverflow.com/questions/tagged/nonblocking\">nonblocking</a> aren&#39;t the same thing."}], "answers": [{"tags": [], "owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "is_accepted": false, "score": 1, "last_activity_date": 1571501743, "creation_date": 1571501743, "answer_id": 58465594, "question_id": 58463007, "link": "https://stackoverflow.com/questions/58463007/rust-non-blocking-openssl-stream/58465594#58465594", "title": "rust non blocking openssl stream", "body": "<p>The tokio project has <code>tokio-openssl</code> crate. You probably need to embrace the whole <code>async/await</code> machinery and use that crate to do nonblocking openssl:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>//# openssl = \"0.10.25\"\n//# tokio = \"0.2.0-alpha.6\"\n//# tokio-net = \"0.2.0-alpha.6\"\n//# tokio-openssl = \"0.4.0-alpha.6\"\nuse openssl::ssl::{SslMethod, SslConnector};\nuse tokio::net::TcpStream;\nuse tokio::prelude::*;\nuse tokio_net::driver::Handle;\nuse tokio_openssl::connect;\nuse std::error::Error;\n\n#[tokio::main]\nasync fn main() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {\n    let sslconf = SslConnector::builder(SslMethod::tls())?\n        .build()\n        .configure()?;\n    // The following 3 lines are equivalent to:\n    //     let stream = TcpStream::connect(\"google.com:443\").await?;\n    // It's just going to show that the socket is indeed nonblocking.\n    let stream = std::net::TcpStream::connect(\"google.com:443\")?;\n    stream.set_nonblocking(true)?;\n    let stream = TcpStream::from_std(stream, &amp;Handle::default())?;\n    let mut stream = connect(sslconf, \"google.com\", stream).await?;\n\n    stream.write_all(b\"GET / HTTP/1.0\\r\\n\\r\\n\").await?;\n    let mut res = vec![];\n    stream.read_to_end(&amp;mut res).await?;\n    dbg!(String::from_utf8_lossy(&amp;res));\n\n    Ok(())\n}\n</code></pre>\n\n<p>Of course this also means that for now you'll have to use beta/nightly channel. It may or may not work out for your project.</p>\n"}, {"tags": [], "owner": {"reputation": 401, "user_id": 4676706, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/693sz.jpg?s=128&g=1", "display_name": "Fi3", "link": "https://stackoverflow.com/users/4676706/fi3"}, "is_accepted": false, "score": 0, "last_activity_date": 1571739717, "creation_date": 1571739717, "answer_id": 58502119, "question_id": 58463007, "link": "https://stackoverflow.com/questions/58463007/rust-non-blocking-openssl-stream/58502119#58502119", "title": "rust non blocking openssl stream", "body": "<p>If a non blocking stream is needed but you don't want to add tokio as dependency a possible solution is:</p>\n\n<pre><code>use openssl::ssl::{SslMethod, SslConnector};\nuse std::io::{Read, Write};\nuse std::net::TcpStream;\n\nlet connector = SslConnector::builder(SslMethod::tls()).unwrap().build();\n\nlet stream = TcpStream::connect(\"google.com:443\").unwrap();\nlet mut stream = connector.connect(\"google.com\", stream).unwrap();\nlet inner_stream = stream.get_ref();\ninner_stream.set_nonblocking(true);\n</code></pre>\n"}], "owner": {"reputation": 401, "user_id": 4676706, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/693sz.jpg?s=128&g=1", "display_name": "Fi3", "link": "https://stackoverflow.com/users/4676706/fi3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1571739717, "creation_date": 1571483035, "last_edit_date": 1571483125, "question_id": 58463007, "link": "https://stackoverflow.com/questions/58463007/rust-non-blocking-openssl-stream", "title": "rust non blocking openssl stream", "body": "<p>Trying to create a non blocking ssl stream:</p>\n\n<pre><code>use openssl::ssl::{SslMethod, SslConnector};\nuse std::io::{Read, Write};\nuse std::net::TcpStream;\n\nlet connector = SslConnector::builder(SslMethod::tls()).unwrap().build();\n\nlet stream = TcpStream::connect(\"google.com:443\").unwrap();\nstream.set_nonblocking(true);\nlet mut stream = connector.connect(\"google.com\", stream).unwrap();\n</code></pre>\n\n<p>But I got this error:</p>\n\n<pre><code>thread '&lt;unnamed&gt;' panicked at 'called `Result::unwrap()` on an `Err` value:WouldBlock(MidHandshakeSslStream { stream: SslStream { stream: TcpStream { addr:V4(10.137.0.17:55628), peer: V4(172.217.21.78:443), fd: 3 }, ssl: Ssl { state: \"SSLv3/TLSwrite client hello\", verify_result: X509VerifyResult { code: 0, error: \"ok\" } } }, error: Error { code: ErrorCode(2), cause: Some(Io(Os { code: 11, kind: WouldBlock, message: \"Resource temporarily unavailable\" })) } })', src/libcore/result.rs:1051:5 \n</code></pre>\n\n<p>How can I create a non blocking ssl stream?</p>\n"}, {"tags": ["rust", "async-await", "reqwest"], "answers": [{"tags": [], "owner": {"reputation": 2058, "user_id": 3958875, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f6149ddd4636bcab17c52b751d79f7fd?s=128&d=identicon&r=PG&f=1", "display_name": "Prime_Aqasix", "link": "https://stackoverflow.com/users/3958875/prime-aqasix"}, "is_accepted": false, "score": 0, "last_activity_date": 1571887399, "creation_date": 1571887399, "answer_id": 58533692, "question_id": 58460837, "link": "https://stackoverflow.com/questions/58460837/fastest-way-to-send-many-groups-of-http-requests-using-new-async-await-syntax-an/58533692#58533692", "title": "Fastest way to send many groups of HTTP requests using new async/await syntax and control the amount of workers", "body": "<p>Not sure if this is the fastest way, as I am just experimenting myself, but here is my solution:</p>\n\n<pre><code>let client = reqwest::Client::new();\n\nlet links = vec![ // A vec of strings representing links\n    \"example.net/a\".to_owned(), \n    \"example.net/b\".to_owned(),\n    \"example.net/c\".to_owned(),\n    \"example.net/d\".to_owned(),\n    ];\n\nlet ref_client = &amp;client; // Need this to prevent client from being moved into the first map\nfutures::stream::iter(links)\n    .map(async move |link: String| {\n        let res = ref_client.get(&amp;link).send().await;\n\n        // res.map(|res| res.text().await.unwrap().to_vec())\n        match res { // This is where I would usually use `map`, but not sure how to await for a future inside a result \n            Ok(res) =&gt; Ok(res.text().await.unwrap()),\n            Err(err) =&gt; Err(err), \n        }\n    })\n    .buffer_unordered(10) // Number of connection at the same time\n    .filter_map(|c| future::ready(c.ok())) // Throw errors out, do your own error handling here\n    .filter_map(|item| {\n        if item.contains(\"abc\") {\n            future::ready(Some(item))\n        } else {\n            future::ready(None)\n        }\n    })\n    .map(async move |sec_link| {\n        let res = ref_client.get(&amp;sec_link).send().await;\n        match res {\n            Ok(res) =&gt; Ok(res.text().await.unwrap()),\n            Err(err) =&gt; Err(err),\n        }\n    })\n    .buffer_unordered(10) // Number of connections for the secondary requests (so max 20 connections concurrently)\n    .filter_map(|c| future::ready(c.ok()))\n    .for_each(|item| {\n        println!(\"File received: {}\", item);\n        future::ready(())\n    })\n    .await;\n</code></pre>\n\n<p>This requires the <code>#![feature(async_closure)]</code> feature.</p>\n"}], "owner": {"reputation": 41, "user_id": 12192073, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mDZK8dQO3RAV64d9mFzPsymKGdk3E3K64o-UTBi=k-s128", "display_name": "PherdEye", "link": "https://stackoverflow.com/users/12192073/pherdeye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 380, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1571887399, "creation_date": 1571463590, "question_id": 58460837, "link": "https://stackoverflow.com/questions/58460837/fastest-way-to-send-many-groups-of-http-requests-using-new-async-await-syntax-an", "title": "Fastest way to send many groups of HTTP requests using new async/await syntax and control the amount of workers", "body": "<p>Most recent threads I have read are saying async is the better way to perform lots of I/O bound work such as sending HTTP requests and the like. I have tried to pick up async recently but am struggling with understanding how to send many groups of requests in parallel, for example:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let client = reqwest::Client::new();\nlet mut requests = 0;\n\nlet get = client.get(\"https://somesite.com\").send().await?;\nlet response = get.text().await?;\n\nif response.contains(\"some stuff\") {\n    let get = client.get(\"https://somesite.com/something\").send().await?;\n    let response = get.text().await?;\n\n    if response.contains(\"some new stuff\") {\n        requests += 1;\n        println!(\"Got response {}\", requests)\n</code></pre>\n\n<p>This does what I want, but how can I run it in parallel and control the amount of \"worker threads\" or whatever the equivalent is to a thread pool in async?</p>\n\n<p>I understand it is similar to <a href=\"https://stackoverflow.com/questions/51044467/how-can-i-perform-parallel-asynchronous-http-get-requests-with-reqwest\">this question</a>, but mine is strictly talking about the nightly Rust async/await syntax and a more specific use case where groups of requests/tasks need to be done. I also find using combinators for these situations a bit confusing, was hoping the newer style would help make it a bit more readable.</p>\n"}, {"tags": ["multithreading", "rust", "closures", "move-semantics", "lifetime"], "answers": [{"comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 2, "creation_date": 1571450967, "post_id": 58459786, "comment_id": 103256485, "body": "Super minor nitpick here, but you&#39;re not really &quot;circumventing&quot; anything, you&#39;re just <i>not</i> reference counting."}, {"owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571519065, "post_id": 58459786, "comment_id": 103270380, "body": "@trentcl thanks! You are of course correct. &#39;Circumvention&#39; is maybe a bit of sloppy language here. I have slightly altered the way it is written in the answer, but if you have better suggestions to make it more clear, feel free to propose one (and/or edit the answer yourself directly)"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1586879681, "post_id": 58459786, "comment_id": 108288303, "body": "<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=3fc1d15786092d676532e3b250f8c984\" rel=\"nofollow noreferrer\">Your second answer does not work</a>."}], "tags": [], "owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "is_accepted": true, "score": 11, "last_activity_date": 1586879651, "last_edit_date": 1586879651, "creation_date": 1571448456, "answer_id": 58459786, "question_id": 58459643, "link": "https://stackoverflow.com/questions/58459643/is-there-a-way-to-have-a-rust-closure-that-moves-only-some-variables-into-it/58459786#58459786", "title": "Is there a way to have a Rust closure that moves only some variables into it?", "body": "<p>Yes, it is possible to move only one or some variables into a closure (rather than all or none).</p>\n\n<p>Yes, this can be used to \"circumvent\" reference counting.</p>\n\n<p>I found an answer in the documentation of <a href=\"https://docs.rs/rayon/1.0.1/rayon/fn.scope.html#accessing-stack-data\" rel=\"noreferrer\"><code>rayon::scope</code></a> that turns out to be exactly about this problem: 'Accessing the stack data [from within a scoped threads scope]'. That page also has an example that is clearer than the pseudocode in this question.</p>\n\n<p>It turns out that you can either:</p>\n\n<ul>\n<li><p>Use a <code>move</code> closure but refer to variables in the outer scope by shadowing them with a reference, therefore capturing them by reference rather than by value, using <code>let settings = &amp;settings</code>:</p>\n\n<pre><code>crossbeam::scope(|scope| {\n    let settings = &amp;settings; // refer to outer variable by reference\n    for score in 0..MAX_FEASIBLE_SCORE {\n        scope.spawn(move |_| {\n            let work_result = do_cool_computation(settings, score);\n            println!(\"{:?}\", work_result);\n        });\n    }\n})\n.unwrap();\n</code></pre></li>\n<li><p>Use a normal closure, and only move the required variables by shadowing them inside the closure using <code>let score = score</code>:</p>\n\n<pre><code>crossbeam::scope(|scope| {\n    for score in 0..MAX_FEASIBLE_SCORE {\n        scope.spawn(|_| {\n            let score = score; // capture only score\n            let work_result = do_cool_computation(&amp;settings, score);\n            println!(\"{:?}\", work_result);\n        });\n    }\n})\n.unwrap();\n</code></pre></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 22921, "user_id": 229753, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f443a82ac96270394a6965323142601b?s=128&d=identicon&r=PG", "display_name": "Tobu", "link": "https://stackoverflow.com/users/229753/tobu"}, "is_accepted": false, "score": 4, "last_activity_date": 1588004056, "creation_date": 1588004056, "answer_id": 61463324, "question_id": 58459643, "link": "https://stackoverflow.com/questions/58459643/is-there-a-way-to-have-a-rust-closure-that-moves-only-some-variables-into-it/61463324#61463324", "title": "Is there a way to have a Rust closure that moves only some variables into it?", "body": "<p>The <a href=\"https://lib.rs/crates/closure\" rel=\"nofollow noreferrer\">closure! macro</a> gives the ability to selectively reference, move, or clone variables into a closure.</p>\n\n<p>Example taken from the docs:</p>\n\n<pre><code>use closure::closure;\n\nlet string = \"move\".to_string();\nlet x = 10;\nlet mut y = 20;\nlet rc = Rc::new(5);\n\nlet closure = closure!(move string, ref x, ref mut y, clone rc, |arg: i32| {\n    ...\n});\n</code></pre>\n\n<p>Variables that are captured but not listed default to being moved.</p>\n"}], "owner": {"reputation": 4605, "user_id": 1067339, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3479b6831ccaa6263ed5ca7dab3ba972?s=128&d=identicon&r=PG", "display_name": "Qqwy", "link": "https://stackoverflow.com/users/1067339/qqwy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2084, "favorite_count": 3, "accepted_answer_id": 58459786, "answer_count": 2, "score": 11, "last_activity_date": 1588004056, "creation_date": 1571446347, "last_edit_date": 1586879408, "question_id": 58459643, "link": "https://stackoverflow.com/questions/58459643/is-there-a-way-to-have-a-rust-closure-that-moves-only-some-variables-into-it", "title": "Is there a way to have a Rust closure that moves only some variables into it?", "body": "<p>I have  a general <code>struct</code> with settings and  an extra variable setting that I want to tune and play around with.</p>\n\n<p>For all possible values in an integer range, I want to start a (scoped) thread with this variable set to that value. Depending on this value, they do slightly different work.</p>\n\n<p>Each of these threads should be able to read the general settings struct.</p>\n\n<pre><code>use crossbeam; // 0.7.3\n\nstruct Settings {\n    // ... many fields\n}\n\nconst MAX_FEASIBLE_SCORE: u8 = 10;\n\nfn example(settings: Settings) {\n    crossbeam::scope(|scope| {\n        for score in 0..MAX_FEASIBLE_SCORE {\n            scope.spawn(|_| {\n                let work_result = do_cool_computation(&amp;settings, score);\n                println!(\"{:?}\", work_result);\n            });\n        }\n    })\n    .unwrap();\n}\n\nfn do_cool_computation(_: &amp;Settings, _: u8) {}\n</code></pre>\n\n<p>This does not compile:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0373]: closure may outlive the current function, but it borrows `score`, which is owned by the current function\n  --&gt; src/lib.rs:12:25\n   |\n10 |     crossbeam::scope(|scope| {\n   |                       ----- has type `&amp;crossbeam_utils::thread::Scope&lt;'1&gt;`\n11 |         for score in 0..MAX_FEASIBLE_SCORE {\n12 |             scope.spawn(|_| {\n   |                         ^^^ may outlive borrowed value `score`\n13 |                 let work_result = do_cool_computation(&amp;settings, score);\n   |                                                                  ----- `score` is borrowed here\n   |\nnote: function requires argument type to outlive `'1`\n  --&gt; src/lib.rs:12:13\n   |\n12 | /             scope.spawn(|_| {\n13 | |                 let work_result = do_cool_computation(&amp;settings, score);\n14 | |                 println!(\"{:?}\", work_result);\n15 | |             });\n   | |______________^\nhelp: to force the closure to take ownership of `score` (and any other referenced variables), use the `move` keyword\n   |\n12 |             scope.spawn(move |_| {\n   |                         ^^^^^^^^\n</code></pre>\n\n<p>This would invalidate <code>&amp;settings</code> since the first loop iteration will take ownership of <code>settings</code> in a <code>move</code> closure.</p>\n\n<p>The only easy ways to make it work were:</p>\n\n<ul>\n<li>copy the <code>Settings</code> struct into each thread (which in my real application is rather expensive)</li>\n<li>introduce an <code>Arc</code> around <code>settings</code>, which also feels a bit unfortunate. </li>\n</ul>\n\n<p>Is there a way that we can circumvent reference counting here? Is there a way we can move <code>score</code> into the inner closure while still being allowed to reference <code>settings</code>?</p>\n"}, {"tags": ["generics", "casting", "rust", "traits"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571430813, "post_id": 58457720, "comment_id": 103252659, "body": "Welcome to Stack Overflow! I think this might be a duplicate of <a href=\"https://stackoverflow.com/questions/41352088/simple-organization-of-rust-traits-for-polymorphic-return\">Simple organization of Rust traits for &quot;polymorphic&quot; return</a>. If you disagree, you may <a href=\"https://stackoverflow.com/posts/58457720/edit\">edit</a> your question to add more detail."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571431194, "post_id": 58457720, "comment_id": 103252781, "body": "<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=e6dcbd9c3652860b5a6f0b836da307f4\" rel=\"nofollow noreferrer\">Here is how I would use associated types to solve your problem</a>. Another question that might help is <a href=\"https://stackoverflow.com/questions/32059370/when-is-it-appropriate-to-use-an-associated-type-versus-a-generic-type\">When is it appropriate to use an associated type versus a generic type?</a>"}], "owner": {"reputation": 13, "user_id": 12172281, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2231c9a905789705ea8ac482d958f5f?s=128&d=identicon&r=PG&f=1", "display_name": "lubro", "link": "https://stackoverflow.com/users/12172281/lubro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "closed_date": 1571433149, "answer_count": 0, "score": 1, "last_activity_date": 1571433149, "creation_date": 1571430309, "last_edit_date": 1571433149, "question_id": 58457720, "link": "https://stackoverflow.com/questions/58457720/rust-return-known-type-for-generic-trait", "closed_reason": "Duplicate", "title": "Rust return known type for generic trait", "body": "<p>I am quite new to Rust and I struggle with generic types:</p>\n\n<p>I have a trait wich I want to implement for multiple types.\nThe trait contains a function with an unkown return type. </p>\n\n<p>Like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait A&lt;T&gt; {\n    fn info(&amp;self) -&gt; T;\n}\n</code></pre>\n\n<p>I want to implement the trait for two structs, the return type should be specified inside those structs.</p>\n\n<p>Like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct S1 {\n    id: i32,\n}\nstruct S2 {\n    id: String,\n}\n\nimpl A for S1 {\n    fn info(&amp;self) -&gt; i32 {\n        self.id\n    }\n}\n\nimpl A for S2 {\n    fn info(&amp;self) -&gt; String {\n        self.id\n    }\n}\n</code></pre>\n\n<p>I tried a lot of combinations for the return type but I don't find one, which is accepted by the compiler. Is this possible at all in Rust or do I have to use some kind of workaround? </p>\n\n<p>Thanks a lot for helping.</p>\n"}, {"tags": ["string", "rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571668889, "post_id": 58457403, "comment_id": 103307758, "body": "Amusingly, neither JS nor Ruby have lazy iterators by default, so your example cases make 2 intermediate arrays that just take up unneeded space and time. Your Rust example (and the answers below) do not."}, {"owner": {"reputation": 2162, "user_id": 1938727, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/adcb26992bdfcaef0657df6e08f2bc92?s=128&d=identicon&r=PG", "display_name": "starscape", "link": "https://stackoverflow.com/users/1938727/starscape"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1571775815, "post_id": 58457403, "comment_id": 103351029, "body": "@Shepmaster I know that. Performance wasn&#39;t really what I was asking about."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1571668767, "post_id": 58457879, "comment_id": 103307674, "body": "You can use the <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=34c041fbd1a4755ca2126527c6ab1af0\" rel=\"nofollow noreferrer\">iterator solution <i>and</i> reserve space</a> in the string, if profiling shows a benefit."}], "tags": [], "owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "is_accepted": true, "score": 6, "last_activity_date": 1571668649, "last_edit_date": 1571668649, "creation_date": 1571431095, "answer_id": 58457879, "question_id": 58457403, "link": "https://stackoverflow.com/questions/58457403/most-idiomatic-way-to-double-every-character-in-a-string-in-rust/58457879#58457879", "title": "Most idiomatic way to double every character in a string in Rust", "body": "<p>I would use <code>std::iter::repeat</code> to repeat every <code>char</code> value from the input. This creates an infinite iterator, but for your case we only need to iterate <strong>2 times</strong>, so we can use <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.take\" rel=\"nofollow noreferrer\"><code>take</code></a> to limit our iterator, then flatten all the iterators that hold the doubled <code>char</code>s. </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::iter;\n\nfn main() {\n    let input = \"abc\"; //\"abc\".to_string();\n\n    let output = input\n        .chars()\n        .flat_map(|c| iter::repeat(c).take(2))\n        .collect::&lt;String&gt;();\n\n    println!(\"{:?}\", output);\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=4ed93362a552e6fe54a522a01d590fa7\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p><strong>Note:</strong> To double we are using <code>take(2)</code> but you can use any <code>usize</code> to increase the repetition. </p>\n"}, {"comments": [{"owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "edited": false, "score": 3, "creation_date": 1571433308, "post_id": 58457896, "comment_id": 103253468, "body": "I would disagree with the loop being easier to understand. The iterator approach doesn\u2019t require me to run the loop in my head to validate it does what I want."}, {"owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "reply_to_user": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "edited": false, "score": 1, "creation_date": 1571433608, "post_id": 58457896, "comment_id": 103253563, "body": "@Listerone: Run the loop in your head? I have no idea what that means."}], "tags": [], "owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "is_accepted": false, "score": 2, "last_activity_date": 1571668572, "last_edit_date": 1571668572, "creation_date": 1571431183, "answer_id": 58457896, "question_id": 58457403, "link": "https://stackoverflow.com/questions/58457403/most-idiomatic-way-to-double-every-character-in-a-string-in-rust/58457896#58457896", "title": "Most idiomatic way to double every character in a string in Rust", "body": "<p>Personally, I would just do exactly what you're doing. Its intent is clear (more clear than the functional approaches you presented from JavaScript or Ruby, in my opinion) and it is efficient. The only thing I would change is perhaps reserve space for the characters, since you know exactly how much space you will need.</p>\n\n<pre><code>let mut result = String::with_capacity(original_string.len() * 2);\n</code></pre>\n\n<p>However, if you are really in love with this style, you could use <code>flat_map</code></p>\n\n<pre><code>let result: String = original_string.chars()\n    .flat_map(|c| std::iter::repeat(c).take(2))\n    .collect();\n</code></pre>\n"}], "owner": {"reputation": 2162, "user_id": 1938727, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/adcb26992bdfcaef0657df6e08f2bc92?s=128&d=identicon&r=PG", "display_name": "starscape", "link": "https://stackoverflow.com/users/1938727/starscape"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 0, "accepted_answer_id": 58457879, "answer_count": 2, "score": 2, "last_activity_date": 1571668819, "creation_date": 1571428647, "last_edit_date": 1571668819, "question_id": 58457403, "link": "https://stackoverflow.com/questions/58457403/most-idiomatic-way-to-double-every-character-in-a-string-in-rust", "title": "Most idiomatic way to double every character in a string in Rust", "body": "<p>I have a <code>String</code>, and I want to make a new <code>String</code>, with every character in the first one doubled. So <code>\"abc\"</code> would become <code>\"aabbcc\"</code> and so on.</p>\n\n<p>The best I've come up with is:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let mut result = String::new();\nfor c in original_string.chars() {\n    result.push(c);\n    result.push(c);\n}\nresult\n</code></pre>\n\n<p>This works fine. but is there a more succinct (or more idiomatic) way to do this?</p>\n\n<p>In JavaScript I would probably write something like:</p>\n\n<pre><code>original.split('').map(c =&gt; c+c).join('')\n</code></pre>\n\n<p>Or in Ruby:</p>\n\n<pre class=\"lang-rb prettyprint-override\"><code>(original.chars.map { |c| c+c }).join('')\n</code></pre>\n\n<p>Since Rust also has functional elements, I was wondering if there is a similarly succinct solution.</p>\n"}, {"tags": ["rust", "future"], "comments": [{"owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 3, "creation_date": 1571426212, "post_id": 58456204, "comment_id": 103250991, "body": "Maybe you are looking for something like <a href=\"https://docs.rs/futures-preview/0.3.0-alpha.19/futures/macro.join.html\" rel=\"nofollow noreferrer\">join!()</a> or <a href=\"https://docs.rs/futures-preview/0.3.0-alpha.19/futures/macro.select.html\" rel=\"nofollow noreferrer\">select!()</a>"}, {"owner": {"reputation": 790, "user_id": 1355121, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7fde47be1461f757f6e7bbac40c4df97?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1355121/nick"}, "reply_to_user": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 0, "creation_date": 1571428450, "post_id": 58456204, "comment_id": 103251808, "body": "Thanks for the suggestion, I looked at those but unfortunately <code>join!</code> blocks my main loop that needs to check for new work and both <code>select</code> and <code>join</code> take in a fixed number of futures rather than a map or vec so they feel a little clumsy at best to use. I will try <code>select</code> out and see if it works well."}, {"owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 0, "creation_date": 1571480706, "post_id": 58456204, "comment_id": 103261061, "body": "Futures perform work only when they are polled, so maybe you should just <code>poll()</code> them ? If the future is <i>done</i> you&#39;ll get <code>Poll::Ready</code>, otherwise - <code>Poll::Pending</code> which is the same as your <code>isDone()</code> method ecept that it returns an enum with two variants instead of true/false"}, {"owner": {"reputation": 679, "user_id": 5155574, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FX9BZpOiVdk/AAAAAAAAAAI/AAAAAAAAAI0/cHgtmpGWfgM/photo.jpg?sz=128", "display_name": "Josh Abraham", "link": "https://stackoverflow.com/users/5155574/josh-abraham"}, "edited": false, "score": 0, "creation_date": 1598833318, "post_id": 58456204, "comment_id": 112577176, "body": "@Nick, did you ever find an answer to this?"}, {"owner": {"reputation": 790, "user_id": 1355121, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7fde47be1461f757f6e7bbac40c4df97?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1355121/nick"}, "edited": false, "score": 1, "creation_date": 1600271182, "post_id": 58456204, "comment_id": 113037218, "body": "Not exactly as described but I ended up using <code>futures::future::join_all</code> (<a href=\"https://docs.rs/futures/0.3.5/futures/future/fn.join_all.html\" rel=\"nofollow noreferrer\">docs.rs/futures/0.3.5/futures/future/fn.join_all.html</a>) which can take any IntoInterator and that worked well enough for me."}, {"owner": {"reputation": 790, "user_id": 1355121, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7fde47be1461f757f6e7bbac40c4df97?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1355121/nick"}, "edited": false, "score": 0, "creation_date": 1600271351, "post_id": 58456204, "comment_id": 113037300, "body": "Actually while grabbing the latest documentation link for my comment above I noticed this: <a href=\"https://docs.rs/futures/0.3.5/futures/stream/struct.FuturesUnordered.html\" rel=\"nofollow noreferrer\">docs.rs/futures/0.3.5/futures/stream/&hellip;</a>  Which appears to be exactly what I was looking for"}, {"owner": {"reputation": 197, "user_id": 11041613, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DM5ik.png?s=128&g=1", "display_name": "Dull Bananas", "link": "https://stackoverflow.com/users/11041613/dull-bananas"}, "edited": false, "score": 1, "creation_date": 1606713841, "post_id": 58456204, "comment_id": 115034601, "body": "@Nick post that as an answer"}], "owner": {"reputation": 790, "user_id": 1355121, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7fde47be1461f757f6e7bbac40c4df97?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/1355121/nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 656, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1593641419, "creation_date": 1571422443, "last_edit_date": 1571425109, "question_id": 58456204, "link": "https://stackoverflow.com/questions/58456204/waiting-for-a-list-of-futures-in-rust", "title": "Waiting for a list of futures in Rust", "body": "<p>I am attempting to make a future that continuously finds new work to do and then maintains a set of futures for those work items. I would like to make sure neither my main future that finds work to be blocked for long periods of time and to have my work being done concurrently.</p>\n\n<p>Here is a rough overview of what I am trying to do. Specifically <code>isDone</code> does not exist and also from what I can understand from the docs isn't necessarily a valid way to use futures in Rust. What is the idomatic way of doing this kind of thing? </p>\n\n<pre><code>use std::collections::HashMap;\nuse tokio::runtime::Runtime;\n\nasync fn find_work() -&gt; HashMap&lt;i64, String&gt; {\n    // Go read from the DB or something...\n    let mut work = HashMap::new();\n    work.insert(1, \"test\".to_string());\n    work.insert(2, \"test\".to_string());\n    return work;\n}\n\nasync fn do_work(id: i64, value: String) -&gt; () {\n    // Result&lt;(), Error&gt; {\n    println!(\"{}: {}\", id, value);\n}\n\nasync fn async_main() -&gt; () {\n    let mut pending_work = HashMap::new();\n    loop {\n        for (id, value) in find_work().await {\n            if !pending_work.contains_key(&amp;id) {\n                let fut = do_work(id, value);\n                pending_work.insert(id, fut);\n            }\n        }\n\n        pending_work.retain(|id, fut| {\n            if isDone(fut) {\n                // do something with the result\n                false\n            } else {\n                true\n            }\n        });\n    }\n}\n\nfn main() {\n    let runtime = Runtime::new().unwrap();\n    let exec = runtime.executor();\n\n    exec.spawn(async_main());\n    runtime.shutdown_on_idle();\n}\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571419178, "post_id": 58454940, "comment_id": 103248176, "body": "You cannot do this because it is unsound. Inserting into the vector may cause it to reallocate, which would invalidate all existing references to its members. You need a <code>&amp;mut</code> reference to guarantee no existing references, which makes the <code>RefCell</code> extraneous."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571419388, "post_id": 58454940, "comment_id": 103248260, "body": "Alternatively, you could make a <code>get(&amp;&#39;a self, usize)</code> method that returns <code>Ref&lt;&#39;a, T&gt;</code>, but that&#39;s (also) not compatible with the <code>Index</code> trait"}, {"owner": {"reputation": 5358, "user_id": 1932452, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/7dfca62a1e4eb69f39ce00152862c70e?s=128&d=identicon&r=PG", "display_name": "wyer33", "link": "https://stackoverflow.com/users/1932452/wyer33"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571419423, "post_id": 58454940, "comment_id": 103248277, "body": "@trentcl I would be fine with only allowing mutable references, but <code>IndexMut</code> requires <code>Index</code>.  Is there a workaround that still preserves the operators?"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571423566, "post_id": 58454940, "comment_id": 103249943, "body": "Another approach could be to use an arena, or to wrap the <code>T</code>s in <code>Box</code>es so they have stable addresses and use a bit of <code>unsafe</code> to lie about the lifetimes. <a href=\"https://users.rust-lang.org/t/a-lazily-initialized-map/18101/9\" rel=\"nofollow noreferrer\">Here&#39;s a post I made on users.rust-lang.org, solving a similar problem</a>; perhaps that will help."}], "owner": {"reputation": 5358, "user_id": 1932452, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/7dfca62a1e4eb69f39ce00152862c70e?s=128&d=identicon&r=PG", "display_name": "wyer33", "link": "https://stackoverflow.com/users/1932452/wyer33"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1571416542, "creation_date": 1571416542, "question_id": 58454940, "link": "https://stackoverflow.com/questions/58454940/how-to-define-the-index-trait-on-an-object-where-the-data-is-held-in-a-refcell", "title": "How to define the Index trait on an object where the data is held in a `RefCell` in Rust?", "body": "<p>How do we define the <code>Index</code> trait on an object where the data is held in a <code>RefCell</code> in Rust?  Basically, I've an object that I'd like to index where sometimes the data exists and sometimes it does not.  When the data does not exist, I would like to create it and then return the appropriate reference for the indexing operation.  Otherwise, I'd like to index as normal.  As a simplified example of this, we have the code</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// External libraries                                                            \nuse std::cell::{Ref, RefCell};                                                   \nuse std::ops::Index;                                                             \n\n// Funny looking vector                                                          \nstruct MyVec&lt;T&gt; {                                                                \n    size: usize,                                                                 \n    data: RefCell&lt;Option&lt;Vec&lt;T&gt;&gt;&gt;,                                               \n}                                                                                \n\n// Create a full vector                                                          \nfn full&lt;T&gt;(size: usize, data: Vec&lt;T&gt;) -&gt; MyVec&lt;T&gt; {                              \n    MyVec {                                                                      \n        size,                                                                    \n        data: RefCell::new(Some(data)),                                          \n    }                                                                            \n}                                                                                \n// Creates an empty vector                                                       \nfn empty&lt;T&gt;(size: usize) -&gt; MyVec&lt;T&gt; {                                           \n    MyVec {                                                                      \n        size,                                                                    \n        data: RefCell::new(None),                                                \n    }                                                                            \n}                                                                                \n\n// Index from the vector                                                         \nimpl&lt;T&gt; Index&lt;usize&gt; for MyVec&lt;T&gt;                                                \nwhere                                                                            \n    T: Clone + Default,                                                          \n{                                                                                \n    type Output = T;                                                             \n    fn index(&amp;self, idx: usize) -&gt; &amp;Self::Output {                               \n        // Take out the data for processing                                      \n        let data = self.data.replace(None);                                      \n\n        // Make sure the data is full                                            \n        let data = match data {                                                  \n            None =&gt; Some(vec![Default::default(); self.size]),                   \n            Some(_) =&gt; data,                                                     \n        };                                                                       \n\n        // Put the data back inside the vector                                   \n        let _ = self.data.replace(data);                                         \n\n        // Return a reference to the element                                     \n        Ref::map(self.data.borrow(), |data| match &amp;data {                        \n            Some(data) =&gt; &amp;data[idx],                                            \n            None =&gt; unreachable!(),                                              \n        })                                                                       \n    }                                                                            \n}                                                                                \n\n// Test our functions                                                            \nfn main() {                                                                      \n    // Create an empty vector                                                    \n    let a = empty::&lt;f32&gt;(3);                                                     \n\n    // Print a value                                                             \n    println!(\"a(1): {}\", a[1]);                                                  \n} \n</code></pre>\n\n<p>This does not compile and returns the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n  --&gt; src/test02.rs:48:9\n   |\n48 | /         Ref::map(self.data.borrow(), |data| match &amp;data {\n49 | |             Some(data) =&gt; &amp;data[idx],\n50 | |             None =&gt; unreachable!(),\n51 | |         })\n   | |__________^ expected &amp;T, found struct `std::cell::Ref`\n   |\n   = note: expected type `&amp;T`\n              found type `std::cell::Ref&lt;'_, T&gt;`\nhelp: consider borrowing here\n   |\n48 |         &amp;Ref::map(self.data.borrow(), |data| match &amp;data {\n49 |             Some(data) =&gt; &amp;data[idx],\n50 |             None =&gt; unreachable!(),\n51 |         })\n   |\n\nerror: aborting due to previous error\n\nFor more information about this error, try `rustc --explain E0308`.\n</code></pre>\n\n<p>Of course, <code>Ref</code> is not the same as <code>&amp;</code>.  That said, how can this be fixed?</p>\n\n<p>In case it matters, I don't necessarily <em>need</em> a <code>RefCell</code>.  In reality, I've an enumerate type with different options.  However, the case remains the same.  Sometimes the data exists.  Sometimes the data doesn't.  When the data doesn't exist, I'd like to create it before we index.</p>\n"}, {"tags": ["pointers", "rust"], "comments": [{"owner": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "edited": false, "score": 0, "creation_date": 1571416790, "post_id": 58454827, "comment_id": 103247250, "body": "The warning is correct - you&#39;re literally in the textbook definition of UB there. Is there a reason you&#39;re not just chunking the slice and then parsing to u64 use <code>read_u64</code>?"}, {"owner": {"reputation": 1384, "user_id": 1659409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/feeb46d4e9c5e2781b7e27070b2f5a3f?s=128&d=identicon&r=PG", "display_name": "Bert Peters", "link": "https://stackoverflow.com/users/1659409/bert-peters"}, "reply_to_user": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "edited": false, "score": 0, "creation_date": 1571417029, "post_id": 58454827, "comment_id": 103247345, "body": "Both the <code>get_foo()</code> and <code>use_bar()</code> functions are library-provided (by different libraries) so I can&#39;t change those signatures. Chunking the slice and then copying would work, but that requires a copy. I was hoping to avoid that."}, {"owner": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "edited": false, "score": 0, "creation_date": 1571417154, "post_id": 58454827, "comment_id": 103247396, "body": "I can think of at least one way to do it without copy, since you don&#39;t actually need to destructure the slice and recreate, just take successive slices of it. However, even if there was a copy, I&#39;m sure we can both agree that extra allocations are much easier to justify than UB."}, {"owner": {"reputation": 1384, "user_id": 1659409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/feeb46d4e9c5e2781b7e27070b2f5a3f?s=128&d=identicon&r=PG", "display_name": "Bert Peters", "link": "https://stackoverflow.com/users/1659409/bert-peters"}, "reply_to_user": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "edited": false, "score": 0, "creation_date": 1571417345, "post_id": 58454827, "comment_id": 103247474, "body": "Maybe, but that is not exactly the question. The question is whether it is possible to avoid UB altogether by ensuring that <code>foo</code> is always properly aligned. Also note that these variables are not slices but arrays."}], "answers": [{"tags": [], "owner": {"reputation": 90851, "user_id": 27009, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f0a29af415477aa8c498a4f41ffe6640?s=128&d=identicon&r=PG", "display_name": "Kornel", "link": "https://stackoverflow.com/users/27009/kornel"}, "is_accepted": false, "score": 4, "last_activity_date": 1572579314, "creation_date": 1572579314, "answer_id": 58653790, "question_id": 58454827, "link": "https://stackoverflow.com/questions/58454827/how-do-i-over-align-a-variable-in-rust/58653790#58653790", "title": "How do I over-align a variable in Rust?", "body": "<p>Use <a href=\"https://doc.rust-lang.org/std/primitive.slice.html#method.align_to\" rel=\"nofollow noreferrer\"><code>align_to</code></a> to get an aligned slice. </p>\n\n<p>To get data aligned in the first place, you can use a wrapper with <code>#[repr(align(x))]</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[repr(align(8))] \nstruct Wrapper([u8; 200]);\n</code></pre>\n"}], "owner": {"reputation": 1384, "user_id": 1659409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/feeb46d4e9c5e2781b7e27070b2f5a3f?s=128&d=identicon&r=PG", "display_name": "Bert Peters", "link": "https://stackoverflow.com/users/1659409/bert-peters"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1572579314, "creation_date": 1571416039, "question_id": 58454827, "link": "https://stackoverflow.com/questions/58454827/how-do-i-over-align-a-variable-in-rust", "title": "How do I over-align a variable in Rust?", "body": "<p>In my code, I have a type that is aligned to 1 byte, and a function that requires a type that is aligned to 8 bytes. The following hypothetical code shows this usage:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn use_bar(bar: &amp;mut [u64; 25]) {\n    unimplemented!()\n}\n\nfn main() {\n    let mut foo: [u8; 200] = get_foo();\n\n    unsafe {\n        // Option 1\n        use_bar(mem::transmute::&lt;&amp;mut [u8; 200], &amp;mut [u64; 25]&gt;::(&amp;mut foo));\n        // Option 2\n        use_bar(&amp;mut *(&amp;mut foo as *mut [u8; 200] as *mut [u64; 25]));\n    }\n}\n</code></pre>\n\n<p>Unfortunately, this doesn't necessarily work. If you ask clippy about the first option, it will tell you that transmuting references is a bad thing to do. Option 2 may work, however, it will then tell you that the alignment requirements for <code>[u64; 25]</code> are more strict (8 byte alignment) than for <code>[u8; 200]</code> (1 byte alignment) so this may cause undefined behaviour.</p>\n\n<p>Since I don't control the type returned by <code>get_foo()</code>, is there any way I can force <code>foo</code> to be 8 byte aligned? (other than wrapping it in a struct that is properly aligned)</p>\n"}, {"tags": ["sqlite", "rust"], "comments": [{"owner": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "edited": false, "score": 4, "creation_date": 1571398389, "post_id": 58449840, "comment_id": 103237691, "body": "&quot;To reduce over head I&#39;m trying to not use OOP for this current program.&quot; - Trading one overhead for another is closer to the truth."}, {"owner": {"reputation": 915, "user_id": 9716278, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-y_OzgTqtpA8/AAAAAAAAAAI/AAAAAAAABmM/yM8i9oN9vmw/photo.jpg?sz=128", "display_name": "9716278", "link": "https://stackoverflow.com/users/9716278/9716278"}, "reply_to_user": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "edited": false, "score": 0, "creation_date": 1571399513, "post_id": 58449840, "comment_id": 103238258, "body": "@S&#233;bastienRenauld Well I know there are going to be fewer calls to the program from the baby than that would summate to the amount of memory OOP would need. The program is just a launcher. It doesn&#39;t need to hold the OOP because the process just hangs around as a side effect of it being the launcher. Also for this application I want data written to disk in case of a power outage. It&#39;s not the kind of program were specific time is trivial."}], "answers": [{"tags": [], "owner": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "is_accepted": false, "score": 3, "last_activity_date": 1571401068, "creation_date": 1571401068, "answer_id": 58450810, "question_id": 58449840, "link": "https://stackoverflow.com/questions/58449840/how-to-get-back-one-rows-data-in-rusqlite/58450810#58450810", "title": "How to get back one row&#39;s data in rusqlite?", "body": "<p>Okay. First off, we <strong>are</strong> going to use a <code>struct</code>, because, unlike in Java, it is literally equivalent to not using one in this case, except that you gain in being able to keep things <em>tidy</em>.</p>\n\n<p>You're trying to emulate <a href=\"https://docs.rs/rusqlite/0.20.0/rusqlite/struct.Connection.html#method.last_insert_rowid\" rel=\"nofollow noreferrer\"><code>Connection::last_insert_rowid()</code></a>, which isn't a terribly smart thing to do, particularly if you are not in a transaction. We're also going to clear this up for you in a nice and neat fashion:</p>\n\n<pre><code>use rusqlite::{Connection};\n\npub struct ShortName {\n    pub id: i64,\n    pub name: String\n}\n\npub fn insert_shortname(db: &amp;Connection, name: &amp;str) -&gt; Result&lt;ShortName, rusqlite::Error&gt; {\n    let mut rtn = ShortName {\n        id: 0,\n        name: name.to_string()\n    };\n    db.execute(\"insert into short_names (short_name) values (?)\",&amp;[name])?;\n    rtn.id = db.last_insert_rowid();\n    Ok(rtn)\n}\n</code></pre>\n\n<p>You can convince yourself that it works with this test:</p>\n\n<pre><code>#[test]\nfn it_works() {\n    let conn = Connection::open_in_memory().expect(\"Could not test: DB not created\");\n    let input:Vec&lt;bool&gt; = vec![];\n    conn.execute(\"CREATE TABLE short_names (id INTEGER PRIMARY KEY AUTOINCREMENT, short_name TEXT NOT NULL)\", input).expect(\"Creation failure\");\n    let output = insert_shortname(&amp;conn, \"Fred\").expect(\"Insert failure\");\n    assert_eq!(output.id, 1);\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 915, "user_id": 9716278, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-y_OzgTqtpA8/AAAAAAAAAAI/AAAAAAAABmM/yM8i9oN9vmw/photo.jpg?sz=128", "display_name": "9716278", "link": "https://stackoverflow.com/users/9716278/9716278"}, "is_accepted": false, "score": 1, "last_activity_date": 1571834362, "creation_date": 1571834362, "answer_id": 58523070, "question_id": 58449840, "link": "https://stackoverflow.com/questions/58449840/how-to-get-back-one-rows-data-in-rusqlite/58523070#58523070", "title": "How to get back one row&#39;s data in rusqlite?", "body": "<p>In <a href=\"https://docs.rs/rusqlite/0.20.0/rusqlite/index.html\" rel=\"nofollow noreferrer\">rusqlite</a> <code>execute</code> does not return a value. To return a value from a sqlite operation you need to use <code>prepare</code> and a variant of <code>query</code>. While much of Rust allows you to leave type up to the compiler, for rusqite you need to give the receiving variable a type.</p>\n\n<p>There is not currently a way in rusqlite to take a single row out of a query. The type of <a href=\"https://docs.rs/rusqlite/0.20.0/rusqlite/struct.Rows.html\" rel=\"nofollow noreferrer\"><code>rows</code></a> is not a type iterator, so you need to progress over it with a while loop, that will progress based on the error type of <code>rows</code>. After the loop runs once it will return that there are no other <code>row</code> in <code>rows</code> and exit; if there is only one row from the query.</p>\n\n<p>You can use <code>query_named</code> to modify the sql query your sanding. Using the <a href=\"https://docs.rs/rusqlite/0.20.0/rusqlite/macro.named_params.html\" rel=\"nofollow noreferrer\"><code>named_params!{}</code></a> macro will allow you to use a String to send information to the command.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use rusqlite::*;\n\nfn main() {\n    let short = \"lookup\".to_string(); // example of a string you might use\n    let id:i64;\n    { // open for db work\n        let db = Connection::open(\"YourDB.db\").expect(\"db conn fail\");\n        let mut receiver = db.prepare(\"SELECT * FROM short_names WHERE short_name = :short;\").expect(\"\");\n        let mut rows = receiver.query_named(named_params!{ \":short\": short }).expect(\"\");\n        while let Some(row) = rows.next().expect(\"\") {\n            id=row.get(0).expect(\"\");\n        }\n    } // close db work\n    println!(\"{}\",id);\n}\n</code></pre>\n\n<p>In the above example, we open a scope with <code>{}</code> around the database transaction, this will automatically close the db when it goes out of scope. Notice that we create our db connection and do all our work with the database solely inside the <code>{}</code>. This allows us to skip closing the db with the explicate command and is done by inference taken by the compiler from the scope: <code>{}</code>. The variables <code>short</code> and <code>id</code>, created in the scope of <code>main()</code>, are still available to the db scope and the rest of the scope of <code>main()</code>. While <code>id</code> is not assigned until the db scope, but it's defined outside of the scope, the scope of main, so that is where <code>id</code>'s lifetime begins. <code>id</code> does not need to be mutable because it's only assigned once, if there is in fact only one row to retrieve, the while loop will only assign it once. Otherwise, if the database does not behave as expected this will result in an error.</p>\n"}], "owner": {"reputation": 915, "user_id": 9716278, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-y_OzgTqtpA8/AAAAAAAAAAI/AAAAAAAABmM/yM8i9oN9vmw/photo.jpg?sz=128", "display_name": "9716278", "link": "https://stackoverflow.com/users/9716278/9716278"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1548, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1571834362, "creation_date": 1571397704, "question_id": 58449840, "link": "https://stackoverflow.com/questions/58449840/how-to-get-back-one-rows-data-in-rusqlite", "title": "How to get back one row&#39;s data in rusqlite?", "body": "<ul>\n<li>rustc 1.38.0 (625451e37 2019-09-23)</li>\n<li><a href=\"https://github.com/jgallagher/rusqlite\" rel=\"nofollow noreferrer\">rusqlite 0.20.0</a></li>\n</ul>\n\n<p>I'm writing a program where I need to get back the <code>id</code> from the last insertion that sqlite just created.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>db.execute(\"insert into short_names (short_name) values (?1)\",params![short]).expect(\"db insert fail\");\n\nlet id = db.execute(\"SELECT id FROM short_names WHERE short_name = '?1';\",params![&amp;short]).query(NO_PARAMS).expect(\"get record id fail\");\n\nlet receiver = db.prepare(\"SELECT id FROM short_names WHERE short_name = \"+short+\";\").expect(\"\");\nlet id = receiver.query(NO_PARAMS).expect(\"\");\nprintln!(\"{:?}\",id);\n</code></pre>\n\n<p>What I should be getting back is the id value sqlite automatically assigned with AUTOINCREMENT.</p>\n\n<p>I'm getting this compiler Error:</p>\n\n<pre><code>error[E0599]: no method named `query` found for type `std::result::Result&lt;usize, rusqlite::Error&gt;` in the current scope\n  --&gt; src/main.rs:91:100\n   |\n91 |         let id = db.execute(\"SELECT id FROM short_names WHERE short_name = '?1';\",params![&amp;short]).query(NO_PARAMS).expect(\"get record id fail\");\n   |                                                                                                    ^^^^^\n\nerror[E0369]: binary operation `+` cannot be applied to type `&amp;str`\n  --&gt; src/main.rs:94:83\n   |\n94 |         let receiver = db.prepare(\"SELECT id FROM short_names WHERE short_name = \"+short+\";\").expect(\"\");\n   |                                   ------------------------------------------------^----- std::string::String\n   |                                   |                                               |\n   |                                   |                                               `+` cannot be used to concatenate a `&amp;str` with a `String`\n   |                                   &amp;str\nhelp: `to_owned()` can be used to create an owned `String` from a string reference. String concatenation appends the string on the right to the string on the left and may require reallocation. This requires ownership of the string on the left\n   |\n94 |         let receiver = db.prepare(\"SELECT id FROM short_names WHERE short_name = \".to_owned()+&amp;short+\";\").expect(\"\");\n   |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ^^^^^^\n\nerror[E0277]: `rusqlite::Rows&lt;'_&gt;` doesn't implement `std::fmt::Debug`\n  --&gt; src/main.rs:96:25\n   |\n96 |         println!(\"{:?}\",id);\n   |                         ^^ `rusqlite::Rows&lt;'_&gt;` cannot be formatted using `{:?}` because it doesn't implement `std::fmt::Debug`\n   |\n   = help: the trait `std::fmt::Debug` is not implemented for `rusqlite::Rows&lt;'_&gt;`\n   = note: required by `std::fmt::Debug::fmt`\n</code></pre>\n\n<p><strong>Line 94:</strong> I understand that rust's String is not the right type for the <code>execute</code> call, but I'm not sure what to do instead. </p>\n\n<p>I suspect what needs to happen is the <code>short_names</code> table needs to be pulled form the database  and then from the rust representation of the table for get the <code>id</code> that matches the <code>short</code> I'm trying to work with. <a href=\"https://rust-lang-nursery.github.io/rust-cookbook/database/sqlite.html\" rel=\"nofollow noreferrer\">I've been going off this example as a jumping off point, but It's dereferenced it's usefulness.</a> The program I'm writing calls another program and then babysits it while this other program runs. To reduce over head I'm trying to not use OOP for this current program.</p>\n\n<p>How should I structure my request to the database to get by the <code>id</code> I need?</p>\n"}, {"tags": ["rust", "associated-types"], "comments": [{"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 1, "creation_date": 1571395404, "post_id": 58448956, "comment_id": 103236221, "body": "In your case <code>key_impl</code> is  actually a <code>User</code> , instead of generic parameter you might want to use <code>&amp;self</code> to infer the associated type. Here is an <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=f60f95fb37171d83df0bba4fac54b81f\" rel=\"nofollow noreferrer\">implementation</a>"}, {"owner": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1571395672, "post_id": 58448956, "comment_id": 103236365, "body": "Otherwise you need to provide associated type explicitly, here is an <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=11ce65803bc5c349eac945ef1369f9e8\" rel=\"nofollow noreferrer\">implementation</a> without <code>&amp;self</code>"}, {"owner": {"reputation": 45, "user_id": 11184806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcda30aac6d3901fe25e524d8b756c32?s=128&d=identicon&r=PG&f=1", "display_name": "Arto", "link": "https://stackoverflow.com/users/11184806/arto"}, "reply_to_user": {"reputation": 5152, "user_id": 1601571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56403b8ee9f5066ce3f75b9783cc9b2b?s=128&d=identicon&r=PG", "display_name": "&#214;mer Erden", "link": "https://stackoverflow.com/users/1601571/%c3%96mer-erden"}, "edited": false, "score": 0, "creation_date": 1571396338, "post_id": 58448956, "comment_id": 103236676, "body": "I tried the explicit version, but have failed for 1.5h. <code>&amp;self</code> however works in my project. Thank you &#214;mer for your time!"}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 11184806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcda30aac6d3901fe25e524d8b756c32?s=128&d=identicon&r=PG&f=1", "display_name": "Arto", "link": "https://stackoverflow.com/users/11184806/arto"}, "edited": false, "score": 0, "creation_date": 1571402316, "post_id": 58449985, "comment_id": 103239727, "body": "Thanks Peter for your clear explanation. Now I not only have a working solution from &#214;mer, but I even understand what&#39;s going on in my code :). Have to admit generics in Rust sometimes crank my brain."}], "tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": true, "score": 1, "last_activity_date": 1571398207, "creation_date": 1571398207, "answer_id": 58449985, "question_id": 58448956, "link": "https://stackoverflow.com/questions/58448956/compiler-doesnt-see-associates-type-is-the-same-as-concrete-type/58449985#58449985", "title": "Compiler doesn&#39;t see associates type is the same as concrete type", "body": "<p>This code makes the assumption that <em>every</em> implementation of <code>KeyTrait</code> has the same associated <code>Key</code> type.</p>\n\n<pre><code>impl PrintTrait for User {\n    fn print_key&lt;K: KeyTrait&gt;(key_impl: K) {\n        let id: u64 = key_impl.key();\n        println!(\"Found key {}\", id);\n    }\n}\n</code></pre>\n\n<p>In fact, an implementation of <code>KeyTrait</code> could choose any type.</p>\n\n<p>You can encode this assumption in the type system:</p>\n\n<pre><code>trait PrintTrait {\n    fn print_key&lt;K&gt;(key: K)\n    where\n        K: KeyTrait&lt;Key = u64&gt;;\n}\n\nimpl PrintTrait for User {\n    fn print_key&lt;K&gt;(key_impl: K) \n    where\n        K: KeyTrait&lt;Key = u64&gt;,\n    {\n        let id: u64 = key_impl.key();\n    }\n}\n</code></pre>\n\n<p>Or, if you need <code>PrintTrait</code> to be generic over all possible associated <code>Key</code> types:</p>\n\n<pre><code>trait PrintTrait&lt;T&gt; {\n    fn print_key&lt;K&gt;(key: K)\n    where\n        K: KeyTrait&lt;Key = T&gt;;\n}\n\nimpl PrintTrait&lt;u64&gt; for User {\n    fn print_key&lt;K&gt;(key_impl: K) \n    where\n        K: KeyTrait&lt;Key = u64&gt;,\n    {\n        let id: u64 = key_impl.key();\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 11184806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcda30aac6d3901fe25e524d8b756c32?s=128&d=identicon&r=PG&f=1", "display_name": "Arto", "link": "https://stackoverflow.com/users/11184806/arto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 58449985, "answer_count": 1, "score": 1, "last_activity_date": 1571398207, "creation_date": 1571394380, "last_edit_date": 1571394584, "question_id": 58448956, "link": "https://stackoverflow.com/questions/58448956/compiler-doesnt-see-associates-type-is-the-same-as-concrete-type", "title": "Compiler doesn&#39;t see associates type is the same as concrete type", "body": "<p>I have a little nuisance in my project, that I can't resolve: The compiler doesn't see that the associated type is the same as the concrete type and won't let my do an assignement.</p>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=26bfae60b0ca52a902eaa664ca9b416d\" rel=\"nofollow noreferrer\">Playground</a> </p>\n\n<p>Does anyone know how to fix it. Thank you for taking your time.</p>\n\n<p>Artos</p>\n\n<pre><code>// This program fails to compile \n// Compiler doesn't see that the associated type and type of user id are the same. \nstruct User {\n    pub id: u64,\n}\n\ntrait KeyTrait {\n    type Key;\n    fn key(&amp;self) -&gt; Self::Key;\n}\n\nimpl KeyTrait for User {\n    type Key = u64;\n    fn key(&amp;self) -&gt; Self::Key {\n        self.id\n    }\n}\n\ntrait PrintTrait {\n    fn print_key&lt;K: KeyTrait&gt;(key: K);\n}\n\nimpl PrintTrait for User {\n    fn print_key&lt;K: KeyTrait&gt;(key_impl: K) {\n        let id: u64 = key_impl.key(); // Raises error: expected u64, found associated type\n\n        println!(\"Found key {}\", id);\n    }\n}\n\nfn main() {\n    let user = User { id: 5 };\n    User::print_key(user);\n}\n</code></pre>\n"}, {"tags": ["server", "rust", "openssl", "client"], "answers": [{"comments": [{"owner": {"reputation": 3836, "user_id": 3003401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f2de9e3bd27825488f4cf0a1dd86ac0?s=128&d=identicon&r=PG&f=1", "display_name": "Cerberus", "link": "https://stackoverflow.com/users/3003401/cerberus"}, "edited": false, "score": 0, "creation_date": 1571393138, "post_id": 58447795, "comment_id": 103235021, "body": "The error is due to the swagger codegen being only tested on Linux. But nothing should stop OP from fixing generated code."}, {"owner": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "reply_to_user": {"reputation": 3836, "user_id": 3003401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f2de9e3bd27825488f4cf0a1dd86ac0?s=128&d=identicon&r=PG&f=1", "display_name": "Cerberus", "link": "https://stackoverflow.com/users/3003401/cerberus"}, "edited": false, "score": 0, "creation_date": 1571394853, "post_id": 58447795, "comment_id": 103235943, "body": "@Cerberus that is true, although it may require a bit of work depending on how he used it. I was waiting for more information to be able to advise further :-)"}, {"owner": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "reply_to_user": {"reputation": 3836, "user_id": 3003401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f2de9e3bd27825488f4cf0a1dd86ac0?s=128&d=identicon&r=PG&f=1", "display_name": "Cerberus", "link": "https://stackoverflow.com/users/3003401/cerberus"}, "edited": false, "score": 0, "creation_date": 1571397002, "post_id": 58447795, "comment_id": 103236995, "body": "Turns out the issue is documented, but the focus of the project is on keeping the ability to add root CAs rather than cross-platform needs; this would be an ideal time to fork &amp; expand."}, {"owner": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "edited": false, "score": 0, "creation_date": 1571743887, "post_id": 58447795, "comment_id": 103335019, "body": "I updated the swagger version and the error no longer comes up. Apparently it was fixed in the v1. something... It is annooying how swagger doesn&#39;t generate the latest versions beacuase now that I have updated the swagger version, I am getting several errors edue to depereciated code. thanks all for looking into this."}, {"owner": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "reply_to_user": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "edited": false, "score": 0, "creation_date": 1571746063, "post_id": 58447795, "comment_id": 103336241, "body": "@theBigCheese88 I much prefer (and contribute to!) <code>openapi-generator</code> due to this. I see more risk than value in having <code>build.rs</code> generate your code from <code>swagger</code>, preferring it to do it manually &amp; test against it. Obviously, your mileage (and use case) may vary."}, {"owner": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "edited": false, "score": 0, "creation_date": 1572001229, "post_id": 58447795, "comment_id": 103433620, "body": "@S&#233;bastienRenauld yes. I gave up on Swagger Codegen for generating rust code since it didn&#39;t seem to be updated. openapigenerator seems to be better, cheer! <a href=\"https://github.com/OpenAPITools/openapi-generator\" rel=\"nofollow noreferrer\">github.com/OpenAPITools/openapi-generator</a>"}, {"owner": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "reply_to_user": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "edited": false, "score": 0, "creation_date": 1572002465, "post_id": 58447795, "comment_id": 103434211, "body": "@theBigCheese88 I have a PR on that repository to add an async <code>reqwest</code> module for codegen; if you want the async version, by this point my branch should be safe for general use. Glad you found your solution, even if it didn&#39;t end with the starting libraries :-)"}], "tags": [], "owner": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "is_accepted": true, "score": 1, "last_activity_date": 1571390494, "creation_date": 1571390494, "answer_id": 58447795, "question_id": 58447385, "link": "https://stackoverflow.com/questions/58447385/could-not-find-openssl-in-backend/58447795#58447795", "title": "Could not find openssl in backend", "body": "<p>You've landed on a flaw from the Rust documentation tools; it picks up what is in a package, but doesn't show the limits.</p>\n\n<p>The <code>backend</code> module definition is defined as:</p>\n\n<pre><code>#[cfg(any(target_os = \"macos\", target_os = \"ios\"))]\npub mod security_framework;\n\n#[cfg(target_os = \"windows\")]\npub mod schannel;\n\n#[cfg(not(any(target_os = \"macos\", target_os = \"windows\", target_os = \"ios\")))]\npub mod openssl;\n</code></pre>\n\n<p>In other words, the situation is the following:</p>\n\n<ul>\n<li>If you are on linux (i.e. not macOS, not windows, not iOS), then <code>openssl</code> is available</li>\n<li>If you are on windows, then <code>schannel</code> is available</li>\n<li>If you are on MacOS or iOS <code>security_framework</code> is available</li>\n</ul>\n\n<p>You should, however, not be trying to target a specific backend, as this defeats the purpose of the library. Instead of importing <code>native_tls::backend::openssl::TlsConnectorBuilderExt</code>, import <code>native_tls::TlsConnectorBuilder</code> and let it decide what backend you need.</p>\n\n<p>This may be easier said than done, however, since by the looks of your error this is caused by a third-party library, which indicates that it was only tested on Linux.</p>\n"}], "owner": {"reputation": 133, "user_id": 10671679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c086dbf7713aa48a259a3d979f9442d6?s=128&d=identicon&r=PG&f=1", "display_name": "theBigCheese88", "link": "https://stackoverflow.com/users/10671679/thebigcheese88"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 0, "accepted_answer_id": 58447795, "answer_count": 1, "score": 0, "last_activity_date": 1571390494, "creation_date": 1571389130, "last_edit_date": 1571390114, "question_id": 58447385, "link": "https://stackoverflow.com/questions/58447385/could-not-find-openssl-in-backend", "title": "Could not find openssl in backend", "body": "<p>Error I get:</p>\n\n<pre><code>error[E0433]: failed to resolve: could not find `openssl` in `backend`\n  --&gt; ...\\src\\...\\swagger-0.12.1\\src\\connector.rs:41:34\n   |\n41 |             native_tls::backend::openssl::TlsConnectorBuilderExt::from_openssl(ssl);\n   |                                  ^^^^^^^ could not find `openssl` in `backend`\n\nerror[E0433]: failed to resolve: could not find `openssl` in `backend`\n  --&gt; ...\\swagger-0.12.1\\src\\connector.rs:85:34\n   |\n85 |             native_tls::backend::openssl::TlsConnectorBuilderExt::from_openssl(ssl);\n   |                                  ^^^^^^^ could not find `openssl` in `backend`\n\n   Compiling hyper v0.2.1\nerror: expected identifier, found `\"rustc-serialize\"`\n   --&gt; ...\\hyper-0.2.1\\src\\lib.rs:129:14\n    |\n129 | extern crate \"rustc-serialize\" as serialize;\n    |              ^^^^^^^^^^^^^^^^^ expected identifier\n</code></pre>\n\n<p>Generated a server stub user swagger. Ran into issues where cargo couldn't find openssl, giving an error like 'custom build something openssl-sys 0.9.24'. This was a known issue and I overcame it by downloading vcpkg, and using vcpkg to download openssl. Then using environment variables to point to the download folder so cargo could use openssl. But now the error seems to be that <code>openssl</code> doesn't exist in <code>backend</code>?</p>\n\n<p>It also seems to specific to windows, any ideas?</p>\n\n<p>Tried changing the version of native-tls to the most up to date version but it doesn't seem to have an affect at all. It looks like swagger's dependencies need updating but I literally just generated this stub...</p>\n"}, {"tags": ["rust", "rust-cargo", "nightly-build"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1571382451, "post_id": 58445559, "comment_id": 103229736, "body": "As a sidenote: You typically don&#39;t use <code>#[cfg(test)]</code> in the tests subfolder, because they will only be called if <code>cargo test</code> or similar is used. You can omit that :)"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1571382495, "post_id": 58445559, "comment_id": 103229764, "body": "Have you tried it with <code>extern crate myswankynewpackage</code>?"}, {"owner": {"reputation": 129, "user_id": 3931121, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9cb5e41cd2593b7227edc616b01b3aa6?s=128&d=identicon&r=PG&f=1", "display_name": "candronikos", "link": "https://stackoverflow.com/users/3931121/candronikos"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1571382520, "post_id": 58445559, "comment_id": 103229779, "body": "Right I forgot about that. This is the result after a few attempts and I forgot to take it out."}, {"owner": {"reputation": 129, "user_id": 3931121, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9cb5e41cd2593b7227edc616b01b3aa6?s=128&d=identicon&r=PG&f=1", "display_name": "candronikos", "link": "https://stackoverflow.com/users/3931121/candronikos"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1571382603, "post_id": 58445559, "comment_id": 103229811, "body": "Yeah, I get a <code>can&#39;t find crate</code> error"}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1571382707, "post_id": 58445559, "comment_id": 103229853, "body": "Works for me: <code>cargo new --lib myswankynewpackage</code>, add the <code>tests&#47;tests.rs</code> file from your question, then <code>cargo test</code> \u2192 I get an unused import warning for <code>myswankynewpackage</code>, but the tests compile and run"}, {"owner": {"reputation": 129, "user_id": 3931121, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9cb5e41cd2593b7227edc616b01b3aa6?s=128&d=identicon&r=PG&f=1", "display_name": "candronikos", "link": "https://stackoverflow.com/users/3931121/candronikos"}, "edited": false, "score": 0, "creation_date": 1571382781, "post_id": 58445559, "comment_id": 103229884, "body": "I&#39;m using a <code>Cargo.toml</code> from the vscode-docker dev environment. Can you post your <code>Cargo.toml</code>?"}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1571383039, "post_id": 58445559, "comment_id": 103229986, "body": "It&#39;s the straight <code>Cargo.toml</code> generated by <code>cargo new --lib</code>: <a href=\"https://framabin.org/p/?d5bcf1b94e0240e3#d0gwoM9G8aR1fzn9EDImjngby9M1H4wHi5mU2XbaSrA=\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1571383060, "post_id": 58445559, "comment_id": 103230000, "body": "Using <code>cargo</code> and <code>rustc</code> version 1.37.0"}, {"owner": {"reputation": 129, "user_id": 3931121, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9cb5e41cd2593b7227edc616b01b3aa6?s=128&d=identicon&r=PG&f=1", "display_name": "candronikos", "link": "https://stackoverflow.com/users/3931121/candronikos"}, "edited": false, "score": 0, "creation_date": 1571385149, "post_id": 58445559, "comment_id": 103230912, "body": "I&#39;m using <code>rustc 1.40.0-nightly (e413dc36a 2019-10-14)</code>. My <code>Cargo.toml</code> matches with it except I added a <code>features</code> section and I&#39;m using a couple of libraries"}, {"owner": {"reputation": 194, "user_id": 10061864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e85c2644da1eb3183ec669998cd00ea?s=128&d=identicon&r=PG&f=1", "display_name": "szignal", "link": "https://stackoverflow.com/users/10061864/szignal"}, "edited": false, "score": 0, "creation_date": 1571498056, "post_id": 58445559, "comment_id": 103265108, "body": "Do you have <code>#[no_std]</code> or something in your original code somewhere? If this is a <code>no_std</code> project, you can&#39;t use rust&#39;s built-in test framework. If true, see my other answer about testing <code>no_std</code> projects <a href=\"https://stackoverflow.com/questions/58441073/cargo-test-cannot-reference-anything-public-inside-the-targeting-crate-in-integr/58461804#58461804\">here</a>."}, {"owner": {"reputation": 90851, "user_id": 27009, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f0a29af415477aa8c498a4f41ffe6640?s=128&d=identicon&r=PG", "display_name": "Kornel", "link": "https://stackoverflow.com/users/27009/kornel"}, "edited": false, "score": 0, "creation_date": 1572579143, "post_id": 58445559, "comment_id": 103612028, "body": "If it doesn&#39;t work in Visual Studio Code, it&#39;s VS&#39;s fault. I think it calls <code>rustc</code> directly on files, instead of <code>cargo</code>, so packages just don&#39;t work in VS Code."}], "answers": [{"tags": [], "owner": {"reputation": 1211, "user_id": 920545, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2f5406e58c35a73af9dfdbd64d435f6b?s=128&d=identicon&r=PG", "display_name": "Paul Molodowitch", "link": "https://stackoverflow.com/users/920545/paul-molodowitch"}, "is_accepted": false, "score": 0, "last_activity_date": 1605109132, "last_edit_date": 1605109132, "creation_date": 1605108985, "answer_id": 64789457, "question_id": 58445559, "link": "https://stackoverflow.com/questions/58445559/rust-integration-test-cant-use-library/64789457#64789457", "title": "Rust integration test can&#39;t `use` library", "body": "<p>So, I noticed that <a href=\"https://stackoverflow.com/questions/58445559/rust-integration-test-cant-use-library#comment103230912_58445559\">OP says</a> the actual <code>Cargo.toml</code> matches the given one &quot;except [OP is] ... using a couple of libraries.&quot;</p>\n<p>I think what's causing problems is the libraries - if you have libraries (with a different name), you need to use the name of the library in the <code>use</code> statement. ie:</p>\n<p><code>Cargo.toml</code></p>\n<pre><code>[package]\nname = &quot;myswankynewpackage&quot;\nversion = &quot;0.1.0&quot;\nauthors = [&quot;Me Myself &lt;me.myself@gmail.com&gt;&quot;]\nedition = &quot;2018&quot;\n\n# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\ntests/tests.rs\n\n[lib]\nname = &quot;myswankynewlib&quot;\npath = &quot;src/lib.rs&quot;\n</code></pre>\n<p><code>tests/tests.rs</code></p>\n<pre><code>// WRONG!\n// use myswankynewpackage;\n\n// RIGHT!\nuse myswankynewlib;\n\n...\n</code></pre>\n<p>I had a similar error message, and originally found this post when searching before I realized the issue.  So even if this WASN'T the original poster's problem, perhaps this answer will help others...</p>\n"}], "owner": {"reputation": 129, "user_id": 3931121, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9cb5e41cd2593b7227edc616b01b3aa6?s=128&d=identicon&r=PG&f=1", "display_name": "candronikos", "link": "https://stackoverflow.com/users/3931121/candronikos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 850, "favorite_count": 0, "closed_date": 1605109334, "answer_count": 1, "score": 1, "last_activity_date": 1605109132, "creation_date": 1571382213, "last_edit_date": 1571837911, "question_id": 58445559, "link": "https://stackoverflow.com/questions/58445559/rust-integration-test-cant-use-library", "closed_reason": "Not suitable for this site", "title": "Rust integration test can&#39;t `use` library", "body": "<p>Working to include integration tests to my project but I'm unable to import the library. I thought the new rules would allow me to just write a <code>use</code> statement but it isn't going very well :)</p>\n\n<p>The code below shows the related components. Isn't this supposed to be valid?</p>\n\n<p><code>Cargo.toml</code></p>\n\n<pre><code>[package]\nname = \"myswankynewpackage\"\nversion = \"0.1.0\"\nauthors = [\"Me Myself &lt;me.myself@gmail.com&gt;\"]\nedition = \"2018\"\n\n# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\n</code></pre>\n\n<p><code>tests/tests.rs</code></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use myswankynewpackage;\n// Also tried extern crate\n// extern crate myswankynewpackage;\n\n#[cfg(test)]\nmod integration {\n    use super::*;\n\n    mod module{\n\n        #[test]\n        fn module_test() {\n        }\n    }\n}\n</code></pre>\n\n<p>I get an error saying it can't find the crate</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0432]: unresolved import `myswankynewpackage`\n --&gt; tests/tests.rs:1:5\n  |\n1 | use myswankynewpackage;\n  |     ^^^^^^^^^^^^^^^^^^ no `myswankynewpackage` external crate\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 5, "creation_date": 1571368743, "post_id": 58443400, "comment_id": 103225950, "body": "Please include the full error and enough code to reproduce your problem."}], "answers": [{"tags": [], "owner": {"reputation": 12041, "user_id": 3830, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b13611d1950fd03a3e1d44195fa6f532?s=128&d=identicon&r=PG", "display_name": "Josh Matthews", "link": "https://stackoverflow.com/users/3830/josh-matthews"}, "is_accepted": true, "score": 3, "last_activity_date": 1571767326, "last_edit_date": 1571767326, "creation_date": 1571370477, "answer_id": 58443675, "question_id": 58443400, "link": "https://stackoverflow.com/questions/58443400/rust-type-must-be-rooted/58443675#58443675", "title": "Rust: Type must be rooted", "body": "<p>This is an error that is specific to a compiler plugin used by <a href=\"https://github.com/servo/servo/\" rel=\"nofollow noreferrer\">the Servo project</a>. It refers to the requirement that types that are under the control of the JavaScript GC must have a root present on the stack to ensure that it is safe to use them in a given stack frame, which will prevent the value from being GCed while it is in use by Rust code.</p>\n"}], "owner": {"reputation": 3017, "user_id": 1546710, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/fe5e016e1bbe4bd9d20d8494453d50d4?s=128&d=identicon&r=PG", "display_name": "aug2uag", "link": "https://stackoverflow.com/users/1546710/aug2uag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "closed_date": 1571383443, "accepted_answer_id": 58443675, "answer_count": 1, "score": -3, "last_activity_date": 1571767326, "creation_date": 1571368002, "last_edit_date": 1571387523, "question_id": 58443400, "link": "https://stackoverflow.com/questions/58443400/rust-type-must-be-rooted", "closed_reason": "Not suitable for this site", "title": "Rust: Type must be rooted", "body": "<p>What is the meaning of this Rust compiler error? I get it encountering:</p>\n\n<pre><code>pub fn some_func(foo: Something&lt;Else&gt;) -&gt; Another {\n    Another { foo: foo }\n}\n</code></pre>\n\n<p>yields error:</p>\n\n<pre><code>error: Type must be rooted\n  --&gt; script/foo.rs:12:32\n   |\n12 |     pub fn some_func(foo: Something&lt;Else&gt;) -&gt; Another {\n   |                                ^^^^^^^^^^^^^^^^^^^^^^\n   |\n   = note: `#[deny(unrooted_must_root)]` on by default\n</code></pre>\n"}, {"tags": ["multithreading", "rust"], "comments": [{"owner": {"reputation": 22505, "user_id": 1411457, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XqssD.png?s=128&g=1", "display_name": "harmic", "link": "https://stackoverflow.com/users/1411457/harmic"}, "edited": false, "score": 1, "creation_date": 1571379419, "post_id": 58441875, "comment_id": 103228528, "body": "Maybe <a href=\"https://stackoverflow.com/a/39928205/1411457\">this</a> answer would help?"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1571387072, "post_id": 58441875, "comment_id": 103231755, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/39928051/can-different-threads-write-to-different-sections-of-the-same-vec\">Can different threads write to different sections of the same Vec?</a>"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571412459, "post_id": 58441875, "comment_id": 103245238, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/32750829/how-can-i-pass-a-reference-to-a-stack-variable-to-a-thread\">How can I pass a reference to a stack variable to a thread?</a>"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571412657, "post_id": 58441875, "comment_id": 103245344, "body": "Summary of the duplicate: no. <code>std</code> does not expose an API that allows stack references to be shared between threads. There is also <code>scoped-threadpool</code> which is considerably smaller in scope than <code>crossbeam</code>, if that helps."}], "answers": [{"tags": [], "owner": {"reputation": 30359, "user_id": 255688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74b63650ed07d745fd9accf52e4d286b?s=128&d=identicon&r=PG", "display_name": "phimuemue", "link": "https://stackoverflow.com/users/255688/phimuemue"}, "is_accepted": false, "score": 0, "last_activity_date": 1571407807, "creation_date": 1571407807, "answer_id": 58452590, "question_id": 58441875, "link": "https://stackoverflow.com/questions/58441875/is-it-possible-to-access-disjoint-slices-with-multiple-threads-using-only-std/58452590#58452590", "title": "Is it possible to access disjoint slices with multiple threads using only std?", "body": "<p>Maybe <a href=\"https://doc.rust-lang.org/std/primitive.slice.html#method.split_at_mut\" rel=\"nofollow noreferrer\"><code>split_at_mut</code></a> or <a href=\"https://doc.rust-lang.org/std/primitive.slice.html#method.chunks_mut\" rel=\"nofollow noreferrer\"><code>chunks_mut</code></a> helps.</p>\n"}], "owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1571407807, "creation_date": 1571354154, "question_id": 58441875, "link": "https://stackoverflow.com/questions/58441875/is-it-possible-to-access-disjoint-slices-with-multiple-threads-using-only-std", "title": "Is it possible to access disjoint slices with multiple threads using only std?", "body": "<p>It's been previously <a href=\"https://stackoverflow.com/questions/33818141/how-do-i-pass-disjoint-slices-from-a-vector-to-different-threads\">asked</a> whether disjoint slices can be accessed by multiple threads. The answer is the crossbeam crate, which provides a lot of functionality.</p>\n\n<p>Is it possible to do this <em>without</em> the use of a third party crate? If I have a vector or array, can I split it into multiple slices and have a different thread operate on each slice using only the features provided by the standard library?</p>\n"}, {"tags": ["rust", "rust-cargo"], "answers": [{"tags": [], "owner": {"reputation": 17581, "user_id": 2167834, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9699e22406fb8e57a0c90f576c610b1c?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Renauld", "link": "https://stackoverflow.com/users/2167834/s%c3%a9bastien-renauld"}, "is_accepted": true, "score": 1, "last_activity_date": 1571345088, "creation_date": 1571345088, "answer_id": 58440492, "question_id": 58439739, "link": "https://stackoverflow.com/questions/58439739/does-cargo-use-semver-with-git-tags/58440492#58440492", "title": "Does Cargo use semver with Git tags?", "body": "<p>Git tags are free-form; for example, it is perfectly possible to tag your commit as <code>foobar</code> and nobody will bat an eyelid. Semver is a common trend people use for their tags; however, is that even a constant? Some people use <code>x.y.z</code>, others <code>vx.y.z</code>.</p>\n\n<p>For that reason, cargo will pick the <strong>exact</strong> tag you specify. You can convince yourself of this by using <code>git daemon</code> to prop your repo up on a temporary port (9418 by default), and then adding the git repo and its tags. You'll see the following the moment the port is up and daemon is available (but without a valid git repo):</p>\n\n<pre><code>Caused by:\n  Unable to update http://localhost:9418/?tag=1.0.0\n</code></pre>\n\n<p>Thus confirming that the only thing cargo does is get the exact tag you mentioned. This is, once again, totally expected.</p>\n"}], "owner": {"reputation": 443, "user_id": 6317971, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8aQrQ.jpg?s=128&g=1", "display_name": "codehearts", "link": "https://stackoverflow.com/users/6317971/codehearts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "accepted_answer_id": 58440492, "answer_count": 1, "score": 0, "last_activity_date": 1571345088, "creation_date": 1571341508, "last_edit_date": 1571341711, "question_id": 58439739, "link": "https://stackoverflow.com/questions/58439739/does-cargo-use-semver-with-git-tags", "title": "Does Cargo use semver with Git tags?", "body": "<p>I'm under the impression it doesn't, but I can't find any concrete documentation on this. Does Cargo treat semver-compliant tags on Git repos the same way it does for crates on crates.io, namely that <code>cargo update</code> updates the crate to the newest non-breaking version?</p>\n\n<p>To be more specific, given the following Cargo.toml snippet and assuming the latest version of \"crate\" is 1.0.1 and a 1.0.1 tag exists for \"git_crate\", the 1.0.1 version of \"crate\" will be downloaded. Would <code>cargo install</code> fetch the 1.0.1 tag for \"git_crate\" as well, or would it use the 1.0.0 tag?</p>\n\n<pre><code>[dependencies]\ncrate = \"1.0.0\"\ngit_crate = { git = \"https://git@example.com/git_crate.git\", tag = \"1.0.0\" }\n</code></pre>\n"}, {"tags": ["linux", "networking", "tcp", "rust", "rust-tokio"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 3, "last_activity_date": 1571339156, "creation_date": 1571339156, "answer_id": 58439241, "question_id": 58439125, "link": "https://stackoverflow.com/questions/58439125/can-stdiobufreader-on-a-tcpstream-lead-to-data-loss/58439241#58439241", "title": "Can std::io::BufReader on a TcpStream lead to data loss?", "body": "<p>Yes. This is described in the <a href=\"https://doc.rust-lang.org/std/io/struct.BufReader.html\" rel=\"nofollow noreferrer\">documentation for <code>BufReader</code></a> (emphasis mine):</p>\n\n<blockquote>\n  <p>When the <code>BufReader</code> is dropped, <strong>the contents of its buffer will be discarded</strong>.</p>\n</blockquote>\n\n<p>The next sentence is <em>correct</em> but not extensive enough:</p>\n\n<blockquote>\n  <p>Creating multiple instances of a <code>BufReader</code> on the same stream can cause data loss.</p>\n</blockquote>\n\n<p>The <code>BufReader</code> has read data from the underlying source and put it in the buffer, then you've thrown away the buffer. The data is gone.</p>\n"}], "owner": {"reputation": 8448, "user_id": 995246, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/0d956964e915c9b3efd2731abb7371b0?s=128&d=identicon&r=PG&f=1", "display_name": "gliderkite", "link": "https://stackoverflow.com/users/995246/gliderkite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "accepted_answer_id": 58439241, "answer_count": 1, "score": 2, "last_activity_date": 1571340113, "creation_date": 1571338629, "last_edit_date": 1571340113, "question_id": 58439125, "link": "https://stackoverflow.com/questions/58439125/can-stdiobufreader-on-a-tcpstream-lead-to-data-loss", "title": "Can std::io::BufReader on a TcpStream lead to data loss?", "body": "<p>Can a single instance of <a href=\"https://doc.rust-lang.org/std/io/struct.BufReader.html\" rel=\"nofollow noreferrer\"><code>std::io::BufReader</code></a> on a <a href=\"https://docs.rs/tokio/0.1.12/tokio/net/struct.TcpStream.html\" rel=\"nofollow noreferrer\"><code>tokio::net::TcpStream</code></a> lead to data loss when the <code>BufReader</code> is used to <a href=\"https://docs.rs/tokio/0.1.12/tokio/io/fn.read_until.html\" rel=\"nofollow noreferrer\"><code>read_until</code></a> a given (byte) delimiter?</p>\n\n<p>That is, is there any possibility that after I use the <code>BufReader</code> for:</p>\n\n<pre><code>let buffer = Vec::new();\nlet reader = BufReader::new(tcp_stream);\ntokio::io::read_until(reader, delimiter, buffer)\n   .map(move |(s, _)| s.into_inner())\n</code></pre>\n\n<p>a following <code>tokio::io::read</code> using the same stream would return data that is actually beyond the delimiter + 1, causing therefore data loss?</p>\n\n<hr>\n\n<p>I have an issue (and <a href=\"https://gist.github.com/gliderkite/9a084ed3405f08e473c346a0d0ff0ada\" rel=\"nofollow noreferrer\">complete reproducible example on Linux</a>) that I have trouble explaining if the above assumption isn't correct. </p>\n\n<p>I have a TCP server that is supposed to send the content of a file to multiple TCP clients following multiple concurrent requests.</p>\n\n<p>Sometimes, using always the same inputs, the data received by the client is less than expected, therefore the transfer fails.</p>\n\n<p>The error is not raised 100% of the times (that is, some of the client requests still succeed), but with the 100 tries defined in <code>tcp_client.rs</code> it was always reproducible for at least one of them.</p>\n\n<p>The sequence of data transferred between client and server is composed by:</p>\n\n<ol>\n<li>the client send a request</li>\n<li>the server read the request and send a response</li>\n<li>the client read the response</li>\n<li>the server send the file data</li>\n<li>the client read the file data</li>\n</ol>\n\n<p>This issue is only reproducible only if steps 1, 2 and 3 are involved, otherwise it works as expected.</p>\n\n<p>The error is raised when this <a href=\"https://gist.github.com/gliderkite/9a084ed3405f08e473c346a0d0ff0ada#file-tcp_client-rs-L30\" rel=\"nofollow noreferrer\"><code>tokio::io::read</code></a> (used to read the file content) returns 0, as if the server closed the connection, even is the server is actually up and running, and all the data has been sent (there is an assertion after <a href=\"https://gist.github.com/gliderkite/9a084ed3405f08e473c346a0d0ff0ada#file-tcp_server-rs-L32\" rel=\"nofollow noreferrer\"><code>tokio::io::copy</code></a> and I checked the TCP packets using a packet sniffer). On a side note, in all my runs the amount of data read before the error was always > 95% than the one expected.</p>\n\n<p>Most importantly the <code>common.rs</code> module defines 2 different <code>read_*</code> functions:</p>\n\n<ul>\n<li><a href=\"https://gist.github.com/gliderkite/9a084ed3405f08e473c346a0d0ff0ada#file-common-rs-L22\" rel=\"nofollow noreferrer\"><code>read_until</code></a> currently used.</li>\n<li><a href=\"https://gist.github.com/gliderkite/9a084ed3405f08e473c346a0d0ff0ada#file-common-rs-L33\" rel=\"nofollow noreferrer\"><code>read_exact</code></a> not used.</li>\n</ul>\n\n<p>The logic of the 2 is the same, they need to read the request/response (and both client and server can be updated to use one or the other). What is surprising is that the bug presents itself only when <code>tokio::io::read_until</code> is used, while <code>tokio::io::read_exact</code> works as expected.</p>\n\n<p>Unless, I misused <code>tokio::io::read_until</code> or there is a bug in my implementation, I expected both versions to work without any issue. What I am seeing instead is <a href=\"https://gist.github.com/gliderkite/9a084ed3405f08e473c346a0d0ff0ada#file-tcp_client-rs-L46\" rel=\"nofollow noreferrer\">this panic</a> being raised because some clients cannot read all the data sent by the server. </p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 2966, "user_id": 3022310, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7f10ec2b45320ee843e539d705c31d08?s=128&d=identicon&r=PG", "display_name": "turbulencetoo", "link": "https://stackoverflow.com/users/3022310/turbulencetoo"}, "is_accepted": true, "score": 6, "last_activity_date": 1571331086, "creation_date": 1571331086, "answer_id": 58437392, "question_id": 58436950, "link": "https://stackoverflow.com/questions/58436950/argument-requires-that-is-borrowed-for-static-how-do-i-work-round-this/58437392#58437392", "title": "Argument requires that _ is borrowed for &#39;static - how do I work round this?", "body": "<p>The problem lies in the function signature of <code>value_for_num</code>.</p>\n\n<p>You indicate that you return a static reference to a <code>TestThingy</code> but have no indication what kind of references that <code>TestThingy&lt;'x&gt;</code> might hold. Thus the compiler assumes that the unspecified input reference lifetime may be tied to the unspecified output lifetime of references <em>inside</em> the <code>TestThingy</code>.</p>\n\n<p>i.e. the compiler sees this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn value_for_num&lt;'a&gt;(num: &amp;'a str) -&gt; Option&lt;&amp;'static TestThingy&lt;'a&gt;&gt;\n</code></pre>\n\n<p>If you change the signature to specify that the contained references are also static then it compiles.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn value_for_num(num: &amp;str) -&gt; Option&lt;&amp;'static TestThingy&lt;'static&gt;&gt;\n</code></pre>\n"}], "owner": {"reputation": 399, "user_id": 50878, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d4b01a9691c30a5b880d097f3eb33e45?s=128&d=identicon&r=PG", "display_name": "William Roe", "link": "https://stackoverflow.com/users/50878/william-roe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7017, "favorite_count": 1, "accepted_answer_id": 58437392, "answer_count": 1, "score": 8, "last_activity_date": 1571331086, "creation_date": 1571329179, "question_id": 58436950, "link": "https://stackoverflow.com/questions/58436950/argument-requires-that-is-borrowed-for-static-how-do-i-work-round-this", "title": "Argument requires that _ is borrowed for &#39;static - how do I work round this?", "body": "<p>I have a lifetime/borrowing error from the Rust compiler that I can't get my head around. The problem seems to be that Rust assumes that when an argument is passed to a function that returns a reference to a static value, the argument reference must also be static. </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Debug)]\nstruct TestThingy&lt;'a&gt; {\n    label: &amp;'a str,\n}\n\nconst TEST_VALUES: [TestThingy; 3] = [\n    TestThingy { label: \"one\" },\n    TestThingy { label: \"two\" },\n    TestThingy { label: \"three\" },\n];\n\npub fn value_for_num(num: &amp;str) -&gt; Option&lt;&amp;'static TestThingy&gt; {\n    TEST_VALUES.iter().find(|value| value.label == num)\n}\n\npub fn test_out_thingy() {\n    let tmp_val = String::from(\"two\");\n    if let Some(test_thingy) = value_for_num(&amp;tmp_val) {\n        println!(\"test_thingy: {:?}\", test_thingy);\n    }\n}\n\nfn main() {\n    test_out_thingy();\n}\n</code></pre>\n\n<p>Rust errors with: <code>error[E0597]: `tmp_val` does not live long enough</code> - E0597 refers to when a value gets dropped whilst its still borrowed, which isn't happening here - I don't know how to convince Rust of that though.</p>\n\n<p>The idea behind this code, for more context, is it's a lookup mechanism for compile-time/static config (in my codebase they are <code>Syntax</code> values, matched on the basis of a provided filename <code>&amp;str</code>). So the provided argument genuinely does not live as long as the static config, but I don't understand why that's a problem. The returned value doesn't/can't contain the argument as a reference, so I'm super unclear why this borrowing error is happening.</p>\n"}, {"tags": ["rust", "global-variables", "actix-web"], "comments": [{"owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "edited": false, "score": 0, "creation_date": 1571330829, "post_id": 58436748, "comment_id": 103214629, "body": "What prevents you from using the same <code>Data&lt;T&gt;</code> extractor in the second example as in the first one?"}, {"owner": {"reputation": 4459, "user_id": 127251, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9b6273d6505f5cead55793f95dbe7873?s=128&d=identicon&r=PG", "display_name": "Paul Chernoch", "link": "https://stackoverflow.com/users/127251/paul-chernoch"}, "reply_to_user": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "edited": false, "score": 0, "creation_date": 1571334475, "post_id": 58436748, "comment_id": 103216192, "body": "Nothing prevents me from doing it using the fluent interface instead of adding attributes to methods. However, my colleagues and I are familiar using Express and similar tools in node.js and C# .Net core that use attributes, and that style is more natural and easier to read (in my opinion). It is self documenting, informing the reader that the function is a route handler and telling them what route it handles concisely."}, {"owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "edited": false, "score": 0, "creation_date": 1571383624, "post_id": 58436748, "comment_id": 103230229, "body": "No, I meant using <code>Data&lt;T&gt;</code> extractor and <code>get</code> attribute together. See my answer."}], "answers": [{"comments": [{"owner": {"reputation": 4459, "user_id": 127251, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9b6273d6505f5cead55793f95dbe7873?s=128&d=identicon&r=PG", "display_name": "Paul Chernoch", "link": "https://stackoverflow.com/users/127251/paul-chernoch"}, "edited": false, "score": 0, "creation_date": 1571399722, "post_id": 58445960, "comment_id": 103238364, "body": "Thank you! I have one confusion. I know that Rust does not have method overloading. How is it that in my original code, I pass a function to the App::service method that has one method signature, while you have passed it a function with a different signature, adding in the app data?"}, {"owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "reply_to_user": {"reputation": 4459, "user_id": 127251, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9b6273d6505f5cead55793f95dbe7873?s=128&d=identicon&r=PG", "display_name": "Paul Chernoch", "link": "https://stackoverflow.com/users/127251/paul-chernoch"}, "edited": false, "score": 0, "creation_date": 1571403654, "post_id": 58445960, "comment_id": 103240486, "body": "@PaulChernoch <code>get</code> attribute is just a convenient way to say <code>web::resource(...).route(web::get().to(...))</code>. <a href=\"https://docs.rs/actix-web/1.0.8/actix_web/struct.Resource.html#method.to\" rel=\"nofollow noreferrer\"><code>actix_web::Resource.to</code></a> takes a handler of type trait <code>Factory</code>. Dig into <code>actix-web</code> source code, one can see the trait <code>Factory</code> is implemented for <a href=\"https://github.com/actix/actix-web/blob/master/src/handler.rs#L22\" rel=\"nofollow noreferrer\"><code>Fn()</code></a> and also <a href=\"https://github.com/actix/actix-web/blob/master/src/handler.rs#L401\" rel=\"nofollow noreferrer\"><code>Fn(tuple)</code></a> with no more than 10 elements. That should answer your Q."}, {"owner": {"reputation": 4459, "user_id": 127251, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9b6273d6505f5cead55793f95dbe7873?s=128&d=identicon&r=PG", "display_name": "Paul Chernoch", "link": "https://stackoverflow.com/users/127251/paul-chernoch"}, "edited": false, "score": 0, "creation_date": 1571409118, "post_id": 58445960, "comment_id": 103243552, "body": "Thanks. I tried looking in the source, but didn&#39;t know where to look!"}], "tags": [], "owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "is_accepted": true, "score": 2, "last_activity_date": 1571383853, "creation_date": 1571383853, "answer_id": 58445960, "question_id": 58436748, "link": "https://stackoverflow.com/questions/58436748/how-do-i-pass-app-data-to-service-route-handler-function-in-actix-web-when-using/58445960#58445960", "title": "How do I pass App data to service route handler function in actix-web when using function decorations?", "body": "<p>The two cases you listed really don't have much difference:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>//# actix-web = \"1.0.8\"\nuse actix_web::{get, web, App, HttpResponse, HttpServer, Responder};\nuse std::sync::Mutex;\n\nconst SERVICE_NAME : &amp;str = \"Shy Rules Engine\";\nconst SERVICE_VERSION : &amp;str  = \"0.1\";\n\nstruct MyData {\n    counter: usize,\n}\n\n#[get(\"/\")]\nfn index(data: web::Data&lt;Mutex&lt;MyData&gt;&gt;) -&gt; impl Responder {\n    let mut data = data.lock().unwrap();\n    data.counter += 1;\n    println!(\"Endpoint visited: {}\", data.counter);\n    HttpResponse::Ok().body(format!(\"{} version {}\", SERVICE_NAME, SERVICE_VERSION))\n}\n\npub fn shy_service(ip : &amp;str, port : &amp;str) {\n    let data = web::Data::new(Mutex::new(MyData{ counter: 0 }));\n\n    HttpServer::new(move || {\n        App::new()\n            .register_data(data.clone())\n            .service(index)\n    })\n    .bind(format!(\"{}:{}\", ip, port))\n    .unwrap()\n    .run()\n    .unwrap();\n}\n\nfn main() {\n    shy_service(\"127.0.0.1\", \"8080\");\n}\n</code></pre>\n\n<p>You can verify that it works by simply <code>curl</code> the http endpoint. For <a href=\"https://actix.rs/docs/extractors/\" rel=\"nofollow noreferrer\">multiple extractors</a>, you'll have to use tuple:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>    #[post(\"/expression/execute\")]\n    fn route((req, data): (web::Json&lt;ExpressionExecuteRequest&gt;, web::Data&lt;Mutex&lt;MyData&gt;&gt;)) -&gt; HttpResponse {\n        unimplemented!()\n    }\n</code></pre>\n"}], "owner": {"reputation": 4459, "user_id": 127251, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9b6273d6505f5cead55793f95dbe7873?s=128&d=identicon&r=PG", "display_name": "Paul Chernoch", "link": "https://stackoverflow.com/users/127251/paul-chernoch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1728, "favorite_count": 0, "accepted_answer_id": 58445960, "answer_count": 1, "score": 1, "last_activity_date": 1571383853, "creation_date": 1571328466, "question_id": 58436748, "link": "https://stackoverflow.com/questions/58436748/how-do-i-pass-app-data-to-service-route-handler-function-in-actix-web-when-using", "title": "How do I pass App data to service route handler function in actix-web when using function decorations?", "body": "<p>I found in the docs an example of how to create global state, protected by Mutex, shared among processing threads that is made available to all your route handlers. Perfect! However, I prefer to use attributes attached to my functions to wire up my route handlers. I do not know the syntax (if permitted) to use attributed functions and also pass in the global state. </p>\n\n<p>Here is the example from the actix-web docs, from <a href=\"https://docs.rs/actix-web/1.0.2/actix_web/web/struct.Data.html\" rel=\"nofollow noreferrer\">https://docs.rs/actix-web/1.0.2/actix_web/web/struct.Data.html</a></p>\n\n<pre><code>use std::sync::Mutex;\nuse actix_web::{web, App};\n\nstruct MyData {\n    counter: usize,\n}\n\n/// Use `Data&lt;T&gt;` extractor to access data in handler.\nfn index(data: web::Data&lt;Mutex&lt;MyData&gt;&gt;) {\n    let mut data = data.lock().unwrap();\n    data.counter += 1;\n}\n\nfn main() {\n    let data = web::Data::new(Mutex::new(MyData{ counter: 0 }));\n\n    let app = App::new()\n        // Store `MyData` in application storage.\n        .register_data(data.clone())\n        .service(\n            web::resource(\"/index.html\").route(\n                web::get().to(index)));\n}\n</code></pre>\n\n<p>Notice how the route handler named <code>index</code> is being passed the <code>web::Data</code>.</p>\n\n<p>Now here are some snippets of my code.</p>\n\n<pre><code>use actix_web::{get, App, HttpResponse, HttpServer, Responder};\npub mod request;\npub mod routes;\n\nconst SERVICE_NAME : &amp;str = \"Shy Rules Engine\";\nconst SERVICE_VERSION : &amp;str  = \"0.1\";\n\n#[get(\"/\")]\nfn index() -&gt; impl Responder {\n    HttpResponse::Ok().body(format!(\"{} version {}\", SERVICE_NAME, SERVICE_VERSION))\n}\n\nmod expression_execute {\n\n  #[post(\"/expression/execute\")]\n  fn route(req: web::Json&lt;ExpressionExecuteRequest&gt;) -&gt; HttpResponse {\n\n    // ... lots of code omitted ...\n\n    if response.has_error() {\n        HttpResponse::Ok().json(response)\n    }\n    else {\n        HttpResponse::BadRequest().json(response)\n    }\n  }\n\n}\n\npub fn shy_service(ip : &amp;str, port : &amp;str) {\n    HttpServer::new(|| {\n        App::new()\n            .service(index)\n            .service(expression_execute::route)\n    })\n    .bind(format!(\"{}:{}\", ip, port))\n    .unwrap()\n    .run()\n    .unwrap();\n}\n\n</code></pre>\n\n<p>Notice how I am calling method <code>App::service</code> to wire up my route handlers.</p>\n\n<p>Also notice how my route handler does not receive global state (because I have not yet added it to my app). If I used a similar pattern as the docs using <code>register_data</code> to create global App data, what changes do I make to my method signature, the <code>get</code> and <code>post</code> attributes and anything else so that I can pass that global state to the handler?</p>\n\n<p>Or is it not possible using <code>get</code> and <code>post</code> attributes to gain access to global state?</p>\n"}, {"tags": ["rust", "rust-macros"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1571391707, "post_id": 58434851, "comment_id": 103234306, "body": "You cannot. Those macros are only aware of the kind of token (expression, identifier, etc.) You cannot actually get an information that is ahead of that, like a type information. You must use another way than <code>Option&lt;X&gt;</code> to express the fact that <code>X</code> is optional."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 2, "creation_date": 1571409488, "post_id": 58434851, "comment_id": 103243741, "body": "Macros can distinguish between <code>X</code> and <code>Option&lt;X&gt;</code> on the syntactic level, but if you used another syntax like <code>std::option::Option&lt;X&gt;</code> or <code>SomeTypeAliasThatHappensToBeOption&lt;X&gt;</code> or <code>SomeType::SomeAssociatedTypeThatHappensToBeOption&lt;X&gt;</code> it would be wrong. Paths, type aliases and trait implementations are all resolved after macro expansion."}, {"owner": {"reputation": 30359, "user_id": 255688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74b63650ed07d745fd9accf52e4d286b?s=128&d=identicon&r=PG", "display_name": "phimuemue", "link": "https://stackoverflow.com/users/255688/phimuemue"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1571410444, "post_id": 58434851, "comment_id": 103244245, "body": "@FrenchBoiethios I do not think that it is really impossible. I think you can acchieve a (reasonably close) solution to this problem."}], "answers": [{"comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571409301, "post_id": 58452912, "comment_id": 103243642, "body": "I had the same idea; here&#39;s as far as I got: <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=10bfa087ea70f39ef2acce337e24d852\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a> The problem is that <code>$ftype:ty</code> in <code>make_table_struct</code> will not match <code>Option&lt;...&gt;</code>, so it needs to be <code>$ftype:tt</code> so that it can be broken down further; at least, that&#39;s my thought. I don&#39;t understand the error message. Perhaps someone with more experience writing macros can finish putting the pieces together"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1571410596, "post_id": 58452912, "comment_id": 103244337, "body": "Yes, this is possible to match the literal <code>Option</code> token, but as @trentcl said, any other wording of the type (full path, alias, etc.) will invalidate the macro."}, {"owner": {"reputation": 30359, "user_id": 255688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74b63650ed07d745fd9accf52e4d286b?s=128&d=identicon&r=PG", "display_name": "phimuemue", "link": "https://stackoverflow.com/users/255688/phimuemue"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571411194, "post_id": 58452912, "comment_id": 103244643, "body": "@trentcl I agree that it is a bit annoying to flesh out all the details, but I think it is doable (see answer)."}, {"owner": {"reputation": 30359, "user_id": 255688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74b63650ed07d745fd9accf52e4d286b?s=128&d=identicon&r=PG", "display_name": "phimuemue", "link": "https://stackoverflow.com/users/255688/phimuemue"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1571411279, "post_id": 58452912, "comment_id": 103244690, "body": "@FrenchBoiethios You are right about this, but if the scope of all this is narrow enough, you might be able to use a solution like this."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1571411458, "post_id": 58452912, "comment_id": 103244771, "body": "At the OP&#39;s place, I&#39;d use something like <code>attrib_b: nullable i64</code>."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1571413657, "post_id": 58452912, "comment_id": 103245812, "body": "The way you&#39;re doing it, you can (and probably should) use <code>$ftype:ty</code>. <code>tt</code> was an attempt to solve a problem that your example doesn&#39;t have because it makes <code>nonnullable</code>/<code>nullable</code> part of the syntax explicitly."}], "tags": [], "owner": {"reputation": 30359, "user_id": 255688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/74b63650ed07d745fd9accf52e4d286b?s=128&d=identicon&r=PG", "display_name": "phimuemue", "link": "https://stackoverflow.com/users/255688/phimuemue"}, "is_accepted": true, "score": 3, "last_activity_date": 1592480272, "last_edit_date": 1592480272, "creation_date": 1571408985, "answer_id": 58452912, "question_id": 58434851, "link": "https://stackoverflow.com/questions/58434851/how-can-i-handle-or-test-if-a-type-is-an-option-in-a-rust-macro/58452912#58452912", "title": "How can I handle or test if a type is an Option in a Rust macro?", "body": "<p>Here's a macro that takes a <code>$fname</code> and a type, which may be optional. If the type is optional, it generates another function than if is not:</p>\n\n<pre><code>macro_rules! make_get_row {\n    ($fname: ident, Option&lt;$ftype: ty&gt;) =&gt; {\n        fn $fname(i: Option&lt;$ftype&gt;) -&gt; i64 {\n            i.unwrap_or(0)\n        }\n    };\n    ($fname: ident, $ftype: ty) =&gt; {\n        fn $fname(i: $ftype) -&gt; i64 {\n            i\n        }\n    };\n}\n\nmake_get_row!(direct, i64);\nmake_get_row!(via_op, Option&lt;i64&gt;);\n\nfn main() {\n    direct(1);\n    via_op(Some(1));\n}\n</code></pre>\n\n<p>You should be able to use a (possibly adjusted) variant of this macro within <code>make_table_struct</code>.</p>\n\n<p>The following is not production quality, but might lead you somewhere:</p>\n\n<pre><code>macro_rules! get_table_row {\n    ($row: ident, nonnullable $fname:ident: $ftype:ty) =&gt; {\n        $row.get::&lt;_,$ftype&gt;(stringify!($fname))\n    };\n    ($row: ident, nullable $fname:ident: $ftype:ty) =&gt; {\n        match $row.get::&lt;_,Option&lt;Option&lt;$ftype&gt;&gt;&gt;(stringify!($fname)) { Some(x) =&gt; x, None =&gt; Some(0) }\n    }\n}\ntype nullable&lt;T&gt; = Option&lt;T&gt;;\ntype nonnullable&lt;T&gt; = T;\nmacro_rules! make_table_struct {\n    ($tname:stmt =&gt; $sname:ident; $($nul: ident $fname:ident: $ftype:tt),+) =&gt; {\n\n        #[derive(Debug, Clone, Default)]\n        pub struct $sname {\n            $(\n                pub $fname: $nul &lt; $ftype &gt;,\n            )+\n        }\n\n        impl $sname {\n            pub fn get_row(&amp;self, row: &amp;postgres::rows::Row) -&gt; $sname {\n                $(\n                    let $fname = get_table_row!(row, $nul $fname: $ftype);\n                )+\n                $sname {\n                    $($fname,)+\n                }\n            }\n        }\n    }\n}\n\nmake_table_struct! (\"source_table_name\" =&gt; MyStruct; nonnullable attrib_a: i64, nullable attrib_b: i64);\n</code></pre>\n"}], "owner": {"reputation": 1976, "user_id": 1622475, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/94a2da046a4b68cdaaa274f822e7804e?s=128&d=identicon&r=PG", "display_name": "Toni Kanoni", "link": "https://stackoverflow.com/users/1622475/toni-kanoni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 432, "favorite_count": 0, "accepted_answer_id": 58452912, "answer_count": 1, "score": 1, "last_activity_date": 1592480272, "creation_date": 1571322094, "last_edit_date": 1571425656, "question_id": 58434851, "link": "https://stackoverflow.com/questions/58434851/how-can-i-handle-or-test-if-a-type-is-an-option-in-a-rust-macro", "title": "How can I handle or test if a type is an Option in a Rust macro?", "body": "<p>I am trying to create a macro to generate a struct which can be filled from a postgres-database.\nNow, as there are fields in the db which are nullable and non-nullable, I'd want to handle them differently in the macro.</p>\n\n<p>Output should be a struct like this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(Debug, Default)]\npub struct MyStruct {\n    pub attrib_a: i64,\n    pub attrib_b: Option&lt;i64&gt;,\n}\n\nimpl MyStruct {\n    pub fn get_row(&amp;self, row: &amp;postgres::rows::Row) -&gt; MyStruct {\n        MyStruct {\n            // the non-nullable attrib_a, where I can for sure take the value out of the Option and assign it\n            attrib_a: match row.get::&lt;_, Option&lt;i64&gt;&gt;(\"attrib_a\") {\n                Some(x) =&gt; x,\n                None =&gt; 0,\n            },\n\n            // here for the nullable attrib_b I just want to return the Option as is\n            attrib_b: row.get::&lt;_, Option&lt;i64&gt;&gt;(\"attrib_b\"),\n        }\n    }\n}\n</code></pre>\n\n<p>Here's the current macro code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>macro_rules! make_table_struct {\n    ($tname: stmt =&gt; $sname: ident; $($fname: ident: $ftype: ty),+) =&gt; {\n\n        #[derive(Debug, Clone, Default)]\n        pub struct $sname {\n            $(\n                pub $fname: $ftype,\n            )+\n        }\n\n        impl $sname\n        {\n            pub fn get_row(&amp;self,row:&amp;postgres::rows::Row)-&gt;$sname\n            {\n                $sname\n                {\n                    //How do I know if I have an Option here or not and act then accordingly?\n                    $(\n                        $fname: row.get::&lt;_,Option&lt;$ftype&gt;&gt;(stringify!($fname)),\n                    )+\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Macro-call:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>make_table_struct! (\"source_table_name\" =&gt; MyStruct; attrib_a: i64, attrib_b: Option&lt;i64&gt;)\n</code></pre>\n"}, {"tags": ["c", "rust", "automake"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 3, "creation_date": 1571321800, "post_id": 58434698, "comment_id": 103209828, "body": "what the problem using cargo in a makefile or whatever ?"}, {"owner": {"reputation": 20255, "user_id": 645128, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/G0V8Q.jpg?s=128&g=1", "display_name": "ryyker", "link": "https://stackoverflow.com/users/645128/ryyker"}, "edited": false, "score": 0, "creation_date": 1571322057, "post_id": 58434698, "comment_id": 103210002, "body": "Not sure if <i><a href=\"https://www.greyblake.com/blog/2017-08-10-exposing-rust-library-to-c/\" rel=\"nofollow noreferrer\">this will help</a></i>."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1571328484, "post_id": 58434698, "comment_id": 103213585, "body": "What&#39;s the problem, specifically? I can understand not wanting to use a hybrid approach but what&#39;s the problem with just calling rustc in your Makefile (or whatever)? What have you tried / are you thinking about trying and what&#39;s wrong with it?"}], "answers": [{"tags": [], "owner": {"reputation": 90851, "user_id": 27009, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f0a29af415477aa8c498a4f41ffe6640?s=128&d=identicon&r=PG", "display_name": "Kornel", "link": "https://stackoverflow.com/users/27009/kornel"}, "is_accepted": false, "score": 0, "last_activity_date": 1572578955, "creation_date": 1572578955, "answer_id": 58653757, "question_id": 58434698, "link": "https://stackoverflow.com/questions/58434698/how-to-use-rust-code-in-a-c-project-while-not-changing-the-build-system/58653757#58653757", "title": "How to use rust code in a C project while not changing the build system?", "body": "<p><code>rustc</code> can be called in a similar fashion to <code>cc</code> and produce a C-compatible static library. If you're adding only a small bit of Rust that doesn't use Cargo dependencies, this may be easy to integrate into C build systems.</p>\n\n<p>However, by using <code>rustc</code> directly you lose access to Cargo, and it'll make use of dependencies as hard and painful as C deps, except Rust programs are used to using hundreds of dependencies.</p>\n\n<p>So the easy way out is to call <code>cargo build --release</code> from an existing build system. </p>\n"}], "owner": {"reputation": 19, "user_id": 9312658, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Xz4SaXq32wA/AAAAAAAAAAI/AAAAAAAAAFE/aOkK1o8fsTE/photo.jpg?sz=128", "display_name": "Arka Ray", "link": "https://stackoverflow.com/users/9312658/arka-ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1572578955, "creation_date": 1571321588, "question_id": 58434698, "link": "https://stackoverflow.com/questions/58434698/how-to-use-rust-code-in-a-c-project-while-not-changing-the-build-system", "title": "How to use rust code in a C project while not changing the build system?", "body": "<p>I was trying to port nano to rust and using but I don't want to change the build system or nor have two concurrent build system on the same project.</p>\n\n<p>For using rust in a C project I found <a href=\"https://rust-embedded.github.io/book/interoperability/rust-with-c.html\" rel=\"nofollow noreferrer\">this guide</a> but this needs me to either change the build system or use a hybrid approach (i.e. use two build systems at the same time).</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 4324346, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002371845307/picture?type=large", "display_name": "Mike Kanzler", "link": "https://stackoverflow.com/users/4324346/mike-kanzler"}, "edited": false, "score": 0, "creation_date": 1571319303, "post_id": 58431844, "comment_id": 103208322, "body": "Thanks you, very easy then you know how to write it. The same should be applied to save method of image?"}], "tags": [], "owner": {"reputation": 1925, "user_id": 2865757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dcfe7782349d59e50b1fa196f9c6669?s=128&d=identicon&r=PG&f=1", "display_name": "Zefick", "link": "https://stackoverflow.com/users/2865757/zefick"}, "is_accepted": true, "score": 0, "last_activity_date": 1571312588, "creation_date": 1571312588, "answer_id": 58431844, "question_id": 58428847, "link": "https://stackoverflow.com/questions/58428847/convert-to-f32-in-trait-implementation-of-generic/58431844#58431844", "title": "Convert to f32 in trait implementation of generic", "body": "<p>The implementation of the <code>gray</code> method should look like this:</p>\n\n<pre><code>impl&lt;T&gt; Pixel&lt;T&gt; for RgbaGeneric&lt;T&gt; where\n        f32: std::convert::From&lt;T&gt;,\n        T: std::convert::From&lt;f32&gt;{\n    fn red(&amp;self) -&gt; T { return self.r;}\n    fn green(&amp;self) -&gt; T { return self.g; }\n    fn blue(&amp;self) -&gt; T { return self.b; }\n    fn alpha(&amp;self) -&gt; T { return self.a; }\n    fn gray(&amp;self) -&gt; T {\n       return (Into::&lt;f32&gt;::into(self.r) * 0.21 +\n               Into::&lt;f32&gt;::into(self.g) * 0.72 +\n               Into::&lt;f32&gt;::into(self.b) * 0.07).into();\n    }\n}\n</code></pre>\n\n<p>In the block's header, we say that our <code>T</code> may be converted to and from <code>f32</code> type and then we use <code>into()</code> method because <code>as</code> expression can only be used to convert between primitive types (compiler implies that <code>T</code> may be any type).</p>\n"}], "owner": {"reputation": 43, "user_id": 4324346, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002371845307/picture?type=large", "display_name": "Mike Kanzler", "link": "https://stackoverflow.com/users/4324346/mike-kanzler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 58431844, "answer_count": 1, "score": 0, "last_activity_date": 1571312588, "creation_date": 1571303108, "question_id": 58428847, "link": "https://stackoverflow.com/questions/58428847/convert-to-f32-in-trait-implementation-of-generic", "title": "Convert to f32 in trait implementation of generic", "body": "<p>To learn rust i tried to implement a generic image class/object. </p>\n\n<p>I have problem with the Image::save(...) function and the implementation from Pixel::gray() of RgbaGeneric. </p>\n\n<p>The compiler say i have to use From or Into trait. But i dont know how the syntax has to look. All atempts to get it works fails.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>mod image {\n    use std::fmt;\n\n    use std::path::Path;\n    use std::io::Write;\n    use std::fs::File;\n\n    #[derive(Clone, Debug)]\n    pub struct RgbaGeneric&lt;T&gt; {\n        r: T, g: T, b: T, a: T,\n    }\n\n    trait Pixel&lt;T&gt; {\n        fn red(&amp;self) -&gt; T;\n        fn green(&amp;self) -&gt; T;\n        fn blue(&amp;self) -&gt; T;\n        fn alpha(&amp;self) -&gt; T;\n        fn gray(&amp;self) -&gt; T;\n    }\n\n    impl&lt;T&gt; Pixel&lt;T&gt; for RgbaGeneric&lt;T&gt; {\n        fn red(&amp;self) -&gt; T { return self.r;}\n        fn green(&amp;self) -&gt; T { return self.g; }\n        fn blue(&amp;self) -&gt; T { return self.b; }\n        fn alpha(&amp;self) -&gt; T { return self.a; }\n        fn gray(&amp;self) -&gt; T {\n           return (self.r as f32 * 0.21 +\n                   self.g as f32 * 0.72 +\n                   self.b  as f32 * 0.07) as T;\n        }\n    }\n\n    impl&lt;T&gt; RgbaGeneric&lt;T&gt; {\n        pub fn new(r: T, g: T, b: T, a: T) -&gt; RgbaGeneric&lt;T&gt; {\n            RgbaGeneric { r, g, b, a }\n        }\n    }\n\n    pub type RgbaU8 = RgbaGeneric&lt;u8&gt;;\n\n    pub struct Image&lt;T&gt; {\n        width: usize, height: usize, data: Vec&lt;T&gt;,\n    }\n\n    pub type ImageRgbaU8 = Image&lt;RgbaU8&gt;;\n\n    impl&lt;T&gt; Image&lt;T&gt;\n    where\n        T: Clone + Pixel&lt;T&gt;\n    {\n        pub fn new(width: usize, height: usize, val: T) -&gt; Image&lt;T&gt; {\n            Image {\n                width,\n                height,\n                data: vec![val; width * height],\n            }\n        }\n\n        pub fn width(&amp;self) -&gt; usize { return self.width; }\n        pub fn height(&amp;self) -&gt; usize { return self.height; }\n        pub fn pixel_count(&amp;self) -&gt; usize {\n            return self.width * self.height;\n        }\n\n        pub fn pixels(&amp;self) -&gt; &amp;[T] { return self.data.as_slice(); }\n\n        pub fn pixel(&amp;self, x: usize, y: usize) -&gt; &amp;T {\n            return &amp;self.data[self.index(x, y)];\n        }\n\n        pub fn set_pixel(&amp;mut self, x: usize, y: usize, pixel: T) {\n            let idx = self.index(x, y);\n            self.data[idx] = pixel;\n        }\n\n        pub fn save(&amp;self, filename: &amp;str) -&gt; std::io::Result&lt;()&gt; {\n            let path = Path::new(filename);\n            let mut file = try!(File::create(&amp;path));\n            let header = format!(\"P6 {} {} 255\\n\", self.width, self.height);\n            try!(file.write(header.as_bytes()));\n            for y in 0..self.height() {\n                for x in 0..self.width() {\n                    let pix = self.pixel(x,y);\n                    try!(file.write(pix.red()));\n                    try!(file.write(pix.green()));\n                    try!(file.write(pix.blue()));\n                }\n            }\n            return Ok(());\n        }\n\n        fn index(&amp;self, x: usize, y: usize) -&gt; usize {\n            return y * &amp;self.width + x;\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["struct", "rust", "traits"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 1, "creation_date": 1571301275, "post_id": 58428100, "comment_id": 103197528, "body": "Do you <i>really</i> want to copy three vectors every time you use the transaction struct, every time you pass it to a function ? What&#39;s your real problem ? Copying a struct doesn&#39;t involve using the <code>Copy</code> trait."}, {"owner": {"reputation": 2058, "user_id": 3958875, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f6149ddd4636bcab17c52b751d79f7fd?s=128&d=identicon&r=PG&f=1", "display_name": "Prime_Aqasix", "link": "https://stackoverflow.com/users/3958875/prime-aqasix"}, "edited": false, "score": 0, "creation_date": 1571301321, "post_id": 58428100, "comment_id": 103197562, "body": "Do you mean <code>Copy</code> or <code>Clone</code>, in rust it is somewhat different."}, {"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "reply_to_user": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "edited": false, "score": 0, "creation_date": 1571301373, "post_id": 58428100, "comment_id": 103197596, "body": "@edwardw I don&#39;t think this is a duplicate because it&#39;s a XY question IMO."}, {"owner": {"reputation": 9280, "user_id": 794457, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d564695b517c0a1080a887633a40b1e?s=128&d=identicon&r=PG", "display_name": "edwardw", "link": "https://stackoverflow.com/users/794457/edwardw"}, "reply_to_user": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1571301476, "post_id": 58428100, "comment_id": 103197649, "body": "@DenysS&#233;guret the answer to that question also answered this one IMO."}, {"owner": {"reputation": 144, "user_id": 5613164, "user_type": "registered", "profile_image": "https://graph.facebook.com/959533824107532/picture?type=large", "display_name": "Micha\u0142 Hanusek", "link": "https://stackoverflow.com/users/5613164/micha%c5%82-hanusek"}, "edited": false, "score": 0, "creation_date": 1571302855, "post_id": 58428100, "comment_id": 103198433, "body": "The documentation shows that there is no implementation for the &#39;Copy&#39; Vec &lt;T&gt; trait. I understand that this should be implemented."}, {"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1571303013, "post_id": 58428100, "comment_id": 103198535, "body": "Why do you think you need to implement the <code>Copy</code> trait ? It&#39;s not needed to copy values and you should <i>not</i> use it for big values like vectors."}, {"owner": {"reputation": 144, "user_id": 5613164, "user_type": "registered", "profile_image": "https://graph.facebook.com/959533824107532/picture?type=large", "display_name": "Micha\u0142 Hanusek", "link": "https://stackoverflow.com/users/5613164/micha%c5%82-hanusek"}, "edited": false, "score": 0, "creation_date": 1571303473, "post_id": 58428100, "comment_id": 103198818, "body": "Denys, I will use small vectors (2 elements). I bypassed this problem - instead of Vec &lt;u8&gt; I used arrays. But I still don&#39;t have the answer. As it should be written using Vec &lt;u8&gt;."}, {"owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "edited": false, "score": 0, "creation_date": 1571303868, "post_id": 58428100, "comment_id": 103199053, "body": "@Micha\u0142Hanusek: There is no way to implement Copy for your type. The Copy trait is for types that can be bitwise copied, and it requires that all members implement Copy. Vec does not implement Copy (because it cannot be bitwise copied), therefore your type cannot implement Copy. If you simply want to be able to duplicate an object, use Clone."}], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1571308578, "post_id": 58429008, "comment_id": 103201841, "body": "&quot;But I still don&#39;t understand why you can&#39;t use vectors in a structure and copy it.&quot; just read the duplicate - -"}], "tags": [], "owner": {"reputation": 144, "user_id": 5613164, "user_type": "registered", "profile_image": "https://graph.facebook.com/959533824107532/picture?type=large", "display_name": "Micha\u0142 Hanusek", "link": "https://stackoverflow.com/users/5613164/micha%c5%82-hanusek"}, "is_accepted": true, "score": -2, "last_activity_date": 1571303663, "creation_date": 1571303663, "answer_id": 58429008, "question_id": 58428100, "link": "https://stackoverflow.com/questions/58428100/how-to-implement-copy-trait-for-custom-struct/58429008#58429008", "title": "How to implement Copy trait for Custom struct?", "body": "<p>I'm solved this problem:\nI used tables [u8; 2] instead of Vec .</p>\n\n<p>But I still don't understand why you can't use vectors in a structure and copy it.</p>\n\n<pre><code>#[derive(PartialOrd, Eq, Copy, Clone, Hash)]\nstruct Transaction {\n    transaction_id: [u8; 2],\n    proto_id:  [u8; 2],\n    len_field: [u8; 2],\n    unit_id: u8,\n    func_nr: u8,\n    count_bytes: u8,\n}\n\nimpl PartialEq for Transaction {\n    fn eq(&amp;self, other: &amp;Self) -&gt; bool {\n        self.unit_id == other.unit_id\n            &amp;&amp; self.func_nr == other.func_nr\n            &amp;&amp; self.count_bytes == other.count_bytes\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 144, "user_id": 5613164, "user_type": "registered", "profile_image": "https://graph.facebook.com/959533824107532/picture?type=large", "display_name": "Micha\u0142 Hanusek", "link": "https://stackoverflow.com/users/5613164/micha%c5%82-hanusek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1795, "favorite_count": 0, "closed_date": 1571665698, "accepted_answer_id": 58429008, "answer_count": 1, "score": 0, "last_activity_date": 1571303663, "creation_date": 1571300775, "last_edit_date": 1571301596, "question_id": 58428100, "link": "https://stackoverflow.com/questions/58428100/how-to-implement-copy-trait-for-custom-struct", "closed_reason": "Duplicate", "title": "How to implement Copy trait for Custom struct?", "body": "<p>I have my custom struct - Transaction, I would like I could copy it.</p>\n\n<blockquote>\n  <p>This fails because Vec does not implement Copy for any T. <a href=\"https://doc.rust-lang.org/stable/error-index.html#E0204\" rel=\"nofollow noreferrer\">E0204</a></p>\n</blockquote>\n\n<p>How to implement copy to Vec and my struct. I am asking for an example.</p>\n\n<p><a href=\"https://gist.github.com/72fd4cb07634e186027cd4329e1e766b\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<pre><code>#[derive(PartialOrd, Eq, Hash)]\nstruct Transaction {\n    transaction_id: Vec&lt;u8&gt;,\n    proto_id: Vec&lt;u8&gt;,\n    len_field: Vec&lt;u8&gt;,\n    unit_id: u8,\n    func_nr: u8,\n    count_bytes: u8,\n}\n\nimpl Copy for Transaction { }\n\nimpl Clone for Transaction {\n    fn clone(&amp;self) -&gt; Transaction {\n        *self\n    }\n}\n\nimpl PartialEq for Transaction {\n    fn eq(&amp;self, other: &amp;Self) -&gt; bool {\n        self.unit_id == other.unit_id\n            &amp;&amp; self.func_nr == other.func_nr\n            &amp;&amp; self.count_bytes == other.count_bytes\n    }\n}\n\nfn main() \n{\n}\n</code></pre>\n"}, {"tags": ["rust", "openssl"], "answers": [{"tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": true, "score": 2, "last_activity_date": 1571296515, "last_edit_date": 1571296515, "creation_date": 1571293727, "answer_id": 58426205, "question_id": 58426023, "link": "https://stackoverflow.com/questions/58426023/encrypt-decrypt-large-text-using-rusts-openssl-library/58426205#58426205", "title": "Encrypt/Decrypt Large text using rust&#39;s openssl library", "body": "<p>Those characters are <code>NUL</code> bytes. They come from two areas in your code:</p>\n\n<ul>\n<li>Those at the beginning come from your <code>decrypt_data_with_prikey</code> function. That function:\n\n<ul>\n<li>Initializes its output vector with <code>data_len</code> zeroes;</li>\n<li>Then <em>appends</em> the decrypted data to this vector. The initial zeroes are never removed nor overwritten. Replace <code>let mut decrypted_data: Vec&lt;u8&gt; = vec![0; data_len]</code> with <code>let mut decrypted_data = Vec::new()</code> to start with an empty vector or <code>let mut decrypted_data = Vec::with_capacity (data_len)</code> if you want to pre-allocate the memory for the data.</li>\n</ul></li>\n<li>Those at the end come from the padding that you add during encryption. You will need to somehow convey the amount of padding that was added from the encryption function to the decryption function so that you can truncate the decrypted data to the appropriate length.</li>\n</ul>\n\n<hr>\n\n<p>As a somewhat unrelated note, when encrypting data with a public/private key pair, it is usually recommended to:</p>\n\n<ul>\n<li>Create a random <em>symmetric</em> key;</li>\n<li>Encrypt that symmetric key with the public key;</li>\n<li>Encrypt the data with the symmetric key;</li>\n<li>Add the encrypted symmetric key in a header so that the receiver can know it.</li>\n</ul>\n\n<p>This approach has two advantages:</p>\n\n<ul>\n<li>Increased speed since symmetric cyphers are <em>much</em> faster than asymmetric.</li>\n<li>Increased security because it leaks less information about the asymmetric key pair, so even if an attacker manages to decrypt a message, she will not be able to decrypt other messages that use the same key pair.</li>\n</ul>\n"}], "owner": {"reputation": 1327, "user_id": 3656414, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/e61d1247b5d7ea2f20d4b7371d671dc7?s=128&d=identicon&r=PG&f=1", "display_name": "rapidclock", "link": "https://stackoverflow.com/users/3656414/rapidclock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1044, "favorite_count": 0, "accepted_answer_id": 58426205, "answer_count": 1, "score": 0, "last_activity_date": 1571296515, "creation_date": 1571292836, "question_id": 58426023, "link": "https://stackoverflow.com/questions/58426023/encrypt-decrypt-large-text-using-rusts-openssl-library", "title": "Encrypt/Decrypt Large text using rust&#39;s openssl library", "body": "<p>I am trying to write an API to use rust's openssl wrapper library to encrypt/decrypt files.</p>\n\n<p>This is the library : <a href=\"https://docs.rs/openssl/0.10.25/openssl/index.html\" rel=\"nofollow noreferrer\">https://docs.rs/openssl/0.10.25/openssl/index.html</a></p>\n\n<p>All the examples in the documentation, show how to encrypt short strings using Padding. I want to encrypt possibly long files.</p>\n\n<p>The problem is I can only encrypt up to the length of the key(using <code>Padding::NONE</code>). I want to possibly encrypt longer pieces of data.</p>\n\n<p>So in order to get around that problem, I break the data into chunks, encrypt/decrypt each chunk, append the encrypted/decrypted chunk into a result Vector. I then write it to file &amp; read from file to vector before decrypting the same.</p>\n\n<p>Outline of what I do:</p>\n\n<ol>\n<li>Load/Generate public/private keys.</li>\n<li>Load the file to encrypt into a <code>Vec&lt;u8&gt;</code> (or string slice, ultimately)</li>\n<li>Use public key to encrypt the data</li>\n<li>Write this encrypted data to a file</li>\n<li>Load the file with encrypted data to a <code>Vec&lt;u8&gt;</code></li>\n<li>Decrypt using private key</li>\n<li>Write decrypted data to another file.</li>\n<li>Compare original to decrypted data.</li>\n</ol>\n\n<p>Code is here (Beware - I copy-pasted stuff to one block below, originally they were in separate modules/files)\nI generate the rsa key initially like </p>\n\n<pre><code>fn generate_rsa_key_pair() -&gt; utils::Pair&lt;Vec&lt;u8&gt;, Vec&lt;u8&gt;&gt; {\n    let rsa = Rsa::generate(4096).unwrap();\n\n    let public_pem = rsa.public_key_to_pem().unwrap();\n    let private_pem = rsa.private_key_to_pem().unwrap();\n\n    Pair::new(public_pem, private_pem) // custom data structure (basically a tuple)\n}\n</code></pre>\n\n<p>I then write them to a file and use the keys from the file for subsequent runs.</p>\n\n<pre><code>extern crate openssl;\n\nuse openssl::pkey::{Private, Public};\nuse openssl::rsa::{Padding, Rsa};\nuse std::cmp::max;\nuse std::io::{BufWriter, Result, Write};\nuse std::str;\n\nfn main() {\n    let (public, private) = generate_rsa_from_files();\n    let data = read_file_into_binary_vec(\"./resources/example_text.txt\").unwrap();\n    let enc_data = encrypt_data_with_pubkey(data.as_slice(), public).unwrap();\n    println!(\"{:?}\", enc_data);\n    binary_slice_to_file(enc_data.as_slice(), \"./resources/example_enc.txt\").unwrap();\n    let dec_data = decrypt_data_with_prikey(enc_data.as_slice(), private).unwrap();\n    println!(\"{}\", str::from_utf8(dec_data.as_slice()).unwrap());\n    binary_slice_to_file(dec_data.as_slice(), \"./resources/example_dec.txt\").unwrap();\n}\n\nfn generate_rsa_from_files() -&gt; (Vec&lt;u8&gt;, Vec&lt;u8&gt;) {\n    let public = read_file_into_binary_vec(\"./resources/public_key\").unwrap();\n    let private = read_file_into_binary_vec(\"./resources/private_key\").unwrap();\n    (public, private)\n}\n\nfn read_file_into_binary_vec(file_path: &amp;str) -&gt; Result&lt;Vec&lt;u8&gt;&gt; {\n    std::fs::read(file_path)\n}\n\nfn binary_slice_to_file(data: &amp;[u8], file_path: &amp;str) -&gt; Result&lt;()&gt; {\n    let file = std::fs::File::create(file_path)?;\n    let mut buf_writer = BufWriter::new(file);\n    buf_writer.write_all(data)\n}\n\nfn encrypt_data_with_pubkey(data: &amp;[u8], pub_key: Vec&lt;u8&gt;) -&gt; Result&lt;Vec&lt;u8&gt;&gt; {\n    let data_len = data.len();\n    let public_rsa: Rsa&lt;Public&gt; = Rsa::public_key_from_pem(pub_key.as_slice())?;\n    let buf_len = public_rsa.size() as usize;\n    let mut buffer: Vec&lt;u8&gt; = vec![0; buf_len];\n    let mut encrypted_data: Vec&lt;u8&gt; = Vec::with_capacity(max(data_len, buf_len));\n    println!(\"{}\", public_rsa.size());\n    for chunk in data.chunks(buf_len) {\n        println!(\"Encrypting (len = {}): {:?}\", chunk.len(), chunk);\n        let chunk_mod;\n        if chunk.len() &lt; buf_len {\n            chunk_mod = pad_chunk_to_size(chunk, buf_len);\n        } else {\n            chunk_mod = Vec::from(chunk);\n        }\n        let chunk_mod = chunk_mod.as_slice();\n        println!(\"Encrypting (len = {}): {:?}\", chunk_mod.len(), chunk_mod);\n        let enc_len = public_rsa\n            .public_encrypt(chunk_mod, buffer.as_mut_slice(), Padding::NONE)\n            .expect(\"Error Encrypting\");\n        println!(\"Enc Data Len : {}\", enc_len);\n        encrypted_data.extend_from_slice(buffer.as_slice());\n    }\n    Ok(encrypted_data)\n}\n\nfn decrypt_data_with_prikey(enc_data: &amp;[u8], priv_key: Vec&lt;u8&gt;) -&gt; Result&lt;Vec&lt;u8&gt;&gt; {\n    let data_len = enc_data.len();\n    let private_rsa: Rsa&lt;Private&gt; = Rsa::private_key_from_pem(priv_key.as_slice())?;\n    let buf_len = private_rsa.size() as usize;\n    let mut buffer: Vec&lt;u8&gt; = vec![0; buf_len];\n    let mut decrypted_data: Vec&lt;u8&gt; = vec![0; data_len];\n    println!(\"{}\", private_rsa.size());\n    for chunk in enc_data.chunks(buf_len) {\n        private_rsa.private_decrypt(chunk, &amp;mut buffer, Padding::NONE).expect(\"Error Decrypting\");;\n        decrypted_data.extend_from_slice(buffer.as_slice());\n    }\n    Ok(decrypted_data)\n}\n\nfn pad_chunk_to_size(chunk: &amp;[u8], desired_size: usize) -&gt; Vec&lt;u8&gt; {\n    let mut resized_vec = Vec::with_capacity(desired_size);\n    for &amp;element in chunk {\n        resized_vec.push(element);\n    }\n    while resized_vec.len() &lt; desired_size {\n        resized_vec.push(0);\n    }\n    println!(\n        \"Desired Length = {}, Actual Length = {}\",\n        desired_size,\n        resized_vec.len()\n    );\n    resized_vec\n}\n</code></pre>\n\n<p>The problem I face is, In my file, I find so many weird characters at the beginning and end of the <em>decrypted</em> file. Image from vim shown below.</p>\n\n<p><a href=\"https://i.stack.imgur.com/XBjqd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/XBjqd.png\" alt=\"enter image description here\"></a></p>\n\n<p>I cannot seem to figure out how to get rid of those characters(which ultimately increase my file size) and, if I chose to use padding, how I would go about doing the same.</p>\n\n<p>Edit: I should note, if I print the output to terminal, I cannot see those characters, but they are definitely present in the file.</p>\n\n<p>Any help is appreciated.</p>\n"}, {"tags": ["sqlite", "rust"], "comments": [{"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1571284837, "post_id": 58424695, "comment_id": 103191256, "body": "Are you perhaps running an old version of Rust? Have you updated recently? <code>Bound</code> was added in <code>1.17.0</code> and <code>RangeBounds</code> in <code>1.28.0</code>."}, {"owner": {"reputation": 915, "user_id": 9716278, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-y_OzgTqtpA8/AAAAAAAAAAI/AAAAAAAABmM/yM8i9oN9vmw/photo.jpg?sz=128", "display_name": "9716278", "link": "https://stackoverflow.com/users/9716278/9716278"}, "reply_to_user": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1571284986, "post_id": 58424695, "comment_id": 103191281, "body": "@loganfsmyth <code>cargo --version [RET] cargo 0.26.0 (41480f5cc 2018-02-26)</code>"}, {"owner": {"reputation": 915, "user_id": 9716278, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-y_OzgTqtpA8/AAAAAAAAAAI/AAAAAAAABmM/yM8i9oN9vmw/photo.jpg?sz=128", "display_name": "9716278", "link": "https://stackoverflow.com/users/9716278/9716278"}, "reply_to_user": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1571285178, "post_id": 58424695, "comment_id": 103191317, "body": "@loganfsmyth (Sorry. Forgot cargo and rustc are not the same.) rustc 1.25.0 (84203cac6 2018-03-25). It must be <code>RangeBounds</code> then. Do you know which version of rusqlite works with rust 1.25?"}, {"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1571285379, "post_id": 58424695, "comment_id": 103191364, "body": "I don&#39;t know, and there isn&#39;t guaranteed to be one. Would you be able to update? As you can see from that date, your version is more than a year and a half behind."}, {"owner": {"reputation": 915, "user_id": 9716278, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-y_OzgTqtpA8/AAAAAAAAAAI/AAAAAAAABmM/yM8i9oN9vmw/photo.jpg?sz=128", "display_name": "9716278", "link": "https://stackoverflow.com/users/9716278/9716278"}, "reply_to_user": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1571285478, "post_id": 58424695, "comment_id": 103191390, "body": "@loganfsmyth I could probably update. Just run <i>rustup</i> again, right?"}, {"owner": {"reputation": 915, "user_id": 9716278, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-y_OzgTqtpA8/AAAAAAAAAAI/AAAAAAAABmM/yM8i9oN9vmw/photo.jpg?sz=128", "display_name": "9716278", "link": "https://stackoverflow.com/users/9716278/9716278"}, "reply_to_user": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1571285650, "post_id": 58424695, "comment_id": 103191427, "body": "@loganfsmyth I just ran <i>rustup</i> for linux and it gave me 1.25 again. Is there a way to tell <i>rustup</i> which version I want?"}, {"owner": {"reputation": 915, "user_id": 9716278, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-y_OzgTqtpA8/AAAAAAAAAAI/AAAAAAAABmM/yM8i9oN9vmw/photo.jpg?sz=128", "display_name": "9716278", "link": "https://stackoverflow.com/users/9716278/9716278"}, "reply_to_user": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1571286002, "post_id": 58424695, "comment_id": 103191512, "body": "rustc 1.38.0 (625451e37 2019-09-23) <a href=\"https://doc.rust-lang.org/nightly/edition-guide/rust-2018/rustup-for-managing-rust-versions.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/nightly/edition-guide/rust-2018/&hellip;</a> after running <code>rustup install stable</code> not run from web."}, {"owner": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1571286101, "post_id": 58424695, "comment_id": 103191539, "body": "Does that version seem to work with <code>rusqlite</code>?"}, {"owner": {"reputation": 915, "user_id": 9716278, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-y_OzgTqtpA8/AAAAAAAAAAI/AAAAAAAABmM/yM8i9oN9vmw/photo.jpg?sz=128", "display_name": "9716278", "link": "https://stackoverflow.com/users/9716278/9716278"}, "reply_to_user": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1571286110, "post_id": 58424695, "comment_id": 103191544, "body": "@loganfsmyth Thanks. It was the old version of rust. I ran cargo again and it complied."}], "answers": [{"tags": [], "owner": {"reputation": 90851, "user_id": 27009, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f0a29af415477aa8c498a4f41ffe6640?s=128&d=identicon&r=PG", "display_name": "Kornel", "link": "https://stackoverflow.com/users/27009/kornel"}, "is_accepted": true, "score": 1, "last_activity_date": 1572578590, "creation_date": 1572578590, "answer_id": 58653721, "question_id": 58424695, "link": "https://stackoverflow.com/questions/58424695/how-to-compile-rusqlite-0-20-0-with-cargo/58653721#58653721", "title": "How to compile rusqlite 0.20.0 with cargo", "body": "<p>Most crates support only the latest Rust version. You could try to use an older version of the crate, but the easiest way is to update Rust to a currently-supported version. </p>\n\n<p>If you're using Rust from a Linux distro, then uninstall it, and get it from <a href=\"https://rustup.rs\" rel=\"nofollow noreferrer\">https://rustup.rs</a> which can keep it up to date. Rust ecosystem moves much faster than most distributions.</p>\n\n<p>Run <code>rustup update</code>. </p>\n"}], "owner": {"reputation": 915, "user_id": 9716278, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-y_OzgTqtpA8/AAAAAAAAAAI/AAAAAAAABmM/yM8i9oN9vmw/photo.jpg?sz=128", "display_name": "9716278", "link": "https://stackoverflow.com/users/9716278/9716278"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 344, "favorite_count": 0, "accepted_answer_id": 58653721, "answer_count": 1, "score": 2, "last_activity_date": 1593283918, "creation_date": 1571284673, "last_edit_date": 1593283918, "question_id": 58424695, "link": "https://stackoverflow.com/questions/58424695/how-to-compile-rusqlite-0-20-0-with-cargo", "title": "How to compile rusqlite 0.20.0 with cargo", "body": "<p>I'm trying to add sqlite support in my rust project. <a href=\"https://crates.io/crates/rusqlite\" rel=\"nofollow noreferrer\">I found rusqlite on crates.io.</a> I added the version line to Cargo.toml. I added some imports (unused) that I found on the <a href=\"https://docs.rs/rusqlite/0.19.0/rusqlite/index.html\" rel=\"nofollow noreferrer\">rusqlite docs page</a>. After running car go build I revived an error.</p>\n<p>I hadn't implemented anything yet. I just wanted to get the dependency added and compiling. main.rs:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate rusqlite;\n\nuse rusqlite::{Connection, Result};\nuse rusqlite::NO_PARAMS;\n</code></pre>\n<p>Cargo.toml:</p>\n<pre><code>[package]\nname = &quot;program&quot;\nversion = &quot;0.1.0&quot;\nauthors = [&quot;97&quot;]\n\n[dependencies]\nargparse = &quot;0.2.2&quot;\nrand = &quot;0.4.0&quot;\nrusqlite = &quot;0.20.0&quot;\n</code></pre>\n<p>Error recived:</p>\n<pre><code>$ cargo build\n   Compiling pkg-config v0.3.16\n   Compiling fallible-iterator v0.2.0\n   Compiling memchr v2.2.1\n   Compiling bitflags v1.2.1\n   Compiling lru-cache v0.1.2\nerror[E0432]: unresolved import `std::ops::Bound`\n  --&gt; /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/pkg-config-0.3.16/src/lib.rs:72:16\n   |\n72 | use std::ops::{Bound, RangeBounds};\n   |                ^^^^^ no `Bound` in `ops`\n\nerror[E0432]: unresolved import `std::ops::RangeBounds`\n  --&gt; /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/pkg-config-0.3.16/src/lib.rs:72:23\n   |\n72 | use std::ops::{Bound, RangeBounds};\n   |                       ^^^^^^^^^^^ no `RangeBounds` in `ops`\n\nerror[E0658]: `dyn Trait` syntax is unstable (see issue #44662)\n   --&gt; /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/pkg-config-0.3.16/src/lib.rs:143:32\n    |\n143 |     fn cause(&amp;self) -&gt; Option&lt;&amp;dyn error::Error&gt; {\n    |                                ^^^^^^^^^^^^^^^^\n\nerror: aborting due to 3 previous errors\n\nerror: Could not compile `pkg-config`.\nwarning: build failed, waiting for other jobs to finish...\nerror[E0658]: `crate` in paths is experimental (see issue #45477)\n  --&gt; /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/fallible-iterator-0.2.0/src/lib.rs:98:5\n   |\n98 | use crate::imports::*;\n   |     ^^^^^\n\nerror[E0658]: `dyn Trait` syntax is unstable (see issue #44662)\n    --&gt; /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/fallible-iterator-0.2.0/src/lib.rs:2606:24\n     |\n2606 | fn _is_object_safe(_: &amp;dyn DoubleEndedFallibleIterator&lt;Item = (), Error = ()&gt;) {}\n     |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\nerror: aborting due to 2 previous errors\n\nerror: Could not compile `fallible-iterator`.\nwarning: build failed, waiting for other jobs to finish...\nerror: build failed\n</code></pre>\n<hr />\n<p><strong>Edit</strong></p>\n<p>cargo 0.26.0 (41480f5cc 2018-02-26)</p>\n<p>rustc 1.25.0 (84203cac6 2018-03-25)</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 281, "user_id": 5405354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a987b9748fdf6d084e4c204912d740b?s=128&d=identicon&r=PG&f=1", "display_name": "Rich", "link": "https://stackoverflow.com/users/5405354/rich"}, "edited": false, "score": 0, "creation_date": 1571410399, "post_id": 58434125, "comment_id": 103244220, "body": "This seems to be on the right track. Apparently you need to call start_with_addr() instead of start() to get the Addr object. I&#39;m now dealing with fun Rust threading issues so haven&#39;t been able to test if the rest works. I&#39;ll update when I get it working."}, {"owner": {"reputation": 281, "user_id": 5405354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a987b9748fdf6d084e4c204912d740b?s=128&d=identicon&r=PG&f=1", "display_name": "Rich", "link": "https://stackoverflow.com/users/5405354/rich"}, "edited": false, "score": 0, "creation_date": 1571459378, "post_id": 58434125, "comment_id": 103257454, "body": "It worked right up until the ctx.text(json) call. I&#39;m not seeing the message show up at the client. I&#39;ll keep poking around with it and see if I can figure out what&#39;s going on. Edit: Nevermind, user error."}, {"owner": {"reputation": 5632, "user_id": 923846, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/09e0e62acac2bdbd44edb763d8566df4?s=128&d=identicon&r=PG", "display_name": "obe", "link": "https://stackoverflow.com/users/923846/obe"}, "edited": false, "score": 0, "creation_date": 1595194022, "post_id": 58434125, "comment_id": 111382731, "body": "This code didn&#39;t compile for me, I got this error: <code>error: Expect a attribute &#39;rtype&#39;</code> for the two <code>#[derive(Message)]</code>. I fixed it by adding <code>#[rtype(result = &quot;()&quot;)]</code> right underneath the <code>#[derive(Message)]</code>."}], "tags": [], "owner": {"reputation": 2798, "user_id": 492747, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/6175ac3e7ef6faba1f1ac2a3decbec7b?s=128&d=identicon&r=PG", "display_name": "evading", "link": "https://stackoverflow.com/users/492747/evading"}, "is_accepted": true, "score": 5, "last_activity_date": 1571772932, "last_edit_date": 1571772932, "creation_date": 1571319795, "answer_id": 58434125, "question_id": 58424473, "link": "https://stackoverflow.com/questions/58424473/how-to-send-server-events-using-rust-with-actix-web-and-websockets/58434125#58434125", "title": "How to send server events using Rust with Actix web and WebSockets?", "body": "<p>This is deep waters for me but I think you need to <code>impl</code> <a href=\"https://docs.rs/actix/0.8.3/actix/trait.Handler.html\" rel=\"noreferrer\">Handler</a> <code>for StatusWS</code>. Then you can use the <a href=\"https://docs.rs/actix/0.8.3/actix/struct.Addr.html\" rel=\"noreferrer\">Addr</a> that you get as return value when you <code>.start()</code> your <code>Actor</code> to send messages to it. Then you'll end up in the <code>handle</code> method of <code>Handler</code> which has access to the <code>ctx</code> and you can send your ws message.</p>\n\n<p>I'm learning Rust and Actix myself so this may not be how you to actually do it. Let me know how it goes.</p>\n\n<p>[Edit] I realize my answer was kind of bleak so I whipped up an example that may be of use to others.</p>\n\n<pre><code>use actix::prelude::*;\nuse actix_web::{middleware, web, App, Error, HttpRequest, HttpResponse, HttpServer};\nuse actix_web_actors::ws;\nuse std::time::Duration;\n\nfn ws_index(\n    r: HttpRequest,\n    stream: web::Payload,\n    data: web::Data&lt;Addr&lt;ServerMonitor&gt;&gt;,\n) -&gt; Result&lt;HttpResponse, Error&gt; {\n    let (addr, res) = ws::start_with_addr(MyWebSocket {}, &amp;r, stream)?;\n\n    data.get_ref().do_send(RegisterWSClient { addr: addr });\n\n    Ok(res)\n}\n\nstruct MyWebSocket {}\n\nimpl Actor for MyWebSocket {\n    type Context = ws::WebsocketContext&lt;Self&gt;;\n}\n\nimpl StreamHandler&lt;ws::Message, ws::ProtocolError&gt; for MyWebSocket {\n    fn handle(&amp;mut self, msg: ws::Message, ctx: &amp;mut Self::Context) {\n        println!(\"WS: {:?}\", msg);\n        match msg {\n            ws::Message::Ping(msg) =&gt; {\n                ctx.pong(&amp;msg);\n            }\n            ws::Message::Pong(_) =&gt; {}\n            ws::Message::Text(text) =&gt; ctx.text(text),\n            ws::Message::Binary(bin) =&gt; ctx.binary(bin),\n            ws::Message::Close(_) =&gt; {\n                ctx.stop();\n            }\n            ws::Message::Nop =&gt; (),\n        }\n    }\n}\n\nimpl Handler&lt;ServerEvent&gt; for MyWebSocket {\n    type Result = ();\n\n    fn handle(&amp;mut self, msg: ServerEvent, ctx: &amp;mut Self::Context) {\n        ctx.text(msg.event);\n    }\n}\n\n#[derive(Message)]\nstruct RegisterWSClient {\n    addr: Addr&lt;MyWebSocket&gt;,\n}\n\n#[derive(Message)]\nstruct ServerEvent {\n    event: String,\n}\n\nstruct ServerMonitor {\n    listeners: Vec&lt;Addr&lt;MyWebSocket&gt;&gt;,\n}\n\nimpl Actor for ServerMonitor {\n    type Context = Context&lt;Self&gt;;\n\n    fn started(&amp;mut self, ctx: &amp;mut Self::Context) {\n        ctx.run_interval(Duration::from_secs(5), |act, _| {\n            for l in &amp;act.listeners {\n                l.do_send(ServerEvent{ event: String::from(\"Event:\") });\n            }\n        });\n    }\n}\n\nimpl Handler&lt;RegisterWSClient&gt; for ServerMonitor {\n    type Result = ();\n\n    fn handle(&amp;mut self, msg: RegisterWSClient, _: &amp;mut Context&lt;Self&gt;) {\n        self.listeners.push(msg.addr);\n    }\n}\n\nfn main() -&gt; std::io::Result&lt;()&gt; {\n    std::env::set_var(\"RUST_LOG\", \"actix_server=info,actix_web=info\");\n    env_logger::init();\n\n    let sys = actix_rt::System::new(\"example\");\n\n    let srvmon = ServerMonitor { listeners: vec![] }.start();\n\n    HttpServer::new(move || {\n        App::new()\n            .data(srvmon.clone())\n            .wrap(middleware::Logger::default())\n            .service(web::resource(\"/ws/\").route(web::get().to(ws_index)))\n    })\n    .bind(\"127.0.0.1:8080\")?\n    .start();\n\n    sys.run()\n}\n</code></pre>\n"}], "owner": {"reputation": 281, "user_id": 5405354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a987b9748fdf6d084e4c204912d740b?s=128&d=identicon&r=PG&f=1", "display_name": "Rich", "link": "https://stackoverflow.com/users/5405354/rich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1379, "favorite_count": 1, "accepted_answer_id": 58434125, "answer_count": 1, "score": 1, "last_activity_date": 1571772932, "creation_date": 1571282867, "question_id": 58424473, "link": "https://stackoverflow.com/questions/58424473/how-to-send-server-events-using-rust-with-actix-web-and-websockets", "title": "How to send server events using Rust with Actix web and WebSockets?", "body": "<p>I'm using Rust with Actix web and would like to use WebSockets for server events, mainly status messages that are sent to the client. I've followed the basic structure,</p>\n\n<pre><code>struct StatusWS {}\n\nimpl Actor for StatusWS {\n    type Context = ws::WebsocketContext&lt;Self&gt;;\n\n    fn started(&amp;mut self, ctx: &amp;mut Self::Context) {\n        // How to keep track of ctx???\n    }\n}\n</code></pre>\n\n<p>When the client connects, started() gets called and I can send messages from there using ctx.text(), etc. However, I need to keep track of the context in order to send the messages later on. How do I do that? It's passed in as a reference, so the borrow checker won't let me do much with it.</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 1058, "user_id": 2797757, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4db8a84f0f567cc5df66a9a480ce5b08?s=128&d=identicon&r=PG&f=1", "display_name": "hydradon", "link": "https://stackoverflow.com/users/2797757/hydradon"}, "edited": false, "score": 0, "creation_date": 1571283250, "post_id": 58424365, "comment_id": 103190922, "body": "HI @SCappella, I tried your method and implement <code>find_mut</code>, but I got some other reference issue: could you check my code here at PlayGround: <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=1a333f353aa91643b8f5d493c02785d0\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "reply_to_user": {"reputation": 1058, "user_id": 2797757, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4db8a84f0f567cc5df66a9a480ce5b08?s=128&d=identicon&r=PG&f=1", "display_name": "hydradon", "link": "https://stackoverflow.com/users/2797757/hydradon"}, "edited": false, "score": 1, "creation_date": 1571284403, "post_id": 58424365, "comment_id": 103191165, "body": "@hydradon Your main problem is the line <code>let mut search_node = &amp;self.root;</code>. Remember, if you start with an immutable reference, you won&#39;t be able to take a mutable reference later on. You&#39;ll also have to use <code>HashMap</code>&#39;s <code>get_mut</code> method to ensure that the later <code>search_node</code>s are also mutable."}, {"owner": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "reply_to_user": {"reputation": 1058, "user_id": 2797757, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4db8a84f0f567cc5df66a9a480ce5b08?s=128&d=identicon&r=PG&f=1", "display_name": "hydradon", "link": "https://stackoverflow.com/users/2797757/hydradon"}, "edited": false, "score": 1, "creation_date": 1571284412, "post_id": 58424365, "comment_id": 103191168, "body": "@hydradon I&#39;ll also warn you about using unwrap. As written, the code will panic whenever a key doesn&#39;t exist in the trie. I&#39;d probably rewrite that using the <a href=\"https://doc.rust-lang.org/edition-guide/rust-2018/error-handling-and-panics/the-question-mark-operator-for-easier-error-handling.html\" rel=\"nofollow noreferrer\"><code>?</code> operator</a> as <code>search_node = search_node.node_map.get_mut(&amp;c)?;</code>."}, {"owner": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "reply_to_user": {"reputation": 1058, "user_id": 2797757, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4db8a84f0f567cc5df66a9a480ce5b08?s=128&d=identicon&r=PG&f=1", "display_name": "hydradon", "link": "https://stackoverflow.com/users/2797757/hydradon"}, "edited": false, "score": 1, "creation_date": 1571284500, "post_id": 58424365, "comment_id": 103191182, "body": "@hydradon Just so we&#39;re clear, <code>let mut search_node = &amp;self.root;</code> is not a mutable reference, but rather a reference that is mutable. That is, the pointer itself can be changed, but not the underlying data. What you want is <code>let search_node = &amp;mut self.root;</code>."}, {"owner": {"reputation": 1058, "user_id": 2797757, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4db8a84f0f567cc5df66a9a480ce5b08?s=128&d=identicon&r=PG&f=1", "display_name": "hydradon", "link": "https://stackoverflow.com/users/2797757/hydradon"}, "edited": false, "score": 0, "creation_date": 1571285996, "post_id": 58424365, "comment_id": 103191509, "body": "I have made your suggested change: <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=5f46673c83a6b5863deb86ffe7b6cb46\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a> Now it complains <code>cannot assign twice to immutable variable search_node</code>. Also, since at the end, it returns <code>Some(search_node)</code> is inconsistent with <code>-&gt; Option&lt;&amp;mut Node&gt;</code> . How do I fix this return?"}, {"owner": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "reply_to_user": {"reputation": 1058, "user_id": 2797757, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4db8a84f0f567cc5df66a9a480ce5b08?s=128&d=identicon&r=PG&f=1", "display_name": "hydradon", "link": "https://stackoverflow.com/users/2797757/hydradon"}, "edited": false, "score": 1, "creation_date": 1571286263, "post_id": 58424365, "comment_id": 103191580, "body": "@hydradon Oh yeah, I guess you do still need to change the reference itself as well as its data, so <code>let mut search_node = &amp;mut self.root;</code> is appropriate."}], "tags": [], "owner": {"reputation": 7716, "user_id": 4639273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae38603d40c633012992337a32330fa0?s=128&d=identicon&r=PG", "display_name": "SCappella", "link": "https://stackoverflow.com/users/4639273/scappella"}, "is_accepted": true, "score": 1, "last_activity_date": 1571282085, "creation_date": 1571282085, "answer_id": 58424365, "question_id": 58424116, "link": "https://stackoverflow.com/questions/58424116/hashmap-in-a-struct-error-cannot-borrow-data-in-a-reference-as-mutable/58424365#58424365", "title": "HashMap in a Struct error: cannot borrow data in a &quot;&amp;&quot; reference as mutable", "body": "<p>The problem is that <code>find</code> returns an (optional) immutable reference, but then you try to mutate it later. For that reason, you'll probably want to add a method <code>find_mut</code> with signature</p>\n\n<pre><code>fn find_mut(&amp;mut self, key: &amp;str) -&gt; Option&lt;&amp;mut Node&gt;\n</code></pre>\n\n<p>(I changed the <code>key</code> argument to <code>&amp;str</code> because <a href=\"https://stackoverflow.com/questions/40006219/why-is-it-discouraged-to-accept-a-reference-to-a-string-string-vec-vec-o?r=SearchResults&amp;s=1%7C65.5803\">it's discouraged to take <code>&amp;String</code> as an argument</a>)</p>\n\n<p>Another stylistic thing: you should use <code>if let</code> instead of checking that <code>search_node</code> is some and then unwrapping.</p>\n\n<pre><code>if let Some(search_node) = self.find_mut(key) {\n    search_node.node_map.remove(&amp;'x');\n}\n</code></pre>\n"}], "owner": {"reputation": 1058, "user_id": 2797757, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/4db8a84f0f567cc5df66a9a480ce5b08?s=128&d=identicon&r=PG&f=1", "display_name": "hydradon", "link": "https://stackoverflow.com/users/2797757/hydradon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 440, "favorite_count": 0, "accepted_answer_id": 58424365, "answer_count": 1, "score": 0, "last_activity_date": 1571282085, "creation_date": 1571280157, "question_id": 58424116, "link": "https://stackoverflow.com/questions/58424116/hashmap-in-a-struct-error-cannot-borrow-data-in-a-reference-as-mutable", "title": "HashMap in a Struct error: cannot borrow data in a &quot;&amp;&quot; reference as mutable", "body": "<p>I have the following code:</p>\n\n<pre><code>struct Node{\n    node_map: HashMap&lt;char, Node&gt;,\n    value: Option&lt;i32&gt;,\n}\n\nstruct Trie {\n    root: Node,\n}\n\nimpl Trie {\n    fn new() -&gt; Trie {\n        Trie {\n            root: Node{\n                node_map: HashMap::new(),\n                value: None,\n            },\n        }\n    }\n\n    fn find(&amp;self, key: &amp;String) -&gt; Option&lt;&amp;Node&gt; {\n       // Returning some Option&lt;&amp;Node&gt;\n    }\n\n    fn delete(&amp;mut self, key: &amp;String) -&gt; Option&lt;i32&gt; {\n        // extract code snippet\n        let mut search_node = self.find(key);\n        if search_node.is_some() {\n            search_node.unwrap().node_map.remove(&amp; 'x');\n        }\n        None\n    }\n}\n</code></pre>\n\n<p>Rust complains the error under <code>search_node.unwrap().chs</code> part: <strong>cannot borrow data in a \"&amp;\" reference as mutable</strong></p>\n\n<p>So I understand that the <code>find</code> function returns <code>Option&lt;&amp;Node&gt;</code> so when unwrapping at the above line, I get the reference to <code>Node</code>.</p>\n\n<p><strong>Attempts</strong>:</p>\n\n<ul>\n<li>I tried to dereference the node by: <code>*search_node.unwrap().node_map.remove(&amp; 'x');</code> or <code>*(search_node.unwrap()).node_map.remove(&amp; 'x');</code> but it still throws error.</li>\n<li>I followed another answer <a href=\"https://stackoverflow.com/questions/42753516/cannot-borrow-data-mutably-in-a-reference-in-array\">here</a> and tried to make <code>node_map</code> mutable like:</li>\n</ul>\n\n<pre><code> struct Node&lt;'a&gt; {\n     node_map: &amp;'a mut HashMap&lt;char, Node&lt;'a&gt;&gt;,\n     value: Option&lt;i32&gt;,\n }\n</code></pre>\n\n<p>But then I got complain about lacking lifetime several places. One particular place I dont know how to add is in the <code>new</code> function.</p>\n\n<p>Please let me know how to solve the original issue or how to add the appropriate lifetime.</p>\n"}]