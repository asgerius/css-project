[{"tags": ["rust", "web-component", "rust-cargo", "webassembly"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1554335349, "post_id": 55505843, "comment_id": 97717572, "body": "You don&#39;t have to have separate <i>repositories</i>, but you do have to have multiple Cargo projects."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 4, "creation_date": 1554335412, "post_id": 55505843, "comment_id": 97717583, "body": "you can have multi workspace, I think that should work in your case if I correctly understand what you want"}, {"owner": {"reputation": 1962, "user_id": 982364, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8f7fcd81979b29f5fd4ddf155987e588?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/982364/tom"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554337974, "post_id": 55505843, "comment_id": 97718163, "body": "@Shepmaster - it&#39;s not a duplicate. That question asks why there&#39;s only one [lib]. I don&#39;t particularily care about the why. I want to know how to set up my project with multiple web-components without having to duplicate everything inside."}, {"owner": {"reputation": 1962, "user_id": 982364, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8f7fcd81979b29f5fd4ddf155987e588?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/982364/tom"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554338025, "post_id": 55505843, "comment_id": 97718176, "body": "@Stargateur can you elaborate on that? It might be exactly what I&#39;m looking for."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554338905, "post_id": 55505843, "comment_id": 97718375, "body": "@Tom just google it... <a href=\"https://doc.rust-lang.org/book/ch14-03-cargo-workspaces.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/book/ch14-03-cargo-workspaces.html</a> <a href=\"https://doc.rust-lang.org/cargo/reference/manifest.html#the-workspace-section\" rel=\"nofollow noreferrer\">doc.rust-lang.org/cargo/reference/&hellip;</a>"}], "owner": {"reputation": 1962, "user_id": 982364, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8f7fcd81979b29f5fd4ddf155987e588?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/982364/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "closed_date": 1554335258, "answer_count": 0, "score": 1, "last_activity_date": 1554338096, "creation_date": 1554334987, "last_edit_date": 1554338096, "question_id": 55505843, "link": "https://stackoverflow.com/questions/55505843/why-is-it-the-case-that-multiple-libraries-arent-allowed-from-the-same-project", "closed_reason": "Duplicate", "title": "Why is it the case that multiple libraries aren&#39;t allowed from the same project in Cargo?", "body": "<p>Using <code>[[bin]]</code> in Cargo.toml allows me to compile multiple binaries from the same source of a Rust project.</p>\n\n<p>But I want to deploy multiple web-components from the same source, and web-components are compiled as libraries. There is, however, no <code>[[lib]]</code>, only <code>[lib]</code> which allows only a single compile target.</p>\n\n<p>I am new to Rust and Cargo so I don't yet fully understand every part of the ecosystem entirely, but I wonder how to go about building my multiple web-components without having a dozen small repositories?</p>\n\n<hr>\n\n<p>If it matters, I plan to use the <a href=\"https://github.com/web-dom/webcomponent\" rel=\"nofollow noreferrer\">webcomponent system of web-dom</a> for this project, while I've used wasm-bindgen for another one with a similar setup (but only 2 components, so it wasn't much of an issue).</p>\n"}, {"tags": ["serialization", "rust", "serde"], "answers": [{"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": true, "score": 12, "last_activity_date": 1554337355, "last_edit_date": 1554337355, "creation_date": 1554335134, "answer_id": 55505859, "question_id": 55505837, "link": "https://stackoverflow.com/questions/55505837/what-is-the-equivalent-of-javas-transient-in-serde/55505859#55505859", "title": "What is the equivalent of Java&#39;s transient in Serde?", "body": "<p>You can use the <code>#[serde(skip)]</code> attribute:</p>\n\n<pre><code>use serde::{Deserialize, Serialize}; // 1.0.88\n\n#[derive(Deserialize, Serialize)]\nstruct MyStruct {\n    field1: i32, // this will be (de)serialized\n    #[serde(skip)]\n    field2: i32, // this will be skipped\n}\n</code></pre>\n\n<p>If the type needs to be <strong><em>de</em></strong>serialized, it's a good idea to accompany a <code>#[serde(skip)]</code> with a <code>#[serde(default)]</code> (or a <code>#[serde(default = \"fn_name\")]</code>) attribute. Serde deserializes  skipped fields as if a <code>#[serde(default)]</code> was implicitly added, but it's clearer to someone reading your code if you make it explicit where this value will come from.</p>\n\n<p>See:</p>\n\n<ul>\n<li><a href=\"https://serde.rs/field-attrs.html\" rel=\"noreferrer\">List of all serde field attributes</a></li>\n<li><a href=\"https://serde.rs/attributes.html\" rel=\"noreferrer\">All serde attributes</a></li>\n</ul>\n"}], "owner": {"reputation": 375, "user_id": 11134001, "user_type": "registered", "profile_image": "https://graph.facebook.com/2130930103663266/picture?type=large", "display_name": "Thomas Braun", "link": "https://stackoverflow.com/users/11134001/thomas-braun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 55505859, "answer_count": 1, "score": 7, "last_activity_date": 1554337355, "creation_date": 1554334936, "last_edit_date": 1554335544, "question_id": 55505837, "link": "https://stackoverflow.com/questions/55505837/what-is-the-equivalent-of-javas-transient-in-serde", "title": "What is the equivalent of Java&#39;s transient in Serde?", "body": "<p>I am interested in making a variable not automatically serialized (e.g., by Serde) with the use of a keyword like Java's <code>transient</code>, but in Rust. I need this to store passwords. Of course, I could manually clear the data upon serialization to the disk, but I would like to know if there are better, more automatic, options.</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1554335022, "post_id": 55504416, "comment_id": 97717483, "body": "See also: <a href=\"https://stackoverflow.com/a/55285391/493729\">Rust error: borrow occurs after drop a mutable borrow</a>"}], "answers": [{"comments": [{"owner": {"reputation": 660, "user_id": 2064646, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/448cafc28b959f69d045688deadf58c0?s=128&d=identicon&r=PG", "display_name": "so61pi", "link": "https://stackoverflow.com/users/2064646/so61pi"}, "edited": false, "score": 0, "creation_date": 1554393828, "post_id": 55504418, "comment_id": 97745318, "body": "Currently, if <code>edition</code> is not set in <code>Cargo.toml</code>, it will default to <code>2015</code>."}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 4, "last_activity_date": 1554326193, "creation_date": 1554326193, "answer_id": 55504418, "question_id": 55504416, "link": "https://stackoverflow.com/questions/55504416/how-do-i-use-a-specific-edition-of-rust/55504418#55504418", "title": "How do I use a specific edition of Rust?", "body": "<p>You can add the following to your <code>Cargo.toml</code>, it's documented on the <a href=\"https://doc.rust-lang.org/edition-guide/editions/creating-a-new-project.html\" rel=\"nofollow noreferrer\">edition 2018 guide</a>:</p>\n\n<pre><code>[package]\nedition = \"2018\"\n</code></pre>\n\n<hr>\n\n<p>If you directly use <code>rustc</code> you can use <code>rustc --edition 2018</code>, it's documented with <code>rustc --help -v</code> command.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>--edition 2015|2018\n  Specify which edition of the compiler to use when\n  compiling code.\n</code></pre>\n"}], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "accepted_answer_id": 55504418, "answer_count": 1, "score": 4, "last_activity_date": 1559831219, "creation_date": 1554326193, "last_edit_date": 1559831219, "question_id": 55504416, "link": "https://stackoverflow.com/questions/55504416/how-do-i-use-a-specific-edition-of-rust", "title": "How do I use a specific edition of Rust?", "body": "<p>I know there are currently two editions of Rust (<code>2015</code> and <code>2018</code>), how can I tell <code>cargo</code> and <code>rustc</code> which one I want to use?</p>\n"}, {"tags": ["rust", "borrow-checker"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1554321300, "post_id": 55503199, "comment_id": 97712810, "body": "Are stuck on Edition 2015 and unable to use Edition 2018 for some reason? Updating to 2018 will solve this problem because of non-lexical lifetimes."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1554321588, "post_id": 55503199, "comment_id": 97712948, "body": "See: <a href=\"https://stackoverflow.com/q/55285018/493729\">stackoverflow.com/q/55285018/493729</a>, <a href=\"https://stackoverflow.com/q/50251487/493729\">stackoverflow.com/q/50251487/493729</a>"}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 2, "creation_date": 1554325970, "post_id": 55503199, "comment_id": 97714829, "body": "Any version since 1.31, but you need to enable it in your <code>Cargo.toml</code>. See the linked question: <a href=\"https://stackoverflow.com/q/55285018/493729\">stackoverflow.com/q/55285018/493729</a>"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554326224, "post_id": 55503199, "comment_id": 97714924, "body": "@x-ray hope this will help <a href=\"https://stackoverflow.com/questions/55504416/how-do-i-use-a-specific-edition-of-rust/55504418#55504418\" title=\"how do i use a specific edition of rust\">stackoverflow.com/questions/55504416/&hellip;</a>"}, {"owner": {"reputation": 145, "user_id": 8874957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QMxdN.png?s=128&g=1", "display_name": "the duck", "link": "https://stackoverflow.com/users/8874957/the-duck"}, "edited": false, "score": 0, "creation_date": 1554331120, "post_id": 55503199, "comment_id": 97716533, "body": "Thanks everyone, I thought I needed a new version of Rust, but with the edition=&quot;2018&quot; in the toml file, it works."}], "owner": {"reputation": 145, "user_id": 8874957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QMxdN.png?s=128&g=1", "display_name": "the duck", "link": "https://stackoverflow.com/users/8874957/the-duck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "closed_date": 1554325286, "answer_count": 0, "score": 1, "last_activity_date": 1554322980, "creation_date": 1554320906, "last_edit_date": 1554322980, "question_id": 55503199, "link": "https://stackoverflow.com/questions/55503199/why-does-the-order-of-declarations-have-an-impact-on-if-compilation-succeeds", "closed_reason": "Duplicate", "title": "Why does the order of declarations have an impact on if compilation succeeds?", "body": "<p>I wrote a simple Rust program. Depending on the order of my variable declaration, compilation succeeds or fails.</p>\n\n<pre><code>fn main() {\n    let my_env: &amp;String;\n    let options: Vec&lt;String&gt; = [\"a\", \"b\", \"c\"].iter().map(|s| s.to_string()).collect();\n    my_env = &amp;options[1];\n    let _ = my_env;\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0597]: `options` does not live long enough\n --&gt; src/main.rs:4:15\n  |\n4 |     my_env = &amp;options[1];\n  |               ^^^^^^^ borrowed value does not live long enough\n5 |     let _ = my_env;\n6 | }\n  | - `options` dropped here while still borrowed\n  |\n  = note: values in a scope are dropped in the opposite order they are created\n</code></pre>\n\n<p>When I declare <code>my_env</code> right after the <code>options</code>, the compilation is a success. Is this a Rust feature or a bug? </p>\n"}, {"tags": ["rust", "serde"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 4, "last_activity_date": 1554322748, "last_edit_date": 1554322748, "creation_date": 1554307449, "answer_id": 55499569, "question_id": 55499421, "link": "https://stackoverflow.com/questions/55499421/how-to-return-a-result-containing-a-serde-jsonvalue/55499569#55499569", "title": "How to return a Result containing a serde_json::Value?", "body": "<p>The official Rust book, <a href=\"https://doc.rust-lang.org/book/\" rel=\"nofollow noreferrer\"><em>The Rust Programming Language</em></a>, is freely available online. It has an <a href=\"https://doc.rust-lang.org/book/ch09-02-recoverable-errors-with-result.html\" rel=\"nofollow noreferrer\">entire chapter on using <code>Result</code></a>, explaining introductory topics such as the <code>Result</code> enum and how to use it.</p>\n\n<blockquote>\n  <p>How to return a <code>Result</code> containing a <code>serde_json::Value</code>?</p>\n</blockquote>\n\n<p>The same way you return a <code>Result</code> of <em>any</em> type; there's nothing special about <code>Value</code>:</p>\n\n<pre><code>use serde_json::json; // 1.0.38\n\npub fn ok_example() -&gt; Result&lt;serde_json::value::Value, i32&gt; {\n    Ok(json! { \"success\" })\n}\n\npub fn err_example() -&gt; Result&lt;serde_json::value::Value, i32&gt; {\n    Err(42)\n}\n</code></pre>\n\n<p>If you have a function that returns a <code>Result</code>, you can use the question mark operator (<code>?</code>) to exit early from a function on error, returning the error. This is a concise way to avoid <code>unwrap</code> or <code>expect</code>:</p>\n\n<pre><code>fn use_them() -&gt; Result&lt;(), i32&gt; {\n    let ok = ok_example()?;\n    println!(\"{:?}\", ok);\n\n    let err = err_example()?;\n    println!(\"{:?}\", err); // Never executed, we always exit due to the `?`\n\n    Ok(()) // Never executed\n}\n</code></pre>\n\n<p>This is just a basic example.</p>\n\n<p>Applied to your <a href=\"/help/mcve\">MCVE</a>, it would look something like:</p>\n\n<pre><code>use reqwest; // 0.9.10\nuse serde_json::Value; // 1.0.38\n\ntype Error = Box&lt;dyn std::error::Error&gt;;\n\npub fn perform_get(_id: String) -&gt; Result&lt;Value, Error&gt; {\n    let client = reqwest::Client::builder().build()?;\n\n    let url = String::from(\"SomeURL\");\n\n    let res = client.get(&amp;url).send()?.text()?;\n\n    let v = serde_json::from_str(&amp;res)?;\n\n    Ok(v)\n}\n</code></pre>\n\n<p>Here, I'm using the <em>trait object</em> <code>Box&lt;dyn std::error::Error&gt;</code> to handle any kind of error (great for quick programs and examples). I then sprinkle <code>?</code> on every method that could fail (i.e. returns a <code>Result</code>) and end the function with an explicit <code>Ok</code> for the final value.</p>\n\n<p>Note that the <code>panic</code> and the never-used <code>null</code> value can be removed with this style.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/42917566/155423\">What is this question mark operator about?</a></li>\n<li><a href=\"https://stackoverflow.com/q/48430836/155423\">Rust proper error handling (auto convert from one error type to another with question mark)</a></li>\n<li><a href=\"https://stackoverflow.com/q/45583246/155423\">Rust return result error from fn</a></li>\n<li><a href=\"https://stackoverflow.com/q/33116457/155423\">Return value from match to Err(e)</a></li>\n<li><a href=\"https://stackoverflow.com/q/39805834/155423\">What is the idiomatic way to handle/unwrap nested Result types?</a></li>\n</ul>\n\n<blockquote>\n  <p>better practice to return a <code>Result</code></p>\n</blockquote>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/39477684/155423\">Should I avoid unwrap in production application?</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "is_accepted": true, "score": -1, "last_activity_date": 1554321689, "last_edit_date": 1554321689, "creation_date": 1554315226, "answer_id": 55501675, "question_id": 55499421, "link": "https://stackoverflow.com/questions/55499421/how-to-return-a-result-containing-a-serde-jsonvalue/55501675#55501675", "title": "How to return a Result containing a serde_json::Value?", "body": "<p>The kind smart folks over at Rust Discord helped me solve this one. (user noc)</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate base64;\nextern crate reqwest;\n\npub fn get_jira_ticket() -&gt; Result&lt;serde_json::value::Value, reqwest::Error&gt; {\n    let client = reqwest::Client::builder().build().unwrap();\n\n    let url = String::from(\"SomeURL\");\n\n    let res = client.get(&amp;url).send().and_then(|mut r| r.json());\n\n    res\n}\n\nfn main() {\n    println!(\"This works\");\n}\n</code></pre>\n\n<p>The key part was this in the header for the return </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>-&gt; Result&lt;serde_json::value::Value, reqwest::Error&gt;\n</code></pre>\n\n<p>And this here to actually return the data.</p>\n\n<pre><code>client.get(&amp;url).send().and_then(|mut r| r.json());\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": false, "score": 3, "last_activity_date": 1554323344, "last_edit_date": 1554323344, "creation_date": 1554322629, "answer_id": 55503617, "question_id": 55499421, "link": "https://stackoverflow.com/questions/55499421/how-to-return-a-result-containing-a-serde-jsonvalue/55503617#55503617", "title": "How to return a Result containing a serde_json::Value?", "body": "<p>If you are in the user side I would suggest to use <a href=\"https://doc.rust-lang.org/std/boxed/struct.Box.html\" rel=\"nofollow noreferrer\"><code>Box&lt;dyn std::error::Error&gt;</code></a>, this allow to return every type that implement <a href=\"https://doc.rust-lang.org/std/error/trait.Error.html\" rel=\"nofollow noreferrer\"><code>Error</code></a>, <code>?</code> will convert the concrete error type to the dynamic boxed trait, this add a little overhead when there is an error but when error are not expected or really rare this is not a big deal. </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use reqwest;\n\nuse serde_json::value::Value;\nuse std::error::Error;\n\nfn perform_get(_id: String) -&gt; Result&lt;Value, Box&lt;dyn Error&gt;&gt; {\n    let client = reqwest::Client::builder().build()?;\n\n    let url = String::from(\"SomeURL\");\n\n    let res = client.get(&amp;url).send()?.text()?;\n\n    let v = serde_json::from_str(&amp;res)?;\n\n    Ok(v)\n\n    // last two line could be serde_json::from_str(&amp;res).map_err(std::convert::Into::into)\n}\n\nfn main() {\n    println!(\"{:?}\", perform_get(\"hello\".to_string()));\n}\n</code></pre>\n\n<p>This produce the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Err(Error { kind: Url(RelativeUrlWithoutBase), url: None })\n</code></pre>\n"}], "owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1201, "favorite_count": 0, "accepted_answer_id": 55501675, "answer_count": 3, "score": 1, "last_activity_date": 1554323344, "creation_date": 1554307004, "last_edit_date": 1554321905, "question_id": 55499421, "link": "https://stackoverflow.com/questions/55499421/how-to-return-a-result-containing-a-serde-jsonvalue", "title": "How to return a Result containing a serde_json::Value?", "body": "<p>This is what I have, but I want to avoid using <code>unwrap</code> on my reqwest values:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate base64;\nextern crate reqwest;\n\nuse serde_json;\n\nuse serde_json::json;\n\npub fn perform_get(id: String) -&gt; serde_json::value::Value {\n    let client = reqwest::Client::builder().build().unwrap();\n\n    let url = String::from(\"SomeURL\");\n\n    let res = client.get(&amp;url).send().unwrap().text();\n\n    let mut v = json!(null);\n    match res {\n        Ok(n) =&gt; {\n            v = serde_json::from_str(&amp;n).unwrap();\n        }\n        Err(r) =&gt; {\n            println!(\"Something wrong happened {:?}\", r);\n        }\n    }\n\n    v\n}\n\nfn main() {\n    println!(\"Hi there! i want the function above to return a result instead of a Serde value so I can handle the error in main!\");\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;code=extern%20crate%20base64%3B%0Aextern%20crate%20reqwest%3B%0A%0Ause%20serde_json%3B%0A%0A%0Ause%20serde_json%3A%3A%7Bjson%7D%3B%0A%0Apub%20fn%20perform_get(id%3A%20String)%20-%3E%20serde_json%3A%3Avalue%3A%3AValue%20%7B%0A%0A%20%20%20%20let%20client%20%3D%20reqwest%3A%3AClient%3A%3Abuilder()%0A%20%20%20%20%20%20%20%20.build()%0A%20%20%20%20%20%20%20%20.unwrap()%3B%0A%0A%20%20%20%20let%20%20url%20%3D%20String%3A%3Afrom(%22SomeURL%22)%3B%0A%20%0A%20%20%20%20let%20res%20%3D%20client%0A%20%20%20%20%20%20%20%20.get(%26url)%0A%20%20%20%20%20%20%20%20.send()%0A%20%20%20%20%20%20%20%20.unwrap()%0A%20%20%20%20%20%20%20%20.text()%3B%0A%0A%20%20%20%20let%20mut%20v%20%3D%20json!(null)%3B%0A%20%20%20%20match%20res%20%7B%0A%20%20%20%20%20%20%20%20Ok(n)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20v%20%3D%20serde_json%3A%3Afrom_str(%26n).unwrap()%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20Err(r)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20println!(%22Something%20wrong%20happened%20%7B%3A%3F%7D%22%2C%20r)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20v%0A%7D%0A%0Afn%20main()%20%7B%0A%20%20%20%20println!(%22Hi%20there!%20i%20want%20the%20function%20above%20to%20return%20a%20result%20instead%20of%20a%20Serde%20value%20so%20I%20can%20handle%20the%20error%20in%20main!%22)%3B%0A%20%20%20%20%0A%20%20%20%20%0A%20%20%20%20%0A%7D\" rel=\"nofollow noreferrer\">Here is a link to a rust playground example</a></p>\n"}, {"tags": ["pointers", "types", "reference", "rust", "unsafe"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554299355, "post_id": 55496176, "comment_id": 97700591, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/questions/30174822/how-to-create-a-dst-type\">How to create a DST type?</a>. If you disagree, please <b><a href=\"https://stackoverflow.com/posts/55496176/edit\">edit</a></b> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 25, "user_id": 9891675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f5f5763c1df946b5958c2cc1cec6932?s=128&d=identicon&r=PG&f=1", "display_name": "Janonard", "link": "https://stackoverflow.com/users/9891675/janonard"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554300041, "post_id": 55496176, "comment_id": 97701052, "body": "This question is about how to create your own &quot;kind&quot; of DST type, since there are only two &quot;kind&quot;s of DSTs in Rust: Arrays and trait objects. These base DST types can be used to create new &quot;derived&quot; DSTs. I don&#39;t want to create a new &quot;kind&quot; of DST, I want to create a pointer to an array-based DST without using unsafe code. I will edit my question to clear this up."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554300134, "post_id": 55496176, "comment_id": 97701114, "body": "Then perhaps <a href=\"https://stackoverflow.com/q/25740916/155423\">How do you actually use dynamically sized types in Rust?</a> is relevant."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1554300369, "post_id": 55496176, "comment_id": 97701273, "body": "Does <code>Atom</code> actually have other (sized) fields besides <code>data</code> and <code>len</code>?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554301317, "post_id": 55496176, "comment_id": 97701881, "body": "C doesn&#39;t have fat pointer or <code>DST</code> so you will have to precise what your hypothetical C API is doing. I check a little on <a href=\"http://drobilla.net/docs/lilv/\" rel=\"nofollow noreferrer\">drobilla.net/docs/lilv</a> doesn&#39;t give me much information. Your <code>Atom</code> structure is not C compatible see <a href=\"https://stackoverflow.com/a/53050526/1233251\">stackoverflow.com/a/53050526/1233251</a>. So, If you want to do Rust-to-C, your question don&#39;t make sense."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1554301398, "post_id": 55496176, "comment_id": 97701940, "body": "Do you actually need a fat pointer to manipulate this in Rust code? If the value is always constructed outside of Rust, then can&#39;t you just refer to it via a normal reference, <code>&amp;Atom</code>, assuming you can make guarantees about its lifetime or a <code>*const Atom</code> if not?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554301468, "post_id": 55496176, "comment_id": 97701976, "body": "Perhaps also via an opaque pointer: <a href=\"https://stackoverflow.com/q/38315383/155423\">What&#39;s the Rust idiom to define a field pointing to a C opaque pointer?</a>"}, {"owner": {"reputation": 25, "user_id": 9891675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f5f5763c1df946b5958c2cc1cec6932?s=128&d=identicon&r=PG&f=1", "display_name": "Janonard", "link": "https://stackoverflow.com/users/9891675/janonard"}, "edited": false, "score": 0, "creation_date": 1554302607, "post_id": 55496176, "comment_id": 97702751, "body": "Sorry for not testing my code before posting, I should have done that. Also: Yes, C can&#39;t express DSTs, but No, Atoms are dynamically sized types: The general idea of an atom is that it has a sized header in the beginning and then an arbitrary, <i>dynamic</i> amount of bytes followed. Also, I have a good argument for this model being compatible with C: It works in my project! (<a href=\"https://github.com/Janonard/lv2rs.git\" rel=\"nofollow noreferrer\">project</a>, <a href=\"https://github.com/Janonard/lv2rs-book.git\" rel=\"nofollow noreferrer\">examples</a> )"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554303720, "post_id": 55496176, "comment_id": 97703628, "body": "&quot;Everything works just fine, I&#39;ve deeply thought about the data models and tested it;&quot; I really doubt about that. looking by your code what you do is incorrect"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554308159, "post_id": 55496176, "comment_id": 97706316, "body": "Please, keep update this question as you go though your project but I think you should look at FAM in C and how bindgen <a href=\"https://stackoverflow.com/a/53055574/7076153\">handle</a> them (you should do something similar), also, forget about the idea to create the fat pointer yourself in Rust that will not help you to make better code."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554332457, "post_id": 55496176, "comment_id": 97716924, "body": "See also <a href=\"https://stackoverflow.com/q/27859822/155423\">Is it possible to have stack allocated arrays with the size determined at runtime in Rust?</a>"}, {"owner": {"reputation": 25, "user_id": 9891675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f5f5763c1df946b5958c2cc1cec6932?s=128&d=identicon&r=PG&f=1", "display_name": "Janonard", "link": "https://stackoverflow.com/users/9891675/janonard"}, "edited": false, "score": 0, "creation_date": 1554374721, "post_id": 55496176, "comment_id": 97732600, "body": "&quot;forget about the idea to create the fat pointer yourself in Rust&quot; Why should I forget about fat pointers? Could you explain that? Is it because the raw representation of fat pointer isn&#39;t stable across versions or architectures? I mean, slices are fat pointers too and the <code>from_raw_parts</code> method also constructs them in a similar way (It uses a union instead of <code>transmute</code>, but it&#39;s basically the same). The way <code>from_raw_parts</code> handles fat pointers even inspired me to use this approach."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 9891675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f5f5763c1df946b5958c2cc1cec6932?s=128&d=identicon&r=PG&f=1", "display_name": "Janonard", "link": "https://stackoverflow.com/users/9891675/janonard"}, "edited": false, "score": 2, "creation_date": 1554303262, "post_id": 55498012, "comment_id": 97703268, "body": "I&#39;m sorry, but that doesn&#39;t solve the problem. The problem is about how to safely create a fat pointer to an array-based type, not if LV2 atoms are DSTs or not. I shouldn&#39;t have said something about LV2, it made the discussion go in a completely wrong direction. Everything works fine, I just want to have a safe alternative to <code>transmute</code> :("}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": -1, "last_activity_date": 1612211055, "last_edit_date": 1612211055, "creation_date": 1554302845, "answer_id": 55498012, "question_id": 55496176, "link": "https://stackoverflow.com/questions/55496176/how-to-safely-construct-fat-pointers-pointers-to-dsts-of-lv2-atoms-in-rust/55498012#55498012", "title": "How to safely construct fat pointers/pointers to DSTs of LV2 atoms in Rust?", "body": "<h1>Assuming you want dynamic-sized-types</h1>\n<p>Change your type to a generic one that allows an unsized parameter that defaults to <code>[u8]</code>. Then you can take a concrete value and get the unsized version:</p>\n<pre class=\"lang-rust prettyprint-override\"><code>#[repr(C)]\nstruct Atom&lt;D: ?Sized = [u8]&gt; {\n    /// The len of the `data` field.\n    len: u32,\n    /// The data.\n    data: D,\n}\n\nfn main() {\n    let a1: &amp;Atom = &amp;Atom {\n        len: 12,\n        data: [1, 2, 3],\n    };\n\n    let a2: Box&lt;Atom&gt; = Box::new(Atom {\n        len: 34,\n        data: [4, 5, 6],\n    });\n}\n</code></pre>\n<p>See also:</p>\n<ul>\n<li><a href=\"https://stackoverflow.com/q/25740916/155423\">How do you actually use dynamically sized types in Rust?</a></li>\n</ul>\n<h1>Assuming you want LV2 atoms</h1>\n<blockquote>\n<p>I am working on an integration of LV2 atoms for Rust</p>\n</blockquote>\n<p>Is there a reason you are not using the <a href=\"https://docs.rs/lv2_raw/\" rel=\"nofollow noreferrer\">existing crate that deals with this</a>?</p>\n<blockquote>\n<p>LV2 atoms for Rust, which are slice-based dynamically sized types</p>\n</blockquote>\n<p>They are not, according to <a href=\"https://github.com/x42/lv2vst/blob/c6a66b442baf218b5ad56c83ff4ce0bc7c0c4932/include/lv2/lv2plug.in/ns/ext/atom/atom.h\" rel=\"nofollow noreferrer\">the source code I could find</a>. Instead, it only uses structural composition:</p>\n<pre class=\"lang-c prettyprint-override\"><code>typedef struct {\n    uint32_t size;  /**&lt; Size in bytes, not including type and size. */\n    uint32_t type;  /**&lt; Type of this atom (mapped URI). */\n} LV2_Atom;\n\n/** An atom:Int or atom:Bool.  May be cast to LV2_Atom. */\ntypedef struct {\n    LV2_Atom atom;  /**&lt; Atom header. */\n    int32_t  body;  /**&lt; Integer value. */\n} LV2_Atom_Int;\n</code></pre>\n<p>The <a href=\"http://lv2plug.in/doc/html/group__atom.html\" rel=\"nofollow noreferrer\">official documentation</a> appears to agree. This means that it would likely be invalid to ever take an <code>LV2_Atom</code> by value as you'd only copy the header, not the body. This is commonly referred to as <em>struct tearing</em>.</p>\n<hr />\n<p>In Rust, this could be implemented as:</p>\n<pre><code>use libc::{int32_t, uint32_t};\n\n#[repr(C)]\nstruct Atom {\n    size: uint32_t,\n    r#type: uint32_t,\n}\n\n#[repr(C)]\nstruct Int {\n    atom: Atom,\n    body: int32_t,\n}\n\nconst INT_TYPE: uint32_t = 42; // Not real\n\nextern &quot;C&quot; {\n    fn get_some_atom() -&gt; *const Atom;\n}\n\nfn get_int() -&gt; Option&lt;*const Int&gt; {\n    unsafe {\n        let a = get_some_atom();\n        if (*a).r#type == INT_TYPE {\n            Some(a as *const Int)\n        } else {\n            None\n        }\n    }\n}\n\nfn use_int() {\n    if let Some(i) = get_int() {\n        let val = unsafe { (*i).body };\n        println!(&quot;{}&quot;, val);\n    }\n}\n</code></pre>\n<p>If you look at the source code for the <a href=\"https://crates.io/crates/lv2_raw\" rel=\"nofollow noreferrer\">lv2_raw crate</a>, you'll see much the same thing. There's also a <a href=\"https://crates.io/crates/lv2\" rel=\"nofollow noreferrer\">lv2 crate</a> that attempts to bring a higher-level interface.</p>\n"}], "owner": {"reputation": 25, "user_id": 9891675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f5f5763c1df946b5958c2cc1cec6932?s=128&d=identicon&r=PG&f=1", "display_name": "Janonard", "link": "https://stackoverflow.com/users/9891675/janonard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 368, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1612211055, "creation_date": 1554297491, "last_edit_date": 1554303460, "question_id": 55496176, "link": "https://stackoverflow.com/questions/55496176/how-to-safely-construct-fat-pointers-pointers-to-dsts-of-lv2-atoms-in-rust", "title": "How to safely construct fat pointers/pointers to DSTs of LV2 atoms in Rust?", "body": "<p>I am working on an integration of LV2 atoms for Rust, which are slice-based dynamically sized types (DSTs). In general, atoms are created by the host or other plugins and my code receives only a thin pointer to them. Therefore, I need to create a fat pointer to a slice-based DST from a thin pointer. This is how my code roughly looks like:</p>\n\n<pre><code>#[repr(C)]\nstruct Atom {\n    /// The len of the `data` field.\n    len: u32,\n    /// The data. \n    data: [u8],\n}\n\n/// This is the host. It creates the atom in a generally unknown way and calls\n/// the plugin's run function. This isn't really part of my code, but it is\n/// needed to understand it.\nfn host() {\n    // The raw representation of the atom\n    let raw_representation: [u8; 8] = [\n        // len: Raw representation of a `u32`. We have four data bytes.\n        4, 0, 0, 0,\n        // The actual data:\n        1, 2, 3, 4\n    ];\n\n    let ptr: *const u8 = raw_representation.as_ptr();\n\n    plugin_run(ptr);\n}\n\n/// This function represents the plugin's run function:\n/// It only knows the pointer to the atom, nothing more.\nfn plugin_run(ptr: *const u8) {\n    // The length of the data.\n    let len: u32 = *unsafe { (ptr as *const u32).as_ref() }.unwrap();\n\n    // The \"true\" representation of the fat pointer.\n    let fat_pointer: (*const u8, usize) = (ptr, len as usize);\n\n    // transmuting the tuple into the actuall raw pointer.\n    let atom: *const Atom = unsafe { std::mem::transmute(fat_pointer) };\n\n    println!(\"{:?}\", &amp;atom.data);\n}\n</code></pre>\n\n<p>The interesting line is the penultimate line in <code>plugin_run</code>: Here, a fat pointer is created by transmuting a tuple containing the thin pointer and the length. This approach works, but it uses the highly unsafe <a href=\"https://doc.rust-lang.org/std/mem/fn.transmute.html\" rel=\"nofollow noreferrer\"><code>transmute</code></a> method. According to the documentation, this method should be the absolute last resort, but as far as I understand the design of Rust, I'm doing nothing that should be unsafe. I'm just creating a pointer!</p>\n\n<p>I don't want to stick with this solution. Is there a safe way to create pointers to array-based structs apart from using <code>transmute</code>?</p>\n\n<p>The only thing that goes in this direction is <a href=\"https://doc.rust-lang.org/std/slice/fn.from_raw_parts.html\" rel=\"nofollow noreferrer\"><code>std::slice::from_raw_parts</code></a>, but it is also unsafe, directly creates a reference, not a pointer, and works exclusively for slices. I found nothing in the standard library, I found nothing on crates.io, I even found no issues in the git repo.  Am I searching for the wrong keywords? Is something like this actually welcome in Rust?</p>\n\n<p>If nothing like this exists, I would go forth and create an issue for that in Rust's Github repo.</p>\n\n<p>EDIT: I shouldn't have said something about LV2, it made the discussion go in a completely different direction. Everything works just fine, I've deeply thought about the data models and tested it; The only thing I would like to have is a safe alternative to using <code>transmute</code> to create fat pointers. :(</p>\n"}, {"tags": ["rust", "embedded", "lld"], "comments": [{"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 1, "creation_date": 1554289812, "post_id": 55493611, "comment_id": 97694449, "body": "What <i>do</i> you have at address 0x8003c00? The value <code>8001bc0</code> per chance?"}, {"owner": {"reputation": 336, "user_id": 2115405, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fe3e511f82696b9306e063bffaa0e913?s=128&d=identicon&r=PG", "display_name": "Kristoffer", "link": "https://stackoverflow.com/users/2115405/kristoffer"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1554290422, "post_id": 55493611, "comment_id": 97694840, "body": "Well sir, I do have c01b0008, but that is due to my endianess..."}, {"owner": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1554290701, "post_id": 55493611, "comment_id": 97695015, "body": "Right. So your code only stores a pointer in flash, not the actual string. I don&#39;t know anything about Rust, but in C you would do <code>const char str[] = &quot;This is in the correct place no?&quot;</code> rather than <code>const char* str = ...</code>."}, {"owner": {"reputation": 336, "user_id": 2115405, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fe3e511f82696b9306e063bffaa0e913?s=128&d=identicon&r=PG", "display_name": "Kristoffer", "link": "https://stackoverflow.com/users/2115405/kristoffer"}, "reply_to_user": {"reputation": 153119, "user_id": 584518, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/RZLo7.png?s=128&g=1", "display_name": "Lundin", "link": "https://stackoverflow.com/users/584518/lundin"}, "edited": false, "score": 0, "creation_date": 1554291526, "post_id": 55493611, "comment_id": 97695525, "body": "Thank you, at least i know there are no other errors, rust is not very forgiving for creating arbitrary lengt arrays though, but that is another problem"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554293215, "post_id": 55493611, "comment_id": 97696592, "body": "As lundin said, the pointer to the string is stored at that position. Is that a problem? You else have to store a byte array <code>[u8]</code> at the position. A problem could be the length of the string (not <code>\\0</code> terminated) as well as the encoding (Rust uses UTF-8 per default)"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554294868, "post_id": 55493611, "comment_id": 97697673, "body": "See also <a href=\"https://stackoverflow.com/q/48701896/155423\">How do I declare a static variable as a reference to a hard-coded memory address?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": true, "score": 3, "last_activity_date": 1554293925, "creation_date": 1554293925, "answer_id": 55495027, "question_id": 55493611, "link": "https://stackoverflow.com/questions/55493611/how-do-i-declare-a-static-variable-in-a-specific-memory-region-in-rust/55495027#55495027", "title": "How do I declare a static variable in a specific memory region in Rust?", "body": "<p>The value of <code>&amp;'static str</code> is still just a pointer, so you are storing only an address in the <code>.device_info</code> section, not the data it is pointing to. To store the actual value there, you could use:</p>\n\n<pre><code>#[link_section = \".device_info\"]\nstatic DEVINFO: [u8; 32] = *b\"This is in the correct place no?\";\n</code></pre>\n"}], "owner": {"reputation": 336, "user_id": 2115405, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/fe3e511f82696b9306e063bffaa0e913?s=128&d=identicon&r=PG", "display_name": "Kristoffer", "link": "https://stackoverflow.com/users/2115405/kristoffer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 381, "favorite_count": 0, "accepted_answer_id": 55495027, "answer_count": 1, "score": 2, "last_activity_date": 1554294911, "creation_date": 1554289370, "last_edit_date": 1554294911, "question_id": 55493611, "link": "https://stackoverflow.com/questions/55493611/how-do-i-declare-a-static-variable-in-a-specific-memory-region-in-rust", "title": "How do I declare a static variable in a specific memory region in Rust?", "body": "<p>I have static constant that I want to place in a specific memory region of my MCU, and the program is written in Rust for an ARM stm32m4 MCU.</p>\n\n<p>In my test case I have defined the variable as such:</p>\n\n<pre><code>#[link_section = \".device_info\"]\nstatic DEVINFO: &amp;'static str = \"This is in the correct place no?\";\n</code></pre>\n\n<p>In my <code>memory.x</code> file I have specified:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>MEMORY\n{\n    FLASH           : org = 0x08000000, len = 15k\n    DEVICE_INFO     : org = 0x08003C00, len = 1k\n    EEPROM          : org = 0x08004000, len = 16k\n    ..Others\n}\n\nSECTIONS {\n     .device_info :  {\n       *(.device_info);\n       . = ALIGN(4);\n     } &gt; DEVICE_INFO\n} INSERT AFTER .text;\n</code></pre>\n\n<p>This builds, but when I check my output file, I want to find the text <code>\"This is in the correct place no?\"</code> located at <code>0x8003c00</code>, but instead when I search with this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>arm-none-eabi-objdump  target/thumbv7em-none-eabihf/debug/binaryfile -s | rg -C4 This\n</code></pre>\n\n<p>It gives this as output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code> 8001b80 401b0008 2b000000 6b1b0008 15000000  @...+...k.......\n 8001b90 59010000 15000000 00000000 00000000  Y...............\n 8001ba0 696e6465 78206f75 74206f66 20626f75  index out of bou\n 8001bb0 6e64733a 20746865 206c656e 20697320  nds: the len is\n 8001bc0 54686973 20697320 696e2074 68652063  This is in the c\n 8001bd0 6f727265 63742070 6c616365 206e6f3f  orrect place no?\n 8001be0 4e6f2076 616c6964 20666972 6d776172  No valid firmwar\n 8001bf0 65737372 632f6c69 622e7273 e01b0008  essrc/lib.rs....\n 8001c00 12000000 f21b0008 0a000000 ac000000  ................\n</code></pre>\n\n<p>How do I get the string to be stored at <code>8003c00</code> when compiling? Or any value for that matter?</p>\n\n<p>Basically, in the end, I want to store a larger structure at that specific position as this is my bootloader, and I want to read that structure's value from my application code later.</p>\n"}, {"tags": ["multithreading", "functional-programming", "rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554294649, "post_id": 55490906, "comment_id": 97697543, "body": "<a href=\"https://stackoverflow.com/questions/26757355/how-do-i-collect-into-an-array\">How do I collect into an array?</a> \u2014 TL;DR you cant easily. Use <code>ArrayVec</code> or just stick with a <code>Vec</code>, which will only do one allocation anyway since the length of the iterator is known."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 7801186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/133adcd6c5d358d3c543a72a56927a60?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse Maas", "link": "https://stackoverflow.com/users/7801186/jesse-maas"}, "edited": false, "score": 0, "creation_date": 1554283148, "post_id": 55491365, "comment_id": 97690343, "body": "Ah thanks. This is exactly what I thought. (I was writing the edit while you posted this.) I think I&#39;ll have a look at rayon."}], "tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": false, "score": 6, "last_activity_date": 1554294750, "last_edit_date": 1554294750, "creation_date": 1554282754, "answer_id": 55491365, "question_id": 55490906, "link": "https://stackoverflow.com/questions/55490906/why-does-spawning-threads-using-iteratormap-not-run-the-threads-in-parallel/55491365#55491365", "title": "Why does spawning threads using Iterator::map not run the threads in parallel?", "body": "<p>Iterators in Rust are lazy, so your threads are not started until <code>handles.fold</code> tries to access the corresponding element of the iterator. Basically what happens is:</p>\n\n<ol>\n<li><code>handles.fold</code> tries to access the first element of the iterator.</li>\n<li>The first thread is started.</li>\n<li><code>handles.fold</code> calls its closure, which calls <code>handle.join()</code> for the first thread.</li>\n<li><code>handle.join</code> waits for the first thread to finish.</li>\n<li><code>handles.fold</code> tries to access the second element of the iterator.</li>\n<li>The second thread is started.</li>\n<li>and so on.</li>\n</ol>\n\n<p>You should collect the handles into a vector before folding the result:</p>\n\n<pre><code>let handles: Vec&lt;_&gt; = (0..THREAD_COUNT)\n    .map(|thread_id| {\n        thread::spawn(move ||\n            // calculate the sum of all numbers from assigned to this thread\n            (thread_id * BATCH_SIZE + 1 .. (thread_id + 1) * BATCH_SIZE + 1)\n                .fold(0_u64,|sum, number| sum + number))\n    })\n    .collect();\n</code></pre>\n\n<p>Or you could use a crate like <a href=\"https://crates.io/crates/rayon\" rel=\"nofollow noreferrer\">Rayon</a> which provides parallel iterators.</p>\n"}], "owner": {"reputation": 21, "user_id": 7801186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/133adcd6c5d358d3c543a72a56927a60?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse Maas", "link": "https://stackoverflow.com/users/7801186/jesse-maas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 468, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554294750, "creation_date": 1554281409, "last_edit_date": 1554294577, "question_id": 55490906, "link": "https://stackoverflow.com/questions/55490906/why-does-spawning-threads-using-iteratormap-not-run-the-threads-in-parallel", "title": "Why does spawning threads using Iterator::map not run the threads in parallel?", "body": "<p>I wrote a simple multithreaded application in Rust to add the numbers from 1 to x. (I know there is a formula for this, but the point was to write some multi threaded code in Rust, not to get the outcome.)\nIt worked fine, but after I refactored it to a more functional style instead of imperative, there was no more speedup from multithreading. When inspecting the CPU usage, it appears that only one core is used of my 4 core / 8 thread CPU. The original code has 790% CPU usage, while the refactored version only has 99%.</p>\n\n<p>The original code: </p>\n\n<pre><code>use std::thread;\n\nfn main() {\n    let mut handles: Vec&lt;thread::JoinHandle&lt;u64&gt;&gt; = Vec::with_capacity(8);\n\n    const thread_count: u64 = 8;\n    const batch_size: u64 = 20000000;\n\n    for thread_id in 0..thread_count {\n        handles.push(thread::spawn(move || {\n            let mut sum = 0_u64;\n\n            for i in thread_id * batch_size + 1_u64..(thread_id + 1) * batch_size + 1_u64 {\n                sum += i;\n            }\n\n            sum\n        }));\n    }\n\n    let mut total_sum = 0_u64;\n\n    for handle in handles.into_iter() {\n        total_sum += handle.join().unwrap();\n    }\n    println!(\"{}\", total_sum);\n}\n</code></pre>\n\n<p>The refactored code:</p>\n\n<pre><code>use std::thread;\n\nfn main() {\n    const THREAD_COUNT: u64 = 8;\n    const BATCH_SIZE: u64 = 20000000;\n\n    // spawn threads that calculate a part of the sum\n    let handles = (0..THREAD_COUNT).map(|thread_id| {\n        thread::spawn(move ||\n            // calculate the sum of all numbers from assigned to this thread\n            (thread_id * BATCH_SIZE + 1 .. (thread_id + 1) * BATCH_SIZE + 1)\n                .fold(0_u64,|sum, number| sum + number))\n    });\n\n    // add the parts of the sum together to get the total sum\n    let sum = handles.fold(0_u64, |sum, handle| sum + handle.join().unwrap());\n\n    println!(\"{}\", sum);\n}\n</code></pre>\n\n<p>the outputs of the programs are the same (12800000080000000), but the refactored version is 5-6 times slower. </p>\n\n<p>It appears that iterators are lazily evaluated. How can I force the entire iterator to be evaluated? I tried to collect it into an array of type <code>[thread::JoinHandle&lt;u64&gt;; THREAD_COUNT as usize]</code>, but I then I get the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>  --&gt; src/main.rs:14:7\n   |\n14 |     ).collect::&lt;[thread::JoinHandle&lt;u64&gt;; THREAD_COUNT as usize]&gt;();\n   |       ^^^^^^^ a collection of type `[std::thread::JoinHandle&lt;u64&gt;; 8]` cannot be built from `std::iter::Iterator&lt;Item=std::thread::JoinHandle&lt;u64&gt;&gt;`\n   |\n   = help: the trait `std::iter::FromIterator&lt;std::thread::JoinHandle&lt;u64&gt;&gt;` is not implemented for `[std::thread::JoinHandle&lt;u64&gt;; 8]`\n</code></pre>\n\n<p>Collecting into a vector does work, but that seems like a weird solution, because the size is known up front. Is there a better way then using a vector?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 4, "creation_date": 1554273957, "post_id": 55488612, "comment_id": 97685301, "body": "so many question in one question"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554274403, "post_id": 55488612, "comment_id": 97685510, "body": "Btw: <a href=\"https://stackoverflow.com/questions/27961879\">Why is using return as the last statement in a function considered bad style?</a>"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554274426, "post_id": 55488612, "comment_id": 97685527, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/50345139/why-can-i-return-a-reference-to-a-local-literal-but-not-a-variable\">Why can I return a reference to a local literal but not a variable?</a>"}, {"owner": {"reputation": 719, "user_id": 6159371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IkhNG.jpg?s=128&g=1", "display_name": "pingze", "link": "https://stackoverflow.com/users/6159371/pingze"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554276305, "post_id": 55488612, "comment_id": 97686384, "body": "@Stargateur I&#39;ll break it down into a few small problems"}], "answers": [{"tags": [], "owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "is_accepted": false, "score": 1, "last_activity_date": 1589474657, "last_edit_date": 1589474657, "creation_date": 1554277624, "answer_id": 55489718, "question_id": 55488612, "link": "https://stackoverflow.com/questions/55488612/confusion-about-ownership-lifetime-in-rust/55489718#55489718", "title": "Confusion about ownership/lifetime in Rust", "body": "<p>Here are the answers to your subquestions:</p>\n\n<blockquote>\n  <p>1) Why you can return <code>&amp;str</code> type but not a <code>&amp;[i32]</code>? Why <code>&amp;str</code>'s value not dropped when function finish?</p>\n</blockquote>\n\n<p>Because when your code compiles, it is referred as <code>'static</code> lifetime. Thus it is not dropped when function finished.</p>\n\n<blockquote>\n  <p>2) How can I write a function that accept <code>&amp;[i32]</code>s, and return a new <code>&amp;[i32]</code>? </p>\n</blockquote>\n\n<p>The signature of your function is correct. But in the implementation, you need to specify your declaration with <code>'static</code> lifetime or at least write it in the way that compiler can refer it as <code>'static</code>. <a href=\"https://stackoverflow.com/questions/50345139/why-can-i-return-a-reference-to-a-local-literal-but-not-a-variable\">Reference</a></p>\n\n<blockquote>\n  <p>3) How can I write a function that accept <code>[i32]</code>s, and return a new <code>[i32]</code>, when the length cannot be determined at compilation time?</p>\n</blockquote>\n\n<p>To use them as you wanted, you need to use <code>Box</code> and change your function signature as following: <a href=\"https://doc.rust-lang.org/1.26.1/std/boxed/struct.Box.html\" rel=\"nofollow noreferrer\">Reference</a></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>fn combine_1(v1: Box&lt;[i32]&gt;, v2: Box&lt;[i32]&gt;) -&gt; Box&lt;[i32]&gt;\n</code></pre>\n\n<blockquote>\n  <p>4) Why <code>[i32]</code> must have a length, but <code>&amp;[i32]</code> not?</p>\n</blockquote>\n\n<p>There are essentially 2 forms of arrays in Rust: <a href=\"https://stackoverflow.com/questions/44864442/passing-array-to-function-array-must-have-sized-type\">Reference</a></p>\n\n<ul>\n<li><code>[T; N]</code> is an array of <code>N</code> <code>T</code>s, it is <code>Sized</code>.</li>\n<li><code>[T]</code> is an array of <code>T</code> of size only known at run-time, it is NOT <code>Sized</code>, and can only really be manipulated as a slice <code>(&amp;[T])</code>.</li>\n</ul>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=9e45199e024ca5842d4aeb6968274a5d\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 719, "user_id": 6159371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IkhNG.jpg?s=128&g=1", "display_name": "pingze", "link": "https://stackoverflow.com/users/6159371/pingze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "closed_date": 1554348535, "answer_count": 1, "score": 1, "last_activity_date": 1589474657, "creation_date": 1554273618, "question_id": 55488612, "link": "https://stackoverflow.com/questions/55488612/confusion-about-ownership-lifetime-in-rust", "closed_reason": "Needs more focus", "title": "Confusion about ownership/lifetime in Rust", "body": "<p>Here is some functions to combine two things to one:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// It's right. move v1/v2's ownership in when call, move v's ownership back when finish.\nfn combine_v(v1: Vec&lt;i32&gt;, v2: Vec&lt;i32&gt;) -&gt; Vec&lt;i32&gt; {\n    let v = vec![1,2,3];\n    return v;\n}\n\n// It's right with lifetime statements. I can return a `&amp;str` type var.\nfn combine_s&lt;'a&gt;(s1: &amp;'a str, s2: &amp;'a str) -&gt; &amp;'a str {\n    let s = \"123\";\n    return s;\n}\n\n// It's not right. \nfn combine&lt;'a&gt;(v1: &amp;'a [i32], v2: &amp;'a [i32]) -&gt; &amp;'a [i32] {\n    let a = [1, 2, 3];\n    // cannot return reference to local variable `a`\n    return &amp;a;\n}\n\n// It's not right. \n// Error: the size for values of type `[i32]` cannot be known at compilation time\nfn combine_1(v1: [i32], v2: [i32]) -&gt; [i32] {\n    let a = [1,2,3];\n    return a;\n}\n</code></pre>\n\n<p>So I have questions:</p>\n\n<ol>\n<li><p>Why you can return <code>&amp;str</code> type but not a <code>&amp;[i32]</code>? Why <code>&amp;str</code>'s value not dropped when function finish?</p></li>\n<li><p>(How) Can I write a function that accept <code>&amp;[i32]</code>s, and return a new <code>&amp;[i32]</code>?</p></li>\n<li><p>(How) Can I write a function that accept <code>[i32]</code>s, and return a new <code>[i32]</code>, when the length cannot be determined at compilation time?</p></li>\n<li><p>Why <code>[i32]</code> must have a length, but <code>&amp;[i32]</code> not?</p></li>\n</ol>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554275586, "post_id": 55488254, "comment_id": 97686047, "body": "@Stargateur Updated. Thanks. If I replace the only line in <code>main</code> with <code>parse_iprange(&quot;192.168.3.1&#47;24&quot;)</code>, it works."}], "answers": [{"tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 2, "last_activity_date": 1554275927, "creation_date": 1554275927, "answer_id": 55489223, "question_id": 55488254, "link": "https://stackoverflow.com/questions/55488254/what-is-the-difference-between-literal-string-and-args-in-rust/55489223#55489223", "title": "What is the difference between literal string and Args in Rust?", "body": "<p>The first item of <a href=\"https://doc.rust-lang.org/std/env/fn.args.html\" rel=\"nofollow noreferrer\"><code>args()</code></a> is implementation behavior:</p>\n\n<blockquote>\n  <p>The first element is traditionally the path of the executable, but it can be set to arbitrary text, and may not even exist. This means this property should not be relied upon for security purposes.</p>\n</blockquote>\n\n<p>So, you should skip it in your case:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let v: Vec&lt;_&gt; = args().skip(1).map(|arg| parse_iprange(&amp;arg)).collect();\n</code></pre>\n"}], "owner": {"reputation": 733, "user_id": 1025192, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/134f2acc9c6343574969a9fa937175c1?s=128&d=identicon&r=PG", "display_name": "Magicloud", "link": "https://stackoverflow.com/users/1025192/magicloud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 55489223, "answer_count": 1, "score": 0, "last_activity_date": 1554275927, "creation_date": 1554272122, "last_edit_date": 1554275805, "question_id": 55488254, "link": "https://stackoverflow.com/questions/55488254/what-is-the-difference-between-literal-string-and-args-in-rust", "title": "What is the difference between literal string and Args in Rust?", "body": "<p>I have a string parsing function using regex: <code>fn parse(s: &amp;str) -&gt; Option&lt;MyObj&gt;</code>. It works when testing with <code>parse(\"test string\")</code>. But failed when using <code>Args</code>. The failure is that the regex could not matching anything from <code>s</code>.</p>\n\n<p>The way I used <code>Args</code> is: <code>args().map(|arg| parse(&amp;arg)).collect()</code>. I could not see type error here. And <code>println</code> in <code>parse</code> shows <code>s</code> is the same string as \"test string\".</p>\n\n<hr>\n\n<p>Updated my description. I am not sure if my problem is related with how String and str are different. Because I was using <code>str</code> and it still failed.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate regex;\n\nuse regex::Regex;\nuse std::env::args;\n\nstruct IPRange {\n    start: u32,\n    mask: u8,\n}\n\nfn parse_iprange(ipr: &amp;str) -&gt; Option&lt;IPRange&gt; {\n    let parser = Regex::new(\n        r\"^(\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})/(\\d+|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})$\",\n    )\n    .unwrap();\n    let caps = parser.captures(ipr).unwrap();\n    return Some(IPRange { start: 0, mask: 0 });\n}\n\nfn main() {\n    let v: Vec&lt;_&gt; = args().map(|arg| parse_iprange(&amp;arg)).collect();\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ RUST_BACKTRACE=1 cargo run 192.168.3.1/24\n    Finished dev [unoptimized + debuginfo] target(s) in 0.04s\n     Running `target/debug/ip_helper 192.168.3.1/24`\nthread 'main' panicked at 'called `Option::unwrap()` on a `None` value', src/libcore/option.rs:345:21\nstack backtrace:\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\n             at src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:39\n   1: std::sys_common::backtrace::_print\n             at src/libstd/sys_common/backtrace.rs:70\n   2: std::panicking::default_hook::{{closure}}\n             at src/libstd/sys_common/backtrace.rs:58\n             at src/libstd/panicking.rs:200\n   3: std::panicking::default_hook\n             at src/libstd/panicking.rs:215\n   4: std::panicking::rust_panic_with_hook\n             at src/libstd/panicking.rs:478\n   5: std::panicking::continue_panic_fmt\n             at src/libstd/panicking.rs:385\n   6: rust_begin_unwind\n             at src/libstd/panicking.rs:312\n   7: core::panicking::panic_fmt\n             at src/libcore/panicking.rs:85\n   8: core::panicking::panic\n             at src/libcore/panicking.rs:49\n   9: &lt;core::option::Option&lt;T&gt;&gt;::unwrap\n             at /rustc/2aa4c46cfdd726e97360c2734835aa3515e8c858/src/libcore/macros.rs:10\n  10: ip_helper::parse_iprange\n             at src/main.rs:18\n</code></pre>\n"}, {"tags": ["visual-studio-code", "rust", "windows-10"], "comments": [{"owner": {"reputation": 3125, "user_id": 2878796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bxWv.png?s=128&g=1", "display_name": "UnholySheep", "link": "https://stackoverflow.com/users/2878796/unholysheep"}, "edited": false, "score": 0, "creation_date": 1554312768, "post_id": 55485873, "comment_id": 97708599, "body": "According to <a href=\"https://areweideyet.com/#vscode\" rel=\"nofollow noreferrer\">areweideyet.com/#vscode</a> you need to install the <code>CodeLLDB</code> or <code>Native Debug</code> extensions to be able to Debug Rust code"}], "answers": [{"comments": [{"owner": {"reputation": 3649, "user_id": 294569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05c97ccc8981952c53fa09dadfafb132?s=128&d=identicon&r=PG", "display_name": "Damian", "link": "https://stackoverflow.com/users/294569/damian"}, "edited": false, "score": 0, "creation_date": 1554335856, "post_id": 55500024, "comment_id": 97717673, "body": "File -&gt; Preferences -&gt; Settings -&gt; Debug -&gt;debug.allowBreakpointsEverywhere = true"}, {"owner": {"reputation": 2966, "user_id": 678016, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/063af0804dc8b3068846c875b45c7630?s=128&d=identicon&r=PG", "display_name": "Rich S", "link": "https://stackoverflow.com/users/678016/rich-s"}, "edited": false, "score": 0, "creation_date": 1608124684, "post_id": 55500024, "comment_id": 115486138, "body": "This is annoying, after a VSCode update, it must have de-selected this option."}, {"owner": {"reputation": 1091, "user_id": 1086134, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bd9e9d29fb9c6eb4c051bb92d9e2bf96?s=128&d=identicon&r=PG", "display_name": "Martin_W", "link": "https://stackoverflow.com/users/1086134/martin-w"}, "edited": false, "score": 0, "creation_date": 1614851110, "post_id": 55500024, "comment_id": 117513151, "body": "Whew! Was ready to tear my hair out. Yes, strange that this option was de-selected after an update."}], "tags": [], "owner": {"reputation": 419, "user_id": 7924529, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/324d14f7eb0354bf94637f2d4b6f391d?s=128&d=identicon&r=PG&f=1", "display_name": "Tal", "link": "https://stackoverflow.com/users/7924529/tal"}, "is_accepted": true, "score": 8, "last_activity_date": 1554308931, "creation_date": 1554308931, "answer_id": 55500024, "question_id": 55485873, "link": "https://stackoverflow.com/questions/55485873/toggle-breakpoint-does-not-work-in-visual-studio-code/55500024#55500024", "title": "Toggle Breakpoint does not work in Visual Studio Code", "body": "<p>try setting the setting value \"debug.allowBreakpointsEverywhere\" to true</p>\n"}], "owner": {"reputation": 3649, "user_id": 294569, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05c97ccc8981952c53fa09dadfafb132?s=128&d=identicon&r=PG", "display_name": "Damian", "link": "https://stackoverflow.com/users/294569/damian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 669, "favorite_count": 0, "accepted_answer_id": 55500024, "answer_count": 1, "score": 3, "last_activity_date": 1554312602, "creation_date": 1554256075, "last_edit_date": 1554312602, "question_id": 55485873, "link": "https://stackoverflow.com/questions/55485873/toggle-breakpoint-does-not-work-in-visual-studio-code", "title": "Toggle Breakpoint does not work in Visual Studio Code", "body": "<p>When I try to set a breakpoint nothing happens; I put my cursor on the <code>println!</code> line and press <kbd>F9</kbd>.</p>\n\n<pre><code>fn main() {\n    println!(\"Hello, world!\");\n}\n</code></pre>\n\n<p>I works on another machine where Visual Studio 2017 is installed, so I suspect this might the problem.</p>\n\n<p>tasks.json</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>{\n    // See https://go.microsoft.com/fwlink/?LinkId=733558\n    // for the documentation about the tasks.json format\n    \"version\": \"2.0.0\",\n    \"tasks\": [\n        {\n            \"label\": \"build\",\n            \"type\": \"shell\",\n            \"command\": \"cargo build\",\n            \"group\": {\n                \"kind\": \"build\",\n                \"isDefault\": true\n            },\n            \"presentation\": {\n                \"panel\": \"dedicated\",\n                \"clear\": true\n            },\n            \"problemMatcher\": {\n                \"owner\": \"rust\",\n                \"fileLocation\": [\n                    \"relative\",\n                    \"${workspaceRoot}\"\n                ],\n                \"pattern\": {\n                    \"regexp\": \"^(.+):(\\\\d+):(\\\\d+):\\\\s+(\\\\d+):(\\\\d+)\\\\s+(warning|error):\\\\s+(.*)$\",\n                    \"file\": 1,\n                    \"line\": 2,\n                    \"column\": 3,\n                    \"endLine\": 4,\n                    \"endColumn\": 5,\n                    \"severity\": 6,\n                    \"message\": 7\n                }\n            }\n        },\n        {\n            \"label\": \"clean\",\n            \"type\": \"shell\",\n            \"command\": \"cargo clean\"\n        },\n        {\n            \"label\": \"run\",\n            \"type\": \"shell\",\n            \"command\": \"cargo run\",\n            \"presentation\": {\n                \"panel\": \"dedicated\",\n                \"clear\": true\n            },\n            \"problemMatcher\": []\n        },\n        {\n            \"label\": \"test\",\n            \"type\": \"shell\",\n            \"command\": \"cargo test\",\n            \"group\": {\n                \"kind\": \"test\",\n                \"isDefault\": true\n            },\n            \"presentation\": {\n                \"panel\": \"dedicated\",\n                \"clear\": true\n            },\n            \"problemMatcher\": [\n                {\n                    \"owner\": \"rust\",\n                    \"fileLocation\": [\n                        \"relative\",\n                        \"${workspaceRoot}\"\n                    ],\n                    \"pattern\": {\n                        \"regexp\": \"^(.+):(\\\\d+):(\\\\d+):\\\\s+(\\\\d+):(\\\\d+)\\\\s+(warning|error):\\\\s+(.*)$\",\n                        \"file\": 1,\n                        \"line\": 2,\n                        \"column\": 3,\n                        \"endLine\": 4,\n                        \"endColumn\": 5,\n                        \"severity\": 6,\n                        \"message\": 7\n                    }\n                },\n                {\n                    \"owner\": \"rust\",\n                    \"fileLocation\": [\n                        \"relative\",\n                        \"${workspaceRoot}\"\n                    ],\n                    \"severity\": \"error\",\n                    \"pattern\": {\n                        \"regexp\": \"^.*panicked\\\\s+at\\\\s+'(.*)',\\\\s+(.*):(\\\\d+)$\",\n                        \"message\": 1,\n                        \"file\": 2,\n                        \"line\": 3\n                    }\n                }\n            ]\n        }\n    ]\n}\n</code></pre>\n\n<p>launch.json</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"name\": \"(Windows) Launch\",\n            \"type\": \"cppvsdbg\",\n            \"request\": \"launch\",\n            \"program\": \"${workspaceFolder}/target/debug/${workspaceRootFolderName}\",\n            \"args\": [],\n            \"stopAtEntry\": false,\n            \"cwd\": \"${workspaceFolder}/target/debug/\",\n            \"environment\": [],\n            \"externalConsole\": true,\n        },       \n    ]\n}\n</code></pre>\n\n<p>I have Visual Studio 2019 installed:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>&gt;cl --version   \nMicrosoft (R) C/C++ Optimizing Compiler Version 19.20.27508.1 for x64\nCopyright (C) Microsoft Corporation.  All rights reserved.\n</code></pre>\n\n<p>I have these Visual Studio Code extensions installed:</p>\n\n<ol>\n<li>C/C++ 0.22.1</li>\n<li>Rust (rls) 0.6.0</li>\n</ol>\n\n<p>I am using Rust 1.33.0.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554239855, "post_id": 55483678, "comment_id": 97677024, "body": "<i>why</i> are you taking a reference to <code>duck</code>?"}, {"owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "edited": false, "score": 0, "creation_date": 1554239877, "post_id": 55483678, "comment_id": 97677031, "body": "&quot;creating a bunch of instances in a for loop that can then be access[ed] outside of it&quot; - isn&#39;t it exactly what the borrow checker trying to <i>prevent</i>?"}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1554240000, "post_id": 55483678, "comment_id": 97677089, "body": "&quot;Trying to learn OOP&quot;, Rust isn&#39;t usually considered an OOP language though."}, {"owner": {"reputation": 1232, "user_id": 1135125, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/c604b99c7895e05548fa08dba3852406?s=128&d=identicon&r=PG&f=1", "display_name": "prismspecs", "link": "https://stackoverflow.com/users/1135125/prismspecs"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554240203, "post_id": 55483678, "comment_id": 97677145, "body": "@Shepmaster I&#39;m working from: <a href=\"https://stevedonovan.github.io/rust-gentle-intro/object-orientation.html#object-orientation-in-rust\" rel=\"nofollow noreferrer\">stevedonovan.github.io/rust-gentle-intro/&hellip;</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554240495, "post_id": 55483678, "comment_id": 97677259, "body": "@prismspecs that resource seems to be geared at teaching Rust to people coming from an OOP background; if you are trying to <i>learn</i> OOP, I don\u2019t know this is a good route."}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1554240612, "post_id": 55483678, "comment_id": 97677311, "body": "Is this a Rust tutorial that never talks about lifetimes and owning values?"}, {"owner": {"reputation": 1232, "user_id": 1135125, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/c604b99c7895e05548fa08dba3852406?s=128&d=identicon&r=PG&f=1", "display_name": "prismspecs", "link": "https://stackoverflow.com/users/1135125/prismspecs"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554240692, "post_id": 55483678, "comment_id": 97677338, "body": "@Shepmaster to be more clear, I mean that I am trying to learn how to utilize objects in Rust, specifically."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554255955, "post_id": 55483678, "comment_id": 97680780, "body": "Please review how to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> and then <a href=\"https://stackoverflow.com/posts/55483678/edit\">edit</a> your question to include it. We cannot tell what types, methods, traits, fields, etc. are present in the code. Try to reproduce your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> if possible, otherwise in a brand new Cargo project. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MCVE tips</a> you can use to reduce your original code for posting here."}], "answers": [{"tags": [], "owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "is_accepted": false, "score": 0, "last_activity_date": 1554241288, "last_edit_date": 1554241288, "creation_date": 1554240874, "answer_id": 55483886, "question_id": 55483678, "link": "https://stackoverflow.com/questions/55483678/how-can-new-members-persist-when-pushing-to-a-vec-in-a-for-loop/55483886#55483886", "title": "How can new members persist when pushing to a Vec in a for loop?", "body": "<p>The problem with your code is that when you create <code>duck</code> it is inside the block of for loop causing it to exist as long as the for loop exists, to fix this you need to <em>transfer</em> ownership of <code>duck</code> to the <code>vec_ducks</code>.</p>\n\n<p>In your code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let mut vec_ducks: Vec&lt;&amp;Duck&gt; = vec![];\n\nfor i in 0..100 {\n\n    let _x = rand::thread_rng().gen_range(0, 100); \n    let _y = rand::thread_rng().gen_range(0, 100); \n\n    let duck = Duck{x:_x,y:_y}; // duck is created here\n\n    vec_ducks.push(&amp;duck);\n\n    //println!(\"{}\", i);\n} // duck is dropped or out of scope here\n\nfor d in &amp;vec_ducks { // you try to use values of duck here, where they no longer exist\n    d.quack();\n}\n</code></pre>\n\n<p>Change the code to:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// take Duck and not a reference to it\nlet mut vec_ducks: Vec&lt;Duck&gt; = vec![];\n\nfor i in 0..100 {\n\n    let _x = rand::thread_rng().gen_range(0, 100); \n    let _y = rand::thread_rng().gen_range(0, 100); \n\n    let duck = Duck{x:_x,y:_y};\n\n    // move ownership\n    vec_ducks.push(duck);\n\n    //println!(\"{}\", i);\n}\n\nfor d in &amp;vec_ducks {\n    d.quack();\n}\n</code></pre>\n\n<p>Further more the example in <a href=\"https://stevedonovan.github.io/rust-gentle-intro/object-orientation.html#animals\" rel=\"nofollow noreferrer\">gentle introduction</a> works because <code>duck1</code> and <code>duck2</code> are in the same scope/block as <code>ducks</code> i.e. the main block.</p>\n\n<p>You can read more about ownership and lifetimes <a href=\"https://doc.rust-lang.org/nomicon/ownership.html\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 1232, "user_id": 1135125, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/c604b99c7895e05548fa08dba3852406?s=128&d=identicon&r=PG&f=1", "display_name": "prismspecs", "link": "https://stackoverflow.com/users/1135125/prismspecs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1554255937, "creation_date": 1554239699, "last_edit_date": 1554255937, "question_id": 55483678, "link": "https://stackoverflow.com/questions/55483678/how-can-new-members-persist-when-pushing-to-a-vec-in-a-for-loop", "title": "How can new members persist when pushing to a Vec in a for loop?", "body": "<p>I am trying to learn how to utilize objects in Rust by hacking away. The following code predictably gives \"borrowed value does not live long enough\" but I'm not sure what to change. What is the approach to creating a bunch of instances in a for loop that can then be access outside of it?</p>\n\n<pre><code>let mut vec_ducks: Vec&lt;&amp;Duck&gt; = vec![];\n\nfor i in 0..100 {\n    let _x = rand::thread_rng().gen_range(0, 100);\n    let _y = rand::thread_rng().gen_range(0, 100);\n\n    let duck = Duck { x: _x, y: _y };\n\n    vec_ducks.push(&amp;duck);\n\n    //println!(\"{}\", i);\n}\n\nfor d in &amp;vec_ducks {\n    d.quack();\n}\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1554242316, "post_id": 55483470, "comment_id": 97677919, "body": "Some parts of the question are unclear: do you mean the <code>ArrayVec</code> type from the <code>arrayvec</code> crate? And do you mean &quot;decorate&quot; rather than &quot;decorticate&quot;? A <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> might still help, so as to be clear what <code>client</code> is."}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 0, "creation_date": 1554325537, "post_id": 55483470, "comment_id": 97714673, "body": "You probably want a <a href=\"https://doc.rust-lang.org/book/ch05-01-defining-structs.html?highlight=tuple,stru#using-tuple-structs-without-named-fields-to-create-different-types\" rel=\"nofollow noreferrer\">tuple struct</a> instead of an enum. So the access becomes <code>encapsulated_array.0.do_whatever()</code>."}, {"owner": {"reputation": 1113, "user_id": 1426842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GU6Z5.jpg?s=128&g=1", "display_name": "Micha\u0142 Fita", "link": "https://stackoverflow.com/users/1426842/micha%c5%82-fita"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1554327692, "post_id": 55483470, "comment_id": 97715416, "body": "@E_net4 Edited. <a href=\"https://www.thefreedictionary.com/decorticate\" rel=\"nofollow noreferrer\">thefreedictionary.com/decorticate</a> @Michail The tuple struct works, cuts down one line... two actually as <code>#[serde(untagged)]</code> goes away from enum type."}, {"owner": {"reputation": 1113, "user_id": 1426842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GU6Z5.jpg?s=128&g=1", "display_name": "Micha\u0142 Fita", "link": "https://stackoverflow.com/users/1426842/micha%c5%82-fita"}, "edited": false, "score": 0, "creation_date": 1554327823, "post_id": 55483470, "comment_id": 97715465, "body": "I&#39;m still astonished the <code>ArrayVec&lt;[MyLocalType;16]&gt;</code> isn&#39;t treated as local type and orphan rule still fires. I&#39;m unhappy with lack of C++&#39;s <code>decltype()</code> equivalent as well, but that&#39;s another story."}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1554374053, "post_id": 55483470, "comment_id": 97732209, "body": "I think the question is answered by <a href=\"https://stackoverflow.com/q/43989065/1233251\">stackoverflow.com/q/43989065/1233251</a> . It doesn&#39;t matter that local types as type parameters or local traits are involved, since these crates could still think about providing their own implementations and lead to a bunch of conflicts. The solution: use an actual newtype and implement the trait for it (roughly as you did, but a tuple struct is preferred over a single-variant enum)."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554376119, "post_id": 55483470, "comment_id": 97733451, "body": "&quot;This works as minimal example, but I suffer from the fact I cannot call client.get(()).unwrap() directly to the member of other structure.&quot;, this is uncrear"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554376280, "post_id": 55483470, "comment_id": 97733558, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/25413201/how-do-i-implement-a-trait-i-dont-own-for-a-type-i-dont-own\">How do I implement a trait I don&#39;t own for a type I don&#39;t own?</a>"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554376335, "post_id": 55483470, "comment_id": 97733585, "body": "&quot;I&#39;m still astonished the <code>ArrayVec&lt;[MyLocalType;16]&gt;</code> isn&#39;t treated as local type and orphan rule still fires. &quot; because <code>RestPast</code> could implement its trait for <code>ArrayVec&lt;T&gt;</code>"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554376524, "post_id": 55483470, "comment_id": 97733691, "body": "I don&#39;t understand why you use word &quot;specialization&quot; because you don&#39;t use it, see <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/1210-impl-specialization.md\" rel=\"nofollow noreferrer\">github.com/rust-lang/rfcs/blob/master/text/&hellip;</a>"}, {"owner": {"reputation": 1113, "user_id": 1426842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GU6Z5.jpg?s=128&g=1", "display_name": "Micha\u0142 Fita", "link": "https://stackoverflow.com/users/1426842/micha%c5%82-fita"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554381427, "post_id": 55483470, "comment_id": 97736916, "body": "@Stargateur Ups... Maybe I use C++ terminology that applies to templates. Is instantiation a correct term here? BTW <i>thank you</i> for correcting my British English into American..."}, {"owner": {"reputation": 1113, "user_id": 1426842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GU6Z5.jpg?s=128&g=1", "display_name": "Micha\u0142 Fita", "link": "https://stackoverflow.com/users/1426842/micha%c5%82-fita"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554381625, "post_id": 55483470, "comment_id": 97737054, "body": "@Stargateur &quot;because RestPast could implement its trait for ArrayVec&lt;T&gt;&quot; - could it be detected by compiler and then rejected as error?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554382063, "post_id": 55483470, "comment_id": 97737369, "body": "&quot;BTW thank you for correcting my British English into American...&quot; well thanks to my spell checking to do it for me and fix my english mistake, I&#39;m french and I don&#39;t speak english very well. I don&#39;t really care about your war with US english feel free to reverse it, it&#39;s your question"}, {"owner": {"reputation": 1113, "user_id": 1426842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GU6Z5.jpg?s=128&g=1", "display_name": "Micha\u0142 Fita", "link": "https://stackoverflow.com/users/1426842/micha%c5%82-fita"}, "edited": false, "score": 0, "creation_date": 1554384180, "post_id": 55483470, "comment_id": 97738785, "body": "Hmm... <a href=\"https://github.com/rust-lang/rust/issues/24745\" rel=\"nofollow noreferrer\">github.com/rust-lang/rust/issues/24745</a>"}], "owner": {"reputation": 1113, "user_id": 1426842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GU6Z5.jpg?s=128&g=1", "display_name": "Micha\u0142 Fita", "link": "https://stackoverflow.com/users/1426842/micha%c5%82-fita"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554381725, "creation_date": 1554238707, "last_edit_date": 1554381725, "question_id": 55483470, "link": "https://stackoverflow.com/questions/55483470/restpath-trait-for-arrayvec-specialisation", "title": "RestPath trait for ArrayVec&lt;&gt; specialisation", "body": "<p>I have my types defined and then I keep them in something like <a href=\"https://docs.rs/arrayvec/0.4.10/arrayvec/struct.ArrayVec.html\" rel=\"nofollow noreferrer\"><code>ArrayVec&lt;[MyType, 16]&gt;</code></a> (from <a href=\"https://crates.io/crates/arrayvec\" rel=\"nofollow noreferrer\"><code>arrayvec</code></a> crate) variables (members of a structure). <a href=\"https://github.com/spietika/restson-rust\" rel=\"nofollow noreferrer\">Restson</a> has the <a href=\"https://docs.rs/restson/0.5.3/restson/trait.RestPath.html\" rel=\"nofollow noreferrer\"><code>RestPath</code></a> trait, allow us to define a path used to form a URI when performing a REST query.</p>\n\n<p>However, due to the restriction that only local traits can be implemented for arbitrary types (AKA the orphan rule) I can't use it straightforwardly for <code>ArrayVec&lt;[MyType, 16]&gt;</code>.</p>\n\n<p>I somehow overcame the problem by implementing the trait for ~specialization~ instantiation of the following enum:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>enum ModelArray&lt;T&gt; {\n    Array(T)\n}\n</code></pre>\n\n<p>and then <a href=\"https://www.thefreedictionary.com/decorticate\" rel=\"nofollow noreferrer\">decorticate</a> the instance of <code>T</code> using:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>type MyArray = ModelArray&lt;ArrayVec&lt;[MyType; 16]&gt;&gt;;\n\nlet encapsulated_array: MyArray = client.get(()).unwrap();\n\nlet ModelArray::&lt;ArrayVec&lt;[MyType; 16]&gt;&gt;::Array(myarray) = encapsulated_array;\n</code></pre>\n\n<p>This works as minimal example, but I suffer from the fact I cannot call <code>client.get(()).unwrap()</code> directly to the member of other structure.</p>\n\n<p>I'm surprised full specialization of a generic type isn't treated by Rust as local type and orphan rule still applies. Why?</p>\n\n<p>Are there other nice ways to overcome the limitation and would let me nicely assign result of Restson's <code>get()</code> into members of a structure?</p>\n\n<hr>\n\n<p>Working code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate restson;\nextern crate arrayvec;\nextern crate serde_derive;\n\nuse restson::RestPath;\nuse arrayvec::ArrayVec;\n\n#[derive(Deserialize, Debug)]\nstruct MyType {\n    id: u16,\n    data: u32,\n}\n\nstruct DataModel {\n    my_data: ArrayVec&lt;[MyType; 16]&gt;\n}\n\n#[derive(Deserialize, Debug)]\n#[serde(untagged)]\nenum ModelArray&lt;T&gt; {\n    Array(T)\n}\n\nimpl RestPath&lt;u16&gt; for MyType {\n    fn get_path(id: u16) -&gt; Result&lt;String, Error&gt; {\n        Ok(format!(\"data/MyType/{}\", id))\n    }\n}\n\nimpl RestPath&lt;()&gt; for ModelArray&lt;ArrayVec&lt;[MyType; 16]&gt;&gt; {\n    fn get_path(_: ()) -&gt; Result&lt;String, Error&gt; {\n        Ok(String::from(\"data/MyType\"))\n    }\n}\n\nuse restson::RestClient;\n\npub fn load_data() {\n    let mut client = RestClient::new(&amp;format!(\"http://{}\", \"localhost:8080\")).unwrap();\n\n    let element: Type = client.get(24).unwrap();\n    println!(\"Room: {:?}\", elementh);\n\n    type ModelArray = ModelArray&lt;ArrayVec&lt;[MyType; 16]&gt;&gt;;\n    let encapsulated: ModelArray = client.get(()).unwrap();\n    let ModelArray::&lt;ArrayVec&lt;[MyType; 16]&gt;&gt;::Array(elements) = encapsulated;\n    println!(\"Room: {:?}\", elements[0]);\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=0611de825f040711f01b598b0e15c094\" rel=\"nofollow noreferrer\">On Rust Playground</a> (lack of <code>restson</code> crate wouldn't allow you to build)</p>\n\n<p>Respective complete code: <a href=\"https://gist.github.com/michalfita/a46f6522341d9f395de8da878e0fec2f\" rel=\"nofollow noreferrer\">on GitHubGist</a></p>\n"}, {"tags": ["rust", "traits"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554236068, "post_id": 55482833, "comment_id": 97675419, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/33759072/155423\">Why doesn&#39;t Vec&lt;T&gt; implement the Display trait?</a> and <a href=\"https://stackoverflow.com/q/25413201/155423\">How do I implement a trait I don&#39;t own for a type I don&#39;t own?</a>. All the same logic applies for <code>&amp;[T]</code> as <code>Vec&lt;T&gt;</code>. If you disagree, please <b><a href=\"https://stackoverflow.com/posts/55482833/edit\">edit</a></b> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554238129, "post_id": 55482833, "comment_id": 97676327, "body": "<a href=\"https://play.integer32.com/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=bd31e0356f55d1c527f8b60ed01251bb\" rel=\"nofollow noreferrer\">exemple</a>"}, {"owner": {"reputation": 5672, "user_id": 134692, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/60bc21f7c0f24d7933c966ae4035fcdc?s=128&d=identicon&r=PG", "display_name": "Ted Middleton", "link": "https://stackoverflow.com/users/134692/ted-middleton"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554239097, "post_id": 55482833, "comment_id": 97676712, "body": "@Shepmaster - I agree, it is answered in <a href=\"https://stackoverflow.com/q/33759072/155423\">stackoverflow.com/q/33759072/155423</a>, although the title doesn&#39;t suggest that to a rust beginner like me"}, {"owner": {"reputation": 5672, "user_id": 134692, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/60bc21f7c0f24d7933c966ae4035fcdc?s=128&d=identicon&r=PG", "display_name": "Ted Middleton", "link": "https://stackoverflow.com/users/134692/ted-middleton"}, "edited": false, "score": 0, "creation_date": 1554239325, "post_id": 55482833, "comment_id": 97676805, "body": "It&#39;s also not quite obvious to me why you need an enclosing type rather than being able to use the type directly in the trait impl, but I&#39;ll ask that as a separate question I guess."}, {"owner": {"reputation": 5672, "user_id": 134692, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/60bc21f7c0f24d7933c966ae4035fcdc?s=128&d=identicon&r=PG", "display_name": "Ted Middleton", "link": "https://stackoverflow.com/users/134692/ted-middleton"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554239430, "post_id": 55482833, "comment_id": 97676852, "body": "@Shepmaster - It&#39;s sort of answered in <a href=\"https://stackoverflow.com/q/33759072/155423\">stackoverflow.com/q/33759072/155423</a>, kind of. I own the SomeStruct type so I don&#39;t see how the second link applies, but the first link at least has a decent explanation for why there is no default and how to implement a work-around."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1554239607, "post_id": 55482833, "comment_id": 97676917, "body": "You don\u2019t own the <code>Display</code> trait or the slice / array type."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554239725, "post_id": 55482833, "comment_id": 97676975, "body": "<i>The title doesn\u2019t suggest that</i> \u2014 that\u2019s why SO has duplicates: now this question serves as a signpost to people who search for the same terms you used."}, {"owner": {"reputation": 5672, "user_id": 134692, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/60bc21f7c0f24d7933c966ae4035fcdc?s=128&d=identicon&r=PG", "display_name": "Ted Middleton", "link": "https://stackoverflow.com/users/134692/ted-middleton"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554239879, "post_id": 55482833, "comment_id": 97677033, "body": "@Shepmaster - ok sounds good"}], "owner": {"reputation": 5672, "user_id": 134692, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/60bc21f7c0f24d7933c966ae4035fcdc?s=128&d=identicon&r=PG", "display_name": "Ted Middleton", "link": "https://stackoverflow.com/users/134692/ted-middleton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "closed_date": 1554239630, "answer_count": 0, "score": 0, "last_activity_date": 1554236220, "creation_date": 1554235909, "last_edit_date": 1554236220, "question_id": 55482833, "link": "https://stackoverflow.com/questions/55482833/how-do-i-print-slices-or-arrays-of-my-struct-if-ive-implemented-fmtdisplay", "closed_reason": "Duplicate", "title": "How do I print slices or arrays of my struct if I&#39;ve implemented fmt::Display?", "body": "<p>I have a struct:</p>\n\n<pre><code>use std::fmt;\n\nstruct SomeStruct {\n    e1: i32,\n    e2: f64,\n}\n\nimpl fmt::Display for SomeStruct {\n    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {\n        write!(f, \"({}, {})\", self.e1, self.e2)\n    }\n}\n\nfn printstuff(name: &amp;str, slc: &amp;[SomeStruct]) {\n    println!(\"{} is {}\", name, slc);\n}\n\nfn main() {\n    let cap = [\n        SomeStruct { e1: 1, e2: 1.1 },\n        SomeStruct { e1: 2, e2: 2.2 },\n        SomeStruct { e1: 3, e2: 3.3 },\n        SomeStruct { e1: 4, e2: 4.4 },\n    ];\n    for elem in &amp;cap {\n        println!(\"  {}\", elem);\n    }\n    println!(\"cap[1]={}\", cap[1]);\n    println!(\"cap[2]={}\", cap[2]);\n    printstuff(\"cap\", cap);\n}\n</code></pre>\n\n<p>I've implemented <code>fmt::Display</code> on it, but when I try to print out a slice or array of <code>SomeStruct</code>, I get a compile error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: `[SomeStruct]` doesn't implement `std::fmt::Display`\n  --&gt; src/main.rs:15:32\n   |\n15 |     println!(\"{} is {}\", name, slc);\n   |                                ^^^ `[SomeStruct]` cannot be formatted with the default formatter\n   |\n   = help: the trait `std::fmt::Display` is not implemented for `[SomeStruct]`\n   = note: in format strings you may be able to use `{:?}` (or {:#?} for pretty-print) instead\n   = note: required because of the requirements on the impl of `std::fmt::Display` for `&amp;[SomeStruct]`\n   = note: required by `std::fmt::Display::fmt`\n</code></pre>\n\n<p>This makes sense - I <em>haven't</em> implemented <code>Display</code> for <code>[SomeStruct]</code>. How do I do this? I can't find any Rust docs or anything else that would indicate how I could do this.</p>\n"}, {"tags": ["rust", "opc"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554234455, "post_id": 55482442, "comment_id": 97674720, "body": "What&#39;s wrong with reading the documentation for <a href=\"https://docs.rs/opcua-client/0.5.0/opcua_client/prelude/service_types/struct.BrowseDescription.html\" rel=\"nofollow noreferrer\"><code>BrowseDescription</code></a>?"}, {"owner": {"reputation": 438, "user_id": 9430509, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_ebfvY4NU_M/AAAAAAAAAAI/AAAAAAAAAOQ/dG2q6mG6_gI/photo.jpg?sz=128", "display_name": "Sergej Herbert", "link": "https://stackoverflow.com/users/9430509/sergej-herbert"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554270799, "post_id": 55482442, "comment_id": 97684108, "body": "Nothing really. I just don&#39;t know how to get the parameters to build a BrowseDescription. Mostly (as mentioned in the question), I don&#39;t know where to get the NodeId for the BrowseDescription, as getting the list of NodeIds is my initial problem."}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 1, "creation_date": 1554272477, "post_id": 55482442, "comment_id": 97684686, "body": "<code>NodeId</code> <a href=\"https://docs.rs/opcua-client/0.5.0/opcua_client/prelude/node_id/struct.NodeId.html#impl-Default\" rel=\"nofollow noreferrer\">implements <code>Default</code></a>, doesn&#39;t the default value work?"}], "owner": {"reputation": 438, "user_id": 9430509, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_ebfvY4NU_M/AAAAAAAAAAI/AAAAAAAAAOQ/dG2q6mG6_gI/photo.jpg?sz=128", "display_name": "Sergej Herbert", "link": "https://stackoverflow.com/users/9430509/sergej-herbert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 260, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1554295153, "creation_date": 1554234297, "last_edit_date": 1554295153, "question_id": 55482442, "link": "https://stackoverflow.com/questions/55482442/how-to-browse-the-nodes-of-an-opc-ua-server-with-rust", "title": "How to browse the nodes of an OPC UA server with Rust?", "body": "<p>I want to browse a known OPC UA server endpoint to get the nodes in order to poll them later with Rust.</p>\n\n<p>I have been using the <a href=\"https://github.com/locka99/opcua\" rel=\"nofollow noreferrer\">locka99/opcua crate</a> and managed to use their samples to read values of known nodes (of the sample server), but I can not get any browsing to work.</p>\n\n<p>There is a <code>browse</code> method on the session struct, but it requires a <code>BrowseDescription</code> as argument, which in itself requires already a <code>NodeId</code>:</p>\n\n<pre><code>session.browse(BrowseDescription {\n    // how can I know the parameters?\n})\n</code></pre>\n\n<p>How can I build the <code>BrowseDescription</code> struct (with a <code>NodeId</code>) if the <code>NodeId</code> is what I am looking for?</p>\n"}, {"tags": ["reference", "rust", "mutable"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554233216, "post_id": 55482000, "comment_id": 97674194, "body": "<code>median(&amp;mut v)</code> and <code>fn median(vec: &amp;mut Vec&lt;i32&gt;)</code>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1554233312, "post_id": 55482000, "comment_id": 97674237, "body": "<b>Please</b> save yourself some heartache and take the time to read the official book: <a href=\"https://doc.rust-lang.org/book/\" rel=\"nofollow noreferrer\"><i>The Rust Programming Language</i></a>. It&#39;s online and free to read. It has an entire chapter discussing references, including <a href=\"https://doc.rust-lang.org/book/ch04-02-references-and-borrowing.html#mutable-references\" rel=\"nofollow noreferrer\">a section on mutable references</a>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554233556, "post_id": 55482000, "comment_id": 97674334, "body": "See also <a href=\"https://stackoverflow.com/q/40006219/155423\">Why is it discouraged to accept a reference to a String (&amp;String), Vec (&amp;Vec), or Box (&amp;Box) as a function argument?</a> \u2014 since you don&#39;t need to add/remove items from the <code>Vec</code>, you can take <code>&amp;mut [i32]</code> instead."}, {"owner": {"reputation": 2505, "user_id": 7505383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZbJK7.jpg?s=128&g=1", "display_name": "Sven Harris", "link": "https://stackoverflow.com/users/7505383/sven-harris"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554270544, "post_id": 55482000, "comment_id": 97684009, "body": "@Shepmaster in fact the book is exactly what I&#39;m working through at the moment, I have clearly misunderstood some of the concepts so will go back and read that chapter again, thanks!"}], "owner": {"reputation": 2505, "user_id": 7505383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZbJK7.jpg?s=128&g=1", "display_name": "Sven Harris", "link": "https://stackoverflow.com/users/7505383/sven-harris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 692, "favorite_count": 0, "closed_date": 1554233180, "answer_count": 0, "score": 0, "last_activity_date": 1554233193, "creation_date": 1554232395, "last_edit_date": 1554233123, "question_id": 55482000, "link": "https://stackoverflow.com/questions/55482000/how-can-i-pass-a-mutable-reference-of-an-array-into-a-function", "closed_reason": "Duplicate", "title": "How can I pass a mutable reference of an array into a function?", "body": "<p>I think in this case my reference needs to be mutable because I'm sorting the array, and it needs to be a reference because I want to use the same vector to calculate the mean and mode. I have tried various combinations of <code>mut</code> in the function signature and variable declaration but have not been able to get this to compile (including the suggestion in the error message but probably incorrectly implemented).</p>\n\n<p>I'm trying to implement a simple median function (I am aware there's probably a built in way but am doing this as an exercise)</p>\n\n<pre><code>fn main() {\n    let mut v = vec![1, 2, 3, 4, 5, 5, 4, 3];\n    println!(\"{}\", median(&amp;v));\n}\n\nfn median(mut vec: &amp;Vec&lt;i32&gt;) -&gt; usize {\n    vec.sort();\n    let len: usize = vec.len();\n    let middle = len as i32 / 2;\n    println!(\"{}\", &amp;middle);\n    0\n}\n</code></pre>\n\n<p>This gives the following error</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0596]: cannot borrow `*vec` as mutable, as it is behind a `&amp;` reference\n --&gt; src/main.rs:7:5\n  |\n6 | fn median(mut vec: &amp;Vec&lt;i32&gt;) -&gt; usize {\n  |                    --------- help: consider changing this to be a mutable reference: `&amp;mut std::vec::Vec&lt;i32&gt;`\n7 |     vec.sort();\n  |     ^^^ `vec` is a `&amp;` reference, so the data it refers to cannot be borrowed as mutable\n</code></pre>\n"}, {"tags": ["rust", "benchmarking", "rust-criterion"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554228964, "post_id": 55481089, "comment_id": 97672232, "body": "Your crate (&quot;project&quot;) is accessible as a crate to your benchmark test(s). Add <code>use project::one::whatever_it_is</code> and go from there."}], "owner": {"reputation": 1007, "user_id": 1492438, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/7325419e84423ed747537a35903ab237?s=128&d=identicon&r=PG", "display_name": "Astinog", "link": "https://stackoverflow.com/users/1492438/astinog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 358, "favorite_count": 0, "closed_date": 1554228886, "answer_count": 0, "score": 2, "last_activity_date": 1611245395, "creation_date": 1554228486, "last_edit_date": 1611245395, "question_id": 55481089, "link": "https://stackoverflow.com/questions/55481089/import-a-module-from-my-crate-in-a-criterion-benchmark", "closed_reason": "Duplicate", "title": "Import a module from my crate in a Criterion benchmark", "body": "<p>I would like to benchmark functions created in my module, but I don't understand how I can import the module to then use the functions. My folders structure is the following</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>project\n|-benches\n  |-benchmarks.rs\n|-src\n  |-one\n    |-mod.rs\n  |-main.rs\n</code></pre>\n\n<p>And I would like to access the <code>one</code> module in the file <code>benchmarks.rs</code>. Can I do that? How? Thanks!</p>\n"}, {"tags": ["rust", "constants"], "answers": [{"comments": [{"owner": {"reputation": 2382, "user_id": 6272277, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/522db908ba9addc9a647f5c8a8f8421a?s=128&d=identicon&r=PG&f=1", "display_name": "Lassi", "link": "https://stackoverflow.com/users/6272277/lassi"}, "edited": false, "score": 0, "creation_date": 1554222345, "post_id": 55479356, "comment_id": 97669016, "body": "Thanks for the thorough edits. Do you know if there&#39;s a proposed solution to let us use higher-order functions inside const functions in the future? I looked at the RFC thread linked from the last question you linked but I didn&#39;t understand it."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 5, "last_activity_date": 1554222637, "last_edit_date": 1554222637, "creation_date": 1554221884, "answer_id": 55479356, "question_id": 55479223, "link": "https://stackoverflow.com/questions/55479223/is-it-possible-to-write-a-const-function-that-folds-over-an-iterator/55479356#55479356", "title": "Is it possible to write a const function that folds over an iterator?", "body": "<p>No, you cannot do this in stable Rust 1.33. You will need to make your function non-const:</p>\n\n<pre><code>fn foo(s: &amp;str) -&gt; u64 {\n    s.chars().fold(0, |accumulator, char| {\n        accumulator ^ (char as u64)\n    })\n}\n</code></pre>\n\n<p>Note I removed the explicit <code>return</code> keywords and closure return type to be idiomatic.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/39452284/155423\">const fns are an unstable feature when using AtomicUsize::new</a></li>\n<li><a href=\"https://stackoverflow.com/q/29250386/155423\">Why can&#39;t I use a function returning a compile-time constant as a constant?</a></li>\n<li><a href=\"https://stackoverflow.com/q/44448488/155423\">Is it possible to have a recursive function computed at compile-time in Rust?</a></li>\n</ul>\n\n<hr>\n\n<p>If you attempt this in nightly Rust:</p>\n\n<pre><code>#![feature(const_fn)]\n\nconst fn foo(s: &amp;str) -&gt; u64 {\n    s.chars().fold(0, |accumulator, char| {\n        accumulator ^ (char as u64)\n    })\n}\n</code></pre>\n\n<p>You'll get a different error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0015]: calls in constant functions are limited to constant functions, tuple structs and tuple variants\n --&gt; src/lib.rs:4:5\n  |\n4 |     s.chars().fold(0, |accumulator, char| {\n  |     ^^^^^^^^^\n\nerror[E0015]: calls in constant functions are limited to constant functions, tuple structs and tuple variants\n --&gt; src/lib.rs:4:5\n  |\n4 | /     s.chars().fold(0, |accumulator, char| {\n5 | |         accumulator ^ (char as u64)\n6 | |     })\n  | |______^\n</code></pre>\n\n<p>Calling <code>Iterator::fold</code> requires several extensions to <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/0911-const-fn.md\" rel=\"nofollow noreferrer\">the original <code>const fn</code> RFC 911</a> to be implemented. For example, it's expressly forbidden by the original RFC:</p>\n\n<blockquote>\n  <p>Traits, trait implementations and their methods cannot be <code>const</code></p>\n</blockquote>\n\n<p>Since closures are implemented as generics backed by traits, I don't immediately see that they could be easily implemented for the same reason.</p>\n"}], "owner": {"reputation": 2382, "user_id": 6272277, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/522db908ba9addc9a647f5c8a8f8421a?s=128&d=identicon&r=PG&f=1", "display_name": "Lassi", "link": "https://stackoverflow.com/users/6272277/lassi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1519, "favorite_count": 0, "accepted_answer_id": 55479356, "answer_count": 1, "score": 2, "last_activity_date": 1554222637, "creation_date": 1554221450, "last_edit_date": 1554221856, "question_id": 55479223, "link": "https://stackoverflow.com/questions/55479223/is-it-possible-to-write-a-const-function-that-folds-over-an-iterator", "title": "Is it possible to write a const function that folds over an iterator?", "body": "<p>Is it possible to write a const function that folds over an iterator? When I try:</p>\n\n<pre><code>const fn foo(s: &amp;str) -&gt; u64 {\n    return s.chars().fold(0, |accumulator, char| -&gt; u64 {\n        return accumulator ^ (char as u64);\n    });\n}\n</code></pre>\n\n<p>I get a compiler error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: function pointers in const fn are unstable\n --&gt; src/lib.rs:2:30\n  |\n2 |       return s.chars().fold(0, |accumulator, char| -&gt; u64 {\n  |  ______________________________^\n3 | |         return accumulator ^ (char as u64);\n4 | |     });\n  | |_____^\n</code></pre>\n\n<p>I presume that my anonymous function <code>|x, y| -&gt; x { ... }</code> is passed as a function pointer to <code>fold()</code> and that's what's causing the error.</p>\n\n<p>Is there some kind of const lambda that I can pass to <code>fold</code> here, or can I just use a for loop instead and accumulate the result in a mutable variable which I then return from the <code>foo</code> function? I have absolutely no Rust experience...</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1554219052, "post_id": 55478321, "comment_id": 97667157, "body": "<code>statrs v0.10.0</code> requires <code>rand v0.5.6</code> but you are using <code>rand v0.6.5</code>. Unify the versions."}, {"owner": {"reputation": 1962, "user_id": 982364, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8f7fcd81979b29f5fd4ddf155987e588?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/982364/tom"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1554220250, "post_id": 55478321, "comment_id": 97667852, "body": "@Shepmaster - turns out to solve the problem. Thanks. Didn&#39;t think about that."}], "owner": {"reputation": 1962, "user_id": 982364, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8f7fcd81979b29f5fd4ddf155987e588?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/982364/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "closed_date": 1554218955, "answer_count": 0, "score": 0, "last_activity_date": 1554219161, "creation_date": 1554218572, "last_edit_date": 1554219161, "question_id": 55478321, "link": "https://stackoverflow.com/questions/55478321/rust-statrs-sample-not-in-scope", "closed_reason": "Duplicate", "title": "rust statrs sample not in scope?", "body": "<p>I can't figure out why I get an error on this code:</p>\n\n<pre><code>extern crate rand;\nextern crate statrs;\n\nuse rand::distributions::Distribution;\nuse statrs::distribution::Beta;\n\nfn main() {\n    let beta = Beta::new(1.0, 2.0).unwrap();\n    beta.sample(&amp;mut rand::thread_rng());\n}\n</code></pre>\n\n<p>The error message I get is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0599]: no method named `sample` found for type `statrs::distribution::Beta` in the current scope\n --&gt; src/main.rs:9:10\n  |\n9 |     beta.sample(&amp;mut rand::thread_rng());\n  |          ^^^^^^\n  |\n  = help: items from traits can only be used if the trait is in scope\nhelp: the following trait is implemented but not in scope, perhaps add a `use` for it:\n  |\n4 | use rand::distributions::Distribution;\n  |\n</code></pre>\n\n<p>I've added the exact use that it suggests, but the error stays. I've now for the better part of an hour tried taking everything I can think of in scope, out of scope, writing the <code>use</code> statements this way and that and I can't figure it out.</p>\n\n<p>I checked both the source and the documentation of statrs and the <code>sample()</code> function implemented in the <code>Distribution</code> trait.</p>\n\n<p>What do I need to change so I can sample random values from the <code>Beta</code> function?</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554217960, "post_id": 55476985, "comment_id": 97666403, "body": "FWIW, you don&#39;t need <code>Path::new</code> here due to generics. You can just say <code>let c_src_path = &quot;parasail_c&quot;;</code> and <code>.current_dir(c_src_path)</code>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554219895, "post_id": 55476985, "comment_id": 97667635, "body": "FWIW, since you are ignoring the data from <code>output</code>, it&#39;s probably lighter to use <a href=\"https://doc.rust-lang.org/std/process/struct.Command.html#method.status\" rel=\"nofollow noreferrer\"><code>status</code></a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554231328, "post_id": 55476985, "comment_id": 97673344, "body": "Please include the Cargo.toml for the parasail-sys crate."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1554231554, "post_id": 55476985, "comment_id": 97673460, "body": "It sounds like your build script / CMake / the Makefile is modifying the C files as it compiles them. That would cause a rebuild each time. Perhaps touch all the files in the crate with a known timestamp, run the build, then use a tool like <code>find</code> to show files that are not the same as that known timestamp."}], "answers": [{"tags": [], "owner": {"reputation": 833, "user_id": 3297655, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/df1bc6c2cef925a8f52d36b3290958b9?s=128&d=identicon&r=PG&f=1", "display_name": "chabapok", "link": "https://stackoverflow.com/users/3297655/chabapok"}, "is_accepted": false, "score": 0, "last_activity_date": 1554230367, "creation_date": 1554230367, "answer_id": 55481534, "question_id": 55476985, "link": "https://stackoverflow.com/questions/55476985/is-it-possible-to-avoid-recompiling-a-crate-when-i-havent-made-any-changes-to-i/55481534#55481534", "title": "Is it possible to avoid recompiling a crate when I haven&#39;t made any changes to it?", "body": "<p>Add to the build script <code>println!(\"cargo:rerun-if-changed={}\", &amp;file);</code> lines for each file and for each directory.</p>\n"}], "owner": {"reputation": 83, "user_id": 4504619, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001694402918/picture?type=large", "display_name": "Nathan Fortier", "link": "https://stackoverflow.com/users/4504619/nathan-fortier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 657, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1554231127, "creation_date": 1554214437, "last_edit_date": 1554231127, "question_id": 55476985, "link": "https://stackoverflow.com/questions/55476985/is-it-possible-to-avoid-recompiling-a-crate-when-i-havent-made-any-changes-to-i", "title": "Is it possible to avoid recompiling a crate when I haven&#39;t made any changes to it?", "body": "<p>I have a Rust crate which is a wrapper for a large C API and takes several minutes to compile. Running <code>cargo build</code> in the directory without making any changes always results in a recompile. It seems that Cargo should not be recompiling this crate unless I make a change, which I have not done.</p>\n\n<p>I would like to compile the crate once and avoid re-compiling the crate unless I make a change. Is there any way for me to avoid constantly recompiling this scrate?</p>\n\n<p>It seems that something is likely incorrect in my crate's build script. I will try to create a minimal reproducible example, but in the meantime I have provided the build script below:</p>\n\n<pre><code>use std::env;\nuse std::fs::copy;\nuse std::path::Path;\nuse std::process::Command;\n\nfn main() {\n    let out_dir = env::var(\"OUT_DIR\").unwrap();\n    let c_src_path = Path::new(\"parasail_c\");\n\n    // configure the build\n    Command::new(\"cmake\")\n        .arg(\".\")\n        .current_dir(&amp;c_src_path)\n        .output()\n        .expect(\"Failed to configure parasail.\");\n\n    // build the library\n    Command::new(\"make\")\n        .current_dir(&amp;c_src_path)\n        .output()\n        .expect(\"Failed to build parasail.\");\n\n    // put the static library in the right directory so we can clean up\n    let target_file = format!(\"{}/libparasail.so\", out_dir);\n    copy(\"parasail_c/libparasail.so\", target_file)\n        .expect(\"Problem copying library to target directoy.\");\n\n    let target_file = format!(\"{}/parasail.h\", out_dir);\n    copy(\"parasail_c/parasail.h\", target_file)\n        .expect(\"Problem copying header to target directoy.\");\n\n    // clean up the temporary build files\n    Command::new(\"make\")\n        .current_dir(&amp;c_src_path)\n        .arg(\"clean\")\n        .output()\n        .expect(\"Failed to clean up build files.\");\n\n    // clean up the configuration files\n    Command::new(\"make\")\n        .arg(\"distclean\")\n        .current_dir(&amp;c_src_path)\n        .output()\n        .expect(\"Failed to clean up configuration files.\");\n\n    // let cargo know that it can find the file in the out directory\n    println!(\"cargo:rustc-link-search=native={}\", out_dir);\n    println!(\"cargo:rustc-link-lib=dylib=parasail\");\n}\n</code></pre>\n\n<p>Here is the output from <code>cargo build --verbose</code></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cargo build --verbose\n   Compiling parasail-sys v0.1.0 (/home/fortier/testcode/rust/pairhmm/parasail-sys)\n       Fresh libc v0.2.51\n     Running `/home/fortier/testcode/rust/pairhmm/parasail-sys/target/debug/build/parasail-sys-f2d2d1f27a70b4d4/build-script-build`\n     Running `rustc --edition=2018 --crate-name parasail_sys src/lib.rs --color always --crate-type lib --emit=dep-info,link -C debuginfo=2 -C metadata=8879665b3d9bf7e1 -C extra-filename=-8879665b3d9bf7e1 --out-dir /home/fortier/testcode/rust/pairhmm/parasail-sys/target/debug/deps -C incremental=/home/fortier/testcode/rust/pairhmm/parasail-sys/target/debug/incremental -L dependency=/home/fortier/testcode/rust/pairhmm/parasail-sys/target/debug/deps --extern libc=/home/fortier/testcode/rust/pairhmm/parasail-sys/target/debug/deps/liblibc-bc949bf21f4fe772.rlib -L native=/home/fortier/testcode/rust/pairhmm/parasail-sys/target/debug/build/parasail-sys-2ac393455c1f3545/out -l dylib=parasail`\n    Finished dev [unoptimized + debuginfo] target(s) in 1m 58s\n\n</code></pre>\n\n<p>After further inspection I have discovered that the issue is somewhere in the C code that the sub-crate is wrapping. I replaced the current C code with an older version, while changing none of the Rust code and the issue has disappeared. I'll continue doing some further investigation to see exactly what was causing the problem and I'll update this post once I narrow it down.</p>\n"}, {"tags": ["rust", "binary-heap"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 4, "creation_date": 1554214383, "post_id": 55476777, "comment_id": 97664101, "body": "The duplicates you&#39;ve identified <i>are</i> how you solve it: <code>BinaryHeap&lt;std::cmp::Reverse&lt;i32&gt;&gt;</code>. In fact, <a href=\"https://stackoverflow.com/a/54489427/155423\">one of the answers</a> already shows how to create a heap with <code>i32</code> values."}, {"owner": {"reputation": 31, "user_id": 11299435, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35e3e6e42f092b27bb8a073dc9b2abb1?s=128&d=identicon&r=PG&f=1", "display_name": "lj94093", "link": "https://stackoverflow.com/users/11299435/lj94093"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554271302, "post_id": 55476777, "comment_id": 97684255, "body": "Thanks for your great answer,I was know little about how to use the <code>Reverse</code> before that.The offical example in API is a bit simple."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1554214240, "post_id": 55476838, "comment_id": 97664019, "body": "Negating is not a good solution as the largest negative and positive <code>i32</code> values have different magnitudes and you cannot flip them. <code>assert_eq!(std::i32::MIN, -std::i32::MAX)</code> fails and <code>assert_eq!(-std::i32::MIN, std::i32::MAX)</code> panics."}, {"owner": {"reputation": 44000, "user_id": 535275, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Ft2Mw.jpg?s=128&g=1", "display_name": "Scott Hunter", "link": "https://stackoverflow.com/users/535275/scott-hunter"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554214928, "post_id": 55476838, "comment_id": 97664464, "body": "@Shep: Not correct; you <i>can</i> represent the negative of the maximum positive value, it just isn&#39;t the most negative value (which isn&#39;t important).  It <i>is</i> true that you cannot represent the negative of the most negative value."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554215165, "post_id": 55476838, "comment_id": 97664616, "body": "I didn&#39;t state that you can&#39;t represent the negative of the maximum positive value though, just that you can&#39;t flip the two extremes due to the different magnitudes. I then provided code that shows that the magnitudes are different."}, {"owner": {"reputation": 44000, "user_id": 535275, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Ft2Mw.jpg?s=128&g=1", "display_name": "Scott Hunter", "link": "https://stackoverflow.com/users/535275/scott-hunter"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1554215929, "post_id": 55476838, "comment_id": 97665161, "body": "&quot;You cannot flip them&quot;: I guess I interpreted this as &quot;you cannot represent the negation each&quot;, which is not true, and my only concern is with representation.  I make the distinction because the <i>only</i> input value that breaks this approach is the most negative."}], "tags": [], "owner": {"reputation": 44000, "user_id": 535275, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/Ft2Mw.jpg?s=128&g=1", "display_name": "Scott Hunter", "link": "https://stackoverflow.com/users/535275/scott-hunter"}, "is_accepted": false, "score": 0, "last_activity_date": 1554214786, "last_edit_date": 1554214786, "creation_date": 1554214010, "answer_id": 55476838, "question_id": 55476777, "link": "https://stackoverflow.com/questions/55476777/how-to-create-a-minimum-binaryheap/55476838#55476838", "title": "How to create a minimum BinaryHeap?", "body": "<p>Assuming you actually want a min-heap, you could just negate each value you put it in the heap &amp; negate each you take out.</p>\n\n<p>Note: As @Shepmaster alludes to, there is a single i32 negative value which does not have a corresponding positive one (to balance 0, which is its own negative).  If you need to handle this value, this technique will not work, at least not without a bit of finessing.</p>\n"}], "owner": {"reputation": 31, "user_id": 11299435, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35e3e6e42f092b27bb8a073dc9b2abb1?s=128&d=identicon&r=PG&f=1", "display_name": "lj94093", "link": "https://stackoverflow.com/users/11299435/lj94093"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 472, "favorite_count": 0, "closed_date": 1554214106, "answer_count": 1, "score": 0, "last_activity_date": 1554214786, "creation_date": 1554213840, "last_edit_date": 1554214743, "question_id": 55476777, "link": "https://stackoverflow.com/questions/55476777/how-to-create-a-minimum-binaryheap", "closed_reason": "Duplicate", "title": "How to create a minimum BinaryHeap?", "body": "<p>I'm trying to solve <a href=\"https://leetcode.com/problems/kth-largest-element-in-a-stream/\" rel=\"nofollow noreferrer\">leetcode problem 703, largest_element_in_a_stream</a> in Rust.</p>\n\n<p>I want to use the <code>BinaryHeap</code> to solve this problem, but the <code>BinaryHeap</code> in Rust is the maximum heap by default. I don't know how to transform it to a maximum heap.</p>\n\n<p>I found answers in similar questions:</p>\n\n<ul>\n<li><p><a href=\"https://stackoverflow.com/questions/54489368/how-do-i-create-a-binaryheap-that-pops-the-smallest-value-not-the-largest\">How do I create a BinaryHeap that pops the smallest value, not the largest?</a></p></li>\n<li><p><a href=\"https://stackoverflow.com/questions/39949939/how-can-i-implement-a-min-heap-of-f64-with-rusts-binaryheap?noredirect=1&amp;lq=1\">How can I implement a min-heap of f64 with Rust&#39;s BinaryHeap?</a></p></li>\n</ul>\n\n<p>But the answer in the two questions uses some special struct and overloads the <code>Ord</code> trait, I want to solve it for primitives such as <code>i32</code>.</p>\n\n<p>How can I solve it?</p>\n"}, {"tags": ["rust", "lifetime"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 5, "creation_date": 1554202546, "post_id": 55472742, "comment_id": 97656527, "body": "I believe the doc answer that: &quot;Indices and ranges branded with &#39;id can not leave the closure. The container can only be accessed and mutated through the Container wrapper passed as the first argument to the indexing scope.&quot; <a href=\"https://docs.rs/indexing/0.3.2/indexing/container/fn.scope.html\" rel=\"nofollow noreferrer\">docs.rs/indexing/0.3.2/indexing/container/fn.scope.html</a>"}, {"owner": {"reputation": 17135, "user_id": 581190, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a503f14866aaa083332c81264860ac8e?s=128&d=identicon&r=PG", "display_name": "zrzka", "link": "https://stackoverflow.com/users/581190/zrzka"}, "edited": false, "score": 2, "creation_date": 1554203827, "post_id": 55472742, "comment_id": 97657323, "body": "It&#39;s also included on the <a href=\"https://docs.rs/indexing/0.3.2/indexing/#basic-parts\" rel=\"nofollow noreferrer\">main documentation page</a>: <i>The container and its indices and ranges are \u201cbranded\u201d with a lifetime parameter <code>&#39;id</code> which is an identity marker. Branded items can&#39;t leave their scope, and they tie the items uniquely to a particular container. This makes it possible to trust them.</i> <a href=\"https://docs.rs/indexing/0.3.2/indexing/container/struct.Container.html#method.only_index\" rel=\"nofollow noreferrer\">only_index</a> returns <code>&#39;id</code> branded <code>Container</code> -&gt; can&#39;t leave the scope."}, {"owner": {"reputation": 11705, "user_id": 2765603, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/WkhcQ.jpg?s=128&g=1", "display_name": "llogiq", "link": "https://stackoverflow.com/users/2765603/llogiq"}, "edited": false, "score": 0, "creation_date": 1554225924, "post_id": 55472742, "comment_id": 97670780, "body": "I&#39;ve edited my example to pull the assert into the scope. Can you tell me how this gets the indices outside the scope?"}, {"owner": {"reputation": 17135, "user_id": 581190, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a503f14866aaa083332c81264860ac8e?s=128&d=identicon&r=PG", "display_name": "zrzka", "link": "https://stackoverflow.com/users/581190/zrzka"}, "edited": false, "score": 2, "creation_date": 1554276662, "post_id": 55472742, "comment_id": 97686574, "body": "<code>Index</code> can&#39;t go out of scope. But your code actually tries to store the <code>Index</code> inside <code>Tree</code> and then <code>Tree</code> inside <code>v</code>. And <code>v</code> is out of scope. If you want numeric indexes, you can modify <code>Tree</code> to <code>struct Tree(Option&lt;(usize, usize)&gt;);</code> and then store numeric index instead of <code>Index</code> via <code>c.push(Tree(Some((left.integer(), right.integer()))));</code>. Check what the <a href=\"https://github.com/bluss/indexing/blob/0.3.2/src/container.rs#L614-L636\" rel=\"nofollow noreferrer\">scope</a> function actually does and read comments."}], "answers": [{"tags": [], "owner": {"reputation": 11705, "user_id": 2765603, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/WkhcQ.jpg?s=128&g=1", "display_name": "llogiq", "link": "https://stackoverflow.com/users/2765603/llogiq"}, "is_accepted": false, "score": 0, "last_activity_date": 1555308748, "creation_date": 1555308748, "answer_id": 55683415, "question_id": 55472742, "link": "https://stackoverflow.com/questions/55472742/is-there-a-way-to-use-recursion-with-the-indexing-crates-branded-indices-to-cre/55683415#55683415", "title": "Is there a way to use recursion with the indexing crate&#39;s branded indices to create a tree?", "body": "<p>As the comments pointed out, this is indeed not possible with the indexing crate. However, this doesn't mean that it's generally impossible to store branded indices. In fact, getting rid of the closure will work all right, as in the following code:</p>\n\n<pre><code>use std::marker::PhantomData;\nuse std::ops::Index;\n\n#[derive(Copy, Clone)]\nstruct InvariantLifetime&lt;'a&gt;(PhantomData&lt;fn(&amp;'a ()) -&gt; &amp;'a ()&gt;);\npub struct Arena&lt;'b, T&gt;(Vec&lt;T&gt;, InvariantLifetime&lt;'b&gt;);\npub struct Idx&lt;'b&gt;(usize, InvariantLifetime&lt;'b&gt;);\n\nimpl&lt;'b, T&gt; Arena&lt;'b, T&gt; {\n    pub unsafe fn new(_: &amp;'b mut ()) -&gt; Self {\n        Arena(vec![], InvariantLifetime(PhantomData))\n    }\n\n    pub fn add(&amp;mut self, t: T) -&gt; Idx&lt;'b&gt; {\n        let i = self.0.len();\n        self.0.push(t);\n        Idx(i, self.1)\n    }\n}\n\nimpl&lt;'b, T&gt; Index&lt;Idx&lt;'b&gt;&gt; for Arena&lt;'b, T&gt; {\n    type Output = T;\n\n    fn index(&amp;self, i: Idx&lt;'b&gt;) -&gt; &amp;T {\n        unsafe { &amp;self.0.get_unchecked(i.0) }\n    }\n}\n\nmacro_rules! mk_arena {\n    ($arena:ident) =&gt; {\n        let mut tag = ();\n        let mut $arena = unsafe { Arena::new(&amp;mut tag) };\n    };\n}\n\nstruct Tree&lt;'b&gt;(Option&lt;(Idx&lt;'b&gt;, Idx&lt;'b&gt;)&gt;);\nfn tree&lt;'b&gt;(a: &amp;mut Arena&lt;'b, Tree&lt;'b&gt;&gt;, d: usize) -&gt; Idx&lt;'b&gt; {\n    if d &gt; 0 {\n        a.add(Tree(Some((tree(a, d - 1), tree(a, d - 1)))))\n    } else {\n        a.add(Tree(None))\n    }\n}\n\npub fn main() {\n    mk_arena!(arena);\n    let _ = tree(&amp;mut arena, 3);\n}\n</code></pre>\n\n<p>The <a href=\"https://github.com/llogiq/compact_arena\" rel=\"nofollow noreferrer\">compact_arena</a> crate has the same solution, with better docs.</p>\n"}], "owner": {"reputation": 11705, "user_id": 2765603, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/WkhcQ.jpg?s=128&g=1", "display_name": "llogiq", "link": "https://stackoverflow.com/users/2765603/llogiq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1555308748, "creation_date": 1554201533, "last_edit_date": 1554992241, "question_id": 55472742, "link": "https://stackoverflow.com/questions/55472742/is-there-a-way-to-use-recursion-with-the-indexing-crates-branded-indices-to-cre", "title": "Is there a way to use recursion with the indexing crate&#39;s branded indices to create a tree?", "body": "<p>I'm trying to build a tree using the <a href=\"https://crates.io/crates/indexing\" rel=\"nofollow noreferrer\">indexing crate</a>:</p>\n\n<pre><code>use indexing::{Container, Index, scope, container::OnlyIndex};\n\nstruct Tree&lt;'id&gt;(Option&lt;(Index&lt;'id&gt;, Index&lt;'id&gt;)&gt;);\n\nfn tree&lt;'a&gt;(c: &amp;mut Container&lt;'a, &amp;mut Vec&lt;Tree&lt;'a&gt;&gt;, OnlyIndex&gt;, depth: usize) -&gt; Index&lt;'a&gt; {\n    if depth == 0 {\n        c.push(Tree(None))\n    } else {\n        let left = tree(c, depth - 1);\n        let right = tree(c, depth - 1);\n        c.push(Tree(Some((left, right))))\n    }\n}\n\nfn main() {\n    let mut v = vec![];\n    scope(&amp;mut v, |v| {\n        let mut v = v.only_index();\n        tree(&amp;mut v, 3);\n        assert_eq!(v.len(), 1 + 2 + 4 + 8);\n    });\n}\n</code></pre>\n\n<p>This results in a lifetime error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: borrowed data cannot be stored outside of its closure\n  --&gt; src/main.rs:18:23\n   |\n16 |     let mut v = vec![];\n   |         ----- borrowed data cannot be stored into here...\n17 |     scope(&amp;mut v, |v| {\n   |                   --- ...because it cannot outlive this closure\n18 |         let mut v = v.only_index();\n   |                       ^^^^^^^^^^ cannot be stored outside of its closure\n</code></pre>\n\n<p>Is there a way to correctly define <code>tree</code> to work within the indexed scope?</p>\n"}, {"tags": ["rust", "borrow-checker", "borrowing"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554189309, "post_id": 55468845, "comment_id": 97649010, "body": "I advice you to read the <a href=\"https://doc.rust-lang.org/stable/book/\" rel=\"nofollow noreferrer\">book</a>"}, {"owner": {"reputation": 898, "user_id": 771405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdf0bf75e96fa18e57769865ebeb9a6e?s=128&d=identicon&r=PG", "display_name": "cjohansson", "link": "https://stackoverflow.com/users/771405/cjohansson"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554189891, "post_id": 55468845, "comment_id": 97649289, "body": "Thanks I have read the book 3 times, I can&#39;t understand how you can think this is duplicate question. The other question accesses same variable in two dimensional loop, my question doesn&#39;t"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1554191470, "post_id": 55468845, "comment_id": 97650084, "body": "&quot;The other question accesses same variable in two dimensional loop, my question doesn&#39;t&quot; that doesn&#39;t change anything. The point of the duplication is that if you iter so you borrow the value you can&#39;t use function that consume the value."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554205773, "post_id": 55468845, "comment_id": 97658580, "body": "Note that you can drastically <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=cd22d9c91a0a5a46c33c089800822b3e\" rel=\"nofollow noreferrer\">simplify your example by manually unrolling the loop</a>. Once you&#39;ve made it as simple as possible, it&#39;s more apparent why it&#39;s a duplicate. You&#39;ll also want to use <a href=\"https://doc.rust-lang.org/std/macro.vec.html\" rel=\"nofollow noreferrer\"><code>vec!</code></a> in your real code."}], "answers": [{"comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1554190099, "post_id": 55468919, "comment_id": 97649404, "body": "@cjohansson Because you tried to edit my code you also should read <a href=\"https://stackoverflow.com/questions/40006219/why-is-it-discouraged-to-accept-a-reference-to-a-string-string-vec-vec-o\" title=\"why is it discouraged to accept a reference to a string string vec vec o\">stackoverflow.com/questions/40006219/&hellip;</a>"}, {"owner": {"reputation": 898, "user_id": 771405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdf0bf75e96fa18e57769865ebeb9a6e?s=128&d=identicon&r=PG", "display_name": "cjohansson", "link": "https://stackoverflow.com/users/771405/cjohansson"}, "edited": false, "score": 0, "creation_date": 1554194254, "post_id": 55468919, "comment_id": 97651496, "body": "Thanks ok, my edit worked but it wasn&#39;t best practice, didn&#39;t know about that"}], "tags": [], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "is_accepted": true, "score": 2, "last_activity_date": 1554205799, "last_edit_date": 1554205799, "creation_date": 1554189233, "answer_id": 55468919, "question_id": 55468845, "link": "https://stackoverflow.com/questions/55468845/multiple-iterations-of-vector-with-structs-cannot-move-out-of-borrowed-content/55468919#55468919", "title": "Multiple iterations of vector with structs &quot;cannot move out of borrowed content&quot;", "body": "<p>The problem is, that your <code>get_title</code> method consumes the <code>Element</code> and therefore can only be called once.\nYou have to accept <code>&amp;self</code> as parameter instead and can do the following:</p>\n\n<p>Either return a <code>&amp;str</code> instead of <code>String</code>:</p>\n\n<pre><code>pub fn get_title(&amp;self) -&gt; &amp;str {\n    &amp;self.title\n}\n</code></pre>\n\n<p>or clone the <code>String</code> if you really want to return a <code>String</code> struct.</p>\n\n<pre><code>pub fn get_title(&amp;self) -&gt; String {\n    self.title.clone()\n}\n</code></pre>\n\n<p>Also have a look at these questions for further clarification:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/24158114/what-are-the-differences-between-rusts-string-and-str\">What are the differences between Rust&#39;s `String` and `str`?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/25462935/what-types-are-valid-for-the-self-parameter-of-a-method\">What types are valid for the `self` parameter of a method?</a></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1554205733, "post_id": 55471310, "comment_id": 97658557, "body": "Now you made your struct hold references. Why? You overshot the target."}, {"owner": {"reputation": 898, "user_id": 771405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdf0bf75e96fa18e57769865ebeb9a6e?s=128&d=identicon&r=PG", "display_name": "cjohansson", "link": "https://stackoverflow.com/users/771405/cjohansson"}, "reply_to_user": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1554206082, "post_id": 55471310, "comment_id": 97658760, "body": "This is just a hypothetical example, I have a more advanced example I&#39;m working on were it makes sense"}], "tags": [], "owner": {"reputation": 898, "user_id": 771405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdf0bf75e96fa18e57769865ebeb9a6e?s=128&d=identicon&r=PG", "display_name": "cjohansson", "link": "https://stackoverflow.com/users/771405/cjohansson"}, "is_accepted": false, "score": 0, "last_activity_date": 1554197369, "creation_date": 1554197369, "answer_id": 55471310, "question_id": 55468845, "link": "https://stackoverflow.com/questions/55468845/multiple-iterations-of-vector-with-structs-cannot-move-out-of-borrowed-content/55471310#55471310", "title": "Multiple iterations of vector with structs &quot;cannot move out of borrowed content&quot;", "body": "<p><strong>Here is a solution to the problem</strong>, it required <em>borrowing self object</em> and <em>lifetime specifications</em>. </p>\n\n<p>Moving from <code>&amp;String</code> to <code>&amp;str</code> is only for following better practices, thanks @hellow <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=4333c268c0d239391cb07e5640710af4\" rel=\"nofollow noreferrer\">Playground 2</a></p>\n\n<pre><code>struct Element&lt;'a&gt; {\n    title: &amp;'a str\n}\n\nimpl &lt;'a&gt;Element&lt;'a&gt; {\n    pub fn get_title(&amp;self) -&gt; &amp;'a str {\n        &amp;self.title\n    }\n}\n\nfn main() {\n    let mut items: Vec&lt;Element&gt; = Vec::new();\n    items.push(Element { title: \"Random\" });\n    items.push(Element { title: \"Gregor\" });\n\n    let mut i = 0;\n    while i &lt; 10 {\n        for item in &amp;items {\n            println!(\"Loop {} item {}\", i, item.get_title());\n        }\n        i = i + 1;\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 898, "user_id": 771405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdf0bf75e96fa18e57769865ebeb9a6e?s=128&d=identicon&r=PG", "display_name": "cjohansson", "link": "https://stackoverflow.com/users/771405/cjohansson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "closed_date": 1554205586, "accepted_answer_id": 55468919, "answer_count": 2, "score": 0, "last_activity_date": 1554205799, "creation_date": 1554188951, "last_edit_date": 1554205515, "question_id": 55468845, "link": "https://stackoverflow.com/questions/55468845/multiple-iterations-of-vector-with-structs-cannot-move-out-of-borrowed-content", "closed_reason": "Duplicate", "title": "Multiple iterations of vector with structs &quot;cannot move out of borrowed content&quot;", "body": "<p>I need to iterate a vector with structs in each iteration in a loop. It works fine as long as the vector doesn't contain structs. I have tried many different solutions but always get some kind of ownership problem.</p>\n\n<p>What am I doing wrong? </p>\n\n<pre><code>struct Element {\n    title: String,\n}\n\nimpl Element {\n    pub fn get_title(self) -&gt; String {\n        self.title\n    }\n}\n\nfn main() {\n    let mut items: Vec&lt;Element&gt; = Vec::new();\n    items.push(Element {\n        title: \"Random\".to_string(),\n    });\n    items.push(Element {\n        title: \"Gregor\".to_string(),\n    });\n\n    let mut i = 0;\n    while i &lt; 10 {\n        for item in &amp;items {\n            println!(\"Loop {} item {}\", i, item.get_title());\n        }\n        i = i + 1;\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=b4ea87a8a44bdc853b06358db1efe16a\" rel=\"nofollow noreferrer\">playground</a></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0507]: cannot move out of borrowed content\n  --&gt; src/main.rs:23:44\n   |\n23 |             println!(\"Loop {} item {}\", i, item.get_title());\n   |                                            ^^^^ cannot move out of borrowed content\n</code></pre>\n"}, {"tags": ["winapi", "rust", "ffi"], "comments": [{"owner": {"reputation": 3836, "user_id": 3003401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f2de9e3bd27825488f4cf0a1dd86ac0?s=128&d=identicon&r=PG&f=1", "display_name": "Cerberus", "link": "https://stackoverflow.com/users/3003401/cerberus"}, "edited": false, "score": 2, "creation_date": 1554182764, "post_id": 55467261, "comment_id": 97646096, "body": "I&#39;d advise to go the third way, as it is the one most correctly representing the semantics (of course, the price will be an explicit cast on every FFI boundary). But I&#39;m afraid that this question is primarily opinion-based."}, {"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "reply_to_user": {"reputation": 3836, "user_id": 3003401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f2de9e3bd27825488f4cf0a1dd86ac0?s=128&d=identicon&r=PG&f=1", "display_name": "Cerberus", "link": "https://stackoverflow.com/users/3003401/cerberus"}, "edited": false, "score": 2, "creation_date": 1554186698, "post_id": 55467261, "comment_id": 97647620, "body": "Like @Cerberus said, this is primarily a matter of opinion. That being said I would go with option 4, which is similar to the C/C++ way of declaring just <code>struct SID;</code> in the public headers and keeping the full declaration in the source or in a private header."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1554207722, "post_id": 55467261, "comment_id": 97659814, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/38315383/155423\">What&#39;s the Rust idiom to define a field pointing to a C opaque pointer?</a>. If you disagree, please <b><a href=\"https://stackoverflow.com/posts/55467261/edit\">edit</a></b> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554231952, "post_id": 55467261, "comment_id": 97673660, "body": "<code>SID</code> is not a dynamic sized type, this doesn&#39;t exist in C anyway... I agree with shep about the duplicate the doc clearly state &quot;Applications should not modify a SID directly. To create and manipulate a security identifier, use the functions listed in the See Also section.&quot; to it should be opaque in Rust too"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1554234087, "post_id": 55467261, "comment_id": 97674563, "body": "FWIW, if it&#39;s possible for there to be zero subauthorities, then Option 1 will allow accessing undefined memory (<i>bad</i>). If it&#39;s possible for there to be less than 256 subauthorities, the Option 2 will allow accessing undefined memory (<i>bad</i>). Having a trailing array would be invalid because nothing would ever set up the length of the array properly as the Rust compiler expects it (<i>bad</i>). All of those will probably trigger undefined behavior. An opaque struct is the correct choice here."}, {"owner": {"reputation": 597, "user_id": 3404377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7df3cf3bc9180341a3e996358cc9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "ddulaney", "link": "https://stackoverflow.com/users/3404377/ddulaney"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554256328, "post_id": 55467261, "comment_id": 97680860, "body": "@Shepmaster You&#39;re right, it is a dupe. I&#39;ll go with the approaches in that other question. Also, 0 subauthorities isn&#39;t technically allowed, but lots of WinAPI calls are happy to handle (and even allocate!) them."}], "owner": {"reputation": 597, "user_id": 3404377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7df3cf3bc9180341a3e996358cc9fe4?s=128&d=identicon&r=PG&f=1", "display_name": "ddulaney", "link": "https://stackoverflow.com/users/3404377/ddulaney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 180, "favorite_count": 0, "closed_date": 1554231970, "answer_count": 0, "score": 3, "last_activity_date": 1554231978, "creation_date": 1554181384, "question_id": 55467261, "link": "https://stackoverflow.com/questions/55467261/how-can-dynamically-sized-types-be-expressed-safely", "closed_reason": "Duplicate", "title": "How can dynamically-sized types be expressed safely?", "body": "<p>I am writing a safe wrapper over an FFI library that uses dynamically-sized types, and I am trying to determine the best way to handle them in Rust.</p>\n\n<p>In particular, I am wrapping the Windows API's <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/winnt/ns-winnt-_sid\" rel=\"nofollow noreferrer\"><code>SID</code></a> structure. It has a BYTE (<code>u8</code>) indicating the current revision, a BYTE (<code>u8</code>) indicating the number of sub-authorities, six BYTEs (<code>[u8; 6]</code>) indicating the identifier authority, and then a series of DWORDs (<code>u32</code>s) that represent the number of sub-authorities. It has as many sub-authorities as indicated by the sub-authority count.</p>\n\n<p>In general, the approach is to only ever handle SIDs through WinAPI calls, so I should only ever have a pointer to it. Additionally, by keeping the internals private, I can ensure that consumers of my crate can only ever access it through a reference, <code>Box</code>, etc. that I control. However, I do need to declare <em>some</em> kind of <code>Sid</code> type, and I am trying to determine the best approach.</p>\n\n<p>Option 1: The <code>winapi</code> crate just assumes that there will only be <a href=\"https://docs.rs/winapi/*/x86_64-pc-windows-msvc/winapi/um/winnt/struct.SID.html\" rel=\"nofollow noreferrer\">a single sub-authority</a>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct SID {\n    Revision: BYTE,\n    SubAuthorityCount: BYTE,\n    IdentifierAuthority: SID_IDENTIFIER_AUTHORITY, // [u8; 6]\n    SubAuthority: [DWORD; 1],\n}\n</code></pre>\n\n<p>This works when you just have references to it, but if you ever create an owned <code>Sid</code> and set the <code>SubAuthorityCount</code> to anything other than 1, WinAPI calls will read invalid <code>SubAuthority</code> entries.</p>\n\n<p>Option 2: Optimistically allocate the maximum number of <code>DWORD</code>s:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct SID {\n    Revision: BYTE,\n    SubAuthorityCount: BYTE,\n    IdentifierAuthority: SID_IDENTIFIER_AUTHORITY, // [u8; 6]\n    SubAuthority: [DWORD; 256],\n}\n</code></pre>\n\n<p>This introduces memory overhead (the common case is to have a couple of sub-authorities). It also means that a WinAPI-allocated SID cannot just be cast to the <code>SID</code> type, because the additional <code>SubAuthorities</code> that Rust expects to be there were not allocated by the SID.</p>\n\n<p>Option 3: Dynamically-sized array:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct SID {\n    Revision: BYTE,\n    SubAuthorityCount: BYTE,\n    IdentifierAuthority: SID_IDENTIFIER_AUTHORITY, // [u8; 6]\n    SubAuthority: [DWORD],\n}\n</code></pre>\n\n<p>Now it is no longer <code>Sized</code>, which accurately reflects the shape of the underlying memory. Additionally, because <code>Sized</code> types cannot be declared directly (I think?), it can only be created using the FFI calls. However, now all pointers to it are automatically fat pointers, which makes it much more difficult to interoperate with the FFI calls, which all expect bare (thin?) pointers.</p>\n\n<p>Option 4: It's never going to be allocated, so just... nothing. It will only ever be handled as a reference, and I will never look at the underlying fields, so there is no reason to expose anything at all:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub struct SID {}\n</code></pre>\n\n<p>This feels super strange. I know that zero-sized types have different behavior in Rust than in C, and I feel uncomfortable using them around FFI calls. However, it does reflect the way the <code>SID</code> type should be <em>used</em>: it should only be by reference (or <code>Box</code> or another pointer), and the fields are irrelevant. But I am definitely not certain about the behavior when, for example, casting ZSTs <code>&amp;</code>s to raw pointers and back.</p>\n\n<p>Or maybe something else? Currently I am using option 1, keeping everything private, and just not accessing any of the fields directly (everything is through WinAPI calls), but I am curious about which approach people recommend and whether my analysis was correct.</p>\n"}, {"tags": ["rust", "hashset"], "comments": [{"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1554162516, "post_id": 55464930, "comment_id": 97641956, "body": "<code>Or is this an anti-pattern and I should be using HashMap instead?</code> I think you hit the nail on the head right there. You want a data structure with an immutable hash part and a mutable non-hash part, which is exactly what <code>HashMap</code> gives you."}, {"owner": {"reputation": 1498, "user_id": 6844327, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9fWJl.jpg?s=128&g=1", "display_name": "HiDefender", "link": "https://stackoverflow.com/users/6844327/hidefender"}, "reply_to_user": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 0, "creation_date": 1554163559, "post_id": 55464930, "comment_id": 97642130, "body": "@SilvioMayolo My structs contain their unique ids. With a HashMap how do you ensure that the key corresponds to id value the struct contains?"}, {"owner": {"reputation": 22377, "user_id": 2288659, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/bBg8v.png?s=128&g=1", "display_name": "Silvio Mayolo", "link": "https://stackoverflow.com/users/2288659/silvio-mayolo"}, "edited": false, "score": 1, "creation_date": 1554165212, "post_id": 55464930, "comment_id": 97642445, "body": "I would recommend encapsulating it in a hashset-like interface. You can use a hashmap internally and encapsulate the guarantees about the ID."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 8, "last_activity_date": 1554187250, "last_edit_date": 1554187250, "creation_date": 1554165453, "answer_id": 55465369, "question_id": 55464930, "link": "https://stackoverflow.com/questions/55464930/how-can-i-modify-properties-in-a-hashset-that-are-not-part-of-the-hash-computati/55465369#55465369", "title": "How can I modify properties in a HashSet that are not part of the hash computation?", "body": "<p>This is not possible with your current data structure.</p>\n\n<p><code>HashSet</code> deliberately does not provide methods to mutate values. As you have alluded to, mutating a value in a <code>HashSet</code> (or the key in a <code>HashMap</code>) will invalidate the hash in the majority of cases. The API encourages proper usage and even makes mention of this:</p>\n\n<blockquote>\n  <p>It is a logic error for an item to be modified in such a way that the item's hash, as determined by the <a href=\"https://doc.rust-lang.org/std/hash/trait.Hash.html\" rel=\"noreferrer\"><code>Hash</code></a> trait, or its equality, as determined by the <a href=\"https://doc.rust-lang.org/std/cmp/trait.Eq.html\" rel=\"noreferrer\"><code>Eq</code></a> trait, changes while it is in the set. This is normally only possible through <a href=\"https://doc.rust-lang.org/std/cell/struct.Cell.html\" rel=\"noreferrer\"><code>Cell</code></a>, <a href=\"https://doc.rust-lang.org/std/cell/struct.RefCell.html\" rel=\"noreferrer\"><code>RefCell</code></a>, global state, I/O, or unsafe code.</p>\n</blockquote>\n\n<p>This alludes to one way that you can solve your problem, by using interior mutability:</p>\n\n<pre><code>use std::cell::Cell;\n\n#[derive(Debug, Eq)]\nstruct Foo {\n    id: Id,\n    other_data: Cell&lt;u32&gt;,\n}\n</code></pre>\n\n<pre><code>fn main() {\n    let mut baz = HashSet::new();\n    baz.insert(Foo {\n        id: 1,\n        other_data: Cell::new(2),\n    });\n\n    if let Some(x) = baz.get(&amp;1) {\n        x.other_data.set(3);\n    }\n}\n</code></pre>\n\n<p>This is a reasonable thing to do, but I wouldn't be thrilled about doing it. Instead, I would allow my type to be decomposed into a key and a value and store it in a <code>HashMap</code>, as mentioned. Something like</p>\n\n<pre><code>\nimpl Foo {\n    // or insert_into_hashmap(self, &amp;mut HashMap&lt;Id, u32&gt;)\n    fn into_key_value(self) -&gt; (Id, u32) {\n        (self.id, self.other_data)\n    }\n\n    // Maybe a\n    //\n    // fn from_key_value(&amp;'a Id, &amp;'a u32) -&gt; Self\n    // or\n    // fn from_hashmap(Id, &amp;HashMap&lt;Id, u32&gt;) -&gt; Self\n}\n\n// Maybe a\n//\n// struct FooRef&lt;'a&gt; { (or FooRefMut?) \n//     id: &amp;'a Id,\n//     other_data: &amp;'a u32,\n// }\n//\n// With a\n// fn from_key_value(&amp;'a Id, &amp;'a u32) -&gt; Self\n// or\n// fn from_hashmap(Id, &amp;HashMap&lt;Id, u32&gt;) -&gt; Self\n\nfn main() {\n    let mut baz = HashMap::new();\n    let f = Foo {\n        id: 1,\n        other_data: 2,\n    };\n    let (k, v) = f.into_key_value();\n    baz.insert(k, v);\n\n    // See also HashMap::get_key_value\n    if let Some(v) = baz.get_mut(&amp;1) {\n        *v = 3;\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554321045, "post_id": 55503063, "comment_id": 97712669, "body": "I believe this code cause undefined behavior and cannot recommend it. Here&#39;s a <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=9ae49d432427a44e6f57cf8151b1ea95\" rel=\"nofollow noreferrer\">small example</a> where Miri detects violations."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554334269, "post_id": 55503063, "comment_id": 97717310, "body": "no you are not allowed to do this, you can&#39;t mutate something that should be const <code>set.get(id)</code>"}, {"owner": {"reputation": 1498, "user_id": 6844327, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9fWJl.jpg?s=128&g=1", "display_name": "HiDefender", "link": "https://stackoverflow.com/users/6844327/hidefender"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554405097, "post_id": 55503063, "comment_id": 97750907, "body": "@Shepmaster Miri complains that <code>error[E0080]: constant evaluation error: borrow being accessed (Alias(None)) does not exist on the borrow stack</code>. However, there is no fear of any other thread mutating the <code>HashSet</code> in the code I gave above because the <code>HashSet</code> is mutably borrowed: <code>set: &amp;mut HashSet&lt;Foo&gt;</code>. I don&#39;t see what the undefined behavior would be."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554405293, "post_id": 55503063, "comment_id": 97751001, "body": "@HiDefender threading has nothing to do with undefined behavior. The Rust compiler is allowed to assume that <i>nothing</i> mutates the referred-to value of an immutable reference, unless there&#39;s an <a href=\"https://doc.rust-lang.org/std/cell/struct.UnsafeCell.html\" rel=\"nofollow noreferrer\"><code>UnsafeCell</code></a>: <i>In general, transmuting an <code>&amp;T</code> type into an <code>&amp;mut T</code> is considered undefined behavior.</i>"}], "tags": [], "owner": {"reputation": 1498, "user_id": 6844327, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9fWJl.jpg?s=128&g=1", "display_name": "HiDefender", "link": "https://stackoverflow.com/users/6844327/hidefender"}, "is_accepted": false, "score": -2, "last_activity_date": 1554320319, "creation_date": 1554320319, "answer_id": 55503063, "question_id": 55464930, "link": "https://stackoverflow.com/questions/55464930/how-can-i-modify-properties-in-a-hashset-that-are-not-part-of-the-hash-computati/55503063#55503063", "title": "How can I modify properties in a HashSet that are not part of the hash computation?", "body": "<p>I believe <code>unsafe</code> code is the best route in this case.</p>\n\n<pre><code>impl Foo {\n    fn set_other_data(set: &amp;mut HashSet&lt;Foo&gt;, id: &amp;Id, data: u32) -&gt; bool{\n        match set.get(id) {\n            Some(x) =&gt; {\n                let p: *const Foo = x;\n                let q: *mut Foo = p as *mut Foo;\n                unsafe {\n                    (*q).other_data = data;\n                }\n                return true;\n            }\n            None =&gt; return false,\n        }\n    }\n}\n\nfn main() {\n    let mut baz = HashSet::new();\n    baz.insert(Foo {\n        id: 1,\n        other_data: 2,\n    });\n\n    Foo::set_other_data(&amp;mut baz, &amp;1, 3);\n    assert_eq!(3, baz.get(&amp;1).unwrap().other_data);\n}\n</code></pre>\n\n<p>As Shepmaster quoted:</p>\n\n<blockquote>\n  <p>It is a logic error for an item to be modified in such a way that the item's hash, as determined by the <a href=\"https://doc.rust-lang.org/std/hash/trait.Hash.html\" rel=\"nofollow noreferrer\"><code>Hash</code></a> trait, or its equality, as determined by the <a href=\"https://doc.rust-lang.org/std/cmp/trait.Eq.html\" rel=\"nofollow noreferrer\"><code>Eq</code></a> trait, changes while it is in the set. This is normally only possible through <a href=\"https://doc.rust-lang.org/std/cell/struct.Cell.html\" rel=\"nofollow noreferrer\"><code>Cell</code></a>, <a href=\"https://doc.rust-lang.org/std/cell/struct.RefCell.html\" rel=\"nofollow noreferrer\"><code>RefCell</code></a>, global state, I/O, or unsafe code.</p>\n</blockquote>\n\n<p>In this case <code>other_data</code> is not used by the <code>Hash</code> or <code>Eq</code> traits. So it can safely be mutated. The largest danger is that at a later point <code>Hash for Foo</code> or <code>Eq for Foo</code> would be modified and include <code>other_data</code>.</p>\n\n<p>There is no danger of data races because the <code>HashSet&lt;Foo&gt;</code> is mutably borrowed.</p>\n\n<p>Other options:</p>\n\n<p>Decomposing: This works when <code>Foo</code> has only 2 elements, but suppose <code>Foo</code> contains many elements. Do you decompose <code>Foo</code> into all of its individual elements (seems messy) or create sub-structs within <code>Foo</code> (code bloat).</p>\n\n<p>Encapsulation: Silvio Mayolo suggested encapsulating <code>Foo</code> in a <code>HashSet</code> like interface that internally uses <code>HashMap</code>. This keeps the API clean and uses only <code>safe</code> code, but seems like more programming then is necessary.</p>\n\n<p>I would appreciate your feedback and if this seems reasonable I can put in a feature request for an <code>unsafe fn get_mut()</code> for <code>HashSet</code>.</p>\n"}], "owner": {"reputation": 1498, "user_id": 6844327, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9fWJl.jpg?s=128&g=1", "display_name": "HiDefender", "link": "https://stackoverflow.com/users/6844327/hidefender"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1554320319, "creation_date": 1554161367, "last_edit_date": 1554164439, "question_id": 55464930, "link": "https://stackoverflow.com/questions/55464930/how-can-i-modify-properties-in-a-hashset-that-are-not-part-of-the-hash-computati", "title": "How can I modify properties in a HashSet that are not part of the hash computation?", "body": "<p>I have a struct that contains a unique id and uses that id for its hash:</p>\n\n<pre><code>use std::borrow::Borrow;\nuse std::collections::HashSet;\nuse std::hash::{Hash, Hasher};\n\ntype Id = u32;\n\n#[derive(Debug, Eq)]\nstruct Foo {\n    id: Id,\n    other_data: u32,\n}\n\nimpl PartialEq for Foo {\n    fn eq(&amp;self, other: &amp;Foo) -&gt; bool {\n        self.id == other.id\n    }\n}\n\nimpl Hash for Foo {\n    fn hash&lt;H: Hasher&gt;(&amp;self, state: &amp;mut H) {\n        self.id.hash(state);\n    }\n}\n\nimpl Borrow&lt;Id&gt; for Foo {\n    fn borrow(&amp;self) -&gt; &amp;Id {\n        &amp;self.id\n    }\n}\n</code></pre>\n\n<p>I understand that I cannot modify the value of <code>Foo::id</code> once I've put it into the <code>HashSet</code> because that would change the hash. However, I would like to modify <code>Foo::other_data</code>. I know I could remove it from the <code>HashSet</code>, modify it, and insert it again, but a method like <code>get_mut()</code> would be so much cleaner. Is there a way to accomplish something like this:</p>\n\n<pre><code>fn main() {\n    let mut baz = HashSet::new();\n    baz.insert(Foo {\n        id: 1,\n        other_data: 2,\n    });\n\n    if let Some(x) = baz.get_mut(&amp;1) {\n        *x = 3;\n    }\n}\n</code></pre>\n\n<p>Is this an anti-pattern; should I be using a <code>HashMap</code> instead?</p>\n\n<p><a href=\"https://stackoverflow.com/questions/45384928/is-there-any-way-to-look-up-in-hashset-by-only-the-value-the-type-is-hashed-on\">Related to this question.</a></p>\n"}, {"tags": ["multithreading", "rust"], "answers": [{"comments": [{"owner": {"reputation": 1054, "user_id": 187769, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9d0faacd977c18b42da378bcfe38927c?s=128&d=identicon&r=PG", "display_name": "RandomInsano", "link": "https://stackoverflow.com/users/187769/randominsano"}, "edited": false, "score": 0, "creation_date": 1554161533, "post_id": 55464441, "comment_id": 97641756, "body": "Ah! Of course. That was dumb of me... Thanks guys. Picked this one as it references docs and explains in-depth for others."}], "tags": [], "owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "is_accepted": true, "score": 4, "last_activity_date": 1554158758, "last_edit_date": 1554158758, "creation_date": 1554157630, "answer_id": 55464441, "question_id": 55464131, "link": "https://stackoverflow.com/questions/55464131/why-does-a-condvar-not-wake-the-last-thread/55464441#55464441", "title": "Why does a Condvar not wake the last thread?", "body": "<p>Your main thread does not wait for the worker threads to finish, and according to <a href=\"https://doc.rust-lang.org/std/thread/fn.spawn.html\" rel=\"nofollow noreferrer\">the documentation of <code>std::thread::spawn</code></a>:</p>\n\n<blockquote>\n  <p>[\u2026] the child thread may outlive the parent (<em>unless the parent thread is the main thread; the whole process is terminated when the main thread finishes</em>).</p>\n</blockquote>\n\n<p>(emphasis is mine)</p>\n\n<p>Because your program terminates immediately after the last <code>notify_one</code>, the worker thread will likely be killed before printing the value.</p>\n\n<p>When you loop 11 times, there is a sleep of 1s after the 10th <code>notify_all</code>, which means the latest worker thread will likely finish its job.</p>\n\n<p>A common solution to the problem is to collect the <code>JoinHandle</code>s returned by <code>spawn</code>, and wait for them, as per <a href=\"https://stackoverflow.com/a/55464571/2733851\">sn99's answer</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "is_accepted": false, "score": 1, "last_activity_date": 1554158518, "creation_date": 1554158518, "answer_id": 55464571, "question_id": 55464131, "link": "https://stackoverflow.com/questions/55464131/why-does-a-condvar-not-wake-the-last-thread/55464571#55464571", "title": "Why does a Condvar not wake the last thread?", "body": "<p>Change the code to :</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::sync::{Arc, Condvar, Mutex};\nuse std::{thread, time};\n\nfn main() {\n    let pair = Arc::new((Mutex::new(false), Condvar::new()));\n    let pause = time::Duration::from_secs(1);\n\n    // Create a vector of `JoinHandle` \n    let mut thread_handles = Vec::new();\n\n    for id in 0..10 {\n        let pair2 = pair.clone();\n        // Push JoinHandle in the vector\n        thread_handles.push(thread::spawn(move || {\n            let &amp;(ref lock, ref cvar) = &amp;*pair2;\n\n            let lock = lock.lock().unwrap();\n            let _ = cvar.wait(lock).unwrap();\n            println!(\"Thread {} done!\", id);\n        }));\n    }\n\n    // Wait for the thread to start up.\n    let &amp;(ref _lock, ref cvar) = &amp;*pair;\n\n    for _ in 0..10 {\n        thread::sleep(pause);\n        cvar.notify_one();\n    }\n\n    // Wait for all threads to complete before exiting `main`\n    // handles is of type JoinHandle\n    for handles in thread_handles {\n        handles.join().unwrap();\n    }\n}\n</code></pre>\n\n<p>The <a href=\"https://doc.rust-lang.org/std/thread/struct.JoinHandle.html#method.join\" rel=\"nofollow noreferrer\"><code>join</code></a> method waits for all threads to finish. This is necessary because a Rust program exits as soon as main returns, even if other threads are still running.</p>\n"}], "owner": {"reputation": 1054, "user_id": 187769, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9d0faacd977c18b42da378bcfe38927c?s=128&d=identicon&r=PG", "display_name": "RandomInsano", "link": "https://stackoverflow.com/users/187769/randominsano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 55464441, "answer_count": 2, "score": 0, "last_activity_date": 1554164084, "creation_date": 1554155683, "last_edit_date": 1554164084, "question_id": 55464131, "link": "https://stackoverflow.com/questions/55464131/why-does-a-condvar-not-wake-the-last-thread", "title": "Why does a Condvar not wake the last thread?", "body": "<p>I'm having unexpected results when playing around with <code>Condvar</code>. I know that I can't trust that my <code>wait()</code> won't wake up early, but in my case it seems that consistently one of my wake-ups is missing. Given this example code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::sync::{Arc, Mutex, Condvar};\nuse std::{\n    thread,\n    time\n};\n\nfn main() {\n    let pair = Arc::new((Mutex::new(false), Condvar::new()));\n    let pause = time::Duration::from_secs(1);\n\n    for id in 0..10 {\n        let pair2 = pair.clone();\n        thread::spawn(move|| {\n            let &amp;(ref lock, ref cvar) = &amp;*pair2;\n\n            let lock = lock.lock().unwrap();\n            let _ = cvar.wait(lock).unwrap();\n            println!(\"Thread {} done!\", id);\n        });\n    }\n\n    // Wait for the thread to start up.\n    let &amp;(ref _lock, ref cvar) = &amp;*pair;\n\n    for _ in 0..10 {\n        thread::sleep(pause);\n        cvar.notify_one();\n    }\n}\n</code></pre>\n\n<p>I'm only getting the first eight threads out of the loop:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Thread 0 done!\nThread 1 done!\nThread 2 done!\nThread 3 done!\nThread 4 done!\nThread 5 done!\nThread 6 done!\nThread 7 done!\nThread 8 done!\n</code></pre>\n\n<p>If I increase the count on the second loop to 11, it does actually wake up all nine.</p>\n\n<p>I've double checked <a href=\"https://doc.rust-lang.org/std/sync/struct.Condvar.html#method.notify_one\" rel=\"nofollow noreferrer\">the documentation</a> on both <code>wait()</code> and <code>notify_one()</code> but it's not obvious what's wrong here.</p>\n\n<p>Any thoughts? Is this a bug or something I'm just not doing right?</p>\n"}, {"tags": ["rust", "network-programming", "gtk3"], "comments": [{"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 1, "creation_date": 1554187594, "post_id": 55462739, "comment_id": 97648053, "body": "I think that GIO has a way to write plugins that can then be used to access any data in a filesystem-like fashion. Once you have such a plugin for your remote filesystem, the GTK file picker should handle it more or less automatically."}, {"owner": {"reputation": 169, "user_id": 9292547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/401084e31cf9049fae6d4ecf56bd9488?s=128&d=identicon&r=PG&f=1", "display_name": "Display Name", "link": "https://stackoverflow.com/users/9292547/display-name"}, "reply_to_user": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 0, "creation_date": 1554217750, "post_id": 55462739, "comment_id": 97666289, "body": "@Jmb It looks like GIO already supports SFTP backends, which will serve my purpose. Thanks so much, you just saved me days of work."}], "owner": {"reputation": 169, "user_id": 9292547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/401084e31cf9049fae6d4ecf56bd9488?s=128&d=identicon&r=PG&f=1", "display_name": "Display Name", "link": "https://stackoverflow.com/users/9292547/display-name"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 123, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1554149065, "creation_date": 1554149065, "question_id": 55462739, "link": "https://stackoverflow.com/questions/55462739/using-the-gtk-file-chooser-to-browse-a-remote-filesystem", "title": "Using the GTK file chooser to browse a remote filesystem?", "body": "<p>My program can use a network protocol to query remote filesystem information (like directory contents). I would like to use the GTK file chooser widget or something similar to allow my users to pick files on the remote server.</p>\n\n<p>However, the GTK file picker handles the interaction with the filesystem itself. I don't see a way to stick my own code in, so although I could write some functions that \"pretended\" to be a filesystem interface, I don't see a way to get the file chooser to use them. Are there any options for me other than creating my own version of the file picker widget?</p>\n\n<p>Also: I happen to be writing this in Rust. That may or may not be relevant, depending on what your suggestions are. ;)</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554144958, "post_id": 55461679, "comment_id": 97636078, "body": "Can you explain what you find difficult about the error message? What about the help text suggested in the error message?"}, {"owner": {"reputation": 1414, "user_id": 6564029, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WxyK5.jpg?s=128&g=1", "display_name": "Michail", "link": "https://stackoverflow.com/users/6564029/michail"}, "edited": false, "score": 1, "creation_date": 1554145059, "post_id": 55461679, "comment_id": 97636121, "body": "That being said, using <code>From</code> for outputting things is kinda wasteful - <code>from</code> uses the argument by value, so you can&#39;t use it afterwards unless it&#39;s <code>Copy</code>. You want either <code>Debug</code> or <code>Display</code> (the former is derivable, btw)."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 3, "last_activity_date": 1554145965, "last_edit_date": 1554145965, "creation_date": 1554145228, "answer_id": 55461850, "question_id": 55461679, "link": "https://stackoverflow.com/questions/55461679/how-to-cast-generic-t-to-string/55461850#55461850", "title": "How to cast generic T to String?", "body": "<p>As the compiler tells you:</p>\n\n<blockquote>\n  <p>consider adding a <code>where std::string::String: std::convert::From&lt;T&gt;</code> bound</p>\n</blockquote>\n\n<pre><code>fn example&lt;T&gt;(node: Node&lt;T&gt;)\nwhere\n    String: From&lt;T&gt;,\n{\n    // ...\n}\n</code></pre>\n\n<p>This won't work for <code>String: From&lt;Option&lt;Node&lt;T&gt;&gt;&gt;</code> because there's no such implementation.</p>\n\n<hr>\n\n<p>If you want to <em>format</em> your struct, you will want to require an implementation of <code>Display</code> instead. There's no reason to convert a value into a <code>String</code> just for the purposes of displaying it:</p>\n\n<pre><code>fn example&lt;T&gt;(node: Node&lt;T&gt;)\nwhere\n    T: std::fmt::Display\n{\n    // ...\n}\n</code></pre>\n\n<p>Again, this doesn't work in your bigger case because neither <code>Node&lt;T&gt;</code> or <code>Option&lt;T&gt;</code> implement <code>Display</code>.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/27769681/155423\">Should I implement Display or ToString to render a type as a string?</a></li>\n<li><a href=\"https://stackoverflow.com/q/40601780/155423\">The trait bound `T: std::fmt::Display` is not satisfied</a></li>\n</ul>\n\n<p>You might want something like</p>\n\n<pre><code>fn example&lt;T&gt;(mut node: Node&lt;T&gt;)\nwhere\n    T: std::fmt::Display,\n{\n    print!(\"{}\", node.element);\n    while let Some(n) = node.next {\n        print!(\" -&gt; {}\", n.element);\n        node = *n;\n    }\n}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>fn example&lt;T&gt;(mut node: &amp;Node&lt;T&gt;)\nwhere\n    T: std::fmt::Display,\n{\n    print!(\"{}\", node.element);\n    while let Some(n) = &amp;node.next {\n        print!(\" -&gt; {}\", n.element);\n        node = &amp;n;\n    }\n}\n</code></pre>\n\n<p>Or even to implement <code>Display</code> / <code>Debug</code> yourself using the same code.</p>\n\n<p>You should also read <a href=\"https://cglab.ca/~abeinges/blah/too-many-lists/book/README.html\" rel=\"nofollow noreferrer\">Learning Rust With Entirely Too Many Linked Lists</a>. You are attempting to create a doubly-linked list which is not possible in safe Rust.</p>\n"}], "owner": {"reputation": 388, "user_id": 10008842, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4yFbIG-hzn4/AAAAAAAAAAI/AAAAAAAAAB8/P7EMMqLaPys/photo.jpg?sz=128", "display_name": "Vin&#237;cius Gabriel", "link": "https://stackoverflow.com/users/10008842/vin%c3%adcius-gabriel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 669, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1554145965, "creation_date": 1554144380, "last_edit_date": 1554144632, "question_id": 55461679, "link": "https://stackoverflow.com/questions/55461679/how-to-cast-generic-t-to-string", "title": "How to cast generic T to String?", "body": "<p>I'm trying to print a custom type:</p>\n\n<pre><code>struct Node&lt;T&gt; {\n    prev: Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;,\n    element: T,\n    next: Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;,\n}\n</code></pre>\n\n<p>Now, the problem:</p>\n\n<pre><code>print!(\n    \"{0} -&gt; {1}\",\n    String::from(node.element),\n    String::from(node.next)\n);\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `std::string::String: std::convert::From&lt;T&gt;` is not satisfied\n  --&gt; src/lib.rs:10:9\n   |\n10 |         String::from(node.element),\n   |         ^^^^^^^^^^^^ the trait `std::convert::From&lt;T&gt;` is not implemented for `std::string::String`\n   |\n   = help: consider adding a `where std::string::String: std::convert::From&lt;T&gt;` bound\n   = note: required by `std::convert::From::from`\n\nerror[E0277]: the trait bound `std::string::String: std::convert::From&lt;std::option::Option&lt;std::boxed::Box&lt;Node&lt;T&gt;&gt;&gt;&gt;` is not satisfied\n  --&gt; src/lib.rs:11:9\n   |\n11 |         String::from(node.next)\n   |         ^^^^^^^^^^^^ the trait `std::convert::From&lt;std::option::Option&lt;std::boxed::Box&lt;Node&lt;T&gt;&gt;&gt;&gt;` is not implemented for `std::string::String`\n   |\n   = help: the following implementations were found:\n             &lt;std::string::String as std::convert::From&lt;&amp;'a str&gt;&gt;\n             &lt;std::string::String as std::convert::From&lt;std::borrow::Cow&lt;'a, str&gt;&gt;&gt;\n             &lt;std::string::String as std::convert::From&lt;std::boxed::Box&lt;str&gt;&gt;&gt;\n   = note: required by `std::convert::From::from`\n</code></pre>\n\n<p>How to cast <code>node.element</code> to <code>String</code> and <code>Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;</code> to <code>String</code>?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 1093, "user_id": 9315690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/747b19bfb99db8f9f3411c19da6c9c50?s=128&d=identicon&r=PG&f=1", "display_name": "Newbyte", "link": "https://stackoverflow.com/users/9315690/newbyte"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1554183090, "post_id": 55461617, "comment_id": 97646204, "body": "@Stargateur I was printing them to the screen for debugging, and printing out 1s and 0s was more handy in my case than <code>true</code> and <code>false</code>."}, {"owner": {"reputation": 118, "user_id": 5994737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c617bb5231b027913ec36ef79bab8452?s=128&d=identicon&r=PG", "display_name": "S. Whittaker", "link": "https://stackoverflow.com/users/5994737/s-whittaker"}, "edited": false, "score": 1, "creation_date": 1556605334, "post_id": 55461617, "comment_id": 98484338, "body": "Sometimes useful in arithmetic e.g. <code>pub fn calculateprice(num : i32) -&gt; i32 { return ((num &gt; 40) as i32 * num) + num; }</code>"}], "answers": [{"tags": [], "owner": {"reputation": 36141, "user_id": 4354477, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/SuxtS.gif?s=128&g=1", "display_name": "ForceBru", "link": "https://stackoverflow.com/users/4354477/forcebru"}, "is_accepted": true, "score": 28, "last_activity_date": 1554144324, "creation_date": 1554144324, "answer_id": 55461662, "question_id": 55461617, "link": "https://stackoverflow.com/questions/55461617/how-do-i-convert-a-boolean-to-an-integer-in-rust/55461662#55461662", "title": "How do I convert a boolean to an integer in Rust?", "body": "<p>Cast it:</p>\n\n<pre><code>fn main() {\n    println!(\"{}\", true as i32)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1287, "user_id": 106275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/43vfP.png?s=128&g=1", "display_name": "Stein", "link": "https://stackoverflow.com/users/106275/stein"}, "edited": false, "score": 4, "creation_date": 1568830631, "post_id": 55461689, "comment_id": 102403300, "body": "A <a href=\"https://github.com/ssomers/rust_bench_quickies/tree/master/src\" rel=\"nofollow noreferrer\">simple benchmark</a> shows that this is 20% faster than the other answers."}, {"owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "reply_to_user": {"reputation": 1287, "user_id": 106275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/43vfP.png?s=128&g=1", "display_name": "Stein", "link": "https://stackoverflow.com/users/106275/stein"}, "edited": false, "score": 0, "creation_date": 1587393127, "post_id": 55461689, "comment_id": 108486795, "body": "@Stein I think your link is outdated."}, {"owner": {"reputation": 1287, "user_id": 106275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/43vfP.png?s=128&g=1", "display_name": "Stein", "link": "https://stackoverflow.com/users/106275/stein"}, "edited": false, "score": 1, "creation_date": 1587482966, "post_id": 55461689, "comment_id": 108526354, "body": "The link is not quite outdated, but meanwhile I&#39;ve added more benchmarks and left it unclear that this one is about the option_cardinality tests. Also, it doesn&#39;t <a href=\"https://github.com/ssomers/rust_bench_quickies\" rel=\"nofollow noreferrer\">link to the top where I just added a README</a> and doesn&#39;t link to the specific file either. By the way, they still report the same performance with today&#39;s nightly Rust: this answer, or a similar <code>match</code> expression, are faster (when used in a microbenchmark)."}, {"owner": {"reputation": 2652, "user_id": 5445670, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xrwS2.png?s=128&g=1", "display_name": "Solomon Ucko", "link": "https://stackoverflow.com/users/5445670/solomon-ucko"}, "reply_to_user": {"reputation": 1287, "user_id": 106275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/43vfP.png?s=128&g=1", "display_name": "Stein", "link": "https://stackoverflow.com/users/106275/stein"}, "edited": false, "score": 1, "creation_date": 1606710312, "post_id": 55461689, "comment_id": 115034009, "body": "@Stein Current nightly appears to generate identical code for <code>is_some_as</code> and <code>is_some_if</code>: <a href=\"https://rust.godbolt.org/z/edcKef\" rel=\"nofollow noreferrer\">rust.godbolt.org/z/edcKef</a>."}, {"owner": {"reputation": 1287, "user_id": 106275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/43vfP.png?s=128&g=1", "display_name": "Stein", "link": "https://stackoverflow.com/users/106275/stein"}, "reply_to_user": {"reputation": 2652, "user_id": 5445670, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xrwS2.png?s=128&g=1", "display_name": "Solomon Ucko", "link": "https://stackoverflow.com/users/5445670/solomon-ucko"}, "edited": false, "score": 1, "creation_date": 1606741072, "post_id": 55461689, "comment_id": 115044159, "body": "@SolomonUcko Not quite, it seems. The benchmarks still report the same difference today (regardless of names and place in file, which could influence alignment). When I swap the <code>-O</code> in your very useful godbolt link with the <code>-C opt-level=3</code> that <code>cargo bench</code> feeds, it does report a difference in assembly."}, {"owner": {"reputation": 2652, "user_id": 5445670, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xrwS2.png?s=128&g=1", "display_name": "Solomon Ucko", "link": "https://stackoverflow.com/users/5445670/solomon-ucko"}, "edited": false, "score": 0, "creation_date": 1606776790, "post_id": 55461689, "comment_id": 115059937, "body": "Hmm, true, interesting! Here&#39;s a smaller example: <a href=\"https://rust.godbolt.org/z/7MM49d\" rel=\"nofollow noreferrer\">rust.godbolt.org/z/7MM49d</a>. I&#39;m not completely sure what&#39;s up with the control flow for <code>is_some_if</code>."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 15, "last_activity_date": 1554144432, "creation_date": 1554144432, "answer_id": 55461689, "question_id": 55461617, "link": "https://stackoverflow.com/questions/55461617/how-do-i-convert-a-boolean-to-an-integer-in-rust/55461689#55461689", "title": "How do I convert a boolean to an integer in Rust?", "body": "<p>Use an <code>if</code> statement:</p>\n\n<pre><code>if some_boolean { 1 } else { 0 }\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/45092638/155423\">How can I port C++ code that uses the ternary operator to Rust?</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "is_accepted": false, "score": 21, "last_activity_date": 1565458768, "last_edit_date": 1565458768, "creation_date": 1554144484, "answer_id": 55461702, "question_id": 55461617, "link": "https://stackoverflow.com/questions/55461617/how-do-i-convert-a-boolean-to-an-integer-in-rust/55461702#55461702", "title": "How do I convert a boolean to an integer in Rust?", "body": "<p>A boolean value in Rust is <a href=\"https://doc.rust-lang.org/std/primitive.bool.html\" rel=\"noreferrer\">guaranteed to be <code>1</code> or <code>0</code></a>:</p>\n\n<blockquote>\n  <p>The <code>bool</code> represents a value, which could only be either <code>true</code> or <code>false</code>. If you cast a <code>bool</code> into an integer, <code>true</code> will be 1 and <code>false</code> will be 0.</p>\n</blockquote>\n\n<p>A boolean value, which is <strong>neither</strong> <code>0</code> <strong>nor</strong> <code>1</code> is <a href=\"https://doc.rust-lang.org/reference/behavior-considered-undefined.html\" rel=\"noreferrer\">undefined behavior</a>:</p>\n\n<blockquote>\n  <p>A value other than <code>false</code> (<code>0</code>) or <code>true</code> (<code>1</code>) in a bool.</p>\n</blockquote>\n\n<p>Therefore, you can just cast it to a primitive:</p>\n\n<pre><code>assert_eq!(0, false as i32);\nassert_eq!(1, true as i32);\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 8, "last_activity_date": 1554150274, "last_edit_date": 1554150274, "creation_date": 1554150225, "answer_id": 55463027, "question_id": 55461617, "link": "https://stackoverflow.com/questions/55461617/how-do-i-convert-a-boolean-to-an-integer-in-rust/55463027#55463027", "title": "How do I convert a boolean to an integer in Rust?", "body": "<p>You may use <code>.into()</code>:</p>\n\n<pre><code>let a = true;\nlet b: i32 = a.into();\nprintln!(\"{}\", b); // 1\n\nlet z: isize = false.into();\nprintln!(\"{}\", z); // 0\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=3297f5b00842ef949369a613e0775911\" rel=\"noreferrer\">playground</a></p>\n"}], "owner": {"reputation": 1093, "user_id": 9315690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/747b19bfb99db8f9f3411c19da6c9c50?s=128&d=identicon&r=PG&f=1", "display_name": "Newbyte", "link": "https://stackoverflow.com/users/9315690/newbyte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9487, "favorite_count": 0, "accepted_answer_id": 55461662, "answer_count": 4, "score": 17, "last_activity_date": 1565458768, "creation_date": 1554144076, "question_id": 55461617, "link": "https://stackoverflow.com/questions/55461617/how-do-i-convert-a-boolean-to-an-integer-in-rust", "title": "How do I convert a boolean to an integer in Rust?", "body": "<p>How do I convert a boolean to an integer in Rust? As in, <code>true</code> becomes 1, and <code>false</code> becomes 0.</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 10903577, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GkxapzVV8uc/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwca3avG2pLthe-3scXprhYrwwbEJvg/mo/photo.jpg?sz=128", "display_name": "chirsz", "link": "https://stackoverflow.com/users/10903577/chirsz"}, "edited": false, "score": 0, "creation_date": 1554289487, "post_id": 55458853, "comment_id": 97694273, "body": "Thanks. I have tried using associated type and as you say it can&#39;t complie although I annotate the type."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 2, "last_activity_date": 1554142107, "last_edit_date": 1554142107, "creation_date": 1554133097, "answer_id": 55458853, "question_id": 55455965, "link": "https://stackoverflow.com/questions/55455965/how-can-i-write-a-method-to-wrap-any-value-in-my-type-that-can-be-called-multipl/55458853#55458853", "title": "How can I write a method to wrap any value in my type that can be called multiple times without requiring type annotations?", "body": "<p>I do not believe you can accomplish your goal of implementing a single trait using specialization at this point in time.</p>\n\n<p>Your trait definition allows for multiple implementations of the trait for the same type:</p>\n\n<pre><code>trait ToWrapper&lt;W&gt; {\n    fn to_wrap(self) -&gt; W;\n}\n\nimpl ToWrapper&lt;i32&gt; for u8 {\n    fn to_wrap(self) -&gt; i32 {\n        i32::from(self)\n    }\n}\n\nimpl ToWrapper&lt;i16&gt; for u8 {\n    fn to_wrap(self) -&gt; i16 {\n        i16::from(self)\n    }\n}\n</code></pre>\n\n<p>With such a setup, it's impossible to know what the resulting type of <code>to_wrap</code> <em>should</em> be; you will always need to provide the output type somehow. Then you compound the problems by attempting to call <code>to_wrap</code> on an unknown type that will produce another unknown type!</p>\n\n<p>Normally, using associated types would be the solution, but you cannot switch to those here because of how they interact with specialization. </p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/32059370/155423\">When is it appropriate to use an associated type versus a generic type?</a></li>\n<li><a href=\"https://stackoverflow.com/q/51022636/155423\">Mismatch between associated type and type parameter only when impl is marked `default`</a></li>\n<li><a href=\"https://stackoverflow.com/q/52453180/155423\">How do I unwrap an arbitrary number of nested Option types?</a></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1554141579, "post_id": 55460987, "comment_id": 97634654, "body": "Please use some words to explain how your solution works, as well as identifying any weaknesses it might have."}, {"owner": {"reputation": 11, "user_id": 10903577, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GkxapzVV8uc/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwca3avG2pLthe-3scXprhYrwwbEJvg/mo/photo.jpg?sz=128", "display_name": "chirsz", "link": "https://stackoverflow.com/users/10903577/chirsz"}, "edited": false, "score": 0, "creation_date": 1554288740, "post_id": 55460987, "comment_id": 97693810, "body": "Thank. I found there would be unexpected behavior when defining a generic function like <code>fn foo&lt;T&gt;(value:ToWrapper&lt;T&gt;);</code>; When I give a <code>value:Wrapper&lt;T&gt;</code> to it, it  would use <code>&lt;Wrapper&lt;T&gt; as ToWrapper&lt;Wrapper&lt;T&gt;&gt;&gt;::to_wrap</code> rather than <code>Wrapper&lt;T&gt;::to_wrap</code>."}], "tags": [], "owner": {"reputation": 833, "user_id": 3297655, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/df1bc6c2cef925a8f52d36b3290958b9?s=128&d=identicon&r=PG&f=1", "display_name": "chabapok", "link": "https://stackoverflow.com/users/3297655/chabapok"}, "is_accepted": false, "score": 0, "last_activity_date": 1554200495, "last_edit_date": 1554200495, "creation_date": 1554141375, "answer_id": 55460987, "question_id": 55455965, "link": "https://stackoverflow.com/questions/55455965/how-can-i-write-a-method-to-wrap-any-value-in-my-type-that-can-be-called-multipl/55460987#55460987", "title": "How can I write a method to wrap any value in my type that can be called multiple times without requiring type annotations?", "body": "<pre><code>#[derive(Debug)]\nstruct Wrapper&lt;T&gt;(T);\n\ntrait ToWrapper&lt;W&gt; {\n    fn to_wrap(self) -&gt; Wrapper&lt;W&gt;;\n}\n\nimpl&lt;T&gt; ToWrapper&lt;T&gt; for T {\n    fn to_wrap(self) -&gt; Wrapper&lt;T&gt; {\n        Wrapper(self)\n    }\n}\n\nimpl&lt;T&gt; Wrapper&lt;T&gt; {\n    fn to_wrap(self) -&gt; Wrapper&lt;T&gt; {\n        self\n    }\n}\n\nfn main() {\n    let a = 1i32;\n    println!(\"{:?}\", a);\n    let a = 1.to_wrap();\n    println!(\"{:?}\", a);\n    let a: Wrapper&lt;i32&gt; = 1.to_wrap().to_wrap();\n    let b = 1.to_wrap().to_wrap();\n    println!(\"{:?}\", a);\n    println!(\"{:?}\", b);\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3836, "user_id": 3003401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f2de9e3bd27825488f4cf0a1dd86ac0?s=128&d=identicon&r=PG&f=1", "display_name": "Cerberus", "link": "https://stackoverflow.com/users/3003401/cerberus"}, "edited": false, "score": 2, "creation_date": 1554184366, "post_id": 55465531, "comment_id": 97646679, "body": "The disadvantage of this approach is that it&#39;ll treat any structure containing <code>Wrapper</code> (e.g. <code>Rc&lt;Wrapper&lt;T&gt;&gt;</code>) as <code>Wrapper</code>, which might be undesirable."}, {"owner": {"reputation": 11, "user_id": 10903577, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GkxapzVV8uc/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwca3avG2pLthe-3scXprhYrwwbEJvg/mo/photo.jpg?sz=128", "display_name": "chirsz", "link": "https://stackoverflow.com/users/10903577/chirsz"}, "edited": false, "score": 0, "creation_date": 1554289328, "post_id": 55465531, "comment_id": 97694192, "body": "Thanks. Auto-trait is a new thing to me."}], "tags": [], "owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "is_accepted": false, "score": 2, "last_activity_date": 1615208506, "last_edit_date": 1615208506, "creation_date": 1554167045, "answer_id": 55465531, "question_id": 55455965, "link": "https://stackoverflow.com/questions/55455965/how-can-i-write-a-method-to-wrap-any-value-in-my-type-that-can-be-called-multipl/55465531#55465531", "title": "How can I write a method to wrap any value in my type that can be called multiple times without requiring type annotations?", "body": "<p>You can achieve something like this on nightly, not using specialization, but using two different traits and an auto trait to distinguish between them.</p>\n<pre><code>#![feature(auto_traits)]\n#![feature(negative_impls)]\n\nauto trait IsWrap {}\n\n#[derive(Debug)]\nstruct Wrapper&lt;T&gt;(T);\n\nimpl&lt;T&gt; !IsWrap for Wrapper&lt;T&gt; {}\n\ntrait ToWrapper: Sized {\n    fn to_wrap(self) -&gt; Wrapper&lt;Self&gt;;\n}\n\nimpl&lt;T: IsWrap&gt; ToWrapper for T {\n    fn to_wrap(self) -&gt; Wrapper&lt;T&gt; {\n        Wrapper(self)\n    }\n}\n\ntrait ToWrapperSelf {\n    fn to_wrap(self) -&gt; Self;\n}\n\nimpl&lt;T&gt; ToWrapperSelf for Wrapper&lt;T&gt; {\n    fn to_wrap(self) -&gt; Self {\n        self\n    }\n}\n\nfn main() {\n    let a = 1.to_wrap();\n    println!(&quot;{:?}&quot;, a);\n    let a = 1.to_wrap().to_wrap(); \n    println!(&quot;{:?}&quot;, a);\n}\n</code></pre>\n<p>As with <a href=\"https://stackoverflow.com/a/55460987/3650362\">chabapok's suggestion</a>, you can't use this technique to write a generic function that behaves one way when given one type and another way with another type (although see the links below). But you can use it when the concrete type is known to the compiler but not to the programmer -- macros come to mind as a possible use case.</p>\n<p>It has one further advantage in that there is no possible ambiguity over which <code>to_wrap</code> method will be called on any type. Every type has at most one <code>to_wrap</code> method, since <code>Wrapper</code>s only have <code>ToWrapperSelf::is_wrap</code> and non-<code>Wrapper</code>s only have <code>ToWrapper::is_wrap</code>.</p>\n<p>One other <em>dis</em>advantage is that <code>!IsWrap</code> for <code>Wrapper&lt;T&gt;</code> is &quot;infectious&quot;: any type that contains or might contain a <code>Wrapper&lt;T&gt;</code> will <em>also</em> be automatically <code>!IsWrap</code>. If you call <code>.to_wrap()</code> on such a type, the compiler will not be able to find the method and will issue an error. If this is a problem, you can manually implement <code>IsWrap</code> for these types, but it might be more prudent to look for another, less fragile solution.</p>\n<p>(The only exception to the above is <code>Box&lt;Wrapper&lt;T&gt;&gt;</code>: you can call <code>ToWrapperSelf::to_wrap</code> on it to get a <code>Wrapper&lt;T&gt;</code>. This happens due to the autodereferencing rules and because <a href=\"https://stackoverflow.com/questions/42264041/how-do-i-get-an-owned-value-out-of-a-box\"><code>Box</code> is special</a>.)</p>\n<h2>See also</h2>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/49710852/what-is-an-auto-trait-in-rust\">What is an auto trait in Rust?</a></li>\n<li>The solution outlined above is similar to <a href=\"https://stackoverflow.com/a/52453259/3650362\">this answer</a>.</li>\n<li><a href=\"https://stackoverflow.com/questions/52281091/can-i-avoid-eager-ambiguity-resolution-for-trait-implementations-with-generics\">Can I avoid eager ambiguity resolution for trait implementations with generics?</a> has a similar &quot;specialization but not really&quot; flavor. My answer to that question can be combined with this answer to create traits and generic functions that dispatch <code>Wrapper</code>s and non-<code>Wrapper</code>s transparently, even though you can't leverage the full power of specialization.</li>\n</ul>\n"}], "owner": {"reputation": 11, "user_id": 10903577, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-GkxapzVV8uc/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwca3avG2pLthe-3scXprhYrwwbEJvg/mo/photo.jpg?sz=128", "display_name": "chirsz", "link": "https://stackoverflow.com/users/10903577/chirsz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 688, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1615208506, "creation_date": 1554124258, "last_edit_date": 1554131588, "question_id": 55455965, "link": "https://stackoverflow.com/questions/55455965/how-can-i-write-a-method-to-wrap-any-value-in-my-type-that-can-be-called-multipl", "title": "How can I write a method to wrap any value in my type that can be called multiple times without requiring type annotations?", "body": "<p>I wrote a type <code>Wrapper&lt;T&gt;</code> which contains a value of <code>T</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct Wrapper&lt;T&gt;(T);\n</code></pre>\n\n<p>I want a method <code>to_wrap</code> which would allow me to write code like this, where <code>b</code> is <code>Wrapper&lt;i32&gt;</code> and <code>c</code> is <code>Wrapper&lt;i32&gt;</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let a = 12i32;\nlet b = a.to_wrap();\nlet c = b.to_wrap();\n</code></pre>\n\n<p>I want <code>v.to_wrap()</code> to always produce a <code>Wrapper&lt;T&gt;</code> where T is <strong>NOT</strong> a <code>Wrapper</code>. If <code>v</code> is a <code>Wrapper&lt;T&gt;</code>, <code>v.to_wrap()</code> will also be a <code>Wrapper&lt;T&gt;</code> with the same value.</p>\n\n<p>The code I wrote closest to my idea is:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#![feature(specialization)]\n\n#[derive(Debug)]\nstruct Wrapper&lt;T&gt;(T);\n\ntrait ToWrapper&lt;W&gt; {\n    fn to_wrap(self) -&gt; W;\n}\n\nimpl&lt;T&gt; ToWrapper&lt;Wrapper&lt;T&gt;&gt; for T {\n    default fn to_wrap(self) -&gt; Wrapper&lt;T&gt; {\n        Wrapper(self)\n    }\n}\n\nimpl&lt;T&gt; ToWrapper&lt;Wrapper&lt;T&gt;&gt; for Wrapper&lt;T&gt; {\n    fn to_wrap(self) -&gt; Self {\n        self\n    }\n}\n\nfn main() {\n    let a = 1i32;\n    println!(\"{:?}\", a);\n    let a = 1.to_wrap();\n    println!(\"{:?}\", a);\n    let a: Wrapper&lt;i32&gt; = 1.to_wrap().to_wrap();\n    // let a = 1.to_wrap().to_wrap();\n    // boom with `cannot infer type`\n    println!(\"{:?}\", a);\n}\n\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=c60f4637fbdee599b1542ad164d3c5b8\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>This has a compilation error if I erase the type annotation on from <code>let a: Wrapper&lt;i32&gt; = 1.to_wrap().to_wrap()</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0282]: type annotations needed\n  --&gt; src/main.rs:27:9\n   |\n27 |     let a = 1.to_wrap().to_wrap();\n   |         ^\n   |         |\n   |         cannot infer type\n   |         consider giving `a` a type\n</code></pre>\n\n<p>I want the Rust compiler to automatically derive the type of <code>1.to_wrap().to_wrap()</code>. How can I write the correct version, or why is it not possible to write it?</p>\n"}, {"tags": ["rust", "panic", "stack-unwinding"], "comments": [{"owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "edited": false, "score": 7, "creation_date": 1554110636, "post_id": 55451373, "comment_id": 97617544, "body": "The following article from <a href=\"https://os.phil-opp.com/freestanding-rust-binary/#panic-implementation\" rel=\"nofollow noreferrer\">phil-opp</a> explains unwinding in a no-std environment,though you will have to use OS specific libraries like <a href=\"http://www.nongnu.org/libunwind/\" rel=\"nofollow noreferrer\">libunwind</a> on linux"}], "owner": {"reputation": 5146, "user_id": 851835, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/20bf44ece0e0db121f9a44812b113e03?s=128&d=identicon&r=PG", "display_name": "updogliu", "link": "https://stackoverflow.com/users/851835/updogliu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 776, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1554125183, "creation_date": 1554109071, "last_edit_date": 1554125183, "question_id": 55451373, "link": "https://stackoverflow.com/questions/55451373/is-it-possible-to-unwind-on-panic-in-no-std-mode", "title": "Is it possible to unwind on panic in `#![no_std]` mode?", "body": "<p>Is it possible to unwind on panic in <code>#![no_std]</code> mode, e.g. with a customized <code>#[panic_handler]</code>?</p>\n"}, {"tags": ["rust", "rust-proc-macros"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1554117037, "post_id": 55451295, "comment_id": 97621001, "body": "I really don&#39;t understand what you want to achieve or what&#39;s your problem. This sounds very much as an XY problem to me. Please describe what your problem is, what you want to do and what you have done so far. Please have a look at <a href=\"https://stackoverflow.com/help/how-to-ask\">how to ask</a> and the rust specific information at the <a href=\"https://stackoverflow.com/tags/rust/info\">rust info page</a>."}, {"owner": {"reputation": 197, "user_id": 1241928, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f3430482c8c98068728b4f23ce67304f?s=128&d=identicon&r=PG", "display_name": "blackwolfsa", "link": "https://stackoverflow.com/users/1241928/blackwolfsa"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554121277, "post_id": 55451295, "comment_id": 97623301, "body": "I added in an extra piece of what I want to do. The trait implementation I have I require the raw bytes in memory. I dont really want to delve into unsafe if I dont have too. Yes I know those functions do."}, {"owner": {"reputation": 197, "user_id": 1241928, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f3430482c8c98068728b4f23ce67304f?s=128&d=identicon&r=PG", "display_name": "blackwolfsa", "link": "https://stackoverflow.com/users/1241928/blackwolfsa"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1554123298, "post_id": 55451295, "comment_id": 97624499, "body": "I thought I might add this as well. What I in essence want is the raw bytes in memory of the struct.  My current macro steps through each field of the struct and asks the as_bytes(), but not every field has as_bytes()."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 3, "last_activity_date": 1602594067, "last_edit_date": 1602594067, "creation_date": 1554124369, "answer_id": 55456011, "question_id": 55451295, "link": "https://stackoverflow.com/questions/55451295/is-it-possible-to-tell-if-a-field-is-a-certain-type-or-implements-a-certain-meth/55456011#55456011", "title": "Is it possible to tell if a field is a certain type or implements a certain method in a procedural macro?", "body": "<blockquote>\n<p>Is it possible to tell if a field is a certain type or implements a certain method in a procedural macro?</p>\n</blockquote>\n<p>No, it is not.</p>\n<p>Macros operate on the <a href=\"https://en.wikipedia.org/wiki/Abstract_syntax_tree\" rel=\"nofollow noreferrer\">abstract syntax tree (AST)</a> of the Rust code. This means that you basically just get the characters that the user typed in.</p>\n<p>If user code has something like <code>type Foo = Option&lt;Result&lt;i32, MyError&gt;&gt;</code>, and you process some code that uses <code>Foo</code>, the macro will not know that it's &quot;really&quot; an <code>Option</code>.</p>\n<p>Even if it <em>did</em> know the type, knowing what methods are available would be even harder. Future crates can create traits which add methods to existing types. At the point in time that the procedural macro is running, these crates may not have even been compiled yet.</p>\n<blockquote>\n<p>I am looking at creating another trait/member function that I just have to create for all primitives and create a procedural macro for larger fields such as structs.</p>\n</blockquote>\n<p>This is the correct solution. If you look at any existing well-used procedural macro, that's exactly what it does. This allows the compiler to do what the compiler is intended to do.</p>\n<p>This is also way better for maintainability \u2014 now these primitive implementations live in a standard Rust file, as opposed to embedded inside of a macro. Much easier to read and debug.</p>\n<p>Your crate will have something like this:</p>\n<pre><code>// No real design put into this trait\ntrait ToBytes {\n    fn encode(&amp;self, buf: &amp;mut Vec&lt;u8&gt;);\n}\n\nimpl ToBytes for str {\n    fn encode(&amp;self, buf: &amp;mut Vec&lt;u8&gt;) {\n        buf.extend(self.as_bytes())\n    }\n}\n\n// Other base implementations\n</code></pre>\n<p>And your procedural macro will implement this in the straightforward way:</p>\n<pre><code>#[derive(ToBytes)]\nstruct Foo {\n    a: A,\n    b: B,\n}\n</code></pre>\n<p>becomes</p>\n<pre><code>impl ToBytes for Foo {\n    fn encode(&amp;self, buf: &amp;mut Vec&lt;u8&gt;) {\n        ToBytes::encode(&amp;self.a, buf);\n        ToBytes::encode(&amp;self.b, buf);\n    }\n}\n</code></pre>\n<p>As a concrete example, <a href=\"https://serde.rs/\" rel=\"nofollow noreferrer\">Serde</a> does the same thing, with <em>multiple</em> ways of serializing to and from binary data:</p>\n<ul>\n<li><a href=\"https://github.com/TyOverby/bincode\" rel=\"nofollow noreferrer\">Bincode</a></li>\n<li><a href=\"https://github.com/pyfisch/cbor\" rel=\"nofollow noreferrer\">CBOR</a></li>\n<li><a href=\"https://github.com/3Hren/msgpack-rust\" rel=\"nofollow noreferrer\">MessagePack</a></li>\n<li>etc.</li>\n</ul>\n"}], "owner": {"reputation": 197, "user_id": 1241928, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f3430482c8c98068728b4f23ce67304f?s=128&d=identicon&r=PG", "display_name": "blackwolfsa", "link": "https://stackoverflow.com/users/1241928/blackwolfsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 936, "favorite_count": 0, "accepted_answer_id": 55456011, "answer_count": 1, "score": 4, "last_activity_date": 1602594067, "creation_date": 1554108829, "last_edit_date": 1554124721, "question_id": 55451295, "link": "https://stackoverflow.com/questions/55451295/is-it-possible-to-tell-if-a-field-is-a-certain-type-or-implements-a-certain-meth", "title": "Is it possible to tell if a field is a certain type or implements a certain method in a procedural macro?", "body": "<p>I created a procedural macro that implements a trait, but in order for this to work I need to get the raw bytes for every field. The problem is how to get the bytes of a field differs depending on the type of field. </p>\n\n<p>Is there some way of testing if a function exists on a field and if it does not tries another function?</p>\n\n<p>E.g. something like this:</p>\n\n<pre><code>if item.field::function_exist {\n    //do code\n} else {\n    //do other code\n}\n</code></pre>\n\n<p>Currently I am looking at creating another trait/member function that I just have to create for all primitives and create a procedural macro for larger fields such as structs. For example:</p>\n\n<pre><code>if item.field::as_bytes().exists {\n    (&amp;self.#index).as_bytes()\n} else {\n    let bytes = (&amp;self.#index).to_bytes();\n    &amp;bytes\n}\n</code></pre>\n\n<p>With a string, it has a <code>as_bytes</code> member function, while <code>i32</code> does not. This means I need extra code, when the member field of the struct is not a string. I might need a <code>match</code> rather than an <code>if</code>, but the <code>if</code> will suffice for the example. </p>\n"}, {"tags": ["string", "rust", "char", "iterable"], "comments": [{"owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "edited": false, "score": 1, "creation_date": 1554098694, "post_id": 55448803, "comment_id": 97612209, "body": "It seems to me you have forgot to subtract 1 from the length of the string: (s1.len() - 1)<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=0fd946d57241b80db557f5d29a60265d\" rel=\"nofollow noreferrer\">Playground</a>"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 3, "creation_date": 1554098841, "post_id": 55448803, "comment_id": 97612259, "body": "I don&#39;t get why one of your examples is false. They both differ in exactly one char and are both equally long. Can you explain it a little more?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "edited": false, "score": 1, "creation_date": 1554099014, "post_id": 55448803, "comment_id": 97612316, "body": "@AkinerAlkan 0..x is inclusive for 0 and exclusif for x, the problem is that <code>s1_chars.nth</code> mut the iterator"}], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554101979, "post_id": 55449430, "comment_id": 97613425, "body": "<code>s1.chars()         .zip(s2.chars())         .filter(|(c1, c2)| c1 != c2)         .nth(1)         .is_none()</code>"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554108098, "post_id": 55449430, "comment_id": 97616232, "body": "@Stargateur Nice, but it doesn&#39;t distinguish &quot;no differences&quot; from &quot;one difference&quot;."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554109280, "post_id": 55449430, "comment_id": 97616871, "body": "But that outside the scope of the function anyway ?"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554112609, "post_id": 55449430, "comment_id": 97618539, "body": "@Stargateur Not as originally written, no."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554123441, "post_id": 55449430, "comment_id": 97624574, "body": "<i>call <code>next()</code> on it twice</i> \u2014 this doesn&#39;t have guaranteed behavior unless you call <code>fuse()</code>. I guess this is handled by the <code>is_some</code> short-circuiting, but it still raised my eyebrows at first."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1554123658, "post_id": 55449430, "comment_id": 97624712, "body": "<i>that is not short-circuiting</i> \u2014 use <code>take</code>?: <code>s1.chars().zip(s2.chars()).filter(|(c1, c2)| c1 != c2).take(2).count() == 1</code>"}, {"owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "edited": false, "score": 0, "creation_date": 1554145671, "post_id": 55449430, "comment_id": 97636386, "body": "&quot;use <code>take</code>&quot; - clever!"}, {"owner": {"reputation": 111, "user_id": 7092314, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bfd0d0b3901bd49b82f10a8640344b5b?s=128&d=identicon&r=PG", "display_name": "Nolik", "link": "https://stackoverflow.com/users/7092314/nolik"}, "edited": false, "score": 0, "creation_date": 1554146496, "post_id": 55449430, "comment_id": 97636757, "body": "Guys, i really appreciate for clear explanation and func code sample. Thx for help!"}], "tags": [], "owner": {"reputation": 60956, "user_id": 8922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f1634a09333f7b391db92e1d2bea6253?s=128&d=identicon&r=PG", "display_name": "Sebastian Redl", "link": "https://stackoverflow.com/users/8922/sebastian-redl"}, "is_accepted": true, "score": 3, "last_activity_date": 1554101314, "creation_date": 1554101314, "answer_id": 55449430, "question_id": 55448803, "link": "https://stackoverflow.com/questions/55448803/how-to-determine-if-two-strings-have-only-one-different-character-in-a-functiona/55449430#55449430", "title": "How to determine if two strings have only one different character in a functional style with iterators?", "body": "<p>First off, I corrected your imperative code to</p>\n\n<ul>\n<li>remove the extremely inefficient index-based access into the character iterators,</li>\n<li>remove the crash if <code>s1</code> is longer but otherwise equal to <code>s2</code> and replace this with the same \"ignore tail of longer string\" behavior that your code exhibits the other way around,</li>\n<li>use <code>str</code> instead of <code>String</code> since there's pretty much never a good reason to pass a <code>&amp;String</code> to a function, and</li>\n<li>fix some minor style issues; in particular adding semicolons to returns, but using tail-return expression without return. This is more idiomatic Rust.</li>\n</ul>\n\n<p>It looks like this:</p>\n\n<pre><code>fn has_one_difference(s1: &amp;str, s2: &amp;str) -&gt; bool {\n    let mut found_one_difference = false;\n\n    for (c1, c2) in s1.chars().zip(s2.chars()) {\n        if c1 != c2 {\n            if found_one_difference {\n                return false;\n            } else {\n                found_one_difference = true\n            }\n        }\n    }\n\n    found_one_difference\n}\n</code></pre>\n\n<p>Now for the functional version, I would simply compose an iterator and see if I can call <code>next()</code> on it twice:</p>\n\n<pre><code>fn has_one_difference_functional(s1: &amp;str, s2: &amp;str) -&gt; bool {\n    // An iterator over different char pairs.\n    let mut iter = s1.chars().zip(s2.chars())\n        .filter(|(c1, c2)| c1 != c2);\n\n    // First call to next() must succeed (one difference), second must fail.   \n    iter.next().is_some() &amp;&amp; iter.next().is_none()\n}\n</code></pre>\n\n<p>This isn't fully functional, but I think it's overall the best combination of conciseness and readability. A simple fully functional version would call <code>count()</code> on the composed iterator and compare that to 1, but that is not short-circuiting and thus less efficient than need be. A more efficient version can be written with <code>try_fold</code>, but that loses readability due to complexity, so I would only consider it for a <code>has_n_differences</code> function.</p>\n"}], "owner": {"reputation": 111, "user_id": 7092314, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bfd0d0b3901bd49b82f10a8640344b5b?s=128&d=identicon&r=PG", "display_name": "Nolik", "link": "https://stackoverflow.com/users/7092314/nolik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 416, "favorite_count": 0, "accepted_answer_id": 55449430, "answer_count": 1, "score": 1, "last_activity_date": 1554123350, "creation_date": 1554097976, "last_edit_date": 1554123350, "question_id": 55448803, "link": "https://stackoverflow.com/questions/55448803/how-to-determine-if-two-strings-have-only-one-different-character-in-a-functiona", "title": "How to determine if two strings have only one different character in a functional style with iterators?", "body": "<p>I need to write a function that will check if two <code>String</code>s differ in exactly one character in sequential way, i.e. only <code>diff(\"aba\", \"abc\") == true</code>, <code>diff(\"aab\", \"cab\") == false</code>, length of strings is equal). </p>\n\n<p>I wrote the code in an imperative style, but it seems ugly and I want to write it in functional style with iterator.</p>\n\n<p>I suppose it should be something with <code>s1.chars()..enumerate()</code> + some closure, that detects one different character in two strings.</p>\n\n<pre><code>fn has_one_difference(s1: &amp;String, s2: &amp;String) -&gt; bool {\n    let mut diff_chars_limit = false;\n    let mut s1_chars = s1.chars();\n    let mut s2_chars = s2.chars();\n\n    for index in 0..s1.len() {\n        if s1_chars.nth(index).unwrap() != s2_chars.nth(index).unwrap() {\n            if diff_chars_limit {\n                return false\n            } else {\n                diff_chars_limit = true\n            }\n        }\n    }\n\n    return diff_chars_limit;\n}\n</code></pre>\n\n<p>I get this error: </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>thread 'main' panicked at 'called `Option::unwrap()` on a `None` value', src/libcore/option.rs:345:21\n</code></pre>\n\n<p>on the last character of string iteration.</p>\n"}, {"tags": ["rust", "rust-tokio"], "answers": [{"tags": [], "owner": {"reputation": 657, "user_id": 2547570, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/66ac34b6d04aa0bf9c738ef391c8b722?s=128&d=identicon&r=PG", "display_name": "mq7", "link": "https://stackoverflow.com/users/2547570/mq7"}, "is_accepted": false, "score": 0, "last_activity_date": 1554184354, "last_edit_date": 1554184354, "creation_date": 1554138979, "answer_id": 55460401, "question_id": 55447650, "link": "https://stackoverflow.com/questions/55447650/tokiorun-async-with-tokionetunixstream-panics/55460401#55460401", "title": "tokio::run_async with tokio::net::UnixStream panics", "body": "<h2>Working Solution</h2>\n\n<p>The code snippet in <a href=\"https://www.reddit.com/r/rust/comments/aaylv7/panic_noopwake_cannot_wake_with/\" rel=\"nofollow noreferrer\">reddit</a> worked.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use futures::{Future,FutureExt};\nuse futures::compat::Compat;\n\npub fn tokio_run&lt;F: Future&lt;Output=()&gt; + Send + 'static&gt;(future: F) {\n    tokio::run(Compat::new(Box::pin(\n        future.map(|()| -&gt; Result&lt;(), ()&gt; { Ok(()) })\n    )));\n}\n\npub fn tokio_spawn&lt;F: Future&lt;Output=()&gt; + Send + 'static&gt;(future: F) {\n    tokio::spawn(Compat::new(Box::pin(\n        future.map(|()| -&gt; Result&lt;(), ()&gt; { Ok(()) })\n    )));\n}\n</code></pre>\n\n<p>Use futures 0.3 in <code>await!</code> (not <code>tokio::await</code>), and use these functions instead of <code>tokio::run_async, tokio::spawn_async</code>.</p>\n\n<h2>Non-working Solution</h2>\n\n<p>The error message suggests to use futures 0.1, but converting futures 0.3 into 0.1 and using <code>tokio::await!</code> didn't work:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use tokio::await;\n...\nawait!(future03.into_awaitable());\n</code></pre>\n\n<p>Run</p>\n\n<pre><code>thread 'tokio-runtime-worker-0' panicked at 'not yet implemented: async-await-\npreview currently only supports futures 0.1. Use the compatibility layer of futures 0.3 instead, if you want to use futures 0.3.', /Users/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-async-await-0.1.6/src/compat/backward.rs:76:5\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3653, "user_id": 786102, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/15fbc7eac0e190a249d7495cc9cdf156?s=128&d=identicon&r=PG", "display_name": "kralyk", "link": "https://stackoverflow.com/users/786102/kralyk"}, "is_accepted": false, "score": 0, "last_activity_date": 1558018860, "creation_date": 1558018860, "answer_id": 56171513, "question_id": 55447650, "link": "https://stackoverflow.com/questions/55447650/tokiorun-async-with-tokionetunixstream-panics/56171513#56171513", "title": "tokio::run_async with tokio::net::UnixStream panics", "body": "<p>I ran into a similar problem. I am using the following utility to make 0.3 futures runnable on Tokio runtime:</p>\n\n<pre><code>fn compat&lt;F: StdFuture + Send + 'static&gt;(f: F) -&gt; impl Future&lt;Item=F::Output, Error=()&gt; {\n    f.unit_error().boxed().compat()\n}\n</code></pre>\n\n<p>I suppose it could be turned into a trait too...</p>\n"}], "owner": {"reputation": 657, "user_id": 2547570, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/66ac34b6d04aa0bf9c738ef391c8b722?s=128&d=identicon&r=PG", "display_name": "mq7", "link": "https://stackoverflow.com/users/2547570/mq7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 361, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1558018860, "creation_date": 1554088295, "last_edit_date": 1554125304, "question_id": 55447650, "link": "https://stackoverflow.com/questions/55447650/tokiorun-async-with-tokionetunixstream-panics", "title": "tokio::run_async with tokio::net::UnixStream panics", "body": "<p><code>tokio::run_async + futures 0.3 + tokio::net::UnixStream</code> panics.</p>\n\n<h3>Setup</h3>\n\n<pre><code>[package]\nname = \"prac\"\nversion = \"0.1.0\"\nedition = \"2018\"\n\n[dependencies]\nfutures-preview = {version=\"0.3.0-alpha.13\", features=[\"compat\", \"io-compat\"]}\ntokio = {version=\"0.1.18\", features=[\"async-await-preview\"]}\n</code></pre>\n\n<h3>Code</h3>\n\n<pre><code>#![feature(await_macro, async_await, futures_api)]\n\nuse tokio::net::UnixStream;\nuse tokio::net::UnixListener;\nuse futures::compat::Future01CompatExt;\nuse futures::compat::Stream01CompatExt;\nuse futures::StreamExt;\n\nfn main() {\n    let _ = std::fs::remove_file(\"/tmp/test.sock\");\n\n    tokio::run_async(async {\n        let fut = UnixListener::bind(&amp;\"/tmp/test.sock\").unwrap().incoming().compat();\n        let fut = fut.for_each(|stream| {\n            let _ = stream;\n            println!(\"new conn\");\n            futures::future::ready(())\n        });\n        tokio::spawn_async(fut);\n\n        let fut = UnixStream::connect(&amp;\"/tmp/test.sock\").compat();\n        let _conn = await!(fut);\n    });\n}\n</code></pre>\n\n<h3>Run</h3>\n\n<pre class=\"lang-none prettyprint-override\"><code>     Running `target/debug/main bin main`\nthread 'tokio-runtime-worker-0' panicked at 'not yet implemented: async-await-preview currently only supports futures 0.1. Use the compatibility layer of futures 0.3 instead, if you want to use futures 0.3.', /Users/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-async-await-0.1.6/src/compat/backward.rs:76:5\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\nthread 'tokio-runtime-worker-1' panicked at 'not yet implemented: async-await-preview currently only supports futures 0.1. Use the compatibility layer of futures 0.3 instead, if you want to use futures 0.3.', /Users/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-async-await-0.1.6/src/compat/backward.rs:76:5\n</code></pre>\n\n<p>The compiler forces me to use futures 0.3.</p>\n\n<ol>\n<li><code>await!()</code> requires futures 0.3 (does not compile with futures 0.1)</li>\n<li><code>async {}</code> block requires futures 0.3 (because <code>await!(async {})</code> works)</li>\n<li><code>tokio::run_async</code> requires futures 0.3 (does not compile with futures 0.1)</li>\n</ol>\n\n<p>It seems that futures 0.3 has something incompatible with futures 0.1.\nIs there a workaround?</p>\n"}, {"tags": ["rust", "lifetime", "borrow-checker"], "comments": [{"owner": {"reputation": 9010, "user_id": 2588800, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/847da843d41921363502159c8b7e5549?s=128&d=identicon&r=PG", "display_name": "Svetlin Zarev", "link": "https://stackoverflow.com/users/2588800/svetlin-zarev"}, "edited": false, "score": 0, "creation_date": 1554118826, "post_id": 55447297, "comment_id": 97621990, "body": "Instead of borrowing you can use <code>Rc</code> to have multiple owners. And if you really need mutability you can use <code>RefCell</code> and the internal mutability pattern."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554124088, "post_id": 55447297, "comment_id": 97624958, "body": "This actually <i>will</i> be fixed by NLL, just not the NLL that&#39;s available in the current version of Rust. In the meantime, you will want to workaround this with some inefficiency by returning a boolean instead of an (optional) reference."}], "owner": {"reputation": 2058, "user_id": 3958875, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f6149ddd4636bcab17c52b751d79f7fd?s=128&d=identicon&r=PG&f=1", "display_name": "Prime_Aqasix", "link": "https://stackoverflow.com/users/3958875/prime-aqasix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 157, "favorite_count": 0, "closed_date": 1554123938, "answer_count": 0, "score": 1, "last_activity_date": 1554123804, "creation_date": 1554084641, "last_edit_date": 1554123804, "question_id": 55447297, "link": "https://stackoverflow.com/questions/55447297/restructuring-match-statement-to-satisfy-borrow-checker", "closed_reason": "Duplicate", "title": "Restructuring match statement to satisfy borrow checker", "body": "<p>I am trying to write a trie structure, which takes in a stream of characters and adds them onto the trie if it doesn't exist yet. When it adds a character, it returns to the top to start again.</p>\n\n<pre><code>#[derive(Debug)]\npub struct Trie {\n    char: u8,\n    children: [Option&lt;Box&lt;Self&gt;&gt;; 2],\n}\n\nimpl Trie {\n    pub fn new(char: u8) -&gt; Trie {\n        return Trie {\n            char,\n            children: [None, None],\n        };\n    }\n\n    pub fn push(&amp;mut self, lz_pair: Trie) {\n        let idx = lz_pair.char as usize;\n        self.children[idx] = Some(Box::new(lz_pair));\n    }\n\n    pub fn get_child(&amp;mut self, char: u8) -&gt; Option&lt;&amp;mut Trie&gt; {\n        let child = self.children[char as usize].as_mut();\n        if let Some(c) = child {\n            Some(c.as_mut())\n        } else {\n            None\n        }\n    }\n}\n\nfn main() {\n    let data = b\"abbabababbbbbabaaaabababaa\";\n\n    let mut root = Trie::new(0);\n    let mut cur = &amp;mut root;\n\n    for c in data {\n        cur = match cur.get_child(*c) {\n            Some(child) =&gt; child,\n            None =&gt; {\n                cur.push(Trie::new(*c - 97));\n                &amp;mut root\n            }\n        };\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=ca559dbcf49d7acfd64f1e19433840f9\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>The actual code is a bit more complicated, but I distilled it down to just show this error.</p>\n\n<p>The borrow checker complains:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0499]: cannot borrow `*cur` as mutable more than once at a time\n  --&gt; src/main.rs:40:17\n   |\n37 |         cur = match cur.get_child(*c) {\n   |                     --- first mutable borrow occurs here\n...\n40 |                 cur.push(Trie::new(*c - 97));\n   |                 ^^^\n   |                 |\n   |                 second mutable borrow occurs here\n   |                 first borrow used here, in later iteration of loop\n</code></pre>\n\n<p>I have read through all the questions here on the borrow checker errors when unwrapping <code>Option</code>s (i.e. <a href=\"https://stackoverflow.com/questions/51165043/how-to-end-borrow-when-an-option-is-none?noredirect=1&amp;lq=1\">This question and all the duplicates</a>), so I sort of understand why it happens, however I don't know how I can restructure this code to solve this particular case.</p>\n\n<p>Non-lexical lifetimes don't seem to solve this problem as I am compiling using the 2018 version of Rust.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1554084889, "post_id": 55447198, "comment_id": 97609276, "body": "Not sure what part of this you think is unnecessary. The compiler can&#39;t resolve <code>a.set_port(...)</code> unless it knows the type of <code>a</code>, and to do that you have to peer into the <code>enum</code>. There are two possibilities, so you have to account for both of them."}], "answers": [{"tags": [], "owner": {"reputation": 373, "user_id": 3949255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2987c356f74bda70da7d3d1e778b12f8?s=128&d=identicon&r=PG&f=1", "display_name": "Will Fischer", "link": "https://stackoverflow.com/users/3949255/will-fischer"}, "is_accepted": true, "score": 1, "last_activity_date": 1554085061, "creation_date": 1554085061, "answer_id": 55447341, "question_id": 55447198, "link": "https://stackoverflow.com/questions/55447198/why-is-this-pattern-match-necessary/55447341#55447341", "title": "Why is this pattern match necessary?", "body": "<p><code>match</code> is required to access the inner value. A <a href=\"https://doc.rust-lang.org/std/net/enum.SocketAddr.html\" rel=\"nofollow noreferrer\"><code>SocketAddr</code></a> can contain either a <a href=\"https://doc.rust-lang.org/std/net/struct.SocketAddrV4.html\" rel=\"nofollow noreferrer\"><code>SocketAddrV4</code></a> or a <a href=\"https://doc.rust-lang.org/std/net/struct.SocketAddrV6.html\" rel=\"nofollow noreferrer\"><code>SocketAddrV6</code></a>, so you need to handle both possibilities.</p>\n"}], "owner": {"reputation": 49, "user_id": 5588832, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206326905104734/picture?type=large", "display_name": "Marco", "link": "https://stackoverflow.com/users/5588832/marco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "closed_date": 1554123036, "accepted_answer_id": 55447341, "answer_count": 1, "score": -1, "last_activity_date": 1608766861, "creation_date": 1554083629, "last_edit_date": 1608766861, "question_id": 55447198, "link": "https://stackoverflow.com/questions/55447198/why-is-this-pattern-match-necessary", "closed_reason": "Duplicate", "title": "Why is this pattern match necessary?", "body": "<p>I am reading <a href=\"https://doc.rust-lang.org/src/std/net/addr.rs.html#199-205\" rel=\"nofollow noreferrer\">this</a> and is like some lines of code are not necessary.</p>\n<p>For example in the example below, is the <code>match</code> really useful? Why is it needed? Seems like repetitive code? Maybe the compiler resolve this and it is written only for expressiveness?</p>\n<pre class=\"lang-rust prettyprint-override\"><code>#[stable(feature = &quot;sockaddr_setters&quot;, since = &quot;1.9.0&quot;)]\npub fn set_port(&amp;mut self, new_port: u16) {\n    match *self {\n        SocketAddr::V4(ref mut a) =&gt; a.set_port(new_port),\n        SocketAddr::V6(ref mut a) =&gt; a.set_port(new_port),\n    }\n}\n</code></pre>\n"}, {"tags": ["rust", "macros"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1554057522, "post_id": 55444086, "comment_id": 97603716, "body": "Educated guess: because it&#39;s annotated with <a href=\"https://doc.rust-lang.org/src/std/macros.rs.html#933\" rel=\"nofollow noreferrer\"><code>rustc_doc_only_macro</code></a>."}], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554058859, "post_id": 55444263, "comment_id": 97604076, "body": "But this is not documented, <a href=\"https://doc.rust-lang.org/std/macro.assert.html\" rel=\"nofollow noreferrer\">doc.rust-lang.org/std/macro.assert.html</a> clearly show <code>macro_rules! assert {</code> without any mention of compiler magic. So as a user point of view <code>assert</code> is a <code>macro_rules</code>"}, {"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "edited": false, "score": 0, "creation_date": 1554059115, "post_id": 55444263, "comment_id": 97604134, "body": "Mhhh. Now I have two more questions: is it intended that users can in fact not <code>use</code> that macro? And: why does <code>assert!</code> has to be a special hardcoded macro? I can understand that for stuff like <code>include_bytes!()</code> it&#39;s necessary, but <code>assert!</code>? Well, but I guess those additional questions are out of scope for your answer? :/ (PS: I also I agree with Stargateur that the docs are not optimal)"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554059228, "post_id": 55444263, "comment_id": 97604161, "body": "@Stargateur that&#39;s true. I&#39;d assume that the intent is that such a built-in is <i>supposed</i> to be indistinguishable from a normal macro. This may simply be an oversight on the implementation side."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "edited": false, "score": 1, "creation_date": 1554059643, "post_id": 55444263, "comment_id": 97604256, "body": "@LukasKalbertodt I think a recent edit addresses &quot;is it intended&quot; (it&#39;s a known limitation, but not desired). <code>assert</code> may just be a hold-over from early Rust development \u2014 try and rewrite it and submit a PR ^_^"}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1554067132, "post_id": 55444263, "comment_id": 97606170, "body": "It&#39;s really weird that <code>assert!</code> needs to be a built-in. It even expends to <code>panic!</code>."}, {"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "edited": false, "score": 0, "creation_date": 1564739625, "post_id": 55444263, "comment_id": 101138349, "body": "<a href=\"https://github.com/rust-lang/rust/pull/63056\" rel=\"nofollow noreferrer\">This PR</a> sounds like it could change something about the current situation. However, I still cannot <code>use std::assert</code> on nightly, so I might be misunderstanding something."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 5, "last_activity_date": 1554059528, "last_edit_date": 1554059528, "creation_date": 1554058152, "answer_id": 55444263, "question_id": 55444086, "link": "https://stackoverflow.com/questions/55444086/why-cant-i-import-stdassert-via-use-while-it-works-for-other-macros-from/55444263#55444263", "title": "Why can&#39;t I import `std::assert` via `use` while it works for other macros from std?", "body": "<blockquote>\n  <p><code>use</code> should work with <code>macro_rules!</code> macros and procedural macros</p>\n</blockquote>\n\n<p>Except <code>assert</code> is <a href=\"https://github.com/rust-lang/rust/blob/1.33.0/src/libstd/macros.rs#L412-L418\" rel=\"nofollow noreferrer\">neither of those</a>:</p>\n\n<blockquote>\n<pre><code>/// Built-in macros to the compiler itself.\n///\n/// These macros do not have any corresponding definition with a `macro_rules!`\n/// macro, but are documented here. Their implementations can be found hardcoded\n/// into libsyntax itself.\n</code></pre>\n</blockquote>\n\n<p>It is a <a href=\"https://github.com/rust-lang/rust/blob/1.33.0/src/libstd/macros.rs#L932-L938\" rel=\"nofollow noreferrer\">compiler built-in</a>:</p>\n\n<pre><code>#[stable(feature = \"rust1\", since = \"1.0.0\")]\n#[rustc_doc_only_macro]\nmacro_rules! assert {\n    ($cond:expr) =&gt; ({ /* compiler built-in */ });\n    ($cond:expr,) =&gt; ({ /* compiler built-in */ });\n    ($cond:expr, $($arg:tt)+) =&gt; ({ /* compiler built-in */ });\n}\n</code></pre>\n\n<p>Other faux-macros include:</p>\n\n<ul>\n<li><code>compile_error</code></li>\n<li><code>format_args</code></li>\n<li><code>env</code></li>\n<li><code>option_env</code></li>\n<li><code>concat_idents</code></li>\n<li><code>concat</code></li>\n<li><code>line</code></li>\n<li><code>column</code></li>\n<li><code>file</code></li>\n<li><code>stringify</code></li>\n<li><code>include_str</code></li>\n<li><code>include_bytes</code></li>\n<li><code>module_path</code></li>\n<li><code>cfg</code></li>\n<li><code>include</code></li>\n</ul>\n\n<p>The actual definition of <code>assert</code> is buried much lower in <a href=\"https://github.com/rust-lang/rust/blob/1.33.0/src/libsyntax_ext/assert.rs\" rel=\"nofollow noreferrer\">libsyntax_ext/assert.rs</a></p>\n\n<hr>\n\n<p><a href=\"https://github.com/rust-lang/rust/issues/56417#issue-386483340\" rel=\"nofollow noreferrer\">Stabilize uniform paths on Rust 2018 (#56417)</a> does mention these in passing:</p>\n\n<blockquote>\n  <p>Built-in macros, for example <code>use env</code>.\n  Currently an error due to some (fixable) implementation details of built-in macros.\n  No known issues to resolve before stabilization (after the error is removed).</p>\n</blockquote>\n"}], "owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 55444263, "answer_count": 1, "score": 4, "last_activity_date": 1554059528, "creation_date": 1554056909, "last_edit_date": 1554057836, "question_id": 55444086, "link": "https://stackoverflow.com/questions/55444086/why-cant-i-import-stdassert-via-use-while-it-works-for-other-macros-from", "title": "Why can&#39;t I import `std::assert` via `use` while it works for other macros from std?", "body": "<p>With Rust 2018, this code works (<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=043365f406a0b110d4084fee3ed016c0\" rel=\"nofollow noreferrer\">Playground</a>):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::panic;\nuse std::format;\nuse std::assert_eq;\n</code></pre>\n\n<p>But this:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::assert;\n</code></pre>\n\n<p>Results in this error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0432]: unresolved import `std::assert`\n --&gt; src/lib.rs:4:5\n  |\n4 | use std::assert;\n  |     ^^^^^^^^^^^ no `assert` in the root\n</code></pre>\n\n<p>I read <a href=\"https://doc.rust-lang.org/edition-guide/rust-2018/macros/macro-changes.html\" rel=\"nofollow noreferrer\">the edition guide about this topic</a> and it says that <code>use</code> should work with <code>macro_rules!</code> macros and procedural macros. Thus, I'm confused.</p>\n"}, {"tags": ["rust", "segmentation-fault", "ffi"], "comments": [{"owner": {"reputation": 3728, "user_id": 1269727, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/75671bb3f0c157f26824dd852f56a13a?s=128&d=identicon&r=PG", "display_name": "toadzky", "link": "https://stackoverflow.com/users/1269727/toadzky"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554052041, "post_id": 55443152, "comment_id": 97602197, "body": "@Stargateur <code>switch_xml_t</code> is just a type-alias on <code>switch_xml</code>"}, {"owner": {"reputation": 3728, "user_id": 1269727, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/75671bb3f0c157f26824dd852f56a13a?s=128&d=identicon&r=PG", "display_name": "toadzky", "link": "https://stackoverflow.com/users/1269727/toadzky"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554052091, "post_id": 55443152, "comment_id": 97602209, "body": "@Shepmaster it&#39;s compiling as a dylib because it&#39;s just loaded at runtime by the C-project. i&#39;m not sure how to make an MCVE without the big C-project i&#39;m trying to write a plugin module for."}, {"owner": {"reputation": 3728, "user_id": 1269727, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/75671bb3f0c157f26824dd852f56a13a?s=128&d=identicon&r=PG", "display_name": "toadzky", "link": "https://stackoverflow.com/users/1269727/toadzky"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554052315, "post_id": 55443152, "comment_id": 97602264, "body": "@Stargateur neither of those variables is causing a problem. that&#39;s in the C-code - which i don&#39;t have control of and works fine when using other plugin modules written in C."}, {"owner": {"reputation": 3728, "user_id": 1269727, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/75671bb3f0c157f26824dd852f56a13a?s=128&d=identicon&r=PG", "display_name": "toadzky", "link": "https://stackoverflow.com/users/1269727/toadzky"}, "edited": false, "score": 0, "creation_date": 1554052721, "post_id": 55443152, "comment_id": 97602369, "body": "updated. i&#39;m not saying i know better than you, i just said the segfault is coming from the line after that which doesn&#39;t reference either of those 2 variables"}, {"owner": {"reputation": 3728, "user_id": 1269727, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/75671bb3f0c157f26824dd852f56a13a?s=128&d=identicon&r=PG", "display_name": "toadzky", "link": "https://stackoverflow.com/users/1269727/toadzky"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1554052814, "post_id": 55443152, "comment_id": 97602398, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/190986/discussion-between-toadzky-and-stargateur\">continue this discussion in chat</a>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554054935, "post_id": 55443152, "comment_id": 97602979, "body": "Please note the <i>drastic</i> difference in code from your <a href=\"https://stackoverflow.com/revisions/55443152/1\">original form</a> to the <a href=\"https://stackoverflow.com/revisions/55443152/5\">current form</a>. See how many things you didn&#39;t provide originally? Definitions of types are <i>important</i>! Definitions of macros are <i>important</i>! Please learn from your mistakes here and continue to improve your question asking skills. It will benefit you both here on Stack Overflow but more importantly everywhere else too."}], "answers": [{"comments": [{"owner": {"reputation": 3728, "user_id": 1269727, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/75671bb3f0c157f26824dd852f56a13a?s=128&d=identicon&r=PG", "display_name": "toadzky", "link": "https://stackoverflow.com/users/1269727/toadzky"}, "edited": false, "score": 0, "creation_date": 1554053189, "post_id": 55443500, "comment_id": 97602481, "body": "thanks. i don&#39;t like it either, i&#39;m just writing the bindings to match the C code exactly"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 3728, "user_id": 1269727, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/75671bb3f0c157f26824dd852f56a13a?s=128&d=identicon&r=PG", "display_name": "toadzky", "link": "https://stackoverflow.com/users/1269727/toadzky"}, "edited": false, "score": 0, "creation_date": 1554053310, "post_id": 55443500, "comment_id": 97602512, "body": "@toadzky Are you aware that automatic tool exist <a href=\"https://github.com/rust-lang/rust-bindgen\" rel=\"nofollow noreferrer\">github.com/rust-lang/rust-bindgen</a> ?"}, {"owner": {"reputation": 3728, "user_id": 1269727, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/75671bb3f0c157f26824dd852f56a13a?s=128&d=identicon&r=PG", "display_name": "toadzky", "link": "https://stackoverflow.com/users/1269727/toadzky"}, "edited": false, "score": 1, "creation_date": 1554053375, "post_id": 55443500, "comment_id": 97602531, "body": "yeah, i tried using it but it didn&#39;t work. i&#39;m not enough of a c or rust dev to understand what was going wrong"}, {"owner": {"reputation": 3728, "user_id": 1269727, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/75671bb3f0c157f26824dd852f56a13a?s=128&d=identicon&r=PG", "display_name": "toadzky", "link": "https://stackoverflow.com/users/1269727/toadzky"}, "edited": false, "score": 0, "creation_date": 1554053400, "post_id": 55443500, "comment_id": 97602543, "body": "i&#39;ll try it again and see if i can get an error message"}], "tags": [], "owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "is_accepted": true, "score": 2, "last_activity_date": 1554055035, "last_edit_date": 1554055035, "creation_date": 1554053045, "answer_id": 55443500, "question_id": 55443152, "link": "https://stackoverflow.com/questions/55443152/segfault-when-dereferencing-a-typedefed-pointer-passed-from-rust-to-c/55443500#55443500", "title": "Segfault when dereferencing a typedefed pointer passed from Rust to C", "body": "<pre class=\"lang-rust prettyprint-override\"><code>pub type switch_xml_t = switch_xml;\n</code></pre>\n\n<p>Is not equivalent to</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>typedef struct switch_xml *switch_xml_t;\n</code></pre>\n\n<p>This typedef hides a pointer. I really don't recommend this style \u2014 one reason why is why this question exists.</p>\n\n<p>The Rust side should be:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[allow(non_camel_case_types)]\npub type switch_xml_t = *mut switch_xml;\n</code></pre>\n"}], "owner": {"reputation": 3728, "user_id": 1269727, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/75671bb3f0c157f26824dd852f56a13a?s=128&d=identicon&r=PG", "display_name": "toadzky", "link": "https://stackoverflow.com/users/1269727/toadzky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 55443500, "answer_count": 1, "score": 0, "last_activity_date": 1554055035, "creation_date": 1554050850, "last_edit_date": 1554054302, "question_id": 55443152, "link": "https://stackoverflow.com/questions/55443152/segfault-when-dereferencing-a-typedefed-pointer-passed-from-rust-to-c", "title": "Segfault when dereferencing a typedefed pointer passed from Rust to C", "body": "<p>I'm trying to write a plugin module in Rust for an existing C project. I've been writing the Rust bindings for the C project as I need them, and my latest one is throwing a segfault every time no matter how I try to interact with it.</p>\n\n<p>Here's the C function signature I'm binding to:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>switch_xml_t switch_xml_open_cfg(const char *file_path, switch_xml_t *node, switch_event_t *params) \n{\n    switch_xml_t xml = NULL, cfg = NULL;\n    *node = NULL; // &lt;-- seg-fault happens here\n    assert(MAIN_XML_ROOT != NULL);\n\n    if (switch_xml_locate(\"configuration\", \"configuration\", \"name\", file_path, &amp;xml, &amp;cfg, params, SWITCH_FALSE) == SWITCH_STATUS_SUCCESS) {\n        *node = cfg;\n    }\n    return xml;\n}\n</code></pre>\n\n<p>and here's the Rust binding and the invocation:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern \"C\" {\n    pub fn switch_xml_open_cfg(\n        file_path: *const c_char,\n        node: *mut switch_xml_t,\n        params: *mut switch_event_t,\n    ) -&gt; switch_xml_t;\n} \n</code></pre>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let mut cfg = switch_xml_t::default();\nunsafe {\n    libfreeswitch_sys::switch_xml_open_cfg(c_str!(\"skeleton_rust_raw.conf\"), &amp;mut cfg, std::ptr::null_mut());\n}\n</code></pre>\n\n<p>I've tried passing the struct to C as:</p>\n\n<ul>\n<li><code>&amp;mut cfg</code></li>\n<li><code>Box::into_raw</code> pointer</li>\n<li><code>&amp;mut cfg as *mut</code></li>\n<li>with <code>mem::forget</code> on it just in case.</li>\n</ul>\n\n<p>I'm completely lost on how the pointer I'm passing in ends up null when it's dereferenced.</p>\n\n<p><code>switch_xml_t</code> is a type alias:</p>\n\n<p>C: </p>\n\n<pre class=\"lang-c prettyprint-override\"><code>typedef struct switch_xml *switch_xml_t;\n</code></pre>\n\n<p>Rust:</p>\n\n<pre><code>pub type switch_xml_t = switch_xml;\n</code></pre>\n\n<p>For the following struct:</p>\n\n<p>C:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>struct switch_xml {\n    /*! tag name */\n    char *name;\n    /*! tag attributes { name, value, name, value, ... NULL } */\n    char **attr;\n    /*! tag character content, empty string if none */\n    char *txt;\n    /*! path to free on destroy */\n    char *free_path;\n    /*! tag offset from start of parent tag character content */\n    switch_size_t off;\n    /*! next tag with same name in this section at this depth */\n    switch_xml_t next;\n    /*! next tag with different name in same section and depth */\n    switch_xml_t sibling;\n    /*! next tag, same section and depth, in original order */\n    switch_xml_t ordered;\n    /*! head of sub tag list, NULL if none */\n    switch_xml_t child;\n    /*! parent tag, NULL if current tag is root tag */\n    switch_xml_t parent;\n    /*! flags */\n    uint32_t flags;\n    /*! is_switch_xml_root bool */\n    switch_bool_t is_switch_xml_root_t;\n    uint32_t refs;\n};\n</code></pre>\n\n<p>Rust:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[repr(C)]\n#[derive(Copy, Clone, Debug)]\npub struct switch_xml {\n    pub name: *mut c_char,\n    pub attr: *mut *mut c_char,\n    pub txt: *mut c_char,\n    pub free_path: *mut c_char,\n    pub off: switch_size_t,\n    pub next: *mut switch_xml_t,\n    pub sibling: *mut switch_xml_t,\n    pub ordered: *mut switch_xml_t,\n    pub child: *mut switch_xml_t,\n    pub parent: *mut switch_xml_t,\n    pub flags: u32,\n    pub is_switch_xml_root_t: switch_bool_t,\n    pub refs: u32,\n}\n</code></pre>\n\n<p>The Rust definition also implements <code>Default</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>impl Default for switch_xml {\n    fn default() -&gt; Self {\n        switch_xml {\n            name: std::ptr::null_mut(),\n            attr: std::ptr::null_mut(),\n            txt: std::ptr::null_mut(),\n            free_path: std::ptr::null_mut(),\n            off: 0,\n            next: std::ptr::null_mut(),\n            sibling: std::ptr::null_mut(),\n            ordered: std::ptr::null_mut(),\n            child: std::ptr::null_mut(),\n            parent: std::ptr::null_mut(),\n            flags: 0,\n            is_switch_xml_root_t: switch_bool_t::SWITCH_FALSE,\n            refs: 0\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["linux", "rust"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "reply_to_user": {"reputation": 3, "user_id": 12347963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72e1e3ab5b9a4b2442f3eb7d405a6a51?s=128&d=identicon&r=PG&f=1", "display_name": "kulicuu", "link": "https://stackoverflow.com/users/12347963/kulicuu"}, "edited": false, "score": 0, "creation_date": 1598282987, "post_id": 55440289, "comment_id": 112401061, "body": "@kulicuu I think this can be re-opened following your edit."}, {"owner": {"reputation": 44923, "user_id": 3440745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5b88faef87b734150f28962f0c8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Tsyvarev", "link": "https://stackoverflow.com/users/3440745/tsyvarev"}, "reply_to_user": {"reputation": 3, "user_id": 12347963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72e1e3ab5b9a4b2442f3eb7d405a6a51?s=128&d=identicon&r=PG&f=1", "display_name": "kulicuu", "link": "https://stackoverflow.com/users/12347963/kulicuu"}, "edited": false, "score": 0, "creation_date": 1598307017, "post_id": 55440289, "comment_id": 112410868, "body": "@kulicuu: Your edit changes the question drastically: new terms, new references. Yes, in the new form the question looks much better, but ... it becomes <b>your question</b>, not the one of the original author. This is not what an edit should do. If you want to ask your question, then do that via &quot;ask a question&quot; button, not via editing some other post."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1598345300, "post_id": 55440289, "comment_id": 112421159, "body": "Uh, I didn&#39;t notice that the big edit wasn&#39;t by the OP."}], "answers": [{"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 6, "last_activity_date": 1554339904, "last_edit_date": 1554339904, "creation_date": 1554031304, "answer_id": 55440385, "question_id": 55440289, "link": "https://stackoverflow.com/questions/55440289/how-do-i-recursively-watch-file-changes-in-rust/55440385#55440385", "title": "How do I recursively watch file changes in Rust?", "body": "<p>The example code for the <a href=\"https://docs.rs/notify/4.0.10/notify/#default-debounced-api\" rel=\"noreferrer\"><code>notify</code> crate</a> does what you want. It uses <code>RecursiveMode::Recursive</code> to specify to watch all files and subdirectories within the provided path.</p>\n\n<pre><code>use notify::{Watcher, RecursiveMode, watcher};\nuse std::sync::mpsc::channel;\nuse std::time::Duration;\n\nfn main() {\n    // Create a channel to receive the events.\n    let (sender, receiver) = channel();\n\n    // Create a watcher object, delivering debounced events.\n    // The notification back-end is selected based on the platform.\n    let mut watcher = watcher(sender, Duration::from_secs(10)).unwrap();\n\n    // Add a path to be watched. All files and directories at that path and\n    // below will be monitored for changes.\n    watcher.watch(\"/path/to/watch\", RecursiveMode::Recursive).unwrap();\n\n    loop {\n        match receiver.recv() {\n           Ok(event) =&gt; println!(\"{:?}\", event),\n           Err(e) =&gt; println!(\"watch error: {:?}\", e),\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1567, "user_id": 2628048, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/1pVHc.jpg?s=128&g=1", "display_name": "Rudolf Schmidt", "link": "https://stackoverflow.com/users/2628048/rudolf-schmidt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2576, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1598343021, "creation_date": 1554030492, "last_edit_date": 1585529089, "question_id": 55440289, "link": "https://stackoverflow.com/questions/55440289/how-do-i-recursively-watch-file-changes-in-rust", "title": "How do I recursively watch file changes in Rust?", "body": "<p>Question:. How to watch for file/directory changes in Rust?\nExtra: How to integrate this in a non-blocking way.  The canonical example (such as that provided by <a href=\"https://docs.rs/notify/4.0.15/notify/\" rel=\"nofollow noreferrer\">https://docs.rs/notify/4.0.15/notify/</a>), shows how to watch the files, but it will block the rest of your main function execution.  (I'm pursuing this <a href=\"https://doc.rust-lang.org/std/sync/mpsc/fn.channel.html\" rel=\"nofollow noreferrer\">https://doc.rust-lang.org/std/sync/mpsc/fn.channel.html</a>)</p>\n"}, {"tags": ["rust", "borrow-checker"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 2, "creation_date": 1554027512, "post_id": 55439815, "comment_id": 97596287, "body": "The compiler told you the reason in the error message, so I suggest reading it. If you don&#39;t understand the error message, please provide a full example to reproduce the error, and include the error message in the question."}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 1, "creation_date": 1554028061, "post_id": 55439815, "comment_id": 97596391, "body": "Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. There is more Rust-specific information in the <a href=\"https://stackoverflow.com/tags/rust/info\">tag description</a>."}], "answers": [{"tags": [], "owner": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "is_accepted": true, "score": 1, "last_activity_date": 1554028457, "creation_date": 1554028457, "answer_id": 55440033, "question_id": 55439815, "link": "https://stackoverflow.com/questions/55439815/using-vec-in-a-struct/55440033#55440033", "title": "Using vec in a struct", "body": "<p>I'm assuming this is the error message that you're getting?</p>\n\n<pre><code>error[E0596]: cannot borrow data in a `&amp;` reference as mutable\n  --&gt; src/main.rs:11:58\n   |\n11 |     let mut parent_children: &amp;mut Vec&lt;Rc&lt;ProcessNode&gt;&gt; = &amp;mut parent_node.children;\n   |                                                          ^^^^^^^^^^^^^^^^^^^^^^^^^ cannot borrow as mutable\n</code></pre>\n\n<p>Since <code><a href=\"https://doc.rust-lang.org/std/rc/struct.Rc.html\" rel=\"nofollow noreferrer\">Rc</a>&lt;T&gt;</code> gives you the ability to have multiple objects point to the same data, it will only allow you to get an immutable reference to its content, otherwise the borrow checker wouldn't be able to guarantee that it won't be changed somewhere in the code while it's borrowed somewhere else.</p>\n\n<p>The way around this is typically to use <code>Rc&lt;<a href=\"https://doc.rust-lang.org/std/cell/struct.RefCell.html\" rel=\"nofollow noreferrer\">RefCell</a>&lt;T&gt;&gt;</code>, which is a container type that allows you to get a mutable reference to the data with an immutable reference, and do borrow checking <em>at runtime</em>  instead of compile time:</p>\n\n<pre><code>let parent_node: &amp;Rc&lt;RefCell&lt;ProcessNode&gt;&gt; = ...;\n\n// get a mutable reference to the ProcessNode\n// (this is really a RefMut&lt;ProcessNode&gt; wrapper, and this needs to be in scope for as\n// long as the reference is borrowed)\nlet mut parent_node_mut: RefMut&lt;'_, ProcessNode&gt; = parent_node.borrow_mut();\n\n// get mutable reference to children\nlet parent_children: &amp;mut Vec&lt;_&gt; = &amp;mut parent_node_mut.children;\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=e1a110cb7b8761558b9cd9dd6ac0dd02\" rel=\"nofollow noreferrer\">Playground example</a></p>\n\n<p>You can read more about using <code>RefCell</code> with <code>Rc</code> in the documentation <a href=\"https://doc.rust-lang.org/std/cell/index.html#introducing-mutability-inside-of-something-immutable\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 30697, "user_id": 31667, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/082b069c287878a1bd5731f44c8f10e7?s=128&d=identicon&r=PG", "display_name": "viraptor", "link": "https://stackoverflow.com/users/31667/viraptor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 422, "favorite_count": 0, "accepted_answer_id": 55440033, "answer_count": 1, "score": -1, "last_activity_date": 1554028457, "creation_date": 1554026822, "last_edit_date": 1554027304, "question_id": 55439815, "link": "https://stackoverflow.com/questions/55439815/using-vec-in-a-struct", "title": "Using vec in a struct", "body": "<p>I've got a struct holding a vec of similar structs:</p>\n\n<pre><code>struct ProcessNode {\n    ...\n    children: Vec&lt;Rc&lt;ProcessNode&gt;&gt;,\n}\n</code></pre>\n\n<p>Unfortunately when I try to append something into the vec, I'm running into an issue:</p>\n\n<pre><code>let mut parent_node: &amp;mut Rc&lt;ProcessNode&gt; = ...\nlet mut parent_children: &amp;mut Vec&lt;Rc&lt;ProcessNode&gt;&gt; = &amp;mut parent_node.children;\n</code></pre>\n\n<p>Now the <code>parent_node</code> checks out during compilation, but <code>parent_children</code> cannot be referenced that way. Why? And how can I append to a vec field in a structure?</p>\n"}, {"tags": ["memory", "memory-management", "rust", "dealloc"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554042968, "post_id": 55439117, "comment_id": 97599805, "body": "Can you expand on exactly what you mean by &quot;erase content of the string&quot;?"}], "answers": [{"tags": [], "owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "is_accepted": false, "score": 0, "last_activity_date": 1554032947, "last_edit_date": 1554032947, "creation_date": 1554022926, "answer_id": 55439316, "question_id": 55439117, "link": "https://stackoverflow.com/questions/55439117/rust-memory-deallocation-for-string/55439316#55439316", "title": "Rust: memory deallocation for String", "body": "<p>In such simple cases, Rust will automatically free memory when it us no longer needed.</p>\n\n<p>If you want to assign a zero-length string to <code>s</code>, you can use the <a href=\"https://doc.rust-lang.org/std/string/struct.String.html#method.clear\" rel=\"nofollow noreferrer\"><code>clear</code></a> function:</p>\n\n<pre><code>s.clear();\n</code></pre>\n\n<p>This preserves the current capacity (and allocation) of the string.  The alternative you cited,</p>\n\n<pre><code>s = String::new();\n</code></pre>\n\n<p>does not do this.  Both approaches have their uses, depending on the circumstances.  Sometimes, retaining a large string allocation is wasteful (if the string will never grow to this size again).</p>\n"}], "owner": {"reputation": 29, "user_id": 11283893, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d27a8f63db0ae0f89870e77b1ee7d2a?s=128&d=identicon&r=PG&f=1", "display_name": "rustafarian", "link": "https://stackoverflow.com/users/11283893/rustafarian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 252, "favorite_count": 0, "closed_date": 1554040314, "answer_count": 1, "score": -2, "last_activity_date": 1554032947, "creation_date": 1554021177, "last_edit_date": 1554032905, "question_id": 55439117, "link": "https://stackoverflow.com/questions/55439117/rust-memory-deallocation-for-string", "closed_reason": "Duplicate", "title": "Rust: memory deallocation for String", "body": "<p>Do I need to deallocate memory manually in this case:</p>\n\n<pre><code>let mut s = String::new();\n...somecode here...\ns = String::new();\n</code></pre>\n\n<p>and is it the best way to erase content of the string?</p>\n"}, {"tags": ["string", "rust", "integer"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1554015595, "post_id": 55438489, "comment_id": 97594134, "body": "The result of <code>read_line</code> includes the <code>&#39;\\n&#39;</code> character, which is causing the parse error."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1554029232, "post_id": 55438489, "comment_id": 97596644, "body": "You can just call <code>string.clear()</code> to reuse the same string. In this kind of IO code, there is really very little impact to allocating a new <code>String</code> each time though."}], "answers": [{"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": true, "score": 5, "last_activity_date": 1596191954, "last_edit_date": 1596191954, "creation_date": 1554015792, "answer_id": 55438601, "question_id": 55438489, "link": "https://stackoverflow.com/questions/55438489/rust-fail-to-parse-integer-to-string-parseinterror/55438601#55438601", "title": "Rust: fail to parse integer to string, ParseIntError", "body": "<p>The string output from <code>read_line</code> includes a trailing newline character, so you will need to strip that out in order to parse the number. You can do that with <code>trim_end</code> (or just <code>trim</code> to handle leading whitespace too):</p>\n<pre><code>let guess: u8 = guess\n    .trim_end()\n    .parse()\n    .expect(&quot;Wrong number format!&quot;);\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 11283893, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d27a8f63db0ae0f89870e77b1ee7d2a?s=128&d=identicon&r=PG&f=1", "display_name": "rustafarian", "link": "https://stackoverflow.com/users/11283893/rustafarian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1822, "favorite_count": 0, "closed_date": 1554041060, "accepted_answer_id": 55438601, "answer_count": 1, "score": 2, "last_activity_date": 1596191954, "creation_date": 1554014528, "last_edit_date": 1554030418, "question_id": 55438489, "link": "https://stackoverflow.com/questions/55438489/rust-fail-to-parse-integer-to-string-parseinterror", "closed_reason": "Duplicate", "title": "Rust: fail to parse integer to string, ParseIntError", "body": "<p>I just started to experiment with Rust, so I've implemented modified version from Book's \"Guessing game\". Every first time I'm trying to enter the number, program fails to parse integer from string:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Guess the number!\nInput your guess:\n50\nYou guessed 50\n (4 bytes)!\nthread 'main' panicked at 'Wrong number format!: ParseIntError { kind: InvalidDigit }', src\\libcore\\result.rs:997:5\nnote: Run with `RUST_BACKTRACE=1` environment variable to display a backtrace.\nerror: process didn't exit successfully: `target\\release\\experiment.exe` (exit code: 101)\n</code></pre>\n\n<p>Code applied below.</p>\n\n<p>I already tried other integer types.</p>\n\n<pre><code>use std::io;\nuse rand::Rng;\n\nfn main() {\n    println!(\"Guess the number!\\nInput your guess:\");\n\n    let mut guess = String::new();\n\n    let secnum = rand::thread_rng().gen_range(1,101);\n\n    'br: loop { \n        match io::stdin().read_line(&amp;mut guess) {\n            Ok(okay) =&gt; {\n                println!(\"You guessed {} ({} bytes)!\", guess, okay);\n\n                let intguess = guess.parse::&lt;u8&gt;()\n                    .expect(\"Wrong number format!\");\n\n                match secnum.cmp(&amp;intguess) {\n                    std::cmp::Ordering::Less =&gt; {\n                        println!(\"Your guess is smaller!\");\n                    }\n                    std::cmp::Ordering::Greater =&gt; {\n                        println!(\"Your guess is bigger!\");\n                    }\n                    std::cmp::Ordering::Equal =&gt; {\n                        println!(\"You guessed right!\");\n                        break 'br;\n                    } \n                }\n            }\n            Err(erro) =&gt; {\n                println!(\"Failed to read the line: {}!\", erro);\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["rust", "cross-compiling"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1554012620, "post_id": 55438334, "comment_id": 97593643, "body": "Try to attach a debugger, either directly via gdb or remotly by using gdbserver. I&#39;m afraid that this is too less information. E.g. what is the content of your  <code>main.rs</code>?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1554013194, "post_id": 55438334, "comment_id": 97593721, "body": "&quot;EINVAL  An ELF executable had more than one PT_INTERP segment (i.e., tried to name more than one interpreter).&quot; <a href=\"https://linux.die.net/man/2/execve\" rel=\"nofollow noreferrer\">linux.die.net/man/2/execve</a>"}, {"owner": {"reputation": 815, "user_id": 1150292, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ2aZ.jpg?s=128&g=1", "display_name": "Mara Bos", "link": "https://stackoverflow.com/users/1150292/mara-bos"}, "edited": false, "score": 1, "creation_date": 1554566608, "post_id": 55438334, "comment_id": 97803123, "body": "You are using <code>arm-none-eabi-gcc</code>, which is not targetting any operating system. Check <code>readelf --headers ~&#47;r&#47;gw-test</code> and compare it with a binary that does work, like /bin/cat or something."}], "answers": [{"comments": [{"owner": {"reputation": 1125, "user_id": 2824342, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ea84a519cbc8e36fd15ced5da3fd3b6?s=128&d=identicon&r=PG&f=1", "display_name": "Cecile", "link": "https://stackoverflow.com/users/2824342/cecile"}, "edited": false, "score": 0, "creation_date": 1555204958, "post_id": 55621093, "comment_id": 98028674, "body": "Sorry for the delay! I don&#39;t think there is any other project since this board is built by a company for commercial purpose only <a href=\"https://www.develcoproducts.com/products/gateways/\" rel=\"nofollow noreferrer\">develcoproducts.com/products/gateways</a> but I do have a rootfs repo with a bunch of C/C++ programs compiled for it on CI and they work. So I guess I should be able to find something there. Or maybe I can simply open a support ticket and ask them directly."}, {"owner": {"reputation": 1125, "user_id": 2824342, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ea84a519cbc8e36fd15ced5da3fd3b6?s=128&d=identicon&r=PG&f=1", "display_name": "Cecile", "link": "https://stackoverflow.com/users/2824342/cecile"}, "edited": false, "score": 0, "creation_date": 1555211085, "post_id": 55621093, "comment_id": 98029375, "body": "I found a Debian package for the toolchain in the support section of the website (access is restricted). From there I made container to build the app using their linker and the Hello World is now working properly. Thanks a lot for your help and for your time. I&#39;ve learned a lot :)"}, {"owner": {"reputation": 1113, "user_id": 1426842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GU6Z5.jpg?s=128&g=1", "display_name": "Micha\u0142 Fita", "link": "https://stackoverflow.com/users/1426842/micha%c5%82-fita"}, "reply_to_user": {"reputation": 1125, "user_id": 2824342, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ea84a519cbc8e36fd15ced5da3fd3b6?s=128&d=identicon&r=PG&f=1", "display_name": "Cecile", "link": "https://stackoverflow.com/users/2824342/cecile"}, "edited": false, "score": 1, "creation_date": 1555314326, "post_id": 55621093, "comment_id": 98052853, "body": "Glad to hear I could help. BTW. I&#39;d welcome if you can write article about your experience (Medium, LinkedIn, whatever) with guide how to do it right, so embedded programming in Rust could be promoted among community and industry. Thanks."}, {"owner": {"reputation": 1113, "user_id": 1426842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GU6Z5.jpg?s=128&g=1", "display_name": "Micha\u0142 Fita", "link": "https://stackoverflow.com/users/1426842/micha%c5%82-fita"}, "reply_to_user": {"reputation": 1125, "user_id": 2824342, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ea84a519cbc8e36fd15ced5da3fd3b6?s=128&d=identicon&r=PG&f=1", "display_name": "Cecile", "link": "https://stackoverflow.com/users/2824342/cecile"}, "edited": false, "score": 0, "creation_date": 1555315195, "post_id": 55621093, "comment_id": 98053238, "body": "@Cecile Are you user of this development board, or you work for Develco? It&#39;s very interesting product, exactly in the niche I&#39;m working for. It would be nice to put hands on the gateway with ability to develop, but it&#39;s too expensive for me privately :-) Am I correctly understanding, the docker works without a linker change to <code>.cargo&#47;config</code>?"}, {"owner": {"reputation": 1125, "user_id": 2824342, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ea84a519cbc8e36fd15ced5da3fd3b6?s=128&d=identicon&r=PG&f=1", "display_name": "Cecile", "link": "https://stackoverflow.com/users/2824342/cecile"}, "edited": false, "score": 0, "creation_date": 1555442126, "post_id": 55621093, "comment_id": 98110883, "body": "No I work for Charlin in Belgium, we are using IoT to help elders staying at home longer :) we even saved a life once! I&#39;m not too fan of this board as it is all proprietary. I&#39;ve received today a hub &quot;Orbitel&quot;. I haven&#39;t check yet but it looks good. I had to change the linker in the .cargo/config (see the PATH in the Dockerfile) but the compiler is musl. I might write an article on <a href=\"https://blog.cecton.com\" rel=\"nofollow noreferrer\">blog.cecton.com</a> but I don&#39;t usually write technical posts (there are plenty already) but for Rust I will do an exception \ud83e\udd80\u2764\ufe0f"}, {"owner": {"reputation": 1125, "user_id": 2824342, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ea84a519cbc8e36fd15ced5da3fd3b6?s=128&d=identicon&r=PG&f=1", "display_name": "Cecile", "link": "https://stackoverflow.com/users/2824342/cecile"}, "edited": false, "score": 0, "creation_date": 1555444060, "post_id": 55621093, "comment_id": 98111666, "body": "s/Orbitel/Orvibo/gi"}], "tags": [], "owner": {"reputation": 1113, "user_id": 1426842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GU6Z5.jpg?s=128&g=1", "display_name": "Micha\u0142 Fita", "link": "https://stackoverflow.com/users/1426842/micha%c5%82-fita"}, "is_accepted": true, "score": 3, "last_activity_date": 1554929209, "creation_date": 1554929209, "answer_id": 55621093, "question_id": 55438334, "link": "https://stackoverflow.com/questions/55438334/segfault-when-running-cross-compiled-helloworld-to-armv5te-on-a-board-with-cpu-a/55621093#55621093", "title": "Segfault when running cross-compiled HelloWorld to armv5te on a board with CPU arm926ej-s", "body": "<p>My first bet are incompatible ABI. Your binary:</p>\n\n<pre><code>0x5000200, Version5 EABI, soft-float ABI\n</code></pre>\n\n<p>Binaries from your board:</p>\n\n<pre><code>0x5000002, Version5 EABI, &lt;unknown&gt;\n</code></pre>\n\n<p>Next bet, your binary has many sections missing, so it looks like linker issue. Your QEMU environment isn't identical to that used on your target, but I'd expect your QEMU runs bare metal binary. These cannot run under Linux as would not have direct access to hardware &amp; peripherals.</p>\n\n<p>You need to setup your linker to link ELF compatible with environment on your board. I don't have experience with Freescale but looking at any project that cross compiles for this board should lead you to proper linker invocation.</p>\n"}], "owner": {"reputation": 1125, "user_id": 2824342, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0ea84a519cbc8e36fd15ced5da3fd3b6?s=128&d=identicon&r=PG&f=1", "display_name": "Cecile", "link": "https://stackoverflow.com/users/2824342/cecile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 803, "favorite_count": 2, "accepted_answer_id": 55621093, "answer_count": 1, "score": 6, "last_activity_date": 1555211459, "creation_date": 1554012305, "last_edit_date": 1555211459, "question_id": 55438334, "link": "https://stackoverflow.com/questions/55438334/segfault-when-running-cross-compiled-helloworld-to-armv5te-on-a-board-with-cpu-a", "title": "Segfault when running cross-compiled HelloWorld to armv5te on a board with CPU arm926ej-s", "body": "<p>I have a board that has this CPU:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code># uname -a\nLinux gw-9167 4.4.24 #1 Thu Mar 28 17:52:19 UTC 2019 armv5tejl GNU/Linux\n# cat /proc/cpuinfo\nprocessor       : 0\nmodel name      : ARM926EJ-S rev 5 (v5l)\nBogoMIPS        : 226.09\nFeatures        : swp half fastmult edsp java \nCPU implementer : 0x41\nCPU architecture: 5TEJ\nCPU variant     : 0x0\nCPU part        : 0x926\nCPU revision    : 5\n\nHardware        : Freescale MXS (Device Tree)\nRevision        : 0000\nSerial          : 0000000000000000\n</code></pre>\n\n<p>I'm trying to cross-compile a simple Rust hello world to it:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[0] [05:56:25] ~/r/gw-test HEAD &gt; /bin/cat .cargo/config\n[target.armv5te-unknown-linux-gnueabi]\nlinker = \"arm-none-eabi-gcc\"\n\n[target.armv5te-unknown-linux-musleabi]\nlinker = \"arm-none-eabi-gcc\"\n[0] [05:56:34] ~/r/gw-test HEAD &gt; env RUSTFLAGS=\"-C target-cpu=arm926ej-s\" cargo build --target=armv5te-unknown-linux-musleabi --release\n   Compiling gw-test v0.1.0 (/home/cecile/repos/gw-test)\n    Finished release [optimized] target(s) in 0.28s\n[0] [05:56:51] ~/r/gw-test HEAD &gt; qemu-arm -L /usr/arm-linux-gnueabi -cpu arm926 target/armv5te-unknown-linux-musleabi/release/gw-test\nHello, world!\n</code></pre>\n\n<p>When I run it on the board itself, it segfaults immediately:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[0] [05:57:09] ~/r/gw-test HEAD &gt; scp ......\ngw-test                         100% 1781KB 906.4KB/s   00:01    \n[0] [05:58:27] ~/r/gw-test HEAD &gt; ssh ...... /tmp/gw-test\nSegmentation fault\n[139] [05:58:47] ~/r/gw-test HEAD &gt; ssh ..... strace /tmp/gw-test\nexecve(\"/tmp/gw-test\", [\"/tmp/gw-test\"], [/* 9 vars */]) = -1 EINVAL (Invalid argument)\n--- SIGSEGV {si_signo=SIGSEGV, si_code=SI_KERNEL, si_addr=0} ---\n+++ killed by SIGSEGV +++\nSegmentation fault\n</code></pre>\n\n<blockquote>\n  <p>What is the content of your main.rs? </p>\n</blockquote>\n\n<p>Nothing! It's just the default hello world generated by Cargo</p>\n\n<blockquote>\n  <p><code>EINVAL</code> An ELF executable had more than one <code>PT_INTERP</code> segment (i.e., tried to name more than one interpreter).</p>\n</blockquote>\n\n<p>Now that's really weird because I also read in the doc: <em>\"If the executable is a dynamically linked ELF executable, the interpreter named in the <code>PT_INTERP</code> segment is used to load the needed shared libraries.\"</em> and I have compiled with musl. It should be static (at least it says it is when I run ldd from the host machine on it).</p>\n\n<blockquote>\n  <p>Try to attach a debugger, either directly via gdb or remotely by using gdbserver.</p>\n</blockquote>\n\n<p>I understand. I will try to see how to do it remotely as you suggested.</p>\n\n<blockquote>\n  <p>It seems like an error from strace and not from your process.</p>\n</blockquote>\n\n<p>It makes sense.</p>\n\n<blockquote>\n  <p>What happens when you run it without strace? Is there a core dump?</p>\n</blockquote>\n\n<p>It's in the log I already shared.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[0] [05:58:27] ~/r/gw-test HEAD &gt; ssh ...... /tmp/gw-test\nSegmentation fault\n</code></pre>\n\n<blockquote>\n  <p>You are using arm-none-eabi-gcc, which is not targetting any operating system. Check readelf --headers ~/r/gw-test and compare it with a binary that does work, like /bin/cat or something. </p>\n</blockquote>\n\n<p>Here is the output of <code>readelf --headers</code> on the binary I made and on cat:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[0] [08:11:23] ~ &gt; cd ~/repos/gw-test/\n[0] [08:15:26] ~/r/gw-test HEAD &gt; ls\nCargo.lock  Cargo.toml  gw.json  lib-root  resources  src  target\n[0] [08:15:27] ~/r/gw-test HEAD &gt; readelf --headers target/armv5te-unknown-linux-musleabi/release/gw-test\nELF Header:\n  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00\n  Class:                             ELF32\n  Data:                              2's complement, little endian\n  Version:                           1 (current)\n  OS/ABI:                            UNIX - System V\n  ABI Version:                       0\n  Type:                              EXEC (Executable file)\n  Machine:                           ARM\n  Version:                           0x1\n  Entry point address:               0x8278\n  Start of program headers:          52 (bytes into file)\n  Start of section headers:          1822748 (bytes into file)\n  Flags:                             0x5000200, Version5 EABI, soft-float ABI\n  Size of this header:               52 (bytes)\n  Size of program headers:           32 (bytes)\n  Number of program headers:         5\n  Size of section headers:           40 (bytes)\n  Number of section headers:         27\n  Section header string table index: 26\n\nSection Headers:\n  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al\n  [ 0]                   NULL            00000000 000000 000000 00      0   0  0\n  [ 1] .init             PROGBITS        00008000 008000 00000c 00  AX  0   0  4\n  [ 2] .text             PROGBITS        00008010 008010 0281b8 00  AX  0   0  8\n  [ 3] .fini             PROGBITS        000301c8 0301c8 00000c 00  AX  0   0  4\n  [ 4] .rodata           PROGBITS        000301e0 0301e0 005174 00   A  0   0 16\n  [ 5] .ARM.extab        PROGBITS        00035354 035354 000bf4 00   A  0   0  4\n  [ 6] .ARM.exidx        ARM_EXIDX       00035f48 035f48 0009e8 00  AL  2   0  4\n  [ 7] .tdata            PROGBITS        00046930 036930 000018 00 WAT  0   0  8\n  [ 8] .tbss             NOBITS          00046948 036948 000034 00 WAT  0   0  8\n  [ 9] .data.rel.ro      PROGBITS        00046948 036948 000f98 00  WA  0   0  8\n  [10] .got              PROGBITS        000478e0 0378e0 0000cc 04  WA  0   0  4\n  [11] .data             PROGBITS        000479b0 0379b0 0000bc 00  WA  0   0  8\n  [12] .bss              NOBITS          00047a70 037a6c 000a78 00  WA  0   0  8\n  [13] .comment          PROGBITS        00000000 037a6c 00003b 01  MS  0   0  1\n  [14] .debug_aranges    PROGBITS        00000000 037aa8 0012f0 00      0   0  8\n  [15] .debug_info       PROGBITS        00000000 038d98 07d9b8 00      0   0  1\n  [16] .debug_abbrev     PROGBITS        00000000 0b6750 00a574 00      0   0  1\n  [17] .debug_line       PROGBITS        00000000 0c0cc4 04e271 00      0   0  1\n  [18] .debug_frame      PROGBITS        00000000 10ef38 0101f4 00      0   0  4\n  [19] .debug_str        PROGBITS        00000000 11f12c 02bc3f 01  MS  0   0  1\n  [20] .debug_loc        PROGBITS        00000000 14ad6b 015230 00      0   0  1\n  [21] .debug_macinfo    PROGBITS        00000000 15ff9b 000007 00      0   0  1\n  [22] .debug_ranges     PROGBITS        00000000 15ffa8 033418 00      0   0  8\n  [23] .ARM.attributes   ARM_ATTRIBUTES  00000000 1933c0 000031 00      0   0  1\n  [24] .symtab           SYMTAB          00000000 1933f4 01e590 10     25 7245  4\n  [25] .strtab           STRTAB          00000000 1b1984 00b595 00      0   0  1\n  [26] .shstrtab         STRTAB          00000000 1bcf19 000103 00      0   0  1\nKey to Flags:\n  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),\n  L (link order), O (extra OS processing required), G (group), T (TLS),\n  C (compressed), x (unknown), o (OS specific), E (exclude),\n  y (purecode), p (processor specific)\n\nProgram Headers:\n  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align\n  EXIDX          0x035f48 0x00035f48 0x00035f48 0x009e8 0x009e8 R   0x4\n  LOAD           0x000000 0x00000000 0x00000000 0x36930 0x36930 R E 0x10000\n  LOAD           0x036930 0x00046930 0x00046930 0x0113c 0x01bb8 RW  0x10000\n  TLS            0x036930 0x00046930 0x00046930 0x00018 0x0004c R   0x8\n  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x10\n\n Section to Segment mapping:\n  Segment Sections...\n   00     .ARM.exidx\n   01     .init .text .fini .rodata .ARM.extab .ARM.exidx\n   02     .tdata .data.rel.ro .got .data .bss\n   03     .tdata .tbss\n   04\n[127] [08:19:01] ~/r/gw-test HEAD &gt; scp -r -i ~/Downloads/hub_keys/sshKeys/0200000100009167 root@gw-9167.lan:/bin/cat ./\ncat                                                                                                                                                                                                                                                         100%  651KB 581.0KB/s   00:01\n[0] [08:19:18] ~/r/gw-test HEAD &gt; stat cat\n  File: cat\n  Size: 666788          Blocks: 1304       IO Block: 4096   regular file\nDevice: 18h/24d Inode: 4034474     Links: 1\nAccess: (0755/-rwxr-xr-x)  Uid: ( 1000/  cecile)   Gid: ( 1000/  cecile)\nAccess: 2019-04-07 10:19:17.131861726 +0200\nModify: 2019-04-07 10:19:18.251842664 +0200\nChange: 2019-04-07 10:19:18.251842664 +0200\n Birth: 2019-04-07 10:19:17.131861726 +0200\n[0] [08:19:22] ~/r/gw-test HEAD &gt; readelf --headers cat\nELF Header:\n  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00\n  Class:                             ELF32\n  Data:                              2's complement, little endian\n  Version:                           1 (current)\n  OS/ABI:                            UNIX - System V\n  ABI Version:                       0\n  Type:                              EXEC (Executable file)\n  Machine:                           ARM\n  Version:                           0x1\n  Entry point address:               0xc914\n  Start of program headers:          52 (bytes into file)\n  Start of section headers:          665748 (bytes into file)\n  Flags:                             0x5000002, Version5 EABI, &lt;unknown&gt;\n  Size of this header:               52 (bytes)\n  Size of program headers:           32 (bytes)\n  Number of program headers:         8\n  Size of section headers:           40 (bytes)\n  Number of section headers:         26\n  Section header string table index: 25\n\nSection Headers:\n  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al\n  [ 0]                   NULL            00000000 000000 000000 00      0   0  0\n  [ 1] .interp           PROGBITS        00008134 000134 000013 00   A  0   0  1\n  [ 2] .note.ABI-tag     NOTE            00008148 000148 000020 00   A  0   0  4\n  [ 3] .hash             HASH            00008168 000168 000990 04   A  4   0  4\n  [ 4] .dynsym           DYNSYM          00008af8 000af8 0015b0 10   A  5   1  4\n  [ 5] .dynstr           STRTAB          0000a0a8 0020a8 000b33 00   A  0   0  1\n  [ 6] .gnu.version      VERSYM          0000abdc 002bdc 0002b6 02   A  4   0  2\n  [ 7] .gnu.version_r    VERNEED         0000ae94 002e94 000020 00   A  5   1  4\n  [ 8] .rel.dyn          REL             0000aeb4 002eb4 000050 08   A  4   0  4\n  [ 9] .rel.plt          REL             0000af04 002f04 000a60 08   A  4  11  4\n  [10] .init             PROGBITS        0000b964 003964 00000c 00  AX  0   0  4\n  [11] .plt              PROGBITS        0000b970 003970 000fa4 04  AX  0   0  4\n  [12] .text             PROGBITS        0000c914 004914 07dcd8 00  AX  0   0  4\n  [13] .fini             PROGBITS        0008a5ec 0825ec 000008 00  AX  0   0  4\n  [14] .rodata           PROGBITS        0008a5f8 0825f8 01f208 00   A  0   0  8\n  [15] .ARM.exidx        ARM_EXIDX       000a9800 0a1800 000008 00  AL 12   0  4\n  [16] .eh_frame         PROGBITS        000a9808 0a1808 000004 00   A  0   0  4\n  [17] .init_array       INIT_ARRAY      000b2000 0a2000 000004 00  WA  0   0  4\n  [18] .fini_array       FINI_ARRAY      000b2004 0a2004 000004 00  WA  0   0  4\n  [19] .jcr              PROGBITS        000b2008 0a2008 000004 00  WA  0   0  4\n  [20] .dynamic          DYNAMIC         000b200c 0a200c 0000e8 08  WA  5   0  4\n  [21] .got              PROGBITS        000b20f4 0a20f4 000544 04  WA  0   0  4\n  [22] .data             PROGBITS        000b2638 0a2638 00014e 00  WA  0   0  4\n  [23] .bss              NOBITS          000b2788 0a2786 0022c0 00  WA  0   0  8\n  [24] .ARM.attributes   ARM_ATTRIBUTES  00000000 0a2786 000034 00      0   0  1\n  [25] .shstrtab         STRTAB          00000000 0a27ba 0000da 00      0   0  1\nKey to Flags:\n  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),\n  L (link order), O (extra OS processing required), G (group), T (TLS),\n  C (compressed), x (unknown), o (OS specific), E (exclude),\n  y (purecode), p (processor specific)\n\nProgram Headers:\n  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align\n  EXIDX          0x0a1800 0x000a9800 0x000a9800 0x00008 0x00008 R   0x4\n  PHDR           0x000034 0x00008034 0x00008034 0x00100 0x00100 R E 0x4\n  INTERP         0x000134 0x00008134 0x00008134 0x00013 0x00013 R   0x1\n      [Requesting program interpreter: /lib/ld-linux.so.3]\n  LOAD           0x000000 0x00008000 0x00008000 0xa180c 0xa180c R E 0x8000\n  LOAD           0x0a2000 0x000b2000 0x000b2000 0x00786 0x02a48 RW  0x8000\n  DYNAMIC        0x0a200c 0x000b200c 0x000b200c 0x000e8 0x000e8 RW  0x4\n  NOTE           0x000148 0x00008148 0x00008148 0x00020 0x00020 R   0x4\n  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x4\n\n Section to Segment mapping:\n  Segment Sections...\n   00     .ARM.exidx\n   01\n   02     .interp\n   03     .interp .note.ABI-tag .hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt .text .fini .rodata .ARM.exidx .eh_frame\n   04     .init_array .fini_array .jcr .dynamic .got .data .bss\n   05     .dynamic\n   06     .note.ABI-tag\n   07\n[0] [08:19:32] ~/r/gw-test HEAD &gt; /usr/arm-none-eabi/bin/readelf --headers cat\nELF Header:\n  Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00\n  Class:                             ELF32\n  Data:                              2's complement, little endian\n  Version:                           1 (current)\n  OS/ABI:                            UNIX - System V\n  ABI Version:                       0\n  Type:                              EXEC (Executable file)\n  Machine:                           ARM\n  Version:                           0x1\n  Entry point address:               0xc914\n  Start of program headers:          52 (bytes into file)\n  Start of section headers:          665748 (bytes into file)\n  Flags:                             0x5000002, Version5 EABI, &lt;unknown&gt;\n  Size of this header:               52 (bytes)\n  Size of program headers:           32 (bytes)\n  Number of program headers:         8\n  Size of section headers:           40 (bytes)\n  Number of section headers:         26\n  Section header string table index: 25\n\nSection Headers:\n  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al\n  [ 0]                   NULL            00000000 000000 000000 00      0   0  0\n  [ 1] .interp           PROGBITS        00008134 000134 000013 00   A  0   0  1\n  [ 2] .note.ABI-tag     NOTE            00008148 000148 000020 00   A  0   0  4\n  [ 3] .hash             HASH            00008168 000168 000990 04   A  4   0  4\n  [ 4] .dynsym           DYNSYM          00008af8 000af8 0015b0 10   A  5   1  4\n  [ 5] .dynstr           STRTAB          0000a0a8 0020a8 000b33 00   A  0   0  1\n  [ 6] .gnu.version      VERSYM          0000abdc 002bdc 0002b6 02   A  4   0  2\n  [ 7] .gnu.version_r    VERNEED         0000ae94 002e94 000020 00   A  5   1  4\n  [ 8] .rel.dyn          REL             0000aeb4 002eb4 000050 08   A  4   0  4\n  [ 9] .rel.plt          REL             0000af04 002f04 000a60 08   A  4  11  4\n  [10] .init             PROGBITS        0000b964 003964 00000c 00  AX  0   0  4\n  [11] .plt              PROGBITS        0000b970 003970 000fa4 04  AX  0   0  4\n  [12] .text             PROGBITS        0000c914 004914 07dcd8 00  AX  0   0  4\n  [13] .fini             PROGBITS        0008a5ec 0825ec 000008 00  AX  0   0  4\n  [14] .rodata           PROGBITS        0008a5f8 0825f8 01f208 00   A  0   0  8\n  [15] .ARM.exidx        ARM_EXIDX       000a9800 0a1800 000008 00  AL 12   0  4\n  [16] .eh_frame         PROGBITS        000a9808 0a1808 000004 00   A  0   0  4\n  [17] .init_array       INIT_ARRAY      000b2000 0a2000 000004 00  WA  0   0  4\n  [18] .fini_array       FINI_ARRAY      000b2004 0a2004 000004 00  WA  0   0  4\n  [19] .jcr              PROGBITS        000b2008 0a2008 000004 00  WA  0   0  4\n  [20] .dynamic          DYNAMIC         000b200c 0a200c 0000e8 08  WA  5   0  4\n  [21] .got              PROGBITS        000b20f4 0a20f4 000544 04  WA  0   0  4\n  [22] .data             PROGBITS        000b2638 0a2638 00014e 00  WA  0   0  4\n  [23] .bss              NOBITS          000b2788 0a2786 0022c0 00  WA  0   0  8\n  [24] .ARM.attributes   ARM_ATTRIBUTES  00000000 0a2786 000034 00      0   0  1\n  [25] .shstrtab         STRTAB          00000000 0a27ba 0000da 00      0   0  1\nKey to Flags:\n  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),\n  L (link order), O (extra OS processing required), G (group), T (TLS),\n  C (compressed), x (unknown), o (OS specific), E (exclude),\n  y (purecode), p (processor specific)\n\nProgram Headers:\n  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align\n  EXIDX          0x0a1800 0x000a9800 0x000a9800 0x00008 0x00008 R   0x4\n  PHDR           0x000034 0x00008034 0x00008034 0x00100 0x00100 R E 0x4\n  INTERP         0x000134 0x00008134 0x00008134 0x00013 0x00013 R   0x1\n      [Requesting program interpreter: /lib/ld-linux.so.3]\n  LOAD           0x000000 0x00008000 0x00008000 0xa180c 0xa180c R E 0x8000\n  LOAD           0x0a2000 0x000b2000 0x000b2000 0x00786 0x02a48 RW  0x8000\n  DYNAMIC        0x0a200c 0x000b200c 0x000b200c 0x000e8 0x000e8 RW  0x4\n  NOTE           0x000148 0x00008148 0x00008148 0x00020 0x00020 R   0x4\n  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x4\n\n Section to Segment mapping:\n  Segment Sections...\n   00     .ARM.exidx\n   01\n   02     .interp\n   03     .interp .note.ABI-tag .hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt .text .fini .rodata .ARM.exidx .eh_frame\n   04     .init_array .fini_array .jcr .dynamic .got .data .bss\n   05     .dynamic\n   06     .note.ABI-tag\n   07\n</code></pre>\n\n<hr>\n\n<h1>Solution:</h1>\n\n<p>I made this Dockerfile:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>FROM buildpack-deps:xenial\n\nRUN dpkg --add-architecture i386 &amp;&amp; \\\n    apt-get update &amp;&amp; \\\n    apt-get install -y --no-install-recommends \\\n        apt-utils build-essential sudo libssl-dev \\\n        subversion wget cpio python unzip rsync bc libncurses-dev \\\n        libc6:i386 libncurses5:i386 libstdc++6:i386 ca-certificates \\\n        ant ant-optional bison curl flex fusesmb\n\nCOPY ./dp-mgw-toolchain_1.6_i386.deb ./\nRUN dpkg -i dp-mgw-toolchain_1.6_i386.deb\n\nRUN curl https://sh.rustup.rs -sSf | bash -s -- -y\n\nRUN echo '. ~/.cargo/env' &gt;&gt; ~/.bashrc\n\nRUN . ~/.cargo/env &amp;&amp; \\\n    rustup target add armv5te-unknown-linux-musleabi\n\nENV PATH=/opt/develco-products/buildroot-toolchain-multigateway-1.6/host/usr/bin:$PATH\nENV RUSTFLAGS=\"-C target-cpu=arm926ej-s\"\n\nRUN cargo build --target=armv5te-unknown-linux-musleabi --release\n</code></pre>\n\n<p>The deb file is actually the toolchain provided by the manufacturer. Now I'm using the correct linker and it runs properly on the board.</p>\n"}, {"tags": ["string", "rust", "char"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 2, "creation_date": 1554002694, "post_id": 55437383, "comment_id": 97592343, "body": "<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=03dec7e73c7568268666abae21c30d63\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>, did you read the book ?"}], "answers": [{"tags": [], "owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "is_accepted": true, "score": 1, "last_activity_date": 1554002928, "creation_date": 1554002928, "answer_id": 55437625, "question_id": 55437383, "link": "https://stackoverflow.com/questions/55437383/why-does-a-byte-that-has-been-cast-to-a-char-not-seem-to-have-a-proper-type-when/55437625#55437625", "title": "Why does a byte that has been cast to a char not seem to have a proper type when pushing to a string?", "body": "<p>This is because <a href=\"https://doc.rust-lang.org/std/string/struct.String.html#method.push\" rel=\"nofollow noreferrer\"><code>push</code></a> on String type returns nothing and ergo returns a <code>()</code></p>\n\n<p>Change your code to:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>// `-&gt;` specifies return type\nfn encode_as_chars( mut integer: u128 ) -&gt; String {\n    let alphabet = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\".as_bytes();\n    let base: u128 = 62;\n    let mut encoded: String = \"\".to_string(); // you need to initialize every variable in Rust\n\n    while integer != 0 {\n        encoded.push( alphabet[(integer % base) as usize] as char );\n        integer /= base;\n    }\n\n    encoded // return encoded\n}\n</code></pre>\n"}], "owner": {"reputation": 2837, "user_id": 1427563, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sdqnK.png?s=128&g=1", "display_name": "jla", "link": "https://stackoverflow.com/users/1427563/jla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 55437625, "answer_count": 1, "score": 0, "last_activity_date": 1554040810, "creation_date": 1553999561, "last_edit_date": 1554040810, "question_id": 55437383, "link": "https://stackoverflow.com/questions/55437383/why-does-a-byte-that-has-been-cast-to-a-char-not-seem-to-have-a-proper-type-when", "title": "Why does a byte that has been cast to a char not seem to have a proper type when pushing to a string?", "body": "<p>Using <a href=\"https://stackoverflow.com/a/2549514/1427563\">this</a> answer I'm attempting to write a Rust function that converts a 128 bit integer into a base 62 number.</p>\n\n<pre><code>fn encode_as_chars(mut integer: u128) {\n    let alphabet = \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\".as_bytes();\n    let base: u128 = 62;\n    let mut encoded: String;\n\n    while integer != 0 {\n        encoded = encoded.push(alphabet[(integer % base) as usize] as char);\n        integer /= base;\n    }\n    encoded;\n}\n</code></pre>\n\n<p>I access a character in the alphabet by index using <code>as_bytes()</code> and cast the byte back to a char, intending to push the char to the encoded string with <code>String::push</code>. However the compiler complains about this, returning the error</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n --&gt; src/lib.rs:7:19\n  |\n7 |         encoded = encoded.push(alphabet[(integer % base) as usize] as char);\n  |                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected struct `std::string::String`, found ()\n  |\n  = note: expected type `std::string::String`\n             found type `()`\n</code></pre>\n\n<p>I tried to explicitly allocate memory to the char by using <code>to_owned()</code>:</p>\n\n<pre><code>let character: char = (alphabet[(integer % base) as usize] as char).to_owned();\nencoded = encoded.push( character );\n</code></pre>\n\n<p>but this returned the same error.</p>\n\n<p>Why does a byte that has been cast to a char not seem to have a proper type when pushing to a string?</p>\n"}, {"tags": ["multithreading", "rust"], "answers": [{"tags": [], "owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "is_accepted": false, "score": 1, "last_activity_date": 1553998422, "last_edit_date": 1553998422, "creation_date": 1553983505, "answer_id": 55436049, "question_id": 55435456, "link": "https://stackoverflow.com/questions/55435456/how-to-share-heap-allocated-vector-of-boxed-trait-type-across-threads/55436049#55436049", "title": "How to share heap allocated vector of boxed trait type across threads", "body": "<p>If your Material trait is defined like:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait Material{\n...\n}\n</code></pre>\n\n<p>Then, define it like:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>trait Material: Send + Sync{\n...\n}\n</code></pre>\n\n<p>Here <code>trait Material: Send + Sync</code> means that every type that implements Material must also implement Send and Sync</p>\n\n<blockquote>\n  <p>material::Material can't be shared safely but why not a Arc pointer to it?</p>\n</blockquote>\n\n<p>You have to let the compiler know that Box happens to hold something with the trait that happens to fulfill <code>Send</code> and <code>Sync</code></p>\n\n<h1>OR</h1>\n\n<p>You can just change the declaration of <code>materials</code> to (For the same reason as above):</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let mut materials: Vec&lt;Box&lt;Material + Send + Sync&gt;&gt; = Vec::new();\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 6039916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ae48f83626f2cbfb2c5f4dfa55b1ca0?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Hadlaw", "link": "https://stackoverflow.com/users/6039916/tom-hadlaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "closed_date": 1554041217, "answer_count": 1, "score": 1, "last_activity_date": 1554021275, "creation_date": 1553978246, "last_edit_date": 1554021275, "question_id": 55435456, "link": "https://stackoverflow.com/questions/55435456/how-to-share-heap-allocated-vector-of-boxed-trait-type-across-threads", "closed_reason": "Duplicate", "title": "How to share heap allocated vector of boxed trait type across threads", "body": "<p>So my current use case is I need to:</p>\n\n<ol>\n<li>Create a <code>Vec&lt;Box&lt;Material&gt;&gt;</code> where Material is a trait.</li>\n<li>Push boxed structs that impl Material into this Vec.</li>\n<li>Share a read only version of this vec to multiple threads.</li>\n</ol>\n\n<p>My current approach is to use an Arc pointer for the Vec&lt;..> and then clone it for each thread.</p>\n\n<p>for example:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>let mut materials: Vec&lt;Box&lt;Material&gt;&gt; = Vec::new();\n// ... push stuff into materials\nlet materials = Arc::new(materials);\nlet mat_cloned = materials.clone();\n// pool is a threadpool\npool.execute(move|| {\n    // do read stuff with mat_cloned.\n}\n</code></pre>\n\n<p>However I get the compiler error: <code>dyn 'materials::Material' cannot be shared between threads safely</code></p>\n\n<p>My understanding of it is that:</p>\n\n<ol>\n<li><p>Materials is a heap allocated vector of boxed pointers to various Material implementations.</p></li>\n<li><p>I then wrap with with an Arc type which is an atomically reference counted read-only pointer.</p></li>\n<li><p>I should be able to share this pointer with threads safely?</p></li>\n</ol>\n\n<p>material::Material can't be shared safely but why not a Arc pointer to it?</p>\n"}, {"tags": ["rust", "statistics", "distribution"], "comments": [{"owner": {"reputation": 50347, "user_id": 1763356, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/zGWG9.png?s=128&g=1", "display_name": "Veedrac", "link": "https://stackoverflow.com/users/1763356/veedrac"}, "edited": false, "score": 0, "creation_date": 1553968529, "post_id": 55433636, "comment_id": 97585804, "body": "You&#39;ll need a package, just search for distributions. An example is <a href=\"https://docs.rs/statrs/0.10.0/statrs/distribution/index.html\" rel=\"nofollow noreferrer\"><code>statrs::distribution</code></a>."}, {"owner": {"reputation": 1962, "user_id": 982364, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8f7fcd81979b29f5fd4ddf155987e588?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/982364/tom"}, "reply_to_user": {"reputation": 50347, "user_id": 1763356, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/zGWG9.png?s=128&g=1", "display_name": "Veedrac", "link": "https://stackoverflow.com/users/1763356/veedrac"}, "edited": false, "score": 0, "creation_date": 1553969245, "post_id": 55433636, "comment_id": 97586030, "body": "I searched but didn&#39;t find that one. Thanks for the link!"}, {"owner": {"reputation": 28567, "user_id": 815724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a514cd424088a3ba3012f5d77f2e334?s=128&d=identicon&r=PG", "display_name": "Peter O.", "link": "https://stackoverflow.com/users/815724/peter-o"}, "edited": false, "score": 0, "creation_date": 1556219577, "post_id": 55433636, "comment_id": 98373711, "body": "I assume you mean &quot;non-uniform&quot;, not &quot;non-random&quot;."}], "owner": {"reputation": 1962, "user_id": 982364, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8f7fcd81979b29f5fd4ddf155987e588?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/982364/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556219560, "creation_date": 1553964620, "last_edit_date": 1556219560, "question_id": 55433636, "link": "https://stackoverflow.com/questions/55433636/where-i-can-find-rust-functions-to-get-values-from-non-uniform-probability-distr", "title": "Where I can find Rust functions to get values from non-uniform probability distributions?", "body": "<p>I'm aware of <code>rand::distributions</code>, but all I can find is <strong>random</strong> sampling.</p>\n\n<p>I also want to display the distribution curve to the user, especially for those that depend on shape parameters like the Beta distribution, but I can't find a function to get an arbitrary value.</p>\n\n<p>Essentially, I want to plot a graph of the distribution by doing something like</p>\n\n<pre><code>for x in 1..100 {\n   let y = beta.sample(x as f64 / 100.0);\n   // add x/y to graph\n}\n</code></pre>\n\n<p>Where can I find the proper function to get these values? I've searched both the Rust rand book and the repository and can't figure it out.</p>\n"}, {"tags": ["shell", "rust"], "answers": [{"tags": [], "owner": {"reputation": 1412, "user_id": 6346531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75aa9d2cb0f4e6bdf16e80bb06d5f8f1?s=128&d=identicon&r=PG", "display_name": "aksh1618", "link": "https://stackoverflow.com/users/6346531/aksh1618"}, "is_accepted": true, "score": 4, "last_activity_date": 1592129154, "last_edit_date": 1592129154, "creation_date": 1553956493, "answer_id": 55432461, "question_id": 55432460, "link": "https://stackoverflow.com/questions/55432460/how-do-i-compile-and-run-a-rust-file-on-save-using-entr/55432461#55432461", "title": "How do I compile and run a Rust file on save using entr?", "body": "<p>You need the <code>-s</code> argument, which uses your shell to evaluate the command:</p>\n\n<blockquote>\n  <pre class=\"lang-none prettyprint-override\"><code>-s  Evaluate the first argument using the\n    interpreter specified by the SHELL\n    environment variable.  When this flag\n    is set, the name of the shell and exit\n    code is printed after each invocation.\n</code></pre>\n</blockquote>\n\n<p>The correct command is:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>ls test.rs | entr -cs \"rustc test.rs &amp;&amp; ./test\"\n</code></pre>\n\n<p>As a bonus, it also prints the exit code for each invocation!</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Hello World!\nzsh returned exit code 0\n</code></pre>\n\n<p>Similarly for cargo, on any rust file change saved under <code>src</code> directory:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>ls src/**/*.rs | entr -cs \"cargo run\"\n</code></pre>\n"}], "owner": {"reputation": 1412, "user_id": 6346531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75aa9d2cb0f4e6bdf16e80bb06d5f8f1?s=128&d=identicon&r=PG", "display_name": "aksh1618", "link": "https://stackoverflow.com/users/6346531/aksh1618"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 55432461, "answer_count": 1, "score": 3, "last_activity_date": 1592129154, "creation_date": 1553956493, "last_edit_date": 1553956654, "question_id": 55432460, "link": "https://stackoverflow.com/questions/55432460/how-do-i-compile-and-run-a-rust-file-on-save-using-entr", "title": "How do I compile and run a Rust file on save using entr?", "body": "<p>How do I use <a href=\"http://eradman.com/entrproject/\" rel=\"nofollow noreferrer\">entr</a> to automatically compile and run a test Rust file on every save? I tried </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>ls test.rs | entr -c \"rustc test.rs &amp;&amp; ./test\"\n</code></pre>\n\n<p>But it gives the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>entr: exec rustc test.rs &amp;&amp; ./test: No such file or directory\n</code></pre>\n"}, {"tags": ["rust", "iterator"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1553931047, "post_id": 55428465, "comment_id": 97576578, "body": "I think the best you can do is <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=5ecde66452279b0f186383d8ec61ac33\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>, doesn&#39;t match the expected output because I miss calculated when I comment AR&#39;s answer"}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1553956084, "post_id": 55432130, "comment_id": 97582496, "body": "@A.R I&#39;m afraid I don&#39;t understand your question. Fundamentally, the OP wants to start with an iterator of references and add a new reference. That much is fine, but as soon as you return from the function, the reference to the local value would be invalidated and the compiler will prevent it. Moving the code around won&#39;t help as long as you try to return a reference to a local variable."}, {"owner": {"reputation": 184, "user_id": 11280382, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3D2ug_waPjY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcOnVtXe5E1IEI5RfFdAr4YkH621g/mo/photo.jpg?sz=128", "display_name": "Kazuhiro Kobayashi", "link": "https://stackoverflow.com/users/11280382/kazuhiro-kobayashi"}, "edited": false, "score": 0, "creation_date": 1554040136, "post_id": 55432130, "comment_id": 97599068, "body": "I found that what I wanted at first is an iterator which returns references to data owned by itself. As long as I read posts like <a href=\"https://medium.com/@jordan_98525/reference-iterators-in-rust-5603a51b5192\" rel=\"nofollow noreferrer\">this</a> or <a href=\"https://stackoverflow.com/questions/30422177/how-do-i-write-an-iterator-that-returns-references-to-itself\">this</a>, it seems impossible. This answer solved my problem, and for my real project, <code>Cow</code> fits best."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1554041355, "post_id": 55432130, "comment_id": 97599370, "body": "Yes, it is impossible to use <code>Iterator</code> to return references to yourself. Your question cannot do that anyway because the function&#39;s variables do not exist after the function exits. This answer sidesteps that by returning ownership of the variables <i>to the iterator</i>."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 2, "last_activity_date": 1553959424, "last_edit_date": 1553959424, "creation_date": 1553954050, "answer_id": 55432130, "question_id": 55428465, "link": "https://stackoverflow.com/questions/55428465/can-i-extend-an-iterator-with-values-created-inside-a-function/55432130#55432130", "title": "Can I extend an iterator with values created inside a function?", "body": "<blockquote>\n  <p>Can I extend an iterator with values created inside a function?</p>\n</blockquote>\n\n<p>Yes:</p>\n\n<pre><code>fn example&lt;'a&gt;(input: impl Iterator&lt;Item = i32&gt; + 'a) -&gt; impl Iterator&lt;Item = i32&gt; + 'a {\n    Some(42).into_iter().chain(input).chain(Some(99))\n}\n\nfn main() {\n    for i in example(vec![1, 2, 3].into_iter()) {\n        println!(\"{}\", i);\n    }\n}\n</code></pre>\n\n<blockquote>\n  <p>I'm looking for a way to turn <code>once(head)</code> into an iterator of <code>&amp;A</code></p>\n</blockquote>\n\n<p>Take a reference to the value:</p>\n\n<pre><code>iter::once(&amp;head)\n</code></pre>\n\n<blockquote>\n  <p>Is it possible to get [this specific code] to work?</p>\n</blockquote>\n\n<p>No. The compiler will even tell you that:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0515]: cannot return value referencing local variable `head`\n  --&gt; src/lib.rs:10:5\n   |\n10 |       iter::once(&amp;head).chain(xs.iter()).scan(accum, |accum, x| {\n   |       ^          ----- `head` is borrowed here\n   |  _____|\n   | |\n11 | |         *accum += x.0;\n12 | |         Some(B(*accum))\n13 | |     })\n   | |______^ returns a value referencing data owned by the current function\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/32682876/155423\">Is there any way to return a reference to a variable created in a function?</a></li>\n</ul>\n\n<blockquote>\n  <p>Is it possible to get [something close to this code] to work?</p>\n</blockquote>\n\n<p>Maybe. Since <code>scan</code> starts with the accumulator value, you can just use that instead of sticking it onto the iterator:</p>\n\n<pre><code>fn scan_something&lt;'a&gt;(xs: &amp;'a [A]) -&gt; impl Iterator&lt;Item = B&gt; + 'a {\n    xs.iter().scan(xs.len(), |accum, x| {\n        *accum += x.0;\n        Some(B(*accum))\n    })\n}\n</code></pre>\n\n<p>This would mean that the resulting iterator has one less item. If that's acceptable depends on your usage.</p>\n\n<p>A more complicated solution is to have an enum that represents either a borrowed value or an owned value. You can then create an iterator of these enums from the input <em>and</em> the local value. The ownership of the local value is transferred to the returned iterator:</p>\n\n<pre><code>struct A(usize);\nstruct B(usize);\n\nuse std::iter;\n\n// `A` doesn't implement `Clone`; if it did, use `Cow`\nenum OwnedOrBorrowed&lt;'a, T&gt; {\n    Owned(T),\n    Borrowed(&amp;'a T),\n}\n\nimpl&lt;'a, T&gt; std::ops::Deref for OwnedOrBorrowed&lt;'a, T&gt; {\n    type Target = T;\n    fn deref(&amp;self) -&gt; &amp;T {\n        match self {\n            OwnedOrBorrowed::Owned(t) =&gt; t,\n            OwnedOrBorrowed::Borrowed(t) =&gt; t,\n        }\n    }\n}\n\nfn scan_something&lt;'a&gt;(xs: &amp;'a [A]) -&gt; impl Iterator&lt;Item = B&gt; + 'a {\n    let accum = 0;\n    let head = OwnedOrBorrowed::Owned(A(xs.len()));\n\n    let borrowed = xs.iter().map(OwnedOrBorrowed::Borrowed);\n\n    iter::once(head).chain(borrowed).scan(accum, |accum, x| {\n        *accum += x.0;\n        Some(B(*accum))\n    })\n}\n</code></pre>\n\n<p>This isn't free \u2014 every invocation of <code>scan</code>'s closure will perform conditional logic to test if the value is owned or borrowed.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/36706429/155423\">Is it possible to return either a borrowed or owned type in Rust?</a></li>\n<li><a href=\"https://stackoverflow.com/q/41146267/155423\">How to abstract over a reference to a value or a value itself?</a></li>\n</ul>\n"}], "owner": {"reputation": 184, "user_id": 11280382, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3D2ug_waPjY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcOnVtXe5E1IEI5RfFdAr4YkH621g/mo/photo.jpg?sz=128", "display_name": "Kazuhiro Kobayashi", "link": "https://stackoverflow.com/users/11280382/kazuhiro-kobayashi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 55432130, "answer_count": 1, "score": 1, "last_activity_date": 1553959424, "creation_date": 1553923581, "last_edit_date": 1553954109, "question_id": 55428465, "link": "https://stackoverflow.com/questions/55428465/can-i-extend-an-iterator-with-values-created-inside-a-function", "title": "Can I extend an iterator with values created inside a function?", "body": "<p>I have a <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=adcf4f24b49b69fbc6bd24fb431e29dd\" rel=\"nofollow noreferrer\">program</a> which performs a <code>scan</code> operation on its argument:</p>\n\n<pre><code>struct A(usize);\nstruct B(usize);\n\nfn scan_something&lt;'a&gt;(xs: &amp;'a [A]) -&gt; impl Iterator&lt;Item = B&gt; + 'a {\n    let accum = 0;\n\n    xs.iter().scan(accum, |accum, x| {\n        *accum += x.0;\n        Some(B(*accum))\n    })\n}\n</code></pre>\n\n<p>I want to extend the iterator with a few values generated inside the function:</p>\n\n<pre><code>fn scan_something&lt;'a&gt;(xs: &amp;'a [A]) -&gt; impl Iterator&lt;Item = B&gt; + 'a {\n    let accum = 0;\n    let head: A = A(xs.len());\n\n    use std::iter::once;\n    once(head).chain(xs.iter()).scan(accum, |accum, x| {\n        *accum += x.0;\n        Some(B(*accum))\n    })\n}\n</code></pre>\n\n<p>This doesn't compile because <code>once(head)</code> is an iterator of <code>A</code>, while <code>xs.iter()</code> is an iterator of <code>&amp;A</code>.</p>\n\n<p>I can implement <code>Clone</code> for <code>A</code> and put<code>.cloned()</code> after <code>xs.iter()</code> to fix this, but I don't want to clone the entire <code>xs</code> because it can be very long and <code>A</code> in the actual program is not cheap to clone.</p>\n\n<p>I'm looking for a way to turn <code>once(head)</code> into an iterator of <code>&amp;A</code>, but cannot find any method.</p>\n\n<p>Is it possible to get it to work?</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 391, "user_id": 11134855, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UDLPa.jpg?s=128&g=1", "display_name": "Ian Preglo", "link": "https://stackoverflow.com/users/11134855/ian-preglo"}, "is_accepted": true, "score": 3, "last_activity_date": 1553972542, "last_edit_date": 1553972542, "creation_date": 1553909668, "answer_id": 55427358, "question_id": 55427244, "link": "https://stackoverflow.com/questions/55427244/why-is-a-return-type-of-expected-even-though-it-is-set-to-bool/55427358#55427358", "title": "Why is a return type of () expected even though it is set to bool?", "body": "<p>The issue is because you have an early return and not placing the <code>return</code> keyword before it, as shown below:</p>\n\n<pre><code>if digits[i] != digits[digits.len() - i] {\n    return false\n}\n</code></pre>\n\n<p>This is because all functions evaluate the last line as a return value. If you want to return before going through the last line, you should add the <code>return</code> keyword.</p>\n\n<p>An additional input here is to refactor your code so that it only returns once:</p>\n\n<pre><code>pub fn is_palindrome(num: u64) -&gt; bool {\n    let mut digits = Vec::new();\n    let mut temp = num;\n    let mut retval = true;\n    loop {\n        digits.push(temp % 10);\n        temp /= 10;\n        if temp == 0 {\n            break;\n        }\n    }\n    for i in 0..digits.len() / 2 {\n        if digits[i] != digits[digits.len() - i] {\n            retval = false; // you might want to put a break here so that it exits the loop after finding the first issue\n        }\n    }\n    retval\n}\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 4278695, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000658517317/picture?type=large", "display_name": "Ch\u0142op Z Lasu", "link": "https://stackoverflow.com/users/4278695/ch%c5%82op-z-lasu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 0, "accepted_answer_id": 55427358, "answer_count": 1, "score": 3, "last_activity_date": 1553972542, "creation_date": 1553908413, "last_edit_date": 1553972475, "question_id": 55427244, "link": "https://stackoverflow.com/questions/55427244/why-is-a-return-type-of-expected-even-though-it-is-set-to-bool", "title": "Why is a return type of () expected even though it is set to bool?", "body": "<p>In a function that is declared to return <code>bool</code>:</p>\n\n<pre><code>pub fn is_palindrome(num: u64) -&gt; bool {\n    let mut digits = Vec::new();\n    let mut temp = num;\n    loop {\n        digits.push(temp % 10);\n        temp /= 10;\n        if temp == 0 {\n            break;\n        }\n    }\n    for i in 0..digits.len() / 2 {\n        if digits[i] != digits[digits.len() - i] {\n            false // HERE I GET THE ERROR !!!!!!!\n        }\n    }\n    true\n}\n</code></pre>\n\n<p>I get an error while compiling: </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n  --&gt; src/lib.rs:13:13\n   |\n13 |             false\n   |             ^^^^^ expected (), found bool\n   |\n   = note: expected type `()`\n              found type `bool`\n</code></pre>\n\n<p>Why is this happening, and how to fix the problem?</p>\n"}, {"tags": ["rust", "lifetime", "borrow-checker"], "comments": [{"owner": {"reputation": 361, "user_id": 9216763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f82db8ba356c594ea3b37011d6e66161?s=128&d=identicon&r=PG&f=1", "display_name": "miimote", "link": "https://stackoverflow.com/users/9216763/miimote"}, "edited": false, "score": 0, "creation_date": 1553884432, "post_id": 55423382, "comment_id": 97566294, "body": "It seems that you are trying to extend the lifetime of CONST over the lifetime of the function. When you exit function, the reference to CONST isn&#39;t valid."}], "answers": [{"comments": [{"owner": {"reputation": 291, "user_id": 6748328, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-ZRBq2EMA69E/AAAAAAAAAAI/AAAAAAAAAFM/7qP0Uau0MXc/photo.jpg?sz=128", "display_name": "Zachary Burns", "link": "https://stackoverflow.com/users/6748328/zachary-burns"}, "edited": false, "score": 0, "creation_date": 1553884710, "post_id": 55423547, "comment_id": 97566441, "body": "This seems inconsistent with some of the documenation. By way of example, I can do this...impl Test for X {     fn static_ref() -&gt; &amp;&#39;static Self {         &amp;X{}     } } In this example, the value X{} is a constant, and yet I take a reference to it."}, {"owner": {"reputation": 291, "user_id": 6748328, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-ZRBq2EMA69E/AAAAAAAAAAI/AAAAAAAAAFM/7qP0Uau0MXc/photo.jpg?sz=128", "display_name": "Zachary Burns", "link": "https://stackoverflow.com/users/6748328/zachary-burns"}, "edited": false, "score": 0, "creation_date": 1553884995, "post_id": 55423547, "comment_id": 97566571, "body": "I will edit the question to add this additional wrinkle."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 291, "user_id": 6748328, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-ZRBq2EMA69E/AAAAAAAAAAI/AAAAAAAAAFM/7qP0Uau0MXc/photo.jpg?sz=128", "display_name": "Zachary Burns", "link": "https://stackoverflow.com/users/6748328/zachary-burns"}, "edited": false, "score": 0, "creation_date": 1553885086, "post_id": 55423547, "comment_id": 97566604, "body": "@ZacharyBurns I can&#39;t follow the example you gave in the comment. I suggest asking a new question if this one wasn&#39;t enough, or at least giving a playground link for the example, so we can follow it. It would also be helpful to give a pointer to the documentation you think is wrong."}, {"owner": {"reputation": 291, "user_id": 6748328, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-ZRBq2EMA69E/AAAAAAAAAAI/AAAAAAAAAFM/7qP0Uau0MXc/photo.jpg?sz=128", "display_name": "Zachary Burns", "link": "https://stackoverflow.com/users/6748328/zachary-burns"}, "edited": false, "score": 0, "creation_date": 1553885422, "post_id": 55423547, "comment_id": 97566759, "body": "I have edited my question to clarify how it is sometimes possible to take a reference to a constant. I am looking for the documentation and will update the comment shortly."}, {"owner": {"reputation": 3201, "user_id": 5986907, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0521ce05a7fcb2580e4f513990a5a8c8?s=128&d=identicon&r=PG&f=1", "display_name": "joel", "link": "https://stackoverflow.com/users/5986907/joel"}, "edited": false, "score": 0, "creation_date": 1566752141, "post_id": 55423547, "comment_id": 101746669, "body": "what&#39;s a temporary?"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 3201, "user_id": 5986907, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0521ce05a7fcb2580e4f513990a5a8c8?s=128&d=identicon&r=PG&f=1", "display_name": "joel", "link": "https://stackoverflow.com/users/5986907/joel"}, "edited": false, "score": 0, "creation_date": 1566756290, "post_id": 55423547, "comment_id": 101747594, "body": "@joel A temporary is an anonymous intermediate result in an expression which only live for the duration of the current statement."}], "tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": false, "score": 9, "last_activity_date": 1553884370, "last_edit_date": 1553884370, "creation_date": 1553884024, "answer_id": 55423547, "question_id": 55423382, "link": "https://stackoverflow.com/questions/55423382/why-does-taking-a-static-reference-to-a-const-return-a-reference-to-a-temporary/55423547#55423547", "title": "Why does taking a static reference to a const return a reference to a temporary variable?", "body": "<p>A <em>constant</em> in Rust is a compile-time constant, not an actual variable with a memory location. The Rust compiler can substitute the actual <em>value</em> of the constant whereever it is used. If you take the address of such a value, you get the address of a temporary.</p>\n\n<p>Rust also has the concept of a <em>static variable</em>. These variables actually have memory locations that are consistent for the whole program duration, and taking a reference to a static variable indeed results in a reference with <code>'static</code> lifetime.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/37877381/what-is-the-difference-between-immutable-and-const-variables-in-rust\">What is the difference between immutable and const variables in Rust?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/52751597/what-is-the-difference-between-a-const-variable-and-a-static-variable-and-which/52753798\">What is the difference between a const variable and a static variable and which should I choose?</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": true, "score": 3, "last_activity_date": 1553886909, "last_edit_date": 1553886909, "creation_date": 1553885950, "answer_id": 55423981, "question_id": 55423382, "link": "https://stackoverflow.com/questions/55423382/why-does-taking-a-static-reference-to-a-const-return-a-reference-to-a-temporary/55423981#55423981", "title": "Why does taking a static reference to a const return a reference to a temporary variable?", "body": "<p>When you define a trait, the definition must make sense for all possible implementations.</p>\n\n<p>The problem may not be immediately clear without an example of where it fails. So suppose you had a type like this:</p>\n\n<pre><code>struct MyStruct;\nimpl MyStruct {\n    const fn new() -&gt; Self {\n        MyStruct\n    }\n}\n</code></pre>\n\n<p>And you attempted to implement the trait like this:</p>\n\n<pre><code>impl Test for MyStruct {\n    const CONST: Self = MyStruct::new();\n}\n</code></pre>\n\n<p>This won't work because the implementation of <code>static_ref</code> will now look like this:</p>\n\n<pre><code>fn static_ref() -&gt; &amp;'static Self {\n    // &amp;Self::CONST\n    &amp;MyStruct::new()\n}\n</code></pre>\n\n<p>It's creating a value inside the function and trying to return it. This value is <em>not</em> static, so the <code>'static</code> lifetime is invalid.</p>\n\n<hr>\n\n<p>However, with a little re-jigging, you can make something work:</p>\n\n<pre><code>pub trait Test: Sized + 'static {\n    // This is now a reference instead of a value:\n    const CONST: &amp;'static Self;\n    fn static_ref() -&gt; &amp;'static Self {\n        Self::CONST\n    }\n}\n\nstruct MyStruct;\nimpl MyStruct {\n    const fn new() -&gt; Self {\n        MyStruct\n    }\n}\n\nimpl Test for MyStruct {\n    const CONST: &amp;'static Self = &amp;MyStruct::new();\n}\n</code></pre>\n\n<p>This works because <code>CONST</code> is already a <code>'static</code> reference, so the function can just return it. All possible implementations would have to be able to obtain a <code>'static</code> reference to <code>Self</code> to implement the trait, so there is no longer an issue with referencing some arbitrary local value.</p>\n"}], "owner": {"reputation": 291, "user_id": 6748328, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh6.googleusercontent.com/-ZRBq2EMA69E/AAAAAAAAAAI/AAAAAAAAAFM/7qP0Uau0MXc/photo.jpg?sz=128", "display_name": "Zachary Burns", "link": "https://stackoverflow.com/users/6748328/zachary-burns"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 0, "accepted_answer_id": 55423981, "answer_count": 2, "score": 2, "last_activity_date": 1553937828, "creation_date": 1553883291, "last_edit_date": 1553937828, "question_id": 55423382, "link": "https://stackoverflow.com/questions/55423382/why-does-taking-a-static-reference-to-a-const-return-a-reference-to-a-temporary", "title": "Why does taking a static reference to a const return a reference to a temporary variable?", "body": "<p>In Rust I have the following code:</p>\n\n<pre><code>pub trait Test: Sized {\n    const CONST: Self;\n    fn static_ref() -&gt; &amp;'static Self {\n        &amp;Self::CONST\n    }\n}\n</code></pre>\n\n<p>My expectation is that since <code>const</code> is <code>'static</code>, then I should be able to take a reference to it that is also <code>'static</code>. However, the compiler gives the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0515]: cannot return reference to temporary value\n   --&gt; file.rs:9:9\n    |\n  9 |         &amp;Self::CONST\n    |         ^-----------\n    |         ||\n    |         |temporary value created here\n    |         returns a reference to data owned by the current function\n</code></pre>\n\n<p>How is a temporary variable being introduced here?</p>\n\n<p>Additionally, it seems that there are some cases where taking a reference to a constant does work. Here is a short concrete example with a slightly different implementation of Test</p>\n\n<pre><code>pub trait Test: Sized {\n    fn static_ref() -&gt; &amp;'static Self;\n}\n\nstruct X;\n\nimpl Test for X {\n    fn static_ref() -&gt; &amp;'static Self {\n        &amp;X\n    }\n}\n</code></pre>\n"}, {"tags": ["c", "rust", "ffi"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1553876260, "post_id": 55421272, "comment_id": 97562346, "body": "<a href=\"https://crates.io/crates/cc\" rel=\"nofollow noreferrer\">crates.io/crates/cc</a>"}, {"owner": {"reputation": 222, "user_id": 10084665, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FnOW9iD0N1U/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pwrO--yv-cnkbhPgCtsqaJLa8xhQ/mo/photo.jpg?sz=128", "display_name": "FireCubez", "link": "https://stackoverflow.com/users/10084665/firecubez"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1553876821, "post_id": 55421272, "comment_id": 97562606, "body": "@Stargateur Yes? What about it?"}, {"owner": {"reputation": 222, "user_id": 10084665, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FnOW9iD0N1U/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pwrO--yv-cnkbhPgCtsqaJLa8xhQ/mo/photo.jpg?sz=128", "display_name": "FireCubez", "link": "https://stackoverflow.com/users/10084665/firecubez"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1553876871, "post_id": 55421272, "comment_id": 97562633, "body": "Oh so I need to use that package to link the code? Would be nice if you can expand and post as an answer so I can mark the question as accepted"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1553877108, "post_id": 55421272, "comment_id": 97562746, "body": "This example is not complete yet. Please include the Rust project&#39;s Cargo.toml and how you are currently compiling and linking the C project."}, {"owner": {"reputation": 222, "user_id": 10084665, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FnOW9iD0N1U/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pwrO--yv-cnkbhPgCtsqaJLa8xhQ/mo/photo.jpg?sz=128", "display_name": "FireCubez", "link": "https://stackoverflow.com/users/10084665/firecubez"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1553877231, "post_id": 55421272, "comment_id": 97562823, "body": "@E_net4 The Cargo.toml has not been touched since automatically created by cargo, and I&#39;m not even <i>sure</i> how I should be compiling and linking the C project which is why I&#39;m asking."}], "answers": [{"comments": [{"owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "reply_to_user": {"reputation": 222, "user_id": 10084665, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FnOW9iD0N1U/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pwrO--yv-cnkbhPgCtsqaJLa8xhQ/mo/photo.jpg?sz=128", "display_name": "FireCubez", "link": "https://stackoverflow.com/users/10084665/firecubez"}, "edited": false, "score": 0, "creation_date": 1553882762, "post_id": 55421921, "comment_id": 97565521, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/190932/discussion-between-siddharth-naithani-and-firecubez\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "is_accepted": true, "score": 2, "last_activity_date": 1553958925, "last_edit_date": 1553958925, "creation_date": 1553877647, "answer_id": 55421921, "question_id": 55421272, "link": "https://stackoverflow.com/questions/55421272/where-do-i-specify-the-filename-to-link-to-in-ffi-for-rust/55421921#55421921", "title": "Where do I specify the filename to link to in FFI for Rust?", "body": "<p>Your Cargo.toml should look like: </p>\n\n<pre><code>[build-dependencies]\ncc = \"1.0.32\"\n</code></pre>\n\n<p>You should also have a build.rs located in the same folder as <code>Cargo.toml</code>:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate cc;\n\nfn main() {\n    cc::Build::new()\n        .file(\"src/main.c\") //here I specify that main.c is in src folder, you can change the location likewise\n        .compile(\"libmain.a\");\n}\n\n</code></pre>\n\n<p>Finally, <code>main.rs</code> has:</p>\n\n<pre><code>extern \"C\" {\n    fn a() -&gt; u8;\n}\n\nfn main() {\n    println!(\"{}\", unsafe { a() });\n}\n</code></pre>\n\n<p>After this, running <code>cargo run</code> will compile the C code and link it as a library, you might find these <a href=\"https://github.com/sn99/rust-ffi-examples/tree/master/rust-to-c\" rel=\"nofollow noreferrer\">examples</a> useful.</p>\n"}], "owner": {"reputation": 222, "user_id": 10084665, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FnOW9iD0N1U/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pwrO--yv-cnkbhPgCtsqaJLa8xhQ/mo/photo.jpg?sz=128", "display_name": "FireCubez", "link": "https://stackoverflow.com/users/10084665/firecubez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "closed_date": 1553959007, "accepted_answer_id": 55421921, "answer_count": 1, "score": 1, "last_activity_date": 1553959108, "creation_date": 1553875251, "last_edit_date": 1553959108, "question_id": 55421272, "link": "https://stackoverflow.com/questions/55421272/where-do-i-specify-the-filename-to-link-to-in-ffi-for-rust", "closed_reason": "Duplicate", "title": "Where do I specify the filename to link to in FFI for Rust?", "body": "<p>I'm experimenting with FFI on Rust, but I can't find how you tell <code>cargo run</code> where to find your C code, after 2 hours of searching.</p>\n\n<p>I know there's an FFI chapter in the Rust book, but it doesn't state <em>what should I pass to <code>cargo run</code> so that it knows that my C file is located at <code>./c/main.c</code></em>.</p>\n\n<p>Rust code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[link(name = \"main\")]\nextern {\n    fn a() -&gt; u8;\n}\n\nfn main() {\n    println!(\"{}\", unsafe {\n        a()\n    });\n}\n</code></pre>\n\n<p>C code:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>char a() {\n    return 'A';\n}\n</code></pre>\n\n<p>Do I need to compile the C code to an <code>.o</code> file so that Rust can detect it? Where should I put it if I need to do so? I am on Windows.</p>\n\n<p>I also tried adding a build script that prints <code>cargo:rustc-link-search=./</code> but that didn't fix it.</p>\n\n<p>The error I get is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>ld: cannot find -lmain\n</code></pre>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1553873314, "post_id": 55420475, "comment_id": 97560655, "body": "well, you mix up two issues here, if you launch with <code>rustc</code> obviously cargo thing will be missing ! But look like rustc has been kill by OS, that look like a bug somewhere, not enough RAM ?"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1553873379, "post_id": 55420475, "comment_id": 97560693, "body": "<i>&quot;It is a work project that is closed source, so unfortunately I cannot easily share it.&quot;</i> Hopefully you can build a separate project that reproduces the same problem. And considering that you are using a nightly toolchain, it is relevant that you specify which one."}, {"owner": {"reputation": 273, "user_id": 1005108, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/29471f3fafdab1a3c66b5e6c28bba8e9?s=128&d=identicon&r=PG", "display_name": "David Pedersen", "link": "https://stackoverflow.com/users/1005108/david-pedersen"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1553873799, "post_id": 55420475, "comment_id": 97560947, "body": "@Stargateur That seems to be why. I did clean build locally and memory usage by rustc peaked at 6 GB \ud83d\ude1e Thanks for the help!"}], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 544431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbfb9042a19dd3cc8938b6452fde4ca4?s=128&d=identicon&r=PG", "display_name": "Oq01", "link": "https://stackoverflow.com/users/544431/oq01"}, "edited": false, "score": 1, "creation_date": 1553920315, "post_id": 55425230, "comment_id": 97574889, "body": "Suggestion on avoiding <code>rustc</code> and use <code>cargo</code> generally, is helpful insight, and this question/answer shows a concrete example why."}], "tags": [], "owner": {"reputation": 51, "user_id": 10239135, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-pCOSg97w_eY/AAAAAAAAAAI/AAAAAAAAAJE/4Va--l6fhxA/photo.jpg?sz=128", "display_name": "rustonaut", "link": "https://stackoverflow.com/users/10239135/rustonaut"}, "is_accepted": false, "score": 2, "last_activity_date": 1553902593, "last_edit_date": 1553902593, "creation_date": 1553892150, "answer_id": 55425230, "question_id": 55420475, "link": "https://stackoverflow.com/questions/55420475/rust-app-failes-to-compile-because-cargo-manifest-dir-environment-variable-is-mi/55425230#55425230", "title": "Rust app failes to compile because CARGO_MANIFEST_DIR environment variable is missing", "body": "<p>The first and second error are unrelated:</p>\n\n<ol>\n<li>Fails because the process was killed from \"some where\" (The comments seem to have solved that).</li>\n<li>Fails because <code>CARGO_MANIFEST_DIR</code> is set by <code>cargo</code> so if you run <code>rustc</code> manually you have to set the variable yourself, generally try not to run <code>rustc</code> manually at all.</li>\n</ol>\n"}], "owner": {"reputation": 273, "user_id": 1005108, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/29471f3fafdab1a3c66b5e6c28bba8e9?s=128&d=identicon&r=PG", "display_name": "David Pedersen", "link": "https://stackoverflow.com/users/1005108/david-pedersen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 772, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1559760797, "creation_date": 1553872394, "last_edit_date": 1559760797, "question_id": 55420475, "link": "https://stackoverflow.com/questions/55420475/rust-app-failes-to-compile-because-cargo-manifest-dir-environment-variable-is-mi", "title": "Rust app failes to compile because CARGO_MANIFEST_DIR environment variable is missing", "body": "<p>I recently added a dependency to my Rust app that contains a procedural macro. This procedural macro is called with <code>i18n_codegen::i18n!(\"locales\");</code>. It will find all files in the <code>locales</code> directory relative to <code>CARGO_MANIFEST_DIR</code>. As far as I understand <code>CARGO_MANIFEST_DIR</code> is the root of your crate, and gets set by Cargo.</p>\n\n<p>This works fine locally but when I try to build it on my CI server it fails with this message:</p>\n\n<pre><code>root@9eb2477f8a48:~# cd ./project/\nroot@9eb2477f8a48:~/project# cargo build --tests\n   Compiling i18n v0.1.0 (/root/project/i18n)\n   Compiling diesel-factories v0.0.1\n   Compiling rocket_contrib v0.4.0\nerror: Could not compile `i18n`.\n\nCaused by:\n  process didn't exit successfully: `rustc --edition=2018 --crate-name i18n i18n/src/lib.rs --color always --crate-type lib --emit=dep-info,link -C debuginfo=2 -C metadata=7a0984ff3e085e3a -C extra-filename=-7a0984ff3e085e3a --out-dir /root/project/target/debug/deps -C incremental=/root/project/target/debug/incremental -L dependency=/root/project/target/debug/deps --extern i18n_codegen=/root/project/target/debug/deps/libi18n_codegen-85460420d23be67d.so` (signal: 9, SIGKILL: kill)\nwarning: build failed, waiting for other jobs to finish...\nerror: Could not compile `i18n`.\n</code></pre>\n\n<p>Running the rustc command gives</p>\n\n<pre><code>root@9eb2477f8a48:~/project# rustc --edition=2018 --crate-name i18n i18n/src/lib.rs --color always --crate-type lib --emit=dep-info,link -C debuginfo=2 -C metadata=7a0984ff3e085e3a -C extra-filename=-7a0984ff3e085e3a --out-dir /root/project/target/debug/deps -C incremental=/root/project/target/debug/incremental -L dependency=/root/project/target/debug/deps --extern i18n_codegen=/root/project/target/debug/deps/libi18n_codegen-85460420d23be67d.so\nerror: proc macro panicked\n --&gt; i18n/src/lib.rs:1:1\n  |\n1 | i18n_codegen::i18n!(\"locales\");\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  |\n  = help: message: Env var `CARGO_MANIFEST_DIR` was missing\n\nerror: aborting due to previous error\n</code></pre>\n\n<p>Seems like <code>CARGO_MANIFEST_DIR</code> is missing... How can that be? I thought that was always set by Cargo? I guess it might be missing when running <code>rustc</code> directly, but how can it also be missing when running <code>cargo build --tests</code>?</p>\n\n<p>The code that finds the env var is here <a href=\"https://github.com/davidpdrsn/i18n_codegen/blob/master/src/lib.rs#L233\" rel=\"nofollow noreferrer\">https://github.com/davidpdrsn/i18n_codegen/blob/master/src/lib.rs#L233</a>.</p>\n\n<p>The main app itself it a Cargo workspace with a few other crates inside it, not sure if that matters.</p>\n\n<p>I'm using the same version of Rust nightly locally and on CI.</p>\n\n<p>It is a work project that is closed source, so unfortunately I cannot easily share it.</p>\n"}, {"tags": ["enums", "rust", "stack", "traits", "serde"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1553869222, "post_id": 55419413, "comment_id": 97557961, "body": "but what is <code>DeserializeOwned</code> ?"}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1553870359, "post_id": 55419413, "comment_id": 97558729, "body": "<code>impl Trait</code> as a return type is an existential, concrete type. You don&#39;t need to name it explicitly, but it still can only be a single, fixed type (possibly depending on generic type parameters to the function)."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1553870889, "post_id": 55419413, "comment_id": 97559109, "body": "&quot;A type that implements <code>Trait</code> but isn&#39;t known until runtime&quot; is <code>dyn Trait</code>, not <code>impl Trait</code>. You could perhaps define <code>EventResp</code> so that it contains a <code>dyn Trait</code> member, but then you would just have to return a <code>Box&lt;EventResp&gt;</code>. There&#39;s currently no way around boxing to return an unsized type; that would require a second stack or something (<a href=\"https://github.com/rust-lang/rfcs/blob/master/text/1909-unsized-rvalues.md\" rel=\"nofollow noreferrer\">see RFC #1909</a>)."}, {"owner": {"reputation": 1238, "user_id": 759901, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/56175c4faa3db6d594ed7a0688b0c296?s=128&d=identicon&r=PG", "display_name": "leshow", "link": "https://stackoverflow.com/users/759901/leshow"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1553871302, "post_id": 55419413, "comment_id": 97559410, "body": "@Stargateur, <code>DeserializeOwned</code> is a trait from <code>serde</code>, I&#39;m trying to say that the function is returning something which can be deserialized.  @trentcl thanks I suppose that&#39;s what I&#39;m looking for, yes this is a duplicate of that other Q"}], "owner": {"reputation": 1238, "user_id": 759901, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/56175c4faa3db6d594ed7a0688b0c296?s=128&d=identicon&r=PG", "display_name": "leshow", "link": "https://stackoverflow.com/users/759901/leshow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "closed_date": 1553871622, "answer_count": 0, "score": 2, "last_activity_date": 1553869076, "creation_date": 1553869076, "question_id": 55419413, "link": "https://stackoverflow.com/questions/55419413/rust-enum-vs-impl-trait-vs", "closed_reason": "Duplicate", "title": "Rust: Enum vs Impl Trait vs?", "body": "<p>I have a function that deserializes content from a UnixStream into concrete struct definitions. These structs can be one of a number of variants: I originally opted for an enum, but clippy helpfully pointed out that a variant like</p>\n\n<pre><code>pub enum EventResponse {\n    Workspace(WorkspaceData), \n    Output(OutputData),\n    Mode(ModeData),\n}\n</code></pre>\n\n<p>Is inefficient if <code>WorkspaceData</code> is very large and has many more fields than the others. This increases the minimum size of each variant.</p>\n\n<p>To get around this, in my deserialization fn I Box some of the variants:</p>\n\n<pre><code>pub enum EventResponse {\n    Workspace(Box&lt;WorkspaceData&gt;),\n    Output(OutputData),\n    Mode(ModeData)\n}\n  pub fn receive_evt(&amp;mut self) -&gt; io::Result&lt;event::EventResponse&gt; {\n        let (evt_type, payload_bytes) = self.decode_msg()?;\n        let body = match evt_type.into() {\n            Event::Workspace =&gt; {\n                EventResponse::Workspace(Box::new(serde_json::from_slice::&lt;event::WorkspaceData&gt;(\n                    &amp;payload_bytes[..],\n                )?))\n            }\n            Event::Output =&gt; EventResponse::Output(serde_json::from_slice::&lt;event::OutputData&gt;(\n                &amp;payload_bytes[..],\n            )?),\n            Event::Mode =&gt; EventResponse::Mode(serde_json::from_slice::&lt;event::ModeData&gt;(\n                &amp;payload_bytes[..],\n            )?),\n        };\n        Ok(body)\n    }\n</code></pre>\n\n<p>However, it would be nice if I didn't have to Box any of the variants. With the advent of <code>impl Trait</code> is there a way to do this now?</p>\n\n<p>I really wanted somethign like:</p>\n\n<pre><code> pub fn receive_evt_2&lt;D: DeserializeOwned&gt;(\n        &amp;mut self,\n    ) -&gt; io::Result&lt;EventResp&lt;impl DeserializeOwned&gt;&gt; {\n        let (evt_type, payload_bytes) = self.decode_msg()?;\n        let evt_type = evt_type.into();\n        let body = match evt_type {\n            Event::Workspace =&gt; serde_json::from_slice::&lt;event::WorkspaceData&gt;(&amp;payload_bytes[..])?,\n            Event::Output =&gt; serde_json::from_slice::&lt;event::OutputData&gt;(&amp;payload_bytes[..])?,\n            Event::Mode =&gt; serde_json::from_slice::&lt;event::ModeData&gt;(&amp;payload_bytes[..])?,\n        };\n        Ok(EventResp { evt_type, body })\n    }\n</code></pre>\n\n<p>But this returns an error like \"Expected type WorkspaceData, found type OutputData\".</p>\n\n<p>What are my options?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1553862642, "post_id": 55416881, "comment_id": 97553892, "body": "<code>Box::&lt;dyn MyTrait&gt;::new</code> make more sense but doesn&#39;t compile. I don&#39;t really understand why"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1553958610, "post_id": 55416881, "comment_id": 97583209, "body": "See also <a href=\"https://stackoverflow.com/q/52288980/155423\">How does the mechanism behind the creation of boxed traits work?</a>; <a href=\"https://stackoverflow.com/q/48180008/155423\">How can I box the contents of an iterator of a type that implements a trait?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 4, "last_activity_date": 1553863390, "last_edit_date": 1553863390, "creation_date": 1553863054, "answer_id": 55417592, "question_id": 55416881, "link": "https://stackoverflow.com/questions/55416881/how-to-box-variable-as-static-method-reference-with-type-argument/55417592#55417592", "title": "How to box variable as static method reference with type argument?", "body": "<p>Since you want to give a type parameter to the <code>Box</code> type, the correct syntax would be <code>Box::&lt;dyn MyTrait&gt;::new</code> rather than <code>Box::new::&lt;dyn MyTrait&gt;</code>. However, this won't work either, since the compiler would try to coerce the type of the argument to <code>Box::new()</code> to <code>dyn MyTrait</code> before passing it by value, which is not possible for dynamically sized types. You need to create the box first, and only then can you perform the unsized coercion, so the code you have is fine.  Here is an alternative that is essentially the same, just written a bit more concisely:</p>\n\n<pre><code>let mut my_trait_vec: Vec&lt;Box&lt;dyn MyTrait&gt;&gt; = my_vec\n    .into_iter()\n    .map(|x| Box::new(x) as Box&lt;dyn MyTrait&gt;)\n    .collect();\n</code></pre>\n\n<p>Yet another option is to define a helper function, e.g.</p>\n\n<pre><code>fn into_boxed_trait&lt;T&gt;(value: T) -&gt; Box&lt;dyn MyTrait&gt;\nwhere\n    T: MyTrait + 'static,\n{\n    Box::new(value)\n}\n</code></pre>\n\n<p>This will allow you to write</p>\n\n<pre><code>let mut my_trait_vec: Vec&lt;_&gt; = my_vec\n    .into_iter()\n    .map(into_boxed_trait)\n    .collect();\n</code></pre>\n"}], "owner": {"reputation": 4195, "user_id": 6882497, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/yMbwv.jpg?s=128&g=1", "display_name": "Akiner Alkan", "link": "https://stackoverflow.com/users/6882497/akiner-alkan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "accepted_answer_id": 55417592, "answer_count": 1, "score": 3, "last_activity_date": 1553958461, "creation_date": 1553860390, "last_edit_date": 1553958461, "question_id": 55416881, "link": "https://stackoverflow.com/questions/55416881/how-to-box-variable-as-static-method-reference-with-type-argument", "title": "How to box variable as static method reference with type argument?", "body": "<p>I am trying to give a static method reference and type argument for <code>Box::new</code> and could not manage to compile it. </p>\n\n<p>I have the following structure:</p>\n\n<pre><code>trait MyTrait {\n    fn hello(&amp;self);\n}\n\nstruct MyStruct;\n\nimpl MyTrait for MyStruct {\n    fn hello(&amp;self) {\n        println!(\"Hello\");\n    }\n}\n</code></pre>\n\n<p>In my main method, I want to cast these structs to trait objects, put them in a <code>Box</code>, and return it as a vector. I have managed to do it this way:</p>\n\n<pre><code>fn main() {\n    let my_vec = vec![MyStruct];\n\n    let my_trait_vec: Vec&lt;Box&lt;MyTrait&gt;&gt; = my_vec\n        .into_iter()\n        .map(|x| {\n            let boxed: Box&lt;MyTrait&gt; = Box::new(x);\n            boxed\n        })\n        .collect();\n}\n</code></pre>\n\n<p>I am looking for something like :</p>\n\n<pre><code>let mut my_trait_vec: Vec&lt;Box&lt;MyTrait&gt;&gt; = my_vec.into_iter().map(Box::new::&lt;MyTrait&gt;).collect();\n</code></pre>\n\n<p>This is not accepted by the compiler and it complains about an unexpected type argument for <code>Box::new()</code>.</p>\n\n<p>Is it possible to make this boxing operation in a single line without declaring any external function?</p>\n\n<p><a href=\"https://play.rust-lang.org/?version=nightly&amp;mode=debug&amp;edition=2018&amp;gist=7766933bf08b26fcbd99ffe45e70686a\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}, {"tags": ["rust", "pattern-matching"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1553843256, "post_id": 55408608, "comment_id": 97543698, "body": "For the best understanding you should read the book further, namely <a href=\"https://doc.rust-lang.org/book/ch06-00-enums.html\" rel=\"nofollow noreferrer\">chapter 6</a> where enums and pattern matching will be explained."}, {"owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 2, "creation_date": 1553850103, "post_id": 55408608, "comment_id": 97546640, "body": "The <code>num</code> in the pattern is the declaration."}], "answers": [{"comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1553843570, "post_id": 55409911, "comment_id": 97543825, "body": "If you answer a question, please try to answer all of them (although it should only be one question at a time, but it&#39;s not the case this time)."}], "tags": [], "owner": {"reputation": 579, "user_id": 11206879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bS2D6.png?s=128&g=1", "display_name": "Pan Ke", "link": "https://stackoverflow.com/users/11206879/pan-ke"}, "is_accepted": false, "score": 0, "last_activity_date": 1553828707, "creation_date": 1553828707, "answer_id": 55409911, "question_id": 55408608, "link": "https://stackoverflow.com/questions/55408608/why-can-you-use-a-previously-undeclared-name-in-a-match/55409911#55409911", "title": "Why can you use a previously undeclared name in a match?", "body": "<p>short answer. <code>patterns match</code> can destruct structs, enums... <a href=\"https://doc.rust-lang.org/book/ch18-03-pattern-syntax.html#destructuring-to-break-apart-values\" rel=\"nofollow noreferrer\">see here</a></p>\n\n<p>signature of <code>parse</code> is <code>pub fn parse&lt;F&gt;(&amp;self) -&gt; Result&lt;F, &lt;F as FromStr&gt;::Err&gt;</code>. There is a generic type <code>F</code> in it.</p>\n\n<p>The compiler finds <code>let guess: u32 =</code>, and it infers that what you need is <code>u32</code>. So the <code>F</code> is <code>u32</code> here.</p>\n\n<p>Then the patterns match destructing extracts <code>num</code> from <code>Ok&lt;u32&gt;</code></p>\n"}, {"tags": [], "owner": {"reputation": 623, "user_id": 10962821, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-2LR2CPhrhu0/AAAAAAAAAAI/AAAAAAAAAAc/OGsF9pFiFOU/photo.jpg?sz=128", "display_name": "sn99", "link": "https://stackoverflow.com/users/10962821/sn99"}, "is_accepted": true, "score": 9, "last_activity_date": 1553953706, "last_edit_date": 1553953706, "creation_date": 1553828737, "answer_id": 55409915, "question_id": 55408608, "link": "https://stackoverflow.com/questions/55408608/why-can-you-use-a-previously-undeclared-name-in-a-match/55409915#55409915", "title": "Why can you use a previously undeclared name in a match?", "body": "<p>If we start with where <code>Ok</code> and <code>Err</code> come from, we might get a better idea. They are a part of the <a href=\"https://doc.rust-lang.org/std/result/\" rel=\"nofollow noreferrer\"><code>Result</code></a> enum defined like:</p>\n\n<pre><code>enum Result&lt;T, E&gt; {\n   Ok(T),\n   Err(E),\n}\n</code></pre>\n\n<p><code>T</code> and <code>E</code> are generic types. <code>match</code> itself is like C's <code>switch</code> statement but more flexible.</p>\n\n<p>The general form of <code>match</code> itself is:</p>\n\n<pre><code>match value {\n    pattern =&gt; expr,\n    ...\n}\n</code></pre>\n\n<blockquote>\n  <p>If those match, the expression will execute the statement beside the first arm, right?</p>\n</blockquote>\n\n<p>Yes</p>\n\n<blockquote>\n  <p>But why is <code>num</code> at the right suddenly usable?</p>\n</blockquote>\n\n<p>Because <code>match</code> matches <em>patterns</em> to the left of the <code>=&gt;</code> in each arm. It can unpack tuples, match struct fields, borrow parts of a value, etc.</p>\n\n<blockquote>\n  <p>If I guessed right, what's the difference of <code>Ok(num)</code> and <code>Ok(_)</code>?</p>\n</blockquote>\n\n<p><code>_</code> is a wildcard pattern and matches everything.</p>\n\n<p>The difference between <code>Ok(num)</code> and <code>Ok(_)</code> is that in first case you are asking that if the <code>Result</code> is the <code>Ok</code> variant then store its value of type <code>T</code> in <code>num</code>. In the second case, you are saying that you do not care what value <code>Ok</code> holds \u2014 as long as the <code>Result</code> is the <code>Ok</code> variant you want to execute something.</p>\n\n<p>Remember that when you use <code>_</code> in a pattern, you cannot use <code>_</code> inside the code i.e. this will not work because <code>_</code> is not an identifier:</p>\n\n<pre><code>let guess: u32 = match guess.trim().parse() {\n    Ok(_) =&gt; _,\n    Err(_) =&gt; continue,\n};\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 11274916, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tg8OwPvmEZk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcVeCvTFC66VtTlaOu4Cjd4Se658A/mo/photo.jpg?sz=128", "display_name": "Jeff White", "link": "https://stackoverflow.com/users/11274916/jeff-white"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 55409915, "answer_count": 2, "score": 4, "last_activity_date": 1553953706, "creation_date": 1553817500, "last_edit_date": 1553866237, "question_id": 55408608, "link": "https://stackoverflow.com/questions/55408608/why-can-you-use-a-previously-undeclared-name-in-a-match", "title": "Why can you use a previously undeclared name in a match?", "body": "<p>I'm experiencing a problem understanding this code from the second chapter of the book:</p>\n\n<pre><code>let guess: u32 = match guess.trim().parse() {\n    Ok(num) =&gt; num,\n    Err(_) =&gt; continue,\n};\n</code></pre>\n\n<p>My problem is with <code>Ok(num) =&gt; num</code>: <code>parse()</code> returns a value (either <code>Ok</code> or <code>Err</code>), <code>match</code> compares that returned value to the first arm. If those match, the expression will execute the statement beside the first arm, right?</p>\n\n<p>In <code>Ok(num)</code>, <code>num</code> seems to have popped up abruptly, since there was no declaration of <code>num</code> in previous code. Same with the statement, <code>=&gt; num</code>: <code>num</code> was suddenly in scope. So</p>\n\n<ol>\n<li>If I'm guessing it right, <code>match</code> matches the returned value with <code>Ok()</code>, then assigns whatever number that is (inside <code>Ok</code>) to <code>num</code>. But why is <code>num</code> at the right suddenly usable?</li>\n<li>If I guessed right, what's the difference of <code>Ok(num)</code> and <code>Ok(_)</code>?</li>\n</ol>\n"}, {"tags": ["rust", "floating-point"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1553849178, "post_id": 55408070, "comment_id": 97546126, "body": "What precision do you need for your big integers? Do you only need a few significant places, or so you want to store <i>all</i> digits of the integer? If all you need is the former, a floating point type is exactly what you want to use. In the latter case, you will need some arbitrary precision integer implementation, as explained in Benjamin Lindley&#39;s answer."}, {"owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 1, "creation_date": 1553850697, "post_id": 55408070, "comment_id": 97546953, "body": "Even as an <code>f64</code> the number <code>99e100</code> cannot be represented exactly. It&#39;s exact value is actually <code>999999999999999967336168804116691273849533185806555472917961&zwnj;&#8203;77947129584592172786&zwnj;&#8203;2608739868455469056</code>."}], "answers": [{"tags": [], "owner": {"reputation": 95188, "user_id": 440119, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5ec9ca2a92a94a5470396073129d79e7?s=128&d=identicon&r=PG", "display_name": "Benjamin Lindley", "link": "https://stackoverflow.com/users/440119/benjamin-lindley"}, "is_accepted": false, "score": 4, "last_activity_date": 1553817049, "last_edit_date": 1553817049, "creation_date": 1553816690, "answer_id": 55408498, "question_id": 55408070, "link": "https://stackoverflow.com/questions/55408070/why-can-rust-floating-point-values-hold-large-values-with-few-significant-figure/55408498#55408498", "title": "Why can Rust floating point values hold large values with few significant figures, whereas integers cannot?", "body": "<p>Rust primitives are a fixed size. As such, there are a finite number of unique values they can store, to be no greater than 2^n, where n is the number of bits in the type. In the case of the integer types, those bit patterns are assigned to every successive integer up to the number of values they can represent, starting from 0. Furthermore, in the case of signed integers, half of those patterns are assigned to negative numbers.</p>\n\n<p>Given these specifications, the maximum value that an <code>i64</code> can hold is 2^63-1 (which is the number you printed). The largest signed integer type <code>i128</code>, can hold a value up to 2^127-1. And if you use <code>u128</code> you can get all the way up to 2^128-1. That is the largest value that a primitive integer type can hold in Rust, significantly less than your request for 99e100.</p>\n\n<p>If you want larger integers, you need to use either a larger fixed size type, or an unbounded type, which grows as needed. Neither of these are part of the Rust standard. So you will have to either write your own implementation, or use someone else's, such as <a href=\"https://github.com/rust-num/num\" rel=\"nofollow noreferrer\">the num crate</a>.</p>\n"}], "owner": {"reputation": 4871, "user_id": 3474089, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/9KTt4.png?s=128&g=1", "display_name": "abagshaw", "link": "https://stackoverflow.com/users/3474089/abagshaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1553952177, "creation_date": 1553813760, "last_edit_date": 1553952177, "question_id": 55408070, "link": "https://stackoverflow.com/questions/55408070/why-can-rust-floating-point-values-hold-large-values-with-few-significant-figure", "title": "Why can Rust floating point values hold large values with few significant figures, whereas integers cannot?", "body": "<p>Why is it that only floating point values in Rust appear to be able to hold large values with few significant figures, whereas integers cannot?</p>\n\n<pre><code>println!(\"{}\", std::f64::MAX); // 1.7976931348623157e199\nprintln!(\"{}\", std::i64::MAX); // 9223372036854775807\n</code></pre>\n\n<p>If I have an integer, i.e. <code>99e100</code> is there any primitive in Rust that can store that value as an integer, or am I forced to use a float?</p>\n"}, {"tags": ["types", "rust", "borrow-checker", "borrowing"], "comments": [{"owner": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "edited": false, "score": 0, "creation_date": 1553808237, "post_id": 55406890, "comment_id": 97534633, "body": "Are you trying to compare the <code>T</code> objects themselves, or the references returned by <code>.get()</code>?"}, {"owner": {"reputation": 15065, "user_id": 723090, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ML1tj.png?s=128&g=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/723090/mark"}, "reply_to_user": {"reputation": 29810, "user_id": 423170, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/H9kNQ.png?s=128&g=1", "display_name": "Frxstrem", "link": "https://stackoverflow.com/users/423170/frxstrem"}, "edited": false, "score": 0, "creation_date": 1553808582, "post_id": 55406890, "comment_id": 97534754, "body": "@Frxstrem Functionally, I want the T objects to be the same."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1553809888, "post_id": 55406890, "comment_id": 97535243, "body": "<code>&amp;&#39;a dyn FnOnce() -&gt; T</code> looks like a questionable type, since you can&#39;t ever call the function. (You need to own an <code>FnOnce</code> to be able to call it.)"}], "answers": [{"comments": [{"owner": {"reputation": 15065, "user_id": 723090, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ML1tj.png?s=128&g=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/723090/mark"}, "edited": false, "score": 0, "creation_date": 1553892859, "post_id": 55407618, "comment_id": 97569819, "body": "I had added <code>&amp;&#39;a mut</code> based on a compiler hint I got when I tried <code>self.get().eq(other.get())</code>. But now I see I should have used <code>&amp;other</code> instead (or easier, <code>==</code>)."}], "tags": [], "owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "is_accepted": true, "score": 4, "last_activity_date": 1553810985, "creation_date": 1553810985, "answer_id": 55407618, "question_id": 55406890, "link": "https://stackoverflow.com/questions/55406890/why-does-rust-expect-double-borrow-a-mut-t/55407618#55407618", "title": "Why does Rust expect double borrow (`&amp;&amp;&#39;a mut T`)", "body": "<p>You can understand why Rust is expecting an <code>&amp;&amp;mut T</code> by looking at the definition of the <code>eq()</code> method in the <code>PartialEq</code> trait:</p>\n\n<pre><code>fn eq(&amp;self, other: &amp;Rhs) -&gt; bool;\n</code></pre>\n\n<p>The types of the parameters to this method are <code>&amp;Self</code> and <code>&amp;Rhs</code>; since <code>Rhs</code> defaults to <code>Self</code> and you did not specify anything else in your trait bound, both arguments are expected to be of type <code>&amp;Self</code>.</p>\n\n<p>Now what is <code>Self</code> in this case?  Your trait bound is this:</p>\n\n<pre><code>&amp;'a mut T: PartialEq\n</code></pre>\n\n<p>So the only <code>PartialEq</code> implementation the compiler can use is the one for the type <code>&amp;'a mut T</code>, so this is what <code>Self</code> is; <code>&amp;Self</code>, in turn, must be <code>&amp;&amp;'a mut T</code>, which is exactly what the compiler is expecting.</p>\n\n<p>You probably want the trait bound for <code>T</code> instead:</p>\n\n<pre><code>impl&lt;'a, T&gt; PartialEq for Cache&lt;'a, T&gt;\nwhere\n    T: PartialEq,\n{\n    fn eq(&amp;self, other: &amp;Self) -&gt; bool {\n        self.get() == other.get()\n    }\n}\n</code></pre>\n\n<p>Also note that you can simply use <code>==</code> instead of explicitly calling <code>eq()</code>. It makes getting the types right a bit easier, since the compiler will take references of the arguments implicitly \u2013 <code>a == b</code> expands to <code>PartialEq::eq(&amp;a, &amp;b)</code>.</p>\n"}], "owner": {"reputation": 15065, "user_id": 723090, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ML1tj.png?s=128&g=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/723090/mark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 656, "favorite_count": 0, "accepted_answer_id": 55407618, "answer_count": 1, "score": 0, "last_activity_date": 1553843469, "creation_date": 1553807427, "last_edit_date": 1553843469, "question_id": 55406890, "link": "https://stackoverflow.com/questions/55406890/why-does-rust-expect-double-borrow-a-mut-t", "title": "Why does Rust expect double borrow (`&amp;&amp;&#39;a mut T`)", "body": "<p>My code looks like <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=c8ea64026f632a10dc076c1c909fc02f\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>pub enum Cache&lt;'a, T&gt; {\n    Pending(&amp;'a dyn FnOnce() -&gt; T),\n    Cached(T),\n}\n\nimpl&lt;'a, T&gt; Cache&lt;'a, T&gt; {\n    pub fn get(&amp;self) -&gt; &amp;mut T {\n        // This caches and borrows the T\n    }\n}\n\nimpl&lt;'a, T&gt; PartialEq for Cache&lt;'a, T&gt;\n    where &amp;'a mut T: PartialEq {\n\n    fn eq(&amp;self, other: &amp;Self) -&gt; bool {\n        self.get().eq(other.get())\n    }\n}\n</code></pre>\n\n<p>But implementing <code>Eq</code> fails with:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: mismatched types\n--&gt; src/lib.rs:20:23\n|\n20 |         self.get().eq(other.get())\n|                       ^^^^^^^^^^^ expected mutable reference, found type parameter\n|\n= note: expected type `&amp;&amp;'a mut T`\n               found type `&amp;mut T`\n</code></pre>\n\n<p>I think I'm conceptually misunderstanding something.</p>\n"}, {"tags": ["function", "rust", "traits"], "comments": [{"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1553805456, "post_id": 55406133, "comment_id": 97533504, "body": "I&#39;m not quite sure what you areasking about. Are you interested in the differences between the function item type of an individual function and the corresponding function pointer type? The latter is not a reference, and since your question mentions &quot;fn references&quot; multiple times, I&#39;m not sure this is what you mean."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1553805925, "post_id": 55406133, "comment_id": 97533694, "body": "For what it&#39;s worth, function items can only be called and copied, but they coerce function pointers in many situations; the details of the latter coercion are not fully documented."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1553805983, "post_id": 55406133, "comment_id": 97533719, "body": "@SvenMarnach I interpret the question like: for whatever type, there is a documentation page that shows the implemented traits; where is this page for <code>fn</code>?"}, {"owner": {"reputation": 975, "user_id": 7687388, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xhm3T.png?s=128&g=1", "display_name": "CodeSandwich", "link": "https://stackoverflow.com/users/7687388/codesandwich"}, "reply_to_user": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1553806764, "post_id": 55406133, "comment_id": 97534071, "body": "@SvenMarnach I&#39;m aware of subtle difference between fn item and fn reference. I want to know what can be done with fn item without coercing it to fn reference. Copying and calling, that&#39;s fair, thank you."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 1, "creation_date": 1553809569, "post_id": 55406133, "comment_id": 97535145, "body": "@CodeSandwich My confusion comes only from your choice of words \u2013 &quot;fn reference&quot;. You seem to use this term for a <i>function pointer</i>, but it wasn&#39;t at all clear that this is what you meant, since a function pointer is not a reference in the usual Rust sense of the word."}, {"owner": {"reputation": 478030, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1553809707, "post_id": 55406133, "comment_id": 97535191, "body": "@FrenchBoiethios There is a documentation page for <a href=\"https://doc.rust-lang.org/std/primitive.fn.html\" rel=\"nofollow noreferrer\">function pointer types</a>, but none for function item types. I don&#39;t think that link is helpful for this question."}], "owner": {"reputation": 975, "user_id": 7687388, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xhm3T.png?s=128&g=1", "display_name": "CodeSandwich", "link": "https://stackoverflow.com/users/7687388/codesandwich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1553813930, "creation_date": 1553804013, "last_edit_date": 1553813930, "question_id": 55406133, "link": "https://stackoverflow.com/questions/55406133/what-traits-or-methods-are-implemented-for-fn-items", "title": "What traits or methods are implemented for fn items?", "body": "<p>I'm trying to find out what things I can do with a fn item. I could find something for fn pointer in std lib source, but nothing about fn item.</p>\n\n<p>I know about <code>Copy</code>, <code>Fn</code>, being called and somehow being casted to fn pointer (but not sure if by trait or by built-in compiler magic). Is there anything else?</p>\n"}, {"tags": ["rust", "clippy"], "comments": [{"owner": {"reputation": 17135, "user_id": 581190, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a503f14866aaa083332c81264860ac8e?s=128&d=identicon&r=PG", "display_name": "zrzka", "link": "https://stackoverflow.com/users/581190/zrzka"}, "edited": false, "score": 0, "creation_date": 1553791776, "post_id": 55402812, "comment_id": 97526413, "body": "<a href=\"https://github.com/rust-lang/rust-clippy#allowingdenying-lints\" rel=\"nofollow noreferrer\">github.com/rust-lang/rust-clippy#allowingdenying-lints</a>"}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1553794612, "post_id": 55402812, "comment_id": 97528037, "body": "Without context it&#39;s hard to say for sure, but probably the best way to get rid of the warning, is to fix the code and rename the method to <code>into_vec_sorted</code>."}, {"owner": {"reputation": 1293, "user_id": 850659, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/772249379272025f1525849064eae7fd?s=128&d=identicon&r=PG", "display_name": "Richard Rast", "link": "https://stackoverflow.com/users/850659/richard-rast"}, "reply_to_user": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 2, "creation_date": 1553795033, "post_id": 55402812, "comment_id": 97528263, "body": "@mcarton If you read the prose it points out that this lint is easy to solve, it&#39;s just present to give a minimal example. I&#39;m looking for a general way to disable a lint in a narrow scope, which was provided in an answer below."}], "answers": [{"comments": [{"owner": {"reputation": 17135, "user_id": 581190, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a503f14866aaa083332c81264860ac8e?s=128&d=identicon&r=PG", "display_name": "zrzka", "link": "https://stackoverflow.com/users/581190/zrzka"}, "edited": false, "score": 2, "creation_date": 1553792175, "post_id": 55402970, "comment_id": 97526644, "body": "<code>or_fun_call</code> is wrong. He has a <i>problem</i> with <a href=\"https://rust-lang.github.io/rust-clippy/master/#wrong_self_convention\" rel=\"nofollow noreferrer\">wrong_self_convention</a>."}, {"owner": {"reputation": 1293, "user_id": 850659, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/772249379272025f1525849064eae7fd?s=128&d=identicon&r=PG", "display_name": "Richard Rast", "link": "https://stackoverflow.com/users/850659/richard-rast"}, "edited": false, "score": 1, "creation_date": 1553792749, "post_id": 55402970, "comment_id": 97526992, "body": "Ha, I read that segment of the README but for some reason thought it was only at a much higher level than I wanted. Thanks much!"}, {"owner": {"reputation": 1224, "user_id": 5027851, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5MxeK.png?s=128&g=1", "display_name": "Ealhad", "link": "https://stackoverflow.com/users/5027851/ealhad"}, "edited": false, "score": 1, "creation_date": 1553793363, "post_id": 55402970, "comment_id": 97527340, "body": "I admit I had to look into the issues to find one with an example. Maybe the README should be updated with one ;)"}], "tags": [], "owner": {"reputation": 1224, "user_id": 5027851, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/5MxeK.png?s=128&g=1", "display_name": "Ealhad", "link": "https://stackoverflow.com/users/5027851/ealhad"}, "is_accepted": true, "score": 23, "last_activity_date": 1553792220, "last_edit_date": 1553792220, "creation_date": 1553791761, "answer_id": 55402970, "question_id": 55402812, "link": "https://stackoverflow.com/questions/55402812/how-to-disable-a-clippy-lint-for-a-single-line-block/55402970#55402970", "title": "How to disable a clippy lint for a single line / block?", "body": "<p>The <a href=\"https://github.com/rust-lang/rust-clippy#allowingdenying-lints\" rel=\"noreferrer\">docs</a> state you can allow or deny lints.</p>\n\n<pre><code>#[allow(clippy::wrong_self_convention)] pub fn to_vec_sorted&lt;U, F&gt;(self, mapper: F) -&gt; Vec&lt;U&gt;\n</code></pre>\n\n<p>And if you want to disable <em>all of them</em>:</p>\n\n<pre><code>#[allow(clippy::all)] pub fn to_vec_sorted&lt;U, F&gt;(self, mapper: F) -&gt; Vec&lt;U&gt;\n</code></pre>\n"}], "owner": {"reputation": 1293, "user_id": 850659, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/772249379272025f1525849064eae7fd?s=128&d=identicon&r=PG", "display_name": "Richard Rast", "link": "https://stackoverflow.com/users/850659/richard-rast"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7572, "favorite_count": 0, "closed_date": 1553796728, "accepted_answer_id": 55402970, "answer_count": 1, "score": 23, "last_activity_date": 1553796783, "creation_date": 1553791192, "last_edit_date": 1553796783, "question_id": 55402812, "link": "https://stackoverflow.com/questions/55402812/how-to-disable-a-clippy-lint-for-a-single-line-block", "closed_reason": "Duplicate", "title": "How to disable a clippy lint for a single line / block?", "body": "<p>I am getting some Clippy lints that look like this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>warning: methods called `to_*` usually take self by reference; consider choosing a less ambiguous name\n  --&gt; src/helpers/mod.rs:29:32\n   |\n29 |     pub fn to_vec_sorted&lt;U, F&gt;(self, mapper: F) -&gt; Vec&lt;U&gt;\n   |                                ^^^^\n   |\n   = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#wrong_self_convention\n</code></pre>\n\n<p>I have no problem dealing with this lint, I just picked it because it doesn't show any proprietary code. Suppose I had a really good reason why I needed to name the function this way, and also that Clippy is integrated into my CI, so I need to have zero Clippy errors / warnings.</p>\n\n<p>Is there a way to disable a Clippy lint <em>for a particular line or code block</em>, analogous to <code>@SuppressWarnings(\"whatever\")</code> in Java? I feel like there must be, but I can't find any examples of doing this in the documentation.</p>\n"}, {"tags": ["sql", "postgresql", "rust", "rust-diesel"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1553783568, "post_id": 55400015, "comment_id": 97520849, "body": "Note that you don&#39;t need to use the diesel client to use diesel. Those are different things."}, {"owner": {"reputation": 2062, "user_id": 7062483, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/720e20205122c5b3cb2b25c533ae0522?s=128&d=identicon&r=PG&f=1", "display_name": "jupiar", "link": "https://stackoverflow.com/users/7062483/jupiar"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1553785461, "post_id": 55400015, "comment_id": 97522219, "body": "If what you meant is that Diesel is the core ORM for interacting with the database, and the cli provides a means to perform actions such as generating migration schemas and applying them to the database, I got that already. If not, could you elaborate?"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1553785772, "post_id": 55400015, "comment_id": 97522447, "body": "Nope, I just wanted to make that clear."}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 1, "creation_date": 1553795033, "post_id": 55400015, "comment_id": 97528262, "body": "&quot;I beleive the SQL queries are both perfectly valid&quot; -&gt; No. It <a href=\"https://www.postgresql.org/docs/11/datatype-numeric.html\" rel=\"nofollow noreferrer\">doesn&#39;t look like PostgreSQL supports <code>int(n)</code></a>."}, {"owner": {"reputation": 2062, "user_id": 7062483, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/720e20205122c5b3cb2b25c533ae0522?s=128&d=identicon&r=PG&f=1", "display_name": "jupiar", "link": "https://stackoverflow.com/users/7062483/jupiar"}, "edited": false, "score": 0, "creation_date": 1553870873, "post_id": 55400015, "comment_id": 97559089, "body": "Thanks, I am now aware that mysql and postgres sql statements differ."}], "owner": {"reputation": 2062, "user_id": 7062483, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/720e20205122c5b3cb2b25c533ae0522?s=128&d=identicon&r=PG&f=1", "display_name": "jupiar", "link": "https://stackoverflow.com/users/7062483/jupiar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 0, "closed_date": 1553797459, "answer_count": 0, "score": 0, "last_activity_date": 1553797524, "creation_date": 1553783037, "last_edit_date": 1553797317, "question_id": 55400015, "link": "https://stackoverflow.com/questions/55400015/why-does-diesel-fail-to-migrate-a-postgressql-database-when-the-columns-specify", "closed_reason": "Duplicate", "title": "Why does Diesel fail to migrate a PostgresSQL database when the columns specify a length?", "body": "<p>When I generate migrations with <code>diesel migration generate customers</code>, if the <code>up.sql</code> file in the migrations folder contains no brackets for column length:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE TABLE customers (\n  id SERIAL PRIMARY KEY,\n  name VARCHAR NOT NULL,\n  identity VARCHAR NOT NULL,\n  hometown VARCHAR NOT NULL,\n  age INT NOT NULL\n)\n</code></pre>\n\n<p>When I run <code>diesel migration run --database-url=postgres://&lt;info&gt;</code>, it successfully migrates the database.</p>\n\n<p>Why would the following:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE TABLE customers (\n  id SERIAL PRIMARY KEY,\n  name VARCHAR(255) NOT NULL,\n  identity VARCHAR(255) NOT NULL,\n  hometown VARCHAR(255) NOT NULL,\n  age INT(11) NOT NULL\n)\n</code></pre>\n\n<p>raise the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Failed with: syntax error at or near \"(\"\n</code></pre>\n\n<p>My SQL isn't amazing, hence why I went straight for an ORM, but I believe the SQL queries are both perfectly valid, I'm at a loss of where to look to debug.</p>\n"}, {"tags": ["rust", "nullable"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1553789622, "post_id": 55399900, "comment_id": 97525194, "body": "Isn\u2019t your pseudocode just <code>$location = row-2</code>?"}, {"owner": {"reputation": 17135, "user_id": 581190, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a503f14866aaa083332c81264860ac8e?s=128&d=identicon&r=PG", "display_name": "zrzka", "link": "https://stackoverflow.com/users/581190/zrzka"}, "edited": false, "score": 0, "creation_date": 1553789714, "post_id": 55399900, "comment_id": 97525239, "body": "<a href=\"https://github.com/sfackler/rust-postgres/issues/96\" rel=\"nofollow noreferrer\">github.com/sfackler/rust-postgres/issues/96</a> -&gt; <code>struct Rating { location: Option&lt;String&gt; }</code> &amp; <code>Rating { location: row.get(2) }</code>."}, {"owner": {"reputation": 1962, "user_id": 982364, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8f7fcd81979b29f5fd4ddf155987e588?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/982364/tom"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1553794134, "post_id": 55399900, "comment_id": 97527794, "body": "@Shepmaster - yes, but the pseudo-code is just for illustration. what I&#39;m actually doing is slightly more complex."}, {"owner": {"reputation": 1962, "user_id": 982364, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8f7fcd81979b29f5fd4ddf155987e588?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/982364/tom"}, "edited": false, "score": 0, "creation_date": 1553964983, "post_id": 55399900, "comment_id": 97584832, "body": "This question is NOT A DUPLICATE. I was aware of the linked question. Implementing the solution posted where into a struct assignment requires duplicate code that I&#39;m sure can be avoided."}], "answers": [{"tags": [], "owner": {"reputation": 1962, "user_id": 982364, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8f7fcd81979b29f5fd4ddf155987e588?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/982364/tom"}, "is_accepted": false, "score": 0, "last_activity_date": 1553953164, "last_edit_date": 1553953164, "creation_date": 1553914151, "answer_id": 55427703, "question_id": 55399900, "link": "https://stackoverflow.com/questions/55399900/handling-null-columns-in-rust-postgres/55427703#55427703", "title": "Handling NULL columns in rust-postgres", "body": "<p>I found something that works, though I'm not sure if it is the right solution:</p>\n\n<pre><code>let x: Option&lt;f64&gt; = row.get(1);\nif let Some(_i) = x {\n   // do something\n}\n</code></pre>\n"}], "owner": {"reputation": 1962, "user_id": 982364, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8f7fcd81979b29f5fd4ddf155987e588?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/982364/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 444, "favorite_count": 0, "closed_date": 1553953267, "answer_count": 1, "score": -2, "last_activity_date": 1553953232, "creation_date": 1553782732, "last_edit_date": 1553953232, "question_id": 55399900, "link": "https://stackoverflow.com/questions/55399900/handling-null-columns-in-rust-postgres", "closed_reason": "Duplicate", "title": "Handling NULL columns in rust-postgres", "body": "<p>I'm lost at something seemingly simple:</p>\n\n<pre><code>for row in &amp;conn.query(\"SELECT r.id, r.name, l.name \nFROM rating r LEFT JOIN location l ON r.loc_id = l.id\", &amp;[]).unwrap() {\n    let rating = Rating {\n        id: row.get(0),\n        name: row.get(1),\n    };\n}\n</code></pre>\n\n<p>This part works. What I can't get is the third column (<code>row.get(2)</code>).</p>\n\n<p>Due to the <code>LEFT JOIN</code>, this row can have a <code>NULL</code> value. I've read the documentation, the related answers here and lots of Google pages and can't figure it out.</p>\n\n<p>Obviously, I want to use <code>Option&lt;&gt;</code> somehow. And seemingly I want to use the <code>get_opt()</code> function.</p>\n\n<p>In pseudo-code, what I want is this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>if row[2] is not null,\nthen $location = row[2]\nelse $location = null\n</code></pre>\n"}, {"tags": ["multithreading", "rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1553774159, "post_id": 55396488, "comment_id": 97514156, "body": "Why is your input string in an <code>Arc</code> if you are using crossbeam? Why are you going out of your way to use hashbrown?"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1553774176, "post_id": 55396488, "comment_id": 97514163, "body": "The problem here is that parallelization doesn&#39;t help you at all, because a thread needs to own exclusivly the string. You can&#39;t operate with multiple threads on the same string at the same time. You have to split it beforehand. Your examples isn&#39;t very well thought."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1553782692, "post_id": 55399160, "comment_id": 97520120, "body": "I&#39;d add that the original algorithm is not very efficient as the amount of contention for the <code>HashMap</code> is going to be extreme. It would likely be much more efficient for each thread to have its own <code>HashMap</code> and merge them at the end. See also <a href=\"https://stackoverflow.com/q/50282619/155423\">Is it possible to share a HashMap between threads without locking the entire HashMap?</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1553783414, "post_id": 55399160, "comment_id": 97520734, "body": "<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=68e7f0214ca9bcfb90ba4f291e9f1f9b\" rel=\"nofollow noreferrer\">Something like this</a>"}], "tags": [], "owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "is_accepted": false, "score": 1, "last_activity_date": 1553785015, "last_edit_date": 1553785015, "creation_date": 1553780675, "answer_id": 55399160, "question_id": 55396488, "link": "https://stackoverflow.com/questions/55396488/parallel-word-count-with-multithreading-in-rust/55399160#55399160", "title": "Parallel Word Count with Multithreading in Rust", "body": "<p>Scoped threads allow you to borrow something <em>outside</em> the thread and use it <em>inside</em> the thread. They cannot allow you to do the opposite (borrow something <em>inside</em> the thread and let it escape).</p>\n\n<p><code>buffer.split_whitespace()</code> borrows <code>buffer</code>, which has been moved into the inner closure and is therefore owned by the current thread. Each <code>word</code> is a reference with a lifetime dependent on <code>buffer</code>, which will go out of scope when the thread exits. (The underlying <code>String</code> isn't destroyed, but <code>word</code> can only borrow from the <code>Arc</code>, which has a shorter lifetime. The same thing would be true if you just cloned a <code>String</code>).</p>\n\n<p><code>Arc</code> and scoped threads are somewhat at odds. <code>Arc</code> is used when you're sharing a thing between threads and you want the thing to be destroyed whenever the last thread exits. You don't generally know or care which thread is the one to destroy it, only that it gets destroyed. On the other hand, scoped threads are used when you <em>do</em> know where a thing should be destroyed, and <em>all</em> the threads that want access to it must definitely exit before that. Because the lifetimes are statically verified with scoped threads, you can use ordinary <code>&amp;</code> references instead of <code>Arc</code>. This goes both for the <code>String</code> and the <code>Mutex</code>.</p>\n\n<p>So let's apply this:</p>\n\n<pre><code>let buffer = String::from(\"Hello World Hello Rust\");\nlet frequency: Mutex&lt;HashMap&lt;&amp;str, u32&gt;&gt; = Mutex::new(HashMap::new());\n\ncrossbeam::scope(|scope| {\n    for _ in 0..1 {\n        scope.spawn(|_| {\n            for word in buffer.split_whitespace() {\n                let mut frequency = frequency.lock().unwrap();\n                *frequency.entry(word).or_insert(0) += 1;\n            }\n        });\n    }\n});\n</code></pre>\n\n<p>Oh, that was easy. Note there are no <code>move</code>s, no <code>Arc</code>s and no <code>clone()</code>s, and <code>frequency</code> will contain references to <code>buffer</code>, which is presumably what you wanted. For this to work, whatever string chunking approach you use must also borrow from the original <code>str</code>; you can't have a separate <code>String</code> for each thread.</p>\n\n<h2>Caveat</h2>\n\n<p>I'm unsure exactly how similar your example is meant to be to the original code. The above solution fixes the compile problem, but as Shepmaster points out:</p>\n\n<blockquote>\n  <p>I'd add that the original algorithm is not very efficient as the amount of contention for the <code>HashMap</code> is going to be extreme. It would likely be much more efficient for each thread to have its own <code>HashMap</code> and merge them at the end. [...] <a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=68e7f0214ca9bcfb90ba4f291e9f1f9b\" rel=\"nofollow noreferrer\">Something like this</a></p>\n</blockquote>\n\n<h2>See also</h2>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/50282619/155423\">Is it possible to share a HashMap between threads without locking the entire HashMap?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/33818141/how-do-i-pass-disjoint-slices-from-a-vector-to-different-threads\">How do I pass disjoint slices from a vector to different threads?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/32750829/how-can-i-pass-a-reference-to-a-stack-variable-to-a-thread\">How can I pass a reference to a stack variable to a thread?</a></li>\n</ul>\n"}], "owner": {"reputation": 968, "user_id": 1494845, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/735e7dcfac40d5d461224a8b3572285a?s=128&d=identicon&r=PG", "display_name": "Oliver", "link": "https://stackoverflow.com/users/1494845/oliver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1553785015, "creation_date": 1553772550, "last_edit_date": 1553774189, "question_id": 55396488, "link": "https://stackoverflow.com/questions/55396488/parallel-word-count-with-multithreading-in-rust", "title": "Parallel Word Count with Multithreading in Rust", "body": "<p>I want to count the frequency of words within a large string. </p>\n\n<p>The simple single threaded solution looks like this</p>\n\n<pre><code>use hashbrown::HashMap;\n\nfn main() {\n    let buffer = String::from(\"Hello World Hello Rust\");\n    let mut frequency: HashMap&lt;&amp;str, u32&gt; = HashMap::new();\n\n    for word in buffer.split_whitespace() {\n        *frequency.entry(word).or_insert(0) += 1;\n    }\n}\n</code></pre>\n\n<p>Then I tried to add some multi threading capabilities and ended up with the code below: </p>\n\n<pre><code>extern crate crossbeam;\n\nuse hashbrown::HashMap;\nuse std::sync::{Arc, Mutex};\n\nfn main() {\n    let buffer = Arc::new(String::from(\"Hello World Hello Rust\"));\n    let frequency: Arc&lt;Mutex&lt;HashMap&lt;&amp;str, u32&gt;&gt;&gt; = Arc::new(Mutex::new(HashMap::new()));\n\n    crossbeam::scope(|scope| {\n        for _ in 0..1 {\n            let buffer = buffer.clone();\n            let frequency = frequency.clone();\n\n            scope.spawn(move |_| {\n                for word in buffer.split_whitespace() {\n                    let mut frequency = frequency.lock().unwrap();\n                    *frequency.entry(word).or_insert(0) += 1;\n                }\n            });\n        }\n    });\n}\n</code></pre>\n\n<p>The compiler fails with the following message: </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0597]: `buffer` does not live long enough\n  --&gt; src/main.rs:16:29\n   |\n13 |             let frequency = frequency.clone();\n   |                 --------- lifetime `'1` appears in the type of `frequency`\n...\n16 |                 for word in buffer.split_whitespace() {\n   |                             ^^^^^^ borrowed value does not live long enough\n17 |                     let mut frequency = frequency.lock().unwrap();\n18 |                     *frequency.entry(word).or_insert(0) += 1;\n   |                      --------------------- argument requires that `buffer` is borrowed for `'1`\n19 |                 }\n20 |             });\n   |             - `buffer` dropped here while still borrowed\n</code></pre>\n\n<p>To simplify the code I removed string chunking and only spawn 1 thread within the for loop.</p>\n"}, {"tags": ["import", "rust", "rust-cargo"], "comments": [{"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1553763541, "post_id": 55393464, "comment_id": 97507584, "body": "What is the exact error message?"}, {"owner": {"reputation": 1, "user_id": 11268123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba2c4b54aa103909c69f827ecdd4df95?s=128&d=identicon&r=PG&f=1", "display_name": "user11268123", "link": "https://stackoverflow.com/users/11268123/user11268123"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1553763893, "post_id": 55393464, "comment_id": 97507772, "body": "@hellow <code>use x::x;</code> doesn&#39;t compile too."}, {"owner": {"reputation": 1, "user_id": 11268123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba2c4b54aa103909c69f827ecdd4df95?s=128&d=identicon&r=PG&f=1", "display_name": "user11268123", "link": "https://stackoverflow.com/users/11268123/user11268123"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1553763913, "post_id": 55393464, "comment_id": 97507779, "body": "@hellow <code>error[E0432]: unresolved import &#39;x&#39;</code>"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1553763936, "post_id": 55393464, "comment_id": 97507788, "body": "Please edit your question to add the error message instead of posting it as a comment, thanks :)"}, {"owner": {"reputation": 1, "user_id": 11268123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba2c4b54aa103909c69f827ecdd4df95?s=128&d=identicon&r=PG&f=1", "display_name": "user11268123", "link": "https://stackoverflow.com/users/11268123/user11268123"}, "reply_to_user": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1553764200, "post_id": 55393464, "comment_id": 97507947, "body": "@hellow yeah, it works; buy why this is so counterintuitive that I should use <code>mod x;</code> instead of <code>use x;</code>?"}], "owner": {"reputation": 1, "user_id": 11268123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba2c4b54aa103909c69f827ecdd4df95?s=128&d=identicon&r=PG&f=1", "display_name": "user11268123", "link": "https://stackoverflow.com/users/11268123/user11268123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 269, "favorite_count": 0, "closed_date": 1553770093, "answer_count": 0, "score": 0, "last_activity_date": 1553764025, "creation_date": 1553763218, "last_edit_date": 1553764025, "question_id": 55393464, "link": "https://stackoverflow.com/questions/55393464/rust-unresolved-import-x-no-x-in-the-root", "closed_reason": "Duplicate", "title": "Rust: unresolved import `X`: no `X` in the root", "body": "<p>I am getting <code>error[E0432]: unresolved import 'x'</code> when trying to compile <code>proj</code> via <code>cargo run</code>. Have no idea what is the problem.</p>\n\n<p><em>proj/src/main.rs:</em></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use x;\n\nfn main() -&gt; () {}\n</code></pre>\n\n<p><em>proj/src/x.rs:</em></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>pub fn test() -&gt; () {}\n</code></pre>\n\n<p>This won't work too:</p>\n\n<p><em>proj/src/x.rs:</em></p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>mod x {\n  pub fn test() -&gt; () {}\n}\n</code></pre>\n"}, {"tags": ["rust", "hashmap", "borrow-checker"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 3, "creation_date": 1553749285, "post_id": 55389847, "comment_id": 97502003, "body": "&quot;I can&#39;t clone my keys&quot; in which world ? I don&#39;t think you can in safe mode."}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 1, "creation_date": 1553757331, "post_id": 55389847, "comment_id": 97504741, "body": "I&#39;m afraid it&#39;s not possible, at least not if you want to return the key which has been removed. If you do not need to return the value you could use <code>retain</code> to remove the pair that fits your criteria."}, {"owner": {"reputation": 765, "user_id": 7246614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83eccd212e4687fc66e13aad21796b0b?s=128&d=identicon&r=PG", "display_name": "timotree", "link": "https://stackoverflow.com/users/7246614/timotree"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1553775044, "post_id": 55389847, "comment_id": 97514660, "body": "@Stargateur I edited it to make it more clear"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1553775183, "post_id": 55389847, "comment_id": 97514744, "body": "@timotree so let me be more clear, key in a hashmap should be clonable in 99% of use case. That very odd situation you have here. I advice you to describe why you can&#39;t clone the key."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1554057288, "post_id": 55389847, "comment_id": 97603643, "body": "See also <a href=\"https://stackoverflow.com/q/45724517/155423\">How to iterate through a Hashmap, print the key/value and remove the value in Rust?</a>; <a href=\"https://stackoverflow.com/q/32913368/155423\">Removing items from a BTreeMap or BTreeSet found through iteration</a>; <a href=\"https://stackoverflow.com/q/45311896/155423\">Rust loop on HashMap while borrowing self</a>;"}], "owner": {"reputation": 765, "user_id": 7246614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83eccd212e4687fc66e13aad21796b0b?s=128&d=identicon&r=PG", "display_name": "timotree", "link": "https://stackoverflow.com/users/7246614/timotree"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 170, "favorite_count": 2, "answer_count": 0, "score": 3, "last_activity_date": 1554056935, "creation_date": 1553744642, "last_edit_date": 1554056935, "question_id": 55389847, "link": "https://stackoverflow.com/questions/55389847/move-a-single-entry-that-meets-a-predicate-out-of-a-hashmap-when-the-key-is-not", "title": "Move a single entry that meets a predicate out of a HashMap when the key is not clonable", "body": "<p>I'm writing a function that works with a <code>HashMap</code> and at various points in the function I want to check if any of the values in the map meet a condition and if any does return the key for just one of the entries that meets the condition.</p>\n\n<p>So far, I tried to first iterate over references to check my condition, and then use <code>remove_entry</code> to get an owned copy of the key rather than a borrow: </p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::{collections::HashMap, hash::Hash};\n\nfn remove_first_odd&lt;K: Hash + Eq&gt;(map: &amp;mut HashMap&lt;K, u64&gt;) -&gt; Option&lt;K&gt; {\n    let maybe_entry = map.iter().find(|(_, &amp;value)| value &amp; 1 == 1);\n\n    match maybe_entry {\n        Some((key_ref, _value_ref)) =&gt; {\n            let (key_owned, _value_owned) = map.remove_entry(key_ref).unwrap();\n            Some(key_owned)\n        }\n        None =&gt; None,\n    }\n}\n</code></pre>\n\n<p>but this fails borrow checking, because I can't mutate the map while I am still holding a reference to one of the keys in it:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0502]: cannot borrow `*map` as mutable because it is also borrowed as immutable\n --&gt; src/lib.rs:8:45\n  |\n4 |     let maybe_entry = map.iter().find(|(_, &amp;value)| value &amp; 1 == 1);\n  |                       --- immutable borrow occurs here\n...\n8 |             let (key_owned, _value_owned) = map.remove_entry(key_ref).unwrap();\n  |                                             ^^^^------------^^^^^^^^^\n  |                                             |   |\n  |                                             |   immutable borrow later used by call\n  |                                             mutable borrow occurs here\n</code></pre>\n\n<p>I believe that this is possible, because as long as <code>remove_entry</code> only dereferences my key before mutation and not after, this should be sound.</p>\n\n<p>So is there a safe API to do this? If not, can one be created?</p>\n\n<p>Note that:</p>\n\n<ul>\n<li>I can't clone my keys because they are generic without a clone bound</li>\n<li>I can't consume the <code>HashMap</code> with something like <code>.into_iter()</code></li>\n<li>I only need to remove a single entry, not all of the entries that match</li>\n</ul>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 365, "user_id": 761485, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/51af9b9ae989c9b63780800c3ddaccda?s=128&d=identicon&r=PG", "display_name": "therealtypon", "link": "https://stackoverflow.com/users/761485/therealtypon"}, "reply_to_user": {"reputation": 2966, "user_id": 3022310, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7f10ec2b45320ee843e539d705c31d08?s=128&d=identicon&r=PG", "display_name": "turbulencetoo", "link": "https://stackoverflow.com/users/3022310/turbulencetoo"}, "edited": false, "score": 0, "creation_date": 1553741245, "post_id": 55389338, "comment_id": 97500352, "body": "I read the responses to that question - they don&#39;t help me. In my particular case, <code>TakesRef</code> is not code owned by me - its library code. I need a solution that doesn&#39;t require me to change the parameters of the problem, but solve it at the Wrapper level"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 2, "creation_date": 1553772497, "post_id": 55389338, "comment_id": 97513125, "body": "The way I see it, the solution is not to have <code>string</code> and <code>obj</code> together (hence, abolish <code>Wrapper</code> and rethink the API), which is one of the first recommendations in the proposed duplicate target."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1553773826, "post_id": 55389338, "comment_id": 97513963, "body": "I&#39;ve updated the duplicate with a selection of pre-existing Q&amp;A that I found by searching Stack Overflow for &quot;rental&quot;. The selected ones solve real problems, so they should be a good starting point, especially <a href=\"https://stackoverflow.com/a/50413062/155423\">this one</a>, which mirrors your situation exactly."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1553773078, "post_id": 55390817, "comment_id": 97513523, "body": "As described in the duplicate, pinning does not help you create a strict with a <b>reference</b> to itself. It only helps correctly use a raw pointer."}], "tags": [], "owner": {"reputation": 1291, "user_id": 6331045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/189f94db303d16b891800f11846bd753?s=128&d=identicon&r=PG&f=1", "display_name": "Laney", "link": "https://stackoverflow.com/users/6331045/laney"}, "is_accepted": false, "score": -1, "last_activity_date": 1553751546, "creation_date": 1553751546, "answer_id": 55390817, "question_id": 55389338, "link": "https://stackoverflow.com/questions/55389338/how-to-store-object-and-its-reference-in-struct/55390817#55390817", "title": "How to store object and its reference in struct", "body": "<p>such self-referential structures is the exact reason of why <code>std::pin</code> has been introduced. You might want to check <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/2349-pin.md\" rel=\"nofollow noreferrer\">this RFC</a> and <a href=\"https://doc.rust-lang.org/stable/std/pin/index.html#example-self-referential-struct\" rel=\"nofollow noreferrer\">this example</a> from documentation.</p>\n"}], "owner": {"reputation": 365, "user_id": 761485, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/51af9b9ae989c9b63780800c3ddaccda?s=128&d=identicon&r=PG", "display_name": "therealtypon", "link": "https://stackoverflow.com/users/761485/therealtypon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "closed_date": 1553772948, "answer_count": 1, "score": 0, "last_activity_date": 1553773640, "creation_date": 1553740409, "last_edit_date": 1553773640, "question_id": 55389338, "link": "https://stackoverflow.com/questions/55389338/how-to-store-object-and-its-reference-in-struct", "closed_reason": "Duplicate", "title": "How to store object and its reference in struct", "body": "<p>I've simplified the code and made a self-contained version of it as follows:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>struct TakesRef&lt;'a&gt; {\n    string_ref: &amp;'a str,\n}\n\nimpl&lt;'a&gt; TakesRef&lt;'a&gt; {\n    fn new(string_ref: &amp;'a str) -&gt; TakesRef&lt;'a&gt; {\n        TakesRef { string_ref }\n    }\n}\n\nstruct Wrapper&lt;'a&gt; {\n    string: String,\n    obj: TakesRef&lt;'a&gt;,\n}\n\nimpl&lt;'a&gt; Wrapper&lt;'a&gt; {\n    fn new(string: String) -&gt; Wrapper&lt;'a&gt; {\n        let obj = TakesRef::new(&amp;string);\n        Wrapper { obj, string }\n    }\n}\n</code></pre>\n\n<p>The error I get is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0515]: cannot return value referencing function parameter `string`\n  --&gt; src/lib.rs:19:9\n   |\n18 |         let obj = TakesRef::new(&amp;string);\n   |                                 ------- `string` is borrowed here\n19 |         Wrapper { obj, string }\n   |         ^^^^^^^^^^^^^^^^^^^^^^^ returns a value referencing data owned by the current function\n\nerror[E0505]: cannot move out of `string` because it is borrowed\n  --&gt; src/lib.rs:19:24\n   |\n16 | impl&lt;'a&gt; Wrapper&lt;'a&gt; {\n   |      -- lifetime `'a` defined here\n17 |     fn new(string: String) -&gt; Wrapper&lt;'a&gt; {\n18 |         let obj = TakesRef::new(&amp;string);\n   |                                 ------- borrow of `string` occurs here\n19 |         Wrapper { obj, string }\n   |         ---------------^^^^^^--\n   |         |              |\n   |         |              move out of `string` occurs here\n   |         returning this value requires that `string` is borrowed for `'a`\n</code></pre>\n\n<p>I can't change the definition of <code>TakesRef</code> since it is a library class. How can I design <code>Wrapper</code> to be able to store a <code>TakesRef</code> inside? I tried using the owned-ref and rental crates... as well as <code>RefCell</code> but I still can't figure out how to compile this code.</p>\n"}, {"tags": ["rust", "traits"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1553739406, "post_id": 55388564, "comment_id": 97499987, "body": "In the future, you are encouraged to try to solve your own problem before asking it and show some of your effort in the question."}, {"owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1553748000, "post_id": 55388564, "comment_id": 97501697, "body": "Well, of course I&#39;ve tried to solve this problem, but as the Rust compiler is very picky, the half dozen variations I tried all resulted in errors that didn&#39;t lead in the right direction. Perhaps in the future I will chronicle all my attempts as a part of my question to prove I&#39;ve not put no thought into it."}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1553770801, "post_id": 55388564, "comment_id": 97512055, "body": "@Listerone We can only consider effort that is visible in the question. In fact, the point of showing research effort is not as much about the effort done as it is about transmitting this effort to the question. In this case, we would expect you to show the examples of code that had failed to compile."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 2, "last_activity_date": 1553739246, "creation_date": 1553739246, "answer_id": 55389203, "question_id": 55388564, "link": "https://stackoverflow.com/questions/55388564/how-to-return-impl-trait-wrapped-inside-result/55389203#55389203", "title": "How to return impl trait wrapped inside Result?", "body": "<blockquote>\n  <p>How to return impl trait wrapped inside Result?</p>\n</blockquote>\n\n<p>By <em>returning an impl trait wrapped inside <code>Result</code></em>:</p>\n\n<pre><code>use std::{\n    fs::File,\n    io::{self, Read},\n};\n\nfn test() -&gt; io::Result&lt;impl Read&gt; {\n    let f = File::open(\"test.txt\")?;\n    Ok(f)\n}\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/27535289/155423\">What is the correct way to return an Iterator (or any other trait)?</a></li>\n<li><a href=\"https://stackoverflow.com/q/52001592/155423\">Why can impl trait not be used to return multiple / conditional types?</a></li>\n</ul>\n"}], "owner": {"reputation": 939, "user_id": 11140945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j5Esk.png?s=128&g=1", "display_name": "Listerone", "link": "https://stackoverflow.com/users/11140945/listerone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1553739246, "creation_date": 1553733825, "last_edit_date": 1553739078, "question_id": 55388564, "link": "https://stackoverflow.com/questions/55388564/how-to-return-impl-trait-wrapped-inside-result", "title": "How to return impl trait wrapped inside Result?", "body": "<p>I have a function that reads in some content either from a file or from the web, and returns the contents. For simplicity, let's use the following which is just for a file:</p>\n\n<pre><code>fn test() -&gt; Result&lt;Vec&lt;u8&gt;, Error&gt; {\n    let mut buf = Vec::new();\n    // Does some things that may error ...\n    File::open(\"test.txt\")?.read_to_end(&amp;mut buf)?;\n    Ok(buf)\n}\n</code></pre>\n\n<p>Is it possible to write this function such that it returns the <code>Read</code> trait wrapped inside <code>Result</code> instead so that it does not need to immediately read the full contents into memory? </p>\n"}]