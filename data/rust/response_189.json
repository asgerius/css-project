[{"tags": ["rust"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534978312, "post_id": 51975898, "comment_id": 90902705, "body": "Well, I not a mathematician but if you think there is a bug in this crate why don&#39;t you report this to... people who dev the crate ? supposedly on github ?"}], "answers": [{"tags": [], "owner": {"reputation": 2479, "user_id": 2370863, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/1A5At.jpg?s=128&g=1", "display_name": "Ian Fiddes", "link": "https://stackoverflow.com/users/2370863/ian-fiddes"}, "is_accepted": false, "score": 0, "last_activity_date": 1534977099, "creation_date": 1534977099, "answer_id": 51976043, "question_id": 51975898, "link": "https://stackoverflow.com/questions/51975898/checking-equality-of-two-trimat-matrices-written-to-matrix-market-format-in-sprs/51976043#51976043", "title": "Checking equality of two TriMat matrices written to Matrix Market format in sprs does not work if insertion order is different", "body": "<p>Turns out you can convert to CSR to get it to work:</p>\n\n<pre><code>let seen_mat: TriMat&lt;usize&gt; = read_matrix_market(\"a.mtx\").unwrap();\nlet expected_mat: TriMat&lt;usize&gt; = read_matrix_market(\"b.mtx\").unwrap();\nlet a = seen_mat.to_csr();\nlet b = expected_mat.to_csr();\nassert_eq!(a, b);\n</code></pre>\n"}], "owner": {"reputation": 2479, "user_id": 2370863, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/1A5At.jpg?s=128&g=1", "display_name": "Ian Fiddes", "link": "https://stackoverflow.com/users/2370863/ian-fiddes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1534977099, "creation_date": 1534976175, "question_id": 51975898, "link": "https://stackoverflow.com/questions/51975898/checking-equality-of-two-trimat-matrices-written-to-matrix-market-format-in-sprs", "title": "Checking equality of two TriMat matrices written to Matrix Market format in sprs does not work if insertion order is different", "body": "<p>I am trying to check if two Matrix Market format files contain the same matrix. In my actual code, due to the use of multi-threading, there is no guarantee that I am inserting items into a <code>TriMat</code> in the same order before being serialized to disk. As a result, when I load the resulting files and compare them, they are not always the same. How can I compare two different <code>.mtx</code> files and ensure that they are the same, regardless of insertion order?</p>\n\n<p>Example code:</p>\n\n<pre><code>extern crate sprs;\nuse sprs::io::{write_matrix_market, read_matrix_market};\nuse sprs::TriMat;\n\nfn main() {\n    let mut mat = TriMat::new((4, 20));\n    let mut vals = Vec::new();\n    vals.push((0, 19, 1));\n    vals.push((1, 14, 1));\n    vals.push((1, 19, 1));\n    vals.push((2, 17, 2));\n    for (i, j, v) in vals {\n        mat.add_triplet(i, j, v)\n    }\n    let _ = write_matrix_market(\"a.mtx\", &amp;mat).unwrap();\n\n    let mut mat2 = TriMat::new((4, 20));\n    let mut vals2 = Vec::new();\n    vals2.push((0, 19, 1));\n    vals2.push((1, 14, 1));\n    vals2.push((2, 17, 2)); // different order\n    vals2.push((1, 19, 1));\n    for (i, j, v) in vals2 {\n        mat2.add_triplet(i, j, v)\n    }\n    let _ = write_matrix_market(\"b.mtx\", &amp;mat2).unwrap();\n\n    let seen_mat: TriMat&lt;usize&gt; = read_matrix_market(\"a.mtx\").unwrap();\n    let expected_mat: TriMat&lt;usize&gt; = read_matrix_market(\"b.mtx\").unwrap();\n    assert_eq!(seen_mat, expected_mat);\n}\n</code></pre>\n\n<p>And the resulting error:</p>\n\n<pre><code>thread 'main' panicked at 'assertion failed: `(left == right)`\n  left: `TriMatBase { rows: 4, cols: 20, row_inds: [0, 1, 1, 2], col_inds: [19, 14, 19, 17], data: [1, 1, 1, 2] }`,\n right: `TriMatBase { rows: 4, cols: 20, row_inds: [0, 1, 2, 1], col_inds: [19, 14, 17, 19], data: [1, 1, 2, 1] }`', src/main.rs:31:5\nnote: Run with `RUST_BACKTRACE=1` for a backtrace.\n</code></pre>\n\n<p>You can see that these two matrices are actually identical, but that the items have been inserted in different orders.</p>\n"}, {"tags": ["rust", "closures", "lifetime", "borrow-checker", "borrowing"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 12, "creation_date": 1534949281, "post_id": 51969236, "comment_id": 90889448, "body": "Please post code rather than screenshots. It&#39;s much easier for someone to help you if they can copy/paste your code."}], "answers": [{"comments": [{"owner": {"reputation": 586, "user_id": 2738247, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wBoWJzL5n2I/AAAAAAAAAAI/AAAAAAAAADg/lEWJ2PPAVT8/photo.jpg?sz=128", "display_name": "robertohuertasm", "link": "https://stackoverflow.com/users/2738247/robertohuertasm"}, "edited": false, "score": 0, "creation_date": 1534966507, "post_id": 51969714, "comment_id": 90898303, "body": "Thanks Peter! Your suggestion worked as you described! I didn&#39;t know about the Higher-ranked trait bound and I was going crazy trying to find a way to change the bound lifetime of the closure. I really appreciate your input and your thorough explanation! :D"}, {"owner": {"reputation": 3212, "user_id": 2731452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xA89V.jpg?s=128&g=1", "display_name": "red75prime", "link": "https://stackoverflow.com/users/2731452/red75prime"}, "reply_to_user": {"reputation": 586, "user_id": 2738247, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wBoWJzL5n2I/AAAAAAAAAAI/AAAAAAAAADg/lEWJ2PPAVT8/photo.jpg?sz=128", "display_name": "robertohuertasm", "link": "https://stackoverflow.com/users/2738247/robertohuertasm"}, "edited": false, "score": 1, "creation_date": 1535009962, "post_id": 51969714, "comment_id": 90910822, "body": "@robertohuertasm, omitting lifetimes from <code>CheckFn</code> (<code>type CheckFn = dyn Fn(&amp;AstNode)</code>) should work too. <a href=\"https://doc.rust-lang.org/reference/lifetime-elision.html\" rel=\"nofollow noreferrer\">Lifetime elision rules</a> kick in and to the right thing."}, {"owner": {"reputation": 586, "user_id": 2738247, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wBoWJzL5n2I/AAAAAAAAAAI/AAAAAAAAADg/lEWJ2PPAVT8/photo.jpg?sz=128", "display_name": "robertohuertasm", "link": "https://stackoverflow.com/users/2738247/robertohuertasm"}, "edited": false, "score": 0, "creation_date": 1535014829, "post_id": 51969714, "comment_id": 90913539, "body": "I&#39;ve tried to omit the lifetimes but it doesn&#39;t work for me. I get this error: <code>expected signature of for&lt;&#39;r, &#39;s&gt; fn(&amp;&#39;r comrak::arena_tree::Node&lt;&#39;s, std::cell::RefCell&lt;comrak::nodes::Ast&gt;&gt;) -&gt; _</code> , <code>found signature of for&lt;&#39;a&gt; fn(&amp;&#39;a comrak::arena_tree::Node&lt;&#39;a, std::cell::RefCell&lt;comrak::nodes::Ast&gt;&gt;) -&gt; _</code>. Note that it works as intended using HRTB"}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "reply_to_user": {"reputation": 586, "user_id": 2738247, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wBoWJzL5n2I/AAAAAAAAAAI/AAAAAAAAADg/lEWJ2PPAVT8/photo.jpg?sz=128", "display_name": "robertohuertasm", "link": "https://stackoverflow.com/users/2738247/robertohuertasm"}, "edited": false, "score": 0, "creation_date": 1535015016, "post_id": 51969714, "comment_id": 90913665, "body": "@robertohuertasm It works for me. It&#39;s very hard to comment further because your question did not provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 586, "user_id": 2738247, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wBoWJzL5n2I/AAAAAAAAAAI/AAAAAAAAADg/lEWJ2PPAVT8/photo.jpg?sz=128", "display_name": "robertohuertasm", "link": "https://stackoverflow.com/users/2738247/robertohuertasm"}, "edited": false, "score": 0, "creation_date": 1535015405, "post_id": 51969714, "comment_id": 90913920, "body": "@PeterHall, this is from a project I&#39;m working on to learn Rust. It&#39;s published in Github. You can download it if you want. The line with the closure type is <a href=\"https://github.com/robertohuertasm/rusty-markdownlint/blob/master/rusty-markdownlint/src/ruleset.rs#L8\" rel=\"nofollow noreferrer\">here</a>. Sorry for not being able to provide anything better. I want to reiterate my appreciation for your help :P"}], "tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": true, "score": 4, "last_activity_date": 1535021659, "last_edit_date": 1535021659, "creation_date": 1534949918, "answer_id": 51969714, "question_id": 51969236, "link": "https://stackoverflow.com/questions/51969236/lifetime-issues-with-a-closure-argument-in-rust/51969714#51969714", "title": "Lifetime issues with a closure argument in Rust", "body": "<blockquote>\n  <p>They have exactly the same signature and even the same body.</p>\n</blockquote>\n\n<p>The body is not relevant because the type checker treats functions as a black box, and only looks at types. But, while the signatures may <em>look</em> the same, they are not. The difference is how the lifetime parameter is bound.</p>\n\n<p>The lifetime parameter <code>'a</code> of <code>print&lt;'a&gt;</code> is bound at the point that you call it. Since you are passing <code>root</code> as the argument, and <code>root</code> is a reference, you are implicitly instantiating <code>'a</code> to be the lifetime of that reference. This is exactly what you want because <code>root</code> lives longer than the call to <code>print</code>.</p>\n\n<p>But the lifetime parameter <code>'a</code> of <code>check&lt;'a&gt;</code> is bound <em>before</em> you call it. Instead, you have bound it to the lifetime parameter of the function <code>it_does_not_have_details_if_all_ok&lt;'a&gt;</code>, which is determined by the caller of <code>it_does_not_have_details_if_all_ok</code>, so could be any lifetime that is longer than this function call. This is definitely not what you want because:</p>\n\n<ol>\n<li>The reference <code>root</code> does not live that long (because it holds a reference to <code>arena</code> which is local to the function).</li>\n<li>The function <code>check</code> does not even need its argument to live that long.</li>\n</ol>\n\n<p>This is exactly the same as the reason why <a href=\"https://stackoverflow.com/questions/32682876/is-there-any-way-to-return-a-reference-to-a-variable-created-in-a-function#32683309\">you can't return a reference to a variable created in a function</a>. The difference is that you don't actually even need this lifetime constraint.</p>\n\n<p>I can't easily test this out because you only posted an image of your code, and you have a few definitions not provided. But the quick fix is to use a <a href=\"https://doc.rust-lang.org/nomicon/hrtb.html\" rel=\"nofollow noreferrer\">higher-ranked trait bound</a> (HRTB) on <code>CheckFn</code>:</p>\n\n<pre><code>type CheckFn = dyn for&lt;'a&gt; Fn(&amp;'a AstNode&lt;'a&gt;);\n</code></pre>\n\n<p>This gets rid of the need to bind <code>'a</code> whenever you mention <code>CheckFn</code>. Instead, the lifetimes are bound at the point when the inner function is called, just like it is for <code>print</code>.</p>\n\n<p>As pointed out in the comments, you can elide these lifetimes altogether:</p>\n\n<pre><code>type CheckFn = dyn Fn(&amp;AstNode);\n</code></pre>\n\n<p>This will cause the type checker to infer the lifetimes slightly more generally than above:</p>\n\n<pre><code>type CheckFn = dyn for&lt;'a, 'b&gt; Fn(&amp;'a AstNode&lt;'b&gt;);\n</code></pre>\n"}], "owner": {"reputation": 586, "user_id": 2738247, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wBoWJzL5n2I/AAAAAAAAAAI/AAAAAAAAADg/lEWJ2PPAVT8/photo.jpg?sz=128", "display_name": "robertohuertasm", "link": "https://stackoverflow.com/users/2738247/robertohuertasm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 840, "favorite_count": 1, "accepted_answer_id": 51969714, "answer_count": 1, "score": 1, "last_activity_date": 1535021659, "creation_date": 1534948406, "last_edit_date": 1535012432, "question_id": 51969236, "link": "https://stackoverflow.com/questions/51969236/lifetime-issues-with-a-closure-argument-in-rust", "title": "Lifetime issues with a closure argument in Rust", "body": "<p>I'm getting an error when trying to use a closure that does exactly the same as the <code>print</code> function below (in ln.9)</p>\n\n<p>The error is the usual <code>borrowed value does not live long enough</code>. I've tried to replicate this in the <code>playground</code> but I can't. I'm certain that this is mainly because I don't really understand what's going on here so any help would be really appreciated.</p>\n\n<p>What I can't understand is what is the difference between calling the <code>print</code> function and calling the <code>check</code> closure. They have exactly the same signature and even the same body. </p>\n\n<p>How does the context in which they were created affect the borrow checker? What would be the solution to this?</p>\n\n<pre><code>extern crate typed_arena;\nuse typed_arena::Arena;\n\n#[derive(Debug)]\nstruct AstNode&lt;'a&gt; {\n    name: &amp;'a str,\n}\n\nfn get_ast&lt;'a&gt;(path: &amp;str, arena: &amp;'a Arena&lt;AstNode&lt;'a&gt;&gt;) -&gt; &amp;'a AstNode&lt;'a&gt; {\n   // ...\n}\n\ntype CheckFn&lt;'a&gt; = dyn Fn(&amp;'a AstNode&lt;'a&gt;);\n\nfn print&lt;'a&gt;(root: &amp;'a AstNode&lt;'a&gt;) {\n    println!(\"{:?}\", root);\n}\n\nfn it_does_not_have_details_if_all_ok&lt;'a&gt;(file: &amp;str, check: Box&lt;CheckFn&lt;'a&gt;&gt;) {\n    let arena = Arena::new();\n    let a = &amp;arena;\n    let root = get_ast(file, a);\n    println!(\"{:?}\", root);\n    // Works\n    print(root);\n    // Produces an error\n    check(root);\n}   \n</code></pre>\n\n<p>The error is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0597]: `arena` does not live long enough\n  --&gt; src/main.rs:21:14\n   |\n21 |     let a = &amp;arena;\n   |              ^^^^^ borrowed value does not live long enough\n...\n28 | }   \n   | - borrowed value only lives until here\n   |\nnote: borrowed value must be valid for the lifetime 'a as defined on the function body at 19:1...\n  --&gt; src/main.rs:19:1\n   |\n19 | fn it_does_not_have_details_if_all_ok&lt;'a&gt;(file: &amp;str, check: Box&lt;CheckFn&lt;'a&gt;&gt;) {\n   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n</code></pre>\n"}, {"tags": ["oop", "rust"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1534942287, "post_id": 51966865, "comment_id": 90884579, "body": "&quot;subtrait&quot; would mean <code>trait RT: R { ... }</code> (which might also be something you want). You just have a regular trait and a &quot;blanket <code>impl</code>&quot;"}, {"owner": {"reputation": 53, "user_id": 8703719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2e93a039e2030654c0fece15ebd251?s=128&d=identicon&r=PG&f=1", "display_name": "xvlc0", "link": "https://stackoverflow.com/users/8703719/xvlc0"}, "reply_to_user": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1534943695, "post_id": 51966865, "comment_id": 90885555, "body": "You are correct, that&#39;s why I put &quot;subtrait&quot; in quotes. Would <code>trait RT: R</code> make a difference to the current state of things?"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1534947596, "post_id": 51966865, "comment_id": 90888241, "body": "Not in terms of your actual question, no. I think it can make a difference to what the compiler can deduce about types in certain situations, but I can&#39;t think of an example right now."}, {"owner": {"reputation": 8378, "user_id": 124538, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/82159aeb57c52bc0c7bfe6e9c832c3ea?s=128&d=identicon&r=PG", "display_name": "Wesley Wiser", "link": "https://stackoverflow.com/users/124538/wesley-wiser"}, "edited": false, "score": 0, "creation_date": 1534950920, "post_id": 51966865, "comment_id": 90890453, "body": "In Java, this line of reasoning makes sense because concrete classes implementing your interface can override the default implementation you&#39;ve provided as necessary. In (stable) Rust, you <i>cannot</i> do that. Given this constraint, it doesn&#39;t make sense that you could implement equality checks for between any two types simply because they implement your <code>RT</code> trait. Usually, the more ideomatic thing to do in Rust is add constraints to your methods something along the lines of <code>&lt;T where T: RT + PartialEq&lt;T&gt;&gt;</code>. The exact constraint would depend on your requirements."}, {"owner": {"reputation": 53, "user_id": 8703719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2e93a039e2030654c0fece15ebd251?s=128&d=identicon&r=PG&f=1", "display_name": "xvlc0", "link": "https://stackoverflow.com/users/8703719/xvlc0"}, "edited": false, "score": 0, "creation_date": 1535027287, "post_id": 51966865, "comment_id": 90920929, "body": "Well, that answers my question, I guess. What do you mean by &quot;stable&quot; exactly. Is there something on the horizon in nightly rust?"}, {"owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "edited": false, "score": 1, "creation_date": 1535033115, "post_id": 51966865, "comment_id": 90924891, "body": "I believe (and I may be wrong) that they&#39;re referring to the fact that you can&#39;t currently have multiple overlapping implementations of a trait. The <a href=\"https://github.com/rust-lang/rust/issues/31844\" rel=\"nofollow noreferrer\">specialization</a> feature, which is currently only on nightly, intends to make it so you can override one impl with a more specific one."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1535034085, "post_id": 51966865, "comment_id": 90925535, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/25339603/155423\">How to test for equality between trait objects?</a>. If you disagree, please <a href=\"https://stackoverflow.com/posts/51966865/edit\">edit</a> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 53, "user_id": 8703719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2e93a039e2030654c0fece15ebd251?s=128&d=identicon&r=PG&f=1", "display_name": "xvlc0", "link": "https://stackoverflow.com/users/8703719/xvlc0"}, "edited": false, "score": 0, "creation_date": 1535189789, "post_id": 51966865, "comment_id": 90982029, "body": "If I understand the linked response correctly, it only works with <code>&#39;static</code> references, which does not apply to my problem."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1546349617, "post_id": 51966865, "comment_id": 94829040, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/25339603/how-to-test-for-equality-between-trait-objects\">How to test for equality between trait objects?</a>"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1546349784, "post_id": 51966865, "comment_id": 94829082, "body": "It is not true that the answers to the linked question require <code>&#39;static</code> references, so I have voted to close this one."}], "answers": [{"tags": [], "owner": {"reputation": 3054, "user_id": 115030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c74c0974c6cc25c194a2737e2d6747?s=128&d=identicon&r=PG", "display_name": "Anders Kaseorg", "link": "https://stackoverflow.com/users/115030/anders-kaseorg"}, "is_accepted": false, "score": 2, "last_activity_date": 1546300682, "creation_date": 1546300682, "answer_id": 53992207, "question_id": 51966865, "link": "https://stackoverflow.com/questions/51966865/how-do-i-make-many-different-structs-that-all-implement-the-same-trait-comparabl/53992207#53992207", "title": "How do I make many different structs that all implement the same trait comparable to each other?", "body": "\n\n<p>That pattern often arises in Java to emulate tagged unions, which are missing from the Java language.  In Rust, unless you are writing a library whose users may need to define new implementations of <code>RT</code>, I suspect you\u2019ll be happier with an <code>enum</code> instead of a trait object:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>#[derive(PartialEq, Eq)]\nenum AnyRT {\n    RV(RV),\n    I(I),\n    U(U),\n}\n\nimpl RT for AnyRT {\n    fn foo(&amp;self, ...) {\n        match self {\n            AnyRT::RV(rv) =&gt; rv.foo(...),\n            AnyRT::I(i) =&gt; i.foo(...),\n            AnyRT::U(u) =&gt; u.foo(...),\n        }\n    }\n}\n</code></pre>\n\n<p>Depending on your application, you may then find that you don\u2019t need the <code>RT</code> trait and/or the separate <code>RV</code>, <code>I</code>, <code>U</code> structs at all.</p>\n"}], "owner": {"reputation": 53, "user_id": 8703719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b2e93a039e2030654c0fece15ebd251?s=128&d=identicon&r=PG&f=1", "display_name": "xvlc0", "link": "https://stackoverflow.com/users/8703719/xvlc0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1546300682, "creation_date": 1534940741, "last_edit_date": 1535034040, "question_id": 51966865, "link": "https://stackoverflow.com/questions/51966865/how-do-i-make-many-different-structs-that-all-implement-the-same-trait-comparabl", "title": "How do I make many different structs that all implement the same trait comparable to each other?", "body": "<p>In Java-lingo, I have an <code>interface R</code>, an <code>interface RT extends R</code> (where <code>RT</code> implements all of <code>R</code>) and a bunch of other classes that all implement <code>RT</code>.</p>\n\n<p>Transitioning to Rust I ended up with two traits</p>\n\n<pre><code>trait R { ... }\ntrait RT { ... }\n</code></pre>\n\n<p>where <code>RT</code> is a \"subtrait\" of <code>R</code>:</p>\n\n<pre><code>impl R for X where X: RT { ... }\n</code></pre>\n\n<p>Following that I have a bunch of structs, all of which implement <code>RT</code>:</p>\n\n<pre><code>struct RV { ... }\nimpl RT for RV { ... }\n\nstruct I { ... }\nimpl RT for I { ... }\n\nstruct U { ... }\nimpl RT for U { ... }\n\n// ...\n</code></pre>\n\n<p>So far so good.</p>\n\n<p>Now I want all of these structs to be comparable to each other, on the basis that all of them implement <code>RT</code>.</p>\n\n<p>In Java I would change <code>RT</code> to </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>interface RT extends R, Comparable&lt;RT&gt;\n</code></pre>\n\n<p>and add a default implementation for <code>equals</code> and <code>compareTo</code>.</p>\n\n<p>In Rust I have no idea if or how this could be approached.</p>\n\n<p>I could say <code>trait RT: PartialEq</code>, but that would only make one implementation comparable with itself (<code>RV == RV</code>, but not <code>RV == U</code>).</p>\n\n<p>My next idea was to add blanket implementations for every struct:</p>\n\n<pre><code>impl PartialEq&lt;RV&gt; for X where X: RT\nimpl PartialEq&lt;I&gt; for X where X: RT\n// ...\n</code></pre>\n\n<p>I understand why this isn't allowed, however I'm still stuck with my initial problem.</p>\n\n<p>I can't cast the values for comparison (<code>RV as RT == U as RT</code>) because <code>RT</code> can't be made into an object.</p>\n\n<p>I could manually implement <code>PartialEq&lt;T&gt;</code> for every combination of structs but that would be a lot of duplication.</p>\n\n<p>I considered using a macro to generate all the different implementations, but that feels so much like brute-forcing, that I question the initial design of my program.</p>\n\n<p>How do I make all the different structs comparable to each other?</p>\n"}, {"tags": ["macros", "rust"], "answers": [{"tags": [], "owner": {"reputation": 44438, "user_id": 42353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f05e802879a805c03a55645dfcc0d4ea?s=128&d=identicon&r=PG", "display_name": "DK.", "link": "https://stackoverflow.com/users/42353/dk"}, "is_accepted": false, "score": 1, "last_activity_date": 1534939821, "creation_date": 1534939821, "answer_id": 51966575, "question_id": 51965979, "link": "https://stackoverflow.com/questions/51965979/use-output-of-macro-as-parameter-for-another-macro/51966575#51966575", "title": "Use output of macro as parameter for another macro", "body": "<blockquote>\n  <p>My question now: Is there any way to tell Rust to expand the macro and use the expanded syntax as my list of arguments in another macro ?</p>\n</blockquote>\n\n<p>No.  Macros are <em>syntactic</em>, not lexical.  That is, a macro <em>cannot</em> expand to an arbitrary bundle of tokens.  Even if it could, you would need some way to force the compiler to expand the inner macro before the outer one, and you can't do that either.</p>\n\n<p>The closest you can get is to use a \"callback\" style:</p>\n\n<pre><code>macro_rules! impl_point_accessors {    \n    ($type_name: ident, $coord_name: ident, $coord_index: expr) =&gt; {\n        impl&lt;T&gt; $type_name&lt;T&gt; {\n            pub fn $coord_name(&amp;self) -&gt; T {\n                panic!(\"coord {}\", $coord_index);\n            }\n        }\n    };\n\n    ($type_name: ident, $coord_name: ident, $coord_index: expr, $($extra_coord_name: ident, $extra_coord_index: expr),+) =&gt; {\n        impl_point_accessors!($type_name, $coord_name, $coord_index);\n        impl_point_accessors!($type_name, $($extra_coord_name, $extra_coord_index), +);\n    }\n}\n\nmacro_rules! dimension_to_coord_pairs {\n    (1, then $cb:ident!($($cb_args:tt)*)) =&gt; {\n        $cb!($($cb_args)* x, 0);\n    };\n    (2, then $cb:ident!($($cb_args:tt)*)) =&gt; {\n        $cb!($($cb_args)* x, 0, y, 1);\n    };\n    (3, then $cb:ident!($($cb_args:tt)*)) =&gt; {\n        $cb!($($cb_args)* x, 0, y, 1, z, 2);\n    };\n    (4, then $cb:ident!($($cb_args:tt)*)) =&gt; {\n        $cb!($($cb_args)* x, 0, y, 1, z, 2, w, 3);\n    };\n}\n\nstruct Point&lt;T&gt;(Vec&lt;T&gt;);\n\ndimension_to_coord_pairs!(2, then impl_point_accessors!(Point,));\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44438, "user_id": 42353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f05e802879a805c03a55645dfcc0d4ea?s=128&d=identicon&r=PG", "display_name": "DK.", "link": "https://stackoverflow.com/users/42353/dk"}, "edited": false, "score": 0, "creation_date": 1534996361, "post_id": 51969169, "comment_id": 90905958, "body": "&quot;I&#39;m not 100% sure why ...&quot;: because token matching is only done on actual tokens.  As soon as you capture something as anything other than <code>ident</code> or <code>tt</code>, it&#39;s no longer a token, it&#39;s a syntax tree."}, {"owner": {"reputation": 18645, "user_id": 50385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2faf0c72f6a7f65431e7df489878be24?s=128&d=identicon&r=PG", "display_name": "Joseph Garvin", "link": "https://stackoverflow.com/users/50385/joseph-garvin"}, "edited": false, "score": 0, "creation_date": 1594563988, "post_id": 51969169, "comment_id": 111163526, "body": "I think it&#39;s unfortunate that an outer macro invocation that is consuming an inner macro invocation can&#39;t opt-in ask the compiler to expand the inner invocation before continuing. This feature is present in lisp macro systems and is necessary in some cases for writing macros that compose properly. If the outer macro wants to change behavior based on an argument to the inner macro (say inner has a name argument and outer is collecting all the names from all the inner macro invocations) then outer can only inspect the name so long as the name itself isn&#39;t specified with a macro invocation."}], "tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": true, "score": 1, "last_activity_date": 1534962374, "last_edit_date": 1534962374, "creation_date": 1534948156, "answer_id": 51969169, "question_id": 51965979, "link": "https://stackoverflow.com/questions/51965979/use-output-of-macro-as-parameter-for-another-macro/51969169#51969169", "title": "Use output of macro as parameter for another macro", "body": "<p>A macro can invoke another macro, but one cannot take the result of another. Each macro invocation must result in legal code, which can include other macro invocations, but the compiler should never have to figure out which macro you intended to be invoked first.</p>\n\n<p>You can work around your problem by reorganising the macros to be completely top-down, something like this:</p>\n\n<pre><code>macro_rules! define_point {\n    ($type_name: ident, $dimension: tt) =&gt; {\n        pub struct $type_name&lt;T&gt; {\n            coords: [T; $dimension]\n        }\n        impl_point_accessors!($type_name, $dimension);\n    }\n}\n\nmacro_rules! impl_point_accessors {    \n    ($type_name: ident, $dimension: tt) =&gt; {\n        impl&lt;T&gt; $type_name&lt;T&gt; {\n            write_coord_getters!($dimension);\n        }\n    };\n}\n\nmacro_rules! coord_getter {\n    ($coord_name: ident, $coord_index: expr, $ret: ty) =&gt; {\n        pub fn $coord_name(&amp;self) -&gt; &amp;T {\n            &amp;self.coords[$coord_index]\n        }\n    }\n}\n\nmacro_rules! write_coord_getters {\n    (1) =&gt; {\n        coord_getter!(x, 1, T);\n    };\n    (2) =&gt; {\n        write_coord_getters!(1);\n        coord_getter!(y, 2, T);\n    };\n    (3) =&gt; {\n        write_coord_getters!(2);\n        coord_getter!(z, 3, T);\n    };\n    (4) =&gt; {\n        write_coord_getters!(3);\n        coord_getter!(w, 4, T);\n    };\n}\n</code></pre>\n\n<p>It's not quite as tidy as you were attempting, but it still lets you invoke it the way you wanted:</p>\n\n<pre><code>define_point!(Point3, 3);\n</code></pre>\n\n<p>Notice that I changed <code>$dimension: expr</code> to <code>$dimension: tt</code>. I'm not 100% sure why this is the case but, inside a macro, a variable of type <code>expr</code> cannot match a literal.</p>\n\n<p>Also, I changed the return type to <code>&amp;T</code> instead of <code>T</code>. You could also fix the same problem by making <code>T: Copy</code> instead.</p>\n"}], "owner": {"reputation": 3849, "user_id": 5198595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2e45c7ec5cb67cf3cdf2186d8037e29?s=128&d=identicon&r=PG&f=1", "display_name": "Sunreef", "link": "https://stackoverflow.com/users/5198595/sunreef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1699, "favorite_count": 1, "accepted_answer_id": 51969169, "answer_count": 2, "score": 4, "last_activity_date": 1534962374, "creation_date": 1534937747, "question_id": 51965979, "link": "https://stackoverflow.com/questions/51965979/use-output-of-macro-as-parameter-for-another-macro", "title": "Use output of macro as parameter for another macro", "body": "<p>I am trying to implement a generic <code>Point&lt;T&gt;</code> type for small dimensions.</p>\n\n<p>To achieve that, I wrote a macro that takes the name of the new type and the dimension of the point (since, as far as I know, Rust doesn't allow for numerical generics).</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>macro_rules! define_point {\n($type_name: ident, $dimension: expr) =&gt; {\n        pub struct $type_name&lt;T&gt; {\n            coords: [T; $dimension]\n        }\n    }\n}\n</code></pre>\n\n<p>I use it like this:</p>\n\n<pre><code>define_point!(Point2, 2);\ndefine_point!(Point3, 3);\n</code></pre>\n\n<p>This works fine. I also implement the <code>Index</code> trait on my Point type in this macro to access the coordinates directly.</p>\n\n<p>Now I want some convenience functions for accessing the coordinates of my point as follows: <code>p.x()</code>, <code>p.y()</code> or <code>p.z()</code> depending on the dimension.</p>\n\n<p>To do that, I have another macro:</p>\n\n<pre><code>macro_rules! impl_point_accessors {    \n    ($type_name: ident, $coord_name: ident, $coord_index: expr) =&gt; {\n        impl&lt;T&gt; $type_name&lt;T&gt; {\n            pub fn $coord_name(&amp;self) -&gt; T {\n                &amp;self[$coord_index]\n            }\n        }\n    };\n\n    ($type_name: ident, $coord_name: ident, $coord_index: expr, $($extra_coord_name: ident, $extra_coord_index: expr),+) =&gt; {\n        impl_point_accessors!($type_name, $coord_name, $coord_index);\n        impl_point_accessors!($type_name, $($extra_coord_name, $extra_coord_index), +);\n    }\n}\n</code></pre>\n\n<p>I use it as follows:</p>\n\n<pre><code>impl_point_accessors!(Point2, x, 0, y, 1);\nimpl_point_accessors!(Point3, x, 0, y, 1, z, 2);\n</code></pre>\n\n<p>This seems to work when I look at the result of <code>rustc --pretty=expanded</code>.</p>\n\n<p>Now, as an exercise, I wrote this other macro that would give me the list <code>x, 0, y, 1, ...</code> from the dimension directly:</p>\n\n<pre><code>macro_rules! dimension_to_coord_pairs {\n    (1) =&gt; {\n        x, 0\n    };\n    (2) =&gt; {\n        x, 0, y, 1\n    };\n    (3) =&gt; {\n        x, 0, y, 1, z, 2\n    };\n    (4) =&gt; {\n        x, 0, y, 1, z, 2, w, 3\n    };\n}\n</code></pre>\n\n<p>However, when I try to use the output of this new macro like this:</p>\n\n<pre><code>impl_point_accessors!($type_name, dimension_to_coord_pairs!($dimension));\n</code></pre>\n\n<p>It looks like the <code>dimension_to_coord_pairs</code> macro does not get expanded into the list of arguments that I want.</p>\n\n<p>My question now: Is there any way to tell Rust to expand the macro and use the expanded syntax as my list of arguments in another macro ?</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 22583, "user_id": 1103681, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/rMUo3.png?s=128&g=1", "display_name": "oli_obk", "link": "https://stackoverflow.com/users/1103681/oli-obk"}, "is_accepted": true, "score": 8, "last_activity_date": 1534927548, "creation_date": 1534927548, "answer_id": 51962991, "question_id": 51962931, "link": "https://stackoverflow.com/questions/51962931/is-it-possible-to-group-items-that-need-the-same-attribute/51962991#51962991", "title": "Is it possible to group items that need the same attribute?", "body": "<p>You can use a helper module to cfg the entire module and then reexport its contents:</p>\n\n<pre><code>#[cfg(target_os = \"linux\")]\nmod linux {\n    extern crate nix;\n    extern crate libc;\n    pub use std::{\n        mem,\n    };\n}\n#[cfg(target_os = \"linux\")]\nuse linux::*;\n</code></pre>\n\n<p>You still have to mention the cfg twice though.</p>\n"}], "owner": {"reputation": 5321, "user_id": 157726, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/PY0sR.png?s=128&g=1", "display_name": "Juan Leni", "link": "https://stackoverflow.com/users/157726/juan-leni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "closed_date": 1534942893, "accepted_answer_id": 51962991, "answer_count": 1, "score": 8, "last_activity_date": 1534927548, "creation_date": 1534927352, "question_id": 51962931, "link": "https://stackoverflow.com/questions/51962931/is-it-possible-to-group-items-that-need-the-same-attribute", "closed_reason": "Duplicate", "title": "Is it possible to group items that need the same attribute?", "body": "<p>This is more a style question but still interesting. Is it possible to group things so the attribute is only there once?</p>\n\n<p>For instance, in the following code I am using the same attribute three times:</p>\n\n<pre><code>#[cfg(target_os = \"linux\")]\nextern crate nix;\n#[cfg(target_os = \"linux\")]\nextern crate libc;\n\n#[cfg(target_os = \"linux\")]\nuse std::{\n    mem,\n};\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 2, "creation_date": 1534886974, "post_id": 51956848, "comment_id": 90864481, "body": "I am also a bit confused. What is this function supposed to do? Why do you write a function if you don&#39;t know how you would call it?"}, {"owner": {"reputation": 71, "user_id": 9991631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64ac8ffd0b3e479ef04fd0474f9d3ad2?s=128&d=identicon&r=PG&f=1", "display_name": "Charles Jonasson", "link": "https://stackoverflow.com/users/9991631/charles-jonasson"}, "reply_to_user": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1534887450, "post_id": 51956848, "comment_id": 90864648, "body": "It&#39;s supposed to print out the current progress on how many characters you got right, also known as Hanging man. I know how i want to call it, i just don&#39;t know what to put inside of the parameters (). Do i type vec? vector?"}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 0, "creation_date": 1534888941, "post_id": 51956848, "comment_id": 90865096, "body": "What&#39;s wrong with what you have? <a href=\"http://play.rust-lang.org/?gist=2c0b8b1c75b668066e07087efa89da6c&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">This compiles now.</a>"}, {"owner": {"reputation": 71, "user_id": 9991631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64ac8ffd0b3e479ef04fd0474f9d3ad2?s=128&d=identicon&r=PG&f=1", "display_name": "Charles Jonasson", "link": "https://stackoverflow.com/users/9991631/charles-jonasson"}, "edited": false, "score": 0, "creation_date": 1534889303, "post_id": 51956848, "comment_id": 90865214, "body": "That&#39;s wierd, here&#39;s the full code though that doesn&#39;t work: <a href=\"http://play.rust-lang.org/?gist=d17b180243a732f3172f10f1b6e5e1b1&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a>"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1534959472, "post_id": 51956848, "comment_id": 90895137, "body": "You may wish to know about Rust&#39;s <a href=\"https://rust-lang-nursery.github.io/api-guidelines/naming.html\" rel=\"nofollow noreferrer\">naming conventions</a>. Use <code>lower_case</code> for local variables and functions."}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 1, "creation_date": 1534964986, "post_id": 51956848, "comment_id": 90897623, "body": "Moreover, iterating on the collection itself is preferred over using indices: <code>for v in correct_guess { }</code>."}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 9991631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64ac8ffd0b3e479ef04fd0474f9d3ad2?s=128&d=identicon&r=PG&f=1", "display_name": "Charles Jonasson", "link": "https://stackoverflow.com/users/9991631/charles-jonasson"}, "edited": false, "score": 0, "creation_date": 1534892901, "post_id": 51957648, "comment_id": 90866097, "body": "Thank you alot, i got rid of the errors. There is one issue remaining that i understand even less than the previous ones, shown in the picture:   <a href=\"https://gyazo.com/70d83c6ef130fd8988f18d807d5e4a6f\" rel=\"nofollow noreferrer\">gyazo.com/70d83c6ef130fd8988f18d807d5e4a6f</a> Code: <a href=\"https://gist.github.com/rust-play/9c4229aa87274ea338df32b0ea2ad882\" rel=\"nofollow noreferrer\">gist.github.com/rust-play/9c4229aa87274ea338df32b0ea2ad882</a>  I&#39;ll mark your comment finished either way, because you helped me with the original problem, again i appreciate it alot, thanks so much!"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1534894541, "post_id": 51957648, "comment_id": 90866474, "body": "<a href=\"https://stackoverflow.com/q/40006219/155423\">Why is it discouraged to accept a reference to a String (&amp;String), Vec (&amp;Vec) or Box (&amp;Box) as a function argument?</a>"}], "tags": [], "owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "is_accepted": true, "score": 2, "last_activity_date": 1535013386, "last_edit_date": 1535013386, "creation_date": 1534891274, "answer_id": 51957648, "question_id": 51956848, "link": "https://stackoverflow.com/questions/51956848/how-do-i-parse-a-vector-into-a-function/51957648#51957648", "title": "How do I parse a vector into a function?", "body": "<p>There's a couple of things wrong with your code.</p>\n\n<p>The first error is pretty straight forward:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>--&gt; src/main.rs:38:25\n   |\n38 |             displayWord(guessed_Letters);\n   |                         ^^^^^^^^^^^^^^^ expected char, found enum     `std::option::Option`\n   |\n   = note: expected type `std::vec::Vec&lt;char&gt;`\n              found type `std::vec::Vec&lt;std::option::Option&lt;char&gt;&gt;`\n</code></pre>\n\n<p>The function you wrote is expecting a vector a characters ... but you're passing it a vector of <code>Option&lt;char&gt;</code>. This is happening here:</p>\n\n<pre><code>guessed_Letters.push(line.chars().nth(0));\n</code></pre>\n\n<p><a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.nth\" rel=\"nofollow noreferrer\">According to the documentation</a>, the <code>nth</code> method returns an <code>Option</code>. The quick fix here is to <code>unwrap</code> the <code>Option</code> to get the underlying value:</p>\n\n<pre><code>guessed_Letters.push(line.chars().nth(0).unwrap());\n</code></pre>\n\n<p>Your next error is:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0382]: use of moved value: `guessed_Letters`\n  --&gt; src/main.rs:38:25\n   |\n38 |             displayWord(guessed_Letters);\n   |                         ^^^^^^^^^^^^^^^ value moved here in previous iteration     of loop\n   |\n   = note: move occurs because `guessed_Letters` has type `std::vec::Vec&lt;char&gt;`, which does not implement the `Copy` trait\n</code></pre>\n\n<p>This is transferring ownership of the vector on the first iteration of the loop and the compiler is telling you that subsequent iterations would be in violation of Rust's ownership rules.</p>\n\n<p>The solution here is to pass the vector <em>by reference instead</em>:</p>\n\n<pre><code>displayWord(&amp;guessed_Letters);\n</code></pre>\n\n<p>..and your method should also accept a reference:</p>\n\n<pre><code>fn displayWord(correctGuess: &amp;Vec&lt;char&gt;) {\n\n  let mut currentWord = String::new();\n\n  for x in 0..5 { \n    currentWord.push(correctGuess[x]);\n  }\n  println!(\"Current guesses: {}\", currentWord);\n}\n</code></pre>\n\n<p>This can be shortened to use a slice and still work:</p>\n\n<pre><code>fn displayWord(correctGuess: &amp;[char]) {\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 9991631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64ac8ffd0b3e479ef04fd0474f9d3ad2?s=128&d=identicon&r=PG&f=1", "display_name": "Charles Jonasson", "link": "https://stackoverflow.com/users/9991631/charles-jonasson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 51957648, "answer_count": 1, "score": -3, "last_activity_date": 1535013386, "creation_date": 1534886380, "last_edit_date": 1534887649, "question_id": 51956848, "link": "https://stackoverflow.com/questions/51956848/how-do-i-parse-a-vector-into-a-function", "title": "How do I parse a vector into a function?", "body": "<p>The idea is to send a set of characters of a vector and let the function display the current correct guesses.</p>\n\n<p>Here is my main:</p>\n\n<pre><code>fn main() {\n    let mut guessedLetters = vec![];\n    displayWord(guessedLetters);\n}\n</code></pre>\n\n<p>And here is the function:</p>\n\n<pre><code>fn displayWord(correctGuess: Vec&lt;char&gt;) {\n    let mut currentWord = String::new();\n\n    for x in 0..5 {\n        currentWord.push(correctGuess[x]);\n    }\n    println!(\"Current guesses: {}\", currentWord);\n}\n</code></pre>\n\n<p>I don't know what I'm supposed to write inside the parameters of <code>displayWord</code>.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1534826366, "post_id": 51941402, "comment_id": 90832872, "body": "<code>parse</code> returns a <code>Result</code> and you&#39;re trying to assign it to an unsigned integer. The <code>Result</code> type in Rust represents one of two things. A successful result, or an error result. If you want to get access to the underlying value, you&#39;ll <a href=\"https://doc.rust-lang.org/std/result/enum.Result.html#method.unwrap\" rel=\"nofollow noreferrer\">need to reference the documentation for a specific set of methods</a> to help with that."}, {"owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "edited": false, "score": 0, "creation_date": 1534842895, "post_id": 51941402, "comment_id": 90840095, "body": "Why are you parsing temperature as integer (<code>u32</code>), when you need to use it as float (<code>f32</code>) anyway? <code>std::parse</code> will parse floats and it will have the benefit of understanding fractional numbers."}], "answers": [{"comments": [{"owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "edited": false, "score": 1, "creation_date": 1534832850, "post_id": 51941665, "comment_id": 90835015, "body": "Note that in your examples, you convert to <code>f32</code> after having done the computations on integers, so you still have the problem of <code>5&#47;9==0</code>. You should do e.g. <code>(temperature as f32) * 9. &#47; 5. + 32.</code>"}, {"owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "edited": false, "score": 0, "creation_date": 1534842813, "post_id": 51941665, "comment_id": 90840043, "body": "Um, why not store <code>temperature</code> as <code>f32</code> from the start\u203d"}, {"owner": {"reputation": 49, "user_id": 5078653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/29gDO.jpg?s=128&g=1", "display_name": "undecisive", "link": "https://stackoverflow.com/users/5078653/undecisive"}, "reply_to_user": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "edited": false, "score": 0, "creation_date": 1534854868, "post_id": 51941665, "comment_id": 90847268, "body": "@JanHudec I tried doing the float to begin with but I kept getting errors when trying to convert the value from a string to a float. So in my last futile attempt before coming to stack overflow I tried doing it as a u32 and making it a float when doing the math below. Neither of which worked."}, {"owner": {"reputation": 49, "user_id": 5078653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/29gDO.jpg?s=128&g=1", "display_name": "undecisive", "link": "https://stackoverflow.com/users/5078653/undecisive"}, "edited": false, "score": 0, "creation_date": 1534855494, "post_id": 51941665, "comment_id": 90847641, "body": "@msbit thanks for the help. I was also unaware you could set the called variable as a different type by saying var as type, so that is much easier and something I will remember moving forward with Rust.  <code>let temperature: u32 = temperature.trim().parse().unwrap()         .expect(&quot;Failed to parse correctly&quot;);</code>  This gave me the error &quot;cannot infer type for &#39;T&#39; and highlights the let statement before it hits the indented except on the next line. I assume this is happening because it sees an integer, but now looks for a result as well. if i exclude the expect it works fine until an error."}, {"owner": {"reputation": 1470, "user_id": 2075745, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6f9a084d236381e1882c4e28edb5151f?s=128&d=identicon&r=PG", "display_name": "user25064", "link": "https://stackoverflow.com/users/2075745/user25064"}, "reply_to_user": {"reputation": 49, "user_id": 5078653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/29gDO.jpg?s=128&g=1", "display_name": "undecisive", "link": "https://stackoverflow.com/users/5078653/undecisive"}, "edited": false, "score": 0, "creation_date": 1534863500, "post_id": 51941665, "comment_id": 90853185, "body": "@undecisive when you get <code>cannot infer type for &#39;T&#39;</code> it can be useful to <a href=\"https://matematikaadit.github.io/posts/rust-turbofish.html\" rel=\"nofollow noreferrer\">use a turbofish</a> just posting this here in case you weren&#39;t aware of it"}, {"owner": {"reputation": 49, "user_id": 5078653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/29gDO.jpg?s=128&g=1", "display_name": "undecisive", "link": "https://stackoverflow.com/users/5078653/undecisive"}, "reply_to_user": {"reputation": 1470, "user_id": 2075745, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6f9a084d236381e1882c4e28edb5151f?s=128&d=identicon&r=PG", "display_name": "user25064", "link": "https://stackoverflow.com/users/2075745/user25064"}, "edited": false, "score": 0, "creation_date": 1534867454, "post_id": 51941665, "comment_id": 90855616, "body": "@user25064 I was unaware of a turbofish, but the link you sent was pretty helpful in explaining what the turbofish is. However, when I try to add a turbofish ::&lt;u32&gt; to my temperature statement, after removing the u32 at the front, i get a expected 0 types but found 1 type error when using <code>let temperature: = temperature.trim().parse().unwrap::&lt;u32&gt;()     .expect(&quot;Failed to parse correctly.&quot;);</code>"}, {"owner": {"reputation": 1470, "user_id": 2075745, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6f9a084d236381e1882c4e28edb5151f?s=128&d=identicon&r=PG", "display_name": "user25064", "link": "https://stackoverflow.com/users/2075745/user25064"}, "edited": false, "score": 0, "creation_date": 1534868467, "post_id": 51941665, "comment_id": 90856204, "body": "ah, that&#39;s because the turbofish goes on the parse function. The <a href=\"https://doc.rust-lang.org/std/result/enum.Result.html#method.unwrap\" rel=\"nofollow noreferrer\">unwrap function</a> is not a generic function but the <a href=\"https://doc.rust-lang.org/std/string/struct.String.html#method.parse\" rel=\"nofollow noreferrer\">parse function</a>  is generic over one parameter."}, {"owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "reply_to_user": {"reputation": 49, "user_id": 5078653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/29gDO.jpg?s=128&g=1", "display_name": "undecisive", "link": "https://stackoverflow.com/users/5078653/undecisive"}, "edited": false, "score": 0, "creation_date": 1534888731, "post_id": 51941665, "comment_id": 90865042, "body": "@undecisive, if you are having trouble <code>std::parse()</code>ing <code>f32</code> than <i>that</i> is what you should be asking about!"}, {"owner": {"reputation": 49, "user_id": 5078653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/29gDO.jpg?s=128&g=1", "display_name": "undecisive", "link": "https://stackoverflow.com/users/5078653/undecisive"}, "reply_to_user": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "edited": false, "score": 0, "creation_date": 1534895591, "post_id": 51941665, "comment_id": 90866728, "body": "@JanHudec Thanks for the tip Jan. I&#39;ll remember that for next time. Like I said at the top of the post I&#39;m new to all of this."}], "tags": [], "owner": {"reputation": 1434, "user_id": 7003720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jM3MB.png?s=128&g=1", "display_name": "msbit", "link": "https://stackoverflow.com/users/7003720/msbit"}, "is_accepted": false, "score": 4, "last_activity_date": 1534833889, "last_edit_date": 1534833889, "creation_date": 1534826466, "answer_id": 51941665, "question_id": 51941402, "link": "https://stackoverflow.com/questions/51941402/getting-mismatched-types-when-compiling-after-stdin-and-then-math-on-input/51941665#51941665", "title": "Getting mismatched types when compiling after STDIN and then math on input", "body": "<p>Rust's <a href=\"https://doc.rust-lang.org/std/string/struct.String.html#method.parse\" rel=\"nofollow noreferrer\"><code>String.parse</code></a> returns a <code>Result&lt;F, &lt;F as FromStr&gt;::Err&gt;</code>, not a string. The simplest thing to do is to use <a href=\"https://doc.rust-lang.org/std/result/enum.Result.html#method.unwrap\" rel=\"nofollow noreferrer\"><code>Result.unwrap</code></a> like so:</p>\n\n<pre><code>let temperature: u32 = temperature.trim().parse().unwrap();\n</code></pre>\n\n<p>Note that if <code>parse</code> returns an error result, <code>unwrap</code> will panic, so you may want to look at:</p>\n\n<ul>\n<li><a href=\"https://doc.rust-lang.org/std/result/enum.Result.html#method.unwrap_or\" rel=\"nofollow noreferrer\"><code>Result.unwrap_or</code></a> which allows you to provide a default value on failure</li>\n<li><a href=\"https://doc.rust-lang.org/std/result/enum.Result.html#method.expect\" rel=\"nofollow noreferrer\"><code>Result.expect</code></a> (as you are using elsewhere) which returns the <code>Ok</code> value of the result if it succeeded, or panics with the provided text argument if not</li>\n</ul>\n\n<p>As for the other issue, this is due to the type being integer (<code>u32</code>), and so the maths is also integer (in which, for example, 5 / 9  = 0). A simple way to get around this is:</p>\n\n<pre><code>let fahr_result: f32 = (((temperature as f32) * 9.) / 5.) + 32.;\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>let celc_result: f32 = (temperature as f32) - 32. * 5. / 9.;\n</code></pre>\n\n<p>As a bonus, the celsius result calculation isn't quite right due to the order of operations, as the multiplication and division will be performed before the subtraction. You can get around this by wrapping the <code>temperature - 32</code> in brackets like so:</p>\n\n<pre><code>let celc_result: f32 = ((temperature as f32) - 32.) * 5. / 9.;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 16020, "user_id": 9716597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f97c613dca0b157b40551a0d756abeb?s=128&d=identicon&r=PG&f=1", "display_name": "L. F.", "link": "https://stackoverflow.com/users/9716597/l-f"}, "edited": false, "score": 2, "creation_date": 1617373275, "post_id": 66920455, "comment_id": 118292233, "body": "<code>fbradley.trim().parse().unwrap_or(0.0)</code> is simpler.  But silently substituting <code>0.0</code> when there is an error is probably not a good idea anyway."}], "tags": [], "owner": {"reputation": 33, "user_id": 6654049, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-0hKVCRUlJfo/AAAAAAAAAAI/AAAAAAAAA6E/jse_3VK_2P0/photo.jpg?sz=128", "display_name": "Khalil Ardat", "link": "https://stackoverflow.com/users/6654049/khalil-ardat"}, "is_accepted": false, "score": 0, "last_activity_date": 1617373641, "last_edit_date": 1617373641, "creation_date": 1617372011, "answer_id": 66920455, "question_id": 51941402, "link": "https://stackoverflow.com/questions/51941402/getting-mismatched-types-when-compiling-after-stdin-and-then-math-on-input/66920455#66920455", "title": "Getting mismatched types when compiling after STDIN and then math on input", "body": "<p>I think we're both reading  <em>The Rust Programming Language</em> and I have the same error. I solved it by:</p>\n<pre><code>let mut fbradley: f64 = match fbradley.trim().parse() {\n    Ok(num) =&gt; num,\n    Err(_) =&gt; 0.0,\n};\n</code></pre>\n<p>The problem is that the output of <code>parse</code> is not a floating point number.</p>\n"}], "owner": {"reputation": 49, "user_id": 5078653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/29gDO.jpg?s=128&g=1", "display_name": "undecisive", "link": "https://stackoverflow.com/users/5078653/undecisive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1617373641, "creation_date": 1534824249, "last_edit_date": 1534824478, "question_id": 51941402, "link": "https://stackoverflow.com/questions/51941402/getting-mismatched-types-when-compiling-after-stdin-and-then-math-on-input", "title": "Getting mismatched types when compiling after STDIN and then math on input", "body": "<p>I am trying to write a rust program to convert an input temperature to celcius from fahrenheit or vice versa. I am still quite new to Rust, and the book mentioned to make this program as a way to learn. </p>\n\n<p>When I try to compile the code I keep getting the error mismatched types. The errors can be seen immediately below, and my code is formatted beneath the errors.</p>\n\n<pre>\nerror[E0308]: mismatched types\n  --> temperature.rs:12:28\n   |\n12 |     let temperature: u32 = temperature.trim().parse();\n   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^ expected u32, found enum `std::result::Result`\n   |\n   = note: expected type `u32`\n              found type `std::result::Result`\n\nerror[E0308]: mismatched types\n  --> temperature.rs:34:29\n   |\n34 |         let fahr_result: f32 = ((temperature * 9) / 5) + 32;\n   |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ expected f32, found u32\n\nerror[E0308]: mismatched types\n  --> temperature.rs:38:29\n   |\n38 |         let celc_result: f32 = temperature - 32 * 5 / 9;\n   |                                ^^^^^^^^^^^^^^^^^^^^^^^^ expected f32, found u32\n</pre>\n\n<pre><code>use std::io;\n\nfn main () {\n    println!(\"Welcome to the Temperature converter.\");\n    println!(\"Enter the temperature value, number only: \");\n\n    let mut temperature = String::new();\n\n    io::stdin().read_line(&amp;mut temperature)\n        .expect(\"Failed to read line\");\n\n    let temperature: u32 = temperature.trim().parse();\n\n    println!(\"Do you want to convert to Celcius or Fahrenheit? (Enter the number of your choice)\\n1. Fahrenheit\\n2.Celcius\");\n\n    let mut temp_choice = String::new();\n\n    io::stdin().read_line(&amp;mut temp_choice)\n        .expect(\"Failed to read line\");\n\n    let temp_choice: u32 = temp_choice.trim().parse()\n        .expect(\"Fart in your butt.\");\n\n    if temp_choice == 1 {\n        let fahr_result: f32 = ((temperature * 9) / 5) + 32;\n        println!(\"{} degrees Celcius is equal to {} degrees Fahrenheit.\", temperature, fahr_result);\n    } else if temp_choice == 2 {\n        let celc_result: f32 = temperature - 32 * 5 / 9;\n        println!(\"{} degrees Fahrenheit is equal to {} degrees Celcius.\", temperature, celc_result);\n    } else {\n        println!(\"Invalid Choice. Exiting.\");\n    }\n}\n</code></pre>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534800554, "post_id": 51938068, "comment_id": 90827564, "body": "<i>I don&#39;t understand why the value <code>y</code> has to live until after it&#39;s used</i> \u2014 can you clarify what you mean? How would <i>any</i> program work if the variable was not available when it needs to be used?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534802108, "post_id": 51938068, "comment_id": 90828062, "body": "<a href=\"https://stackoverflow.com/q/40006219/155423\">Why is it discouraged to accept a reference to a String (&amp;String), Vec (&amp;Vec) or Box (&amp;Box) as a function argument?</a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534802305, "post_id": 51938068, "comment_id": 90828116, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/42503296/155423\">Value does not live long enough</a>. If you disagree, please <a href=\"https://stackoverflow.com/posts/51938068/edit\">edit</a> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1534802564, "post_id": 51938068, "comment_id": 90828186, "body": "TL;DR \u2014 you created the <code>Vec</code> <code>y</code> and then got a reference to the vector via <code>get_highest</code> and <code>get_lowest</code>. When you exit the closure, <code>Vec</code> is destroyed and the references would point at nothing. The compiler is preventing you from making a massive mistake that would lead to memory unsafety in a language like C or C++."}], "answers": [{"tags": [], "owner": {"reputation": 144, "user_id": 8121879, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ruCdFqDlB4U/AAAAAAAAAAI/AAAAAAAAHFA/zAanfV0tJak/photo.jpg?sz=128", "display_name": "Arne Goeteyn", "link": "https://stackoverflow.com/users/8121879/arne-goeteyn"}, "is_accepted": false, "score": 0, "last_activity_date": 1534837786, "creation_date": 1534837786, "answer_id": 51944009, "question_id": 51938068, "link": "https://stackoverflow.com/questions/51938068/variable-doesnt-live-long-enough-in-map/51944009#51944009", "title": "Variable doesn&#39;t live long enough in map", "body": "<p>Shepmaster explained it well</p>\n\n<blockquote>\n  <p>TL;DR \u2014 you created the Vec y and then got a reference to the vector\n  via get_highest and get_lowest. When you exit the closure, Vec is\n  destroyed and the references would point at nothing. The compiler is\n  preventing you from making a massive mistake that would lead to memory\n  unsafety in a language like C or C++.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 311, "user_id": 9485332, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-vGA69piOLh4/AAAAAAAAAAI/AAAAAAAAChQ/8urLJifCW4M/photo.jpg?sz=128", "display_name": "Miguel Berr&#237;o", "link": "https://stackoverflow.com/users/9485332/miguel-berr%c3%ado"}, "is_accepted": true, "score": 0, "last_activity_date": 1534838360, "creation_date": 1534838360, "answer_id": 51944172, "question_id": 51938068, "link": "https://stackoverflow.com/questions/51938068/variable-doesnt-live-long-enough-in-map/51944172#51944172", "title": "Variable doesn&#39;t live long enough in map", "body": "<p>You can use the <code>clone()</code> function to pass new copies of the vectors to the functions <code>get_highest</code> and <code>get_lowest</code> and make the functions return integers and not references with the funciton <code>to_owned()</code>. </p>\n\n<pre><code>pub fn find_saddle_points(input: &amp;[Vec&lt;u64&gt;]) -&gt; Vec&lt;(usize, usize)&gt; {\n    let answer = Vec::new();\n    println!(\"matrix: {:?}\", input);\n    let x: Vec&lt;Vec&lt;_&gt;&gt; = input\n        .iter()\n        .map(|row| {\n            row.iter()\n                .map(move |_| {\n                    let y = get_column(&amp;input, 0);\n                    println!(\"y is {:?}\", y);\n                    let x = get_lowest(y.clone());\n                    (get_highest(row), x)\n                }).collect()\n        }).collect();\n    println!(\"x is {:?}\", x);\n    answer\n}\n\nfn get_highest(row: Vec&lt;u64&gt;) -&gt; u64 {\n    row.iter().max().unwrap().to_owned()\n}\n\nfn get_lowest(column: Vec&lt;u64&gt;) -&gt; u64 {\n    column.iter().min().unwrap().to_owned()\n}\n\nfn get_column(matrix: &amp;[Vec&lt;u64&gt;], index: usize) -&gt; Vec&lt;u64&gt; {\n    matrix.iter().map(|row| row[index]).collect()\n}\n</code></pre>\n\n<p>And as @shepmaster posted, you should avoid using references of Vectors as function parameters.</p>\n"}], "owner": {"reputation": 144, "user_id": 8121879, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ruCdFqDlB4U/AAAAAAAAAAI/AAAAAAAAHFA/zAanfV0tJak/photo.jpg?sz=128", "display_name": "Arne Goeteyn", "link": "https://stackoverflow.com/users/8121879/arne-goeteyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "closed_date": 1534856011, "accepted_answer_id": 51944172, "answer_count": 2, "score": 0, "last_activity_date": 1534838360, "creation_date": 1534796849, "last_edit_date": 1534800041, "question_id": 51938068, "link": "https://stackoverflow.com/questions/51938068/variable-doesnt-live-long-enough-in-map", "closed_reason": "Duplicate", "title": "Variable doesn&#39;t live long enough in map", "body": "<p>I'm trying to turn a matrix A into matrix B where B_11 would be the biggest element of the first row and the smallest element of the second row in a tuple. So the matrix [1,2;3,4] would become [(2,1), (2,2); (4,1), (4,2)].</p>\n\n<pre><code>pub fn find_saddle_points(input: &amp;[Vec&lt;u64&gt;]) -&gt; Vec&lt;(usize, usize)&gt; {\n    let answer = Vec::new();\n    println!(\"matrix: {:?}\", input);\n    let x: Vec&lt;Vec&lt;_&gt;&gt; = input\n        .iter()\n        .map(|row| {\n            row.iter()\n                .map(move |_| {\n                    let y = get_column(&amp;input, 0);\n                    println!(\"y is {:?}\", y);\n                    let x = get_lowest(&amp;y);\n                    (get_highest(row), x)\n                }).collect()\n        }).collect();\n    println!(\"x is {:?}\", x);\n    answer\n}\n\nfn get_highest(row: &amp;Vec&lt;u64&gt;) -&gt; &amp;u64 {\n    row.iter().max().unwrap()\n}\n\nfn get_lowest(column: &amp;Vec&lt;u64&gt;) -&gt; &amp;u64 {\n    column.iter().min().unwrap()\n}\n\nfn get_column(matrix: &amp;[Vec&lt;u64&gt;], index: usize) -&gt; Vec&lt;u64&gt; {\n    matrix.iter().map(|row| row[index]).collect()\n}\n</code></pre>\n\n<p>I'm getting an error messages when I try to use <code>y</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0597]: `y` does not live long enough\n  --&gt; src/lib.rs:11:41\n   |\n11 |                     let x = get_lowest(&amp;y);\n   |                                         ^ borrowed value does not live long enough\n12 |                     (get_highest(row), x)\n13 |                 }).collect()\n   |                 - `y` dropped here while still borrowed\n...\n17 | }\n   | - borrowed value needs to live until here                          \n</code></pre>\n\n<p>I don't understand why the value <code>y</code> has to live until after it's used. Isn't it enough that it lives until after the <code>get_lowest</code> function?\nHow would I fix this?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1534799571, "post_id": 51937384, "comment_id": 90827238, "body": "You probably want to use <code>static</code> instead of <code>const</code>. In practice they may be the same, but <code>static</code> guarantees the behavior you probably want: that there&#39;s only one <code>DATA</code> array and all references are to its interior."}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 4, "last_activity_date": 1534794953, "last_edit_date": 1534794953, "creation_date": 1534794366, "answer_id": 51937578, "question_id": 51937384, "link": "https://stackoverflow.com/questions/51937384/how-to-return-a-reference-to-a-global-vector-or-an-internal-option/51937578#51937578", "title": "How to return a reference to a global vector or an internal Option?", "body": "<blockquote>\n  <p>How to return a reference to a global vector or an internal Option?</p>\n</blockquote>\n\n<p>By using <a href=\"https://doc.rust-lang.org/std/option/enum.Option.html#method.unwrap_or_else\" rel=\"nofollow noreferrer\"><code>Option::unwrap_or_else</code></a>:</p>\n\n<pre><code>impl Entity {\n    pub fn data(&amp;self) -&gt; &amp;Data {\n        self.modifier.as_ref().unwrap_or_else(|| &amp;DATA[self.idata])\n    }\n}\n</code></pre>\n\n<blockquote>\n  <p>but it's instead generating wrong instructions and the program is crashing with <code>SIGILL</code></p>\n</blockquote>\n\n<p>The code in your question does not have this behavior on macOS with Rust 1.27.2 or 1.28.0. On Ubuntu I see an issue when running the program in Valgrind, but the problem goes away in Rust 1.28.0.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/45547293/155423\">Why should I prefer `Option::ok_or_else` instead of `Option::ok_or`?</a></li>\n<li><a href=\"https://stackoverflow.com/q/21257686/155423\">What is this unwrap thing: sometimes it&#39;s unwrap sometimes it&#39;s unwrap_or</a></li>\n</ul>\n"}], "owner": {"reputation": 4600, "user_id": 4118, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bac29238c328f03828471cdf33fae699?s=128&d=identicon&r=PG", "display_name": "Penz", "link": "https://stackoverflow.com/users/4118/penz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1534794953, "creation_date": 1534793539, "last_edit_date": 1534794093, "question_id": 51937384, "link": "https://stackoverflow.com/questions/51937384/how-to-return-a-reference-to-a-global-vector-or-an-internal-option", "title": "How to return a reference to a global vector or an internal Option?", "body": "<p>I'm trying to create a method that can return a reference to <code>Data</code> that is either in a constant global array or inside an <code>Option</code> in an item. The lifetimes are certainly different, but it's safe to assume that the lifetime of the data is at least as long as the lifetime of the item. While doing this, I expected the compiler to warn if I did anything wrong, but it's instead generating wrong instructions and the program is crashing with <code>SIGILL</code>.</p>\n\n<p>Concretely speaking, I have the following code failing in Rust 1.27.2:</p>\n\n<pre><code>#[derive(Debug)]\npub enum Type {\n    TYPE1,\n    TYPE2,\n}\n\n#[derive(Debug)]\npub struct Data {\n    pub ctype: Type,\n    pub int: i32,\n}\n\n#[derive(Debug)]\npub struct Entity {\n    pub idata: usize,\n    pub modifier: Option&lt;Data&gt;,\n}\n\nimpl Entity {\n    pub fn data(&amp;self) -&gt; &amp;Data {\n        if self.modifier.is_none() {\n            &amp;DATA[self.idata]\n        } else {\n            self.modifier.as_ref().unwrap()\n        }\n    }\n}\n\npub const DATA: [Data; 1] = [Data {\n    ctype: Type::TYPE2,\n    int: 1,\n}];\n\nfn main() {\n    let mut itemvec = vec![Entity {\n        idata: 0,\n        modifier: None,\n    }];\n    eprintln!(\"vec[0]: {:p} = {:?}\", &amp;itemvec[0], itemvec[0]);\n    eprintln!(\"removed item 0\");\n    let item = itemvec.remove(0);\n    eprintln!(\"item: {:p} = {:?}\", &amp;item, item);\n    eprintln!(\"modifier: {:p} = {:?}\", &amp;item.modifier, item.modifier);\n    eprintln!(\"DATA: {:p} = {:?}\", &amp;DATA[0], DATA[0]);\n    let itemdata = item.data();\n    eprintln!(\"itemdata: {:p} = {:?}\", itemdata, itemdata);\n}\n</code></pre>\n\n<p><a href=\"https://github.com/lpenz/rust-sigill\" rel=\"nofollow noreferrer\">Complete code</a></p>\n\n<p>I can't understand what I'm doing wrong. Why isn't the compiler generating a warning? Is it the removal of the (non-copy) item of the vector? Is it the ambiguous lifetimes?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 105, "user_id": 2624445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D3FFy.jpg?s=128&g=1", "display_name": "ryanyz10", "link": "https://stackoverflow.com/users/2624445/ryanyz10"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534793021, "post_id": 51937049, "comment_id": 90824544, "body": "@Shepmaster will do, sorry I haven&#39;t looked much into variable naming conventions so I mix them up all the time. And literal = string literal representing the token, I don&#39;t see how I&#39;m using that incorrectly. It wasn&#39;t meant to be a literal in terms of a programming language."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534793189, "post_id": 51937049, "comment_id": 90824630, "body": "Re &quot;literal&quot; \u2014 your original post didn&#39;t use backticks (`) to mark up <code>literal</code> as code, so it wan&#39;t clear you were referring to the field named &quot;literal&quot; instead of an actual Rust-source-code literal."}, {"owner": {"reputation": 105, "user_id": 2624445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D3FFy.jpg?s=128&g=1", "display_name": "ryanyz10", "link": "https://stackoverflow.com/users/2624445/ryanyz10"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534793982, "post_id": 51937049, "comment_id": 90824983, "body": "@Shepmaster I looked at the question you linked and it doesn&#39;t quite address my problem. I understand why I can&#39;t build a <code>String</code> and return <code>&amp;str</code>, my question is more how ownership works in <code>&amp;self.curr_char.get().to_string()</code>. From my understanding, literal types transfer ownership because they can be copied but that&#39;s apparently an incorrect understanding, and I don&#39;t know how memory is allocated in this case."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1534794722, "post_id": 51937049, "comment_id": 90825323, "body": "&quot;literal types&quot; \u2014 And now I think you are using the term differently from general meaning again. A literal is <code>&quot;foo&quot;</code> or <code>&#39;x&#39;</code> or <code>123</code>. There are <i>no literals</i> in <code>&amp;self.curr_char.get().to_string()</code>. <i>I understand why I can&#39;t build a <code>String</code> and return <code>&amp;str</code></i> \u2014 but the code you have posted is attempting to build a <code>String</code> and return a <code>&amp;str</code>, so help us figure out what part of the explanation is lacking."}, {"owner": {"reputation": 105, "user_id": 2624445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D3FFy.jpg?s=128&g=1", "display_name": "ryanyz10", "link": "https://stackoverflow.com/users/2624445/ryanyz10"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534795153, "post_id": 51937049, "comment_id": 90825528, "body": "@Shepmaster The value enclosed in the <code>curr_char</code> cell is a <code>char</code> type, which is a literal, no? Then <code>self.curr_char.get()</code> returns a <code>char</code> type, which would produce a copy, so no ownership problems. I&#39;m trying to understand how memory works in this case when calling <code>to_string()</code> on the <code>char</code>. Sorry my question isn&#39;t clear, I was (and still am) having trouble phrasing it."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1534795679, "post_id": 51937049, "comment_id": 90825741, "body": "<code>Cell</code> has nothing to do with this. <a href=\"http://play.rust-lang.org/?gist=fc25a1224c616c06f6ff4fb25e9f3b4b&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">This code produces the same error with no <code>Cell</code></a>. <code>to_string</code> creates a new, owned <code>String</code>, as its signature suggests: <a href=\"https://doc.rust-lang.org/std/string/trait.ToString.html#tymethod.to_string\" rel=\"nofollow noreferrer\"><code>fn to_string(&amp;self) -&gt; String</code></a>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1534795910, "post_id": 51937049, "comment_id": 90825837, "body": "<i>The value enclosed in the <code>curr_char</code> cell is a <code>char</code> type</i> \u2014 yes. <i>which is a literal</i> \u2014 no. <i>returns a <code>char</code> type</i>  \u2014 yes. <i>calling <code>to_string()</code> on the <code>char</code></i> \u2014 allocates a completely brand new <code>String</code>, as trentcl points out. Just like the proposed duplicate creates a new <code>String</code> via <code>to_string</code>."}, {"owner": {"reputation": 105, "user_id": 2624445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D3FFy.jpg?s=128&g=1", "display_name": "ryanyz10", "link": "https://stackoverflow.com/users/2624445/ryanyz10"}, "edited": false, "score": 0, "creation_date": 1534796362, "post_id": 51937049, "comment_id": 90826025, "body": "I guess I don&#39;t understand what a literal is then. Does a character literal have to be of the form <code>&#39;a&#39;</code>? But the word I was looking for was primitive, not literal, so my mistake. Anyways, if <code>to_string()</code> creates a completely brand-new string, then what has ownership of it? Is that where my problem comes from?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534808580, "post_id": 51937049, "comment_id": 90829543, "body": "<i>then what has ownership of it</i> \u2014 nothing (see 3rd linked duplicate) <i>Is that where my problem comes from</i> \u2014 yes."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1534808909, "post_id": 51937049, "comment_id": 90829614, "body": "Here&#39;s a <a href=\"https://play.rust-lang.org/?gist=393ae7907dc5e42c3f9e76ff9997cf71&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">minimal amount of change that you can make to get your code to compile</a>."}, {"owner": {"reputation": 105, "user_id": 2624445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D3FFy.jpg?s=128&g=1", "display_name": "ryanyz10", "link": "https://stackoverflow.com/users/2624445/ryanyz10"}, "edited": false, "score": 0, "creation_date": 1534809165, "post_id": 51937049, "comment_id": 90829665, "body": "Thanks for the help! I&#39;m currently rewriting my code...the issue I had was a result of my lack of understanding of Rust and I think hardcoding values is just a temporary fix.   If I have all the <code>literal</code> fields as references to the <code>input</code> byte slice, would that get rid of the ownership problems? To clarify something like: <code>&amp;self.input[start..end]</code> and then condensing that into an <code>&amp;str</code> with <code>str::from_utf8</code>."}], "owner": {"reputation": 105, "user_id": 2624445, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D3FFy.jpg?s=128&g=1", "display_name": "ryanyz10", "link": "https://stackoverflow.com/users/2624445/ryanyz10"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "closed_date": 1534808484, "answer_count": 0, "score": 0, "last_activity_date": 1534808505, "creation_date": 1534791999, "last_edit_date": 1534793342, "question_id": 51937049, "link": "https://stackoverflow.com/questions/51937049/ownership-with-copy-of-cell-enclosed-value", "closed_reason": "Duplicate", "title": "Ownership with copy of Cell-enclosed value", "body": "<p>I'm currently working on creating the programming language described in \"Writing an Interpreter in Go\", but I'm trying to write the code in Rust.</p>\n\n<p>I have the following struct representing the lexer:</p>\n\n<pre><code>struct Lexer&lt;'a&gt; {\n    input: &amp;'a [u8], // assume the text input is all ascii\n    curr_pos: Cell&lt;usize&gt;,\n    read_pos: Cell&lt;usize&gt;,\n    curr_char: Cell&lt;char&gt;,\n}\n</code></pre>\n\n<p>and the following struct representing a token: </p>\n\n<pre><code>struct Token&lt;'a&gt; {\n    tokenType: TokenType&lt;'a&gt;,\n    literal: &amp;'a str,\n}\n</code></pre>\n\n<p>where <code>tokenType</code> is an enum representing the various kinds of tokens. It's pretty standard, but I'm having trouble with the ownership of <code>literal</code>.</p>\n\n<p>When I try to set create a token:</p>\n\n<pre><code>Token {tokenType: TokenType::ASSIGN, literal: &amp;self.curr_char.get().to_string()}\n</code></pre>\n\n<p>I get an error about the value <code>&amp;self.curr_char.get().to_string()</code> not living long enough. How do ownership rules come into play here, and what is the best way to \"give\" a <code>Token</code> its value? </p>\n\n<p>Here's the full code:</p>\n\n<pre><code>use std::cell::Cell;\nuse std::str;\nuse std::char;\n\n#[derive(Debug, PartialEq)]\nenum TokenType&lt;'a&gt; {\n    ILLEGAL,\n    EOF,\n    IDENT(&amp;'a str),\n    INT(i64),\n    ASSIGN,\n    PLUS,\n    COMMA,\n    SEMICOLON,\n    LPAREN,\n    RPAREN,\n    LBRACE,\n    RBRACE,\n    FUNCTION,\n    LET,\n}\n\nstruct Token&lt;'a&gt; {\n    tokenType: TokenType&lt;'a&gt;,\n    literal: &amp;'a str,\n}\n\nstruct Lexer&lt;'a&gt; {\n    input: &amp;'a [u8], // assume the text input is all ascii\n    curr_pos: Cell&lt;usize&gt;,\n    read_pos: Cell&lt;usize&gt;,\n    curr_char: Cell&lt;char&gt;,\n}\n\nimpl&lt;'a&gt; Lexer&lt;'a&gt; {\n    fn next_token(&amp;self) -&gt; Token {\n        const NULL_CHAR: char = 0 as char;\n        let token = match self.curr_char.get() {\n            '='         =&gt; Token {tokenType: TokenType::ASSIGN,    literal: &amp;self.curr_char.get().to_string()},\n            ';'         =&gt; Token {tokenType: TokenType::SEMICOLON, literal: &amp;self.curr_char.get().to_string()},\n            '('         =&gt; Token {tokenType: TokenType::LPAREN,    literal: &amp;self.curr_char.get().to_string()},\n            ')'         =&gt; Token {tokenType: TokenType::RPAREN,    literal: &amp;self.curr_char.get().to_string()},\n            '{'         =&gt; Token {tokenType: TokenType::LBRACE,    literal: &amp;self.curr_char.get().to_string()},\n            '}'         =&gt; Token {tokenType: TokenType::RBRACE,    literal: &amp;self.curr_char.get().to_string()},\n            ','         =&gt; Token {tokenType: TokenType::COMMA,     literal: &amp;self.curr_char.get().to_string()},\n            '+'         =&gt; Token {tokenType: TokenType::PLUS,      literal: &amp;self.curr_char.get().to_string()},\n            '\\0'        =&gt; Token {tokenType: TokenType::EOF,       literal: &amp;self.curr_char.get().to_string()},\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["rust", "panic"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534789969, "post_id": 51936604, "comment_id": 90823278, "body": "What is &quot;lang_items.rs&quot;? That&#39;s nothing standard."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1534789983, "post_id": 51936604, "comment_id": 90823288, "body": "Please review how to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> and then <a href=\"https://stackoverflow.com/posts/51936604/edit\">edit</a> your question to include it. We cannot tell what crates, types, traits, fields, etc. are present in the code. Try to produce something that reproduces your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> or you can reproduce it in a brand new Cargo project. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MCVE tips</a> as well."}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1534790084, "post_id": 51936604, "comment_id": 90823330, "body": "Do you know that <code>feature</code>s require a nightly compiler?"}, {"owner": {"reputation": 321, "user_id": 2671017, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/Mdvbp.jpg?s=128&g=1", "display_name": "dynsne", "link": "https://stackoverflow.com/users/2671017/dynsne"}, "edited": false, "score": 0, "creation_date": 1534790107, "post_id": 51936604, "comment_id": 90823342, "body": "Yes, I&#39;m using a nightly compiler :-)."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1534790655, "post_id": 51936604, "comment_id": 90823556, "body": "<i>Following their suggestion of adding <code>#![feature(panic_implementation)]</code> to the top of the lang_items.rs file</i> \u2014 that is <b>not</b> the suggestion. Possible duplicate of <a href=\"https://stackoverflow.com/q/27454761/155423\">What is a crate attribute and where do I add it?</a>."}, {"owner": {"reputation": 321, "user_id": 2671017, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/Mdvbp.jpg?s=128&g=1", "display_name": "dynsne", "link": "https://stackoverflow.com/users/2671017/dynsne"}, "edited": false, "score": 0, "creation_date": 1534790813, "post_id": 51936604, "comment_id": 90823631, "body": "Thanks shepmaster, I read your answer earlier and then realized what I was doing wrong."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1534790913, "post_id": 51936804, "comment_id": 90823679, "body": "There&#39;s no need to duplicate answers when an existing Q&amp;A has already solved the problem. That just increases the amount of maintenance needed to keep Q&amp;A useful."}], "tags": [], "owner": {"reputation": 321, "user_id": 2671017, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/Mdvbp.jpg?s=128&g=1", "display_name": "dynsne", "link": "https://stackoverflow.com/users/2671017/dynsne"}, "is_accepted": false, "score": 1, "last_activity_date": 1534790865, "last_edit_date": 1534790865, "creation_date": 1534790774, "answer_id": 51936804, "question_id": 51936604, "link": "https://stackoverflow.com/questions/51936604/how-to-fix-definition-of-unknown-language-item-panic-fmt/51936804#51936804", "title": "How to fix `definition of unknown language item &#39;panic_fmt&#39;`?", "body": "<p>Okay, it was a simple mistake I was making. Here is a link to the <a href=\"https://play.rust-lang.org/?gist=aefd00397e89920ea72dffa6dc99fb93&amp;version=nightly&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">playground</a> containing my code. First of all, I needed to add the crate attribute to the <em>top</em> of my crate root (which, for me, was <code>lib.rs</code>). <code>lang_items.rs</code> was just a file that was used in <code>lib.rs</code> like so:</p>\n\n<pre><code>#![feature(compiler_builtins_lib, lang_items, asm, panic_implementation, core_intrinsics)]\n#![no_builtins]\n#![no_std]\n\npub mod lang_items;\n\nconst GPIO_BASE: usize = 0x3F000000 + 0x200000;\n\nconst GPIO_FSEL1: *mut u32 = (GPIO_BASE + 0x04) as *mut u32;\nconst GPIO_SET0: *mut u32 = (GPIO_BASE + 0x1C) as *mut u32;\nconst GPIO_CLR0: *mut u32 = (GPIO_BASE + 0x28) as *mut u32;\n\n#[inline(never)]\nfn spin_sleep_ms(ms: usize) {\n    for _ in 0..(ms * 600) {\n        unsafe { asm!(\"nop\" :::: \"volatile\"); }\n    }\n}\n\n#[no_mangle]\npub unsafe extern \"C\" fn kmain() {\n    // STEP 1: Set GPIO Pin 16 as output.\n    GPIO_FSEL1.write_volatile(0x1 &lt;&lt; 0x12);\n    // STEP 2: Continuously set and clear GPIO 16.\n    loop {\n        GPIO_SET0.write_volatile(0x1 &lt;&lt; 0x10);\n        spin_sleep_ms(256);\n        GPIO_CLR0.write_volatile(0x1 &lt;&lt; 0x10);\n        spin_sleep_ms(256);\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 321, "user_id": 2671017, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/Mdvbp.jpg?s=128&g=1", "display_name": "dynsne", "link": "https://stackoverflow.com/users/2671017/dynsne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 0, "closed_date": 1534790824, "answer_count": 1, "score": -1, "last_activity_date": 1534790865, "creation_date": 1534789734, "last_edit_date": 1534789880, "question_id": 51936604, "link": "https://stackoverflow.com/questions/51936604/how-to-fix-definition-of-unknown-language-item-panic-fmt", "closed_reason": "Duplicate", "title": "How to fix `definition of unknown language item &#39;panic_fmt&#39;`?", "body": "<p>For a <code>no_std</code> application there are a few language items defined in <code>lang_items.rs</code>, one of them being the <code>panic_fmt</code> language item (to specify the behavior of <code>panic!</code> in this <code>no_std</code> context) defined like:</p>\n\n<pre><code>#[lang = \"panic_fmt\"] #[no_mangle] pub extern fn panic_fmt() -&gt; ! { loop{} }\n</code></pre>\n\n<p>When compiling, I receive this error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0522]: definition of an unknown language item: `panic_fmt`\n --&gt; src/lang_items.rs:3:1\n  |\n3 | #[lang = \"panic_fmt\"] #[no_mangle] pub extern fn panic_fmt() -&gt; ! { loop{} }\n  | ^^^^^^^^^^^^^^^^^^^^^ definition of unknown language item `panic_fmt`\n\nerror: `#[panic_implementation]` function required, but not found\n</code></pre>\n\n<p>After reading <a href=\"https://rust-lang.github.io/rfcs/2070-panic-implementation.html\" rel=\"nofollow noreferrer\">RFC 2070</a> I learned there was a recent breaking change for <code>no_std</code>/embedded programs. While it's recommended that I use the <code>#[panic_implementation]</code> attributes, a recently added feature, I still receive an error, doing so like:</p>\n\n<pre><code>#[panic_implementation] #[no_mangle] pub extern fn panic_fmt() -&gt; ! { loop{} }\n</code></pre>\n\n<p>Gives the error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0658]: #[panic_implementation] is an unstable feature (see issue #44489)\n --&gt; src/lang_items.rs:4:1\n  |\n4 | #[panic_implementation] #[no_mangle] pub extern fn panic_fmt() -&gt; ! { loop{} }\n  | ^^^^^^^^^^^^^^^^^^^^^^^\n  |\n  = help: add #![feature(panic_implementation)] to the crate attributes to enable\n</code></pre>\n\n<p>Following their suggestion of adding <code>#![feature(panic_implementation)]</code> to the top of the <code>lang_items.rs</code> file doesn't seem to do the trick, as I'm getting the same error. How do I enable this unstable feature properly so that I can compile this <code>no_std</code> application with behavior for <code>panic!</code> defined?</p>\n"}, {"tags": ["rust"], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534790659, "post_id": 51936494, "comment_id": 90823559, "body": "&quot;Rust won&#39;t do any mapping of struct names to enum variants for you - you need to explicitly include the data in the enum itself:&quot; no ?"}, {"owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534792606, "post_id": 51936494, "comment_id": 90824336, "body": "@Stargateur: Elaborate? To me, the question sounded like they were trying to insert three different types into a hash map, which would require them to either use trait objects or wrap their three types in a single enum (the latter being what I showed in my answer). Maybe &quot;Rust won&#39;t do any mapping of <i>types</i> to enum variants for you&quot; would be a better way to phrase what I was saying, though."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534793063, "post_id": 51936494, "comment_id": 90824569, "body": "Well, <a href=\"https://play.rust-lang.org/?gist=e8974a51ee3d664bebc734345e0484cc&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">play.rust-lang.org/&hellip;</a> work fine... someenum is the common type"}, {"owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534793616, "post_id": 51936494, "comment_id": 90824814, "body": "@Stargateur: None of the structs are being used, though (see the compiler warnings). There&#39;s no actual relationship defined between the enum variant <code>SomeEnum::TypeA</code> and the struct <code>TypeA</code>, they just have the same name."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534795615, "post_id": 51936494, "comment_id": 90825720, "body": "Oh sorry, I was completely off"}, {"owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534796589, "post_id": 51936494, "comment_id": 90826111, "body": "@Stargateur: No problem, just wanted to make sure I wasn&#39;t missing something :)"}], "tags": [], "owner": {"reputation": 26154, "user_id": 5436257, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iGuaK.jpg?s=128&g=1", "display_name": "Joe Clay", "link": "https://stackoverflow.com/users/5436257/joe-clay"}, "is_accepted": true, "score": 5, "last_activity_date": 1534792732, "last_edit_date": 1534792732, "creation_date": 1534789189, "answer_id": 51936494, "question_id": 51936299, "link": "https://stackoverflow.com/questions/51936299/how-to-put-heterogeneous-types-into-a-rust-structure/51936494#51936494", "title": "How to put heterogeneous types into a Rust structure", "body": "<p>Rust won't do any mapping of types to enum variants for you - you need to explicitly include the data in the enum itself:</p>\n\n<pre><code>use std::collections::HashMap;\n\nenum SomeEnum {\n    A(TypeA),\n    B(TypeB),\n    C(TypeC),\n}\n\nstruct TypeA {}\nstruct TypeB {}\nstruct TypeC {}\n\nfn main() {\n    let mut hm = HashMap::new();\n    hm.insert(\"foo\".to_string(), SomeEnum::A(TypeA {}));\n    hm.insert(\"bar\".to_string(), SomeEnum::B(TypeB {}));\n    hm.insert(\"zoo\".to_string(), SomeEnum::C(TypeC {}));\n}\n</code></pre>\n\n<p>That said, if the <em>only</em> context in which you'll need to use those struct types is when you're using that enum, you can combine them like so:</p>\n\n<pre><code>use std::collections::HashMap;\n\nenum SomeEnum {\n    A {},\n    B {},\n    C {},\n}\n\nfn main() {\n    let mut hm = HashMap::new();\n    hm.insert(\"foo\".to_string(), SomeEnum::A {});\n    hm.insert(\"bar\".to_string(), SomeEnum::B {});\n    hm.insert(\"zoo\".to_string(), SomeEnum::C {});\n}\n</code></pre>\n"}], "owner": {"reputation": 925, "user_id": 4701228, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a51e05717e2b8a78ae0876d705757d41?s=128&d=identicon&r=PG&f=1", "display_name": "semore_1267", "link": "https://stackoverflow.com/users/4701228/semore-1267"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 429, "favorite_count": 0, "closed_date": 1534789311, "accepted_answer_id": 51936494, "answer_count": 1, "score": 3, "last_activity_date": 1534792732, "creation_date": 1534788397, "question_id": 51936299, "link": "https://stackoverflow.com/questions/51936299/how-to-put-heterogeneous-types-into-a-rust-structure", "closed_reason": "Duplicate", "title": "How to put heterogeneous types into a Rust structure", "body": "<p>My questions is two parts (since I couldn't get the first part, I moved to the second part, which still left me with questions)</p>\n\n<p>Part #1: How do you insert heterogeneous <code>struct</code> types into a <code>HashMap</code>? At first I thought to do it via an <code>enum</code></p>\n\n<p>E.g.,</p>\n\n<pre><code>enum SomeEnum {\n    TypeA,\n    TypeB,\n    TypeC,\n}\n\nstruct TypeA{}\nstruct TypeB{}\nstruct TypeC{}\n\nlet hm = HashMap::new();\nhm.insert(\"foo\".to_string(), SomeEnum::TypeA);\nhm.insert(\"bar\".to_string(), SomeEnum::TypeB);\nhm.insert(\"zoo\".to_string(), SomeEnum::TypeC);\n</code></pre>\n\n<p>But I get a <code>\"Expected type: TypeA, found type TypeB\"</code> error</p>\n\n<p>Part #2: So then I went to the docs and read up on <a href=\"https://doc.rust-lang.org/book/second-edition/ch17-02-trait-objects.html\" rel=\"nofollow noreferrer\">Using Trait Objects that Allow for Values of Different Types</a>, and simplified the problem down to just trying to put heterogeneous types into a <code>Vec</code>. So I followed the tutorial <em>exactly</em>, but I'm still getting the same type of error (in the case of the docs, the error is now <code>\"Expected type SelectBox, found type Button\"</code>.</p>\n\n<p>I know static typing is huge part of Rust, but can anyone tell me/show me/refer me to any info related to putting different <code>struct</code> types in either a <code>Vec</code> or <code>HashMap</code>.</p>\n"}, {"tags": ["rust", "borrow-checker"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1534783564, "post_id": 51935138, "comment_id": 90820459, "body": "<i>do the same thing</i> \u2014 <a href=\"https://stackoverflow.com/q/40578224/155423\">Why doesn&#39;t the lifetime of a mutable borrow end when the function call is complete?</a>; <i>Is there any way to get [it] to work</i> \u2014 <a href=\"https://stackoverflow.com/q/35765440/155423\">What are the options to end a mutable borrow in Rust?</a>; <i>are there any plans to fix this particular issue</i> \u2014 <a href=\"https://stackoverflow.com/q/50251487/155423\">What are non-lexical lifetimes?</a>"}, {"owner": {"reputation": 11, "user_id": 6744378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ebe3557c128910d4afabd7d4e70e084?s=128&d=identicon&r=PG&f=1", "display_name": "Phlopsi", "link": "https://stackoverflow.com/users/6744378/phlopsi"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1560503284, "post_id": 51935138, "comment_id": 99766314, "body": "@Shepmaster This issue is not solvable by non-lexical lifetimes. While the current code would work, now, as soon as I add a manual drop, i.e. I don&#39;t allow the compiler to reorder the statements, so that _unit_1 gets dropped before _unit_0 is created, the error appears, again."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 6744378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ebe3557c128910d4afabd7d4e70e084?s=128&d=identicon&r=PG&f=1", "display_name": "Phlopsi", "link": "https://stackoverflow.com/users/6744378/phlopsi"}, "is_accepted": true, "score": 0, "last_activity_date": 1560513679, "last_edit_date": 1560513679, "creation_date": 1560511468, "answer_id": 56597200, "question_id": 51935138, "link": "https://stackoverflow.com/questions/51935138/errore0502-cannot-borrow-vector-as-immutable-because-it-is-also-borrowed-as/56597200#56597200", "title": "error[E0502]: cannot borrow `vector` as immutable because it is also borrowed as mutable", "body": "<p>After more testing, I think I can answer my own question, now. The provided example can be reduced even further to show the core problem. Here's the actual minimum amount of code required to reproduce the error:</p>\n\n<pre><code>// I have embedded the error message as comments\nfn main() {\n    let mut owned: () = ();\n    let ref0: &amp;() = &amp;mut owned;\n    //              ---------- mutable borrow occurs here\n    let ref1: &amp;() = &amp;owned;\n    //              ^^^^^^ immutable borrow occurs here\n    drop(ref0);\n    //   ---- mutable borrow later used here\n}\n</code></pre>\n\n<p>What this boils down to is, that Rust allows the conversion of <code>&amp;mut</code> to <code>&amp;</code>, but only in theory. Practically, as soon as you use that borrow created from the mutable borrow, while having another regular borrow, the compiler suddenly realizes, that the converted borrow is still a mutable borrow. The type checker is lying.</p>\n\n<p>In conclusion, it's impossible to combine push() and last() into a single function.</p>\n\n<p>P.S. It'd be nice if Rust would support true conversion from <code>&amp;mut</code> to <code>&amp;</code>, that doesn't produce the above error, in the future.</p>\n"}], "owner": {"reputation": 11, "user_id": 6744378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ebe3557c128910d4afabd7d4e70e084?s=128&d=identicon&r=PG&f=1", "display_name": "Phlopsi", "link": "https://stackoverflow.com/users/6744378/phlopsi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 56597200, "answer_count": 1, "score": 1, "last_activity_date": 1560513679, "creation_date": 1534783154, "last_edit_date": 1560503689, "question_id": 51935138, "link": "https://stackoverflow.com/questions/51935138/errore0502-cannot-borrow-vector-as-immutable-because-it-is-also-borrowed-as", "title": "error[E0502]: cannot borrow `vector` as immutable because it is also borrowed as mutable", "body": "<p>Inside a function, I am trying to push a value into a vector and afterwards return a reference to that value, which is inside the vector. Sadly, it doesn't work and I get the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0502]: cannot borrow `vector` as immutable because it is also borrowed as mutable\n  --&gt; src\\lib.rs:19:19\n   |\n18 |     let _unit_0 = push_and_get(&amp;mut vector);\n   |                                ----------- mutable borrow occurs here\n19 |     let _unit_1 = vector.last().unwrap();\n   |                   ^^^^^^ immutable borrow occurs here\n20 |     drop(_unit_0);\n   |          ------- mutable borrow later used here\n</code></pre>\n\n<p>Here's my code with two functions (<code>this_works</code>, <code>this_does_not_work</code>) which, to my understanding, do the same thing, but only one of them works.</p>\n\n<pre><code>fn this_works() {\n    let mut vector = Vec::new();\n    vector.push(());\n    let _unit_0 = vector.last().unwrap();\n    let _unit_1 = vector.last().unwrap();\n}\n\nfn this_does_not_work() {\n    let mut vector = Vec::new();\n    let _unit_0 = push_and_get(&amp;mut vector);\n    let _unit_1 = vector.last().unwrap();\n    drop(_unit_0); // Added, to make the error reappear\n}\n\nfn push_and_get(vector: &amp;mut Vec&lt;()&gt;) -&gt; &amp;() {\n    vector.push(());\n    vector.last().unwrap()\n}\n</code></pre>\n\n<p>Is there any way to get the <code>push_and_get</code> function to work or is it impossible, because of a limitation of Rust? If it's the first, how can I get it to work and if it's the latter, are there any plans to fix this particular issue or are there any good reasons why this shouldn't be fixed?</p>\n"}, {"tags": ["rust"], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 6, "last_activity_date": 1534780725, "last_edit_date": 1534780725, "creation_date": 1534779546, "answer_id": 51934186, "question_id": 51934079, "link": "https://stackoverflow.com/questions/51934079/what-is-the-rust-compiler-flag-to-disable-heap-allocation/51934186#51934186", "title": "What is the Rust compiler flag to disable heap allocation?", "body": "<p>There is no such compiler flag, although I don't think that's what the article meant:</p>\n\n<blockquote>\n  <p>Rust has compiler directives</p>\n</blockquote>\n\n<p>I'd parse \"directive\" as an attribute, something like <code>#[foo]</code>. There's still no attribute that I'm aware of that accomplishes this goal.</p>\n\n<p>Note that your article predates Rust 1.0:</p>\n\n<blockquote>\n  <p>Rust, version 0.11</p>\n</blockquote>\n\n<hr>\n\n<p>The closest you can get is to avoid using the standard library and only using <a href=\"https://doc.rust-lang.org/core/\" rel=\"noreferrer\">the core library</a>. This eschews the use of <code>liballoc</code>, the primary mechanism for allocation. Doing this prevents types like <code>Box</code> or <code>String</code> from even existing, which is a pretty strong static guarantee.</p>\n\n<pre><code>#![no_std]\n\npub fn example() {\n    Box::new(42);\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0433]: failed to resolve. Use of undeclared type or module `Box`\n --&gt; src/lib.rs:4:5\n  |\n4 |     Box::new(42);\n  |     ^^^ Use of undeclared type or module `Box`\n</code></pre>\n\n<p>However, nothing can stop you from rewriting the same code that is in liballoc and allocating memory yourself. You could also link against existing libraries that allocate memory. There's no magic compiler pass that detects heap allocation.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/37843379/155423\">Is it possible to use Box with no_std?</a></li>\n</ul>\n"}], "owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 454, "favorite_count": 0, "accepted_answer_id": 51934186, "answer_count": 1, "score": 4, "last_activity_date": 1534780725, "creation_date": 1534779115, "last_edit_date": 1534779267, "question_id": 51934079, "link": "https://stackoverflow.com/questions/51934079/what-is-the-rust-compiler-flag-to-disable-heap-allocation", "title": "What is the Rust compiler flag to disable heap allocation?", "body": "<p>I was reading <a href=\"http://yager.io/programming/go.html\" rel=\"nofollow noreferrer\">an article</a> which says that Rust has a compiler option to disable heap allocation:</p>\n\n<blockquote>\n  <p>Rust has a number of standard library features that rely on the heap,\n  like boxes. However, Rust has compiler directives to completely\n  disable any heap-using language features, and statically verify that\n  none of these features are being used. It is entirely practical to\n  write a Rust program with no heap usage.</p>\n</blockquote>\n\n<p>The ability to check for any mistaken heap allocations at compile-time would be very valuable to me. Exactly how do you do this in Rust? I don't see any relevant flags in the <a href=\"https://www.mankier.com/1/rustc\" rel=\"nofollow noreferrer\">rustc man page</a>.</p>\n"}, {"tags": ["rust", "lifetime", "borrow-checker"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534779039, "post_id": 51933984, "comment_id": 90818134, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/32403837/155423\">Mutable borrow seems to outlive its scope</a>. If you disagree, please <a href=\"https://stackoverflow.com/posts/51933984/edit\">edit</a> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534780265, "post_id": 51933984, "comment_id": 90818798, "body": "Yeah, thanks, I guess it&#39;s essentially the same question."}, {"owner": {"reputation": 3566, "user_id": 5138648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fdbc41d6ae88135845b5d965dac0b13?s=128&d=identicon&r=PG", "display_name": "aSpex", "link": "https://stackoverflow.com/users/5138648/aspex"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534845026, "post_id": 51933984, "comment_id": 90841298, "body": "@Shepmaster, I do not think this is duplicate.  @Matthieu M. &#39;s answer only explains how to get rid of the error. The code in the new question was cleared of all unnecessary and clearly shows the borrowchecker&#39;s weird behavior. I belive that the fact that borrowing continues beyond the scope where <code>tmp_mut</code> was defined can not be explained with equality of lifetimes or invariance."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "reply_to_user": {"reputation": 3566, "user_id": 5138648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fdbc41d6ae88135845b5d965dac0b13?s=128&d=identicon&r=PG", "display_name": "aSpex", "link": "https://stackoverflow.com/users/5138648/aspex"}, "edited": false, "score": 1, "creation_date": 1534949385, "post_id": 51933984, "comment_id": 90889507, "body": "@aSpex I disagree. Matthieu&#39;s answer contains the phrase &quot;you <i>told</i> the compiler that you wanted both lifetimes to be the same!&quot; which is exactly the reason the mutable borrow has to be no shorter than the lifetime of <code>tmp_mut</code>: <i>because you said so</i>. I don&#39;t understand your objection here, because there is clearly no lifetime that satisfies all the requirements."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 2, "creation_date": 1534949795, "post_id": 51933984, "comment_id": 90889774, "body": "<a href=\"https://stackoverflow.com/questions/32165917/why-does-linking-lifetimes-matter-only-with-mutable-references\">Why does linking lifetimes matter only with mutable references?</a> is another closely related question."}, {"owner": {"reputation": 3566, "user_id": 5138648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fdbc41d6ae88135845b5d965dac0b13?s=128&d=identicon&r=PG", "display_name": "aSpex", "link": "https://stackoverflow.com/users/5138648/aspex"}, "edited": false, "score": 0, "creation_date": 1535006467, "post_id": 51933984, "comment_id": 90909075, "body": "Thanks for that link.  &gt; &quot;there is clearly no lifetime that satisfies all the requirements&quot;  Why do you think so? The scope of the <code>main()</code> satisfies the requrements. The compiler does not complain that it can not infer the lifetime. It complains that <code>data</code> is borrowed. If you remove <code>println()</code> in the last line, then the code will run without errors.   We can deliberately create a situation where the lifetime can not be infer. Change <code>data</code> defenition to <code>let mut data:&amp;&#39;static u8 = &amp;1;</code>  Now the compiler says that <code>data does not live long enough</code>."}, {"owner": {"reputation": 3566, "user_id": 5138648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fdbc41d6ae88135845b5d965dac0b13?s=128&d=identicon&r=PG", "display_name": "aSpex", "link": "https://stackoverflow.com/users/5138648/aspex"}, "edited": false, "score": 0, "creation_date": 1535008272, "post_id": 51933984, "comment_id": 90909958, "body": "&gt; &quot;which is exactly the reason the mutable borrow has to be no shorter than the lifetime of <code>tmp_mut</code>&quot;.   I cant agree whith this. In my opinion, it is the reason why <code>tmp_mut</code> can not outlive <code>data</code>. Duration of mutable borrowing should be determined only by the inner scope in which <code>tmp_mut</code> is declared."}, {"owner": {"reputation": 3566, "user_id": 5138648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fdbc41d6ae88135845b5d965dac0b13?s=128&d=identicon&r=PG", "display_name": "aSpex", "link": "https://stackoverflow.com/users/5138648/aspex"}, "edited": false, "score": 0, "creation_date": 1535008763, "post_id": 51933984, "comment_id": 90910190, "body": "I have not seen any exceptions to this rule in the Rust book, Rustonomicon or wherever else."}, {"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "reply_to_user": {"reputation": 3566, "user_id": 5138648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fdbc41d6ae88135845b5d965dac0b13?s=128&d=identicon&r=PG", "display_name": "aSpex", "link": "https://stackoverflow.com/users/5138648/aspex"}, "edited": false, "score": 0, "creation_date": 1535030610, "post_id": 51933984, "comment_id": 90923172, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/178618/discussion-between-trentcl-and-aspex\">continue this discussion in chat</a>."}], "owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "closed_date": 1534780435, "answer_count": 0, "score": 2, "last_activity_date": 1535111761, "creation_date": 1534778716, "last_edit_date": 1535111761, "question_id": 51933984, "link": "https://stackoverflow.com/questions/51933984/what-exactly-is-the-logic-of-a-borrow-checker-in-the-case-of-nested-references-w", "closed_reason": "Duplicate", "title": "What exactly is the logic of a borrow checker in the case of nested references with the same lifetime?", "body": "<pre><code>fn f&lt;'a&gt;(_: &amp;'a mut &amp;'a u8) {}\n\nfn main() {\n    let mut data = &amp;1;\n    {\n        let tmp_mut = &amp;mut data;\n        f(tmp_mut);\n    }\n    println!(\"{:p}\", data);\n}\n</code></pre>\n\n<p><a href=\"https://play.rust-lang.org/?gist=2bd6c0fd99c9414e48ea0f8f4aa7a3ad&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0502]: cannot borrow `data` as immutable because it is also borrowed as mutable\n  --&gt; src/main.rs:11:22\n   |\n8  |         let tmp_mut = &amp;mut data;\n   |                            ---- mutable borrow occurs here\n...\n11 |     println!(\"{:p}\", data);\n   |                      ^^^^ immutable borrow occurs here\n12 | }\n   | - mutable borrow ends here\n</code></pre>\n\n<p>This code can be fixed by not using the same lifetime in the function signature (just leave <code>fn f(_: &amp;mut &amp;u8) {}</code>), but what exactly is going on here?</p>\n\n<p>The error message looks a little bit strange - it seems counterintuitive that <code>tmp_mut</code> tries to live more than the block where it was declared.\nI would expect the error message to grumble about impossible lifetime requirements, not about a uniqueness error.</p>\n"}, {"tags": ["rust", "shared-libraries"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534779922, "post_id": 51933956, "comment_id": 90818602, "body": "Perhaps a duplicate of <a href=\"https://stackoverflow.com/q/42523354/155423\">How to transfer ownership of a value to C code from Rust?</a>"}, {"owner": {"reputation": 4300, "user_id": 313522, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e6dd88ec54643689069f97f0d52398ca?s=128&d=identicon&r=PG", "display_name": "gorn", "link": "https://stackoverflow.com/users/313522/gorn"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534780066, "post_id": 51933956, "comment_id": 90818684, "body": "I am NOT trying to transfer ownership to C (because than I would have to trasfer it back and forth all the time), but the &quot;Rust FFI Omnibus&quot; seems promissing from at first sight, I will have a look at it closely."}, {"owner": {"reputation": 4300, "user_id": 313522, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e6dd88ec54643689069f97f0d52398ca?s=128&d=identicon&r=PG", "display_name": "gorn", "link": "https://stackoverflow.com/users/313522/gorn"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534780225, "post_id": 51933956, "comment_id": 90818778, "body": "More specifically about the ownership - the example calls C function from Rust, but I do it the other way round - I call the rust function from C."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534780240, "post_id": 51933956, "comment_id": 90818788, "body": "<i>I would have to trasfer it back and forth</i> \u2014 why do you believe that? Are you under the impression that transferring a pointer is an expensive operation?"}, {"owner": {"reputation": 4300, "user_id": 313522, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e6dd88ec54643689069f97f0d52398ca?s=128&d=identicon&r=PG", "display_name": "gorn", "link": "https://stackoverflow.com/users/313522/gorn"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534780595, "post_id": 51933956, "comment_id": 90818982, "body": "Maybe it is usable as well, but it raises more questions: how do I return the ownership as result to the calling C function? How do I reuse it in the C code? How do I &quot;retype&quot; it in rust back to the object it refers to when called later from the C code? However I will look at both of these links and come back. Thanks a lot for both links."}], "answers": [{"comments": [{"owner": {"reputation": 4300, "user_id": 313522, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e6dd88ec54643689069f97f0d52398ca?s=128&d=identicon&r=PG", "display_name": "gorn", "link": "https://stackoverflow.com/users/313522/gorn"}, "edited": false, "score": 0, "creation_date": 1534785972, "post_id": 51935745, "comment_id": 90821533, "body": "@Shepmaster I would be gratefull, if you look at the answer I have compiled. I have tested it and it seems to run fine, but maybe you could have some valuable insight. Thanks for the inspirational links, the credit for this answer should go to you, however I do not know how to do that..."}, {"owner": {"reputation": 4300, "user_id": 313522, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e6dd88ec54643689069f97f0d52398ca?s=128&d=identicon&r=PG", "display_name": "gorn", "link": "https://stackoverflow.com/users/313522/gorn"}, "edited": false, "score": 0, "creation_date": 1534789179, "post_id": 51935745, "comment_id": 90822915, "body": "The only thing I am not really sure about is the usage of long got the pointer on the java side."}], "tags": [], "owner": {"reputation": 4300, "user_id": 313522, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e6dd88ec54643689069f97f0d52398ca?s=128&d=identicon&r=PG", "display_name": "gorn", "link": "https://stackoverflow.com/users/313522/gorn"}, "is_accepted": false, "score": 3, "last_activity_date": 1534789073, "last_edit_date": 1534789073, "creation_date": 1534785864, "answer_id": 51935745, "question_id": 51933956, "link": "https://stackoverflow.com/questions/51933956/returning-a-pointer-to-an-object-from-a-rust-library-for-later-reuse/51935745#51935745", "title": "Returning a pointer to an object from a Rust library for later reuse?", "body": "<p><a href=\"http://jakegoulding.com/rust-ffi-omnibus/objects/\" rel=\"nofollow noreferrer\">This approach</a> can be taken:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>import com.sun.jna.Library;\nimport com.sun.jna.Native;\nimport com.sun.jna.Platform;\n\npublic class App {\n  public interface MyLibrary extends Library {\n    MyLibrary INSTANCE = (MyLibrary) Native.loadLibrary(\"myjavarust\", MyLibrary.class);\n    long set_increment_engine(double parameter);\n    double use_increment_engine(long engine, double a);\n    void free_increment_engine(long engine);\n  }\n\n  public static void main(String[] args) {\n    long engine = MyLibrary.INSTANCE.set_increment_engine(13.0);\n    double result = MyLibrary.INSTANCE.use_increment_engine(engine, 5.0);\n    System.out.println(result);  // returns correctly 18.0\n    MyLibrary.INSTANCE.free_increment_engine(engine);\n  }\n}\n</code></pre>\n\n<p>with this <strong>lib.rs</strong> code:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate libc;\n\nuse libc::c_double;\n\n#[no_mangle]\npub extern \"C\" fn set_increment_engine(param: c_double) -&gt; *mut IncrementEngine {\n    let engine = IncrementEngine { param: param };\n    Box::into_raw(Box::new(engine))\n}\n\n#[no_mangle]\npub extern \"C\" fn use_increment_engine(engine_ptr: *mut IncrementEngine, a: c_double) -&gt; c_double {\n    let engine = unsafe {\n        assert!(!engine_ptr.is_null());\n        &amp;mut *engine_ptr\n    };\n    engine.increment(a)\n}\n\n#[no_mangle]\npub extern \"C\" fn free_increment_engine(engine_ptr: *mut IncrementEngine) {\n    if engine_ptr.is_null() {\n        return;\n    }\n    unsafe {\n        Box::from_raw(engine_ptr);\n    }\n}\n\npub struct IncrementEngine {\n    param: c_double,\n}\n\nimpl IncrementEngine {\n    pub fn increment(&amp;self, a: f64) -&gt; f64 {\n        a + self.param\n    }\n}\n</code></pre>\n\n<p>Note that the function <code>addition</code> was removed as it only served for purpose of the question.</p>\n"}], "owner": {"reputation": 4300, "user_id": 313522, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/e6dd88ec54643689069f97f0d52398ca?s=128&d=identicon&r=PG", "display_name": "gorn", "link": "https://stackoverflow.com/users/313522/gorn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 728, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1534789073, "creation_date": 1534778626, "last_edit_date": 1534781388, "question_id": 51933956, "link": "https://stackoverflow.com/questions/51933956/returning-a-pointer-to-an-object-from-a-rust-library-for-later-reuse", "title": "Returning a pointer to an object from a Rust library for later reuse?", "body": "<p>I want to call a Rust library which will create an object <code>increment_engine</code> for me and return a pointer to it (or anything persistent). This engine would be given a parameter on creation.</p>\n\n<p>Later I could call this object's <code>increment(a)</code> method and it would add the remembered parameter to <code>a</code> and return the result. Here is the code: </p>\n\n<pre class=\"lang-java prettyprint-override\"><code>import com.sun.jna.Library;\nimport com.sun.jna.Native;\nimport com.sun.jna.Platform;\n\npublic class App {\n  public interface MyLibrary extends Library {\n      MyLibrary INSTANCE = (MyLibrary) Native.loadLibrary(\"myjavarust\", MyLibrary.class);\n      double addition(double a , double b);\n      int set_increment_engine(double parameter);\n      double use_increment_engine(int engine_id, double a);\n  }\n\n  public static void main() {\n    int sum = MyLibrary.INSTANCE.addition(13.0,5.0);\n    System.out.println(sum);  // this works and prints 18 (=13+5)\n\n    engine_id = MyLibrary.INSTANCE.get_increment_engine(13.0);\n    double  result = MyLibrary.INSTANCE.use_increment_engine(engine_id,5.0);\n    System.out.println(result);  // this should also return 18 \n\n  }\n}\n</code></pre>\n\n<p>The last three lines of <code>main()</code> show how I would like to use the \"increment engine\"</p>\n\n<p>The Rust pseudo-code should look like this.</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate libc;\n\nuse libc::{c_double, uint32_t};\n\n#[no_mangle]\npub extern \"C\" fn addition(a: f64, b: f64) -&gt; f64 {\n    a + b\n}\n\n#[no_mangle]\npub extern \"C\" fn set_increment_engine(param: c_double) -&gt; uint32_t {\n    let engine = IncrementEngine { param: param };\n    return_engine_id_somehow\n}\n\n#[no_mangle]\npub extern \"C\" fn use_increment_engine(engine_id: uint32_t, a: c_double) -&gt; c_double {\n    let engine = find_engine_somehow(engine_id);\n    engine.increment(a)\n}\n\nstruct IncrementEngine {\n    param: c_double,\n}\n\nimpl IncrementEngine {\n    pub fn increment(&amp;self, a: f64) -&gt; f64 {\n        a + self.param\n    }\n}\n</code></pre>\n\n<p>I have successfully tested the function \"addition\" which does not require the persistent \"increment machine\", but I would like to use the <em>engine</em> pattern (obviously for more complex things than incrementing a <code>double</code>). I have investigated many sites about passing data across library boundaries and there is lots of information on passing structures etc, but not so many on \"persistent pointers\". The only thing close to the solution is <a href=\"https://doc.rust-lang.org/beta/nomicon/ffi.html#targeting-callbacks-to-rust-objects\" rel=\"nofollow noreferrer\">in the Nomicon</a> where the Rust library calls the caller back which allows for the object to persist, but it is really not applicable to my use-case.</p>\n\n<p><code>engine_id</code> in the example is an <code>int</code>, but presumably it would be some kind of pointer to the object created by <code>set_increment_engine</code>.</p>\n"}, {"tags": ["macros", "rust", "rust-macros"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 2, "creation_date": 1534777508, "post_id": 51932944, "comment_id": 90817212, "body": "I do not want to be negative, but macros are such a mess\u2026 I also failed to match some of the Rust constructs."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1534777838, "post_id": 51932944, "comment_id": 90817410, "body": "@Boiethios I remember. I will just have to invent special syntax, similar to what you probably had to do with your issue."}], "answers": [{"comments": [{"owner": {"reputation": 4690, "user_id": 2019549, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/900a3735d55a0473c975ba9266bf0c68?s=128&d=identicon&r=PG", "display_name": "cambunctious", "link": "https://stackoverflow.com/users/2019549/cambunctious"}, "edited": false, "score": 0, "creation_date": 1594670755, "post_id": 52694079, "comment_id": 111201442, "body": "Awesome! Just a note, it also works without <code>predicate =</code> or <code>rest =</code> in the pattern. The parenthesis afterwards are what really matter."}], "tags": [], "owner": {"reputation": 6357, "user_id": 6086311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb99289473f6393b89474785f2d294d1?s=128&d=identicon&r=PG", "display_name": "dtolnay", "link": "https://stackoverflow.com/users/6086311/dtolnay"}, "is_accepted": true, "score": 3, "last_activity_date": 1538958822, "creation_date": 1538958822, "answer_id": 52694079, "question_id": 51932944, "link": "https://stackoverflow.com/questions/51932944/how-to-match-rusts-if-expressions-in-a-macro/52694079#52694079", "title": "How to match Rust&#39;s `if` expressions in a macro?", "body": "<p>You could use a <a href=\"https://danielkeep.github.io/tlborm/book/pat-incremental-tt-munchers.html\" rel=\"nofollow noreferrer\">TT muncher</a> to parse the predicate:</p>\n\n<pre><code>macro_rules! branch {\n    {\n        if $($rest:tt)*\n    } =&gt; {\n        branch_parser! {\n            predicate = ()\n            rest = ($($rest)*)\n        }\n    };\n}\n\nmacro_rules! branch_parser {\n    {\n        predicate = ($($predicate:tt)*)\n        rest = ({ $($then:tt)* } else { $($else:tt)* })\n    } =&gt; {\n        println!(\"predicate: {}\", stringify!($($predicate)*));\n        println!(\"then: {}\", stringify!($($then)*));\n        println!(\"else: {}\", stringify!($($else)*));\n    };\n\n    {\n        predicate = ($($predicate:tt)*)\n        rest = ($next:tt $($rest:tt)*)\n    } =&gt; {\n        branch_parser! {\n            predicate = ($($predicate)* $next)\n            rest = ($($rest)*)\n        }\n    };\n}\n\nfn main() {\n    branch! {\n        if foo == bar {\n            1\n        } else {\n            2\n        }\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>predicate: foo == bar\nthen: 1\nelse: 2\n</code></pre>\n"}], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1293, "favorite_count": 3, "accepted_answer_id": 52694079, "answer_count": 1, "score": 10, "last_activity_date": 1538958822, "creation_date": 1534775232, "question_id": 51932944, "link": "https://stackoverflow.com/questions/51932944/how-to-match-rusts-if-expressions-in-a-macro", "title": "How to match Rust&#39;s `if` expressions in a macro?", "body": "<p>I'm trying to write a macro that will rewrite certain Rust control flow, but I'm having difficulty matching an <code>if</code> expression. The problem is that the predicate is an expression, but an <code>expr</code> is not permitted to be followed by a <code>block</code> or <code>{</code>.</p>\n\n<p>The best I've got is to use <code>tt</code>:</p>\n\n<pre><code>macro_rules! branch {\n    (\n        if $pred:tt \n            $r1:block\n        else\n            $r2:block\n    ) =&gt; {\n        if $pred { \n            $r1\n        } else {\n            $r2\n        }\n    };\n}\n</code></pre>\n\n<p>Which works fine with single-token or grouped predicates:</p>\n\n<pre><code>branch! {\n    if (foo == bar) {\n        1\n    } else {\n        2\n    }\n}\n</code></pre>\n\n<p>But fails if the predicate was not grouped:</p>\n\n<pre><code>branch! {\n    if foo == bar {\n        1\n    } else {\n        2\n    }\n}\n</code></pre>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: no rules expected the token `==`\n</code></pre>\n\n<p>I also tried to use a repeating pattern of <code>tt</code> in the predicate:</p>\n\n<pre><code>macro_rules! branch {\n    (\n        if $($pred:tt)+\n            $r1:block\n        else\n            $r2:block\n    ) =&gt; {\n        if $($pred)+ { \n            $r1\n        } else {\n            $r2\n        }\n    };\n}\n</code></pre>\n\n<p>But this produces an error because it's now ambiguous whether subsequent block should match the <code>tt</code> too:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: local ambiguity: multiple parsing options: built-in NTs tt ('pred') or block ('r1').\n</code></pre>\n\n<p>Is there a way to do this, or am I stuck with inventing special syntax to use in the macro?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "edited": false, "score": 0, "creation_date": 1534746844, "post_id": 51925050, "comment_id": 90799715, "body": "I don&#39;t think that there&#39;re any workarounds. What&#39;s the point of having a vector of Defaults? How should it even work?"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "reply_to_user": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "edited": false, "score": 0, "creation_date": 1534747134, "post_id": 51925050, "comment_id": 90799818, "body": "You could call the method provided by the trait (in this case <code>default</code>), like with any other trait too."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534748873, "post_id": 51925050, "comment_id": 90800556, "body": "You want to make a factory ?"}, {"owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "edited": false, "score": 1, "creation_date": 1534749529, "post_id": 51925050, "comment_id": 90800874, "body": "@hellow it&#39;s a factory function that doesn&#39;t take <code>self</code>. There&#39;s no point in trying to call it with some already existing object like <code>obj.default()</code>."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "edited": false, "score": 0, "creation_date": 1534749896, "post_id": 51925050, "comment_id": 90801069, "body": "@ozkriff I have added this point to my answer"}, {"owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "edited": false, "score": 0, "creation_date": 1534750466, "post_id": 51925050, "comment_id": 90801407, "body": "Damn... You&#39;re right. How am I supposed to call a &quot;constructor&quot; on a already created object... Valid point! Thanks, for making me to understand this."}], "answers": [{"comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 1, "creation_date": 1534770025, "post_id": 51925198, "comment_id": 90812432, "body": "How often I&#39;ve wished that the rule was the other way around: ie, allow such traits to be boxed, etc... but only allow access to the subset of their interface which is object safe."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1534774498, "post_id": 51925198, "comment_id": 90815340, "body": "@MatthieuM. I think this is possible and that would be retrocompatible. Let&#39;s do an RFC ;)"}], "tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 5, "last_activity_date": 1534749884, "last_edit_date": 1534749884, "creation_date": 1534746852, "answer_id": 51925198, "question_id": 51925050, "link": "https://stackoverflow.com/questions/51925050/how-to-insert-sized-traits-into-a-collection/51925198#51925198", "title": "How to insert sized traits into a collection", "body": "<p>You cannot do such a thing because of the object safety rule. This rule says that a trait which a method returns the concrete type itself cannot be made into a trait object. The reason is that the trait object would have known the concrete type.</p>\n\n<p>Also, this trait has no method (a function that takes <code>self</code>), so there is no point to make a trait object from it.</p>\n\n<p>See more about this rule <a href=\"https://doc.rust-lang.org/book/second-edition/ch17-02-trait-objects.html#object-safety-is-required-for-trait-objects\" rel=\"nofollow noreferrer\">here</a>, <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/0255-object-safety.md\" rel=\"nofollow noreferrer\">there</a> and in this <a href=\"https://huonw.github.io/blog/2015/01/object-safety/\" rel=\"nofollow noreferrer\">blog article</a>.</p>\n\n<p>See also <a href=\"https://stackoverflow.com/questions/45116984/the-trait-cannot-be-made-into-an-object\">this question</a>.</p>\n\n<hr>\n\n<p>This rule is pretty intuitive: what do you expect your code to do?</p>\n\n<pre><code>#[derive(Default)]\nstruct Bar;\n\n#[derive(Default)]\nstruct Baz;\n\nfn main() {\n    let mut vec = Vec::&lt;Box&lt;dyn Default&gt;&gt;::new();\n    vec.push(Box::new(Bar));\n    vec.push(Box::new(Baz));\n\n    vec.first().unwrap()::new();\n    // Whatever the syntax should be, what do you expect this to return?\n    // This type cannot be know at compile time.\n}\n</code></pre>\n"}], "owner": {"reputation": 9345, "user_id": 1021920, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VukgG.jpg?s=128&g=1", "display_name": "hellow", "link": "https://stackoverflow.com/users/1021920/hellow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 51925198, "answer_count": 1, "score": 3, "last_activity_date": 1534749884, "creation_date": 1534746054, "last_edit_date": 1534747229, "question_id": 51925050, "link": "https://stackoverflow.com/questions/51925050/how-to-insert-sized-traits-into-a-collection", "title": "How to insert sized traits into a collection", "body": "<p><a href=\"https://play.rust-lang.org/?gist=35c37268fceec64573e1918d5631c40c&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<pre><code>#[derive(Default)]\nstruct Bar;\n\n#[derive(Default)]\nstruct Baz;\n\nfn main() {\n    let mut vec = Vec::&lt;Box&lt;dyn Default&gt;&gt;::new();\n//                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `std::default::Default` cannot be made into an object\n    vec.push(Box::new(Bar));\n    vec.push(Box::new(Baz));\n}\n</code></pre>\n\n<p><a href=\"https://doc.rust-lang.org/src/core/default.rs.html#94-126\" rel=\"nofollow noreferrer\">Default</a> is a sized Trait, which means you <a href=\"https://doc.rust-lang.org/std/marker/trait.Sized.html\" rel=\"nofollow noreferrer\">cannot convert it to a trait object</a>.</p>\n\n<p>For the example above, is there a workaround so I can store sized traits in a <code>Vec</code> (or any other collection)?</p>\n"}, {"tags": ["rust", "operating-system", "arm64", "toolchain"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534736132, "post_id": 51922928, "comment_id": 90797195, "body": "The conclusion is use rustup ? ;)"}, {"owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534769785, "post_id": 51922928, "comment_id": 90812285, "body": "@Stargateur But it looks like rustup doesn&#39;t have <code>aarch64-none-elf</code> toolchain too."}], "answers": [{"tags": [], "owner": {"reputation": 321, "user_id": 2671017, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/Mdvbp.jpg?s=128&g=1", "display_name": "dynsne", "link": "https://stackoverflow.com/users/2671017/dynsne"}, "is_accepted": true, "score": 2, "last_activity_date": 1534787877, "creation_date": 1534787877, "answer_id": 51936173, "question_id": 51922928, "link": "https://stackoverflow.com/questions/51922928/how-can-i-add-aarch64-none-elf-to-my-rust-toolchain/51936173#51936173", "title": "How can I add `aarch64-none-elf` to my Rust toolchain?", "body": "<p>Turns out all I needed to do was run <code>rustup default nightly</code> and use the nightly version of <code>rustc</code>, as mentioned in the warning and I'm able to get past that error. If anyone want's to explain <em>why</em> this is, that'd be nice.</p>\n\n<pre><code>\u279c  phase4 git:(master) \u2717 rustc --version\nrustc 1.30.0-nightly (33b923fd4 2018-08-18)\n</code></pre>\n"}], "owner": {"reputation": 321, "user_id": 2671017, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/Mdvbp.jpg?s=128&g=1", "display_name": "dynsne", "link": "https://stackoverflow.com/users/2671017/dynsne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1300, "favorite_count": 1, "accepted_answer_id": 51936173, "answer_count": 1, "score": 4, "last_activity_date": 1534787877, "creation_date": 1534725960, "last_edit_date": 1534772684, "question_id": 51922928, "link": "https://stackoverflow.com/questions/51922928/how-can-i-add-aarch64-none-elf-to-my-rust-toolchain", "title": "How can I add `aarch64-none-elf` to my Rust toolchain?", "body": "<p>While beginning my work on CS140e today I've completed phase 3 of the project (writing C code to speak directly to GPIO pins on a Raspberry Pi 3 which would simply blink an LED) but on phase 4, once I attempt to compile my solution in Rust, <code>rustc</code> seems to not be able to find the <code>aarch64-none-elf</code> target:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\u279c  phase4 git:(master) \u2717 make\n+ Building target/aarch64-none-elf/release/libblinky.a [xargo --release]\nWARNING: the sysroot can't be built for the Stable channel. Switch to nightly.\nwarning: `panic` setting is ignored for `test` profile\n   Compiling rlibc v1.0.0\nerror[E0463]: can't find crate for `core`\n  |\n  = note: the `aarch64-none-elf` target may not be installed\n\nerror: aborting due to previous error\n\nFor more information about this error, try `rustc --explain E0463`.\nerror: Could not compile `rlibc`.\n\nTo learn more, run the command again with --verbose.\nMakefile:35: recipe for target 'target/aarch64-none-elf/release/libblinky.a' failed\nmake: *** [target/aarch64-none-elf/release/libblinky.a] Error 101\n</code></pre>\n\n<p>and, indeed, <code>rustc --print target-list</code> doesn't include <code>aarch64-none-elf</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\u279c  phase4 git:(master) \u2717 rustc --print target-list\naarch64-linux-android\naarch64-unknown-cloudabi\naarch64-unknown-freebsd\naarch64-unknown-fuchsia\naarch64-unknown-linux-gnu\naarch64-unknown-linux-musl\naarch64-unknown-openbsd\n        ...\n</code></pre>\n\n<p>Though I have installed the toolchain:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>\u279c  phase4 git:(master) \u2717 whereis aarch64-none-elf-gcc\naarch64-none-elf-gcc: /usr/local/bin/aarch64-none-elf/bin/aarch64-none-elf-gcc\n</code></pre>\n\n<p>Also, I have a custom target file named <code>aarch64-none-elf.json</code> with these contents (presumably passed to <code>xargo</code> when building):</p>\n\n<pre><code>{\n  \"abi-blacklist\": [\n    \"stdcall\",\n    \"fastcall\",\n    \"vectorcall\",\n    \"thiscall\",\n    \"win64\",\n    \"sysv64\"\n  ],\n  \"arch\": \"aarch64\",\n  \"data-layout\": \"e-m:e-i8:8:32-i16:16:32-i64:64-i128:128-n32:64-S128\",\n  \"executables\": true,\n  \"linker\": \"aarch64-none-elf-ld\",\n  \"linker-flavor\": \"ld\",\n  \"linker-is-gnu\": true,\n  \"llvm-target\": \"aarch64-unknown-none\",\n  \"no-compiler-rt\": true,\n  \"features\": \"+a53,+strict-align\",\n  \"max-atomic-width\": 128,\n  \"os\": \"none\",\n  \"panic\": \"abort\",\n  \"panic-strategy\": \"abort\",\n  \"position-independent-executables\": true,\n  \"target-c-int-width\": \"32\",\n  \"target-endian\": \"little\",\n  \"target-pointer-width\": \"64\",\n  \"disable-redzone\": true\n}\n</code></pre>\n"}, {"tags": ["rust", "runtime-error", "ffi", "backtrace"], "comments": [{"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 2, "creation_date": 1534715328, "post_id": 51921872, "comment_id": 90793858, "body": "See also <a href=\"https://stackoverflow.com/questions/24145823/how-do-i-convert-a-c-string-into-a-rust-string-and-back-via-ffi/24148033#24148033\">How do I convert a C string into a Rust string and back via FFI?</a>"}, {"owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "edited": false, "score": 3, "creation_date": 1534715614, "post_id": 51921872, "comment_id": 90793905, "body": "<a href=\"http://jakegoulding.com/rust-ffi-omnibus/\" rel=\"nofollow noreferrer\">The Rust FFI Omnibus</a>"}, {"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1534769505, "post_id": 51921872, "comment_id": 90812114, "body": "Is the C API thread-safe? Is the lifetime of the errors really <code>&#39;static</code> (ie, an error is valid until the end of the program)?"}, {"owner": {"reputation": 842, "user_id": 1375899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7881c4b6271f3b501fe6930aa1798907?s=128&d=identicon&r=PG", "display_name": "Ehsan M. Kermani", "link": "https://stackoverflow.com/users/1375899/ehsan-m-kermani"}, "reply_to_user": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1534780102, "post_id": 51921872, "comment_id": 90818703, "body": "@MatthieuM, yes and yes!"}], "answers": [{"tags": [], "owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "is_accepted": true, "score": 6, "last_activity_date": 1534748685, "last_edit_date": 1534748685, "creation_date": 1534715081, "answer_id": 51922070, "question_id": 51921872, "link": "https://stackoverflow.com/questions/51921872/what-is-a-correct-way-of-getting-and-setting-last-error-message-through-ffi/51922070#51922070", "title": "What is a correct way of getting and setting last error message through FFI?", "body": "<p>Rust strings are not 0-terminated, however, you assume they are when you do:</p>\n\n<pre><code>c_api::SetLastError(msg.as_ptr() as *const c_char);\n</code></pre>\n\n<p>Because C APIs detect the end of a string by the presence of a null byte.</p>\n\n<p>A proper way to do this would be:</p>\n\n<pre><code>let c_string = CString::new(\"message\").unwrap(); // will add a null byte\nunsafe {\n    c_api::SetLastError(c_string.as_ptr());\n}\n</code></pre>\n\n<p>Depending on whether the C API makes a copy of the string or not, you might want to use <code>into_raw</code> plus proper deinitialization handling if necessary.</p>\n"}], "owner": {"reputation": 842, "user_id": 1375899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7881c4b6271f3b501fe6930aa1798907?s=128&d=identicon&r=PG", "display_name": "Ehsan M. Kermani", "link": "https://stackoverflow.com/users/1375899/ehsan-m-kermani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 51922070, "answer_count": 1, "score": 2, "last_activity_date": 1534772165, "creation_date": 1534712940, "last_edit_date": 1534772165, "question_id": 51921872, "link": "https://stackoverflow.com/questions/51921872/what-is-a-correct-way-of-getting-and-setting-last-error-message-through-ffi", "title": "What is a correct way of getting and setting last error message through FFI?", "body": "<p>I'm wrapping a C API (dylib) that exposes a setter and getter API for the last error message:</p>\n\n<pre><code>extern \"C\" {\n    /// GetLastError is thread-safe\n    pub fn GetLastError() -&gt; *const ::std::os::raw::c_char;\n    pub fn SetLastError(msg: *const ::std::os::raw::c_char);\n}\n</code></pre>\n\n<p>The simplest way of wrapping them is as follows</p>\n\n<pre><code>use std::error::Error;\nuse std::ffi::CStr;\nuse std::fmt::{self, Display, Formatter};\nuse std::os::raw::c_char;\n\npub struct MyError;\n\nimpl MyError {\n    pub fn get_last() -&gt; &amp;'static str {\n        unsafe {\n            match CStr::from_ptr(c_api::GetLastError()).to_str() {\n                Ok(s) =&gt; s,\n                Err(_) =&gt; \"Invalid UTF-8 message\",\n            }\n        }\n    }\n\n    pub fn set_last(msg: &amp;'static str) {\n        unsafe {\n            c_api::SetLastError(msg.as_ptr() as *const c_char);\n        }\n    }\n}\n\nimpl Display for MyError {\n    fn fmt(&amp;self, f: &amp;mut Formatter) -&gt; fmt::Result {\n        write!(f, \"{}\", MyError::get_last())\n    }\n}\n\nimpl Error for MyError {\n    fn description(&amp;self) -&gt; &amp;'static str {\n        MyError::get_last()\n    }\n\n    fn cause(&amp;self) -&gt; Option&lt;&amp;Error&gt; {\n        None\n    }\n}\n</code></pre>\n\n<p>This seems to work correctly getting the last error message. However, setting the last error message seems naive and it clutters previous messages in the stack frame!</p>\n\n<p>For example; </p>\n\n<pre><code>let msg: &amp;'static str = \"invalid\";\nMyError::set_last(msg);\nprintln!(\"Last error msg: {}\", MyError::get_last());\n</code></pre>\n\n<p>outputs <code>Last error msg: invalidLast error msg</code>, or</p>\n\n<pre><code>assert_eq!(MyError::get_last().trim(), msg);\n</code></pre>\n\n<p>fails with</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>thread 'tests::set_error' panicked at 'assertion failed: `(left == right)`\n  left: `\"invalidassertion failed: `(left == right)`\\n  left: ``,\\n right: ``\"`,\n right: `\"invalid\"`'\n</code></pre>\n\n<p>What's a correct way doing this?</p>\n\n<p>I thought of using <a href=\"https://github.com/alexcrichton/backtrace-rs\" rel=\"nofollow noreferrer\">backtrace</a>, but found little explanations in the crate and it led to nowhere!</p>\n"}, {"tags": ["rust", "rust-tokio"], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534771286, "post_id": 51921472, "comment_id": 90813231, "body": "<i>the life of the return value can be extended</i> \u2014 this is very dangerous wording. Many newcomers to Rust think that lifetimes <i>control</i> how long something lives and that by finding the &quot;magic&quot; lifetime that their code will start working. Lifetimes do not work this way, but the term &quot;extend&quot; is commonly used by those who think they do."}, {"owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1534787932, "post_id": 51921472, "comment_id": 90822359, "body": "@Shepmaster, I tried to reword it. The lifetime is indeed merely an upper bound on the validity."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534788025, "post_id": 51921472, "comment_id": 90822398, "body": "I don&#39;t think I stated this clearly, but I knew that you knew the right thing; it&#39;s just mostly a matter of tricky phrasing. ;-)"}], "tags": [], "owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "is_accepted": false, "score": 3, "last_activity_date": 1534787757, "last_edit_date": 1534787757, "creation_date": 1534709685, "answer_id": 51921472, "question_id": 51921064, "link": "https://stackoverflow.com/questions/51921064/expected-lifetime-parameter-error-in-minimal-futures-callback-example/51921472#51921472", "title": "&quot;Expected lifetime parameter&quot; error in minimal futures callback example?", "body": "<p>Everything in Rust has a lifetime bound. If it contains references, it is the lifetime of the shortest-lived reference, otherwise it is <code>'static</code>, which should be interpreted as \u201cdoes not depend on anything that could have shorter lifetime\u201d.</p>\n\n<p>Therefore the lifetime of <code>i32</code> is known. It is <code>'static</code>, because it does not contain any references.</p>\n\n<p>But <code>Error</code>, which is <code>std::error::Error</code> is a <em>trait</em>, and one which does not require any lifetime bound. That means you could implement it for a reference, or a type including a reference with a lifetime. And since the code is supposed to be valid for <em>any</em> substitution you might make anywhere downstream, the compiler insists that you give it a lifetime that is lower bound for usability of the return value.</p>\n\n<p>Giving it <code>'static</code> lifetime is sensible here. It does not mean the return value would be valid over the entire program execution, it only means the the return value is not limited to any shorter lifetime (which basically means that it does not depend on anything outside the <code>Box</code> except possibly static things) and will stay valid as long as something holds on to it.</p>\n\n<p>I believe the correct syntax is:</p>\n\n<pre><code>fn async_op() -&gt; impl Future&lt;Item = i32, Error = Box&lt;Error + 'static&gt;&gt;\n</code></pre>\n\n<p>Note that it is really only limiting the <em>content of the Box</em>. That's the only thing the compiler does not see into and is concerned it might cease to be valid at some point. And thus you promise it that the content of the <code>Box</code> won't become invalid <em>until it drops the Box</em>.</p>\n"}], "owner": {"reputation": 21, "user_id": 871729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c40b1ecbfc315e24b13accdec38d7d53?s=128&d=identicon&r=PG", "display_name": "traceroute", "link": "https://stackoverflow.com/users/871729/traceroute"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "closed_date": 1534771153, "answer_count": 1, "score": 2, "last_activity_date": 1534787757, "creation_date": 1534706460, "last_edit_date": 1534771125, "question_id": 51921064, "link": "https://stackoverflow.com/questions/51921064/expected-lifetime-parameter-error-in-minimal-futures-callback-example", "closed_reason": "Duplicate", "title": "&quot;Expected lifetime parameter&quot; error in minimal futures callback example?", "body": "<p>I'm trying to build a <a href=\"https://play.rust-lang.org/?gist=bdabc0eb791d3db36faa3a0f7104f20d&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">very basic example of an asynchronous callback function in Rust</a>:</p>\n\n<pre><code>extern crate tokio;\nextern crate tokio_core;\nextern crate tokio_io;\n\nuse std::error::Error;\nuse tokio::prelude::future::ok;\nuse tokio::prelude::Future;\n\nfn async_op() -&gt; impl Future&lt;Item = i32, Error = Box&lt;Error&gt;&gt; {\n    ok(12)\n}\n\nfn main() {\n    let fut = async_op().and_then(|result| {\n        println!(\"result: {:?}\", result);\n    });\n    tokio::run(fut);\n}\n</code></pre>\n\n<p>This always results in the compiler error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0106]: missing lifetime specifier\n --&gt; src/main.rs:9:54\n  |\n9 | fn async_op() -&gt; impl Future&lt;Item = i32, Error = Box&lt;Error&gt;&gt; {\n  |                                                      ^^^^^ expected lifetime parameter\n  |\n  = help: this function's return type contains a borrowed value, but there is no value for it to be borrowed from\n  = help: consider giving it a 'static lifetime\n</code></pre>\n\n<p>Why is there a lifetime error in the first place? Why is it only for the <code>Error</code> but not for the <code>Item</code>?</p>\n\n<p>I am also unsure about \"help: consider giving it a 'static lifetime\" \u2012 AFAICT this would result in a lifetime of the return value over the entire program execution, which is definitely not what I would want in a more complex example.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 5, "creation_date": 1534698918, "post_id": 51919815, "comment_id": 90789859, "body": "&quot;this doesn&#39;t work as intended&quot;, alright, but what&#39;s not working then?"}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534701872, "post_id": 51919815, "comment_id": 90790652, "body": "&quot;hanging man simulation&quot; for non english speaker please explain the behavior wanted and the problem you are facing to."}, {"owner": {"reputation": 71, "user_id": 9991631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64ac8ffd0b3e479ef04fd0474f9d3ad2?s=128&d=identicon&r=PG&f=1", "display_name": "Charles Jonasson", "link": "https://stackoverflow.com/users/9991631/charles-jonasson"}, "edited": false, "score": 0, "creation_date": 1534703203, "post_id": 51919815, "comment_id": 90790997, "body": "the program asks for a character &gt; and the user inputs one &gt; and then the program compares the guess to the word to see if there is a match with characters"}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1534703652, "post_id": 51919815, "comment_id": 90791110, "body": "@CharlesJonasson if your program does not compile, please edit the question to include the error and explain what you do not understand in the error message. If your program does compile, please edit your question to add a description of what exactly is the current behaviour and how it differs from the expected behaviour."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534707477, "post_id": 51919815, "comment_id": 90792110, "body": "@CharlesJonasson <a href=\"https://stackoverflow.com/posts/51919815/edit\">edit</a> your question to make it better would be much better than ask information in comment section. You should read <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1534715444, "post_id": 51919815, "comment_id": 90793877, "body": "I&#39;ve edited the question to include the error message that you&#39;d see with the source code you have provided. A <code>String</code> cannot be compared to a <code>char</code>. So you need to find a way to turn your <code>String</code> into <code>char</code>s or your <code>char</code> into a <code>String</code> so they can be compared."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1534715626, "post_id": 51919815, "comment_id": 90793910, "body": "And it looks like you were already on your way to doing that when you created the <code>char_vec</code> variable. But then you don&#39;t use it! Comparing <code>char_vec[0]</code> instead of <code>line</code> will at least compile. I can&#39;t tell you if this is what you actually want your program to do though."}], "answers": [{"comments": [{"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1534886829, "post_id": 51923306, "comment_id": 90864436, "body": "<code>String::len</code> returns the size in bytes, not in <code>chars</code>. So if I were to guess that your word starts with <code>&#233;</code>, your function would tell me &quot;Please guess a single char.&quot;."}], "tags": [], "owner": {"reputation": 129, "user_id": 2958778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2480b04b9493594c5f1d6750041b3963?s=128&d=identicon&r=PG&f=1", "display_name": "Scott Maddox", "link": "https://stackoverflow.com/users/2958778/scott-maddox"}, "is_accepted": false, "score": 1, "last_activity_date": 1534771881, "last_edit_date": 1534771881, "creation_date": 1534730373, "answer_id": 51923306, "question_id": 51919815, "link": "https://stackoverflow.com/questions/51919815/compilation-error-when-comparing-a-string-with-a-char-in-a-hangman-project/51923306#51923306", "title": "Compilation error when comparing a string with a char in a Hangman project", "body": "<p>Here's the critical part of the error message:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>can't compare `std::string::String` with `char`\n</code></pre>\n\n<p>The problem is that you're storing the user input as a <code>String</code>, but trying to compare it with a <code>char</code>. There are a couple of solutions. Perhaps the simplest is to use the first <code>char</code> from the user input <code>String</code>:</p>\n\n<pre><code>use std::io::stdin;\n\nfn main() {\n    'outer: loop {\n        let w1 = vec!['m', 'o', 'm', 'm', 'y']; //the answer\n        println!(\"Guess a Character\");\n\n        loop {\n            let mut line = String::new(); //the guess\n\n            stdin().read_line(&amp;mut line).unwrap();\n            if line.len() &lt; 1 || line.len() &gt; 1 {\n                println!(\"Please guess a single char.\");\n            } else {\n                let guess = line.chars().next().unwrap();\n                let mut correct = false;\n                for c in &amp;w1 {\n                    if guess == *c {\n                        correct = true;\n                        break;\n                    }\n                }\n                if correct {\n                    println!(\"You guessd right!\");\n                } else {\n                    println!(\"You guessed wrong...\");\n                }\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 9991631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64ac8ffd0b3e479ef04fd0474f9d3ad2?s=128&d=identicon&r=PG&f=1", "display_name": "Charles Jonasson", "link": "https://stackoverflow.com/users/9991631/charles-jonasson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534771881, "creation_date": 1534697081, "last_edit_date": 1534771844, "question_id": 51919815, "link": "https://stackoverflow.com/questions/51919815/compilation-error-when-comparing-a-string-with-a-char-in-a-hangman-project", "title": "Compilation error when comparing a string with a char in a Hangman project", "body": "<p>I'm trying to make a hangman game:</p>\n\n<pre><code>use std::io::stdin;\n\nfn main() {\n    let mut isRunning: bool = true;\n\n    'outer: loop {\n        let w1 = vec!['m', 'o', 'm', 'm', 'y']; //the answer\n        println!(\"Guess a Character\");\n\n        loop {\n            let mut line = String::new(); //the guess\n\n            let input = stdin().read_line(&amp;mut line);\n            let char_vec: Vec&lt;char&gt; = line.to_string().chars().collect();\n\n            for x in 0..4 {\n                if line == w1[x] {\n                    println!(\"you guessed right? \");\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I get a compiler error when comparing the user input to the letters in the word:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0277]: the trait bound `std::string::String: std::cmp::PartialEq&lt;char&gt;` is not satisfied\n  --&gt; src/main.rs:17:25\n   |\n17 |                 if line == w1[x] {\n   |                         ^^ can't compare `std::string::String` with `char`\n   |\n   = help: the trait `std::cmp::PartialEq&lt;char&gt;` is not implemented for `std::string::String`\n</code></pre>\n\n<p>Why this doesn't work as intended?</p>\n"}, {"tags": ["testing", "dependency-injection", "rust", "mocking"], "answers": [{"tags": [], "owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "is_accepted": true, "score": 6, "last_activity_date": 1534715174, "last_edit_date": 1534715174, "creation_date": 1534712466, "answer_id": 51921832, "question_id": 51919079, "link": "https://stackoverflow.com/questions/51919079/how-to-mock-external-dependencies-in-tests/51921832#51921832", "title": "How to mock external dependencies in tests?", "body": "<p>I would suggest you wrap the back-end function <code>speed_control::increase</code> in some trait:</p>\n\n<pre><code>trait SpeedControlBackend {\n    fn increase();\n}\n\nstruct RealSpeedControl;\n\nimpl SpeedControlBackend for RealSpeedControl {\n    fn increase() {\n        speed_control::increase();\n    }\n}\n\nstruct MockSpeedControl;\n\nimpl SpeedControlBackend for MockSpeedControl {\n    fn increase() {\n        println!(\"MockSpeedControl::increase called\");\n    }\n}\n\ntrait SpeedControl {\n    fn other_function(&amp;self) -&gt; Result&lt;(), ()&gt;;\n}\n\nstruct Car&lt;T: SpeedControlBackend&gt; {\n    sc: T,\n}\n\nimpl&lt;T: SpeedControlBackend&gt; SpeedControl for Car&lt;T&gt; {\n    fn other_function(&amp;self) -&gt; Result&lt;(), ()&gt; {\n        match self.sc.increase() {\n            () =&gt; (),\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1784, "user_id": 3146716, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/BfuKj.jpg?s=128&g=1", "display_name": "simeg", "link": "https://stackoverflow.com/users/3146716/simeg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1274, "favorite_count": 2, "closed_date": 1534771484, "accepted_answer_id": 51921832, "answer_count": 1, "score": 4, "last_activity_date": 1534771515, "creation_date": 1534691762, "last_edit_date": 1534771358, "question_id": 51919079, "link": "https://stackoverflow.com/questions/51919079/how-to-mock-external-dependencies-in-tests", "closed_reason": "Duplicate", "title": "How to mock external dependencies in tests?", "body": "<p>I've modeled and implemented a car using an extern crate inside the implementation:</p>\n\n<pre><code>extern crate speed_control;\n\nstruct Car;\n\ntrait SpeedControl {\n    fn increase(&amp;self) -&gt; Result&lt;(), ()&gt;;\n    fn decrease(&amp;self) -&gt; Result&lt;(), ()&gt;;\n}\n\nimpl SpeedControl for Car {\n    fn increase(&amp;self) -&gt; Result&lt;(), ()&gt; {\n        match speed_control::increase() {  // Here I use the dependency\n          // ... \n        }\n    }\n    // ...\n}\n</code></pre>\n\n<p>I want to test the implementation above, but in my tests I don't want <code>speed_control::increase()</code> to behave like it was in production - I want to mock it. How can I achieve this?</p>\n"}, {"tags": ["rust", "rust-cargo"], "comments": [{"owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "edited": false, "score": 3, "creation_date": 1534685813, "post_id": 51917952, "comment_id": 90786161, "body": "<code>cargo uninstall</code> is for binaries (like <code>cargo-tree</code> for example) that you&#39;ve installed, not dependencies of the project. If you want to remove one of your dependencies just edit <code>Cargo.toml</code> of the project."}, {"owner": {"reputation": 1986, "user_id": 2843583, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/5ed69a2177b073c7600828646620a9b1?s=128&d=identicon&r=PG", "display_name": "bergercookie", "link": "https://stackoverflow.com/users/2843583/bergercookie"}, "reply_to_user": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "edited": false, "score": 0, "creation_date": 1534686289, "post_id": 51917952, "comment_id": 90786302, "body": "Hmm, that makes sense. But how would I know in which one of my projects is that dependency in use? Notice that this may be a dependency of my dependency so it&#39;s not as straightforward as something like  <code>find Cargo.toml | xargs cat | grep &lt;dep-name&gt;</code>"}, {"owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "edited": false, "score": 1, "creation_date": 1534686603, "post_id": 51917952, "comment_id": 90786396, "body": "You may take a look at <a href=\"https://github.com/sfackler/cargo-tree#cargo-tree\" rel=\"nofollow noreferrer\">cargo-tree</a>"}, {"owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "edited": false, "score": 1, "creation_date": 1534689062, "post_id": 51917952, "comment_id": 90787155, "body": "or you can just check generated <code>Cargo.lock</code> - it lists all the recursive deps of the project"}, {"owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "edited": false, "score": 2, "creation_date": 1534689130, "post_id": 51917952, "comment_id": 90787176, "body": "btw, what exactly are you trying to do? If I remember correctly, <code>~&#47;.cargo&#47;registry</code> is just a cache so you can delete anything you want from there - cargo will re-download what it needs later."}], "answers": [{"comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 0, "creation_date": 1534772383, "post_id": 51919907, "comment_id": 90813976, "body": "<i>Using arbitrary dot-dirs is an insult at this day and age. It was reported, several times probably.</i> =&gt; I would note that this is <i>your</i> opinion, not an established fact. I can see both sides of the argument as &quot;consistency across applications on the platform&quot; vs &quot;consistency of cargo across platforms&quot;."}], "tags": [], "owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "is_accepted": true, "score": 5, "last_activity_date": 1534697743, "creation_date": 1534697743, "answer_id": 51919907, "question_id": 51917952, "link": "https://stackoverflow.com/questions/51917952/cannot-use-cargo-uninstall-to-uninstall-packages-in-cargo-package-id-specifi/51919907#51919907", "title": "Cannot use cargo uninstall to uninstall packages in ~/.cargo: package id specification matched no package", "body": "<p><code>cargo uninstall</code> undoes the effect of <code>cargo install</code>. You did not <code>cargo install</code> <code>rand</code>, because it is just a library, not an executable program. That means it was <em>not installed</em>.</p>\n\n<p>The <code>~/.cargo/registry</code> is just a cache of build dependencies. Feel free to wipe it anytime; cargo will re-download and re-build whatever it needs when it does.</p>\n\n<p>Yes, it is wrong. Cargo should be using <code>.local</code>, <code>.config</code> and <code>.cache</code> as appropriate; then it would be obvious what you can just clean up. Using arbitrary dot-dirs is an insult at this day and age. It was reported, several times probably. Nobody got around to fixing it yet.</p>\n"}], "owner": {"reputation": 1986, "user_id": 2843583, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/5ed69a2177b073c7600828646620a9b1?s=128&d=identicon&r=PG", "display_name": "bergercookie", "link": "https://stackoverflow.com/users/2843583/bergercookie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1992, "favorite_count": 0, "accepted_answer_id": 51919907, "answer_count": 1, "score": 3, "last_activity_date": 1534770970, "creation_date": 1534684095, "last_edit_date": 1534770970, "question_id": 51917952, "link": "https://stackoverflow.com/questions/51917952/cannot-use-cargo-uninstall-to-uninstall-packages-in-cargo-package-id-specifi", "title": "Cannot use cargo uninstall to uninstall packages in ~/.cargo: package id specification matched no package", "body": "<p>I'm having trouble uninstalling Cargo-installed packages from my system.</p>\n\n<p>There are packages like rand-0.3.22 that are obviously installed under <code>$HOME/.cargo</code></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>ls ~/.cargo/registry/src/github.com-1ecc6299db9ec823/ra\n\nracer-2.0.14/     rand-0.3.22/      rand-0.4.2/\nrand-0.4.3/       rand-0.5.5/       rand_core-0.2.1/\nrawpointer-0.1.0/ rayon-1.0.2/      rayon-core-1.4.1/\n</code></pre>\n\n<p>This can also be verified by using <code>cargo pkgid</code></p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cargo pkgid -p rand\n\nerror: There are multiple `rand` packages in your project, and the specification `rand` is ambiguous.\n\nPlease re-run this command with `-p &lt;spec&gt;` where `&lt;spec&gt;` is one of the following:\n\nrand:0.5.5\nrand:0.4.3\nrand:0.3.22\n</code></pre>\n\n<p>However, I'm unable to remove that package with <code>cargo uninstall</code>. None of these seem to work:</p>\n\n<ul>\n<li><p><code>cargo uninstall rand</code></p></li>\n<li><p><code>cargo uninstall -- rand:0.4.3</code></p></li>\n<li><p><code>cargo uninstall https://github.com/rust-lang/crates.io-index#rand:0.4.3</code></p></li>\n</ul>\n\n<p>For any of the commands above I get:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error: invalid package id specification: &lt;name-of-package-i-specified&gt;\n</code></pre>\n\n<p>This seems like a rather basic operation so I suspect it's something fundamental to how <code>cargo-uninstall</code> is to be used.</p>\n\n<p>Any pointers?</p>\n"}, {"tags": ["rust", "rust-cargo", "rust-macros"], "comments": [{"owner": {"reputation": 314, "user_id": 5883049, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L81F9.jpg?s=128&g=1", "display_name": "bertfred", "link": "https://stackoverflow.com/users/5883049/bertfred"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 3, "creation_date": 1536404524, "post_id": 51917354, "comment_id": 91417913, "body": "Wow from +6 to -3. @Shepmaster I think people weren&#39;t happy with your editing. Just joking ;)"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 5, "creation_date": 1536642113, "post_id": 51917354, "comment_id": 91485258, "body": "Your question was brought up on Meta, and they did not feel that the question&#39;s rating was on par with its quality. Next time, please show additional effort in your questions."}, {"owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "reply_to_user": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1538989950, "post_id": 51917354, "comment_id": 92324320, "body": "@E_net4 do you have a link to the meta thread?"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "reply_to_user": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "edited": false, "score": 2, "creation_date": 1538990093, "post_id": 51917354, "comment_id": 92324411, "body": "@TimDiekmann <a href=\"https://meta.stackoverflow.com/q/373705/1233251\">meta.stackoverflow.com/q/373705/1233251</a>"}], "answers": [{"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 12, "last_activity_date": 1547552804, "last_edit_date": 1547552804, "creation_date": 1534682570, "answer_id": 51917771, "question_id": 51917354, "link": "https://stackoverflow.com/questions/51917354/is-it-possible-to-get-the-expansion-of-a-single-macro-instead-of-the-whole-file/51917771#51917771", "title": "Is it possible to get the expansion of a single macro instead of the whole file?", "body": "<p>The <a href=\"https://github.com/dtolnay/cargo-expand\" rel=\"nofollow noreferrer\"><code>cargo-expand</code></a> command is really just a thin wrapper around <code>cargo rustc -- -Zunstable-options --pretty=expanded</code>, which is itself a blunt instrument. You can't target a specific macro. </p>\n\n<p>However, since <a href=\"https://github.com/dtolnay/cargo-expand/releases/tag/0.4.0\" rel=\"nofollow noreferrer\">version 0.4</a>, you can reduce some noise by specifying an extra path argument to expand only macros used by that module:</p>\n\n<pre><code>$ cargo expand path::to::module\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 314, "user_id": 5883049, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L81F9.jpg?s=128&g=1", "display_name": "bertfred", "link": "https://stackoverflow.com/users/5883049/bertfred"}, "edited": false, "score": 1, "creation_date": 1539007349, "post_id": 52315201, "comment_id": 92334524, "body": "How can I do this without intellij ?"}, {"owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "edited": false, "score": 0, "creation_date": 1539010566, "post_id": 52315201, "comment_id": 92336449, "body": "It&#39;s a part of the plugin&#39;s logic, so I guess that you can&#39;t use it outside of IntelliJ-Rust."}], "tags": [], "owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "is_accepted": false, "score": 7, "last_activity_date": 1536846575, "creation_date": 1536846575, "answer_id": 52315201, "question_id": 51917354, "link": "https://stackoverflow.com/questions/51917354/is-it-possible-to-get-the-expansion-of-a-single-macro-instead-of-the-whole-file/52315201#52315201", "title": "Is it possible to get the expansion of a single macro instead of the whole file?", "body": "<p>\"Show expanded macro\" and \"Show recursively expanded macro\" commands were <a href=\"https://intellij-rust.github.io/2018/08/06/changelog-80.html\" rel=\"noreferrer\">recently added</a> to <a href=\"https://intellij-rust.github.io/\" rel=\"noreferrer\">IntelliJ Rust</a>.</p>\n\n<p>A gif demo from <a href=\"https://blog.jetbrains.com/clion/2018/08/intellij-rust-features-entry-one-macros/\" rel=\"noreferrer\">CLion blog post</a>:</p>\n\n<p><img src=\"https://d3nmt5vlzunoa1.cloudfront.net/clion/files/2018/08/4_expand_macro.gif\" alt=\"Demo\"></p>\n"}], "owner": {"reputation": 314, "user_id": 5883049, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L81F9.jpg?s=128&g=1", "display_name": "bertfred", "link": "https://stackoverflow.com/users/5883049/bertfred"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1347, "favorite_count": 3, "answer_count": 2, "score": 3, "last_activity_date": 1551785610, "creation_date": 1534679363, "last_edit_date": 1551785610, "question_id": 51917354, "link": "https://stackoverflow.com/questions/51917354/is-it-possible-to-get-the-expansion-of-a-single-macro-instead-of-the-whole-file", "title": "Is it possible to get the expansion of a single macro instead of the whole file?", "body": "<p>I just found <a href=\"https://stackoverflow.com/questions/28580386/how-do-i-see-the-expanded-macro-code-thats-causing-my-compile-error/28580527\">How do I see the expanded macro code that&#39;s causing my compile error?</a>. Is it possible to get the expansion of a single macro instead of the whole file?</p>\n"}, {"tags": ["rust", "julia"], "comments": [{"owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "edited": false, "score": 1, "creation_date": 1534676053, "post_id": 51916904, "comment_id": 90783646, "body": "check this <a href=\"https://github.com/alexcrichton/rust-ffi-examples/tree/a2ddf21e4/julia-to-rust\" rel=\"nofollow noreferrer\">github.com/alexcrichton/rust-ffi-examples/tree/a2ddf21e4/&hellip;</a>"}, {"owner": {"reputation": 1038, "user_id": 547270, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yEM1T.png?s=128&g=1", "display_name": "scrutari", "link": "https://stackoverflow.com/users/547270/scrutari"}, "edited": false, "score": 2, "creation_date": 1534676503, "post_id": 51916904, "comment_id": 90783756, "body": "This question is beautiful per se"}, {"owner": {"reputation": 15416, "user_id": 2441637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z8fpp.jpg?s=128&g=1", "display_name": "Hasan A Yousef", "link": "https://stackoverflow.com/users/2441637/hasan-a-yousef"}, "reply_to_user": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "edited": false, "score": 0, "creation_date": 1534677181, "post_id": 51916904, "comment_id": 90783877, "body": "Thanks @ozkriff, what about the opposite way, i.e. calling Julia from Rust?"}, {"owner": {"reputation": 16267, "user_id": 1346276, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Tu8Re.jpg?s=128&g=1", "display_name": "phipsgabler", "link": "https://stackoverflow.com/users/1346276/phipsgabler"}, "reply_to_user": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "edited": false, "score": 1, "creation_date": 1534678611, "post_id": 51916904, "comment_id": 90784212, "body": "@ozkriff, I think you expand that into an answer!"}], "answers": [{"comments": [{"owner": {"reputation": 15416, "user_id": 2441637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z8fpp.jpg?s=128&g=1", "display_name": "Hasan A Yousef", "link": "https://stackoverflow.com/users/2441637/hasan-a-yousef"}, "edited": false, "score": 0, "creation_date": 1534692299, "post_id": 51918853, "comment_id": 90787991, "body": "How can I make output file like <code>run.o</code> instead of the make file?"}, {"owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "reply_to_user": {"reputation": 15416, "user_id": 2441637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z8fpp.jpg?s=128&g=1", "display_name": "Hasan A Yousef", "link": "https://stackoverflow.com/users/2441637/hasan-a-yousef"}, "edited": false, "score": 0, "creation_date": 1534693243, "post_id": 51918853, "comment_id": 90788270, "body": "@HasanAYousef how to compile rust code to a static library?  <a href=\"https://stackoverflow.com/questions/43866969\">stackoverflow.com/questions/43866969</a> and <a href=\"https://stackoverflow.com/questions/50229088\">stackoverflow.com/questions/50229088</a> should help"}, {"owner": {"reputation": 65310, "user_id": 201725, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/616f7a1cbb20fe949d883393657c039a?s=128&d=identicon&r=PG", "display_name": "Jan Hudec", "link": "https://stackoverflow.com/users/201725/jan-hudec"}, "edited": false, "score": 1, "creation_date": 1534694057, "post_id": 51918853, "comment_id": 90788486, "body": "You don&#39;t <i>have to</i> use the julia crate. You can always run bindgen yourself. But you <i>should</i> use it, because it is easier."}], "tags": [], "owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "is_accepted": true, "score": 8, "last_activity_date": 1534709486, "last_edit_date": 1534709486, "creation_date": 1534690193, "answer_id": 51918853, "question_id": 51916904, "link": "https://stackoverflow.com/questions/51916904/interaction-between-julia-and-rust/51918853#51918853", "title": "Interaction between Julia and Rust", "body": "<blockquote>\n  <p>Calling Rust function from Julia, like ccall</p>\n</blockquote>\n\n<p>There's an example for this in <a href=\"https://github.com/alexcrichton/rust-ffi-examples/tree/a2ddf21e4/julia-to-rust\" rel=\"noreferrer\">alexcrichton/rust-ffi-examples</a> repo:</p>\n\n<p><code>Cargo.toml</code>:</p>\n\n<pre><code>[package]\nname = \"julia-to-rust\"\nversion = \"0.1.0\"\nauthors = [\"timmonfette1 &lt;monfette.timothy@gmail.com&gt;\"]\n\n[lib]\nname = \"double_input\"\ncrate-type = [\"dylib\"]\n</code></pre>\n\n<p><code>src/lib.rs</code>:</p>\n\n<pre><code>#[no_mangle]\npub extern fn double_input(input: i32) -&gt; i32 {\n    input * 2\n}\n</code></pre>\n\n<p><code>src/main.jl</code>:</p>\n\n<pre><code>input = Int32(10)\noutput =  ccall((:double_input, \"target/debug/libdouble_input\"),\n                        Int32, (Int32,), input)\n\nprint(input)\nprint(\" * 2 = \")\nprintln(output)\n</code></pre>\n\n<p><code>Makefile</code>:</p>\n\n<pre><code>ifeq ($(shell uname),Darwin)\n    EXT := dylib\nelse\n    EXT := so\nendif\n\nall: target/debug/libdouble_input.$(EXT)\n    julia src/main.jl\n\ntarget/debug/libdouble_input.$(EXT): src/lib.rs Cargo.toml\n    cargo build\n\nclean:\n    rm -rf target\n</code></pre>\n\n<p>The idea is that you export a non-mangled function and compile your rust library to a normal native shared library. Then you just use standard C FFI of Julia.</p>\n\n<blockquote>\n  <p>Calling Julia from Rust</p>\n</blockquote>\n\n<p>I guess it's better to use <a href=\"https://crates.io/crates/julia\" rel=\"noreferrer\"><code>julia</code> crate</a> for this - it provides a safe wrapper over a <a href=\"https://github.com/pi-pi3/julia-rs/tree/master/julia-sys\" rel=\"noreferrer\">raw C API</a>. Example from the repo:</p>\n\n<pre><code>fn main() {\n    use julia::api::{Julia, Value};\n\n    let mut jl = Julia::new().unwrap();\n    jl.eval_string(\"println(\\\"Hello, Julia!\\\")\").unwrap();\n    // Hello, Julia!\n\n    let sqrt = jl.base().function(\"sqrt\").unwrap();\n\n    let boxed_x = Value::from(1337.0);\n    let boxed_sqrt_x = sqrt.call1(&amp;boxed_x).unwrap();\n\n    let sqrt_x = f64::try_from(boxed_sqrt_x).unwrap();\n    println!(\"{}\", sqrt_x);\n    // 36.565010597564445\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 15416, "user_id": 2441637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z8fpp.jpg?s=128&g=1", "display_name": "Hasan A Yousef", "link": "https://stackoverflow.com/users/2441637/hasan-a-yousef"}, "is_accepted": false, "score": 2, "last_activity_date": 1534771704, "last_edit_date": 1534771704, "creation_date": 1534690323, "answer_id": 51918872, "question_id": 51916904, "link": "https://stackoverflow.com/questions/51916904/interaction-between-julia-and-rust/51918872#51918872", "title": "Interaction between Julia and Rust", "body": "<h3>Executing Julia from Rust</h3>\n\n<p>Use Rust's <a href=\"https://doc.rust-lang.org/std/process/struct.Command.html\" rel=\"nofollow noreferrer\"><code>Command</code></a>.</p>\n\n<p>Create a <code>main.jl</code> file that contains:</p>\n\n<pre><code># __precompile__()   # If required to be kept precompiled for faster execution\n# name = isempty(ARGS) ? \"name\" : ARGS[1] # To check input arguments\nprintln(\"hello from Julia function\")\n</code></pre>\n\n<p>Create a <code>main.rs</code> file that contains:</p>\n\n<pre><code>use std::process::Command;\n\nfn main() {\n    println!(\"Hello from Rust\");\n    let mut cmd = Command::new(\"Julia\");\n    cmd.arg(\"main.jl\");\n    // cmd.args(&amp;[\"main.jl\", \"arg1\", \"arg2\"]);\n    match cmd.output() {\n        Ok(o) =&gt; unsafe {\n            println!(\"Output: {}\", String::from_utf8_unchecked(o.stdout));\n        },\n        Err(e) =&gt; {\n            println!(\"There was an error {}\", e);\n        }\n    }\n}\n</code></pre>\n\n<p>Then, by running <code>cargo run</code> you'll get the required output below:</p>\n\n<p><a href=\"https://i.stack.imgur.com/ApVC2.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ApVC2.png\" alt=\"enter image description here\"></a></p>\n\n<h3>Executing Rust from Julia</h3>\n\n<p>Use the <a href=\"https://docs.julialang.org/en/v0.6.1/manual/calling-c-and-fortran-code/\" rel=\"nofollow noreferrer\">calling-c-and-fortran-code</a> by <a href=\"https://docs.julialang.org/en/v0.6.1/stdlib/c/#ccall\" rel=\"nofollow noreferrer\">ccall</a></p>\n\n<p>Create a Rust shared library using a <code>lib.rs</code> file that contains:</p>\n\n<pre><code>#[no_mangle]\npub extern fn double_input(input: i32) -&gt; i32 {\n    println!(\"Hello from Rust\");\n    input * 2\n}\n</code></pre>\n\n<p>The <code>Cargo.toml</code> for building the library:</p>\n\n<pre><code>[package]\nname = \"julia_call_rust\"\nversion = \"1.0.0\"\nauthors = [\"hasan yousef]\n\n[lib]\nname = \"my_rust_lib\"\ncrate-type = [\"dylib\"]\n</code></pre>\n\n<p>Create a <code>main.jl</code> file, that contains:</p>\n\n<pre><code>println(\"Hello from Julia\")\ninput = 10 #Int32(10)\noutput =  ccall(   #(:function or \"function\", \"library\"), Return type, (Input types,), arguments if any)\n                (:double_input,\n                \"target/debug/libmy_rust_lib\"),\n                Int32,          # Return type\n                (Int32,),       # (Input types,)\n                input)          # Arguments if any\nprintln(\"As result of $input * 2 is: $output\")\n</code></pre>\n\n<p>Run <code>cargo build</code> to get the Rust library built, and run <code>julia main.jl</code> to get the required output below:</p>\n\n<p><a href=\"https://i.stack.imgur.com/xTEWj.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xTEWj.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 15416, "user_id": 2441637, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z8fpp.jpg?s=128&g=1", "display_name": "Hasan A Yousef", "link": "https://stackoverflow.com/users/2441637/hasan-a-yousef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 741, "favorite_count": 2, "accepted_answer_id": 51918853, "answer_count": 2, "score": 8, "last_activity_date": 1534771704, "creation_date": 1534675846, "last_edit_date": 1534703395, "question_id": 51916904, "link": "https://stackoverflow.com/questions/51916904/interaction-between-julia-and-rust", "title": "Interaction between Julia and Rust", "body": "<p>Is there any way to interact between Julia and Rust, a way that allow:</p>\n\n<ol>\n<li>Calling/Executing Rust function from Julia</li>\n<li>Calling/Executing Julia from Rust</li>\n</ol>\n\n<p>Thanks</p>\n"}, {"tags": ["interface", "rust", "custom-type"], "comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 4, "creation_date": 1534666100, "post_id": 51915551, "comment_id": 90781374, "body": "In the way you describe it, no Rust don&#39;t have optional method. You should give a usecase where we can give you possible solution instead of trying to mimic something from an another language."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534666263, "post_id": 51915551, "comment_id": 90781416, "body": "&quot;how should one think about dealing with objects whereby the programmer doesn&#39;t know whether a method will be present or not?&quot;, programmer is suppose to know if a method exist, maybe you want use <a href=\"https://stackoverflow.com/q/22461457/7076153\">dynamic load of function</a> ?"}, {"owner": {"reputation": 3359, "user_id": 5950725, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/6uR5y.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5950725/tom"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534667086, "post_id": 51915551, "comment_id": 90781567, "body": "@Stargateur Thank you for your answer. Usecase: implementing the observer pattern in Rust in a similar way to rxjs likeso: <a href=\"https://github.com/ReactiveX/rxjs/blob/master/src/internal/types.ts#L56\" rel=\"nofollow noreferrer\">github.com/ReactiveX/rxjs/blob/master/src/internal/types.ts#&zwnj;&#8203;L56</a>"}], "answers": [{"tags": [], "owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "is_accepted": true, "score": 18, "last_activity_date": 1534671948, "last_edit_date": 1534671948, "creation_date": 1534666104, "answer_id": 51915705, "question_id": 51915551, "link": "https://stackoverflow.com/questions/51915551/how-does-one-define-optional-methods-on-traits/51915705#51915705", "title": "How does one define optional methods on traits?", "body": "<p>You can try using empty default implementations of methods for this:</p>\n\n<pre><code>trait T {\n    fn required_method(&amp;self);\n\n    // This default implementation does nothing        \n    fn optional_method(&amp;self) {}\n}\n\nstruct A;\n\nimpl T for A {\n    fn required_method(&amp;self) {\n        println!(\"A::required_method\");\n    }\n}\n\nstruct B;\n\nimpl T for B {\n    fn required_method(&amp;self) {\n        println!(\"B::required_method\");\n    }\n\n    // overriding T::optional_method with something useful for B\n    fn optional_method(&amp;self) {\n        println!(\"B::optional_method\");\n    }\n}\n\nfn main() {\n    let a = A;\n    a.required_method();\n    a.optional_method(); // does nothing\n\n    let b = B;\n    b.required_method();\n    b.optional_method();\n}\n</code></pre>\n\n<p><a href=\"http://play.rust-lang.org/?gist=dbc76710162daf3c53ff2544c55b9219&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 3359, "user_id": 5950725, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/6uR5y.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/5950725/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1500, "favorite_count": 1, "accepted_answer_id": 51915705, "answer_count": 1, "score": 4, "last_activity_date": 1534724375, "creation_date": 1534664583, "last_edit_date": 1534724375, "question_id": 51915551, "link": "https://stackoverflow.com/questions/51915551/how-does-one-define-optional-methods-on-traits", "title": "How does one define optional methods on traits?", "body": "<p>Does Rust have a feature whereby I can create define potentially non-existent methods on traits?</p>\n\n<p>I realize that <code>Option</code> can be used to handle potentially non-existent properties but I don't know how the same can be achieved with methods.</p>\n\n<p>In TypeScript, the question mark denotes that the methods may potentially be non-existent. Here is an excerpt from RxJs:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>export interface NextObserver&lt;T&gt; {\n  next?: (value: T) =&gt; void;\n  // ...\n}\n</code></pre>\n\n<p>If this feature does not exist in Rust, how should one think about dealing with objects whereby the programmer doesn't know whether a method will be present or not? Panic?</p>\n"}, {"tags": ["error-handling", "rust"], "comments": [{"owner": {"reputation": 4837, "user_id": 9769953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f14a586643a20c8d68010f7a329f5a04?s=128&d=identicon&r=PG", "display_name": "0 0", "link": "https://stackoverflow.com/users/9769953/0-0"}, "edited": false, "score": 3, "creation_date": 1534648646, "post_id": 51914124, "comment_id": 90778288, "body": "You should still add an error as second argument, since there may still be an error returned from your function."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534652658, "post_id": 51914124, "comment_id": 90778841, "body": "void is simply <code>()</code> so you could just <code>on_message(&amp;mut self, msg: String) -&gt; ()</code> or just <code>on_message(&amp;mut self, msg: String)</code> but a function should already return something in general"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 1, "creation_date": 1534655699, "post_id": 51914124, "comment_id": 90779324, "body": "@Stargateur Obviously, the OP needs some error handling. <code>Result&lt;(), ErrorType&gt;</code> is fine for this."}], "answers": [{"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": true, "score": 4, "last_activity_date": 1534724609, "last_edit_date": 1534724609, "creation_date": 1534683275, "answer_id": 51917868, "question_id": 51914124, "link": "https://stackoverflow.com/questions/51914124/how-to-use-a-result-when-there-is-no-success-value-to-return-from-a-function/51917868#51917868", "title": "How to use a Result when there is no success value to return from a function?", "body": "<p>If you don't need error handling, then there is no need to use a <code>Result</code>: </p>\n\n<pre><code>fn on_message(&amp;mut self, msg: String) { \n    // ... \n}\n</code></pre>\n\n<p>If you need to handle errors, but don't have a meaningful \"success\" value, then you can say that the success type is <code>()</code>, but you still need to say what the error type is:</p>\n\n<pre><code>fn on_message(&amp;mut self, msg: String) -&gt; Result&lt;(), MyError&gt; {\n    // ...\n}\n</code></pre>\n\n<p>Where I put <code>MyError</code>, you could use a built-in error like <code>io::Error</code>, a custom error struct or enum, or any other type such as <code>String</code>. It could even be <code>()</code>, making your return type <code>Result&lt;(), ()&gt;</code>, which would let users of your function know if it was successful or not, without providing any information about either the successful outcome or the possible error. At that point, you might consider using an <code>Option&lt;()&gt;</code> or even just a <code>bool</code>, which carry the same amount of information.</p>\n"}, {"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1534771942, "post_id": 51923329, "comment_id": 90813664, "body": "What does this answer bring that the existing answer, which already suggests using <code>Result&lt;(), ()&gt;</code>, does not?"}], "tags": [], "owner": {"reputation": 129, "user_id": 2958778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2480b04b9493594c5f1d6750041b3963?s=128&d=identicon&r=PG&f=1", "display_name": "Scott Maddox", "link": "https://stackoverflow.com/users/2958778/scott-maddox"}, "is_accepted": false, "score": 1, "last_activity_date": 1534730638, "creation_date": 1534730638, "answer_id": 51923329, "question_id": 51914124, "link": "https://stackoverflow.com/questions/51914124/how-to-use-a-result-when-there-is-no-success-value-to-return-from-a-function/51923329#51923329", "title": "How to use a Result when there is no success value to return from a function?", "body": "<p>The error message is trying to tell you that <code>Result</code> takes two type parameters, i.e. <code>Result&lt;(), ()&gt;</code>. Here's a working version:</p>\n\n<pre><code>trait Handler {\n    fn on_message(&amp;mut self, msg: String) -&gt; Result&lt;(), ()&gt; {\n        println!(\"on_message: {}\", msg);\n        Ok(())\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 845, "user_id": 4077574, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/orn50.png?s=128&g=1", "display_name": "Galaxy", "link": "https://stackoverflow.com/users/4077574/galaxy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 650, "favorite_count": 0, "accepted_answer_id": 51917868, "answer_count": 2, "score": 1, "last_activity_date": 1545502150, "creation_date": 1534648294, "last_edit_date": 1545502150, "question_id": 51914124, "link": "https://stackoverflow.com/questions/51914124/how-to-use-a-result-when-there-is-no-success-value-to-return-from-a-function", "title": "How to use a Result when there is no success value to return from a function?", "body": "<p>To define a function with void return, my code goes like the following:</p>\n\n<pre><code>trait Handler {\n    fn on_message(&amp;mut self, msg: String) -&gt; Result&lt;()&gt; {\n        println!(\"on_message: {}\", msg);\n        Ok(())\n    }\n}\n</code></pre>\n\n<p>The compiler tell me this is wrong because a <code>Result</code> should always have 2 parameters:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0243]: wrong number of type arguments: expected 2, found 1\n --&gt; src/lib.rs:2:46\n  |\n2 |     fn on_message(&amp;mut self, msg: String) -&gt; Result&lt;()&gt; {\n  |                                              ^^^^^^^^^^ expected 2 type arguments\n</code></pre>\n\n<p>This confuses me. How should I define a function when I don't care about its return value?</p>\n"}, {"tags": ["rust", "rust-crates"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 3, "creation_date": 1534621548, "post_id": 51911869, "comment_id": 90774096, "body": "I think the tutorial is expecting you to create a file called <code>lib.rs</code> right next to <code>main.rs</code>."}, {"owner": {"reputation": 13057, "user_id": 729541, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/9c8f35ef59003de814a4bca351071045?s=128&d=identicon&r=PG", "display_name": "John H", "link": "https://stackoverflow.com/users/729541/john-h"}, "reply_to_user": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1534621639, "post_id": 51911869, "comment_id": 90774115, "body": "@PeterHall I went through this tutorial myself last week, and your comment is the answer."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1534621858, "post_id": 51911869, "comment_id": 90774154, "body": "This isn&#39;t anything to do with an external crate. This is just organising code within your project - no external crates involved."}, {"owner": {"reputation": 41, "user_id": 10244148, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-R8JKZ8q6q2w/AAAAAAAAAAI/AAAAAAAA8lY/jRnu27Qc8G8/photo.jpg?sz=128", "display_name": "toobie", "link": "https://stackoverflow.com/users/10244148/toobie"}, "reply_to_user": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1534635491, "post_id": 51911869, "comment_id": 90776699, "body": "@PeterHall It works thanks!"}], "owner": {"reputation": 41, "user_id": 10244148, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-R8JKZ8q6q2w/AAAAAAAAAAI/AAAAAAAA8lY/jRnu27Qc8G8/photo.jpg?sz=128", "display_name": "toobie", "link": "https://stackoverflow.com/users/10244148/toobie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 221, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1534621136, "creation_date": 1534620044, "last_edit_date": 1534621136, "question_id": 51911869, "link": "https://stackoverflow.com/questions/51911869/confused-about-extern-crate", "title": "Confused about extern crate", "body": "<p>So I'm currently learning the Rust language on the official website and I'm in the middle of Chapter 12 where they want me to split some of my code from <code>src/main.rs</code> to <code>src/lib.rs</code>. At first I created a library crate named \"minigrep\" inside the binary crate:</p>\n\n<ul>\n<li>minigrep</li>\n<li>src\n\n<ul>\n<li>main.rs</li>\n</ul></li>\n</ul>\n\n<p>but Rust couldn't find it. Next I tried moving it inside the src directory:</p>\n\n<ul>\n<li>src\n\n<ul>\n<li>minigrep</li>\n<li>main.rs</li>\n</ul></li>\n</ul>\n\n<p>Any help as to how Rust can detect an external crate?</p>\n"}, {"tags": ["rust", "stm32", "linker-scripts"], "comments": [{"owner": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 0, "creation_date": 1534676017, "post_id": 51911516, "comment_id": 90783639, "body": "Does &quot;load the program to the target&quot; include flashing? If not, you are seeing some old content in the flash memory."}, {"owner": {"reputation": 961, "user_id": 5920297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/80fc64c0293ff9460b4a8f127afdb8b2?s=128&d=identicon&r=PG&f=1", "display_name": "phodina", "link": "https://stackoverflow.com/users/5920297/phodina"}, "reply_to_user": {"reputation": 51497, "user_id": 49246, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c421b43470bb8d3c099c5a847e588549?s=128&d=identicon&r=PG", "display_name": "starblue", "link": "https://stackoverflow.com/users/49246/starblue"}, "edited": false, "score": 0, "creation_date": 1534688607, "post_id": 51911516, "comment_id": 90787055, "body": "Yes it does. But for some unknown reason the .rodata section is flashed to <code>0xf0000ef6</code> which no assigned to FLASH or RAM."}], "owner": {"reputation": 961, "user_id": 5920297, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/80fc64c0293ff9460b4a8f127afdb8b2?s=128&d=identicon&r=PG&f=1", "display_name": "phodina", "link": "https://stackoverflow.com/users/5920297/phodina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 229, "favorite_count": 1, "answer_count": 0, "score": 4, "last_activity_date": 1535033849, "creation_date": 1534617109, "last_edit_date": 1535033849, "question_id": 51911516, "link": "https://stackoverflow.com/questions/51911516/why-does-the-content-of-stm32-read-only-data-set-by-rust-differ-between-the-targ", "title": "Why does the content of STM32 read-only data set by Rust differ between the target and the ELF file?", "body": "<p>I'm trying to print a string through semihosting on STM32F4. I define a variable:</p>\n\n<pre><code>let array: &amp;[u8] = &amp;[\n    0x54, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, \n    0x6e, 0x65, 0x77, 0x20, 0x77, 0x61, 0x79, 0x00, 0x00, 0x00,\n];\n</code></pre>\n\n<p>This a non-mutable variable so it goes into .rodata section in the ELF file.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Section Headers:\n[Nr] Name    Type     Addr     Off    Size   ES Flg Lk Inf Al\n[ 4] .rodata PROGBITS 0800077c 00277c 000014 00   A  0   0  4\n</code></pre>\n\n<p>Here I can see the variable is 20 bytes long and stored at <code>0x800077c</code>.</p>\n\n<p>If I dump the section I can see the text:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Hex dump of section '.rodata':\n0x0800077c 54686973 20697320 61206e65 77207761 This is a new wa\n0x0800078c 79000000                            y...\n</code></pre>\n\n<p>Finally, I load the program to the target and execute it. If I look at the address of the string I see this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>(gdb) x /20bx 0x0800077c\n0x800077c &lt;.Lbyte_str.0&gt;:    0x00 0x68 0x01 0x00 0x00 0x00 0x72 0x07\n0x8000784 &lt;.Lbyte_str.0+8&gt;:  0x00 0x68 0x01 0x00 0x00 0x00 0xff 0xff\n0x800078c &lt;.Lbyte_str.0+16&gt;: 0xff 0xff 0xff 0xff\n</code></pre>\n\n<p>Here is the relevant section for the linker script:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>.rodata : ALIGN(4)\n{\n  _srodata = .;\n  *(.rodata)\n  *(.rodata.*)\n  _erodata = ALIGN(4);\n} &gt; FLASH\n</code></pre>\n\n<p>Why does the content of memory on the target and in the ELF file differ?</p>\n\n<p>If I place the variable in RAM it works.</p>\n\n<p>I checked with GDB and it loads the <em>.rodata</em> section as follows:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Loading section .rodata, size 0x14 lma 0xf0000ef6\nLoading section .text, size 0x77a lma 0x8000000\n</code></pre>\n\n<p>Why does GDB load the <em>.rodata</em> section to <code>0xf0000ef6</code> instead of <code>0x800077c</code>? I'd expect it will read the ELF file and load the sections correctly.</p>\n\n<p>Removing the <em>.rodata</em> section and placing content of <em>.rodata</em> directly into <em>.text</em> solves the issue.</p>\n\n<p>Content of the linker script that causes the issue:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>ENTRY(reset_handler)\n\nMEMORY\n{\n    FLASH (rx) : ORIGIN = 0x08000000, LENGTH = 256K\n    RAM  (rwx) : ORIGIN = 0x20000000, LENGTH = 64K\n}\n\nPROVIDE(_stack_start = ORIGIN(RAM) + LENGTH(RAM));\n\nSECTIONS\n{\n    .text : {\n        __STACK_START = .;\n        LONG(_stack_start);\n\n        KEEP(*(.vector_table.reset_vector));\n    __reset_vector = ABSOLUTE(.);\n\n        KEEP(*(.vector_table.exceptions));\n    __eexceptions = ABSOLUTE(.);\n\n    KEEP(*(.vector_table.interrupts));\n    __einterrupts = ABSOLUTE(.);\n\n    *(.text*)\n    } &gt; FLASH = 0xFF\n\n    .bss : ALIGN(4)\n    {\n        _sbss = .;\n        *(.bss.*);\n       _ebss = ALIGN(4);\n    } &gt; RAM\n\n    .data : ALIGN(4)\n    {\n    _sdata = .;\n    *(.data*)\n    _edata = ALIGN(4);\n     } &gt; RAM AT &gt; FLASH = 0xFF\n\n    .rodata :  ALIGN(4)\n     {\n     _srodata = .;\n     *(.rodata*)\n     *(.rodata)\n     _erodata = ALIGN(4);\n     } &gt; FLASH\n\n     .ARM.exidx :\n     {\n     *(.ARM.exidx*)\n     } &gt; RAM\n\n    _sidata = LOADADDR(.data);\n   }\n</code></pre>\n\n<p>Result in GDB output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Reading symbols from target/thumbv7em-none-eabi/debug/cortex...done.\n0x00000000 in ?? ()\nLoading section .rodata, size 0x14 lma 0xf0000ef6\nLoading section .text, size 0x77a lma 0x8000000\nLoading section .ARM.exidx, size 0x10 lma 0x800077a\nStart address 0x80004ae, load size 1950\nTransfer rate: 1 KB/sec, 650 bytes/write.\n</code></pre>\n\n<p>readelf dump:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Section Headers:\n  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al\n  [ 0]                   NULL            00000000 000000 000000 00      0   0  0\n  [ 1] .text             PROGBITS        08000000 001000 00077a 00  AX  0   0  4\n  [ 2] .bss              NOBITS          20000000 002000 000000 00  WA  0   0  4\n  [ 3] .data             NOBITS          20000000 002000 000000 00  WA  0   0  4\n  [ 4] .rodata           PROGBITS        0800077c 00277c 000014 00   A  0   0  4\n</code></pre>\n"}, {"tags": ["generics", "rust", "associated-types"], "comments": [{"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 1, "creation_date": 1534606200, "post_id": 51910003, "comment_id": 90770331, "body": "There is nothing about the <code>C</code> in <code>new&lt;C&gt;</code> that constrains it to <code>Constructable</code>. Also I think you can just use <code>Into</code>/<code>From</code> rather than introducing a new trait, since it looks like a conversion."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1534606236, "post_id": 51910003, "comment_id": 90770340, "body": "Also, implementing for <code>String</code> is probably not what you meant, since you are using <code>&amp;str</code> in your main function."}, {"owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "edited": false, "score": 0, "creation_date": 1534607305, "post_id": 51910003, "comment_id": 90770609, "body": "Why does <code>Constructible</code> need an associated type? The type argument <code>T</code> seems redundant in the way you are using it, and can just be <code>Self</code>."}], "answers": [{"tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 1, "last_activity_date": 1534618182, "last_edit_date": 1534618182, "creation_date": 1534608244, "answer_id": 51910388, "question_id": 51910003, "link": "https://stackoverflow.com/questions/51910003/why-is-impl-not-in-scope/51910388#51910388", "title": "Why is impl not in scope", "body": "<p>In the declaration of <code>new&lt;C&gt;()</code>, the type parameter <code>C</code> is a new type variable with no constraints. It appears that you <em>intended</em> it to be the associated type from <code>T</code>'s <code>Constructible</code> instance, which you'd express like this:</p>\n\n<pre><code>pub fn new(connections: HashMap&lt;K, T::C&gt;) -&gt; HashedGraph&lt;K, T&gt; {\n ...\n}\n</code></pre>\n\n<p>Your code has a number of other problems though:</p>\n\n<ul>\n<li>You are instantiating the object with <code>&amp;str</code> but you only added a <code>Constructible</code> instance for <code>String</code>. These are different types.</li>\n<li>You don't need to use <code>hashmap.get(key)</code> to access the value. You can just use <code>iter()</code> - or in this case <code>drain()</code>, since you are moving all of the values from one container to another anyway, so this will avoid borrowing problems if you don't need the original <code>HashMap</code>.</li>\n<li><code>Constructible</code>'s type parameter is redundant. This is always going to be <code>Self</code>.</li>\n<li>The only way that <code>T</code> can be inferred in <code>fn new() -&gt; T</code> is from where the caller chooses to use it. In theory, another implementation of <code>Constructible</code> could have the same associated <code>C</code> type, so that isn't enough. This means you will need type annotations when constructing the <code>HashedGraph</code>.</li>\n</ul>\n\n<p><a href=\"https://play.rust-lang.org/?gist=4763a709899b10f0d37909d59b2f829f&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">Here's a version of your code</a> that compiles, though I made some assumptions about what you were really trying to achieve.</p>\n"}], "owner": {"reputation": 119, "user_id": 10243540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/361e881a21334f36949e027d3446c2ff?s=128&d=identicon&r=PG&f=1", "display_name": "Benedikt", "link": "https://stackoverflow.com/users/10243540/benedikt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1887, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1551012830, "creation_date": 1534605242, "last_edit_date": 1551012830, "question_id": 51910003, "link": "https://stackoverflow.com/questions/51910003/why-is-impl-not-in-scope", "title": "Why is impl not in scope", "body": "<p>I'm a Rust newbie, and in my learning-toy-project I need a graph data structure with mutable nodes, so I came up with:</p>\n\n<pre><code>use std::cell::RefCell;\nuse std::clone::Clone;\nuse std::cmp::Eq;\nuse std::collections::HashMap;\nuse std::hash::Hash;\nuse std::rc::Rc;\n\npub trait Constructible&lt;T&gt; {\n    type C;\n    fn new(Self::C) -&gt; T;\n}\n\n#[derive(Debug)]\npub struct HashedGraph&lt;K: Eq + Hash + Clone, T: Constructible&lt;T&gt;&gt; {\n    graph: HashMap&lt;K, Rc&lt;RefCell&lt;T&gt;&gt;&gt;,\n}\n\nimpl&lt;K, T&gt; HashedGraph&lt;K, T&gt;\nwhere\n    K: Eq + Hash + Clone,\n    T: Constructible&lt;T&gt;,\n{\n    pub fn new&lt;C&gt;(connections: HashMap&lt;K, C&gt;) -&gt; HashedGraph&lt;K, T&gt; {\n        let mut graph: HashMap&lt;K, Rc&lt;RefCell&lt;T&gt;&gt;&gt; = HashMap::new();\n\n        for key in connections.keys() {\n            graph.insert(\n                key.clone(),\n                Rc::new(RefCell::new(C::new(*connections.get(key).unwrap()))),\n            );\n        }\n\n        HashedGraph { graph }\n    }\n}\n\nimpl Constructible&lt;String&gt; for String {\n    type C = String;\n    fn new(instring: String) -&gt; String {\n        instring\n    }\n}\n\nfn main() {\n    let mut test = HashMap::new();\n    test.insert(\"one\", \"ONE\");\n    test.insert(\"two\", \"TWO\");\n    let hg = HashedGraph::new(test);\n}\n</code></pre>\n\n<p>The idea is, that I want the nodes to be constructible from another data type, but this data is not contained in the Graph, and therefore an associated type and not a generic parameter. The Nodes T will later contain connections, which are just weak Pointers to other nodes, but for this question that\u2019s not really relevant. When compiling this I get an error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0599]: no function or associated item named `new` found for type `C` in the current scope\n  --&gt; src/main.rs:26:61\n   |\n26 |             graph.insert(key.clone(), Rc::new(RefCell::new( C::new( *connections.get(key).unwrap() ))));\n   |                                                             ^^^^^^ function or associated item not found in `C`\n   |\n   = help: items from traits can only be used if the trait is implemented and in scope\n   = note: the following trait defines an item `new`, perhaps you need to implement it:\n           candidate #1: `Constructible`\n</code></pre>\n\n<p>I don't understand why the implementation of constructible is not in scope or what else is not correct. If this is an unidiomatic way of implementing this, I would be very happy to receive suggestions!</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "edited": false, "score": 2, "creation_date": 1534593354, "post_id": 51908293, "comment_id": 90766893, "body": "Hi :) I marked your question as duplicate. If the linked answers don&#39;t help you, please <a href=\"https://stackoverflow.com/posts/51908293/edit\">edit</a> your question to explain why your question is different than the one I linked. Thanks and have fun in continuing your Rust journey!"}, {"owner": {"reputation": 33, "user_id": 7742169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0709f7a127f7dbeb6249b40458f01602?s=128&d=identicon&r=PG&f=1", "display_name": "HerrTeetrinken", "link": "https://stackoverflow.com/users/7742169/herrteetrinken"}, "reply_to_user": {"reputation": 53952, "user_id": 2408867, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/994y9.jpg?s=128&g=1", "display_name": "Lukas Kalbertodt", "link": "https://stackoverflow.com/users/2408867/lukas-kalbertodt"}, "edited": false, "score": 0, "creation_date": 1534594109, "post_id": 51908293, "comment_id": 90767084, "body": "Oh, thx. That exactly answers my question. Nice rust feature."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 3, "creation_date": 1534594821, "post_id": 51908293, "comment_id": 90767288, "body": "Note that your whole function can be written like this: <code>if n == 0 { 1_u32.into() } else { factorial_recursive(n - 1) * n }</code>. No need of <code>result</code>."}], "owner": {"reputation": 33, "user_id": 7742169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0709f7a127f7dbeb6249b40458f01602?s=128&d=identicon&r=PG&f=1", "display_name": "HerrTeetrinken", "link": "https://stackoverflow.com/users/7742169/herrteetrinken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "closed_date": 1534593279, "answer_count": 0, "score": 1, "last_activity_date": 1534592761, "creation_date": 1534592761, "question_id": 51908293, "link": "https://stackoverflow.com/questions/51908293/why-does-result-not-need-to-be-mut", "closed_reason": "Duplicate", "title": "Why does &#39;result&#39; not need to be mut?", "body": "<p>I'm just about to learn rust with the rust book. What I understood is, that I can't assign to variables, that aren't declared mut. So I'm wondering, why this code works: </p>\n\n<pre><code>extern crate num_bigint;\nuse num_bigint::BigUint;\n\nfn main() {\n    let n = 10_000;\n    println!(\"{}! = {};\", n, factorial_recursive(n));\n}\n\nfn factorial_recursive(n: usize) -&gt; BigUint {\n    let result: BigUint;\n    if n == 0 { result = BigUint::new(vec![1]); }\n    else { result = factorial_recursive(n-1) * n; }\n    result\n}\n</code></pre>\n\n<p>In the beginning, I had declared result mut, but I got a compiler warning, that mut isn't necessary. So I removed it, and was surprised, that it still works.\nWhy is that so?</p>\n\n<p>PS: I know, that I could return directly from the if/else branches. I had this in the beginning, but wanted to print out result, before returning, so I changed to this and got the compiler warning about mut not necessary. Now I want to understand this.</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 2, "creation_date": 1534523565, "post_id": 51899535, "comment_id": 90750207, "body": "AFAIK, none of them is quicker: the bracket syntax performs also bound-checks (that&#39;s why it panics and does not segfault if you are out of bounds)."}, {"owner": {"reputation": 3942, "user_id": 747916, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e780eae6ca6a0b5d0d4705259f9da879?s=128&d=identicon&r=PG", "display_name": "John Doucette", "link": "https://stackoverflow.com/users/747916/john-doucette"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1534523743, "post_id": 51899535, "comment_id": 90750309, "body": "@Boiethios Don&#39;t I still save on the cost of unpacking the Option though (i.e. a match)? I don&#39;t think that&#39;s a big savings, but it&#39;s not <i>quite</i> identical."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1534524212, "post_id": 51899535, "comment_id": 90750566, "body": "Not sure if I&#39;m right, but there is no overhead with <code>Option</code>: you can see it as a C raw pointer: <code>None</code> is <code>NULL</code> and <code>Some</code> is the ok pointer value."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1534526595, "post_id": 51899535, "comment_id": 90751558, "body": "Related: <a href=\"https://stackoverflow.com/questions/16504643/what-is-the-overhead-of-rusts-option-type\" title=\"what is the overhead of rusts option type\">stackoverflow.com/questions/16504643/&hellip;</a>"}, {"owner": {"reputation": 19105, "user_id": 3005167, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/t0bMQ.png?s=128&g=1", "display_name": "kazemakase", "link": "https://stackoverflow.com/users/3005167/kazemakase"}, "edited": false, "score": 2, "creation_date": 1534531879, "post_id": 51899535, "comment_id": 90753805, "body": "As a rule of thumb I&#39;d say if you don&#39;t expect out of bounds access (i.e. it indicates a programming error or another serious problem with your code) it&#39;s fine to stop execution by panic in the index operator. If you expect out of bounds access during normal execution (e.g. it depends on external input) you will want to catch this situation and use <code>.get</code> instead."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1534535120, "post_id": 51899535, "comment_id": 90755018, "body": "@Boiethios That is only if you also use a pointer to the object in C, as you directly get to the object in C, yes Option add an overhead."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1534535690, "post_id": 51899535, "comment_id": 90755250, "body": "@Stargateur Nope, read the answer I linked."}, {"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1534535882, "post_id": 51899535, "comment_id": 90755323, "body": "@Boiethios I know option don&#39;t add size for pointer but that wasn&#39;t my point, I&#39;m talking about runtime overhead."}], "answers": [{"comments": [{"owner": {"reputation": 1012, "user_id": 6255770, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/9KT6y.jpg?s=128&g=1", "display_name": "Quoc-Hao Tran", "link": "https://stackoverflow.com/users/6255770/quoc-hao-tran"}, "edited": false, "score": 0, "creation_date": 1610511705, "post_id": 51899683, "comment_id": 116154200, "body": "I think <code>get</code> is a bit slower. Had couple benchmark that showed the difference in perf. Not remarkable tho"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 1012, "user_id": 6255770, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/9KT6y.jpg?s=128&g=1", "display_name": "Quoc-Hao Tran", "link": "https://stackoverflow.com/users/6255770/quoc-hao-tran"}, "edited": false, "score": 0, "creation_date": 1610650487, "post_id": 51899683, "comment_id": 116206698, "body": "@Quoc-HaoTran Was is in release (<code>--release</code> flag)?"}, {"owner": {"reputation": 1012, "user_id": 6255770, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/9KT6y.jpg?s=128&g=1", "display_name": "Quoc-Hao Tran", "link": "https://stackoverflow.com/users/6255770/quoc-hao-tran"}, "edited": false, "score": 0, "creation_date": 1610658784, "post_id": 51899683, "comment_id": 116209976, "body": "Nope I dont think so"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 1012, "user_id": 6255770, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/9KT6y.jpg?s=128&g=1", "display_name": "Quoc-Hao Tran", "link": "https://stackoverflow.com/users/6255770/quoc-hao-tran"}, "edited": false, "score": 0, "creation_date": 1611738093, "post_id": 51899683, "comment_id": 116544155, "body": "@Quoc-HaoTran Well, every performance related test must be done in release. The dev build doesn&#39;t guarantee any optimization, and it&#39;s not done to be deployed on prod."}], "tags": [], "owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "is_accepted": true, "score": 10, "last_activity_date": 1534770828, "last_edit_date": 1534770828, "creation_date": 1534523799, "answer_id": 51899683, "question_id": 51899535, "link": "https://stackoverflow.com/questions/51899535/when-should-i-use-direct-access-into-a-rust-vec-instead-of-the-get-method/51899683#51899683", "title": "When should I use direct access into a Rust Vec instead of the get method?", "body": "<p>Neither of them is quicker because they both do bounds checks. In fact, your question is quite generic because there are other pairs of methods where one of them panics while the other returns an option, such as  <a href=\"https://doc.rust-lang.org/std/string/struct.String.html#method.reserve\" rel=\"nofollow noreferrer\"><code>String::reserve</code></a> vs <a href=\"https://doc.rust-lang.org/std/string/struct.String.html#method.try_reserve\" rel=\"nofollow noreferrer\"><code>String::try_reserve</code></a>.</p>\n\n<ul>\n<li>If you are sure that you are in bounds, use the brackets version. This is only a syntactic shortcut for <code>get().unwrap()</code>.</li>\n<li>If you are unsure of this, use the <code>get()</code> method and do your check.</li>\n<li>If you critically need maximum speed <strong>and</strong> you cannot use an iterator <strong>and</strong> you have determined through benchmarks that the indexing is the bottleneck <strong>and</strong> you are sure to be in bounds, you can use the <code>get_unchecked()</code> method. Be careful about this because it is <code>unsafe</code>: it is always better to not have any <code>unsafe</code> block in your code.</li>\n</ul>\n\n<hr>\n\n<p>Just a little bit of advice: if you are concerned by your program performance, avoid using those methods and prefer to use iterators as much as you can. For example, the second example is faster than the first one because in the first case there are one million bounds checks:</p>\n\n<pre><code>let v: Vec&lt;_&gt; = (0..1000_000).collect();\n\nfor idx in 0..1000_000 {\n    // do something with v[idx]\n}\n\nfor num in &amp;v {\n    // do something with num\n}\n</code></pre>\n"}], "owner": {"reputation": 3942, "user_id": 747916, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e780eae6ca6a0b5d0d4705259f9da879?s=128&d=identicon&r=PG", "display_name": "John Doucette", "link": "https://stackoverflow.com/users/747916/john-doucette"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 765, "favorite_count": 0, "accepted_answer_id": 51899683, "answer_count": 1, "score": 4, "last_activity_date": 1534770828, "creation_date": 1534523117, "last_edit_date": 1534524128, "question_id": 51899535, "link": "https://stackoverflow.com/questions/51899535/when-should-i-use-direct-access-into-a-rust-vec-instead-of-the-get-method", "title": "When should I use direct access into a Rust Vec instead of the get method?", "body": "<p>Rust supports two methods for accessing the elements of a vector: </p>\n\n<pre><code>let mut v = vec![1, 2, 3];\n\nlet first_element = &amp;v[0];\n\nlet second_element = v.get(1);\n</code></pre>\n\n<p>The <code>get()</code> method returns an Option type, which seems like a useful safety feature. The C-like syntax <code>&amp;v[0]</code> seems shorter to type, but gives up the safety benefits, since invalid reads cause a run-time error rather than producing an indication that the read was out of bounds.</p>\n\n<p>It's not clear to me when I would want to use the direct access approach, because it seems like the only advantage is that it's quicker to type (I save 3 characters). Is there some other advantage (perhaps a speedup?) that I'm not seeing? I guess I would save the conditional of a match expression, but that doesn't seem like it offers much benefit compared to the costs. </p>\n"}, {"tags": ["json", "rust", "serde-json"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1534522320, "post_id": 51899190, "comment_id": 90749560, "body": "To be clear, your <i>contacts</i> have contacts of their own? &quot;James&quot; is a contact of &quot;Stefan&quot;, and &quot;Stefan&quot; is a contact of &quot;John Doe&quot;?"}], "answers": [{"tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": false, "score": 1, "last_activity_date": 1534526950, "creation_date": 1534526950, "answer_id": 51900342, "question_id": 51899190, "link": "https://stackoverflow.com/questions/51899190/how-to-iterate-over-json-objects-within-a-hierarchy/51900342#51900342", "title": "How to iterate over JSON objects within a hierarchy?", "body": "<blockquote>\n  <p>may not have the exact same number of fields every time to make a\n  suitable structure</p>\n</blockquote>\n\n<p>It's unclear why you think this:</p>\n\n<pre><code>extern crate serde_json; // 1.0.24\n#[macro_use]\nextern crate serde_derive; // 1.0.70;\n\nuse serde_json::Error;\n\n#[derive(Debug, Deserialize)]\nstruct Contact {\n    name: String,\n    contact: Option&lt;Box&lt;Contact&gt;&gt;,\n}\n\nimpl Contact {\n    fn print_names(&amp;self) {\n        println!(\"{}\", self.name);\n\n        let mut current = self;\n\n        while let Some(ref c) = current.contact {\n            println!(\"{}\", c.name);\n\n            current = &amp;c;\n        }\n    }\n}\n\nfn main() -&gt; Result&lt;(), Error&gt; {\n    let data = r#\"{\n      \"name\":\"John Doe\",\n      \"contact\":{\n        \"name\":\"Stefan\",\n        \"contact\":{\n          \"name\":\"James\"\n        }\n      }\n    }\"#;\n\n    let person: Contact = serde_json::from_str(data)?;\n    person.print_names();\n\n    Ok(())\n}\n</code></pre>\n\n<p>I've removed the extra fields from the JSON to have a smaller example but nothing changes if they are present.</p>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"http://cglab.ca/~abeinges/blah/too-many-lists/book/\" rel=\"nofollow noreferrer\">Learning Rust With Entirely Too Many Linked Lists</a></li>\n<li><a href=\"https://stackoverflow.com/q/25296195/155423\">Why are recursive struct types illegal in Rust?</a></li>\n<li><a href=\"https://stackoverflow.com/q/33251881/155423\">Rust &amp; Serde JSON deserialization examples?</a></li>\n</ul>\n"}], "owner": {"reputation": 41, "user_id": 10240204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8bb54d5f2dd2ba68dd745c41245b4f7?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/10240204/rahul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1350, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1534526950, "creation_date": 1534521712, "last_edit_date": 1534526281, "question_id": 51899190, "link": "https://stackoverflow.com/questions/51899190/how-to-iterate-over-json-objects-within-a-hierarchy", "title": "How to iterate over JSON objects within a hierarchy?", "body": "<p>I want to print the <code>name</code> of each contact in the object deep down the hierarchy. The contact object may not have the exact same number of fields every time to make a suitable structure. How can I achieve this?</p>\n\n<pre><code>extern crate serde_json;\n\nuse serde_json::{Error, Value};\nuse std::collections::HashMap;\n\nfn untyped_example() -&gt; Result&lt;(), Error&gt; {\n    // Some JSON input data as a &amp;str. Maybe this comes from the user.\n    let data = r#\"{\n      \"name\":\"John Doe\",\n      \"age\":43,\n      \"phones\":[\n        \"+44 1234567\",\n        \"+44 2345678\"\n      ],\n      \"contact\":{\n        \"name\":\"Stefan\",\n        \"age\":23,\n        \"optionalfield\":\"dummy field\",\n        \"phones\":[\n          \"12123\",\n          \"345346\"\n        ],\n        \"contact\":{\n          \"name\":\"James\",\n          \"age\":34,\n          \"phones\":[\n            \"23425\",\n            \"98734\"\n          ]\n        }\n      }\n    }\"#;\n\n    let mut d: HashMap&lt;String, Value&gt; = serde_json::from_str(&amp;data)?;\n    for (str, val) in d {\n        println!(\"{}\", str);\n        if str == \"contact\" {\n            d = serde_json::from_value(val)?;\n        }\n    }\n\n    Ok(())\n}\n\nfn main() {\n    untyped_example().unwrap();\n}\n</code></pre>\n\n<p>I am very new to Rust and basically coming from a JavaScript background.</p>\n"}, {"tags": ["rust", "usb", "ioctl", "usb-hid"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534541721, "post_id": 51898034, "comment_id": 90757324, "body": "Please review how to create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> and then <a href=\"https://stackoverflow.com/posts/51898034/edit\">edit</a> your question to include it. We cannot tell what crates, types, traits, fields, etc. are present in the code. Try to produce something that reproduces your error on the <a href=\"https://play.rust-lang.org\" rel=\"nofollow noreferrer\">Rust Playground</a> or you can reproduce it in a brand new Cargo project. There are <a href=\"//stackoverflow.com/tags/rust/info\">Rust-specific MCVE tips</a> as well."}], "answers": [{"comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534545132, "post_id": 51903352, "comment_id": 90758154, "body": "What is <code>extern crate ffi</code> for?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 2, "creation_date": 1534552827, "post_id": 51903352, "comment_id": 90759462, "body": "Using <code>i32</code> for <code>hid_read_sz</code> is not as portable as it should be, and may trigger undefined behavior. The size of C&#39;s <code>int</code> can vary from platform to platform."}, {"owner": {"reputation": 5321, "user_id": 157726, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/PY0sR.png?s=128&g=1", "display_name": "Juan Leni", "link": "https://stackoverflow.com/users/157726/juan-leni"}, "edited": false, "score": 0, "creation_date": 1534607033, "post_id": 51903352, "comment_id": 90770540, "body": "This is something I was wondering earlier today. <code>libc::c_int</code> is very cool."}], "tags": [], "owner": {"reputation": 1736, "user_id": 130554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1affa5f0b72a1a76c8b72bc0ccc6f552?s=128&d=identicon&r=PG", "display_name": "Digikata", "link": "https://stackoverflow.com/users/130554/digikata"}, "is_accepted": false, "score": 2, "last_activity_date": 1534555016, "last_edit_date": 1534555016, "creation_date": 1534543152, "answer_id": 51903352, "question_id": 51898034, "link": "https://stackoverflow.com/questions/51898034/how-to-use-ioctl-nix-macros-to-get-a-variable-size-buffer/51903352#51903352", "title": "How to use ioctl + nix macros to get a variable size buffer", "body": "<p>I think you've got a couple of issues here. Some on the Rust side, and some with using the <code>HIDIOCGRDESC</code> ioctl incorrectly. If you look in a Linux kernel distribution at the hidraw.txt and hid-example.c code, the use of the struct is as follows:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>struct hidraw_report_descriptor rpt_desc;\n\nmemset(&amp;rpt_desc, 0x0, sizeof(rpt_desc));\n\n/* Get Report Descriptor */\nrpt_desc.size = desc_size;\nres = ioctl(fd, HIDIOCGRDESC, &amp;rpt_desc);\n</code></pre>\n\n<p><code>desc_size</code> comes from a previous <code>HIDIOCGRDESCSIZE</code> ioctl call. Unless I fill in the correct size parameter, the ioctl returns an error (<code>ENOTTY</code> or <code>EINVAL</code>).</p>\n\n<p>There are also issues with passing the <code>O_NONBLOCK</code> flag to open a HID device without using <code>libc::open</code>. I ended up with this:</p>\n\n<pre><code>#[macro_use]\nextern crate nix;\n\nextern crate libc;\n\nioctl_read!(hid_read_sz, b'H', 0x01, i32);\nioctl_read_buf!(hid_read_descr, b'H', 0x02, u8);\n\nfn main() {\n    // see /usr/include/linux/hidraw.h\n    // and hid-example.c\n    extern crate ffi;\n    use std::ffi::CString;\n    let fname = CString::new(\"/dev/hidraw0\").unwrap();\n    let fd = unsafe { libc::open(fname.as_ptr(), libc::O_NONBLOCK | libc::O_RDWR) };\n\n    let mut sz = 0i32;\n    let err = unsafe { hid_read_sz(fd, &amp;mut sz) };\n    println!(\"{:?} size is {:?}\", err, sz);\n\n    let mut desc_raw = [0x0u8; 4 + 4096];\n\n    // sz on my system ended up as 52 - this handjams in the value\n    // w/ a little endian swizzle into the C struct .size field, but\n    // really we should properly define the struct\n    desc_raw[0] = sz as u8;\n\n    let err = unsafe { hid_read_descr(fd, &amp;mut desc_raw) };\n    println!(\"{:?}\", err);\n\n    for (i, &amp;b) in desc_raw.iter().enumerate() {\n        if b != 0 {\n            println!(\"{:4} {:?}\", i, b);\n        }\n    }\n}\n</code></pre>\n\n<p>In the end, you shouldn't be sizing the struct to a variable size, the ioctl header indicates there is a fixed max expected. The variability is all on the system ioctl to deal with, it just needs the expected size hint from another ioctl call. </p>\n"}, {"comments": [{"owner": {"reputation": 1736, "user_id": 130554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1affa5f0b72a1a76c8b72bc0ccc6f552?s=128&d=identicon&r=PG", "display_name": "Digikata", "link": "https://stackoverflow.com/users/130554/digikata"}, "edited": false, "score": 2, "creation_date": 1534554610, "post_id": 51904291, "comment_id": 90759689, "body": "Nice cleanups from my version! I definitely learned at least a thing or two."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 4, "last_activity_date": 1577993882, "last_edit_date": 1577993882, "creation_date": 1534552486, "answer_id": 51904291, "question_id": 51898034, "link": "https://stackoverflow.com/questions/51898034/how-to-use-ioctl-nix-macros-to-get-a-variable-size-buffer/51904291#51904291", "title": "How to use ioctl + nix macros to get a variable size buffer", "body": "<p>Now that <a href=\"https://stackoverflow.com/a/51903352/155423\">Digikata has thoughtfully provided enough code to drive the program</a>...</p>\n\n<blockquote>\n  <p>Am I using the <code>ioctl_read_buf</code> macro incorrectly?</p>\n</blockquote>\n\n<p>I'd say that <em>using it at all</em> is incorrect here. You don't want to read an array of data, you want to read a single instance of a specific type. That's what <code>ioctl_read!</code> is for.</p>\n\n<p>We define a <code>repr(C)</code> struct that mimics the C definition. This ensures that important details like alignment, padding, field ordering, etc., all match one-to-one with the code we are calling.</p>\n\n<p>We can then construct an uninitialized instance of this struct and pass it to the newly-defined function. </p>\n\n<pre><code>use libc; // 0.2.66\nuse nix::ioctl_read; // 0.16.1\nuse std::{\n    fs::OpenOptions,\n    mem::MaybeUninit,\n    os::unix::{fs::OpenOptionsExt, io::AsRawFd},\n};\n\nconst HID_MAX_DESCRIPTOR_SIZE: usize = 4096;\n\n#[repr(C)]\npub struct hidraw_report_descriptor {\n    size: u32,\n    value: [u8; HID_MAX_DESCRIPTOR_SIZE],\n}\n\nioctl_read!(hid_read_sz, b'H', 0x01, libc::c_int);\nioctl_read!(hid_read_descr, b'H', 0x02, hidraw_report_descriptor);\n\nfn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {\n    let file = OpenOptions::new()\n        .read(true)\n        .write(true)\n        .custom_flags(libc::O_NONBLOCK)\n        .open(\"/dev/hidraw0\")?;\n\n    unsafe {\n        let fd = file.as_raw_fd();\n\n        let mut size = 0;\n        hid_read_sz(fd, &amp;mut size)?;\n        println!(\"{}\", size);\n\n        let mut desc_raw = MaybeUninit::&lt;hidraw_report_descriptor&gt;::uninit();\n        (*desc_raw.as_mut_ptr()).size = size as u32;\n        hid_read_descr(file.as_raw_fd(), desc_raw.as_mut_ptr())?;\n        let desc_raw = desc_raw.assume_init();\n        let data = &amp;desc_raw.value[..desc_raw.size as usize];\n        println!(\"{:02x?}\", data);\n    }\n\n    Ok(())\n}\n</code></pre>\n"}], "owner": {"reputation": 5321, "user_id": 157726, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/PY0sR.png?s=128&g=1", "display_name": "Juan Leni", "link": "https://stackoverflow.com/users/157726/juan-leni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 686, "favorite_count": 0, "accepted_answer_id": 51904291, "answer_count": 2, "score": 3, "last_activity_date": 1577993882, "creation_date": 1534517750, "last_edit_date": 1536078450, "question_id": 51898034, "link": "https://stackoverflow.com/questions/51898034/how-to-use-ioctl-nix-macros-to-get-a-variable-size-buffer", "title": "How to use ioctl + nix macros to get a variable size buffer", "body": "<p>This is related to <a href=\"https://stackoverflow.com/questions/41478901/how-to-use-nixs-ioctl\">How to use nix&#39;s ioctl?</a> but it is not the same question.</p>\n\n<p>I want to retrieve a variable size buffer. There is another <code>ioctl</code> that tells me that I need to read X bytes. The C header tells me the following too:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#define HID_MAX_DESCRIPTOR_SIZE     4096\n#define HIDIOCGRDESC        _IOR('H', 0x02, struct hidraw_report_descriptor)\n\nstruct hidraw_report_descriptor {\n    __u32 size;\n    __u8 value[HID_MAX_DESCRIPTOR_SIZE];\n};\n</code></pre>\n\n<p>I define the macro in the following way:</p>\n\n<pre><code>ioctl_read_buf!(hid_read_descr, b'H', 0x02, u8);\n</code></pre>\n\n<p>And later call:</p>\n\n<pre><code>let mut desc_raw = [0u8; 4 + 4096];\nlet err = unsafe { hid_read_descr(file.as_raw_fd(), &amp;mut desc_raw); };\n</code></pre>\n\n<p>When doing this, <code>desc_raw</code> is full of zeros. I would have expected the first 4 bytes to contain <code>size</code> based on the struct definition.</p>\n\n<p>The alternative, does not seem to work either</p>\n\n<pre><code>ioctl_read!(hid_read_descr2, b'H', 0x02, [u8; 4+4096]);\n// ...\nlet mut desc_raw = [0xFFu8; 4 + 4096];\nlet err = unsafe { hid_read_descr2(file.as_raw_fd(), &amp;mut desc_raw); };\n</code></pre>\n\n<p>In both cases, I have tried initializing <code>desc_raw</code> with 0xFF and after the call, it seems untouched.</p>\n\n<p>Am I using the <code>ioctl_read_buf</code> macro incorrectly?</p>\n"}, {"tags": ["iterator", "rust", "type-erasure"], "comments": [{"owner": {"reputation": 17608, "user_id": 3650362, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fqdi1.jpg?s=128&g=1", "display_name": "trentcl", "link": "https://stackoverflow.com/users/3650362/trentcl"}, "edited": false, "score": 1, "creation_date": 1534515074, "post_id": 51896609, "comment_id": 90745306, "body": "If you can change <code>func</code> to take <code>IntoIterator</code> instead of <code>Iterator</code>, you can just write <code>func(input)</code>. Also, <code>Iterator</code> is in the prelude, so you don&#39;t need to <code>use std::iter;</code> first."}], "answers": [{"comments": [{"owner": {"reputation": 522, "user_id": 153612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba347a31bc66bb2654de01850e914021?s=128&d=identicon&r=PG", "display_name": "Ta Thanh Dinh", "link": "https://stackoverflow.com/users/153612/ta-thanh-dinh"}, "edited": false, "score": 0, "creation_date": 1534513699, "post_id": 51896781, "comment_id": 90744454, "body": "Thanks a lot, I didn&#39;t know that, yay yay."}], "tags": [], "owner": {"reputation": 8877, "user_id": 5397009, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/7405bb106a62e8a3ea2d6d787b7261ee?s=128&d=identicon&r=PG&f=1", "display_name": "Jmb", "link": "https://stackoverflow.com/users/5397009/jmb"}, "is_accepted": true, "score": 3, "last_activity_date": 1534513404, "creation_date": 1534513404, "answer_id": 51896781, "question_id": 51896609, "link": "https://stackoverflow.com/questions/51896609/from-option-to-iterator/51896781#51896781", "title": "From Option to iterator", "body": "<p><code>Option</code> has an <a href=\"https://doc.rust-lang.org/stable/std/option/enum.Option.html#method.iter\" rel=\"nofollow noreferrer\"><code>iter</code> method</a> that does what you want.</p>\n"}], "owner": {"reputation": 522, "user_id": 153612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba347a31bc66bb2654de01850e914021?s=128&d=identicon&r=PG", "display_name": "Ta Thanh Dinh", "link": "https://stackoverflow.com/users/153612/ta-thanh-dinh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "closed_date": 1534514348, "accepted_answer_id": 51896781, "answer_count": 1, "score": 0, "last_activity_date": 1534514451, "creation_date": 1534512891, "last_edit_date": 1534514434, "question_id": 51896609, "link": "https://stackoverflow.com/questions/51896609/from-option-to-iterator", "closed_reason": "Duplicate", "title": "From Option to iterator", "body": "<p>I have a function which consumes an iterator:</p>\n\n<pre><code>fn func&lt;T: iter::Iterator&lt;Item = char&gt;&gt;(i: T) {\n    //...   \n}\n</code></pre>\n\n<p>I need to write a function whose input is an <code>Option&lt;char&gt;</code> (type <code>char</code> is not important here, just for illustrative purpose), and depends on the value of input, it should create an empty or an once iterator. My <a href=\"https://play.rust-lang.org/?gist=8d86c98234f70e26ef8001b9cee1499f&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">solution</a> is:\n    use std::iter;</p>\n\n<pre><code>fn option_iter(input: Option&lt;char&gt;) {\n    let i: Box&lt;iter::Iterator&lt;Item = char&gt;&gt; = if let Some(input) = input {\n        Box::new(iter::once(input))\n    } else {\n        Box::new(iter::empty())\n    };\n}\n</code></pre>\n\n<p>I find this ugly because of type erasure by <code>Box</code>. I cannot use:</p>\n\n<pre><code>let i = if let Some(input) = input {\n    iter::once(input)\n} else {\n    iter::empty()\n};\nfunc(i);\n</code></pre>\n\n<p>because the compiler complains the types of two branches are different. Is there any method which does not use <code>Box</code> for this situation?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534515448, "post_id": 51894610, "comment_id": 90745551, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/36379242/155423\">Mutably borrow one struct field while borrowing another in a closure</a>. If you disagree, please <a href=\"https://stackoverflow.com/posts/51894610/edit\">edit</a> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1534518400, "post_id": 51894610, "comment_id": 90747425, "body": "The duplicate applied to your question: <code>let running = &amp;mut store.running; store.events_loop.poll_events(|event| &#47;*...*&#47; *running = false; &#47;*...*&#47;)</code>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534520589, "post_id": 51894610, "comment_id": 90748558, "body": "Regarding your edit: no, you can&#39;t do that with plain references. See <a href=\"https://stackoverflow.com/q/28385339/155423\">Mutable self while reading from owner object</a>; <a href=\"https://stackoverflow.com/q/25513755/155423\">Borrowing references to attributes in a struct</a>; <a href=\"https://stackoverflow.com/q/30681468/155423\">Passing mutable self reference to method of owned object</a>. Note this last one has answers with many different alternatives."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534521168, "post_id": 51894610, "comment_id": 90748896, "body": "Note that these are all the same root issue. Something has taken a mutable reference to <code>store.events_loop</code> and thus nothing else may be allowed to access that. By passing <code>store</code> to another function, it would be able to access <code>store.events_loop</code>, breaking the guarantees. Rust must prevent this."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534770652, "post_id": 51894610, "comment_id": 90812836, "body": "Note that, according to your edit, the code you have provided is <i>still</i> not a MCVE. <i>The code you have provided</i> is solved by applying the linked question. If the code you have provided isn&#39;t representative of the problem you are having, there&#39;s not much we can do to help."}], "owner": {"reputation": 149, "user_id": 4056420, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ery1d.jpg?s=128&g=1", "display_name": "Peerhenry", "link": "https://stackoverflow.com/users/4056420/peerhenry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 255, "favorite_count": 0, "closed_date": 1534518431, "answer_count": 0, "score": 0, "last_activity_date": 1534520197, "creation_date": 1534505865, "last_edit_date": 1534520197, "question_id": 51894610, "link": "https://stackoverflow.com/questions/51894610/how-to-transfer-ownership-or-extract-a-mutable-reference-from-a-struct", "closed_reason": "Duplicate", "title": "How to transfer ownership or extract a mutable reference from a struct", "body": "<p>Consider the following code:</p>\n\n<pre><code>struct Event {\n    id: i32,\n}\n\nstruct EventsLoop;\nimpl EventsLoop {\n    pub fn new() -&gt; EventsLoop {\n        EventsLoop {}\n    }\n\n    pub fn poll_events&lt;F&gt;(&amp;mut self, _callback: F)\n    where\n        F: FnMut(Event),\n    {\n        // gets event and passes it to the callback\n    }\n}\n\nstruct Store {\n    events_loop: EventsLoop,\n    running: bool,\n}\n\nfn main() {\n    let store = setup_store();\n    run_app(store);\n}\n\nfn setup_store() -&gt; Store {\n    Store {\n        events_loop: EventsLoop::new(),\n        running: true,\n    }\n}\n\nfn run_app(mut store: Store) {\n    let mut e_loop = store.events_loop;\n    e_loop.poll_events(|event| {\n        // poll_events needs EventsLoop as a mutable reference\n        match event {\n            Event { id: -1 } =&gt; {\n                store.running = false;\n            }\n            _ =&gt; { /* store is used in other events */ }\n        }\n    })\n}\n</code></pre>\n\n<p>This causes the compiler to complain:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0382]: capture of partially moved value: `store`\n  --&gt; src/main.rs:38:24\n   |\n37 |     let mut e_loop = store.events_loop;\n   |         ---------- value moved here\n38 |     e_loop.poll_events(|event| {\n   |                        ^^^^^^^ value captured here after move\n   |\n   = note: move occurs because `store.events_loop` has type `EventsLoop`, which does not implement the `Copy` trait\n</code></pre>\n\n<p>I have a closure that needs to either borrow or take ownership of <code>store</code>. At the same time I need <code>store.events_loop</code> as a mutable reference (because of its method <code>poll_events</code>). I thought that maybe I could get around the multiple mutable borrowing problem by passing ownership of the <code>EventsLoop</code> from <code>store</code> to the function scope. So my first question is:</p>\n\n<ol>\n<li>Can this problem be solved by somehow moving the <code>EventsLoop</code> out of <code>store</code>?</li>\n</ol>\n\n<p>Another solution I thought of was passing <code>store</code> to <code>run_app</code> as an immutable reference, and wrapping the field <code>running</code> in a <code>Cell</code>, but then I would need some kind of smart pointer to get the <code>EventsLoop</code> as a mutable reference. So that leads me to my second question:</p>\n\n<ol start=\"2\">\n<li>Is there a way to extract <code>events_loop</code> from <code>store</code> as a <em>mutable</em> reference when <code>store</code> was passed as an <em>immutable</em> reference?</li>\n</ol>\n\n<p>Edit:</p>\n\n<p>My apologies for not having an MVCE in my first post. The current example should reproduce the problem.\nIt has been suggested this question may be duplicate to <a href=\"https://stackoverflow.com/questions/36379242/mutably-borrow-one-struct-field-while-borrowing-another-in-a-closure\">Mutably borrow one struct field while borrowing another in a closure</a>\nThe situation here is similar but different. \nThe question in the link is about two fields in a struct, using one field from a struct in a closure that is passed to a method on the other field.\nThis question is about using a struct in a closure, that closure being passed to a method of a field inside that struct. \nThe point here is that I would like to be able to access the store in the closure, while also getting the events loop from the store. The idea is that all data structures created at initialization in <code>setup_store</code> - including the events loop - go into a single struct.</p>\n"}, {"tags": ["string", "rust", "api-design", "copy-on-write"], "answers": [{"comments": [{"owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "edited": false, "score": 4, "creation_date": 1534507665, "post_id": 51894908, "comment_id": 90740704, "body": "This was my first thought, but you have to check the edge case anyway: While iterating over the string slice, you have to check every single character. For now, the <code>String</code> is allocated before and then it loops over every letter. It&#39;s changed when needed. You could just search for the first occurrence of a upper cased letter: <code>str.chars().position(|c| !c.is_lowercase())</code>. If nothing is found, you return <code>Cow::Borrow</code>, otherwise you start converting to lower case from this point."}, {"owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "edited": false, "score": 0, "creation_date": 1534508682, "post_id": 51894908, "comment_id": 90741316, "body": "More or less <a href=\"https://play.rust-lang.org/?gist=159c238a86a453aa217aabb5d3936bb9&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">this</a>"}], "tags": [], "owner": {"reputation": 36134, "user_id": 493729, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/bU0Kx.jpg?s=128&g=1", "display_name": "Peter Hall", "link": "https://stackoverflow.com/users/493729/peter-hall"}, "is_accepted": false, "score": 1, "last_activity_date": 1534508016, "last_edit_date": 1534508016, "creation_date": 1534506854, "answer_id": 51894908, "question_id": 51894489, "link": "https://stackoverflow.com/questions/51894489/why-does-to-ascii-lowercase-return-a-string-rather-than-a-cowstr/51894908#51894908", "title": "Why does to_ascii_lowercase return a String rather than a Cow&lt;str&gt;?", "body": "<p>The reason why you might want to return a <code>Cow&lt;str&gt;</code> presumably is because the string may <em>already</em> be lower case. However, to detect this edge case might also introduce a performance degradation when the string is not already lower case, which intuitively seems like the most common scenario.</p>\n\n<p>You can, of course, create your own function that wraps <code>to_ascii_lowercase()</code>, checks if it is already lower case, and return a <code>Cow&lt;str&gt;</code>:</p>\n\n<pre><code>fn my_to_ascii_lowercase&lt;'a&gt;(s: &amp;'a str) -&gt; Cow&lt;'a, str&gt; {\n    let bytes = s.as_bytes();\n    if bytes.is_ascii() &amp;&amp; bytes.iter().all(u8::is_ascii_lowercase) {\n        Cow::Borrowed(s)\n    } else {\n        Cow::Owned(s.to_ascii_lowercase())\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1549368525, "creation_date": 1534505458, "last_edit_date": 1549368525, "question_id": 51894489, "link": "https://stackoverflow.com/questions/51894489/why-does-to-ascii-lowercase-return-a-string-rather-than-a-cowstr", "title": "Why does to_ascii_lowercase return a String rather than a Cow&lt;str&gt;?", "body": "<p><a href=\"https://doc.rust-lang.org/std/primitive.str.html#method.to_ascii_lowercase\" rel=\"nofollow noreferrer\"><code>str::to_ascii_lowercase</code></a> returns a String. Why doesn't it return a <a href=\"https://doc.rust-lang.org/std/borrow/enum.Cow.html\" rel=\"nofollow noreferrer\"><code>Cow&lt;str&gt;</code></a> just like <a href=\"https://doc.rust-lang.org/std/primitive.str.html?search=to_string_lossy\" rel=\"nofollow noreferrer\"><code>to_string_lossy</code></a> or <a href=\"https://doc.rust-lang.org/std/string/struct.String.html#method.from_utf8_lossy\" rel=\"nofollow noreferrer\"><code>String::from_utf8_lossy</code></a>?</p>\n\n<p>The same applies to <a href=\"https://doc.rust-lang.org/std/primitive.str.html#method.to_ascii_uppercase\" rel=\"nofollow noreferrer\"><code>str::to_ascii_uppercase</code></a>.</p>\n"}, {"tags": ["json", "rust", "serde"], "answers": [{"tags": [], "owner": {"reputation": 113, "user_id": 7602302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c47b79ab3d92098c0b0a889f2583bc0b?s=128&d=identicon&r=PG&f=1", "display_name": "Tverous", "link": "https://stackoverflow.com/users/7602302/tverous"}, "is_accepted": true, "score": 3, "last_activity_date": 1534509262, "last_edit_date": 1534509262, "creation_date": 1534498254, "answer_id": 51892383, "question_id": 51890312, "link": "https://stackoverflow.com/questions/51890312/parsing-json-with-multiple-representation-in-the-same-attribute/51892383#51892383", "title": "Parsing JSON with multiple representation in the same attribute", "body": "<p>I got <a href=\"https://github.com/serde-rs/json/issues/473\" rel=\"nofollow noreferrer\">help from the serde-rs developer</a>:</p>\n\n<blockquote>\n  <p>I would recommend using an <a href=\"https://serde.rs/enum-representations.html#untagged\" rel=\"nofollow noreferrer\">untagged enum</a> to represent a coordinate array that can be 2d or 3d.\n  <a href=\"https://play.rust-lang.org/?gist=e1f4a4e688b3adc08ccded3c4a571cdb&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">Playground link</a></p>\n</blockquote>\n\n<p>Here is the code after modification:</p>\n\n<pre><code>#[derive(Serialize, Deserialize, Debug)]\nstruct Geometry {\n    #[serde(deserialize_with = \"string_or_number\", rename = \"type\")]\n    geometry_type: Value,\n    #[serde(default, skip_serializing_if = \"Vec::is_empty\", rename = \"coordinates\")]\n    geometry_coor: Vec&lt;Coordinates_form&gt;,\n}\n\n#[derive(Serialize, Deserialize, Debug)]\n#[serde(untagged)]\nenum Coordinates_form {\n    #[serde(skip_serializing)]\n    OneD(Coordinates),\n    #[serde(skip_serializing)]\n    TwoD(Vec&lt;Coordinates&gt;),\n    #[serde(skip_serializing)]\n    ThreeD(Vec&lt;Vec&lt;Coordinates&gt;&gt;),\n}\n\n#[derive(Deserialize, Debug)]\nstruct Coordinates {\n    #[serde(deserialize_with = \"string_or_number\")]\n    longitude: Value, \n    #[serde(deserialize_with = \"string_or_number\")]\n    latitude: Value,\n}\n\nfn string_or_number&lt;'de, D&gt;(de: D) -&gt; Result&lt;Value, D::Error&gt;\nwhere\n    D: serde::Deserializer&lt;'de&gt;,\n{\n    let helper: Value = Deserialize::deserialize(de)?;\n\n    match helper {\n        Value::Number(n) =&gt; {\n            println!(\"{:#?}\", n.as_f64().unwrap().to_string());\n            Ok(Value::Number(n))\n        }\n        Value::String(s) =&gt; Ok(json!(s)),\n        _ =&gt; Ok(json!(null)),\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 7602302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c47b79ab3d92098c0b0a889f2583bc0b?s=128&d=identicon&r=PG&f=1", "display_name": "Tverous", "link": "https://stackoverflow.com/users/7602302/tverous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 441, "favorite_count": 0, "accepted_answer_id": 51892383, "answer_count": 1, "score": 6, "last_activity_date": 1534553924, "creation_date": 1534490648, "last_edit_date": 1534553924, "question_id": 51890312, "link": "https://stackoverflow.com/questions/51890312/parsing-json-with-multiple-representation-in-the-same-attribute", "title": "Parsing JSON with multiple representation in the same attribute", "body": "<p>I'm relatively new to Rust, and even more so to Serde, so I'm having trouble finding out if this is even doable. I have a JSON file which has two different representations for the same key: </p>\n\n<pre><code>\"coordinates\": [\n  [\n    [\n      121.423364,\n      24.9913596\n    ],\n    [\n      121.4233327,\n      24.9912977\n    ],\n  ]\n]\n</code></pre>\n\n<p>and this:</p>\n\n<pre><code>\"coordinates\": [\n  [\n    121.4472492,\n    25.0052053\n  ],\n  [\n    121.4466457,\n    25.0028547\n  ]\n]\n</code></pre>\n\n<p>There is a two dimensional array and a three dimensional array representing ways in the same attribute. This makes the file hard to serialize.</p>\n\n<p>Here is the code that I implemented:</p>\n\n<pre><code>#[derive(Serialize, Deserialize, Debug)]\nstruct Geometry {\n    #[serde(deserialize_with = \"string_or_number\", rename = \"type\")]\n    geometry_type: Value,\n    #[serde(default, skip_serializing_if = \"Vec::is_empty\", rename = \"coordinates\")]\n    geometry_coor: Vec&lt;Coordinates&gt;,\n    #[serde(default, skip_serializing_if = \"Vec::is_empty\", rename = \"coordinates\")]\n    geometry_coor2: Vec&lt;Vec&lt;Coordinates&gt;&gt;,\n}\n\n#[derive(Serialize, Deserialize, Debug)]\nstruct Coordinates {\n    #[serde(deserialize_with = \"string_or_number\")]\n    longitude: Value,\n    #[serde(deserialize_with = \"string_or_number\")]\n    latitude: Value,\n}\n\nfn string_or_number&lt;'de, D&gt;(de: D) -&gt; Result&lt;Value, D::Error&gt;\nwhere\n    D: serde::Deserializer&lt;'de&gt;,\n{\n    let helper: Value = Deserialize::deserialize(de)?;\n\n    match helper {\n        Value::Number(n) =&gt; {\n            println!(\"{:#?}\", n.as_f64().unwrap().to_string());\n            Ok(Value::Number(n))\n        }\n        Value::String(s) =&gt; Ok(json!(s)),\n        _ =&gt; Ok(json!(null)),\n    }\n}\n</code></pre>\n\n<p>I have trouble in <code>struct Geometry</code> which serializes the file of coordinates.</p>\n\n<p>Are there any ways that I can deal with this kind of form?</p>\n"}, {"tags": ["rust", "iron"], "answers": [{"comments": [{"owner": {"reputation": 33796, "user_id": 45525, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/TKzgD.png?s=128&g=1", "display_name": "Synesso", "link": "https://stackoverflow.com/users/45525/synesso"}, "edited": false, "score": 0, "creation_date": 1534474025, "post_id": 51887661, "comment_id": 90726680, "body": "Thank you. I didn&#39;t read the docs, but I did check the source &amp; it was less obvious there (to my eyes)."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 3, "last_activity_date": 1534473168, "creation_date": 1534473168, "answer_id": 51887661, "question_id": 51887262, "link": "https://stackoverflow.com/questions/51887262/how-do-i-create-a-custom-content-type-with-iron/51887661#51887661", "title": "How do I create a custom Content-Type with Iron?", "body": "<blockquote>\n  <p>but there's no <code>SubLevel</code> that corresponds to protobuf. </p>\n</blockquote>\n\n<p>If you read <a href=\"https://docs.rs/iron/0.5.1/iron/mime/enum.SubLevel.html\" rel=\"nofollow noreferrer\">the documentation for <code>SubLevel</code></a>, you'll see its definition:</p>\n\n<pre><code>pub enum SubLevel {\n    Star,\n    Plain,\n    // ... snip ...\n    Ogg,\n    Ext(String),\n}\n</code></pre>\n\n<p>Thus, you need:</p>\n\n<pre><code>extern crate iron; // 0.6.0\n\nuse iron::{\n    headers::ContentType,\n    mime::{Mime, SubLevel, TopLevel},\n    Headers,\n};\n\nfn main() {\n    let mut headers = Headers::new();\n    headers.set(ContentType(Mime(\n        TopLevel::Application,\n        SubLevel::Ext(\"x-protobuf\".into()),\n        vec![],\n    )));\n}\n</code></pre>\n"}], "owner": {"reputation": 33796, "user_id": 45525, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/TKzgD.png?s=128&g=1", "display_name": "Synesso", "link": "https://stackoverflow.com/users/45525/synesso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 51887661, "answer_count": 1, "score": 1, "last_activity_date": 1534473168, "creation_date": 1534469265, "last_edit_date": 1534472907, "question_id": 51887262, "link": "https://stackoverflow.com/questions/51887262/how-do-i-create-a-custom-content-type-with-iron", "title": "How do I create a custom Content-Type with Iron?", "body": "<p>I want to create the header <code>Content-Type: application/x-protobuf</code> in my Iron web app.</p>\n\n<p>I can see from the Iron docs that <a href=\"https://docs.rs/iron/0.5.1/iron/headers/struct.ContentType.html\" rel=\"nofollow noreferrer\">it's possible to construct content-types</a>, but there's no <code>SubLevel</code> that corresponds to protobuf. </p>\n\n<p>How can I create this content-type value?</p>\n\n<pre><code>let mut headers = Headers::new();\nheaders.set(ContentType(Mime(TopLevel::Application, SubLevel::???, vec![])));\n</code></pre>\n"}, {"tags": ["rust", "rust-tokio"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534472753, "post_id": 51887255, "comment_id": 90726458, "body": "Potentially a duplicate of <a href=\"https://stackoverflow.com/q/51885745/155423\">How do I conditionally return different types of futures?</a>."}, {"owner": {"reputation": 1299, "user_id": 216247, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/714f671da100ae1caacfae017ed07a3a?s=128&d=identicon&r=PG", "display_name": "scooterman", "link": "https://stackoverflow.com/users/216247/scooterman"}, "reply_to_user": {"reputation": 134258, "user_id": 785065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qAbxM.jpg?s=128&g=1", "display_name": "loganfsmyth", "link": "https://stackoverflow.com/users/785065/loganfsmyth"}, "edited": false, "score": 0, "creation_date": 1534523445, "post_id": 51887255, "comment_id": 90750141, "body": "@loganfsmyth I&#39;ve updated the question with more information."}, {"owner": {"reputation": 1299, "user_id": 216247, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/714f671da100ae1caacfae017ed07a3a?s=128&d=identicon&r=PG", "display_name": "scooterman", "link": "https://stackoverflow.com/users/216247/scooterman"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534523466, "post_id": 51887255, "comment_id": 90750153, "body": "@Shepmaster indeed, with Either I&#39;ve managed to make it work. After my last update, do you think it&#39;s possible to use <code>impl User</code> or I have to use <code>Box&lt;User&gt;</code>?"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 0, "creation_date": 1544180402, "post_id": 51887255, "comment_id": 94193803, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/51885745/how-do-i-conditionally-return-different-types-of-futures\">How do I conditionally return different types of futures?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1299, "user_id": 216247, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/714f671da100ae1caacfae017ed07a3a?s=128&d=identicon&r=PG", "display_name": "scooterman", "link": "https://stackoverflow.com/users/216247/scooterman"}, "is_accepted": true, "score": 2, "last_activity_date": 1535919576, "creation_date": 1535919576, "answer_id": 52140729, "question_id": 51887255, "link": "https://stackoverflow.com/questions/51887255/converting-a-future-result-in-another-future/52140729#52140729", "title": "Converting a future result in another future", "body": "<p>At the end the comment from shepmaster led me to the response through this other question: <a href=\"https://stackoverflow.com/q/51885745/155423\">How do I conditionally return different types of futures?</a></p>\n\n<p>Basically using Either::A and Either::B solves the issue. I still couldn't make it work without boxing the parameters but this might be a different question.</p>\n"}], "owner": {"reputation": 1299, "user_id": 216247, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/714f671da100ae1caacfae017ed07a3a?s=128&d=identicon&r=PG", "display_name": "scooterman", "link": "https://stackoverflow.com/users/216247/scooterman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1013, "favorite_count": 0, "accepted_answer_id": 52140729, "answer_count": 1, "score": 1, "last_activity_date": 1535919576, "creation_date": 1534469216, "last_edit_date": 1534524744, "question_id": 51887255, "link": "https://stackoverflow.com/questions/51887255/converting-a-future-result-in-another-future", "title": "Converting a future result in another future", "body": "<p>I have a function that returns a future with a <code>User</code> trait. I have two concrete implementations of it: <code>AnonymousUser</code> and <code>BaseUser</code>. To get the <code>BaseUser</code>, after authentication, I have to go to the database and fetch it, which may or not succeed, and return the new future with the correct type. I've tried the following (<a href=\"https://play.rust-lang.org/?gist=9093a8fea7e786c15a4e68e5fa5ec61e&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">playground</a>):</p>\n\n<pre><code>extern crate futures; // 0.1.23\nextern crate rand; // 0.5.4\n\nuse futures::future::{ok, Future};\nuse std::io::Error;\n\ntrait User {}\n\n#[derive(Debug)]\nstruct AnonymousUser;\nimpl User for AnonymousUser {}\n\n#[derive(Debug)]\nstruct BaseUser;\nimpl User for BaseUser {}\n\nfn fetch_base_user() -&gt; impl Future&lt;Item = BaseUser, Error = Error&gt; {\n    ok(BaseUser)\n}\n\nfn run_future() -&gt; impl Future&lt;Item = impl User, Error = Error&gt; {\n    match rand::random::&lt;bool&gt;() {\n        true =&gt; fetch_base_user().from_err().then(move |res| match res {\n            Ok(user) =&gt; ok(user),\n            Err(_) =&gt; ok(AnonymousUser),\n        }),\n        false =&gt; ok(AnonymousUser),\n    }\n}\n\nfn main() {\n    run_future().and_then(move |user| println!(\"User {:?}\", user));\n}\n</code></pre>\n\n<p>this failed because the return of the <code>then</code> function expects a <code>BaseUser</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: match arms have incompatible types\n  --&gt; src/main.rs:23:62\n   |\n23 |           true =&gt; fetch_base_user().from_err().then(move |res| match res {\n   |  ______________________________________________________________^\n24 | |             Ok(user) =&gt; ok(user),\n25 | |             Err(_) =&gt; ok(AnonymousUser),\n   | |                       ----------------- match arm with an incompatible type\n26 | |         }),\n   | |_________^ expected struct `BaseUser`, found struct `AnonymousUser`\n   |\n   = note: expected type `futures::FutureResult&lt;BaseUser, _&gt;`\n              found type `futures::FutureResult&lt;AnonymousUser, _&gt;`\n</code></pre>\n\n<p>I tried forcing the return type:</p>\n\n<pre><code>use futures::future::FutureResult;\n\nfn run_future() -&gt; impl Future&lt;Item=impl User, Error=Error&gt; {\n    match rand::random::&lt;bool&gt;() {\n        true =&gt; fetch_base_user().from_err().then(move |res| -&gt;\n        FutureResult&lt;impl User, Error&gt; { // Forcing the result type here\n            match res {\n                Ok(user) =&gt; ok(user),\n                Err(_) =&gt; ok(AnonymousUser),\n            }\n        }),\n        false =&gt; ok(AnonymousUser),\n    }\n}\n</code></pre>\n\n<p>which fails with:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0562]: `impl Trait` not allowed outside of function and inherent method return types\n  --&gt; src/main.rs:27:22\n   |\n27 |         FutureResult&lt;impl User, Error&gt; { // Forcing the result type here\n   |                      ^^^^^^^^^\n</code></pre>\n\n<p>I've tried to rework using <code>Box</code>es for the return, which almost worked (<a href=\"https://play.rust-lang.org/?gist=6a80a01d7c20969952929d894d78eeff&amp;version=stable&amp;mode=debug&amp;edition=2015\" rel=\"nofollow noreferrer\">playground</a>)</p>\n\n<pre><code>fn run_future() -&gt; impl Future&lt;Item = Box&lt;impl User&gt;, Error = Error&gt; {\n    match rand::random::&lt;bool&gt;() {\n        true =&gt; fetch_base_user()\n            .from_err()\n            .then(move |res| -&gt; FutureResult&lt;Box&lt;User&gt;, Error&gt; {\n                match res {\n                    Ok(user) =&gt; ok(Box::new(user) as Box&lt;User&gt;),\n                    Err(_) =&gt; ok(Box::new(AnonymousUser) as Box&lt;User&gt;),\n                }\n            }),\n        false =&gt; ok(Box::new(AnonymousUser) as Box&lt;User&gt;),\n    }\n}\n</code></pre>\n\n<p>which fails with </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: match arms have incompatible types\n  --&gt; src/main.rs:22:5\n   |\n22 | /     match rand::random::&lt;bool&gt;() {\n23 | |         true =&gt; fetch_base_user().from_err().then(move |res| match res {\n24 | |             Ok(user) =&gt; ok(Box::new(user) as Box&lt;User&gt;),\n25 | |             Err(_) =&gt; ok(Box::new(AnonymousUser) as Box&lt;User&gt;),\n26 | |         }),\n27 | |         false =&gt; ok(Box::new(AnonymousUser) as Box&lt;User&gt;),\n   | |                  ---------------------------------------- match arm with an incompatible type\n28 | |     }\n   | |_____^ expected struct `futures::Then`, found struct `futures::FutureResult`\n   |\n   = note: expected type `futures::Then&lt;futures::future::FromErr&lt;impl futures::Future, _&gt;, futures::FutureResult&lt;std::boxed::Box&lt;User&gt;, _&gt;, [closure@src/main.rs:23:51: 26:10]&gt;`\n              found type `futures::FutureResult&lt;std::boxed::Box&lt;User&gt;, _&gt;`\n</code></pre>\n\n<p>So I guess it's only a matter of forcing both to be the same result type</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 939, "user_id": 2870802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHzULJklIJg/AAAAAAAAAAI/AAAAAAAABwk/_pJZF95FiAY/photo.jpg?sz=128", "display_name": "ozkriff", "link": "https://stackoverflow.com/users/2870802/ozkriff"}, "edited": false, "score": 0, "creation_date": 1534483549, "post_id": 51886379, "comment_id": 90728715, "body": "You may be interested in this threads: <a href=\"https://www.reddit.com/r/rust/comments/5fu7pd/the_intooption_trick\" rel=\"nofollow noreferrer\">reddit.com/r/rust/comments/5fu7pd/the_intooption_trick</a>  <a href=\"https://www.reddit.com/r/rust/comments/556c0g/optional_arguments_in_rust_112\" rel=\"nofollow noreferrer\">reddit.com/r/rust/comments/556c0g/&hellip;</a> (TLDR: it&#39;s controversial)"}, {"owner": {"reputation": 765, "user_id": 7246614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83eccd212e4687fc66e13aad21796b0b?s=128&d=identicon&r=PG", "display_name": "timotree", "link": "https://stackoverflow.com/users/7246614/timotree"}, "edited": false, "score": 1, "creation_date": 1550637546, "post_id": 51886379, "comment_id": 96336922, "body": "How can this be answered objectively?"}], "answers": [{"tags": [], "owner": {"reputation": 90851, "user_id": 27009, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f0a29af415477aa8c498a4f41ffe6640?s=128&d=identicon&r=PG", "display_name": "Kornel", "link": "https://stackoverflow.com/users/27009/kornel"}, "is_accepted": true, "score": 1, "last_activity_date": 1563963591, "creation_date": 1563963591, "answer_id": 57180601, "question_id": 51886379, "link": "https://stackoverflow.com/questions/51886379/is-it-idiomatic-to-use-implt-fromt-for-optiont-in-argument-position/57180601#57180601", "title": "Is it idiomatic to use `impl&lt;T&gt; From&lt;T&gt; for Option&lt;T&gt;` in argument position?", "body": "<p>This pattern is uncommon, but reasonably easy to understand. If it's convenient in the context of your library's usage, it should be OK.</p>\n\n<p>I think it's more common to have <code>do_stuff</code> and <code>do_stuff_with_timeout</code> functions.</p>\n"}], "owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 1, "accepted_answer_id": 57180601, "answer_count": 1, "score": 6, "last_activity_date": 1563963591, "creation_date": 1534460388, "question_id": 51886379, "link": "https://stackoverflow.com/questions/51886379/is-it-idiomatic-to-use-implt-fromt-for-optiont-in-argument-position", "title": "Is it idiomatic to use `impl&lt;T&gt; From&lt;T&gt; for Option&lt;T&gt;` in argument position?", "body": "<p>This trait is <a href=\"https://doc.rust-lang.org/std/option/enum.Option.html#impl-From%3CT%3E\" rel=\"noreferrer\">implemented since 1.12.0</a>:</p>\n\n<pre><code>impl&lt;T&gt; From&lt;T&gt; for Option&lt;T&gt; {\n    fn from(val: T) -&gt; Option&lt;T&gt; {\n        Some(val)\n    }\n}\n</code></pre>\n\n<p>How idiomatic is this as an argument? Consider this example:</p>\n\n<pre><code>fn do_things(parameters: &amp;Foo, optional_argument: impl Into&lt;Option&lt;Duration&gt;&gt;) {\n    let optional_argument = optional_argument.into();\n    // use it...\n}\n</code></pre>\n\n<p>If you see the documentation, it's (more or less) clear (if you know, that this trait is implemented). But if you see the code, you may be confused:</p>\n\n<pre><code>do_things(params, Duration::from_millis(100));\n</code></pre>\n\n<p>Is this fine to use or should it be avoided?</p>\n"}, {"tags": ["asynchronous", "rust", "future", "control-flow"], "answers": [{"comments": [{"owner": {"reputation": 249985, "user_id": 147192, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/E78Vj.png?s=128&g=1", "display_name": "Matthieu M.", "link": "https://stackoverflow.com/users/147192/matthieu-m"}, "edited": false, "score": 4, "creation_date": 1534487763, "post_id": 51885804, "comment_id": 90730137, "body": "I would note that there is a middle ground solution for the case of a large <code>B</code>: <code>Either(A, Box&lt;B&gt;)</code>. This way, you only pay for the heap allocation on the rare case where it&#39;s a B."}, {"owner": {"reputation": 762, "user_id": 1314907, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/3c575eac8eb587d55f783fbde27a3c76?s=128&d=identicon&r=PG&f=1", "display_name": "Lukasz Guminski", "link": "https://stackoverflow.com/users/1314907/lukasz-guminski"}, "edited": false, "score": 0, "creation_date": 1568406625, "post_id": 51885804, "comment_id": 102277479, "body": "In case of odd number of conditions you can define <code>Either&lt;A, Empty&lt;_, _&gt;&gt;</code>"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 762, "user_id": 1314907, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/3c575eac8eb587d55f783fbde27a3c76?s=128&d=identicon&r=PG&f=1", "display_name": "Lukasz Guminski", "link": "https://stackoverflow.com/users/1314907/lukasz-guminski"}, "edited": false, "score": 0, "creation_date": 1568643427, "post_id": 51885804, "comment_id": 102329361, "body": "@LukaszGuminski the examples I give handle 3 (odd) and 4 (even) conditions: <i>if you have more than 2 conditions (<code>Either&lt;A, Either&lt;B, C&gt;&gt;</code>; <code>Either&lt;Either&lt;A, B&gt;, Either&lt;C, D&gt;&gt;</code>, etc.)</i> . I don&#39;t understand why you are using <code>Empty</code>."}, {"owner": {"reputation": 762, "user_id": 1314907, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/3c575eac8eb587d55f783fbde27a3c76?s=128&d=identicon&r=PG&f=1", "display_name": "Lukasz Guminski", "link": "https://stackoverflow.com/users/1314907/lukasz-guminski"}, "edited": false, "score": 0, "creation_date": 1568665434, "post_id": 51885804, "comment_id": 102338940, "body": "@Shepmaster I tried to say that <code>Either&lt;Either&lt;A, B&gt;, C&gt;</code> could be written as <code>Either&lt;Either&lt;A, B&gt;, Either&lt;C, Empty&lt;_, _&gt;&gt;&gt;</code>. But now actually I am not sure if it is any better. The Either types are equally nested, but this doesn&#39;t seem to be an advantage. I think I overcomplicated."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 762, "user_id": 1314907, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/3c575eac8eb587d55f783fbde27a3c76?s=128&d=identicon&r=PG&f=1", "display_name": "Lukasz Guminski", "link": "https://stackoverflow.com/users/1314907/lukasz-guminski"}, "edited": false, "score": 0, "creation_date": 1568666568, "post_id": 51885804, "comment_id": 102339314, "body": "@LukaszGuminski in the absence of other information, I&#39;d think that the version with less code in play (<code>Either&lt;A, Either&lt;B, C&gt;&gt;</code>) would be better."}, {"owner": {"reputation": 762, "user_id": 1314907, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/3c575eac8eb587d55f783fbde27a3c76?s=128&d=identicon&r=PG&f=1", "display_name": "Lukasz Guminski", "link": "https://stackoverflow.com/users/1314907/lukasz-guminski"}, "edited": false, "score": 0, "creation_date": 1568666852, "post_id": 51885804, "comment_id": 102339432, "body": "@Shepmaster I agree."}, {"owner": {"reputation": 7686, "user_id": 274972, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/6T1Bg.jpg?s=128&g=1", "display_name": "Monstieur", "link": "https://stackoverflow.com/users/274972/monstieur"}, "edited": false, "score": 0, "creation_date": 1569605401, "post_id": 51885804, "comment_id": 102664617, "body": "@Shepmaster Can you provide an example of nesting <code>Either</code> when there are early returns with <code>Either</code>."}], "tags": [], "owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "is_accepted": true, "score": 23, "last_activity_date": 1590513283, "last_edit_date": 1590513283, "creation_date": 1534456320, "answer_id": 51885804, "question_id": 51885745, "link": "https://stackoverflow.com/questions/51885745/how-do-i-conditionally-return-different-types-of-futures/51885804#51885804", "title": "How do I conditionally return different types of futures?", "body": "<h1>Using <code>async</code>/<code>await</code></h1>\n\n<p>Since Rust 1.39, you can use <code>async</code> and <code>await</code> syntax to cover most cases:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>async fn a() -&gt; usize {\n    2\n}\nasync fn b() -&gt; usize {\n    10\n}\n\nasync fn f() -&gt; usize {\n    if 1 &gt; 0 {\n        a().await\n    } else {\n        b().await + 2\n    }\n}\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/52835725/155423\">What is the purpose of async/await in Rust?</a></li>\n</ul>\n\n<h1><code>Either</code></h1>\n\n<p>Using <a href=\"https://docs.rs/futures/0.3.5/futures/future/enum.Either.html\" rel=\"nofollow noreferrer\"><code>futures::future::Either</code></a> via the <a href=\"https://docs.rs/futures/0.3.5/futures/future/trait.FutureExt.html\" rel=\"nofollow noreferrer\"><code>FutureExt</code></a> trait has no additional heap allocation:</p>\n\n<pre><code>use futures::{Future, FutureExt}; // 0.3.5\n\nasync fn a() -&gt; usize {\n    2\n}\n\nasync fn b() -&gt; usize {\n    10\n}\n\nfn f() -&gt; impl Future&lt;Output = usize&gt; {\n    if 1 &gt; 0 {\n        a().left_future()\n    } else {\n        b().right_future()\n    }\n}\n</code></pre>\n\n<p>However, this requires a fixed stack allocation. If <code>A</code> takes 1 byte and happens 99% of the time, but <code>B</code> takes up 512 bytes, your <code>Either</code> will <em>always</em> take up 512 bytes (plus some). This isn't always a win.</p>\n\n<h1>Boxed trait objects</h1>\n\n<p>Here we use <a href=\"https://docs.rs/futures/0.3.5/futures/future/trait.FutureExt.html#method.boxed\" rel=\"nofollow noreferrer\"><code>FutureExt::boxed</code></a> to return a trait object:</p>\n\n<pre><code>use futures::{Future, FutureExt}; // 0.3.5\n\nasync fn a() -&gt; usize {\n    2\n}\n\nasync fn b() -&gt; usize {\n    10\n}\n\nfn f() -&gt; impl Future&lt;Output = usize&gt; {\n    if 1 &gt; 0 {\n        a().boxed()\n    } else {\n        b().boxed()\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>As <a href=\"https://stackoverflow.com/questions/51885745/how-do-i-conditionally-return-different-types-of-futures/51885804?noredirect=1#comment90730137_51885804\">Matthieu M. points out</a>, the two solutions can be combined:</p>\n\n<blockquote>\n  <p>I would note that there is a middle ground solution for the case of a large <code>B</code>: <code>Either(A, Box&lt;B&gt;)</code>. This way, you only pay for the heap allocation on the rare case where it's a <code>B</code></p>\n</blockquote>\n\n<p>Note that you can also stack <code>Either</code>s if you have more than 2 conditions (<code>Either&lt;A, Either&lt;B, C&gt;&gt;</code>; <code>Either&lt;Either&lt;A, B&gt;, Either&lt;C, D&gt;&gt;</code>, etc.):</p>\n\n<pre><code>use futures::{Future, FutureExt}; // 0.3.5\n\nasync fn a() -&gt; i32 {\n    2\n}\n\nasync fn b() -&gt; i32 {\n    0\n}\n\nasync fn c() -&gt; i32 {\n    -2\n}\n\nfn f(v: i32) -&gt; impl Future&lt;Output = i32&gt; {\n    use std::cmp::Ordering;\n\n    match v.cmp(&amp;0) {\n        Ordering::Less =&gt; a().left_future(),\n        Ordering::Equal =&gt; b().left_future().right_future(),\n        Ordering::Greater =&gt; c().right_future().right_future(),\n    }\n}\n</code></pre>\n\n<p>See also:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/q/29760668/155423\">Conditionally iterate over one of several possible iterators</a></li>\n</ul>\n"}], "owner": {"reputation": 6491, "user_id": 1714997, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/44565e25a9f92a342de42b050e14aee5?s=128&d=identicon&r=PG", "display_name": "Dominykas Mostauskis", "link": "https://stackoverflow.com/users/1714997/dominykas-mostauskis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2563, "favorite_count": 3, "accepted_answer_id": 51885804, "answer_count": 1, "score": 15, "last_activity_date": 1590513283, "creation_date": 1534455924, "last_edit_date": 1534456399, "question_id": 51885745, "link": "https://stackoverflow.com/questions/51885745/how-do-i-conditionally-return-different-types-of-futures", "title": "How do I conditionally return different types of futures?", "body": "<p>I have a method that, depending on a predicate, will return one future or another. In other words, an if-else expression that returns a future:</p>\n\n<pre><code>extern crate futures; // 0.1.23\n\nuse futures::{future, Future};\n\nfn f() -&gt; impl Future&lt;Item = usize, Error = ()&gt; {\n    if 1 &gt; 0 {\n        future::ok(2).map(|x| x)\n    } else {\n        future::ok(10).and_then(|x| future::ok(x + 2))\n    }\n}\n</code></pre>\n\n<p>This doesn't compile: </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>error[E0308]: if and else have incompatible types\n  --&gt; src/lib.rs:6:5\n   |\n6  | /     if 1 &gt; 0 {\n7  | |         future::ok(2).map(|x| x)\n8  | |     } else {\n9  | |         future::ok(10).and_then(|x| future::ok(x + 2))\n10 | |     }\n   | |_____^ expected struct `futures::Map`, found struct `futures::AndThen`\n   |\n   = note: expected type `futures::Map&lt;futures::FutureResult&lt;{integer}, _&gt;, [closure@src/lib.rs:7:27: 7:32]&gt;`\n              found type `futures::AndThen&lt;futures::FutureResult&lt;{integer}, _&gt;, futures::FutureResult&lt;{integer}, _&gt;, [closure@src/lib.rs:9:33: 9:54]&gt;`\n</code></pre>\n\n<p>The futures are created differently, and might hold closures, so their types are not equal. Ideally, the solution wouldn't use <code>Box</code>es, since the rest of my async logic doesn't use them.</p>\n\n<p>How is if-else logic in futures normally done?</p>\n"}, {"tags": ["unit-testing", "rust"], "comments": [{"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1534451232, "post_id": 51884807, "comment_id": 90721217, "body": "I believe your question is answered by the answers of <a href=\"https://stackoverflow.com/q/31752882/155423\">What is the idiomatic way to have a private function tested?</a>. If you disagree, please <a href=\"https://stackoverflow.com/posts/51884807/edit\">edit</a> your question to explain the differences. Otherwise, we can mark this question as already answered."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534451586, "post_id": 51884807, "comment_id": 90721382, "body": "Otherwise, it&#39;s answered by the answers of <a href=\"https://stackoverflow.com/q/49479854/155423\">How do I change a function&#39;s qualifiers via conditional compilation?</a>."}, {"owner": {"reputation": 4068, "user_id": 862193, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/60a062a625895665d619c40b96f82d6a?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/862193/tim"}, "reply_to_user": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1534451720, "post_id": 51884807, "comment_id": 90721449, "body": "Yes, the conditional compilation macros are probably the closest to what I want."}], "owner": {"reputation": 4068, "user_id": 862193, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/60a062a625895665d619c40b96f82d6a?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/862193/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "closed_date": 1534455140, "answer_count": 0, "score": 0, "last_activity_date": 1534451017, "creation_date": 1534451017, "question_id": 51884807, "link": "https://stackoverflow.com/questions/51884807/conditional-visibility-for-unit-tests", "closed_reason": "Duplicate", "title": "Conditional visibility for unit tests", "body": "<p>I'm building a crate for reading and writing a file format. Reading is accomplished via <code>nom</code> parser-combinators. As a result I have lots of small parser methods like:</p>\n\n<pre><code>named!(read_prop_fs&lt;&amp;[u8], PropChunk&gt;, do_parse!(\n    tag!(\"FS  \") &gt;&gt;\n    size: be_u64 &gt;&gt;\n    fs: be_u32   &gt;&gt;\n    (PropChunk { id: PropId::FS(fs), size: size })\n));\n</code></pre>\n\n<p>The parser functions are in <code>io::input::internal</code> and are all private. Most of the data types they use are also private to that module.</p>\n\n<p>The file writer code I would like to test is in <code>io::output::internal</code>. Ideally, I would like to use the parser functions in unit tests for the writer.</p>\n\n<p>Making all these methods and types <code>pub</code> or even <code>crate</code> seems very ugly. It seems equally strange to invert the modules, having the equivalent of <code>io::internal::{input, output}</code> where <code>input</code> and <code>output</code> are ultimately <code>pub</code> and represent the crate API.</p>\n\n<p>Is there a way to do something like this?</p>\n\n<blockquote>\n  <p>When <code>#[cfg(test)]</code> is true the default visibility in the current module should be <code>crate</code>, otherwise the default should be private.</p>\n</blockquote>\n\n<p>If not, is there a typical, ergonomic workaround?</p>\n"}, {"tags": ["rust", "gdb"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1534429136, "post_id": 51879050, "comment_id": 90709905, "body": "Did you compile in release mode?"}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1534429275, "post_id": 51879050, "comment_id": 90710015, "body": "@Boiethios <code>rustc -g .&#47;fn.rs</code>"}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 1, "creation_date": 1534430178, "post_id": 51879050, "comment_id": 90710662, "body": "You are in a module <code>fn</code>: did you try to print the definition with the full path (<i>i.e.</i> <code>fn::one()</code>)? Display the list of the functions if you&#39;re not sure about the path."}, {"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 5, "creation_date": 1534434545, "post_id": 51879050, "comment_id": 90713319, "body": "It might help to have more information about the platform you are running and version of <code>rustc</code> and <code>rust-gdb</code>. When I run exactly what you posted, <code>gdb</code> does display <code>$1 = 1</code> as expected."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "reply_to_user": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1534434858, "post_id": 51879050, "comment_id": 90713474, "body": "@mcarton Did you try it with the function in another module?"}, {"owner": {"reputation": 5700, "user_id": 3131852, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/26365707ecfa02e221f5192aaaa29a43?s=128&d=identicon&r=PG", "display_name": "Tim Diekmann", "link": "https://stackoverflow.com/users/3131852/tim-diekmann"}, "edited": false, "score": 0, "creation_date": 1534439304, "post_id": 51879050, "comment_id": 90715913, "body": "Wrapping in a module also works: <code>print ::module::one()</code> also results in <code>$1 = 1</code>."}, {"owner": {"reputation": 269539, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 2, "creation_date": 1534439333, "post_id": 51879050, "comment_id": 90715927, "body": "@Boiethios there&#39;s no module here. OP is directly compiling the file <code>fn.rs</code>"}, {"owner": {"reputation": 170, "user_id": 6085922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1a177e3574c200dbb9307586be3e930?s=128&d=identicon&r=PG", "display_name": "fukatani", "link": "https://stackoverflow.com/users/6085922/fukatani"}, "reply_to_user": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1534485790, "post_id": 51879050, "comment_id": 90729407, "body": "Thanks everyone, I use rustc==1.27.0 and gdb==7.11 I use fn.rs only. There is no module. I tried additional command.      (gdb) p one     $1 = 1     (gdb) p one()     Invalid data type for function to be called.     (gdb) p ::module::one()     A syntax error in expression, near <code>::one()&#39;.     (gdb) p ::module::one     A syntax error in expression, near </code>::one&#39;.     (gdb) p fn::one()     No symbol &quot;one&quot; in namespace &quot;fn&quot;.   @mcarton Thanks, which version do you use?"}], "answers": [{"tags": [], "owner": {"reputation": 170, "user_id": 6085922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1a177e3574c200dbb9307586be3e930?s=128&d=identicon&r=PG", "display_name": "fukatani", "link": "https://stackoverflow.com/users/6085922/fukatani"}, "is_accepted": true, "score": 1, "last_activity_date": 1534581260, "creation_date": 1534581260, "answer_id": 51906796, "question_id": 51879050, "link": "https://stackoverflow.com/questions/51879050/how-to-print-the-result-of-calling-a-rust-function-in-rust-gdb/51906796#51906796", "title": "How to print the result of calling a Rust function in rust-gdb?", "body": "<p>I tried gdb==8.11.\nIt works perfect.</p>\n\n<pre><code>(gdb) p one\n$1 = {fn () -&gt; i32} 0x55555555a5a0 &lt;fn::one&gt;\n(gdb) p one()\n$2 = 1\n</code></pre>\n\n<p>Thanks, everyone. (especially @mcarton)</p>\n"}], "owner": {"reputation": 170, "user_id": 6085922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1a177e3574c200dbb9307586be3e930?s=128&d=identicon&r=PG", "display_name": "fukatani", "link": "https://stackoverflow.com/users/6085922/fukatani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 610, "favorite_count": 1, "accepted_answer_id": 51906796, "answer_count": 1, "score": 3, "last_activity_date": 1534723733, "creation_date": 1534428507, "last_edit_date": 1534723733, "question_id": 51879050, "link": "https://stackoverflow.com/questions/51879050/how-to-print-the-result-of-calling-a-rust-function-in-rust-gdb", "title": "How to print the result of calling a Rust function in rust-gdb?", "body": "<p>I want to print a function's result in the rust-gdb console.</p>\n\n<p>fn.rs</p>\n\n<pre><code>fn one() -&gt; i32 {\n    1\n}\n\nfn main() {\n    println!(\"{}\", one());\n}\n</code></pre>\n\n<p>console</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>rustc -g ./fn.rs\nrust-gdb ./fn\n&gt;&gt;&gt; b 6\n&gt;&gt;&gt; run\n&gt;&gt;&gt; print one()\nInvalid data type for function to be called.\n</code></pre>\n\n<p>Are there any means to display the function result?</p>\n\n<p>I am using Rust 1.27.0 and GDB 7.11. I am compiling fn.rs directly; there is no module. I tried these additional commands: </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>(gdb) p one \n$1 = 1 \n(gdb) p one() \nInvalid data type for function to be called. \n(gdb) p \n::module::one() A syntax error in expression, near ::one()'. \n(gdb) p \n::module::one A syntax error in expression, near ::one'. \n(gdb) p \nfn::one() No symbol \"one\" in namespace \"fn\".\n</code></pre>\n\n<p>p one() is disable?</p>\n"}, {"tags": ["rust"], "comments": [{"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 2, "creation_date": 1534409270, "post_id": 51871648, "comment_id": 90697528, "body": "TL;DR: a literal has a static lifetime, so <code>&#39;a</code> is inferred to be <code>&#39;static</code> in <code>skip</code>."}], "owner": {"reputation": 81, "user_id": 10180179, "user_type": "registered", "profile_image": "https://graph.facebook.com/186998478777114/picture?type=large", "display_name": "Sooner", "link": "https://stackoverflow.com/users/10180179/sooner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "closed_date": 1534405381, "answer_count": 0, "score": 3, "last_activity_date": 1534425832, "creation_date": 1534404128, "last_edit_date": 1534425832, "question_id": 51871648, "link": "https://stackoverflow.com/questions/51871648/why-doesnt-a-string-literal-vanish-after-going-out-of-scope", "closed_reason": "Duplicate", "title": "Why doesn&#39;t a string literal vanish after going out of scope?", "body": "<p>Shouldn't <code>test</code> vanish after going out of the scope? Why can <code>println!</code> still print the value of <code>test</code>?</p>\n\n<pre><code>fn skip&lt;'a&gt;(line: &amp;'a str, _prefix: &amp;'a str) -&gt; &amp;'a str {\n    line\n}\n\nfn main() {\n    let line = \"aaa\";\n    let q;\n    {\n        let test = \"bbb\";\n        q = skip(test, line);\n    }\n    println!(\"{}\", q);\n}\n</code></pre>\n"}]